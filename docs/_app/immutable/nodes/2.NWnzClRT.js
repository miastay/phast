import{s as Ks,e as xs,d as bs,f as Br,i as ii,v as ei,k as lr,n as TA,O as Cd,p as xf,t as cu,b as ws,h as hu,j as ks,l as gn,P as Wa,Q as Xa,x as yu,R as Ah,m as zc,S as Ig,T as Mg,U as Cg,o as jl,V as Du,W as bf,X as Pg,Y as Dg,c as Bg,u as zg,g as Lg,a as Rg,Z as wf,_ as kf,r as Fg}from"../chunks/scheduler.1u4hD_Ig.js";import{S as Js,i as eo,t as dr,g as Eh,a as Hr,c as Sh,b as Fo,d as Oo,m as Vo,e as No,f as Ef}from"../chunks/index.K17bVZBP.js";import{w as Vl,r as Lc}from"../chunks/index.C6ZM863q.js";function vu(p){return(p==null?void 0:p.length)!==void 0?p:Array.from(p)}function Pd(){return[[0,"#F9A825","Very low biodiversity"],[.35,"#e8f4c4"],[.5,"#00E676","Expected biodiversity"],[.75,"#3d9ab8"],[.85,"#318ab5"],[1,"#2a4e9b","Very high biodiversity"]]}function Sf(p,_,E){const T=p.slice();return T[1]=_[E],T}function Og(p){let _,E,T,D=p[1][2]+"",L,V;return{c(){_=xs("div"),E=xs("div"),T=xs("span"),L=cu(D),V=ws(),this.h()},l(h){_=bs(h,"DIV",{class:!0});var U=Br(_);E=bs(U,"DIV",{class:!0,style:!0}),Br(E).forEach(ii),T=bs(U,"SPAN",{});var R=Br(T);L=hu(R,D),R.forEach(ii),V=ks(U),U.forEach(ii),this.h()},h(){ei(E,"class","square svelte-bdqmuj"),ei(E,"style",`background: ${p[1][1]}`),ei(_,"class","item svelte-bdqmuj")},m(h,U){lr(h,_,U),gn(_,E),gn(_,T),gn(T,L),gn(_,V)},p:TA,d(h){h&&ii(_)}}}function Tf(p){let _,E=p[1][2]&&Og(p);return{c(){E&&E.c(),_=xf()},l(T){E&&E.l(T),_=xf()},m(T,D){E&&E.m(T,D),lr(T,_,D)},p(T,D){T[1][2]&&E.p(T,D)},d(T){T&&ii(_),E&&E.d(T)}}}function Vg(p){let _,E=vu(p[0]),T=[];for(let D=0;D<E.length;D+=1)T[D]=Tf(Sf(p,E,D));return{c(){_=xs("div");for(let D=0;D<T.length;D+=1)T[D].c();this.h()},l(D){_=bs(D,"DIV",{class:!0});var L=Br(_);for(let V=0;V<T.length;V+=1)T[V].l(L);L.forEach(ii),this.h()},h(){ei(_,"class","legend-container svelte-bdqmuj")},m(D,L){lr(D,_,L);for(let V=0;V<T.length;V+=1)T[V]&&T[V].m(_,null)},p(D,[L]){if(L&1){E=vu(D[0]);let V;for(V=0;V<E.length;V+=1){const h=Sf(D,E,V);T[V]?T[V].p(h,L):(T[V]=Tf(h),T[V].c(),T[V].m(_,null))}for(;V<T.length;V+=1)T[V].d(1);T.length=E.length}},i:TA,o:TA,d(D){D&&ii(_),Cd(T,D)}}}function Ng(p){return[Pd()]}class Ug extends Js{constructor(_){super(),eo(this,_,Ng,Vg,Ks,{})}}function fu(p,_){return p==null||_==null?NaN:p<_?-1:p>_?1:p>=_?0:NaN}function Gg(p,_){return p==null||_==null?NaN:_<p?-1:_>p?1:_>=p?0:NaN}function Dd(p){let _,E,T;p.length!==2?(_=fu,E=(h,U)=>fu(p(h),U),T=(h,U)=>p(h)-U):(_=p===fu||p===Gg?p:jg,E=p,T=p);function D(h,U,R=0,ie=h.length){if(R<ie){if(_(U,U)!==0)return ie;do{const X=R+ie>>>1;E(h[X],U)<0?R=X+1:ie=X}while(R<ie)}return R}function L(h,U,R=0,ie=h.length){if(R<ie){if(_(U,U)!==0)return ie;do{const X=R+ie>>>1;E(h[X],U)<=0?R=X+1:ie=X}while(R<ie)}return R}function V(h,U,R=0,ie=h.length){const X=D(h,U,R,ie-1);return X>R&&T(h[X-1],U)>-T(h[X],U)?X-1:X}return{left:D,center:V,right:L}}function jg(){return 0}function qg(p){return p===null?NaN:+p}const Zg=Dd(fu),Qg=Zg.right;Dd(qg).center;function $g(p,_){let E,T;if(_===void 0)for(const D of p)D!=null&&(E===void 0?D>=D&&(E=T=D):(E>D&&(E=D),T<D&&(T=D)));else{let D=-1;for(let L of p)(L=_(L,++D,p))!=null&&(E===void 0?L>=L&&(E=T=L):(E>L&&(E=L),T<L&&(T=L)))}return[E,T]}const Hg=Math.sqrt(50),Wg=Math.sqrt(10),Xg=Math.sqrt(2);function xu(p,_,E){const T=(_-p)/Math.max(0,E),D=Math.floor(Math.log10(T)),L=T/Math.pow(10,D),V=L>=Hg?10:L>=Wg?5:L>=Xg?2:1;let h,U,R;return D<0?(R=Math.pow(10,-D)/V,h=Math.round(p*R),U=Math.round(_*R),h/R<p&&++h,U/R>_&&--U,R=-R):(R=Math.pow(10,D)*V,h=Math.round(p/R),U=Math.round(_/R),h*R<p&&++h,U*R>_&&--U),U<h&&.5<=E&&E<2?xu(p,_,E*2):[h,U,R]}function Yg(p,_,E){if(_=+_,p=+p,E=+E,!(E>0))return[];if(p===_)return[p];const T=_<p,[D,L,V]=T?xu(_,p,E):xu(p,_,E);if(!(L>=D))return[];const h=L-D+1,U=new Array(h);if(T)if(V<0)for(let R=0;R<h;++R)U[R]=(L-R)/-V;else for(let R=0;R<h;++R)U[R]=(L-R)*V;else if(V<0)for(let R=0;R<h;++R)U[R]=(D+R)/-V;else for(let R=0;R<h;++R)U[R]=(D+R)*V;return U}function uh(p,_,E){return _=+_,p=+p,E=+E,xu(p,_,E)[2]}function Kg(p,_,E){_=+_,p=+p,E=+E;const T=_<p,D=T?uh(_,p,E):uh(p,_,E);return(T?-1:1)*(D<0?1/-D:D)}function Jg(p){return p}var Rc=1,Fc=2,ch=3,wA=4,If=1e-6;function e_(p){return"translate("+p+",0)"}function t_(p){return"translate(0,"+p+")"}function i_(p){return _=>+p(_)}function r_(p,_){return _=Math.max(0,p.bandwidth()-_*2)/2,p.round()&&(_=Math.round(_)),E=>+p(E)+_}function n_(){return!this.__axis}function Bd(p,_){var E=[],T=null,D=null,L=6,V=6,h=3,U=typeof window<"u"&&window.devicePixelRatio>1?0:.5,R=p===Rc||p===wA?-1:1,ie=p===wA||p===Fc?"x":"y",X=p===Rc||p===ch?e_:t_;function K(Ae){var we=T??(_.ticks?_.ticks.apply(_,E):_.domain()),xe=D??(_.tickFormat?_.tickFormat.apply(_,E):Jg),Te=Math.max(L,0)+h,Le=_.range(),Ze=+Le[0]+U,We=+Le[Le.length-1]+U,je=(_.bandwidth?r_:i_)(_.copy(),U),nt=Ae.selection?Ae.selection():Ae,Tt=nt.selectAll(".domain").data([null]),Ot=nt.selectAll(".tick").data(we,_).order(),It=Ot.exit(),Kt=Ot.enter().append("g").attr("class","tick"),Lt=Ot.select("line"),kt=Ot.select("text");Tt=Tt.merge(Tt.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),Ot=Ot.merge(Kt),Lt=Lt.merge(Kt.append("line").attr("stroke","currentColor").attr(ie+"2",R*L)),kt=kt.merge(Kt.append("text").attr("fill","currentColor").attr(ie,R*Te).attr("dy",p===Rc?"0em":p===ch?"0.71em":"0.32em")),Ae!==nt&&(Tt=Tt.transition(Ae),Ot=Ot.transition(Ae),Lt=Lt.transition(Ae),kt=kt.transition(Ae),It=It.transition(Ae).attr("opacity",If).attr("transform",function(Gt){return isFinite(Gt=je(Gt))?X(Gt+U):this.getAttribute("transform")}),Kt.attr("opacity",If).attr("transform",function(Gt){var Jt=this.parentNode.__axis;return X((Jt&&isFinite(Jt=Jt(Gt))?Jt:je(Gt))+U)})),It.remove(),Tt.attr("d",p===wA||p===Fc?V?"M"+R*V+","+Ze+"H"+U+"V"+We+"H"+R*V:"M"+U+","+Ze+"V"+We:V?"M"+Ze+","+R*V+"V"+U+"H"+We+"V"+R*V:"M"+Ze+","+U+"H"+We),Ot.attr("opacity",1).attr("transform",function(Gt){return X(je(Gt)+U)}),Lt.attr(ie+"2",R*L),kt.attr(ie,R*Te).text(xe),nt.filter(n_).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",p===Fc?"start":p===wA?"end":"middle"),nt.each(function(){this.__axis=je})}return K.scale=function(Ae){return arguments.length?(_=Ae,K):_},K.ticks=function(){return E=Array.from(arguments),K},K.tickArguments=function(Ae){return arguments.length?(E=Ae==null?[]:Array.from(Ae),K):E.slice()},K.tickValues=function(Ae){return arguments.length?(T=Ae==null?null:Array.from(Ae),K):T&&T.slice()},K.tickFormat=function(Ae){return arguments.length?(D=Ae,K):D},K.tickSize=function(Ae){return arguments.length?(L=V=+Ae,K):L},K.tickSizeInner=function(Ae){return arguments.length?(L=+Ae,K):L},K.tickSizeOuter=function(Ae){return arguments.length?(V=+Ae,K):V},K.tickPadding=function(Ae){return arguments.length?(h=+Ae,K):h},K.offset=function(Ae){return arguments.length?(U=+Ae,K):U},K}function s_(p){return Bd(ch,p)}function o_(p){return Bd(wA,p)}var a_={value:()=>{}};function zd(){for(var p=0,_=arguments.length,E={},T;p<_;++p){if(!(T=arguments[p]+"")||T in E||/[\s.]/.test(T))throw new Error("illegal type: "+T);E[T]=[]}return new du(E)}function du(p){this._=p}function l_(p,_){return p.trim().split(/^|\s+/).map(function(E){var T="",D=E.indexOf(".");if(D>=0&&(T=E.slice(D+1),E=E.slice(0,D)),E&&!_.hasOwnProperty(E))throw new Error("unknown type: "+E);return{type:E,name:T}})}du.prototype=zd.prototype={constructor:du,on:function(p,_){var E=this._,T=l_(p+"",E),D,L=-1,V=T.length;if(arguments.length<2){for(;++L<V;)if((D=(p=T[L]).type)&&(D=A_(E[D],p.name)))return D;return}if(_!=null&&typeof _!="function")throw new Error("invalid callback: "+_);for(;++L<V;)if(D=(p=T[L]).type)E[D]=Mf(E[D],p.name,_);else if(_==null)for(D in E)E[D]=Mf(E[D],p.name,null);return this},copy:function(){var p={},_=this._;for(var E in _)p[E]=_[E].slice();return new du(p)},call:function(p,_){if((D=arguments.length-2)>0)for(var E=new Array(D),T=0,D,L;T<D;++T)E[T]=arguments[T+2];if(!this._.hasOwnProperty(p))throw new Error("unknown type: "+p);for(L=this._[p],T=0,D=L.length;T<D;++T)L[T].value.apply(_,E)},apply:function(p,_,E){if(!this._.hasOwnProperty(p))throw new Error("unknown type: "+p);for(var T=this._[p],D=0,L=T.length;D<L;++D)T[D].value.apply(_,E)}};function A_(p,_){for(var E=0,T=p.length,D;E<T;++E)if((D=p[E]).name===_)return D.value}function Mf(p,_,E){for(var T=0,D=p.length;T<D;++T)if(p[T].name===_){p[T]=a_,p=p.slice(0,T).concat(p.slice(T+1));break}return E!=null&&p.push({name:_,value:E}),p}var hh="http://www.w3.org/1999/xhtml";const Cf={svg:"http://www.w3.org/2000/svg",xhtml:hh,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Bu(p){var _=p+="",E=_.indexOf(":");return E>=0&&(_=p.slice(0,E))!=="xmlns"&&(p=p.slice(E+1)),Cf.hasOwnProperty(_)?{space:Cf[_],local:p}:p}function u_(p){return function(){var _=this.ownerDocument,E=this.namespaceURI;return E===hh&&_.documentElement.namespaceURI===hh?_.createElement(p):_.createElementNS(E,p)}}function c_(p){return function(){return this.ownerDocument.createElementNS(p.space,p.local)}}function Ld(p){var _=Bu(p);return(_.local?c_:u_)(_)}function h_(){}function Th(p){return p==null?h_:function(){return this.querySelector(p)}}function f_(p){typeof p!="function"&&(p=Th(p));for(var _=this._groups,E=_.length,T=new Array(E),D=0;D<E;++D)for(var L=_[D],V=L.length,h=T[D]=new Array(V),U,R,ie=0;ie<V;++ie)(U=L[ie])&&(R=p.call(U,U.__data__,ie,L))&&("__data__"in U&&(R.__data__=U.__data__),h[ie]=R);return new Ln(T,this._parents)}function d_(p){return p==null?[]:Array.isArray(p)?p:Array.from(p)}function p_(){return[]}function Rd(p){return p==null?p_:function(){return this.querySelectorAll(p)}}function m_(p){return function(){return d_(p.apply(this,arguments))}}function g_(p){typeof p=="function"?p=m_(p):p=Rd(p);for(var _=this._groups,E=_.length,T=[],D=[],L=0;L<E;++L)for(var V=_[L],h=V.length,U,R=0;R<h;++R)(U=V[R])&&(T.push(p.call(U,U.__data__,R,V)),D.push(U));return new Ln(T,D)}function Fd(p){return function(){return this.matches(p)}}function Od(p){return function(_){return _.matches(p)}}var __=Array.prototype.find;function y_(p){return function(){return __.call(this.children,p)}}function v_(){return this.firstElementChild}function x_(p){return this.select(p==null?v_:y_(typeof p=="function"?p:Od(p)))}var b_=Array.prototype.filter;function w_(){return Array.from(this.children)}function k_(p){return function(){return b_.call(this.children,p)}}function E_(p){return this.selectAll(p==null?w_:k_(typeof p=="function"?p:Od(p)))}function S_(p){typeof p!="function"&&(p=Fd(p));for(var _=this._groups,E=_.length,T=new Array(E),D=0;D<E;++D)for(var L=_[D],V=L.length,h=T[D]=[],U,R=0;R<V;++R)(U=L[R])&&p.call(U,U.__data__,R,L)&&h.push(U);return new Ln(T,this._parents)}function Vd(p){return new Array(p.length)}function T_(){return new Ln(this._enter||this._groups.map(Vd),this._parents)}function bu(p,_){this.ownerDocument=p.ownerDocument,this.namespaceURI=p.namespaceURI,this._next=null,this._parent=p,this.__data__=_}bu.prototype={constructor:bu,appendChild:function(p){return this._parent.insertBefore(p,this._next)},insertBefore:function(p,_){return this._parent.insertBefore(p,_)},querySelector:function(p){return this._parent.querySelector(p)},querySelectorAll:function(p){return this._parent.querySelectorAll(p)}};function I_(p){return function(){return p}}function M_(p,_,E,T,D,L){for(var V=0,h,U=_.length,R=L.length;V<R;++V)(h=_[V])?(h.__data__=L[V],T[V]=h):E[V]=new bu(p,L[V]);for(;V<U;++V)(h=_[V])&&(D[V]=h)}function C_(p,_,E,T,D,L,V){var h,U,R=new Map,ie=_.length,X=L.length,K=new Array(ie),Ae;for(h=0;h<ie;++h)(U=_[h])&&(K[h]=Ae=V.call(U,U.__data__,h,_)+"",R.has(Ae)?D[h]=U:R.set(Ae,U));for(h=0;h<X;++h)Ae=V.call(p,L[h],h,L)+"",(U=R.get(Ae))?(T[h]=U,U.__data__=L[h],R.delete(Ae)):E[h]=new bu(p,L[h]);for(h=0;h<ie;++h)(U=_[h])&&R.get(K[h])===U&&(D[h]=U)}function P_(p){return p.__data__}function D_(p,_){if(!arguments.length)return Array.from(this,P_);var E=_?C_:M_,T=this._parents,D=this._groups;typeof p!="function"&&(p=I_(p));for(var L=D.length,V=new Array(L),h=new Array(L),U=new Array(L),R=0;R<L;++R){var ie=T[R],X=D[R],K=X.length,Ae=B_(p.call(ie,ie&&ie.__data__,R,T)),we=Ae.length,xe=h[R]=new Array(we),Te=V[R]=new Array(we),Le=U[R]=new Array(K);E(ie,X,xe,Te,Le,Ae,_);for(var Ze=0,We=0,je,nt;Ze<we;++Ze)if(je=xe[Ze]){for(Ze>=We&&(We=Ze+1);!(nt=Te[We])&&++We<we;);je._next=nt||null}}return V=new Ln(V,T),V._enter=h,V._exit=U,V}function B_(p){return typeof p=="object"&&"length"in p?p:Array.from(p)}function z_(){return new Ln(this._exit||this._groups.map(Vd),this._parents)}function L_(p,_,E){var T=this.enter(),D=this,L=this.exit();return typeof p=="function"?(T=p(T),T&&(T=T.selection())):T=T.append(p+""),_!=null&&(D=_(D),D&&(D=D.selection())),E==null?L.remove():E(L),T&&D?T.merge(D).order():D}function R_(p){for(var _=p.selection?p.selection():p,E=this._groups,T=_._groups,D=E.length,L=T.length,V=Math.min(D,L),h=new Array(D),U=0;U<V;++U)for(var R=E[U],ie=T[U],X=R.length,K=h[U]=new Array(X),Ae,we=0;we<X;++we)(Ae=R[we]||ie[we])&&(K[we]=Ae);for(;U<D;++U)h[U]=E[U];return new Ln(h,this._parents)}function F_(){for(var p=this._groups,_=-1,E=p.length;++_<E;)for(var T=p[_],D=T.length-1,L=T[D],V;--D>=0;)(V=T[D])&&(L&&V.compareDocumentPosition(L)^4&&L.parentNode.insertBefore(V,L),L=V);return this}function O_(p){p||(p=V_);function _(X,K){return X&&K?p(X.__data__,K.__data__):!X-!K}for(var E=this._groups,T=E.length,D=new Array(T),L=0;L<T;++L){for(var V=E[L],h=V.length,U=D[L]=new Array(h),R,ie=0;ie<h;++ie)(R=V[ie])&&(U[ie]=R);U.sort(_)}return new Ln(D,this._parents).order()}function V_(p,_){return p<_?-1:p>_?1:p>=_?0:NaN}function N_(){var p=arguments[0];return arguments[0]=this,p.apply(null,arguments),this}function U_(){return Array.from(this)}function G_(){for(var p=this._groups,_=0,E=p.length;_<E;++_)for(var T=p[_],D=0,L=T.length;D<L;++D){var V=T[D];if(V)return V}return null}function j_(){let p=0;for(const _ of this)++p;return p}function q_(){return!this.node()}function Z_(p){for(var _=this._groups,E=0,T=_.length;E<T;++E)for(var D=_[E],L=0,V=D.length,h;L<V;++L)(h=D[L])&&p.call(h,h.__data__,L,D);return this}function Q_(p){return function(){this.removeAttribute(p)}}function $_(p){return function(){this.removeAttributeNS(p.space,p.local)}}function H_(p,_){return function(){this.setAttribute(p,_)}}function W_(p,_){return function(){this.setAttributeNS(p.space,p.local,_)}}function X_(p,_){return function(){var E=_.apply(this,arguments);E==null?this.removeAttribute(p):this.setAttribute(p,E)}}function Y_(p,_){return function(){var E=_.apply(this,arguments);E==null?this.removeAttributeNS(p.space,p.local):this.setAttributeNS(p.space,p.local,E)}}function K_(p,_){var E=Bu(p);if(arguments.length<2){var T=this.node();return E.local?T.getAttributeNS(E.space,E.local):T.getAttribute(E)}return this.each((_==null?E.local?$_:Q_:typeof _=="function"?E.local?Y_:X_:E.local?W_:H_)(E,_))}function Nd(p){return p.ownerDocument&&p.ownerDocument.defaultView||p.document&&p||p.defaultView}function J_(p){return function(){this.style.removeProperty(p)}}function ey(p,_,E){return function(){this.style.setProperty(p,_,E)}}function ty(p,_,E){return function(){var T=_.apply(this,arguments);T==null?this.style.removeProperty(p):this.style.setProperty(p,T,E)}}function iy(p,_,E){return arguments.length>1?this.each((_==null?J_:typeof _=="function"?ty:ey)(p,_,E??"")):ql(this.node(),p)}function ql(p,_){return p.style.getPropertyValue(_)||Nd(p).getComputedStyle(p,null).getPropertyValue(_)}function ry(p){return function(){delete this[p]}}function ny(p,_){return function(){this[p]=_}}function sy(p,_){return function(){var E=_.apply(this,arguments);E==null?delete this[p]:this[p]=E}}function oy(p,_){return arguments.length>1?this.each((_==null?ry:typeof _=="function"?sy:ny)(p,_)):this.node()[p]}function Ud(p){return p.trim().split(/^|\s+/)}function Ih(p){return p.classList||new Gd(p)}function Gd(p){this._node=p,this._names=Ud(p.getAttribute("class")||"")}Gd.prototype={add:function(p){var _=this._names.indexOf(p);_<0&&(this._names.push(p),this._node.setAttribute("class",this._names.join(" ")))},remove:function(p){var _=this._names.indexOf(p);_>=0&&(this._names.splice(_,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(p){return this._names.indexOf(p)>=0}};function jd(p,_){for(var E=Ih(p),T=-1,D=_.length;++T<D;)E.add(_[T])}function qd(p,_){for(var E=Ih(p),T=-1,D=_.length;++T<D;)E.remove(_[T])}function ay(p){return function(){jd(this,p)}}function ly(p){return function(){qd(this,p)}}function Ay(p,_){return function(){(_.apply(this,arguments)?jd:qd)(this,p)}}function uy(p,_){var E=Ud(p+"");if(arguments.length<2){for(var T=Ih(this.node()),D=-1,L=E.length;++D<L;)if(!T.contains(E[D]))return!1;return!0}return this.each((typeof _=="function"?Ay:_?ay:ly)(E,_))}function cy(){this.textContent=""}function hy(p){return function(){this.textContent=p}}function fy(p){return function(){var _=p.apply(this,arguments);this.textContent=_??""}}function dy(p){return arguments.length?this.each(p==null?cy:(typeof p=="function"?fy:hy)(p)):this.node().textContent}function py(){this.innerHTML=""}function my(p){return function(){this.innerHTML=p}}function gy(p){return function(){var _=p.apply(this,arguments);this.innerHTML=_??""}}function _y(p){return arguments.length?this.each(p==null?py:(typeof p=="function"?gy:my)(p)):this.node().innerHTML}function yy(){this.nextSibling&&this.parentNode.appendChild(this)}function vy(){return this.each(yy)}function xy(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function by(){return this.each(xy)}function wy(p){var _=typeof p=="function"?p:Ld(p);return this.select(function(){return this.appendChild(_.apply(this,arguments))})}function ky(){return null}function Ey(p,_){var E=typeof p=="function"?p:Ld(p),T=_==null?ky:typeof _=="function"?_:Th(_);return this.select(function(){return this.insertBefore(E.apply(this,arguments),T.apply(this,arguments)||null)})}function Sy(){var p=this.parentNode;p&&p.removeChild(this)}function Ty(){return this.each(Sy)}function Iy(){var p=this.cloneNode(!1),_=this.parentNode;return _?_.insertBefore(p,this.nextSibling):p}function My(){var p=this.cloneNode(!0),_=this.parentNode;return _?_.insertBefore(p,this.nextSibling):p}function Cy(p){return this.select(p?My:Iy)}function Py(p){return arguments.length?this.property("__data__",p):this.node().__data__}function Dy(p){return function(_){p.call(this,_,this.__data__)}}function By(p){return p.trim().split(/^|\s+/).map(function(_){var E="",T=_.indexOf(".");return T>=0&&(E=_.slice(T+1),_=_.slice(0,T)),{type:_,name:E}})}function zy(p){return function(){var _=this.__on;if(_){for(var E=0,T=-1,D=_.length,L;E<D;++E)L=_[E],(!p.type||L.type===p.type)&&L.name===p.name?this.removeEventListener(L.type,L.listener,L.options):_[++T]=L;++T?_.length=T:delete this.__on}}}function Ly(p,_,E){return function(){var T=this.__on,D,L=Dy(_);if(T){for(var V=0,h=T.length;V<h;++V)if((D=T[V]).type===p.type&&D.name===p.name){this.removeEventListener(D.type,D.listener,D.options),this.addEventListener(D.type,D.listener=L,D.options=E),D.value=_;return}}this.addEventListener(p.type,L,E),D={type:p.type,name:p.name,value:_,listener:L,options:E},T?T.push(D):this.__on=[D]}}function Ry(p,_,E){var T=By(p+""),D,L=T.length,V;if(arguments.length<2){var h=this.node().__on;if(h){for(var U=0,R=h.length,ie;U<R;++U)for(D=0,ie=h[U];D<L;++D)if((V=T[D]).type===ie.type&&V.name===ie.name)return ie.value}return}for(h=_?Ly:zy,D=0;D<L;++D)this.each(h(T[D],_,E));return this}function Zd(p,_,E){var T=Nd(p),D=T.CustomEvent;typeof D=="function"?D=new D(_,E):(D=T.document.createEvent("Event"),E?(D.initEvent(_,E.bubbles,E.cancelable),D.detail=E.detail):D.initEvent(_,!1,!1)),p.dispatchEvent(D)}function Fy(p,_){return function(){return Zd(this,p,_)}}function Oy(p,_){return function(){return Zd(this,p,_.apply(this,arguments))}}function Vy(p,_){return this.each((typeof _=="function"?Oy:Fy)(p,_))}function*Ny(){for(var p=this._groups,_=0,E=p.length;_<E;++_)for(var T=p[_],D=0,L=T.length,V;D<L;++D)(V=T[D])&&(yield V)}var Qd=[null];function Ln(p,_){this._groups=p,this._parents=_}function DA(){return new Ln([[document.documentElement]],Qd)}function Uy(){return this}Ln.prototype=DA.prototype={constructor:Ln,select:f_,selectAll:g_,selectChild:x_,selectChildren:E_,filter:S_,data:D_,enter:T_,exit:z_,join:L_,merge:R_,selection:Uy,order:F_,sort:O_,call:N_,nodes:U_,node:G_,size:j_,empty:q_,each:Z_,attr:K_,style:iy,property:oy,classed:uy,text:dy,html:_y,raise:vy,lower:by,append:wy,insert:Ey,remove:Ty,clone:Cy,datum:Py,on:Ry,dispatch:Vy,[Symbol.iterator]:Ny};function su(p){return typeof p=="string"?new Ln([[document.querySelector(p)]],[document.documentElement]):new Ln([[p]],Qd)}function Mh(p,_,E){p.prototype=_.prototype=E,E.constructor=p}function $d(p,_){var E=Object.create(p.prototype);for(var T in _)E[T]=_[T];return E}function BA(){}var IA=.7,wu=1/IA,Gl="\\s*([+-]?\\d+)\\s*",MA="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Ys="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Gy=/^#([0-9a-f]{3,8})$/,jy=new RegExp(`^rgb\\(${Gl},${Gl},${Gl}\\)$`),qy=new RegExp(`^rgb\\(${Ys},${Ys},${Ys}\\)$`),Zy=new RegExp(`^rgba\\(${Gl},${Gl},${Gl},${MA}\\)$`),Qy=new RegExp(`^rgba\\(${Ys},${Ys},${Ys},${MA}\\)$`),$y=new RegExp(`^hsl\\(${MA},${Ys},${Ys}\\)$`),Hy=new RegExp(`^hsla\\(${MA},${Ys},${Ys},${MA}\\)$`),Pf={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Mh(BA,el,{copy(p){return Object.assign(new this.constructor,this,p)},displayable(){return this.rgb().displayable()},hex:Df,formatHex:Df,formatHex8:Wy,formatHsl:Xy,formatRgb:Bf,toString:Bf});function Df(){return this.rgb().formatHex()}function Wy(){return this.rgb().formatHex8()}function Xy(){return Hd(this).formatHsl()}function Bf(){return this.rgb().formatRgb()}function el(p){var _,E;return p=(p+"").trim().toLowerCase(),(_=Gy.exec(p))?(E=_[1].length,_=parseInt(_[1],16),E===6?zf(_):E===3?new _n(_>>8&15|_>>4&240,_>>4&15|_&240,(_&15)<<4|_&15,1):E===8?ou(_>>24&255,_>>16&255,_>>8&255,(_&255)/255):E===4?ou(_>>12&15|_>>8&240,_>>8&15|_>>4&240,_>>4&15|_&240,((_&15)<<4|_&15)/255):null):(_=jy.exec(p))?new _n(_[1],_[2],_[3],1):(_=qy.exec(p))?new _n(_[1]*255/100,_[2]*255/100,_[3]*255/100,1):(_=Zy.exec(p))?ou(_[1],_[2],_[3],_[4]):(_=Qy.exec(p))?ou(_[1]*255/100,_[2]*255/100,_[3]*255/100,_[4]):(_=$y.exec(p))?Ff(_[1],_[2]/100,_[3]/100,1):(_=Hy.exec(p))?Ff(_[1],_[2]/100,_[3]/100,_[4]):Pf.hasOwnProperty(p)?zf(Pf[p]):p==="transparent"?new _n(NaN,NaN,NaN,0):null}function zf(p){return new _n(p>>16&255,p>>8&255,p&255,1)}function ou(p,_,E,T){return T<=0&&(p=_=E=NaN),new _n(p,_,E,T)}function Yy(p){return p instanceof BA||(p=el(p)),p?(p=p.rgb(),new _n(p.r,p.g,p.b,p.opacity)):new _n}function fh(p,_,E,T){return arguments.length===1?Yy(p):new _n(p,_,E,T??1)}function _n(p,_,E,T){this.r=+p,this.g=+_,this.b=+E,this.opacity=+T}Mh(_n,fh,$d(BA,{brighter(p){return p=p==null?wu:Math.pow(wu,p),new _n(this.r*p,this.g*p,this.b*p,this.opacity)},darker(p){return p=p==null?IA:Math.pow(IA,p),new _n(this.r*p,this.g*p,this.b*p,this.opacity)},rgb(){return this},clamp(){return new _n(Ja(this.r),Ja(this.g),Ja(this.b),ku(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Lf,formatHex:Lf,formatHex8:Ky,formatRgb:Rf,toString:Rf}));function Lf(){return`#${Ka(this.r)}${Ka(this.g)}${Ka(this.b)}`}function Ky(){return`#${Ka(this.r)}${Ka(this.g)}${Ka(this.b)}${Ka((isNaN(this.opacity)?1:this.opacity)*255)}`}function Rf(){const p=ku(this.opacity);return`${p===1?"rgb(":"rgba("}${Ja(this.r)}, ${Ja(this.g)}, ${Ja(this.b)}${p===1?")":`, ${p})`}`}function ku(p){return isNaN(p)?1:Math.max(0,Math.min(1,p))}function Ja(p){return Math.max(0,Math.min(255,Math.round(p)||0))}function Ka(p){return p=Ja(p),(p<16?"0":"")+p.toString(16)}function Ff(p,_,E,T){return T<=0?p=_=E=NaN:E<=0||E>=1?p=_=NaN:_<=0&&(p=NaN),new vs(p,_,E,T)}function Hd(p){if(p instanceof vs)return new vs(p.h,p.s,p.l,p.opacity);if(p instanceof BA||(p=el(p)),!p)return new vs;if(p instanceof vs)return p;p=p.rgb();var _=p.r/255,E=p.g/255,T=p.b/255,D=Math.min(_,E,T),L=Math.max(_,E,T),V=NaN,h=L-D,U=(L+D)/2;return h?(_===L?V=(E-T)/h+(E<T)*6:E===L?V=(T-_)/h+2:V=(_-E)/h+4,h/=U<.5?L+D:2-L-D,V*=60):h=U>0&&U<1?0:V,new vs(V,h,U,p.opacity)}function Jy(p,_,E,T){return arguments.length===1?Hd(p):new vs(p,_,E,T??1)}function vs(p,_,E,T){this.h=+p,this.s=+_,this.l=+E,this.opacity=+T}Mh(vs,Jy,$d(BA,{brighter(p){return p=p==null?wu:Math.pow(wu,p),new vs(this.h,this.s,this.l*p,this.opacity)},darker(p){return p=p==null?IA:Math.pow(IA,p),new vs(this.h,this.s,this.l*p,this.opacity)},rgb(){var p=this.h%360+(this.h<0)*360,_=isNaN(p)||isNaN(this.s)?0:this.s,E=this.l,T=E+(E<.5?E:1-E)*_,D=2*E-T;return new _n(Oc(p>=240?p-240:p+120,D,T),Oc(p,D,T),Oc(p<120?p+240:p-120,D,T),this.opacity)},clamp(){return new vs(Of(this.h),au(this.s),au(this.l),ku(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const p=ku(this.opacity);return`${p===1?"hsl(":"hsla("}${Of(this.h)}, ${au(this.s)*100}%, ${au(this.l)*100}%${p===1?")":`, ${p})`}`}}));function Of(p){return p=(p||0)%360,p<0?p+360:p}function au(p){return Math.max(0,Math.min(1,p||0))}function Oc(p,_,E){return(p<60?_+(E-_)*p/60:p<180?E:p<240?_+(E-_)*(240-p)/60:_)*255}const Ch=p=>()=>p;function e1(p,_){return function(E){return p+E*_}}function t1(p,_,E){return p=Math.pow(p,E),_=Math.pow(_,E)-p,E=1/E,function(T){return Math.pow(p+T*_,E)}}function i1(p){return(p=+p)==1?Wd:function(_,E){return E-_?t1(_,E,p):Ch(isNaN(_)?E:_)}}function Wd(p,_){var E=_-p;return E?e1(p,E):Ch(isNaN(p)?_:p)}const Eu=function p(_){var E=i1(_);function T(D,L){var V=E((D=fh(D)).r,(L=fh(L)).r),h=E(D.g,L.g),U=E(D.b,L.b),R=Wd(D.opacity,L.opacity);return function(ie){return D.r=V(ie),D.g=h(ie),D.b=U(ie),D.opacity=R(ie),D+""}}return T.gamma=p,T}(1);function r1(p,_){_||(_=[]);var E=p?Math.min(_.length,p.length):0,T=_.slice(),D;return function(L){for(D=0;D<E;++D)T[D]=p[D]*(1-L)+_[D]*L;return T}}function n1(p){return ArrayBuffer.isView(p)&&!(p instanceof DataView)}function s1(p,_){var E=_?_.length:0,T=p?Math.min(E,p.length):0,D=new Array(T),L=new Array(E),V;for(V=0;V<T;++V)D[V]=Ph(p[V],_[V]);for(;V<E;++V)L[V]=_[V];return function(h){for(V=0;V<T;++V)L[V]=D[V](h);return L}}function o1(p,_){var E=new Date;return p=+p,_=+_,function(T){return E.setTime(p*(1-T)+_*T),E}}function ys(p,_){return p=+p,_=+_,function(E){return p*(1-E)+_*E}}function a1(p,_){var E={},T={},D;(p===null||typeof p!="object")&&(p={}),(_===null||typeof _!="object")&&(_={});for(D in _)D in p?E[D]=Ph(p[D],_[D]):T[D]=_[D];return function(L){for(D in E)T[D]=E[D](L);return T}}var dh=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Vc=new RegExp(dh.source,"g");function l1(p){return function(){return p}}function A1(p){return function(_){return p(_)+""}}function Xd(p,_){var E=dh.lastIndex=Vc.lastIndex=0,T,D,L,V=-1,h=[],U=[];for(p=p+"",_=_+"";(T=dh.exec(p))&&(D=Vc.exec(_));)(L=D.index)>E&&(L=_.slice(E,L),h[V]?h[V]+=L:h[++V]=L),(T=T[0])===(D=D[0])?h[V]?h[V]+=D:h[++V]=D:(h[++V]=null,U.push({i:V,x:ys(T,D)})),E=Vc.lastIndex;return E<_.length&&(L=_.slice(E),h[V]?h[V]+=L:h[++V]=L),h.length<2?U[0]?A1(U[0].x):l1(_):(_=U.length,function(R){for(var ie=0,X;ie<_;++ie)h[(X=U[ie]).i]=X.x(R);return h.join("")})}function Ph(p,_){var E=typeof _,T;return _==null||E==="boolean"?Ch(_):(E==="number"?ys:E==="string"?(T=el(_))?(_=T,Eu):Xd:_ instanceof el?Eu:_ instanceof Date?o1:n1(_)?r1:Array.isArray(_)?s1:typeof _.valueOf!="function"&&typeof _.toString!="function"||isNaN(_)?a1:ys)(p,_)}function u1(p,_){return p=+p,_=+_,function(E){return Math.round(p*(1-E)+_*E)}}var Vf=180/Math.PI,ph={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Yd(p,_,E,T,D,L){var V,h,U;return(V=Math.sqrt(p*p+_*_))&&(p/=V,_/=V),(U=p*E+_*T)&&(E-=p*U,T-=_*U),(h=Math.sqrt(E*E+T*T))&&(E/=h,T/=h,U/=h),p*T<_*E&&(p=-p,_=-_,U=-U,V=-V),{translateX:D,translateY:L,rotate:Math.atan2(_,p)*Vf,skewX:Math.atan(U)*Vf,scaleX:V,scaleY:h}}var lu;function c1(p){const _=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(p+"");return _.isIdentity?ph:Yd(_.a,_.b,_.c,_.d,_.e,_.f)}function h1(p){return p==null||(lu||(lu=document.createElementNS("http://www.w3.org/2000/svg","g")),lu.setAttribute("transform",p),!(p=lu.transform.baseVal.consolidate()))?ph:(p=p.matrix,Yd(p.a,p.b,p.c,p.d,p.e,p.f))}function Kd(p,_,E,T){function D(R){return R.length?R.pop()+" ":""}function L(R,ie,X,K,Ae,we){if(R!==X||ie!==K){var xe=Ae.push("translate(",null,_,null,E);we.push({i:xe-4,x:ys(R,X)},{i:xe-2,x:ys(ie,K)})}else(X||K)&&Ae.push("translate("+X+_+K+E)}function V(R,ie,X,K){R!==ie?(R-ie>180?ie+=360:ie-R>180&&(R+=360),K.push({i:X.push(D(X)+"rotate(",null,T)-2,x:ys(R,ie)})):ie&&X.push(D(X)+"rotate("+ie+T)}function h(R,ie,X,K){R!==ie?K.push({i:X.push(D(X)+"skewX(",null,T)-2,x:ys(R,ie)}):ie&&X.push(D(X)+"skewX("+ie+T)}function U(R,ie,X,K,Ae,we){if(R!==X||ie!==K){var xe=Ae.push(D(Ae)+"scale(",null,",",null,")");we.push({i:xe-4,x:ys(R,X)},{i:xe-2,x:ys(ie,K)})}else(X!==1||K!==1)&&Ae.push(D(Ae)+"scale("+X+","+K+")")}return function(R,ie){var X=[],K=[];return R=p(R),ie=p(ie),L(R.translateX,R.translateY,ie.translateX,ie.translateY,X,K),V(R.rotate,ie.rotate,X,K),h(R.skewX,ie.skewX,X,K),U(R.scaleX,R.scaleY,ie.scaleX,ie.scaleY,X,K),R=ie=null,function(Ae){for(var we=-1,xe=K.length,Te;++we<xe;)X[(Te=K[we]).i]=Te.x(Ae);return X.join("")}}}var f1=Kd(c1,"px, ","px)","deg)"),d1=Kd(h1,", ",")",")"),Zl=0,kA=0,vA=0,Jd=1e3,Su,EA,Tu=0,tl=0,zu=0,CA=typeof performance=="object"&&performance.now?performance:Date,ep=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(p){setTimeout(p,17)};function Dh(){return tl||(ep(p1),tl=CA.now()+zu)}function p1(){tl=0}function Iu(){this._call=this._time=this._next=null}Iu.prototype=tp.prototype={constructor:Iu,restart:function(p,_,E){if(typeof p!="function")throw new TypeError("callback is not a function");E=(E==null?Dh():+E)+(_==null?0:+_),!this._next&&EA!==this&&(EA?EA._next=this:Su=this,EA=this),this._call=p,this._time=E,mh()},stop:function(){this._call&&(this._call=null,this._time=1/0,mh())}};function tp(p,_,E){var T=new Iu;return T.restart(p,_,E),T}function m1(){Dh(),++Zl;for(var p=Su,_;p;)(_=tl-p._time)>=0&&p._call.call(void 0,_),p=p._next;--Zl}function Nf(){tl=(Tu=CA.now())+zu,Zl=kA=0;try{m1()}finally{Zl=0,_1(),tl=0}}function g1(){var p=CA.now(),_=p-Tu;_>Jd&&(zu-=_,Tu=p)}function _1(){for(var p,_=Su,E,T=1/0;_;)_._call?(T>_._time&&(T=_._time),p=_,_=_._next):(E=_._next,_._next=null,_=p?p._next=E:Su=E);EA=p,mh(T)}function mh(p){if(!Zl){kA&&(kA=clearTimeout(kA));var _=p-tl;_>24?(p<1/0&&(kA=setTimeout(Nf,p-CA.now()-zu)),vA&&(vA=clearInterval(vA))):(vA||(Tu=CA.now(),vA=setInterval(g1,Jd)),Zl=1,ep(Nf))}}function Uf(p,_,E){var T=new Iu;return _=_==null?0:+_,T.restart(D=>{T.stop(),p(D+_)},_,E),T}var y1=zd("start","end","cancel","interrupt"),v1=[],ip=0,Gf=1,gh=2,pu=3,jf=4,_h=5,mu=6;function Lu(p,_,E,T,D,L){var V=p.__transition;if(!V)p.__transition={};else if(E in V)return;x1(p,E,{name:_,index:T,group:D,on:y1,tween:v1,time:L.time,delay:L.delay,duration:L.duration,ease:L.ease,timer:null,state:ip})}function Bh(p,_){var E=Es(p,_);if(E.state>ip)throw new Error("too late; already scheduled");return E}function to(p,_){var E=Es(p,_);if(E.state>pu)throw new Error("too late; already running");return E}function Es(p,_){var E=p.__transition;if(!E||!(E=E[_]))throw new Error("transition not found");return E}function x1(p,_,E){var T=p.__transition,D;T[_]=E,E.timer=tp(L,0,E.time);function L(R){E.state=Gf,E.timer.restart(V,E.delay,E.time),E.delay<=R&&V(R-E.delay)}function V(R){var ie,X,K,Ae;if(E.state!==Gf)return U();for(ie in T)if(Ae=T[ie],Ae.name===E.name){if(Ae.state===pu)return Uf(V);Ae.state===jf?(Ae.state=mu,Ae.timer.stop(),Ae.on.call("interrupt",p,p.__data__,Ae.index,Ae.group),delete T[ie]):+ie<_&&(Ae.state=mu,Ae.timer.stop(),Ae.on.call("cancel",p,p.__data__,Ae.index,Ae.group),delete T[ie])}if(Uf(function(){E.state===pu&&(E.state=jf,E.timer.restart(h,E.delay,E.time),h(R))}),E.state=gh,E.on.call("start",p,p.__data__,E.index,E.group),E.state===gh){for(E.state=pu,D=new Array(K=E.tween.length),ie=0,X=-1;ie<K;++ie)(Ae=E.tween[ie].value.call(p,p.__data__,E.index,E.group))&&(D[++X]=Ae);D.length=X+1}}function h(R){for(var ie=R<E.duration?E.ease.call(null,R/E.duration):(E.timer.restart(U),E.state=_h,1),X=-1,K=D.length;++X<K;)D[X].call(p,ie);E.state===_h&&(E.on.call("end",p,p.__data__,E.index,E.group),U())}function U(){E.state=mu,E.timer.stop(),delete T[_];for(var R in T)return;delete p.__transition}}function b1(p,_){var E=p.__transition,T,D,L=!0,V;if(E){_=_==null?null:_+"";for(V in E){if((T=E[V]).name!==_){L=!1;continue}D=T.state>gh&&T.state<_h,T.state=mu,T.timer.stop(),T.on.call(D?"interrupt":"cancel",p,p.__data__,T.index,T.group),delete E[V]}L&&delete p.__transition}}function w1(p){return this.each(function(){b1(this,p)})}function k1(p,_){var E,T;return function(){var D=to(this,p),L=D.tween;if(L!==E){T=E=L;for(var V=0,h=T.length;V<h;++V)if(T[V].name===_){T=T.slice(),T.splice(V,1);break}}D.tween=T}}function E1(p,_,E){var T,D;if(typeof E!="function")throw new Error;return function(){var L=to(this,p),V=L.tween;if(V!==T){D=(T=V).slice();for(var h={name:_,value:E},U=0,R=D.length;U<R;++U)if(D[U].name===_){D[U]=h;break}U===R&&D.push(h)}L.tween=D}}function S1(p,_){var E=this._id;if(p+="",arguments.length<2){for(var T=Es(this.node(),E).tween,D=0,L=T.length,V;D<L;++D)if((V=T[D]).name===p)return V.value;return null}return this.each((_==null?k1:E1)(E,p,_))}function zh(p,_,E){var T=p._id;return p.each(function(){var D=to(this,T);(D.value||(D.value={}))[_]=E.apply(this,arguments)}),function(D){return Es(D,T).value[_]}}function rp(p,_){var E;return(typeof _=="number"?ys:_ instanceof el?Eu:(E=el(_))?(_=E,Eu):Xd)(p,_)}function T1(p){return function(){this.removeAttribute(p)}}function I1(p){return function(){this.removeAttributeNS(p.space,p.local)}}function M1(p,_,E){var T,D=E+"",L;return function(){var V=this.getAttribute(p);return V===D?null:V===T?L:L=_(T=V,E)}}function C1(p,_,E){var T,D=E+"",L;return function(){var V=this.getAttributeNS(p.space,p.local);return V===D?null:V===T?L:L=_(T=V,E)}}function P1(p,_,E){var T,D,L;return function(){var V,h=E(this),U;return h==null?void this.removeAttribute(p):(V=this.getAttribute(p),U=h+"",V===U?null:V===T&&U===D?L:(D=U,L=_(T=V,h)))}}function D1(p,_,E){var T,D,L;return function(){var V,h=E(this),U;return h==null?void this.removeAttributeNS(p.space,p.local):(V=this.getAttributeNS(p.space,p.local),U=h+"",V===U?null:V===T&&U===D?L:(D=U,L=_(T=V,h)))}}function B1(p,_){var E=Bu(p),T=E==="transform"?d1:rp;return this.attrTween(p,typeof _=="function"?(E.local?D1:P1)(E,T,zh(this,"attr."+p,_)):_==null?(E.local?I1:T1)(E):(E.local?C1:M1)(E,T,_))}function z1(p,_){return function(E){this.setAttribute(p,_.call(this,E))}}function L1(p,_){return function(E){this.setAttributeNS(p.space,p.local,_.call(this,E))}}function R1(p,_){var E,T;function D(){var L=_.apply(this,arguments);return L!==T&&(E=(T=L)&&L1(p,L)),E}return D._value=_,D}function F1(p,_){var E,T;function D(){var L=_.apply(this,arguments);return L!==T&&(E=(T=L)&&z1(p,L)),E}return D._value=_,D}function O1(p,_){var E="attr."+p;if(arguments.length<2)return(E=this.tween(E))&&E._value;if(_==null)return this.tween(E,null);if(typeof _!="function")throw new Error;var T=Bu(p);return this.tween(E,(T.local?R1:F1)(T,_))}function V1(p,_){return function(){Bh(this,p).delay=+_.apply(this,arguments)}}function N1(p,_){return _=+_,function(){Bh(this,p).delay=_}}function U1(p){var _=this._id;return arguments.length?this.each((typeof p=="function"?V1:N1)(_,p)):Es(this.node(),_).delay}function G1(p,_){return function(){to(this,p).duration=+_.apply(this,arguments)}}function j1(p,_){return _=+_,function(){to(this,p).duration=_}}function q1(p){var _=this._id;return arguments.length?this.each((typeof p=="function"?G1:j1)(_,p)):Es(this.node(),_).duration}function Z1(p,_){if(typeof _!="function")throw new Error;return function(){to(this,p).ease=_}}function Q1(p){var _=this._id;return arguments.length?this.each(Z1(_,p)):Es(this.node(),_).ease}function $1(p,_){return function(){var E=_.apply(this,arguments);if(typeof E!="function")throw new Error;to(this,p).ease=E}}function H1(p){if(typeof p!="function")throw new Error;return this.each($1(this._id,p))}function W1(p){typeof p!="function"&&(p=Fd(p));for(var _=this._groups,E=_.length,T=new Array(E),D=0;D<E;++D)for(var L=_[D],V=L.length,h=T[D]=[],U,R=0;R<V;++R)(U=L[R])&&p.call(U,U.__data__,R,L)&&h.push(U);return new Uo(T,this._parents,this._name,this._id)}function X1(p){if(p._id!==this._id)throw new Error;for(var _=this._groups,E=p._groups,T=_.length,D=E.length,L=Math.min(T,D),V=new Array(T),h=0;h<L;++h)for(var U=_[h],R=E[h],ie=U.length,X=V[h]=new Array(ie),K,Ae=0;Ae<ie;++Ae)(K=U[Ae]||R[Ae])&&(X[Ae]=K);for(;h<T;++h)V[h]=_[h];return new Uo(V,this._parents,this._name,this._id)}function Y1(p){return(p+"").trim().split(/^|\s+/).every(function(_){var E=_.indexOf(".");return E>=0&&(_=_.slice(0,E)),!_||_==="start"})}function K1(p,_,E){var T,D,L=Y1(_)?Bh:to;return function(){var V=L(this,p),h=V.on;h!==T&&(D=(T=h).copy()).on(_,E),V.on=D}}function J1(p,_){var E=this._id;return arguments.length<2?Es(this.node(),E).on.on(p):this.each(K1(E,p,_))}function e2(p){return function(){var _=this.parentNode;for(var E in this.__transition)if(+E!==p)return;_&&_.removeChild(this)}}function t2(){return this.on("end.remove",e2(this._id))}function i2(p){var _=this._name,E=this._id;typeof p!="function"&&(p=Th(p));for(var T=this._groups,D=T.length,L=new Array(D),V=0;V<D;++V)for(var h=T[V],U=h.length,R=L[V]=new Array(U),ie,X,K=0;K<U;++K)(ie=h[K])&&(X=p.call(ie,ie.__data__,K,h))&&("__data__"in ie&&(X.__data__=ie.__data__),R[K]=X,Lu(R[K],_,E,K,R,Es(ie,E)));return new Uo(L,this._parents,_,E)}function r2(p){var _=this._name,E=this._id;typeof p!="function"&&(p=Rd(p));for(var T=this._groups,D=T.length,L=[],V=[],h=0;h<D;++h)for(var U=T[h],R=U.length,ie,X=0;X<R;++X)if(ie=U[X]){for(var K=p.call(ie,ie.__data__,X,U),Ae,we=Es(ie,E),xe=0,Te=K.length;xe<Te;++xe)(Ae=K[xe])&&Lu(Ae,_,E,xe,K,we);L.push(K),V.push(ie)}return new Uo(L,V,_,E)}var n2=DA.prototype.constructor;function s2(){return new n2(this._groups,this._parents)}function o2(p,_){var E,T,D;return function(){var L=ql(this,p),V=(this.style.removeProperty(p),ql(this,p));return L===V?null:L===E&&V===T?D:D=_(E=L,T=V)}}function np(p){return function(){this.style.removeProperty(p)}}function a2(p,_,E){var T,D=E+"",L;return function(){var V=ql(this,p);return V===D?null:V===T?L:L=_(T=V,E)}}function l2(p,_,E){var T,D,L;return function(){var V=ql(this,p),h=E(this),U=h+"";return h==null&&(U=h=(this.style.removeProperty(p),ql(this,p))),V===U?null:V===T&&U===D?L:(D=U,L=_(T=V,h))}}function A2(p,_){var E,T,D,L="style."+_,V="end."+L,h;return function(){var U=to(this,p),R=U.on,ie=U.value[L]==null?h||(h=np(_)):void 0;(R!==E||D!==ie)&&(T=(E=R).copy()).on(V,D=ie),U.on=T}}function u2(p,_,E){var T=(p+="")=="transform"?f1:rp;return _==null?this.styleTween(p,o2(p,T)).on("end.style."+p,np(p)):typeof _=="function"?this.styleTween(p,l2(p,T,zh(this,"style."+p,_))).each(A2(this._id,p)):this.styleTween(p,a2(p,T,_),E).on("end.style."+p,null)}function c2(p,_,E){return function(T){this.style.setProperty(p,_.call(this,T),E)}}function h2(p,_,E){var T,D;function L(){var V=_.apply(this,arguments);return V!==D&&(T=(D=V)&&c2(p,V,E)),T}return L._value=_,L}function f2(p,_,E){var T="style."+(p+="");if(arguments.length<2)return(T=this.tween(T))&&T._value;if(_==null)return this.tween(T,null);if(typeof _!="function")throw new Error;return this.tween(T,h2(p,_,E??""))}function d2(p){return function(){this.textContent=p}}function p2(p){return function(){var _=p(this);this.textContent=_??""}}function m2(p){return this.tween("text",typeof p=="function"?p2(zh(this,"text",p)):d2(p==null?"":p+""))}function g2(p){return function(_){this.textContent=p.call(this,_)}}function _2(p){var _,E;function T(){var D=p.apply(this,arguments);return D!==E&&(_=(E=D)&&g2(D)),_}return T._value=p,T}function y2(p){var _="text";if(arguments.length<1)return(_=this.tween(_))&&_._value;if(p==null)return this.tween(_,null);if(typeof p!="function")throw new Error;return this.tween(_,_2(p))}function v2(){for(var p=this._name,_=this._id,E=sp(),T=this._groups,D=T.length,L=0;L<D;++L)for(var V=T[L],h=V.length,U,R=0;R<h;++R)if(U=V[R]){var ie=Es(U,_);Lu(U,p,E,R,V,{time:ie.time+ie.delay+ie.duration,delay:0,duration:ie.duration,ease:ie.ease})}return new Uo(T,this._parents,p,E)}function x2(){var p,_,E=this,T=E._id,D=E.size();return new Promise(function(L,V){var h={value:V},U={value:function(){--D===0&&L()}};E.each(function(){var R=to(this,T),ie=R.on;ie!==p&&(_=(p=ie).copy(),_._.cancel.push(h),_._.interrupt.push(h),_._.end.push(U)),R.on=_}),D===0&&L()})}var b2=0;function Uo(p,_,E,T){this._groups=p,this._parents=_,this._name=E,this._id=T}function sp(){return++b2}var Lo=DA.prototype;Uo.prototype={constructor:Uo,select:i2,selectAll:r2,selectChild:Lo.selectChild,selectChildren:Lo.selectChildren,filter:W1,merge:X1,selection:s2,transition:v2,call:Lo.call,nodes:Lo.nodes,node:Lo.node,size:Lo.size,empty:Lo.empty,each:Lo.each,on:J1,attr:B1,attrTween:O1,style:u2,styleTween:f2,text:m2,textTween:y2,remove:t2,tween:S1,delay:U1,duration:q1,ease:Q1,easeVarying:H1,end:x2,[Symbol.iterator]:Lo[Symbol.iterator]};function w2(p){return((p*=2)<=1?p*p*p:(p-=2)*p*p+2)/2}var k2={time:null,delay:0,duration:250,ease:w2};function E2(p,_){for(var E;!(E=p.__transition)||!(E=E[_]);)if(!(p=p.parentNode))throw new Error(`transition ${_} not found`);return E}function S2(p){var _,E;p instanceof Uo?(_=p._id,p=p._name):(_=sp(),(E=k2).time=Dh(),p=p==null?null:p+"");for(var T=this._groups,D=T.length,L=0;L<D;++L)for(var V=T[L],h=V.length,U,R=0;R<h;++R)(U=V[R])&&Lu(U,p,_,R,V,E||E2(U,_));return new Uo(T,this._parents,p,_)}DA.prototype.interrupt=w1;DA.prototype.transition=S2;const yh=Math.PI,vh=2*yh,Ya=1e-6,T2=vh-Ya;function op(p){this._+=p[0];for(let _=1,E=p.length;_<E;++_)this._+=arguments[_]+p[_]}function I2(p){let _=Math.floor(p);if(!(_>=0))throw new Error(`invalid digits: ${p}`);if(_>15)return op;const E=10**_;return function(T){this._+=T[0];for(let D=1,L=T.length;D<L;++D)this._+=Math.round(arguments[D]*E)/E+T[D]}}class M2{constructor(_){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=_==null?op:I2(_)}moveTo(_,E){this._append`M${this._x0=this._x1=+_},${this._y0=this._y1=+E}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(_,E){this._append`L${this._x1=+_},${this._y1=+E}`}quadraticCurveTo(_,E,T,D){this._append`Q${+_},${+E},${this._x1=+T},${this._y1=+D}`}bezierCurveTo(_,E,T,D,L,V){this._append`C${+_},${+E},${+T},${+D},${this._x1=+L},${this._y1=+V}`}arcTo(_,E,T,D,L){if(_=+_,E=+E,T=+T,D=+D,L=+L,L<0)throw new Error(`negative radius: ${L}`);let V=this._x1,h=this._y1,U=T-_,R=D-E,ie=V-_,X=h-E,K=ie*ie+X*X;if(this._x1===null)this._append`M${this._x1=_},${this._y1=E}`;else if(K>Ya)if(!(Math.abs(X*U-R*ie)>Ya)||!L)this._append`L${this._x1=_},${this._y1=E}`;else{let Ae=T-V,we=D-h,xe=U*U+R*R,Te=Ae*Ae+we*we,Le=Math.sqrt(xe),Ze=Math.sqrt(K),We=L*Math.tan((yh-Math.acos((xe+K-Te)/(2*Le*Ze)))/2),je=We/Ze,nt=We/Le;Math.abs(je-1)>Ya&&this._append`L${_+je*ie},${E+je*X}`,this._append`A${L},${L},0,0,${+(X*Ae>ie*we)},${this._x1=_+nt*U},${this._y1=E+nt*R}`}}arc(_,E,T,D,L,V){if(_=+_,E=+E,T=+T,V=!!V,T<0)throw new Error(`negative radius: ${T}`);let h=T*Math.cos(D),U=T*Math.sin(D),R=_+h,ie=E+U,X=1^V,K=V?D-L:L-D;this._x1===null?this._append`M${R},${ie}`:(Math.abs(this._x1-R)>Ya||Math.abs(this._y1-ie)>Ya)&&this._append`L${R},${ie}`,T&&(K<0&&(K=K%vh+vh),K>T2?this._append`A${T},${T},0,1,${X},${_-h},${E-U}A${T},${T},0,1,${X},${this._x1=R},${this._y1=ie}`:K>Ya&&this._append`A${T},${T},0,${+(K>=yh)},${X},${this._x1=_+T*Math.cos(L)},${this._y1=E+T*Math.sin(L)}`)}rect(_,E,T,D){this._append`M${this._x0=this._x1=+_},${this._y0=this._y1=+E}h${T=+T}v${+D}h${-T}Z`}toString(){return this._}}var qf={},Nc={},Uc=34,xA=10,Gc=13;function ap(p){return new Function("d","return {"+p.map(function(_,E){return JSON.stringify(_)+": d["+E+'] || ""'}).join(",")+"}")}function C2(p,_){var E=ap(p);return function(T,D){return _(E(T),D,p)}}function Zf(p){var _=Object.create(null),E=[];return p.forEach(function(T){for(var D in T)D in _||E.push(_[D]=D)}),E}function mn(p,_){var E=p+"",T=E.length;return T<_?new Array(_-T+1).join(0)+E:E}function P2(p){return p<0?"-"+mn(-p,6):p>9999?"+"+mn(p,6):mn(p,4)}function D2(p){var _=p.getUTCHours(),E=p.getUTCMinutes(),T=p.getUTCSeconds(),D=p.getUTCMilliseconds();return isNaN(p)?"Invalid Date":P2(p.getUTCFullYear())+"-"+mn(p.getUTCMonth()+1,2)+"-"+mn(p.getUTCDate(),2)+(D?"T"+mn(_,2)+":"+mn(E,2)+":"+mn(T,2)+"."+mn(D,3)+"Z":T?"T"+mn(_,2)+":"+mn(E,2)+":"+mn(T,2)+"Z":E||_?"T"+mn(_,2)+":"+mn(E,2)+"Z":"")}function B2(p){var _=new RegExp('["'+p+`
\r]`),E=p.charCodeAt(0);function T(X,K){var Ae,we,xe=D(X,function(Te,Le){if(Ae)return Ae(Te,Le-1);we=Te,Ae=K?C2(Te,K):ap(Te)});return xe.columns=we||[],xe}function D(X,K){var Ae=[],we=X.length,xe=0,Te=0,Le,Ze=we<=0,We=!1;X.charCodeAt(we-1)===xA&&--we,X.charCodeAt(we-1)===Gc&&--we;function je(){if(Ze)return Nc;if(We)return We=!1,qf;var Tt,Ot=xe,It;if(X.charCodeAt(Ot)===Uc){for(;xe++<we&&X.charCodeAt(xe)!==Uc||X.charCodeAt(++xe)===Uc;);return(Tt=xe)>=we?Ze=!0:(It=X.charCodeAt(xe++))===xA?We=!0:It===Gc&&(We=!0,X.charCodeAt(xe)===xA&&++xe),X.slice(Ot+1,Tt-1).replace(/""/g,'"')}for(;xe<we;){if((It=X.charCodeAt(Tt=xe++))===xA)We=!0;else if(It===Gc)We=!0,X.charCodeAt(xe)===xA&&++xe;else if(It!==E)continue;return X.slice(Ot,Tt)}return Ze=!0,X.slice(Ot,we)}for(;(Le=je())!==Nc;){for(var nt=[];Le!==qf&&Le!==Nc;)nt.push(Le),Le=je();K&&(nt=K(nt,Te++))==null||Ae.push(nt)}return Ae}function L(X,K){return X.map(function(Ae){return K.map(function(we){return ie(Ae[we])}).join(p)})}function V(X,K){return K==null&&(K=Zf(X)),[K.map(ie).join(p)].concat(L(X,K)).join(`
`)}function h(X,K){return K==null&&(K=Zf(X)),L(X,K).join(`
`)}function U(X){return X.map(R).join(`
`)}function R(X){return X.map(ie).join(p)}function ie(X){return X==null?"":X instanceof Date?D2(X):_.test(X+="")?'"'+X.replace(/"/g,'""')+'"':X}return{parse:T,parseRows:D,format:V,formatBody:h,formatRows:U,formatRow:R,formatValue:ie}}var z2=B2(","),L2=z2.parse;function R2(p){if(!p.ok)throw new Error(p.status+" "+p.statusText);return p.text()}function F2(p,_){return fetch(p,_).then(R2)}function O2(p){return function(_,E,T){return arguments.length===2&&typeof E=="function"&&(T=E,E=void 0),F2(_,E).then(function(D){return p(D,T)})}}var V2=O2(L2);function N2(p){return Math.abs(p=Math.round(p))>=1e21?p.toLocaleString("en").replace(/,/g,""):p.toString(10)}function Mu(p,_){if((E=(p=_?p.toExponential(_-1):p.toExponential()).indexOf("e"))<0)return null;var E,T=p.slice(0,E);return[T.length>1?T[0]+T.slice(2):T,+p.slice(E+1)]}function Ql(p){return p=Mu(Math.abs(p)),p?p[1]:NaN}function U2(p,_){return function(E,T){for(var D=E.length,L=[],V=0,h=p[0],U=0;D>0&&h>0&&(U+h+1>T&&(h=Math.max(1,T-U)),L.push(E.substring(D-=h,D+h)),!((U+=h+1)>T));)h=p[V=(V+1)%p.length];return L.reverse().join(_)}}function G2(p){return function(_){return _.replace(/[0-9]/g,function(E){return p[+E]})}}var j2=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Cu(p){if(!(_=j2.exec(p)))throw new Error("invalid format: "+p);var _;return new Lh({fill:_[1],align:_[2],sign:_[3],symbol:_[4],zero:_[5],width:_[6],comma:_[7],precision:_[8]&&_[8].slice(1),trim:_[9],type:_[10]})}Cu.prototype=Lh.prototype;function Lh(p){this.fill=p.fill===void 0?" ":p.fill+"",this.align=p.align===void 0?">":p.align+"",this.sign=p.sign===void 0?"-":p.sign+"",this.symbol=p.symbol===void 0?"":p.symbol+"",this.zero=!!p.zero,this.width=p.width===void 0?void 0:+p.width,this.comma=!!p.comma,this.precision=p.precision===void 0?void 0:+p.precision,this.trim=!!p.trim,this.type=p.type===void 0?"":p.type+""}Lh.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function q2(p){e:for(var _=p.length,E=1,T=-1,D;E<_;++E)switch(p[E]){case".":T=D=E;break;case"0":T===0&&(T=E),D=E;break;default:if(!+p[E])break e;T>0&&(T=0);break}return T>0?p.slice(0,T)+p.slice(D+1):p}var lp;function Z2(p,_){var E=Mu(p,_);if(!E)return p+"";var T=E[0],D=E[1],L=D-(lp=Math.max(-8,Math.min(8,Math.floor(D/3)))*3)+1,V=T.length;return L===V?T:L>V?T+new Array(L-V+1).join("0"):L>0?T.slice(0,L)+"."+T.slice(L):"0."+new Array(1-L).join("0")+Mu(p,Math.max(0,_+L-1))[0]}function Qf(p,_){var E=Mu(p,_);if(!E)return p+"";var T=E[0],D=E[1];return D<0?"0."+new Array(-D).join("0")+T:T.length>D+1?T.slice(0,D+1)+"."+T.slice(D+1):T+new Array(D-T.length+2).join("0")}const $f={"%":(p,_)=>(p*100).toFixed(_),b:p=>Math.round(p).toString(2),c:p=>p+"",d:N2,e:(p,_)=>p.toExponential(_),f:(p,_)=>p.toFixed(_),g:(p,_)=>p.toPrecision(_),o:p=>Math.round(p).toString(8),p:(p,_)=>Qf(p*100,_),r:Qf,s:Z2,X:p=>Math.round(p).toString(16).toUpperCase(),x:p=>Math.round(p).toString(16)};function Hf(p){return p}var Wf=Array.prototype.map,Xf=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function Q2(p){var _=p.grouping===void 0||p.thousands===void 0?Hf:U2(Wf.call(p.grouping,Number),p.thousands+""),E=p.currency===void 0?"":p.currency[0]+"",T=p.currency===void 0?"":p.currency[1]+"",D=p.decimal===void 0?".":p.decimal+"",L=p.numerals===void 0?Hf:G2(Wf.call(p.numerals,String)),V=p.percent===void 0?"%":p.percent+"",h=p.minus===void 0?"−":p.minus+"",U=p.nan===void 0?"NaN":p.nan+"";function R(X){X=Cu(X);var K=X.fill,Ae=X.align,we=X.sign,xe=X.symbol,Te=X.zero,Le=X.width,Ze=X.comma,We=X.precision,je=X.trim,nt=X.type;nt==="n"?(Ze=!0,nt="g"):$f[nt]||(We===void 0&&(We=12),je=!0,nt="g"),(Te||K==="0"&&Ae==="=")&&(Te=!0,K="0",Ae="=");var Tt=xe==="$"?E:xe==="#"&&/[boxX]/.test(nt)?"0"+nt.toLowerCase():"",Ot=xe==="$"?T:/[%p]/.test(nt)?V:"",It=$f[nt],Kt=/[defgprs%]/.test(nt);We=We===void 0?6:/[gprs]/.test(nt)?Math.max(1,Math.min(21,We)):Math.max(0,Math.min(20,We));function Lt(kt){var Gt=Tt,Jt=Ot,si,ui,_i;if(nt==="c")Jt=It(kt)+Jt,kt="";else{kt=+kt;var vi=kt<0||1/kt<0;if(kt=isNaN(kt)?U:It(Math.abs(kt),We),je&&(kt=q2(kt)),vi&&+kt==0&&we!=="+"&&(vi=!1),Gt=(vi?we==="("?we:h:we==="-"||we==="("?"":we)+Gt,Jt=(nt==="s"?Xf[8+lp/3]:"")+Jt+(vi&&we==="("?")":""),Kt){for(si=-1,ui=kt.length;++si<ui;)if(_i=kt.charCodeAt(si),48>_i||_i>57){Jt=(_i===46?D+kt.slice(si+1):kt.slice(si))+Jt,kt=kt.slice(0,si);break}}}Ze&&!Te&&(kt=_(kt,1/0));var Gi=Gt.length+kt.length+Jt.length,Fi=Gi<Le?new Array(Le-Gi+1).join(K):"";switch(Ze&&Te&&(kt=_(Fi+kt,Fi.length?Le-Jt.length:1/0),Fi=""),Ae){case"<":kt=Gt+kt+Jt+Fi;break;case"=":kt=Gt+Fi+kt+Jt;break;case"^":kt=Fi.slice(0,Gi=Fi.length>>1)+Gt+kt+Jt+Fi.slice(Gi);break;default:kt=Fi+Gt+kt+Jt;break}return L(kt)}return Lt.toString=function(){return X+""},Lt}function ie(X,K){var Ae=R((X=Cu(X),X.type="f",X)),we=Math.max(-8,Math.min(8,Math.floor(Ql(K)/3)))*3,xe=Math.pow(10,-we),Te=Xf[8+we/3];return function(Le){return Ae(xe*Le)+Te}}return{format:R,formatPrefix:ie}}var Au,Ap,up;$2({thousands:",",grouping:[3],currency:["$",""]});function $2(p){return Au=Q2(p),Ap=Au.format,up=Au.formatPrefix,Au}function H2(p){return Math.max(0,-Ql(Math.abs(p)))}function W2(p,_){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Ql(_)/3)))*3-Ql(Math.abs(p)))}function X2(p,_){return p=Math.abs(p),_=Math.abs(_)-p,Math.max(0,Ql(_)-Ql(p))+1}function Y2(p,_){switch(arguments.length){case 0:break;case 1:this.range(p);break;default:this.range(_).domain(p);break}return this}function K2(p){return function(){return p}}function J2(p){return+p}var Yf=[0,1];function Nl(p){return p}function xh(p,_){return(_-=p=+p)?function(E){return(E-p)/_}:K2(isNaN(_)?NaN:.5)}function ev(p,_){var E;return p>_&&(E=p,p=_,_=E),function(T){return Math.max(p,Math.min(_,T))}}function tv(p,_,E){var T=p[0],D=p[1],L=_[0],V=_[1];return D<T?(T=xh(D,T),L=E(V,L)):(T=xh(T,D),L=E(L,V)),function(h){return L(T(h))}}function iv(p,_,E){var T=Math.min(p.length,_.length)-1,D=new Array(T),L=new Array(T),V=-1;for(p[T]<p[0]&&(p=p.slice().reverse(),_=_.slice().reverse());++V<T;)D[V]=xh(p[V],p[V+1]),L[V]=E(_[V],_[V+1]);return function(h){var U=Qg(p,h,1,T)-1;return L[U](D[U](h))}}function rv(p,_){return _.domain(p.domain()).range(p.range()).interpolate(p.interpolate()).clamp(p.clamp()).unknown(p.unknown())}function nv(){var p=Yf,_=Yf,E=Ph,T,D,L,V=Nl,h,U,R;function ie(){var K=Math.min(p.length,_.length);return V!==Nl&&(V=ev(p[0],p[K-1])),h=K>2?iv:tv,U=R=null,X}function X(K){return K==null||isNaN(K=+K)?L:(U||(U=h(p.map(T),_,E)))(T(V(K)))}return X.invert=function(K){return V(D((R||(R=h(_,p.map(T),ys)))(K)))},X.domain=function(K){return arguments.length?(p=Array.from(K,J2),ie()):p.slice()},X.range=function(K){return arguments.length?(_=Array.from(K),ie()):_.slice()},X.rangeRound=function(K){return _=Array.from(K),E=u1,ie()},X.clamp=function(K){return arguments.length?(V=K?!0:Nl,ie()):V!==Nl},X.interpolate=function(K){return arguments.length?(E=K,ie()):E},X.unknown=function(K){return arguments.length?(L=K,X):L},function(K,Ae){return T=K,D=Ae,ie()}}function sv(){return nv()(Nl,Nl)}function ov(p,_,E,T){var D=Kg(p,_,E),L;switch(T=Cu(T??",f"),T.type){case"s":{var V=Math.max(Math.abs(p),Math.abs(_));return T.precision==null&&!isNaN(L=W2(D,V))&&(T.precision=L),up(T,V)}case"":case"e":case"g":case"p":case"r":{T.precision==null&&!isNaN(L=X2(D,Math.max(Math.abs(p),Math.abs(_))))&&(T.precision=L-(T.type==="e"));break}case"f":case"%":{T.precision==null&&!isNaN(L=H2(D))&&(T.precision=L-(T.type==="%")*2);break}}return Ap(T)}function av(p){var _=p.domain;return p.ticks=function(E){var T=_();return Yg(T[0],T[T.length-1],E??10)},p.tickFormat=function(E,T){var D=_();return ov(D[0],D[D.length-1],E??10,T)},p.nice=function(E){E==null&&(E=10);var T=_(),D=0,L=T.length-1,V=T[D],h=T[L],U,R,ie=10;for(h<V&&(R=V,V=h,h=R,R=D,D=L,L=R);ie-- >0;){if(R=uh(V,h,E),R===U)return T[D]=V,T[L]=h,_(T);if(R>0)V=Math.floor(V/R)*R,h=Math.ceil(h/R)*R;else if(R<0)V=Math.ceil(V*R)/R,h=Math.floor(h*R)/R;else break;U=R}return p},p}function bh(){var p=sv();return p.copy=function(){return rv(p,bh())},Y2.apply(p,arguments),av(p)}function kr(p){return function(){return p}}function cp(p){let _=3;return p.digits=function(E){if(!arguments.length)return _;if(E==null)_=null;else{const T=Math.floor(E);if(!(T>=0))throw new RangeError(`invalid digits: ${E}`);_=T}return p},()=>new M2(_)}function hp(p){return typeof p=="object"&&"length"in p?p:Array.from(p)}function fp(p){this._context=p}fp.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(p,_){switch(p=+p,_=+_,this._point){case 0:this._point=1,this._line?this._context.lineTo(p,_):this._context.moveTo(p,_);break;case 1:this._point=2;default:this._context.lineTo(p,_);break}}};function dp(p){return new fp(p)}function pp(p){return p[0]}function mp(p){return p[1]}function wh(p,_){var E=kr(!0),T=null,D=dp,L=null,V=cp(h);p=typeof p=="function"?p:p===void 0?pp:kr(p),_=typeof _=="function"?_:_===void 0?mp:kr(_);function h(U){var R,ie=(U=hp(U)).length,X,K=!1,Ae;for(T==null&&(L=D(Ae=V())),R=0;R<=ie;++R)!(R<ie&&E(X=U[R],R,U))===K&&((K=!K)?L.lineStart():L.lineEnd()),K&&L.point(+p(X,R,U),+_(X,R,U));if(Ae)return L=null,Ae+""||null}return h.x=function(U){return arguments.length?(p=typeof U=="function"?U:kr(+U),h):p},h.y=function(U){return arguments.length?(_=typeof U=="function"?U:kr(+U),h):_},h.defined=function(U){return arguments.length?(E=typeof U=="function"?U:kr(!!U),h):E},h.curve=function(U){return arguments.length?(D=U,T!=null&&(L=D(T)),h):D},h.context=function(U){return arguments.length?(U==null?T=L=null:L=D(T=U),h):T},h}function Kf(p,_,E){var T=null,D=kr(!0),L=null,V=dp,h=null,U=cp(R);p=typeof p=="function"?p:p===void 0?pp:kr(+p),_=typeof _=="function"?_:kr(_===void 0?0:+_),E=typeof E=="function"?E:E===void 0?mp:kr(+E);function R(X){var K,Ae,we,xe=(X=hp(X)).length,Te,Le=!1,Ze,We=new Array(xe),je=new Array(xe);for(L==null&&(h=V(Ze=U())),K=0;K<=xe;++K){if(!(K<xe&&D(Te=X[K],K,X))===Le)if(Le=!Le)Ae=K,h.areaStart(),h.lineStart();else{for(h.lineEnd(),h.lineStart(),we=K-1;we>=Ae;--we)h.point(We[we],je[we]);h.lineEnd(),h.areaEnd()}Le&&(We[K]=+p(Te,K,X),je[K]=+_(Te,K,X),h.point(T?+T(Te,K,X):We[K],E?+E(Te,K,X):je[K]))}if(Ze)return h=null,Ze+""||null}function ie(){return wh().defined(D).curve(V).context(L)}return R.x=function(X){return arguments.length?(p=typeof X=="function"?X:kr(+X),T=null,R):p},R.x0=function(X){return arguments.length?(p=typeof X=="function"?X:kr(+X),R):p},R.x1=function(X){return arguments.length?(T=X==null?null:typeof X=="function"?X:kr(+X),R):T},R.y=function(X){return arguments.length?(_=typeof X=="function"?X:kr(+X),E=null,R):_},R.y0=function(X){return arguments.length?(_=typeof X=="function"?X:kr(+X),R):_},R.y1=function(X){return arguments.length?(E=X==null?null:typeof X=="function"?X:kr(+X),R):E},R.lineX0=R.lineY0=function(){return ie().x(p).y(_)},R.lineY1=function(){return ie().x(p).y(E)},R.lineX1=function(){return ie().x(T).y(_)},R.defined=function(X){return arguments.length?(D=typeof X=="function"?X:kr(!!X),R):D},R.curve=function(X){return arguments.length?(V=X,L!=null&&(h=V(L)),R):V},R.context=function(X){return arguments.length?(X==null?L=h=null:h=V(L=X),R):L},R}function SA(p,_,E){this.k=p,this.x=_,this.y=E}SA.prototype={constructor:SA,scale:function(p){return p===1?this:new SA(this.k*p,this.x,this.y)},translate:function(p,_){return p===0&_===0?this:new SA(this.k,this.x+this.k*p,this.y+this.k*_)},apply:function(p){return[p[0]*this.k+this.x,p[1]*this.k+this.y]},applyX:function(p){return p*this.k+this.x},applyY:function(p){return p*this.k+this.y},invert:function(p){return[(p[0]-this.x)/this.k,(p[1]-this.y)/this.k]},invertX:function(p){return(p-this.x)/this.k},invertY:function(p){return(p-this.y)/this.k},rescaleX:function(p){return p.copy().domain(p.range().map(this.invertX,this).map(p.invert,p))},rescaleY:function(p){return p.copy().domain(p.range().map(this.invertY,this).map(p.invert,p))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};SA.prototype;function Jf(p,_,E){const T=p.slice();return T[18]=_[E],T[20]=E,T}function ed(p){let _,E,T;return{c(){_=Wa("circle"),this.h()},l(D){_=Xa(D,"circle",{key:!0,cx:!0,cy:!0,r:!0,fill:!0,class:!0}),Br(_).forEach(ii),this.h()},h(){ei(_,"key",p[20]),ei(_,"cx",E=p[8](p[18][0])),ei(_,"cy",T=p[7](p[18][1])),ei(_,"r","5"),ei(_,"fill","white"),ei(_,"class","svelte-1m6ma0t")},m(D,L){lr(D,_,L)},p(D,L){L&257&&E!==(E=D[8](D[18][0]))&&ei(_,"cx",E),L&129&&T!==(T=D[7](D[18][1]))&&ei(_,"cy",T)},d(D){D&&ii(_)}}}function lv(p){let _,E,T,D,L,V,h,U,R,ie,X=vu(p[0]),K=[];for(let Ae=0;Ae<X.length;Ae+=1)K[Ae]=ed(Jf(p,X,Ae));return{c(){_=xs("div"),E=Wa("svg"),T=Wa("g"),L=Wa("g"),h=Wa("g");for(let Ae=0;Ae<K.length;Ae+=1)K[Ae].c();U=Wa("path"),R=Wa("path"),this.h()},l(Ae){_=bs(Ae,"DIV",{class:!0});var we=Br(_);E=Xa(we,"svg",{id:!0,viewBox:!0});var xe=Br(E);T=Xa(xe,"g",{class:!0,transform:!0}),Br(T).forEach(ii),L=Xa(xe,"g",{class:!0,transform:!0}),Br(L).forEach(ii),h=Xa(xe,"g",{class:!0,fill:!0,stroke:!0,"stroke-width":!0});var Te=Br(h);for(let Le=0;Le<K.length;Le+=1)K[Le].l(Te);Te.forEach(ii),U=Xa(xe,"path",{class:!0,fill:!0,stroke:!0,"stroke-width":!0,d:!0}),Br(U).forEach(ii),R=Xa(xe,"path",{class:!0,fill:!0,stroke:!0,"stroke-width":!0,d:!0}),Br(R).forEach(ii),xe.forEach(ii),we.forEach(ii),this.h()},h(){ei(T,"class","scale x svelte-1m6ma0t"),ei(T,"transform",D="translate(0,"+(p[2]-p[3])+")"),ei(L,"class","scale y svelte-1m6ma0t"),ei(L,"transform",V="translate("+p[4]+",0)"),ei(h,"class","point"),ei(h,"fill","white"),ei(h,"stroke","currentColor"),ei(h,"stroke-width","1.5"),ei(U,"class","area"),ei(U,"fill","#00ffaacc"),ei(U,"stroke","currentColor"),ei(U,"stroke-width","0"),ei(U,"d",p[10](p[9])),ei(R,"class","line"),ei(R,"fill","none"),ei(R,"stroke","currentColor"),ei(R,"stroke-width","1.5"),ei(R,"d",p[11](p[9])),ei(E,"id","viz"),ei(E,"viewBox",ie=`0 0 ${p[1]} ${p[2]}`),ei(_,"class","graph-container svelte-1m6ma0t")},m(Ae,we){lr(Ae,_,we),gn(_,E),gn(E,T),p[15](T),gn(E,L),p[16](L),gn(E,h);for(let xe=0;xe<K.length;xe+=1)K[xe]&&K[xe].m(h,null);gn(E,U),gn(E,R)},p(Ae,[we]){if(we&12&&D!==(D="translate(0,"+(Ae[2]-Ae[3])+")")&&ei(T,"transform",D),we&16&&V!==(V="translate("+Ae[4]+",0)")&&ei(L,"transform",V),we&385){X=vu(Ae[0]);let xe;for(xe=0;xe<X.length;xe+=1){const Te=Jf(Ae,X,xe);K[xe]?K[xe].p(Te,we):(K[xe]=ed(Te),K[xe].c(),K[xe].m(h,null))}for(;xe<K.length;xe+=1)K[xe].d(1);K.length=X.length}we&6&&ie!==(ie=`0 0 ${Ae[1]} ${Ae[2]}`)&&ei(E,"viewBox",ie)},i:TA,o:TA,d(Ae){Ae&&ii(_),p[15](null),p[16](null),Cd(K,Ae)}}}function Av(p,_,E){let T,D,{data:L}=_,{point:V}=_,{width:h=640}=_,{height:U=400}=_,{marginTop:R=20}=_,{marginRight:ie=20}=_,{marginBottom:X=30}=_,{marginLeft:K=40}=_,Ae,we,xe=[{x:0,y:0,ci_minus:.4,ci_plus:.6},{x:.5,y:.2,ci_minus:.4,ci_plus:.6},{x:1,y:.3,ci_minus:.6,ci_plus:.7},{x:2,y:.55,ci_minus:.65,ci_plus:.7},{x:3,y:.65,ci_minus:.6,ci_plus:.75}];V2("https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/data_IC.csv",function(je){console.log(je),su("#viz").append("path").datum(je).attr("fill","#cce5df").attr("stroke","none").attr("d",Kf().x(function(nt){return T(nt.x)}).y0(function(nt){return D(nt.CI_right)}).y1(function(nt){return D(nt.CI_left)}))});const Te=Kf().x(je=>T(je.x)).y0(je=>D(je.ci_minus)).y1(je=>D(je.ci_plus)),Le=wh(je=>T(je.x),je=>D(je.y));function Ze(je){yu[je?"unshift":"push"](()=>{Ae=je,E(5,Ae)})}function We(je){yu[je?"unshift":"push"](()=>{we=je,E(6,we)})}return p.$$set=je=>{"data"in je&&E(12,L=je.data),"point"in je&&E(0,V=je.point),"width"in je&&E(1,h=je.width),"height"in je&&E(2,U=je.height),"marginTop"in je&&E(13,R=je.marginTop),"marginRight"in je&&E(14,ie=je.marginRight),"marginBottom"in je&&E(3,X=je.marginBottom),"marginLeft"in je&&E(4,K=je.marginLeft)},p.$$.update=()=>{p.$$.dirty&20498&&E(8,T=bh([0,L.length-1],[K,h-ie])),p.$$.dirty&8204&&E(7,D=bh($g([0,1]),[U-X,R])),p.$$.dirty&384&&wh((je,nt)=>T(nt),D),p.$$.dirty&192&&su(we).call(o_(D)),p.$$.dirty&288&&su(Ae).call(s_(T)),p.$$.dirty&6&&su("svg").append("div").classed("svg-container",!0).append("svg").attr("preserveAspectRatio","xMinYMin meet").attr("viewBox",`0 0 ${h} ${U}`).classed("svg-content-responsive",!0)},[V,h,U,X,K,Ae,we,D,T,xe,Te,Le,L,R,ie,Ze,We]}class uv extends Js{constructor(_){super(),eo(this,_,Av,lv,Ks,{data:12,point:0,width:1,height:2,marginTop:13,marginRight:14,marginBottom:3,marginLeft:4})}}function td(p){let _,E=`${p[0].hex}`,T,D,L,V=`${p[0].latlng.lat}, ${p[0].latlng.lng}`,h,U,R,ie=p[0].properties.pd+"",X,K,Ae,we;return Ae=new uv({props:{data:[.4,.7,.8,.9,1],point:[[1.2,p[0].properties.pd]]}}),{c(){_=xs("h1"),T=cu(E),D=ws(),L=xs("h3"),h=cu(V),U=ws(),R=xs("span"),X=cu(ie),K=ws(),Fo(Ae.$$.fragment),this.h()},l(xe){_=bs(xe,"H1",{class:!0});var Te=Br(_);T=hu(Te,E),Te.forEach(ii),D=ks(xe),L=bs(xe,"H3",{});var Le=Br(L);h=hu(Le,V),Le.forEach(ii),U=ks(xe),R=bs(xe,"SPAN",{});var Ze=Br(R);X=hu(Ze,ie),Ze.forEach(ii),K=ks(xe),Oo(Ae.$$.fragment,xe),this.h()},h(){ei(_,"class","svelte-1w59bdv")},m(xe,Te){lr(xe,_,Te),gn(_,T),lr(xe,D,Te),lr(xe,L,Te),gn(L,h),lr(xe,U,Te),lr(xe,R,Te),gn(R,X),lr(xe,K,Te),Vo(Ae,xe,Te),we=!0},p(xe,Te){(!we||Te&1)&&E!==(E=`${xe[0].hex}`)&&zc(T,E),(!we||Te&1)&&V!==(V=`${xe[0].latlng.lat}, ${xe[0].latlng.lng}`)&&zc(h,V),(!we||Te&1)&&ie!==(ie=xe[0].properties.pd+"")&&zc(X,ie);const Le={};Te&1&&(Le.point=[[1.2,xe[0].properties.pd]]),Ae.$set(Le)},i(xe){we||(dr(Ae.$$.fragment,xe),we=!0)},o(xe){Hr(Ae.$$.fragment,xe),we=!1},d(xe){xe&&(ii(_),ii(D),ii(L),ii(U),ii(R),ii(K)),No(Ae,xe)}}}function id(p){let _,E="Click on a hexagon to see data";return{c(){_=xs("h3"),_.textContent=E},l(T){_=bs(T,"H3",{"data-svelte-h":!0}),Ig(_)!=="svelte-k06cu4"&&(_.textContent=E)},m(T,D){lr(T,_,D)},d(T){T&&ii(_)}}}function cv(p){let _,E,T,D=p[0].properties&&td(p),L=!p[0].properties&&id();return{c(){_=xs("div"),D&&D.c(),E=ws(),L&&L.c(),this.h()},l(V){_=bs(V,"DIV",{class:!0});var h=Br(_);D&&D.l(h),E=ks(h),L&&L.l(h),h.forEach(ii),this.h()},h(){ei(_,"class",Ah("modal")+" svelte-1w59bdv")},m(V,h){lr(V,_,h),D&&D.m(_,null),gn(_,E),L&&L.m(_,null),T=!0},p(V,[h]){V[0].properties?D?(D.p(V,h),h&1&&dr(D,1)):(D=td(V),D.c(),dr(D,1),D.m(_,E)):D&&(Eh(),Hr(D,1,1,()=>{D=null}),Sh()),V[0].properties?L&&(L.d(1),L=null):L||(L=id(),L.c(),L.m(_,null))},i(V){T||(dr(D),T=!0)},o(V){Hr(D),T=!1},d(V){V&&ii(_),D&&D.d(),L&&L.d()}}}function hv(p,_,E){let{selectionData:T}=_;return p.$$set=D=>{"selectionData"in D&&E(0,T=D.selectionData)},[T]}class fv extends Js{constructor(_){super(),eo(this,_,hv,cv,Ks,{selectionData:0})}}const gp=Symbol.for("svelte-maplibre");function Ru(){return Cg(gp)}function dv(p){let _=new WeakMap;return E=>{var V;let T=_.get(E.originalEvent);if(T!==void 0)return T;let L=(V=E.target.queryRenderedFeatures(E.point).find(h=>{var U;return(U=p.get(h.layer.id))==null?void 0:U.interactive}))==null?void 0:V.layer.id;return _.set(E.originalEvent,L),L}}function pv(){let p=new Map;return Mg(gp,{map:Vl(null),source:Lc(null),layer:Lc(null),popupTarget:Lc(null),cluster:Vl(),loadedImages:Vl(new Set),minzoom:Vl(0),maxzoom:Vl(24),layerEvent:Vl(null),layerInfo:p,eventTopMost:dv(p)})}var mv=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function _p(p){return p&&p.__esModule&&Object.prototype.hasOwnProperty.call(p,"default")?p.default:p}function gv(p){if(p.__esModule)return p;var _=p.default;if(typeof _=="function"){var E=function T(){return this instanceof T?Reflect.construct(_,arguments,this.constructor):_.apply(this,arguments)};E.prototype=_.prototype}else E={};return Object.defineProperty(E,"__esModule",{value:!0}),Object.keys(p).forEach(function(T){var D=Object.getOwnPropertyDescriptor(p,T);Object.defineProperty(E,T,D.get?D:{enumerable:!0,get:function(){return p[T]}})}),E}var yp={exports:{}};(function(p,_){(function(E,T){p.exports=T()})(mv,function(){var E,T,D;function L(h,U){if(!E)E=U;else if(!T)T=U;else{var R="var sharedChunk = {}; ("+E+")(sharedChunk); ("+T+")(sharedChunk);",ie={};E(ie),D=U(ie),typeof window<"u"&&(D.workerUrl=window.URL.createObjectURL(new Blob([R],{type:"text/javascript"})))}}L(["exports"],function(h){function U(r,e,o,u){return new(o||(o=Promise))(function(m,w){function k(B){try{P(u.next(B))}catch(F){w(F)}}function I(B){try{P(u.throw(B))}catch(F){w(F)}}function P(B){var F;B.done?m(B.value):(F=B.value,F instanceof o?F:new o(function(O){O(F)})).then(k,I)}P((u=u.apply(r,e||[])).next())})}function R(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}typeof SuppressedError=="function"&&SuppressedError;var ie=X;function X(r,e){this.x=r,this.y=e}X.prototype={clone:function(){return new X(this.x,this.y)},add:function(r){return this.clone()._add(r)},sub:function(r){return this.clone()._sub(r)},multByPoint:function(r){return this.clone()._multByPoint(r)},divByPoint:function(r){return this.clone()._divByPoint(r)},mult:function(r){return this.clone()._mult(r)},div:function(r){return this.clone()._div(r)},rotate:function(r){return this.clone()._rotate(r)},rotateAround:function(r,e){return this.clone()._rotateAround(r,e)},matMult:function(r){return this.clone()._matMult(r)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(r){return this.x===r.x&&this.y===r.y},dist:function(r){return Math.sqrt(this.distSqr(r))},distSqr:function(r){var e=r.x-this.x,o=r.y-this.y;return e*e+o*o},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith:function(r){return this.angleWithSep(r.x,r.y)},angleWithSep:function(r,e){return Math.atan2(this.x*e-this.y*r,this.x*r+this.y*e)},_matMult:function(r){var e=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=e,this},_add:function(r){return this.x+=r.x,this.y+=r.y,this},_sub:function(r){return this.x-=r.x,this.y-=r.y,this},_mult:function(r){return this.x*=r,this.y*=r,this},_div:function(r){return this.x/=r,this.y/=r,this},_multByPoint:function(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint:function(r){return this.x/=r.x,this.y/=r.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var r=this.y;return this.y=this.x,this.x=-r,this},_rotate:function(r){var e=Math.cos(r),o=Math.sin(r),u=o*this.x+e*this.y;return this.x=e*this.x-o*this.y,this.y=u,this},_rotateAround:function(r,e){var o=Math.cos(r),u=Math.sin(r),m=e.y+u*(this.x-e.x)+o*(this.y-e.y);return this.x=e.x+o*(this.x-e.x)-u*(this.y-e.y),this.y=m,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},X.convert=function(r){return r instanceof X?r:Array.isArray(r)?new X(r[0],r[1]):r};var K=R(ie),Ae=we;function we(r,e,o,u){this.cx=3*r,this.bx=3*(o-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(u-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=e,this.p2x=o,this.p2y=u}we.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,e){if(e===void 0&&(e=1e-6),r<0)return 0;if(r>1)return 1;for(var o=r,u=0;u<8;u++){var m=this.sampleCurveX(o)-r;if(Math.abs(m)<e)return o;var w=this.sampleCurveDerivativeX(o);if(Math.abs(w)<1e-6)break;o-=m/w}var k=0,I=1;for(o=r,u=0;u<20&&(m=this.sampleCurveX(o),!(Math.abs(m-r)<e));u++)r>m?k=o:I=o,o=.5*(I-k)+k;return o},solve:function(r,e){return this.sampleCurveY(this.solveCurveX(r,e))}};var xe=R(Ae);let Te,Le;function Ze(){return Te==null&&(Te=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Te}function We(){if(Le==null&&(Le=!1,Ze())){const e=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(e){for(let u=0;u<5*5;u++){const m=4*u;e.fillStyle=`rgb(${m},${m+1},${m+2})`,e.fillRect(u%5,Math.floor(u/5),1,1)}const o=e.getImageData(0,0,5,5).data;for(let u=0;u<5*5*4;u++)if(u%4!=3&&o[u]!==u){Le=!0;break}}}return Le||!1}function je(r,e,o,u){const m=new xe(r,e,o,u);return function(w){return m.solve(w)}}const nt=je(.25,.1,.25,1);function Tt(r,e,o){return Math.min(o,Math.max(e,r))}function Ot(r,e,o){const u=o-e,m=((r-e)%u+u)%u+e;return m===e?o:m}function It(r,...e){for(const o of e)for(const u in o)r[u]=o[u];return r}let Kt=1;function Lt(r,e,o){const u={};for(const m in r)u[m]=e.call(o||this,r[m],m,r);return u}function kt(r,e,o){const u={};for(const m in r)e.call(o||this,r[m],m,r)&&(u[m]=r[m]);return u}function Gt(r){return Array.isArray(r)?r.map(Gt):typeof r=="object"&&r?Lt(r,Gt):r}const Jt={};function si(r){Jt[r]||(typeof console<"u"&&console.warn(r),Jt[r]=!0)}function ui(r,e,o){return(o.y-r.y)*(e.x-r.x)>(e.y-r.y)*(o.x-r.x)}function _i(r){let e=0;for(let o,u,m=0,w=r.length,k=w-1;m<w;k=m++)o=r[m],u=r[k],e+=(u.x-o.x)*(o.y+u.y);return e}function vi(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}let Gi=null;function Fi(r){return typeof ImageBitmap<"u"&&r instanceof ImageBitmap}const Jn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Wr(r,e,o,u,m){return U(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const w=new VideoFrame(r,{timestamp:0});try{const k=w==null?void 0:w.format;if(!k||!k.startsWith("BGR")&&!k.startsWith("RGB"))throw new Error(`Unrecognized format ${k}`);const I=k.startsWith("BGR"),P=new Uint8ClampedArray(u*m*4);if(yield w.copyTo(P,function(B,F,O,q,W){const Y=4*Math.max(-F,0),re=(Math.max(0,O)-O)*q*4+Y,ue=4*q,me=Math.max(0,F),ke=Math.max(0,O);return{rect:{x:me,y:ke,width:Math.min(B.width,F+q)-me,height:Math.min(B.height,O+W)-ke},layout:[{offset:re,stride:ue}]}}(r,e,o,u,m)),I)for(let B=0;B<P.length;B+=4){const F=P[B];P[B]=P[B+2],P[B+2]=F}return P}finally{w.close()}})}let ji,ri,Oi,yn;const Xr={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(r){const e=requestAnimationFrame(r);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(r,e=0){return this.getImageCanvasContext(r).getImageData(-e,-e,r.width+2*e,r.height+2*e)},getImageCanvasContext(r){const e=window.document.createElement("canvas"),o=e.getContext("2d",{willReadFrequently:!0});if(!o)throw new Error("failed to create canvas 2d context");return e.width=r.width,e.height=r.height,o.drawImage(r,0,0,r.width,r.height),o},resolveURL:r=>(Oi||(Oi=document.createElement("a")),Oi.href=r,Oi.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(yn==null&&(yn=matchMedia("(prefers-reduced-motion: reduce)")),yn.matches)}},Ye={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};class Dt extends Error{constructor(e,o,u,m){super(`AJAXError: ${o} (${e}): ${u}`),this.status=e,this.statusText=o,this.url=u,this.body=m}}const ni=vi()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href,Wi=r=>Ye.REGISTERED_PROTOCOLS[r.substring(0,r.indexOf("://"))];function ro(r,e){const o=new AbortController,u=new Request(r.url,{method:r.method||"GET",body:r.body,credentials:r.credentials,headers:r.headers,cache:r.cache,referrer:ni(),signal:o.signal});let m=!1,w=!1;return r.type==="json"&&u.headers.set("Accept","application/json"),w||fetch(u).then(k=>k.ok?(I=>{(r.type==="arrayBuffer"||r.type==="image"?I.arrayBuffer():r.type==="json"?I.json():I.text()).then(P=>{w||(m=!0,e(null,P,I.headers.get("Cache-Control"),I.headers.get("Expires")))}).catch(P=>{w||e(new Error(P.message))})})(k):k.blob().then(I=>e(new Dt(k.status,k.statusText,r.url,I)))).catch(k=>{k.code!==20&&e(new Error(k.message))}),{cancel:()=>{w=!0,m||o.abort()}}}const Rn=function(r,e){if(/:\/\//.test(r.url)&&!/^https?:|^file:/.test(r.url)){if(vi()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",r,e);if(!vi())return(Wi(r.url)||ro)(r,e)}if(!(/^file:/.test(o=r.url)||/^file:/.test(ni())&&!/^\w+:/.test(o))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return ro(r,e);if(vi()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",r,e,void 0,!0)}var o;return function(u,m){const w=new XMLHttpRequest;w.open(u.method||"GET",u.url,!0),u.type!=="arrayBuffer"&&u.type!=="image"||(w.responseType="arraybuffer");for(const k in u.headers)w.setRequestHeader(k,u.headers[k]);return u.type==="json"&&(w.responseType="text",w.setRequestHeader("Accept","application/json")),w.withCredentials=u.credentials==="include",w.onerror=()=>{m(new Error(w.statusText))},w.onload=()=>{if((w.status>=200&&w.status<300||w.status===0)&&w.response!==null){let k=w.response;if(u.type==="json")try{k=JSON.parse(w.response)}catch(I){return m(I)}m(null,k,w.getResponseHeader("Cache-Control"),w.getResponseHeader("Expires"))}else{const k=new Blob([w.response],{type:w.getResponseHeader("Content-Type")});m(new Dt(w.status,w.statusText,u.url,k))}},w.send(u.body),{cancel:()=>w.abort()}}(r,e)},no=function(r,e){return Rn(It(r,{type:"arrayBuffer"}),e)};function vn(r){if(!r||r.indexOf("://")<=0||r.indexOf("data:image/")===0||r.indexOf("blob:")===0)return!0;const e=new URL(r),o=window.location;return e.protocol===o.protocol&&e.host===o.host}function Ss(r,e,o){o[r]&&o[r].indexOf(e)!==-1||(o[r]=o[r]||[],o[r].push(e))}function es(r,e,o){if(o&&o[r]){const u=o[r].indexOf(e);u!==-1&&o[r].splice(u,1)}}class pr{constructor(e,o={}){It(this,o),this.type=e}}class Lr extends pr{constructor(e,o={}){super("error",It({error:e},o))}}class ts{on(e,o){return this._listeners=this._listeners||{},Ss(e,o,this._listeners),this}off(e,o){return es(e,o,this._listeners),es(e,o,this._oneTimeListeners),this}once(e,o){return o?(this._oneTimeListeners=this._oneTimeListeners||{},Ss(e,o,this._oneTimeListeners),this):new Promise(u=>this.once(e,u))}fire(e,o){typeof e=="string"&&(e=new pr(e,o||{}));const u=e.type;if(this.listens(u)){e.target=this;const m=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];for(const I of m)I.call(this,e);const w=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];for(const I of w)es(u,I,this._oneTimeListeners),I.call(this,e);const k=this._eventedParent;k&&(It(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),k.fire(e))}else e instanceof Lr&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,o){return this._eventedParent=e,this._eventedParentData=o,this}}var ze={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Mi=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function mr(r,e){const o={};for(const u in r)u!=="ref"&&(o[u]=r[u]);return Mi.forEach(u=>{u in e&&(o[u]=e[u])}),o}function oi(r,e){if(Array.isArray(r)){if(!Array.isArray(e)||r.length!==e.length)return!1;for(let o=0;o<r.length;o++)if(!oi(r[o],e[o]))return!1;return!0}if(typeof r=="object"&&r!==null&&e!==null){if(typeof e!="object"||Object.keys(r).length!==Object.keys(e).length)return!1;for(const o in r)if(!oi(r[o],e[o]))return!1;return!0}return r===e}const qt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Rr(r,e,o){o.push({command:qt.addSource,args:[r,e[r]]})}function Ts(r,e,o){e.push({command:qt.removeSource,args:[r]}),o[r]=!0}function xn(r,e,o,u){Ts(r,o,u),Rr(r,e,o)}function so(r,e,o){let u;for(u in r[o])if(Object.prototype.hasOwnProperty.call(r[o],u)&&u!=="data"&&!oi(r[o][u],e[o][u]))return!1;for(u in e[o])if(Object.prototype.hasOwnProperty.call(e[o],u)&&u!=="data"&&!oi(r[o][u],e[o][u]))return!1;return!0}function is(r,e,o,u,m,w){let k;for(k in e=e||{},r=r||{})Object.prototype.hasOwnProperty.call(r,k)&&(oi(r[k],e[k])||o.push({command:w,args:[u,k,e[k],m]}));for(k in e)Object.prototype.hasOwnProperty.call(e,k)&&!Object.prototype.hasOwnProperty.call(r,k)&&(oi(r[k],e[k])||o.push({command:w,args:[u,k,e[k],m]}))}function Fn(r){return r.id}function rs(r,e){return r[e.id]=e,r}class qe{constructor(e,o,u,m){this.message=(e?`${e}: `:"")+u,m&&(this.identifier=m),o!=null&&o.__line__&&(this.line=o.__line__)}}function An(r,...e){for(const o of e)for(const u in o)r[u]=o[u];return r}class Ei extends Error{constructor(e,o){super(o),this.message=o,this.key=e}}class ns{constructor(e,o=[]){this.parent=e,this.bindings={};for(const[u,m]of o)this.bindings[u]=m}concat(e){return new ns(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const un={kind:"null"},$e={kind:"number"},Vt={kind:"string"},Mt={kind:"boolean"},Xi={kind:"color"},cn={kind:"object"},Bt={kind:"value"},Ve={kind:"collator"},ae={kind:"formatted"},j={kind:"padding"},$={kind:"resolvedImage"},te={kind:"variableAnchorOffsetCollection"};function le(r,e){return{kind:"array",itemType:r,N:e}}function ce(r){if(r.kind==="array"){const e=ce(r.itemType);return typeof r.N=="number"?`array<${e}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${e}>`}return r.kind}const Ee=[un,$e,Vt,Mt,Xi,ae,cn,le(Bt),j,$,te];function ve(r,e){if(e.kind==="error")return null;if(r.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!ve(r.itemType,e.itemType))&&(typeof r.N!="number"||r.N===e.N))return null}else{if(r.kind===e.kind)return null;if(r.kind==="value"){for(const o of Ee)if(!ve(o,e))return null}}return`Expected ${ce(r)} but found ${ce(e)} instead.`}function de(r,e){return e.some(o=>o.kind===r.kind)}function be(r,e){return e.some(o=>o==="null"?r===null:o==="array"?Array.isArray(r):o==="object"?r&&!Array.isArray(r)&&typeof r=="object":o===typeof r)}function Be(r,e){return r.kind==="array"&&e.kind==="array"?r.itemType.kind===e.itemType.kind&&typeof r.N=="number":r.kind===e.kind}const se=.96422,_e=.82521,De=4/29,Ue=6/29,A=3*Ue*Ue,H=Ue*Ue*Ue,Ke=Math.PI/180,mt=180/Math.PI;function zt(r){return(r%=360)<0&&(r+=360),r}function ot([r,e,o,u]){let m,w;const k=Si((.2225045*(r=At(r))+.7168786*(e=At(e))+.0606169*(o=At(o)))/1);r===e&&e===o?m=w=k:(m=Si((.4360747*r+.3850649*e+.1430804*o)/se),w=Si((.0139322*r+.0971045*e+.7141733*o)/_e));const I=116*k-16;return[I<0?0:I,500*(m-k),200*(k-w),u]}function At(r){return r<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function Si(r){return r>H?Math.pow(r,1/3):r/A+De}function Et([r,e,o,u]){let m=(r+16)/116,w=isNaN(e)?m:m+e/500,k=isNaN(o)?m:m-o/200;return m=1*li(m),w=se*li(w),k=_e*li(k),[gt(3.1338561*w-1.6168667*m-.4906146*k),gt(-.9787684*w+1.9161415*m+.033454*k),gt(.0719453*w-.2289914*m+1.4052427*k),u]}function gt(r){return(r=r<=.00304?12.92*r:1.055*Math.pow(r,1/2.4)-.055)<0?0:r>1?1:r}function li(r){return r>Ue?r*r*r:A*(r-De)}function Ar(r){return parseInt(r.padEnd(2,r),16)/255}function il(r,e){return On(e?r/100:r,0,1)}function On(r,e,o){return Math.min(Math.max(e,r),o)}function Yi(r){return!r.some(Number.isNaN)}const Is={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Zt{constructor(e,o,u,m=1,w=!0){this.r=e,this.g=o,this.b=u,this.a=m,w||(this.r*=m,this.g*=m,this.b*=m,m||this.overwriteGetter("rgb",[e,o,u,m]))}static parse(e){if(e instanceof Zt)return e;if(typeof e!="string")return;const o=function(u){if((u=u.toLowerCase().trim())==="transparent")return[0,0,0,0];const m=Is[u];if(m){const[k,I,P]=m;return[k/255,I/255,P/255,1]}if(u.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(u)){const k=u.length<6?1:2;let I=1;return[Ar(u.slice(I,I+=k)),Ar(u.slice(I,I+=k)),Ar(u.slice(I,I+=k)),Ar(u.slice(I,I+k)||"ff")]}if(u.startsWith("rgb")){const k=u.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(k){const[I,P,B,F,O,q,W,Y,re,ue,me,ke]=k,ye=[F||" ",W||" ",ue].join("");if(ye==="  "||ye==="  /"||ye===",,"||ye===",,,"){const Se=[B,q,re].join(""),Ie=Se==="%%%"?100:Se===""?255:0;if(Ie){const Re=[On(+P/Ie,0,1),On(+O/Ie,0,1),On(+Y/Ie,0,1),me?il(+me,ke):1];if(Yi(Re))return Re}}return}}const w=u.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(w){const[k,I,P,B,F,O,q,W,Y]=w,re=[P||" ",F||" ",q].join("");if(re==="  "||re==="  /"||re===",,"||re===",,,"){const ue=[+I,On(+B,0,100),On(+O,0,100),W?il(+W,Y):1];if(Yi(ue))return function([me,ke,ye,Se]){function Ie(Re){const it=(Re+me/30)%12,ct=ke*Math.min(ye,1-ye);return ye-ct*Math.max(-1,Math.min(it-3,9-it,1))}return me=zt(me),ke/=100,ye/=100,[Ie(0),Ie(8),Ie(4),Se]}(ue)}}}(e);return o?new Zt(...o,!1):void 0}get rgb(){const{r:e,g:o,b:u,a:m}=this,w=m||1/0;return this.overwriteGetter("rgb",[e/w,o/w,u/w,m])}get hcl(){return this.overwriteGetter("hcl",function(e){const[o,u,m,w]=ot(e),k=Math.sqrt(u*u+m*m);return[Math.round(1e4*k)?zt(Math.atan2(m,u)*mt):NaN,k,o,w]}(this.rgb))}get lab(){return this.overwriteGetter("lab",ot(this.rgb))}overwriteGetter(e,o){return Object.defineProperty(this,e,{value:o}),o}toString(){const[e,o,u,m]=this.rgb;return`rgba(${[e,o,u].map(w=>Math.round(255*w)).join(",")},${m})`}}Zt.black=new Zt(0,0,0,1),Zt.white=new Zt(1,1,1,1),Zt.transparent=new Zt(0,0,0,0),Zt.red=new Zt(1,0,0,1);class oo{constructor(e,o,u){this.sensitivity=e?o?"variant":"case":o?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,o){return this.collator.compare(e,o)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Go{constructor(e,o,u,m,w){this.text=e,this.image=o,this.scale=u,this.fontStack=m,this.textColor=w}}class Ci{constructor(e){this.sections=e}static fromString(e){return new Ci([new Go(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof Ci?e:Ci.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class St{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof St)return e;if(typeof e=="number")return new St([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const o of e)if(typeof o!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new St(e)}}toString(){return JSON.stringify(this.values)}}const ne=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class _t{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof _t)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let o=0;o<e.length;o+=2){const u=e[o],m=e[o+1];if(typeof u!="string"||!ne.has(u)||!Array.isArray(m)||m.length!==2||typeof m[0]!="number"||typeof m[1]!="number")return}return new _t(e)}}toString(){return JSON.stringify(this.values)}}class qi{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new qi({name:e,available:!1}):null}}function jo(r,e,o,u){return typeof r=="number"&&r>=0&&r<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof o=="number"&&o>=0&&o<=255?u===void 0||typeof u=="number"&&u>=0&&u<=1?null:`Invalid rgba value [${[r,e,o,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof u=="number"?[r,e,o,u]:[r,e,o]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ms(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof Zt||r instanceof oo||r instanceof Ci||r instanceof St||r instanceof _t||r instanceof qi)return!0;if(Array.isArray(r)){for(const e of r)if(!Ms(e))return!1;return!0}if(typeof r=="object"){for(const e in r)if(!Ms(r[e]))return!1;return!0}return!1}function xi(r){if(r===null)return un;if(typeof r=="string")return Vt;if(typeof r=="boolean")return Mt;if(typeof r=="number")return $e;if(r instanceof Zt)return Xi;if(r instanceof oo)return Ve;if(r instanceof Ci)return ae;if(r instanceof St)return j;if(r instanceof _t)return te;if(r instanceof qi)return $;if(Array.isArray(r)){const e=r.length;let o;for(const u of r){const m=xi(u);if(o){if(o===m)continue;o=Bt;break}o=m}return le(o||Bt,e)}return cn}function ti(r){const e=typeof r;return r===null?"":e==="string"||e==="number"||e==="boolean"?String(r):r instanceof Zt||r instanceof Ci||r instanceof St||r instanceof _t||r instanceof qi?r.toString():JSON.stringify(r)}class J{constructor(e,o){this.type=e,this.value=o}static parse(e,o){if(e.length!==2)return o.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Ms(e[1]))return o.error("invalid value");const u=e[1];let m=xi(u);const w=o.expectedType;return m.kind!=="array"||m.N!==0||!w||w.kind!=="array"||typeof w.N=="number"&&w.N!==0||(m=w),new J(m,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Ti{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const qo={string:Vt,number:$e,boolean:Mt,object:cn};class Fr{constructor(e,o){this.type=e,this.args=o}static parse(e,o){if(e.length<2)return o.error("Expected at least one argument.");let u,m=1;const w=e[0];if(w==="array"){let I,P;if(e.length>2){const B=e[1];if(typeof B!="string"||!(B in qo)||B==="object")return o.error('The item type argument of "array" must be one of string, number, boolean',1);I=qo[B],m++}else I=Bt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return o.error('The length argument to "array" must be a positive integer literal',2);P=e[2],m++}u=le(I,P)}else{if(!qo[w])throw new Error(`Types doesn't contain name = ${w}`);u=qo[w]}const k=[];for(;m<e.length;m++){const I=o.parse(e[m],m,Bt);if(!I)return null;k.push(I)}return new Fr(u,k)}evaluate(e){for(let o=0;o<this.args.length;o++){const u=this.args[o].evaluate(e);if(!ve(this.type,xi(u)))return u;if(o===this.args.length-1)throw new Ti(`Expected value to be of type ${ce(this.type)}, but found ${ce(xi(u))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const pa={"to-boolean":Mt,"to-color":Xi,"to-number":$e,"to-string":Vt};class Vn{constructor(e,o){this.type=e,this.args=o}static parse(e,o){if(e.length<2)return o.error("Expected at least one argument.");const u=e[0];if(!pa[u])throw new Error(`Can't parse ${u} as it is not part of the known types`);if((u==="to-boolean"||u==="to-string")&&e.length!==2)return o.error("Expected one argument.");const m=pa[u],w=[];for(let k=1;k<e.length;k++){const I=o.parse(e[k],k,Bt);if(!I)return null;w.push(I)}return new Vn(m,w)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let o,u;for(const m of this.args){if(o=m.evaluate(e),u=null,o instanceof Zt)return o;if(typeof o=="string"){const w=e.parseColor(o);if(w)return w}else if(Array.isArray(o)&&(u=o.length<3||o.length>4?`Invalid rbga value ${JSON.stringify(o)}: expected an array containing either three or four numeric values.`:jo(o[0],o[1],o[2],o[3]),!u))return new Zt(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new Ti(u||`Could not parse color from value '${typeof o=="string"?o:JSON.stringify(o)}'`)}case"padding":{let o;for(const u of this.args){o=u.evaluate(e);const m=St.parse(o);if(m)return m}throw new Ti(`Could not parse padding from value '${typeof o=="string"?o:JSON.stringify(o)}'`)}case"variableAnchorOffsetCollection":{let o;for(const u of this.args){o=u.evaluate(e);const m=_t.parse(o);if(m)return m}throw new Ti(`Could not parse variableAnchorOffsetCollection from value '${typeof o=="string"?o:JSON.stringify(o)}'`)}case"number":{let o=null;for(const u of this.args){if(o=u.evaluate(e),o===null)return 0;const m=Number(o);if(!isNaN(m))return m}throw new Ti(`Could not convert ${JSON.stringify(o)} to number.`)}case"formatted":return Ci.fromString(ti(this.args[0].evaluate(e)));case"resolvedImage":return qi.fromString(ti(this.args[0].evaluate(e)));default:return ti(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const rl=["Unknown","Point","LineString","Polygon"];class Zo{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?rl[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let o=this._parseColorCache[e];return o||(o=this._parseColorCache[e]=Zt.parse(e)),o}}class ao{constructor(e,o,u=[],m,w=new ns,k=[]){this.registry=e,this.path=u,this.key=u.map(I=>`[${I}]`).join(""),this.scope=w,this.errors=k,this.expectedType=m,this._isConstant=o}parse(e,o,u,m,w={}){return o?this.concat(o,u,m)._parse(e,w):this._parse(e,w)}_parse(e,o){function u(m,w,k){return k==="assert"?new Fr(w,[m]):k==="coerce"?new Vn(w,[m]):m}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const m=e[0];if(typeof m!="string")return this.error(`Expression name must be a string, but found ${typeof m} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const w=this.registry[m];if(w){let k=w.parse(e,this);if(!k)return null;if(this.expectedType){const I=this.expectedType,P=k.type;if(I.kind!=="string"&&I.kind!=="number"&&I.kind!=="boolean"&&I.kind!=="object"&&I.kind!=="array"||P.kind!=="value")if(I.kind!=="color"&&I.kind!=="formatted"&&I.kind!=="resolvedImage"||P.kind!=="value"&&P.kind!=="string")if(I.kind!=="padding"||P.kind!=="value"&&P.kind!=="number"&&P.kind!=="array")if(I.kind!=="variableAnchorOffsetCollection"||P.kind!=="value"&&P.kind!=="array"){if(this.checkSubtype(I,P))return null}else k=u(k,I,o.typeAnnotation||"coerce");else k=u(k,I,o.typeAnnotation||"coerce");else k=u(k,I,o.typeAnnotation||"coerce");else k=u(k,I,o.typeAnnotation||"assert")}if(!(k instanceof J)&&k.type.kind!=="resolvedImage"&&this._isConstant(k)){const I=new Zo;try{k=new J(k.type,k.evaluate(I))}catch(P){return this.error(P.message),null}}return k}return this.error(`Unknown expression "${m}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,o,u){const m=typeof e=="number"?this.path.concat(e):this.path,w=u?this.scope.concat(u):this.scope;return new ao(this.registry,this._isConstant,m,o||null,w,this.errors)}error(e,...o){const u=`${this.key}${o.map(m=>`[${m}]`).join("")}`;this.errors.push(new Ei(u,e))}checkSubtype(e,o){const u=ve(e,o);return u&&this.error(u),u}}class lo{constructor(e,o,u){this.type=Ve,this.locale=u,this.caseSensitive=e,this.diacriticSensitive=o}static parse(e,o){if(e.length!==2)return o.error("Expected one argument.");const u=e[1];if(typeof u!="object"||Array.isArray(u))return o.error("Collator options argument must be an object.");const m=o.parse(u["case-sensitive"]!==void 0&&u["case-sensitive"],1,Mt);if(!m)return null;const w=o.parse(u["diacritic-sensitive"]!==void 0&&u["diacritic-sensitive"],1,Mt);if(!w)return null;let k=null;return u.locale&&(k=o.parse(u.locale,1,Vt),!k)?null:new lo(m,w,k)}evaluate(e){return new oo(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}const sr=8192;function zi(r,e){r[0]=Math.min(r[0],e[0]),r[1]=Math.min(r[1],e[1]),r[2]=Math.max(r[2],e[0]),r[3]=Math.max(r[3],e[1])}function ss(r,e){return!(r[0]<=e[0]||r[2]>=e[2]||r[1]<=e[1]||r[3]>=e[3])}function nl(r,e){const o=(180+r[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,m=Math.pow(2,e.z);return[Math.round(o*m*sr),Math.round(u*m*sr)]}function Hl(r,e,o){const u=r[0]-e[0],m=r[1]-e[1],w=r[0]-o[0],k=r[1]-o[1];return u*k-w*m==0&&u*w<=0&&m*k<=0}function Qo(r,e){let o=!1;for(let k=0,I=e.length;k<I;k++){const P=e[k];for(let B=0,F=P.length;B<F-1;B++){if(Hl(r,P[B],P[B+1]))return!1;(m=P[B])[1]>(u=r)[1]!=(w=P[B+1])[1]>u[1]&&u[0]<(w[0]-m[0])*(u[1]-m[1])/(w[1]-m[1])+m[0]&&(o=!o)}}var u,m,w;return o}function ma(r,e){for(let o=0;o<e.length;o++)if(Qo(r,e[o]))return!0;return!1}function sl(r,e,o,u){const m=u[0]-o[0],w=u[1]-o[1],k=(r[0]-o[0])*w-m*(r[1]-o[1]),I=(e[0]-o[0])*w-m*(e[1]-o[1]);return k>0&&I<0||k<0&&I>0}function Wl(r,e,o){for(const B of o)for(let F=0;F<B.length-1;++F)if((I=[(k=B[F+1])[0]-(w=B[F])[0],k[1]-w[1]])[0]*(P=[(m=e)[0]-(u=r)[0],m[1]-u[1]])[1]-I[1]*P[0]!=0&&sl(u,m,w,k)&&sl(w,k,u,m))return!0;var u,m,w,k,I,P;return!1}function ci(r,e){for(let o=0;o<r.length;++o)if(!Qo(r[o],e))return!1;for(let o=0;o<r.length-1;++o)if(Wl(r[o],r[o+1],e))return!1;return!0}function $o(r,e){for(let o=0;o<e.length;o++)if(ci(r,e[o]))return!0;return!1}function Ao(r,e,o){const u=[];for(let m=0;m<r.length;m++){const w=[];for(let k=0;k<r[m].length;k++){const I=nl(r[m][k],o);zi(e,I),w.push(I)}u.push(w)}return u}function ol(r,e,o){const u=[];for(let m=0;m<r.length;m++){const w=Ao(r[m],e,o);u.push(w)}return u}function al(r,e,o,u){if(r[0]<o[0]||r[0]>o[2]){const m=.5*u;let w=r[0]-o[0]>m?-u:o[0]-r[0]>m?u:0;w===0&&(w=r[0]-o[2]>m?-u:o[2]-r[0]>m?u:0),r[0]+=w}zi(e,r)}function ga(r,e,o,u){const m=Math.pow(2,u.z)*sr,w=[u.x*sr,u.y*sr],k=[];for(const I of r)for(const P of I){const B=[P.x+w[0],P.y+w[1]];al(B,e,o,m),k.push(B)}return k}function Ho(r,e,o,u){const m=Math.pow(2,u.z)*sr,w=[u.x*sr,u.y*sr],k=[];for(const P of r){const B=[];for(const F of P){const O=[F.x+w[0],F.y+w[1]];zi(e,O),B.push(O)}k.push(B)}if(e[2]-e[0]<=m/2){(I=e)[0]=I[1]=1/0,I[2]=I[3]=-1/0;for(const P of k)for(const B of P)al(B,e,o,m)}var I;return k}class bn{constructor(e,o){this.type=Mt,this.geojson=e,this.geometries=o}static parse(e,o){if(e.length!==2)return o.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Ms(e[1])){const u=e[1];if(u.type==="FeatureCollection")for(let m=0;m<u.features.length;++m){const w=u.features[m].geometry.type;if(w==="Polygon"||w==="MultiPolygon")return new bn(u,u.features[m].geometry)}else if(u.type==="Feature"){const m=u.geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new bn(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new bn(u,u)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(o,u){const m=[1/0,1/0,-1/0,-1/0],w=[1/0,1/0,-1/0,-1/0],k=o.canonicalID();if(u.type==="Polygon"){const I=Ao(u.coordinates,w,k),P=ga(o.geometry(),m,w,k);if(!ss(m,w))return!1;for(const B of P)if(!Qo(B,I))return!1}if(u.type==="MultiPolygon"){const I=ol(u.coordinates,w,k),P=ga(o.geometry(),m,w,k);if(!ss(m,w))return!1;for(const B of P)if(!ma(B,I))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(o,u){const m=[1/0,1/0,-1/0,-1/0],w=[1/0,1/0,-1/0,-1/0],k=o.canonicalID();if(u.type==="Polygon"){const I=Ao(u.coordinates,w,k),P=Ho(o.geometry(),m,w,k);if(!ss(m,w))return!1;for(const B of P)if(!ci(B,I))return!1}if(u.type==="MultiPolygon"){const I=ol(u.coordinates,w,k),P=Ho(o.geometry(),m,w,k);if(!ss(m,w))return!1;for(const B of P)if(!$o(B,I))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Cs{constructor(e,o){this.type=o.type,this.name=e,this.boundExpression=o}static parse(e,o){if(e.length!==2||typeof e[1]!="string")return o.error("'var' expression requires exactly one string literal argument.");const u=e[1];return o.scope.has(u)?new Cs(u,o.scope.get(u)):o.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class Or{constructor(e,o,u,m){this.name=e,this.type=o,this._evaluate=u,this.args=m}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,o){const u=e[0],m=Or.definitions[u];if(!m)return o.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);const w=Array.isArray(m)?m[0]:m.type,k=Array.isArray(m)?[[m[1],m[2]]]:m.overloads,I=k.filter(([B])=>!Array.isArray(B)||B.length===e.length-1);let P=null;for(const[B,F]of I){P=new ao(o.registry,Wo,o.path,null,o.scope);const O=[];let q=!1;for(let W=1;W<e.length;W++){const Y=e[W],re=Array.isArray(B)?B[W-1]:B.type,ue=P.parse(Y,1+O.length,re);if(!ue){q=!0;break}O.push(ue)}if(!q)if(Array.isArray(B)&&B.length!==O.length)P.error(`Expected ${B.length} arguments, but found ${O.length} instead.`);else{for(let W=0;W<O.length;W++){const Y=Array.isArray(B)?B[W]:B.type,re=O[W];P.concat(W+1).checkSubtype(Y,re.type)}if(P.errors.length===0)return new Or(u,w,F,O)}}if(I.length===1)o.errors.push(...P.errors);else{const B=(I.length?I:k).map(([O])=>{return q=O,Array.isArray(q)?`(${q.map(ce).join(", ")})`:`(${ce(q.type)}...)`;var q}).join(" | "),F=[];for(let O=1;O<e.length;O++){const q=o.parse(e[O],1+F.length);if(!q)return null;F.push(ce(q.type))}o.error(`Expected arguments of type ${B}, but found (${F.join(", ")}) instead.`)}return null}static register(e,o){Or.definitions=o;for(const u in o)e[u]=Or}}function Wo(r){if(r instanceof Cs)return Wo(r.boundExpression);if(r instanceof Or&&r.name==="error"||r instanceof lo||r instanceof bn)return!1;const e=r instanceof Vn||r instanceof Fr;let o=!0;return r.eachChild(u=>{o=e?o&&Wo(u):o&&u instanceof J}),!!o&&uo(r)&&co(r,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function uo(r){if(r instanceof Or&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof bn)return!1;let e=!0;return r.eachChild(o=>{e&&!uo(o)&&(e=!1)}),e}function Ps(r){if(r instanceof Or&&r.name==="feature-state")return!1;let e=!0;return r.eachChild(o=>{e&&!Ps(o)&&(e=!1)}),e}function co(r,e){if(r instanceof Or&&e.indexOf(r.name)>=0)return!1;let o=!0;return r.eachChild(u=>{o&&!co(u,e)&&(o=!1)}),o}function Ds(r,e){const o=r.length-1;let u,m,w=0,k=o,I=0;for(;w<=k;)if(I=Math.floor((w+k)/2),u=r[I],m=r[I+1],u<=e){if(I===o||e<m)return I;w=I+1}else{if(!(u>e))throw new Ti("Input is not a number.");k=I-1}return 0}class Nn{constructor(e,o,u){this.type=e,this.input=o,this.labels=[],this.outputs=[];for(const[m,w]of u)this.labels.push(m),this.outputs.push(w)}static parse(e,o){if(e.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return o.error("Expected an even number of arguments.");const u=o.parse(e[1],1,$e);if(!u)return null;const m=[];let w=null;o.expectedType&&o.expectedType.kind!=="value"&&(w=o.expectedType);for(let k=1;k<e.length;k+=2){const I=k===1?-1/0:e[k],P=e[k+1],B=k,F=k+1;if(typeof I!="number")return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',B);if(m.length&&m[m.length-1][0]>=I)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',B);const O=o.parse(P,F,w);if(!O)return null;w=w||O.type,m.push([I,O])}return new Nn(w,u,m)}evaluate(e){const o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(e);const m=this.input.evaluate(e);if(m<=o[0])return u[0].evaluate(e);const w=o.length;return m>=o[w-1]?u[w-1].evaluate(e):u[Ds(o,m)].evaluate(e)}eachChild(e){e(this.input);for(const o of this.outputs)e(o)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function Wt(r,e,o){return r+o*(e-r)}function Vi(r,e,o){return r.map((u,m)=>Wt(u,e[m],o))}const Ni={number:Wt,color:function(r,e,o,u="rgb"){switch(u){case"rgb":{const[m,w,k,I]=Vi(r.rgb,e.rgb,o);return new Zt(m,w,k,I,!1)}case"hcl":{const[m,w,k,I]=r.hcl,[P,B,F,O]=e.hcl;let q,W;if(isNaN(m)||isNaN(P))isNaN(m)?isNaN(P)?q=NaN:(q=P,k!==1&&k!==0||(W=B)):(q=m,F!==1&&F!==0||(W=w));else{let ke=P-m;P>m&&ke>180?ke-=360:P<m&&m-P>180&&(ke+=360),q=m+o*ke}const[Y,re,ue,me]=function([ke,ye,Se,Ie]){return ke=isNaN(ke)?0:ke*Ke,Et([Se,Math.cos(ke)*ye,Math.sin(ke)*ye,Ie])}([q,W??Wt(w,B,o),Wt(k,F,o),Wt(I,O,o)]);return new Zt(Y,re,ue,me,!1)}case"lab":{const[m,w,k,I]=Et(Vi(r.lab,e.lab,o));return new Zt(m,w,k,I,!1)}}},array:Vi,padding:function(r,e,o){return new St(Vi(r.values,e.values,o))},variableAnchorOffsetCollection:function(r,e,o){const u=r.values,m=e.values;if(u.length!==m.length)throw new Ti(`Cannot interpolate values of different length. from: ${r.toString()}, to: ${e.toString()}`);const w=[];for(let k=0;k<u.length;k+=2){if(u[k]!==m[k])throw new Ti(`Cannot interpolate values containing mismatched anchors. from[${k}]: ${u[k]}, to[${k}]: ${m[k]}`);w.push(u[k]);const[I,P]=u[k+1],[B,F]=m[k+1];w.push([Wt(I,B,o),Wt(P,F,o)])}return new _t(w)}};class hi{constructor(e,o,u,m,w){this.type=e,this.operator=o,this.interpolation=u,this.input=m,this.labels=[],this.outputs=[];for(const[k,I]of w)this.labels.push(k),this.outputs.push(I)}static interpolationFactor(e,o,u,m){let w=0;if(e.name==="exponential")w=ho(o,e.base,u,m);else if(e.name==="linear")w=ho(o,1,u,m);else if(e.name==="cubic-bezier"){const k=e.controlPoints;w=new xe(k[0],k[1],k[2],k[3]).solve(ho(o,1,u,m))}return w}static parse(e,o){let[u,m,w,...k]=e;if(!Array.isArray(m)||m.length===0)return o.error("Expected an interpolation type expression.",1);if(m[0]==="linear")m={name:"linear"};else if(m[0]==="exponential"){const B=m[1];if(typeof B!="number")return o.error("Exponential interpolation requires a numeric base.",1,1);m={name:"exponential",base:B}}else{if(m[0]!=="cubic-bezier")return o.error(`Unknown interpolation type ${String(m[0])}`,1,0);{const B=m.slice(1);if(B.length!==4||B.some(F=>typeof F!="number"||F<0||F>1))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);m={name:"cubic-bezier",controlPoints:B}}}if(e.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return o.error("Expected an even number of arguments.");if(w=o.parse(w,2,$e),!w)return null;const I=[];let P=null;u==="interpolate-hcl"||u==="interpolate-lab"?P=Xi:o.expectedType&&o.expectedType.kind!=="value"&&(P=o.expectedType);for(let B=0;B<k.length;B+=2){const F=k[B],O=k[B+1],q=B+3,W=B+4;if(typeof F!="number")return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',q);if(I.length&&I[I.length-1][0]>=F)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',q);const Y=o.parse(O,W,P);if(!Y)return null;P=P||Y.type,I.push([F,Y])}return Be(P,$e)||Be(P,Xi)||Be(P,j)||Be(P,te)||Be(P,le($e))?new hi(P,u,m,w,I):o.error(`Type ${ce(P)} is not interpolatable.`)}evaluate(e){const o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(e);const m=this.input.evaluate(e);if(m<=o[0])return u[0].evaluate(e);const w=o.length;if(m>=o[w-1])return u[w-1].evaluate(e);const k=Ds(o,m),I=hi.interpolationFactor(this.interpolation,m,o[k],o[k+1]),P=u[k].evaluate(e),B=u[k+1].evaluate(e);switch(this.operator){case"interpolate":return Ni[this.type.kind](P,B,I);case"interpolate-hcl":return Ni.color(P,B,I,"hcl");case"interpolate-lab":return Ni.color(P,B,I,"lab")}}eachChild(e){e(this.input);for(const o of this.outputs)e(o)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function ho(r,e,o,u){const m=u-o,w=r-o;return m===0?0:e===1?w/m:(Math.pow(e,w)-1)/(Math.pow(e,m)-1)}class fo{constructor(e,o){this.type=e,this.args=o}static parse(e,o){if(e.length<2)return o.error("Expectected at least one argument.");let u=null;const m=o.expectedType;m&&m.kind!=="value"&&(u=m);const w=[];for(const I of e.slice(1)){const P=o.parse(I,1+w.length,u,void 0,{typeAnnotation:"omit"});if(!P)return null;u=u||P.type,w.push(P)}if(!u)throw new Error("No output type");const k=m&&w.some(I=>ve(m,I.type));return new fo(k?Bt:u,w)}evaluate(e){let o,u=null,m=0;for(const w of this.args)if(m++,u=w.evaluate(e),u&&u instanceof qi&&!u.available&&(o||(o=u.name),u=null,m===this.args.length&&(u=o)),u!==null)break;return u}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}class os{constructor(e,o){this.type=o.type,this.bindings=[].concat(e),this.result=o}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const o of this.bindings)e(o[1]);e(this.result)}static parse(e,o){if(e.length<4)return o.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const u=[];for(let w=1;w<e.length-1;w+=2){const k=e[w];if(typeof k!="string")return o.error(`Expected string, but found ${typeof k} instead.`,w);if(/[^a-zA-Z0-9_]/.test(k))return o.error("Variable names must contain only alphanumeric characters or '_'.",w);const I=o.parse(e[w+1],w+1);if(!I)return null;u.push([k,I])}const m=o.parse(e[e.length-1],e.length-1,o.expectedType,u);return m?new os(u,m):null}outputDefined(){return this.result.outputDefined()}}class _a{constructor(e,o,u){this.type=e,this.index=o,this.input=u}static parse(e,o){if(e.length!==3)return o.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const u=o.parse(e[1],1,$e),m=o.parse(e[2],2,le(o.expectedType||Bt));return u&&m?new _a(m.type.itemType,u,m):null}evaluate(e){const o=this.index.evaluate(e),u=this.input.evaluate(e);if(o<0)throw new Ti(`Array index out of bounds: ${o} < 0.`);if(o>=u.length)throw new Ti(`Array index out of bounds: ${o} > ${u.length-1}.`);if(o!==Math.floor(o))throw new Ti(`Array index must be an integer, but found ${o} instead.`);return u[o]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class ya{constructor(e,o){this.type=Mt,this.needle=e,this.haystack=o}static parse(e,o){if(e.length!==3)return o.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const u=o.parse(e[1],1,Bt),m=o.parse(e[2],2,Bt);return u&&m?de(u.type,[Mt,Vt,$e,un,Bt])?new ya(u,m):o.error(`Expected first argument to be of type boolean, string, number or null, but found ${ce(u.type)} instead`):null}evaluate(e){const o=this.needle.evaluate(e),u=this.haystack.evaluate(e);if(!u)return!1;if(!be(o,["boolean","string","number","null"]))throw new Ti(`Expected first argument to be of type boolean, string, number or null, but found ${ce(xi(o))} instead.`);if(!be(u,["string","array"]))throw new Ti(`Expected second argument to be of type array or string, but found ${ce(xi(u))} instead.`);return u.indexOf(o)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class Xo{constructor(e,o,u){this.type=$e,this.needle=e,this.haystack=o,this.fromIndex=u}static parse(e,o){if(e.length<=2||e.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const u=o.parse(e[1],1,Bt),m=o.parse(e[2],2,Bt);if(!u||!m)return null;if(!de(u.type,[Mt,Vt,$e,un,Bt]))return o.error(`Expected first argument to be of type boolean, string, number or null, but found ${ce(u.type)} instead`);if(e.length===4){const w=o.parse(e[3],3,$e);return w?new Xo(u,m,w):null}return new Xo(u,m)}evaluate(e){const o=this.needle.evaluate(e),u=this.haystack.evaluate(e);if(!be(o,["boolean","string","number","null"]))throw new Ti(`Expected first argument to be of type boolean, string, number or null, but found ${ce(xi(o))} instead.`);if(!be(u,["string","array"]))throw new Ti(`Expected second argument to be of type array or string, but found ${ce(xi(u))} instead.`);if(this.fromIndex){const m=this.fromIndex.evaluate(e);return u.indexOf(o,m)}return u.indexOf(o)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class Yo{constructor(e,o,u,m,w,k){this.inputType=e,this.type=o,this.input=u,this.cases=m,this.outputs=w,this.otherwise=k}static parse(e,o){if(e.length<5)return o.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return o.error("Expected an even number of arguments.");let u,m;o.expectedType&&o.expectedType.kind!=="value"&&(m=o.expectedType);const w={},k=[];for(let B=2;B<e.length-1;B+=2){let F=e[B];const O=e[B+1];Array.isArray(F)||(F=[F]);const q=o.concat(B);if(F.length===0)return q.error("Expected at least one branch label.");for(const Y of F){if(typeof Y!="number"&&typeof Y!="string")return q.error("Branch labels must be numbers or strings.");if(typeof Y=="number"&&Math.abs(Y)>Number.MAX_SAFE_INTEGER)return q.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof Y=="number"&&Math.floor(Y)!==Y)return q.error("Numeric branch labels must be integer values.");if(u){if(q.checkSubtype(u,xi(Y)))return null}else u=xi(Y);if(w[String(Y)]!==void 0)return q.error("Branch labels must be unique.");w[String(Y)]=k.length}const W=o.parse(O,B,m);if(!W)return null;m=m||W.type,k.push(W)}const I=o.parse(e[1],1,Bt);if(!I)return null;const P=o.parse(e[e.length-1],e.length-1,m);return P?I.type.kind!=="value"&&o.concat(1).checkSubtype(u,I.type)?null:new Yo(u,m,I,w,k,P):null}evaluate(e){const o=this.input.evaluate(e);return(xi(o)===this.inputType&&this.outputs[this.cases[o]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class Bs{constructor(e,o,u){this.type=e,this.branches=o,this.otherwise=u}static parse(e,o){if(e.length<4)return o.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return o.error("Expected an odd number of arguments.");let u;o.expectedType&&o.expectedType.kind!=="value"&&(u=o.expectedType);const m=[];for(let k=1;k<e.length-1;k+=2){const I=o.parse(e[k],k,Mt);if(!I)return null;const P=o.parse(e[k+1],k+1,u);if(!P)return null;m.push([I,P]),u=u||P.type}const w=o.parse(e[e.length-1],e.length-1,u);if(!w)return null;if(!u)throw new Error("Can't infer output type");return new Bs(u,m,w)}evaluate(e){for(const[o,u]of this.branches)if(o.evaluate(e))return u.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[o,u]of this.branches)e(o),e(u);e(this.otherwise)}outputDefined(){return this.branches.every(([e,o])=>o.outputDefined())&&this.otherwise.outputDefined()}}class hn{constructor(e,o,u,m){this.type=e,this.input=o,this.beginIndex=u,this.endIndex=m}static parse(e,o){if(e.length<=2||e.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const u=o.parse(e[1],1,Bt),m=o.parse(e[2],2,$e);if(!u||!m)return null;if(!de(u.type,[le(Bt),Vt,Bt]))return o.error(`Expected first argument to be of type array or string, but found ${ce(u.type)} instead`);if(e.length===4){const w=o.parse(e[3],3,$e);return w?new hn(u.type,u,m,w):null}return new hn(u.type,u,m)}evaluate(e){const o=this.input.evaluate(e),u=this.beginIndex.evaluate(e);if(!be(o,["string","array"]))throw new Ti(`Expected first argument to be of type array or string, but found ${ce(xi(o))} instead.`);if(this.endIndex){const m=this.endIndex.evaluate(e);return o.slice(u,m)}return o.slice(u)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function va(r,e){return r==="=="||r==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function xa(r,e,o,u){return u.compare(e,o)===0}function wn(r,e,o){const u=r!=="=="&&r!=="!=";return class vp{constructor(w,k,I){this.type=Mt,this.lhs=w,this.rhs=k,this.collator=I,this.hasUntypedArgument=w.type.kind==="value"||k.type.kind==="value"}static parse(w,k){if(w.length!==3&&w.length!==4)return k.error("Expected two or three arguments.");const I=w[0];let P=k.parse(w[1],1,Bt);if(!P)return null;if(!va(I,P.type))return k.concat(1).error(`"${I}" comparisons are not supported for type '${ce(P.type)}'.`);let B=k.parse(w[2],2,Bt);if(!B)return null;if(!va(I,B.type))return k.concat(2).error(`"${I}" comparisons are not supported for type '${ce(B.type)}'.`);if(P.type.kind!==B.type.kind&&P.type.kind!=="value"&&B.type.kind!=="value")return k.error(`Cannot compare types '${ce(P.type)}' and '${ce(B.type)}'.`);u&&(P.type.kind==="value"&&B.type.kind!=="value"?P=new Fr(B.type,[P]):P.type.kind!=="value"&&B.type.kind==="value"&&(B=new Fr(P.type,[B])));let F=null;if(w.length===4){if(P.type.kind!=="string"&&B.type.kind!=="string"&&P.type.kind!=="value"&&B.type.kind!=="value")return k.error("Cannot use collator to compare non-string types.");if(F=k.parse(w[3],3,Ve),!F)return null}return new vp(P,B,F)}evaluate(w){const k=this.lhs.evaluate(w),I=this.rhs.evaluate(w);if(u&&this.hasUntypedArgument){const P=xi(k),B=xi(I);if(P.kind!==B.kind||P.kind!=="string"&&P.kind!=="number")throw new Ti(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${P.kind}, ${B.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){const P=xi(k),B=xi(I);if(P.kind!=="string"||B.kind!=="string")return e(w,k,I)}return this.collator?o(w,k,I,this.collator.evaluate(w)):e(w,k,I)}eachChild(w){w(this.lhs),w(this.rhs),this.collator&&w(this.collator)}outputDefined(){return!0}}}const as=wn("==",function(r,e,o){return e===o},xa),Un=wn("!=",function(r,e,o){return e!==o},function(r,e,o,u){return!xa(0,e,o,u)}),ll=wn("<",function(r,e,o){return e<o},function(r,e,o,u){return u.compare(e,o)<0}),Al=wn(">",function(r,e,o){return e>o},function(r,e,o,u){return u.compare(e,o)>0}),ba=wn("<=",function(r,e,o){return e<=o},function(r,e,o,u){return u.compare(e,o)<=0}),Xl=wn(">=",function(r,e,o){return e>=o},function(r,e,o,u){return u.compare(e,o)>=0});class wa{constructor(e,o,u,m,w){this.type=Vt,this.number=e,this.locale=o,this.currency=u,this.minFractionDigits=m,this.maxFractionDigits=w}static parse(e,o){if(e.length!==3)return o.error("Expected two arguments.");const u=o.parse(e[1],1,$e);if(!u)return null;const m=e[2];if(typeof m!="object"||Array.isArray(m))return o.error("NumberFormat options argument must be an object.");let w=null;if(m.locale&&(w=o.parse(m.locale,1,Vt),!w))return null;let k=null;if(m.currency&&(k=o.parse(m.currency,1,Vt),!k))return null;let I=null;if(m["min-fraction-digits"]&&(I=o.parse(m["min-fraction-digits"],1,$e),!I))return null;let P=null;return m["max-fraction-digits"]&&(P=o.parse(m["max-fraction-digits"],1,$e),!P)?null:new wa(u,w,k,I,P)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class po{constructor(e){this.type=ae,this.sections=e}static parse(e,o){if(e.length<2)return o.error("Expected at least one argument.");const u=e[1];if(!Array.isArray(u)&&typeof u=="object")return o.error("First argument must be an image or text section.");const m=[];let w=!1;for(let k=1;k<=e.length-1;++k){const I=e[k];if(w&&typeof I=="object"&&!Array.isArray(I)){w=!1;let P=null;if(I["font-scale"]&&(P=o.parse(I["font-scale"],1,$e),!P))return null;let B=null;if(I["text-font"]&&(B=o.parse(I["text-font"],1,le(Vt)),!B))return null;let F=null;if(I["text-color"]&&(F=o.parse(I["text-color"],1,Xi),!F))return null;const O=m[m.length-1];O.scale=P,O.font=B,O.textColor=F}else{const P=o.parse(e[k],1,Bt);if(!P)return null;const B=P.type.kind;if(B!=="string"&&B!=="value"&&B!=="null"&&B!=="resolvedImage")return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");w=!0,m.push({content:P,scale:null,font:null,textColor:null})}}return new po(m)}evaluate(e){return new Ci(this.sections.map(o=>{const u=o.content.evaluate(e);return xi(u)===$?new Go("",u,null,null,null):new Go(ti(u),null,o.scale?o.scale.evaluate(e):null,o.font?o.font.evaluate(e).join(","):null,o.textColor?o.textColor.evaluate(e):null)}))}eachChild(e){for(const o of this.sections)e(o.content),o.scale&&e(o.scale),o.font&&e(o.font),o.textColor&&e(o.textColor)}outputDefined(){return!1}}class ka{constructor(e){this.type=$,this.input=e}static parse(e,o){if(e.length!==2)return o.error("Expected two arguments.");const u=o.parse(e[1],1,Vt);return u?new ka(u):o.error("No image name provided.")}evaluate(e){const o=this.input.evaluate(e),u=qi.fromString(o);return u&&e.availableImages&&(u.available=e.availableImages.indexOf(o)>-1),u}eachChild(e){e(this.input)}outputDefined(){return!1}}class Ea{constructor(e){this.type=$e,this.input=e}static parse(e,o){if(e.length!==2)return o.error(`Expected 1 argument, but found ${e.length-1} instead.`);const u=o.parse(e[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?o.error(`Expected argument of type string or array, but found ${ce(u.type)} instead.`):new Ea(u):null}evaluate(e){const o=this.input.evaluate(e);if(typeof o=="string"||Array.isArray(o))return o.length;throw new Ti(`Expected value to be of type string or array, but found ${ce(xi(o))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const zs={"==":as,"!=":Un,">":Al,"<":ll,">=":Xl,"<=":ba,array:Fr,at:_a,boolean:Fr,case:Bs,coalesce:fo,collator:lo,format:po,image:ka,in:ya,"index-of":Xo,interpolate:hi,"interpolate-hcl":hi,"interpolate-lab":hi,length:Ea,let:os,literal:J,match:Yo,number:Fr,"number-format":wa,object:Fr,slice:hn,step:Nn,string:Fr,"to-boolean":Vn,"to-color":Vn,"to-number":Vn,"to-string":Vn,var:Cs,within:bn};function ul(r,[e,o,u,m]){e=e.evaluate(r),o=o.evaluate(r),u=u.evaluate(r);const w=m?m.evaluate(r):1,k=jo(e,o,u,w);if(k)throw new Ti(k);return new Zt(e/255,o/255,u/255,w,!1)}function cl(r,e){return r in e}function Sa(r,e){const o=e[r];return o===void 0?null:o}function ls(r){return{type:r}}function hl(r){return{result:"success",value:r}}function Yr(r){return{result:"error",value:r}}function Ls(r){return r["property-type"]==="data-driven"||r["property-type"]==="cross-faded-data-driven"}function fl(r){return!!r.expression&&r.expression.parameters.indexOf("zoom")>-1}function Ta(r){return!!r.expression&&r.expression.interpolated}function Xt(r){return r instanceof Number?"number":r instanceof String?"string":r instanceof Boolean?"boolean":Array.isArray(r)?"array":r===null?"null":typeof r}function bi(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}function Ia(r){return r}function Qt(r,e){const o=e.type==="color",u=r.stops&&typeof r.stops[0][0]=="object",m=u||!(u||r.property!==void 0),w=r.type||(Ta(e)?"exponential":"interval");if(o||e.type==="padding"){const F=o?Zt.parse:St.parse;(r=An({},r)).stops&&(r.stops=r.stops.map(O=>[O[0],F(O[1])])),r.default=F(r.default?r.default:e.default)}if(r.colorSpace&&(k=r.colorSpace)!=="rgb"&&k!=="hcl"&&k!=="lab")throw new Error(`Unknown color space: "${r.colorSpace}"`);var k;let I,P,B;if(w==="exponential")I=Rs;else if(w==="interval")I=fi;else if(w==="categorical"){I=wi,P=Object.create(null);for(const F of r.stops)P[F[0]]=F[1];B=typeof r.stops[0][0]}else{if(w!=="identity")throw new Error(`Unknown function type "${w}"`);I=dl}if(u){const F={},O=[];for(let Y=0;Y<r.stops.length;Y++){const re=r.stops[Y],ue=re[0].zoom;F[ue]===void 0&&(F[ue]={zoom:ue,type:r.type,property:r.property,default:r.default,stops:[]},O.push(ue)),F[ue].stops.push([re[0].value,re[1]])}const q=[];for(const Y of O)q.push([F[Y].zoom,Qt(F[Y],e)]);const W={name:"linear"};return{kind:"composite",interpolationType:W,interpolationFactor:hi.interpolationFactor.bind(void 0,W),zoomStops:q.map(Y=>Y[0]),evaluate:({zoom:Y},re)=>Rs({stops:q,base:r.base},e,Y).evaluate(Y,re)}}if(m){const F=w==="exponential"?{name:"exponential",base:r.base!==void 0?r.base:1}:null;return{kind:"camera",interpolationType:F,interpolationFactor:hi.interpolationFactor.bind(void 0,F),zoomStops:r.stops.map(O=>O[0]),evaluate:({zoom:O})=>I(r,e,O,P,B)}}return{kind:"source",evaluate(F,O){const q=O&&O.properties?O.properties[r.property]:void 0;return q===void 0?Vr(r.default,e.default):I(r,e,q,P,B)}}}function Vr(r,e,o){return r!==void 0?r:e!==void 0?e:o!==void 0?o:void 0}function wi(r,e,o,u,m){return Vr(typeof o===m?u[o]:void 0,r.default,e.default)}function fi(r,e,o){if(Xt(o)!=="number")return Vr(r.default,e.default);const u=r.stops.length;if(u===1||o<=r.stops[0][0])return r.stops[0][1];if(o>=r.stops[u-1][0])return r.stops[u-1][1];const m=Ds(r.stops.map(w=>w[0]),o);return r.stops[m][1]}function Rs(r,e,o){const u=r.base!==void 0?r.base:1;if(Xt(o)!=="number")return Vr(r.default,e.default);const m=r.stops.length;if(m===1||o<=r.stops[0][0])return r.stops[0][1];if(o>=r.stops[m-1][0])return r.stops[m-1][1];const w=Ds(r.stops.map(F=>F[0]),o),k=function(F,O,q,W){const Y=W-q,re=F-q;return Y===0?0:O===1?re/Y:(Math.pow(O,re)-1)/(Math.pow(O,Y)-1)}(o,u,r.stops[w][0],r.stops[w+1][0]),I=r.stops[w][1],P=r.stops[w+1][1],B=Ni[e.type]||Ia;return typeof I.evaluate=="function"?{evaluate(...F){const O=I.evaluate.apply(void 0,F),q=P.evaluate.apply(void 0,F);if(O!==void 0&&q!==void 0)return B(O,q,k,r.colorSpace)}}:B(I,P,k,r.colorSpace)}function dl(r,e,o){switch(e.type){case"color":o=Zt.parse(o);break;case"formatted":o=Ci.fromString(o.toString());break;case"resolvedImage":o=qi.fromString(o.toString());break;case"padding":o=St.parse(o);break;default:Xt(o)===e.type||e.type==="enum"&&e.values[o]||(o=void 0)}return Vr(o,r.default,e.default)}Or.register(zs,{error:[{kind:"error"},[Vt],(r,[e])=>{throw new Ti(e.evaluate(r))}],typeof:[Vt,[Bt],(r,[e])=>ce(xi(e.evaluate(r)))],"to-rgba":[le($e,4),[Xi],(r,[e])=>{const[o,u,m,w]=e.evaluate(r).rgb;return[255*o,255*u,255*m,w]}],rgb:[Xi,[$e,$e,$e],ul],rgba:[Xi,[$e,$e,$e,$e],ul],has:{type:Mt,overloads:[[[Vt],(r,[e])=>cl(e.evaluate(r),r.properties())],[[Vt,cn],(r,[e,o])=>cl(e.evaluate(r),o.evaluate(r))]]},get:{type:Bt,overloads:[[[Vt],(r,[e])=>Sa(e.evaluate(r),r.properties())],[[Vt,cn],(r,[e,o])=>Sa(e.evaluate(r),o.evaluate(r))]]},"feature-state":[Bt,[Vt],(r,[e])=>Sa(e.evaluate(r),r.featureState||{})],properties:[cn,[],r=>r.properties()],"geometry-type":[Vt,[],r=>r.geometryType()],id:[Bt,[],r=>r.id()],zoom:[$e,[],r=>r.globals.zoom],"heatmap-density":[$e,[],r=>r.globals.heatmapDensity||0],"line-progress":[$e,[],r=>r.globals.lineProgress||0],accumulated:[Bt,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[$e,ls($e),(r,e)=>{let o=0;for(const u of e)o+=u.evaluate(r);return o}],"*":[$e,ls($e),(r,e)=>{let o=1;for(const u of e)o*=u.evaluate(r);return o}],"-":{type:$e,overloads:[[[$e,$e],(r,[e,o])=>e.evaluate(r)-o.evaluate(r)],[[$e],(r,[e])=>-e.evaluate(r)]]},"/":[$e,[$e,$e],(r,[e,o])=>e.evaluate(r)/o.evaluate(r)],"%":[$e,[$e,$e],(r,[e,o])=>e.evaluate(r)%o.evaluate(r)],ln2:[$e,[],()=>Math.LN2],pi:[$e,[],()=>Math.PI],e:[$e,[],()=>Math.E],"^":[$e,[$e,$e],(r,[e,o])=>Math.pow(e.evaluate(r),o.evaluate(r))],sqrt:[$e,[$e],(r,[e])=>Math.sqrt(e.evaluate(r))],log10:[$e,[$e],(r,[e])=>Math.log(e.evaluate(r))/Math.LN10],ln:[$e,[$e],(r,[e])=>Math.log(e.evaluate(r))],log2:[$e,[$e],(r,[e])=>Math.log(e.evaluate(r))/Math.LN2],sin:[$e,[$e],(r,[e])=>Math.sin(e.evaluate(r))],cos:[$e,[$e],(r,[e])=>Math.cos(e.evaluate(r))],tan:[$e,[$e],(r,[e])=>Math.tan(e.evaluate(r))],asin:[$e,[$e],(r,[e])=>Math.asin(e.evaluate(r))],acos:[$e,[$e],(r,[e])=>Math.acos(e.evaluate(r))],atan:[$e,[$e],(r,[e])=>Math.atan(e.evaluate(r))],min:[$e,ls($e),(r,e)=>Math.min(...e.map(o=>o.evaluate(r)))],max:[$e,ls($e),(r,e)=>Math.max(...e.map(o=>o.evaluate(r)))],abs:[$e,[$e],(r,[e])=>Math.abs(e.evaluate(r))],round:[$e,[$e],(r,[e])=>{const o=e.evaluate(r);return o<0?-Math.round(-o):Math.round(o)}],floor:[$e,[$e],(r,[e])=>Math.floor(e.evaluate(r))],ceil:[$e,[$e],(r,[e])=>Math.ceil(e.evaluate(r))],"filter-==":[Mt,[Vt,Bt],(r,[e,o])=>r.properties()[e.value]===o.value],"filter-id-==":[Mt,[Bt],(r,[e])=>r.id()===e.value],"filter-type-==":[Mt,[Vt],(r,[e])=>r.geometryType()===e.value],"filter-<":[Mt,[Vt,Bt],(r,[e,o])=>{const u=r.properties()[e.value],m=o.value;return typeof u==typeof m&&u<m}],"filter-id-<":[Mt,[Bt],(r,[e])=>{const o=r.id(),u=e.value;return typeof o==typeof u&&o<u}],"filter->":[Mt,[Vt,Bt],(r,[e,o])=>{const u=r.properties()[e.value],m=o.value;return typeof u==typeof m&&u>m}],"filter-id->":[Mt,[Bt],(r,[e])=>{const o=r.id(),u=e.value;return typeof o==typeof u&&o>u}],"filter-<=":[Mt,[Vt,Bt],(r,[e,o])=>{const u=r.properties()[e.value],m=o.value;return typeof u==typeof m&&u<=m}],"filter-id-<=":[Mt,[Bt],(r,[e])=>{const o=r.id(),u=e.value;return typeof o==typeof u&&o<=u}],"filter->=":[Mt,[Vt,Bt],(r,[e,o])=>{const u=r.properties()[e.value],m=o.value;return typeof u==typeof m&&u>=m}],"filter-id->=":[Mt,[Bt],(r,[e])=>{const o=r.id(),u=e.value;return typeof o==typeof u&&o>=u}],"filter-has":[Mt,[Bt],(r,[e])=>e.value in r.properties()],"filter-has-id":[Mt,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[Mt,[le(Vt)],(r,[e])=>e.value.indexOf(r.geometryType())>=0],"filter-id-in":[Mt,[le(Bt)],(r,[e])=>e.value.indexOf(r.id())>=0],"filter-in-small":[Mt,[Vt,le(Bt)],(r,[e,o])=>o.value.indexOf(r.properties()[e.value])>=0],"filter-in-large":[Mt,[Vt,le(Bt)],(r,[e,o])=>function(u,m,w,k){for(;w<=k;){const I=w+k>>1;if(m[I]===u)return!0;m[I]>u?k=I-1:w=I+1}return!1}(r.properties()[e.value],o.value,0,o.value.length-1)],all:{type:Mt,overloads:[[[Mt,Mt],(r,[e,o])=>e.evaluate(r)&&o.evaluate(r)],[ls(Mt),(r,e)=>{for(const o of e)if(!o.evaluate(r))return!1;return!0}]]},any:{type:Mt,overloads:[[[Mt,Mt],(r,[e,o])=>e.evaluate(r)||o.evaluate(r)],[ls(Mt),(r,e)=>{for(const o of e)if(o.evaluate(r))return!0;return!1}]]},"!":[Mt,[Mt],(r,[e])=>!e.evaluate(r)],"is-supported-script":[Mt,[Vt],(r,[e])=>{const o=r.globals&&r.globals.isSupportedScript;return!o||o(e.evaluate(r))}],upcase:[Vt,[Vt],(r,[e])=>e.evaluate(r).toUpperCase()],downcase:[Vt,[Vt],(r,[e])=>e.evaluate(r).toLowerCase()],concat:[Vt,ls(Bt),(r,e)=>e.map(o=>ti(o.evaluate(r))).join("")],"resolved-locale":[Vt,[Ve],(r,[e])=>e.evaluate(r).resolvedLocale()]});class Ko{constructor(e,o){var u;this.expression=e,this._warningHistory={},this._evaluator=new Zo,this._defaultValue=o?(u=o).type==="color"&&bi(u.default)?new Zt(0,0,0,0):u.type==="color"?Zt.parse(u.default)||null:u.type==="padding"?St.parse(u.default)||null:u.type==="variableAnchorOffsetCollection"?_t.parse(u.default)||null:u.default===void 0?null:u.default:null,this._enumValues=o&&o.type==="enum"?o.values:null}evaluateWithoutErrorHandling(e,o,u,m,w,k){return this._evaluator.globals=e,this._evaluator.feature=o,this._evaluator.featureState=u,this._evaluator.canonical=m,this._evaluator.availableImages=w||null,this._evaluator.formattedSection=k,this.expression.evaluate(this._evaluator)}evaluate(e,o,u,m,w,k){this._evaluator.globals=e,this._evaluator.feature=o||null,this._evaluator.featureState=u||null,this._evaluator.canonical=m,this._evaluator.availableImages=w||null,this._evaluator.formattedSection=k||null;try{const I=this.expression.evaluate(this._evaluator);if(I==null||typeof I=="number"&&I!=I)return this._defaultValue;if(this._enumValues&&!(I in this._enumValues))throw new Ti(`Expected value to be one of ${Object.keys(this._enumValues).map(P=>JSON.stringify(P)).join(", ")}, but found ${JSON.stringify(I)} instead.`);return I}catch(I){return this._warningHistory[I.message]||(this._warningHistory[I.message]=!0,typeof console<"u"&&console.warn(I.message)),this._defaultValue}}}function Fs(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in zs}function Os(r,e){const o=new ao(zs,Wo,[],e?function(m){const w={color:Xi,string:Vt,number:$e,enum:Vt,boolean:Mt,formatted:ae,padding:j,resolvedImage:$,variableAnchorOffsetCollection:te};return m.type==="array"?le(w[m.value]||Bt,m.length):w[m.type]}(e):void 0),u=o.parse(r,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return u?hl(new Ko(u,e)):Yr(o.errors)}class Vs{constructor(e,o){this.kind=e,this._styleExpression=o,this.isStateDependent=e!=="constant"&&!Ps(o.expression)}evaluateWithoutErrorHandling(e,o,u,m,w,k){return this._styleExpression.evaluateWithoutErrorHandling(e,o,u,m,w,k)}evaluate(e,o,u,m,w,k){return this._styleExpression.evaluate(e,o,u,m,w,k)}}class ai{constructor(e,o,u,m){this.kind=e,this.zoomStops=u,this._styleExpression=o,this.isStateDependent=e!=="camera"&&!Ps(o.expression),this.interpolationType=m}evaluateWithoutErrorHandling(e,o,u,m,w,k){return this._styleExpression.evaluateWithoutErrorHandling(e,o,u,m,w,k)}evaluate(e,o,u,m,w,k){return this._styleExpression.evaluate(e,o,u,m,w,k)}interpolationFactor(e,o,u){return this.interpolationType?hi.interpolationFactor(this.interpolationType,e,o,u):0}}function Ma(r,e){const o=Os(r,e);if(o.result==="error")return o;const u=o.value.expression,m=uo(u);if(!m&&!Ls(e))return Yr([new Ei("","data expressions not supported")]);const w=co(u,["zoom"]);if(!w&&!fl(e))return Yr([new Ei("","zoom expressions not supported")]);const k=go(u);return k||w?k instanceof Ei?Yr([k]):k instanceof hi&&!Ta(e)?Yr([new Ei("",'"interpolate" expressions cannot be used with this property')]):hl(k?new ai(m?"camera":"composite",o.value,k.labels,k instanceof hi?k.interpolation:void 0):new Vs(m?"constant":"source",o.value)):Yr([new Ei("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class mo{constructor(e,o){this._parameters=e,this._specification=o,An(this,Qt(this._parameters,this._specification))}static deserialize(e){return new mo(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function go(r){let e=null;if(r instanceof os)e=go(r.result);else if(r instanceof fo){for(const o of r.args)if(e=go(o),e)break}else(r instanceof Nn||r instanceof hi)&&r.input instanceof Or&&r.input.name==="zoom"&&(e=r);return e instanceof Ei||r.eachChild(o=>{const u=go(o);u instanceof Ei?e=u:!e&&u?e=new Ei("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&u&&e!==u&&(e=new Ei("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function _o(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const e of r.slice(1))if(!_o(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const Yl={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Ca(r){if(r==null)return{filter:()=>!0,needGeometry:!1};_o(r)||(r=Ns(r));const e=Os(r,Yl);if(e.result==="error")throw new Error(e.value.map(o=>`${o.key}: ${o.message}`).join(", "));return{filter:(o,u,m)=>e.value.evaluate(o,u,{},m),needGeometry:ur(r)}}function Kl(r,e){return r<e?-1:r>e?1:0}function ur(r){if(!Array.isArray(r))return!1;if(r[0]==="within")return!0;for(let e=1;e<r.length;e++)if(ur(r[e]))return!0;return!1}function Ns(r){if(!r)return!0;const e=r[0];return r.length<=1?e!=="any":e==="=="?kn(r[1],r[2],"=="):e==="!="?yo(kn(r[1],r[2],"==")):e==="<"||e===">"||e==="<="||e===">="?kn(r[1],r[2],e):e==="any"?(o=r.slice(1),["any"].concat(o.map(Ns))):e==="all"?["all"].concat(r.slice(1).map(Ns)):e==="none"?["all"].concat(r.slice(1).map(Ns).map(yo)):e==="in"?pl(r[1],r.slice(2)):e==="!in"?yo(pl(r[1],r.slice(2))):e==="has"?Jo(r[1]):e==="!has"?yo(Jo(r[1])):e!=="within"||r;var o}function kn(r,e,o){switch(r){case"$type":return[`filter-type-${o}`,e];case"$id":return[`filter-id-${o}`,e];default:return[`filter-${o}`,r,e]}}function pl(r,e){if(e.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(o=>typeof o!=typeof e[0])?["filter-in-large",r,["literal",e.sort(Kl)]]:["filter-in-small",r,["literal",e]]}}function Jo(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function yo(r){return["!",r]}function cr(r){const e=typeof r;if(e==="number"||e==="boolean"||e==="string"||r==null)return JSON.stringify(r);if(Array.isArray(r)){let m="[";for(const w of r)m+=`${cr(w)},`;return`${m}]`}const o=Object.keys(r).sort();let u="{";for(let m=0;m<o.length;m++)u+=`${JSON.stringify(o[m])}:${cr(r[o[m]])},`;return`${u}}`}function vo(r){let e="";for(const o of Mi)e+=`/${cr(r[o])}`;return e}function ea(r){const e=r.value;return e?[new qe(r.key,e,"constants have been deprecated as of v8")]:[]}function Ai(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function Kr(r){if(Array.isArray(r))return r.map(Kr);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const e={};for(const o in r)e[o]=Kr(r[o]);return e}return Ai(r)}function Zi(r){const e=r.key,o=r.value,u=r.valueSpec||{},m=r.objectElementValidators||{},w=r.style,k=r.styleSpec,I=r.validateSpec;let P=[];const B=Xt(o);if(B!=="object")return[new qe(e,o,`object expected, ${B} found`)];for(const F in o){const O=F.split(".")[0],q=u[O]||u["*"];let W;if(m[O])W=m[O];else if(u[O])W=I;else if(m["*"])W=m["*"];else{if(!u["*"]){P.push(new qe(e,o[F],`unknown property "${F}"`));continue}W=I}P=P.concat(W({key:(e&&`${e}.`)+F,value:o[F],valueSpec:q,style:w,styleSpec:k,object:o,objectKey:F,validateSpec:I},o))}for(const F in u)m[F]||u[F].required&&u[F].default===void 0&&o[F]===void 0&&P.push(new qe(e,o,`missing required property "${F}"`));return P}function Us(r){const e=r.value,o=r.valueSpec,u=r.style,m=r.styleSpec,w=r.key,k=r.arrayElementValidator||r.validateSpec;if(Xt(e)!=="array")return[new qe(w,e,`array expected, ${Xt(e)} found`)];if(o.length&&e.length!==o.length)return[new qe(w,e,`array length ${o.length} expected, length ${e.length} found`)];if(o["min-length"]&&e.length<o["min-length"])return[new qe(w,e,`array length at least ${o["min-length"]} expected, length ${e.length} found`)];let I={type:o.value,values:o.values};m.$version<7&&(I.function=o.function),Xt(o.value)==="object"&&(I=o.value);let P=[];for(let B=0;B<e.length;B++)P=P.concat(k({array:e,arrayIndex:B,value:e[B],valueSpec:I,validateSpec:r.validateSpec,style:u,styleSpec:m,key:`${w}[${B}]`}));return P}function Gs(r){const e=r.key,o=r.value,u=r.valueSpec;let m=Xt(o);return m==="number"&&o!=o&&(m="NaN"),m!=="number"?[new qe(e,o,`number expected, ${m} found`)]:"minimum"in u&&o<u.minimum?[new qe(e,o,`${o} is less than the minimum value ${u.minimum}`)]:"maximum"in u&&o>u.maximum?[new qe(e,o,`${o} is greater than the maximum value ${u.maximum}`)]:[]}function ta(r){const e=r.valueSpec,o=Ai(r.value.type);let u,m,w,k={};const I=o!=="categorical"&&r.value.property===void 0,P=!I,B=Xt(r.value.stops)==="array"&&Xt(r.value.stops[0])==="array"&&Xt(r.value.stops[0][0])==="object",F=Zi({key:r.key,value:r.value,valueSpec:r.styleSpec.function,validateSpec:r.validateSpec,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{stops:function(W){if(o==="identity")return[new qe(W.key,W.value,'identity function may not have a "stops" property')];let Y=[];const re=W.value;return Y=Y.concat(Us({key:W.key,value:re,valueSpec:W.valueSpec,validateSpec:W.validateSpec,style:W.style,styleSpec:W.styleSpec,arrayElementValidator:O})),Xt(re)==="array"&&re.length===0&&Y.push(new qe(W.key,re,"array must have at least one stop")),Y},default:function(W){return W.validateSpec({key:W.key,value:W.value,valueSpec:e,validateSpec:W.validateSpec,style:W.style,styleSpec:W.styleSpec})}}});return o==="identity"&&I&&F.push(new qe(r.key,r.value,'missing required property "property"')),o==="identity"||r.value.stops||F.push(new qe(r.key,r.value,'missing required property "stops"')),o==="exponential"&&r.valueSpec.expression&&!Ta(r.valueSpec)&&F.push(new qe(r.key,r.value,"exponential functions not supported")),r.styleSpec.$version>=8&&(P&&!Ls(r.valueSpec)?F.push(new qe(r.key,r.value,"property functions not supported")):I&&!fl(r.valueSpec)&&F.push(new qe(r.key,r.value,"zoom functions not supported"))),o!=="categorical"&&!B||r.value.property!==void 0||F.push(new qe(r.key,r.value,'"property" property is required')),F;function O(W){let Y=[];const re=W.value,ue=W.key;if(Xt(re)!=="array")return[new qe(ue,re,`array expected, ${Xt(re)} found`)];if(re.length!==2)return[new qe(ue,re,`array length 2 expected, length ${re.length} found`)];if(B){if(Xt(re[0])!=="object")return[new qe(ue,re,`object expected, ${Xt(re[0])} found`)];if(re[0].zoom===void 0)return[new qe(ue,re,"object stop key must have zoom")];if(re[0].value===void 0)return[new qe(ue,re,"object stop key must have value")];if(w&&w>Ai(re[0].zoom))return[new qe(ue,re[0].zoom,"stop zoom values must appear in ascending order")];Ai(re[0].zoom)!==w&&(w=Ai(re[0].zoom),m=void 0,k={}),Y=Y.concat(Zi({key:`${ue}[0]`,value:re[0],valueSpec:{zoom:{}},validateSpec:W.validateSpec,style:W.style,styleSpec:W.styleSpec,objectElementValidators:{zoom:Gs,value:q}}))}else Y=Y.concat(q({key:`${ue}[0]`,value:re[0],valueSpec:{},validateSpec:W.validateSpec,style:W.style,styleSpec:W.styleSpec},re));return Fs(Kr(re[1]))?Y.concat([new qe(`${ue}[1]`,re[1],"expressions are not allowed in function stops.")]):Y.concat(W.validateSpec({key:`${ue}[1]`,value:re[1],valueSpec:e,validateSpec:W.validateSpec,style:W.style,styleSpec:W.styleSpec}))}function q(W,Y){const re=Xt(W.value),ue=Ai(W.value),me=W.value!==null?W.value:Y;if(u){if(re!==u)return[new qe(W.key,me,`${re} stop domain type must match previous stop domain type ${u}`)]}else u=re;if(re!=="number"&&re!=="string"&&re!=="boolean")return[new qe(W.key,me,"stop domain value must be a number, string, or boolean")];if(re!=="number"&&o!=="categorical"){let ke=`number expected, ${re} found`;return Ls(e)&&o===void 0&&(ke+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new qe(W.key,me,ke)]}return o!=="categorical"||re!=="number"||isFinite(ue)&&Math.floor(ue)===ue?o!=="categorical"&&re==="number"&&m!==void 0&&ue<m?[new qe(W.key,me,"stop domain values must appear in ascending order")]:(m=ue,o==="categorical"&&ue in k?[new qe(W.key,me,"stop domain values must be unique")]:(k[ue]=!0,[])):[new qe(W.key,me,`integer expected, found ${ue}`)]}}function En(r){const e=(r.expressionContext==="property"?Ma:Os)(Kr(r.value),r.valueSpec);if(e.result==="error")return e.value.map(u=>new qe(`${r.key}${u.key}`,r.value,u.message));const o=e.value.expression||e.value._styleExpression.expression;if(r.expressionContext==="property"&&r.propertyKey==="text-font"&&!o.outputDefined())return[new qe(r.key,r.value,`Invalid data expression for "${r.propertyKey}". Output values must be contained as literals within the expression.`)];if(r.expressionContext==="property"&&r.propertyType==="layout"&&!Ps(o))return[new qe(r.key,r.value,'"feature-state" data expressions are not supported with layout properties.')];if(r.expressionContext==="filter"&&!Ps(o))return[new qe(r.key,r.value,'"feature-state" data expressions are not supported with filters.')];if(r.expressionContext&&r.expressionContext.indexOf("cluster")===0){if(!co(o,["zoom","feature-state"]))return[new qe(r.key,r.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(r.expressionContext==="cluster-initial"&&!uo(o))return[new qe(r.key,r.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function xo(r){const e=r.key,o=r.value,u=r.valueSpec,m=[];return Array.isArray(u.values)?u.values.indexOf(Ai(o))===-1&&m.push(new qe(e,o,`expected one of [${u.values.join(", ")}], ${JSON.stringify(o)} found`)):Object.keys(u.values).indexOf(Ai(o))===-1&&m.push(new qe(e,o,`expected one of [${Object.keys(u.values).join(", ")}], ${JSON.stringify(o)} found`)),m}function js(r){return _o(Kr(r.value))?En(An({},r,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Pa(r)}function Pa(r){const e=r.value,o=r.key;if(Xt(e)!=="array")return[new qe(o,e,`array expected, ${Xt(e)} found`)];const u=r.styleSpec;let m,w=[];if(e.length<1)return[new qe(o,e,"filter array must have at least 1 element")];switch(w=w.concat(xo({key:`${o}[0]`,value:e[0],valueSpec:u.filter_operator,style:r.style,styleSpec:r.styleSpec})),Ai(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&Ai(e[1])==="$type"&&w.push(new qe(o,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&w.push(new qe(o,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(m=Xt(e[1]),m!=="string"&&w.push(new qe(`${o}[1]`,e[1],`string expected, ${m} found`)));for(let k=2;k<e.length;k++)m=Xt(e[k]),Ai(e[1])==="$type"?w=w.concat(xo({key:`${o}[${k}]`,value:e[k],valueSpec:u.geometry_type,style:r.style,styleSpec:r.styleSpec})):m!=="string"&&m!=="number"&&m!=="boolean"&&w.push(new qe(`${o}[${k}]`,e[k],`string, number, or boolean expected, ${m} found`));break;case"any":case"all":case"none":for(let k=1;k<e.length;k++)w=w.concat(Pa({key:`${o}[${k}]`,value:e[k],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":m=Xt(e[1]),e.length!==2?w.push(new qe(o,e,`filter array for "${e[0]}" operator must have 2 elements`)):m!=="string"&&w.push(new qe(`${o}[1]`,e[1],`string expected, ${m} found`));break;case"within":m=Xt(e[1]),e.length!==2?w.push(new qe(o,e,`filter array for "${e[0]}" operator must have 2 elements`)):m!=="object"&&w.push(new qe(`${o}[1]`,e[1],`object expected, ${m} found`))}return w}function Da(r,e){const o=r.key,u=r.validateSpec,m=r.style,w=r.styleSpec,k=r.value,I=r.objectKey,P=w[`${e}_${r.layerType}`];if(!P)return[];const B=I.match(/^(.*)-transition$/);if(e==="paint"&&B&&P[B[1]]&&P[B[1]].transition)return u({key:o,value:k,valueSpec:w.transition,style:m,styleSpec:w});const F=r.valueSpec||P[I];if(!F)return[new qe(o,k,`unknown property "${I}"`)];let O;if(Xt(k)==="string"&&Ls(F)&&!F.tokens&&(O=/^{([^}]+)}$/.exec(k)))return[new qe(o,k,`"${I}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(O[1])} }\`.`)];const q=[];return r.layerType==="symbol"&&(I==="text-field"&&m&&!m.glyphs&&q.push(new qe(o,k,'use of "text-field" requires a style "glyphs" property')),I==="text-font"&&bi(Kr(k))&&Ai(k.type)==="identity"&&q.push(new qe(o,k,'"text-font" does not support identity functions'))),q.concat(u({key:r.key,value:k,valueSpec:F,style:m,styleSpec:w,expressionContext:"property",propertyType:e,propertyKey:I}))}function qs(r){return Da(r,"paint")}function As(r){return Da(r,"layout")}function ml(r){let e=[];const o=r.value,u=r.key,m=r.style,w=r.styleSpec;o.type||o.ref||e.push(new qe(u,o,'either "type" or "ref" is required'));let k=Ai(o.type);const I=Ai(o.ref);if(o.id){const P=Ai(o.id);for(let B=0;B<r.arrayIndex;B++){const F=m.layers[B];Ai(F.id)===P&&e.push(new qe(u,o.id,`duplicate layer id "${o.id}", previously used at line ${F.id.__line__}`))}}if("ref"in o){let P;["type","source","source-layer","filter","layout"].forEach(B=>{B in o&&e.push(new qe(u,o[B],`"${B}" is prohibited for ref layers`))}),m.layers.forEach(B=>{Ai(B.id)===I&&(P=B)}),P?P.ref?e.push(new qe(u,o.ref,"ref cannot reference another ref layer")):k=Ai(P.type):e.push(new qe(u,o.ref,`ref layer "${I}" not found`))}else if(k!=="background")if(o.source){const P=m.sources&&m.sources[o.source],B=P&&Ai(P.type);P?B==="vector"&&k==="raster"?e.push(new qe(u,o.source,`layer "${o.id}" requires a raster source`)):B!=="raster-dem"&&k==="hillshade"?e.push(new qe(u,o.source,`layer "${o.id}" requires a raster-dem source`)):B==="raster"&&k!=="raster"?e.push(new qe(u,o.source,`layer "${o.id}" requires a vector source`)):B!=="vector"||o["source-layer"]?B==="raster-dem"&&k!=="hillshade"?e.push(new qe(u,o.source,"raster-dem source can only be used with layer type 'hillshade'.")):k!=="line"||!o.paint||!o.paint["line-gradient"]||B==="geojson"&&P.lineMetrics||e.push(new qe(u,o,`layer "${o.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new qe(u,o,`layer "${o.id}" must specify a "source-layer"`)):e.push(new qe(u,o.source,`source "${o.source}" not found`))}else e.push(new qe(u,o,'missing required property "source"'));return e=e.concat(Zi({key:u,value:o,valueSpec:w.layer,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,objectElementValidators:{"*":()=>[],type:()=>r.validateSpec({key:`${u}.type`,value:o.type,valueSpec:w.layer.type,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,object:o,objectKey:"type"}),filter:js,layout:P=>Zi({layer:o,key:P.key,value:P.value,style:P.style,styleSpec:P.styleSpec,validateSpec:P.validateSpec,objectElementValidators:{"*":B=>As(An({layerType:k},B))}}),paint:P=>Zi({layer:o,key:P.key,value:P.value,style:P.style,styleSpec:P.styleSpec,validateSpec:P.validateSpec,objectElementValidators:{"*":B=>qs(An({layerType:k},B))}})}})),e}function gr(r){const e=r.value,o=r.key,u=Xt(e);return u!=="string"?[new qe(o,e,`string expected, ${u} found`)]:[]}const bo={promoteId:function({key:r,value:e}){if(Xt(e)==="string")return gr({key:r,value:e});{const o=[];for(const u in e)o.push(...gr({key:`${r}.${u}`,value:e[u]}));return o}}};function Er(r){const e=r.value,o=r.key,u=r.styleSpec,m=r.style,w=r.validateSpec;if(!e.type)return[new qe(o,e,'"type" is required')];const k=Ai(e.type);let I;switch(k){case"vector":case"raster":return I=Zi({key:o,value:e,valueSpec:u[`source_${k.replace("-","_")}`],style:r.style,styleSpec:u,objectElementValidators:bo,validateSpec:w}),I;case"raster-dem":return I=function(P){var B;const F=(B=P.sourceName)!==null&&B!==void 0?B:"",O=P.value,q=P.styleSpec,W=q.source_raster_dem,Y=P.style;let re=[];const ue=Xt(O);if(O===void 0)return re;if(ue!=="object")return re.push(new qe("source_raster_dem",O,`object expected, ${ue} found`)),re;const me=Ai(O.encoding)==="custom",ke=["redFactor","greenFactor","blueFactor","baseShift"],ye=P.value.encoding?`"${P.value.encoding}"`:"Default";for(const Se in O)!me&&ke.includes(Se)?re.push(new qe(Se,O[Se],`In "${F}": "${Se}" is only valid when "encoding" is set to "custom". ${ye} encoding found`)):W[Se]?re=re.concat(P.validateSpec({key:Se,value:O[Se],valueSpec:W[Se],validateSpec:P.validateSpec,style:Y,styleSpec:q})):re.push(new qe(Se,O[Se],`unknown property "${Se}"`));return re}({sourceName:o,value:e,style:r.style,styleSpec:u,validateSpec:w}),I;case"geojson":if(I=Zi({key:o,value:e,valueSpec:u.source_geojson,style:m,styleSpec:u,validateSpec:w,objectElementValidators:bo}),e.cluster)for(const P in e.clusterProperties){const[B,F]=e.clusterProperties[P],O=typeof B=="string"?[B,["accumulated"],["get",P]]:B;I.push(...En({key:`${o}.${P}.map`,value:F,validateSpec:w,expressionContext:"cluster-map"})),I.push(...En({key:`${o}.${P}.reduce`,value:O,validateSpec:w,expressionContext:"cluster-reduce"}))}return I;case"video":return Zi({key:o,value:e,valueSpec:u.source_video,style:m,validateSpec:w,styleSpec:u});case"image":return Zi({key:o,value:e,valueSpec:u.source_image,style:m,validateSpec:w,styleSpec:u});case"canvas":return[new qe(o,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return xo({key:`${o}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:m,validateSpec:w,styleSpec:u})}}function wo(r){const e=r.value,o=r.styleSpec,u=o.light,m=r.style;let w=[];const k=Xt(e);if(e===void 0)return w;if(k!=="object")return w=w.concat([new qe("light",e,`object expected, ${k} found`)]),w;for(const I in e){const P=I.match(/^(.*)-transition$/);w=w.concat(P&&u[P[1]]&&u[P[1]].transition?r.validateSpec({key:I,value:e[I],valueSpec:o.transition,validateSpec:r.validateSpec,style:m,styleSpec:o}):u[I]?r.validateSpec({key:I,value:e[I],valueSpec:u[I],validateSpec:r.validateSpec,style:m,styleSpec:o}):[new qe(I,e[I],`unknown property "${I}"`)])}return w}function gl(r){const e=r.value,o=r.styleSpec,u=o.terrain,m=r.style;let w=[];const k=Xt(e);if(e===void 0)return w;if(k!=="object")return w=w.concat([new qe("terrain",e,`object expected, ${k} found`)]),w;for(const I in e)w=w.concat(u[I]?r.validateSpec({key:I,value:e[I],valueSpec:u[I],validateSpec:r.validateSpec,style:m,styleSpec:o}):[new qe(I,e[I],`unknown property "${I}"`)]);return w}function _l(r){let e=[];const o=r.value,u=r.key;if(Array.isArray(o)){const m=[],w=[];for(const k in o)o[k].id&&m.includes(o[k].id)&&e.push(new qe(u,o,`all the sprites' ids must be unique, but ${o[k].id} is duplicated`)),m.push(o[k].id),o[k].url&&w.includes(o[k].url)&&e.push(new qe(u,o,`all the sprites' URLs must be unique, but ${o[k].url} is duplicated`)),w.push(o[k].url),e=e.concat(Zi({key:`${u}[${k}]`,value:o[k],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:r.validateSpec}));return e}return gr({key:u,value:o})}const yl={"*":()=>[],array:Us,boolean:function(r){const e=r.value,o=r.key,u=Xt(e);return u!=="boolean"?[new qe(o,e,`boolean expected, ${u} found`)]:[]},number:Gs,color:function(r){const e=r.key,o=r.value,u=Xt(o);return u!=="string"?[new qe(e,o,`color expected, ${u} found`)]:Zt.parse(String(o))?[]:[new qe(e,o,`color expected, "${o}" found`)]},constants:ea,enum:xo,filter:js,function:ta,layer:ml,object:Zi,source:Er,light:wo,terrain:gl,string:gr,formatted:function(r){return gr(r).length===0?[]:En(r)},resolvedImage:function(r){return gr(r).length===0?[]:En(r)},padding:function(r){const e=r.key,o=r.value;if(Xt(o)==="array"){if(o.length<1||o.length>4)return[new qe(e,o,`padding requires 1 to 4 values; ${o.length} values found`)];const u={type:"number"};let m=[];for(let w=0;w<o.length;w++)m=m.concat(r.validateSpec({key:`${e}[${w}]`,value:o[w],validateSpec:r.validateSpec,valueSpec:u}));return m}return Gs({key:e,value:o,valueSpec:{}})},variableAnchorOffsetCollection:function(r){const e=r.key,o=r.value,u=Xt(o),m=r.styleSpec;if(u!=="array"||o.length<1||o.length%2!=0)return[new qe(e,o,"variableAnchorOffsetCollection requires a non-empty array of even length")];let w=[];for(let k=0;k<o.length;k+=2)w=w.concat(xo({key:`${e}[${k}]`,value:o[k],valueSpec:m.layout_symbol["text-anchor"]})),w=w.concat(Us({key:`${e}[${k+1}]`,value:o[k+1],valueSpec:{length:2,value:"number"},validateSpec:r.validateSpec,style:r.style,styleSpec:m}));return w},sprite:_l};function Sn(r){const e=r.value,o=r.valueSpec,u=r.styleSpec;return r.validateSpec=Sn,o.expression&&bi(Ai(e))?ta(r):o.expression&&Fs(Kr(e))?En(r):o.type&&yl[o.type]?yl[o.type](r):Zi(An({},r,{valueSpec:o.type?u[o.type]:o}))}function ia(r){const e=r.value,o=r.key,u=gr(r);return u.length||(e.indexOf("{fontstack}")===-1&&u.push(new qe(o,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&u.push(new qe(o,e,'"glyphs" url must include a "{range}" token'))),u}function Sr(r,e=ze){let o=[];return o=o.concat(Sn({key:"",value:r,valueSpec:e.$root,styleSpec:e,style:r,validateSpec:Sn,objectElementValidators:{glyphs:ia,"*":()=>[]}})),r.constants&&(o=o.concat(ea({key:"constants",value:r.constants,style:r,styleSpec:e,validateSpec:Sn}))),ra(o)}function Jr(r){return function(e){return r({...e,validateSpec:Sn})}}function ra(r){return[].concat(r).sort((e,o)=>e.line-o.line)}function Tn(r){return function(...e){return ra(r.apply(this,e))}}Sr.source=Tn(Jr(Er)),Sr.sprite=Tn(Jr(_l)),Sr.glyphs=Tn(Jr(ia)),Sr.light=Tn(Jr(wo)),Sr.terrain=Tn(Jr(gl)),Sr.layer=Tn(Jr(ml)),Sr.filter=Tn(Jr(js)),Sr.paintProperty=Tn(Jr(qs)),Sr.layoutProperty=Tn(Jr(As));const In=Sr,Jl=In.light,Ba=In.paintProperty,vl=In.layoutProperty;function na(r,e){let o=!1;if(e&&e.length)for(const u of e)r.fire(new Lr(new Error(u.message))),o=!0;return o}class us{constructor(e,o,u){const m=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const k=new Int32Array(this.arrayBuffer);e=k[0],this.d=(o=k[1])+2*(u=k[2]);for(let P=0;P<this.d*this.d;P++){const B=k[3+P],F=k[3+P+1];m.push(B===F?null:k.subarray(B,F))}const I=k[3+m.length+1];this.keys=k.subarray(k[3+m.length],I),this.bboxes=k.subarray(I),this.insert=this._insertReadonly}else{this.d=o+2*u;for(let k=0;k<this.d*this.d;k++)m.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=e,this.padding=u,this.scale=o/e,this.uid=0;const w=u/o*e;this.min=-w,this.max=e+w}insert(e,o,u,m,w){this._forEachCell(o,u,m,w,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(m),this.bboxes.push(w)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,o,u,m,w,k){this.cells[w].push(k)}query(e,o,u,m,w){const k=this.min,I=this.max;if(e<=k&&o<=k&&I<=u&&I<=m&&!w)return Array.prototype.slice.call(this.keys);{const P=[];return this._forEachCell(e,o,u,m,this._queryCell,P,{},w),P}}_queryCell(e,o,u,m,w,k,I,P){const B=this.cells[w];if(B!==null){const F=this.keys,O=this.bboxes;for(let q=0;q<B.length;q++){const W=B[q];if(I[W]===void 0){const Y=4*W;(P?P(O[Y+0],O[Y+1],O[Y+2],O[Y+3]):e<=O[Y+2]&&o<=O[Y+3]&&u>=O[Y+0]&&m>=O[Y+1])?(I[W]=!0,k.push(F[W])):I[W]=!1}}}}_forEachCell(e,o,u,m,w,k,I,P){const B=this._convertToCellCoord(e),F=this._convertToCellCoord(o),O=this._convertToCellCoord(u),q=this._convertToCellCoord(m);for(let W=B;W<=O;W++)for(let Y=F;Y<=q;Y++){const re=this.d*Y+W;if((!P||P(this._convertFromCellCoord(W),this._convertFromCellCoord(Y),this._convertFromCellCoord(W+1),this._convertFromCellCoord(Y+1)))&&w.call(this,e,o,u,m,re,k,I,P))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,o=3+this.cells.length+1+1;let u=0;for(let k=0;k<this.cells.length;k++)u+=this.cells[k].length;const m=new Int32Array(o+u+this.keys.length+this.bboxes.length);m[0]=this.extent,m[1]=this.n,m[2]=this.padding;let w=o;for(let k=0;k<e.length;k++){const I=e[k];m[3+k]=w,m.set(I,w),w+=I.length}return m[3+e.length]=w,m.set(this.keys,w),w+=this.keys.length,m[3+e.length+1]=w,m.set(this.bboxes,w),w+=this.bboxes.length,m.buffer}static serialize(e,o){const u=e.toArrayBuffer();return o&&o.push(u),{buffer:u}}static deserialize(e){return new us(e.buffer)}}const Mn={};function st(r,e,o={}){if(Mn[r])throw new Error(`${r} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:r,writeable:!1}),Mn[r]={klass:e,omit:o.omit||[],shallow:o.shallow||[]}}st("Object",Object),st("TransferableGridIndex",us),st("Color",Zt),st("Error",Error),st("AJAXError",Dt),st("ResolvedImage",qi),st("StylePropertyFunction",mo),st("StyleExpression",Ko,{omit:["_evaluator"]}),st("ZoomDependentExpression",ai),st("ZoomConstantExpression",Vs),st("CompoundExpression",Or,{omit:["_evaluate"]});for(const r in zs)zs[r]._classRegistryKey||st(`Expression_${r}`,zs[r]);function Nr(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function Cn(r,e){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||r instanceof Blob)return r;if(Nr(r)||Fi(r))return e&&e.push(r),r;if(ArrayBuffer.isView(r)){const o=r;return e&&e.push(o.buffer),o}if(r instanceof ImageData)return e&&e.push(r.data.buffer),r;if(Array.isArray(r)){const o=[];for(const u of r)o.push(Cn(u,e));return o}if(typeof r=="object"){const o=r.constructor,u=o._classRegistryKey;if(!u)throw new Error("can't serialize object of unregistered class");if(!Mn[u])throw new Error(`${u} is not registered.`);const m=o.serialize?o.serialize(r,e):{};if(o.serialize){if(e&&m===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const w in r){if(!r.hasOwnProperty(w)||Mn[u].omit.indexOf(w)>=0)continue;const k=r[w];m[w]=Mn[u].shallow.indexOf(w)>=0?k:Cn(k,e)}r instanceof Error&&(m.message=r.message)}if(m.$name)throw new Error("$name property is reserved for worker serialization logic.");return u!=="Object"&&(m.$name=u),m}throw new Error("can't serialize object of type "+typeof r)}function Zs(r){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||r instanceof Blob||Nr(r)||Fi(r)||ArrayBuffer.isView(r)||r instanceof ImageData)return r;if(Array.isArray(r))return r.map(Zs);if(typeof r=="object"){const e=r.$name||"Object";if(!Mn[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:o}=Mn[e];if(!o)throw new Error(`can't deserialize unregistered class ${e}`);if(o.deserialize)return o.deserialize(r);const u=Object.create(o.prototype);for(const m of Object.keys(r)){if(m==="$name")continue;const w=r[m];u[m]=Mn[e].shallow.indexOf(m)>=0?w:Zs(w)}return u}throw new Error("can't deserialize object of type "+typeof r)}class xl{constructor(){this.first=!0}update(e,o){const u=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=u,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=u,!0):(this.lastFloorZoom>u?(this.lastIntegerZoom=u+1,this.lastIntegerZoomTime=o):this.lastFloorZoom<u&&(this.lastIntegerZoom=u,this.lastIntegerZoomTime=o),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=u,!0))}}const Je={"Latin-1 Supplement":r=>r>=128&&r<=255,Arabic:r=>r>=1536&&r<=1791,"Arabic Supplement":r=>r>=1872&&r<=1919,"Arabic Extended-A":r=>r>=2208&&r<=2303,"Hangul Jamo":r=>r>=4352&&r<=4607,"Unified Canadian Aboriginal Syllabics":r=>r>=5120&&r<=5759,Khmer:r=>r>=6016&&r<=6143,"Unified Canadian Aboriginal Syllabics Extended":r=>r>=6320&&r<=6399,"General Punctuation":r=>r>=8192&&r<=8303,"Letterlike Symbols":r=>r>=8448&&r<=8527,"Number Forms":r=>r>=8528&&r<=8591,"Miscellaneous Technical":r=>r>=8960&&r<=9215,"Control Pictures":r=>r>=9216&&r<=9279,"Optical Character Recognition":r=>r>=9280&&r<=9311,"Enclosed Alphanumerics":r=>r>=9312&&r<=9471,"Geometric Shapes":r=>r>=9632&&r<=9727,"Miscellaneous Symbols":r=>r>=9728&&r<=9983,"Miscellaneous Symbols and Arrows":r=>r>=11008&&r<=11263,"CJK Radicals Supplement":r=>r>=11904&&r<=12031,"Kangxi Radicals":r=>r>=12032&&r<=12255,"Ideographic Description Characters":r=>r>=12272&&r<=12287,"CJK Symbols and Punctuation":r=>r>=12288&&r<=12351,Hiragana:r=>r>=12352&&r<=12447,Katakana:r=>r>=12448&&r<=12543,Bopomofo:r=>r>=12544&&r<=12591,"Hangul Compatibility Jamo":r=>r>=12592&&r<=12687,Kanbun:r=>r>=12688&&r<=12703,"Bopomofo Extended":r=>r>=12704&&r<=12735,"CJK Strokes":r=>r>=12736&&r<=12783,"Katakana Phonetic Extensions":r=>r>=12784&&r<=12799,"Enclosed CJK Letters and Months":r=>r>=12800&&r<=13055,"CJK Compatibility":r=>r>=13056&&r<=13311,"CJK Unified Ideographs Extension A":r=>r>=13312&&r<=19903,"Yijing Hexagram Symbols":r=>r>=19904&&r<=19967,"CJK Unified Ideographs":r=>r>=19968&&r<=40959,"Yi Syllables":r=>r>=40960&&r<=42127,"Yi Radicals":r=>r>=42128&&r<=42191,"Hangul Jamo Extended-A":r=>r>=43360&&r<=43391,"Hangul Syllables":r=>r>=44032&&r<=55215,"Hangul Jamo Extended-B":r=>r>=55216&&r<=55295,"Private Use Area":r=>r>=57344&&r<=63743,"CJK Compatibility Ideographs":r=>r>=63744&&r<=64255,"Arabic Presentation Forms-A":r=>r>=64336&&r<=65023,"Vertical Forms":r=>r>=65040&&r<=65055,"CJK Compatibility Forms":r=>r>=65072&&r<=65103,"Small Form Variants":r=>r>=65104&&r<=65135,"Arabic Presentation Forms-B":r=>r>=65136&&r<=65279,"Halfwidth and Fullwidth Forms":r=>r>=65280&&r<=65519};function za(r){for(const e of r)if(sa(e.charCodeAt(0)))return!0;return!1}function La(r){for(const e of r)if(!Gn(e.charCodeAt(0)))return!1;return!0}function Gn(r){return!(Je.Arabic(r)||Je["Arabic Supplement"](r)||Je["Arabic Extended-A"](r)||Je["Arabic Presentation Forms-A"](r)||Je["Arabic Presentation Forms-B"](r))}function sa(r){return!(r!==746&&r!==747&&(r<4352||!(Je["Bopomofo Extended"](r)||Je.Bopomofo(r)||Je["CJK Compatibility Forms"](r)&&!(r>=65097&&r<=65103)||Je["CJK Compatibility Ideographs"](r)||Je["CJK Compatibility"](r)||Je["CJK Radicals Supplement"](r)||Je["CJK Strokes"](r)||!(!Je["CJK Symbols and Punctuation"](r)||r>=12296&&r<=12305||r>=12308&&r<=12319||r===12336)||Je["CJK Unified Ideographs Extension A"](r)||Je["CJK Unified Ideographs"](r)||Je["Enclosed CJK Letters and Months"](r)||Je["Hangul Compatibility Jamo"](r)||Je["Hangul Jamo Extended-A"](r)||Je["Hangul Jamo Extended-B"](r)||Je["Hangul Jamo"](r)||Je["Hangul Syllables"](r)||Je.Hiragana(r)||Je["Ideographic Description Characters"](r)||Je.Kanbun(r)||Je["Kangxi Radicals"](r)||Je["Katakana Phonetic Extensions"](r)||Je.Katakana(r)&&r!==12540||!(!Je["Halfwidth and Fullwidth Forms"](r)||r===65288||r===65289||r===65293||r>=65306&&r<=65310||r===65339||r===65341||r===65343||r>=65371&&r<=65503||r===65507||r>=65512&&r<=65519)||!(!Je["Small Form Variants"](r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||Je["Unified Canadian Aboriginal Syllabics"](r)||Je["Unified Canadian Aboriginal Syllabics Extended"](r)||Je["Vertical Forms"](r)||Je["Yijing Hexagram Symbols"](r)||Je["Yi Syllables"](r)||Je["Yi Radicals"](r))))}function Ra(r){return!(sa(r)||function(e){return!!(Je["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Je["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Je["Letterlike Symbols"](e)||Je["Number Forms"](e)||Je["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Je["Control Pictures"](e)&&e!==9251||Je["Optical Character Recognition"](e)||Je["Enclosed Alphanumerics"](e)||Je["Geometric Shapes"](e)||Je["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Je["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Je["CJK Symbols and Punctuation"](e)||Je.Katakana(e)||Je["Private Use Area"](e)||Je["CJK Compatibility Forms"](e)||Je["Small Form Variants"](e)||Je["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(r))}function bl(r){return r>=1424&&r<=2303||Je["Arabic Presentation Forms-A"](r)||Je["Arabic Presentation Forms-B"](r)}function wl(r,e){return!(!e&&bl(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||Je.Khmer(r))}function eA(r){for(const e of r)if(bl(e.charCodeAt(0)))return!0;return!1}const Fa="deferred",Oa="loading",Va="loaded";let Na=null,_r="unavailable",jn=null;const ko=function(r){r&&typeof r=="string"&&r.indexOf("NetworkError")>-1&&(_r="error"),Na&&Na(r)};function Ua(){Qs.fire(new pr("pluginStateChange",{pluginStatus:_r,pluginURL:jn}))}const Qs=new ts,oa=function(){return _r},Pi=function(){if(_r!==Fa||!jn)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");_r=Oa,Ua(),jn&&no({url:jn},r=>{r?ko(r):(_r=Va,Ua())})},Tr={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>_r===Va||Tr.applyArabicShaping!=null,isLoading:()=>_r===Oa,setState(r){if(!vi())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");_r=r.pluginStatus,jn=r.pluginURL},isParsed(){if(!vi())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return Tr.applyArabicShaping!=null&&Tr.processBidirectionalText!=null&&Tr.processStyledBidirectionalText!=null},getPluginURL(){if(!vi())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return jn}};class yi{constructor(e,o){this.zoom=e,o?(this.now=o.now,this.fadeDuration=o.fadeDuration,this.zoomHistory=o.zoomHistory,this.transition=o.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new xl,this.transition={})}isSupportedScript(e){return function(o,u){for(const m of o)if(!wl(m.charCodeAt(0),u))return!1;return!0}(e,Tr.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,o=e-Math.floor(e),u=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:o+(1-o)*u}:{fromScale:.5,toScale:1,t:1-(1-u)*o}}}class qn{constructor(e,o){this.property=e,this.value=o,this.expression=function(u,m){if(bi(u))return new mo(u,m);if(Fs(u)){const w=Ma(u,m);if(w.result==="error")throw new Error(w.value.map(k=>`${k.key}: ${k.message}`).join(", "));return w.value}{let w=u;return m.type==="color"&&typeof u=="string"?w=Zt.parse(u):m.type!=="padding"||typeof u!="number"&&!Array.isArray(u)?m.type==="variableAnchorOffsetCollection"&&Array.isArray(u)&&(w=_t.parse(u)):w=St.parse(u),{kind:"constant",evaluate:()=>w}}}(o===void 0?e.specification.default:o,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,o,u){return this.property.possiblyEvaluate(this,e,o,u)}}class yr{constructor(e){this.property=e,this.value=new qn(e,void 0)}transitioned(e,o){return new El(this.property,this.value,o,It({},e.transition,this.transition),e.now)}untransitioned(){return new El(this.property,this.value,null,{},0)}}class kl{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return Gt(this._values[e].value.value)}setValue(e,o){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new yr(this._values[e].property)),this._values[e].value=new qn(this._values[e].property,o===null?void 0:Gt(o))}getTransition(e){return Gt(this._values[e].transition)}setTransition(e,o){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new yr(this._values[e].property)),this._values[e].transition=Gt(o)||void 0}serialize(){const e={};for(const o of Object.keys(this._values)){const u=this.getValue(o);u!==void 0&&(e[o]=u);const m=this.getTransition(o);m!==void 0&&(e[`${o}-transition`]=m)}return e}transitioned(e,o){const u=new Sl(this._properties);for(const m of Object.keys(this._values))u._values[m]=this._values[m].transitioned(e,o._values[m]);return u}untransitioned(){const e=new Sl(this._properties);for(const o of Object.keys(this._values))e._values[o]=this._values[o].untransitioned();return e}}class El{constructor(e,o,u,m,w){this.property=e,this.value=o,this.begin=w+m.delay||0,this.end=this.begin+m.duration||0,e.specification.transition&&(m.delay||m.duration)&&(this.prior=u)}possiblyEvaluate(e,o,u){const m=e.now||0,w=this.value.possiblyEvaluate(e,o,u),k=this.prior;if(k){if(m>this.end)return this.prior=null,w;if(this.value.isDataDriven())return this.prior=null,w;if(m<this.begin)return k.possiblyEvaluate(e,o,u);{const I=(m-this.begin)/(this.end-this.begin);return this.property.interpolate(k.possiblyEvaluate(e,o,u),w,function(P){if(P<=0)return 0;if(P>=1)return 1;const B=P*P,F=B*P;return 4*(P<.5?F:3*(P-B)+F-.75)}(I))}}return w}}class Sl{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,o,u){const m=new Eo(this._properties);for(const w of Object.keys(this._values))m._values[w]=this._values[w].possiblyEvaluate(e,o,u);return m}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Tl{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}hasValue(e){return this._values[e].value!==void 0}getValue(e){return Gt(this._values[e].value)}setValue(e,o){this._values[e]=new qn(this._values[e].property,o===null?void 0:Gt(o))}serialize(){const e={};for(const o of Object.keys(this._values)){const u=this.getValue(o);u!==void 0&&(e[o]=u)}return e}possiblyEvaluate(e,o,u){const m=new Eo(this._properties);for(const w of Object.keys(this._values))m._values[w]=this._values[w].possiblyEvaluate(e,o,u);return m}}class or{constructor(e,o,u){this.property=e,this.value=o,this.parameters=u}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,o,u,m){return this.property.evaluate(this.value,this.parameters,e,o,u,m)}}class Eo{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class ht{constructor(e){this.specification=e}possiblyEvaluate(e,o){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(o)}interpolate(e,o,u){const m=Ni[this.specification.type];return m?m(e,o,u):e}}class wt{constructor(e,o){this.specification=e,this.overrides=o}possiblyEvaluate(e,o,u,m){return new or(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(o,null,{},u,m)}:e.expression,o)}interpolate(e,o,u){if(e.value.kind!=="constant"||o.value.kind!=="constant")return e;if(e.value.value===void 0||o.value.value===void 0)return new or(this,{kind:"constant",value:void 0},e.parameters);const m=Ni[this.specification.type];if(m){const w=m(e.value.value,o.value.value,u);return new or(this,{kind:"constant",value:w},e.parameters)}return e}evaluate(e,o,u,m,w,k){return e.kind==="constant"?e.value:e.evaluate(o,u,m,w,k)}}class So extends wt{possiblyEvaluate(e,o,u,m){if(e.value===void 0)return new or(this,{kind:"constant",value:void 0},o);if(e.expression.kind==="constant"){const w=e.expression.evaluate(o,null,{},u,m),k=e.property.specification.type==="resolvedImage"&&typeof w!="string"?w.name:w,I=this._calculate(k,k,k,o);return new or(this,{kind:"constant",value:I},o)}if(e.expression.kind==="camera"){const w=this._calculate(e.expression.evaluate({zoom:o.zoom-1}),e.expression.evaluate({zoom:o.zoom}),e.expression.evaluate({zoom:o.zoom+1}),o);return new or(this,{kind:"constant",value:w},o)}return new or(this,e.expression,o)}evaluate(e,o,u,m,w,k){if(e.kind==="source"){const I=e.evaluate(o,u,m,w,k);return this._calculate(I,I,I,o)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(o.zoom)-1},u,m),e.evaluate({zoom:Math.floor(o.zoom)},u,m),e.evaluate({zoom:Math.floor(o.zoom)+1},u,m),o):e.value}_calculate(e,o,u,m){return m.zoom>m.zoomHistory.lastIntegerZoom?{from:e,to:o}:{from:u,to:o}}interpolate(e){return e}}class Ga{constructor(e){this.specification=e}possiblyEvaluate(e,o,u,m){if(e.value!==void 0){if(e.expression.kind==="constant"){const w=e.expression.evaluate(o,null,{},u,m);return this._calculate(w,w,w,o)}return this._calculate(e.expression.evaluate(new yi(Math.floor(o.zoom-1),o)),e.expression.evaluate(new yi(Math.floor(o.zoom),o)),e.expression.evaluate(new yi(Math.floor(o.zoom+1),o)),o)}}_calculate(e,o,u,m){return m.zoom>m.zoomHistory.lastIntegerZoom?{from:e,to:o}:{from:u,to:o}}interpolate(e){return e}}class ja{constructor(e){this.specification=e}possiblyEvaluate(e,o,u,m){return!!e.expression.evaluate(o,null,{},u,m)}interpolate(){return!1}}class Di{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const o in e){const u=e[o];u.specification.overridable&&this.overridableProperties.push(o);const m=this.defaultPropertyValues[o]=new qn(u,void 0),w=this.defaultTransitionablePropertyValues[o]=new yr(u);this.defaultTransitioningPropertyValues[o]=w.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=m.possiblyEvaluate({})}}}st("DataDrivenProperty",wt),st("DataConstantProperty",ht),st("CrossFadedDataDrivenProperty",So),st("CrossFadedProperty",Ga),st("ColorRampProperty",ja);const fn="-transition";class Bi extends ts{constructor(e,o){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),o.layout&&(this._unevaluatedLayout=new Tl(o.layout)),o.paint)){this._transitionablePaint=new kl(o.paint);for(const u in e.paint)this.setPaintProperty(u,e.paint[u],{validate:!1});for(const u in e.layout)this.setLayoutProperty(u,e.layout[u],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Eo(o.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,o,u={}){o!=null&&this._validate(vl,`layers.${this.id}.layout.${e}`,e,o,u)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,o):this.visibility=o)}getPaintProperty(e){return e.endsWith(fn)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,o,u={}){if(o!=null&&this._validate(Ba,`layers.${this.id}.paint.${e}`,e,o,u))return!1;if(e.endsWith(fn))return this._transitionablePaint.setTransition(e.slice(0,-11),o||void 0),!1;{const m=this._transitionablePaint._values[e],w=m.property.specification["property-type"]==="cross-faded-data-driven",k=m.value.isDataDriven(),I=m.value;this._transitionablePaint.setValue(e,o),this._handleSpecialPaintPropertyUpdate(e);const P=this._transitionablePaint._values[e].value;return P.isDataDriven()||k||w||this._handleOverridablePaintPropertyUpdate(e,I,P)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,o,u){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,o){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,o)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,o)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),kt(e,(o,u)=>!(o===void 0||u==="layout"&&!Object.keys(o).length||u==="paint"&&!Object.keys(o).length))}_validate(e,o,u,m,w={}){return(!w||w.validate!==!1)&&na(this,e.call(In,{key:o,layerType:this.type,objectKey:u,value:m,styleSpec:ze,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const o=this.paint.get(e);if(o instanceof or&&Ls(o.property.specification)&&(o.value.kind==="source"||o.value.kind==="composite")&&o.value.isStateDependent)return!0}return!1}}const Ct={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ar{constructor(e,o){this._structArray=e,this._pos1=o*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class yt{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,o){return e._trim(),o&&(e.isTransferred=!0,o.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const o=Object.create(this.prototype);return o.arrayBuffer=e.arrayBuffer,o.length=e.length,o.capacity=e.arrayBuffer.byteLength/o.bytesPerElement,o._refreshViews(),o}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const o=this.uint8;this._refreshViews(),o&&this.uint8.set(o)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function $t(r,e=1){let o=0,u=0;return{members:r.map(m=>{const w=Ct[m.type].BYTES_PER_ELEMENT,k=o=cs(o,Math.max(e,w)),I=m.components||1;return u=Math.max(u,w),o+=w*I,{name:m.name,type:m.type,components:I,offset:k}}),size:cs(o,Math.max(u,e)),alignment:e}}function cs(r,e){return Math.ceil(r/e)*e}class hs extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,o)}emplace(e,o,u){const m=2*e;return this.int16[m+0]=o,this.int16[m+1]=u,e}}hs.prototype.bytesPerElement=4,st("StructArrayLayout2i4",hs);class en extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,o,u){const m=this.length;return this.resize(m+1),this.emplace(m,e,o,u)}emplace(e,o,u,m){const w=3*e;return this.int16[w+0]=o,this.int16[w+1]=u,this.int16[w+2]=m,e}}en.prototype.bytesPerElement=6,st("StructArrayLayout3i6",en);class fs extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,o,u,m){const w=this.length;return this.resize(w+1),this.emplace(w,e,o,u,m)}emplace(e,o,u,m,w){const k=4*e;return this.int16[k+0]=o,this.int16[k+1]=u,this.int16[k+2]=m,this.int16[k+3]=w,e}}fs.prototype.bytesPerElement=8,st("StructArrayLayout4i8",fs);class Qi extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,o,u,m,w,k){const I=this.length;return this.resize(I+1),this.emplace(I,e,o,u,m,w,k)}emplace(e,o,u,m,w,k,I){const P=6*e;return this.int16[P+0]=o,this.int16[P+1]=u,this.int16[P+2]=m,this.int16[P+3]=w,this.int16[P+4]=k,this.int16[P+5]=I,e}}Qi.prototype.bytesPerElement=12,st("StructArrayLayout2i4i12",Qi);class $s extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,o,u,m,w,k){const I=this.length;return this.resize(I+1),this.emplace(I,e,o,u,m,w,k)}emplace(e,o,u,m,w,k,I){const P=4*e,B=8*e;return this.int16[P+0]=o,this.int16[P+1]=u,this.uint8[B+4]=m,this.uint8[B+5]=w,this.uint8[B+6]=k,this.uint8[B+7]=I,e}}$s.prototype.bytesPerElement=8,st("StructArrayLayout2i4ub8",$s);class tn extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,o)}emplace(e,o,u){const m=2*e;return this.float32[m+0]=o,this.float32[m+1]=u,e}}tn.prototype.bytesPerElement=8,st("StructArrayLayout2f8",tn);class aa extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,o,u,m,w,k,I,P,B,F){const O=this.length;return this.resize(O+1),this.emplace(O,e,o,u,m,w,k,I,P,B,F)}emplace(e,o,u,m,w,k,I,P,B,F,O){const q=10*e;return this.uint16[q+0]=o,this.uint16[q+1]=u,this.uint16[q+2]=m,this.uint16[q+3]=w,this.uint16[q+4]=k,this.uint16[q+5]=I,this.uint16[q+6]=P,this.uint16[q+7]=B,this.uint16[q+8]=F,this.uint16[q+9]=O,e}}aa.prototype.bytesPerElement=20,st("StructArrayLayout10ui20",aa);class Ge extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,o,u,m,w,k,I,P,B,F,O,q){const W=this.length;return this.resize(W+1),this.emplace(W,e,o,u,m,w,k,I,P,B,F,O,q)}emplace(e,o,u,m,w,k,I,P,B,F,O,q,W){const Y=12*e;return this.int16[Y+0]=o,this.int16[Y+1]=u,this.int16[Y+2]=m,this.int16[Y+3]=w,this.uint16[Y+4]=k,this.uint16[Y+5]=I,this.uint16[Y+6]=P,this.uint16[Y+7]=B,this.int16[Y+8]=F,this.int16[Y+9]=O,this.int16[Y+10]=q,this.int16[Y+11]=W,e}}Ge.prototype.bytesPerElement=24,st("StructArrayLayout4i4ui4i24",Ge);class Oe extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,u){const m=this.length;return this.resize(m+1),this.emplace(m,e,o,u)}emplace(e,o,u,m){const w=3*e;return this.float32[w+0]=o,this.float32[w+1]=u,this.float32[w+2]=m,e}}Oe.prototype.bytesPerElement=12,st("StructArrayLayout3f12",Oe);class v extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const o=this.length;return this.resize(o+1),this.emplace(o,e)}emplace(e,o){return this.uint32[1*e+0]=o,e}}v.prototype.bytesPerElement=4,st("StructArrayLayout1ul4",v);class t extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,o,u,m,w,k,I,P,B){const F=this.length;return this.resize(F+1),this.emplace(F,e,o,u,m,w,k,I,P,B)}emplace(e,o,u,m,w,k,I,P,B,F){const O=10*e,q=5*e;return this.int16[O+0]=o,this.int16[O+1]=u,this.int16[O+2]=m,this.int16[O+3]=w,this.int16[O+4]=k,this.int16[O+5]=I,this.uint32[q+3]=P,this.uint16[O+8]=B,this.uint16[O+9]=F,e}}t.prototype.bytesPerElement=20,st("StructArrayLayout6i1ul2ui20",t);class a extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,o,u,m,w,k){const I=this.length;return this.resize(I+1),this.emplace(I,e,o,u,m,w,k)}emplace(e,o,u,m,w,k,I){const P=6*e;return this.int16[P+0]=o,this.int16[P+1]=u,this.int16[P+2]=m,this.int16[P+3]=w,this.int16[P+4]=k,this.int16[P+5]=I,e}}a.prototype.bytesPerElement=12,st("StructArrayLayout2i2i2i12",a);class d extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,o,u,m,w){const k=this.length;return this.resize(k+1),this.emplace(k,e,o,u,m,w)}emplace(e,o,u,m,w,k){const I=4*e,P=8*e;return this.float32[I+0]=o,this.float32[I+1]=u,this.float32[I+2]=m,this.int16[P+6]=w,this.int16[P+7]=k,e}}d.prototype.bytesPerElement=16,st("StructArrayLayout2f1f2i16",d);class g extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,u,m){const w=this.length;return this.resize(w+1),this.emplace(w,e,o,u,m)}emplace(e,o,u,m,w){const k=12*e,I=3*e;return this.uint8[k+0]=o,this.uint8[k+1]=u,this.float32[I+1]=m,this.float32[I+2]=w,e}}g.prototype.bytesPerElement=12,st("StructArrayLayout2ub2f12",g);class b extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,o,u){const m=this.length;return this.resize(m+1),this.emplace(m,e,o,u)}emplace(e,o,u,m){const w=3*e;return this.uint16[w+0]=o,this.uint16[w+1]=u,this.uint16[w+2]=m,e}}b.prototype.bytesPerElement=6,st("StructArrayLayout3ui6",b);class M extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,u,m,w,k,I,P,B,F,O,q,W,Y,re,ue,me){const ke=this.length;return this.resize(ke+1),this.emplace(ke,e,o,u,m,w,k,I,P,B,F,O,q,W,Y,re,ue,me)}emplace(e,o,u,m,w,k,I,P,B,F,O,q,W,Y,re,ue,me,ke){const ye=24*e,Se=12*e,Ie=48*e;return this.int16[ye+0]=o,this.int16[ye+1]=u,this.uint16[ye+2]=m,this.uint16[ye+3]=w,this.uint32[Se+2]=k,this.uint32[Se+3]=I,this.uint32[Se+4]=P,this.uint16[ye+10]=B,this.uint16[ye+11]=F,this.uint16[ye+12]=O,this.float32[Se+7]=q,this.float32[Se+8]=W,this.uint8[Ie+36]=Y,this.uint8[Ie+37]=re,this.uint8[Ie+38]=ue,this.uint32[Se+10]=me,this.int16[ye+22]=ke,e}}M.prototype.bytesPerElement=48,st("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",M);class i extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,u,m,w,k,I,P,B,F,O,q,W,Y,re,ue,me,ke,ye,Se,Ie,Re,it,ct,tt,Xe,Qe,lt){const He=this.length;return this.resize(He+1),this.emplace(He,e,o,u,m,w,k,I,P,B,F,O,q,W,Y,re,ue,me,ke,ye,Se,Ie,Re,it,ct,tt,Xe,Qe,lt)}emplace(e,o,u,m,w,k,I,P,B,F,O,q,W,Y,re,ue,me,ke,ye,Se,Ie,Re,it,ct,tt,Xe,Qe,lt,He){const Ne=32*e,bt=16*e;return this.int16[Ne+0]=o,this.int16[Ne+1]=u,this.int16[Ne+2]=m,this.int16[Ne+3]=w,this.int16[Ne+4]=k,this.int16[Ne+5]=I,this.int16[Ne+6]=P,this.int16[Ne+7]=B,this.uint16[Ne+8]=F,this.uint16[Ne+9]=O,this.uint16[Ne+10]=q,this.uint16[Ne+11]=W,this.uint16[Ne+12]=Y,this.uint16[Ne+13]=re,this.uint16[Ne+14]=ue,this.uint16[Ne+15]=me,this.uint16[Ne+16]=ke,this.uint16[Ne+17]=ye,this.uint16[Ne+18]=Se,this.uint16[Ne+19]=Ie,this.uint16[Ne+20]=Re,this.uint16[Ne+21]=it,this.uint16[Ne+22]=ct,this.uint32[bt+12]=tt,this.float32[bt+13]=Xe,this.float32[bt+14]=Qe,this.uint16[Ne+30]=lt,this.uint16[Ne+31]=He,e}}i.prototype.bytesPerElement=64,st("StructArrayLayout8i15ui1ul2f2ui64",i);class n extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const o=this.length;return this.resize(o+1),this.emplace(o,e)}emplace(e,o){return this.float32[1*e+0]=o,e}}n.prototype.bytesPerElement=4,st("StructArrayLayout1f4",n);class s extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,u){const m=this.length;return this.resize(m+1),this.emplace(m,e,o,u)}emplace(e,o,u,m){const w=3*e;return this.uint16[6*e+0]=o,this.float32[w+1]=u,this.float32[w+2]=m,e}}s.prototype.bytesPerElement=12,st("StructArrayLayout1ui2f12",s);class l extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,o,u){const m=this.length;return this.resize(m+1),this.emplace(m,e,o,u)}emplace(e,o,u,m){const w=4*e;return this.uint32[2*e+0]=o,this.uint16[w+2]=u,this.uint16[w+3]=m,e}}l.prototype.bytesPerElement=8,st("StructArrayLayout1ul2ui8",l);class c extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,o)}emplace(e,o,u){const m=2*e;return this.uint16[m+0]=o,this.uint16[m+1]=u,e}}c.prototype.bytesPerElement=4,st("StructArrayLayout2ui4",c);class f extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const o=this.length;return this.resize(o+1),this.emplace(o,e)}emplace(e,o){return this.uint16[1*e+0]=o,e}}f.prototype.bytesPerElement=2,st("StructArrayLayout1ui2",f);class y extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,u,m){const w=this.length;return this.resize(w+1),this.emplace(w,e,o,u,m)}emplace(e,o,u,m,w){const k=4*e;return this.float32[k+0]=o,this.float32[k+1]=u,this.float32[k+2]=m,this.float32[k+3]=w,e}}y.prototype.bytesPerElement=16,st("StructArrayLayout4f16",y);class x extends ar{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new K(this.anchorPointX,this.anchorPointY)}}x.prototype.size=20;class S extends t{get(e){return new x(this,e)}}st("CollisionBoxArray",S);class C extends ar{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}C.prototype.size=48;class z extends M{get(e){return new C(this,e)}}st("PlacedSymbolArray",z);class G extends ar{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}G.prototype.size=64;class N extends i{get(e){return new G(this,e)}}st("SymbolInstanceArray",N);class Z extends n{getoffsetX(e){return this.float32[1*e+0]}}st("GlyphOffsetArray",Z);class Q extends en{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}st("SymbolLineVertexArray",Q);class ee extends ar{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}ee.prototype.size=12;class he extends s{get(e){return new ee(this,e)}}st("TextAnchorOffsetArray",he);class ge extends ar{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}ge.prototype.size=8;class oe extends l{get(e){return new ge(this,e)}}st("FeatureIndexArray",oe);class fe extends hs{}class pe extends hs{}class Fe extends hs{}class Me extends Qi{}class Pe extends $s{}class Ce extends tn{}class vt extends aa{}class at extends Ge{}class rt extends Oe{}class et extends v{}class ft extends a{}class ut extends g{}class Rt extends b{}class dt extends c{}const Pt=$t([{name:"a_pos",components:2,type:"Int16"}],4),{members:di}=Pt;class pi{constructor(e=[]){this.segments=e}prepareSegment(e,o,u,m){let w=this.segments[this.segments.length-1];return e>pi.MAX_VERTEX_ARRAY_LENGTH&&si(`Max vertices per segment is ${pi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!w||w.vertexLength+e>pi.MAX_VERTEX_ARRAY_LENGTH||w.sortKey!==m)&&(w={vertexOffset:o.length,primitiveOffset:u.length,vertexLength:0,primitiveLength:0},m!==void 0&&(w.sortKey=m),this.segments.push(w)),w}get(){return this.segments}destroy(){for(const e of this.segments)for(const o in e.vaos)e.vaos[o].destroy()}static simpleSegment(e,o,u,m){return new pi([{vertexOffset:e,primitiveOffset:o,vertexLength:u,primitiveLength:m,vaos:{},sortKey:0}])}}function Zn(r,e){return 256*(r=Tt(Math.floor(r),0,255))+Tt(Math.floor(e),0,255)}pi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,st("SegmentVector",pi);const Qn=$t([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Hs={exports:{}},To={exports:{}};To.exports=function(r,e){var o,u,m,w,k,I,P,B;for(u=r.length-(o=3&r.length),m=e,k=3432918353,I=461845907,B=0;B<u;)P=255&r.charCodeAt(B)|(255&r.charCodeAt(++B))<<8|(255&r.charCodeAt(++B))<<16|(255&r.charCodeAt(++B))<<24,++B,m=27492+(65535&(w=5*(65535&(m=(m^=P=(65535&(P=(P=(65535&P)*k+(((P>>>16)*k&65535)<<16)&4294967295)<<15|P>>>17))*I+(((P>>>16)*I&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+((58964+(w>>>16)&65535)<<16);switch(P=0,o){case 3:P^=(255&r.charCodeAt(B+2))<<16;case 2:P^=(255&r.charCodeAt(B+1))<<8;case 1:m^=P=(65535&(P=(P=(65535&(P^=255&r.charCodeAt(B)))*k+(((P>>>16)*k&65535)<<16)&4294967295)<<15|P>>>17))*I+(((P>>>16)*I&65535)<<16)&4294967295}return m^=r.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0};var la=To.exports,vr={exports:{}};vr.exports=function(r,e){for(var o,u=r.length,m=e^u,w=0;u>=4;)o=1540483477*(65535&(o=255&r.charCodeAt(w)|(255&r.charCodeAt(++w))<<8|(255&r.charCodeAt(++w))<<16|(255&r.charCodeAt(++w))<<24))+((1540483477*(o>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(o=1540483477*(65535&(o^=o>>>24))+((1540483477*(o>>>16)&65535)<<16)),u-=4,++w;switch(u){case 3:m^=(255&r.charCodeAt(w+2))<<16;case 2:m^=(255&r.charCodeAt(w+1))<<8;case 1:m=1540483477*(65535&(m^=255&r.charCodeAt(w)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0};var hr=la,Ir=vr.exports;Hs.exports=hr,Hs.exports.murmur3=hr,Hs.exports.murmur2=Ir;var Io=R(Hs.exports);class Li{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,o,u,m){this.ids.push(Ki(e)),this.positions.push(o,u,m)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const o=Ki(e);let u=0,m=this.ids.length-1;for(;u<m;){const k=u+m>>1;this.ids[k]>=o?m=k:u=k+1}const w=[];for(;this.ids[u]===o;)w.push({index:this.positions[3*u],start:this.positions[3*u+1],end:this.positions[3*u+2]}),u++;return w}static serialize(e,o){const u=new Float64Array(e.ids),m=new Uint32Array(e.positions);return Ur(u,m,0,u.length-1),o&&o.push(u.buffer,m.buffer),{ids:u,positions:m}}static deserialize(e){const o=new Li;return o.ids=e.ids,o.positions=e.positions,o.indexed=!0,o}}function Ki(r){const e=+r;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:Io(String(r))}function Ur(r,e,o,u){for(;o<u;){const m=r[o+u>>1];let w=o-1,k=u+1;for(;;){do w++;while(r[w]<m);do k--;while(r[k]>m);if(w>=k)break;Ri(r,w,k),Ri(e,3*w,3*k),Ri(e,3*w+1,3*k+1),Ri(e,3*w+2,3*k+2)}k-o<u-k?(Ur(r,e,o,k),o=k+1):(Ur(r,e,k+1,u),u=k)}}function Ri(r,e,o){const u=r[e];r[e]=r[o],r[o]=u}st("FeaturePositionMap",Li);class Mo{constructor(e,o){this.gl=e.gl,this.location=o}}class Il extends Mo{constructor(e,o){super(e,o),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class RA extends Mo{constructor(e,o){super(e,o),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class FA extends Mo{constructor(e,o){super(e,o),this.current=Zt.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const qu=new Float32Array(16);function tA(r){return[Zn(255*r.r,255*r.g),Zn(255*r.b,255*r.a)]}class $n{constructor(e,o,u){this.value=e,this.uniformNames=o.map(m=>`u_${m}`),this.type=u}setUniform(e,o,u){e.set(u.constantOr(this.value))}getBinding(e,o,u){return this.type==="color"?new FA(e,o):new Il(e,o)}}class Co{constructor(e,o){this.uniformNames=o.map(u=>`u_${u}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,o){this.pixelRatioFrom=o.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=o.tlbr,this.patternTo=e.tlbr}setUniform(e,o,u,m){const w=m==="u_pattern_to"?this.patternTo:m==="u_pattern_from"?this.patternFrom:m==="u_pixel_ratio_to"?this.pixelRatioTo:m==="u_pixel_ratio_from"?this.pixelRatioFrom:null;w&&e.set(w)}getBinding(e,o,u){return u.substr(0,9)==="u_pattern"?new RA(e,o):new Il(e,o)}}class Hn{constructor(e,o,u,m){this.expression=e,this.type=u,this.maxValue=0,this.paintVertexAttributes=o.map(w=>({name:`a_${w}`,type:"Float32",components:u==="color"?2:1,offset:0})),this.paintVertexArray=new m}populatePaintArray(e,o,u,m,w){const k=this.paintVertexArray.length,I=this.expression.evaluate(new yi(0),o,{},m,[],w);this.paintVertexArray.resize(e),this._setPaintValue(k,e,I)}updatePaintArray(e,o,u,m){const w=this.expression.evaluate({zoom:0},u,m);this._setPaintValue(e,o,w)}_setPaintValue(e,o,u){if(this.type==="color"){const m=tA(u);for(let w=e;w<o;w++)this.paintVertexArray.emplace(w,m[0],m[1])}else{for(let m=e;m<o;m++)this.paintVertexArray.emplace(m,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class dn{constructor(e,o,u,m,w,k){this.expression=e,this.uniformNames=o.map(I=>`u_${I}_t`),this.type=u,this.useIntegerZoom=m,this.zoom=w,this.maxValue=0,this.paintVertexAttributes=o.map(I=>({name:`a_${I}`,type:"Float32",components:u==="color"?4:2,offset:0})),this.paintVertexArray=new k}populatePaintArray(e,o,u,m,w){const k=this.expression.evaluate(new yi(this.zoom),o,{},m,[],w),I=this.expression.evaluate(new yi(this.zoom+1),o,{},m,[],w),P=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(P,e,k,I)}updatePaintArray(e,o,u,m){const w=this.expression.evaluate({zoom:this.zoom},u,m),k=this.expression.evaluate({zoom:this.zoom+1},u,m);this._setPaintValue(e,o,w,k)}_setPaintValue(e,o,u,m){if(this.type==="color"){const w=tA(u),k=tA(m);for(let I=e;I<o;I++)this.paintVertexArray.emplace(I,w[0],w[1],k[0],k[1])}else{for(let w=e;w<o;w++)this.paintVertexArray.emplace(w,u,m);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(m))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,o){const u=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,m=Tt(this.expression.interpolationFactor(u,this.zoom,this.zoom+1),0,1);e.set(m)}getBinding(e,o,u){return new Il(e,o)}}class Wn{constructor(e,o,u,m,w,k){this.expression=e,this.type=o,this.useIntegerZoom=u,this.zoom=m,this.layerId=k,this.zoomInPaintVertexArray=new w,this.zoomOutPaintVertexArray=new w}populatePaintArray(e,o,u){const m=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(m,e,o.patterns&&o.patterns[this.layerId],u)}updatePaintArray(e,o,u,m,w){this._setPaintValues(e,o,u.patterns&&u.patterns[this.layerId],w)}_setPaintValues(e,o,u,m){if(!m||!u)return;const{min:w,mid:k,max:I}=u,P=m[w],B=m[k],F=m[I];if(P&&B&&F)for(let O=e;O<o;O++)this.zoomInPaintVertexArray.emplace(O,B.tl[0],B.tl[1],B.br[0],B.br[1],P.tl[0],P.tl[1],P.br[0],P.br[1],B.pixelRatio,P.pixelRatio),this.zoomOutPaintVertexArray.emplace(O,B.tl[0],B.tl[1],B.br[0],B.br[1],F.tl[0],F.tl[1],F.br[0],F.br[1],B.pixelRatio,F.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,Qn.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,Qn.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class iA{constructor(e,o,u){this.binders={},this._buffers=[];const m=[];for(const w in e.paint._values){if(!u(w))continue;const k=e.paint.get(w);if(!(k instanceof or&&Ls(k.property.specification)))continue;const I=zp(w,e.type),P=k.value,B=k.property.specification.type,F=k.property.useIntegerZoom,O=k.property.specification["property-type"],q=O==="cross-faded"||O==="cross-faded-data-driven";if(P.kind==="constant")this.binders[w]=q?new Co(P.value,I):new $n(P.value,I,B),m.push(`/u_${w}`);else if(P.kind==="source"||q){const W=Nh(w,B,"source");this.binders[w]=q?new Wn(P,B,F,o,W,e.id):new Hn(P,I,B,W),m.push(`/a_${w}`)}else{const W=Nh(w,B,"composite");this.binders[w]=new dn(P,I,B,F,o,W),m.push(`/z_${w}`)}}this.cacheKey=m.sort().join("")}getMaxValue(e){const o=this.binders[e];return o instanceof Hn||o instanceof dn?o.maxValue:0}populatePaintArrays(e,o,u,m,w){for(const k in this.binders){const I=this.binders[k];(I instanceof Hn||I instanceof dn||I instanceof Wn)&&I.populatePaintArray(e,o,u,m,w)}}setConstantPatternPositions(e,o){for(const u in this.binders){const m=this.binders[u];m instanceof Co&&m.setConstantPatternPositions(e,o)}}updatePaintArrays(e,o,u,m,w){let k=!1;for(const I in e){const P=o.getPositions(I);for(const B of P){const F=u.feature(B.index);for(const O in this.binders){const q=this.binders[O];if((q instanceof Hn||q instanceof dn||q instanceof Wn)&&q.expression.isStateDependent===!0){const W=m.paint.get(O);q.expression=W.value,q.updatePaintArray(B.start,B.end,F,e[I],w),k=!0}}}}return k}defines(){const e=[];for(const o in this.binders){const u=this.binders[o];(u instanceof $n||u instanceof Co)&&e.push(...u.uniformNames.map(m=>`#define HAS_UNIFORM_${m}`))}return e}getBinderAttributes(){const e=[];for(const o in this.binders){const u=this.binders[o];if(u instanceof Hn||u instanceof dn)for(let m=0;m<u.paintVertexAttributes.length;m++)e.push(u.paintVertexAttributes[m].name);else if(u instanceof Wn)for(let m=0;m<Qn.members.length;m++)e.push(Qn.members[m].name)}return e}getBinderUniforms(){const e=[];for(const o in this.binders){const u=this.binders[o];if(u instanceof $n||u instanceof Co||u instanceof dn)for(const m of u.uniformNames)e.push(m)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,o){const u=[];for(const m in this.binders){const w=this.binders[m];if(w instanceof $n||w instanceof Co||w instanceof dn){for(const k of w.uniformNames)if(o[k]){const I=w.getBinding(e,o[k],k);u.push({name:k,property:m,binding:I})}}}return u}setUniforms(e,o,u,m){for(const{name:w,property:k,binding:I}of o)this.binders[k].setUniform(I,m,u.get(k),w)}updatePaintBuffers(e){this._buffers=[];for(const o in this.binders){const u=this.binders[o];if(e&&u instanceof Wn){const m=e.fromScale===2?u.zoomInPaintVertexBuffer:u.zoomOutPaintVertexBuffer;m&&this._buffers.push(m)}else(u instanceof Hn||u instanceof dn)&&u.paintVertexBuffer&&this._buffers.push(u.paintVertexBuffer)}}upload(e){for(const o in this.binders){const u=this.binders[o];(u instanceof Hn||u instanceof dn||u instanceof Wn)&&u.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const o=this.binders[e];(o instanceof Hn||o instanceof dn||o instanceof Wn)&&o.destroy()}}}class ds{constructor(e,o,u=()=>!0){this.programConfigurations={};for(const m of e)this.programConfigurations[m.id]=new iA(m,o,u);this.needsUpload=!1,this._featureMap=new Li,this._bufferOffset=0}populatePaintArrays(e,o,u,m,w,k){for(const I in this.programConfigurations)this.programConfigurations[I].populatePaintArrays(e,o,m,w,k);o.id!==void 0&&this._featureMap.add(o.id,u,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,o,u,m){for(const w of u)this.needsUpload=this.programConfigurations[w.id].updatePaintArrays(e,this._featureMap,o,w,m)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const o in this.programConfigurations)this.programConfigurations[o].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function zp(r,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[r]||[r.replace(`${e}-`,"").replace(/-/g,"_")]}function Nh(r,e,o){const u={color:{source:tn,composite:y},number:{source:n,composite:tn}},m=function(w){return{"line-pattern":{source:vt,composite:vt},"fill-pattern":{source:vt,composite:vt},"fill-extrusion-pattern":{source:vt,composite:vt}}[w]}(r);return m&&m[o]||u[e][o]}st("ConstantBinder",$n),st("CrossFadedConstantBinder",Co),st("SourceExpressionBinder",Hn),st("CrossFadedCompositeBinder",Wn),st("CompositeExpressionBinder",dn),st("ProgramConfiguration",iA,{omit:["_buffers"]}),st("ProgramConfigurationSet",ds);const $i=8192,Zu=Math.pow(2,14)-1,Uh=-Zu-1;function qa(r){const e=$i/r.extent,o=r.loadGeometry();for(let u=0;u<o.length;u++){const m=o[u];for(let w=0;w<m.length;w++){const k=m[w],I=Math.round(k.x*e),P=Math.round(k.y*e);k.x=Tt(I,Uh,Zu),k.y=Tt(P,Uh,Zu),(I<k.x||I>k.x+1||P<k.y||P>k.y+1)&&si("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return o}function Za(r,e){return{type:r.type,id:r.id,properties:r.properties,geometry:e?qa(r):[]}}function OA(r,e,o,u,m){r.emplaceBack(2*e+(u+1)/2,2*o+(m+1)/2)}class Qu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(o=>o.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new pe,this.indexArray=new Rt,this.segments=new pi,this.programConfigurations=new ds(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(e,o,u){const m=this.layers[0],w=[];let k=null,I=!1;m.type==="circle"&&(k=m.layout.get("circle-sort-key"),I=!k.isConstant());for(const{feature:P,id:B,index:F,sourceLayerIndex:O}of e){const q=this.layers[0]._featureFilter.needGeometry,W=Za(P,q);if(!this.layers[0]._featureFilter.filter(new yi(this.zoom),W,u))continue;const Y=I?k.evaluate(W,{},u):void 0,re={id:B,properties:P.properties,type:P.type,sourceLayerIndex:O,index:F,geometry:q?W.geometry:qa(P),patterns:{},sortKey:Y};w.push(re)}I&&w.sort((P,B)=>P.sortKey-B.sortKey);for(const P of w){const{geometry:B,index:F,sourceLayerIndex:O}=P,q=e[F].feature;this.addFeature(P,B,F,u),o.featureIndex.insert(q,B,F,O,this.index)}}update(e,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,o,this.stateDependentLayers,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,di),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,o,u,m){for(const w of o)for(const k of w){const I=k.x,P=k.y;if(I<0||I>=$i||P<0||P>=$i)continue;const B=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),F=B.vertexLength;OA(this.layoutVertexArray,I,P,-1,-1),OA(this.layoutVertexArray,I,P,1,-1),OA(this.layoutVertexArray,I,P,1,1),OA(this.layoutVertexArray,I,P,-1,1),this.indexArray.emplaceBack(F,F+1,F+2),this.indexArray.emplaceBack(F,F+3,F+2),B.vertexLength+=4,B.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,u,{},m)}}function Gh(r,e){for(let o=0;o<r.length;o++)if(Ml(e,r[o]))return!0;for(let o=0;o<e.length;o++)if(Ml(r,e[o]))return!0;return!!$u(r,e)}function Lp(r,e,o){return!!Ml(r,e)||!!Hu(e,r,o)}function jh(r,e){if(r.length===1)return Zh(e,r[0]);for(let o=0;o<e.length;o++){const u=e[o];for(let m=0;m<u.length;m++)if(Ml(r,u[m]))return!0}for(let o=0;o<r.length;o++)if(Zh(e,r[o]))return!0;for(let o=0;o<e.length;o++)if($u(r,e[o]))return!0;return!1}function Rp(r,e,o){if(r.length>1){if($u(r,e))return!0;for(let u=0;u<e.length;u++)if(Hu(e[u],r,o))return!0}for(let u=0;u<r.length;u++)if(Hu(r[u],e,o))return!0;return!1}function $u(r,e){if(r.length===0||e.length===0)return!1;for(let o=0;o<r.length-1;o++){const u=r[o],m=r[o+1];for(let w=0;w<e.length-1;w++)if(Fp(u,m,e[w],e[w+1]))return!0}return!1}function Fp(r,e,o,u){return ui(r,o,u)!==ui(e,o,u)&&ui(r,e,o)!==ui(r,e,u)}function Hu(r,e,o){const u=o*o;if(e.length===1)return r.distSqr(e[0])<u;for(let m=1;m<e.length;m++)if(qh(r,e[m-1],e[m])<u)return!0;return!1}function qh(r,e,o){const u=e.distSqr(o);if(u===0)return r.distSqr(e);const m=((r.x-e.x)*(o.x-e.x)+(r.y-e.y)*(o.y-e.y))/u;return r.distSqr(m<0?e:m>1?o:o.sub(e)._mult(m)._add(e))}function Zh(r,e){let o,u,m,w=!1;for(let k=0;k<r.length;k++){o=r[k];for(let I=0,P=o.length-1;I<o.length;P=I++)u=o[I],m=o[P],u.y>e.y!=m.y>e.y&&e.x<(m.x-u.x)*(e.y-u.y)/(m.y-u.y)+u.x&&(w=!w)}return w}function Ml(r,e){let o=!1;for(let u=0,m=r.length-1;u<r.length;m=u++){const w=r[u],k=r[m];w.y>e.y!=k.y>e.y&&e.x<(k.x-w.x)*(e.y-w.y)/(k.y-w.y)+w.x&&(o=!o)}return o}function Op(r,e,o){const u=o[0],m=o[2];if(r.x<u.x&&e.x<u.x||r.x>m.x&&e.x>m.x||r.y<u.y&&e.y<u.y||r.y>m.y&&e.y>m.y)return!1;const w=ui(r,e,o[0]);return w!==ui(r,e,o[1])||w!==ui(r,e,o[2])||w!==ui(r,e,o[3])}function rA(r,e,o){const u=e.paint.get(r).value;return u.kind==="constant"?u.value:o.programConfigurations.get(e.id).getMaxValue(r)}function VA(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function NA(r,e,o,u,m){if(!e[0]&&!e[1])return r;const w=K.convert(e)._mult(m);o==="viewport"&&w._rotate(-u);const k=[];for(let I=0;I<r.length;I++)k.push(r[I].sub(w));return k}let Qh,$h;st("CircleBucket",Qu,{omit:["layers"]});var Vp={get paint(){return $h=$h||new Di({"circle-radius":new wt(ze.paint_circle["circle-radius"]),"circle-color":new wt(ze.paint_circle["circle-color"]),"circle-blur":new wt(ze.paint_circle["circle-blur"]),"circle-opacity":new wt(ze.paint_circle["circle-opacity"]),"circle-translate":new ht(ze.paint_circle["circle-translate"]),"circle-translate-anchor":new ht(ze.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ht(ze.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ht(ze.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new wt(ze.paint_circle["circle-stroke-width"]),"circle-stroke-color":new wt(ze.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new wt(ze.paint_circle["circle-stroke-opacity"])})},get layout(){return Qh=Qh||new Di({"circle-sort-key":new wt(ze.layout_circle["circle-sort-key"])})}},Gr=1e-6,Cl=typeof Float32Array<"u"?Float32Array:Array;function Wu(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Hh(r,e,o){var u=e[0],m=e[1],w=e[2],k=e[3],I=e[4],P=e[5],B=e[6],F=e[7],O=e[8],q=e[9],W=e[10],Y=e[11],re=e[12],ue=e[13],me=e[14],ke=e[15],ye=o[0],Se=o[1],Ie=o[2],Re=o[3];return r[0]=ye*u+Se*I+Ie*O+Re*re,r[1]=ye*m+Se*P+Ie*q+Re*ue,r[2]=ye*w+Se*B+Ie*W+Re*me,r[3]=ye*k+Se*F+Ie*Y+Re*ke,r[4]=(ye=o[4])*u+(Se=o[5])*I+(Ie=o[6])*O+(Re=o[7])*re,r[5]=ye*m+Se*P+Ie*q+Re*ue,r[6]=ye*w+Se*B+Ie*W+Re*me,r[7]=ye*k+Se*F+Ie*Y+Re*ke,r[8]=(ye=o[8])*u+(Se=o[9])*I+(Ie=o[10])*O+(Re=o[11])*re,r[9]=ye*m+Se*P+Ie*q+Re*ue,r[10]=ye*w+Se*B+Ie*W+Re*me,r[11]=ye*k+Se*F+Ie*Y+Re*ke,r[12]=(ye=o[12])*u+(Se=o[13])*I+(Ie=o[14])*O+(Re=o[15])*re,r[13]=ye*m+Se*P+Ie*q+Re*ue,r[14]=ye*w+Se*B+Ie*W+Re*me,r[15]=ye*k+Se*F+Ie*Y+Re*ke,r}Math.hypot||(Math.hypot=function(){for(var r=0,e=arguments.length;e--;)r+=arguments[e]*arguments[e];return Math.sqrt(r)});var nA,Np=Hh;function UA(r,e,o){var u=e[0],m=e[1],w=e[2],k=e[3];return r[0]=o[0]*u+o[4]*m+o[8]*w+o[12]*k,r[1]=o[1]*u+o[5]*m+o[9]*w+o[13]*k,r[2]=o[2]*u+o[6]*m+o[10]*w+o[14]*k,r[3]=o[3]*u+o[7]*m+o[11]*w+o[15]*k,r}nA=new Cl(4),Cl!=Float32Array&&(nA[0]=0,nA[1]=0,nA[2]=0,nA[3]=0);class Up extends Bi{constructor(e){super(e,Vp)}createBucket(e){return new Qu(e)}queryRadius(e){const o=e;return rA("circle-radius",this,o)+rA("circle-stroke-width",this,o)+VA(this.paint.get("circle-translate"))}queryIntersectsFeature(e,o,u,m,w,k,I,P){const B=NA(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),k.angle,I),F=this.paint.get("circle-radius").evaluate(o,u)+this.paint.get("circle-stroke-width").evaluate(o,u),O=this.paint.get("circle-pitch-alignment")==="map",q=O?B:function(Y,re){return Y.map(ue=>Wh(ue,re))}(B,P),W=O?F*I:F;for(const Y of m)for(const re of Y){const ue=O?re:Wh(re,P);let me=W;const ke=UA([],[re.x,re.y,0,1],P);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?me*=ke[3]/k.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(me*=k.cameraToCenterDistance/ke[3]),Lp(q,ue,me))return!0}return!1}}function Wh(r,e){const o=UA([],[r.x,r.y,0,1],e);return new K(o[0]/o[3],o[1]/o[3])}class Xh extends Qu{}let Yh;st("HeatmapBucket",Xh,{omit:["layers"]});var Gp={get paint(){return Yh=Yh||new Di({"heatmap-radius":new wt(ze.paint_heatmap["heatmap-radius"]),"heatmap-weight":new wt(ze.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ht(ze.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ja(ze.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ht(ze.paint_heatmap["heatmap-opacity"])})}};function Xu(r,{width:e,height:o},u,m){if(m){if(m instanceof Uint8ClampedArray)m=new Uint8Array(m.buffer);else if(m.length!==e*o*u)throw new RangeError(`mismatched image size. expected: ${m.length} but got: ${e*o*u}`)}else m=new Uint8Array(e*o*u);return r.width=e,r.height=o,r.data=m,r}function Kh(r,{width:e,height:o},u){if(e===r.width&&o===r.height)return;const m=Xu({},{width:e,height:o},u);Yu(r,m,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,e),height:Math.min(r.height,o)},u),r.width=e,r.height=o,r.data=m.data}function Yu(r,e,o,u,m,w){if(m.width===0||m.height===0)return e;if(m.width>r.width||m.height>r.height||o.x>r.width-m.width||o.y>r.height-m.height)throw new RangeError("out of range source coordinates for image copy");if(m.width>e.width||m.height>e.height||u.x>e.width-m.width||u.y>e.height-m.height)throw new RangeError("out of range destination coordinates for image copy");const k=r.data,I=e.data;if(k===I)throw new Error("srcData equals dstData, so image is already copied");for(let P=0;P<m.height;P++){const B=((o.y+P)*r.width+o.x)*w,F=((u.y+P)*e.width+u.x)*w;for(let O=0;O<m.width*w;O++)I[F+O]=k[B+O]}return e}class sA{constructor(e,o){Xu(this,e,1,o)}resize(e){Kh(this,e,1)}clone(){return new sA({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,o,u,m,w){Yu(e,o,u,m,w,1)}}class Pn{constructor(e,o){Xu(this,e,4,o)}resize(e){Kh(this,e,4)}replace(e,o){o?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Pn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,o,u,m,w){Yu(e,o,u,m,w,4)}}function Jh(r){const e={},o=r.resolution||256,u=r.clips?r.clips.length:1,m=r.image||new Pn({width:o,height:u});if(Math.log(o)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${o}`);const w=(k,I,P)=>{e[r.evaluationKey]=P;const B=r.expression.evaluate(e);m.data[k+I+0]=Math.floor(255*B.r/B.a),m.data[k+I+1]=Math.floor(255*B.g/B.a),m.data[k+I+2]=Math.floor(255*B.b/B.a),m.data[k+I+3]=Math.floor(255*B.a)};if(r.clips)for(let k=0,I=0;k<u;++k,I+=4*o)for(let P=0,B=0;P<o;P++,B+=4){const F=P/(o-1),{start:O,end:q}=r.clips[k];w(I,B,O*(1-F)+q*F)}else for(let k=0,I=0;k<o;k++,I+=4)w(0,I,k/(o-1));return m}st("AlphaImage",sA),st("RGBAImage",Pn);class jp extends Bi{createBucket(e){return new Xh(e)}constructor(e){super(e,Gp),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Jh({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let e0;var qp={get paint(){return e0=e0||new Di({"hillshade-illumination-direction":new ht(ze.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ht(ze.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ht(ze.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ht(ze.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ht(ze.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ht(ze.paint_hillshade["hillshade-accent-color"])})}};class Zp extends Bi{constructor(e){super(e,qp)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const Qp=$t([{name:"a_pos",components:2,type:"Int16"}],4),{members:$p}=Qp;var Ku={exports:{}};function GA(r,e,o){o=o||2;var u,m,w,k,I,P,B,F=e&&e.length,O=F?e[0]*o:r.length,q=t0(r,0,O,o,!0),W=[];if(!q||q.next===q.prev)return W;if(F&&(q=function(re,ue,me,ke){var ye,Se,Ie,Re=[];for(ye=0,Se=ue.length;ye<Se;ye++)(Ie=t0(re,ue[ye]*ke,ye<Se-1?ue[ye+1]*ke:re.length,ke,!1))===Ie.next&&(Ie.steiner=!0),Re.push(tm(Ie));for(Re.sort(Kp),ye=0;ye<Re.length;ye++)me=Jp(Re[ye],me);return me}(r,e,q,o)),r.length>80*o){u=w=r[0],m=k=r[1];for(var Y=o;Y<O;Y+=o)(I=r[Y])<u&&(u=I),(P=r[Y+1])<m&&(m=P),I>w&&(w=I),P>k&&(k=P);B=(B=Math.max(w-u,k-m))!==0?32767/B:0}return oA(q,W,o,u,m,B,0),W}function t0(r,e,o,u,m){var w,k;if(m===tc(r,e,o,u)>0)for(w=e;w<o;w+=u)k=n0(w,r[w],r[w+1],k);else for(w=o-u;w>=e;w-=u)k=n0(w,r[w],r[w+1],k);return k&&jA(k,k.next)&&(lA(k),k=k.next),k}function Qa(r,e){if(!r)return r;e||(e=r);var o,u=r;do if(o=!1,u.steiner||!jA(u,u.next)&&Ui(u.prev,u,u.next)!==0)u=u.next;else{if(lA(u),(u=e=u.prev)===u.next)break;o=!0}while(o||u!==e);return e}function oA(r,e,o,u,m,w,k){if(r){!k&&w&&function(F,O,q,W){var Y=F;do Y.z===0&&(Y.z=Ju(Y.x,Y.y,O,q,W)),Y.prevZ=Y.prev,Y.nextZ=Y.next,Y=Y.next;while(Y!==F);Y.prevZ.nextZ=null,Y.prevZ=null,function(re){var ue,me,ke,ye,Se,Ie,Re,it,ct=1;do{for(me=re,re=null,Se=null,Ie=0;me;){for(Ie++,ke=me,Re=0,ue=0;ue<ct&&(Re++,ke=ke.nextZ);ue++);for(it=ct;Re>0||it>0&&ke;)Re!==0&&(it===0||!ke||me.z<=ke.z)?(ye=me,me=me.nextZ,Re--):(ye=ke,ke=ke.nextZ,it--),Se?Se.nextZ=ye:re=ye,ye.prevZ=Se,Se=ye;me=ke}Se.nextZ=null,ct*=2}while(Ie>1)}(Y)}(r,u,m,w);for(var I,P,B=r;r.prev!==r.next;)if(I=r.prev,P=r.next,w?Wp(r,u,m,w):Hp(r))e.push(I.i/o|0),e.push(r.i/o|0),e.push(P.i/o|0),lA(r),r=P.next,B=P.next;else if((r=P)===B){k?k===1?oA(r=Xp(Qa(r),e,o),e,o,u,m,w,2):k===2&&Yp(r,e,o,u,m,w):oA(Qa(r),e,o,u,m,w,1);break}}}function Hp(r){var e=r.prev,o=r,u=r.next;if(Ui(e,o,u)>=0)return!1;for(var m=e.x,w=o.x,k=u.x,I=e.y,P=o.y,B=u.y,F=m<w?m<k?m:k:w<k?w:k,O=I<P?I<B?I:B:P<B?P:B,q=m>w?m>k?m:k:w>k?w:k,W=I>P?I>B?I:B:P>B?P:B,Y=u.next;Y!==e;){if(Y.x>=F&&Y.x<=q&&Y.y>=O&&Y.y<=W&&Pl(m,I,w,P,k,B,Y.x,Y.y)&&Ui(Y.prev,Y,Y.next)>=0)return!1;Y=Y.next}return!0}function Wp(r,e,o,u){var m=r.prev,w=r,k=r.next;if(Ui(m,w,k)>=0)return!1;for(var I=m.x,P=w.x,B=k.x,F=m.y,O=w.y,q=k.y,W=I<P?I<B?I:B:P<B?P:B,Y=F<O?F<q?F:q:O<q?O:q,re=I>P?I>B?I:B:P>B?P:B,ue=F>O?F>q?F:q:O>q?O:q,me=Ju(W,Y,e,o,u),ke=Ju(re,ue,e,o,u),ye=r.prevZ,Se=r.nextZ;ye&&ye.z>=me&&Se&&Se.z<=ke;){if(ye.x>=W&&ye.x<=re&&ye.y>=Y&&ye.y<=ue&&ye!==m&&ye!==k&&Pl(I,F,P,O,B,q,ye.x,ye.y)&&Ui(ye.prev,ye,ye.next)>=0||(ye=ye.prevZ,Se.x>=W&&Se.x<=re&&Se.y>=Y&&Se.y<=ue&&Se!==m&&Se!==k&&Pl(I,F,P,O,B,q,Se.x,Se.y)&&Ui(Se.prev,Se,Se.next)>=0))return!1;Se=Se.nextZ}for(;ye&&ye.z>=me;){if(ye.x>=W&&ye.x<=re&&ye.y>=Y&&ye.y<=ue&&ye!==m&&ye!==k&&Pl(I,F,P,O,B,q,ye.x,ye.y)&&Ui(ye.prev,ye,ye.next)>=0)return!1;ye=ye.prevZ}for(;Se&&Se.z<=ke;){if(Se.x>=W&&Se.x<=re&&Se.y>=Y&&Se.y<=ue&&Se!==m&&Se!==k&&Pl(I,F,P,O,B,q,Se.x,Se.y)&&Ui(Se.prev,Se,Se.next)>=0)return!1;Se=Se.nextZ}return!0}function Xp(r,e,o){var u=r;do{var m=u.prev,w=u.next.next;!jA(m,w)&&i0(m,u,u.next,w)&&aA(m,w)&&aA(w,m)&&(e.push(m.i/o|0),e.push(u.i/o|0),e.push(w.i/o|0),lA(u),lA(u.next),u=r=w),u=u.next}while(u!==r);return Qa(u)}function Yp(r,e,o,u,m,w){var k=r;do{for(var I=k.next.next;I!==k.prev;){if(k.i!==I.i&&im(k,I)){var P=r0(k,I);return k=Qa(k,k.next),P=Qa(P,P.next),oA(k,e,o,u,m,w,0),void oA(P,e,o,u,m,w,0)}I=I.next}k=k.next}while(k!==r)}function Kp(r,e){return r.x-e.x}function Jp(r,e){var o=function(m,w){var k,I=w,P=m.x,B=m.y,F=-1/0;do{if(B<=I.y&&B>=I.next.y&&I.next.y!==I.y){var O=I.x+(B-I.y)*(I.next.x-I.x)/(I.next.y-I.y);if(O<=P&&O>F&&(F=O,k=I.x<I.next.x?I:I.next,O===P))return k}I=I.next}while(I!==w);if(!k)return null;var q,W=k,Y=k.x,re=k.y,ue=1/0;I=k;do P>=I.x&&I.x>=Y&&P!==I.x&&Pl(B<re?P:F,B,Y,re,B<re?F:P,B,I.x,I.y)&&(q=Math.abs(B-I.y)/(P-I.x),aA(I,m)&&(q<ue||q===ue&&(I.x>k.x||I.x===k.x&&em(k,I)))&&(k=I,ue=q)),I=I.next;while(I!==W);return k}(r,e);if(!o)return e;var u=r0(o,r);return Qa(u,u.next),Qa(o,o.next)}function em(r,e){return Ui(r.prev,r,e.prev)<0&&Ui(e.next,r,r.next)<0}function Ju(r,e,o,u,m){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-o)*m|0)|r<<8))|r<<4))|r<<2))|r<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-u)*m|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function tm(r){var e=r,o=r;do(e.x<o.x||e.x===o.x&&e.y<o.y)&&(o=e),e=e.next;while(e!==r);return o}function Pl(r,e,o,u,m,w,k,I){return(m-k)*(e-I)>=(r-k)*(w-I)&&(r-k)*(u-I)>=(o-k)*(e-I)&&(o-k)*(w-I)>=(m-k)*(u-I)}function im(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!function(o,u){var m=o;do{if(m.i!==o.i&&m.next.i!==o.i&&m.i!==u.i&&m.next.i!==u.i&&i0(m,m.next,o,u))return!0;m=m.next}while(m!==o);return!1}(r,e)&&(aA(r,e)&&aA(e,r)&&function(o,u){var m=o,w=!1,k=(o.x+u.x)/2,I=(o.y+u.y)/2;do m.y>I!=m.next.y>I&&m.next.y!==m.y&&k<(m.next.x-m.x)*(I-m.y)/(m.next.y-m.y)+m.x&&(w=!w),m=m.next;while(m!==o);return w}(r,e)&&(Ui(r.prev,r,e.prev)||Ui(r,e.prev,e))||jA(r,e)&&Ui(r.prev,r,r.next)>0&&Ui(e.prev,e,e.next)>0)}function Ui(r,e,o){return(e.y-r.y)*(o.x-e.x)-(e.x-r.x)*(o.y-e.y)}function jA(r,e){return r.x===e.x&&r.y===e.y}function i0(r,e,o,u){var m=ZA(Ui(r,e,o)),w=ZA(Ui(r,e,u)),k=ZA(Ui(o,u,r)),I=ZA(Ui(o,u,e));return m!==w&&k!==I||!(m!==0||!qA(r,o,e))||!(w!==0||!qA(r,u,e))||!(k!==0||!qA(o,r,u))||!(I!==0||!qA(o,e,u))}function qA(r,e,o){return e.x<=Math.max(r.x,o.x)&&e.x>=Math.min(r.x,o.x)&&e.y<=Math.max(r.y,o.y)&&e.y>=Math.min(r.y,o.y)}function ZA(r){return r>0?1:r<0?-1:0}function aA(r,e){return Ui(r.prev,r,r.next)<0?Ui(r,e,r.next)>=0&&Ui(r,r.prev,e)>=0:Ui(r,e,r.prev)<0||Ui(r,r.next,e)<0}function r0(r,e){var o=new ec(r.i,r.x,r.y),u=new ec(e.i,e.x,e.y),m=r.next,w=e.prev;return r.next=e,e.prev=r,o.next=m,m.prev=o,u.next=o,o.prev=u,w.next=u,u.prev=w,u}function n0(r,e,o,u){var m=new ec(r,e,o);return u?(m.next=u.next,m.prev=u,u.next.prev=m,u.next=m):(m.prev=m,m.next=m),m}function lA(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function ec(r,e,o){this.i=r,this.x=e,this.y=o,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function tc(r,e,o,u){for(var m=0,w=e,k=o-u;w<o;w+=u)m+=(r[k]-r[w])*(r[w+1]+r[k+1]),k=w;return m}Ku.exports=GA,Ku.exports.default=GA,GA.deviation=function(r,e,o,u){var m=e&&e.length,w=Math.abs(tc(r,0,m?e[0]*o:r.length,o));if(m)for(var k=0,I=e.length;k<I;k++)w-=Math.abs(tc(r,e[k]*o,k<I-1?e[k+1]*o:r.length,o));var P=0;for(k=0;k<u.length;k+=3){var B=u[k]*o,F=u[k+1]*o,O=u[k+2]*o;P+=Math.abs((r[B]-r[O])*(r[F+1]-r[B+1])-(r[B]-r[F])*(r[O+1]-r[B+1]))}return w===0&&P===0?0:Math.abs((P-w)/w)},GA.flatten=function(r){for(var e=r[0][0].length,o={vertices:[],holes:[],dimensions:e},u=0,m=0;m<r.length;m++){for(var w=0;w<r[m].length;w++)for(var k=0;k<e;k++)o.vertices.push(r[m][w][k]);m>0&&o.holes.push(u+=r[m-1].length)}return o};var s0=R(Ku.exports);function rm(r,e,o,u,m){o0(r,e,o||0,u||r.length-1,m||nm)}function o0(r,e,o,u,m){for(;u>o;){if(u-o>600){var w=u-o+1,k=e-o+1,I=Math.log(w),P=.5*Math.exp(2*I/3),B=.5*Math.sqrt(I*P*(w-P)/w)*(k-w/2<0?-1:1);o0(r,e,Math.max(o,Math.floor(e-k*P/w+B)),Math.min(u,Math.floor(e+(w-k)*P/w+B)),m)}var F=r[e],O=o,q=u;for(AA(r,o,e),m(r[u],F)>0&&AA(r,o,u);O<q;){for(AA(r,O,q),O++,q--;m(r[O],F)<0;)O++;for(;m(r[q],F)>0;)q--}m(r[o],F)===0?AA(r,o,q):AA(r,++q,u),q<=e&&(o=q+1),e<=q&&(u=q-1)}}function AA(r,e,o){var u=r[e];r[e]=r[o],r[o]=u}function nm(r,e){return r<e?-1:r>e?1:0}function ic(r,e){const o=r.length;if(o<=1)return[r];const u=[];let m,w;for(let k=0;k<o;k++){const I=_i(r[k]);I!==0&&(r[k].area=Math.abs(I),w===void 0&&(w=I<0),w===I<0?(m&&u.push(m),m=[r[k]]):m.push(r[k]))}if(m&&u.push(m),e>1)for(let k=0;k<u.length;k++)u[k].length<=e||(rm(u[k],e,1,u[k].length-1,sm),u[k]=u[k].slice(0,e));return u}function sm(r,e){return e.area-r.area}function rc(r,e,o){const u=o.patternDependencies;let m=!1;for(const w of e){const k=w.paint.get(`${r}-pattern`);k.isConstant()||(m=!0);const I=k.constantOr(null);I&&(m=!0,u[I.to]=!0,u[I.from]=!0)}return m}function nc(r,e,o,u,m){const w=m.patternDependencies;for(const k of e){const I=k.paint.get(`${r}-pattern`).value;if(I.kind!=="constant"){let P=I.evaluate({zoom:u-1},o,{},m.availableImages),B=I.evaluate({zoom:u},o,{},m.availableImages),F=I.evaluate({zoom:u+1},o,{},m.availableImages);P=P&&P.name?P.name:P,B=B&&B.name?B.name:B,F=F&&F.name?F.name:F,w[P]=!0,w[B]=!0,w[F]=!0,o.patterns[k.id]={min:P,mid:B,max:F}}}return o}class sc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(o=>o.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Fe,this.indexArray=new Rt,this.indexArray2=new dt,this.programConfigurations=new ds(e.layers,e.zoom),this.segments=new pi,this.segments2=new pi,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(e,o,u){this.hasPattern=rc("fill",this.layers,o);const m=this.layers[0].layout.get("fill-sort-key"),w=!m.isConstant(),k=[];for(const{feature:I,id:P,index:B,sourceLayerIndex:F}of e){const O=this.layers[0]._featureFilter.needGeometry,q=Za(I,O);if(!this.layers[0]._featureFilter.filter(new yi(this.zoom),q,u))continue;const W=w?m.evaluate(q,{},u,o.availableImages):void 0,Y={id:P,properties:I.properties,type:I.type,sourceLayerIndex:F,index:B,geometry:O?q.geometry:qa(I),patterns:{},sortKey:W};k.push(Y)}w&&k.sort((I,P)=>I.sortKey-P.sortKey);for(const I of k){const{geometry:P,index:B,sourceLayerIndex:F}=I;if(this.hasPattern){const O=nc("fill",this.layers,I,this.zoom,o);this.patternFeatures.push(O)}else this.addFeature(I,P,B,u,{});o.featureIndex.insert(e[B].feature,P,B,F,this.index)}}update(e,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,o,this.stateDependentLayers,u)}addFeatures(e,o,u){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,o,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,$p),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,o,u,m,w){for(const k of ic(o,500)){let I=0;for(const W of k)I+=W.length;const P=this.segments.prepareSegment(I,this.layoutVertexArray,this.indexArray),B=P.vertexLength,F=[],O=[];for(const W of k){if(W.length===0)continue;W!==k[0]&&O.push(F.length/2);const Y=this.segments2.prepareSegment(W.length,this.layoutVertexArray,this.indexArray2),re=Y.vertexLength;this.layoutVertexArray.emplaceBack(W[0].x,W[0].y),this.indexArray2.emplaceBack(re+W.length-1,re),F.push(W[0].x),F.push(W[0].y);for(let ue=1;ue<W.length;ue++)this.layoutVertexArray.emplaceBack(W[ue].x,W[ue].y),this.indexArray2.emplaceBack(re+ue-1,re+ue),F.push(W[ue].x),F.push(W[ue].y);Y.vertexLength+=W.length,Y.primitiveLength+=W.length}const q=s0(F,O);for(let W=0;W<q.length;W+=3)this.indexArray.emplaceBack(B+q[W],B+q[W+1],B+q[W+2]);P.vertexLength+=I,P.primitiveLength+=q.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,u,w,m)}}let a0,l0;st("FillBucket",sc,{omit:["layers","patternFeatures"]});var om={get paint(){return l0=l0||new Di({"fill-antialias":new ht(ze.paint_fill["fill-antialias"]),"fill-opacity":new wt(ze.paint_fill["fill-opacity"]),"fill-color":new wt(ze.paint_fill["fill-color"]),"fill-outline-color":new wt(ze.paint_fill["fill-outline-color"]),"fill-translate":new ht(ze.paint_fill["fill-translate"]),"fill-translate-anchor":new ht(ze.paint_fill["fill-translate-anchor"]),"fill-pattern":new So(ze.paint_fill["fill-pattern"])})},get layout(){return a0=a0||new Di({"fill-sort-key":new wt(ze.layout_fill["fill-sort-key"])})}};class am extends Bi{constructor(e){super(e,om)}recalculate(e,o){super.recalculate(e,o);const u=this.paint._values["fill-outline-color"];u.value.kind==="constant"&&u.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new sc(e)}queryRadius(){return VA(this.paint.get("fill-translate"))}queryIntersectsFeature(e,o,u,m,w,k,I){return jh(NA(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),k.angle,I),m)}isTileClipped(){return!0}}const lm=$t([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Am=$t([{name:"a_centroid",components:2,type:"Int16"}],4),{members:um}=lm;var Aa={},cm=ie,A0=Dl;function Dl(r,e,o,u,m){this.properties={},this.extent=o,this.type=0,this._pbf=r,this._geometry=-1,this._keys=u,this._values=m,r.readFields(hm,this,e)}function hm(r,e,o){r==1?e.id=o.readVarint():r==2?function(u,m){for(var w=u.readVarint()+u.pos;u.pos<w;){var k=m._keys[u.readVarint()],I=m._values[u.readVarint()];m.properties[k]=I}}(o,e):r==3?e.type=o.readVarint():r==4&&(e._geometry=o.pos)}function fm(r){for(var e,o,u=0,m=0,w=r.length,k=w-1;m<w;k=m++)u+=((o=r[k]).x-(e=r[m]).x)*(e.y+o.y);return u}Dl.types=["Unknown","Point","LineString","Polygon"],Dl.prototype.loadGeometry=function(){var r=this._pbf;r.pos=this._geometry;for(var e,o=r.readVarint()+r.pos,u=1,m=0,w=0,k=0,I=[];r.pos<o;){if(m<=0){var P=r.readVarint();u=7&P,m=P>>3}if(m--,u===1||u===2)w+=r.readSVarint(),k+=r.readSVarint(),u===1&&(e&&I.push(e),e=[]),e.push(new cm(w,k));else{if(u!==7)throw new Error("unknown command "+u);e&&e.push(e[0].clone())}}return e&&I.push(e),I},Dl.prototype.bbox=function(){var r=this._pbf;r.pos=this._geometry;for(var e=r.readVarint()+r.pos,o=1,u=0,m=0,w=0,k=1/0,I=-1/0,P=1/0,B=-1/0;r.pos<e;){if(u<=0){var F=r.readVarint();o=7&F,u=F>>3}if(u--,o===1||o===2)(m+=r.readSVarint())<k&&(k=m),m>I&&(I=m),(w+=r.readSVarint())<P&&(P=w),w>B&&(B=w);else if(o!==7)throw new Error("unknown command "+o)}return[k,P,I,B]},Dl.prototype.toGeoJSON=function(r,e,o){var u,m,w=this.extent*Math.pow(2,o),k=this.extent*r,I=this.extent*e,P=this.loadGeometry(),B=Dl.types[this.type];function F(W){for(var Y=0;Y<W.length;Y++){var re=W[Y];W[Y]=[360*(re.x+k)/w-180,360/Math.PI*Math.atan(Math.exp((180-360*(re.y+I)/w)*Math.PI/180))-90]}}switch(this.type){case 1:var O=[];for(u=0;u<P.length;u++)O[u]=P[u][0];F(P=O);break;case 2:for(u=0;u<P.length;u++)F(P[u]);break;case 3:for(P=function(W){var Y=W.length;if(Y<=1)return[W];for(var re,ue,me=[],ke=0;ke<Y;ke++){var ye=fm(W[ke]);ye!==0&&(ue===void 0&&(ue=ye<0),ue===ye<0?(re&&me.push(re),re=[W[ke]]):re.push(W[ke]))}return re&&me.push(re),me}(P),u=0;u<P.length;u++)for(m=0;m<P[u].length;m++)F(P[u][m])}P.length===1?P=P[0]:B="Multi"+B;var q={type:"Feature",geometry:{type:B,coordinates:P},properties:this.properties};return"id"in this&&(q.id=this.id),q};var dm=A0,u0=c0;function c0(r,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=r,this._keys=[],this._values=[],this._features=[],r.readFields(pm,this,e),this.length=this._features.length}function pm(r,e,o){r===15?e.version=o.readVarint():r===1?e.name=o.readString():r===5?e.extent=o.readVarint():r===2?e._features.push(o.pos):r===3?e._keys.push(o.readString()):r===4&&e._values.push(function(u){for(var m=null,w=u.readVarint()+u.pos;u.pos<w;){var k=u.readVarint()>>3;m=k===1?u.readString():k===2?u.readFloat():k===3?u.readDouble():k===4?u.readVarint64():k===5?u.readVarint():k===6?u.readSVarint():k===7?u.readBoolean():null}return m}(o))}c0.prototype.feature=function(r){if(r<0||r>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[r];var e=this._pbf.readVarint()+this._pbf.pos;return new dm(this._pbf,e,this.extent,this._keys,this._values)};var mm=u0;function gm(r,e,o){if(r===3){var u=new mm(o,o.readVarint()+o.pos);u.length&&(e[u.name]=u)}}Aa.VectorTile=function(r,e){this.layers=r.readFields(gm,{},e)},Aa.VectorTileFeature=A0,Aa.VectorTileLayer=u0;const _m=Aa.VectorTileFeature.types,oc=Math.pow(2,13);function uA(r,e,o,u,m,w,k,I){r.emplaceBack(e,o,2*Math.floor(u*oc)+k,m*oc*2,w*oc*2,Math.round(I))}class ac{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(o=>o.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Me,this.centroidVertexArray=new fe,this.indexArray=new Rt,this.programConfigurations=new ds(e.layers,e.zoom),this.segments=new pi,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(e,o,u){this.features=[],this.hasPattern=rc("fill-extrusion",this.layers,o);for(const{feature:m,id:w,index:k,sourceLayerIndex:I}of e){const P=this.layers[0]._featureFilter.needGeometry,B=Za(m,P);if(!this.layers[0]._featureFilter.filter(new yi(this.zoom),B,u))continue;const F={id:w,sourceLayerIndex:I,index:k,geometry:P?B.geometry:qa(m),properties:m.properties,type:m.type,patterns:{}};this.hasPattern?this.features.push(nc("fill-extrusion",this.layers,F,this.zoom,o)):this.addFeature(F,F.geometry,k,u,{}),o.featureIndex.insert(m,F.geometry,k,I,this.index,!0)}}addFeatures(e,o,u){for(const m of this.features){const{geometry:w}=m;this.addFeature(m,w,m.index,o,u)}}update(e,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,o,this.stateDependentLayers,u)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,um),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Am.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,o,u,m,w){const k={x:0,y:0,vertexCount:0};for(const I of ic(o,500)){let P=0;for(const Y of I)P+=Y.length;let B=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const Y of I){if(Y.length===0||vm(Y))continue;let re=0;for(let ue=0;ue<Y.length;ue++){const me=Y[ue];if(ue>=1){const ke=Y[ue-1];if(!ym(me,ke)){B.vertexLength+4>pi.MAX_VERTEX_ARRAY_LENGTH&&(B=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ye=me.sub(ke)._perp()._unit(),Se=ke.dist(me);re+Se>32768&&(re=0),uA(this.layoutVertexArray,me.x,me.y,ye.x,ye.y,0,0,re),uA(this.layoutVertexArray,me.x,me.y,ye.x,ye.y,0,1,re),k.x+=2*me.x,k.y+=2*me.y,k.vertexCount+=2,re+=Se,uA(this.layoutVertexArray,ke.x,ke.y,ye.x,ye.y,0,0,re),uA(this.layoutVertexArray,ke.x,ke.y,ye.x,ye.y,0,1,re),k.x+=2*ke.x,k.y+=2*ke.y,k.vertexCount+=2;const Ie=B.vertexLength;this.indexArray.emplaceBack(Ie,Ie+2,Ie+1),this.indexArray.emplaceBack(Ie+1,Ie+2,Ie+3),B.vertexLength+=4,B.primitiveLength+=2}}}}if(B.vertexLength+P>pi.MAX_VERTEX_ARRAY_LENGTH&&(B=this.segments.prepareSegment(P,this.layoutVertexArray,this.indexArray)),_m[e.type]!=="Polygon")continue;const F=[],O=[],q=B.vertexLength;for(const Y of I)if(Y.length!==0){Y!==I[0]&&O.push(F.length/2);for(let re=0;re<Y.length;re++){const ue=Y[re];uA(this.layoutVertexArray,ue.x,ue.y,0,0,1,1,0),k.x+=ue.x,k.y+=ue.y,k.vertexCount+=1,F.push(ue.x),F.push(ue.y)}}const W=s0(F,O);for(let Y=0;Y<W.length;Y+=3)this.indexArray.emplaceBack(q+W[Y],q+W[Y+2],q+W[Y+1]);B.primitiveLength+=W.length/3,B.vertexLength+=P}for(let I=0;I<k.vertexCount;I++)this.centroidVertexArray.emplaceBack(Math.floor(k.x/k.vertexCount),Math.floor(k.y/k.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,u,w,m)}}function ym(r,e){return r.x===e.x&&(r.x<0||r.x>$i)||r.y===e.y&&(r.y<0||r.y>$i)}function vm(r){return r.every(e=>e.x<0)||r.every(e=>e.x>$i)||r.every(e=>e.y<0)||r.every(e=>e.y>$i)}let h0;st("FillExtrusionBucket",ac,{omit:["layers","features"]});var xm={get paint(){return h0=h0||new Di({"fill-extrusion-opacity":new ht(ze["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new wt(ze["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ht(ze["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ht(ze["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new So(ze["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new wt(ze["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new wt(ze["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ht(ze["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class bm extends Bi{constructor(e){super(e,xm)}createBucket(e){return new ac(e)}queryRadius(){return VA(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(e,o,u,m,w,k,I,P){const B=NA(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),k.angle,I),F=this.paint.get("fill-extrusion-height").evaluate(o,u),O=this.paint.get("fill-extrusion-base").evaluate(o,u),q=function(Y,re,ue,me){const ke=[];for(const ye of Y){const Se=[ye.x,ye.y,0,1];UA(Se,Se,re),ke.push(new K(Se[0]/Se[3],Se[1]/Se[3]))}return ke}(B,P),W=function(Y,re,ue,me){const ke=[],ye=[],Se=me[8]*re,Ie=me[9]*re,Re=me[10]*re,it=me[11]*re,ct=me[8]*ue,tt=me[9]*ue,Xe=me[10]*ue,Qe=me[11]*ue;for(const lt of Y){const He=[],Ne=[];for(const bt of lt){const pt=bt.x,jt=bt.y,ki=me[0]*pt+me[4]*jt+me[12],Ii=me[1]*pt+me[5]*jt+me[13],er=me[2]*pt+me[6]*jt+me[14],pn=me[3]*pt+me[7]*jt+me[15],jr=er+Re,Hi=pn+it,fr=ki+ct,br=Ii+tt,qr=er+Xe,Zr=pn+Qe,tr=new K((ki+Se)/Hi,(Ii+Ie)/Hi);tr.z=jr/Hi,He.push(tr);const ir=new K(fr/Zr,br/Zr);ir.z=qr/Zr,Ne.push(ir)}ke.push(He),ye.push(Ne)}return[ke,ye]}(m,O,F,P);return function(Y,re,ue){let me=1/0;jh(ue,re)&&(me=f0(ue,re[0]));for(let ke=0;ke<re.length;ke++){const ye=re[ke],Se=Y[ke];for(let Ie=0;Ie<ye.length-1;Ie++){const Re=ye[Ie],it=[Re,ye[Ie+1],Se[Ie+1],Se[Ie],Re];Gh(ue,it)&&(me=Math.min(me,f0(ue,it)))}}return me!==1/0&&me}(W[0],W[1],q)}}function cA(r,e){return r.x*e.x+r.y*e.y}function f0(r,e){if(r.length===1){let o=0;const u=e[o++];let m;for(;!m||u.equals(m);)if(m=e[o++],!m)return 1/0;for(;o<e.length;o++){const w=e[o],k=r[0],I=m.sub(u),P=w.sub(u),B=k.sub(u),F=cA(I,I),O=cA(I,P),q=cA(P,P),W=cA(B,I),Y=cA(B,P),re=F*q-O*O,ue=(q*W-O*Y)/re,me=(F*Y-O*W)/re,ke=u.z*(1-ue-me)+m.z*ue+w.z*me;if(isFinite(ke))return ke}return 1/0}{let o=1/0;for(const u of e)o=Math.min(o,u.z);return o}}const wm=$t([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:km}=wm,Em=$t([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Sm}=Em,Tm=Aa.VectorTileFeature.types,Im=Math.cos(Math.PI/180*37.5),d0=Math.pow(2,14)/.5;class lc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(o=>o.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(o=>{this.gradients[o.id]={}}),this.layoutVertexArray=new Pe,this.layoutVertexArray2=new Ce,this.indexArray=new Rt,this.programConfigurations=new ds(e.layers,e.zoom),this.segments=new pi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(e,o,u){this.hasPattern=rc("line",this.layers,o);const m=this.layers[0].layout.get("line-sort-key"),w=!m.isConstant(),k=[];for(const{feature:I,id:P,index:B,sourceLayerIndex:F}of e){const O=this.layers[0]._featureFilter.needGeometry,q=Za(I,O);if(!this.layers[0]._featureFilter.filter(new yi(this.zoom),q,u))continue;const W=w?m.evaluate(q,{},u):void 0,Y={id:P,properties:I.properties,type:I.type,sourceLayerIndex:F,index:B,geometry:O?q.geometry:qa(I),patterns:{},sortKey:W};k.push(Y)}w&&k.sort((I,P)=>I.sortKey-P.sortKey);for(const I of k){const{geometry:P,index:B,sourceLayerIndex:F}=I;if(this.hasPattern){const O=nc("line",this.layers,I,this.zoom,o);this.patternFeatures.push(O)}else this.addFeature(I,P,B,u,{});o.featureIndex.insert(e[B].feature,P,B,F,this.index)}}update(e,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,o,this.stateDependentLayers,u)}addFeatures(e,o,u){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,o,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Sm)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,km),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,o,u,m,w){const k=this.layers[0].layout,I=k.get("line-join").evaluate(e,{}),P=k.get("line-cap"),B=k.get("line-miter-limit"),F=k.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const O of o)this.addLine(O,e,I,P,B,F);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,u,w,m)}addLine(e,o,u,m,w,k){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let me=0;me<e.length-1;me++)this.totalDistance+=e[me].dist(e[me+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const I=Tm[o.type]==="Polygon";let P=e.length;for(;P>=2&&e[P-1].equals(e[P-2]);)P--;let B=0;for(;B<P-1&&e[B].equals(e[B+1]);)B++;if(P<(I?3:2))return;u==="bevel"&&(w=1.05);const F=this.overscaling<=16?15*$i/(512*this.overscaling):0,O=this.segments.prepareSegment(10*P,this.layoutVertexArray,this.indexArray);let q,W,Y,re,ue;this.e1=this.e2=-1,I&&(q=e[P-2],ue=e[B].sub(q)._unit()._perp());for(let me=B;me<P;me++){if(Y=me===P-1?I?e[B+1]:void 0:e[me+1],Y&&e[me].equals(Y))continue;ue&&(re=ue),q&&(W=q),q=e[me],ue=Y?Y.sub(q)._unit()._perp():re,re=re||ue;let ke=re.add(ue);ke.x===0&&ke.y===0||ke._unit();const ye=re.x*ue.x+re.y*ue.y,Se=ke.x*ue.x+ke.y*ue.y,Ie=Se!==0?1/Se:1/0,Re=2*Math.sqrt(2-2*Se),it=Se<Im&&W&&Y,ct=re.x*ue.y-re.y*ue.x>0;if(it&&me>B){const Qe=q.dist(W);if(Qe>2*F){const lt=q.sub(q.sub(W)._mult(F/Qe)._round());this.updateDistance(W,lt),this.addCurrentVertex(lt,re,0,0,O),W=lt}}const tt=W&&Y;let Xe=tt?u:I?"butt":m;if(tt&&Xe==="round"&&(Ie<k?Xe="miter":Ie<=2&&(Xe="fakeround")),Xe==="miter"&&Ie>w&&(Xe="bevel"),Xe==="bevel"&&(Ie>2&&(Xe="flipbevel"),Ie<w&&(Xe="miter")),W&&this.updateDistance(W,q),Xe==="miter")ke._mult(Ie),this.addCurrentVertex(q,ke,0,0,O);else if(Xe==="flipbevel"){if(Ie>100)ke=ue.mult(-1);else{const Qe=Ie*re.add(ue).mag()/re.sub(ue).mag();ke._perp()._mult(Qe*(ct?-1:1))}this.addCurrentVertex(q,ke,0,0,O),this.addCurrentVertex(q,ke.mult(-1),0,0,O)}else if(Xe==="bevel"||Xe==="fakeround"){const Qe=-Math.sqrt(Ie*Ie-1),lt=ct?Qe:0,He=ct?0:Qe;if(W&&this.addCurrentVertex(q,re,lt,He,O),Xe==="fakeround"){const Ne=Math.round(180*Re/Math.PI/20);for(let bt=1;bt<Ne;bt++){let pt=bt/Ne;if(pt!==.5){const ki=pt-.5;pt+=pt*ki*(pt-1)*((1.0904+ye*(ye*(3.55645-1.43519*ye)-3.2452))*ki*ki+(.848013+ye*(.215638*ye-1.06021)))}const jt=ue.sub(re)._mult(pt)._add(re)._unit()._mult(ct?-1:1);this.addHalfVertex(q,jt.x,jt.y,!1,ct,0,O)}}Y&&this.addCurrentVertex(q,ue,-lt,-He,O)}else if(Xe==="butt")this.addCurrentVertex(q,ke,0,0,O);else if(Xe==="square"){const Qe=W?1:-1;this.addCurrentVertex(q,ke,Qe,Qe,O)}else Xe==="round"&&(W&&(this.addCurrentVertex(q,re,0,0,O),this.addCurrentVertex(q,re,1,1,O,!0)),Y&&(this.addCurrentVertex(q,ue,-1,-1,O,!0),this.addCurrentVertex(q,ue,0,0,O)));if(it&&me<P-1){const Qe=q.dist(Y);if(Qe>2*F){const lt=q.add(Y.sub(q)._mult(F/Qe)._round());this.updateDistance(q,lt),this.addCurrentVertex(lt,ue,0,0,O),q=lt}}}}addCurrentVertex(e,o,u,m,w,k=!1){const I=o.y*m-o.x,P=-o.y-o.x*m;this.addHalfVertex(e,o.x+o.y*u,o.y-o.x*u,k,!1,u,w),this.addHalfVertex(e,I,P,k,!0,-m,w),this.distance>d0/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,o,u,m,w,k))}addHalfVertex({x:e,y:o},u,m,w,k,I,P){const B=.5*(this.lineClips?this.scaledDistance*(d0-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(w?1:0),(o<<1)+(k?1:0),Math.round(63*u)+128,Math.round(63*m)+128,1+(I===0?0:I<0?-1:1)|(63&B)<<2,B>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const F=P.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,F),P.primitiveLength++),k?this.e2=F:this.e1=F}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,o){this.distance+=e.dist(o),this.updateScaledDistance()}}let p0,m0;st("LineBucket",lc,{omit:["layers","patternFeatures"]});var g0={get paint(){return m0=m0||new Di({"line-opacity":new wt(ze.paint_line["line-opacity"]),"line-color":new wt(ze.paint_line["line-color"]),"line-translate":new ht(ze.paint_line["line-translate"]),"line-translate-anchor":new ht(ze.paint_line["line-translate-anchor"]),"line-width":new wt(ze.paint_line["line-width"]),"line-gap-width":new wt(ze.paint_line["line-gap-width"]),"line-offset":new wt(ze.paint_line["line-offset"]),"line-blur":new wt(ze.paint_line["line-blur"]),"line-dasharray":new Ga(ze.paint_line["line-dasharray"]),"line-pattern":new So(ze.paint_line["line-pattern"]),"line-gradient":new ja(ze.paint_line["line-gradient"])})},get layout(){return p0=p0||new Di({"line-cap":new ht(ze.layout_line["line-cap"]),"line-join":new wt(ze.layout_line["line-join"]),"line-miter-limit":new ht(ze.layout_line["line-miter-limit"]),"line-round-limit":new ht(ze.layout_line["line-round-limit"]),"line-sort-key":new wt(ze.layout_line["line-sort-key"])})}};class Mm extends wt{possiblyEvaluate(e,o){return o=new yi(Math.floor(o.zoom),{now:o.now,fadeDuration:o.fadeDuration,zoomHistory:o.zoomHistory,transition:o.transition}),super.possiblyEvaluate(e,o)}evaluate(e,o,u,m){return o=It({},o,{zoom:Math.floor(o.zoom)}),super.evaluate(e,o,u,m)}}let QA;class Cm extends Bi{constructor(e){super(e,g0),this.gradientVersion=0,QA||(QA=new Mm(g0.paint.properties["line-width"].specification),QA.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const o=this.gradientExpression();this.stepInterpolant=!!function(u){return u._styleExpression!==void 0}(o)&&o._styleExpression.expression instanceof Nn,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,o){super.recalculate(e,o),this.paint._values["line-floorwidth"]=QA.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new lc(e)}queryRadius(e){const o=e,u=_0(rA("line-width",this,o),rA("line-gap-width",this,o)),m=rA("line-offset",this,o);return u/2+Math.abs(m)+VA(this.paint.get("line-translate"))}queryIntersectsFeature(e,o,u,m,w,k,I){const P=NA(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),k.angle,I),B=I/2*_0(this.paint.get("line-width").evaluate(o,u),this.paint.get("line-gap-width").evaluate(o,u)),F=this.paint.get("line-offset").evaluate(o,u);return F&&(m=function(O,q){const W=[];for(let Y=0;Y<O.length;Y++){const re=O[Y],ue=[];for(let me=0;me<re.length;me++){const ke=re[me-1],ye=re[me],Se=re[me+1],Ie=me===0?new K(0,0):ye.sub(ke)._unit()._perp(),Re=me===re.length-1?new K(0,0):Se.sub(ye)._unit()._perp(),it=Ie._add(Re)._unit(),ct=it.x*Re.x+it.y*Re.y;ct!==0&&it._mult(1/ct),ue.push(it._mult(q)._add(ye))}W.push(ue)}return W}(m,F*I)),function(O,q,W){for(let Y=0;Y<q.length;Y++){const re=q[Y];if(O.length>=3){for(let ue=0;ue<re.length;ue++)if(Ml(O,re[ue]))return!0}if(Rp(O,re,W))return!0}return!1}(P,m,B)}isTileClipped(){return!0}}function _0(r,e){return e>0?e+2*r:r}const Pm=$t([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Dm=$t([{name:"a_projected_pos",components:3,type:"Float32"}],4);$t([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Bm=$t([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);$t([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const y0=$t([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),zm=$t([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Lm(r,e,o){return r.sections.forEach(u=>{u.text=function(m,w,k){const I=w.layout.get("text-transform").evaluate(k,{});return I==="uppercase"?m=m.toLocaleUpperCase():I==="lowercase"&&(m=m.toLocaleLowerCase()),Tr.applyArabicShaping&&(m=Tr.applyArabicShaping(m)),m}(u.text,e,o)}),r}$t([{name:"triangle",components:3,type:"Uint16"}]),$t([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),$t([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),$t([{type:"Float32",name:"offsetX"}]),$t([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),$t([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const hA={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var Ji=24,v0=mi,x0=function(r,e,o,u,m){var w,k,I=8*m-u-1,P=(1<<I)-1,B=P>>1,F=-7,O=o?m-1:0,q=o?-1:1,W=r[e+O];for(O+=q,w=W&(1<<-F)-1,W>>=-F,F+=I;F>0;w=256*w+r[e+O],O+=q,F-=8);for(k=w&(1<<-F)-1,w>>=-F,F+=u;F>0;k=256*k+r[e+O],O+=q,F-=8);if(w===0)w=1-B;else{if(w===P)return k?NaN:1/0*(W?-1:1);k+=Math.pow(2,u),w-=B}return(W?-1:1)*k*Math.pow(2,w-u)},b0=function(r,e,o,u,m,w){var k,I,P,B=8*w-m-1,F=(1<<B)-1,O=F>>1,q=m===23?Math.pow(2,-24)-Math.pow(2,-77):0,W=u?0:w-1,Y=u?1:-1,re=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(I=isNaN(e)?1:0,k=F):(k=Math.floor(Math.log(e)/Math.LN2),e*(P=Math.pow(2,-k))<1&&(k--,P*=2),(e+=k+O>=1?q/P:q*Math.pow(2,1-O))*P>=2&&(k++,P/=2),k+O>=F?(I=0,k=F):k+O>=1?(I=(e*P-1)*Math.pow(2,m),k+=O):(I=e*Math.pow(2,O-1)*Math.pow(2,m),k=0));m>=8;r[o+W]=255&I,W+=Y,I/=256,m-=8);for(k=k<<m|I,B+=m;B>0;r[o+W]=255&k,W+=Y,k/=256,B-=8);r[o+W-Y]|=128*re};function mi(r){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(r)?r:new Uint8Array(r||0),this.pos=0,this.type=0,this.length=this.buf.length}mi.Varint=0,mi.Fixed64=1,mi.Bytes=2,mi.Fixed32=5;var Ac=4294967296,w0=1/Ac,k0=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Po(r){return r.type===mi.Bytes?r.readVarint()+r.pos:r.pos+1}function Bl(r,e,o){return o?4294967296*e+(r>>>0):4294967296*(e>>>0)+(r>>>0)}function E0(r,e,o){var u=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));o.realloc(u);for(var m=o.pos-1;m>=r;m--)o.buf[m+u]=o.buf[m]}function Rm(r,e){for(var o=0;o<r.length;o++)e.writeVarint(r[o])}function Fm(r,e){for(var o=0;o<r.length;o++)e.writeSVarint(r[o])}function Om(r,e){for(var o=0;o<r.length;o++)e.writeFloat(r[o])}function Vm(r,e){for(var o=0;o<r.length;o++)e.writeDouble(r[o])}function Nm(r,e){for(var o=0;o<r.length;o++)e.writeBoolean(r[o])}function Um(r,e){for(var o=0;o<r.length;o++)e.writeFixed32(r[o])}function Gm(r,e){for(var o=0;o<r.length;o++)e.writeSFixed32(r[o])}function jm(r,e){for(var o=0;o<r.length;o++)e.writeFixed64(r[o])}function qm(r,e){for(var o=0;o<r.length;o++)e.writeSFixed64(r[o])}function $A(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16)+16777216*r[e+3]}function zl(r,e,o){r[o]=e,r[o+1]=e>>>8,r[o+2]=e>>>16,r[o+3]=e>>>24}function S0(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16)+(r[e+3]<<24)}mi.prototype={destroy:function(){this.buf=null},readFields:function(r,e,o){for(o=o||this.length;this.pos<o;){var u=this.readVarint(),m=u>>3,w=this.pos;this.type=7&u,r(m,e,this),this.pos===w&&this.skip(u)}return e},readMessage:function(r,e){return this.readFields(r,e,this.readVarint()+this.pos)},readFixed32:function(){var r=$A(this.buf,this.pos);return this.pos+=4,r},readSFixed32:function(){var r=S0(this.buf,this.pos);return this.pos+=4,r},readFixed64:function(){var r=$A(this.buf,this.pos)+$A(this.buf,this.pos+4)*Ac;return this.pos+=8,r},readSFixed64:function(){var r=$A(this.buf,this.pos)+S0(this.buf,this.pos+4)*Ac;return this.pos+=8,r},readFloat:function(){var r=x0(this.buf,this.pos,!0,23,4);return this.pos+=4,r},readDouble:function(){var r=x0(this.buf,this.pos,!0,52,8);return this.pos+=8,r},readVarint:function(r){var e,o,u=this.buf;return e=127&(o=u[this.pos++]),o<128?e:(e|=(127&(o=u[this.pos++]))<<7,o<128?e:(e|=(127&(o=u[this.pos++]))<<14,o<128?e:(e|=(127&(o=u[this.pos++]))<<21,o<128?e:function(m,w,k){var I,P,B=k.buf;if(I=(112&(P=B[k.pos++]))>>4,P<128||(I|=(127&(P=B[k.pos++]))<<3,P<128)||(I|=(127&(P=B[k.pos++]))<<10,P<128)||(I|=(127&(P=B[k.pos++]))<<17,P<128)||(I|=(127&(P=B[k.pos++]))<<24,P<128)||(I|=(1&(P=B[k.pos++]))<<31,P<128))return Bl(m,I,w);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(o=u[this.pos]))<<28,r,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var r=this.readVarint();return r%2==1?(r+1)/-2:r/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var r=this.readVarint()+this.pos,e=this.pos;return this.pos=r,r-e>=12&&k0?function(o,u,m){return k0.decode(o.subarray(u,m))}(this.buf,e,r):function(o,u,m){for(var w="",k=u;k<m;){var I,P,B,F=o[k],O=null,q=F>239?4:F>223?3:F>191?2:1;if(k+q>m)break;q===1?F<128&&(O=F):q===2?(192&(I=o[k+1]))==128&&(O=(31&F)<<6|63&I)<=127&&(O=null):q===3?(P=o[k+2],(192&(I=o[k+1]))==128&&(192&P)==128&&((O=(15&F)<<12|(63&I)<<6|63&P)<=2047||O>=55296&&O<=57343)&&(O=null)):q===4&&(P=o[k+2],B=o[k+3],(192&(I=o[k+1]))==128&&(192&P)==128&&(192&B)==128&&((O=(15&F)<<18|(63&I)<<12|(63&P)<<6|63&B)<=65535||O>=1114112)&&(O=null)),O===null?(O=65533,q=1):O>65535&&(O-=65536,w+=String.fromCharCode(O>>>10&1023|55296),O=56320|1023&O),w+=String.fromCharCode(O),k+=q}return w}(this.buf,e,r)},readBytes:function(){var r=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,r);return this.pos=r,e},readPackedVarint:function(r,e){if(this.type!==mi.Bytes)return r.push(this.readVarint(e));var o=Po(this);for(r=r||[];this.pos<o;)r.push(this.readVarint(e));return r},readPackedSVarint:function(r){if(this.type!==mi.Bytes)return r.push(this.readSVarint());var e=Po(this);for(r=r||[];this.pos<e;)r.push(this.readSVarint());return r},readPackedBoolean:function(r){if(this.type!==mi.Bytes)return r.push(this.readBoolean());var e=Po(this);for(r=r||[];this.pos<e;)r.push(this.readBoolean());return r},readPackedFloat:function(r){if(this.type!==mi.Bytes)return r.push(this.readFloat());var e=Po(this);for(r=r||[];this.pos<e;)r.push(this.readFloat());return r},readPackedDouble:function(r){if(this.type!==mi.Bytes)return r.push(this.readDouble());var e=Po(this);for(r=r||[];this.pos<e;)r.push(this.readDouble());return r},readPackedFixed32:function(r){if(this.type!==mi.Bytes)return r.push(this.readFixed32());var e=Po(this);for(r=r||[];this.pos<e;)r.push(this.readFixed32());return r},readPackedSFixed32:function(r){if(this.type!==mi.Bytes)return r.push(this.readSFixed32());var e=Po(this);for(r=r||[];this.pos<e;)r.push(this.readSFixed32());return r},readPackedFixed64:function(r){if(this.type!==mi.Bytes)return r.push(this.readFixed64());var e=Po(this);for(r=r||[];this.pos<e;)r.push(this.readFixed64());return r},readPackedSFixed64:function(r){if(this.type!==mi.Bytes)return r.push(this.readSFixed64());var e=Po(this);for(r=r||[];this.pos<e;)r.push(this.readSFixed64());return r},skip:function(r){var e=7&r;if(e===mi.Varint)for(;this.buf[this.pos++]>127;);else if(e===mi.Bytes)this.pos=this.readVarint()+this.pos;else if(e===mi.Fixed32)this.pos+=4;else{if(e!==mi.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(r,e){this.writeVarint(r<<3|e)},realloc:function(r){for(var e=this.length||16;e<this.pos+r;)e*=2;if(e!==this.length){var o=new Uint8Array(e);o.set(this.buf),this.buf=o,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(r){this.realloc(4),zl(this.buf,r,this.pos),this.pos+=4},writeSFixed32:function(r){this.realloc(4),zl(this.buf,r,this.pos),this.pos+=4},writeFixed64:function(r){this.realloc(8),zl(this.buf,-1&r,this.pos),zl(this.buf,Math.floor(r*w0),this.pos+4),this.pos+=8},writeSFixed64:function(r){this.realloc(8),zl(this.buf,-1&r,this.pos),zl(this.buf,Math.floor(r*w0),this.pos+4),this.pos+=8},writeVarint:function(r){(r=+r||0)>268435455||r<0?function(e,o){var u,m;if(e>=0?(u=e%4294967296|0,m=e/4294967296|0):(m=~(-e/4294967296),4294967295^(u=~(-e%4294967296))?u=u+1|0:(u=0,m=m+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");o.realloc(10),function(w,k,I){I.buf[I.pos++]=127&w|128,w>>>=7,I.buf[I.pos++]=127&w|128,w>>>=7,I.buf[I.pos++]=127&w|128,w>>>=7,I.buf[I.pos++]=127&w|128,I.buf[I.pos]=127&(w>>>=7)}(u,0,o),function(w,k){var I=(7&w)<<4;k.buf[k.pos++]|=I|((w>>>=3)?128:0),w&&(k.buf[k.pos++]=127&w|((w>>>=7)?128:0),w&&(k.buf[k.pos++]=127&w|((w>>>=7)?128:0),w&&(k.buf[k.pos++]=127&w|((w>>>=7)?128:0),w&&(k.buf[k.pos++]=127&w|((w>>>=7)?128:0),w&&(k.buf[k.pos++]=127&w)))))}(m,o)}(r,this):(this.realloc(4),this.buf[this.pos++]=127&r|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=r>>>7&127))))},writeSVarint:function(r){this.writeVarint(r<0?2*-r-1:2*r)},writeBoolean:function(r){this.writeVarint(!!r)},writeString:function(r){r=String(r),this.realloc(4*r.length),this.pos++;var e=this.pos;this.pos=function(u,m,w){for(var k,I,P=0;P<m.length;P++){if((k=m.charCodeAt(P))>55295&&k<57344){if(!I){k>56319||P+1===m.length?(u[w++]=239,u[w++]=191,u[w++]=189):I=k;continue}if(k<56320){u[w++]=239,u[w++]=191,u[w++]=189,I=k;continue}k=I-55296<<10|k-56320|65536,I=null}else I&&(u[w++]=239,u[w++]=191,u[w++]=189,I=null);k<128?u[w++]=k:(k<2048?u[w++]=k>>6|192:(k<65536?u[w++]=k>>12|224:(u[w++]=k>>18|240,u[w++]=k>>12&63|128),u[w++]=k>>6&63|128),u[w++]=63&k|128)}return w}(this.buf,r,this.pos);var o=this.pos-e;o>=128&&E0(e,o,this),this.pos=e-1,this.writeVarint(o),this.pos+=o},writeFloat:function(r){this.realloc(4),b0(this.buf,r,this.pos,!0,23,4),this.pos+=4},writeDouble:function(r){this.realloc(8),b0(this.buf,r,this.pos,!0,52,8),this.pos+=8},writeBytes:function(r){var e=r.length;this.writeVarint(e),this.realloc(e);for(var o=0;o<e;o++)this.buf[this.pos++]=r[o]},writeRawMessage:function(r,e){this.pos++;var o=this.pos;r(e,this);var u=this.pos-o;u>=128&&E0(o,u,this),this.pos=o-1,this.writeVarint(u),this.pos+=u},writeMessage:function(r,e,o){this.writeTag(r,mi.Bytes),this.writeRawMessage(e,o)},writePackedVarint:function(r,e){e.length&&this.writeMessage(r,Rm,e)},writePackedSVarint:function(r,e){e.length&&this.writeMessage(r,Fm,e)},writePackedBoolean:function(r,e){e.length&&this.writeMessage(r,Nm,e)},writePackedFloat:function(r,e){e.length&&this.writeMessage(r,Om,e)},writePackedDouble:function(r,e){e.length&&this.writeMessage(r,Vm,e)},writePackedFixed32:function(r,e){e.length&&this.writeMessage(r,Um,e)},writePackedSFixed32:function(r,e){e.length&&this.writeMessage(r,Gm,e)},writePackedFixed64:function(r,e){e.length&&this.writeMessage(r,jm,e)},writePackedSFixed64:function(r,e){e.length&&this.writeMessage(r,qm,e)},writeBytesField:function(r,e){this.writeTag(r,mi.Bytes),this.writeBytes(e)},writeFixed32Field:function(r,e){this.writeTag(r,mi.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(r,e){this.writeTag(r,mi.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(r,e){this.writeTag(r,mi.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(r,e){this.writeTag(r,mi.Fixed64),this.writeSFixed64(e)},writeVarintField:function(r,e){this.writeTag(r,mi.Varint),this.writeVarint(e)},writeSVarintField:function(r,e){this.writeTag(r,mi.Varint),this.writeSVarint(e)},writeStringField:function(r,e){this.writeTag(r,mi.Bytes),this.writeString(e)},writeFloatField:function(r,e){this.writeTag(r,mi.Fixed32),this.writeFloat(e)},writeDoubleField:function(r,e){this.writeTag(r,mi.Fixed64),this.writeDouble(e)},writeBooleanField:function(r,e){this.writeVarintField(r,!!e)}};var uc=R(v0);const cc=3;function Zm(r,e,o){r===1&&o.readMessage(Qm,e)}function Qm(r,e,o){if(r===3){const{id:u,bitmap:m,width:w,height:k,left:I,top:P,advance:B}=o.readMessage($m,{});e.push({id:u,bitmap:new sA({width:w+2*cc,height:k+2*cc},m),metrics:{width:w,height:k,left:I,top:P,advance:B}})}}function $m(r,e,o){r===1?e.id=o.readVarint():r===2?e.bitmap=o.readBytes():r===3?e.width=o.readVarint():r===4?e.height=o.readVarint():r===5?e.left=o.readSVarint():r===6?e.top=o.readSVarint():r===7&&(e.advance=o.readVarint())}const T0=cc;function I0(r){let e=0,o=0;for(const k of r)e+=k.w*k.h,o=Math.max(o,k.w);r.sort((k,I)=>I.h-k.h);const u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),o),h:1/0}];let m=0,w=0;for(const k of r)for(let I=u.length-1;I>=0;I--){const P=u[I];if(!(k.w>P.w||k.h>P.h)){if(k.x=P.x,k.y=P.y,w=Math.max(w,k.y+k.h),m=Math.max(m,k.x+k.w),k.w===P.w&&k.h===P.h){const B=u.pop();I<u.length&&(u[I]=B)}else k.h===P.h?(P.x+=k.w,P.w-=k.w):k.w===P.w?(P.y+=k.h,P.h-=k.h):(u.push({x:P.x+k.w,y:P.y,w:P.w-k.w,h:k.h}),P.y+=k.h,P.h-=k.h);break}}return{w:m,h:w,fill:e/(m*w)||0}}const rn=1;class hc{constructor(e,{pixelRatio:o,version:u,stretchX:m,stretchY:w,content:k}){this.paddedRect=e,this.pixelRatio=o,this.stretchX=m,this.stretchY=w,this.content=k,this.version=u}get tl(){return[this.paddedRect.x+rn,this.paddedRect.y+rn]}get br(){return[this.paddedRect.x+this.paddedRect.w-rn,this.paddedRect.y+this.paddedRect.h-rn]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*rn)/this.pixelRatio,(this.paddedRect.h-2*rn)/this.pixelRatio]}}class M0{constructor(e,o){const u={},m={};this.haveRenderCallbacks=[];const w=[];this.addImages(e,u,w),this.addImages(o,m,w);const{w:k,h:I}=I0(w),P=new Pn({width:k||1,height:I||1});for(const B in e){const F=e[B],O=u[B].paddedRect;Pn.copy(F.data,P,{x:0,y:0},{x:O.x+rn,y:O.y+rn},F.data)}for(const B in o){const F=o[B],O=m[B].paddedRect,q=O.x+rn,W=O.y+rn,Y=F.data.width,re=F.data.height;Pn.copy(F.data,P,{x:0,y:0},{x:q,y:W},F.data),Pn.copy(F.data,P,{x:0,y:re-1},{x:q,y:W-1},{width:Y,height:1}),Pn.copy(F.data,P,{x:0,y:0},{x:q,y:W+re},{width:Y,height:1}),Pn.copy(F.data,P,{x:Y-1,y:0},{x:q-1,y:W},{width:1,height:re}),Pn.copy(F.data,P,{x:0,y:0},{x:q+Y,y:W},{width:1,height:re})}this.image=P,this.iconPositions=u,this.patternPositions=m}addImages(e,o,u){for(const m in e){const w=e[m],k={x:0,y:0,w:w.data.width+2*rn,h:w.data.height+2*rn};u.push(k),o[m]=new hc(k,w),w.hasRenderCallback&&this.haveRenderCallbacks.push(m)}}patchUpdatedImages(e,o){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const u in e.updatedImages)this.patchUpdatedImage(this.iconPositions[u],e.getImage(u),o),this.patchUpdatedImage(this.patternPositions[u],e.getImage(u),o)}patchUpdatedImage(e,o,u){if(!e||!o||e.version===o.version)return;e.version=o.version;const[m,w]=e.tl;u.update(o.data,void 0,{x:m,y:w})}}var ua;st("ImagePosition",hc),st("ImageAtlas",M0),h.ai=void 0,(ua=h.ai||(h.ai={}))[ua.none=0]="none",ua[ua.horizontal=1]="horizontal",ua[ua.vertical=2]="vertical",ua[ua.horizontalOnly=3]="horizontalOnly";const fA=-17;class dA{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,o){const u=new dA;return u.scale=e||1,u.fontStack=o,u}static forImage(e){const o=new dA;return o.imageName=e,o}}class Ll{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,o){const u=new Ll;for(let m=0;m<e.sections.length;m++){const w=e.sections[m];w.image?u.addImageSection(w):u.addTextSection(w,o)}return u}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let o="";for(let u=0;u<e.length;u++){const m=e.charCodeAt(u+1)||null,w=e.charCodeAt(u-1)||null;o+=m&&Ra(m)&&!hA[e[u+1]]||w&&Ra(w)&&!hA[e[u-1]]||!hA[e[u]]?e[u]:hA[e[u]]}return o}(this.text)}trim(){let e=0;for(let u=0;u<this.text.length&&WA[this.text.charCodeAt(u)];u++)e++;let o=this.text.length;for(let u=this.text.length-1;u>=0&&u>=e&&WA[this.text.charCodeAt(u)];u--)o--;this.text=this.text.substring(e,o),this.sectionIndex=this.sectionIndex.slice(e,o)}substring(e,o){const u=new Ll;return u.text=this.text.substring(e,o),u.sectionIndex=this.sectionIndex.slice(e,o),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,o)=>Math.max(e,this.sections[o].scale),0)}addTextSection(e,o){this.text+=e.text,this.sections.push(dA.forText(e.scale,e.fontStack||o));const u=this.sections.length-1;for(let m=0;m<e.text.length;++m)this.sectionIndex.push(u)}addImageSection(e){const o=e.image?e.image.name:"";if(o.length===0)return void si("Can't add FormattedSection with an empty image.");const u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCharCode(u),this.sections.push(dA.forImage(o)),this.sectionIndex.push(this.sections.length-1)):si("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function HA(r,e,o,u,m,w,k,I,P,B,F,O,q,W,Y,re){const ue=Ll.fromFeature(r,m);let me;O===h.ai.vertical&&ue.verticalizePunctuation();const{processBidirectionalText:ke,processStyledBidirectionalText:ye}=Tr;if(ke&&ue.sections.length===1){me=[];const Re=ke(ue.toString(),fc(ue,B,w,e,u,W,Y));for(const it of Re){const ct=new Ll;ct.text=it,ct.sections=ue.sections;for(let tt=0;tt<it.length;tt++)ct.sectionIndex.push(0);me.push(ct)}}else if(ye){me=[];const Re=ye(ue.text,ue.sectionIndex,fc(ue,B,w,e,u,W,Y));for(const it of Re){const ct=new Ll;ct.text=it[0],ct.sectionIndex=it[1],ct.sections=ue.sections,me.push(ct)}}else me=function(Re,it){const ct=[],tt=Re.text;let Xe=0;for(const Qe of it)ct.push(Re.substring(Xe,Qe)),Xe=Qe;return Xe<tt.length&&ct.push(Re.substring(Xe,tt.length)),ct}(ue,fc(ue,B,w,e,u,W,Y));const Se=[],Ie={positionedLines:Se,text:ue.toString(),top:F[1],bottom:F[1],left:F[0],right:F[0],writingMode:O,iconsInText:!1,verticalizable:!1};return function(Re,it,ct,tt,Xe,Qe,lt,He,Ne,bt,pt,jt){let ki=0,Ii=fA,er=0,pn=0;const jr=He==="right"?1:He==="left"?0:.5;let Hi=0;for(const tr of Xe){tr.trim();const ir=tr.getMaxScale(),Mr=(ir-1)*Ji,Qr={positionedGlyphs:[],lineOffset:0};Re.positionedLines[Hi]=Qr;const Cr=Qr.positionedGlyphs;let nn=0;if(!tr.length()){Ii+=Qe,++Hi;continue}for(let rr=0;rr<tr.length();rr++){const Yt=tr.getSection(rr),Pr=tr.getSectionIndex(rr),wr=tr.getCharCode(rr);let nr=0,Xn=null,ps=null,ms=null,Do=Ji;const Yn=!(Ne===h.ai.horizontal||!pt&&!sa(wr)||pt&&(WA[wr]||(fr=wr,Je.Arabic(fr)||Je["Arabic Supplement"](fr)||Je["Arabic Extended-A"](fr)||Je["Arabic Presentation Forms-A"](fr)||Je["Arabic Presentation Forms-B"](fr))));if(Yt.imageName){const Bn=tt[Yt.imageName];if(!Bn)continue;ms=Yt.imageName,Re.iconsInText=Re.iconsInText||!0,ps=Bn.paddedRect;const on=Bn.displaySize;Yt.scale=Yt.scale*Ji/jt,Xn={width:on[0],height:on[1],left:rn,top:-T0,advance:Yn?on[1]:on[0]},nr=Mr+(Ji-on[1]*Yt.scale),Do=Xn.advance;const Bo=Yn?on[0]*Yt.scale-Ji*ir:on[1]*Yt.scale-Ji*ir;Bo>0&&Bo>nn&&(nn=Bo)}else{const Bn=ct[Yt.fontStack],on=Bn&&Bn[wr];if(on&&on.rect)ps=on.rect,Xn=on.metrics;else{const Bo=it[Yt.fontStack],yA=Bo&&Bo[wr];if(!yA)continue;Xn=yA.metrics}nr=(ir-Yt.scale)*Ji}Yn?(Re.verticalizable=!0,Cr.push({glyph:wr,imageName:ms,x:ki,y:Ii+nr,vertical:Yn,scale:Yt.scale,fontStack:Yt.fontStack,sectionIndex:Pr,metrics:Xn,rect:ps}),ki+=Do*Yt.scale+bt):(Cr.push({glyph:wr,imageName:ms,x:ki,y:Ii+nr,vertical:Yn,scale:Yt.scale,fontStack:Yt.fontStack,sectionIndex:Pr,metrics:Xn,rect:ps}),ki+=Xn.advance*Yt.scale+bt)}Cr.length!==0&&(er=Math.max(ki-bt,er),Xm(Cr,0,Cr.length-1,jr,nn)),ki=0;const sn=Qe*ir+nn;Qr.lineOffset=Math.max(nn,Mr),Ii+=sn,pn=Math.max(sn,pn),++Hi}var fr;const br=Ii-fA,{horizontalAlign:qr,verticalAlign:Zr}=dc(lt);(function(tr,ir,Mr,Qr,Cr,nn,sn,rr,Yt){const Pr=(ir-Mr)*Cr;let wr=0;wr=nn!==sn?-rr*Qr-fA:(-Qr*Yt+.5)*sn;for(const nr of tr)for(const Xn of nr.positionedGlyphs)Xn.x+=Pr,Xn.y+=wr})(Re.positionedLines,jr,qr,Zr,er,pn,Qe,br,Xe.length),Re.top+=-Zr*br,Re.bottom=Re.top+br,Re.left+=-qr*er,Re.right=Re.left+er}(Ie,e,o,u,me,k,I,P,O,B,q,re),!function(Re){for(const it of Re)if(it.positionedGlyphs.length!==0)return!1;return!0}(Se)&&Ie}const WA={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Hm={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function C0(r,e,o,u,m,w){if(e.imageName){const k=u[e.imageName];return k?k.displaySize[0]*e.scale*Ji/w+m:0}{const k=o[e.fontStack],I=k&&k[r];return I?I.metrics.advance*e.scale+m:0}}function P0(r,e,o,u){const m=Math.pow(r-e,2);return u?r<e?m/2:2*m:m+Math.abs(o)*o}function Wm(r,e,o){let u=0;return r===10&&(u-=1e4),o&&(u+=150),r!==40&&r!==65288||(u+=50),e!==41&&e!==65289||(u+=50),u}function D0(r,e,o,u,m,w){let k=null,I=P0(e,o,m,w);for(const P of u){const B=P0(e-P.x,o,m,w)+P.badness;B<=I&&(k=P,I=B)}return{index:r,x:e,priorBreak:k,badness:I}}function B0(r){return r?B0(r.priorBreak).concat(r.index):[]}function fc(r,e,o,u,m,w,k){if(w!=="point")return[];if(!r)return[];const I=[],P=function(q,W,Y,re,ue,me){let ke=0;for(let ye=0;ye<q.length();ye++){const Se=q.getSection(ye);ke+=C0(q.getCharCode(ye),Se,re,ue,W,me)}return ke/Math.max(1,Math.ceil(ke/Y))}(r,e,o,u,m,k),B=r.text.indexOf("​")>=0;let F=0;for(let q=0;q<r.length();q++){const W=r.getSection(q),Y=r.getCharCode(q);if(WA[Y]||(F+=C0(Y,W,u,m,e,k)),q<r.length()-1){const re=!((O=Y)<11904||!(Je["Bopomofo Extended"](O)||Je.Bopomofo(O)||Je["CJK Compatibility Forms"](O)||Je["CJK Compatibility Ideographs"](O)||Je["CJK Compatibility"](O)||Je["CJK Radicals Supplement"](O)||Je["CJK Strokes"](O)||Je["CJK Symbols and Punctuation"](O)||Je["CJK Unified Ideographs Extension A"](O)||Je["CJK Unified Ideographs"](O)||Je["Enclosed CJK Letters and Months"](O)||Je["Halfwidth and Fullwidth Forms"](O)||Je.Hiragana(O)||Je["Ideographic Description Characters"](O)||Je["Kangxi Radicals"](O)||Je["Katakana Phonetic Extensions"](O)||Je.Katakana(O)||Je["Vertical Forms"](O)||Je["Yi Radicals"](O)||Je["Yi Syllables"](O)));(Hm[Y]||re||W.imageName)&&I.push(D0(q+1,F,P,I,Wm(Y,r.getCharCode(q+1),re&&B),!1))}}var O;return B0(D0(r.length(),F,P,I,0,!0))}function dc(r){let e=.5,o=.5;switch(r){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":o=1;break;case"top":case"top-right":case"top-left":o=0}return{horizontalAlign:e,verticalAlign:o}}function Xm(r,e,o,u,m){if(!u&&!m)return;const w=r[o],k=(r[o].x+w.metrics.advance*w.scale)*u;for(let I=e;I<=o;I++)r[I].x-=k,r[I].y+=m}function Ym(r,e,o){const{horizontalAlign:u,verticalAlign:m}=dc(o),w=e[0]-r.displaySize[0]*u,k=e[1]-r.displaySize[1]*m;return{image:r,top:k,bottom:k+r.displaySize[1],left:w,right:w+r.displaySize[0]}}function z0(r,e,o,u,m,w){const k=r.image;let I;if(k.content){const ue=k.content,me=k.pixelRatio||1;I=[ue[0]/me,ue[1]/me,k.displaySize[0]-ue[2]/me,k.displaySize[1]-ue[3]/me]}const P=e.left*w,B=e.right*w;let F,O,q,W;o==="width"||o==="both"?(W=m[0]+P-u[3],O=m[0]+B+u[1]):(W=m[0]+(P+B-k.displaySize[0])/2,O=W+k.displaySize[0]);const Y=e.top*w,re=e.bottom*w;return o==="height"||o==="both"?(F=m[1]+Y-u[0],q=m[1]+re+u[2]):(F=m[1]+(Y+re-k.displaySize[1])/2,q=F+k.displaySize[1]),{image:k,top:F,right:O,bottom:q,left:W,collisionPadding:I}}const pA=255,Ws=128,ca=pA*Ws;function L0(r,e){const{expression:o}=e;if(o.kind==="constant")return{kind:"constant",layoutSize:o.evaluate(new yi(r+1))};if(o.kind==="source")return{kind:"source"};{const{zoomStops:u,interpolationType:m}=o;let w=0;for(;w<u.length&&u[w]<=r;)w++;w=Math.max(0,w-1);let k=w;for(;k<u.length&&u[k]<r+1;)k++;k=Math.min(u.length-1,k);const I=u[w],P=u[k];return o.kind==="composite"?{kind:"composite",minZoom:I,maxZoom:P,interpolationType:m}:{kind:"camera",minZoom:I,maxZoom:P,minSize:o.evaluate(new yi(I)),maxSize:o.evaluate(new yi(P)),interpolationType:m}}}function pc(r,e,o){let u="never";const m=r.get(e);return m?u=m:r.get(o)&&(u="always"),u}const Km=Aa.VectorTileFeature.types,Jm=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function XA(r,e,o,u,m,w,k,I,P,B,F,O,q){const W=I?Math.min(ca,Math.round(I[0])):0,Y=I?Math.min(ca,Math.round(I[1])):0;r.emplaceBack(e,o,Math.round(32*u),Math.round(32*m),w,k,(W<<1)+(P?1:0),Y,16*B,16*F,256*O,256*q)}function mc(r,e,o){r.emplaceBack(e.x,e.y,o),r.emplaceBack(e.x,e.y,o),r.emplaceBack(e.x,e.y,o),r.emplaceBack(e.x,e.y,o)}function eg(r){for(const e of r.sections)if(eA(e.text))return!0;return!1}class gc{constructor(e){this.layoutVertexArray=new at,this.indexArray=new Rt,this.programConfigurations=e,this.segments=new pi,this.dynamicLayoutVertexArray=new rt,this.opacityVertexArray=new et,this.hasVisibleVertices=!1,this.placedSymbolArray=new z}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,o,u,m){this.isEmpty()||(u&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Pm.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,o),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Dm.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Jm,!0),this.opacityVertexBuffer.itemSize=1),(u||m)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}st("SymbolBuffers",gc);class _c{constructor(e,o,u){this.layoutVertexArray=new e,this.layoutAttributes=o,this.indexArray=new u,this.segments=new pi,this.collisionVertexArray=new ut}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Bm.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}st("CollisionBuffers",_c);class Rl{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(k=>k.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Wu([]),this.placementViewportMatrix=Wu([]);const o=this.layers[0]._unevaluatedLayout._values;this.textSizeData=L0(this.zoom,o["text-size"]),this.iconSizeData=L0(this.zoom,o["icon-size"]);const u=this.layers[0].layout,m=u.get("symbol-sort-key"),w=u.get("symbol-z-order");this.canOverlap=pc(u,"text-overlap","text-allow-overlap")!=="never"||pc(u,"icon-overlap","icon-allow-overlap")!=="never"||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=w!=="viewport-y"&&!m.isConstant(),this.sortFeaturesByY=(w==="viewport-y"||w==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,u.get("symbol-placement")==="point"&&(this.writingModes=u.get("text-writing-mode").map(k=>h.ai[k])),this.stateDependentLayerIds=this.layers.filter(k=>k.isStateDependent()).map(k=>k.id),this.sourceID=e.sourceID}createArrays(){this.text=new gc(new ds(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new gc(new ds(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Z,this.lineVertexArray=new Q,this.symbolInstances=new N,this.textAnchorOffsets=new he}calculateGlyphDependencies(e,o,u,m,w){for(let k=0;k<e.length;k++)if(o[e.charCodeAt(k)]=!0,(u||m)&&w){const I=hA[e.charAt(k)];I&&(o[I.charCodeAt(0)]=!0)}}populate(e,o,u){const m=this.layers[0],w=m.layout,k=w.get("text-font"),I=w.get("text-field"),P=w.get("icon-image"),B=(I.value.kind!=="constant"||I.value.value instanceof Ci&&!I.value.value.isEmpty()||I.value.value.toString().length>0)&&(k.value.kind!=="constant"||k.value.value.length>0),F=P.value.kind!=="constant"||!!P.value.value||Object.keys(P.parameters).length>0,O=w.get("symbol-sort-key");if(this.features=[],!B&&!F)return;const q=o.iconDependencies,W=o.glyphDependencies,Y=o.availableImages,re=new yi(this.zoom);for(const{feature:ue,id:me,index:ke,sourceLayerIndex:ye}of e){const Se=m._featureFilter.needGeometry,Ie=Za(ue,Se);if(!m._featureFilter.filter(re,Ie,u))continue;let Re,it;if(Se||(Ie.geometry=qa(ue)),B){const tt=m.getValueAndResolveTokens("text-field",Ie,u,Y),Xe=Ci.factory(tt);eg(Xe)&&(this.hasRTLText=!0),(!this.hasRTLText||oa()==="unavailable"||this.hasRTLText&&Tr.isParsed())&&(Re=Lm(Xe,m,Ie))}if(F){const tt=m.getValueAndResolveTokens("icon-image",Ie,u,Y);it=tt instanceof qi?tt:qi.fromString(tt)}if(!Re&&!it)continue;const ct=this.sortFeaturesByKey?O.evaluate(Ie,{},u):void 0;if(this.features.push({id:me,text:Re,icon:it,index:ke,sourceLayerIndex:ye,geometry:Ie.geometry,properties:ue.properties,type:Km[ue.type],sortKey:ct}),it&&(q[it.name]=!0),Re){const tt=k.evaluate(Ie,{},u).join(","),Xe=w.get("text-rotation-alignment")!=="viewport"&&w.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(h.ai.vertical)>=0;for(const Qe of Re.sections)if(Qe.image)q[Qe.image.name]=!0;else{const lt=za(Re.toString()),He=Qe.fontStack||tt,Ne=W[He]=W[He]||{};this.calculateGlyphDependencies(Qe.text,Ne,Xe,this.allowVerticalPlacement,lt)}}}w.get("symbol-placement")==="line"&&(this.features=function(ue){const me={},ke={},ye=[];let Se=0;function Ie(tt){ye.push(ue[tt]),Se++}function Re(tt,Xe,Qe){const lt=ke[tt];return delete ke[tt],ke[Xe]=lt,ye[lt].geometry[0].pop(),ye[lt].geometry[0]=ye[lt].geometry[0].concat(Qe[0]),lt}function it(tt,Xe,Qe){const lt=me[Xe];return delete me[Xe],me[tt]=lt,ye[lt].geometry[0].shift(),ye[lt].geometry[0]=Qe[0].concat(ye[lt].geometry[0]),lt}function ct(tt,Xe,Qe){const lt=Qe?Xe[0][Xe[0].length-1]:Xe[0][0];return`${tt}:${lt.x}:${lt.y}`}for(let tt=0;tt<ue.length;tt++){const Xe=ue[tt],Qe=Xe.geometry,lt=Xe.text?Xe.text.toString():null;if(!lt){Ie(tt);continue}const He=ct(lt,Qe),Ne=ct(lt,Qe,!0);if(He in ke&&Ne in me&&ke[He]!==me[Ne]){const bt=it(He,Ne,Qe),pt=Re(He,Ne,ye[bt].geometry);delete me[He],delete ke[Ne],ke[ct(lt,ye[pt].geometry,!0)]=pt,ye[bt].geometry=null}else He in ke?Re(He,Ne,Qe):Ne in me?it(He,Ne,Qe):(Ie(tt),me[He]=Se-1,ke[Ne]=Se-1)}return ye.filter(tt=>tt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ue,me)=>ue.sortKey-me.sortKey)}update(e,o,u){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,o,this.layers,u),this.icon.programConfigurations.updatePaintArrays(e,o,this.layers,u))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,o){const u=this.lineVertexArray.length;if(e.segment!==void 0){let m=e.dist(o[e.segment+1]),w=e.dist(o[e.segment]);const k={};for(let I=e.segment+1;I<o.length;I++)k[I]={x:o[I].x,y:o[I].y,tileUnitDistanceFromAnchor:m},I<o.length-1&&(m+=o[I+1].dist(o[I]));for(let I=e.segment||0;I>=0;I--)k[I]={x:o[I].x,y:o[I].y,tileUnitDistanceFromAnchor:w},I>0&&(w+=o[I-1].dist(o[I]));for(let I=0;I<o.length;I++){const P=k[I];this.lineVertexArray.emplaceBack(P.x,P.y,P.tileUnitDistanceFromAnchor)}}return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(e,o,u,m,w,k,I,P,B,F,O,q){const W=e.indexArray,Y=e.layoutVertexArray,re=e.segments.prepareSegment(4*o.length,Y,W,this.canOverlap?k.sortKey:void 0),ue=this.glyphOffsetArray.length,me=re.vertexLength,ke=this.allowVerticalPlacement&&I===h.ai.vertical?Math.PI/2:0,ye=k.text&&k.text.sections;for(let Se=0;Se<o.length;Se++){const{tl:Ie,tr:Re,bl:it,br:ct,tex:tt,pixelOffsetTL:Xe,pixelOffsetBR:Qe,minFontScaleX:lt,minFontScaleY:He,glyphOffset:Ne,isSDF:bt,sectionIndex:pt}=o[Se],jt=re.vertexLength,ki=Ne[1];XA(Y,P.x,P.y,Ie.x,ki+Ie.y,tt.x,tt.y,u,bt,Xe.x,Xe.y,lt,He),XA(Y,P.x,P.y,Re.x,ki+Re.y,tt.x+tt.w,tt.y,u,bt,Qe.x,Xe.y,lt,He),XA(Y,P.x,P.y,it.x,ki+it.y,tt.x,tt.y+tt.h,u,bt,Xe.x,Qe.y,lt,He),XA(Y,P.x,P.y,ct.x,ki+ct.y,tt.x+tt.w,tt.y+tt.h,u,bt,Qe.x,Qe.y,lt,He),mc(e.dynamicLayoutVertexArray,P,ke),W.emplaceBack(jt,jt+1,jt+2),W.emplaceBack(jt+1,jt+2,jt+3),re.vertexLength+=4,re.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ne[0]),Se!==o.length-1&&pt===o[Se+1].sectionIndex||e.programConfigurations.populatePaintArrays(Y.length,k,k.index,{},q,ye&&ye[pt])}e.placedSymbolArray.emplaceBack(P.x,P.y,ue,this.glyphOffsetArray.length-ue,me,B,F,P.segment,u?u[0]:0,u?u[1]:0,m[0],m[1],I,0,!1,0,O)}_addCollisionDebugVertex(e,o,u,m,w,k){return o.emplaceBack(0,0),e.emplaceBack(u.x,u.y,m,w,Math.round(k.x),Math.round(k.y))}addCollisionDebugVertices(e,o,u,m,w,k,I){const P=w.segments.prepareSegment(4,w.layoutVertexArray,w.indexArray),B=P.vertexLength,F=w.layoutVertexArray,O=w.collisionVertexArray,q=I.anchorX,W=I.anchorY;this._addCollisionDebugVertex(F,O,k,q,W,new K(e,o)),this._addCollisionDebugVertex(F,O,k,q,W,new K(u,o)),this._addCollisionDebugVertex(F,O,k,q,W,new K(u,m)),this._addCollisionDebugVertex(F,O,k,q,W,new K(e,m)),P.vertexLength+=4;const Y=w.indexArray;Y.emplaceBack(B,B+1),Y.emplaceBack(B+1,B+2),Y.emplaceBack(B+2,B+3),Y.emplaceBack(B+3,B),P.primitiveLength+=4}addDebugCollisionBoxes(e,o,u,m){for(let w=e;w<o;w++){const k=this.collisionBoxArray.get(w);this.addCollisionDebugVertices(k.x1,k.y1,k.x2,k.y2,m?this.textCollisionBox:this.iconCollisionBox,k.anchorPoint,u)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new _c(ft,y0.members,dt),this.iconCollisionBox=new _c(ft,y0.members,dt);for(let e=0;e<this.symbolInstances.length;e++){const o=this.symbolInstances.get(e);this.addDebugCollisionBoxes(o.textBoxStartIndex,o.textBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.iconBoxStartIndex,o.iconBoxEndIndex,o,!1),this.addDebugCollisionBoxes(o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o,!1)}}_deserializeCollisionBoxesForSymbol(e,o,u,m,w,k,I,P,B){const F={};for(let O=o;O<u;O++){const q=e.get(O);F.textBox={x1:q.x1,y1:q.y1,x2:q.x2,y2:q.y2,anchorPointX:q.anchorPointX,anchorPointY:q.anchorPointY},F.textFeatureIndex=q.featureIndex;break}for(let O=m;O<w;O++){const q=e.get(O);F.verticalTextBox={x1:q.x1,y1:q.y1,x2:q.x2,y2:q.y2,anchorPointX:q.anchorPointX,anchorPointY:q.anchorPointY},F.verticalTextFeatureIndex=q.featureIndex;break}for(let O=k;O<I;O++){const q=e.get(O);F.iconBox={x1:q.x1,y1:q.y1,x2:q.x2,y2:q.y2,anchorPointX:q.anchorPointX,anchorPointY:q.anchorPointY},F.iconFeatureIndex=q.featureIndex;break}for(let O=P;O<B;O++){const q=e.get(O);F.verticalIconBox={x1:q.x1,y1:q.y1,x2:q.x2,y2:q.y2,anchorPointX:q.anchorPointX,anchorPointY:q.anchorPointY},F.verticalIconFeatureIndex=q.featureIndex;break}return F}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let o=0;o<this.symbolInstances.length;o++){const u=this.symbolInstances.get(o);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,o){const u=e.placedSymbolArray.get(o),m=u.vertexStartIndex+4*u.numGlyphs;for(let w=u.vertexStartIndex;w<m;w+=4)e.indexArray.emplaceBack(w,w+1,w+2),e.indexArray.emplaceBack(w+1,w+2,w+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const o=Math.sin(e),u=Math.cos(e),m=[],w=[],k=[];for(let I=0;I<this.symbolInstances.length;++I){k.push(I);const P=this.symbolInstances.get(I);m.push(0|Math.round(o*P.anchorX+u*P.anchorY)),w.push(P.featureIndex)}return k.sort((I,P)=>m[I]-m[P]||w[P]-w[I]),k}addToSortKeyRanges(e,o){const u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===o?u.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:o,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const o of this.symbolInstanceIndexes){const u=this.symbolInstances.get(o);this.featureSortOrder.push(u.featureIndex),[u.rightJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.leftJustifiedTextSymbolIndex].forEach((m,w,k)=>{m>=0&&k.indexOf(m)===w&&this.addIndicesForPlacedSymbol(this.text,m)}),u.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,u.verticalPlacedTextSymbolIndex),u.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,u.placedIconSymbolIndex),u.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,u.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let R0,F0;st("SymbolBucket",Rl,{omit:["layers","collisionBoxArray","features","compareText"]}),Rl.MAX_GLYPHS=65535,Rl.addDynamicAttributes=mc;var yc={get paint(){return F0=F0||new Di({"icon-opacity":new wt(ze.paint_symbol["icon-opacity"]),"icon-color":new wt(ze.paint_symbol["icon-color"]),"icon-halo-color":new wt(ze.paint_symbol["icon-halo-color"]),"icon-halo-width":new wt(ze.paint_symbol["icon-halo-width"]),"icon-halo-blur":new wt(ze.paint_symbol["icon-halo-blur"]),"icon-translate":new ht(ze.paint_symbol["icon-translate"]),"icon-translate-anchor":new ht(ze.paint_symbol["icon-translate-anchor"]),"text-opacity":new wt(ze.paint_symbol["text-opacity"]),"text-color":new wt(ze.paint_symbol["text-color"],{runtimeType:Xi,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new wt(ze.paint_symbol["text-halo-color"]),"text-halo-width":new wt(ze.paint_symbol["text-halo-width"]),"text-halo-blur":new wt(ze.paint_symbol["text-halo-blur"]),"text-translate":new ht(ze.paint_symbol["text-translate"]),"text-translate-anchor":new ht(ze.paint_symbol["text-translate-anchor"])})},get layout(){return R0=R0||new Di({"symbol-placement":new ht(ze.layout_symbol["symbol-placement"]),"symbol-spacing":new ht(ze.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ht(ze.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new wt(ze.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ht(ze.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ht(ze.layout_symbol["icon-allow-overlap"]),"icon-overlap":new ht(ze.layout_symbol["icon-overlap"]),"icon-ignore-placement":new ht(ze.layout_symbol["icon-ignore-placement"]),"icon-optional":new ht(ze.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ht(ze.layout_symbol["icon-rotation-alignment"]),"icon-size":new wt(ze.layout_symbol["icon-size"]),"icon-text-fit":new ht(ze.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ht(ze.layout_symbol["icon-text-fit-padding"]),"icon-image":new wt(ze.layout_symbol["icon-image"]),"icon-rotate":new wt(ze.layout_symbol["icon-rotate"]),"icon-padding":new wt(ze.layout_symbol["icon-padding"]),"icon-keep-upright":new ht(ze.layout_symbol["icon-keep-upright"]),"icon-offset":new wt(ze.layout_symbol["icon-offset"]),"icon-anchor":new wt(ze.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ht(ze.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ht(ze.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ht(ze.layout_symbol["text-rotation-alignment"]),"text-field":new wt(ze.layout_symbol["text-field"]),"text-font":new wt(ze.layout_symbol["text-font"]),"text-size":new wt(ze.layout_symbol["text-size"]),"text-max-width":new wt(ze.layout_symbol["text-max-width"]),"text-line-height":new ht(ze.layout_symbol["text-line-height"]),"text-letter-spacing":new wt(ze.layout_symbol["text-letter-spacing"]),"text-justify":new wt(ze.layout_symbol["text-justify"]),"text-radial-offset":new wt(ze.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ht(ze.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new wt(ze.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new wt(ze.layout_symbol["text-anchor"]),"text-max-angle":new ht(ze.layout_symbol["text-max-angle"]),"text-writing-mode":new ht(ze.layout_symbol["text-writing-mode"]),"text-rotate":new wt(ze.layout_symbol["text-rotate"]),"text-padding":new ht(ze.layout_symbol["text-padding"]),"text-keep-upright":new ht(ze.layout_symbol["text-keep-upright"]),"text-transform":new wt(ze.layout_symbol["text-transform"]),"text-offset":new wt(ze.layout_symbol["text-offset"]),"text-allow-overlap":new ht(ze.layout_symbol["text-allow-overlap"]),"text-overlap":new ht(ze.layout_symbol["text-overlap"]),"text-ignore-placement":new ht(ze.layout_symbol["text-ignore-placement"]),"text-optional":new ht(ze.layout_symbol["text-optional"])})}};class O0{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:un,this.defaultValue=e}evaluate(e){if(e.formattedSection){const o=this.defaultValue.property.overrides;if(o&&o.hasOverride(e.formattedSection))return o.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}st("FormatSectionOverride",O0,{omit:["defaultValue"]});class YA extends Bi{constructor(e){super(e,yc)}recalculate(e,o){if(super.recalculate(e,o),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const u=this.layout.get("text-writing-mode");if(u){const m=[];for(const w of u)m.indexOf(w)<0&&m.push(w);this.layout._values["text-writing-mode"]=m}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,o,u,m){const w=this.layout.get(e).evaluate(o,{},u,m),k=this._unevaluatedLayout._values[e];return k.isDataDriven()||Fs(k.value)||!w?w:function(I,P){return P.replace(/{([^{}]+)}/g,(B,F)=>I&&F in I?String(I[F]):"")}(o.properties,w)}createBucket(e){return new Rl(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of yc.paint.overridableProperties){if(!YA.hasPaintOverride(this.layout,e))continue;const o=this.paint.get(e),u=new O0(o),m=new Ko(u,o.property.specification);let w=null;w=o.value.kind==="constant"||o.value.kind==="source"?new Vs("source",m):new ai("composite",m,o.value.zoomStops),this.paint._values[e]=new or(o.property,w,o.parameters)}}_handleOverridablePaintPropertyUpdate(e,o,u){return!(!this.layout||o.isDataDriven()||u.isDataDriven())&&YA.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,o){const u=e.get("text-field"),m=yc.paint.properties[o];let w=!1;const k=I=>{for(const P of I)if(m.overrides&&m.overrides.hasOverride(P))return void(w=!0)};if(u.value.kind==="constant"&&u.value.value instanceof Ci)k(u.value.value.sections);else if(u.value.kind==="source"){const I=B=>{w||(B instanceof J&&xi(B.value)===ae?k(B.value.sections):B instanceof po?k(B.sections):B.eachChild(I))},P=u.value;P._styleExpression&&I(P._styleExpression.expression)}return w}}let V0;var tg={get paint(){return V0=V0||new Di({"background-color":new ht(ze.paint_background["background-color"]),"background-pattern":new Ga(ze.paint_background["background-pattern"]),"background-opacity":new ht(ze.paint_background["background-opacity"])})}};class ig extends Bi{constructor(e){super(e,tg)}}let N0;var rg={get paint(){return N0=N0||new Di({"raster-opacity":new ht(ze.paint_raster["raster-opacity"]),"raster-hue-rotate":new ht(ze.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ht(ze.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ht(ze.paint_raster["raster-brightness-max"]),"raster-saturation":new ht(ze.paint_raster["raster-saturation"]),"raster-contrast":new ht(ze.paint_raster["raster-contrast"]),"raster-resampling":new ht(ze.paint_raster["raster-resampling"]),"raster-fade-duration":new ht(ze.paint_raster["raster-fade-duration"])})}};class ng extends Bi{constructor(e){super(e,rg)}}class sg extends Bi{constructor(e){super(e,{}),this.onAdd=o=>{this.implementation.onAdd&&this.implementation.onAdd(o,o.painter.context.gl)},this.onRemove=o=>{this.implementation.onRemove&&this.implementation.onRemove(o,o.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class og{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const vc=63710088e-1;class ha{constructor(e,o){if(isNaN(e)||isNaN(o))throw new Error(`Invalid LngLat object: (${e}, ${o})`);if(this.lng=+e,this.lat=+o,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ha(Ot(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const o=Math.PI/180,u=this.lat*o,m=e.lat*o,w=Math.sin(u)*Math.sin(m)+Math.cos(u)*Math.cos(m)*Math.cos((e.lng-this.lng)*o);return vc*Math.acos(Math.min(w,1))}static convert(e){if(e instanceof ha)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new ha(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new ha(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const U0=2*Math.PI*vc;function G0(r){return U0*Math.cos(r*Math.PI/180)}function j0(r){return(180+r)/360}function q0(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function Z0(r,e){return r/G0(e)}function Q0(r){return 360*r-180}function xc(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}class KA{constructor(e,o,u=0){this.x=+e,this.y=+o,this.z=+u}static fromLngLat(e,o=0){const u=ha.convert(e);return new KA(j0(u.lng),q0(u.lat),Z0(o,u.lat))}toLngLat(){return new ha(Q0(this.x),xc(this.y))}toAltitude(){return this.z*G0(xc(this.y))}meterInMercatorCoordinateUnits(){return 1/U0*(e=xc(this.y),1/Math.cos(e*Math.PI/180));var e}}function $0(r,e,o){var u=2*Math.PI*6378137/256/Math.pow(2,o);return[r*u-2*Math.PI*6378137/2,e*u-2*Math.PI*6378137/2]}class bc{constructor(e,o,u){if(e<0||e>25||u<0||u>=Math.pow(2,e)||o<0||o>=Math.pow(2,e))throw new Error(`x=${o}, y=${u}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=o,this.y=u,this.key=mA(0,e,e,o,u)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,o,u){const m=(k=this.y,I=this.z,P=$0(256*(w=this.x),256*(k=Math.pow(2,I)-k-1),I),B=$0(256*(w+1),256*(k+1),I),P[0]+","+P[1]+","+B[0]+","+B[1]);var w,k,I,P,B;const F=function(O,q,W){let Y,re="";for(let ue=O;ue>0;ue--)Y=1<<ue-1,re+=(q&Y?1:0)+(W&Y?2:0);return re}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(u==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,o>1?"@2x":"").replace(/{quadkey}/g,F).replace(/{bbox-epsg-3857}/g,m)}isChildOf(e){const o=this.z-e.z;return o>0&&e.x===this.x>>o&&e.y===this.y>>o}getTilePoint(e){const o=Math.pow(2,this.z);return new K((e.x*o-this.x)*$i,(e.y*o-this.y)*$i)}toString(){return`${this.z}/${this.x}/${this.y}`}}class H0{constructor(e,o){this.wrap=e,this.canonical=o,this.key=mA(e,o.z,o.z,o.x,o.y)}}class Dn{constructor(e,o,u,m,w){if(e<u)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${u}`);this.overscaledZ=e,this.wrap=o,this.canonical=new bc(u,+m,+w),this.key=mA(o,e,u,m,w)}clone(){return new Dn(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-e;return e>this.canonical.z?new Dn(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Dn(e,this.wrap,e,this.canonical.x>>o,this.canonical.y>>o)}calculateScaledKey(e,o){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const u=this.canonical.z-e;return e>this.canonical.z?mA(this.wrap*+o,e,this.canonical.z,this.canonical.x,this.canonical.y):mA(this.wrap*+o,e,e,this.canonical.x>>u,this.canonical.y>>u)}isChildOf(e){if(e.wrap!==this.wrap)return!1;const o=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>o&&e.canonical.y===this.canonical.y>>o}children(e){if(this.overscaledZ>=e)return[new Dn(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const o=this.canonical.z+1,u=2*this.canonical.x,m=2*this.canonical.y;return[new Dn(o,this.wrap,o,u,m),new Dn(o,this.wrap,o,u+1,m),new Dn(o,this.wrap,o,u,m+1),new Dn(o,this.wrap,o,u+1,m+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Dn(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Dn(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new H0(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new KA(e.x-this.wrap,e.y))}}function mA(r,e,o,u,m){(r*=2)<0&&(r=-1*r-1);const w=1<<o;return(w*w*r+w*m+u).toString(36)+o.toString(36)+e.toString(36)}st("CanonicalTileID",bc),st("OverscaledTileID",Dn,{omit:["posMatrix"]});class W0{constructor(e,o,u,m=1,w=1,k=1,I=0){if(this.uid=e,o.height!==o.width)throw new RangeError("DEM tiles must be square");if(u&&!["mapbox","terrarium","custom"].includes(u))return void si(`"${u}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=o.height;const P=this.dim=o.height-2;switch(this.data=new Uint32Array(o.data.buffer),u){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=m,this.greenFactor=w,this.blueFactor=k,this.baseShift=I;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let B=0;B<P;B++)this.data[this._idx(-1,B)]=this.data[this._idx(0,B)],this.data[this._idx(P,B)]=this.data[this._idx(P-1,B)],this.data[this._idx(B,-1)]=this.data[this._idx(B,0)],this.data[this._idx(B,P)]=this.data[this._idx(B,P-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(P,-1)]=this.data[this._idx(P-1,0)],this.data[this._idx(-1,P)]=this.data[this._idx(0,P-1)],this.data[this._idx(P,P)]=this.data[this._idx(P-1,P-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let B=0;B<P;B++)for(let F=0;F<P;F++){const O=this.get(B,F);O>this.max&&(this.max=O),O<this.min&&(this.min=O)}}get(e,o){const u=new Uint8Array(this.data.buffer),m=4*this._idx(e,o);return this.unpack(u[m],u[m+1],u[m+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,o){if(e<-1||e>=this.dim+1||o<-1||o>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(o+1)*this.stride+(e+1)}unpack(e,o,u){return e*this.redFactor+o*this.greenFactor+u*this.blueFactor-this.baseShift}getPixels(){return new Pn({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,o,u){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let m=o*this.dim,w=o*this.dim+this.dim,k=u*this.dim,I=u*this.dim+this.dim;switch(o){case-1:m=w-1;break;case 1:w=m+1}switch(u){case-1:k=I-1;break;case 1:I=k+1}const P=-o*this.dim,B=-u*this.dim;for(let F=k;F<I;F++)for(let O=m;O<w;O++)this.data[this._idx(O,F)]=e.data[this._idx(O+P,F+B)]}}st("DEMData",W0);class X0{constructor(e){this._stringToNumber={},this._numberToString=[];for(let o=0;o<e.length;o++){const u=e[o];this._stringToNumber[u]=o,this._numberToString[o]=u}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class Y0{constructor(e,o,u,m,w){this.type="Feature",this._vectorTileFeature=e,e._z=o,e._x=u,e._y=m,this.properties=e.properties,this.id=w}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const o in this)o!=="_geometry"&&o!=="_vectorTileFeature"&&(e[o]=this[o]);return e}}class K0{constructor(e,o){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new us($i,16,0),this.grid3D=new us($i,16,0),this.featureIndexArray=new oe,this.promoteId=o}insert(e,o,u,m,w,k){const I=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,m,w);const P=k?this.grid3D:this.grid;for(let B=0;B<o.length;B++){const F=o[B],O=[1/0,1/0,-1/0,-1/0];for(let q=0;q<F.length;q++){const W=F[q];O[0]=Math.min(O[0],W.x),O[1]=Math.min(O[1],W.y),O[2]=Math.max(O[2],W.x),O[3]=Math.max(O[3],W.y)}O[0]<$i&&O[1]<$i&&O[2]>=0&&O[3]>=0&&P.insert(I,O[0],O[1],O[2],O[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Aa.VectorTile(new uc(this.rawTileData)).layers,this.sourceLayerCoder=new X0(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,o,u,m){this.loadVTLayers();const w=e.params||{},k=$i/e.tileSize/e.scale,I=Ca(w.filter),P=e.queryGeometry,B=e.queryPadding*k,F=ef(P),O=this.grid.query(F.minX-B,F.minY-B,F.maxX+B,F.maxY+B),q=ef(e.cameraQueryGeometry),W=this.grid3D.query(q.minX-B,q.minY-B,q.maxX+B,q.maxY+B,(ue,me,ke,ye)=>function(Se,Ie,Re,it,ct){for(const Xe of Se)if(Ie<=Xe.x&&Re<=Xe.y&&it>=Xe.x&&ct>=Xe.y)return!0;const tt=[new K(Ie,Re),new K(Ie,ct),new K(it,ct),new K(it,Re)];if(Se.length>2){for(const Xe of tt)if(Ml(Se,Xe))return!0}for(let Xe=0;Xe<Se.length-1;Xe++)if(Op(Se[Xe],Se[Xe+1],tt))return!0;return!1}(e.cameraQueryGeometry,ue-B,me-B,ke+B,ye+B));for(const ue of W)O.push(ue);O.sort(ag);const Y={};let re;for(let ue=0;ue<O.length;ue++){const me=O[ue];if(me===re)continue;re=me;const ke=this.featureIndexArray.get(me);let ye=null;this.loadMatchingFeature(Y,ke.bucketIndex,ke.sourceLayerIndex,ke.featureIndex,I,w.layers,w.availableImages,o,u,m,(Se,Ie,Re)=>(ye||(ye=qa(Se)),Ie.queryIntersectsFeature(P,Se,Re,ye,this.z,e.transform,k,e.pixelPosMatrix)))}return Y}loadMatchingFeature(e,o,u,m,w,k,I,P,B,F,O){const q=this.bucketLayerIDs[o];if(k&&!function(ue,me){for(let ke=0;ke<ue.length;ke++)if(me.indexOf(ue[ke])>=0)return!0;return!1}(k,q))return;const W=this.sourceLayerCoder.decode(u),Y=this.vtLayers[W].feature(m);if(w.needGeometry){const ue=Za(Y,!0);if(!w.filter(new yi(this.tileID.overscaledZ),ue,this.tileID.canonical))return}else if(!w.filter(new yi(this.tileID.overscaledZ),Y))return;const re=this.getId(Y,W);for(let ue=0;ue<q.length;ue++){const me=q[ue];if(k&&k.indexOf(me)<0)continue;const ke=P[me];if(!ke)continue;let ye={};re&&F&&(ye=F.getState(ke.sourceLayer||"_geojsonTileLayer",re));const Se=It({},B[me]);Se.paint=J0(Se.paint,ke.paint,Y,ye,I),Se.layout=J0(Se.layout,ke.layout,Y,ye,I);const Ie=!O||O(Y,ke,ye);if(!Ie)continue;const Re=new Y0(Y,this.z,this.x,this.y,re);Re.layer=Se;let it=e[me];it===void 0&&(it=e[me]=[]),it.push({featureIndex:m,feature:Re,intersectionZ:Ie})}}lookupSymbolFeatures(e,o,u,m,w,k,I,P){const B={};this.loadVTLayers();const F=Ca(w);for(const O of e)this.loadMatchingFeature(B,u,m,O,F,k,I,P,o);return B}hasLayer(e){for(const o of this.bucketLayerIDs)for(const u of o)if(e===u)return!0;return!1}getId(e,o){let u=e.id;return this.promoteId&&(u=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[o]],typeof u=="boolean"&&(u=Number(u))),u}}function J0(r,e,o,u,m){return Lt(r,(w,k)=>{const I=e instanceof Eo?e.get(k):null;return I&&I.evaluate?I.evaluate(o,u,m):I})}function ef(r){let e=1/0,o=1/0,u=-1/0,m=-1/0;for(const w of r)e=Math.min(e,w.x),o=Math.min(o,w.y),u=Math.max(u,w.x),m=Math.max(m,w.y);return{minX:e,minY:o,maxX:u,maxY:m}}function ag(r,e){return e-r}function tf(r,e,o,u,m){const w=[];for(let k=0;k<r.length;k++){const I=r[k];let P;for(let B=0;B<I.length-1;B++){let F=I[B],O=I[B+1];F.x<e&&O.x<e||(F.x<e?F=new K(e,F.y+(e-F.x)/(O.x-F.x)*(O.y-F.y))._round():O.x<e&&(O=new K(e,F.y+(e-F.x)/(O.x-F.x)*(O.y-F.y))._round()),F.y<o&&O.y<o||(F.y<o?F=new K(F.x+(o-F.y)/(O.y-F.y)*(O.x-F.x),o)._round():O.y<o&&(O=new K(F.x+(o-F.y)/(O.y-F.y)*(O.x-F.x),o)._round()),F.x>=u&&O.x>=u||(F.x>=u?F=new K(u,F.y+(u-F.x)/(O.x-F.x)*(O.y-F.y))._round():O.x>=u&&(O=new K(u,F.y+(u-F.x)/(O.x-F.x)*(O.y-F.y))._round()),F.y>=m&&O.y>=m||(F.y>=m?F=new K(F.x+(m-F.y)/(O.y-F.y)*(O.x-F.x),m)._round():O.y>=m&&(O=new K(F.x+(m-F.y)/(O.y-F.y)*(O.x-F.x),m)._round()),P&&F.equals(P[P.length-1])||(P=[F],w.push(P)),P.push(O)))))}}return w}st("FeatureIndex",K0,{omit:["rawTileData","sourceLayerCoder"]});class fa extends K{constructor(e,o,u,m){super(e,o),this.angle=u,m!==void 0&&(this.segment=m)}clone(){return new fa(this.x,this.y,this.angle,this.segment)}}function rf(r,e,o,u,m){if(e.segment===void 0||o===0)return!0;let w=e,k=e.segment+1,I=0;for(;I>-o/2;){if(k--,k<0)return!1;I-=r[k].dist(w),w=r[k]}I+=r[k].dist(r[k+1]),k++;const P=[];let B=0;for(;I<o/2;){const F=r[k],O=r[k+1];if(!O)return!1;let q=r[k-1].angleTo(F)-F.angleTo(O);for(q=Math.abs((q+3*Math.PI)%(2*Math.PI)-Math.PI),P.push({distance:I,angleDelta:q}),B+=q;I-P[0].distance>u;)B-=P.shift().angleDelta;if(B>m)return!1;k++,I+=F.dist(O)}return!0}function nf(r){let e=0;for(let o=0;o<r.length-1;o++)e+=r[o].dist(r[o+1]);return e}function sf(r,e,o){return r?.6*e*o:0}function of(r,e){return Math.max(r?r.right-r.left:0,e?e.right-e.left:0)}function lg(r,e,o,u,m,w){const k=sf(o,m,w),I=of(o,u)*w;let P=0;const B=nf(r)/2;for(let F=0;F<r.length-1;F++){const O=r[F],q=r[F+1],W=O.dist(q);if(P+W>B){const Y=(B-P)/W,re=Ni.number(O.x,q.x,Y),ue=Ni.number(O.y,q.y,Y),me=new fa(re,ue,q.angleTo(O),F);return me._round(),!k||rf(r,me,I,k,e)?me:void 0}P+=W}}function Ag(r,e,o,u,m,w,k,I,P){const B=sf(u,w,k),F=of(u,m),O=F*k,q=r[0].x===0||r[0].x===P||r[0].y===0||r[0].y===P;return e-O<e/4&&(e=O+e/4),af(r,q?e/2*I%e:(F/2+2*w)*k*I%e,e,B,o,O,q,!1,P)}function af(r,e,o,u,m,w,k,I,P){const B=w/2,F=nf(r);let O=0,q=e-o,W=[];for(let Y=0;Y<r.length-1;Y++){const re=r[Y],ue=r[Y+1],me=re.dist(ue),ke=ue.angleTo(re);for(;q+o<O+me;){q+=o;const ye=(q-O)/me,Se=Ni.number(re.x,ue.x,ye),Ie=Ni.number(re.y,ue.y,ye);if(Se>=0&&Se<P&&Ie>=0&&Ie<P&&q-B>=0&&q+B<=F){const Re=new fa(Se,Ie,ke,Y);Re._round(),u&&!rf(r,Re,w,u,m)||W.push(Re)}}O+=me}return I||W.length||k||(W=af(r,O/2,o,u,m,w,k,!0,P)),W}st("Anchor",fa);const Fl=rn;function lf(r,e,o,u){const m=[],w=r.image,k=w.pixelRatio,I=w.paddedRect.w-2*Fl,P=w.paddedRect.h-2*Fl,B=r.right-r.left,F=r.bottom-r.top,O=w.stretchX||[[0,I]],q=w.stretchY||[[0,P]],W=(Qe,lt)=>Qe+lt[1]-lt[0],Y=O.reduce(W,0),re=q.reduce(W,0),ue=I-Y,me=P-re;let ke=0,ye=Y,Se=0,Ie=re,Re=0,it=ue,ct=0,tt=me;if(w.content&&u){const Qe=w.content;ke=JA(O,0,Qe[0]),Se=JA(q,0,Qe[1]),ye=JA(O,Qe[0],Qe[2]),Ie=JA(q,Qe[1],Qe[3]),Re=Qe[0]-ke,ct=Qe[1]-Se,it=Qe[2]-Qe[0]-ye,tt=Qe[3]-Qe[1]-Ie}const Xe=(Qe,lt,He,Ne)=>{const bt=eu(Qe.stretch-ke,ye,B,r.left),pt=tu(Qe.fixed-Re,it,Qe.stretch,Y),jt=eu(lt.stretch-Se,Ie,F,r.top),ki=tu(lt.fixed-ct,tt,lt.stretch,re),Ii=eu(He.stretch-ke,ye,B,r.left),er=tu(He.fixed-Re,it,He.stretch,Y),pn=eu(Ne.stretch-Se,Ie,F,r.top),jr=tu(Ne.fixed-ct,tt,Ne.stretch,re),Hi=new K(bt,jt),fr=new K(Ii,jt),br=new K(Ii,pn),qr=new K(bt,pn),Zr=new K(pt/k,ki/k),tr=new K(er/k,jr/k),ir=e*Math.PI/180;if(ir){const Cr=Math.sin(ir),nn=Math.cos(ir),sn=[nn,-Cr,Cr,nn];Hi._matMult(sn),fr._matMult(sn),qr._matMult(sn),br._matMult(sn)}const Mr=Qe.stretch+Qe.fixed,Qr=lt.stretch+lt.fixed;return{tl:Hi,tr:fr,bl:qr,br,tex:{x:w.paddedRect.x+Fl+Mr,y:w.paddedRect.y+Fl+Qr,w:He.stretch+He.fixed-Mr,h:Ne.stretch+Ne.fixed-Qr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Zr,pixelOffsetBR:tr,minFontScaleX:it/k/B,minFontScaleY:tt/k/F,isSDF:o}};if(u&&(w.stretchX||w.stretchY)){const Qe=Af(O,ue,Y),lt=Af(q,me,re);for(let He=0;He<Qe.length-1;He++){const Ne=Qe[He],bt=Qe[He+1];for(let pt=0;pt<lt.length-1;pt++)m.push(Xe(Ne,lt[pt],bt,lt[pt+1]))}}else m.push(Xe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:I+1},{fixed:0,stretch:P+1}));return m}function JA(r,e,o){let u=0;for(const m of r)u+=Math.max(e,Math.min(o,m[1]))-Math.max(e,Math.min(o,m[0]));return u}function Af(r,e,o){const u=[{fixed:-Fl,stretch:0}];for(const[m,w]of r){const k=u[u.length-1];u.push({fixed:m-k.stretch,stretch:k.stretch}),u.push({fixed:m-k.stretch,stretch:k.stretch+(w-m)})}return u.push({fixed:e+Fl,stretch:o}),u}function eu(r,e,o,u){return r/e*o+u}function tu(r,e,o,u){return r-e*o/u}class iu{constructor(e,o,u,m,w,k,I,P,B,F){if(this.boxStartIndex=e.length,B){let O=k.top,q=k.bottom;const W=k.collisionPadding;W&&(O-=W[1],q+=W[3]);let Y=q-O;Y>0&&(Y=Math.max(10,Y),this.circleDiameter=Y)}else{let O=k.top*I-P[0],q=k.bottom*I+P[2],W=k.left*I-P[3],Y=k.right*I+P[1];const re=k.collisionPadding;if(re&&(W-=re[0]*I,O-=re[1]*I,Y+=re[2]*I,q+=re[3]*I),F){const ue=new K(W,O),me=new K(Y,O),ke=new K(W,q),ye=new K(Y,q),Se=F*Math.PI/180;ue._rotate(Se),me._rotate(Se),ke._rotate(Se),ye._rotate(Se),W=Math.min(ue.x,me.x,ke.x,ye.x),Y=Math.max(ue.x,me.x,ke.x,ye.x),O=Math.min(ue.y,me.y,ke.y,ye.y),q=Math.max(ue.y,me.y,ke.y,ye.y)}e.emplaceBack(o.x,o.y,W,O,Y,q,u,m,w)}this.boxEndIndex=e.length}}class ug{constructor(e=[],o=cg){if(this.data=e,this.length=this.data.length,this.compare=o,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],o=this.data.pop();return this.length--,this.length>0&&(this.data[0]=o,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:o,compare:u}=this,m=o[e];for(;e>0;){const w=e-1>>1,k=o[w];if(u(m,k)>=0)break;o[e]=k,e=w}o[e]=m}_down(e){const{data:o,compare:u}=this,m=this.length>>1,w=o[e];for(;e<m;){let k=1+(e<<1),I=o[k];const P=k+1;if(P<this.length&&u(o[P],I)<0&&(k=P,I=o[P]),u(I,w)>=0)break;o[e]=I,e=k}o[e]=w}}function cg(r,e){return r<e?-1:r>e?1:0}function hg(r,e=1,o=!1){let u=1/0,m=1/0,w=-1/0,k=-1/0;const I=r[0];for(let W=0;W<I.length;W++){const Y=I[W];(!W||Y.x<u)&&(u=Y.x),(!W||Y.y<m)&&(m=Y.y),(!W||Y.x>w)&&(w=Y.x),(!W||Y.y>k)&&(k=Y.y)}const P=Math.min(w-u,k-m);let B=P/2;const F=new ug([],fg);if(P===0)return new K(u,m);for(let W=u;W<w;W+=P)for(let Y=m;Y<k;Y+=P)F.push(new Ol(W+B,Y+B,B,r));let O=function(W){let Y=0,re=0,ue=0;const me=W[0];for(let ke=0,ye=me.length,Se=ye-1;ke<ye;Se=ke++){const Ie=me[ke],Re=me[Se],it=Ie.x*Re.y-Re.x*Ie.y;re+=(Ie.x+Re.x)*it,ue+=(Ie.y+Re.y)*it,Y+=3*it}return new Ol(re/Y,ue/Y,0,W)}(r),q=F.length;for(;F.length;){const W=F.pop();(W.d>O.d||!O.d)&&(O=W,o&&console.log("found best %d after %d probes",Math.round(1e4*W.d)/1e4,q)),W.max-O.d<=e||(B=W.h/2,F.push(new Ol(W.p.x-B,W.p.y-B,B,r)),F.push(new Ol(W.p.x+B,W.p.y-B,B,r)),F.push(new Ol(W.p.x-B,W.p.y+B,B,r)),F.push(new Ol(W.p.x+B,W.p.y+B,B,r)),q+=4)}return o&&(console.log(`num probes: ${q}`),console.log(`best distance: ${O.d}`)),O.p}function fg(r,e){return e.max-r.max}function Ol(r,e,o,u){this.p=new K(r,e),this.h=o,this.d=function(m,w){let k=!1,I=1/0;for(let P=0;P<w.length;P++){const B=w[P];for(let F=0,O=B.length,q=O-1;F<O;q=F++){const W=B[F],Y=B[q];W.y>m.y!=Y.y>m.y&&m.x<(Y.x-W.x)*(m.y-W.y)/(Y.y-W.y)+W.x&&(k=!k),I=Math.min(I,qh(m,W,Y))}}return(k?1:-1)*Math.sqrt(I)}(this.p,u),this.max=this.d+this.h*Math.SQRT2}var xr;h.aq=void 0,(xr=h.aq||(h.aq={}))[xr.center=1]="center",xr[xr.left=2]="left",xr[xr.right=3]="right",xr[xr.top=4]="top",xr[xr.bottom=5]="bottom",xr[xr["top-left"]=6]="top-left",xr[xr["top-right"]=7]="top-right",xr[xr["bottom-left"]=8]="bottom-left",xr[xr["bottom-right"]=9]="bottom-right";const da=7,wc=Number.POSITIVE_INFINITY;function uf(r,e){return e[1]!==wc?function(o,u,m){let w=0,k=0;switch(u=Math.abs(u),m=Math.abs(m),o){case"top-right":case"top-left":case"top":k=m-da;break;case"bottom-right":case"bottom-left":case"bottom":k=-m+da}switch(o){case"top-right":case"bottom-right":case"right":w=-u;break;case"top-left":case"bottom-left":case"left":w=u}return[w,k]}(r,e[0],e[1]):function(o,u){let m=0,w=0;u<0&&(u=0);const k=u/Math.SQRT2;switch(o){case"top-right":case"top-left":w=k-da;break;case"bottom-right":case"bottom-left":w=-k+da;break;case"bottom":w=-u+da;break;case"top":w=u-da}switch(o){case"top-right":case"bottom-right":m=-k;break;case"top-left":case"bottom-left":m=k;break;case"left":m=u;break;case"right":m=-u}return[m,w]}(r,e[0])}function cf(r,e,o){var u;const m=r.layout,w=(u=m.get("text-variable-anchor-offset"))===null||u===void 0?void 0:u.evaluate(e,{},o);if(w){const I=w.values,P=[];for(let B=0;B<I.length;B+=2){const F=P[B]=I[B],O=I[B+1].map(q=>q*Ji);F.startsWith("top")?O[1]-=da:F.startsWith("bottom")&&(O[1]+=da),P[B+1]=O}return new _t(P)}const k=m.get("text-variable-anchor");if(k){let I;I=r._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[m.get("text-radial-offset").evaluate(e,{},o)*Ji,wc]:m.get("text-offset").evaluate(e,{},o).map(B=>B*Ji);const P=[];for(const B of k)P.push(B,uf(B,I));return new _t(P)}return null}function kc(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function dg(r,e,o,u,m,w,k,I,P,B,F){let O=w.textMaxSize.evaluate(e,{});O===void 0&&(O=k);const q=r.layers[0].layout,W=q.get("icon-offset").evaluate(e,{},F),Y=ff(o.horizontal),re=k/24,ue=r.tilePixelRatio*re,me=r.tilePixelRatio*O/24,ke=r.tilePixelRatio*I,ye=r.tilePixelRatio*q.get("symbol-spacing"),Se=q.get("text-padding")*r.tilePixelRatio,Ie=function(Ne,bt,pt,jt=1){const ki=Ne.get("icon-padding").evaluate(bt,{},pt),Ii=ki&&ki.values;return[Ii[0]*jt,Ii[1]*jt,Ii[2]*jt,Ii[3]*jt]}(q,e,F,r.tilePixelRatio),Re=q.get("text-max-angle")/180*Math.PI,it=q.get("text-rotation-alignment")!=="viewport"&&q.get("symbol-placement")!=="point",ct=q.get("icon-rotation-alignment")==="map"&&q.get("symbol-placement")!=="point",tt=q.get("symbol-placement"),Xe=ye/2,Qe=q.get("icon-text-fit");let lt;u&&Qe!=="none"&&(r.allowVerticalPlacement&&o.vertical&&(lt=z0(u,o.vertical,Qe,q.get("icon-text-fit-padding"),W,re)),Y&&(u=z0(u,Y,Qe,q.get("icon-text-fit-padding"),W,re)));const He=(Ne,bt)=>{bt.x<0||bt.x>=$i||bt.y<0||bt.y>=$i||function(pt,jt,ki,Ii,er,pn,jr,Hi,fr,br,qr,Zr,tr,ir,Mr,Qr,Cr,nn,sn,rr,Yt,Pr,wr,nr,Xn){const ps=pt.addToLineVertexArray(jt,ki);let ms,Do,Yn,Bn,on=0,Bo=0,yA=0,gf=0,Dc=-1,Bc=-1;const zo={};let _f=Io("");if(pt.allowVerticalPlacement&&Ii.vertical){const Dr=Hi.layout.get("text-rotate").evaluate(Yt,{},nr)+90;Yn=new iu(fr,jt,br,qr,Zr,Ii.vertical,tr,ir,Mr,Dr),jr&&(Bn=new iu(fr,jt,br,qr,Zr,jr,Cr,nn,Mr,Dr))}if(er){const Dr=Hi.layout.get("icon-rotate").evaluate(Yt,{}),zn=Hi.layout.get("icon-text-fit")!=="none",$a=lf(er,Dr,wr,zn),_s=jr?lf(jr,Dr,wr,zn):void 0;Do=new iu(fr,jt,br,qr,Zr,er,Cr,nn,!1,Dr),on=4*$a.length;const Ha=pt.iconSizeData;let Xs=null;Ha.kind==="source"?(Xs=[Ws*Hi.layout.get("icon-size").evaluate(Yt,{})],Xs[0]>ca&&si(`${pt.layerIds[0]}: Value for "icon-size" is >= ${pA}. Reduce your "icon-size".`)):Ha.kind==="composite"&&(Xs=[Ws*Pr.compositeIconSizes[0].evaluate(Yt,{},nr),Ws*Pr.compositeIconSizes[1].evaluate(Yt,{},nr)],(Xs[0]>ca||Xs[1]>ca)&&si(`${pt.layerIds[0]}: Value for "icon-size" is >= ${pA}. Reduce your "icon-size".`)),pt.addSymbols(pt.icon,$a,Xs,rr,sn,Yt,h.ai.none,jt,ps.lineStartIndex,ps.lineLength,-1,nr),Dc=pt.icon.placedSymbolArray.length-1,_s&&(Bo=4*_s.length,pt.addSymbols(pt.icon,_s,Xs,rr,sn,Yt,h.ai.vertical,jt,ps.lineStartIndex,ps.lineLength,-1,nr),Bc=pt.icon.placedSymbolArray.length-1)}const yf=Object.keys(Ii.horizontal);for(const Dr of yf){const zn=Ii.horizontal[Dr];if(!ms){_f=Io(zn.text);const _s=Hi.layout.get("text-rotate").evaluate(Yt,{},nr);ms=new iu(fr,jt,br,qr,Zr,zn,tr,ir,Mr,_s)}const $a=zn.positionedLines.length===1;if(yA+=hf(pt,jt,zn,pn,Hi,Mr,Yt,Qr,ps,Ii.vertical?h.ai.horizontal:h.ai.horizontalOnly,$a?yf:[Dr],zo,Dc,Pr,nr),$a)break}Ii.vertical&&(gf+=hf(pt,jt,Ii.vertical,pn,Hi,Mr,Yt,Qr,ps,h.ai.vertical,["vertical"],zo,Bc,Pr,nr));const gg=ms?ms.boxStartIndex:pt.collisionBoxArray.length,_g=ms?ms.boxEndIndex:pt.collisionBoxArray.length,yg=Yn?Yn.boxStartIndex:pt.collisionBoxArray.length,vg=Yn?Yn.boxEndIndex:pt.collisionBoxArray.length,xg=Do?Do.boxStartIndex:pt.collisionBoxArray.length,bg=Do?Do.boxEndIndex:pt.collisionBoxArray.length,wg=Bn?Bn.boxStartIndex:pt.collisionBoxArray.length,kg=Bn?Bn.boxEndIndex:pt.collisionBoxArray.length;let gs=-1;const nu=(Dr,zn)=>Dr&&Dr.circleDiameter?Math.max(Dr.circleDiameter,zn):zn;gs=nu(ms,gs),gs=nu(Yn,gs),gs=nu(Do,gs),gs=nu(Bn,gs);const vf=gs>-1?1:0;vf&&(gs*=Xn/Ji),pt.glyphOffsetArray.length>=Rl.MAX_GLYPHS&&si("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Yt.sortKey!==void 0&&pt.addToSortKeyRanges(pt.symbolInstances.length,Yt.sortKey);const Eg=cf(Hi,Yt,nr),[Sg,Tg]=function(Dr,zn){const $a=Dr.length,_s=zn==null?void 0:zn.values;if((_s==null?void 0:_s.length)>0)for(let Ha=0;Ha<_s.length;Ha+=2){const Xs=_s[Ha+1];Dr.emplaceBack(h.aq[_s[Ha]],Xs[0],Xs[1])}return[$a,Dr.length]}(pt.textAnchorOffsets,Eg);pt.symbolInstances.emplaceBack(jt.x,jt.y,zo.right>=0?zo.right:-1,zo.center>=0?zo.center:-1,zo.left>=0?zo.left:-1,zo.vertical||-1,Dc,Bc,_f,gg,_g,yg,vg,xg,bg,wg,kg,br,yA,gf,on,Bo,vf,0,tr,gs,Sg,Tg)}(r,bt,Ne,o,u,m,lt,r.layers[0],r.collisionBoxArray,e.index,e.sourceLayerIndex,r.index,ue,[Se,Se,Se,Se],it,P,ke,Ie,ct,W,e,w,B,F,k)};if(tt==="line")for(const Ne of tf(e.geometry,0,0,$i,$i)){const bt=Ag(Ne,ye,Re,o.vertical||Y,u,24,me,r.overscaling,$i);for(const pt of bt)Y&&pg(r,Y.text,Xe,pt)||He(Ne,pt)}else if(tt==="line-center"){for(const Ne of e.geometry)if(Ne.length>1){const bt=lg(Ne,Re,o.vertical||Y,u,24,me);bt&&He(Ne,bt)}}else if(e.type==="Polygon")for(const Ne of ic(e.geometry,0)){const bt=hg(Ne,16);He(Ne[0],new fa(bt.x,bt.y,0))}else if(e.type==="LineString")for(const Ne of e.geometry)He(Ne,new fa(Ne[0].x,Ne[0].y,0));else if(e.type==="Point")for(const Ne of e.geometry)for(const bt of Ne)He([bt],new fa(bt.x,bt.y,0))}function hf(r,e,o,u,m,w,k,I,P,B,F,O,q,W,Y){const re=function(ke,ye,Se,Ie,Re,it,ct,tt){const Xe=Ie.layout.get("text-rotate").evaluate(it,{})*Math.PI/180,Qe=[];for(const lt of ye.positionedLines)for(const He of lt.positionedGlyphs){if(!He.rect)continue;const Ne=He.rect||{};let bt=T0+1,pt=!0,jt=1,ki=0;const Ii=(Re||tt)&&He.vertical,er=He.metrics.advance*He.scale/2;if(tt&&ye.verticalizable&&(ki=lt.lineOffset/2-(He.imageName?-(Ji-He.metrics.width*He.scale)/2:(He.scale-1)*Ji)),He.imageName){const rr=ct[He.imageName];pt=rr.sdf,jt=rr.pixelRatio,bt=rn/jt}const pn=Re?[He.x+er,He.y]:[0,0];let jr=Re?[0,0]:[He.x+er+Se[0],He.y+Se[1]-ki],Hi=[0,0];Ii&&(Hi=jr,jr=[0,0]);const fr=He.metrics.isDoubleResolution?2:1,br=(He.metrics.left-bt)*He.scale-er+jr[0],qr=(-He.metrics.top-bt)*He.scale+jr[1],Zr=br+Ne.w/fr*He.scale/jt,tr=qr+Ne.h/fr*He.scale/jt,ir=new K(br,qr),Mr=new K(Zr,qr),Qr=new K(br,tr),Cr=new K(Zr,tr);if(Ii){const rr=new K(-er,er-fA),Yt=-Math.PI/2,Pr=Ji/2-er,wr=new K(5-fA-Pr,-(He.imageName?Pr:0)),nr=new K(...Hi);ir._rotateAround(Yt,rr)._add(wr)._add(nr),Mr._rotateAround(Yt,rr)._add(wr)._add(nr),Qr._rotateAround(Yt,rr)._add(wr)._add(nr),Cr._rotateAround(Yt,rr)._add(wr)._add(nr)}if(Xe){const rr=Math.sin(Xe),Yt=Math.cos(Xe),Pr=[Yt,-rr,rr,Yt];ir._matMult(Pr),Mr._matMult(Pr),Qr._matMult(Pr),Cr._matMult(Pr)}const nn=new K(0,0),sn=new K(0,0);Qe.push({tl:ir,tr:Mr,bl:Qr,br:Cr,tex:Ne,writingMode:ye.writingMode,glyphOffset:pn,sectionIndex:He.sectionIndex,isSDF:pt,pixelOffsetTL:nn,pixelOffsetBR:sn,minFontScaleX:0,minFontScaleY:0})}return Qe}(0,o,I,m,w,k,u,r.allowVerticalPlacement),ue=r.textSizeData;let me=null;ue.kind==="source"?(me=[Ws*m.layout.get("text-size").evaluate(k,{})],me[0]>ca&&si(`${r.layerIds[0]}: Value for "text-size" is >= ${pA}. Reduce your "text-size".`)):ue.kind==="composite"&&(me=[Ws*W.compositeTextSizes[0].evaluate(k,{},Y),Ws*W.compositeTextSizes[1].evaluate(k,{},Y)],(me[0]>ca||me[1]>ca)&&si(`${r.layerIds[0]}: Value for "text-size" is >= ${pA}. Reduce your "text-size".`)),r.addSymbols(r.text,re,me,I,w,k,B,e,P.lineStartIndex,P.lineLength,q,Y);for(const ke of F)O[ke]=r.text.placedSymbolArray.length-1;return 4*re.length}function ff(r){for(const e in r)return r[e];return null}function pg(r,e,o,u){const m=r.compareText;if(e in m){const w=m[e];for(let k=w.length-1;k>=0;k--)if(u.dist(w[k])<o)return!0}else m[e]=[];return m[e].push(u),!1}const df=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Ec{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[o,u]=new Uint8Array(e,0,2);if(o!==219)throw new Error("Data does not appear to be in a KDBush format.");const m=u>>4;if(m!==1)throw new Error(`Got v${m} data when expected v1.`);const w=df[15&u];if(!w)throw new Error("Unrecognized array type.");const[k]=new Uint16Array(e,2,1),[I]=new Uint32Array(e,4,1);return new Ec(I,k,w,e)}constructor(e,o=64,u=Float64Array,m){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+o,2),65535),this.ArrayType=u,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const w=df.indexOf(this.ArrayType),k=2*e*this.ArrayType.BYTES_PER_ELEMENT,I=e*this.IndexArrayType.BYTES_PER_ELEMENT,P=(8-I%8)%8;if(w<0)throw new Error(`Unexpected typed array class: ${u}.`);m&&m instanceof ArrayBuffer?(this.data=m,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+I+P,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+k+I+P),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+I+P,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+w]),new Uint16Array(this.data,2,1)[0]=o,new Uint32Array(this.data,4,1)[0]=e)}add(e,o){const u=this._pos>>1;return this.ids[u]=u,this.coords[this._pos++]=e,this.coords[this._pos++]=o,u}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Sc(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,o,u,m){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:w,coords:k,nodeSize:I}=this,P=[0,w.length-1,0],B=[];for(;P.length;){const F=P.pop()||0,O=P.pop()||0,q=P.pop()||0;if(O-q<=I){for(let ue=q;ue<=O;ue++){const me=k[2*ue],ke=k[2*ue+1];me>=e&&me<=u&&ke>=o&&ke<=m&&B.push(w[ue])}continue}const W=q+O>>1,Y=k[2*W],re=k[2*W+1];Y>=e&&Y<=u&&re>=o&&re<=m&&B.push(w[W]),(F===0?e<=Y:o<=re)&&(P.push(q),P.push(W-1),P.push(1-F)),(F===0?u>=Y:m>=re)&&(P.push(W+1),P.push(O),P.push(1-F))}return B}within(e,o,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:w,nodeSize:k}=this,I=[0,m.length-1,0],P=[],B=u*u;for(;I.length;){const F=I.pop()||0,O=I.pop()||0,q=I.pop()||0;if(O-q<=k){for(let ue=q;ue<=O;ue++)mf(w[2*ue],w[2*ue+1],e,o)<=B&&P.push(m[ue]);continue}const W=q+O>>1,Y=w[2*W],re=w[2*W+1];mf(Y,re,e,o)<=B&&P.push(m[W]),(F===0?e-u<=Y:o-u<=re)&&(I.push(q),I.push(W-1),I.push(1-F)),(F===0?e+u>=Y:o+u>=re)&&(I.push(W+1),I.push(O),I.push(1-F))}return P}}function Sc(r,e,o,u,m,w){if(m-u<=o)return;const k=u+m>>1;pf(r,e,k,u,m,w),Sc(r,e,o,u,k-1,1-w),Sc(r,e,o,k+1,m,1-w)}function pf(r,e,o,u,m,w){for(;m>u;){if(m-u>600){const B=m-u+1,F=o-u+1,O=Math.log(B),q=.5*Math.exp(2*O/3),W=.5*Math.sqrt(O*q*(B-q)/B)*(F-B/2<0?-1:1);pf(r,e,o,Math.max(u,Math.floor(o-F*q/B+W)),Math.min(m,Math.floor(o+(B-F)*q/B+W)),w)}const k=e[2*o+w];let I=u,P=m;for(gA(r,e,u,o),e[2*m+w]>k&&gA(r,e,u,m);I<P;){for(gA(r,e,I,P),I++,P--;e[2*I+w]<k;)I++;for(;e[2*P+w]>k;)P--}e[2*u+w]===k?gA(r,e,u,P):(P++,gA(r,e,P,m)),P<=o&&(u=P+1),o<=P&&(m=P-1)}}function gA(r,e,o,u){Tc(r,o,u),Tc(e,2*o,2*u),Tc(e,2*o+1,2*u+1)}function Tc(r,e,o){const u=r[e];r[e]=r[o],r[o]=u}function mf(r,e,o,u){const m=r-o,w=e-u;return m*m+w*w}var Ic;h.bh=void 0,(Ic=h.bh||(h.bh={})).create="create",Ic.load="load",Ic.fullLoad="fullLoad";let ru=null,_A=[];const Mc=1e3/60,Cc="loadTime",Pc="fullLoadTime",mg={mark(r){performance.mark(r)},frame(r){const e=r;ru!=null&&_A.push(e-ru),ru=e},clearMetrics(){ru=null,_A=[],performance.clearMeasures(Cc),performance.clearMeasures(Pc);for(const r in h.bh)performance.clearMarks(h.bh[r])},getPerformanceMetrics(){performance.measure(Cc,h.bh.create,h.bh.load),performance.measure(Pc,h.bh.create,h.bh.fullLoad);const r=performance.getEntriesByName(Cc)[0].duration,e=performance.getEntriesByName(Pc)[0].duration,o=_A.length,u=1/(_A.reduce((w,k)=>w+k,0)/o/1e3),m=_A.filter(w=>w>Mc).reduce((w,k)=>w+(k-Mc)/Mc,0);return{loadTime:r,fullLoadTime:e,fps:u,percentDroppedFrames:m/(o+m)*100,totalFrames:o}}};h.$=function(r,e,o){var u,m,w,k,I,P,B,F,O,q,W,Y,re=o[0],ue=o[1],me=o[2];return e===r?(r[12]=e[0]*re+e[4]*ue+e[8]*me+e[12],r[13]=e[1]*re+e[5]*ue+e[9]*me+e[13],r[14]=e[2]*re+e[6]*ue+e[10]*me+e[14],r[15]=e[3]*re+e[7]*ue+e[11]*me+e[15]):(m=e[1],w=e[2],k=e[3],I=e[4],P=e[5],B=e[6],F=e[7],O=e[8],q=e[9],W=e[10],Y=e[11],r[0]=u=e[0],r[1]=m,r[2]=w,r[3]=k,r[4]=I,r[5]=P,r[6]=B,r[7]=F,r[8]=O,r[9]=q,r[10]=W,r[11]=Y,r[12]=u*re+I*ue+O*me+e[12],r[13]=m*re+P*ue+q*me+e[13],r[14]=w*re+B*ue+W*me+e[14],r[15]=k*re+F*ue+Y*me+e[15]),r},h.A=Cl,h.B=Ni,h.C=class{constructor(r,e,o){this.receive=u=>{const m=u.data,w=m.id;if(w&&(!m.targetMapId||this.mapId===m.targetMapId))if(m.type==="<cancel>"){delete this.tasks[w];const k=this.cancelCallbacks[w];delete this.cancelCallbacks[w],k&&k()}else vi()||m.mustQueue?(this.tasks[w]=m,this.taskQueue.push(w),this.invoker.trigger()):this.processTask(w,m)},this.process=()=>{if(!this.taskQueue.length)return;const u=this.taskQueue.shift(),m=this.tasks[u];delete this.tasks[u],this.taskQueue.length&&this.invoker.trigger(),m&&this.processTask(u,m)},this.target=r,this.parent=e,this.mapId=o,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},this.invoker=new og(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=vi()?r:window}send(r,e,o,u,m=!1){const w=Math.round(1e18*Math.random()).toString(36).substring(0,10);o&&(this.callbacks[w]=o);const k=[],I={id:w,type:r,hasCallback:!!o,targetMapId:u,mustQueue:m,sourceMapId:this.mapId,data:Cn(e,k)};return this.target.postMessage(I,{transfer:k}),{cancel:()=>{o&&delete this.callbacks[w],this.target.postMessage({id:w,type:"<cancel>",targetMapId:u,sourceMapId:this.mapId})}}}processTask(r,e){if(e.type==="<response>"){const o=this.callbacks[r];delete this.callbacks[r],o&&(e.error?o(Zs(e.error)):o(null,Zs(e.data)))}else{let o=!1;const u=[],m=e.hasCallback?(I,P)=>{o=!0,delete this.cancelCallbacks[r];const B={id:r,type:"<response>",sourceMapId:this.mapId,error:I?Cn(I):null,data:Cn(P,u)};this.target.postMessage(B,{transfer:u})}:I=>{o=!0};let w=null;const k=Zs(e.data);if(this.parent[e.type])w=this.parent[e.type](e.sourceMapId,k,m);else if("getWorkerSource"in this.parent){const I=e.type.split(".");w=this.parent.getWorkerSource(e.sourceMapId,I[0],k.source)[I[1]](k,m)}else m(new Error(`Could not find function ${e.type}`));!o&&w&&w.cancel&&(this.cancelCallbacks[r]=w.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},h.D=ht,h.E=ts,h.F=function(r,e){const o={};for(let u=0;u<e.length;u++){const m=e[u];m in r&&(o[m]=r[m])}return o},h.G=j0,h.H=q0,h.I=hc,h.J=Ze,h.K=We,h.L=ha,h.M=Wr,h.N=$i,h.O=Dn,h.P=K,h.Q=$t,h.R=Pn,h.S=pi,h.T=kl,h.U=KA,h.V=class extends fs{},h.W=bc,h.X=function(r,e){const o=window.document.createElement("video");o.muted=!0,o.onloadstart=function(){e(null,o)};for(let u=0;u<r.length;u++){const m=window.document.createElement("source");vn(r[u])||(o.crossOrigin="Anonymous"),m.src=r[u],o.appendChild(m)}return{cancel:()=>{}}},h.Y=qe,h.Z=function(){var r=new Cl(16);return Cl!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r},h._=U,h.a=Fi,h.a$=class extends f{},h.a0=function(r,e,o){var u=o[0],m=o[1],w=o[2];return r[0]=e[0]*u,r[1]=e[1]*u,r[2]=e[2]*u,r[3]=e[3]*u,r[4]=e[4]*m,r[5]=e[5]*m,r[6]=e[6]*m,r[7]=e[7]*m,r[8]=e[8]*w,r[9]=e[9]*w,r[10]=e[10]*w,r[11]=e[11]*w,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r},h.a1=Hh,h.a2=function(){return Kt++},h.a3=S,h.a4=Rl,h.a5=function(){Tr.isLoading()||Tr.isLoaded()||oa()!=="deferred"||Pi()},h.a6=Ca,h.a7=Za,h.a8=yi,h.a9=Y0,h.aA=ko,h.aB=function(r){r=r.slice();const e=Object.create(null);for(let o=0;o<r.length;o++)e[r[o].id]=r[o];for(let o=0;o<r.length;o++)"ref"in r[o]&&(r[o]=mr(r[o],e[r[o].ref]));return r},h.aC=function(r){if(r.type==="custom")return new sg(r);switch(r.type){case"background":return new ig(r);case"circle":return new Up(r);case"fill":return new am(r);case"fill-extrusion":return new bm(r);case"heatmap":return new jp(r);case"hillshade":return new Zp(r);case"line":return new Cm(r);case"raster":return new ng(r);case"symbol":return new YA(r)}},h.aD=Gt,h.aE=function(r,e){if(!r)return[{command:qt.setStyle,args:[e]}];let o=[];try{if(!oi(r.version,e.version))return[{command:qt.setStyle,args:[e]}];oi(r.center,e.center)||o.push({command:qt.setCenter,args:[e.center]}),oi(r.zoom,e.zoom)||o.push({command:qt.setZoom,args:[e.zoom]}),oi(r.bearing,e.bearing)||o.push({command:qt.setBearing,args:[e.bearing]}),oi(r.pitch,e.pitch)||o.push({command:qt.setPitch,args:[e.pitch]}),oi(r.sprite,e.sprite)||o.push({command:qt.setSprite,args:[e.sprite]}),oi(r.glyphs,e.glyphs)||o.push({command:qt.setGlyphs,args:[e.glyphs]}),oi(r.transition,e.transition)||o.push({command:qt.setTransition,args:[e.transition]}),oi(r.light,e.light)||o.push({command:qt.setLight,args:[e.light]});const u={},m=[];(function(k,I,P,B){let F;for(F in I=I||{},k=k||{})Object.prototype.hasOwnProperty.call(k,F)&&(Object.prototype.hasOwnProperty.call(I,F)||Ts(F,P,B));for(F in I)Object.prototype.hasOwnProperty.call(I,F)&&(Object.prototype.hasOwnProperty.call(k,F)?oi(k[F],I[F])||(k[F].type==="geojson"&&I[F].type==="geojson"&&so(k,I,F)?P.push({command:qt.setGeoJSONSourceData,args:[F,I[F].data]}):xn(F,I,P,B)):Rr(F,I,P))})(r.sources,e.sources,m,u);const w=[];r.layers&&r.layers.forEach(k=>{u[k.source]?o.push({command:qt.removeLayer,args:[k.id]}):w.push(k)}),o=o.concat(m),function(k,I,P){I=I||[];const B=(k=k||[]).map(Fn),F=I.map(Fn),O=k.reduce(rs,{}),q=I.reduce(rs,{}),W=B.slice(),Y=Object.create(null);let re,ue,me,ke,ye,Se,Ie;for(re=0,ue=0;re<B.length;re++)me=B[re],Object.prototype.hasOwnProperty.call(q,me)?ue++:(P.push({command:qt.removeLayer,args:[me]}),W.splice(W.indexOf(me,ue),1));for(re=0,ue=0;re<F.length;re++)me=F[F.length-1-re],W[W.length-1-re]!==me&&(Object.prototype.hasOwnProperty.call(O,me)?(P.push({command:qt.removeLayer,args:[me]}),W.splice(W.lastIndexOf(me,W.length-ue),1)):ue++,Se=W[W.length-re],P.push({command:qt.addLayer,args:[q[me],Se]}),W.splice(W.length-re,0,me),Y[me]=!0);for(re=0;re<F.length;re++)if(me=F[re],ke=O[me],ye=q[me],!Y[me]&&!oi(ke,ye))if(oi(ke.source,ye.source)&&oi(ke["source-layer"],ye["source-layer"])&&oi(ke.type,ye.type)){for(Ie in is(ke.layout,ye.layout,P,me,null,qt.setLayoutProperty),is(ke.paint,ye.paint,P,me,null,qt.setPaintProperty),oi(ke.filter,ye.filter)||P.push({command:qt.setFilter,args:[me,ye.filter]}),oi(ke.minzoom,ye.minzoom)&&oi(ke.maxzoom,ye.maxzoom)||P.push({command:qt.setLayerZoomRange,args:[me,ye.minzoom,ye.maxzoom]}),ke)Object.prototype.hasOwnProperty.call(ke,Ie)&&Ie!=="layout"&&Ie!=="paint"&&Ie!=="filter"&&Ie!=="metadata"&&Ie!=="minzoom"&&Ie!=="maxzoom"&&(Ie.indexOf("paint.")===0?is(ke[Ie],ye[Ie],P,me,Ie.slice(6),qt.setPaintProperty):oi(ke[Ie],ye[Ie])||P.push({command:qt.setLayerProperty,args:[me,Ie,ye[Ie]]}));for(Ie in ye)Object.prototype.hasOwnProperty.call(ye,Ie)&&!Object.prototype.hasOwnProperty.call(ke,Ie)&&Ie!=="layout"&&Ie!=="paint"&&Ie!=="filter"&&Ie!=="metadata"&&Ie!=="minzoom"&&Ie!=="maxzoom"&&(Ie.indexOf("paint.")===0?is(ke[Ie],ye[Ie],P,me,Ie.slice(6),qt.setPaintProperty):oi(ke[Ie],ye[Ie])||P.push({command:qt.setLayerProperty,args:[me,Ie,ye[Ie]]}))}else P.push({command:qt.removeLayer,args:[me]}),Se=W[W.lastIndexOf(me)+1],P.push({command:qt.addLayer,args:[ye,Se]})}(w,e.layers,o)}catch(u){console.warn("Unable to compute style diff:",u),o=[{command:qt.setStyle,args:[e]}]}return o},h.aF=function(r){const e=[],o=r.id;return o===void 0&&e.push({message:`layers.${o}: missing required property "id"`}),r.render===void 0&&e.push({message:`layers.${o}: missing required method "render"`}),r.renderingMode&&r.renderingMode!=="2d"&&r.renderingMode!=="3d"&&e.push({message:`layers.${o}: property "renderingMode" must be either "2d" or "3d"`}),e},h.aG=function r(e,o){if(Array.isArray(e)){if(!Array.isArray(o)||e.length!==o.length)return!1;for(let u=0;u<e.length;u++)if(!r(e[u],o[u]))return!1;return!0}if(typeof e=="object"&&e!==null&&o!==null){if(typeof o!="object"||Object.keys(e).length!==Object.keys(o).length)return!1;for(const u in e)if(!r(e[u],o[u]))return!1;return!0}return e===o},h.aH=Lt,h.aI=kt,h.aJ=Qs,h.aK=function(r){return r({pluginStatus:_r,pluginURL:jn}),Qs.on("pluginStateChange",r),r},h.aL=class extends Mo{constructor(r,e){super(r,e),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}},h.aM=Il,h.aN=class extends Mo{constructor(r,e){super(r,e),this.current=qu}set(r){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let e=1;e<16;e++)if(r[e]!==this.current[e]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}},h.aO=RA,h.aP=class extends Mo{constructor(r,e){super(r,e),this.current=[0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2]))}},h.aQ=class extends Mo{constructor(r,e){super(r,e),this.current=[0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1]))}},h.aR=FA,h.aS=function(r,e,o,u,m,w,k){var I=1/(e-o),P=1/(u-m),B=1/(w-k);return r[0]=-2*I,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*P,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*B,r[11]=0,r[12]=(e+o)*I,r[13]=(m+u)*P,r[14]=(k+w)*B,r[15]=1,r},h.aT=Zt,h.aU=Np,h.aV=class extends d{},h.aW=zm,h.aX=class extends b{},h.aY=function(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))},h.aZ=Jh,h.a_=fe,h.aa=function(r){const e={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(o,u,m,w)=>{const k=m||w;return e[u]=!k||k.toLowerCase(),""}),e["max-age"]){const o=parseInt(e["max-age"],10);isNaN(o)?delete e["max-age"]:e["max-age"]=o}return e},h.ab=function(r,e){const o=[];for(const u in r)u in e||o.push(u);return o},h.ac=function(r){if(Gi==null){const e=r.navigator?r.navigator.userAgent:null;Gi=!!r.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Gi},h.ad=Tt,h.ae=function(r,e,o){var u=Math.sin(o),m=Math.cos(o),w=e[0],k=e[1],I=e[2],P=e[3],B=e[4],F=e[5],O=e[6],q=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=w*m+B*u,r[1]=k*m+F*u,r[2]=I*m+O*u,r[3]=P*m+q*u,r[4]=B*m-w*u,r[5]=F*m-k*u,r[6]=O*m-I*u,r[7]=q*m-P*u,r},h.af=function(r){var e=new Cl(16);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e},h.ag=UA,h.ah=function(r,e){let o=0,u=0;if(r.kind==="constant")u=r.layoutSize;else if(r.kind!=="source"){const{interpolationType:m,minZoom:w,maxZoom:k}=r,I=m?Tt(hi.interpolationFactor(m,e,w,k),0,1):0;r.kind==="camera"?u=Ni.number(r.minSize,r.maxSize,I):o=I}return{uSizeT:o,uSize:u}},h.aj=function(r,{uSize:e,uSizeT:o},{lowerSize:u,upperSize:m}){return r.kind==="source"?u/Ws:r.kind==="composite"?Ni.number(u/Ws,m/Ws,o):e},h.ak=mc,h.al=function(r,e,o,u){const m=e.y-r.y,w=e.x-r.x,k=u.y-o.y,I=u.x-o.x,P=k*w-I*m;if(P===0)return null;const B=(I*(r.y-o.y)-k*(r.x-o.x))/P;return new K(r.x+B*w,r.y+B*m)},h.am=tf,h.an=Gh,h.ao=Wu,h.ap=Ji,h.ar=pc,h.as=function(r,e){var o=e[0],u=e[1],m=e[2],w=e[3],k=e[4],I=e[5],P=e[6],B=e[7],F=e[8],O=e[9],q=e[10],W=e[11],Y=e[12],re=e[13],ue=e[14],me=e[15],ke=o*I-u*k,ye=o*P-m*k,Se=o*B-w*k,Ie=u*P-m*I,Re=u*B-w*I,it=m*B-w*P,ct=F*re-O*Y,tt=F*ue-q*Y,Xe=F*me-W*Y,Qe=O*ue-q*re,lt=O*me-W*re,He=q*me-W*ue,Ne=ke*He-ye*lt+Se*Qe+Ie*Xe-Re*tt+it*ct;return Ne?(r[0]=(I*He-P*lt+B*Qe)*(Ne=1/Ne),r[1]=(m*lt-u*He-w*Qe)*Ne,r[2]=(re*it-ue*Re+me*Ie)*Ne,r[3]=(q*Re-O*it-W*Ie)*Ne,r[4]=(P*Xe-k*He-B*tt)*Ne,r[5]=(o*He-m*Xe+w*tt)*Ne,r[6]=(ue*Se-Y*it-me*ye)*Ne,r[7]=(F*it-q*Se+W*ye)*Ne,r[8]=(k*lt-I*Xe+B*ct)*Ne,r[9]=(u*Xe-o*lt-w*ct)*Ne,r[10]=(Y*Re-re*Se+me*ke)*Ne,r[11]=(O*Se-F*Re-W*ke)*Ne,r[12]=(I*tt-k*Qe-P*ct)*Ne,r[13]=(o*Qe-u*tt+m*ct)*Ne,r[14]=(re*ye-Y*Ie-ue*ke)*Ne,r[15]=(F*Ie-O*ye+q*ke)*Ne,r):null},h.at=kc,h.au=dc,h.av=Ec,h.aw=function(){const r={},e=ze.$version;for(const o in ze.$root){const u=ze.$root[o];if(u.required){let m=null;m=o==="version"?e:u.type==="array"?[]:{},m!=null&&(r[o]=m)}}return r},h.ax=qt,h.ay=xl,h.az=ni,h.b=function(r,e){const o=new Blob([new Uint8Array(r)],{type:"image/png"});createImageBitmap(o).then(u=>{e(null,u)}).catch(u=>{e(new Error(`Could not load image because of ${u.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})},h.b0=Rt,h.b1=function(r,e){var o=r[0],u=r[1],m=r[2],w=r[3],k=r[4],I=r[5],P=r[6],B=r[7],F=r[8],O=r[9],q=r[10],W=r[11],Y=r[12],re=r[13],ue=r[14],me=r[15],ke=e[0],ye=e[1],Se=e[2],Ie=e[3],Re=e[4],it=e[5],ct=e[6],tt=e[7],Xe=e[8],Qe=e[9],lt=e[10],He=e[11],Ne=e[12],bt=e[13],pt=e[14],jt=e[15];return Math.abs(o-ke)<=Gr*Math.max(1,Math.abs(o),Math.abs(ke))&&Math.abs(u-ye)<=Gr*Math.max(1,Math.abs(u),Math.abs(ye))&&Math.abs(m-Se)<=Gr*Math.max(1,Math.abs(m),Math.abs(Se))&&Math.abs(w-Ie)<=Gr*Math.max(1,Math.abs(w),Math.abs(Ie))&&Math.abs(k-Re)<=Gr*Math.max(1,Math.abs(k),Math.abs(Re))&&Math.abs(I-it)<=Gr*Math.max(1,Math.abs(I),Math.abs(it))&&Math.abs(P-ct)<=Gr*Math.max(1,Math.abs(P),Math.abs(ct))&&Math.abs(B-tt)<=Gr*Math.max(1,Math.abs(B),Math.abs(tt))&&Math.abs(F-Xe)<=Gr*Math.max(1,Math.abs(F),Math.abs(Xe))&&Math.abs(O-Qe)<=Gr*Math.max(1,Math.abs(O),Math.abs(Qe))&&Math.abs(q-lt)<=Gr*Math.max(1,Math.abs(q),Math.abs(lt))&&Math.abs(W-He)<=Gr*Math.max(1,Math.abs(W),Math.abs(He))&&Math.abs(Y-Ne)<=Gr*Math.max(1,Math.abs(Y),Math.abs(Ne))&&Math.abs(re-bt)<=Gr*Math.max(1,Math.abs(re),Math.abs(bt))&&Math.abs(ue-pt)<=Gr*Math.max(1,Math.abs(ue),Math.abs(pt))&&Math.abs(me-jt)<=Gr*Math.max(1,Math.abs(me),Math.abs(jt))},h.b2=function(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r},h.b3=function(r,e,o){return r[0]=e[0]*o[0],r[1]=e[1]*o[1],r[2]=e[2]*o[2],r[3]=e[3]*o[3],r},h.b4=function(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]*e[3]},h.b5=Ot,h.b6=H0,h.b7=Z0,h.b8=function(r,e,o,u,m){var w,k=1/Math.tan(e/2);return r[0]=k/o,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=k,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,m!=null&&m!==1/0?(r[10]=(m+u)*(w=1/(u-m)),r[14]=2*m*u*w):(r[10]=-1,r[14]=-2*u),r},h.b9=function(r,e,o){var u=Math.sin(o),m=Math.cos(o),w=e[4],k=e[5],I=e[6],P=e[7],B=e[8],F=e[9],O=e[10],q=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=w*m+B*u,r[5]=k*m+F*u,r[6]=I*m+O*u,r[7]=P*m+q*u,r[8]=B*m-w*u,r[9]=F*m-k*u,r[10]=O*m-I*u,r[11]=q*m-P*u,r},h.bA=ie,h.bB=v0,h.bC=Os,h.bD=Tr,h.ba=je,h.bb=nt,h.bc=function(r,e){return r[0]=e[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=e[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=e[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},h.bd=class extends en{},h.be=vc,h.bf=Q0,h.bg=mg,h.bi=Dt,h.bj=function(r,e,o=!1){if(_r===Fa||_r===Oa||_r===Va)throw new Error("setRTLTextPlugin cannot be called multiple times.");jn=Xr.resolveURL(r),_r=Fa,Na=e,Ua(),o||Pi()},h.bk=oa,h.bl=function(r,e){const o={};for(let m=0;m<r.length;m++){const w=e&&e[r[m].id]||vo(r[m]);e&&(e[r[m].id]=w);let k=o[w];k||(k=o[w]=[]),k.push(r[m])}const u=[];for(const m in o)u.push(o[m]);return u},h.bm=st,h.bn=X0,h.bo=K0,h.bp=M0,h.bq=function(r){r.bucket.createArrays(),r.bucket.tilePixelRatio=$i/(512*r.bucket.overscaling),r.bucket.compareText={},r.bucket.iconsNeedLinear=!1;const e=r.bucket.layers[0],o=e.layout,u=e._unevaluatedLayout._values,m={layoutIconSize:u["icon-size"].possiblyEvaluate(new yi(r.bucket.zoom+1),r.canonical),layoutTextSize:u["text-size"].possiblyEvaluate(new yi(r.bucket.zoom+1),r.canonical),textMaxSize:u["text-size"].possiblyEvaluate(new yi(18))};if(r.bucket.textSizeData.kind==="composite"){const{minZoom:B,maxZoom:F}=r.bucket.textSizeData;m.compositeTextSizes=[u["text-size"].possiblyEvaluate(new yi(B),r.canonical),u["text-size"].possiblyEvaluate(new yi(F),r.canonical)]}if(r.bucket.iconSizeData.kind==="composite"){const{minZoom:B,maxZoom:F}=r.bucket.iconSizeData;m.compositeIconSizes=[u["icon-size"].possiblyEvaluate(new yi(B),r.canonical),u["icon-size"].possiblyEvaluate(new yi(F),r.canonical)]}const w=o.get("text-line-height")*Ji,k=o.get("text-rotation-alignment")!=="viewport"&&o.get("symbol-placement")!=="point",I=o.get("text-keep-upright"),P=o.get("text-size");for(const B of r.bucket.features){const F=o.get("text-font").evaluate(B,{},r.canonical).join(","),O=P.evaluate(B,{},r.canonical),q=m.layoutTextSize.evaluate(B,{},r.canonical),W=m.layoutIconSize.evaluate(B,{},r.canonical),Y={horizontal:{},vertical:void 0},re=B.text;let ue,me=[0,0];if(re){const Se=re.toString(),Ie=o.get("text-letter-spacing").evaluate(B,{},r.canonical)*Ji,Re=La(Se)?Ie:0,it=o.get("text-anchor").evaluate(B,{},r.canonical),ct=cf(e,B,r.canonical);if(!ct){const He=o.get("text-radial-offset").evaluate(B,{},r.canonical);me=He?uf(it,[He*Ji,wc]):o.get("text-offset").evaluate(B,{},r.canonical).map(Ne=>Ne*Ji)}let tt=k?"center":o.get("text-justify").evaluate(B,{},r.canonical);const Xe=o.get("symbol-placement"),Qe=Xe==="point"?o.get("text-max-width").evaluate(B,{},r.canonical)*Ji:0,lt=()=>{r.bucket.allowVerticalPlacement&&za(Se)&&(Y.vertical=HA(re,r.glyphMap,r.glyphPositions,r.imagePositions,F,Qe,w,it,"left",Re,me,h.ai.vertical,!0,Xe,q,O))};if(!k&&ct){const He=new Set;if(tt==="auto")for(let bt=0;bt<ct.values.length;bt+=2)He.add(kc(ct.values[bt]));else He.add(tt);let Ne=!1;for(const bt of He)if(!Y.horizontal[bt])if(Ne)Y.horizontal[bt]=Y.horizontal[0];else{const pt=HA(re,r.glyphMap,r.glyphPositions,r.imagePositions,F,Qe,w,"center",bt,Re,me,h.ai.horizontal,!1,Xe,q,O);pt&&(Y.horizontal[bt]=pt,Ne=pt.positionedLines.length===1)}lt()}else{tt==="auto"&&(tt=kc(it));const He=HA(re,r.glyphMap,r.glyphPositions,r.imagePositions,F,Qe,w,it,tt,Re,me,h.ai.horizontal,!1,Xe,q,O);He&&(Y.horizontal[tt]=He),lt(),za(Se)&&k&&I&&(Y.vertical=HA(re,r.glyphMap,r.glyphPositions,r.imagePositions,F,Qe,w,it,tt,Re,me,h.ai.vertical,!1,Xe,q,O))}}let ke=!1;if(B.icon&&B.icon.name){const Se=r.imageMap[B.icon.name];Se&&(ue=Ym(r.imagePositions[B.icon.name],o.get("icon-offset").evaluate(B,{},r.canonical),o.get("icon-anchor").evaluate(B,{},r.canonical)),ke=!!Se.sdf,r.bucket.sdfIcons===void 0?r.bucket.sdfIcons=ke:r.bucket.sdfIcons!==ke&&si("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Se.pixelRatio!==r.bucket.pixelRatio||o.get("icon-rotate").constantOr(1)!==0)&&(r.bucket.iconsNeedLinear=!0))}const ye=ff(Y.horizontal)||Y.vertical;r.bucket.iconsInText=!!ye&&ye.iconsInText,(ye||ue)&&dg(r.bucket,B,Y,ue,r.imageMap,m,q,W,me,ke,r.canonical)}r.showCollisionBoxes&&r.bucket.generateCollisionDebugBuffers()},h.br=lc,h.bs=sc,h.bt=ac,h.bu=class{constructor(r){this._marks={start:[r.url,"start"].join("#"),end:[r.url,"end"].join("#"),measure:r.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let r=performance.getEntriesByName(this._marks.measure);return r.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),r=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),r}},h.bv=uc,h.bw=Aa,h.bx=function(r,e,o,u,m){return U(this,void 0,void 0,function*(){if(We())try{return yield Wr(r,e,o,u,m)}catch{}return function(w,k,I,P,B){const F=w.width,O=w.height;ji&&ri||(ji=new OffscreenCanvas(F,O),ri=ji.getContext("2d",{willReadFrequently:!0})),ji.width=F,ji.height=O,ri.drawImage(w,0,0,F,O);const q=ri.getImageData(k,I,P,B);return ri.clearRect(0,0,F,O),q.data}(r,e,o,u,m)})},h.by=W0,h.bz=R,h.c=Ye,h.d=function(r,e){const o=new Image;o.onload=()=>{e(null,o),URL.revokeObjectURL(o.src),o.onload=null,window.requestAnimationFrame(()=>{o.src=Jn})},o.onerror=()=>e(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const u=new Blob([new Uint8Array(r)],{type:"image/png"});o.src=r.byteLength?URL.createObjectURL(u):Jn},h.e=It,h.f=function(r,e){return Rn(It(r,{type:"json"}),e)},h.g=Wi,h.h=Xr,h.i=vi,h.j=Lr,h.k=pr,h.l=no,h.m=Rn,h.n=function(r){return new uc(r).readFields(Zm,[])},h.o=function(r,e,o){if(!r.length)return o(null,[]);let u=r.length;const m=new Array(r.length);let w=null;r.forEach((k,I)=>{e(k,(P,B)=>{P&&(w=P),m[I]=B,--u==0&&o(w,m)})})},h.p=I0,h.q=sA,h.r=Di,h.s=vn,h.t=Jl,h.u=Je,h.v=ze,h.w=si,h.x=na,h.y=In,h.z=function([r,e,o]){return e+=90,e*=Math.PI/180,o*=Math.PI/180,{x:r*Math.cos(e)*Math.sin(o),y:r*Math.sin(e)*Math.sin(o),z:r*Math.cos(o)}}}),L(["./shared"],function(h){class U{constructor(j){this.keyCache={},j&&this.replace(j)}replace(j){this._layerConfigs={},this._layers={},this.update(j,[])}update(j,$){for(const le of j){this._layerConfigs[le.id]=le;const ce=this._layers[le.id]=h.aC(le);ce._featureFilter=h.a6(ce.filter),this.keyCache[le.id]&&delete this.keyCache[le.id]}for(const le of $)delete this.keyCache[le],delete this._layerConfigs[le],delete this._layers[le];this.familiesBySource={};const te=h.bl(Object.values(this._layerConfigs),this.keyCache);for(const le of te){const ce=le.map(se=>this._layers[se.id]),Ee=ce[0];if(Ee.visibility==="none")continue;const ve=Ee.source||"";let de=this.familiesBySource[ve];de||(de=this.familiesBySource[ve]={});const be=Ee.sourceLayer||"_geojsonTileLayer";let Be=de[be];Be||(Be=de[be]=[]),Be.push(ce)}}}class R{constructor(j){const $={},te=[];for(const ve in j){const de=j[ve],be=$[ve]={};for(const Be in de){const se=de[+Be];if(!se||se.bitmap.width===0||se.bitmap.height===0)continue;const _e={x:0,y:0,w:se.bitmap.width+2,h:se.bitmap.height+2};te.push(_e),be[Be]={rect:_e,metrics:se.metrics}}}const{w:le,h:ce}=h.p(te),Ee=new h.q({width:le||1,height:ce||1});for(const ve in j){const de=j[ve];for(const be in de){const Be=de[+be];if(!Be||Be.bitmap.width===0||Be.bitmap.height===0)continue;const se=$[ve][be].rect;h.q.copy(Be.bitmap,Ee,{x:0,y:0},{x:se.x+1,y:se.y+1},Be.bitmap)}}this.image=Ee,this.positions=$}}h.bm("GlyphAtlas",R);class ie{constructor(j){this.tileID=new h.O(j.tileID.overscaledZ,j.tileID.wrap,j.tileID.canonical.z,j.tileID.canonical.x,j.tileID.canonical.y),this.uid=j.uid,this.zoom=j.zoom,this.pixelRatio=j.pixelRatio,this.tileSize=j.tileSize,this.source=j.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=j.showCollisionBoxes,this.collectResourceTiming=!!j.collectResourceTiming,this.returnDependencies=!!j.returnDependencies,this.promoteId=j.promoteId,this.inFlightDependencies=[],this.dependencySentinel=-1}parse(j,$,te,le,ce){this.status="parsing",this.data=j,this.collisionBoxArray=new h.a3;const Ee=new h.bn(Object.keys(j.layers).sort()),ve=new h.bo(this.tileID,this.promoteId);ve.bucketLayerIDs=[];const de={},be={featureIndex:ve,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:te},Be=$.familiesBySource[this.source];for(const ot in Be){const At=j.layers[ot];if(!At)continue;At.version===1&&h.w(`Vector tile source "${this.source}" layer "${ot}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Si=Ee.encode(ot),Et=[];for(let gt=0;gt<At.length;gt++){const li=At.feature(gt),Ar=ve.getId(li,ot);Et.push({feature:li,id:Ar,index:gt,sourceLayerIndex:Si})}for(const gt of Be[ot]){const li=gt[0];li.source!==this.source&&h.w(`layer.source = ${li.source} does not equal this.source = ${this.source}`),li.minzoom&&this.zoom<Math.floor(li.minzoom)||li.maxzoom&&this.zoom>=li.maxzoom||li.visibility!=="none"&&(X(gt,this.zoom,te),(de[li.id]=li.createBucket({index:ve.bucketLayerIDs.length,layers:gt,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Si,sourceID:this.source})).populate(Et,be,this.tileID.canonical),ve.bucketLayerIDs.push(gt.map(Ar=>Ar.id)))}}let se,_e,De,Ue;const A=h.aH(be.glyphDependencies,ot=>Object.keys(ot).map(Number));this.inFlightDependencies.forEach(ot=>ot==null?void 0:ot.cancel()),this.inFlightDependencies=[];const H=++this.dependencySentinel;Object.keys(A).length?this.inFlightDependencies.push(le.send("getGlyphs",{uid:this.uid,stacks:A,source:this.source,tileID:this.tileID,type:"glyphs"},(ot,At)=>{H===this.dependencySentinel&&(se||(se=ot,_e=At,zt.call(this)))})):_e={};const Ke=Object.keys(be.iconDependencies);Ke.length?this.inFlightDependencies.push(le.send("getImages",{icons:Ke,source:this.source,tileID:this.tileID,type:"icons"},(ot,At)=>{H===this.dependencySentinel&&(se||(se=ot,De=At,zt.call(this)))})):De={};const mt=Object.keys(be.patternDependencies);function zt(){if(se)return ce(se);if(_e&&De&&Ue){const ot=new R(_e),At=new h.bp(De,Ue);for(const Si in de){const Et=de[Si];Et instanceof h.a4?(X(Et.layers,this.zoom,te),h.bq({bucket:Et,glyphMap:_e,glyphPositions:ot.positions,imageMap:De,imagePositions:At.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Et.hasPattern&&(Et instanceof h.br||Et instanceof h.bs||Et instanceof h.bt)&&(X(Et.layers,this.zoom,te),Et.addFeatures(be,this.tileID.canonical,At.patternPositions))}this.status="done",ce(null,{buckets:Object.values(de).filter(Si=>!Si.isEmpty()),featureIndex:ve,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ot.image,imageAtlas:At,glyphMap:this.returnDependencies?_e:null,iconMap:this.returnDependencies?De:null,glyphPositions:this.returnDependencies?ot.positions:null})}}mt.length?this.inFlightDependencies.push(le.send("getImages",{icons:mt,source:this.source,tileID:this.tileID,type:"patterns"},(ot,At)=>{H===this.dependencySentinel&&(se||(se=ot,Ue=At,zt.call(this)))})):Ue={},zt.call(this)}}function X(ae,j,$){const te=new h.a8(j);for(const le of ae)le.recalculate(te,$)}function K(ae,j){const $=h.l(ae.request,(te,le,ce,Ee)=>{if(te)j(te);else if(le)try{const ve=new h.bw.VectorTile(new h.bv(le));j(null,{vectorTile:ve,rawData:le,cacheControl:ce,expires:Ee})}catch(ve){const de=new Uint8Array(le);let be=`Unable to parse the tile at ${ae.request.url}, `;be+=de[0]===31&&de[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${ve.messge}`,j(new Error(be))}});return()=>{$.cancel(),j()}}class Ae{constructor(j,$,te,le){this.actor=j,this.layerIndex=$,this.availableImages=te,this.loadVectorData=le||K,this.fetching={},this.loading={},this.loaded={}}loadTile(j,$){const te=j.uid;this.loading||(this.loading={});const le=!!(j&&j.request&&j.request.collectResourceTiming)&&new h.bu(j.request),ce=this.loading[te]=new ie(j);ce.abort=this.loadVectorData(j,(Ee,ve)=>{if(delete this.loading[te],Ee||!ve)return ce.status="done",this.loaded[te]=ce,$(Ee);const de=ve.rawData,be={};ve.expires&&(be.expires=ve.expires),ve.cacheControl&&(be.cacheControl=ve.cacheControl);const Be={};if(le){const se=le.finish();se&&(Be.resourceTiming=JSON.parse(JSON.stringify(se)))}ce.vectorTile=ve.vectorTile,ce.parse(ve.vectorTile,this.layerIndex,this.availableImages,this.actor,(se,_e)=>{if(delete this.fetching[te],se||!_e)return $(se);$(null,h.e({rawTileData:de.slice(0)},_e,be,Be))}),this.loaded=this.loaded||{},this.loaded[te]=ce,this.fetching[te]={rawTileData:de,cacheControl:be,resourceTiming:Be}})}reloadTile(j,$){const te=this.loaded,le=j.uid;if(te&&te[le]){const ce=te[le];ce.showCollisionBoxes=j.showCollisionBoxes,ce.status==="parsing"?ce.parse(ce.vectorTile,this.layerIndex,this.availableImages,this.actor,(Ee,ve)=>{if(Ee||!ve)return $(Ee,ve);let de;if(this.fetching[le]){const{rawTileData:be,cacheControl:Be,resourceTiming:se}=this.fetching[le];delete this.fetching[le],de=h.e({rawTileData:be.slice(0)},ve,Be,se)}else de=ve;$(null,de)}):ce.status==="done"&&(ce.vectorTile?ce.parse(ce.vectorTile,this.layerIndex,this.availableImages,this.actor,$):$())}}abortTile(j,$){const te=this.loading,le=j.uid;te&&te[le]&&te[le].abort&&(te[le].abort(),delete te[le]),$()}removeTile(j,$){const te=this.loaded,le=j.uid;te&&te[le]&&delete te[le],$()}}class we{constructor(){this.loaded={}}loadTile(j,$){return h._(this,void 0,void 0,function*(){const{uid:te,encoding:le,rawImageData:ce,redFactor:Ee,greenFactor:ve,blueFactor:de,baseShift:be}=j,Be=ce.width+2,se=ce.height+2,_e=h.a(ce)?new h.R({width:Be,height:se},yield h.bx(ce,-1,-1,Be,se)):ce,De=new h.by(te,_e,le,Ee,ve,de,be);this.loaded=this.loaded||{},this.loaded[te]=De,$(null,De)})}removeTile(j){const $=this.loaded,te=j.uid;$&&$[te]&&delete $[te]}}function xe(ae,j){if(ae.length!==0){Te(ae[0],j);for(var $=1;$<ae.length;$++)Te(ae[$],!j)}}function Te(ae,j){for(var $=0,te=0,le=0,ce=ae.length,Ee=ce-1;le<ce;Ee=le++){var ve=(ae[le][0]-ae[Ee][0])*(ae[Ee][1]+ae[le][1]),de=$+ve;te+=Math.abs($)>=Math.abs(ve)?$-de+ve:ve-de+$,$=de}$+te>=0!=!!j&&ae.reverse()}var Le=h.bz(function ae(j,$){var te,le=j&&j.type;if(le==="FeatureCollection")for(te=0;te<j.features.length;te++)ae(j.features[te],$);else if(le==="GeometryCollection")for(te=0;te<j.geometries.length;te++)ae(j.geometries[te],$);else if(le==="Feature")ae(j.geometry,$);else if(le==="Polygon")xe(j.coordinates,$);else if(le==="MultiPolygon")for(te=0;te<j.coordinates.length;te++)xe(j.coordinates[te],$);return j});const Ze=h.bw.VectorTileFeature.prototype.toGeoJSON;var We={exports:{}},je=h.bA,nt=h.bw.VectorTileFeature,Tt=Ot;function Ot(ae,j){this.options=j||{},this.features=ae,this.length=ae.length}function It(ae,j){this.id=typeof ae.id=="number"?ae.id:void 0,this.type=ae.type,this.rawGeometry=ae.type===1?[ae.geometry]:ae.geometry,this.properties=ae.tags,this.extent=j||4096}Ot.prototype.feature=function(ae){return new It(this.features[ae],this.options.extent)},It.prototype.loadGeometry=function(){var ae=this.rawGeometry;this.geometry=[];for(var j=0;j<ae.length;j++){for(var $=ae[j],te=[],le=0;le<$.length;le++)te.push(new je($[le][0],$[le][1]));this.geometry.push(te)}return this.geometry},It.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ae=this.geometry,j=1/0,$=-1/0,te=1/0,le=-1/0,ce=0;ce<ae.length;ce++)for(var Ee=ae[ce],ve=0;ve<Ee.length;ve++){var de=Ee[ve];j=Math.min(j,de.x),$=Math.max($,de.x),te=Math.min(te,de.y),le=Math.max(le,de.y)}return[j,te,$,le]},It.prototype.toGeoJSON=nt.prototype.toGeoJSON;var Kt=h.bB,Lt=Tt;function kt(ae){var j=new Kt;return function($,te){for(var le in $.layers)te.writeMessage(3,Gt,$.layers[le])}(ae,j),j.finish()}function Gt(ae,j){var $;j.writeVarintField(15,ae.version||1),j.writeStringField(1,ae.name||""),j.writeVarintField(5,ae.extent||4096);var te={keys:[],values:[],keycache:{},valuecache:{}};for($=0;$<ae.length;$++)te.feature=ae.feature($),j.writeMessage(2,Jt,te);var le=te.keys;for($=0;$<le.length;$++)j.writeStringField(3,le[$]);var ce=te.values;for($=0;$<ce.length;$++)j.writeMessage(4,Gi,ce[$])}function Jt(ae,j){var $=ae.feature;$.id!==void 0&&j.writeVarintField(1,$.id),j.writeMessage(2,si,ae),j.writeVarintField(3,$.type),j.writeMessage(4,vi,$)}function si(ae,j){var $=ae.feature,te=ae.keys,le=ae.values,ce=ae.keycache,Ee=ae.valuecache;for(var ve in $.properties){var de=$.properties[ve],be=ce[ve];if(de!==null){be===void 0&&(te.push(ve),ce[ve]=be=te.length-1),j.writeVarint(be);var Be=typeof de;Be!=="string"&&Be!=="boolean"&&Be!=="number"&&(de=JSON.stringify(de));var se=Be+":"+de,_e=Ee[se];_e===void 0&&(le.push(de),Ee[se]=_e=le.length-1),j.writeVarint(_e)}}}function ui(ae,j){return(j<<3)+(7&ae)}function _i(ae){return ae<<1^ae>>31}function vi(ae,j){for(var $=ae.loadGeometry(),te=ae.type,le=0,ce=0,Ee=$.length,ve=0;ve<Ee;ve++){var de=$[ve],be=1;te===1&&(be=de.length),j.writeVarint(ui(1,be));for(var Be=te===3?de.length-1:de.length,se=0;se<Be;se++){se===1&&te!==1&&j.writeVarint(ui(2,Be-1));var _e=de[se].x-le,De=de[se].y-ce;j.writeVarint(_i(_e)),j.writeVarint(_i(De)),le+=_e,ce+=De}te===3&&j.writeVarint(ui(7,1))}}function Gi(ae,j){var $=typeof ae;$==="string"?j.writeStringField(1,ae):$==="boolean"?j.writeBooleanField(7,ae):$==="number"&&(ae%1!=0?j.writeDoubleField(3,ae):ae<0?j.writeSVarintField(6,ae):j.writeVarintField(5,ae))}We.exports=kt,We.exports.fromVectorTileJs=kt,We.exports.fromGeojsonVt=function(ae,j){j=j||{};var $={};for(var te in ae)$[te]=new Lt(ae[te].features,j),$[te].name=te,$[te].version=j.version,$[te].extent=j.extent;return kt({layers:$})},We.exports.GeoJSONWrapper=Lt;var Fi=h.bz(We.exports);const Jn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ae=>ae},Wr=Math.fround||(ji=new Float32Array(1),ae=>(ji[0]=+ae,ji[0]));var ji;const ri=3,Oi=5,yn=6;class Xr{constructor(j){this.options=Object.assign(Object.create(Jn),j),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(j){const{log:$,minZoom:te,maxZoom:le}=this.options;$&&console.time("total time");const ce=`prepare ${j.length} points`;$&&console.time(ce),this.points=j;const Ee=[];for(let de=0;de<j.length;de++){const be=j[de];if(!be.geometry)continue;const[Be,se]=be.geometry.coordinates,_e=Wr(ni(Be)),De=Wr(Wi(se));Ee.push(_e,De,1/0,de,-1,1),this.options.reduce&&Ee.push(0)}let ve=this.trees[le+1]=this._createTree(Ee);$&&console.timeEnd(ce);for(let de=le;de>=te;de--){const be=+Date.now();ve=this.trees[de]=this._createTree(this._cluster(ve,de)),$&&console.log("z%d: %d clusters in %dms",de,ve.numItems,+Date.now()-be)}return $&&console.timeEnd("total time"),this}getClusters(j,$){let te=((j[0]+180)%360+360)%360-180;const le=Math.max(-90,Math.min(90,j[1]));let ce=j[2]===180?180:((j[2]+180)%360+360)%360-180;const Ee=Math.max(-90,Math.min(90,j[3]));if(j[2]-j[0]>=360)te=-180,ce=180;else if(te>ce){const se=this.getClusters([te,le,180,Ee],$),_e=this.getClusters([-180,le,ce,Ee],$);return se.concat(_e)}const ve=this.trees[this._limitZoom($)],de=ve.range(ni(te),Wi(Ee),ni(ce),Wi(le)),be=ve.data,Be=[];for(const se of de){const _e=this.stride*se;Be.push(be[_e+Oi]>1?Ye(be,_e,this.clusterProps):this.points[be[_e+ri]])}return Be}getChildren(j){const $=this._getOriginId(j),te=this._getOriginZoom(j),le="No cluster with the specified id.",ce=this.trees[te];if(!ce)throw new Error(le);const Ee=ce.data;if($*this.stride>=Ee.length)throw new Error(le);const ve=this.options.radius/(this.options.extent*Math.pow(2,te-1)),de=ce.within(Ee[$*this.stride],Ee[$*this.stride+1],ve),be=[];for(const Be of de){const se=Be*this.stride;Ee[se+4]===j&&be.push(Ee[se+Oi]>1?Ye(Ee,se,this.clusterProps):this.points[Ee[se+ri]])}if(be.length===0)throw new Error(le);return be}getLeaves(j,$,te){const le=[];return this._appendLeaves(le,j,$=$||10,te=te||0,0),le}getTile(j,$,te){const le=this.trees[this._limitZoom(j)],ce=Math.pow(2,j),{extent:Ee,radius:ve}=this.options,de=ve/Ee,be=(te-de)/ce,Be=(te+1+de)/ce,se={features:[]};return this._addTileFeatures(le.range(($-de)/ce,be,($+1+de)/ce,Be),le.data,$,te,ce,se),$===0&&this._addTileFeatures(le.range(1-de/ce,be,1,Be),le.data,ce,te,ce,se),$===ce-1&&this._addTileFeatures(le.range(0,be,de/ce,Be),le.data,-1,te,ce,se),se.features.length?se:null}getClusterExpansionZoom(j){let $=this._getOriginZoom(j)-1;for(;$<=this.options.maxZoom;){const te=this.getChildren(j);if($++,te.length!==1)break;j=te[0].properties.cluster_id}return $}_appendLeaves(j,$,te,le,ce){const Ee=this.getChildren($);for(const ve of Ee){const de=ve.properties;if(de&&de.cluster?ce+de.point_count<=le?ce+=de.point_count:ce=this._appendLeaves(j,de.cluster_id,te,le,ce):ce<le?ce++:j.push(ve),j.length===te)break}return ce}_createTree(j){const $=new h.av(j.length/this.stride|0,this.options.nodeSize,Float32Array);for(let te=0;te<j.length;te+=this.stride)$.add(j[te],j[te+1]);return $.finish(),$.data=j,$}_addTileFeatures(j,$,te,le,ce,Ee){for(const ve of j){const de=ve*this.stride,be=$[de+Oi]>1;let Be,se,_e;if(be)Be=Dt($,de,this.clusterProps),se=$[de],_e=$[de+1];else{const A=this.points[$[de+ri]];Be=A.properties;const[H,Ke]=A.geometry.coordinates;se=ni(H),_e=Wi(Ke)}const De={type:1,geometry:[[Math.round(this.options.extent*(se*ce-te)),Math.round(this.options.extent*(_e*ce-le))]],tags:Be};let Ue;Ue=be||this.options.generateId?$[de+ri]:this.points[$[de+ri]].id,Ue!==void 0&&(De.id=Ue),Ee.features.push(De)}}_limitZoom(j){return Math.max(this.options.minZoom,Math.min(Math.floor(+j),this.options.maxZoom+1))}_cluster(j,$){const{radius:te,extent:le,reduce:ce,minPoints:Ee}=this.options,ve=te/(le*Math.pow(2,$)),de=j.data,be=[],Be=this.stride;for(let se=0;se<de.length;se+=Be){if(de[se+2]<=$)continue;de[se+2]=$;const _e=de[se],De=de[se+1],Ue=j.within(de[se],de[se+1],ve),A=de[se+Oi];let H=A;for(const Ke of Ue){const mt=Ke*Be;de[mt+2]>$&&(H+=de[mt+Oi])}if(H>A&&H>=Ee){let Ke,mt=_e*A,zt=De*A,ot=-1;const At=((se/Be|0)<<5)+($+1)+this.points.length;for(const Si of Ue){const Et=Si*Be;if(de[Et+2]<=$)continue;de[Et+2]=$;const gt=de[Et+Oi];mt+=de[Et]*gt,zt+=de[Et+1]*gt,de[Et+4]=At,ce&&(Ke||(Ke=this._map(de,se,!0),ot=this.clusterProps.length,this.clusterProps.push(Ke)),ce(Ke,this._map(de,Et)))}de[se+4]=At,be.push(mt/H,zt/H,1/0,At,-1,H),ce&&be.push(ot)}else{for(let Ke=0;Ke<Be;Ke++)be.push(de[se+Ke]);if(H>1)for(const Ke of Ue){const mt=Ke*Be;if(!(de[mt+2]<=$)){de[mt+2]=$;for(let zt=0;zt<Be;zt++)be.push(de[mt+zt])}}}}return be}_getOriginId(j){return j-this.points.length>>5}_getOriginZoom(j){return(j-this.points.length)%32}_map(j,$,te){if(j[$+Oi]>1){const Ee=this.clusterProps[j[$+yn]];return te?Object.assign({},Ee):Ee}const le=this.points[j[$+ri]].properties,ce=this.options.map(le);return te&&ce===le?Object.assign({},ce):ce}}function Ye(ae,j,$){return{type:"Feature",id:ae[j+ri],properties:Dt(ae,j,$),geometry:{type:"Point",coordinates:[(te=ae[j],360*(te-.5)),ro(ae[j+1])]}};var te}function Dt(ae,j,$){const te=ae[j+Oi],le=te>=1e4?`${Math.round(te/1e3)}k`:te>=1e3?Math.round(te/100)/10+"k":te,ce=ae[j+yn],Ee=ce===-1?{}:Object.assign({},$[ce]);return Object.assign(Ee,{cluster:!0,cluster_id:ae[j+ri],point_count:te,point_count_abbreviated:le})}function ni(ae){return ae/360+.5}function Wi(ae){const j=Math.sin(ae*Math.PI/180),$=.5-.25*Math.log((1+j)/(1-j))/Math.PI;return $<0?0:$>1?1:$}function ro(ae){const j=(180-360*ae)*Math.PI/180;return 360*Math.atan(Math.exp(j))/Math.PI-90}function Rn(ae,j,$,te){for(var le,ce=te,Ee=$-j>>1,ve=$-j,de=ae[j],be=ae[j+1],Be=ae[$],se=ae[$+1],_e=j+3;_e<$;_e+=3){var De=no(ae[_e],ae[_e+1],de,be,Be,se);if(De>ce)le=_e,ce=De;else if(De===ce){var Ue=Math.abs(_e-Ee);Ue<ve&&(le=_e,ve=Ue)}}ce>te&&(le-j>3&&Rn(ae,j,le,te),ae[le+2]=ce,$-le>3&&Rn(ae,le,$,te))}function no(ae,j,$,te,le,ce){var Ee=le-$,ve=ce-te;if(Ee!==0||ve!==0){var de=((ae-$)*Ee+(j-te)*ve)/(Ee*Ee+ve*ve);de>1?($=le,te=ce):de>0&&($+=Ee*de,te+=ve*de)}return(Ee=ae-$)*Ee+(ve=j-te)*ve}function vn(ae,j,$,te){var le={id:ae===void 0?null:ae,type:j,geometry:$,tags:te,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ce){var Ee=ce.geometry,ve=ce.type;if(ve==="Point"||ve==="MultiPoint"||ve==="LineString")Ss(ce,Ee);else if(ve==="Polygon"||ve==="MultiLineString")for(var de=0;de<Ee.length;de++)Ss(ce,Ee[de]);else if(ve==="MultiPolygon")for(de=0;de<Ee.length;de++)for(var be=0;be<Ee[de].length;be++)Ss(ce,Ee[de][be])}(le),le}function Ss(ae,j){for(var $=0;$<j.length;$+=3)ae.minX=Math.min(ae.minX,j[$]),ae.minY=Math.min(ae.minY,j[$+1]),ae.maxX=Math.max(ae.maxX,j[$]),ae.maxY=Math.max(ae.maxY,j[$+1])}function es(ae,j,$,te){if(j.geometry){var le=j.geometry.coordinates,ce=j.geometry.type,Ee=Math.pow($.tolerance/((1<<$.maxZoom)*$.extent),2),ve=[],de=j.id;if($.promoteId?de=j.properties[$.promoteId]:$.generateId&&(de=te||0),ce==="Point")pr(le,ve);else if(ce==="MultiPoint")for(var be=0;be<le.length;be++)pr(le[be],ve);else if(ce==="LineString")Lr(le,ve,Ee,!1);else if(ce==="MultiLineString"){if($.lineMetrics){for(be=0;be<le.length;be++)Lr(le[be],ve=[],Ee,!1),ae.push(vn(de,"LineString",ve,j.properties));return}ts(le,ve,Ee,!1)}else if(ce==="Polygon")ts(le,ve,Ee,!0);else{if(ce!=="MultiPolygon"){if(ce==="GeometryCollection"){for(be=0;be<j.geometry.geometries.length;be++)es(ae,{id:de,geometry:j.geometry.geometries[be],properties:j.properties},$,te);return}throw new Error("Input data is not a valid GeoJSON object.")}for(be=0;be<le.length;be++){var Be=[];ts(le[be],Be,Ee,!0),ve.push(Be)}}ae.push(vn(de,ce,ve,j.properties))}}function pr(ae,j){j.push(ze(ae[0])),j.push(Mi(ae[1])),j.push(0)}function Lr(ae,j,$,te){for(var le,ce,Ee=0,ve=0;ve<ae.length;ve++){var de=ze(ae[ve][0]),be=Mi(ae[ve][1]);j.push(de),j.push(be),j.push(0),ve>0&&(Ee+=te?(le*be-de*ce)/2:Math.sqrt(Math.pow(de-le,2)+Math.pow(be-ce,2))),le=de,ce=be}var Be=j.length-3;j[2]=1,Rn(j,0,Be,$),j[Be+2]=1,j.size=Math.abs(Ee),j.start=0,j.end=j.size}function ts(ae,j,$,te){for(var le=0;le<ae.length;le++){var ce=[];Lr(ae[le],ce,$,te),j.push(ce)}}function ze(ae){return ae/360+.5}function Mi(ae){var j=Math.sin(ae*Math.PI/180),$=.5-.25*Math.log((1+j)/(1-j))/Math.PI;return $<0?0:$>1?1:$}function mr(ae,j,$,te,le,ce,Ee,ve){if(te/=j,ce>=($/=j)&&Ee<te)return ae;if(Ee<$||ce>=te)return null;for(var de=[],be=0;be<ae.length;be++){var Be=ae[be],se=Be.geometry,_e=Be.type,De=le===0?Be.minX:Be.minY,Ue=le===0?Be.maxX:Be.maxY;if(De>=$&&Ue<te)de.push(Be);else if(!(Ue<$||De>=te)){var A=[];if(_e==="Point"||_e==="MultiPoint")oi(se,A,$,te,le);else if(_e==="LineString")qt(se,A,$,te,le,!1,ve.lineMetrics);else if(_e==="MultiLineString")Ts(se,A,$,te,le,!1);else if(_e==="Polygon")Ts(se,A,$,te,le,!0);else if(_e==="MultiPolygon")for(var H=0;H<se.length;H++){var Ke=[];Ts(se[H],Ke,$,te,le,!0),Ke.length&&A.push(Ke)}if(A.length){if(ve.lineMetrics&&_e==="LineString"){for(H=0;H<A.length;H++)de.push(vn(Be.id,_e,A[H],Be.tags));continue}_e!=="LineString"&&_e!=="MultiLineString"||(A.length===1?(_e="LineString",A=A[0]):_e="MultiLineString"),_e!=="Point"&&_e!=="MultiPoint"||(_e=A.length===3?"Point":"MultiPoint"),de.push(vn(Be.id,_e,A,Be.tags))}}}return de.length?de:null}function oi(ae,j,$,te,le){for(var ce=0;ce<ae.length;ce+=3){var Ee=ae[ce+le];Ee>=$&&Ee<=te&&(j.push(ae[ce]),j.push(ae[ce+1]),j.push(ae[ce+2]))}}function qt(ae,j,$,te,le,ce,Ee){for(var ve,de,be=Rr(ae),Be=le===0?so:is,se=ae.start,_e=0;_e<ae.length-3;_e+=3){var De=ae[_e],Ue=ae[_e+1],A=ae[_e+2],H=ae[_e+3],Ke=ae[_e+4],mt=le===0?De:Ue,zt=le===0?H:Ke,ot=!1;Ee&&(ve=Math.sqrt(Math.pow(De-H,2)+Math.pow(Ue-Ke,2))),mt<$?zt>$&&(de=Be(be,De,Ue,H,Ke,$),Ee&&(be.start=se+ve*de)):mt>te?zt<te&&(de=Be(be,De,Ue,H,Ke,te),Ee&&(be.start=se+ve*de)):xn(be,De,Ue,A),zt<$&&mt>=$&&(de=Be(be,De,Ue,H,Ke,$),ot=!0),zt>te&&mt<=te&&(de=Be(be,De,Ue,H,Ke,te),ot=!0),!ce&&ot&&(Ee&&(be.end=se+ve*de),j.push(be),be=Rr(ae)),Ee&&(se+=ve)}var At=ae.length-3;De=ae[At],Ue=ae[At+1],A=ae[At+2],(mt=le===0?De:Ue)>=$&&mt<=te&&xn(be,De,Ue,A),At=be.length-3,ce&&At>=3&&(be[At]!==be[0]||be[At+1]!==be[1])&&xn(be,be[0],be[1],be[2]),be.length&&j.push(be)}function Rr(ae){var j=[];return j.size=ae.size,j.start=ae.start,j.end=ae.end,j}function Ts(ae,j,$,te,le,ce){for(var Ee=0;Ee<ae.length;Ee++)qt(ae[Ee],j,$,te,le,ce,!1)}function xn(ae,j,$,te){ae.push(j),ae.push($),ae.push(te)}function so(ae,j,$,te,le,ce){var Ee=(ce-j)/(te-j);return ae.push(ce),ae.push($+(le-$)*Ee),ae.push(1),Ee}function is(ae,j,$,te,le,ce){var Ee=(ce-$)/(le-$);return ae.push(j+(te-j)*Ee),ae.push(ce),ae.push(1),Ee}function Fn(ae,j){for(var $=[],te=0;te<ae.length;te++){var le,ce=ae[te],Ee=ce.type;if(Ee==="Point"||Ee==="MultiPoint"||Ee==="LineString")le=rs(ce.geometry,j);else if(Ee==="MultiLineString"||Ee==="Polygon"){le=[];for(var ve=0;ve<ce.geometry.length;ve++)le.push(rs(ce.geometry[ve],j))}else if(Ee==="MultiPolygon")for(le=[],ve=0;ve<ce.geometry.length;ve++){for(var de=[],be=0;be<ce.geometry[ve].length;be++)de.push(rs(ce.geometry[ve][be],j));le.push(de)}$.push(vn(ce.id,Ee,le,ce.tags))}return $}function rs(ae,j){var $=[];$.size=ae.size,ae.start!==void 0&&($.start=ae.start,$.end=ae.end);for(var te=0;te<ae.length;te+=3)$.push(ae[te]+j,ae[te+1],ae[te+2]);return $}function qe(ae,j){if(ae.transformed)return ae;var $,te,le,ce=1<<ae.z,Ee=ae.x,ve=ae.y;for($=0;$<ae.features.length;$++){var de=ae.features[$],be=de.geometry,Be=de.type;if(de.geometry=[],Be===1)for(te=0;te<be.length;te+=2)de.geometry.push(An(be[te],be[te+1],j,ce,Ee,ve));else for(te=0;te<be.length;te++){var se=[];for(le=0;le<be[te].length;le+=2)se.push(An(be[te][le],be[te][le+1],j,ce,Ee,ve));de.geometry.push(se)}}return ae.transformed=!0,ae}function An(ae,j,$,te,le,ce){return[Math.round($*(ae*te-le)),Math.round($*(j*te-ce))]}function Ei(ae,j,$,te,le){for(var ce=j===le.maxZoom?0:le.tolerance/((1<<j)*le.extent),Ee={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:$,y:te,z:j,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ve=0;ve<ae.length;ve++){Ee.numFeatures++,ns(Ee,ae[ve],ce,le);var de=ae[ve].minX,be=ae[ve].minY,Be=ae[ve].maxX,se=ae[ve].maxY;de<Ee.minX&&(Ee.minX=de),be<Ee.minY&&(Ee.minY=be),Be>Ee.maxX&&(Ee.maxX=Be),se>Ee.maxY&&(Ee.maxY=se)}return Ee}function ns(ae,j,$,te){var le=j.geometry,ce=j.type,Ee=[];if(ce==="Point"||ce==="MultiPoint")for(var ve=0;ve<le.length;ve+=3)Ee.push(le[ve]),Ee.push(le[ve+1]),ae.numPoints++,ae.numSimplified++;else if(ce==="LineString")un(Ee,le,ae,$,!1,!1);else if(ce==="MultiLineString"||ce==="Polygon")for(ve=0;ve<le.length;ve++)un(Ee,le[ve],ae,$,ce==="Polygon",ve===0);else if(ce==="MultiPolygon")for(var de=0;de<le.length;de++){var be=le[de];for(ve=0;ve<be.length;ve++)un(Ee,be[ve],ae,$,!0,ve===0)}if(Ee.length){var Be=j.tags||null;if(ce==="LineString"&&te.lineMetrics){for(var se in Be={},j.tags)Be[se]=j.tags[se];Be.mapbox_clip_start=le.start/le.size,Be.mapbox_clip_end=le.end/le.size}var _e={geometry:Ee,type:ce==="Polygon"||ce==="MultiPolygon"?3:ce==="LineString"||ce==="MultiLineString"?2:1,tags:Be};j.id!==null&&(_e.id=j.id),ae.features.push(_e)}}function un(ae,j,$,te,le,ce){var Ee=te*te;if(te>0&&j.size<(le?Ee:te))$.numPoints+=j.length/3;else{for(var ve=[],de=0;de<j.length;de+=3)(te===0||j[de+2]>Ee)&&($.numSimplified++,ve.push(j[de]),ve.push(j[de+1])),$.numPoints++;le&&function(be,Be){for(var se=0,_e=0,De=be.length,Ue=De-2;_e<De;Ue=_e,_e+=2)se+=(be[_e]-be[Ue])*(be[_e+1]+be[Ue+1]);if(se>0===Be)for(_e=0,De=be.length;_e<De/2;_e+=2){var A=be[_e],H=be[_e+1];be[_e]=be[De-2-_e],be[_e+1]=be[De-1-_e],be[De-2-_e]=A,be[De-1-_e]=H}}(ve,ce),ae.push(ve)}}function $e(ae,j){var $=(j=this.options=function(le,ce){for(var Ee in ce)le[Ee]=ce[Ee];return le}(Object.create(this.options),j)).debug;if($&&console.time("preprocess data"),j.maxZoom<0||j.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(j.promoteId&&j.generateId)throw new Error("promoteId and generateId cannot be used together.");var te=function(le,ce){var Ee=[];if(le.type==="FeatureCollection")for(var ve=0;ve<le.features.length;ve++)es(Ee,le.features[ve],ce,ve);else es(Ee,le.type==="Feature"?le:{geometry:le},ce);return Ee}(ae,j);this.tiles={},this.tileCoords=[],$&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",j.indexMaxZoom,j.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),te=function(le,ce){var Ee=ce.buffer/ce.extent,ve=le,de=mr(le,1,-1-Ee,Ee,0,-1,2,ce),be=mr(le,1,1-Ee,2+Ee,0,-1,2,ce);return(de||be)&&(ve=mr(le,1,-Ee,1+Ee,0,-1,2,ce)||[],de&&(ve=Fn(de,1).concat(ve)),be&&(ve=ve.concat(Fn(be,-1)))),ve}(te,j),te.length&&this.splitTile(te,0,0,0),$&&(te.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Vt(ae,j,$){return 32*((1<<ae)*$+j)+ae}function Mt(ae,j){return j?ae.properties[j]:ae.id}function Xi(ae,j){if(ae==null)return!0;if(ae.type==="Feature")return Mt(ae,j)!=null;if(ae.type==="FeatureCollection"){const $=new Set;for(const te of ae.features){const le=Mt(te,j);if(le==null||$.has(le))return!1;$.add(le)}return!0}return!1}function cn(ae,j){const $=new Map;if(ae!=null)if(ae.type==="Feature")$.set(Mt(ae,j),ae);else for(const te of ae.features)$.set(Mt(te,j),te);return $}$e.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},$e.prototype.splitTile=function(ae,j,$,te,le,ce,Ee){for(var ve=[ae,j,$,te],de=this.options,be=de.debug;ve.length;){te=ve.pop(),$=ve.pop(),j=ve.pop(),ae=ve.pop();var Be=1<<j,se=Vt(j,$,te),_e=this.tiles[se];if(!_e&&(be>1&&console.time("creation"),_e=this.tiles[se]=Ei(ae,j,$,te,de),this.tileCoords.push({z:j,x:$,y:te}),be)){be>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",j,$,te,_e.numFeatures,_e.numPoints,_e.numSimplified),console.timeEnd("creation"));var De="z"+j;this.stats[De]=(this.stats[De]||0)+1,this.total++}if(_e.source=ae,le){if(j===de.maxZoom||j===le)continue;var Ue=1<<le-j;if($!==Math.floor(ce/Ue)||te!==Math.floor(Ee/Ue))continue}else if(j===de.indexMaxZoom||_e.numPoints<=de.indexMaxPoints)continue;if(_e.source=null,ae.length!==0){be>1&&console.time("clipping");var A,H,Ke,mt,zt,ot,At=.5*de.buffer/de.extent,Si=.5-At,Et=.5+At,gt=1+At;A=H=Ke=mt=null,zt=mr(ae,Be,$-At,$+Et,0,_e.minX,_e.maxX,de),ot=mr(ae,Be,$+Si,$+gt,0,_e.minX,_e.maxX,de),ae=null,zt&&(A=mr(zt,Be,te-At,te+Et,1,_e.minY,_e.maxY,de),H=mr(zt,Be,te+Si,te+gt,1,_e.minY,_e.maxY,de),zt=null),ot&&(Ke=mr(ot,Be,te-At,te+Et,1,_e.minY,_e.maxY,de),mt=mr(ot,Be,te+Si,te+gt,1,_e.minY,_e.maxY,de),ot=null),be>1&&console.timeEnd("clipping"),ve.push(A||[],j+1,2*$,2*te),ve.push(H||[],j+1,2*$,2*te+1),ve.push(Ke||[],j+1,2*$+1,2*te),ve.push(mt||[],j+1,2*$+1,2*te+1)}}},$e.prototype.getTile=function(ae,j,$){var te=this.options,le=te.extent,ce=te.debug;if(ae<0||ae>24)return null;var Ee=1<<ae,ve=Vt(ae,j=(j%Ee+Ee)%Ee,$);if(this.tiles[ve])return qe(this.tiles[ve],le);ce>1&&console.log("drilling down to z%d-%d-%d",ae,j,$);for(var de,be=ae,Be=j,se=$;!de&&be>0;)be--,Be=Math.floor(Be/2),se=Math.floor(se/2),de=this.tiles[Vt(be,Be,se)];return de&&de.source?(ce>1&&console.log("found parent tile z%d-%d-%d",be,Be,se),ce>1&&console.time("drilling down"),this.splitTile(de.source,be,Be,se,ae,j,$),ce>1&&console.timeEnd("drilling down"),this.tiles[ve]?qe(this.tiles[ve],le):null):null};class Bt extends Ae{constructor(j,$,te,le){super(j,$,te),this._dataUpdateable=new Map,this.loadGeoJSON=(ce,Ee)=>{const{promoteId:ve}=ce;if(ce.request)return h.f(ce.request,(de,be,Be,se)=>{this._dataUpdateable=Xi(be,ve)?cn(be,ve):void 0,Ee(de,be,Be,se)});if(typeof ce.data=="string")try{const de=JSON.parse(ce.data);this._dataUpdateable=Xi(de,ve)?cn(de,ve):void 0,Ee(null,de)}catch{Ee(new Error(`Input data given to '${ce.source}' is not a valid GeoJSON object.`))}else ce.dataDiff?this._dataUpdateable?(function(de,be,Be){var se,_e,De,Ue;if(be.removeAll&&de.clear(),be.remove)for(const A of be.remove)de.delete(A);if(be.add)for(const A of be.add){const H=Mt(A,Be);H!=null&&de.set(H,A)}if(be.update)for(const A of be.update){let H=de.get(A.id);if(H==null)continue;const Ke=!A.removeAllProperties&&(((se=A.removeProperties)===null||se===void 0?void 0:se.length)>0||((_e=A.addOrUpdateProperties)===null||_e===void 0?void 0:_e.length)>0);if((A.newGeometry||A.removeAllProperties||Ke)&&(H=Object.assign({},H),de.set(A.id,H),Ke&&(H.properties=Object.assign({},H.properties))),A.newGeometry&&(H.geometry=A.newGeometry),A.removeAllProperties)H.properties={};else if(((De=A.removeProperties)===null||De===void 0?void 0:De.length)>0)for(const mt of A.removeProperties)Object.prototype.hasOwnProperty.call(H.properties,mt)&&delete H.properties[mt];if(((Ue=A.addOrUpdateProperties)===null||Ue===void 0?void 0:Ue.length)>0)for(const{key:mt,value:zt}of A.addOrUpdateProperties)H.properties[mt]=zt}}(this._dataUpdateable,ce.dataDiff,ve),Ee(null,{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())})):Ee(new Error(`Cannot update existing geojson data in ${ce.source}`)):Ee(new Error(`Input data given to '${ce.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},this.loadVectorData=this.loadGeoJSONTile,le&&(this.loadGeoJSON=le)}loadGeoJSONTile(j,$){const te=j.tileID.canonical;if(!this._geoJSONIndex)return $(null,null);const le=this._geoJSONIndex.getTile(te.z,te.x,te.y);if(!le)return $(null,null);const ce=new class{constructor(ve){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=h.N,this.length=ve.length,this._features=ve}feature(ve){return new class{constructor(de){this._feature=de,this.extent=h.N,this.type=de.type,this.properties=de.tags,"id"in de&&!isNaN(de.id)&&(this.id=parseInt(de.id,10))}loadGeometry(){if(this._feature.type===1){const de=[];for(const be of this._feature.geometry)de.push([new h.P(be[0],be[1])]);return de}{const de=[];for(const be of this._feature.geometry){const Be=[];for(const se of be)Be.push(new h.P(se[0],se[1]));de.push(Be)}return de}}toGeoJSON(de,be,Be){return Ze.call(this,de,be,Be)}}(this._features[ve])}}(le.features);let Ee=Fi(ce);Ee.byteOffset===0&&Ee.byteLength===Ee.buffer.byteLength||(Ee=new Uint8Array(Ee)),$(null,{vectorTile:ce,rawData:Ee.buffer})}loadData(j,$){var te;(te=this._pendingRequest)===null||te===void 0||te.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const le=!!(j&&j.request&&j.request.collectResourceTiming)&&new h.bu(j.request);this._pendingCallback=$,this._pendingRequest=this.loadGeoJSON(j,(ce,Ee)=>{if(delete this._pendingCallback,delete this._pendingRequest,ce||!Ee)return $(ce);if(typeof Ee!="object")return $(new Error(`Input data given to '${j.source}' is not a valid GeoJSON object.`));{Le(Ee,!0);try{if(j.filter){const de=h.bC(j.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(de.result==="error")throw new Error(de.value.map(Be=>`${Be.key}: ${Be.message}`).join(", "));Ee={type:"FeatureCollection",features:Ee.features.filter(Be=>de.value.evaluate({zoom:0},Be))}}this._geoJSONIndex=j.cluster?new Xr(function({superclusterOptions:de,clusterProperties:be}){if(!be||!de)return de;const Be={},se={},_e={accumulated:null,zoom:0},De={properties:null},Ue=Object.keys(be);for(const A of Ue){const[H,Ke]=be[A],mt=h.bC(Ke),zt=h.bC(typeof H=="string"?[H,["accumulated"],["get",A]]:H);Be[A]=mt.value,se[A]=zt.value}return de.map=A=>{De.properties=A;const H={};for(const Ke of Ue)H[Ke]=Be[Ke].evaluate(_e,De);return H},de.reduce=(A,H)=>{De.properties=H;for(const Ke of Ue)_e.accumulated=A[Ke],A[Ke]=se[Ke].evaluate(_e,De)},de}(j)).load(Ee.features):function(de,be){return new $e(de,be)}(Ee,j.geojsonVtOptions)}catch(de){return $(de)}this.loaded={};const ve={};if(le){const de=le.finish();de&&(ve.resourceTiming={},ve.resourceTiming[j.source]=JSON.parse(JSON.stringify(de)))}$(null,ve)}})}reloadTile(j,$){const te=this.loaded;return te&&te[j.uid]?super.reloadTile(j,$):this.loadTile(j,$)}removeSource(j,$){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),$()}getClusterExpansionZoom(j,$){try{$(null,this._geoJSONIndex.getClusterExpansionZoom(j.clusterId))}catch(te){$(te)}}getClusterChildren(j,$){try{$(null,this._geoJSONIndex.getChildren(j.clusterId))}catch(te){$(te)}}getClusterLeaves(j,$){try{$(null,this._geoJSONIndex.getLeaves(j.clusterId,j.limit,j.offset))}catch(te){$(te)}}}class Ve{constructor(j){this.self=j,this.actor=new h.C(j,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:Ae,geojson:Bt},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=($,te)=>{if(this.workerSourceTypes[$])throw new Error(`Worker source with name "${$}" already registered.`);this.workerSourceTypes[$]=te},this.self.registerRTLTextPlugin=$=>{if(h.bD.isParsed())throw new Error("RTL text plugin already registered.");h.bD.applyArabicShaping=$.applyArabicShaping,h.bD.processBidirectionalText=$.processBidirectionalText,h.bD.processStyledBidirectionalText=$.processStyledBidirectionalText}}setReferrer(j,$){this.referrer=$}setImages(j,$,te){this.availableImages[j]=$;for(const le in this.workerSources[j]){const ce=this.workerSources[j][le];for(const Ee in ce)ce[Ee].availableImages=$}te()}setLayers(j,$,te){this.getLayerIndex(j).replace($),te()}updateLayers(j,$,te){this.getLayerIndex(j).update($.layers,$.removedIds),te()}loadTile(j,$,te){this.getWorkerSource(j,$.type,$.source).loadTile($,te)}loadDEMTile(j,$,te){this.getDEMWorkerSource(j,$.source).loadTile($,te)}reloadTile(j,$,te){this.getWorkerSource(j,$.type,$.source).reloadTile($,te)}abortTile(j,$,te){this.getWorkerSource(j,$.type,$.source).abortTile($,te)}removeTile(j,$,te){this.getWorkerSource(j,$.type,$.source).removeTile($,te)}removeDEMTile(j,$){this.getDEMWorkerSource(j,$.source).removeTile($)}removeSource(j,$,te){if(!this.workerSources[j]||!this.workerSources[j][$.type]||!this.workerSources[j][$.type][$.source])return;const le=this.workerSources[j][$.type][$.source];delete this.workerSources[j][$.type][$.source],le.removeSource!==void 0?le.removeSource($,te):te()}loadWorkerSource(j,$,te){try{this.self.importScripts($.url),te()}catch(le){te(le.toString())}}syncRTLPluginState(j,$,te){try{h.bD.setState($);const le=h.bD.getPluginURL();if(h.bD.isLoaded()&&!h.bD.isParsed()&&le!=null){this.self.importScripts(le);const ce=h.bD.isParsed();te(ce?void 0:new Error(`RTL Text Plugin failed to import scripts from ${le}`),ce)}}catch(le){te(le.toString())}}getAvailableImages(j){let $=this.availableImages[j];return $||($=[]),$}getLayerIndex(j){let $=this.layerIndexes[j];return $||($=this.layerIndexes[j]=new U),$}getWorkerSource(j,$,te){return this.workerSources[j]||(this.workerSources[j]={}),this.workerSources[j][$]||(this.workerSources[j][$]={}),this.workerSources[j][$][te]||(this.workerSources[j][$][te]=new this.workerSourceTypes[$]({send:(le,ce,Ee)=>{this.actor.send(le,ce,Ee,j)}},this.getLayerIndex(j),this.getAvailableImages(j))),this.workerSources[j][$][te]}getDEMWorkerSource(j,$){return this.demWorkerSources[j]||(this.demWorkerSources[j]={}),this.demWorkerSources[j][$]||(this.demWorkerSources[j][$]=new we),this.demWorkerSources[j][$]}}return h.i()&&(self.worker=new Ve(self)),Ve}),L(["./shared"],function(h){var U="3.6.2";class R{static testProp(t){if(!R.docStyle)return t[0];for(let a=0;a<t.length;a++)if(t[a]in R.docStyle)return t[a];return t[0]}static create(t,a,d){const g=window.document.createElement(t);return a!==void 0&&(g.className=a),d&&d.appendChild(g),g}static createNS(t,a){return window.document.createElementNS(t,a)}static disableDrag(){R.docStyle&&R.selectProp&&(R.userSelect=R.docStyle[R.selectProp],R.docStyle[R.selectProp]="none")}static enableDrag(){R.docStyle&&R.selectProp&&(R.docStyle[R.selectProp]=R.userSelect)}static setTransform(t,a){t.style[R.transformProp]=a}static addEventListener(t,a,d,g={}){t.addEventListener(a,d,"passive"in g?g:g.capture)}static removeEventListener(t,a,d,g={}){t.removeEventListener(a,d,"passive"in g?g:g.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",R.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",R.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",R.suppressClickInternal,!0)},0)}static mousePos(t,a){const d=t.getBoundingClientRect();return new h.P(a.clientX-d.left-t.clientLeft,a.clientY-d.top-t.clientTop)}static touchPos(t,a){const d=t.getBoundingClientRect(),g=[];for(let b=0;b<a.length;b++)g.push(new h.P(a[b].clientX-d.left-t.clientLeft,a[b].clientY-d.top-t.clientTop));return g}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}}R.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,R.selectProp=R.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),R.transformProp=R.testProp(["transform","WebkitTransform"]);const ie={supported:!1,testSupport:function(v){!Ae&&K&&(we?xe(v):X=v)}};let X,K,Ae=!1,we=!1;function xe(v){const t=v.createTexture();v.bindTexture(v.TEXTURE_2D,t);try{if(v.texImage2D(v.TEXTURE_2D,0,v.RGBA,v.RGBA,v.UNSIGNED_BYTE,K),v.isContextLost())return;ie.supported=!0}catch{}v.deleteTexture(t),Ae=!0}var Te,Le;typeof document<"u"&&(K=document.createElement("img"),K.onload=function(){X&&xe(X),X=null,we=!0},K.onerror=function(){Ae=!0,X=null},K.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(v){let t,a,d,g;v.resetRequestQueue=()=>{t=[],a=0,d=0,g={}},v.addThrottleControl=s=>{const l=d++;return g[l]=s,l},v.removeThrottleControl=s=>{delete g[s],i()},v.getImage=(s,l,c=!0)=>{ie.supported&&(s.headers||(s.headers={}),s.headers.accept="image/webp,*/*");const f={requestParameters:s,supportImageRefresh:c,callback:l,cancelled:!1,completed:!1,cancel:()=>{f.completed||f.cancelled||(f.cancelled=!0,f.innerRequest&&(f.innerRequest.cancel(),a--),i())}};return t.push(f),i(),f};const b=s=>{const{requestParameters:l,supportImageRefresh:c,callback:f}=s;return h.e(l,{type:"image"}),(c!==!1||h.i()||h.g(l.url)||l.headers&&!Object.keys(l.headers).reduce((y,x)=>y&&x==="accept",!0)?h.m:n)(l,(y,x,S,C)=>{M(s,f,y,x,S,C)})},M=(s,l,c,f,y,x)=>{c?l(c):f instanceof HTMLImageElement||h.a(f)?l(null,f):f&&((S,C)=>{typeof createImageBitmap=="function"?h.b(S,C):h.d(S,C)})(f,(S,C)=>{S!=null?l(S):C!=null&&l(null,C,{cacheControl:y,expires:x})}),s.cancelled||(s.completed=!0,a--,i())},i=()=>{const s=(()=>{const l=Object.keys(g);let c=!1;if(l.length>0){for(const f of l)if(c=g[f](),c)break}return c})()?h.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:h.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let l=a;l<s&&t.length>0;l++){const c=t.shift();if(c.cancelled){l--;continue}const f=b(c);a++,c.innerRequest=f}},n=(s,l)=>{const c=new Image,f=s.url;let y=!1;const x=s.credentials;return x&&x==="include"?c.crossOrigin="use-credentials":(x&&x==="same-origin"||!h.s(f))&&(c.crossOrigin="anonymous"),c.fetchPriority="high",c.onload=()=>{l(null,c),c.onerror=c.onload=null},c.onerror=()=>{y||l(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")),c.onerror=c.onload=null},c.src=f,{cancel:()=>{y=!0,c.src=""}}}}(Te||(Te={})),Te.resetRequestQueue(),function(v){v.Glyphs="Glyphs",v.Image="Image",v.Source="Source",v.SpriteImage="SpriteImage",v.SpriteJSON="SpriteJSON",v.Style="Style",v.Tile="Tile",v.Unknown="Unknown"}(Le||(Le={}));class Ze{constructor(t){this._transformRequestFn=t}transformRequest(t,a){return this._transformRequestFn&&this._transformRequestFn(t,a)||{url:t}}normalizeSpriteURL(t,a,d){const g=function(b){const M=b.match(We);if(!M)throw new Error(`Unable to parse URL "${b}"`);return{protocol:M[1],authority:M[2],path:M[3]||"/",params:M[4]?M[4].split("&"):[]}}(t);return g.path+=`${a}${d}`,function(b){const M=b.params.length?`?${b.params.join("&")}`:"";return`${b.protocol}://${b.authority}${b.path}${M}`}(g)}setTransformRequest(t){this._transformRequestFn=t}}const We=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function je(v){var t=new h.A(3);return t[0]=v[0],t[1]=v[1],t[2]=v[2],t}var nt,Tt=function(v,t,a){return v[0]=t[0]-a[0],v[1]=t[1]-a[1],v[2]=t[2]-a[2],v};nt=new h.A(3),h.A!=Float32Array&&(nt[0]=0,nt[1]=0,nt[2]=0);var Ot=function(v){var t=v[0],a=v[1];return t*t+a*a};function It(v){const t=[];if(typeof v=="string")t.push({id:"default",url:v});else if(v&&v.length>0){const a=[];for(const{id:d,url:g}of v){const b=`${d}${g}`;a.indexOf(b)===-1&&(a.push(b),t.push({id:d,url:g}))}}return t}function Kt(v,t,a,d,g){if(d)return void v(d);if(g!==Object.values(t).length||g!==Object.values(a).length)return;const b={};for(const M in t){b[M]={};const i=h.h.getImageCanvasContext(a[M]),n=t[M];for(const s in n){const{width:l,height:c,x:f,y,sdf:x,pixelRatio:S,stretchX:C,stretchY:z,content:G}=n[s];b[M][s]={data:null,pixelRatio:S,sdf:x,stretchX:C,stretchY:z,content:G,spriteData:{width:l,height:c,x:f,y,context:i}}}}v(null,b)}(function(){var v=new h.A(2);h.A!=Float32Array&&(v[0]=0,v[1]=0)})();class Lt{constructor(t,a,d,g){this.context=t,this.format=d,this.texture=t.gl.createTexture(),this.update(a,g)}update(t,a,d){const{width:g,height:b}=t,M=!(this.size&&this.size[0]===g&&this.size[1]===b||d),{context:i}=this,{gl:n}=i;if(this.useMipmap=!!(a&&a.useMipmap),n.bindTexture(n.TEXTURE_2D,this.texture),i.pixelStoreUnpackFlipY.set(!1),i.pixelStoreUnpack.set(1),i.pixelStoreUnpackPremultiplyAlpha.set(this.format===n.RGBA&&(!a||a.premultiply!==!1)),M)this.size=[g,b],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||h.a(t)?n.texImage2D(n.TEXTURE_2D,0,this.format,this.format,n.UNSIGNED_BYTE,t):n.texImage2D(n.TEXTURE_2D,0,this.format,g,b,0,this.format,n.UNSIGNED_BYTE,t.data);else{const{x:s,y:l}=d||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||h.a(t)?n.texSubImage2D(n.TEXTURE_2D,0,s,l,n.RGBA,n.UNSIGNED_BYTE,t):n.texSubImage2D(n.TEXTURE_2D,0,s,l,g,b,n.RGBA,n.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&n.generateMipmap(n.TEXTURE_2D)}bind(t,a,d){const{context:g}=this,{gl:b}=g;b.bindTexture(b.TEXTURE_2D,this.texture),d!==b.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(d=b.LINEAR),t!==this.filter&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,t),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,d||t),this.filter=t),a!==this.wrap&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,a),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,a),this.wrap=a)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}function kt(v){const{userImage:t}=v;return!!(t&&t.render&&t.render())&&(v.data.replace(new Uint8Array(t.data.buffer)),!0)}class Gt extends h.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new h.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:a,callback:d}of this.requestors)this._notify(a,d);this.requestors=[]}}getImage(t){const a=this.images[t];if(a&&!a.data&&a.spriteData){const d=a.spriteData;a.data=new h.R({width:d.width,height:d.height},d.context.getImageData(d.x,d.y,d.width,d.height).data),a.spriteData=null}return a}addImage(t,a){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,a)&&(this.images[t]=a)}_validate(t,a){let d=!0;const g=a.data||a.spriteData;return this._validateStretch(a.stretchX,g&&g.width)||(this.fire(new h.j(new Error(`Image "${t}" has invalid "stretchX" value`))),d=!1),this._validateStretch(a.stretchY,g&&g.height)||(this.fire(new h.j(new Error(`Image "${t}" has invalid "stretchY" value`))),d=!1),this._validateContent(a.content,a)||(this.fire(new h.j(new Error(`Image "${t}" has invalid "content" value`))),d=!1),d}_validateStretch(t,a){if(!t)return!0;let d=0;for(const g of t){if(g[0]<d||g[1]<g[0]||a<g[1])return!1;d=g[1]}return!0}_validateContent(t,a){if(!t)return!0;if(t.length!==4)return!1;const d=a.spriteData,g=d&&d.width||a.data.width,b=d&&d.height||a.data.height;return!(t[0]<0||g<t[0]||t[1]<0||b<t[1]||t[2]<0||g<t[2]||t[3]<0||b<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,a,d=!0){const g=this.getImage(t);if(d&&(g.data.width!==a.data.width||g.data.height!==a.data.height))throw new Error(`size mismatch between old image (${g.data.width}x${g.data.height}) and new image (${a.data.width}x${a.data.height}).`);a.version=g.version+1,this.images[t]=a,this.updatedImages[t]=!0}removeImage(t){const a=this.images[t];delete this.images[t],delete this.patterns[t],a.userImage&&a.userImage.onRemove&&a.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,a){let d=!0;if(!this.isLoaded())for(const g of t)this.images[g]||(d=!1);this.isLoaded()||d?this._notify(t,a):this.requestors.push({ids:t,callback:a})}_notify(t,a){const d={};for(const g of t){let b=this.getImage(g);b||(this.fire(new h.k("styleimagemissing",{id:g})),b=this.getImage(g)),b?d[g]={data:b.data.clone(),pixelRatio:b.pixelRatio,sdf:b.sdf,version:b.version,stretchX:b.stretchX,stretchY:b.stretchY,content:b.content,hasRenderCallback:!!(b.userImage&&b.userImage.render)}:h.w(`Image "${g}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}a(null,d)}getPixelSize(){const{width:t,height:a}=this.atlasImage;return{width:t,height:a}}getPattern(t){const a=this.patterns[t],d=this.getImage(t);if(!d)return null;if(a&&a.position.version===d.version)return a.position;if(a)a.position.version=d.version;else{const g={w:d.data.width+2,h:d.data.height+2,x:0,y:0},b=new h.I(g,d);this.patterns[t]={bin:g,position:b}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const a=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Lt(t,this.atlasImage,a.RGBA),this.atlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const b in this.patterns)t.push(this.patterns[b].bin);const{w:a,h:d}=h.p(t),g=this.atlasImage;g.resize({width:a||1,height:d||1});for(const b in this.patterns){const{bin:M}=this.patterns[b],i=M.x+1,n=M.y+1,s=this.getImage(b).data,l=s.width,c=s.height;h.R.copy(s,g,{x:0,y:0},{x:i,y:n},{width:l,height:c}),h.R.copy(s,g,{x:0,y:c-1},{x:i,y:n-1},{width:l,height:1}),h.R.copy(s,g,{x:0,y:0},{x:i,y:n+c},{width:l,height:1}),h.R.copy(s,g,{x:l-1,y:0},{x:i-1,y:n},{width:1,height:c}),h.R.copy(s,g,{x:0,y:0},{x:i+l,y:n},{width:1,height:c})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const a of t){if(this.callbackDispatchedThisFrame[a])continue;this.callbackDispatchedThisFrame[a]=!0;const d=this.getImage(a);d||h.w(`Image with ID: "${a}" was not found`),kt(d)&&this.updateImage(a,d)}}}const Jt=1e20;function si(v,t,a,d,g,b,M,i,n){for(let s=t;s<t+d;s++)ui(v,a*b+s,b,g,M,i,n);for(let s=a;s<a+g;s++)ui(v,s*b+t,1,d,M,i,n)}function ui(v,t,a,d,g,b,M){b[0]=0,M[0]=-Jt,M[1]=Jt,g[0]=v[t];for(let i=1,n=0,s=0;i<d;i++){g[i]=v[t+i*a];const l=i*i;do{const c=b[n];s=(g[i]-g[c]+l-c*c)/(i-c)/2}while(s<=M[n]&&--n>-1);n++,b[n]=i,M[n]=s,M[n+1]=Jt}for(let i=0,n=0;i<d;i++){for(;M[n+1]<i;)n++;const s=b[n],l=i-s;v[t+i*a]=g[s]+l*l}}class _i{constructor(t,a){this.requestManager=t,this.localIdeographFontFamily=a,this.entries={}}setURL(t){this.url=t}getGlyphs(t,a){const d=[];for(const g in t)for(const b of t[g])d.push({stack:g,id:b});h.o(d,({stack:g,id:b},M)=>{let i=this.entries[g];i||(i=this.entries[g]={glyphs:{},requests:{},ranges:{}});let n=i.glyphs[b];if(n!==void 0)return void M(null,{stack:g,id:b,glyph:n});if(n=this._tinySDF(i,g,b),n)return i.glyphs[b]=n,void M(null,{stack:g,id:b,glyph:n});const s=Math.floor(b/256);if(256*s>65535)return void M(new Error("glyphs > 65535 not supported"));if(i.ranges[s])return void M(null,{stack:g,id:b,glyph:n});if(!this.url)return void M(new Error("glyphsUrl is not set"));let l=i.requests[s];l||(l=i.requests[s]=[],_i.loadGlyphRange(g,s,this.url,this.requestManager,(c,f)=>{if(f){for(const y in f)this._doesCharSupportLocalGlyph(+y)||(i.glyphs[+y]=f[+y]);i.ranges[s]=!0}for(const y of l)y(c,f);delete i.requests[s]})),l.push((c,f)=>{c?M(c):f&&M(null,{stack:g,id:b,glyph:f[b]||null})})},(g,b)=>{if(g)a(g);else if(b){const M={};for(const{stack:i,id:n,glyph:s}of b)(M[i]||(M[i]={}))[n]=s&&{id:s.id,bitmap:s.bitmap.clone(),metrics:s.metrics};a(null,M)}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&(h.u["CJK Unified Ideographs"](t)||h.u["Hangul Syllables"](t)||h.u.Hiragana(t)||h.u.Katakana(t))}_tinySDF(t,a,d){const g=this.localIdeographFontFamily;if(!g||!this._doesCharSupportLocalGlyph(d))return;let b=t.tinySDF;if(!b){let i="400";/bold/i.test(a)?i="900":/medium/i.test(a)?i="500":/light/i.test(a)&&(i="200"),b=t.tinySDF=new _i.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:g,fontWeight:i})}const M=b.draw(String.fromCharCode(d));return{id:d,bitmap:new h.q({width:M.width||60,height:M.height||60},M.data),metrics:{width:M.glyphWidth/2||24,height:M.glyphHeight/2||24,left:M.glyphLeft/2+.5||0,top:M.glyphTop/2-27.5||-8,advance:M.glyphAdvance/2||24,isDoubleResolution:!0}}}}_i.loadGlyphRange=function(v,t,a,d,g){const b=256*t,M=b+255,i=d.transformRequest(a.replace("{fontstack}",v).replace("{range}",`${b}-${M}`),Le.Glyphs);h.l(i,(n,s)=>{if(n)g(n);else if(s){const l={};for(const c of h.n(s))l[c.id]=c;g(null,l)}})},_i.TinySDF=class{constructor({fontSize:v=24,buffer:t=3,radius:a=8,cutoff:d=.25,fontFamily:g="sans-serif",fontWeight:b="normal",fontStyle:M="normal"}={}){this.buffer=t,this.cutoff=d,this.radius=a;const i=this.size=v+4*t,n=this._createCanvas(i),s=this.ctx=n.getContext("2d",{willReadFrequently:!0});s.font=`${M} ${b} ${v}px ${g}`,s.textBaseline="alphabetic",s.textAlign="left",s.fillStyle="black",this.gridOuter=new Float64Array(i*i),this.gridInner=new Float64Array(i*i),this.f=new Float64Array(i),this.z=new Float64Array(i+1),this.v=new Uint16Array(i)}_createCanvas(v){const t=document.createElement("canvas");return t.width=t.height=v,t}draw(v){const{width:t,actualBoundingBoxAscent:a,actualBoundingBoxDescent:d,actualBoundingBoxLeft:g,actualBoundingBoxRight:b}=this.ctx.measureText(v),M=Math.ceil(a),i=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(b-g))),n=Math.min(this.size-this.buffer,M+Math.ceil(d)),s=i+2*this.buffer,l=n+2*this.buffer,c=Math.max(s*l,0),f=new Uint8ClampedArray(c),y={data:f,width:s,height:l,glyphWidth:i,glyphHeight:n,glyphTop:M,glyphLeft:0,glyphAdvance:t};if(i===0||n===0)return y;const{ctx:x,buffer:S,gridInner:C,gridOuter:z}=this;x.clearRect(S,S,i,n),x.fillText(v,S,S+M);const G=x.getImageData(S,S,i,n);z.fill(Jt,0,c),C.fill(0,0,c);for(let N=0;N<n;N++)for(let Z=0;Z<i;Z++){const Q=G.data[4*(N*i+Z)+3]/255;if(Q===0)continue;const ee=(N+S)*s+Z+S;if(Q===1)z[ee]=0,C[ee]=Jt;else{const he=.5-Q;z[ee]=he>0?he*he:0,C[ee]=he<0?he*he:0}}si(z,0,0,s,l,s,this.f,this.v,this.z),si(C,S,S,i,n,s,this.f,this.v,this.z);for(let N=0;N<c;N++){const Z=Math.sqrt(z[N])-Math.sqrt(C[N]);f[N]=Math.round(255-255*(Z/this.radius+this.cutoff))}return y}};class vi{constructor(){this.specification=h.v.light.position}possiblyEvaluate(t,a){return h.z(t.expression.evaluate(a))}interpolate(t,a,d){return{x:h.B.number(t.x,a.x,d),y:h.B.number(t.y,a.y,d),z:h.B.number(t.z,a.z,d)}}}let Gi;class Fi extends h.E{constructor(t){super(),Gi=Gi||new h.r({anchor:new h.D(h.v.light.anchor),position:new vi,color:new h.D(h.v.light.color),intensity:new h.D(h.v.light.intensity)}),this._transitionable=new h.T(Gi),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,a={}){if(!this._validate(h.t,t,a))for(const d in t){const g=t[d];d.endsWith("-transition")?this._transitionable.setTransition(d.slice(0,-11),g):this._transitionable.setValue(d,g)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,a,d){return(!d||d.validate!==!1)&&h.x(this,t.call(h.y,h.e({value:a,style:{glyphs:!0,sprite:!0},styleSpec:h.v})))}}class Jn{constructor(t,a){this.width=t,this.height=a,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,a){const d=t.join(",")+String(a);return this.dashEntry[d]||(this.dashEntry[d]=this.addDash(t,a)),this.dashEntry[d]}getDashRanges(t,a,d){const g=[];let b=t.length%2==1?-t[t.length-1]*d:0,M=t[0]*d,i=!0;g.push({left:b,right:M,isDash:i,zeroLength:t[0]===0});let n=t[0];for(let s=1;s<t.length;s++){i=!i;const l=t[s];b=n*d,n+=l,M=n*d,g.push({left:b,right:M,isDash:i,zeroLength:l===0})}return g}addRoundDash(t,a,d){const g=a/2;for(let b=-d;b<=d;b++){const M=this.width*(this.nextRow+d+b);let i=0,n=t[i];for(let s=0;s<this.width;s++){s/n.right>1&&(n=t[++i]);const l=Math.abs(s-n.left),c=Math.abs(s-n.right),f=Math.min(l,c);let y;const x=b/d*(g+1);if(n.isDash){const S=g-Math.abs(x);y=Math.sqrt(f*f+S*S)}else y=g-Math.sqrt(f*f+x*x);this.data[M+s]=Math.max(0,Math.min(255,y+128))}}}addRegularDash(t){for(let i=t.length-1;i>=0;--i){const n=t[i],s=t[i+1];n.zeroLength?t.splice(i,1):s&&s.isDash===n.isDash&&(s.left=n.left,t.splice(i,1))}const a=t[0],d=t[t.length-1];a.isDash===d.isDash&&(a.left=d.left-this.width,d.right=a.right+this.width);const g=this.width*this.nextRow;let b=0,M=t[b];for(let i=0;i<this.width;i++){i/M.right>1&&(M=t[++b]);const n=Math.abs(i-M.left),s=Math.abs(i-M.right),l=Math.min(n,s);this.data[g+i]=Math.max(0,Math.min(255,(M.isDash?l:-l)+128))}}addDash(t,a){const d=a?7:0,g=2*d+1;if(this.nextRow+g>this.height)return h.w("LineAtlas out of space"),null;let b=0;for(let i=0;i<t.length;i++)b+=t[i];if(b!==0){const i=this.width/b,n=this.getDashRanges(t,this.width,i);a?this.addRoundDash(n,i,d):this.addRegularDash(n)}const M={y:(this.nextRow+d+.5)/this.height,height:2*d/this.height,width:b};return this.nextRow+=g,this.dirty=!0,M}bind(t){const a=t.gl;this.texture?(a.bindTexture(a.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,a.texSubImage2D(a.TEXTURE_2D,0,0,0,this.width,this.height,a.ALPHA,a.UNSIGNED_BYTE,this.data))):(this.texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texImage2D(a.TEXTURE_2D,0,a.ALPHA,this.width,this.height,0,a.ALPHA,a.UNSIGNED_BYTE,this.data))}}class Wr{constructor(t,a,d){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=d;const g=this.workerPool.acquire(d);for(let b=0;b<g.length;b++){const M=new h.C(g[b],a,d);M.name=`Worker ${b}`,this.actors.push(M)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,a,d){h.o(this.actors,(g,b)=>{g.send(t,a,b)},d=d||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach(a=>{a.remove()}),this.actors=[],t&&this.workerPool.release(this.id)}}function ji(v,t,a){const d=function(g,b){if(g)return a(g);if(b){const M=h.F(h.e(b,v),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);b.vector_layers&&(M.vectorLayers=b.vector_layers,M.vectorLayerIds=M.vectorLayers.map(i=>i.id)),a(null,M)}};return v.url?h.f(t.transformRequest(v.url,Le.Source),d):h.h.frame(()=>d(null,v))}class ri{constructor(t,a){t&&(a?this.setSouthWest(t).setNorthEast(a):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof h.L?new h.L(t.lng,t.lat):h.L.convert(t),this}setSouthWest(t){return this._sw=t instanceof h.L?new h.L(t.lng,t.lat):h.L.convert(t),this}extend(t){const a=this._sw,d=this._ne;let g,b;if(t instanceof h.L)g=t,b=t;else{if(!(t instanceof ri))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(ri.convert(t)):this.extend(h.L.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(h.L.convert(t)):this;if(g=t._sw,b=t._ne,!g||!b)return this}return a||d?(a.lng=Math.min(g.lng,a.lng),a.lat=Math.min(g.lat,a.lat),d.lng=Math.max(b.lng,d.lng),d.lat=Math.max(b.lat,d.lat)):(this._sw=new h.L(g.lng,g.lat),this._ne=new h.L(b.lng,b.lat)),this}getCenter(){return new h.L((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new h.L(this.getWest(),this.getNorth())}getSouthEast(){return new h.L(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:a,lat:d}=h.L.convert(t);let g=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(g=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=d&&d<=this._ne.lat&&g}static convert(t){return t instanceof ri?t:t&&new ri(t)}static fromLngLat(t,a=0){const d=360*a/40075017,g=d/Math.cos(Math.PI/180*t.lat);return new ri(new h.L(t.lng-g,t.lat-d),new h.L(t.lng+g,t.lat+d))}}class Oi{constructor(t,a,d){this.bounds=ri.convert(this.validateBounds(t)),this.minzoom=a||0,this.maxzoom=d||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const a=Math.pow(2,t.z),d=Math.floor(h.G(this.bounds.getWest())*a),g=Math.floor(h.H(this.bounds.getNorth())*a),b=Math.ceil(h.G(this.bounds.getEast())*a),M=Math.ceil(h.H(this.bounds.getSouth())*a);return t.x>=d&&t.x<b&&t.y>=g&&t.y<M}}class yn extends h.E{constructor(t,a,d,g){if(super(),this.load=()=>{this._loaded=!1,this.fire(new h.k("dataloading",{dataType:"source"})),this._tileJSONRequest=ji(this._options,this.map._requestManager,(b,M)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),b?this.fire(new h.j(b)):M&&(h.e(this,M),M.bounds&&(this.tileBounds=new Oi(M.bounds,this.minzoom,this.maxzoom)),this.fire(new h.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.k("data",{dataType:"source",sourceDataType:"content"})))})},this.serialize=()=>h.e({},this._options),this.id=t,this.dispatcher=d,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,h.e(this,h.F(a,["url","scheme","tileSize","promoteId"])),this._options=h.e({type:"vector"},a),this._collectResourceTiming=a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(g)}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}loadTile(t,a){const d=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),g={request:this.map._requestManager.transformRequest(d,Le.Tile),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function b(M,i){return delete t.request,t.aborted?a(null):M&&M.status!==404?a(M):(i&&i.resourceTiming&&(t.resourceTiming=i.resourceTiming),this.map._refreshExpiredTiles&&i&&t.setExpiryData(i),t.loadVectorData(i,this.map.painter),a(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}g.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired"?t.state==="loading"?t.reloadCallback=a:t.request=t.actor.send("reloadTile",g,b.bind(this)):(t.actor=this.dispatcher.getActor(),t.request=t.actor.send("loadTile",g,b.bind(this)))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0)}unloadTile(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class Xr extends h.E{constructor(t,a,d,g){super(),this.id=t,this.dispatcher=d,this.setEventedParent(g),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=h.e({type:"raster"},a),h.e(this,h.F(a,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new h.k("dataloading",{dataType:"source"})),this._tileJSONRequest=ji(this._options,this.map._requestManager,(t,a)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new h.j(t)):a&&(h.e(this,a),a.bounds&&(this.tileBounds=new Oi(a.bounds,this.minzoom,this.maxzoom)),this.fire(new h.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.k("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}serialize(){return h.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,a){const d=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.request=Te.getImage(this.map._requestManager.transformRequest(d,Le.Tile),(g,b,M)=>{if(delete t.request,t.aborted)t.state="unloaded",a(null);else if(g)t.state="errored",a(g);else if(b){this.map._refreshExpiredTiles&&M&&t.setExpiryData(M);const i=this.map.painter.context,n=i.gl;t.texture=this.map.painter.getTileTexture(b.width),t.texture?t.texture.update(b,{useMipmap:!0}):(t.texture=new Lt(i,b,n.RGBA,{useMipmap:!0}),t.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE,n.LINEAR_MIPMAP_NEAREST),i.extTextureFilterAnisotropic&&n.texParameterf(n.TEXTURE_2D,i.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,i.extTextureFilterAnisotropicMax)),t.state="loaded",a(null)}},this.map._refreshExpiredTiles)}abortTile(t,a){t.request&&(t.request.cancel(),delete t.request),a()}unloadTile(t,a){t.texture&&this.map.painter.saveTileTexture(t.texture),a()}hasTransition(){return!1}}class Ye extends Xr{constructor(t,a,d,g){super(t,a,d,g),this.type="raster-dem",this.maxzoom=22,this._options=h.e({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox",this.redFactor=a.redFactor,this.greenFactor=a.greenFactor,this.blueFactor=a.blueFactor,this.baseShift=a.baseShift}loadTile(t,a){const d=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),g=this.map._requestManager.transformRequest(d,Le.Tile);function b(M,i){M&&(t.state="errored",a(M)),i&&(t.dem=i,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded",a(null))}t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.request=Te.getImage(g,(M,i,n)=>h._(this,void 0,void 0,function*(){if(delete t.request,t.aborted)t.state="unloaded",a(null);else if(M)t.state="errored",a(M);else if(i){this.map._refreshExpiredTiles&&t.setExpiryData(n);const s=h.a(i)&&h.J()?i:yield function(c){return h._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&h.K()){const f=c.width+2,y=c.height+2;try{return new h.R({width:f,height:y},yield h.M(c,-1,-1,f,y))}catch{}}return h.h.getImageData(c,1)})}(i),l={uid:t.uid,coord:t.tileID,source:this.id,rawImageData:s,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};t.actor&&t.state!=="expired"||(t.actor=this.dispatcher.getActor(),t.actor.send("loadDEMTile",l,b))}}),this.map._refreshExpiredTiles)}_getNeighboringTiles(t){const a=t.canonical,d=Math.pow(2,a.z),g=(a.x-1+d)%d,b=a.x===0?t.wrap-1:t.wrap,M=(a.x+1+d)%d,i=a.x+1===d?t.wrap+1:t.wrap,n={};return n[new h.O(t.overscaledZ,b,a.z,g,a.y).key]={backfilled:!1},n[new h.O(t.overscaledZ,i,a.z,M,a.y).key]={backfilled:!1},a.y>0&&(n[new h.O(t.overscaledZ,b,a.z,g,a.y-1).key]={backfilled:!1},n[new h.O(t.overscaledZ,t.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},n[new h.O(t.overscaledZ,i,a.z,M,a.y-1).key]={backfilled:!1}),a.y+1<d&&(n[new h.O(t.overscaledZ,b,a.z,g,a.y+1).key]={backfilled:!1},n[new h.O(t.overscaledZ,t.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},n[new h.O(t.overscaledZ,i,a.z,M,a.y+1).key]={backfilled:!1}),n}unloadTile(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&t.actor.send("removeDEMTile",{uid:t.uid,source:this.id})}}class Dt extends h.E{constructor(t,a,d,g){super(),this.load=()=>{this._updateWorkerData()},this.serialize=()=>h.e({},this._options,{type:this.type,data:this._data}),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=d.getActor(),this.setEventedParent(g),this._data=a.data,this._options=h.e({},a),this._collectResourceTiming=a.collectResourceTiming,a.maxzoom!==void 0&&(this.maxzoom=a.maxzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId;const b=h.N/this.tileSize;this.workerOptions=h.e({source:this.id,cluster:a.cluster||!1,geojsonVtOptions:{buffer:(a.buffer!==void 0?a.buffer:128)*b,tolerance:(a.tolerance!==void 0?a.tolerance:.375)*b,extent:h.N,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:a.clusterMaxZoom!==void 0?a.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,a.clusterMinPoints||2),extent:h.N,radius:(a.clusterRadius||50)*b,log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter},a.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData(),this}updateData(t){return this._updateWorkerData(t),this}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t&&(t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=t.clusterRadius),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=t.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(t,a){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},a),this}getClusterChildren(t,a){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id},a),this}getClusterLeaves(t,a,d,g){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:a,offset:d},g),this}_updateWorkerData(t){const a=h.e({},this.workerOptions);t?a.dataDiff=t:typeof this._data=="string"?(a.request=this.map._requestManager.transformRequest(h.h.resolveURL(this._data),Le.Source),a.request.collectResourceTiming=this._collectResourceTiming):a.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new h.k("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,a,(d,g)=>{if(this._pendingLoads--,this._removed||g&&g.abandoned)return void this.fire(new h.k("dataabort",{dataType:"source"}));let b=null;if(g&&g.resourceTiming&&g.resourceTiming[this.id]&&(b=g.resourceTiming[this.id].slice(0)),d)return void this.fire(new h.j(d));const M={dataType:"source"};this._collectResourceTiming&&b&&b.length>0&&h.e(M,{resourceTiming:b}),this.fire(new h.k("data",Object.assign(Object.assign({},M),{sourceDataType:"metadata"}))),this.fire(new h.k("data",Object.assign(Object.assign({},M),{sourceDataType:"content"})))})}loaded(){return this._pendingLoads===0}loadTile(t,a){const d=t.actor?"reloadTile":"loadTile";t.actor=this.actor;const g={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};t.request=this.actor.send(d,g,(b,M)=>(delete t.request,t.unloadVectorData(),t.aborted?a(null):b?a(b):(t.loadVectorData(M,this.map.painter,d==="reloadTile"),a(null))))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0}unloadTile(t){t.unloadVectorData(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}hasTransition(){return!1}}var ni=h.Q([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Wi extends h.E{constructor(t,a,d,g){super(),this.load=(b,M)=>{this._loaded=!1,this.fire(new h.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=Te.getImage(this.map._requestManager.transformRequest(this.url,Le.Image),(i,n)=>{this._request=null,this._loaded=!0,i?this.fire(new h.j(i)):n&&(this.image=n,b&&(this.coordinates=b),M&&M(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||!this.image)return;const b=this.map.painter.context,M=b.gl;this.boundsBuffer||(this.boundsBuffer=b.createVertexBuffer(this._boundsArray,ni.members)),this.boundsSegments||(this.boundsSegments=h.S.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Lt(b,this.image,M.RGBA),this.texture.bind(M.LINEAR,M.CLAMP_TO_EDGE));let i=!1;for(const n in this.tiles){const s=this.tiles[n];s.state!=="loaded"&&(s.state="loaded",s.texture=this.texture,i=!0)}i&&this.fire(new h.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"image",url:this.options.url,coordinates:this.coordinates}),this.id=t,this.dispatcher=d,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(g),this.options=a}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.cancel(),this._request=null),this.options.url=t.url,this.load(t.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new h.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.cancel(),this._request=null)}setCoordinates(t){this.coordinates=t;const a=t.map(h.U.fromLngLat);this.tileID=function(g){let b=1/0,M=1/0,i=-1/0,n=-1/0;for(const f of g)b=Math.min(b,f.x),M=Math.min(M,f.y),i=Math.max(i,f.x),n=Math.max(n,f.y);const s=Math.max(i-b,n-M),l=Math.max(0,Math.floor(-Math.log(s)/Math.LN2)),c=Math.pow(2,l);return new h.W(l,Math.floor((b+i)/2*c),Math.floor((M+n)/2*c))}(a),this.minzoom=this.maxzoom=this.tileID.z;const d=a.map(g=>this.tileID.getTilePoint(g)._round());return this._boundsArray=new h.V,this._boundsArray.emplaceBack(d[0].x,d[0].y,0,0),this._boundsArray.emplaceBack(d[1].x,d[1].y,h.N,0),this._boundsArray.emplaceBack(d[3].x,d[3].y,0,h.N),this._boundsArray.emplaceBack(d[2].x,d[2].y,h.N,h.N),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new h.k("data",{dataType:"source",sourceDataType:"content"})),this}loadTile(t,a){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},a(null)):(t.state="errored",a(null))}hasTransition(){return!1}}class ro extends Wi{constructor(t,a,d,g){super(t,a,d,g),this.load=()=>{this._loaded=!1;const b=this.options;this.urls=[];for(const M of b.urls)this.urls.push(this.map._requestManager.transformRequest(M,Le.Source).url);h.X(this.urls,(M,i)=>{this._loaded=!0,M?this.fire(new h.j(M)):i&&(this.video=i,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const b=this.map.painter.context,M=b.gl;this.boundsBuffer||(this.boundsBuffer=b.createVertexBuffer(this._boundsArray,ni.members)),this.boundsSegments||(this.boundsSegments=h.S.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(M.LINEAR,M.CLAMP_TO_EDGE),M.texSubImage2D(M.TEXTURE_2D,0,0,0,M.RGBA,M.UNSIGNED_BYTE,this.video)):(this.texture=new Lt(b,this.video,M.RGBA),this.texture.bind(M.LINEAR,M.CLAMP_TO_EDGE));let i=!1;for(const n in this.tiles){const s=this.tiles[n];s.state!=="loaded"&&(s.state="loaded",s.texture=this.texture,i=!0)}i&&this.fire(new h.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"video",urls:this.urls,coordinates:this.coordinates}),this.roundZoom=!0,this.type="video",this.options=a}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const a=this.video.seekable;t<a.start(0)||t>a.end(0)?this.fire(new h.j(new h.Y(`sources.${this.id}`,null,`Playback for this video can be set only between the ${a.start(0)} and ${a.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}hasTransition(){return this.video&&!this.video.paused}}class Rn extends Wi{constructor(t,a,d,g){super(t,a,d,g),this.load=()=>{this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new h.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},this.prepare=()=>{let b=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,b=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,b=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const M=this.map.painter.context,i=M.gl;this.boundsBuffer||(this.boundsBuffer=M.createVertexBuffer(this._boundsArray,ni.members)),this.boundsSegments||(this.boundsSegments=h.S.simpleSegment(0,0,4,2)),this.texture?(b||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Lt(M,this.canvas,i.RGBA,{premultiply:!0});let n=!1;for(const s in this.tiles){const l=this.tiles[s];l.state!=="loaded"&&(l.state="loaded",l.texture=this.texture,n=!0)}n&&this.fire(new h.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"canvas",coordinates:this.coordinates}),a.coordinates?Array.isArray(a.coordinates)&&a.coordinates.length===4&&!a.coordinates.some(b=>!Array.isArray(b)||b.length!==2||b.some(M=>typeof M!="number"))||this.fire(new h.j(new h.Y(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new h.j(new h.Y(`sources.${t}`,null,'missing required property "coordinates"'))),a.animate&&typeof a.animate!="boolean"&&this.fire(new h.j(new h.Y(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),a.canvas?typeof a.canvas=="string"||a.canvas instanceof HTMLCanvasElement||this.fire(new h.j(new h.Y(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new h.j(new h.Y(`sources.${t}`,null,'missing required property "canvas"'))),this.options=a,this.animate=a.animate===void 0||a.animate}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const no={},vn=v=>{switch(v){case"geojson":return Dt;case"image":return Wi;case"raster":return Xr;case"raster-dem":return Ye;case"vector":return yn;case"video":return ro;case"canvas":return Rn}return no[v]};function Ss(v,t){const a=h.Z();return h.$(a,a,[1,1,0]),h.a0(a,a,[.5*v.width,.5*v.height,1]),h.a1(a,a,v.calculatePosMatrix(t.toUnwrapped()))}function es(v,t,a,d,g,b){const M=function(c,f,y){if(c)for(const x of c){const S=f[x];if(S&&S.source===y&&S.type==="fill-extrusion")return!0}else for(const x in f){const S=f[x];if(S.source===y&&S.type==="fill-extrusion")return!0}return!1}(g&&g.layers,t,v.id),i=b.maxPitchScaleFactor(),n=v.tilesIn(d,i,M);n.sort(pr);const s=[];for(const c of n)s.push({wrappedTileID:c.tileID.wrapped().key,queryResults:c.tile.queryRenderedFeatures(t,a,v._state,c.queryGeometry,c.cameraQueryGeometry,c.scale,g,b,i,Ss(v.transform,c.tileID))});const l=function(c){const f={},y={};for(const x of c){const S=x.queryResults,C=x.wrappedTileID,z=y[C]=y[C]||{};for(const G in S){const N=S[G],Z=z[G]=z[G]||{},Q=f[G]=f[G]||[];for(const ee of N)Z[ee.featureIndex]||(Z[ee.featureIndex]=!0,Q.push(ee))}}return f}(s);for(const c in l)l[c].forEach(f=>{const y=f.feature,x=v.getFeatureState(y.layer["source-layer"],y.id);y.source=y.layer.source,y.layer["source-layer"]&&(y.sourceLayer=y.layer["source-layer"]),y.state=x});return l}function pr(v,t){const a=v.tileID,d=t.tileID;return a.overscaledZ-d.overscaledZ||a.canonical.y-d.canonical.y||a.wrap-d.wrap||a.canonical.x-d.canonical.x}class Lr{constructor(t,a){this.timeAdded=0,this.fadeEndTime=0,this.tileID=t,this.uid=h.a2(),this.uses=0,this.tileSize=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const a=t+this.timeAdded;a<this.fadeEndTime||(this.fadeEndTime=a)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,a,d){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(g,b){const M={};if(!b)return M;for(const i of g){const n=i.layerIds.map(s=>b.getLayer(s)).filter(Boolean);if(n.length!==0){i.layers=n,i.stateDependentLayerIds&&(i.stateDependentLayers=i.stateDependentLayerIds.map(s=>n.filter(l=>l.id===s)[0]));for(const s of n)M[s.id]=i}}return M}(t.buckets,a.style),this.hasSymbolBuckets=!1;for(const g in this.buckets){const b=this.buckets[g];if(b instanceof h.a4){if(this.hasSymbolBuckets=!0,!d)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const g in this.buckets){const b=this.buckets[g];if(b instanceof h.a4&&b.hasRTLText){this.hasRTLText=!0,h.a5();break}}this.queryPadding=0;for(const g in this.buckets){const b=this.buckets[g];this.queryPadding=Math.max(this.queryPadding,a.style.getLayer(g).queryRadius(b))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new h.a3}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const d in this.buckets){const g=this.buckets[d];g.uploadPending()&&g.upload(t)}const a=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Lt(t,this.imageAtlas.image,a.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Lt(t,this.glyphAtlasImage,a.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,a,d,g,b,M,i,n,s,l){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:g,cameraQueryGeometry:b,scale:M,tileSize:this.tileSize,pixelPosMatrix:l,transform:n,params:i,queryPadding:this.queryPadding*s},t,a,d):{}}querySourceFeatures(t,a){const d=this.latestFeatureIndex;if(!d||!d.rawTileData)return;const g=d.loadVTLayers(),b=a&&a.sourceLayer?a.sourceLayer:"",M=g._geojsonTileLayer||g[b];if(!M)return;const i=h.a6(a&&a.filter),{z:n,x:s,y:l}=this.tileID.canonical,c={z:n,x:s,y:l};for(let f=0;f<M.length;f++){const y=M.feature(f);if(i.needGeometry){const C=h.a7(y,!0);if(!i.filter(new h.a8(this.tileID.overscaledZ),C,this.tileID.canonical))continue}else if(!i.filter(new h.a8(this.tileID.overscaledZ),y))continue;const x=d.getId(y,b),S=new h.a9(y,n,s,l,x);S.tile=c,t.push(S)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const a=this.expirationTime;if(t.cacheControl){const d=h.aa(t.cacheControl);d["max-age"]&&(this.expirationTime=Date.now()+1e3*d["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const d=Date.now();let g=!1;if(this.expirationTime>d)g=!1;else if(a)if(this.expirationTime<a)g=!0;else{const b=this.expirationTime-a;b?this.expirationTime=d+Math.max(b,3e4):g=!0}else g=!0;g?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,a){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const d=this.latestFeatureIndex.loadVTLayers();for(const g in this.buckets){if(!a.style.hasLayer(g))continue;const b=this.buckets[g],M=b.layers[0].sourceLayer||"_geojsonTileLayer",i=d[M],n=t[M];if(!i||!n||Object.keys(n).length===0)continue;b.update(n,i,this.imageAtlas&&this.imageAtlas.patternPositions||{});const s=a&&a.style&&a.style.getLayer(g);s&&(this.queryPadding=Math.max(this.queryPadding,s.queryRadius(b)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<h.h.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=h.h.now()+t}setDependencies(t,a){const d={};for(const g of a)d[g]=!0;this.dependencies[t]=d}hasDependency(t,a){for(const d of t){const g=this.dependencies[d];if(g){for(const b of a)if(g[b])return!0}}return!1}}class ts{constructor(t,a){this.max=t,this.onRemove=a,this.reset()}reset(){for(const t in this.data)for(const a of this.data[t])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(t,a,d){const g=t.wrapped().key;this.data[g]===void 0&&(this.data[g]=[]);const b={value:a,timeout:void 0};if(d!==void 0&&(b.timeout=setTimeout(()=>{this.remove(t,b)},d)),this.data[g].push(b),this.order.push(g),this.order.length>this.max){const M=this._getAndRemoveByKey(this.order[0]);M&&this.onRemove(M)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const a=this.data[t].shift();return a.timeout&&clearTimeout(a.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),a.value}getByKey(t){const a=this.data[t];return a?a[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,a){if(!this.has(t))return this;const d=t.wrapped().key,g=a===void 0?0:this.data[d].indexOf(a),b=this.data[d][g];return this.data[d].splice(g,1),b.timeout&&clearTimeout(b.timeout),this.data[d].length===0&&delete this.data[d],this.onRemove(b.value),this.order.splice(this.order.indexOf(d),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(t){const a=[];for(const d in this.data)for(const g of this.data[d])t(g.value)||a.push(g);for(const d of a)this.remove(d.value.tileID,d)}}class ze{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,a,d){const g=String(a);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][g]=this.stateChanges[t][g]||{},h.e(this.stateChanges[t][g],d),this.deletedStates[t]===null){this.deletedStates[t]={};for(const b in this.state[t])b!==g&&(this.deletedStates[t][b]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][g]===null){this.deletedStates[t][g]={};for(const b in this.state[t][g])d[b]||(this.deletedStates[t][g][b]=null)}else for(const b in d)this.deletedStates[t]&&this.deletedStates[t][g]&&this.deletedStates[t][g][b]===null&&delete this.deletedStates[t][g][b]}removeFeatureState(t,a,d){if(this.deletedStates[t]===null)return;const g=String(a);if(this.deletedStates[t]=this.deletedStates[t]||{},d&&a!==void 0)this.deletedStates[t][g]!==null&&(this.deletedStates[t][g]=this.deletedStates[t][g]||{},this.deletedStates[t][g][d]=null);else if(a!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][g])for(d in this.deletedStates[t][g]={},this.stateChanges[t][g])this.deletedStates[t][g][d]=null;else this.deletedStates[t][g]=null;else this.deletedStates[t]=null}getState(t,a){const d=String(a),g=h.e({},(this.state[t]||{})[d],(this.stateChanges[t]||{})[d]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const b=this.deletedStates[t][a];if(b===null)return{};for(const M in b)delete g[M]}return g}initializeTileState(t,a){t.setFeatureState(this.state,a)}coalesceChanges(t,a){const d={};for(const g in this.stateChanges){this.state[g]=this.state[g]||{};const b={};for(const M in this.stateChanges[g])this.state[g][M]||(this.state[g][M]={}),h.e(this.state[g][M],this.stateChanges[g][M]),b[M]=this.state[g][M];d[g]=b}for(const g in this.deletedStates){this.state[g]=this.state[g]||{};const b={};if(this.deletedStates[g]===null)for(const M in this.state[g])b[M]={},this.state[g][M]={};else for(const M in this.deletedStates[g]){if(this.deletedStates[g][M]===null)this.state[g][M]={};else for(const i of Object.keys(this.deletedStates[g][M]))delete this.state[g][M][i];b[M]=this.state[g][M]}d[g]=d[g]||{},h.e(d[g],b)}if(this.stateChanges={},this.deletedStates={},Object.keys(d).length!==0)for(const g in t)t[g].setFeatureState(d,a)}}class Mi extends h.E{constructor(t,a,d){super(),this.id=t,this.dispatcher=d,this.on("data",g=>{g.dataType==="source"&&g.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&g.dataType==="source"&&g.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((g,b,M,i)=>{const n=new(vn(b.type))(g,b,M,i);if(n.id!==g)throw new Error(`Expected Source id to be ${g} instead of ${n.id}`);return n})(t,a,d,this),this._tiles={},this._cache=new ts(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new ze,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t in this._tiles){const a=this._tiles[t];if(a.state!=="loaded"&&a.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,a){return this._source.loadTile(t,a)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){this._source.abortTile&&this._source.abortTile(t,()=>{}),this._source.fire(new h.k("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const a in this._tiles){const d=this._tiles[a];d.upload(t),d.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(mr).map(t=>t.key)}getRenderableIds(t){const a=[];for(const d in this._tiles)this._isIdRenderable(d,t)&&a.push(this._tiles[d]);return t?a.sort((d,g)=>{const b=d.tileID,M=g.tileID,i=new h.P(b.canonical.x,b.canonical.y)._rotate(this.transform.angle),n=new h.P(M.canonical.x,M.canonical.y)._rotate(this.transform.angle);return b.overscaledZ-M.overscaledZ||n.y-i.y||n.x-i.x}).map(d=>d.tileID.key):a.map(d=>d.tileID).sort(mr).map(d=>d.key)}hasRenderableParent(t){const a=this.findLoadedParent(t,0);return!!a&&this._isIdRenderable(a.tileID.key)}_isIdRenderable(t,a){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(a||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(t,"reloading")}}_reloadTile(t,a){const d=this._tiles[t];d&&(d.state!=="loading"&&(d.state=a),this._loadTile(d,this._tileLoaded.bind(this,d,t,a)))}_tileLoaded(t,a,d,g){if(g)return t.state="errored",void(g.status!==404?this._source.fire(new h.j(g,{tile:t})):this.update(this.transform,this.terrain));t.timeAdded=h.h.now(),d==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(a,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new h.k("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const a=this.getRenderableIds();for(let g=0;g<a.length;g++){const b=a[g];if(t.neighboringTiles&&t.neighboringTiles[b]){const M=this.getTileByID(b);d(t,M),d(M,t)}}function d(g,b){g.needsHillshadePrepare=!0,g.needsTerrainPrepare=!0;let M=b.tileID.canonical.x-g.tileID.canonical.x;const i=b.tileID.canonical.y-g.tileID.canonical.y,n=Math.pow(2,g.tileID.canonical.z),s=b.tileID.key;M===0&&i===0||Math.abs(i)>1||(Math.abs(M)>1&&(Math.abs(M+n)===1?M+=n:Math.abs(M-n)===1&&(M-=n)),b.dem&&g.dem&&(g.dem.backfillBorder(b.dem,M,i),g.neighboringTiles&&g.neighboringTiles[s]&&(g.neighboringTiles[s].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,a,d,g){for(const b in this._tiles){let M=this._tiles[b];if(g[b]||!M.hasData()||M.tileID.overscaledZ<=a||M.tileID.overscaledZ>d)continue;let i=M.tileID;for(;M&&M.tileID.overscaledZ>a+1;){const s=M.tileID.scaledTo(M.tileID.overscaledZ-1);M=this._tiles[s.key],M&&M.hasData()&&(i=s)}let n=i;for(;n.overscaledZ>a;)if(n=n.scaledTo(n.overscaledZ-1),t[n.key]){g[i.key]=i;break}}}findLoadedParent(t,a){if(t.key in this._loadedParentTiles){const d=this._loadedParentTiles[t.key];return d&&d.tileID.overscaledZ>=a?d:null}for(let d=t.overscaledZ-1;d>=a;d--){const g=t.scaledTo(d),b=this._getLoadedTile(g);if(b)return b}}_getLoadedTile(t){const a=this._tiles[t.key];return a&&a.hasData()?a:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const a=Math.ceil(t.width/this._source.tileSize)+1,d=Math.ceil(t.height/this._source.tileSize)+1,g=Math.floor(a*d*(this._maxTileCacheZoomLevels===null?h.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),b=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,g):g;this._cache.setMaxSize(b)}handleWrapJump(t){const a=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,a){const d={};for(const g in this._tiles){const b=this._tiles[g];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+a),d[b.tileID.key]=b}this._tiles=d;for(const g in this._timers)clearTimeout(this._timers[g]),delete this._timers[g];for(const g in this._tiles)this._setTileReloadTimer(g,this._tiles[g])}}update(t,a){if(this.transform=t,this.terrain=a,!this._sourceLoaded||this._paused)return;let d;this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?d=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(l=>new h.O(l.canonical.z,l.wrap,l.canonical.z,l.canonical.x,l.canonical.y)):(d=t.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:a}),this._source.hasTile&&(d=d.filter(l=>this._source.hasTile(l)))):d=[];const g=t.coveringZoomLevel(this._source),b=Math.max(g-Mi.maxOverzooming,this._source.minzoom),M=Math.max(g+Mi.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const l={};for(const c of d)if(c.canonical.z>this._source.minzoom){const f=c.scaledTo(c.canonical.z-1);l[f.key]=f;const y=c.scaledTo(Math.max(this._source.minzoom,Math.min(c.canonical.z,5)));l[y.key]=y}d=d.concat(Object.values(l))}const i=d.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,i&&this.fire(new h.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const n=this._updateRetainedTiles(d,g);if(oi(this._source.type)){const l={},c={},f=Object.keys(n),y=h.h.now();for(const x of f){const S=n[x],C=this._tiles[x];if(!C||C.fadeEndTime!==0&&C.fadeEndTime<=y)continue;const z=this.findLoadedParent(S,b);z&&(this._addTile(z.tileID),l[z.tileID.key]=z.tileID),c[x]=S}this._retainLoadedChildren(c,g,M,n);for(const x in l)n[x]||(this._coveredTiles[x]=!0,n[x]=l[x]);if(a){const x={},S={};for(const C of d)this._tiles[C.key].hasData()?x[C.key]=C:S[C.key]=C;for(const C in S){const z=S[C].children(this._source.maxzoom);this._tiles[z[0].key]&&this._tiles[z[1].key]&&this._tiles[z[2].key]&&this._tiles[z[3].key]&&(x[z[0].key]=n[z[0].key]=z[0],x[z[1].key]=n[z[1].key]=z[1],x[z[2].key]=n[z[2].key]=z[2],x[z[3].key]=n[z[3].key]=z[3],delete S[C])}for(const C in S){const z=this.findLoadedParent(S[C],this._source.minzoom);if(z){x[z.tileID.key]=n[z.tileID.key]=z.tileID;for(const G in x)x[G].isChildOf(z.tileID)&&delete x[G]}}for(const C in this._tiles)x[C]||(this._coveredTiles[C]=!0)}}for(const l in n)this._tiles[l].clearFadeHold();const s=h.ab(this._tiles,n);for(const l of s){const c=this._tiles[l];c.hasSymbolBuckets&&!c.holdingForFade()?c.setHoldDuration(this.map._fadeDuration):c.hasSymbolBuckets&&!c.symbolFadeFinished()||this._removeTile(l)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,a){const d={},g={},b=Math.max(a-Mi.maxOverzooming,this._source.minzoom),M=Math.max(a+Mi.maxUnderzooming,this._source.minzoom),i={};for(const n of t){const s=this._addTile(n);d[n.key]=n,s.hasData()||a<this._source.maxzoom&&(i[n.key]=n)}this._retainLoadedChildren(i,a,M,d);for(const n of t){let s=this._tiles[n.key];if(s.hasData())continue;if(a+1>this._source.maxzoom){const c=n.children(this._source.maxzoom)[0],f=this.getTile(c);if(f&&f.hasData()){d[c.key]=c;continue}}else{const c=n.children(this._source.maxzoom);if(d[c[0].key]&&d[c[1].key]&&d[c[2].key]&&d[c[3].key])continue}let l=s.wasRequested();for(let c=n.overscaledZ-1;c>=b;--c){const f=n.scaledTo(c);if(g[f.key])break;if(g[f.key]=!0,s=this.getTile(f),!s&&l&&(s=this._addTile(f)),s){const y=s.hasData();if((l||y)&&(d[f.key]=f),l=s.wasRequested(),y)break}}}return d}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const a=[];let d,g=this._tiles[t].tileID;for(;g.overscaledZ>0;){if(g.key in this._loadedParentTiles){d=this._loadedParentTiles[g.key];break}a.push(g.key);const b=g.scaledTo(g.overscaledZ-1);if(d=this._getLoadedTile(b),d)break;g=b}for(const b of a)this._loadedParentTiles[b]=d}}_addTile(t){let a=this._tiles[t.key];if(a)return a;a=this._cache.getAndRemove(t),a&&(this._setTileReloadTimer(t.key,a),a.tileID=t,this._state.initializeTileState(a,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,a)));const d=a;return a||(a=new Lr(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(a,this._tileLoaded.bind(this,a,t.key,a.state))),a.uses++,this._tiles[t.key]=a,d||this._source.fire(new h.k("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a}_setTileReloadTimer(t,a){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const d=a.getExpiryTimeout();d&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},d))}_removeTile(t){const a=this._tiles[t];a&&(a.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),a.uses>0||(a.hasData()&&a.state!=="reloading"?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,a,d){const g=[],b=this.transform;if(!b)return g;const M=d?b.getCameraQueryGeometry(t):t,i=t.map(x=>b.pointCoordinate(x,this.terrain)),n=M.map(x=>b.pointCoordinate(x,this.terrain)),s=this.getIds();let l=1/0,c=1/0,f=-1/0,y=-1/0;for(const x of n)l=Math.min(l,x.x),c=Math.min(c,x.y),f=Math.max(f,x.x),y=Math.max(y,x.y);for(let x=0;x<s.length;x++){const S=this._tiles[s[x]];if(S.holdingForFade())continue;const C=S.tileID,z=Math.pow(2,b.zoom-S.tileID.overscaledZ),G=a*S.queryPadding*h.N/S.tileSize/z,N=[C.getTilePoint(new h.U(l,c)),C.getTilePoint(new h.U(f,y))];if(N[0].x-G<h.N&&N[0].y-G<h.N&&N[1].x+G>=0&&N[1].y+G>=0){const Z=i.map(ee=>C.getTilePoint(ee)),Q=n.map(ee=>C.getTilePoint(ee));g.push({tile:S,tileID:C,queryGeometry:Z,cameraQueryGeometry:Q,scale:z})}}return g}getVisibleCoordinates(t){const a=this.getRenderableIds(t).map(d=>this._tiles[d].tileID);for(const d of a)d.posMatrix=this.transform.calculatePosMatrix(d.toUnwrapped());return a}hasTransition(){if(this._source.hasTransition())return!0;if(oi(this._source.type)){const t=h.h.now();for(const a in this._tiles)if(this._tiles[a].fadeEndTime>=t)return!0}return!1}setFeatureState(t,a,d){this._state.updateState(t=t||"_geojsonTileLayer",a,d)}removeFeatureState(t,a,d){this._state.removeFeatureState(t=t||"_geojsonTileLayer",a,d)}getFeatureState(t,a){return this._state.getState(t=t||"_geojsonTileLayer",a)}setDependencies(t,a,d){const g=this._tiles[t];g&&g.setDependencies(a,d)}reloadTilesForDependencies(t,a){for(const d in this._tiles)this._tiles[d].hasDependency(t,a)&&this._reloadTile(d,"reloading");this._cache.filter(d=>!d.hasDependency(t,a))}}function mr(v,t){const a=Math.abs(2*v.wrap)-+(v.wrap<0),d=Math.abs(2*t.wrap)-+(t.wrap<0);return v.overscaledZ-t.overscaledZ||d-a||t.canonical.y-v.canonical.y||t.canonical.x-v.canonical.x}function oi(v){return v==="raster"||v==="image"||v==="video"}Mi.maxOverzooming=10,Mi.maxUnderzooming=3;const qt="mapboxgl_preloaded_worker_pool";class Rr{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Rr.workerCount;)this.workers.push(new Worker(h.c.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(a=>{a.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[qt]}numActive(){return Object.keys(this.active).length}}const Ts=Math.floor(h.h.hardwareConcurrency/2);let xn;function so(){return xn||(xn=new Rr),xn}Rr.workerCount=h.ac(globalThis)?Math.max(Math.min(Ts,3),1):1;class is{constructor(t,a){this.reset(t,a)}reset(t,a){this.points=t||[],this._distances=[0];for(let d=1;d<this.points.length;d++)this._distances[d]=this._distances[d-1]+this.points[d].dist(this.points[d-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=h.ad(t,0,1);let a=1,d=this._distances[a];const g=t*this.paddedLength+this.padding;for(;d<g&&a<this._distances.length;)d=this._distances[++a];const b=a-1,M=this._distances[b],i=d-M,n=i>0?(g-M)/i:0;return this.points[b].mult(1-n).add(this.points[a].mult(n))}}function Fn(v,t){let a=!0;return v==="always"||v!=="never"&&t!=="never"||(a=!1),a}class rs{constructor(t,a,d){const g=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(t/d),this.yCellCount=Math.ceil(a/d);for(let M=0;M<this.xCellCount*this.yCellCount;M++)g.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=a,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,a,d,g,b){this._forEachCell(a,d,g,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(a),this.bboxes.push(d),this.bboxes.push(g),this.bboxes.push(b)}insertCircle(t,a,d,g){this._forEachCell(a-g,d-g,a+g,d+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(a),this.circles.push(d),this.circles.push(g)}_insertBoxCell(t,a,d,g,b,M){this.boxCells[b].push(M)}_insertCircleCell(t,a,d,g,b,M){this.circleCells[b].push(M)}_query(t,a,d,g,b,M,i){if(d<0||t>this.width||g<0||a>this.height)return[];const n=[];if(t<=0&&a<=0&&this.width<=d&&this.height<=g){if(b)return[{key:null,x1:t,y1:a,x2:d,y2:g}];for(let s=0;s<this.boxKeys.length;s++)n.push({key:this.boxKeys[s],x1:this.bboxes[4*s],y1:this.bboxes[4*s+1],x2:this.bboxes[4*s+2],y2:this.bboxes[4*s+3]});for(let s=0;s<this.circleKeys.length;s++){const l=this.circles[3*s],c=this.circles[3*s+1],f=this.circles[3*s+2];n.push({key:this.circleKeys[s],x1:l-f,y1:c-f,x2:l+f,y2:c+f})}}else this._forEachCell(t,a,d,g,this._queryCell,n,{hitTest:b,overlapMode:M,seenUids:{box:{},circle:{}}},i);return n}query(t,a,d,g){return this._query(t,a,d,g,!1,null)}hitTest(t,a,d,g,b,M){return this._query(t,a,d,g,!0,b,M).length>0}hitTestCircle(t,a,d,g,b){const M=t-d,i=t+d,n=a-d,s=a+d;if(i<0||M>this.width||s<0||n>this.height)return!1;const l=[];return this._forEachCell(M,n,i,s,this._queryCellCircle,l,{hitTest:!0,overlapMode:g,circle:{x:t,y:a,radius:d},seenUids:{box:{},circle:{}}},b),l.length>0}_queryCell(t,a,d,g,b,M,i,n){const{seenUids:s,hitTest:l,overlapMode:c}=i,f=this.boxCells[b];if(f!==null){const x=this.bboxes;for(const S of f)if(!s.box[S]){s.box[S]=!0;const C=4*S,z=this.boxKeys[S];if(t<=x[C+2]&&a<=x[C+3]&&d>=x[C+0]&&g>=x[C+1]&&(!n||n(z))&&(!l||!Fn(c,z.overlapMode))&&(M.push({key:z,x1:x[C],y1:x[C+1],x2:x[C+2],y2:x[C+3]}),l))return!0}}const y=this.circleCells[b];if(y!==null){const x=this.circles;for(const S of y)if(!s.circle[S]){s.circle[S]=!0;const C=3*S,z=this.circleKeys[S];if(this._circleAndRectCollide(x[C],x[C+1],x[C+2],t,a,d,g)&&(!n||n(z))&&(!l||!Fn(c,z.overlapMode))){const G=x[C],N=x[C+1],Z=x[C+2];if(M.push({key:z,x1:G-Z,y1:N-Z,x2:G+Z,y2:N+Z}),l)return!0}}}return!1}_queryCellCircle(t,a,d,g,b,M,i,n){const{circle:s,seenUids:l,overlapMode:c}=i,f=this.boxCells[b];if(f!==null){const x=this.bboxes;for(const S of f)if(!l.box[S]){l.box[S]=!0;const C=4*S,z=this.boxKeys[S];if(this._circleAndRectCollide(s.x,s.y,s.radius,x[C+0],x[C+1],x[C+2],x[C+3])&&(!n||n(z))&&!Fn(c,z.overlapMode))return M.push(!0),!0}}const y=this.circleCells[b];if(y!==null){const x=this.circles;for(const S of y)if(!l.circle[S]){l.circle[S]=!0;const C=3*S,z=this.circleKeys[S];if(this._circlesCollide(x[C],x[C+1],x[C+2],s.x,s.y,s.radius)&&(!n||n(z))&&!Fn(c,z.overlapMode))return M.push(!0),!0}}}_forEachCell(t,a,d,g,b,M,i,n){const s=this._convertToXCellCoord(t),l=this._convertToYCellCoord(a),c=this._convertToXCellCoord(d),f=this._convertToYCellCoord(g);for(let y=s;y<=c;y++)for(let x=l;x<=f;x++)if(b.call(this,t,a,d,g,this.xCellCount*x+y,M,i,n))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,a,d,g,b,M){const i=g-t,n=b-a,s=d+M;return s*s>i*i+n*n}_circleAndRectCollide(t,a,d,g,b,M,i){const n=(M-g)/2,s=Math.abs(t-(g+n));if(s>n+d)return!1;const l=(i-b)/2,c=Math.abs(a-(b+l));if(c>l+d)return!1;if(s<=n||c<=l)return!0;const f=s-n,y=c-l;return f*f+y*y<=d*d}}function qe(v,t,a,d,g){const b=h.Z();return t?(h.a0(b,b,[1/g,1/g,1]),a||h.ae(b,b,d.angle)):h.a1(b,d.labelPlaneMatrix,v),b}function An(v,t,a,d,g){if(t){const b=h.af(v);return h.a0(b,b,[g,g,1]),a||h.ae(b,b,-d.angle),b}return d.glCoordMatrix}function Ei(v,t,a){let d;a?(d=[v.x,v.y,a(v.x,v.y),1],h.ag(d,d,t)):(d=[v.x,v.y,0,1],le(d,d,t));const g=d[3];return{point:new h.P(d[0]/g,d[1]/g),signedDistanceFromCamera:g}}function ns(v,t){return .5+v/t*.5}function un(v,t){const a=v[0]/v[3],d=v[1]/v[3];return a>=-t[0]&&a<=t[0]&&d>=-t[1]&&d<=t[1]}function $e(v,t,a,d,g,b,M,i,n,s){const l=d?v.textSizeData:v.iconSizeData,c=h.ah(l,a.transform.zoom),f=[256/a.width*2+1,256/a.height*2+1],y=d?v.text.dynamicLayoutVertexArray:v.icon.dynamicLayoutVertexArray;y.clear();const x=v.lineVertexArray,S=d?v.text.placedSymbolArray:v.icon.placedSymbolArray,C=a.transform.width/a.transform.height;let z=!1;for(let G=0;G<S.length;G++){const N=S.get(G);if(N.hidden||N.writingMode===h.ai.vertical&&!z){te(N.numGlyphs,y);continue}let Z;if(z=!1,s?(Z=[N.anchorX,N.anchorY,s(N.anchorX,N.anchorY),1],h.ag(Z,Z,t)):(Z=[N.anchorX,N.anchorY,0,1],le(Z,Z,t)),!un(Z,f)){te(N.numGlyphs,y);continue}const Q=ns(a.transform.cameraToCenterDistance,Z[3]),ee=h.aj(l,c,N),he=M?ee/Q:ee*Q,ge=new h.P(N.anchorX,N.anchorY),oe=Ei(ge,g,s).point,fe={projections:{},offsets:{}},pe=Xi(N,he,!1,i,t,g,b,v.glyphOffsetArray,x,y,oe,ge,fe,C,n,s);z=pe.useVertical,(pe.notEnoughRoom||z||pe.needsFlipping&&Xi(N,he,!0,i,t,g,b,v.glyphOffsetArray,x,y,oe,ge,fe,C,n,s).notEnoughRoom)&&te(N.numGlyphs,y)}d?v.text.dynamicLayoutVertexBuffer.updateData(y):v.icon.dynamicLayoutVertexBuffer.updateData(y)}function Vt(v,t,a,d,g,b,M,i,n,s,l,c,f){const y=i.glyphStartIndex+i.numGlyphs,x=i.lineStartIndex,S=i.lineStartIndex+i.lineLength,C=t.getoffsetX(i.glyphStartIndex),z=t.getoffsetX(y-1),G=j(v*C,a,d,g,b,M,i.segment,x,S,n,s,l,c,f);if(!G)return null;const N=j(v*z,a,d,g,b,M,i.segment,x,S,n,s,l,c,f);return N?{first:G,last:N}:null}function Mt(v,t,a,d){return v===h.ai.horizontal&&Math.abs(a.y-t.y)>Math.abs(a.x-t.x)*d?{useVertical:!0}:(v===h.ai.vertical?t.y<a.y:t.x>a.x)?{needsFlipping:!0}:null}function Xi(v,t,a,d,g,b,M,i,n,s,l,c,f,y,x,S){const C=t/24,z=v.lineOffsetX*C,G=v.lineOffsetY*C;let N;if(v.numGlyphs>1){const Z=v.glyphStartIndex+v.numGlyphs,Q=v.lineStartIndex,ee=v.lineStartIndex+v.lineLength,he=Vt(C,i,z,G,a,l,c,v,n,b,f,x,S);if(!he)return{notEnoughRoom:!0};const ge=Ei(he.first.point,M,S).point,oe=Ei(he.last.point,M,S).point;if(d&&!a){const fe=Mt(v.writingMode,ge,oe,y);if(fe)return fe}N=[he.first];for(let fe=v.glyphStartIndex+1;fe<Z-1;fe++)N.push(j(C*i.getoffsetX(fe),z,G,a,l,c,v.segment,Q,ee,n,b,f,x,S));N.push(he.last)}else{if(d&&!a){const Q=Ei(c,g,S).point,ee=v.lineStartIndex+v.segment+1,he=new h.P(n.getx(ee),n.gety(ee)),ge=Ei(he,g,S),oe=ge.signedDistanceFromCamera>0?ge.point:cn(c,he,Q,1,g,S),fe=Mt(v.writingMode,Q,oe,y);if(fe)return fe}const Z=j(C*i.getoffsetX(v.glyphStartIndex),z,G,a,l,c,v.segment,v.lineStartIndex,v.lineStartIndex+v.lineLength,n,b,f,x,S);if(!Z)return{notEnoughRoom:!0};N=[Z]}for(const Z of N)h.ak(s,Z.point,Z.angle);return{}}function cn(v,t,a,d,g,b){const M=Ei(v.add(v.sub(t)._unit()),g,b).point,i=a.sub(M);return a.add(i._mult(d/i.mag()))}function Bt(v,t){const{projectionCache:a,lineVertexArray:d,labelPlaneMatrix:g,tileAnchorPoint:b,distanceFromAnchor:M,getElevation:i,previousVertex:n,direction:s,absOffsetX:l}=t;if(a.projections[v])return a.projections[v];const c=new h.P(d.getx(v),d.gety(v)),f=Ei(c,g,i);if(f.signedDistanceFromCamera>0)return a.projections[v]=f.point,f.point;const y=v-s;return cn(M===0?b:new h.P(d.getx(y),d.gety(y)),c,n,l-M+1,g,i)}function Ve(v,t,a){return v._unit()._perp()._mult(t*a)}function ae(v,t,a,d,g,b,M,i){const{projectionCache:n,direction:s}=i;if(n.offsets[v])return n.offsets[v];const l=a.add(t);if(v+s<d||v+s>=g)return n.offsets[v]=l,l;const c=Bt(v+s,i),f=Ve(c.sub(a),M,s),y=a.add(f),x=c.add(f);return n.offsets[v]=h.al(b,l,y,x)||l,n.offsets[v]}function j(v,t,a,d,g,b,M,i,n,s,l,c,f,y){const x=d?v-t:v+t;let S=x>0?1:-1,C=0;d&&(S*=-1,C=Math.PI),S<0&&(C+=Math.PI);let z,G,N=S>0?i+M:i+M+1,Z=g,Q=g,ee=0,he=0;const ge=Math.abs(x),oe=[];let fe;for(;ee+he<=ge;){if(N+=S,N<i||N>=n)return null;ee+=he,Q=Z,G=z;const Me={projectionCache:c,lineVertexArray:s,labelPlaneMatrix:l,tileAnchorPoint:b,distanceFromAnchor:ee,getElevation:y,previousVertex:Q,direction:S,absOffsetX:ge};if(Z=Bt(N,Me),a===0)oe.push(Q),fe=Z.sub(Q);else{let Pe;const Ce=Z.sub(Q);Pe=Ce.mag()===0?Ve(Bt(N+S,Me).sub(Z),a,S):Ve(Ce,a,S),G||(G=Q.add(Pe)),z=ae(N,Pe,Z,i,n,G,a,Me),oe.push(G),fe=z.sub(G)}he=fe.mag()}const pe=fe._mult((ge-ee)/he)._add(G||Q),Fe=C+Math.atan2(Z.y-Q.y,Z.x-Q.x);return oe.push(pe),{point:pe,angle:f?Fe:0,path:oe}}const $=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function te(v,t){for(let a=0;a<v;a++){const d=t.length;t.resize(d+4),t.float32.set($,3*d)}}function le(v,t,a){const d=t[0],g=t[1];return v[0]=a[0]*d+a[4]*g+a[12],v[1]=a[1]*d+a[5]*g+a[13],v[3]=a[3]*d+a[7]*g+a[15],v}const ce=100;class Ee{constructor(t,a=new rs(t.width+200,t.height+200,25),d=new rs(t.width+200,t.height+200,25)){this.transform=t,this.grid=a,this.ignoredGrid=d,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+ce,this.screenBottomBoundary=t.height+ce,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,a,d,g,b,M){const i=this.projectAndGetPerspectiveRatio(g,t.anchorPointX,t.anchorPointY,M),n=d*i.perspectiveRatio,s=t.x1*n+i.point.x,l=t.y1*n+i.point.y,c=t.x2*n+i.point.x,f=t.y2*n+i.point.y;return!this.isInsideGrid(s,l,c,f)||a!=="always"&&this.grid.hitTest(s,l,c,f,a,b)||i.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[s,l,c,f],offscreen:this.isOffscreen(s,l,c,f)}}placeCollisionCircles(t,a,d,g,b,M,i,n,s,l,c,f,y,x){const S=[],C=new h.P(a.anchorX,a.anchorY),z=Ei(C,M,x),G=ns(this.transform.cameraToCenterDistance,z.signedDistanceFromCamera),N=(l?b/G:b*G)/h.ap,Z=Ei(C,i,x).point,Q=Vt(N,g,a.lineOffsetX*N,a.lineOffsetY*N,!1,Z,C,a,d,i,{projections:{},offsets:{}},!1,x);let ee=!1,he=!1,ge=!0;if(Q){const oe=.5*f*G+y,fe=new h.P(-100,-100),pe=new h.P(this.screenRightBoundary,this.screenBottomBoundary),Fe=new is,Me=Q.first,Pe=Q.last;let Ce=[];for(let rt=Me.path.length-1;rt>=1;rt--)Ce.push(Me.path[rt]);for(let rt=1;rt<Pe.path.length;rt++)Ce.push(Pe.path[rt]);const vt=2.5*oe;if(n){const rt=Ce.map(et=>Ei(et,n,x));Ce=rt.some(et=>et.signedDistanceFromCamera<=0)?[]:rt.map(et=>et.point)}let at=[];if(Ce.length>0){const rt=Ce[0].clone(),et=Ce[0].clone();for(let ft=1;ft<Ce.length;ft++)rt.x=Math.min(rt.x,Ce[ft].x),rt.y=Math.min(rt.y,Ce[ft].y),et.x=Math.max(et.x,Ce[ft].x),et.y=Math.max(et.y,Ce[ft].y);at=rt.x>=fe.x&&et.x<=pe.x&&rt.y>=fe.y&&et.y<=pe.y?[Ce]:et.x<fe.x||rt.x>pe.x||et.y<fe.y||rt.y>pe.y?[]:h.am([Ce],fe.x,fe.y,pe.x,pe.y)}for(const rt of at){Fe.reset(rt,.25*oe);let et=0;et=Fe.length<=.5*oe?1:Math.ceil(Fe.paddedLength/vt)+1;for(let ft=0;ft<et;ft++){const ut=ft/Math.max(et-1,1),Rt=Fe.lerp(ut),dt=Rt.x+ce,Pt=Rt.y+ce;S.push(dt,Pt,oe,0);const di=dt-oe,pi=Pt-oe,Zn=dt+oe,Qn=Pt+oe;if(ge=ge&&this.isOffscreen(di,pi,Zn,Qn),he=he||this.isInsideGrid(di,pi,Zn,Qn),t!=="always"&&this.grid.hitTestCircle(dt,Pt,oe,t,c)&&(ee=!0,!s))return{circles:[],offscreen:!1,collisionDetected:ee}}}}return{circles:!s&&ee||!he||G<this.perspectiveRatioCutoff?[]:S,offscreen:ge,collisionDetected:ee}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const a=[];let d=1/0,g=1/0,b=-1/0,M=-1/0;for(const l of t){const c=new h.P(l.x+ce,l.y+ce);d=Math.min(d,c.x),g=Math.min(g,c.y),b=Math.max(b,c.x),M=Math.max(M,c.y),a.push(c)}const i=this.grid.query(d,g,b,M).concat(this.ignoredGrid.query(d,g,b,M)),n={},s={};for(const l of i){const c=l.key;if(n[c.bucketInstanceId]===void 0&&(n[c.bucketInstanceId]={}),n[c.bucketInstanceId][c.featureIndex])continue;const f=[new h.P(l.x1,l.y1),new h.P(l.x2,l.y1),new h.P(l.x2,l.y2),new h.P(l.x1,l.y2)];h.an(a,f)&&(n[c.bucketInstanceId][c.featureIndex]=!0,s[c.bucketInstanceId]===void 0&&(s[c.bucketInstanceId]=[]),s[c.bucketInstanceId].push(c.featureIndex))}return s}insertCollisionBox(t,a,d,g,b,M){(d?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:b,collisionGroupID:M,overlapMode:a},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,a,d,g,b,M){const i=d?this.ignoredGrid:this.grid,n={bucketInstanceId:g,featureIndex:b,collisionGroupID:M,overlapMode:a};for(let s=0;s<t.length;s+=4)i.insertCircle(n,t[s],t[s+1],t[s+2])}projectAndGetPerspectiveRatio(t,a,d,g){let b;return g?(b=[a,d,g(a,d),1],h.ag(b,b,t)):(b=[a,d,0,1],le(b,b,t)),{point:new h.P((b[0]/b[3]+1)/2*this.transform.width+ce,(-b[1]/b[3]+1)/2*this.transform.height+ce),perspectiveRatio:.5+this.transform.cameraToCenterDistance/b[3]*.5}}isOffscreen(t,a,d,g){return d<ce||t>=this.screenRightBoundary||g<ce||a>this.screenBottomBoundary}isInsideGrid(t,a,d,g){return d>=0&&t<this.gridRightBoundary&&g>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const t=h.ao([]);return h.$(t,t,[-100,-100,0]),t}}function ve(v,t,a){return t*(h.N/(v.tileSize*Math.pow(2,a-v.tileID.overscaledZ)))}class de{constructor(t,a,d,g){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?a:-a))):g&&d?1:0,this.placed=d}isHidden(){return this.opacity===0&&!this.placed}}class be{constructor(t,a,d,g,b){this.text=new de(t?t.text:null,a,d,b),this.icon=new de(t?t.icon:null,a,g,b)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Be{constructor(t,a,d){this.text=t,this.icon=a,this.skipFade=d}}class se{constructor(){this.invProjMatrix=h.Z(),this.viewportMatrix=h.Z(),this.circles=[]}}class _e{constructor(t,a,d,g,b){this.bucketInstanceId=t,this.featureIndex=a,this.sourceLayerIndex=d,this.bucketIndex=g,this.tileID=b}}class De{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const a=++this.maxGroupID;this.collisionGroups[t]={ID:a,predicate:d=>d.collisionGroupID===a}}return this.collisionGroups[t]}}function Ue(v,t,a,d,g){const{horizontalAlign:b,verticalAlign:M}=h.au(v);return new h.P(-(b-.5)*t+d[0]*g,-(M-.5)*a+d[1]*g)}function A(v,t,a,d,g,b){const{x1:M,x2:i,y1:n,y2:s,anchorPointX:l,anchorPointY:c}=v,f=new h.P(t,a);return d&&f._rotate(g?b:-b),{x1:M+f.x,y1:n+f.y,x2:i+f.x,y2:s+f.y,anchorPointX:l,anchorPointY:c}}class H{constructor(t,a,d,g,b){this.transform=t.clone(),this.terrain=a,this.collisionIndex=new Ee(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=d,this.retainedQueryData={},this.collisionGroups=new De(g),this.collisionCircleArrays={},this.prevPlacement=b,b&&(b.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,a,d,g){const b=d.getBucket(a),M=d.latestFeatureIndex;if(!b||!M||a.id!==b.layerIds[0])return;const i=d.collisionBoxArray,n=b.layers[0].layout,s=Math.pow(2,this.transform.zoom-d.tileID.overscaledZ),l=d.tileSize/h.N,c=this.transform.calculatePosMatrix(d.tileID.toUnwrapped()),f=n.get("text-pitch-alignment")==="map",y=n.get("text-rotation-alignment")==="map",x=ve(d,1,this.transform.zoom),S=qe(c,f,y,this.transform,x);let C=null;if(f){const G=An(c,f,y,this.transform,x);C=h.a1([],this.transform.labelPlaneMatrix,G)}this.retainedQueryData[b.bucketInstanceId]=new _e(b.bucketInstanceId,M,b.sourceLayerIndex,b.index,d.tileID);const z={bucket:b,layout:n,posMatrix:c,textLabelPlaneMatrix:S,labelToScreenMatrix:C,scale:s,textPixelRatio:l,holdingForFade:d.holdingForFade(),collisionBoxArray:i,partiallyEvaluatedTextSize:h.ah(b.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(g)for(const G of b.sortKeyRanges){const{sortKey:N,symbolInstanceStart:Z,symbolInstanceEnd:Q}=G;t.push({sortKey:N,symbolInstanceStart:Z,symbolInstanceEnd:Q,parameters:z})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:z})}attemptAnchorPlacement(t,a,d,g,b,M,i,n,s,l,c,f,y,x,S,C){const z=h.aq[t.textAnchor],G=[t.textOffset0,t.textOffset1],N=Ue(z,d,g,G,b),Z=this.collisionIndex.placeCollisionBox(A(a,N.x,N.y,M,i,this.transform.angle),c,n,s,l.predicate,C);if((!S||this.collisionIndex.placeCollisionBox(A(S,N.x,N.y,M,i,this.transform.angle),c,n,s,l.predicate,C).box.length!==0)&&Z.box.length>0){let Q;if(this.prevPlacement&&this.prevPlacement.variableOffsets[f.crossTileID]&&this.prevPlacement.placements[f.crossTileID]&&this.prevPlacement.placements[f.crossTileID].text&&(Q=this.prevPlacement.variableOffsets[f.crossTileID].anchor),f.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[f.crossTileID]={textOffset:G,width:d,height:g,anchor:z,textBoxScale:b,prevAnchor:Q},this.markUsedJustification(y,z,f,x),y.allowVerticalPlacement&&(this.markUsedOrientation(y,x,f),this.placedOrientations[f.crossTileID]=x),{shift:N,placedGlyphBoxes:Z}}}placeLayerBucketPart(t,a,d){const{bucket:g,layout:b,posMatrix:M,textLabelPlaneMatrix:i,labelToScreenMatrix:n,textPixelRatio:s,holdingForFade:l,collisionBoxArray:c,partiallyEvaluatedTextSize:f,collisionGroup:y}=t.parameters,x=b.get("text-optional"),S=b.get("icon-optional"),C=h.ar(b,"text-overlap","text-allow-overlap"),z=C==="always",G=h.ar(b,"icon-overlap","icon-allow-overlap"),N=G==="always",Z=b.get("text-rotation-alignment")==="map",Q=b.get("text-pitch-alignment")==="map",ee=b.get("icon-text-fit")!=="none",he=b.get("symbol-z-order")==="viewport-y",ge=z&&(N||!g.hasIconData()||S),oe=N&&(z||!g.hasTextData()||x);!g.collisionArrays&&c&&g.deserializeCollisionBoxes(c);const fe=this.retainedQueryData[g.bucketInstanceId].tileID,pe=this.terrain?(Me,Pe)=>this.terrain.getElevation(fe,Me,Pe):null,Fe=(Me,Pe)=>{var Ce,vt;if(a[Me.crossTileID])return;if(l)return void(this.placements[Me.crossTileID]=new Be(!1,!1,!1));let at=!1,rt=!1,et=!0,ft=null,ut={box:null,offscreen:null},Rt={box:null,offscreen:null},dt=null,Pt=null,di=null,pi=0,Zn=0,Qn=0;Pe.textFeatureIndex?pi=Pe.textFeatureIndex:Me.useRuntimeCollisionCircles&&(pi=Me.featureIndex),Pe.verticalTextFeatureIndex&&(Zn=Pe.verticalTextFeatureIndex);const Hs=Pe.textBox;if(Hs){const vr=Li=>{let Ki=h.ai.horizontal;if(g.allowVerticalPlacement&&!Li&&this.prevPlacement){const Ur=this.prevPlacement.placedOrientations[Me.crossTileID];Ur&&(this.placedOrientations[Me.crossTileID]=Ur,Ki=Ur,this.markUsedOrientation(g,Ki,Me))}return Ki},hr=(Li,Ki)=>{if(g.allowVerticalPlacement&&Me.numVerticalGlyphVertices>0&&Pe.verticalTextBox){for(const Ur of g.writingModes)if(Ur===h.ai.vertical?(ut=Ki(),Rt=ut):ut=Li(),ut&&ut.box&&ut.box.length)break}else ut=Li()},Ir=Me.textAnchorOffsetStartIndex,Io=Me.textAnchorOffsetEndIndex;if(Io===Ir){const Li=(Ki,Ur)=>{const Ri=this.collisionIndex.placeCollisionBox(Ki,C,s,M,y.predicate,pe);return Ri&&Ri.box&&Ri.box.length&&(this.markUsedOrientation(g,Ur,Me),this.placedOrientations[Me.crossTileID]=Ur),Ri};hr(()=>Li(Hs,h.ai.horizontal),()=>{const Ki=Pe.verticalTextBox;return g.allowVerticalPlacement&&Me.numVerticalGlyphVertices>0&&Ki?Li(Ki,h.ai.vertical):{box:null,offscreen:null}}),vr(ut&&ut.box&&ut.box.length)}else{let Li=h.aq[(vt=(Ce=this.prevPlacement)===null||Ce===void 0?void 0:Ce.variableOffsets[Me.crossTileID])===null||vt===void 0?void 0:vt.anchor];const Ki=(Ri,Mo,Il)=>{const RA=Ri.x2-Ri.x1,FA=Ri.y2-Ri.y1,qu=Me.textBoxScale,tA=ee&&G==="never"?Mo:null;let $n={box:[],offscreen:!1},Co=C==="never"?1:2,Hn="never";Li&&Co++;for(let dn=0;dn<Co;dn++){for(let Wn=Ir;Wn<Io;Wn++){const iA=g.textAnchorOffsets.get(Wn);if(Li&&iA.textAnchor!==Li)continue;const ds=this.attemptAnchorPlacement(iA,Ri,RA,FA,qu,Z,Q,s,M,y,Hn,Me,g,Il,tA,pe);if(ds&&($n=ds.placedGlyphBoxes,$n&&$n.box&&$n.box.length))return at=!0,ft=ds.shift,$n}Li?Li=null:Hn=C}return $n};hr(()=>Ki(Hs,Pe.iconBox,h.ai.horizontal),()=>{const Ri=Pe.verticalTextBox;return g.allowVerticalPlacement&&!(ut&&ut.box&&ut.box.length)&&Me.numVerticalGlyphVertices>0&&Ri?Ki(Ri,Pe.verticalIconBox,h.ai.vertical):{box:null,offscreen:null}}),ut&&(at=ut.box,et=ut.offscreen);const Ur=vr(ut&&ut.box);if(!at&&this.prevPlacement){const Ri=this.prevPlacement.variableOffsets[Me.crossTileID];Ri&&(this.variableOffsets[Me.crossTileID]=Ri,this.markUsedJustification(g,Ri.anchor,Me,Ur))}}}if(dt=ut,at=dt&&dt.box&&dt.box.length>0,et=dt&&dt.offscreen,Me.useRuntimeCollisionCircles){const vr=g.text.placedSymbolArray.get(Me.centerJustifiedTextSymbolIndex),hr=h.aj(g.textSizeData,f,vr),Ir=b.get("text-padding");Pt=this.collisionIndex.placeCollisionCircles(C,vr,g.lineVertexArray,g.glyphOffsetArray,hr,M,i,n,d,Q,y.predicate,Me.collisionCircleDiameter,Ir,pe),Pt.circles.length&&Pt.collisionDetected&&!d&&h.w("Collisions detected, but collision boxes are not shown"),at=z||Pt.circles.length>0&&!Pt.collisionDetected,et=et&&Pt.offscreen}if(Pe.iconFeatureIndex&&(Qn=Pe.iconFeatureIndex),Pe.iconBox){const vr=hr=>{const Ir=ee&&ft?A(hr,ft.x,ft.y,Z,Q,this.transform.angle):hr;return this.collisionIndex.placeCollisionBox(Ir,G,s,M,y.predicate,pe)};Rt&&Rt.box&&Rt.box.length&&Pe.verticalIconBox?(di=vr(Pe.verticalIconBox),rt=di.box.length>0):(di=vr(Pe.iconBox),rt=di.box.length>0),et=et&&di.offscreen}const To=x||Me.numHorizontalGlyphVertices===0&&Me.numVerticalGlyphVertices===0,la=S||Me.numIconVertices===0;if(To||la?la?To||(rt=rt&&at):at=rt&&at:rt=at=rt&&at,at&&dt&&dt.box&&this.collisionIndex.insertCollisionBox(dt.box,C,b.get("text-ignore-placement"),g.bucketInstanceId,Rt&&Rt.box&&Zn?Zn:pi,y.ID),rt&&di&&this.collisionIndex.insertCollisionBox(di.box,G,b.get("icon-ignore-placement"),g.bucketInstanceId,Qn,y.ID),Pt&&(at&&this.collisionIndex.insertCollisionCircles(Pt.circles,C,b.get("text-ignore-placement"),g.bucketInstanceId,pi,y.ID),d)){const vr=g.bucketInstanceId;let hr=this.collisionCircleArrays[vr];hr===void 0&&(hr=this.collisionCircleArrays[vr]=new se);for(let Ir=0;Ir<Pt.circles.length;Ir+=4)hr.circles.push(Pt.circles[Ir+0]),hr.circles.push(Pt.circles[Ir+1]),hr.circles.push(Pt.circles[Ir+2]),hr.circles.push(Pt.collisionDetected?1:0)}if(Me.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(g.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Me.crossTileID]=new Be(at||ge,rt||oe,et||g.justReloaded),a[Me.crossTileID]=!0};if(he){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Me=g.getSortedSymbolIndexes(this.transform.angle);for(let Pe=Me.length-1;Pe>=0;--Pe){const Ce=Me[Pe];Fe(g.symbolInstances.get(Ce),g.collisionArrays[Ce])}}else for(let Me=t.symbolInstanceStart;Me<t.symbolInstanceEnd;Me++)Fe(g.symbolInstances.get(Me),g.collisionArrays[Me]);if(d&&g.bucketInstanceId in this.collisionCircleArrays){const Me=this.collisionCircleArrays[g.bucketInstanceId];h.as(Me.invProjMatrix,M),Me.viewportMatrix=this.collisionIndex.getViewportMatrix()}g.justReloaded=!1}markUsedJustification(t,a,d,g){let b;b=g===h.ai.vertical?d.verticalPlacedTextSymbolIndex:{left:d.leftJustifiedTextSymbolIndex,center:d.centerJustifiedTextSymbolIndex,right:d.rightJustifiedTextSymbolIndex}[h.at(a)];const M=[d.leftJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.rightJustifiedTextSymbolIndex,d.verticalPlacedTextSymbolIndex];for(const i of M)i>=0&&(t.text.placedSymbolArray.get(i).crossTileID=b>=0&&i!==b?0:d.crossTileID)}markUsedOrientation(t,a,d){const g=a===h.ai.horizontal||a===h.ai.horizontalOnly?a:0,b=a===h.ai.vertical?a:0,M=[d.leftJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.rightJustifiedTextSymbolIndex];for(const i of M)t.text.placedSymbolArray.get(i).placedOrientation=g;d.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(d.verticalPlacedTextSymbolIndex).placedOrientation=b)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let d=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const g=a?a.symbolFadeChange(t):1,b=a?a.opacities:{},M=a?a.variableOffsets:{},i=a?a.placedOrientations:{};for(const n in this.placements){const s=this.placements[n],l=b[n];l?(this.opacities[n]=new be(l,g,s.text,s.icon),d=d||s.text!==l.text.placed||s.icon!==l.icon.placed):(this.opacities[n]=new be(null,g,s.text,s.icon,s.skipFade),d=d||s.text||s.icon)}for(const n in b){const s=b[n];if(!this.opacities[n]){const l=new be(s,g,!1,!1);l.isHidden()||(this.opacities[n]=l,d=d||s.text.placed||s.icon.placed)}}for(const n in M)this.variableOffsets[n]||!this.opacities[n]||this.opacities[n].isHidden()||(this.variableOffsets[n]=M[n]);for(const n in i)this.placedOrientations[n]||!this.opacities[n]||this.opacities[n].isHidden()||(this.placedOrientations[n]=i[n]);if(a&&a.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");d?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:t)}updateLayerOpacities(t,a){const d={};for(const g of a){const b=g.getBucket(t);b&&g.latestFeatureIndex&&t.id===b.layerIds[0]&&this.updateBucketOpacities(b,d,g.collisionBoxArray)}}updateBucketOpacities(t,a,d){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const g=t.layers[0],b=g.layout,M=new be(null,0,!1,!1,!0),i=b.get("text-allow-overlap"),n=b.get("icon-allow-overlap"),s=g._unevaluatedLayout.hasValue("text-variable-anchor")||g._unevaluatedLayout.hasValue("text-variable-anchor-offset"),l=b.get("text-rotation-alignment")==="map",c=b.get("text-pitch-alignment")==="map",f=b.get("icon-text-fit")!=="none",y=new be(null,0,i&&(n||!t.hasIconData()||b.get("icon-optional")),n&&(i||!t.hasTextData()||b.get("text-optional")),!0);!t.collisionArrays&&d&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(d);const x=(S,C,z)=>{for(let G=0;G<C/4;G++)S.opacityVertexArray.emplaceBack(z);S.hasVisibleVertices=S.hasVisibleVertices||z!==Ar};for(let S=0;S<t.symbolInstances.length;S++){const C=t.symbolInstances.get(S),{numHorizontalGlyphVertices:z,numVerticalGlyphVertices:G,crossTileID:N}=C;let Z=this.opacities[N];a[N]?Z=M:Z||(Z=y,this.opacities[N]=Z),a[N]=!0;const Q=C.numIconVertices>0,ee=this.placedOrientations[C.crossTileID],he=ee===h.ai.vertical,ge=ee===h.ai.horizontal||ee===h.ai.horizontalOnly;if(z>0||G>0){const oe=li(Z.text);x(t.text,z,he?Ar:oe),x(t.text,G,ge?Ar:oe);const fe=Z.text.isHidden();[C.rightJustifiedTextSymbolIndex,C.centerJustifiedTextSymbolIndex,C.leftJustifiedTextSymbolIndex].forEach(Me=>{Me>=0&&(t.text.placedSymbolArray.get(Me).hidden=fe||he?1:0)}),C.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(C.verticalPlacedTextSymbolIndex).hidden=fe||ge?1:0);const pe=this.variableOffsets[C.crossTileID];pe&&this.markUsedJustification(t,pe.anchor,C,ee);const Fe=this.placedOrientations[C.crossTileID];Fe&&(this.markUsedJustification(t,"left",C,Fe),this.markUsedOrientation(t,Fe,C))}if(Q){const oe=li(Z.icon),fe=!(f&&C.verticalPlacedIconSymbolIndex&&he);C.placedIconSymbolIndex>=0&&(x(t.icon,C.numIconVertices,fe?oe:Ar),t.icon.placedSymbolArray.get(C.placedIconSymbolIndex).hidden=Z.icon.isHidden()),C.verticalPlacedIconSymbolIndex>=0&&(x(t.icon,C.numVerticalIconVertices,fe?Ar:oe),t.icon.placedSymbolArray.get(C.verticalPlacedIconSymbolIndex).hidden=Z.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const oe=t.collisionArrays[S];if(oe){let fe=new h.P(0,0);if(oe.textBox||oe.verticalTextBox){let Fe=!0;if(s){const Me=this.variableOffsets[N];Me?(fe=Ue(Me.anchor,Me.width,Me.height,Me.textOffset,Me.textBoxScale),l&&fe._rotate(c?this.transform.angle:-this.transform.angle)):Fe=!1}oe.textBox&&Ke(t.textCollisionBox.collisionVertexArray,Z.text.placed,!Fe||he,fe.x,fe.y),oe.verticalTextBox&&Ke(t.textCollisionBox.collisionVertexArray,Z.text.placed,!Fe||ge,fe.x,fe.y)}const pe=!!(!ge&&oe.verticalIconBox);oe.iconBox&&Ke(t.iconCollisionBox.collisionVertexArray,Z.icon.placed,pe,f?fe.x:0,f?fe.y:0),oe.verticalIconBox&&Ke(t.iconCollisionBox.collisionVertexArray,Z.icon.placed,!pe,f?fe.x:0,f?fe.y:0)}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);if(t.bucketInstanceId in this.collisionCircleArrays){const S=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=S.invProjMatrix,t.placementViewportMatrix=S.viewportMatrix,t.collisionCircleArray=S.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,a){const d=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*d>t}setStale(){this.stale=!0}}function Ke(v,t,a,d,g){v.emplaceBack(t?1:0,a?1:0,d||0,g||0),v.emplaceBack(t?1:0,a?1:0,d||0,g||0),v.emplaceBack(t?1:0,a?1:0,d||0,g||0),v.emplaceBack(t?1:0,a?1:0,d||0,g||0)}const mt=Math.pow(2,25),zt=Math.pow(2,24),ot=Math.pow(2,17),At=Math.pow(2,16),Si=Math.pow(2,9),Et=Math.pow(2,8),gt=Math.pow(2,1);function li(v){if(v.opacity===0&&!v.placed)return 0;if(v.opacity===1&&v.placed)return 4294967295;const t=v.placed?1:0,a=Math.floor(127*v.opacity);return a*mt+t*zt+a*ot+t*At+a*Si+t*Et+a*gt+t}const Ar=0;class il{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,a,d,g,b){const M=this._bucketParts;for(;this._currentTileIndex<t.length;)if(a.getBucketParts(M,g,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,M.sort((i,n)=>i.sortKey-n.sortKey));this._currentPartIndex<M.length;)if(a.placeLayerBucketPart(M[this._currentPartIndex],this._seenCrossTileIDs,d),this._currentPartIndex++,b())return!0;return!1}}class On{constructor(t,a,d,g,b,M,i,n){this.placement=new H(t,a,M,i,n),this._currentPlacementIndex=d.length-1,this._forceFullPlacement=g,this._showCollisionBoxes=b,this._done=!1}isDone(){return this._done}continuePlacement(t,a,d){const g=h.h.now(),b=()=>!this._forceFullPlacement&&h.h.now()-g>2;for(;this._currentPlacementIndex>=0;){const M=a[t[this._currentPlacementIndex]],i=this.placement.collisionIndex.transform.zoom;if(M.type==="symbol"&&(!M.minzoom||M.minzoom<=i)&&(!M.maxzoom||M.maxzoom>i)){if(this._inProgressLayer||(this._inProgressLayer=new il(M)),this._inProgressLayer.continuePlacement(d[M.source],this.placement,this._showCollisionBoxes,M,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Yi=512/h.N/2;class Is{constructor(t,a,d){this.tileID=t,this.bucketInstanceId=d,this._symbolsByKey={};const g=new Map;for(let b=0;b<a.length;b++){const M=a.get(b),i=M.key,n=g.get(i);n?n.push(M):g.set(i,[M])}for(const[b,M]of g){const i={positions:M.map(n=>({x:Math.floor(n.anchorX*Yi),y:Math.floor(n.anchorY*Yi)})),crossTileIDs:M.map(n=>n.crossTileID)};if(i.positions.length>128){const n=new h.av(i.positions.length,16,Uint16Array);for(const{x:s,y:l}of i.positions)n.add(s,l);n.finish(),delete i.positions,i.index=n}this._symbolsByKey[b]=i}}getScaledCoordinates(t,a){const{x:d,y:g,z:b}=this.tileID.canonical,{x:M,y:i,z:n}=a.canonical,s=Yi/Math.pow(2,n-b),l=(i*h.N+t.anchorY)*s,c=g*h.N*Yi;return{x:Math.floor((M*h.N+t.anchorX)*s-d*h.N*Yi),y:Math.floor(l-c)}}findMatches(t,a,d){const g=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z);for(let b=0;b<t.length;b++){const M=t.get(b);if(M.crossTileID)continue;const i=this._symbolsByKey[M.key];if(!i)continue;const n=this.getScaledCoordinates(M,a);if(i.index){const s=i.index.range(n.x-g,n.y-g,n.x+g,n.y+g).sort();for(const l of s){const c=i.crossTileIDs[l];if(!d[c]){d[c]=!0,M.crossTileID=c;break}}}else if(i.positions)for(let s=0;s<i.positions.length;s++){const l=i.positions[s],c=i.crossTileIDs[s];if(Math.abs(l.x-n.x)<=g&&Math.abs(l.y-n.y)<=g&&!d[c]){d[c]=!0,M.crossTileID=c;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:t})=>t)}}class Zt{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class oo{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const a=Math.round((t-this.lng)/360);if(a!==0)for(const d in this.indexes){const g=this.indexes[d],b={};for(const M in g){const i=g[M];i.tileID=i.tileID.unwrapTo(i.tileID.wrap+a),b[i.tileID.key]=i}this.indexes[d]=b}this.lng=t}addBucket(t,a,d){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let b=0;b<a.symbolInstances.length;b++)a.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const g=this.usedCrossTileIDs[t.overscaledZ];for(const b in this.indexes){const M=this.indexes[b];if(Number(b)>t.overscaledZ)for(const i in M){const n=M[i];n.tileID.isChildOf(t)&&n.findMatches(a.symbolInstances,t,g)}else{const i=M[t.scaledTo(Number(b)).key];i&&i.findMatches(a.symbolInstances,t,g)}}for(let b=0;b<a.symbolInstances.length;b++){const M=a.symbolInstances.get(b);M.crossTileID||(M.crossTileID=d.generate(),g[M.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Is(t,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(t,a){for(const d of a.getCrossTileIDsLists())for(const g of d)delete this.usedCrossTileIDs[t][g]}removeStaleBuckets(t){let a=!1;for(const d in this.indexes){const g=this.indexes[d];for(const b in g)t[g[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(d,g[b]),delete g[b],a=!0)}return a}}class Go{constructor(){this.layerIndexes={},this.crossTileIDs=new Zt,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,a,d){let g=this.layerIndexes[t.id];g===void 0&&(g=this.layerIndexes[t.id]=new oo);let b=!1;const M={};g.handleWrapJump(d);for(const i of a){const n=i.getBucket(t);n&&t.id===n.layerIds[0]&&(n.bucketInstanceId||(n.bucketInstanceId=++this.maxBucketInstanceId),g.addBucket(i.tileID,n,this.crossTileIDs)&&(b=!0),M[n.bucketInstanceId]=!0)}return g.removeStaleBuckets(M)&&(b=!0),b}pruneUnusedLayers(t){const a={};t.forEach(d=>{a[d]=!0});for(const d in this.layerIndexes)a[d]||delete this.layerIndexes[d]}}const Ci=(v,t)=>h.x(v,t&&t.filter(a=>a.identifier!=="source.canvas")),St=h.F(h.ax,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setGlyphs","setSprite"]),ne=h.F(h.ax,["setCenter","setZoom","setBearing","setPitch"]),_t=h.aw();class qi extends h.E{constructor(t,a={}){super(),this.map=t,this.dispatcher=new Wr(so(),this,t._getMapId()),this.imageManager=new Gt,this.imageManager.setEventedParent(this),this.glyphManager=new _i(t._requestManager,a.localIdeographFontFamily),this.lineAtlas=new Jn(256,512),this.crossTileSymbolIndex=new Go,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new h.ay,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",h.az());const d=this;this._rtlTextPluginCallback=qi.registerForPluginStateChange(g=>{d.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:g.pluginStatus,pluginURL:g.pluginURL},(b,M)=>{if(h.aA(b),M&&M.every(i=>i))for(const i in d.sourceCaches){const n=d.sourceCaches[i].getSource().type;n!=="vector"&&n!=="geojson"||d.sourceCaches[i].reload()}})}),this.on("data",g=>{if(g.dataType!=="source"||g.sourceDataType!=="metadata")return;const b=this.sourceCaches[g.sourceId];if(!b)return;const M=b.getSource();if(M&&M.vectorLayerIds)for(const i in this._layers){const n=this._layers[i];n.source===M.id&&this._validateLayer(n)}})}loadURL(t,a={},d){this.fire(new h.k("dataloading",{dataType:"style"})),a.validate=typeof a.validate!="boolean"||a.validate;const g=this.map._requestManager.transformRequest(t,Le.Style);this._request=h.f(g,(b,M)=>{this._request=null,b?this.fire(new h.j(b)):M&&this._load(M,a,d)})}loadJSON(t,a={},d){this.fire(new h.k("dataloading",{dataType:"style"})),this._request=h.h.frame(()=>{this._request=null,a.validate=a.validate!==!1,this._load(t,a,d)})}loadEmpty(){this.fire(new h.k("dataloading",{dataType:"style"})),this._load(_t,{validate:!1})}_load(t,a,d){var g;const b=a.transformStyle?a.transformStyle(d,t):t;if(!a.validate||!Ci(this,h.y(b))){this._loaded=!0,this.stylesheet=b;for(const M in b.sources)this.addSource(M,b.sources[M],{validate:!1});b.sprite?this._loadSprite(b.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(b.glyphs),this._createLayers(),this.light=new Fi(this.stylesheet.light),this.map.setTerrain((g=this.stylesheet.terrain)!==null&&g!==void 0?g:null),this.fire(new h.k("data",{dataType:"style"})),this.fire(new h.k("style.load"))}}_createLayers(){const t=h.aB(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",t),this._order=t.map(a=>a.id),this._layers={},this._serializedLayers=null;for(const a of t){const d=h.aC(a);d.setEventedParent(this,{layer:{id:a.id}}),this._layers[a.id]=d}}_loadSprite(t,a=!1,d=void 0){this.imageManager.setLoaded(!1),this._spriteRequest=function(g,b,M,i){const n=It(g),s=n.length,l=M>1?"@2x":"",c={},f={},y={};for(const{id:x,url:S}of n){const C=b.transformRequest(b.normalizeSpriteURL(S,l,".json"),Le.SpriteJSON),z=`${x}_${C.url}`;c[z]=h.f(C,(Z,Q)=>{delete c[z],f[x]=Q,Kt(i,f,y,Z,s)});const G=b.transformRequest(b.normalizeSpriteURL(S,l,".png"),Le.SpriteImage),N=`${x}_${G.url}`;c[N]=Te.getImage(G,(Z,Q)=>{delete c[N],y[x]=Q,Kt(i,f,y,Z,s)})}return{cancel(){for(const x of Object.values(c))x.cancel()}}}(t,this.map._requestManager,this.map.getPixelRatio(),(g,b)=>{if(this._spriteRequest=null,g)this.fire(new h.j(g));else if(b)for(const M in b){this._spritesImagesIds[M]=[];const i=this._spritesImagesIds[M]?this._spritesImagesIds[M].filter(n=>!(n in b)):[];for(const n of i)this.imageManager.removeImage(n),this._changedImages[n]=!0;for(const n in b[M]){const s=M==="default"?n:`${M}:${n}`;this._spritesImagesIds[M].push(s),s in this.imageManager.images?this.imageManager.updateImage(s,b[M][n],!1):this.imageManager.addImage(s,b[M][n]),a&&(this._changedImages[s]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),a&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new h.k("data",{dataType:"style"})),d&&d(g)})}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new h.k("data",{dataType:"style"}))}_validateLayer(t){const a=this.sourceCaches[t.source];if(!a)return;const d=t.sourceLayer;if(!d)return;const g=a.getSource();(g.type==="geojson"||g.vectorLayerIds&&g.vectorLayerIds.indexOf(d)===-1)&&this.fire(new h.j(new Error(`Source layer "${d}" does not exist on source "${g.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t){const a=this._serializedAllLayers();if(!t||t.length===0)return Object.values(a);const d=[];for(const g of t)a[g]&&d.push(a[g]);return d}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const a=Object.keys(this._layers);for(const d of a){const g=this._layers[d];g.type!=="custom"&&(t[d]=g.serialize())}return t}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const a=this._changed;if(this._changed){const g=Object.keys(this._updatedLayers),b=Object.keys(this._removedLayers);(g.length||b.length)&&this._updateWorkerLayers(g,b);for(const M in this._updatedSources){const i=this._updatedSources[M];if(i==="reload")this._reloadSource(M);else{if(i!=="clear")throw new Error(`Invalid action ${i}`);this._clearSource(M)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const M in this._updatedPaintProps)this._layers[M].updateTransitions(t);this.light.updateTransitions(t),this._resetUpdates()}const d={};for(const g in this.sourceCaches){const b=this.sourceCaches[g];d[g]=b.used,b.used=!1}for(const g of this._order){const b=this._layers[g];b.recalculate(t,this._availableImages),!b.isHidden(t.zoom)&&b.source&&(this.sourceCaches[b.source].used=!0)}for(const g in d){const b=this.sourceCaches[g];d[g]!==b.used&&b.fire(new h.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:g}))}this.light.recalculate(t),this.z=t.zoom,a&&this.fire(new h.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const a in this.sourceCaches)this.sourceCaches[a].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,a){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(t),removedIds:a})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,a={}){this._checkLoaded();const d=this.serialize();if(t=a.transformStyle?a.transformStyle(d,t):t,Ci(this,h.y(t)))return!1;(t=h.aD(t)).layers=h.aB(t.layers);const g=h.aE(d,t).filter(M=>!(M.command in ne));if(g.length===0)return!1;const b=g.filter(M=>!(M.command in St));if(b.length>0)throw new Error(`Unimplemented: ${b.map(M=>M.command).join(", ")}.`);for(const M of g)M.command!=="setTransition"&&this[M.command].apply(this,M.args);return this.stylesheet=t,this._serializedLayers=null,!0}addImage(t,a){if(this.getImage(t))return this.fire(new h.j(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,a),this._afterImageUpdated(t)}updateImage(t,a){this.imageManager.updateImage(t,a)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new h.j(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new h.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,a,d={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(h.y.source,`sources.${t}`,a,null,d))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const g=this.sourceCaches[t]=new Mi(t,a,this.dispatcher);g.style=this,g.setEventedParent(this,()=>({isSourceLoaded:g.loaded(),source:g.serialize(),sourceId:t})),g.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(const d in this._layers)if(this._layers[d].source===t)return this.fire(new h.j(new Error(`Source "${t}" cannot be removed while layer "${d}" is using it.`)));const a=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],a.fire(new h.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),a.setEventedParent(null),a.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,a){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const d=this.sourceCaches[t].getSource();if(d.type!=="geojson")throw new Error(`geojsonSource.type is ${d.type}, which is !== 'geojson`);d.setData(a),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,a,d={}){this._checkLoaded();const g=t.id;if(this.getLayer(g))return void this.fire(new h.j(new Error(`Layer "${g}" already exists on this map.`)));let b;if(t.type==="custom"){if(Ci(this,h.aF(t)))return;b=h.aC(t)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(g,t.source),t=h.aD(t),t=h.e(t,{source:g})),this._validate(h.y.layer,`layers.${g}`,t,{arrayIndex:-1},d))return;b=h.aC(t),this._validateLayer(b),b.setEventedParent(this,{layer:{id:g}})}const M=a?this._order.indexOf(a):this._order.length;if(a&&M===-1)this.fire(new h.j(new Error(`Cannot add layer "${g}" before non-existing layer "${a}".`)));else{if(this._order.splice(M,0,g),this._layerOrderChanged=!0,this._layers[g]=b,this._removedLayers[g]&&b.source&&b.type!=="custom"){const i=this._removedLayers[g];delete this._removedLayers[g],i.type!==b.type?this._updatedSources[b.source]="clear":(this._updatedSources[b.source]="reload",this.sourceCaches[b.source].pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map)}}moveLayer(t,a){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new h.j(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===a)return;const d=this._order.indexOf(t);this._order.splice(d,1);const g=a?this._order.indexOf(a):this._order.length;a&&g===-1?this.fire(new h.j(new Error(`Cannot move layer "${t}" before non-existing layer "${a}".`))):(this._order.splice(g,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const a=this._layers[t];if(!a)return void this.fire(new h.j(new Error(`Cannot remove non-existing layer "${t}".`)));a.setEventedParent(null);const d=this._order.indexOf(t);this._order.splice(d,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=a,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],a.onRemove&&a.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,a,d){this._checkLoaded();const g=this.getLayer(t);g?g.minzoom===a&&g.maxzoom===d||(a!=null&&(g.minzoom=a),d!=null&&(g.maxzoom=d),this._updateLayer(g)):this.fire(new h.j(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,a,d={}){this._checkLoaded();const g=this.getLayer(t);if(g){if(!h.aG(g.filter,a))return a==null?(g.filter=void 0,void this._updateLayer(g)):void(this._validate(h.y.filter,`layers.${g.id}.filter`,a,null,d)||(g.filter=h.aD(a),this._updateLayer(g)))}else this.fire(new h.j(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return h.aD(this.getLayer(t).filter)}setLayoutProperty(t,a,d,g={}){this._checkLoaded();const b=this.getLayer(t);b?h.aG(b.getLayoutProperty(a),d)||(b.setLayoutProperty(a,d,g),this._updateLayer(b)):this.fire(new h.j(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,a){const d=this.getLayer(t);if(d)return d.getLayoutProperty(a);this.fire(new h.j(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,a,d,g={}){this._checkLoaded();const b=this.getLayer(t);b?h.aG(b.getPaintProperty(a),d)||(b.setPaintProperty(a,d,g)&&this._updateLayer(b),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new h.j(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,a){return this.getLayer(t).getPaintProperty(a)}setFeatureState(t,a){this._checkLoaded();const d=t.source,g=t.sourceLayer,b=this.sourceCaches[d];if(b===void 0)return void this.fire(new h.j(new Error(`The source '${d}' does not exist in the map's style.`)));const M=b.getSource().type;M==="geojson"&&g?this.fire(new h.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):M!=="vector"||g?(t.id===void 0&&this.fire(new h.j(new Error("The feature id parameter must be provided."))),b.setFeatureState(g,t.id,a)):this.fire(new h.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,a){this._checkLoaded();const d=t.source,g=this.sourceCaches[d];if(g===void 0)return void this.fire(new h.j(new Error(`The source '${d}' does not exist in the map's style.`)));const b=g.getSource().type,M=b==="vector"?t.sourceLayer:void 0;b!=="vector"||M?a&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new h.j(new Error("A feature id is required to remove its specific state property."))):g.removeFeatureState(M,t.id,a):this.fire(new h.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const a=t.source,d=t.sourceLayer,g=this.sourceCaches[a];if(g!==void 0)return g.getSource().type!=="vector"||d?(t.id===void 0&&this.fire(new h.j(new Error("The feature id parameter must be provided."))),g.getFeatureState(d,t.id)):void this.fire(new h.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new h.j(new Error(`The source '${a}' does not exist in the map's style.`)))}getTransition(){return h.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=h.aH(this.sourceCaches,b=>b.serialize()),a=this._serializeByIds(this._order),d=this.map.getTerrain()||void 0,g=this.stylesheet;return h.aI({version:g.version,name:g.name,metadata:g.metadata,light:g.light,center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch,sprite:g.sprite,glyphs:g.glyphs,transition:g.transition,sources:t,layers:a,terrain:d},b=>b!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const a=M=>this._layers[M].type==="fill-extrusion",d={},g=[];for(let M=this._order.length-1;M>=0;M--){const i=this._order[M];if(a(i)){d[i]=M;for(const n of t){const s=n[i];if(s)for(const l of s)g.push(l)}}}g.sort((M,i)=>i.intersectionZ-M.intersectionZ);const b=[];for(let M=this._order.length-1;M>=0;M--){const i=this._order[M];if(a(i))for(let n=g.length-1;n>=0;n--){const s=g[n].feature;if(d[s.layer.id]<M)break;b.push(s),g.pop()}else for(const n of t){const s=n[i];if(s)for(const l of s)b.push(l.feature)}}return b}queryRenderedFeatures(t,a,d){a&&a.filter&&this._validate(h.y.filter,"queryRenderedFeatures.filter",a.filter,null,a);const g={};if(a&&a.layers){if(!Array.isArray(a.layers))return this.fire(new h.j(new Error("parameters.layers must be an Array."))),[];for(const i of a.layers){const n=this._layers[i];if(!n)return this.fire(new h.j(new Error(`The layer '${i}' does not exist in the map's style and cannot be queried for features.`))),[];g[n.source]=!0}}const b=[];a.availableImages=this._availableImages;const M=this._serializedAllLayers();for(const i in this.sourceCaches)a.layers&&!g[i]||b.push(es(this.sourceCaches[i],this._layers,M,t,a,d));return this.placement&&b.push(function(i,n,s,l,c,f,y){const x={},S=f.queryRenderedSymbols(l),C=[];for(const z of Object.keys(S).map(Number))C.push(y[z]);C.sort(pr);for(const z of C){const G=z.featureIndex.lookupSymbolFeatures(S[z.bucketInstanceId],n,z.bucketIndex,z.sourceLayerIndex,c.filter,c.layers,c.availableImages,i);for(const N in G){const Z=x[N]=x[N]||[],Q=G[N];Q.sort((ee,he)=>{const ge=z.featureSortOrder;if(ge){const oe=ge.indexOf(ee.featureIndex);return ge.indexOf(he.featureIndex)-oe}return he.featureIndex-ee.featureIndex});for(const ee of Q)Z.push(ee)}}for(const z in x)x[z].forEach(G=>{const N=G.feature,Z=s[i[z].source].getFeatureState(N.layer["source-layer"],N.id);N.source=N.layer.source,N.layer["source-layer"]&&(N.sourceLayer=N.layer["source-layer"]),N.state=Z});return x}(this._layers,M,this.sourceCaches,t,a,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(b)}querySourceFeatures(t,a){a&&a.filter&&this._validate(h.y.filter,"querySourceFeatures.filter",a.filter,null,a);const d=this.sourceCaches[t];return d?function(g,b){const M=g.getRenderableIds().map(s=>g.getTileByID(s)),i=[],n={};for(let s=0;s<M.length;s++){const l=M[s],c=l.tileID.canonical.key;n[c]||(n[c]=!0,l.querySourceFeatures(i,b))}return i}(d,a):[]}addSourceType(t,a,d){return vn(t)?d(new Error(`A source type called "${t}" already exists.`)):(((g,b)=>{no[g]=b})(t,a),a.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:a.workerSourceURL},d):d(null,null))}getLight(){return this.light.getLight()}setLight(t,a={}){this._checkLoaded();const d=this.light.getLight();let g=!1;for(const M in t)if(!h.aG(t[M],d[M])){g=!0;break}if(!g)return;const b={now:h.h.now(),transition:h.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,a),this.light.updateTransitions(b)}_validate(t,a,d,g,b={}){return(!b||b.validate!==!1)&&Ci(this,t.call(h.y,h.e({key:a,style:this.serialize(),value:d,styleSpec:h.v},g)))}_remove(t=!0){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),h.aJ.off("pluginStateChange",this._rtlTextPluginCallback);for(const a in this._layers)this._layers[a].setEventedParent(null);for(const a in this.sourceCaches){const d=this.sourceCaches[a];d.setEventedParent(null),d.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(t)}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const a in this.sourceCaches)this.sourceCaches[a].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,a,d,g,b=!1){let M=!1,i=!1;const n={};for(const s of this._order){const l=this._layers[s];if(l.type!=="symbol")continue;if(!n[l.source]){const f=this.sourceCaches[l.source];n[l.source]=f.getRenderableIds(!0).map(y=>f.getTileByID(y)).sort((y,x)=>x.tileID.overscaledZ-y.tileID.overscaledZ||(y.tileID.isLessThan(x.tileID)?-1:1))}const c=this.crossTileSymbolIndex.addLayer(l,n[l.source],t.center.lng);M=M||c}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((b=b||this._layerOrderChanged||d===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(h.h.now(),t.zoom))&&(this.pauseablePlacement=new On(t,this.map.terrain,this._order,b,a,d,g,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,n),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(h.h.now()),i=!0),M&&this.pauseablePlacement.placement.setStale()),i||M)for(const s of this._order){const l=this._layers[s];l.type==="symbol"&&this.placement.updateLayerOpacities(l,n[l.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(h.h.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,a,d){this.imageManager.getImages(a.icons,d),this._updateTilesForChangedImages();const g=this.sourceCaches[a.source];g&&g.setDependencies(a.tileID.key,a.type,a.icons)}getGlyphs(t,a,d){this.glyphManager.getGlyphs(a.stacks,d);const g=this.sourceCaches[a.source];g&&g.setDependencies(a.tileID.key,a.type,[""])}getResource(t,a,d){return h.m(a,d)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,a={}){this._checkLoaded(),t&&this._validate(h.y.glyphs,"glyphs",t,null,a)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}addSprite(t,a,d={},g){this._checkLoaded();const b=[{id:t,url:a}],M=[...It(this.stylesheet.sprite),...b];this._validate(h.y.sprite,"sprite",M,null,d)||(this.stylesheet.sprite=M,this._loadSprite(b,!0,g))}removeSprite(t){this._checkLoaded();const a=It(this.stylesheet.sprite);if(a.find(d=>d.id===t)){if(this._spritesImagesIds[t])for(const d of this._spritesImagesIds[t])this.imageManager.removeImage(d),this._changedImages[d]=!0;a.splice(a.findIndex(d=>d.id===t),1),this.stylesheet.sprite=a.length>0?a:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new h.k("data",{dataType:"style"}))}else this.fire(new h.j(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return It(this.stylesheet.sprite)}setSprite(t,a={},d){this._checkLoaded(),t&&this._validate(h.y.sprite,"sprite",t,null,a)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,d):(this._unloadSprite(),d&&d(null)))}}qi.registerForPluginStateChange=h.aK;var jo=h.Q([{name:"a_pos",type:"Int16",components:2}]),Ms="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const xi={prelude:ti(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:ti(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:ti(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:ti(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:ti("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ti(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:ti(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:ti("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:ti("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:ti("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:ti(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:ti(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:ti(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:ti(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:ti(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:ti(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:ti(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ti(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:ti(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:ti(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:ti(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:ti(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:ti(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:ti(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:ti(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:ti(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:ti("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Ms),terrainDepth:ti("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Ms),terrainCoords:ti("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Ms)};function ti(v,t){const a=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,d=t.match(/attribute ([\w]+) ([\w]+)/g),g=v.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),b=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),M=b?b.concat(g):g,i={};return{fragmentSource:v=v.replace(a,(n,s,l,c,f)=>(i[f]=!0,s==="define"?`
#ifndef HAS_UNIFORM_u_${f}
varying ${l} ${c} ${f};
#else
uniform ${l} ${c} u_${f};
#endif
`:`
#ifdef HAS_UNIFORM_u_${f}
    ${l} ${c} ${f} = u_${f};
#endif
`)),vertexSource:t=t.replace(a,(n,s,l,c,f)=>{const y=c==="float"?"vec2":"vec4",x=f.match(/color/)?"color":y;return i[f]?s==="define"?`
#ifndef HAS_UNIFORM_u_${f}
uniform lowp float u_${f}_t;
attribute ${l} ${y} a_${f};
varying ${l} ${c} ${f};
#else
uniform ${l} ${c} u_${f};
#endif
`:x==="vec4"?`
#ifndef HAS_UNIFORM_u_${f}
    ${f} = a_${f};
#else
    ${l} ${c} ${f} = u_${f};
#endif
`:`
#ifndef HAS_UNIFORM_u_${f}
    ${f} = unpack_mix_${x}(a_${f}, u_${f}_t);
#else
    ${l} ${c} ${f} = u_${f};
#endif
`:s==="define"?`
#ifndef HAS_UNIFORM_u_${f}
uniform lowp float u_${f}_t;
attribute ${l} ${y} a_${f};
#else
uniform ${l} ${c} u_${f};
#endif
`:x==="vec4"?`
#ifndef HAS_UNIFORM_u_${f}
    ${l} ${c} ${f} = a_${f};
#else
    ${l} ${c} ${f} = u_${f};
#endif
`:`
#ifndef HAS_UNIFORM_u_${f}
    ${l} ${c} ${f} = unpack_mix_${x}(a_${f}, u_${f}_t);
#else
    ${l} ${c} ${f} = u_${f};
#endif
`}),staticAttributes:d,staticUniforms:M}}class J{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,a,d,g,b,M,i,n,s){this.context=t;let l=this.boundPaintVertexBuffers.length!==g.length;for(let c=0;!l&&c<g.length;c++)this.boundPaintVertexBuffers[c]!==g[c]&&(l=!0);!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==d||l||this.boundIndexBuffer!==b||this.boundVertexOffset!==M||this.boundDynamicVertexBuffer!==i||this.boundDynamicVertexBuffer2!==n||this.boundDynamicVertexBuffer3!==s?this.freshBind(a,d,g,b,M,i,n,s):(t.bindVertexArray.set(this.vao),i&&i.bind(),b&&b.dynamicDraw&&b.bind(),n&&n.bind(),s&&s.bind())}freshBind(t,a,d,g,b,M,i,n){const s=t.numAttributes,l=this.context,c=l.gl;this.vao&&this.destroy(),this.vao=l.createVertexArray(),l.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=d,this.boundIndexBuffer=g,this.boundVertexOffset=b,this.boundDynamicVertexBuffer=M,this.boundDynamicVertexBuffer2=i,this.boundDynamicVertexBuffer3=n,a.enableAttributes(c,t);for(const f of d)f.enableAttributes(c,t);M&&M.enableAttributes(c,t),i&&i.enableAttributes(c,t),n&&n.enableAttributes(c,t),a.bind(),a.setVertexAttribPointers(c,t,b);for(const f of d)f.bind(),f.setVertexAttribPointers(c,t,b);M&&(M.bind(),M.setVertexAttribPointers(c,t,b)),g&&g.bind(),i&&(i.bind(),i.setVertexAttribPointers(c,t,b)),n&&(n.bind(),n.setVertexAttribPointers(c,t,b)),l.currentNumAttributes=s}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function Ti(v){const t=[];for(let a=0;a<v.length;a++){if(v[a]===null)continue;const d=v[a].split(" ");t.push(d.pop())}return t}class qo{constructor(t,a,d,g,b,M){const i=t.gl;this.program=i.createProgram();const n=Ti(a.staticAttributes),s=d?d.getBinderAttributes():[],l=n.concat(s),c=xi.prelude.staticUniforms?Ti(xi.prelude.staticUniforms):[],f=a.staticUniforms?Ti(a.staticUniforms):[],y=d?d.getBinderUniforms():[],x=c.concat(f).concat(y),S=[];for(const ee of x)S.indexOf(ee)<0&&S.push(ee);const C=d?d.defines():[];b&&C.push("#define OVERDRAW_INSPECTOR;"),M&&C.push("#define TERRAIN3D;");const z=C.concat(xi.prelude.fragmentSource,a.fragmentSource).join(`
`),G=C.concat(xi.prelude.vertexSource,a.vertexSource).join(`
`),N=i.createShader(i.FRAGMENT_SHADER);if(i.isContextLost())return void(this.failedToCreate=!0);if(i.shaderSource(N,z),i.compileShader(N),!i.getShaderParameter(N,i.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${i.getShaderInfoLog(N)}`);i.attachShader(this.program,N);const Z=i.createShader(i.VERTEX_SHADER);if(i.isContextLost())return void(this.failedToCreate=!0);if(i.shaderSource(Z,G),i.compileShader(Z),!i.getShaderParameter(Z,i.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${i.getShaderInfoLog(Z)}`);i.attachShader(this.program,Z),this.attributes={};const Q={};this.numAttributes=l.length;for(let ee=0;ee<this.numAttributes;ee++)l[ee]&&(i.bindAttribLocation(this.program,ee,l[ee]),this.attributes[l[ee]]=ee);if(i.linkProgram(this.program),!i.getProgramParameter(this.program,i.LINK_STATUS))throw new Error(`Program failed to link: ${i.getProgramInfoLog(this.program)}`);i.deleteShader(Z),i.deleteShader(N);for(let ee=0;ee<S.length;ee++){const he=S[ee];if(he&&!Q[he]){const ge=i.getUniformLocation(this.program,he);ge&&(Q[he]=ge)}}this.fixedUniforms=g(t,Q),this.terrainUniforms=((ee,he)=>({u_depth:new h.aL(ee,he.u_depth),u_terrain:new h.aL(ee,he.u_terrain),u_terrain_dim:new h.aM(ee,he.u_terrain_dim),u_terrain_matrix:new h.aN(ee,he.u_terrain_matrix),u_terrain_unpack:new h.aO(ee,he.u_terrain_unpack),u_terrain_exaggeration:new h.aM(ee,he.u_terrain_exaggeration)}))(t,Q),this.binderUniforms=d?d.getUniforms(t,Q):[]}draw(t,a,d,g,b,M,i,n,s,l,c,f,y,x,S,C,z,G){const N=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(d),t.setStencilMode(g),t.setColorMode(b),t.setCullFace(M),n){t.activeTexture.set(N.TEXTURE2),N.bindTexture(N.TEXTURE_2D,n.depthTexture),t.activeTexture.set(N.TEXTURE3),N.bindTexture(N.TEXTURE_2D,n.texture);for(const Q in this.terrainUniforms)this.terrainUniforms[Q].set(n[Q])}for(const Q in this.fixedUniforms)this.fixedUniforms[Q].set(i[Q]);S&&S.setUniforms(t,this.binderUniforms,y,{zoom:x});let Z=0;switch(a){case N.LINES:Z=2;break;case N.TRIANGLES:Z=3;break;case N.LINE_STRIP:Z=1}for(const Q of f.get()){const ee=Q.vaos||(Q.vaos={});(ee[s]||(ee[s]=new J)).bind(t,this,l,S?S.getPaintVertexBuffers():[],c,Q.vertexOffset,C,z,G),N.drawElements(a,Q.primitiveLength*Z,N.UNSIGNED_SHORT,Q.primitiveOffset*Z*2)}}}function Fr(v,t,a){const d=1/ve(a,1,t.transform.tileZoom),g=Math.pow(2,a.tileID.overscaledZ),b=a.tileSize*Math.pow(2,t.transform.tileZoom)/g,M=b*(a.tileID.canonical.x+a.tileID.wrap*g),i=b*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_scale:[d,v.fromScale,v.toScale],u_fade:v.t,u_pixel_coord_upper:[M>>16,i>>16],u_pixel_coord_lower:[65535&M,65535&i]}}const pa=(v,t,a,d)=>{const g=t.style.light,b=g.properties.get("position"),M=[b.x,b.y,b.z],i=function(){var s=new h.A(9);return h.A!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[5]=0,s[6]=0,s[7]=0),s[0]=1,s[4]=1,s[8]=1,s}();g.properties.get("anchor")==="viewport"&&function(s,l){var c=Math.sin(l),f=Math.cos(l);s[0]=f,s[1]=c,s[2]=0,s[3]=-c,s[4]=f,s[5]=0,s[6]=0,s[7]=0,s[8]=1}(i,-t.transform.angle),function(s,l,c){var f=l[0],y=l[1],x=l[2];s[0]=f*c[0]+y*c[3]+x*c[6],s[1]=f*c[1]+y*c[4]+x*c[7],s[2]=f*c[2]+y*c[5]+x*c[8]}(M,M,i);const n=g.properties.get("color");return{u_matrix:v,u_lightpos:M,u_lightintensity:g.properties.get("intensity"),u_lightcolor:[n.r,n.g,n.b],u_vertical_gradient:+a,u_opacity:d}},Vn=(v,t,a,d,g,b,M)=>h.e(pa(v,t,a,d),Fr(b,t,M),{u_height_factor:-Math.pow(2,g.overscaledZ)/M.tileSize/8}),rl=v=>({u_matrix:v}),Zo=(v,t,a,d)=>h.e(rl(v),Fr(a,t,d)),ao=(v,t)=>({u_matrix:v,u_world:t}),lo=(v,t,a,d,g)=>h.e(Zo(v,t,a,d),{u_world:g}),sr=(v,t,a,d)=>{const g=v.transform;let b,M;if(d.paint.get("circle-pitch-alignment")==="map"){const i=ve(a,1,g.zoom);b=!0,M=[i,i]}else b=!1,M=g.pixelsToGLUnits;return{u_camera_to_center_distance:g.cameraToCenterDistance,u_scale_with_map:+(d.paint.get("circle-pitch-scale")==="map"),u_matrix:v.translatePosMatrix(t.posMatrix,a,d.paint.get("circle-translate"),d.paint.get("circle-translate-anchor")),u_pitch_with_map:+b,u_device_pixel_ratio:v.pixelRatio,u_extrude_scale:M}},zi=(v,t,a)=>{const d=ve(a,1,t.zoom),g=Math.pow(2,t.zoom-a.tileID.overscaledZ),b=a.tileID.overscaleFactor();return{u_matrix:v,u_camera_to_center_distance:t.cameraToCenterDistance,u_pixels_to_tile_units:d,u_extrude_scale:[t.pixelsToGLUnits[0]/(d*g),t.pixelsToGLUnits[1]/(d*g)],u_overscale_factor:b}},ss=(v,t,a=1)=>({u_matrix:v,u_color:t,u_overlay:0,u_overlay_scale:a}),nl=v=>({u_matrix:v}),Hl=(v,t,a,d)=>({u_matrix:v,u_extrude_scale:ve(t,1,a),u_intensity:d});function Qo(v,t){const a=Math.pow(2,t.canonical.z),d=t.canonical.y;return[new h.U(0,d/a).toLngLat().lat,new h.U(0,(d+1)/a).toLngLat().lat]}const ma=(v,t,a,d)=>{const g=v.transform;return{u_matrix:Ao(v,t,a,d),u_ratio:1/ve(t,1,g.zoom),u_device_pixel_ratio:v.pixelRatio,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},sl=(v,t,a,d,g)=>h.e(ma(v,t,a,g),{u_image:0,u_image_height:d}),Wl=(v,t,a,d,g)=>{const b=v.transform,M=$o(t,b);return{u_matrix:Ao(v,t,a,g),u_texsize:t.imageAtlasTexture.size,u_ratio:1/ve(t,1,b.zoom),u_device_pixel_ratio:v.pixelRatio,u_image:0,u_scale:[M,d.fromScale,d.toScale],u_fade:d.t,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]]}},ci=(v,t,a,d,g,b)=>{const M=v.lineAtlas,i=$o(t,v.transform),n=a.layout.get("line-cap")==="round",s=M.getDash(d.from,n),l=M.getDash(d.to,n),c=s.width*g.fromScale,f=l.width*g.toScale;return h.e(ma(v,t,a,b),{u_patternscale_a:[i/c,-s.height/2],u_patternscale_b:[i/f,-l.height/2],u_sdfgamma:M.width/(256*Math.min(c,f)*v.pixelRatio)/2,u_image:0,u_tex_y_a:s.y,u_tex_y_b:l.y,u_mix:g.t})};function $o(v,t){return 1/ve(v,1,t.tileZoom)}function Ao(v,t,a,d){return v.translatePosMatrix(d?d.posMatrix:t.tileID.posMatrix,t,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}const ol=(v,t,a,d,g)=>{return{u_matrix:v,u_tl_parent:t,u_scale_parent:a,u_buffer_scale:1,u_fade_t:d.mix,u_opacity:d.opacity*g.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:g.paint.get("raster-brightness-min"),u_brightness_high:g.paint.get("raster-brightness-max"),u_saturation_factor:(M=g.paint.get("raster-saturation"),M>0?1-1/(1.001-M):-M),u_contrast_factor:(b=g.paint.get("raster-contrast"),b>0?1/(1-b):1+b),u_spin_weights:al(g.paint.get("raster-hue-rotate"))};var b,M};function al(v){v*=Math.PI/180;const t=Math.sin(v),a=Math.cos(v);return[(2*a+1)/3,(-Math.sqrt(3)*t-a+1)/3,(Math.sqrt(3)*t-a+1)/3]}const ga=(v,t,a,d,g,b,M,i,n,s)=>{const l=g.transform;return{u_is_size_zoom_constant:+(v==="constant"||v==="source"),u_is_size_feature_constant:+(v==="constant"||v==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:l.cameraToCenterDistance,u_pitch:l.pitch/360*2*Math.PI,u_rotate_symbol:+a,u_aspect_ratio:l.width/l.height,u_fade_change:g.options.fadeDuration?g.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:M,u_coord_matrix:i,u_is_text:+n,u_pitch_with_map:+d,u_texsize:s,u_texture:0}},Ho=(v,t,a,d,g,b,M,i,n,s,l)=>{const c=g.transform;return h.e(ga(v,t,a,d,g,b,M,i,n,s),{u_gamma_scale:d?Math.cos(c._pitch)*c.cameraToCenterDistance:1,u_device_pixel_ratio:g.pixelRatio,u_is_halo:+l})},bn=(v,t,a,d,g,b,M,i,n,s)=>h.e(Ho(v,t,a,d,g,b,M,i,!0,n,!0),{u_texsize_icon:s,u_texture_icon:1}),Cs=(v,t,a)=>({u_matrix:v,u_opacity:t,u_color:a}),Or=(v,t,a,d,g,b)=>h.e(function(M,i,n,s){const l=n.imageManager.getPattern(M.from.toString()),c=n.imageManager.getPattern(M.to.toString()),{width:f,height:y}=n.imageManager.getPixelSize(),x=Math.pow(2,s.tileID.overscaledZ),S=s.tileSize*Math.pow(2,n.transform.tileZoom)/x,C=S*(s.tileID.canonical.x+s.tileID.wrap*x),z=S*s.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:l.tl,u_pattern_br_a:l.br,u_pattern_tl_b:c.tl,u_pattern_br_b:c.br,u_texsize:[f,y],u_mix:i.t,u_pattern_size_a:l.displaySize,u_pattern_size_b:c.displaySize,u_scale_a:i.fromScale,u_scale_b:i.toScale,u_tile_units_to_pixels:1/ve(s,1,n.transform.tileZoom),u_pixel_coord_upper:[C>>16,z>>16],u_pixel_coord_lower:[65535&C,65535&z]}}(d,b,a,g),{u_matrix:v,u_opacity:t}),Wo={fillExtrusion:(v,t)=>({u_matrix:new h.aN(v,t.u_matrix),u_lightpos:new h.aP(v,t.u_lightpos),u_lightintensity:new h.aM(v,t.u_lightintensity),u_lightcolor:new h.aP(v,t.u_lightcolor),u_vertical_gradient:new h.aM(v,t.u_vertical_gradient),u_opacity:new h.aM(v,t.u_opacity)}),fillExtrusionPattern:(v,t)=>({u_matrix:new h.aN(v,t.u_matrix),u_lightpos:new h.aP(v,t.u_lightpos),u_lightintensity:new h.aM(v,t.u_lightintensity),u_lightcolor:new h.aP(v,t.u_lightcolor),u_vertical_gradient:new h.aM(v,t.u_vertical_gradient),u_height_factor:new h.aM(v,t.u_height_factor),u_image:new h.aL(v,t.u_image),u_texsize:new h.aQ(v,t.u_texsize),u_pixel_coord_upper:new h.aQ(v,t.u_pixel_coord_upper),u_pixel_coord_lower:new h.aQ(v,t.u_pixel_coord_lower),u_scale:new h.aP(v,t.u_scale),u_fade:new h.aM(v,t.u_fade),u_opacity:new h.aM(v,t.u_opacity)}),fill:(v,t)=>({u_matrix:new h.aN(v,t.u_matrix)}),fillPattern:(v,t)=>({u_matrix:new h.aN(v,t.u_matrix),u_image:new h.aL(v,t.u_image),u_texsize:new h.aQ(v,t.u_texsize),u_pixel_coord_upper:new h.aQ(v,t.u_pixel_coord_upper),u_pixel_coord_lower:new h.aQ(v,t.u_pixel_coord_lower),u_scale:new h.aP(v,t.u_scale),u_fade:new h.aM(v,t.u_fade)}),fillOutline:(v,t)=>({u_matrix:new h.aN(v,t.u_matrix),u_world:new h.aQ(v,t.u_world)}),fillOutlinePattern:(v,t)=>({u_matrix:new h.aN(v,t.u_matrix),u_world:new h.aQ(v,t.u_world),u_image:new h.aL(v,t.u_image),u_texsize:new h.aQ(v,t.u_texsize),u_pixel_coord_upper:new h.aQ(v,t.u_pixel_coord_upper),u_pixel_coord_lower:new h.aQ(v,t.u_pixel_coord_lower),u_scale:new h.aP(v,t.u_scale),u_fade:new h.aM(v,t.u_fade)}),circle:(v,t)=>({u_camera_to_center_distance:new h.aM(v,t.u_camera_to_center_distance),u_scale_with_map:new h.aL(v,t.u_scale_with_map),u_pitch_with_map:new h.aL(v,t.u_pitch_with_map),u_extrude_scale:new h.aQ(v,t.u_extrude_scale),u_device_pixel_ratio:new h.aM(v,t.u_device_pixel_ratio),u_matrix:new h.aN(v,t.u_matrix)}),collisionBox:(v,t)=>({u_matrix:new h.aN(v,t.u_matrix),u_camera_to_center_distance:new h.aM(v,t.u_camera_to_center_distance),u_pixels_to_tile_units:new h.aM(v,t.u_pixels_to_tile_units),u_extrude_scale:new h.aQ(v,t.u_extrude_scale),u_overscale_factor:new h.aM(v,t.u_overscale_factor)}),collisionCircle:(v,t)=>({u_matrix:new h.aN(v,t.u_matrix),u_inv_matrix:new h.aN(v,t.u_inv_matrix),u_camera_to_center_distance:new h.aM(v,t.u_camera_to_center_distance),u_viewport_size:new h.aQ(v,t.u_viewport_size)}),debug:(v,t)=>({u_color:new h.aR(v,t.u_color),u_matrix:new h.aN(v,t.u_matrix),u_overlay:new h.aL(v,t.u_overlay),u_overlay_scale:new h.aM(v,t.u_overlay_scale)}),clippingMask:(v,t)=>({u_matrix:new h.aN(v,t.u_matrix)}),heatmap:(v,t)=>({u_extrude_scale:new h.aM(v,t.u_extrude_scale),u_intensity:new h.aM(v,t.u_intensity),u_matrix:new h.aN(v,t.u_matrix)}),heatmapTexture:(v,t)=>({u_matrix:new h.aN(v,t.u_matrix),u_world:new h.aQ(v,t.u_world),u_image:new h.aL(v,t.u_image),u_color_ramp:new h.aL(v,t.u_color_ramp),u_opacity:new h.aM(v,t.u_opacity)}),hillshade:(v,t)=>({u_matrix:new h.aN(v,t.u_matrix),u_image:new h.aL(v,t.u_image),u_latrange:new h.aQ(v,t.u_latrange),u_light:new h.aQ(v,t.u_light),u_shadow:new h.aR(v,t.u_shadow),u_highlight:new h.aR(v,t.u_highlight),u_accent:new h.aR(v,t.u_accent)}),hillshadePrepare:(v,t)=>({u_matrix:new h.aN(v,t.u_matrix),u_image:new h.aL(v,t.u_image),u_dimension:new h.aQ(v,t.u_dimension),u_zoom:new h.aM(v,t.u_zoom),u_unpack:new h.aO(v,t.u_unpack)}),line:(v,t)=>({u_matrix:new h.aN(v,t.u_matrix),u_ratio:new h.aM(v,t.u_ratio),u_device_pixel_ratio:new h.aM(v,t.u_device_pixel_ratio),u_units_to_pixels:new h.aQ(v,t.u_units_to_pixels)}),lineGradient:(v,t)=>({u_matrix:new h.aN(v,t.u_matrix),u_ratio:new h.aM(v,t.u_ratio),u_device_pixel_ratio:new h.aM(v,t.u_device_pixel_ratio),u_units_to_pixels:new h.aQ(v,t.u_units_to_pixels),u_image:new h.aL(v,t.u_image),u_image_height:new h.aM(v,t.u_image_height)}),linePattern:(v,t)=>({u_matrix:new h.aN(v,t.u_matrix),u_texsize:new h.aQ(v,t.u_texsize),u_ratio:new h.aM(v,t.u_ratio),u_device_pixel_ratio:new h.aM(v,t.u_device_pixel_ratio),u_image:new h.aL(v,t.u_image),u_units_to_pixels:new h.aQ(v,t.u_units_to_pixels),u_scale:new h.aP(v,t.u_scale),u_fade:new h.aM(v,t.u_fade)}),lineSDF:(v,t)=>({u_matrix:new h.aN(v,t.u_matrix),u_ratio:new h.aM(v,t.u_ratio),u_device_pixel_ratio:new h.aM(v,t.u_device_pixel_ratio),u_units_to_pixels:new h.aQ(v,t.u_units_to_pixels),u_patternscale_a:new h.aQ(v,t.u_patternscale_a),u_patternscale_b:new h.aQ(v,t.u_patternscale_b),u_sdfgamma:new h.aM(v,t.u_sdfgamma),u_image:new h.aL(v,t.u_image),u_tex_y_a:new h.aM(v,t.u_tex_y_a),u_tex_y_b:new h.aM(v,t.u_tex_y_b),u_mix:new h.aM(v,t.u_mix)}),raster:(v,t)=>({u_matrix:new h.aN(v,t.u_matrix),u_tl_parent:new h.aQ(v,t.u_tl_parent),u_scale_parent:new h.aM(v,t.u_scale_parent),u_buffer_scale:new h.aM(v,t.u_buffer_scale),u_fade_t:new h.aM(v,t.u_fade_t),u_opacity:new h.aM(v,t.u_opacity),u_image0:new h.aL(v,t.u_image0),u_image1:new h.aL(v,t.u_image1),u_brightness_low:new h.aM(v,t.u_brightness_low),u_brightness_high:new h.aM(v,t.u_brightness_high),u_saturation_factor:new h.aM(v,t.u_saturation_factor),u_contrast_factor:new h.aM(v,t.u_contrast_factor),u_spin_weights:new h.aP(v,t.u_spin_weights)}),symbolIcon:(v,t)=>({u_is_size_zoom_constant:new h.aL(v,t.u_is_size_zoom_constant),u_is_size_feature_constant:new h.aL(v,t.u_is_size_feature_constant),u_size_t:new h.aM(v,t.u_size_t),u_size:new h.aM(v,t.u_size),u_camera_to_center_distance:new h.aM(v,t.u_camera_to_center_distance),u_pitch:new h.aM(v,t.u_pitch),u_rotate_symbol:new h.aL(v,t.u_rotate_symbol),u_aspect_ratio:new h.aM(v,t.u_aspect_ratio),u_fade_change:new h.aM(v,t.u_fade_change),u_matrix:new h.aN(v,t.u_matrix),u_label_plane_matrix:new h.aN(v,t.u_label_plane_matrix),u_coord_matrix:new h.aN(v,t.u_coord_matrix),u_is_text:new h.aL(v,t.u_is_text),u_pitch_with_map:new h.aL(v,t.u_pitch_with_map),u_texsize:new h.aQ(v,t.u_texsize),u_texture:new h.aL(v,t.u_texture)}),symbolSDF:(v,t)=>({u_is_size_zoom_constant:new h.aL(v,t.u_is_size_zoom_constant),u_is_size_feature_constant:new h.aL(v,t.u_is_size_feature_constant),u_size_t:new h.aM(v,t.u_size_t),u_size:new h.aM(v,t.u_size),u_camera_to_center_distance:new h.aM(v,t.u_camera_to_center_distance),u_pitch:new h.aM(v,t.u_pitch),u_rotate_symbol:new h.aL(v,t.u_rotate_symbol),u_aspect_ratio:new h.aM(v,t.u_aspect_ratio),u_fade_change:new h.aM(v,t.u_fade_change),u_matrix:new h.aN(v,t.u_matrix),u_label_plane_matrix:new h.aN(v,t.u_label_plane_matrix),u_coord_matrix:new h.aN(v,t.u_coord_matrix),u_is_text:new h.aL(v,t.u_is_text),u_pitch_with_map:new h.aL(v,t.u_pitch_with_map),u_texsize:new h.aQ(v,t.u_texsize),u_texture:new h.aL(v,t.u_texture),u_gamma_scale:new h.aM(v,t.u_gamma_scale),u_device_pixel_ratio:new h.aM(v,t.u_device_pixel_ratio),u_is_halo:new h.aL(v,t.u_is_halo)}),symbolTextAndIcon:(v,t)=>({u_is_size_zoom_constant:new h.aL(v,t.u_is_size_zoom_constant),u_is_size_feature_constant:new h.aL(v,t.u_is_size_feature_constant),u_size_t:new h.aM(v,t.u_size_t),u_size:new h.aM(v,t.u_size),u_camera_to_center_distance:new h.aM(v,t.u_camera_to_center_distance),u_pitch:new h.aM(v,t.u_pitch),u_rotate_symbol:new h.aL(v,t.u_rotate_symbol),u_aspect_ratio:new h.aM(v,t.u_aspect_ratio),u_fade_change:new h.aM(v,t.u_fade_change),u_matrix:new h.aN(v,t.u_matrix),u_label_plane_matrix:new h.aN(v,t.u_label_plane_matrix),u_coord_matrix:new h.aN(v,t.u_coord_matrix),u_is_text:new h.aL(v,t.u_is_text),u_pitch_with_map:new h.aL(v,t.u_pitch_with_map),u_texsize:new h.aQ(v,t.u_texsize),u_texsize_icon:new h.aQ(v,t.u_texsize_icon),u_texture:new h.aL(v,t.u_texture),u_texture_icon:new h.aL(v,t.u_texture_icon),u_gamma_scale:new h.aM(v,t.u_gamma_scale),u_device_pixel_ratio:new h.aM(v,t.u_device_pixel_ratio),u_is_halo:new h.aL(v,t.u_is_halo)}),background:(v,t)=>({u_matrix:new h.aN(v,t.u_matrix),u_opacity:new h.aM(v,t.u_opacity),u_color:new h.aR(v,t.u_color)}),backgroundPattern:(v,t)=>({u_matrix:new h.aN(v,t.u_matrix),u_opacity:new h.aM(v,t.u_opacity),u_image:new h.aL(v,t.u_image),u_pattern_tl_a:new h.aQ(v,t.u_pattern_tl_a),u_pattern_br_a:new h.aQ(v,t.u_pattern_br_a),u_pattern_tl_b:new h.aQ(v,t.u_pattern_tl_b),u_pattern_br_b:new h.aQ(v,t.u_pattern_br_b),u_texsize:new h.aQ(v,t.u_texsize),u_mix:new h.aM(v,t.u_mix),u_pattern_size_a:new h.aQ(v,t.u_pattern_size_a),u_pattern_size_b:new h.aQ(v,t.u_pattern_size_b),u_scale_a:new h.aM(v,t.u_scale_a),u_scale_b:new h.aM(v,t.u_scale_b),u_pixel_coord_upper:new h.aQ(v,t.u_pixel_coord_upper),u_pixel_coord_lower:new h.aQ(v,t.u_pixel_coord_lower),u_tile_units_to_pixels:new h.aM(v,t.u_tile_units_to_pixels)}),terrain:(v,t)=>({u_matrix:new h.aN(v,t.u_matrix),u_texture:new h.aL(v,t.u_texture),u_ele_delta:new h.aM(v,t.u_ele_delta)}),terrainDepth:(v,t)=>({u_matrix:new h.aN(v,t.u_matrix),u_ele_delta:new h.aM(v,t.u_ele_delta)}),terrainCoords:(v,t)=>({u_matrix:new h.aN(v,t.u_matrix),u_texture:new h.aL(v,t.u_texture),u_terrain_coords_id:new h.aM(v,t.u_terrain_coords_id),u_ele_delta:new h.aM(v,t.u_ele_delta)})};class uo{constructor(t,a,d){this.context=t;const g=t.gl;this.buffer=g.createBuffer(),this.dynamicDraw=!!d,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const a=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ps={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class co{constructor(t,a,d,g){this.length=a.length,this.attributes=d,this.itemSize=a.bytesPerElement,this.dynamicDraw=g,this.context=t;const b=t.gl;this.buffer=b.createBuffer(),t.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,a){for(let d=0;d<this.attributes.length;d++){const g=a.attributes[this.attributes[d].name];g!==void 0&&t.enableVertexAttribArray(g)}}setVertexAttribPointers(t,a,d){for(let g=0;g<this.attributes.length;g++){const b=this.attributes[g],M=a.attributes[b.name];M!==void 0&&t.vertexAttribPointer(M,b.components,t[Ps[b.type]],!1,this.itemSize,b.offset+this.itemSize*(d||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ds=new WeakMap;function Nn(v){var t;if(Ds.has(v))return Ds.get(v);{const a=(t=v.getParameter(v.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return Ds.set(v,a),a}}class Wt{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Vi extends Wt{getDefault(){return h.aT.transparent}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Ni extends Wt{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class hi extends Wt{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class ho extends Wt{getDefault(){return[!0,!0,!0,!0]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class fo extends Wt{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class os extends Wt{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class _a extends Wt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const a=this.current;(t.func!==a.func||t.ref!==a.ref||t.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class ya extends Wt{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Xo extends Wt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=t,this.dirty=!1}}class Yo extends Wt{getDefault(){return[0,1]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Bs extends Wt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=t,this.dirty=!1}}class hn extends Wt{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class va extends Wt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.BLEND):a.disable(a.BLEND),this.current=t,this.dirty=!1}}class xa extends Wt{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class wn extends Wt{getDefault(){return h.aT.transparent}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class as extends Wt{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class Un extends Wt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=t,this.dirty=!1}}class ll extends Wt{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Al extends Wt{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class ba extends Wt{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class Xl extends Wt{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class wa extends Wt{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class po extends Wt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class ka extends Wt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Ea extends Wt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class zs extends Wt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class ul extends Wt{getDefault(){return null}set(t){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class cl extends Wt{getDefault(){return null}set(t){var a;if(t===this.current&&!this.dirty)return;const d=this.gl;Nn(d)?d.bindVertexArray(t):(a=d.getExtension("OES_vertex_array_object"))===null||a===void 0||a.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class Sa extends Wt{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class ls extends Wt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class hl extends Wt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Yr extends Wt{constructor(t,a){super(t),this.context=t,this.parent=a}getDefault(){return null}}class Ls extends Yr{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class fl extends Yr{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Ta extends Yr{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Xt{constructor(t,a,d,g,b){this.context=t,this.width=a,this.height=d;const M=t.gl,i=this.framebuffer=M.createFramebuffer();if(this.colorAttachment=new Ls(t,i),g)this.depthAttachment=b?new Ta(t,i):new fl(t,i);else if(b)throw new Error("Stencil cannot be setted without depth");if(M.checkFramebufferStatus(M.FRAMEBUFFER)!==M.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const t=this.context.gl,a=this.colorAttachment.get();if(a&&t.deleteTexture(a),this.depthAttachment){const d=this.depthAttachment.get();d&&t.deleteRenderbuffer(d)}t.deleteFramebuffer(this.framebuffer)}}class bi{constructor(t,a,d){this.blendFunction=t,this.blendColor=a,this.mask=d}}bi.Replace=[1,0],bi.disabled=new bi(bi.Replace,h.aT.transparent,[!1,!1,!1,!1]),bi.unblended=new bi(bi.Replace,h.aT.transparent,[!0,!0,!0,!0]),bi.alphaBlended=new bi([1,771],h.aT.transparent,[!0,!0,!0,!0]);class Ia{constructor(t){var a,d;if(this.gl=t,this.clearColor=new Vi(this),this.clearDepth=new Ni(this),this.clearStencil=new hi(this),this.colorMask=new ho(this),this.depthMask=new fo(this),this.stencilMask=new os(this),this.stencilFunc=new _a(this),this.stencilOp=new ya(this),this.stencilTest=new Xo(this),this.depthRange=new Yo(this),this.depthTest=new Bs(this),this.depthFunc=new hn(this),this.blend=new va(this),this.blendFunc=new xa(this),this.blendColor=new wn(this),this.blendEquation=new as(this),this.cullFace=new Un(this),this.cullFaceSide=new ll(this),this.frontFace=new Al(this),this.program=new ba(this),this.activeTexture=new Xl(this),this.viewport=new wa(this),this.bindFramebuffer=new po(this),this.bindRenderbuffer=new ka(this),this.bindTexture=new Ea(this),this.bindVertexBuffer=new zs(this),this.bindElementBuffer=new ul(this),this.bindVertexArray=new cl(this),this.pixelStoreUnpack=new Sa(this),this.pixelStoreUnpackPremultiplyAlpha=new ls(this),this.pixelStoreUnpackFlipY=new hl(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),Nn(t)){this.HALF_FLOAT=t.HALF_FLOAT;const g=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(a=t.RGBA16F)!==null&&a!==void 0?a:g==null?void 0:g.RGBA16F_EXT,this.RGB16F=(d=t.RGB16F)!==null&&d!==void 0?d:g==null?void 0:g.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const g=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=g==null?void 0:g.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,a){return new uo(this,t,a)}createVertexBuffer(t,a,d){return new co(this,t,a,d)}createRenderbuffer(t,a,d){const g=this.gl,b=g.createRenderbuffer();return this.bindRenderbuffer.set(b),g.renderbufferStorage(g.RENDERBUFFER,t,a,d),this.bindRenderbuffer.set(null),b}createFramebuffer(t,a,d,g){return new Xt(this,t,a,d,g)}clear({color:t,depth:a,stencil:d}){const g=this.gl;let b=0;t&&(b|=g.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),a!==void 0&&(b|=g.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),d!==void 0&&(b|=g.STENCIL_BUFFER_BIT,this.clearStencil.set(d),this.stencilMask.set(255)),g.clear(b)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){h.aG(t.blendFunction,bi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return Nn(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var a;return Nn(this.gl)?this.gl.deleteVertexArray(t):(a=this.gl.getExtension("OES_vertex_array_object"))===null||a===void 0?void 0:a.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}class Qt{constructor(t,a,d){this.func=t,this.mask=a,this.range=d}}Qt.ReadOnly=!1,Qt.ReadWrite=!0,Qt.disabled=new Qt(519,Qt.ReadOnly,[0,1]);const Vr=7680;class wi{constructor(t,a,d,g,b,M){this.test=t,this.ref=a,this.mask=d,this.fail=g,this.depthFail=b,this.pass=M}}wi.disabled=new wi({func:519,mask:0},0,0,Vr,Vr,Vr);class fi{constructor(t,a,d){this.enable=t,this.mode=a,this.frontFace=d}}let Rs;function dl(v,t,a,d,g,b,M){const i=v.context,n=i.gl,s=v.useProgram("collisionBox"),l=[];let c=0,f=0;for(let N=0;N<d.length;N++){const Z=d[N],Q=t.getTile(Z),ee=Q.getBucket(a);if(!ee)continue;let he=Z.posMatrix;g[0]===0&&g[1]===0||(he=v.translatePosMatrix(Z.posMatrix,Q,g,b));const ge=M?ee.textCollisionBox:ee.iconCollisionBox,oe=ee.collisionCircleArray;if(oe.length>0){const fe=h.Z(),pe=he;h.aU(fe,ee.placementInvProjMatrix,v.transform.glCoordMatrix),h.aU(fe,fe,ee.placementViewportMatrix),l.push({circleArray:oe,circleOffset:f,transform:pe,invTransform:fe,coord:Z}),c+=oe.length/4,f=c}ge&&s.draw(i,n.LINES,Qt.disabled,wi.disabled,v.colorModeForRenderPass(),fi.disabled,zi(he,v.transform,Q),v.style.map.terrain&&v.style.map.terrain.getTerrainData(Z),a.id,ge.layoutVertexBuffer,ge.indexBuffer,ge.segments,null,v.transform.zoom,null,null,ge.collisionVertexBuffer)}if(!M||!l.length)return;const y=v.useProgram("collisionCircle"),x=new h.aV;x.resize(4*c),x._trim();let S=0;for(const N of l)for(let Z=0;Z<N.circleArray.length/4;Z++){const Q=4*Z,ee=N.circleArray[Q+0],he=N.circleArray[Q+1],ge=N.circleArray[Q+2],oe=N.circleArray[Q+3];x.emplace(S++,ee,he,ge,oe,0),x.emplace(S++,ee,he,ge,oe,1),x.emplace(S++,ee,he,ge,oe,2),x.emplace(S++,ee,he,ge,oe,3)}(!Rs||Rs.length<2*c)&&(Rs=function(N){const Z=2*N,Q=new h.aX;Q.resize(Z),Q._trim();for(let ee=0;ee<Z;ee++){const he=6*ee;Q.uint16[he+0]=4*ee+0,Q.uint16[he+1]=4*ee+1,Q.uint16[he+2]=4*ee+2,Q.uint16[he+3]=4*ee+2,Q.uint16[he+4]=4*ee+3,Q.uint16[he+5]=4*ee+0}return Q}(c));const C=i.createIndexBuffer(Rs,!0),z=i.createVertexBuffer(x,h.aW.members,!0);for(const N of l){const Z={u_matrix:N.transform,u_inv_matrix:N.invTransform,u_camera_to_center_distance:(G=v.transform).cameraToCenterDistance,u_viewport_size:[G.width,G.height]};y.draw(i,n.TRIANGLES,Qt.disabled,wi.disabled,v.colorModeForRenderPass(),fi.disabled,Z,v.style.map.terrain&&v.style.map.terrain.getTerrainData(N.coord),a.id,z,C,h.S.simpleSegment(0,2*N.circleOffset,N.circleArray.length,N.circleArray.length/2),null,v.transform.zoom,null,null,null)}var G;z.destroy(),C.destroy()}fi.disabled=new fi(!1,1029,2305),fi.backCCW=new fi(!0,1029,2305);const Ko=h.ao(new Float32Array(16));function Fs(v,t,a,d,g,b){const{horizontalAlign:M,verticalAlign:i}=h.au(v);return new h.P((-(M-.5)*t/g+d[0])*b,(-(i-.5)*a/g+d[1])*b)}function Os(v,t,a,d,g,b,M,i,n,s,l){const c=v.text.placedSymbolArray,f=v.text.dynamicLayoutVertexArray,y=v.icon.dynamicLayoutVertexArray,x={};f.clear();for(let S=0;S<c.length;S++){const C=c.get(S),z=C.hidden||!C.crossTileID||v.allowVerticalPlacement&&!C.placedOrientation?null:d[C.crossTileID];if(z){const G=new h.P(C.anchorX,C.anchorY),N=Ei(G,a?M:b,l),Z=ns(g.cameraToCenterDistance,N.signedDistanceFromCamera);let Q=h.aj(v.textSizeData,n,C)*Z/h.ap;a&&(Q*=v.tilePixelRatio/i);const{width:ee,height:he,anchor:ge,textOffset:oe,textBoxScale:fe}=z,pe=Fs(ge,ee,he,oe,fe,Q),Fe=a?Ei(G.add(pe),b,l).point:N.point.add(t?pe.rotate(-g.angle):pe),Me=v.allowVerticalPlacement&&C.placedOrientation===h.ai.vertical?Math.PI/2:0;for(let Pe=0;Pe<C.numGlyphs;Pe++)h.ak(f,Fe,Me);s&&C.associatedIconIndex>=0&&(x[C.associatedIconIndex]={shiftedAnchor:Fe,angle:Me})}else te(C.numGlyphs,f)}if(s){y.clear();const S=v.icon.placedSymbolArray;for(let C=0;C<S.length;C++){const z=S.get(C);if(z.hidden)te(z.numGlyphs,y);else{const G=x[C];if(G)for(let N=0;N<z.numGlyphs;N++)h.ak(y,G.shiftedAnchor,G.angle);else te(z.numGlyphs,y)}}v.icon.dynamicLayoutVertexBuffer.updateData(y)}v.text.dynamicLayoutVertexBuffer.updateData(f)}function Vs(v,t,a){return a.iconsInText&&t?"symbolTextAndIcon":v?"symbolSDF":"symbolIcon"}function ai(v,t,a,d,g,b,M,i,n,s,l,c){const f=v.context,y=f.gl,x=v.transform,S=i==="map",C=n==="map",z=i!=="viewport"&&a.layout.get("symbol-placement")!=="point",G=S&&!C&&!z,N=!a.layout.get("symbol-sort-key").isConstant();let Z=!1;const Q=v.depthModeForSublayer(0,Qt.ReadOnly),ee=a._unevaluatedLayout.hasValue("text-variable-anchor")||a._unevaluatedLayout.hasValue("text-variable-anchor-offset"),he=[];for(const ge of d){const oe=t.getTile(ge),fe=oe.getBucket(a);if(!fe)continue;const pe=g?fe.text:fe.icon;if(!pe||!pe.segments.get().length||!pe.hasVisibleVertices)continue;const Fe=pe.programConfigurations.get(a.id),Me=g||fe.sdfIcons,Pe=g?fe.textSizeData:fe.iconSizeData,Ce=C||x.pitch!==0,vt=v.useProgram(Vs(Me,g,fe),Fe),at=h.ah(Pe,x.zoom),rt=v.style.map.terrain&&v.style.map.terrain.getTerrainData(ge);let et,ft,ut,Rt,dt=[0,0],Pt=null;if(g)ft=oe.glyphAtlasTexture,ut=y.LINEAR,et=oe.glyphAtlasTexture.size,fe.iconsInText&&(dt=oe.imageAtlasTexture.size,Pt=oe.imageAtlasTexture,Rt=Ce||v.options.rotating||v.options.zooming||Pe.kind==="composite"||Pe.kind==="camera"?y.LINEAR:y.NEAREST);else{const Li=a.layout.get("icon-size").constantOr(0)!==1||fe.iconsNeedLinear;ft=oe.imageAtlasTexture,ut=Me||v.options.rotating||v.options.zooming||Li||Ce?y.LINEAR:y.NEAREST,et=oe.imageAtlasTexture.size}const di=ve(oe,1,v.transform.zoom),pi=qe(ge.posMatrix,C,S,v.transform,di),Zn=An(ge.posMatrix,C,S,v.transform,di),Qn=ee&&fe.hasTextData(),Hs=a.layout.get("icon-text-fit")!=="none"&&Qn&&fe.hasIconData();if(z){const Li=v.style.map.terrain?(Ur,Ri)=>v.style.map.terrain.getElevation(ge,Ur,Ri):null,Ki=a.layout.get("text-rotation-alignment")==="map";$e(fe,ge.posMatrix,v,g,pi,Zn,C,s,Ki,Li)}const To=v.translatePosMatrix(ge.posMatrix,oe,b,M),la=z||g&&ee||Hs?Ko:pi,vr=v.translatePosMatrix(Zn,oe,b,M,!0),hr=Me&&a.paint.get(g?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Ir;Ir=Me?fe.iconsInText?bn(Pe.kind,at,G,C,v,To,la,vr,et,dt):Ho(Pe.kind,at,G,C,v,To,la,vr,g,et,!0):ga(Pe.kind,at,G,C,v,To,la,vr,g,et);const Io={program:vt,buffers:pe,uniformValues:Ir,atlasTexture:ft,atlasTextureIcon:Pt,atlasInterpolation:ut,atlasInterpolationIcon:Rt,isSDF:Me,hasHalo:hr};if(N&&fe.canOverlap){Z=!0;const Li=pe.segments.get();for(const Ki of Li)he.push({segments:new h.S([Ki]),sortKey:Ki.sortKey,state:Io,terrainData:rt})}else he.push({segments:pe.segments,sortKey:0,state:Io,terrainData:rt})}Z&&he.sort((ge,oe)=>ge.sortKey-oe.sortKey);for(const ge of he){const oe=ge.state;if(f.activeTexture.set(y.TEXTURE0),oe.atlasTexture.bind(oe.atlasInterpolation,y.CLAMP_TO_EDGE),oe.atlasTextureIcon&&(f.activeTexture.set(y.TEXTURE1),oe.atlasTextureIcon&&oe.atlasTextureIcon.bind(oe.atlasInterpolationIcon,y.CLAMP_TO_EDGE)),oe.isSDF){const fe=oe.uniformValues;oe.hasHalo&&(fe.u_is_halo=1,Ma(oe.buffers,ge.segments,a,v,oe.program,Q,l,c,fe,ge.terrainData)),fe.u_is_halo=0}Ma(oe.buffers,ge.segments,a,v,oe.program,Q,l,c,oe.uniformValues,ge.terrainData)}}function Ma(v,t,a,d,g,b,M,i,n,s){const l=d.context;g.draw(l,l.gl.TRIANGLES,b,M,i,fi.disabled,n,s,a.id,v.layoutVertexBuffer,v.indexBuffer,t,a.paint,d.transform.zoom,v.programConfigurations.get(a.id),v.dynamicLayoutVertexBuffer,v.opacityVertexBuffer)}function mo(v,t,a,d,g){if(!a||!d||!d.imageAtlas)return;const b=d.imageAtlas.patternPositions;let M=b[a.to.toString()],i=b[a.from.toString()];if(!M&&i&&(M=i),!i&&M&&(i=M),!M||!i){const n=g.getPaintProperty(t);M=b[n],i=b[n]}M&&i&&v.setConstantPatternPositions(M,i)}function go(v,t,a,d,g,b,M){const i=v.context.gl,n="fill-pattern",s=a.paint.get(n),l=s&&s.constantOr(1),c=a.getCrossfadeParameters();let f,y,x,S,C;M?(y=l&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",f=i.LINES):(y=l?"fillPattern":"fill",f=i.TRIANGLES);const z=s.constantOr(null);for(const G of d){const N=t.getTile(G);if(l&&!N.patternsLoaded())continue;const Z=N.getBucket(a);if(!Z)continue;const Q=Z.programConfigurations.get(a.id),ee=v.useProgram(y,Q),he=v.style.map.terrain&&v.style.map.terrain.getTerrainData(G);l&&(v.context.activeTexture.set(i.TEXTURE0),N.imageAtlasTexture.bind(i.LINEAR,i.CLAMP_TO_EDGE),Q.updatePaintBuffers(c)),mo(Q,n,z,N,a);const ge=he?G:null,oe=v.translatePosMatrix(ge?ge.posMatrix:G.posMatrix,N,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor"));if(M){S=Z.indexBuffer2,C=Z.segments2;const fe=[i.drawingBufferWidth,i.drawingBufferHeight];x=y==="fillOutlinePattern"&&l?lo(oe,v,c,N,fe):ao(oe,fe)}else S=Z.indexBuffer,C=Z.segments,x=l?Zo(oe,v,c,N):rl(oe);ee.draw(v.context,f,g,v.stencilModeForClipping(G),b,fi.disabled,x,he,a.id,Z.layoutVertexBuffer,S,C,a.paint,v.transform.zoom,Q)}}function _o(v,t,a,d,g,b,M){const i=v.context,n=i.gl,s="fill-extrusion-pattern",l=a.paint.get(s),c=l.constantOr(1),f=a.getCrossfadeParameters(),y=a.paint.get("fill-extrusion-opacity"),x=l.constantOr(null);for(const S of d){const C=t.getTile(S),z=C.getBucket(a);if(!z)continue;const G=v.style.map.terrain&&v.style.map.terrain.getTerrainData(S),N=z.programConfigurations.get(a.id),Z=v.useProgram(c?"fillExtrusionPattern":"fillExtrusion",N);c&&(v.context.activeTexture.set(n.TEXTURE0),C.imageAtlasTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE),N.updatePaintBuffers(f)),mo(N,s,x,C,a);const Q=v.translatePosMatrix(S.posMatrix,C,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),ee=a.paint.get("fill-extrusion-vertical-gradient"),he=c?Vn(Q,v,ee,y,S,f,C):pa(Q,v,ee,y);Z.draw(i,i.gl.TRIANGLES,g,b,M,fi.backCCW,he,G,a.id,z.layoutVertexBuffer,z.indexBuffer,z.segments,a.paint,v.transform.zoom,N,v.style.map.terrain&&z.centroidVertexBuffer)}}function Yl(v,t,a,d,g,b,M){const i=v.context,n=i.gl,s=a.fbo;if(!s)return;const l=v.useProgram("hillshade"),c=v.style.map.terrain&&v.style.map.terrain.getTerrainData(t);i.activeTexture.set(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,s.colorAttachment.get()),l.draw(i,n.TRIANGLES,g,b,M,fi.disabled,((f,y,x,S)=>{const C=x.paint.get("hillshade-shadow-color"),z=x.paint.get("hillshade-highlight-color"),G=x.paint.get("hillshade-accent-color");let N=x.paint.get("hillshade-illumination-direction")*(Math.PI/180);x.paint.get("hillshade-illumination-anchor")==="viewport"&&(N-=f.transform.angle);const Z=!f.options.moving;return{u_matrix:S?S.posMatrix:f.transform.calculatePosMatrix(y.tileID.toUnwrapped(),Z),u_image:0,u_latrange:Qo(0,y.tileID),u_light:[x.paint.get("hillshade-exaggeration"),N],u_shadow:C,u_highlight:z,u_accent:G}})(v,a,d,c?t:null),c,d.id,v.rasterBoundsBuffer,v.quadTriangleIndexBuffer,v.rasterBoundsSegments)}function Ca(v,t,a,d,g,b){const M=v.context,i=M.gl,n=t.dem;if(n&&n.data){const s=n.dim,l=n.stride,c=n.getPixels();if(M.activeTexture.set(i.TEXTURE1),M.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||v.getTileTexture(l),t.demTexture){const y=t.demTexture;y.update(c,{premultiply:!1}),y.bind(i.NEAREST,i.CLAMP_TO_EDGE)}else t.demTexture=new Lt(M,c,i.RGBA,{premultiply:!1}),t.demTexture.bind(i.NEAREST,i.CLAMP_TO_EDGE);M.activeTexture.set(i.TEXTURE0);let f=t.fbo;if(!f){const y=new Lt(M,{width:s,height:s,data:null},i.RGBA);y.bind(i.LINEAR,i.CLAMP_TO_EDGE),f=t.fbo=M.createFramebuffer(s,s,!0,!1),f.colorAttachment.set(y.texture)}M.bindFramebuffer.set(f.framebuffer),M.viewport.set([0,0,s,s]),v.useProgram("hillshadePrepare").draw(M,i.TRIANGLES,d,g,b,fi.disabled,((y,x)=>{const S=x.stride,C=h.Z();return h.aS(C,0,h.N,-h.N,0,0,1),h.$(C,C,[0,-h.N,0]),{u_matrix:C,u_image:1,u_dimension:[S,S],u_zoom:y.overscaledZ,u_unpack:x.getUnpackVector()}})(t.tileID,n),null,a.id,v.rasterBoundsBuffer,v.quadTriangleIndexBuffer,v.rasterBoundsSegments),t.needsHillshadePrepare=!1}}function Kl(v,t,a,d,g,b){const M=d.paint.get("raster-fade-duration");if(!b&&M>0){const i=h.h.now(),n=(i-v.timeAdded)/M,s=t?(i-t.timeAdded)/M:-1,l=a.getSource(),c=g.coveringZoomLevel({tileSize:l.tileSize,roundZoom:l.roundZoom}),f=!t||Math.abs(t.tileID.overscaledZ-c)>Math.abs(v.tileID.overscaledZ-c),y=f&&v.refreshedUponExpiration?1:h.ad(f?n:1-s,0,1);return v.refreshedUponExpiration&&n>=1&&(v.refreshedUponExpiration=!1),t?{opacity:1,mix:1-y}:{opacity:y,mix:0}}return{opacity:1,mix:0}}const ur=new h.aT(1,0,0,1),Ns=new h.aT(0,1,0,1),kn=new h.aT(0,0,1,1),pl=new h.aT(1,0,1,1),Jo=new h.aT(0,1,1,1);function yo(v,t,a,d){vo(v,0,t+a/2,v.transform.width,a,d)}function cr(v,t,a,d){vo(v,t-a/2,0,a,v.transform.height,d)}function vo(v,t,a,d,g,b){const M=v.context,i=M.gl;i.enable(i.SCISSOR_TEST),i.scissor(t*v.pixelRatio,a*v.pixelRatio,d*v.pixelRatio,g*v.pixelRatio),M.clear({color:b}),i.disable(i.SCISSOR_TEST)}function ea(v,t,a){const d=v.context,g=d.gl,b=a.posMatrix,M=v.useProgram("debug"),i=Qt.disabled,n=wi.disabled,s=v.colorModeForRenderPass(),l="$debug",c=v.style.map.terrain&&v.style.map.terrain.getTerrainData(a);d.activeTexture.set(g.TEXTURE0);const f=t.getTileByID(a.key).latestRawTileData,y=Math.floor((f&&f.byteLength||0)/1024),x=t.getTile(a).tileSize,S=512/Math.min(x,512)*(a.overscaledZ/v.transform.zoom)*.5;let C=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(C+=` => ${a.overscaledZ}`),function(z,G){z.initDebugOverlayCanvas();const N=z.debugOverlayCanvas,Z=z.context.gl,Q=z.debugOverlayCanvas.getContext("2d");Q.clearRect(0,0,N.width,N.height),Q.shadowColor="white",Q.shadowBlur=2,Q.lineWidth=1.5,Q.strokeStyle="white",Q.textBaseline="top",Q.font="bold 36px Open Sans, sans-serif",Q.fillText(G,5,5),Q.strokeText(G,5,5),z.debugOverlayTexture.update(N),z.debugOverlayTexture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE)}(v,`${C} ${y}kB`),M.draw(d,g.TRIANGLES,i,n,bi.alphaBlended,fi.disabled,ss(b,h.aT.transparent,S),null,l,v.debugBuffer,v.quadTriangleIndexBuffer,v.debugSegments),M.draw(d,g.LINE_STRIP,i,n,s,fi.disabled,ss(b,h.aT.red),c,l,v.debugBuffer,v.tileBorderIndexBuffer,v.debugSegments)}function Ai(v,t,a){const d=v.context,g=d.gl,b=v.colorModeForRenderPass(),M=new Qt(g.LEQUAL,Qt.ReadWrite,v.depthRangeFor3D),i=v.useProgram("terrain"),n=t.getTerrainMesh();d.bindFramebuffer.set(null),d.viewport.set([0,0,v.width,v.height]);for(const s of a){const l=v.renderToTexture.getTexture(s),c=t.getTerrainData(s.tileID);d.activeTexture.set(g.TEXTURE0),g.bindTexture(g.TEXTURE_2D,l.texture);const f={u_matrix:v.transform.calculatePosMatrix(s.tileID.toUnwrapped()),u_texture:0,u_ele_delta:t.getMeshFrameDelta(v.transform.zoom)};i.draw(d,g.TRIANGLES,M,wi.disabled,b,fi.backCCW,f,c,"terrain",n.vertexBuffer,n.indexBuffer,n.segments)}}class Kr{constructor(t,a){this.context=new Ia(t),this.transform=a,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:h.Z(),renderTime:0},this.setup(),this.numSublayers=Mi.maxUnderzooming+Mi.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Go}resize(t,a,d){if(this.width=Math.floor(t*d),this.height=Math.floor(a*d),this.pixelRatio=d,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const g of this.style._order)this.style._layers[g].resize()}setup(){const t=this.context,a=new h.a_;a.emplaceBack(0,0),a.emplaceBack(h.N,0),a.emplaceBack(0,h.N),a.emplaceBack(h.N,h.N),this.tileExtentBuffer=t.createVertexBuffer(a,jo.members),this.tileExtentSegments=h.S.simpleSegment(0,0,4,2);const d=new h.a_;d.emplaceBack(0,0),d.emplaceBack(h.N,0),d.emplaceBack(0,h.N),d.emplaceBack(h.N,h.N),this.debugBuffer=t.createVertexBuffer(d,jo.members),this.debugSegments=h.S.simpleSegment(0,0,4,5);const g=new h.V;g.emplaceBack(0,0,0,0),g.emplaceBack(h.N,0,h.N,0),g.emplaceBack(0,h.N,0,h.N),g.emplaceBack(h.N,h.N,h.N,h.N),this.rasterBoundsBuffer=t.createVertexBuffer(g,ni.members),this.rasterBoundsSegments=h.S.simpleSegment(0,0,4,2);const b=new h.a_;b.emplaceBack(0,0),b.emplaceBack(1,0),b.emplaceBack(0,1),b.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(b,jo.members),this.viewportSegments=h.S.simpleSegment(0,0,4,2);const M=new h.a$;M.emplaceBack(0),M.emplaceBack(1),M.emplaceBack(3),M.emplaceBack(2),M.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(M);const i=new h.b0;i.emplaceBack(0,1,2),i.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(i);const n=this.context.gl;this.stencilClearMode=new wi({func:n.ALWAYS,mask:0},0,255,n.ZERO,n.ZERO,n.ZERO)}clearStencil(){const t=this.context,a=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const d=h.Z();h.aS(d,0,this.width,this.height,0,0,1),h.a0(d,d,[a.drawingBufferWidth,a.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,a.TRIANGLES,Qt.disabled,this.stencilClearMode,bi.disabled,fi.disabled,nl(d),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,a){if(this.currentStencilSource===t.source||!t.isTileClipped()||!a||!a.length)return;this.currentStencilSource=t.source;const d=this.context,g=d.gl;this.nextStencilID+a.length>256&&this.clearStencil(),d.setColorMode(bi.disabled),d.setDepthMode(Qt.disabled);const b=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const M of a){const i=this._tileClippingMaskIDs[M.key]=this.nextStencilID++,n=this.style.map.terrain&&this.style.map.terrain.getTerrainData(M);b.draw(d,g.TRIANGLES,Qt.disabled,new wi({func:g.ALWAYS,mask:0},i,255,g.KEEP,g.KEEP,g.REPLACE),bi.disabled,fi.disabled,nl(M.posMatrix),n,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,a=this.context.gl;return new wi({func:a.NOTEQUAL,mask:255},t,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(t){const a=this.context.gl;return new wi({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,a.KEEP,a.KEEP,a.REPLACE)}stencilConfigForOverlap(t){const a=this.context.gl,d=t.sort((M,i)=>i.overscaledZ-M.overscaledZ),g=d[d.length-1].overscaledZ,b=d[0].overscaledZ-g+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const M={};for(let i=0;i<b;i++)M[i+g]=new wi({func:a.GEQUAL,mask:255},i+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=b,[M,d]}return[{[g]:wi.disabled},d]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new bi([t.CONSTANT_COLOR,t.ONE],new h.aT(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?bi.unblended:bi.alphaBlended}depthModeForSublayer(t,a,d){if(!this.opaquePassEnabledForLayer())return Qt.disabled;const g=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Qt(d||this.context.gl.LEQUAL,a,[g,g])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,a){this.style=t,this.options=a,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(h.h.now()),this.imageManager.beginFrame();const d=this.style._order,g=this.style.sourceCaches,b={},M={},i={};for(const n in g){const s=g[n];s.used&&s.prepare(this.context),b[n]=s.getVisibleCoordinates(),M[n]=b[n].slice().reverse(),i[n]=s.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let n=0;n<d.length;n++)if(this.style._layers[d[n]].is3D()){this.opaquePassCutoff=n;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;const n=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!h.b1(this.terrainFacilitator.matrix,this.transform.projMatrix)||n.length)&&(h.b2(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(s,l){const c=s.context,f=c.gl,y=bi.unblended,x=new Qt(f.LEQUAL,Qt.ReadWrite,[0,1]),S=l.getTerrainMesh(),C=l.sourceCache.getRenderableTiles(),z=s.useProgram("terrainDepth");c.bindFramebuffer.set(l.getFramebuffer("depth").framebuffer),c.viewport.set([0,0,s.width/devicePixelRatio,s.height/devicePixelRatio]),c.clear({color:h.aT.transparent,depth:1});for(const G of C){const N=l.getTerrainData(G.tileID),Z={u_matrix:s.transform.calculatePosMatrix(G.tileID.toUnwrapped()),u_ele_delta:l.getMeshFrameDelta(s.transform.zoom)};z.draw(c,f.TRIANGLES,x,wi.disabled,y,fi.backCCW,Z,N,"terrain",S.vertexBuffer,S.indexBuffer,S.segments)}c.bindFramebuffer.set(null),c.viewport.set([0,0,s.width,s.height])}(this,this.style.map.terrain),function(s,l){const c=s.context,f=c.gl,y=bi.unblended,x=new Qt(f.LEQUAL,Qt.ReadWrite,[0,1]),S=l.getTerrainMesh(),C=l.getCoordsTexture(),z=l.sourceCache.getRenderableTiles(),G=s.useProgram("terrainCoords");c.bindFramebuffer.set(l.getFramebuffer("coords").framebuffer),c.viewport.set([0,0,s.width/devicePixelRatio,s.height/devicePixelRatio]),c.clear({color:h.aT.transparent,depth:1}),l.coordsIndex=[];for(const N of z){const Z=l.getTerrainData(N.tileID);c.activeTexture.set(f.TEXTURE0),f.bindTexture(f.TEXTURE_2D,C.texture);const Q={u_matrix:s.transform.calculatePosMatrix(N.tileID.toUnwrapped()),u_terrain_coords_id:(255-l.coordsIndex.length)/255,u_texture:0,u_ele_delta:l.getMeshFrameDelta(s.transform.zoom)};G.draw(c,f.TRIANGLES,x,wi.disabled,y,fi.backCCW,Q,Z,"terrain",S.vertexBuffer,S.indexBuffer,S.segments),l.coordsIndex.push(N.tileID.key)}c.bindFramebuffer.set(null),c.viewport.set([0,0,s.width,s.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(const n of d){const s=this.style._layers[n];if(!s.hasOffscreenPass()||s.isHidden(this.transform.zoom))continue;const l=M[s.source];(s.type==="custom"||l.length)&&this.renderLayer(this,g[s.source],s,l)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:a.showOverdrawInspector?h.aT.black:h.aT.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=a.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=d.length-1;this.currentLayer>=0;this.currentLayer--){const n=this.style._layers[d[this.currentLayer]],s=g[n.source],l=b[n.source];this._renderTileClippingMasks(n,l),this.renderLayer(this,s,n,l)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<d.length;this.currentLayer++){const n=this.style._layers[d[this.currentLayer]],s=g[n.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(n))continue;const l=(n.type==="symbol"?i:M)[n.source];this._renderTileClippingMasks(n,b[n.source]),this.renderLayer(this,s,n,l)}if(this.options.showTileBoundaries){const n=function(s,l){let c=null;const f=Object.values(s._layers).flatMap(C=>C.source&&!C.isHidden(l)?[s.sourceCaches[C.source]]:[]),y=f.filter(C=>C.getSource().type==="vector"),x=f.filter(C=>C.getSource().type!=="vector"),S=C=>{(!c||c.getSource().maxzoom<C.getSource().maxzoom)&&(c=C)};return y.forEach(C=>S(C)),c||x.forEach(C=>S(C)),c}(this.style,this.transform.zoom);n&&function(s,l,c){for(let f=0;f<c.length;f++)ea(s,l,c[f])}(this,n,n.getVisibleCoordinates())}this.options.showPadding&&function(n){const s=n.transform.padding;yo(n,n.transform.height-(s.top||0),3,ur),yo(n,s.bottom||0,3,Ns),cr(n,s.left||0,3,kn),cr(n,n.transform.width-(s.right||0),3,pl);const l=n.transform.centerPoint;(function(c,f,y,x){vo(c,f-1,y-10,2,20,x),vo(c,f-10,y-1,20,2,x)})(n,l.x,n.transform.height-l.y,Jo)}(this),this.context.setDefault()}renderLayer(t,a,d,g){if(!d.isHidden(this.transform.zoom)&&(d.type==="background"||d.type==="custom"||(g||[]).length))switch(this.id=d.id,d.type){case"symbol":(function(b,M,i,n,s){if(b.renderPass!=="translucent")return;const l=wi.disabled,c=b.colorModeForRenderPass();(i._unevaluatedLayout.hasValue("text-variable-anchor")||i._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(f,y,x,S,C,z,G){const N=y.transform,Z=C==="map",Q=z==="map";for(const ee of f){const he=S.getTile(ee),ge=he.getBucket(x);if(!ge||!ge.text||!ge.text.segments.get().length)continue;const oe=h.ah(ge.textSizeData,N.zoom),fe=ve(he,1,y.transform.zoom),pe=qe(ee.posMatrix,Q,Z,y.transform,fe),Fe=x.layout.get("icon-text-fit")!=="none"&&ge.hasIconData();if(oe){const Me=Math.pow(2,N.zoom-he.tileID.overscaledZ);Os(ge,Z,Q,G,N,pe,ee.posMatrix,Me,oe,Fe,y.style.map.terrain?(Pe,Ce)=>y.style.map.terrain.getElevation(ee,Pe,Ce):null)}}}(n,b,i,M,i.layout.get("text-rotation-alignment"),i.layout.get("text-pitch-alignment"),s),i.paint.get("icon-opacity").constantOr(1)!==0&&ai(b,M,i,n,!1,i.paint.get("icon-translate"),i.paint.get("icon-translate-anchor"),i.layout.get("icon-rotation-alignment"),i.layout.get("icon-pitch-alignment"),i.layout.get("icon-keep-upright"),l,c),i.paint.get("text-opacity").constantOr(1)!==0&&ai(b,M,i,n,!0,i.paint.get("text-translate"),i.paint.get("text-translate-anchor"),i.layout.get("text-rotation-alignment"),i.layout.get("text-pitch-alignment"),i.layout.get("text-keep-upright"),l,c),M.map.showCollisionBoxes&&(dl(b,M,i,n,i.paint.get("text-translate"),i.paint.get("text-translate-anchor"),!0),dl(b,M,i,n,i.paint.get("icon-translate"),i.paint.get("icon-translate-anchor"),!1))})(t,a,d,g,this.style.placement.variableOffsets);break;case"circle":(function(b,M,i,n){if(b.renderPass!=="translucent")return;const s=i.paint.get("circle-opacity"),l=i.paint.get("circle-stroke-width"),c=i.paint.get("circle-stroke-opacity"),f=!i.layout.get("circle-sort-key").isConstant();if(s.constantOr(1)===0&&(l.constantOr(1)===0||c.constantOr(1)===0))return;const y=b.context,x=y.gl,S=b.depthModeForSublayer(0,Qt.ReadOnly),C=wi.disabled,z=b.colorModeForRenderPass(),G=[];for(let N=0;N<n.length;N++){const Z=n[N],Q=M.getTile(Z),ee=Q.getBucket(i);if(!ee)continue;const he=ee.programConfigurations.get(i.id),ge=b.useProgram("circle",he),oe=ee.layoutVertexBuffer,fe=ee.indexBuffer,pe=b.style.map.terrain&&b.style.map.terrain.getTerrainData(Z),Fe={programConfiguration:he,program:ge,layoutVertexBuffer:oe,indexBuffer:fe,uniformValues:sr(b,Z,Q,i),terrainData:pe};if(f){const Me=ee.segments.get();for(const Pe of Me)G.push({segments:new h.S([Pe]),sortKey:Pe.sortKey,state:Fe})}else G.push({segments:ee.segments,sortKey:0,state:Fe})}f&&G.sort((N,Z)=>N.sortKey-Z.sortKey);for(const N of G){const{programConfiguration:Z,program:Q,layoutVertexBuffer:ee,indexBuffer:he,uniformValues:ge,terrainData:oe}=N.state;Q.draw(y,x.TRIANGLES,S,C,z,fi.disabled,ge,oe,i.id,ee,he,N.segments,i.paint,b.transform.zoom,Z)}})(t,a,d,g);break;case"heatmap":(function(b,M,i,n){if(i.paint.get("heatmap-opacity")!==0)if(b.renderPass==="offscreen"){const s=b.context,l=s.gl,c=wi.disabled,f=new bi([l.ONE,l.ONE],h.aT.transparent,[!0,!0,!0,!0]);(function(y,x,S){const C=y.gl;y.activeTexture.set(C.TEXTURE1),y.viewport.set([0,0,x.width/4,x.height/4]);let z=S.heatmapFbo;if(z)C.bindTexture(C.TEXTURE_2D,z.colorAttachment.get()),y.bindFramebuffer.set(z.framebuffer);else{const G=C.createTexture();C.bindTexture(C.TEXTURE_2D,G),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_WRAP_S,C.CLAMP_TO_EDGE),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_WRAP_T,C.CLAMP_TO_EDGE),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_MIN_FILTER,C.LINEAR),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_MAG_FILTER,C.LINEAR),z=S.heatmapFbo=y.createFramebuffer(x.width/4,x.height/4,!1,!1),function(N,Z,Q,ee){var he,ge;const oe=N.gl,fe=(he=N.HALF_FLOAT)!==null&&he!==void 0?he:oe.UNSIGNED_BYTE,pe=(ge=N.RGBA16F)!==null&&ge!==void 0?ge:oe.RGBA;oe.texImage2D(oe.TEXTURE_2D,0,pe,Z.width/4,Z.height/4,0,oe.RGBA,fe,null),ee.colorAttachment.set(Q)}(y,x,G,z)}})(s,b,i),s.clear({color:h.aT.transparent});for(let y=0;y<n.length;y++){const x=n[y];if(M.hasRenderableParent(x))continue;const S=M.getTile(x),C=S.getBucket(i);if(!C)continue;const z=C.programConfigurations.get(i.id),G=b.useProgram("heatmap",z),{zoom:N}=b.transform;G.draw(s,l.TRIANGLES,Qt.disabled,c,f,fi.disabled,Hl(x.posMatrix,S,N,i.paint.get("heatmap-intensity")),null,i.id,C.layoutVertexBuffer,C.indexBuffer,C.segments,i.paint,b.transform.zoom,z)}s.viewport.set([0,0,b.width,b.height])}else b.renderPass==="translucent"&&(b.context.setColorMode(b.colorModeForRenderPass()),function(s,l){const c=s.context,f=c.gl,y=l.heatmapFbo;if(!y)return;c.activeTexture.set(f.TEXTURE0),f.bindTexture(f.TEXTURE_2D,y.colorAttachment.get()),c.activeTexture.set(f.TEXTURE1);let x=l.colorRampTexture;x||(x=l.colorRampTexture=new Lt(c,l.colorRamp,f.RGBA)),x.bind(f.LINEAR,f.CLAMP_TO_EDGE),s.useProgram("heatmapTexture").draw(c,f.TRIANGLES,Qt.disabled,wi.disabled,s.colorModeForRenderPass(),fi.disabled,((S,C,z,G)=>{const N=h.Z();h.aS(N,0,S.width,S.height,0,0,1);const Z=S.context.gl;return{u_matrix:N,u_world:[Z.drawingBufferWidth,Z.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:C.paint.get("heatmap-opacity")}})(s,l),null,l.id,s.viewportBuffer,s.quadTriangleIndexBuffer,s.viewportSegments,l.paint,s.transform.zoom)}(b,i))})(t,a,d,g);break;case"line":(function(b,M,i,n){if(b.renderPass!=="translucent")return;const s=i.paint.get("line-opacity"),l=i.paint.get("line-width");if(s.constantOr(1)===0||l.constantOr(1)===0)return;const c=b.depthModeForSublayer(0,Qt.ReadOnly),f=b.colorModeForRenderPass(),y=i.paint.get("line-dasharray"),x=i.paint.get("line-pattern"),S=x.constantOr(1),C=i.paint.get("line-gradient"),z=i.getCrossfadeParameters(),G=S?"linePattern":y?"lineSDF":C?"lineGradient":"line",N=b.context,Z=N.gl;let Q=!0;for(const ee of n){const he=M.getTile(ee);if(S&&!he.patternsLoaded())continue;const ge=he.getBucket(i);if(!ge)continue;const oe=ge.programConfigurations.get(i.id),fe=b.context.program.get(),pe=b.useProgram(G,oe),Fe=Q||pe.program!==fe,Me=b.style.map.terrain&&b.style.map.terrain.getTerrainData(ee),Pe=x.constantOr(null);if(Pe&&he.imageAtlas){const at=he.imageAtlas,rt=at.patternPositions[Pe.to.toString()],et=at.patternPositions[Pe.from.toString()];rt&&et&&oe.setConstantPatternPositions(rt,et)}const Ce=Me?ee:null,vt=S?Wl(b,he,i,z,Ce):y?ci(b,he,i,y,z,Ce):C?sl(b,he,i,ge.lineClipsArray.length,Ce):ma(b,he,i,Ce);if(S)N.activeTexture.set(Z.TEXTURE0),he.imageAtlasTexture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE),oe.updatePaintBuffers(z);else if(y&&(Fe||b.lineAtlas.dirty))N.activeTexture.set(Z.TEXTURE0),b.lineAtlas.bind(N);else if(C){const at=ge.gradients[i.id];let rt=at.texture;if(i.gradientVersion!==at.version){let et=256;if(i.stepInterpolant){const ft=M.getSource().maxzoom,ut=ee.canonical.z===ft?Math.ceil(1<<b.transform.maxZoom-ee.canonical.z):1;et=h.ad(h.aY(ge.maxLineLength/h.N*1024*ut),256,N.maxTextureSize)}at.gradient=h.aZ({expression:i.gradientExpression(),evaluationKey:"lineProgress",resolution:et,image:at.gradient||void 0,clips:ge.lineClipsArray}),at.texture?at.texture.update(at.gradient):at.texture=new Lt(N,at.gradient,Z.RGBA),at.version=i.gradientVersion,rt=at.texture}N.activeTexture.set(Z.TEXTURE0),rt.bind(i.stepInterpolant?Z.NEAREST:Z.LINEAR,Z.CLAMP_TO_EDGE)}pe.draw(N,Z.TRIANGLES,c,b.stencilModeForClipping(ee),f,fi.disabled,vt,Me,i.id,ge.layoutVertexBuffer,ge.indexBuffer,ge.segments,i.paint,b.transform.zoom,oe,ge.layoutVertexBuffer2),Q=!1}})(t,a,d,g);break;case"fill":(function(b,M,i,n){const s=i.paint.get("fill-color"),l=i.paint.get("fill-opacity");if(l.constantOr(1)===0)return;const c=b.colorModeForRenderPass(),f=i.paint.get("fill-pattern"),y=b.opaquePassEnabledForLayer()&&!f.constantOr(1)&&s.constantOr(h.aT.transparent).a===1&&l.constantOr(0)===1?"opaque":"translucent";if(b.renderPass===y){const x=b.depthModeForSublayer(1,b.renderPass==="opaque"?Qt.ReadWrite:Qt.ReadOnly);go(b,M,i,n,x,c,!1)}if(b.renderPass==="translucent"&&i.paint.get("fill-antialias")){const x=b.depthModeForSublayer(i.getPaintProperty("fill-outline-color")?2:0,Qt.ReadOnly);go(b,M,i,n,x,c,!0)}})(t,a,d,g);break;case"fill-extrusion":(function(b,M,i,n){const s=i.paint.get("fill-extrusion-opacity");if(s!==0&&b.renderPass==="translucent"){const l=new Qt(b.context.gl.LEQUAL,Qt.ReadWrite,b.depthRangeFor3D);if(s!==1||i.paint.get("fill-extrusion-pattern").constantOr(1))_o(b,M,i,n,l,wi.disabled,bi.disabled),_o(b,M,i,n,l,b.stencilModeFor3D(),b.colorModeForRenderPass());else{const c=b.colorModeForRenderPass();_o(b,M,i,n,l,wi.disabled,c)}}})(t,a,d,g);break;case"hillshade":(function(b,M,i,n){if(b.renderPass!=="offscreen"&&b.renderPass!=="translucent")return;const s=b.context,l=b.depthModeForSublayer(0,Qt.ReadOnly),c=b.colorModeForRenderPass(),[f,y]=b.renderPass==="translucent"?b.stencilConfigForOverlap(n):[{},n];for(const x of y){const S=M.getTile(x);S.needsHillshadePrepare!==void 0&&S.needsHillshadePrepare&&b.renderPass==="offscreen"?Ca(b,S,i,l,wi.disabled,c):b.renderPass==="translucent"&&Yl(b,x,S,i,l,f[x.overscaledZ],c)}s.viewport.set([0,0,b.width,b.height])})(t,a,d,g);break;case"raster":(function(b,M,i,n){if(b.renderPass!=="translucent"||i.paint.get("raster-opacity")===0||!n.length)return;const s=b.context,l=s.gl,c=M.getSource(),f=b.useProgram("raster"),y=b.colorModeForRenderPass(),[x,S]=c instanceof Wi?[{},n]:b.stencilConfigForOverlap(n),C=S[S.length-1].overscaledZ,z=!b.options.moving;for(const G of S){const N=b.depthModeForSublayer(G.overscaledZ-C,i.paint.get("raster-opacity")===1?Qt.ReadWrite:Qt.ReadOnly,l.LESS),Z=M.getTile(G);Z.registerFadeDuration(i.paint.get("raster-fade-duration"));const Q=M.findLoadedParent(G,0),ee=Kl(Z,Q,M,i,b.transform,b.style.map.terrain);let he,ge;const oe=i.paint.get("raster-resampling")==="nearest"?l.NEAREST:l.LINEAR;s.activeTexture.set(l.TEXTURE0),Z.texture.bind(oe,l.CLAMP_TO_EDGE,l.LINEAR_MIPMAP_NEAREST),s.activeTexture.set(l.TEXTURE1),Q?(Q.texture.bind(oe,l.CLAMP_TO_EDGE,l.LINEAR_MIPMAP_NEAREST),he=Math.pow(2,Q.tileID.overscaledZ-Z.tileID.overscaledZ),ge=[Z.tileID.canonical.x*he%1,Z.tileID.canonical.y*he%1]):Z.texture.bind(oe,l.CLAMP_TO_EDGE,l.LINEAR_MIPMAP_NEAREST);const fe=b.style.map.terrain&&b.style.map.terrain.getTerrainData(G),pe=fe?G:null,Fe=pe?pe.posMatrix:b.transform.calculatePosMatrix(G.toUnwrapped(),z),Me=ol(Fe,ge||[0,0],he||1,ee,i);c instanceof Wi?f.draw(s,l.TRIANGLES,N,wi.disabled,y,fi.disabled,Me,fe,i.id,c.boundsBuffer,b.quadTriangleIndexBuffer,c.boundsSegments):f.draw(s,l.TRIANGLES,N,x[G.overscaledZ],y,fi.disabled,Me,fe,i.id,b.rasterBoundsBuffer,b.quadTriangleIndexBuffer,b.rasterBoundsSegments)}})(t,a,d,g);break;case"background":(function(b,M,i,n){const s=i.paint.get("background-color"),l=i.paint.get("background-opacity");if(l===0)return;const c=b.context,f=c.gl,y=b.transform,x=y.tileSize,S=i.paint.get("background-pattern");if(b.isPatternMissing(S))return;const C=!S&&s.a===1&&l===1&&b.opaquePassEnabledForLayer()?"opaque":"translucent";if(b.renderPass!==C)return;const z=wi.disabled,G=b.depthModeForSublayer(0,C==="opaque"?Qt.ReadWrite:Qt.ReadOnly),N=b.colorModeForRenderPass(),Z=b.useProgram(S?"backgroundPattern":"background"),Q=n||y.coveringTiles({tileSize:x,terrain:b.style.map.terrain});S&&(c.activeTexture.set(f.TEXTURE0),b.imageManager.bind(b.context));const ee=i.getCrossfadeParameters();for(const he of Q){const ge=n?he.posMatrix:b.transform.calculatePosMatrix(he.toUnwrapped()),oe=S?Or(ge,l,b,S,{tileID:he,tileSize:x},ee):Cs(ge,l,s),fe=b.style.map.terrain&&b.style.map.terrain.getTerrainData(he);Z.draw(c,f.TRIANGLES,G,z,N,fi.disabled,oe,fe,i.id,b.tileExtentBuffer,b.quadTriangleIndexBuffer,b.tileExtentSegments)}})(t,0,d,g);break;case"custom":(function(b,M,i){const n=b.context,s=i.implementation;if(b.renderPass==="offscreen"){const l=s.prerender;l&&(b.setCustomLayerDefaults(),n.setColorMode(b.colorModeForRenderPass()),l.call(s,n.gl,b.transform.customLayerMatrix()),n.setDirty(),b.setBaseState())}else if(b.renderPass==="translucent"){b.setCustomLayerDefaults(),n.setColorMode(b.colorModeForRenderPass()),n.setStencilMode(wi.disabled);const l=s.renderingMode==="3d"?new Qt(b.context.gl.LEQUAL,Qt.ReadWrite,b.depthRangeFor3D):b.depthModeForSublayer(0,Qt.ReadOnly);n.setDepthMode(l),s.render(n.gl,b.transform.customLayerMatrix()),n.setDirty(),b.setBaseState(),n.bindFramebuffer.set(null)}})(t,0,d)}}translatePosMatrix(t,a,d,g,b){if(!d[0]&&!d[1])return t;const M=b?g==="map"?this.transform.angle:0:g==="viewport"?-this.transform.angle:0;if(M){const s=Math.sin(M),l=Math.cos(M);d=[d[0]*l-d[1]*s,d[0]*s+d[1]*l]}const i=[b?d[0]:ve(a,d[0],this.transform.zoom),b?d[1]:ve(a,d[1],this.transform.zoom),0],n=new Float32Array(16);return h.$(n,t,i),n}saveTileTexture(t){const a=this._tileTextures[t.size[0]];a?a.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const a=this._tileTextures[t];return a&&a.length>0?a.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const a=this.imageManager.getPattern(t.from.toString()),d=this.imageManager.getPattern(t.to.toString());return!a||!d}useProgram(t,a){this.cache=this.cache||{};const d=t+(a?a.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[d]||(this.cache[d]=new qo(this.context,xi[t],a,Wo[t],this._showOverdrawInspector,this.style.map.terrain)),this.cache[d]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Lt(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:a}=this.context.gl;return this.width!==t||this.height!==a}}class Zi{constructor(t,a){this.points=t,this.planes=a}static fromInvProjectionMatrix(t,a,d){const g=Math.pow(2,d),b=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(i=>{const n=1/(i=h.ag([],i,t))[3]/a*g;return h.b3(i,i,[n,n,1/i[3],n])}),M=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(i=>{const n=function(f,y){var x=y[0],S=y[1],C=y[2],z=x*x+S*S+C*C;return z>0&&(z=1/Math.sqrt(z)),f[0]=y[0]*z,f[1]=y[1]*z,f[2]=y[2]*z,f}([],function(f,y,x){var S=y[0],C=y[1],z=y[2],G=x[0],N=x[1],Z=x[2];return f[0]=C*Z-z*N,f[1]=z*G-S*Z,f[2]=S*N-C*G,f}([],Tt([],b[i[0]],b[i[1]]),Tt([],b[i[2]],b[i[1]]))),s=-((l=n)[0]*(c=b[i[1]])[0]+l[1]*c[1]+l[2]*c[2]);var l,c;return n.concat(s)});return new Zi(b,M)}}class Us{constructor(t,a){this.min=t,this.max=a,this.center=function(d,g,b){return d[0]=.5*g[0],d[1]=.5*g[1],d[2]=.5*g[2],d}([],function(d,g,b){return d[0]=g[0]+b[0],d[1]=g[1]+b[1],d[2]=g[2]+b[2],d}([],this.min,this.max))}quadrant(t){const a=[t%2==0,t<2],d=je(this.min),g=je(this.max);for(let b=0;b<a.length;b++)d[b]=a[b]?this.min[b]:this.center[b],g[b]=a[b]?this.center[b]:this.max[b];return g[2]=this.max[2],new Us(d,g)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersects(t){const a=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let d=!0;for(let g=0;g<t.planes.length;g++){const b=t.planes[g];let M=0;for(let i=0;i<a.length;i++)h.b4(b,a[i])>=0&&M++;if(M===0)return 0;M!==a.length&&(d=!1)}if(d)return 2;for(let g=0;g<3;g++){let b=Number.MAX_VALUE,M=-Number.MAX_VALUE;for(let i=0;i<t.points.length;i++){const n=t.points[i][g]-this.min[g];b=Math.min(b,n),M=Math.max(M,n)}if(M<0||b>this.max[g]-this.min[g])return 0}return 1}}class Gs{constructor(t=0,a=0,d=0,g=0){if(isNaN(t)||t<0||isNaN(a)||a<0||isNaN(d)||d<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=a,this.left=d,this.right=g}interpolate(t,a,d){return a.top!=null&&t.top!=null&&(this.top=h.B.number(t.top,a.top,d)),a.bottom!=null&&t.bottom!=null&&(this.bottom=h.B.number(t.bottom,a.bottom,d)),a.left!=null&&t.left!=null&&(this.left=h.B.number(t.left,a.left,d)),a.right!=null&&t.right!=null&&(this.right=h.B.number(t.right,a.right,d)),this}getCenter(t,a){const d=h.ad((this.left+t-this.right)/2,0,t),g=h.ad((this.top+a-this.bottom)/2,0,a);return new h.P(d,g)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Gs(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class ta{constructor(t,a,d,g,b){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=b===void 0||!!b,this._minZoom=t||0,this._maxZoom=a||22,this._minPitch=d??0,this._maxPitch=g??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new h.L(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Gs,this._posMatrixCache={},this._alignedPosMatrixCache={},this._minEleveationForCurrentTile=0}clone(){const t=new ta(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.apply(this),t}apply(t){this.tileSize=t.tileSize,this.latRange=t.latRange,this.width=t.width,this.height=t.height,this._center=t._center,this._elevation=t._elevation,this._minEleveationForCurrentTile=t._minEleveationForCurrentTile,this.zoom=t.zoom,this.angle=t.angle,this._fov=t._fov,this._pitch=t._pitch,this._unmodified=t._unmodified,this._edgeInsets=t._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new h.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const a=-h.b5(t,-180,180)*Math.PI/180;this.angle!==a&&(this._unmodified=!1,this.angle=a,this._calcMatrices(),this.rotationMatrix=function(){var d=new h.A(4);return h.A!=Float32Array&&(d[1]=0,d[2]=0),d[0]=1,d[3]=1,d}(),function(d,g,b){var M=g[0],i=g[1],n=g[2],s=g[3],l=Math.sin(b),c=Math.cos(b);d[0]=M*c+n*l,d[1]=i*c+s*l,d[2]=M*-l+n*c,d[3]=i*-l+s*c}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const a=h.ad(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==a&&(this._unmodified=!1,this._pitch=a,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const a=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==a&&(this._unmodified=!1,this._zoom=a,this.tileZoom=Math.max(0,Math.floor(a)),this.scale=this.zoomScale(a),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,a,d){this._unmodified=!1,this._edgeInsets.interpolate(t,a,d),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const a=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,a)}getVisibleUnwrappedCoordinates(t){const a=[new h.b6(0,t)];if(this._renderWorldCopies){const d=this.pointCoordinate(new h.P(0,0)),g=this.pointCoordinate(new h.P(this.width,0)),b=this.pointCoordinate(new h.P(this.width,this.height)),M=this.pointCoordinate(new h.P(0,this.height)),i=Math.floor(Math.min(d.x,g.x,b.x,M.x)),n=Math.floor(Math.max(d.x,g.x,b.x,M.x)),s=1;for(let l=i-s;l<=n+s;l++)l!==0&&a.push(new h.b6(l,t))}return a}coveringTiles(t){var a,d;let g=this.coveringZoomLevel(t);const b=g;if(t.minzoom!==void 0&&g<t.minzoom)return[];t.maxzoom!==void 0&&g>t.maxzoom&&(g=t.maxzoom);const M=this.pointCoordinate(this.getCameraPoint()),i=h.U.fromLngLat(this.center),n=Math.pow(2,g),s=[n*M.x,n*M.y,0],l=[n*i.x,n*i.y,0],c=Zi.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,g);let f=t.minzoom||0;!t.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(f=g);const y=t.terrain?2/Math.min(this.tileSize,t.tileSize)*this.tileSize:3,x=N=>({aabb:new Us([N*n,0,0],[(N+1)*n,n,0]),zoom:0,x:0,y:0,wrap:N,fullyVisible:!1}),S=[],C=[],z=g,G=t.reparseOverscaled?b:g;if(this._renderWorldCopies)for(let N=1;N<=3;N++)S.push(x(-N)),S.push(x(N));for(S.push(x(0));S.length>0;){const N=S.pop(),Z=N.x,Q=N.y;let ee=N.fullyVisible;if(!ee){const pe=N.aabb.intersects(c);if(pe===0)continue;ee=pe===2}const he=t.terrain?s:l,ge=N.aabb.distanceX(he),oe=N.aabb.distanceY(he),fe=Math.max(Math.abs(ge),Math.abs(oe));if(N.zoom===z||fe>y+(1<<z-N.zoom)-2&&N.zoom>=f){const pe=z-N.zoom,Fe=s[0]-.5-(Z<<pe),Me=s[1]-.5-(Q<<pe);C.push({tileID:new h.O(N.zoom===z?G:N.zoom,N.wrap,N.zoom,Z,Q),distanceSq:Ot([l[0]-.5-Z,l[1]-.5-Q]),tileDistanceToCamera:Math.sqrt(Fe*Fe+Me*Me)})}else for(let pe=0;pe<4;pe++){const Fe=(Z<<1)+pe%2,Me=(Q<<1)+(pe>>1),Pe=N.zoom+1;let Ce=N.aabb.quadrant(pe);if(t.terrain){const vt=new h.O(Pe,N.wrap,Pe,Fe,Me),at=t.terrain.getMinMaxElevation(vt),rt=(a=at.minElevation)!==null&&a!==void 0?a:this.elevation,et=(d=at.maxElevation)!==null&&d!==void 0?d:this.elevation;Ce=new Us([Ce.min[0],Ce.min[1],rt],[Ce.max[0],Ce.max[1],et])}S.push({aabb:Ce,zoom:Pe,x:Fe,y:Me,wrap:N.wrap,fullyVisible:ee})}}return C.sort((N,Z)=>N.distanceSq-Z.distanceSq).map(N=>N.tileID)}resize(t,a){this.width=t,this.height=a,this.pixelsToGLUnits=[2/t,-2/a],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const a=h.ad(t.lat,-this.maxValidLatitude,this.maxValidLatitude);return new h.P(h.G(t.lng)*this.worldSize,h.H(a)*this.worldSize)}unproject(t){return new h.U(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(t){const a=this.pointLocation(this.centerPoint,t),d=t.getElevationForLngLatZoom(a,this.tileZoom);if(!(this.elevation-d))return;const g=this.getCameraPosition(),b=h.U.fromLngLat(g.lngLat,g.altitude),M=h.U.fromLngLat(a,d),i=b.x-M.x,n=b.y-M.y,s=b.z-M.z,l=Math.sqrt(i*i+n*n+s*s),c=this.scaleZoom(this.cameraToCenterDistance/l/this.tileSize);this._elevation=d,this._center=a,this.zoom=c}setLocationAtPoint(t,a){const d=this.pointCoordinate(a),g=this.pointCoordinate(this.centerPoint),b=this.locationCoordinate(t),M=new h.U(b.x-(d.x-g.x),b.y-(d.y-g.y));this.center=this.coordinateLocation(M),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t,a){return a?this.coordinatePoint(this.locationCoordinate(t),a.getElevationForLngLatZoom(t,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(t))}pointLocation(t,a){return this.coordinateLocation(this.pointCoordinate(t,a))}locationCoordinate(t){return h.U.fromLngLat(t)}coordinateLocation(t){return t&&t.toLngLat()}pointCoordinate(t,a){if(a){const f=a.pointCoordinate(t);if(f!=null)return f}const d=[t.x,t.y,0,1],g=[t.x,t.y,1,1];h.ag(d,d,this.pixelMatrixInverse),h.ag(g,g,this.pixelMatrixInverse);const b=d[3],M=g[3],i=d[1]/b,n=g[1]/M,s=d[2]/b,l=g[2]/M,c=s===l?0:(0-s)/(l-s);return new h.U(h.B.number(d[0]/b,g[0]/M,c)/this.worldSize,h.B.number(i,n,c)/this.worldSize)}coordinatePoint(t,a=0,d=this.pixelMatrix){const g=[t.x*this.worldSize,t.y*this.worldSize,a,1];return h.ag(g,g,d),new h.P(g[0]/g[3],g[1]/g[3])}getBounds(){const t=Math.max(0,this.height/2-this.getHorizon());return new ri().extend(this.pointLocation(new h.P(0,t))).extend(this.pointLocation(new h.P(this.width,t))).extend(this.pointLocation(new h.P(this.width,this.height))).extend(this.pointLocation(new h.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new ri([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(t,a=!1){const d=t.key,g=a?this._alignedPosMatrixCache:this._posMatrixCache;if(g[d])return g[d];const b=t.canonical,M=this.worldSize/this.zoomScale(b.z),i=b.x+Math.pow(2,b.z)*t.wrap,n=h.ao(new Float64Array(16));return h.$(n,n,[i*M,b.y*M,0]),h.a0(n,n,[M/h.N,M/h.N,1]),h.a1(n,a?this.alignedProjMatrix:this.projMatrix,n),g[d]=new Float32Array(n),g[d]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let t,a,d,g,b=-90,M=90,i=-180,n=180;const s=this.size,l=this._unmodified;if(this.latRange){const y=this.latRange;b=h.H(y[1])*this.worldSize,M=h.H(y[0])*this.worldSize,t=M-b<s.y?s.y/(M-b):0}if(this.lngRange){const y=this.lngRange;i=h.b5(h.G(y[0])*this.worldSize,0,this.worldSize),n=h.b5(h.G(y[1])*this.worldSize,0,this.worldSize),n<i&&(n+=this.worldSize),a=n-i<s.x?s.x/(n-i):0}const c=this.point,f=Math.max(a||0,t||0);if(f)return this.center=this.unproject(new h.P(a?(n+i)/2:c.x,t?(M+b)/2:c.y)),this.zoom+=this.scaleZoom(f),this._unmodified=l,void(this._constraining=!1);if(this.latRange){const y=c.y,x=s.y/2;y-x<b&&(g=b+x),y+x>M&&(g=M-x)}if(this.lngRange){const y=(i+n)/2,x=h.b5(c.x,y-this.worldSize/2,y+this.worldSize/2),S=s.x/2;x-S<i&&(d=i+S),x+S>n&&(d=n-S)}d===void 0&&g===void 0||(this.center=this.unproject(new h.P(d!==void 0?d:c.x,g!==void 0?g:c.y)).wrap()),this._unmodified=l,this._constraining=!1}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,a=this.point.x,d=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=h.b7(1,this.center.lat)*this.worldSize;let g=h.ao(new Float64Array(16));h.a0(g,g,[this.width/2,-this.height/2,1]),h.$(g,g,[1,-1,0]),this.labelPlaneMatrix=g,g=h.ao(new Float64Array(16)),h.a0(g,g,[1,-1,1]),h.$(g,g,[-1,-1,0]),h.a0(g,g,[2/this.width,2/this.height,1]),this.glCoordMatrix=g;const b=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),M=Math.min(this.elevation,this._minEleveationForCurrentTile),i=b-M*this._pixelPerMeter/Math.cos(this._pitch),n=M<0?i:b,s=Math.PI/2+this._pitch,l=this._fov*(.5+t.y/this.height),c=Math.sin(l)*n/Math.sin(h.ad(Math.PI-s-l,.01,Math.PI-.01)),f=this.getHorizon(),y=2*Math.atan(f/this.cameraToCenterDistance)*(.5+t.y/(2*f)),x=Math.sin(y)*n/Math.sin(h.ad(Math.PI-s-y,.01,Math.PI-.01)),S=Math.min(c,x),C=1.01*(Math.cos(Math.PI/2-this._pitch)*S+n),z=this.height/50;g=new Float64Array(16),h.b8(g,this._fov,this.width/this.height,z,C),g[8]=2*-t.x/this.width,g[9]=2*t.y/this.height,h.a0(g,g,[1,-1,1]),h.$(g,g,[0,0,-this.cameraToCenterDistance]),h.b9(g,g,this._pitch),h.ae(g,g,this.angle),h.$(g,g,[-a,-d,0]),this.mercatorMatrix=h.a0([],g,[this.worldSize,this.worldSize,this.worldSize]),h.a0(g,g,[1,1,this._pixelPerMeter]),this.pixelMatrix=h.a1(new Float64Array(16),this.labelPlaneMatrix,g),h.$(g,g,[0,0,-this.elevation]),this.projMatrix=g,this.invProjMatrix=h.as([],g),this.pixelMatrix3D=h.a1(new Float64Array(16),this.labelPlaneMatrix,g);const G=this.width%2/2,N=this.height%2/2,Z=Math.cos(this.angle),Q=Math.sin(this.angle),ee=a-Math.round(a)+Z*G+Q*N,he=d-Math.round(d)+Z*N+Q*G,ge=new Float64Array(g);if(h.$(ge,ge,[ee>.5?ee-1:ee,he>.5?he-1:he,0]),this.alignedProjMatrix=ge,g=h.as(new Float64Array(16),this.pixelMatrix),!g)throw new Error("failed to invert matrix");this.pixelMatrixInverse=g,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const t=this.pointCoordinate(new h.P(0,0)),a=[t.x*this.worldSize,t.y*this.worldSize,0,1];return h.ag(a,a,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new h.P(0,t))}getCameraQueryGeometry(t){const a=this.getCameraPoint();if(t.length===1)return[t[0],a];{let d=a.x,g=a.y,b=a.x,M=a.y;for(const i of t)d=Math.min(d,i.x),g=Math.min(g,i.y),b=Math.max(b,i.x),M=Math.max(M,i.y);return[new h.P(d,g),new h.P(b,g),new h.P(b,M),new h.P(d,M),new h.P(d,g)]}}}function En(v,t){let a,d=!1,g=null,b=null;const M=()=>{g=null,d&&(v.apply(b,a),g=setTimeout(M,t),d=!1)};return(...i)=>(d=!0,b=this,a=i,g||M(),g)}class xo{constructor(t){this._getCurrentHash=()=>{const a=window.location.hash.replace("#","");if(this._hashName){let d;return a.split("&").map(g=>g.split("=")).forEach(g=>{g[0]===this._hashName&&(d=g)}),(d&&d[1]||"").split("/")}return a.split("/")},this._onHashChange=()=>{const a=this._getCurrentHash();if(a.length>=3&&!a.some(d=>isNaN(d))){const d=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(a[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:d,pitch:+(a[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const a=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,a)}catch{}},this._updateHash=En(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(t){const a=this._map.getCenter(),d=Math.round(100*this._map.getZoom())/100,g=Math.ceil((d*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,g),M=Math.round(a.lng*b)/b,i=Math.round(a.lat*b)/b,n=this._map.getBearing(),s=this._map.getPitch();let l="";if(l+=t?`/${M}/${i}/${d}`:`${d}/${i}/${M}`,(n||s)&&(l+="/"+Math.round(10*n)/10),s&&(l+=`/${Math.round(s)}`),this._hashName){const c=this._hashName;let f=!1;const y=window.location.hash.slice(1).split("&").map(x=>{const S=x.split("=")[0];return S===c?(f=!0,`${S}=${l}`):x}).filter(x=>x);return f||y.push(`${c}=${l}`),`#${y.join("&")}`}return`#${l}`}}const js={linearity:.3,easing:h.ba(0,0,.3,1)},Pa=h.e({deceleration:2500,maxSpeed:1400},js),Da=h.e({deceleration:20,maxSpeed:1400},js),qs=h.e({deceleration:1e3,maxSpeed:360},js),As=h.e({deceleration:1e3,maxSpeed:90},js);class ml{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:h.h.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,a=h.h.now();for(;t.length>0&&a-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const a={zoom:0,bearing:0,pitch:0,pan:new h.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)a.zoom+=b.zoomDelta||0,a.bearing+=b.bearingDelta||0,a.pitch+=b.pitchDelta||0,b.panDelta&&a.pan._add(b.panDelta),b.around&&(a.around=b.around),b.pinchAround&&(a.pinchAround=b.pinchAround);const d=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,g={};if(a.pan.mag()){const b=bo(a.pan.mag(),d,h.e({},Pa,t||{}));g.offset=a.pan.mult(b.amount/a.pan.mag()),g.center=this._map.transform.center,gr(g,b)}if(a.zoom){const b=bo(a.zoom,d,Da);g.zoom=this._map.transform.zoom+b.amount,gr(g,b)}if(a.bearing){const b=bo(a.bearing,d,qs);g.bearing=this._map.transform.bearing+h.ad(b.amount,-179,179),gr(g,b)}if(a.pitch){const b=bo(a.pitch,d,As);g.pitch=this._map.transform.pitch+b.amount,gr(g,b)}if(g.zoom||g.bearing){const b=a.pinchAround===void 0?a.around:a.pinchAround;g.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),h.e(g,{noMoveStart:!0})}}function gr(v,t){(!v.duration||v.duration<t.duration)&&(v.duration=t.duration,v.easing=t.easing)}function bo(v,t,a){const{maxSpeed:d,linearity:g,deceleration:b}=a,M=h.ad(v*g/(t/1e3),-d,d),i=Math.abs(M)/(b*g);return{easing:a.easing,duration:1e3*i,amount:M*(i/2)}}class Er extends h.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,d,g={}){const b=R.mousePos(a.getCanvasContainer(),d),M=a.unproject(b);super(t,h.e({point:b,lngLat:M,originalEvent:d},g)),this._defaultPrevented=!1,this.target=a}}class wo extends h.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,d){const g=t==="touchend"?d.changedTouches:d.touches,b=R.touchPos(a.getCanvasContainer(),g),M=b.map(n=>a.unproject(n)),i=b.reduce((n,s,l,c)=>n.add(s.div(c.length)),new h.P(0,0));super(t,{points:b,point:i,lngLats:M,lngLat:a.unproject(i),originalEvent:d}),this._defaultPrevented=!1}}class gl extends h.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,d){super(t,{originalEvent:d}),this._defaultPrevented=!1}}class _l{constructor(t,a){this._map=t,this._clickTolerance=a.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new gl(t.type,this._map,t))}mousedown(t,a){return this._mousedownPos=a,this._firePreventable(new Er(t.type,this._map,t))}mouseup(t){this._map.fire(new Er(t.type,this._map,t))}click(t,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||this._map.fire(new Er(t.type,this._map,t))}dblclick(t){return this._firePreventable(new Er(t.type,this._map,t))}mouseover(t){this._map.fire(new Er(t.type,this._map,t))}mouseout(t){this._map.fire(new Er(t.type,this._map,t))}touchstart(t){return this._firePreventable(new wo(t.type,this._map,t))}touchmove(t){this._map.fire(new wo(t.type,this._map,t))}touchend(t){this._map.fire(new wo(t.type,this._map,t))}touchcancel(t){this._map.fire(new wo(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class yl{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new Er(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Er("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new Er(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Sn{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.pointLocation(h.P.convert(t),this._map.terrain)}}class ia{constructor(t,a){this._map=t,this._tr=new Sn(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,a){this.isEnabled()&&t.shiftKey&&t.button===0&&(R.disableDrag(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(t,a){if(!this._active)return;const d=a;if(this._lastPos.equals(d)||!this._box&&d.dist(this._startPos)<this._clickTolerance)return;const g=this._startPos;this._lastPos=d,this._box||(this._box=R.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const b=Math.min(g.x,d.x),M=Math.max(g.x,d.x),i=Math.min(g.y,d.y),n=Math.max(g.y,d.y);R.setTransform(this._box,`translate(${b}px,${i}px)`),this._box.style.width=M-b+"px",this._box.style.height=n-i+"px"}mouseupWindow(t,a){if(!this._active||t.button!==0)return;const d=this._startPos,g=a;if(this.reset(),R.suppressClick(),d.x!==g.x||d.y!==g.y)return this._map.fire(new h.k("boxzoomend",{originalEvent:t})),{cameraAnimation:b=>b.fitScreenCoordinates(d,g,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(R.remove(this._box),this._box=null),R.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,a){return this._map.fire(new h.k(t,{originalEvent:a}))}}function Sr(v,t){if(v.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${v.length}, points ${t.length}`);const a={};for(let d=0;d<v.length;d++)a[v[d].identifier]=t[d];return a}class Jr{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,a,d){(this.centroid||d.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),d.length===this.numTouches&&(this.centroid=function(g){const b=new h.P(0,0);for(const M of g)b._add(M);return b.div(g.length)}(a),this.touches=Sr(d,a)))}touchmove(t,a,d){if(this.aborted||!this.centroid)return;const g=Sr(d,a);for(const b in this.touches){const M=g[b];(!M||M.dist(this.touches[b])>30)&&(this.aborted=!0)}}touchend(t,a,d){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),d.length===0){const g=!this.aborted&&this.centroid;if(this.reset(),g)return g}}}class ra{constructor(t){this.singleTap=new Jr(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,a,d){this.singleTap.touchstart(t,a,d)}touchmove(t,a,d){this.singleTap.touchmove(t,a,d)}touchend(t,a,d){const g=this.singleTap.touchend(t,a,d);if(g){const b=t.timeStamp-this.lastTime<500,M=!this.lastTap||this.lastTap.dist(g)<30;if(b&&M||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}}}class Tn{constructor(t){this._tr=new Sn(t),this._zoomIn=new ra({numTouches:1,numTaps:2}),this._zoomOut=new ra({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,a,d){this._zoomIn.touchstart(t,a,d),this._zoomOut.touchstart(t,a,d)}touchmove(t,a,d){this._zoomIn.touchmove(t,a,d),this._zoomOut.touchmove(t,a,d)}touchend(t,a,d){const g=this._zoomIn.touchend(t,a,d),b=this._zoomOut.touchend(t,a,d),M=this._tr;return g?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:i=>i.easeTo({duration:300,zoom:M.zoom+1,around:M.unproject(g)},{originalEvent:t})}):b?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:i=>i.easeTo({duration:300,zoom:M.zoom-1,around:M.unproject(b)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class In{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const a=this._moveFunction(...t);if(a.bearingDelta||a.pitchDelta||a.around||a.panDelta)return this._active=!0,a}dragStart(t,a){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=a.length?a[0]:a,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,a){if(!this.isEnabled())return;const d=this._lastPoint;if(!d)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const g=a.length?a[0]:a;return!this._moved&&g.dist(d)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=g,this._move(d,g))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&R.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Jl={0:1,2:2};class Ba{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const a=R.mouseButton(t);this._eventButton=a}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!function(a,d){const g=Jl[d];return a.buttons===void 0||(a.buttons&g)!==g}(t,this._eventButton)}isValidEndEvent(t){return R.mouseButton(t)===this._eventButton}}class vl{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}const na=v=>{v.mousedown=v.dragStart,v.mousemoveWindow=v.dragMove,v.mouseup=v.dragEnd,v.contextmenu=function(t){t.preventDefault()}},us=({enable:v,clickTolerance:t,bearingDegreesPerPixelMoved:a=.8})=>{const d=new Ba({checkCorrectEvent:g=>R.mouseButton(g)===0&&g.ctrlKey||R.mouseButton(g)===2});return new In({clickTolerance:t,move:(g,b)=>({bearingDelta:(b.x-g.x)*a}),moveStateManager:d,enable:v,assignEvents:na})},Mn=({enable:v,clickTolerance:t,pitchDegreesPerPixelMoved:a=-.5})=>{const d=new Ba({checkCorrectEvent:g=>R.mouseButton(g)===0&&g.ctrlKey||R.mouseButton(g)===2});return new In({clickTolerance:t,move:(g,b)=>({pitchDelta:(b.y-g.y)*a}),moveStateManager:d,enable:v,assignEvents:na})};class st{constructor(t,a){this._minTouches=t.cooperativeGestures?2:1,this._clickTolerance=t.clickTolerance||1,this._map=a,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new h.P(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(t,a,d){return this._calculateTransform(t,a,d)}touchmove(t,a,d){if(this._map._cooperativeGestures&&(this._minTouches===2&&d.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(t,!1,d.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(d.length<this._minTouches))return t.preventDefault(),this._calculateTransform(t,a,d)}touchend(t,a,d){this._calculateTransform(t,a,d),this._active&&d.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,a,d){d.length>0&&(this._active=!0);const g=Sr(d,a),b=new h.P(0,0),M=new h.P(0,0);let i=0;for(const s in g){const l=g[s],c=this._touches[s];c&&(b._add(l),M._add(l.sub(c)),i++,g[s]=l)}if(this._touches=g,i<this._minTouches||!M.mag())return;const n=M.div(i);return this._sum._add(n),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(i),panDelta:n}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Nr{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,a,d){this._firstTwoTouches||d.length<2||(this._firstTwoTouches=[d[0].identifier,d[1].identifier],this._start([a[0],a[1]]))}touchmove(t,a,d){if(!this._firstTwoTouches)return;t.preventDefault();const[g,b]=this._firstTwoTouches,M=Cn(d,a,g),i=Cn(d,a,b);if(!M||!i)return;const n=this._aroundCenter?null:M.add(i).div(2);return this._move([M,i],n,t)}touchend(t,a,d){if(!this._firstTwoTouches)return;const[g,b]=this._firstTwoTouches,M=Cn(d,a,g),i=Cn(d,a,b);M&&i||(this._active&&R.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Cn(v,t,a){for(let d=0;d<v.length;d++)if(v[d].identifier===a)return t[d]}function Zs(v,t){return Math.log(v/t)/Math.LN2}class xl extends Nr{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,a){const d=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Zs(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Zs(this._distance,d),pinchAround:a}}}function Je(v,t){return 180*v.angleWith(t)/Math.PI}class za extends Nr{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,a){const d=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Je(this._vector,d),pinchAround:a}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const a=25/(Math.PI*this._minDiameter)*360,d=Je(t,this._startVector);return Math.abs(d)<a}}function La(v){return Math.abs(v.y)>Math.abs(v.x)}class Gn extends Nr{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,a,d){super.touchstart(t,a,d),this._currentTouchCount=d.length}_start(t){this._lastPoints=t,La(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,a,d){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const g=t[0].sub(this._lastPoints[0]),b=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(g,b,d.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(g.y+b.y)/2*-.5}):void 0}gestureBeginsVertically(t,a,d){if(this._valid!==void 0)return this._valid;const g=t.mag()>=2,b=a.mag()>=2;if(!g&&!b)return;if(!g||!b)return this._firstMove===void 0&&(this._firstMove=d),d-this._firstMove<100&&void 0;const M=t.y>0==a.y>0;return La(t)&&La(a)&&M}}const sa={panStep:100,bearingStep:15,pitchStep:10};class Ra{constructor(t){this._tr=new Sn(t);const a=sa;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let a=0,d=0,g=0,b=0,M=0;switch(t.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:t.shiftKey?d=-1:(t.preventDefault(),b=-1);break;case 39:t.shiftKey?d=1:(t.preventDefault(),b=1);break;case 38:t.shiftKey?g=1:(t.preventDefault(),M=-1);break;case 40:t.shiftKey?g=-1:(t.preventDefault(),M=1);break;default:return}return this._rotationDisabled&&(d=0,g=0),{cameraAnimation:i=>{const n=this._tr;i.easeTo({duration:300,easeId:"keyboardHandler",easing:bl,zoom:a?Math.round(n.zoom)+a*(t.shiftKey?2:1):n.zoom,bearing:n.bearing+d*this._bearingStep,pitch:n.pitch+g*this._pitchStep,offset:[-b*this._panStep,-M*this._panStep],center:n.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function bl(v){return v*(2-v)}const wl=4.000244140625;class eA{constructor(t,a){this._onTimeout=d=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(d)},this._map=t,this._tr=new Sn(t),this._el=t.getCanvasContainer(),this._triggerRenderFrame=a,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!t[this._map._metaKey])return;t.preventDefault()}let a=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const d=h.h.now(),g=d-(this._lastWheelEventTime||0);this._lastWheelEventTime=d,a!==0&&a%wl==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=a,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(g*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),t.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=t,this._delta-=a,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=R.mousePos(this._el,t),d=this._tr;this._around=h.L.convert(this._aroundCenter?d.center:d.unproject(a)),this._aroundPoint=d.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(this._delta!==0){const i=this._type==="wheel"&&Math.abs(this._delta)>wl?this._wheelZoomRate:this._defaultZoomRate;let n=2/(1+Math.exp(-Math.abs(this._delta*i)));this._delta<0&&n!==0&&(n=1/n);const s=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(s*n))),this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const a=typeof this._targetZoom=="number"?this._targetZoom:t.zoom,d=this._startZoom,g=this._easing;let b,M=!1;if(this._type==="wheel"&&d&&g){const i=Math.min((h.h.now()-this._lastWheelEventTime)/200,1),n=g(i);b=h.B.number(d,a,n),i<1?this._frameId||(this._frameId=!0):M=!0}else b=a,M=!0;return this._active=!0,M&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!M,zoomDelta:b-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let a=h.bb;if(this._prevEase){const d=this._prevEase,g=(h.h.now()-d.start)/d.duration,b=d.easing(g+.01)-d.easing(g),M=.27/Math.sqrt(b*b+1e-4)*.01,i=Math.sqrt(.0729-M*M);a=h.ba(M,i,.25,1)}return this._prevEase={start:h.h.now(),duration:t,easing:a},a}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Fa{constructor(t,a){this._clickZoom=t,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Oa{constructor(t){this._tr=new Sn(t),this.reset()}reset(){this._active=!1}dblclick(t,a){return t.preventDefault(),{cameraAnimation:d=>{d.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(a)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Va{constructor(){this._tap=new ra({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,a,d){if(!this._swipePoint)if(this._tapTime){const g=a[0],b=t.timeStamp-this._tapTime<500,M=this._tapPoint.dist(g)<30;b&&M?d.length>0&&(this._swipePoint=g,this._swipeTouch=d[0].identifier):this.reset()}else this._tap.touchstart(t,a,d)}touchmove(t,a,d){if(this._tapTime){if(this._swipePoint){if(d[0].identifier!==this._swipeTouch)return;const g=a[0],b=g.y-this._swipePoint.y;return this._swipePoint=g,t.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(t,a,d)}touchend(t,a,d){if(this._tapTime)this._swipePoint&&d.length===0&&this.reset();else{const g=this._tap.touchend(t,a,d);g&&(this._tapTime=t.timeStamp,this._tapPoint=g)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Na{constructor(t,a,d){this._el=t,this._mousePan=a,this._touchPan=d}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class _r{constructor(t,a,d){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=a,this._mousePitch=d}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class jn{constructor(t,a,d,g){this._el=t,this._touchZoom=a,this._touchRotate=d,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const ko=v=>v.zoom||v.drag||v.pitch||v.rotate;class Ua extends h.k{}function Qs(v){return v.panDelta&&v.panDelta.mag()||v.zoomDelta||v.bearingDelta||v.pitchDelta}class oa{constructor(t,a){this.handleWindowEvent=g=>{this.handleEvent(g,`${g.type}Window`)},this.handleEvent=(g,b)=>{if(g.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const M=g.type==="renderFrame"?void 0:g,i={needsRenderFrame:!1},n={},s={},l=g.touches,c=l?this._getMapTouches(l):void 0,f=c?R.touchPos(this._el,c):R.mousePos(this._el,g);for(const{handlerName:S,handler:C,allowed:z}of this._handlers){if(!C.isEnabled())continue;let G;this._blockedByActive(s,z,S)?C.reset():C[b||g.type]&&(G=C[b||g.type](g,f,c),this.mergeHandlerResult(i,n,G,S,M),G&&G.needsRenderFrame&&this._triggerRenderFrame()),(G||C.isActive())&&(s[S]=C)}const y={};for(const S in this._previousActiveHandlers)s[S]||(y[S]=M);this._previousActiveHandlers=s,(Object.keys(y).length||Qs(i))&&(this._changes.push([i,n,y]),this._triggerRenderFrame()),(Object.keys(s).length||Qs(i))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:x}=i;x&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],x(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new ml(t),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(a);const d=this._el;this._listeners=[[d,"touchstart",{passive:!0}],[d,"touchmove",{passive:!1}],[d,"touchend",void 0],[d,"touchcancel",void 0],[d,"mousedown",void 0],[d,"mousemove",void 0],[d,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[d,"mouseover",void 0],[d,"mouseout",void 0],[d,"dblclick",void 0],[d,"click",void 0],[d,"keydown",{capture:!1}],[d,"keyup",void 0],[d,"wheel",{passive:!1}],[d,"contextmenu",void 0],[window,"blur",void 0]];for(const[g,b,M]of this._listeners)R.addEventListener(g,b,g===document?this.handleWindowEvent:this.handleEvent,M)}destroy(){for(const[t,a,d]of this._listeners)R.removeEventListener(t,a,t===document?this.handleWindowEvent:this.handleEvent,d)}_addDefaultHandlers(t){const a=this._map,d=a.getCanvasContainer();this._add("mapEvent",new _l(a,t));const g=a.boxZoom=new ia(a,t);this._add("boxZoom",g),t.interactive&&t.boxZoom&&g.enable();const b=new Tn(a),M=new Oa(a);a.doubleClickZoom=new Fa(M,b),this._add("tapZoom",b),this._add("clickZoom",M),t.interactive&&t.doubleClickZoom&&a.doubleClickZoom.enable();const i=new Va;this._add("tapDragZoom",i);const n=a.touchPitch=new Gn(a);this._add("touchPitch",n),t.interactive&&t.touchPitch&&a.touchPitch.enable(t.touchPitch);const s=us(t),l=Mn(t);a.dragRotate=new _r(t,s,l),this._add("mouseRotate",s,["mousePitch"]),this._add("mousePitch",l,["mouseRotate"]),t.interactive&&t.dragRotate&&a.dragRotate.enable();const c=(({enable:z,clickTolerance:G})=>{const N=new Ba({checkCorrectEvent:Z=>R.mouseButton(Z)===0&&!Z.ctrlKey});return new In({clickTolerance:G,move:(Z,Q)=>({around:Q,panDelta:Q.sub(Z)}),activateOnStart:!0,moveStateManager:N,enable:z,assignEvents:na})})(t),f=new st(t,a);a.dragPan=new Na(d,c,f),this._add("mousePan",c),this._add("touchPan",f,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&a.dragPan.enable(t.dragPan);const y=new za,x=new xl;a.touchZoomRotate=new jn(d,x,y,i),this._add("touchRotate",y,["touchPan","touchZoom"]),this._add("touchZoom",x,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&a.touchZoomRotate.enable(t.touchZoomRotate);const S=a.scrollZoom=new eA(a,()=>this._triggerRenderFrame());this._add("scrollZoom",S,["mousePan"]),t.interactive&&t.scrollZoom&&a.scrollZoom.enable(t.scrollZoom);const C=a.keyboard=new Ra(a);this._add("keyboard",C),t.interactive&&t.keyboard&&a.keyboard.enable(),this._add("blockableMapEvent",new yl(a))}_add(t,a,d){this._handlers.push({handlerName:t,handler:a,allowed:d}),this._handlersById[t]=a}stop(t){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ko(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,a,d){for(const g in t)if(g!==d&&(!a||a.indexOf(g)<0))return!0;return!1}_getMapTouches(t){const a=[];for(const d of t)this._el.contains(d.target)&&a.push(d);return a}mergeHandlerResult(t,a,d,g,b){if(!d)return;h.e(t,d);const M={handlerName:g,originalEvent:d.originalEvent||b};d.zoomDelta!==void 0&&(a.zoom=M),d.panDelta!==void 0&&(a.drag=M),d.pitchDelta!==void 0&&(a.pitch=M),d.bearingDelta!==void 0&&(a.rotate=M)}_applyChanges(){const t={},a={},d={};for(const[g,b,M]of this._changes)g.panDelta&&(t.panDelta=(t.panDelta||new h.P(0,0))._add(g.panDelta)),g.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+g.zoomDelta),g.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+g.bearingDelta),g.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+g.pitchDelta),g.around!==void 0&&(t.around=g.around),g.pinchAround!==void 0&&(t.pinchAround=g.pinchAround),g.noInertia&&(t.noInertia=g.noInertia),h.e(a,b),h.e(d,M);this._updateMapTransform(t,a,d),this._changes=[]}_updateMapTransform(t,a,d){const g=this._map,b=g._getTransformForUpdate(),M=g.terrain;if(!(Qs(t)||M&&this._terrainMovement))return this._fireEvents(a,d,!0);let{panDelta:i,zoomDelta:n,bearingDelta:s,pitchDelta:l,around:c,pinchAround:f}=t;f!==void 0&&(c=f),g._stop(!0),c=c||g.transform.centerPoint;const y=b.pointLocation(i?c.sub(i):c);s&&(b.bearing+=s),l&&(b.pitch+=l),n&&(b.zoom+=n),M?this._terrainMovement||!a.drag&&!a.zoom?a.drag&&this._terrainMovement?b.center=b.pointLocation(b.centerPoint.sub(i)):b.setLocationAtPoint(y,c):(this._terrainMovement=!0,this._map._elevationFreeze=!0,b.setLocationAtPoint(y,c),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,b.recalculateZoom(g.terrain)})):b.setLocationAtPoint(y,c),g._applyUpdatedTransform(b),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(a,d,!0)}_fireEvents(t,a,d){const g=ko(this._eventsInProgress),b=ko(t),M={};for(const l in t){const{originalEvent:c}=t[l];this._eventsInProgress[l]||(M[`${l}start`]=c),this._eventsInProgress[l]=t[l]}!g&&b&&this._fireEvent("movestart",b.originalEvent);for(const l in M)this._fireEvent(l,M[l]);b&&this._fireEvent("move",b.originalEvent);for(const l in t){const{originalEvent:c}=t[l];this._fireEvent(l,c)}const i={};let n;for(const l in this._eventsInProgress){const{handlerName:c,originalEvent:f}=this._eventsInProgress[l];this._handlersById[c].isActive()||(delete this._eventsInProgress[l],n=a[c]||f,i[`${l}end`]=n)}for(const l in i)this._fireEvent(l,i[l]);const s=ko(this._eventsInProgress);if(d&&(g||b)&&!s){this._updatingCamera=!0;const l=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),c=f=>f!==0&&-this._bearingSnap<f&&f<this._bearingSnap;!l||!l.essential&&h.h.prefersReducedMotion?(this._map.fire(new h.k("moveend",{originalEvent:n})),c(this._map.getBearing())&&this._map.resetNorth()):(c(l.bearing||this._map.getBearing())&&(l.bearing=0),l.freezeElevation=!0,this._map.easeTo(l,{originalEvent:n})),this._updatingCamera=!1}}_fireEvent(t,a){this._map.fire(new h.k(t,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new Ua("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Pi extends h.E{constructor(t,a){super(),this._renderFrameCallback=()=>{const d=Math.min((h.h.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(d)),d<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=a.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new h.L(this.transform.center.lng,this.transform.center.lat)}setCenter(t,a){return this.jumpTo({center:t},a)}panBy(t,a,d){return t=h.P.convert(t).mult(-1),this.panTo(this.transform.center,h.e({offset:t},a),d)}panTo(t,a,d){return this.easeTo(h.e({center:t},a),d)}getZoom(){return this.transform.zoom}setZoom(t,a){return this.jumpTo({zoom:t},a),this}zoomTo(t,a,d){return this.easeTo(h.e({zoom:t},a),d)}zoomIn(t,a){return this.zoomTo(this.getZoom()+1,t,a),this}zoomOut(t,a){return this.zoomTo(this.getZoom()-1,t,a),this}getBearing(){return this.transform.bearing}setBearing(t,a){return this.jumpTo({bearing:t},a),this}getPadding(){return this.transform.padding}setPadding(t,a){return this.jumpTo({padding:t},a),this}rotateTo(t,a,d){return this.easeTo(h.e({bearing:t},a),d)}resetNorth(t,a){return this.rotateTo(0,h.e({duration:1e3},t),a),this}resetNorthPitch(t,a){return this.easeTo(h.e({bearing:0,pitch:0,duration:1e3},t),a),this}snapToNorth(t,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,a):this}getPitch(){return this.transform.pitch}setPitch(t,a){return this.jumpTo({pitch:t},a),this}cameraForBounds(t,a){t=ri.convert(t);const d=a&&a.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),d,a)}_cameraForBoxAndBearing(t,a,d,g){const b={top:0,bottom:0,right:0,left:0};if(typeof(g=h.e({padding:b,offset:[0,0],maxZoom:this.transform.maxZoom},g)).padding=="number"){const Q=g.padding;g.padding={top:Q,bottom:Q,right:Q,left:Q}}g.padding=h.e(b,g.padding);const M=this.transform,i=M.padding,n=M.project(h.L.convert(t)),s=M.project(h.L.convert(a)),l=n.rotate(-d*Math.PI/180),c=s.rotate(-d*Math.PI/180),f=new h.P(Math.max(l.x,c.x),Math.max(l.y,c.y)),y=new h.P(Math.min(l.x,c.x),Math.min(l.y,c.y)),x=f.sub(y),S=(M.width-(i.left+i.right+g.padding.left+g.padding.right))/x.x,C=(M.height-(i.top+i.bottom+g.padding.top+g.padding.bottom))/x.y;if(C<0||S<0)return void h.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const z=Math.min(M.scaleZoom(M.scale*Math.min(S,C)),g.maxZoom),G=h.P.convert(g.offset),N=new h.P((g.padding.left-g.padding.right)/2,(g.padding.top-g.padding.bottom)/2).rotate(d*Math.PI/180),Z=G.add(N).mult(M.scale/M.zoomScale(z));return{center:M.unproject(n.add(s).div(2).sub(Z)),zoom:z,bearing:d}}fitBounds(t,a,d){return this._fitInternal(this.cameraForBounds(t,a),a,d)}fitScreenCoordinates(t,a,d,g,b){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(h.P.convert(t)),this.transform.pointLocation(h.P.convert(a)),d,g),g,b)}_fitInternal(t,a,d){return t?(delete(a=h.e(t,a)).padding,a.linear?this.easeTo(a,d):this.flyTo(a,d)):this}jumpTo(t,a){this.stop();const d=this._getTransformForUpdate();let g=!1,b=!1,M=!1;return"zoom"in t&&d.zoom!==+t.zoom&&(g=!0,d.zoom=+t.zoom),t.center!==void 0&&(d.center=h.L.convert(t.center)),"bearing"in t&&d.bearing!==+t.bearing&&(b=!0,d.bearing=+t.bearing),"pitch"in t&&d.pitch!==+t.pitch&&(M=!0,d.pitch=+t.pitch),t.padding==null||d.isPaddingEqual(t.padding)||(d.padding=t.padding),this._applyUpdatedTransform(d),this.fire(new h.k("movestart",a)).fire(new h.k("move",a)),g&&this.fire(new h.k("zoomstart",a)).fire(new h.k("zoom",a)).fire(new h.k("zoomend",a)),b&&this.fire(new h.k("rotatestart",a)).fire(new h.k("rotate",a)).fire(new h.k("rotateend",a)),M&&this.fire(new h.k("pitchstart",a)).fire(new h.k("pitch",a)).fire(new h.k("pitchend",a)),this.fire(new h.k("moveend",a))}calculateCameraOptionsFromTo(t,a,d,g=0){const b=h.U.fromLngLat(t,a),M=h.U.fromLngLat(d,g),i=M.x-b.x,n=M.y-b.y,s=M.z-b.z,l=Math.hypot(i,n,s);if(l===0)throw new Error("Can't calculate camera options with same From and To");const c=Math.hypot(i,n),f=this.transform.scaleZoom(this.transform.cameraToCenterDistance/l/this.transform.tileSize),y=180*Math.atan2(i,-n)/Math.PI;let x=180*Math.acos(c/l)/Math.PI;return x=s<0?90-x:90+x,{center:M.toLngLat(),zoom:f,pitch:x,bearing:y}}easeTo(t,a){this._stop(!1,t.easeId),((t=h.e({offset:[0,0],duration:500,easing:h.bb},t)).animate===!1||!t.essential&&h.h.prefersReducedMotion)&&(t.duration=0);const d=this._getTransformForUpdate(),g=this.getZoom(),b=this.getBearing(),M=this.getPitch(),i=this.getPadding(),n="zoom"in t?+t.zoom:g,s="bearing"in t?this._normalizeBearing(t.bearing,b):b,l="pitch"in t?+t.pitch:M,c="padding"in t?t.padding:d.padding,f=h.P.convert(t.offset);let y=d.centerPoint.add(f);const x=d.pointLocation(y),S=h.L.convert(t.center||x);this._normalizeCenter(S);const C=d.project(x),z=d.project(S).sub(C),G=d.zoomScale(n-g);let N,Z;t.around&&(N=h.L.convert(t.around),Z=d.locationPoint(N));const Q={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||n!==g,this._rotating=this._rotating||b!==s,this._pitching=this._pitching||l!==M,this._padding=!d.isPaddingEqual(c),this._easeId=t.easeId,this._prepareEase(a,t.noMoveStart,Q),this.terrain&&this._prepareElevation(S),this._ease(ee=>{if(this._zooming&&(d.zoom=h.B.number(g,n,ee)),this._rotating&&(d.bearing=h.B.number(b,s,ee)),this._pitching&&(d.pitch=h.B.number(M,l,ee)),this._padding&&(d.interpolatePadding(i,c,ee),y=d.centerPoint.add(f)),this.terrain&&!t.freezeElevation&&this._updateElevation(ee),N)d.setLocationAtPoint(N,Z);else{const he=d.zoomScale(d.zoom-g),ge=n>g?Math.min(2,G):Math.max(.5,G),oe=Math.pow(ge,1-ee),fe=d.unproject(C.add(z.mult(ee*oe)).mult(he));d.setLocationAtPoint(d.renderWorldCopies?fe.wrap():fe,y)}this._applyUpdatedTransform(d),this._fireMoveEvents(a)},ee=>{this.terrain&&this._finalizeElevation(),this._afterEase(a,ee)},t),this}_prepareEase(t,a,d={}){this._moving=!0,a||d.moving||this.fire(new h.k("movestart",t)),this._zooming&&!d.zooming&&this.fire(new h.k("zoomstart",t)),this._rotating&&!d.rotating&&this.fire(new h.k("rotatestart",t)),this._pitching&&!d.pitching&&this.fire(new h.k("pitchstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const a=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&a!==this._elevationTarget){const d=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(d-(a-(d*t+this._elevationStart))/(1-t)),this._elevationTarget=a}this.transform.elevation=h.B.number(this._elevationStart,this._elevationTarget,t)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(t){if(!this.transformCameraUpdate)return;const a=t.clone(),{center:d,zoom:g,pitch:b,bearing:M,elevation:i}=this.transformCameraUpdate(a);d&&(a.center=d),g!==void 0&&(a.zoom=g),b!==void 0&&(a.pitch=b),M!==void 0&&(a.bearing=M),i!==void 0&&(a.elevation=i),this.transform.apply(a)}_fireMoveEvents(t){this.fire(new h.k("move",t)),this._zooming&&this.fire(new h.k("zoom",t)),this._rotating&&this.fire(new h.k("rotate",t)),this._pitching&&this.fire(new h.k("pitch",t))}_afterEase(t,a){if(this._easeId&&a&&this._easeId===a)return;delete this._easeId;const d=this._zooming,g=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,d&&this.fire(new h.k("zoomend",t)),g&&this.fire(new h.k("rotateend",t)),b&&this.fire(new h.k("pitchend",t)),this.fire(new h.k("moveend",t))}flyTo(t,a){if(!t.essential&&h.h.prefersReducedMotion){const Ce=h.F(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ce,a)}this.stop(),t=h.e({offset:[0,0],speed:1.2,curve:1.42,easing:h.bb},t);const d=this._getTransformForUpdate(),g=this.getZoom(),b=this.getBearing(),M=this.getPitch(),i=this.getPadding(),n="zoom"in t?h.ad(+t.zoom,d.minZoom,d.maxZoom):g,s="bearing"in t?this._normalizeBearing(t.bearing,b):b,l="pitch"in t?+t.pitch:M,c="padding"in t?t.padding:d.padding,f=d.zoomScale(n-g),y=h.P.convert(t.offset);let x=d.centerPoint.add(y);const S=d.pointLocation(x),C=h.L.convert(t.center||S);this._normalizeCenter(C);const z=d.project(S),G=d.project(C).sub(z);let N=t.curve;const Z=Math.max(d.width,d.height),Q=Z/f,ee=G.mag();if("minZoom"in t){const Ce=h.ad(Math.min(t.minZoom,g,n),d.minZoom,d.maxZoom),vt=Z/d.zoomScale(Ce-g);N=Math.sqrt(vt/ee*2)}const he=N*N;function ge(Ce){const vt=(Q*Q-Z*Z+(Ce?-1:1)*he*he*ee*ee)/(2*(Ce?Q:Z)*he*ee);return Math.log(Math.sqrt(vt*vt+1)-vt)}function oe(Ce){return(Math.exp(Ce)-Math.exp(-Ce))/2}function fe(Ce){return(Math.exp(Ce)+Math.exp(-Ce))/2}const pe=ge(!1);let Fe=function(Ce){return fe(pe)/fe(pe+N*Ce)},Me=function(Ce){return Z*((fe(pe)*(oe(vt=pe+N*Ce)/fe(vt))-oe(pe))/he)/ee;var vt},Pe=(ge(!0)-pe)/N;if(Math.abs(ee)<1e-6||!isFinite(Pe)){if(Math.abs(Z-Q)<1e-6)return this.easeTo(t,a);const Ce=Q<Z?-1:1;Pe=Math.abs(Math.log(Q/Z))/N,Me=function(){return 0},Fe=function(vt){return Math.exp(Ce*N*vt)}}return t.duration="duration"in t?+t.duration:1e3*Pe/("screenSpeed"in t?+t.screenSpeed/N:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=b!==s,this._pitching=l!==M,this._padding=!d.isPaddingEqual(c),this._prepareEase(a,!1),this.terrain&&this._prepareElevation(C),this._ease(Ce=>{const vt=Ce*Pe,at=1/Fe(vt);d.zoom=Ce===1?n:g+d.scaleZoom(at),this._rotating&&(d.bearing=h.B.number(b,s,Ce)),this._pitching&&(d.pitch=h.B.number(M,l,Ce)),this._padding&&(d.interpolatePadding(i,c,Ce),x=d.centerPoint.add(y)),this.terrain&&!t.freezeElevation&&this._updateElevation(Ce);const rt=Ce===1?C:d.unproject(z.add(G.mult(Me(vt))).mult(at));d.setLocationAtPoint(d.renderWorldCopies?rt.wrap():rt,x),this._applyUpdatedTransform(d),this._fireMoveEvents(a)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(a)},t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,a){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const d=this._onEaseEnd;delete this._onEaseEnd,d.call(this,a)}if(!t){const d=this.handlers;d&&d.stop(!1)}return this}_ease(t,a,d){d.animate===!1||d.duration===0?(t(1),a()):(this._easeStart=h.h.now(),this._easeOptions=d,this._onEaseFrame=t,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,a){t=h.b5(t,-180,180);const d=Math.abs(t-a);return Math.abs(t-360-a)<d&&(t-=360),Math.abs(t+360-a)<d&&(t+=360),t}_normalizeCenter(t){const a=this.transform;if(!a.renderWorldCopies||a.lngRange)return;const d=t.lng-a.center.lng;t.lng+=d>180?-360:d<-180?360:0}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLatZoom(h.L.convert(t),this.transform.tileZoom)-this.transform.elevation:null}}class Tr{constructor(t={}){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=a=>{!a||a.sourceDataType!=="metadata"&&a.sourceDataType!=="visibility"&&a.dataType!=="style"&&a.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options&&this.options.compact,this._container=R.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=R.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=R.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){R.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,a){const d=this._map._getUIString(`AttributionControl.${a}`);t.title=d,t.setAttribute("aria-label",d)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(g=>typeof g!="string"?"":g)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const g=this._map.style.stylesheet;this.styleOwner=g.owner,this.styleId=g.id}const a=this._map.style.sourceCaches;for(const g in a){const b=a[g];if(b.used||b.usedForTerrain){const M=b.getSource();M.attribution&&t.indexOf(M.attribution)<0&&t.push(M.attribution)}}t=t.filter(g=>String(g).trim()),t.sort((g,b)=>g.length-b.length),t=t.filter((g,b)=>{for(let M=b+1;M<t.length;M++)if(t[M].indexOf(g)>=0)return!1;return!0});const d=t.join(" | ");d!==this._attribHTML&&(this._attribHTML=d,t.length?(this._innerContainer.innerHTML=d,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class yi{constructor(t={}){this._updateCompact=()=>{const a=this._container.children;if(a.length){const d=a[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&d.classList.add("maplibregl-compact"):d.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=R.create("div","maplibregl-ctrl");const a=R.create("a","maplibregl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://maplibre.org/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){R.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class qn{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const a=++this._id;return this._queue.push({callback:t,id:a,cancelled:!1}),a}remove(t){const a=this._currentlyRunning,d=a?this._queue.concat(a):this._queue;for(const g of d)if(g.id===t)return void(g.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const a=this._currentlyRunning=this._queue;this._queue=[];for(const d of a)if(!d.cancelled&&(d.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const yr={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"};var kl=h.Q([{name:"a_pos3d",type:"Int16",components:3}]);class El extends h.E{constructor(t){super(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,t.usedForTerrain=!0,t.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(t,a){this.sourceCache.update(t,a),this._renderableTilesKeys=[];const d={};for(const g of t.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:a}))d[g.key]=!0,this._renderableTilesKeys.push(g.key),this._tiles[g.key]||(g.posMatrix=new Float64Array(16),h.aS(g.posMatrix,0,h.N,0,h.N,0,1),this._tiles[g.key]=new Lr(g,this.tileSize));for(const g in this._tiles)d[g]||delete this._tiles[g]}freeRtt(t){for(const a in this._tiles){const d=this._tiles[a];(!t||d.tileID.equals(t)||d.tileID.isChildOf(t)||t.isChildOf(d.tileID))&&(d.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t){const a={};for(const d of this._renderableTilesKeys){const g=this._tiles[d].tileID;if(g.canonical.equals(t.canonical)){const b=t.clone();b.posMatrix=new Float64Array(16),h.aS(b.posMatrix,0,h.N,0,h.N,0,1),a[d]=b}else if(g.canonical.isChildOf(t.canonical)){const b=t.clone();b.posMatrix=new Float64Array(16);const M=g.canonical.z-t.canonical.z,i=g.canonical.x-(g.canonical.x>>M<<M),n=g.canonical.y-(g.canonical.y>>M<<M),s=h.N>>M;h.aS(b.posMatrix,0,s,0,s,0,1),h.$(b.posMatrix,b.posMatrix,[-i*s,-n*s,0]),a[d]=b}else if(t.canonical.isChildOf(g.canonical)){const b=t.clone();b.posMatrix=new Float64Array(16);const M=t.canonical.z-g.canonical.z,i=t.canonical.x-(t.canonical.x>>M<<M),n=t.canonical.y-(t.canonical.y>>M<<M),s=h.N>>M;h.aS(b.posMatrix,0,h.N,0,h.N,0,1),h.$(b.posMatrix,b.posMatrix,[i*s,n*s,0]),h.a0(b.posMatrix,b.posMatrix,[1/2**M,1/2**M,0]),a[d]=b}}return a}getSourceTile(t,a){const d=this.sourceCache._source;let g=t.overscaledZ-this.deltaZoom;if(g>d.maxzoom&&(g=d.maxzoom),g<d.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(g).key);let b=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!b||!b.dem)&&a)for(;g>=d.minzoom&&(!b||!b.dem);)b=this.sourceCache.getTileByID(t.scaledTo(g--).key);return b}tilesAfterTime(t=Date.now()){return Object.values(this._tiles).filter(a=>a.timeAdded>=t)}}class Sl{constructor(t,a,d){this.painter=t,this.sourceCache=new El(a),this.options=d,this.exaggeration=typeof d.exaggeration=="number"?d.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,a,d,g=h.N){var b;if(!(a>=0&&a<g&&d>=0&&d<g))return 0;const M=this.getTerrainData(t),i=(b=M.tile)===null||b===void 0?void 0:b.dem;if(!i)return 0;const n=function(x,S,C){var z=S[0],G=S[1];return x[0]=C[0]*z+C[4]*G+C[12],x[1]=C[1]*z+C[5]*G+C[13],x}([],[a/g*h.N,d/g*h.N],M.u_terrain_matrix),s=[n[0]*i.dim,n[1]*i.dim],l=Math.floor(s[0]),c=Math.floor(s[1]),f=s[0]-l,y=s[1]-c;return i.get(l,c)*(1-f)*(1-y)+i.get(l+1,c)*f*(1-y)+i.get(l,c+1)*(1-f)*y+i.get(l+1,c+1)*f*y}getElevationForLngLatZoom(t,a){const{tileID:d,mercatorX:g,mercatorY:b}=this._getOverscaledTileIDFromLngLatZoom(t,a);return this.getElevation(d,g%h.N,b%h.N,h.N)}getElevation(t,a,d,g=h.N){return this.getDEMElevation(t,a,d,g)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const g=this.painter.context,b=new h.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Lt(g,b,g.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Lt(g,new h.R({width:1,height:1}),g.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(g.gl.NEAREST,g.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=h.ao([])}const a=this.sourceCache.getSourceTile(t,!0);if(a&&a.dem&&(!a.demTexture||a.needsTerrainPrepare)){const g=this.painter.context;a.demTexture=this.painter.getTileTexture(a.dem.stride),a.demTexture?a.demTexture.update(a.dem.getPixels(),{premultiply:!1}):a.demTexture=new Lt(g,a.dem.getPixels(),g.gl.RGBA,{premultiply:!1}),a.demTexture.bind(g.gl.NEAREST,g.gl.CLAMP_TO_EDGE),a.needsTerrainPrepare=!1}const d=a&&a+a.tileID.key+t.key;if(d&&!this._demMatrixCache[d]){const g=this.sourceCache.sourceCache._source.maxzoom;let b=t.canonical.z-a.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=g?b=t.canonical.z-g:h.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const M=t.canonical.x-(t.canonical.x>>b<<b),i=t.canonical.y-(t.canonical.y>>b<<b),n=h.bc(new Float64Array(16),[1/(h.N<<b),1/(h.N<<b),0]);h.$(n,n,[M*h.N,i*h.N,0]),this._demMatrixCache[t.key]={matrix:n,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:a&&a.dem&&a.dem.dim||1,u_terrain_matrix:d?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:a&&a.dem&&a.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(a&&a.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:a}}getFramebuffer(t){const a=this.painter,d=a.width/devicePixelRatio,g=a.height/devicePixelRatio;return!this._fbo||this._fbo.width===d&&this._fbo.height===g||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Lt(a.context,{width:d,height:g,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Lt(a.context,{width:d,height:g,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=a.context.createFramebuffer(d,g,!0,!1),this._fbo.depthAttachment.set(a.context.createRenderbuffer(a.context.gl.DEPTH_COMPONENT16,d,g))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const a=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let b=0,M=0;b<this._coordsTextureSize;b++)for(let i=0;i<this._coordsTextureSize;i++,M+=4)a[M+0]=255&i,a[M+1]=255&b,a[M+2]=i>>8<<4|b>>8,a[M+3]=0;const d=new h.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(a.buffer)),g=new Lt(t,d,t.gl.RGBA,{premultiply:!1});return g.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=g,g}pointCoordinate(t){const a=new Uint8Array(4),d=this.painter.context,g=d.gl;d.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),g.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,g.RGBA,g.UNSIGNED_BYTE,a),d.bindFramebuffer.set(null);const b=a[0]+(a[2]>>4<<8),M=a[1]+((15&a[2])<<8),i=this.coordsIndex[255-a[3]],n=i&&this.sourceCache.getTileByID(i);if(!n)return null;const s=this._coordsTextureSize,l=(1<<n.tileID.canonical.z)*s;return new h.U(this._allowMercatorOverflow(t,(n.tileID.canonical.x*s+b)/l),(n.tileID.canonical.y*s+M)/l,this.getElevation(n.tileID,b,M,s))}getTerrainMesh(){if(this._mesh)return this._mesh;const t=this.painter.context,a=new h.bd,d=new h.b0,g=this.meshSize,b=h.N/g,M=g*g;for(let c=0;c<=g;c++)for(let f=0;f<=g;f++)a.emplaceBack(f*b,c*b,0);for(let c=0;c<M;c+=g+1)for(let f=0;f<g;f++)d.emplaceBack(f+c,g+f+c+1,g+f+c+2),d.emplaceBack(f+c,g+f+c+2,f+c+1);const i=a.length,n=i+2*(g+1);for(const c of[0,1])for(let f=0;f<=g;f++)for(const y of[0,1])a.emplaceBack(f*b,c*h.N,y);for(let c=0;c<2*g;c+=2)d.emplaceBack(n+c,n+c+1,n+c+3),d.emplaceBack(n+c,n+c+3,n+c+2),d.emplaceBack(i+c,i+c+3,i+c+1),d.emplaceBack(i+c,i+c+2,i+c+3);const s=a.length,l=s+2*(g+1);for(const c of[0,1])for(let f=0;f<=g;f++)for(const y of[0,1])a.emplaceBack(c*h.N,f*b,y);for(let c=0;c<2*g;c+=2)d.emplaceBack(s+c,s+c+1,s+c+3),d.emplaceBack(s+c,s+c+3,s+c+2),d.emplaceBack(l+c,l+c+3,l+c+1),d.emplaceBack(l+c,l+c+2,l+c+3);return this._mesh={indexBuffer:t.createIndexBuffer(d),vertexBuffer:t.createVertexBuffer(a,kl.members),segments:h.S.simpleSegment(0,0,a.length,d.length)},this._mesh}getMeshFrameDelta(t){return 2*Math.PI*h.be/Math.pow(2,t)/5}getMinTileElevationForLngLatZoom(t,a){var d;const{tileID:g}=this._getOverscaledTileIDFromLngLatZoom(t,a);return(d=this.getMinMaxElevation(g).minElevation)!==null&&d!==void 0?d:0}getMinMaxElevation(t){const a=this.getTerrainData(t).tile,d={minElevation:null,maxElevation:null};return a&&a.dem&&(d.minElevation=a.dem.min*this.exaggeration,d.maxElevation=a.dem.max*this.exaggeration),d}_getOverscaledTileIDFromLngLatZoom(t,a){const d=h.U.fromLngLat(t.wrap()),g=(1<<a)*h.N,b=d.x*g,M=d.y*g,i=Math.floor(b/h.N),n=Math.floor(M/h.N);return{tileID:new h.O(a,0,a,i,n),mercatorX:b,mercatorY:M}}_allowMercatorOverflow(t,a){const d=t.x<this.painter.width/2;let g=h.bf(a);const b=this.painter.transform.center.lng;return d&&Math.sign(g)>0&&Math.sign(b)<0||!d&&Math.sign(g)<0&&Math.sign(b)>0?(g=360*Math.sign(b)+g,h.G(g)):a}}class Tl{constructor(t,a,d){this._context=t,this._size=a,this._tileSize=d,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const a=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),d=new Lt(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return d.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),a.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),a.colorAttachment.set(d.texture),{id:t,fbo:a,texture:d,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(a=>t.id!==a),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const a of this._recentlyUsed)if(!this._objects[a].inUse)return this._objects[a];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(t=>!t.inUse)===!1}}const or={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Eo{constructor(t,a){this.painter=t,this.terrain=a,this.pool=new Tl(t.context,30,a.sourceCache.tileSize*a.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,a){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=t._order.filter(d=>!t._layers[d].isHidden(a)),this._coordsDescendingInv={};for(const d in t.sourceCaches){this._coordsDescendingInv[d]={};const g=t.sourceCaches[d].getVisibleCoordinates();for(const b of g){const M=this.terrain.sourceCache.getTerrainCoords(b);for(const i in M)this._coordsDescendingInv[d][i]||(this._coordsDescendingInv[d][i]=[]),this._coordsDescendingInv[d][i].push(M[i])}}this._coordsDescendingInvStr={};for(const d of t._order){const g=t._layers[d],b=g.source;if(or[g.type]&&!this._coordsDescendingInvStr[b]){this._coordsDescendingInvStr[b]={};for(const M in this._coordsDescendingInv[b])this._coordsDescendingInvStr[b][M]=this._coordsDescendingInv[b][M].map(i=>i.key).sort().join()}}for(const d of this._renderableTiles)for(const g in this._coordsDescendingInvStr){const b=this._coordsDescendingInvStr[g][d.tileID.key];b&&b!==d.rttCoords[g]&&(d.rtt=[])}}renderLayer(t){if(t.isHidden(this.painter.transform.zoom))return!1;const a=t.type,d=this.painter,g=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(or[a]&&(this._prevType&&or[this._prevType]||this._stacks.push([]),this._prevType=a,this._stacks[this._stacks.length-1].push(t.id),!g))return!0;if(or[this._prevType]||or[a]&&g){this._prevType=a;const b=this._stacks.length-1,M=this._stacks[b]||[];for(const i of this._renderableTiles){if(this.pool.isFull()&&(Ai(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(i),i.rtt[b]){const s=this.pool.getObjectForId(i.rtt[b].id);if(s.stamp===i.rtt[b].stamp){this.pool.useObject(s);continue}}const n=this.pool.getOrCreateFreeObject();this.pool.useObject(n),this.pool.stampObject(n),i.rtt[b]={id:n.id,stamp:n.stamp},d.context.bindFramebuffer.set(n.fbo.framebuffer),d.context.clear({color:h.aT.transparent,stencil:0}),d.currentStencilSource=void 0;for(let s=0;s<M.length;s++){const l=d.style._layers[M[s]],c=l.source?this._coordsDescendingInv[l.source][i.tileID.key]:[i.tileID];d.context.viewport.set([0,0,n.fbo.width,n.fbo.height]),d._renderTileClippingMasks(l,c),d.renderLayer(d,d.style.sourceCaches[l.source],l,c),l.source&&(i.rttCoords[l.source]=this._coordsDescendingInvStr[l.source][i.tileID.key])}}return Ai(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),or[a]}return!1}}const ht=U,wt={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:h.c.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},So=v=>{v.touchstart=v.dragStart,v.touchmoveWindow=v.dragMove,v.touchend=v.dragEnd},Ga={showCompass:!0,showZoom:!0,visualizePitch:!1};class ja{constructor(t,a,d=!1){this.mousedown=M=>{this.startMouse(h.e({},M,{ctrlKey:!0,preventDefault:()=>M.preventDefault()}),R.mousePos(this.element,M)),R.addEventListener(window,"mousemove",this.mousemove),R.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=M=>{this.moveMouse(M,R.mousePos(this.element,M))},this.mouseup=M=>{this.mouseRotate.dragEnd(M),this.mousePitch&&this.mousePitch.dragEnd(M),this.offTemp()},this.touchstart=M=>{M.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=R.touchPos(this.element,M.targetTouches)[0],this.startTouch(M,this._startPos),R.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),R.addEventListener(window,"touchend",this.touchend))},this.touchmove=M=>{M.targetTouches.length!==1?this.reset():(this._lastPos=R.touchPos(this.element,M.targetTouches)[0],this.moveTouch(M,this._lastPos))},this.touchend=M=>{M.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const g=t.dragRotate._mouseRotate.getClickTolerance(),b=t.dragRotate._mousePitch.getClickTolerance();this.element=a,this.mouseRotate=us({clickTolerance:g,enable:!0}),this.touchRotate=(({enable:M,clickTolerance:i,bearingDegreesPerPixelMoved:n=.8})=>{const s=new vl;return new In({clickTolerance:i,move:(l,c)=>({bearingDelta:(c.x-l.x)*n}),moveStateManager:s,enable:M,assignEvents:So})})({clickTolerance:g,enable:!0}),this.map=t,d&&(this.mousePitch=Mn({clickTolerance:b,enable:!0}),this.touchPitch=(({enable:M,clickTolerance:i,pitchDegreesPerPixelMoved:n=-.5})=>{const s=new vl;return new In({clickTolerance:i,move:(l,c)=>({pitchDelta:(c.y-l.y)*n}),moveStateManager:s,enable:M,assignEvents:So})})({clickTolerance:b,enable:!0})),R.addEventListener(a,"mousedown",this.mousedown),R.addEventListener(a,"touchstart",this.touchstart,{passive:!1}),R.addEventListener(a,"touchcancel",this.reset)}startMouse(t,a){this.mouseRotate.dragStart(t,a),this.mousePitch&&this.mousePitch.dragStart(t,a),R.disableDrag()}startTouch(t,a){this.touchRotate.dragStart(t,a),this.touchPitch&&this.touchPitch.dragStart(t,a),R.disableDrag()}moveMouse(t,a){const d=this.map,{bearingDelta:g}=this.mouseRotate.dragMove(t,a)||{};if(g&&d.setBearing(d.getBearing()+g),this.mousePitch){const{pitchDelta:b}=this.mousePitch.dragMove(t,a)||{};b&&d.setPitch(d.getPitch()+b)}}moveTouch(t,a){const d=this.map,{bearingDelta:g}=this.touchRotate.dragMove(t,a)||{};if(g&&d.setBearing(d.getBearing()+g),this.touchPitch){const{pitchDelta:b}=this.touchPitch.dragMove(t,a)||{};b&&d.setPitch(d.getPitch()+b)}}off(){const t=this.element;R.removeEventListener(t,"mousedown",this.mousedown),R.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),R.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),R.removeEventListener(window,"touchend",this.touchend),R.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){R.enableDrag(),R.removeEventListener(window,"mousemove",this.mousemove),R.removeEventListener(window,"mouseup",this.mouseup),R.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),R.removeEventListener(window,"touchend",this.touchend)}}let Di;function fn(v,t,a){if(v=new h.L(v.lng,v.lat),t){const d=new h.L(v.lng-360,v.lat),g=new h.L(v.lng+360,v.lat),b=a.locationPoint(v).distSqr(t);a.locationPoint(d).distSqr(t)<b?v=d:a.locationPoint(g).distSqr(t)<b&&(v=g)}for(;Math.abs(v.lng-a.center.lng)>180;){const d=a.locationPoint(v);if(d.x>=0&&d.y>=0&&d.x<=a.width&&d.y<=a.height)break;v.lng>a.center.lng?v.lng-=360:v.lng+=360}return v}const Bi={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Ct(v,t,a){const d=v.classList;for(const g in Bi)d.remove(`maplibregl-${a}-anchor-${g}`);d.add(`maplibregl-${a}-anchor-${t}`)}class ar extends h.E{constructor(t){if(super(),this._onKeyPress=a=>{const d=a.code,g=a.charCode||a.keyCode;d!=="Space"&&d!=="Enter"&&g!==32&&g!==13||this.togglePopup()},this._onMapClick=a=>{const d=a.originalEvent.target,g=this._element;this._popup&&(d===g||g.contains(d))&&this.togglePopup()},this._update=a=>{if(!this._map)return;const d=this._map.loaded()&&!this._map.isMoving();((a==null?void 0:a.type)==="terrain"||(a==null?void 0:a.type)==="render"&&!d)&&this._map.once("render",this._update),this._map.transform.renderWorldCopies&&(this._lngLat=fn(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let g="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?g=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(g=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let b="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?b="rotateX(0deg)":this._pitchAlignment==="map"&&(b=`rotateX(${this._map.getPitch()}deg)`),a&&a.type!=="moveend"||(this._pos=this._pos.round()),R.setTransform(this._element,`${Bi[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${b} ${g}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const M=this._map.unproject(this._pos),i=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=M.distanceTo(this._lngLat)>20*i?"0.2":"1.0",this._opacityTimeout=null},100))},this._onMove=a=>{if(!this._isDragging){const d=this._clickTolerance||this._map._clickTolerance;this._isDragging=a.point.dist(this._pointerdownPos)>=d}this._isDragging&&(this._pos=a.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new h.k("dragstart"))),this.fire(new h.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new h.k("dragend")),this._state="inactive"},this._addDragHandler=a=>{this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(this._pos).add(this._offset),this._pointerdownPos=a.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,t&&t.element)this._element=t.element,this._offset=h.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=R.create("div"),this._element.setAttribute("aria-label","Map marker");const a=R.createNS("http://www.w3.org/2000/svg","svg"),d=41,g=27;a.setAttributeNS(null,"display","block"),a.setAttributeNS(null,"height",`${d}px`),a.setAttributeNS(null,"width",`${g}px`),a.setAttributeNS(null,"viewBox",`0 0 ${g} ${d}`);const b=R.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"stroke","none"),b.setAttributeNS(null,"stroke-width","1"),b.setAttributeNS(null,"fill","none"),b.setAttributeNS(null,"fill-rule","evenodd");const M=R.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"fill-rule","nonzero");const i=R.createNS("http://www.w3.org/2000/svg","g");i.setAttributeNS(null,"transform","translate(3.0, 29.0)"),i.setAttributeNS(null,"fill","#000000");const n=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const z of n){const G=R.createNS("http://www.w3.org/2000/svg","ellipse");G.setAttributeNS(null,"opacity","0.04"),G.setAttributeNS(null,"cx","10.5"),G.setAttributeNS(null,"cy","5.80029008"),G.setAttributeNS(null,"rx",z.rx),G.setAttributeNS(null,"ry",z.ry),i.appendChild(G)}const s=R.createNS("http://www.w3.org/2000/svg","g");s.setAttributeNS(null,"fill",this._color);const l=R.createNS("http://www.w3.org/2000/svg","path");l.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),s.appendChild(l);const c=R.createNS("http://www.w3.org/2000/svg","g");c.setAttributeNS(null,"opacity","0.25"),c.setAttributeNS(null,"fill","#000000");const f=R.createNS("http://www.w3.org/2000/svg","path");f.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),c.appendChild(f);const y=R.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"transform","translate(6.0, 7.0)"),y.setAttributeNS(null,"fill","#FFFFFF");const x=R.createNS("http://www.w3.org/2000/svg","g");x.setAttributeNS(null,"transform","translate(8.0, 8.0)");const S=R.createNS("http://www.w3.org/2000/svg","circle");S.setAttributeNS(null,"fill","#000000"),S.setAttributeNS(null,"opacity","0.25"),S.setAttributeNS(null,"cx","5.5"),S.setAttributeNS(null,"cy","5.5"),S.setAttributeNS(null,"r","5.4999962");const C=R.createNS("http://www.w3.org/2000/svg","circle");C.setAttributeNS(null,"fill","#FFFFFF"),C.setAttributeNS(null,"cx","5.5"),C.setAttributeNS(null,"cy","5.5"),C.setAttributeNS(null,"r","5.4999962"),x.appendChild(S),x.appendChild(C),M.appendChild(i),M.appendChild(s),M.appendChild(c),M.appendChild(y),M.appendChild(x),a.appendChild(M),a.setAttributeNS(null,"height",d*this._scale+"px"),a.setAttributeNS(null,"width",g*this._scale+"px"),this._element.appendChild(a),this._offset=h.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",a=>{a.preventDefault()}),this._element.addEventListener("mousedown",a=>{a.preventDefault()}),Ct(this._element,this._anchor,"marker"),t&&t.className)for(const a of t.className.split(" "))this._element.classList.add(a);this._popup=null}addTo(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),R.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=h.L.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const g=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,-1*(38.1-13.5+g)],"bottom-right":[-g,-1*(38.1-13.5+g)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this}getOffset(){return this._offset}setOffset(t){return this._offset=h.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const yt={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let $t=0,cs=!1;const hs={maxWidth:100,unit:"metric"};function en(v,t,a){const d=a&&a.maxWidth||100,g=v._container.clientHeight/2,b=v.unproject([0,g]),M=v.unproject([d,g]),i=b.distanceTo(M);if(a&&a.unit==="imperial"){const n=3.2808*i;n>5280?fs(t,d,n/5280,v._getUIString("ScaleControl.Miles")):fs(t,d,n,v._getUIString("ScaleControl.Feet"))}else a&&a.unit==="nautical"?fs(t,d,i/1852,v._getUIString("ScaleControl.NauticalMiles")):i>=1e3?fs(t,d,i/1e3,v._getUIString("ScaleControl.Kilometers")):fs(t,d,i,v._getUIString("ScaleControl.Meters"))}function fs(v,t,a,d){const g=function(b){const M=Math.pow(10,`${Math.floor(b)}`.length-1);let i=b/M;return i=i>=10?10:i>=5?5:i>=3?3:i>=2?2:i>=1?1:function(n){const s=Math.pow(10,Math.ceil(-Math.log(n)/Math.LN10));return Math.round(n*s)/s}(i),M*i}(a);v.style.width=t*(g/a)+"px",v.innerHTML=`${g}&nbsp;${d}`}const Qi={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},$s=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function tn(v){if(v){if(typeof v=="number"){const t=Math.round(Math.abs(v)/Math.SQRT2);return{center:new h.P(0,0),top:new h.P(0,v),"top-left":new h.P(t,t),"top-right":new h.P(-t,t),bottom:new h.P(0,-v),"bottom-left":new h.P(t,-t),"bottom-right":new h.P(-t,-t),left:new h.P(v,0),right:new h.P(-v,0)}}if(v instanceof h.P||Array.isArray(v)){const t=h.P.convert(v);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:h.P.convert(v.center||[0,0]),top:h.P.convert(v.top||[0,0]),"top-left":h.P.convert(v["top-left"]||[0,0]),"top-right":h.P.convert(v["top-right"]||[0,0]),bottom:h.P.convert(v.bottom||[0,0]),"bottom-left":h.P.convert(v["bottom-left"]||[0,0]),"bottom-right":h.P.convert(v["bottom-right"]||[0,0]),left:h.P.convert(v.left||[0,0]),right:h.P.convert(v.right||[0,0])}}return tn(new h.P(0,0))}const aa={extend:(v,...t)=>h.e(v,...t),run(v){v()},logToElement(v,t=!1,a="log"){const d=window.document.getElementById(a);d&&(t&&(d.innerHTML=""),d.innerHTML+=`<br>${v}`)}},Ge=U;class Oe{static get version(){return Ge}static get workerCount(){return Rr.workerCount}static set workerCount(t){Rr.workerCount=t}static get maxParallelImageRequests(){return h.c.MAX_PARALLEL_IMAGE_REQUESTS}static set maxParallelImageRequests(t){h.c.MAX_PARALLEL_IMAGE_REQUESTS=t}static get workerUrl(){return h.c.WORKER_URL}static set workerUrl(t){h.c.WORKER_URL=t}static addProtocol(t,a){h.c.REGISTERED_PROTOCOLS[t]=a}static removeProtocol(t){delete h.c.REGISTERED_PROTOCOLS[t]}}return Oe.Map=class extends Pi{constructor(v){if(h.bg.mark(h.bh.create),(v=h.e({},wt,v)).minZoom!=null&&v.maxZoom!=null&&v.minZoom>v.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(v.minPitch!=null&&v.maxPitch!=null&&v.minPitch>v.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(v.minPitch!=null&&v.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(v.maxPitch!=null&&v.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new ta(v.minZoom,v.maxZoom,v.minPitch,v.maxPitch,v.renderWorldCopies),{bearingSnap:v.bearingSnap}),this._cooperativeGesturesOnWheel=t=>{this._onCooperativeGesture(t,t[this._metaKey],1)},this._contextLost=t=>{t.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new h.k("webglcontextlost",{originalEvent:t}))},this._contextRestored=t=>{this._setupPainter(),this.resize(),this._update(),this.fire(new h.k("webglcontextrestored",{originalEvent:t}))},this._onMapScroll=t=>{if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=v.interactive,this._cooperativeGestures=v.cooperativeGestures,this._metaKey=navigator.platform.indexOf("Mac")===0?"metaKey":"ctrlKey",this._maxTileCacheSize=v.maxTileCacheSize,this._maxTileCacheZoomLevels=v.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=v.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=v.preserveDrawingBuffer,this._antialias=v.antialias,this._trackResize=v.trackResize,this._bearingSnap=v.bearingSnap,this._refreshExpiredTiles=v.refreshExpiredTiles,this._fadeDuration=v.fadeDuration,this._crossSourceCollisions=v.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=v.collectResourceTiming,this._renderTaskQueue=new qn,this._controls=[],this._mapId=h.a2(),this._locale=h.e({},yr,v.locale),this._clickTolerance=v.clickTolerance,this._overridePixelRatio=v.pixelRatio,this._maxCanvasSize=v.maxCanvasSize,this.transformCameraUpdate=v.transformCameraUpdate,this._imageQueueHandle=Te.addThrottleControl(()=>this.isMoving()),this._requestManager=new Ze(v.transformRequest),typeof v.container=="string"){if(this._container=document.getElementById(v.container),!this._container)throw new Error(`Container '${v.container}' not found.`)}else{if(!(v.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=v.container}if(v.maxBounds&&this.setMaxBounds(v.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let t=!1;const a=En(d=>{this._trackResize&&!this._removed&&this.resize(d)._update()},50);this._resizeObserver=new ResizeObserver(d=>{t?a(d):t=!0}),this._resizeObserver.observe(this._container)}this.handlers=new oa(this,v),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=v.hash&&new xo(typeof v.hash=="string"&&v.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:v.center,zoom:v.zoom,bearing:v.bearing,pitch:v.pitch}),v.bounds&&(this.resize(),this.fitBounds(v.bounds,h.e({},v.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=v.localIdeographFontFamily,this._validateStyle=v.validateStyle,v.style&&this.setStyle(v.style,{localIdeographFontFamily:v.localIdeographFontFamily}),v.attributionControl&&this.addControl(new Tr({customAttribution:v.customAttribution})),v.maplibreLogo&&this.addControl(new yi,v.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",t=>{this._update(t.dataType==="style"),this.fire(new h.k(`${t.dataType}data`,t))}),this.on("dataloading",t=>{this.fire(new h.k(`${t.dataType}dataloading`,t))}),this.on("dataabort",t=>{this.fire(new h.k("sourcedataabort",t))})}_getMapId(){return this._mapId}addControl(v,t){if(t===void 0&&(t=v.getDefaultPosition?v.getDefaultPosition():"top-right"),!v||!v.onAdd)return this.fire(new h.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=v.onAdd(this);this._controls.push(v);const d=this._controlPositions[t];return t.indexOf("bottom")!==-1?d.insertBefore(a,d.firstChild):d.appendChild(a),this}removeControl(v){if(!v||!v.onRemove)return this.fire(new h.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(v);return t>-1&&this._controls.splice(t,1),v.onRemove(this),this}hasControl(v){return this._controls.indexOf(v)>-1}calculateCameraOptionsFromTo(v,t,a,d){return d==null&&this.terrain&&(d=this.terrain.getElevationForLngLatZoom(a,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(v,t,a,d)}resize(v){var t;const a=this._containerDimensions(),d=a[0],g=a[1],b=this._getClampedPixelRatio(d,g);if(this._resizeCanvas(d,g,b),this.painter.resize(d,g,b),this.painter.overLimit()){const i=this.painter.context.gl;this._maxCanvasSize=[i.drawingBufferWidth,i.drawingBufferHeight];const n=this._getClampedPixelRatio(d,g);this._resizeCanvas(d,g,n),this.painter.resize(d,g,n)}this.transform.resize(d,g),(t=this._requestedCameraState)===null||t===void 0||t.resize(d,g);const M=!this._moving;return M&&(this.stop(),this.fire(new h.k("movestart",v)).fire(new h.k("move",v))),this.fire(new h.k("resize",v)),M&&this.fire(new h.k("moveend",v)),this}_getClampedPixelRatio(v,t){const{0:a,1:d}=this._maxCanvasSize,g=this.getPixelRatio(),b=v*g,M=t*g;return Math.min(b>a?a/b:1,M>d?d/M:1)*g}getPixelRatio(){var v;return(v=this._overridePixelRatio)!==null&&v!==void 0?v:devicePixelRatio}setPixelRatio(v){this._overridePixelRatio=v,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(v){return this.transform.setMaxBounds(ri.convert(v)),this._update()}setMinZoom(v){if((v=v??-2)>=-2&&v<=this.transform.maxZoom)return this.transform.minZoom=v,this._update(),this.getZoom()<v&&this.setZoom(v),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(v){if((v=v??22)>=this.transform.minZoom)return this.transform.maxZoom=v,this._update(),this.getZoom()>v&&this.setZoom(v),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(v){if((v=v??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(v>=0&&v<=this.transform.maxPitch)return this.transform.minPitch=v,this._update(),this.getPitch()<v&&this.setPitch(v),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(v){if((v=v??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(v>=this.transform.minPitch)return this.transform.maxPitch=v,this._update(),this.getPitch()>v&&this.setPitch(v),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(v){return this.transform.renderWorldCopies=v,this._update()}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(v){return this._cooperativeGestures=v,this._cooperativeGestures?this._setupCooperativeGestures():this._destroyCooperativeGestures(),this}project(v){return this.transform.locationPoint(h.L.convert(v),this.style&&this.terrain)}unproject(v){return this.transform.pointLocation(h.P.convert(v),this.terrain)}isMoving(){var v;return this._moving||((v=this.handlers)===null||v===void 0?void 0:v.isMoving())}isZooming(){var v;return this._zooming||((v=this.handlers)===null||v===void 0?void 0:v.isZooming())}isRotating(){var v;return this._rotating||((v=this.handlers)===null||v===void 0?void 0:v.isRotating())}_createDelegatedListener(v,t,a){if(v==="mouseenter"||v==="mouseover"){let d=!1;return{layer:t,listener:a,delegates:{mousemove:b=>{const M=this.getLayer(t)?this.queryRenderedFeatures(b.point,{layers:[t]}):[];M.length?d||(d=!0,a.call(this,new Er(v,this,b.originalEvent,{features:M}))):d=!1},mouseout:()=>{d=!1}}}}if(v==="mouseleave"||v==="mouseout"){let d=!1;return{layer:t,listener:a,delegates:{mousemove:M=>{(this.getLayer(t)?this.queryRenderedFeatures(M.point,{layers:[t]}):[]).length?d=!0:d&&(d=!1,a.call(this,new Er(v,this,M.originalEvent)))},mouseout:M=>{d&&(d=!1,a.call(this,new Er(v,this,M.originalEvent)))}}}}{const d=g=>{const b=this.getLayer(t)?this.queryRenderedFeatures(g.point,{layers:[t]}):[];b.length&&(g.features=b,a.call(this,g),delete g.features)};return{layer:t,listener:a,delegates:{[v]:d}}}}on(v,t,a){if(a===void 0)return super.on(v,t);const d=this._createDelegatedListener(v,t,a);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[v]=this._delegatedListeners[v]||[],this._delegatedListeners[v].push(d);for(const g in d.delegates)this.on(g,d.delegates[g]);return this}once(v,t,a){if(a===void 0)return super.once(v,t);const d=this._createDelegatedListener(v,t,a);for(const g in d.delegates)this.once(g,d.delegates[g]);return this}off(v,t,a){return a===void 0?super.off(v,t):(this._delegatedListeners&&this._delegatedListeners[v]&&(d=>{const g=this._delegatedListeners[v];for(let b=0;b<g.length;b++){const M=g[b];if(M.layer===t&&M.listener===a){for(const i in M.delegates)this.off(i,M.delegates[i]);return g.splice(b,1),this}}})(),this)}queryRenderedFeatures(v,t){if(!this.style)return[];let a;const d=v instanceof h.P||Array.isArray(v),g=d?v:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(d?{}:v)||{},g instanceof h.P||typeof g[0]=="number")a=[h.P.convert(g)];else{const b=h.P.convert(g[0]),M=h.P.convert(g[1]);a=[b,new h.P(M.x,b.y),M,new h.P(b.x,M.y),b]}return this.style.queryRenderedFeatures(a,t,this.transform)}querySourceFeatures(v,t){return this.style.querySourceFeatures(v,t)}setStyle(v,t){return(t=h.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&v?(this._diffStyle(v,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(v,t))}setTransformRequest(v){return this._requestManager.setTransformRequest(v),this}_getUIString(v){const t=this._locale[v];if(t==null)throw new Error(`Missing UI string '${v}'`);return t}_updateStyle(v,t){if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(v,t));const a=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!v)),v?(this.style=new qi(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof v=="string"?this.style.loadURL(v,t,a):this.style.loadJSON(v,t,a),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new qi(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(v,t){if(typeof v=="string"){const a=this._requestManager.transformRequest(v,Le.Style);h.f(a,(d,g)=>{d?this.fire(new h.j(d)):g&&this._updateDiff(g,t)})}else typeof v=="object"&&this._updateDiff(v,t)}_updateDiff(v,t){try{this.style.setState(v,t)&&this._update(!0)}catch(a){h.w(`Unable to perform style diff: ${a.message||a.error||a}.  Rebuilding the style from scratch.`),this._updateStyle(v,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():h.w("There is no style added to the map.")}addSource(v,t){return this._lazyInitEmptyStyle(),this.style.addSource(v,t),this._update(!0)}isSourceLoaded(v){const t=this.style&&this.style.sourceCaches[v];if(t!==void 0)return t.loaded();this.fire(new h.j(new Error(`There is no source with ID '${v}'`)))}setTerrain(v){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),v){const t=this.style.sourceCaches[v.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${v.source}`);for(const a in this.style._layers){const d=this.style._layers[a];d.type==="hillshade"&&d.source===v.source&&h.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Sl(this.painter,t,v),this.painter.renderToTexture=new Eo(this.painter,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=a=>{a.dataType==="style"?this.terrain.sourceCache.freeRtt():a.dataType==="source"&&a.tile&&(a.sourceId!==v.source||this._elevationFreeze||(this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(a.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0;return this.fire(new h.k("terrain",{terrain:v})),this}getTerrain(){var v,t;return(t=(v=this.terrain)===null||v===void 0?void 0:v.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const v=this.style&&this.style.sourceCaches;for(const t in v){const a=v[t]._tiles;for(const d in a){const g=a[d];if(g.state!=="loaded"&&g.state!=="errored")return!1}}return!0}addSourceType(v,t,a){return this._lazyInitEmptyStyle(),this.style.addSourceType(v,t,a)}removeSource(v){return this.style.removeSource(v),this._update(!0)}getSource(v){return this.style.getSource(v)}addImage(v,t,a={}){const{pixelRatio:d=1,sdf:g=!1,stretchX:b,stretchY:M,content:i}=a;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||h.a(t))){if(t.width===void 0||t.height===void 0)return this.fire(new h.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:n,height:s,data:l}=t,c=t;return this.style.addImage(v,{data:new h.R({width:n,height:s},new Uint8Array(l)),pixelRatio:d,stretchX:b,stretchY:M,content:i,sdf:g,version:0,userImage:c}),c.onAdd&&c.onAdd(this,v),this}}{const{width:n,height:s,data:l}=h.h.getImageData(t);this.style.addImage(v,{data:new h.R({width:n,height:s},l),pixelRatio:d,stretchX:b,stretchY:M,content:i,sdf:g,version:0})}}updateImage(v,t){const a=this.style.getImage(v);if(!a)return this.fire(new h.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const d=t instanceof HTMLImageElement||h.a(t)?h.h.getImageData(t):t,{width:g,height:b,data:M}=d;if(g===void 0||b===void 0)return this.fire(new h.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(g!==a.data.width||b!==a.data.height)return this.fire(new h.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const i=!(t instanceof HTMLImageElement||h.a(t));return a.data.replace(M,i),this.style.updateImage(v,a),this}getImage(v){return this.style.getImage(v)}hasImage(v){return v?!!this.style.getImage(v):(this.fire(new h.j(new Error("Missing required image id"))),!1)}removeImage(v){this.style.removeImage(v)}loadImage(v,t){Te.getImage(this._requestManager.transformRequest(v,Le.Image),t)}listImages(){return this.style.listImages()}addLayer(v,t){return this._lazyInitEmptyStyle(),this.style.addLayer(v,t),this._update(!0)}moveLayer(v,t){return this.style.moveLayer(v,t),this._update(!0)}removeLayer(v){return this.style.removeLayer(v),this._update(!0)}getLayer(v){return this.style.getLayer(v)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(v,t,a){return this.style.setLayerZoomRange(v,t,a),this._update(!0)}setFilter(v,t,a={}){return this.style.setFilter(v,t,a),this._update(!0)}getFilter(v){return this.style.getFilter(v)}setPaintProperty(v,t,a,d={}){return this.style.setPaintProperty(v,t,a,d),this._update(!0)}getPaintProperty(v,t){return this.style.getPaintProperty(v,t)}setLayoutProperty(v,t,a,d={}){return this.style.setLayoutProperty(v,t,a,d),this._update(!0)}getLayoutProperty(v,t){return this.style.getLayoutProperty(v,t)}setGlyphs(v,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(v,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(v,t,a={}){return this._lazyInitEmptyStyle(),this.style.addSprite(v,t,a,d=>{d||this._update(!0)}),this}removeSprite(v){return this._lazyInitEmptyStyle(),this.style.removeSprite(v),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(v,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(v,t,a=>{a||this._update(!0)}),this}setLight(v,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(v,t),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(v,t){return this.style.setFeatureState(v,t),this._update()}removeFeatureState(v,t){return this.style.removeFeatureState(v,t),this._update()}getFeatureState(v){return this.style.getFeatureState(v)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let v=0,t=0;return this._container&&(v=this._container.clientWidth||400,t=this._container.clientHeight||300),[v,t]}_setupContainer(){const v=this._container;v.classList.add("maplibregl-map");const t=this._canvasContainer=R.create("div","maplibregl-canvas-container",v);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=R.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const a=this._containerDimensions(),d=this._getClampedPixelRatio(a[0],a[1]);this._resizeCanvas(a[0],a[1],d);const g=this._controlContainer=R.create("div","maplibregl-control-container",v),b=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(M=>{b[M]=R.create("div",`maplibregl-ctrl-${M} `,g)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){this._cooperativeGesturesScreen=R.create("div","maplibregl-cooperative-gesture-screen",this._container);let v=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(v=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use ⌘ + scroll to zoom the map"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${v}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,this._cooperativeGesturesScreen.setAttribute("aria-hidden","true"),this._canvasContainer.addEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.add("maplibregl-cooperative-gestures")}_destroyCooperativeGestures(){R.remove(this._cooperativeGesturesScreen),this._canvasContainer.removeEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.remove("maplibregl-cooperative-gestures")}_resizeCanvas(v,t,a){this._canvas.width=Math.floor(a*v),this._canvas.height=Math.floor(a*t),this._canvas.style.width=`${v}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const v={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let t=null;this._canvas.addEventListener("webglcontextcreationerror",d=>{t={requestedAttributes:v},d&&(t.statusMessage=d.statusMessage,t.type=d.type)},{once:!0});const a=this._canvas.getContext("webgl2",v)||this._canvas.getContext("webgl",v);if(!a){const d="Failed to initialize WebGL";throw t?(t.message=d,new Error(JSON.stringify(t))):new Error(d)}this.painter=new Kr(a,this.transform),ie.testSupport(a)}_onCooperativeGesture(v,t,a){return!t&&a<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(v){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||v,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(v){return this._update(),this._renderTaskQueue.add(v)}_cancelRenderFrame(v){this._renderTaskQueue.remove(v)}_render(v){const t=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(v),this._removed)return;let a=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const g=this.transform.zoom,b=h.h.now();this.style.zoomHistory.update(g,b);const M=new h.a8(g,{now:b,fadeDuration:t,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),i=M.crossFadingFactor();i===1&&i===this._crossFadingFactor||(a=!0,this._crossFadingFactor=i),this.style.update(M)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,t,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:t,showPadding:this.showPadding}),this.fire(new h.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,h.bg.mark(h.bh.load),this.fire(new h.k("load"))),this.style&&(this.style.hasTransitions()||a)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const d=this._sourcesDirty||this._styleDirty||this._placementDirty;return d||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new h.k("idle")),!this._loaded||this._fullyLoaded||d||(this._fullyLoaded=!0,h.bg.mark(h.bh.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){var v;this._hash&&this._hash.remove();for(const a of this._controls)a.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Te.removeThrottleControl(this._imageQueueHandle),(v=this._resizeObserver)===null||v===void 0||v.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),R.remove(this._canvasContainer),R.remove(this._controlContainer),this._cooperativeGestures&&this._destroyCooperativeGestures(),this._container.classList.remove("maplibregl-map"),h.bg.clearMetrics(),this._removed=!0,this.fire(new h.k("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=h.h.frame(v=>{h.bg.frame(v),this._frame=null,this._render(v)}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(v){this._showTileBoundaries!==v&&(this._showTileBoundaries=v,this._update())}get showPadding(){return!!this._showPadding}set showPadding(v){this._showPadding!==v&&(this._showPadding=v,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(v){this._showCollisionBoxes!==v&&(this._showCollisionBoxes=v,v?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(v){this._showOverdrawInspector!==v&&(this._showOverdrawInspector=v,this._update())}get repaint(){return!!this._repaint}set repaint(v){this._repaint!==v&&(this._repaint=v,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(v){this._vertices=v,this._update()}get version(){return ht}getCameraTargetElevation(){return this.transform.elevation}},Oe.NavigationControl=class{constructor(v){this._updateZoomButtons=()=>{const t=this._map.getZoom(),a=t===this._map.getMaxZoom(),d=t===this._map.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=d,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",d.toString())},this._rotateCompassArrow=()=>{const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=t},this._setButtonTitle=(t,a)=>{const d=this._map._getUIString(`NavigationControl.${a}`);t.title=d,t.setAttribute("aria-label",d)},this.options=h.e({},Ga,v),this._container=R.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),R.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),R.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=R.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(v){return this._map=v,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ja(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){R.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(v,t){const a=R.create("button",v,this._container);return a.type="button",a.addEventListener("click",t),a}},Oe.GeolocateControl=class extends h.E{constructor(v){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new h.k("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new h.k("geolocate",t)),this._finish()}},this._updateCamera=t=>{const a=new h.L(t.coords.longitude,t.coords.latitude),d=t.coords.accuracy,g=this._map.getBearing(),b=h.e({bearing:g},this.options.fitBoundsOptions),M=ri.fromLngLat(a,d);this._map.fitBounds(M,b,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const a=new h.L(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=t=>{if(this._map){if(this.options.trackUserLocation)if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&cs)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new h.k("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=t=>{if(this._map){if(this._container.addEventListener("contextmenu",a=>a.preventDefault()),this._geolocateButton=R.create("button","maplibregl-ctrl-geolocate",this._container),R.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",t===!1){h.w("Geolocation support is not available so the GeolocateControl will be disabled.");const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}else{const a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=R.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new ar({element:this._dotElement}),this._circleElement=R.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ar({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",a=>{a.geolocateSource||this._watchState!=="ACTIVE_LOCK"||a.originalEvent&&a.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new h.k("trackuserlocationend")))})}},this.options=h.e({},yt,v)}onAdd(v){return this._map=v,this._container=R.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(t,a=!1){Di===void 0||a?window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(d=>{Di=d.state!=="denied",t(Di)}).catch(()=>{Di=!!window.navigator.geolocation,t(Di)}):(Di=!!window.navigator.geolocation,t(Di)):t(Di)}(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),R.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,$t=0,cs=!1}_isOutOfMapMaxBounds(v){const t=this._map.getMaxBounds(),a=v.coords;return t&&(a.longitude<t.getWest()||a.longitude>t.getEast()||a.latitude<t.getSouth()||a.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const v=this._map.getBounds(),t=v.getSouthEast(),a=v.getNorthEast(),d=t.distanceTo(a),g=Math.ceil(this._accuracy/(d/this._map._container.clientHeight)*2);this._circleElement.style.width=`${g}px`,this._circleElement.style.height=`${g}px`}trigger(){if(!this._setup)return h.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new h.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":$t--,cs=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new h.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new h.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let v;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),$t++,$t>1?(v={maximumAge:6e5,timeout:0},cs=!0):(v=this.options.positionOptions,cs=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,v)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},Oe.AttributionControl=Tr,Oe.LogoControl=yi,Oe.ScaleControl=class{constructor(v){this._onMove=()=>{en(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,en(this._map,this._container,this.options)},this.options=h.e({},hs,v)}getDefaultPosition(){return"bottom-left"}onAdd(v){return this._map=v,this._container=R.create("div","maplibregl-ctrl maplibregl-ctrl-scale",v.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){R.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},Oe.FullscreenControl=class extends h.E{constructor(v={}){super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,v&&v.container&&(v.container instanceof HTMLElement?this._container=v.container:h.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(v){return this._map=v,this._container||(this._container=this._map.getContainer()),this._controlContainer=R.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){R.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const v=this._fullscreenButton=R.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);R.create("span","maplibregl-ctrl-icon",v).setAttribute("aria-hidden","true"),v.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const v=this._getTitle();this._fullscreenButton.setAttribute("aria-label",v),this._fullscreenButton.title=v}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new h.k("fullscreenstart")),this._map._cooperativeGestures&&(this._prevCooperativeGestures=this._map._cooperativeGestures,this._map.setCooperativeGestures())):(this.fire(new h.k("fullscreenend")),this._prevCooperativeGestures&&(this._map.setCooperativeGestures(this._prevCooperativeGestures),delete this._prevCooperativeGestures))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},Oe.TerrainControl=class{constructor(v){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))},this.options=v}onAdd(v){return this._map=v,this._container=R.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=R.create("button","maplibregl-ctrl-terrain",this._container),R.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){R.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},Oe.Popup=class extends h.E{constructor(v){super(),this.remove=()=>(this._content&&R.remove(this._content),this._container&&(R.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new h.k("close")),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=R.create("div","maplibregl-popup",this._map.getContainer()),this._tip=R.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const M of this.options.className.split(" "))this._container.classList.add(M);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=fn(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!t)return;const a=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);let d=this.options.anchor;const g=tn(this.options.offset);if(!d){const M=this._container.offsetWidth,i=this._container.offsetHeight;let n;n=a.y+g.bottom.y<i?["top"]:a.y>this._map.transform.height-i?["bottom"]:[],a.x<M/2?n.push("left"):a.x>this._map.transform.width-M/2&&n.push("right"),d=n.length===0?"bottom":n.join("-")}const b=a.add(g[d]).round();R.setTransform(this._container,`${Bi[d]} translate(${b.x}px,${b.y}px)`),Ct(this._container,d,"popup")},this._onClose=()=>{this.remove()},this.options=h.e(Object.create(Qi),v)}addTo(v){return this._map&&this.remove(),this._map=v,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new h.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(v){return this._lngLat=h.L.convert(v),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(v){return this.setDOMContent(document.createTextNode(v))}setHTML(v){const t=document.createDocumentFragment(),a=document.createElement("body");let d;for(a.innerHTML=v;d=a.firstChild,d;)t.appendChild(d);return this.setDOMContent(t)}getMaxWidth(){var v;return(v=this._container)===null||v===void 0?void 0:v.style.maxWidth}setMaxWidth(v){return this.options.maxWidth=v,this._update(),this}setDOMContent(v){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=R.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(v),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(v){this._container&&this._container.classList.add(v)}removeClassName(v){this._container&&this._container.classList.remove(v)}setOffset(v){return this.options.offset=v,this._update(),this}toggleClassName(v){if(this._container)return this._container.classList.toggle(v)}_createCloseButton(){this.options.closeButton&&(this._closeButton=R.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const v=this._container.querySelector($s);v&&v.focus()}},Oe.Marker=ar,Oe.Style=qi,Oe.LngLat=h.L,Oe.LngLatBounds=ri,Oe.Point=h.P,Oe.MercatorCoordinate=h.U,Oe.Evented=h.E,Oe.AJAXError=h.bi,Oe.config=h.c,Oe.CanvasSource=Rn,Oe.GeoJSONSource=Dt,Oe.ImageSource=Wi,Oe.RasterDEMTileSource=Ye,Oe.RasterTileSource=Xr,Oe.VectorTileSource=yn,Oe.VideoSource=ro,Oe.setRTLTextPlugin=h.bj,Oe.getRTLTextPluginStatus=h.bk,Oe.prewarm=function(){so().acquire(qt)},Oe.clearPrewarmedResources=function(){const v=xn;v&&(v.isPreloaded()&&v.numActive()===1?(v.release(qt),xn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},aa.extend(Oe,{isSafari:h.ac,getPerformanceMetrics:h.bg.getPerformanceMetrics}),Oe});var V=D;return V})})(yp);var _v=yp.exports;const zA=_p(_v);var yv=vv;function vv(p){var _,E,T;if(p){if(Array.isArray(p)){for(_=[],E=p.length,T=0;T<E;T++){var D=p[T];D!=null&&_.push(D)}return _}if(typeof p=="object"){_={};var L=Object.keys(p);for(E=L.length,T=0;T<E;T++){var V=L[T],h=p[V];h!=null&&(_[V]=h)}return _}}}function xv(p,_,E){let T;const{map:D}=Ru();jl(p,D,U=>E(4,T=U));let{position:L="top-left"}=_,{container:V=void 0}=_,h=null;return Du(()=>{T!=null&&T.loaded()&&h&&T.removeControl(h)}),p.$$set=U=>{"position"in U&&E(1,L=U.position),"container"in U&&E(2,V=U.container)},p.$$.update=()=>{if(p.$$.dirty&30&&T&&!h){let U;typeof V=="string"?U=document.querySelector(V)??void 0:U=V,E(3,h=new zA.FullscreenControl({container:U})),T.addControl(h,L)}},[D,L,V,h,T]}class bv extends Js{constructor(_){super(),eo(this,_,xv,null,Ks,{position:1,container:2})}}function wv(p,_,E){let T;const{map:D}=Ru();jl(p,D,K=>E(8,T=K));let{position:L="top-left"}=_,{positionOptions:V=void 0}=_,{fitBoundsOptions:h=void 0}=_,{trackUserLocation:U=!1}=_,{showAccuracyCircle:R=!0}=_,{showUserLocation:ie=!0}=_,X=null;return Du(()=>{T!=null&&T.loaded()&&X&&T.removeControl(X)}),p.$$set=K=>{"position"in K&&E(1,L=K.position),"positionOptions"in K&&E(2,V=K.positionOptions),"fitBoundsOptions"in K&&E(3,h=K.fitBoundsOptions),"trackUserLocation"in K&&E(4,U=K.trackUserLocation),"showAccuracyCircle"in K&&E(5,R=K.showAccuracyCircle),"showUserLocation"in K&&E(6,ie=K.showUserLocation)},p.$$.update=()=>{p.$$.dirty&510&&T&&!X&&(E(7,X=new zA.GeolocateControl({positionOptions:V,fitBoundsOptions:h,trackUserLocation:U,showAccuracyCircle:R,showUserLocation:ie})),T.addControl(X,L))},[D,L,V,h,U,R,ie,X,T]}class kv extends Js{constructor(_){super(),eo(this,_,wv,null,Ks,{position:1,positionOptions:2,fitBoundsOptions:3,trackUserLocation:4,showAccuracyCircle:5,showUserLocation:6})}}function Ev(p){let _=p.getCenter(),E=Math.round(p.getZoom()*100)/100,T=Math.ceil((E*Math.LN2+Math.log(512/360/.5))/Math.LN10),D=Math.pow(10,T),L=Math.round(_.lat*D)/D,V=Math.round(_.lng*D)/D,h=`${E}/${L}/${V}`,U=p.getBearing(),R=p.getPitch();return(U||R)&&(h+=`/${Math.round(U*10)/10}`),R&&(h+=`/${Math.round(R)}`),`#${h}`}function Sv(p){return p.replace("#","").split("/").map(parseFloat)}var uu=Rh;function Rh(p,_){return p===_||p!==p&&_!==_?!0:typeof p!=typeof _||{}.toString.call(p)!={}.toString.call(_)||p!==Object(p)||!p?!1:Array.isArray(p)?rd(p,_):{}.toString.call(p)=="[object Set]"?rd(Array.from(p),Array.from(_)):{}.toString.call(p)=="[object Object]"?Iv(p,_):Tv(p,_)}function Tv(p,_){return p.toString()===_.toString()}function rd(p,_){var E=p.length;if(E!=_.length)return!1;for(var T=0;T<E;T++)if(!Rh(p[T],_[T]))return!1;return!0}function Iv(p,_){var E=Object.keys(p),T=E.length;if(T!=Object.keys(_).length)return!1;for(var D=0;D<T;D++){var L=E[D];if(!(_.hasOwnProperty(L)&&Rh(p[L],_[L])))return!1}return!0}function Mv(p,_,E){let T;const{map:D}=Ru();jl(p,D,ie=>E(6,T=ie));let{position:L="top-left"}=_,{showCompass:V=!0}=_,{showZoom:h=!0}=_,{visualizePitch:U=!1}=_,R=null;return Du(()=>{T!=null&&T.loaded()&&R&&T.removeControl(R)}),p.$$set=ie=>{"position"in ie&&E(1,L=ie.position),"showCompass"in ie&&E(2,V=ie.showCompass),"showZoom"in ie&&E(3,h=ie.showZoom),"visualizePitch"in ie&&E(4,U=ie.visualizePitch)},p.$$.update=()=>{p.$$.dirty&126&&T&&!R&&(E(5,R=new zA.NavigationControl({showCompass:V,showZoom:h,visualizePitch:U})),T.addControl(R,L))},[D,L,V,h,U,R,T]}class Cv extends Js{constructor(_){super(),eo(this,_,Mv,null,Ks,{position:1,showCompass:2,showZoom:3,visualizePitch:4})}}function Pv(p,_,E){let T;const{map:D}=Ru();jl(p,D,R=>E(5,T=R));let{position:L="bottom-left"}=_,{maxWidth:V=void 0}=_,{unit:h="metric"}=_,U=null;return Du(()=>{T!=null&&T.loaded()&&U&&T.removeControl(U)}),p.$$set=R=>{"position"in R&&E(1,L=R.position),"maxWidth"in R&&E(2,V=R.maxWidth),"unit"in R&&E(3,h=R.unit)},p.$$.update=()=>{p.$$.dirty&62&&T&&!U&&(E(4,U=new zA.ScaleControl({maxWidth:V,unit:h})),T.addControl(U,L))},[D,L,V,h,U,T]}class Dv extends Js{constructor(_){super(),eo(this,_,Pv,null,Ks,{position:1,maxWidth:2,unit:3})}}const Bv=p=>({map:p[0]&8,loadedImages:p[0]&16,allImagesLoaded:p[0]&32}),nd=p=>({map:p[3],loadedImages:p[4],allImagesLoaded:p[5]});function sd(p){let _,E,T=p[2]&&od(p);const D=p[34].default,L=Bg(D,p,p[33],nd);return{c(){T&&T.c(),_=ws(),L&&L.c()},l(V){T&&T.l(V),_=ks(V),L&&L.l(V)},m(V,h){T&&T.m(V,h),lr(V,_,h),L&&L.m(V,h),E=!0},p(V,h){V[2]?T?(T.p(V,h),h[0]&4&&dr(T,1)):(T=od(V),T.c(),dr(T,1),T.m(_.parentNode,_)):T&&(Eh(),Hr(T,1,1,()=>{T=null}),Sh()),L&&L.p&&(!E||h[0]&56|h[1]&4)&&zg(L,D,V,V[33],E?Rg(D,V[33],h,Bv):Lg(V[33]),nd)},i(V){E||(dr(T),dr(L,V),E=!0)},o(V){Hr(T),Hr(L,V),E=!1},d(V){V&&ii(_),T&&T.d(V),L&&L.d(V)}}}function od(p){let _,E,T,D,L,V,h,U;return _=new Cv({props:{position:p[6]}}),T=new kv({props:{position:p[6],fitBoundsOptions:{maxZoom:12}}}),L=new bv({props:{position:p[6]}}),h=new Dv({props:{position:p[6]}}),{c(){Fo(_.$$.fragment),E=ws(),Fo(T.$$.fragment),D=ws(),Fo(L.$$.fragment),V=ws(),Fo(h.$$.fragment)},l(R){Oo(_.$$.fragment,R),E=ks(R),Oo(T.$$.fragment,R),D=ks(R),Oo(L.$$.fragment,R),V=ks(R),Oo(h.$$.fragment,R)},m(R,ie){Vo(_,R,ie),lr(R,E,ie),Vo(T,R,ie),lr(R,D,ie),Vo(L,R,ie),lr(R,V,ie),Vo(h,R,ie),U=!0},p(R,ie){const X={};ie[0]&64&&(X.position=R[6]),_.$set(X);const K={};ie[0]&64&&(K.position=R[6]),T.$set(K);const Ae={};ie[0]&64&&(Ae.position=R[6]),L.$set(Ae);const we={};ie[0]&64&&(we.position=R[6]),h.$set(we)},i(R){U||(dr(_.$$.fragment,R),dr(T.$$.fragment,R),dr(L.$$.fragment,R),dr(h.$$.fragment,R),U=!0)},o(R){Hr(_.$$.fragment,R),Hr(T.$$.fragment,R),Hr(L.$$.fragment,R),Hr(h.$$.fragment,R),U=!1},d(R){R&&(ii(E),ii(D),ii(V)),No(_,R),No(T,R),No(L,R),No(h,R)}}}function zv(p){let _,E,T,D,L,V=p[3]&&p[0]&&sd(p);return{c(){_=xs("div"),V&&V.c(),this.h()},l(h){_=bs(h,"DIV",{class:!0});var U=Br(_);V&&V.l(U),U.forEach(ii),this.h()},h(){ei(_,"class",E=Ah(p[1])+" svelte-p00lfq"),bf(_,"expand-map",!p[1])},m(h,U){lr(h,_,U),V&&V.m(_,null),T=!0,D||(L=Pg(p[9].call(null,_)),D=!0)},p(h,U){h[3]&&h[0]?V?(V.p(h,U),U[0]&9&&dr(V,1)):(V=sd(h),V.c(),dr(V,1),V.m(_,null)):V&&(Eh(),Hr(V,1,1,()=>{V=null}),Sh()),(!T||U[0]&2&&E!==(E=Ah(h[1])+" svelte-p00lfq"))&&ei(_,"class",E),(!T||U[0]&2)&&bf(_,"expand-map",!h[1])},i(h){T||(dr(V),T=!0)},o(h){Hr(V),T=!1},d(h){h&&ii(_),V&&V.d(),D=!1,L()}}}function Lv(p,_,E){let T,D,L,V,{$$slots:h={},$$scope:U}=_,{map:R=null}=_,{class:ie=void 0}=_,{style:X}=_,{diffStyleUpdates:K=!1}=_,{center:Ae=void 0}=_,{zoom:we=void 0}=_,{pitch:xe=0}=_,{bearing:Te=0}=_,{bounds:Le=void 0}=_,{hash:Ze=!1}=_,{loaded:We=!1}=_,{minZoom:je=0}=_,{maxZoom:nt=22}=_,{zoomOnDoubleClick:Tt=!0}=_,{interactive:Ot=!0}=_,{attributionControl:It=!0}=_,{cooperativeGestures:Kt=!1}=_,{preserveDrawingBuffer:Lt=!1}=_,{maxBounds:kt=void 0}=_,{images:Gt=[]}=_,{standardControls:Jt=!1}=_,{filterLayers:si=void 0}=_,{transformRequest:ui=void 0}=_;const _i=Dg(),{map:vi,loadedImages:Gi}=pv();jl(p,vi,Ye=>E(3,L=Ye)),jl(p,Gi,Ye=>E(4,V=Ye));let Fi=new Set;function Jn(Ye){L!=null&&L.loaded()&&("url"in Ye?(Fi.add(Ye.id),L.loadImage(Ye.url,(Dt,ni)=>{Fi.delete(Ye.id),Dt?_i("error",Dt):ni&&(L==null||L.addImage(Ye.id,ni,Ye.options),V.add(Ye.id),Gi.set(V))})):(L.addImage(Ye.id,Ye.data,Ye.options),V.add(Ye.id),Gi.set(V)))}let Wr,ji,ri,Oi;function yn(Ye){if(Ze){let Dt=Sv(window.location.hash);Dt.length>=3&&(E(11,we=Dt[0]),E(10,Ae=[Dt[2],Dt[1]])),Dt.length==5&&(E(15,Te=Dt[3]),E(14,xe=Dt[4]))}return wf(vi,L=new zA.Map(yv({container:Ye,style:X,center:Ae,zoom:we,pitch:xe,bearing:Te,minZoom:je,maxZoom:nt,interactive:Ot,preserveDrawingBuffer:Lt,maxBounds:kt,bounds:Le,attributionControl:It,transformRequest:ui,cooperativeGestures:Kt})),L),L.on("load",Dt=>{E(0,We=!0),_i("load",L)}),L.on("error",Dt=>_i("error",{...Dt,map:L})),L.on("movestart",Dt=>_i("movestart",{...Dt,map:L})),L.on("moveend",Dt=>{if(E(10,Ae=Dt.target.getCenter()),E(11,we=Dt.target.getZoom()),E(12,Le=Dt.target.getBounds()),_i("moveend",{...Dt,map:L}),Ze){let ni=window.location.href.replace(/(#.+)?$/,Ev(L));window.history.replaceState(window.history.state,"",ni)}}),L.on("zoomstart",Dt=>_i("zoomstart",{...Dt,map:L})),L.on("zoom",Dt=>{E(11,we=Dt.target.getZoom()),_i("zoom",{...Dt,map:L})}),L.on("zoomend",Dt=>{E(11,we=Dt.target.getZoom()),_i("zoomend",{...Dt,map:L})}),L.on("style.load",()=>{if(L){const Dt=L.getStyle();if(E(30,Wr=Dt.layers.map(ni=>ni.id)),E(31,ji=Object.keys(Dt.sources)),Oi)for(const[ni,Wi]of Object.entries(Oi))L.addSource(ni,Wi);if(ri)for(const ni of ri)L.addLayer(ni)}}),L.on("styledata",Dt=>{if(L&&si){const ni=L.getStyle().layers;if(ni)for(let Wi of ni)si(Wi)||L.setLayoutProperty(Wi.id,"visibility","none")}_i("styledata",{...Dt,map:L})}),{destroy(){E(0,We=!1),L==null||L.remove(),wf(vi,L=null,L)}}}let Xr=X;return p.$$set=Ye=>{"map"in Ye&&E(13,R=Ye.map),"class"in Ye&&E(1,ie=Ye.class),"style"in Ye&&E(16,X=Ye.style),"diffStyleUpdates"in Ye&&E(17,K=Ye.diffStyleUpdates),"center"in Ye&&E(10,Ae=Ye.center),"zoom"in Ye&&E(11,we=Ye.zoom),"pitch"in Ye&&E(14,xe=Ye.pitch),"bearing"in Ye&&E(15,Te=Ye.bearing),"bounds"in Ye&&E(12,Le=Ye.bounds),"hash"in Ye&&E(18,Ze=Ye.hash),"loaded"in Ye&&E(0,We=Ye.loaded),"minZoom"in Ye&&E(19,je=Ye.minZoom),"maxZoom"in Ye&&E(20,nt=Ye.maxZoom),"zoomOnDoubleClick"in Ye&&E(21,Tt=Ye.zoomOnDoubleClick),"interactive"in Ye&&E(22,Ot=Ye.interactive),"attributionControl"in Ye&&E(23,It=Ye.attributionControl),"cooperativeGestures"in Ye&&E(24,Kt=Ye.cooperativeGestures),"preserveDrawingBuffer"in Ye&&E(25,Lt=Ye.preserveDrawingBuffer),"maxBounds"in Ye&&E(26,kt=Ye.maxBounds),"images"in Ye&&E(27,Gt=Ye.images),"standardControls"in Ye&&E(2,Jt=Ye.standardControls),"filterLayers"in Ye&&E(28,si=Ye.filterLayers),"transformRequest"in Ye&&E(29,ui=Ye.transformRequest),"$$scope"in Ye&&E(33,U=Ye.$$scope)},p.$$.update=()=>{if(p.$$.dirty[0]&4&&E(6,T=typeof Jt=="boolean"?void 0:Jt),p.$$.dirty[0]&8&&E(13,R=L),p.$$.dirty[0]&134217737&&We&&L!=null&&L.loaded())for(let Ye of Gt)!Fi.has(Ye.id)&&!L.hasImage(Ye.id)&&Jn(Ye);if(p.$$.dirty[0]&134217744&&E(5,D=Gt.every(Ye=>V.has(Ye.id))),p.$$.dirty[0]&1073938440|p.$$.dirty[1]&3&&L&&!uu(X,Xr)){const Ye=L.getStyle();if(Wr&&(ri=Ye.layers.filter(Dt=>!Wr.includes(Dt.id))),ji){const Dt=Object.keys(Ye.sources).filter(ni=>!ji.includes(ni));Oi={};for(const ni of Dt)Oi[ni]=Ye.sources[ni]}E(32,Xr=X),L.setStyle(X,{diff:K})}p.$$.dirty[0]&1032&&Ae&&!uu(Ae,L==null?void 0:L.getCenter())&&(L==null||L.panTo(Ae)),p.$$.dirty[0]&2056&&we&&!uu(we,L==null?void 0:L.getZoom())&&(L==null||L.zoomTo(we)),p.$$.dirty[0]&4104&&Le&&!uu(Le,L==null?void 0:L.getBounds())&&(L==null||L.fitBounds(Le)),p.$$.dirty[0]&2097160&&(Tt?L==null||L.doubleClickZoom.enable():L==null||L.doubleClickZoom.disable())},[We,ie,Jt,L,V,D,T,vi,Gi,yn,Ae,we,Le,R,xe,Te,X,K,Ze,je,nt,Tt,Ot,It,Kt,Lt,kt,Gt,si,ui,Wr,ji,Xr,U,h]}class Rv extends Js{constructor(_){super(),eo(this,_,Lv,zv,Ks,{map:13,class:1,style:16,diffStyleUpdates:17,center:10,zoom:11,pitch:14,bearing:15,bounds:12,hash:18,loaded:0,minZoom:19,maxZoom:20,zoomOnDoubleClick:21,interactive:22,attributionControl:23,cooperativeGestures:24,preserveDrawingBuffer:25,maxBounds:26,images:27,standardControls:2,filterLayers:28,transformRequest:29},null,[-1,-1])}}var LA=Uint8Array,xp=Uint16Array,Fv=Int32Array,Ov=new LA([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Vv=new LA([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),bp=function(p,_){for(var E=new xp(31),T=0;T<31;++T)E[T]=_+=1<<p[T-1];for(var D=new Fv(E[30]),T=1;T<30;++T)for(var L=E[T];L<E[T+1];++L)D[L]=L-E[T]<<5|T;return{b:E,r:D}},wp=bp(Ov,2),Nv=wp.b,Uv=wp.r;Nv[28]=258,Uv[258]=28;bp(Vv,0);var Gv=new xp(32768);for(gi=0;gi<32768;++gi)Ro=(gi&43690)>>1|(gi&21845)<<1,Ro=(Ro&52428)>>2|(Ro&13107)<<2,Ro=(Ro&61680)>>4|(Ro&3855)<<4,Gv[gi]=((Ro&65280)>>8|(Ro&255)<<8)>>1;var Ro,gi,Fu=new LA(288);for(gi=0;gi<144;++gi)Fu[gi]=8;var gi;for(gi=144;gi<256;++gi)Fu[gi]=9;var gi;for(gi=256;gi<280;++gi)Fu[gi]=7;var gi;for(gi=280;gi<288;++gi)Fu[gi]=8;var gi,jv=new LA(32);for(gi=0;gi<32;++gi)jv[gi]=5;var gi,qv=new LA(0),Zv=typeof TextDecoder<"u"&&new TextDecoder,Qv=0;try{Zv.decode(qv,{stream:!0}),Qv=1}catch{}var Ou={exports:{}},$v=Wv,Hv={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"};function Wv(p){if(!p||!p.type)return null;var _=Hv[p.type];if(!_)return null;if(_==="geometry")return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:p}]};if(_==="feature")return{type:"FeatureCollection",features:[p]};if(_==="featurecollection")return p}function gu(p){switch(p&&p.type||null){case"FeatureCollection":return p.features=p.features.reduce(function(_,E){return _.concat(gu(E))},[]),p;case"Feature":return p.geometry?gu(p.geometry).map(function(_){var E={type:"Feature",properties:JSON.parse(JSON.stringify(p.properties)),geometry:_};return p.id!==void 0&&(E.id=p.id),E}):[p];case"MultiPoint":return p.coordinates.map(function(_){return{type:"Point",coordinates:_}});case"MultiPolygon":return p.coordinates.map(function(_){return{type:"Polygon",coordinates:_}});case"MultiLineString":return p.coordinates.map(function(_){return{type:"LineString",coordinates:_}});case"GeometryCollection":return p.geometries.map(gu).reduce(function(_,E){return _.concat(E)},[]);case"Point":case"Polygon":case"LineString":return[p]}}const Xv=Object.freeze(Object.defineProperty({__proto__:null,default:gu},Symbol.toStringTag,{value:"Module"})),Yv=gv(Xv);var Kv=function(_){return E(_);function E(T){return Array.isArray(T)&&T.length&&typeof T[0]=="number"?[T]:T.reduce(function(D,L){return Array.isArray(L)&&Array.isArray(L[0])?D.concat(E(L)):(D.push(L),D)},[])}},Jv=$v,_u=Yv,ex=Kv;_u instanceof Function||(_u=_u.default);var tx=function(p){if(!p)return[];var _=_u(Jv(p)),E=[];return _.features.forEach(function(T){T.geometry&&(E=E.concat(ex(T.geometry.coordinates)))}),E};function $l(p){return Object.prototype.toString.call(p)}function ix(p){return $l(p)==="[object Date]"}function rx(p){return $l(p)==="[object RegExp]"}function nx(p){return $l(p)==="[object Error]"}function sx(p){return $l(p)==="[object Boolean]"}function ox(p){return $l(p)==="[object Number]"}function ax(p){return $l(p)==="[object String]"}var kp=Array.isArray||function(_){return Object.prototype.toString.call(_)==="[object Array]"};function Vu(p,_){if(p.forEach)return p.forEach(_);for(var E=0;E<p.length;E++)_(p[E],E,p)}var lx=Object.keys||function(_){var E=[];for(var T in _)E.push(T);return E},Ax=Object.prototype.propertyIsEnumerable,ad=Object.getOwnPropertySymbols;function Nu(p){var _=lx(p);if(ad)for(var E=ad(p),T=0;T<E.length;T++)Ax.call(p,E[T])&&_.push(E[T]);return _}var Uu=Object.prototype.hasOwnProperty||function(p,_){return _ in p};function Ep(p){if(typeof p=="object"&&p!==null){var _;if(kp(p))_=[];else if(ix(p))_=new Date(p.getTime?p.getTime():p);else if(rx(p))_=new RegExp(p);else if(nx(p))_={message:p.message};else if(sx(p)||ox(p)||ax(p))_=Object(p);else if(Object.create&&Object.getPrototypeOf)_=Object.create(Object.getPrototypeOf(p));else if(p.constructor===Object)_={};else{var E=p.constructor&&p.constructor.prototype||p.__proto__||{},T=function(){};T.prototype=E,_=new T}return Vu(Nu(p),function(D){_[D]=p[D]}),_}return p}function Sp(p,_,E){var T=[],D=[],L=!0;return function V(h){var U=E?Ep(h):h,R={},ie=!0,X={node:U,node_:h,path:[].concat(T),parent:D[D.length-1],parents:D,key:T[T.length-1],isRoot:T.length===0,level:T.length,circular:null,update:function(we,xe){X.isRoot||(X.parent.node[X.key]=we),X.node=we,xe&&(ie=!1)},delete:function(we){delete X.parent.node[X.key],we&&(ie=!1)},remove:function(we){kp(X.parent.node)?X.parent.node.splice(X.key,1):delete X.parent.node[X.key],we&&(ie=!1)},keys:null,before:function(we){R.before=we},after:function(we){R.after=we},pre:function(we){R.pre=we},post:function(we){R.post=we},stop:function(){L=!1},block:function(){ie=!1}};if(!L)return X;function K(){if(typeof X.node=="object"&&X.node!==null){(!X.keys||X.node_!==X.node)&&(X.keys=Nu(X.node)),X.isLeaf=X.keys.length===0;for(var we=0;we<D.length;we++)if(D[we].node_===h){X.circular=D[we];break}}else X.isLeaf=!0,X.keys=null;X.notLeaf=!X.isLeaf,X.notRoot=!X.isRoot}K();var Ae=_.call(X,X.node);return Ae!==void 0&&X.update&&X.update(Ae),R.before&&R.before.call(X,X.node),ie&&(typeof X.node=="object"&&X.node!==null&&!X.circular&&(D.push(X),K(),Vu(X.keys,function(we,xe){T.push(we),R.pre&&R.pre.call(X,X.node[we],we);var Te=V(X.node[we]);E&&Uu.call(X.node,we)&&(X.node[we]=Te.node),Te.isLast=xe===X.keys.length-1,Te.isFirst=xe===0,R.post&&R.post.call(X,Te),T.pop()}),D.pop()),R.after&&R.after.call(X,X.node)),X}(p).node}function Kn(p){this.value=p}Kn.prototype.get=function(p){for(var _=this.value,E=0;E<p.length;E++){var T=p[E];if(!_||!Uu.call(_,T))return;_=_[T]}return _};Kn.prototype.has=function(p){for(var _=this.value,E=0;E<p.length;E++){var T=p[E];if(!_||!Uu.call(_,T))return!1;_=_[T]}return!0};Kn.prototype.set=function(p,_){for(var E=this.value,T=0;T<p.length-1;T++){var D=p[T];Uu.call(E,D)||(E[D]={}),E=E[D]}return E[p[T]]=_,_};Kn.prototype.map=function(p){return Sp(this.value,p,!0)};Kn.prototype.forEach=function(p){return this.value=Sp(this.value,p,!1),this.value};Kn.prototype.reduce=function(p,_){var E=arguments.length===1,T=E?this.value:_;return this.forEach(function(D){(!this.isRoot||!E)&&(T=p.call(this,T,D))}),T};Kn.prototype.paths=function(){var p=[];return this.forEach(function(){p.push(this.path)}),p};Kn.prototype.nodes=function(){var p=[];return this.forEach(function(){p.push(this.node)}),p};Kn.prototype.clone=function(){var p=[],_=[];return function E(T){for(var D=0;D<p.length;D++)if(p[D]===T)return _[D];if(typeof T=="object"&&T!==null){var L=Ep(T);return p.push(T),_.push(L),Vu(Nu(T),function(V){L[V]=E(T[V])}),p.pop(),_.pop(),L}return T}(this.value)};function Tp(p){return new Kn(p)}Vu(Nu(Kn.prototype),function(p){Tp[p]=function(_){var E=[].slice.call(arguments,1),T=new Kn(_);return T[p].apply(T,E)}});var ux=Tp,cx=ln;function ln(p){if(!(this instanceof ln))return new ln(p);this._bbox=p||[1/0,1/0,-1/0,-1/0],this._valid=!!p}ln.prototype.include=function(p){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],p[0]),this._bbox[1]=Math.min(this._bbox[1],p[1]),this._bbox[2]=Math.max(this._bbox[2],p[0]),this._bbox[3]=Math.max(this._bbox[3],p[1]),this};ln.prototype.equals=function(p){var _;return p instanceof ln?_=p.bbox():_=p,this._bbox[0]==_[0]&&this._bbox[1]==_[1]&&this._bbox[2]==_[2]&&this._bbox[3]==_[3]};ln.prototype.center=function(p){return this._valid?[(this._bbox[0]+this._bbox[2])/2,(this._bbox[1]+this._bbox[3])/2]:null};ln.prototype.union=function(p){this._valid=!0;var _;return p instanceof ln?_=p.bbox():_=p,this._bbox[0]=Math.min(this._bbox[0],_[0]),this._bbox[1]=Math.min(this._bbox[1],_[1]),this._bbox[2]=Math.max(this._bbox[2],_[2]),this._bbox[3]=Math.max(this._bbox[3],_[3]),this};ln.prototype.bbox=function(){return this._valid?this._bbox:null};ln.prototype.contains=function(p){if(!p)return this._fastContains();if(!this._valid)return null;var _=p[0],E=p[1];return this._bbox[0]<=_&&this._bbox[1]<=E&&this._bbox[2]>=_&&this._bbox[3]>=E};ln.prototype.intersect=function(p){if(!this._valid)return null;var _;return p instanceof ln?_=p.bbox():_=p,!(this._bbox[0]>_[2]||this._bbox[2]<_[0]||this._bbox[3]<_[1]||this._bbox[1]>_[3])};ln.prototype._fastContains=function(){if(!this._valid)return new Function("return null;");var p="return "+this._bbox[0]+"<= ll[0] &&"+this._bbox[1]+"<= ll[1] &&"+this._bbox[2]+">= ll[0] &&"+this._bbox[3]+">= ll[1]";return new Function("ll",p)};ln.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null};var hx=tx,fx=ux,dx=cx,Ip={features:["FeatureCollection"],coordinates:["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],geometry:["Feature"],geometries:["GeometryCollection"]},px=Object.keys(Ip);Ou.exports=function(p){return Fh(p).bbox()};Ou.exports.polygon=function(p){return Fh(p).polygon()};Ou.exports.bboxify=function(p){return fx(p).map(function(_){if(_){var E=px.some(function(T){return _[T]?Ip[T].indexOf(_.type)!==-1:!1});E&&(_.bbox=Fh(_).bbox(),this.update(_))}})};function Fh(p){for(var _=dx(),E=hx(p),T=0;T<E.length;T++)_.include(E[T]);return _}var mx=Ou.exports;const gx=_p(mx);var an=function(p){p=p||{};var _=typeof p<"u"?p:{},E={},T;for(T in _)_.hasOwnProperty(T)&&(E[T]=_[T]);var D="";function L(se){return _.locateFile?_.locateFile(se,D):D+se}var V;typeof document<"u"&&document.currentScript&&(D=document.currentScript.src),D.indexOf("blob:")!==0?D=D.substr(0,D.lastIndexOf("/")+1):D="",V=function(_e,De,Ue){var A=new XMLHttpRequest;A.open("GET",_e,!0),A.responseType="arraybuffer",A.onload=function(){if(A.status==200||A.status==0&&A.response){De(A.response);return}var Ke=Xi(_e);if(Ke){De(Ke.buffer);return}Ue()},A.onerror=Ue,A.send(null)};var h=_.print||console.log.bind(console),U=_.printErr||console.warn.bind(console);for(T in E)E.hasOwnProperty(T)&&(_[T]=E[T]);E=null,_.arguments&&_.arguments;var R=0,ie=function(se){R=se},X=function(){return R},K=8;function Ae(se,_e,De,Ue){switch(De=De||"i8",De.charAt(De.length-1)==="*"&&(De="i32"),De){case"i1":Gt[se>>0]=_e;break;case"i8":Gt[se>>0]=_e;break;case"i16":si[se>>1]=_e;break;case"i32":ui[se>>2]=_e;break;case"i64":Rr=[_e>>>0,(qt=_e,+no(qt)>=1?qt>0?(es(+Ss(qt/4294967296),4294967295)|0)>>>0:~~+vn((qt-+(~~qt>>>0))/4294967296)>>>0:0)],ui[se>>2]=Rr[0],ui[se+4>>2]=Rr[1];break;case"float":_i[se>>2]=_e;break;case"double":vi[se>>3]=_e;break;default:Be("invalid type for setValue: "+De)}}function we(se,_e,De){switch(_e=_e||"i8",_e.charAt(_e.length-1)==="*"&&(_e="i32"),_e){case"i1":return Gt[se>>0];case"i8":return Gt[se>>0];case"i16":return si[se>>1];case"i32":return ui[se>>2];case"i64":return ui[se>>2];case"float":return _i[se>>2];case"double":return vi[se>>3];default:Be("invalid type for getValue: "+_e)}return null}var xe=!1;function Te(se,_e){se||Be("Assertion failed: "+_e)}function Le(se){var _e=_["_"+se];return Te(_e,"Cannot call unknown function "+se+", make sure it is exported"),_e}function Ze(se,_e,De,Ue,A){var H={string:function(gt){var li=0;if(gt!=null&&gt!==0){var Ar=(gt.length<<2)+1;li=j(Ar),It(gt,li,Ar)}return li},array:function(gt){var li=j(gt.length);return Kt(gt,li),li}};function Ke(gt){return _e==="string"?Tt(gt):_e==="boolean"?!!gt:gt}var mt=Le(se),zt=[],ot=0;if(Ue)for(var At=0;At<Ue.length;At++){var Si=H[De[At]];Si?(ot===0&&(ot=te()),zt[At]=Si(Ue[At])):zt[At]=Ue[At]}var Et=mt.apply(null,zt);return Et=Ke(Et),ot!==0&&$(ot),Et}function We(se,_e,De,Ue){De=De||[];var A=De.every(function(Ke){return Ke==="number"}),H=_e!=="string";return H&&A&&!Ue?Le(se):function(){return Ze(se,_e,De,arguments)}}var je=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function nt(se,_e,De){for(var Ue=_e+De,A=_e;se[A]&&!(A>=Ue);)++A;if(A-_e>16&&se.subarray&&je)return je.decode(se.subarray(_e,A));for(var H="";_e<A;){var Ke=se[_e++];if(!(Ke&128)){H+=String.fromCharCode(Ke);continue}var mt=se[_e++]&63;if((Ke&224)==192){H+=String.fromCharCode((Ke&31)<<6|mt);continue}var zt=se[_e++]&63;if((Ke&240)==224?Ke=(Ke&15)<<12|mt<<6|zt:Ke=(Ke&7)<<18|mt<<12|zt<<6|se[_e++]&63,Ke<65536)H+=String.fromCharCode(Ke);else{var ot=Ke-65536;H+=String.fromCharCode(55296|ot>>10,56320|ot&1023)}}return H}function Tt(se,_e){return se?nt(Jt,se,_e):""}function Ot(se,_e,De,Ue){if(!(Ue>0))return 0;for(var A=De,H=De+Ue-1,Ke=0;Ke<se.length;++Ke){var mt=se.charCodeAt(Ke);if(mt>=55296&&mt<=57343){var zt=se.charCodeAt(++Ke);mt=65536+((mt&1023)<<10)|zt&1023}if(mt<=127){if(De>=H)break;_e[De++]=mt}else if(mt<=2047){if(De+1>=H)break;_e[De++]=192|mt>>6,_e[De++]=128|mt&63}else if(mt<=65535){if(De+2>=H)break;_e[De++]=224|mt>>12,_e[De++]=128|mt>>6&63,_e[De++]=128|mt&63}else{if(De+3>=H)break;_e[De++]=240|mt>>18,_e[De++]=128|mt>>12&63,_e[De++]=128|mt>>6&63,_e[De++]=128|mt&63}}return _e[De]=0,De-A}function It(se,_e,De){return Ot(se,Jt,_e,De)}typeof TextDecoder<"u"&&new TextDecoder("utf-16le");function Kt(se,_e){Gt.set(se,_e)}function Lt(se,_e){return se%_e>0&&(se+=_e-se%_e),se}var kt,Gt,Jt,si,ui,_i,vi;function Gi(se){kt=se,_.HEAP8=Gt=new Int8Array(se),_.HEAP16=si=new Int16Array(se),_.HEAP32=ui=new Int32Array(se),_.HEAPU8=Jt=new Uint8Array(se),_.HEAPU16=new Uint16Array(se),_.HEAPU32=new Uint32Array(se),_.HEAPF32=_i=new Float32Array(se),_.HEAPF64=vi=new Float64Array(se)}var Fi=5267040,Jn=24128,Wr=_.TOTAL_MEMORY||33554432;_.buffer?kt=_.buffer:kt=new ArrayBuffer(Wr),Wr=kt.byteLength,Gi(kt),ui[Jn>>2]=Fi;function ji(se){for(;se.length>0;){var _e=se.shift();if(typeof _e=="function"){_e();continue}var De=_e.func;typeof De=="number"?_e.arg===void 0?_.dynCall_v(De):_.dynCall_vi(De,_e.arg):De(_e.arg===void 0?null:_e.arg)}}var ri=[],Oi=[],yn=[],Xr=[];function Ye(){if(_.preRun)for(typeof _.preRun=="function"&&(_.preRun=[_.preRun]);_.preRun.length;)ro(_.preRun.shift());ji(ri)}function Dt(){ji(Oi)}function ni(){ji(yn)}function Wi(){if(_.postRun)for(typeof _.postRun=="function"&&(_.postRun=[_.postRun]);_.postRun.length;)Rn(_.postRun.shift());ji(Xr)}function ro(se){ri.unshift(se)}function Rn(se){Xr.unshift(se)}var no=Math.abs,vn=Math.ceil,Ss=Math.floor,es=Math.min,pr=0,Lr=null;function ts(se){pr++,_.monitorRunDependencies&&_.monitorRunDependencies(pr)}function ze(se){if(pr--,_.monitorRunDependencies&&_.monitorRunDependencies(pr),pr==0&&Lr){var _e=Lr;Lr=null,_e()}}_.preloadedImages={},_.preloadedAudios={};var Mi=null,mr="data:application/octet-stream;base64,";function oi(se){return String.prototype.startsWith?se.startsWith(mr):se.indexOf(mr)===0}var qt,Rr;Mi="data:application/octet-stream;base64,AAAAAAAAAAAAAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAAAQAAAAQAAAADAAAABgAAAAUAAAACAAAAAAAAAAIAAAADAAAAAQAAAAQAAAAGAAAAAAAAAAUAAAADAAAABgAAAAQAAAAFAAAAAAAAAAEAAAACAAAABAAAAAUAAAAGAAAAAAAAAAIAAAADAAAAAQAAAAUAAAACAAAAAAAAAAEAAAADAAAABgAAAAQAAAAGAAAAAAAAAAUAAAACAAAAAQAAAAQAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAIAAAADAAAAAAAAAAAAAAACAAAAAAAAAAEAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAYAAAAAAAAABQAAAAAAAAAAAAAABAAAAAUAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAYAAAAAAAAABgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAIAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAIAAAADAAAABQAAAAYAAAAAAAAAAQAAAAIAAAADAAAABAAAAAYAAAAAAAAAAQAAAAIAAAADAAAABAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAIAAAAAAAAAAAAAAAYAAAAAAAAAAwAAAAIAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAFAAAABAAAAAAAAAABAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAYAAAAAAAAABAAAAAAAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAgAAAAQAAAADAAAACAAAAAEAAAAHAAAABgAAAAkAAAAAAAAAAwAAAAIAAAACAAAABgAAAAoAAAALAAAAAAAAAAEAAAAFAAAAAwAAAA0AAAABAAAABwAAAAQAAAAMAAAAAAAAAAQAAAB/AAAADwAAAAgAAAADAAAAAAAAAAwAAAAFAAAAAgAAABIAAAAKAAAACAAAAAAAAAAQAAAABgAAAA4AAAALAAAAEQAAAAEAAAAJAAAAAgAAAAcAAAAVAAAACQAAABMAAAADAAAADQAAAAEAAAAIAAAABQAAABYAAAAQAAAABAAAAAAAAAAPAAAACQAAABMAAAAOAAAAFAAAAAEAAAAHAAAABgAAAAoAAAALAAAAGAAAABcAAAAFAAAAAgAAABIAAAALAAAAEQAAABcAAAAZAAAAAgAAAAYAAAAKAAAADAAAABwAAAANAAAAGgAAAAQAAAAPAAAAAwAAAA0AAAAaAAAAFQAAAB0AAAADAAAADAAAAAcAAAAOAAAAfwAAABEAAAAbAAAACQAAABQAAAAGAAAADwAAABYAAAAcAAAAHwAAAAQAAAAIAAAADAAAABAAAAASAAAAIQAAAB4AAAAIAAAABQAAABYAAAARAAAACwAAAA4AAAAGAAAAIwAAABkAAAAbAAAAEgAAABgAAAAeAAAAIAAAAAUAAAAKAAAAEAAAABMAAAAiAAAAFAAAACQAAAAHAAAAFQAAAAkAAAAUAAAADgAAABMAAAAJAAAAKAAAABsAAAAkAAAAFQAAACYAAAATAAAAIgAAAA0AAAAdAAAABwAAABYAAAAQAAAAKQAAACEAAAAPAAAACAAAAB8AAAAXAAAAGAAAAAsAAAAKAAAAJwAAACUAAAAZAAAAGAAAAH8AAAAgAAAAJQAAAAoAAAAXAAAAEgAAABkAAAAXAAAAEQAAAAsAAAAtAAAAJwAAACMAAAAaAAAAKgAAAB0AAAArAAAADAAAABwAAAANAAAAGwAAACgAAAAjAAAALgAAAA4AAAAUAAAAEQAAABwAAAAfAAAAKgAAACwAAAAMAAAADwAAABoAAAAdAAAAKwAAACYAAAAvAAAADQAAABoAAAAVAAAAHgAAACAAAAAwAAAAMgAAABAAAAASAAAAIQAAAB8AAAApAAAALAAAADUAAAAPAAAAFgAAABwAAAAgAAAAHgAAABgAAAASAAAANAAAADIAAAAlAAAAIQAAAB4AAAAxAAAAMAAAABYAAAAQAAAAKQAAACIAAAATAAAAJgAAABUAAAA2AAAAJAAAADMAAAAjAAAALgAAAC0AAAA4AAAAEQAAABsAAAAZAAAAJAAAABQAAAAiAAAAEwAAADcAAAAoAAAANgAAACUAAAAnAAAANAAAADkAAAAYAAAAFwAAACAAAAAmAAAAfwAAACIAAAAzAAAAHQAAAC8AAAAVAAAAJwAAACUAAAAZAAAAFwAAADsAAAA5AAAALQAAACgAAAAbAAAAJAAAABQAAAA8AAAALgAAADcAAAApAAAAMQAAADUAAAA9AAAAFgAAACEAAAAfAAAAKgAAADoAAAArAAAAPgAAABwAAAAsAAAAGgAAACsAAAA+AAAALwAAAEAAAAAaAAAAKgAAAB0AAAAsAAAANQAAADoAAABBAAAAHAAAAB8AAAAqAAAALQAAACcAAAAjAAAAGQAAAD8AAAA7AAAAOAAAAC4AAAA8AAAAOAAAAEQAAAAbAAAAKAAAACMAAAAvAAAAJgAAACsAAAAdAAAARQAAADMAAABAAAAAMAAAADEAAAAeAAAAIQAAAEMAAABCAAAAMgAAADEAAAB/AAAAPQAAAEIAAAAhAAAAMAAAACkAAAAyAAAAMAAAACAAAAAeAAAARgAAAEMAAAA0AAAAMwAAAEUAAAA2AAAARwAAACYAAAAvAAAAIgAAADQAAAA5AAAARgAAAEoAAAAgAAAAJQAAADIAAAA1AAAAPQAAAEEAAABLAAAAHwAAACkAAAAsAAAANgAAAEcAAAA3AAAASQAAACIAAAAzAAAAJAAAADcAAAAoAAAANgAAACQAAABIAAAAPAAAAEkAAAA4AAAARAAAAD8AAABNAAAAIwAAAC4AAAAtAAAAOQAAADsAAABKAAAATgAAACUAAAAnAAAANAAAADoAAAB/AAAAPgAAAEwAAAAsAAAAQQAAACoAAAA7AAAAPwAAAE4AAABPAAAAJwAAAC0AAAA5AAAAPAAAAEgAAABEAAAAUAAAACgAAAA3AAAALgAAAD0AAAA1AAAAMQAAACkAAABRAAAASwAAAEIAAAA+AAAAKwAAADoAAAAqAAAAUgAAAEAAAABMAAAAPwAAAH8AAAA4AAAALQAAAE8AAAA7AAAATQAAAEAAAAAvAAAAPgAAACsAAABUAAAARQAAAFIAAABBAAAAOgAAADUAAAAsAAAAVgAAAEwAAABLAAAAQgAAAEMAAABRAAAAVQAAADEAAAAwAAAAPQAAAEMAAABCAAAAMgAAADAAAABXAAAAVQAAAEYAAABEAAAAOAAAADwAAAAuAAAAWgAAAE0AAABQAAAARQAAADMAAABAAAAALwAAAFkAAABHAAAAVAAAAEYAAABDAAAANAAAADIAAABTAAAAVwAAAEoAAABHAAAAWQAAAEkAAABbAAAAMwAAAEUAAAA2AAAASAAAAH8AAABJAAAANwAAAFAAAAA8AAAAWAAAAEkAAABbAAAASAAAAFgAAAA2AAAARwAAADcAAABKAAAATgAAAFMAAABcAAAANAAAADkAAABGAAAASwAAAEEAAAA9AAAANQAAAF4AAABWAAAAUQAAAEwAAABWAAAAUgAAAGAAAAA6AAAAQQAAAD4AAABNAAAAPwAAAEQAAAA4AAAAXQAAAE8AAABaAAAATgAAAEoAAAA7AAAAOQAAAF8AAABcAAAATwAAAE8AAABOAAAAPwAAADsAAABdAAAAXwAAAE0AAABQAAAARAAAAEgAAAA8AAAAYwAAAFoAAABYAAAAUQAAAFUAAABeAAAAZQAAAD0AAABCAAAASwAAAFIAAABgAAAAVAAAAGIAAAA+AAAATAAAAEAAAABTAAAAfwAAAEoAAABGAAAAZAAAAFcAAABcAAAAVAAAAEUAAABSAAAAQAAAAGEAAABZAAAAYgAAAFUAAABXAAAAZQAAAGYAAABCAAAAQwAAAFEAAABWAAAATAAAAEsAAABBAAAAaAAAAGAAAABeAAAAVwAAAFMAAABmAAAAZAAAAEMAAABGAAAAVQAAAFgAAABIAAAAWwAAAEkAAABjAAAAUAAAAGkAAABZAAAAYQAAAFsAAABnAAAARQAAAFQAAABHAAAAWgAAAE0AAABQAAAARAAAAGoAAABdAAAAYwAAAFsAAABJAAAAWQAAAEcAAABpAAAAWAAAAGcAAABcAAAAUwAAAE4AAABKAAAAbAAAAGQAAABfAAAAXQAAAE8AAABaAAAATQAAAG0AAABfAAAAagAAAF4AAABWAAAAUQAAAEsAAABrAAAAaAAAAGUAAABfAAAAXAAAAE8AAABOAAAAbQAAAGwAAABdAAAAYAAAAGgAAABiAAAAbgAAAEwAAABWAAAAUgAAAGEAAAB/AAAAYgAAAFQAAABnAAAAWQAAAG8AAABiAAAAbgAAAGEAAABvAAAAUgAAAGAAAABUAAAAYwAAAFAAAABpAAAAWAAAAGoAAABaAAAAcQAAAGQAAABmAAAAUwAAAFcAAABsAAAAcgAAAFwAAABlAAAAZgAAAGsAAABwAAAAUQAAAFUAAABeAAAAZgAAAGUAAABXAAAAVQAAAHIAAABwAAAAZAAAAGcAAABbAAAAYQAAAFkAAAB0AAAAaQAAAG8AAABoAAAAawAAAG4AAABzAAAAVgAAAF4AAABgAAAAaQAAAFgAAABnAAAAWwAAAHEAAABjAAAAdAAAAGoAAABdAAAAYwAAAFoAAAB1AAAAbQAAAHEAAABrAAAAfwAAAGUAAABeAAAAcwAAAGgAAABwAAAAbAAAAGQAAABfAAAAXAAAAHYAAAByAAAAbQAAAG0AAABsAAAAXQAAAF8AAAB1AAAAdgAAAGoAAABuAAAAYgAAAGgAAABgAAAAdwAAAG8AAABzAAAAbwAAAGEAAABuAAAAYgAAAHQAAABnAAAAdwAAAHAAAABrAAAAZgAAAGUAAAB4AAAAcwAAAHIAAABxAAAAYwAAAHQAAABpAAAAdQAAAGoAAAB5AAAAcgAAAHAAAABkAAAAZgAAAHYAAAB4AAAAbAAAAHMAAABuAAAAawAAAGgAAAB4AAAAdwAAAHAAAAB0AAAAZwAAAHcAAABvAAAAcQAAAGkAAAB5AAAAdQAAAH8AAABtAAAAdgAAAHEAAAB5AAAAagAAAHYAAAB4AAAAbAAAAHIAAAB1AAAAeQAAAG0AAAB3AAAAbwAAAHMAAABuAAAAeQAAAHQAAAB4AAAAeAAAAHMAAAByAAAAcAAAAHkAAAB3AAAAdgAAAHkAAAB0AAAAeAAAAHcAAAB1AAAAcQAAAHYAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAABAAAABQAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAACAAAABQAAAAEAAAAAAAAA/////wEAAAAAAAAAAwAAAAQAAAACAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAFAAAAAQAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAAAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAADAAAABQAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAEAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAAAAAABAAAAAwAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAUAAAABAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAABAAAAAUAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAIAAAAFAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAD/////AQAAAAAAAAADAAAABAAAAAIAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAUAAAABAAAAAAAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAEAAAD//////////wEAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAACAAAAAAAAAAAAAAABAAAAAgAAAAYAAAAEAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAcAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAKAAAAAgAAAAAAAAAAAAAAAQAAAAEAAAAFAAAABgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAACAAAAAAAAAAAAAAABAAAAAwAAAAcAAAAGAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABwAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAADgAAAAIAAAAAAAAAAAAAAAEAAAAAAAAACQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAMAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAIAAAAAAAAAAAAAAAEAAAAEAAAACAAAAAoAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAALAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAACQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAgAAAAAAAAAAAAAAAQAAAAsAAAAPAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAIAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAgAAAAAAAAAAAAAAAQAAAAwAAAAQAAAADAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAoAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAPAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAADwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAACAAAAAAAAAAAAAAABAAAACgAAABMAAAAIAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAQAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAACQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAIAAAAAAAAAAAAAAAEAAAANAAAAEQAAAA0AAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAARAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA0AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAACAAAAAAAAAAAAAAABAAAADgAAABIAAAAPAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAADwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABIAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAATAAAAAgAAAAAAAAAAAAAAAQAAAP//////////EwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAASAAAAAAAAABgAAAAAAAAAIQAAAAAAAAAeAAAAAAAAACAAAAADAAAAMQAAAAEAAAAwAAAAAwAAADIAAAADAAAACAAAAAAAAAAFAAAABQAAAAoAAAAFAAAAFgAAAAAAAAAQAAAAAAAAABIAAAAAAAAAKQAAAAEAAAAhAAAAAAAAAB4AAAAAAAAABAAAAAAAAAAAAAAABQAAAAIAAAAFAAAADwAAAAEAAAAIAAAAAAAAAAUAAAAFAAAAHwAAAAEAAAAWAAAAAAAAABAAAAAAAAAAAgAAAAAAAAAGAAAAAAAAAA4AAAAAAAAACgAAAAAAAAALAAAAAAAAABEAAAADAAAAGAAAAAEAAAAXAAAAAwAAABkAAAADAAAAAAAAAAAAAAABAAAABQAAAAkAAAAFAAAABQAAAAAAAAACAAAAAAAAAAYAAAAAAAAAEgAAAAEAAAAKAAAAAAAAAAsAAAAAAAAABAAAAAEAAAADAAAABQAAAAcAAAAFAAAACAAAAAEAAAAAAAAAAAAAAAEAAAAFAAAAEAAAAAEAAAAFAAAAAAAAAAIAAAAAAAAABwAAAAAAAAAVAAAAAAAAACYAAAAAAAAACQAAAAAAAAATAAAAAAAAACIAAAADAAAADgAAAAEAAAAUAAAAAwAAACQAAAADAAAAAwAAAAAAAAANAAAABQAAAB0AAAAFAAAAAQAAAAAAAAAHAAAAAAAAABUAAAAAAAAABgAAAAEAAAAJAAAAAAAAABMAAAAAAAAABAAAAAIAAAAMAAAABQAAABoAAAAFAAAAAAAAAAEAAAADAAAAAAAAAA0AAAAFAAAAAgAAAAEAAAABAAAAAAAAAAcAAAAAAAAAGgAAAAAAAAAqAAAAAAAAADoAAAAAAAAAHQAAAAAAAAArAAAAAAAAAD4AAAADAAAAJgAAAAEAAAAvAAAAAwAAAEAAAAADAAAADAAAAAAAAAAcAAAABQAAACwAAAAFAAAADQAAAAAAAAAaAAAAAAAAACoAAAAAAAAAFQAAAAEAAAAdAAAAAAAAACsAAAAAAAAABAAAAAMAAAAPAAAABQAAAB8AAAAFAAAAAwAAAAEAAAAMAAAAAAAAABwAAAAFAAAABwAAAAEAAAANAAAAAAAAABoAAAAAAAAAHwAAAAAAAAApAAAAAAAAADEAAAAAAAAALAAAAAAAAAA1AAAAAAAAAD0AAAADAAAAOgAAAAEAAABBAAAAAwAAAEsAAAADAAAADwAAAAAAAAAWAAAABQAAACEAAAAFAAAAHAAAAAAAAAAfAAAAAAAAACkAAAAAAAAAKgAAAAEAAAAsAAAAAAAAADUAAAAAAAAABAAAAAQAAAAIAAAABQAAABAAAAAFAAAADAAAAAEAAAAPAAAAAAAAABYAAAAFAAAAGgAAAAEAAAAcAAAAAAAAAB8AAAAAAAAAMgAAAAAAAAAwAAAAAAAAADEAAAADAAAAIAAAAAAAAAAeAAAAAwAAACEAAAADAAAAGAAAAAMAAAASAAAAAwAAABAAAAADAAAARgAAAAAAAABDAAAAAAAAAEIAAAADAAAANAAAAAMAAAAyAAAAAAAAADAAAAAAAAAAJQAAAAMAAAAgAAAAAAAAAB4AAAADAAAAUwAAAAAAAABXAAAAAwAAAFUAAAADAAAASgAAAAMAAABGAAAAAAAAAEMAAAAAAAAAOQAAAAEAAAA0AAAAAwAAADIAAAAAAAAAGQAAAAAAAAAXAAAAAAAAABgAAAADAAAAEQAAAAAAAAALAAAAAwAAAAoAAAADAAAADgAAAAMAAAAGAAAAAwAAAAIAAAADAAAALQAAAAAAAAAnAAAAAAAAACUAAAADAAAAIwAAAAMAAAAZAAAAAAAAABcAAAAAAAAAGwAAAAMAAAARAAAAAAAAAAsAAAADAAAAPwAAAAAAAAA7AAAAAwAAADkAAAADAAAAOAAAAAMAAAAtAAAAAAAAACcAAAAAAAAALgAAAAMAAAAjAAAAAwAAABkAAAAAAAAAJAAAAAAAAAAUAAAAAAAAAA4AAAADAAAAIgAAAAAAAAATAAAAAwAAAAkAAAADAAAAJgAAAAMAAAAVAAAAAwAAAAcAAAADAAAANwAAAAAAAAAoAAAAAAAAABsAAAADAAAANgAAAAMAAAAkAAAAAAAAABQAAAAAAAAAMwAAAAMAAAAiAAAAAAAAABMAAAADAAAASAAAAAAAAAA8AAAAAwAAAC4AAAADAAAASQAAAAMAAAA3AAAAAAAAACgAAAAAAAAARwAAAAMAAAA2AAAAAwAAACQAAAAAAAAAQAAAAAAAAAAvAAAAAAAAACYAAAADAAAAPgAAAAAAAAArAAAAAwAAAB0AAAADAAAAOgAAAAMAAAAqAAAAAwAAABoAAAADAAAAVAAAAAAAAABFAAAAAAAAADMAAAADAAAAUgAAAAMAAABAAAAAAAAAAC8AAAAAAAAATAAAAAMAAAA+AAAAAAAAACsAAAADAAAAYQAAAAAAAABZAAAAAwAAAEcAAAADAAAAYgAAAAMAAABUAAAAAAAAAEUAAAAAAAAAYAAAAAMAAABSAAAAAwAAAEAAAAAAAAAASwAAAAAAAABBAAAAAAAAADoAAAADAAAAPQAAAAAAAAA1AAAAAwAAACwAAAADAAAAMQAAAAMAAAApAAAAAwAAAB8AAAADAAAAXgAAAAAAAABWAAAAAAAAAEwAAAADAAAAUQAAAAMAAABLAAAAAAAAAEEAAAAAAAAAQgAAAAMAAAA9AAAAAAAAADUAAAADAAAAawAAAAAAAABoAAAAAwAAAGAAAAADAAAAZQAAAAMAAABeAAAAAAAAAFYAAAAAAAAAVQAAAAMAAABRAAAAAwAAAEsAAAAAAAAAOQAAAAAAAAA7AAAAAAAAAD8AAAADAAAASgAAAAAAAABOAAAAAwAAAE8AAAADAAAAUwAAAAMAAABcAAAAAwAAAF8AAAADAAAAJQAAAAAAAAAnAAAAAwAAAC0AAAADAAAANAAAAAAAAAA5AAAAAAAAADsAAAAAAAAARgAAAAMAAABKAAAAAAAAAE4AAAADAAAAGAAAAAAAAAAXAAAAAwAAABkAAAADAAAAIAAAAAMAAAAlAAAAAAAAACcAAAADAAAAMgAAAAMAAAA0AAAAAAAAADkAAAAAAAAALgAAAAAAAAA8AAAAAAAAAEgAAAADAAAAOAAAAAAAAABEAAAAAwAAAFAAAAADAAAAPwAAAAMAAABNAAAAAwAAAFoAAAADAAAAGwAAAAAAAAAoAAAAAwAAADcAAAADAAAAIwAAAAAAAAAuAAAAAAAAADwAAAAAAAAALQAAAAMAAAA4AAAAAAAAAEQAAAADAAAADgAAAAAAAAAUAAAAAwAAACQAAAADAAAAEQAAAAMAAAAbAAAAAAAAACgAAAADAAAAGQAAAAMAAAAjAAAAAAAAAC4AAAAAAAAARwAAAAAAAABZAAAAAAAAAGEAAAADAAAASQAAAAAAAABbAAAAAwAAAGcAAAADAAAASAAAAAMAAABYAAAAAwAAAGkAAAADAAAAMwAAAAAAAABFAAAAAwAAAFQAAAADAAAANgAAAAAAAABHAAAAAAAAAFkAAAAAAAAANwAAAAMAAABJAAAAAAAAAFsAAAADAAAAJgAAAAAAAAAvAAAAAwAAAEAAAAADAAAAIgAAAAMAAAAzAAAAAAAAAEUAAAADAAAAJAAAAAMAAAA2AAAAAAAAAEcAAAAAAAAAYAAAAAAAAABoAAAAAAAAAGsAAAADAAAAYgAAAAAAAABuAAAAAwAAAHMAAAADAAAAYQAAAAMAAABvAAAAAwAAAHcAAAADAAAATAAAAAAAAABWAAAAAwAAAF4AAAADAAAAUgAAAAAAAABgAAAAAAAAAGgAAAAAAAAAVAAAAAMAAABiAAAAAAAAAG4AAAADAAAAOgAAAAAAAABBAAAAAwAAAEsAAAADAAAAPgAAAAMAAABMAAAAAAAAAFYAAAADAAAAQAAAAAMAAABSAAAAAAAAAGAAAAAAAAAAVQAAAAAAAABXAAAAAAAAAFMAAAADAAAAZQAAAAAAAABmAAAAAwAAAGQAAAADAAAAawAAAAMAAABwAAAAAwAAAHIAAAADAAAAQgAAAAAAAABDAAAAAwAAAEYAAAADAAAAUQAAAAAAAABVAAAAAAAAAFcAAAAAAAAAXgAAAAMAAABlAAAAAAAAAGYAAAADAAAAMQAAAAAAAAAwAAAAAwAAADIAAAADAAAAPQAAAAMAAABCAAAAAAAAAEMAAAADAAAASwAAAAMAAABRAAAAAAAAAFUAAAAAAAAAXwAAAAAAAABcAAAAAAAAAFMAAAAAAAAATwAAAAAAAABOAAAAAAAAAEoAAAADAAAAPwAAAAEAAAA7AAAAAwAAADkAAAADAAAAbQAAAAAAAABsAAAAAAAAAGQAAAAFAAAAXQAAAAEAAABfAAAAAAAAAFwAAAAAAAAATQAAAAEAAABPAAAAAAAAAE4AAAAAAAAAdQAAAAQAAAB2AAAABQAAAHIAAAAFAAAAagAAAAEAAABtAAAAAAAAAGwAAAAAAAAAWgAAAAEAAABdAAAAAQAAAF8AAAAAAAAAWgAAAAAAAABNAAAAAAAAAD8AAAAAAAAAUAAAAAAAAABEAAAAAAAAADgAAAADAAAASAAAAAEAAAA8AAAAAwAAAC4AAAADAAAAagAAAAAAAABdAAAAAAAAAE8AAAAFAAAAYwAAAAEAAABaAAAAAAAAAE0AAAAAAAAAWAAAAAEAAABQAAAAAAAAAEQAAAAAAAAAdQAAAAMAAABtAAAABQAAAF8AAAAFAAAAcQAAAAEAAABqAAAAAAAAAF0AAAAAAAAAaQAAAAEAAABjAAAAAQAAAFoAAAAAAAAAaQAAAAAAAABYAAAAAAAAAEgAAAAAAAAAZwAAAAAAAABbAAAAAAAAAEkAAAADAAAAYQAAAAEAAABZAAAAAwAAAEcAAAADAAAAcQAAAAAAAABjAAAAAAAAAFAAAAAFAAAAdAAAAAEAAABpAAAAAAAAAFgAAAAAAAAAbwAAAAEAAABnAAAAAAAAAFsAAAAAAAAAdQAAAAIAAABqAAAABQAAAFoAAAAFAAAAeQAAAAEAAABxAAAAAAAAAGMAAAAAAAAAdwAAAAEAAAB0AAAAAQAAAGkAAAAAAAAAdwAAAAAAAABvAAAAAAAAAGEAAAAAAAAAcwAAAAAAAABuAAAAAAAAAGIAAAADAAAAawAAAAEAAABoAAAAAwAAAGAAAAADAAAAeQAAAAAAAAB0AAAAAAAAAGcAAAAFAAAAeAAAAAEAAAB3AAAAAAAAAG8AAAAAAAAAcAAAAAEAAABzAAAAAAAAAG4AAAAAAAAAdQAAAAEAAABxAAAABQAAAGkAAAAFAAAAdgAAAAEAAAB5AAAAAAAAAHQAAAAAAAAAcgAAAAEAAAB4AAAAAQAAAHcAAAAAAAAAcgAAAAAAAABwAAAAAAAAAGsAAAAAAAAAZAAAAAAAAABmAAAAAAAAAGUAAAADAAAAUwAAAAEAAABXAAAAAwAAAFUAAAADAAAAdgAAAAAAAAB4AAAAAAAAAHMAAAAFAAAAbAAAAAEAAAByAAAAAAAAAHAAAAAAAAAAXAAAAAEAAABkAAAAAAAAAGYAAAAAAAAAdQAAAAAAAAB5AAAABQAAAHcAAAAFAAAAbQAAAAEAAAB2AAAAAAAAAHgAAAAAAAAAXwAAAAEAAABsAAAAAQAAAHIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAGAAAAAgAAAAUAAAABAAAABAAAAAAAAAAAAAAABQAAAAMAAAABAAAABgAAAAQAAAACAAAAAAAAAH6iBfbytuk/Gq6akm/58z/Xrm0Liez0P5doSdOpSwRAWs602ULg8D/dT7Rcbo/1v1N1RQHFNOM/g9Snx7HW3L8HWsP8Q3jfP6VwOLosutk/9rjk1YQcxj+gnmKMsNn6P/HDeuPFY+M/YHwDjqKhB0Ci19/fCVrbP4UxKkDWOP6/pvljWa09tL9wi7wrQXjnv/Z6yLImkM2/3yTlOzY14D+m+WNZrT20PzwKVQnrQwNA9nrIsiaQzT/g40rFrRQFwPa45NWEHMa/kbslHEZq97/xw3rjxWPjv4cLC2SMBci/otff3wla27+rKF5oIAv0P1N1RQHFNOO/iDJPGyWHBUAHWsP8Q3jfvwQf/by16gXAfqIF9vK26b8XrO0Vh0r+v9eubQuJ7PS/BxLrA0ZZ479azrTZQuDwv1MK1EuItPw/yscgV9Z6FkAwHBR2WjQMQJNRzXsQ5vY/GlUHVJYKF0DONuFv2lMNQNCGZ28QJfk/0WUwoIL36D8ggDOMQuATQNqMOeAy/wZAWFYOYM+M2z/LWC4uH3oSQDE+LyTsMgRAkJzhRGWFGEDd4soovCQQQKqk0DJMEP8/rGmNdwOLBUAW2X/9xCbjP4hu3dcqJhNAzuYItRvdB0CgzW3zJW/sPxotm/Y2TxRAQAk9XmdDDEC1Kx9MKgT3P1M+NctcghZAFVqcLlb0C0Bgzd3sB2b2P77mZDPUWhZAFROHJpUGCEDAfma5CxXtPz1DWq/zYxRAmhYY5824F0DOuQKWSbAOQNCMqrvu3fs/L6DR22K2wT9nAAxPBU8RQGiN6mW43AFAZhu25b633D8c1YgmzowSQNM25BRKWARArGS08/lNxD+LFssHwmMRQLC5aNcxBgJABL9HT0WRF0CjCmJmOGEOQHsuaVzMP/s/TWJCaGGwBUCeu1PAPLzjP9nqN9DZOBNAKE4JcydbCkCGtbd1qjPzP8dgm9U8jhVAtPeKTkVwDkCeCLss5l37P401XMPLmBdAFd29VMVQDUBg0yA55h75Pz6odcYLCRdApBM4rBrkAkDyAVWgQxbRP4XDMnK20hFAymLlF7EmzD8GUgo9XBHlP3lbK7T9COc/k+OhPthhy7+YGEpnrOvCPzBFhLs15u4/epbqB6H4uz9IuuLF5svev6lzLKY31es/CaQ0envF5z8ZY0xlUADXv7zaz7HYEuI/CfbK1sn16T8uAQfWwxLWPzKn/YuFN94/5KdbC1AFu793fyCSnlfvPzK2y4doAMY/NRg5t1/X6b/shq4QJaHDP5yNIAKPOeI/vpn7BSE30r/X4YQrO6nrv78Ziv/Thto/DqJ1Y6+y5z9l51NaxFrlv8QlA65HOLS/86dxiEc96z+Hj0+LFjneP6LzBZ8LTc2/DaJ1Y6+y579l51NaxFrlP8QlA65HOLQ/8qdxiEc967+Jj0+LFjnev6LzBZ8LTc0/1qdbC1AFuz93fyCSnlfvvzK2y4doAMa/NRg5t1/X6T/vhq4QJaHDv5yNIAKPOeK/wJn7BSE30j/W4YQrO6nrP78Ziv/Thtq/CaQ0envF578XY0xlUADXP7zaz7HYEuK/CvbK1sn16b8rAQfWwxLWvzKn/YuFN96/zWLlF7EmzL8GUgo9XBHlv3lbK7T9COe/kOOhPthhyz+cGEpnrOvCvzBFhLs15u6/c5bqB6H4u79IuuLF5sveP6lzLKY31eu/AQAAAP////8HAAAA/////zEAAAD/////VwEAAP////9hCQAA/////6dBAAD/////kcsBAP/////3kAwA/////8H2VwAAAAAAAAAAAAAAAAACAAAA/////w4AAAD/////YgAAAP////+uAgAA/////8ISAAD/////ToMAAP////8ilwMA/////+4hGQD/////gu2vAAAAAAAAAAAAAAAAAAAAAAACAAAA//////////8BAAAAAwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////AgAAAP//////////AQAAAAAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD/////////////////////AQAAAP///////////////wIAAAD///////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP///////////////////////////////wIAAAD///////////////8BAAAA/////////////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAABAAAA//////////8CAAAA//////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAAAQAAAP//////////AgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAACAAAAAAAAAAIAAAABAAAAAQAAAAIAAAACAAAAAAAAAAUAAAAFAAAAAAAAAAIAAAACAAAAAwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAgAAAAEAAAACAAAAAgAAAAIAAAAAAAAABQAAAAYAAAAAAAAAAgAAAAIAAAADAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAAAAAACAAAAAQAAAAMAAAACAAAAAgAAAAAAAAAFAAAABwAAAAAAAAACAAAAAgAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAACAAAAAAAAAAIAAAABAAAABAAAAAIAAAACAAAAAAAAAAUAAAAIAAAAAAAAAAIAAAACAAAAAwAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAIAAAAAAAAAAgAAAAEAAAAAAAAAAgAAAAIAAAAAAAAABQAAAAkAAAAAAAAAAgAAAAIAAAADAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAgAAAAIAAAAAAAAAAwAAAA4AAAACAAAAAAAAAAIAAAADAAAAAAAAAAAAAAACAAAAAgAAAAMAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAACAAAAAgAAAAAAAAADAAAACgAAAAIAAAAAAAAAAgAAAAMAAAABAAAAAAAAAAIAAAACAAAAAwAAAAcAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAIAAAACAAAAAAAAAAMAAAALAAAAAgAAAAAAAAACAAAAAwAAAAIAAAAAAAAAAgAAAAIAAAADAAAACAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAgAAAAIAAAAAAAAAAwAAAAwAAAACAAAAAAAAAAIAAAADAAAAAwAAAAAAAAACAAAAAgAAAAMAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAACAAAAAgAAAAAAAAADAAAADQAAAAIAAAAAAAAAAgAAAAMAAAAEAAAAAAAAAAIAAAACAAAAAwAAAAoAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAIAAAACAAAAAAAAAAMAAAAGAAAAAgAAAAAAAAACAAAAAwAAAA8AAAAAAAAAAgAAAAIAAAADAAAACwAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAgAAAAIAAAAAAAAAAwAAAAcAAAACAAAAAAAAAAIAAAADAAAAEAAAAAAAAAACAAAAAgAAAAMAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAcAAAACAAAAAgAAAAAAAAADAAAACAAAAAIAAAAAAAAAAgAAAAMAAAARAAAAAAAAAAIAAAACAAAAAwAAAA0AAAAAAAAAAAAAAAAAAAAAAAAACAAAAAIAAAACAAAAAAAAAAMAAAAJAAAAAgAAAAAAAAACAAAAAwAAABIAAAAAAAAAAgAAAAIAAAADAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAgAAAAIAAAAAAAAAAwAAAAUAAAACAAAAAAAAAAIAAAADAAAAEwAAAAAAAAACAAAAAgAAAAMAAAAPAAAAAAAAAAAAAAAAAAAAAAAAABAAAAACAAAAAAAAAAIAAAABAAAAEwAAAAIAAAACAAAAAAAAAAUAAAAKAAAAAAAAAAIAAAACAAAAAwAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEQAAAAIAAAAAAAAAAgAAAAEAAAAPAAAAAgAAAAIAAAAAAAAABQAAAAsAAAAAAAAAAgAAAAIAAAADAAAAEQAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAgAAAAAAAAACAAAAAQAAABAAAAACAAAAAgAAAAAAAAAFAAAADAAAAAAAAAACAAAAAgAAAAMAAAASAAAAAAAAAAAAAAAAAAAAAAAAABMAAAACAAAAAAAAAAIAAAABAAAAEQAAAAIAAAACAAAAAAAAAAUAAAANAAAAAAAAAAIAAAACAAAAAwAAABMAAAAAAAAAAAAAAAAAAAAAAAAADwAAAAIAAAAAAAAAAgAAAAEAAAASAAAAAgAAAAIAAAAAAAAABQAAAA4AAAAAAAAAAgAAAAIAAAADAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAAAAAAAAAAAAAIAAAABAAAAAAAAAAEAAAACAAAAAQAAAAAAAAACAAAAAAAAAAUAAAAEAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAQAAAAAAAAABQAAAAAAAAACAAAAAQAAAAAAAAABAAAAAgAAAAAAAAAAAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAABAAAAAAAAAAIAAAACAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAAEAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAQAAAAAAAAABQAAAAUAAAAAAAAAAQAAAAAAAAAAAAAAOgehWlKfUEEz1zLi+JsiQa2og3wcMfVAWCbHorc0yEDi+Yn/Y6mbQJ11/mfsnG9At6bnG4UQQkBvMCQWKqUUQJVmwwswmOc/3hVgVBL3uj//qqOEOdGOPw/WDN4gnGE/H3ANkCUgND+AA8btKgAHPwTXBqJVSdo+XfRQAqsKrj4fc+zLYbSPQklEmCZHv2FCUP+uDso1NEKYtPhwphUHQptxnyFXYdpB7CddZAMmrkGAt1AxSTqBQUibBVdTsFNBSuX3MV+AJkFocv82SLf5QAqmgj7AY81A23VDSEnLoEDGEJVSeDFzQDYrqvBk70VA8U157pcRGUBWfEF+ZKbsP7KBdLHZTpFAqKYk69AqekDbeGY41MdjQD8AZzHK501A1vcrrjubNkD5LnquvBYhQCbiRRD71QlAqt72EbOH8z8Eu+jL1YbdP4uaox/xUcY/abedg1XfsD+BsUdzJ4KZP5wE9YFySIM/rW1kAKMpbT+rZFthVRhWPy4PKlXIs0A/qMZLlwDnMEHByqEF0I0ZQQYSFD8lUQNBPpY+dFs07UAH8BZImBPWQN9RY0I0sMBA2T7kLfc6qUByFYvfhBKTQMq+0Mis1XxA0XQbeQXMZUBJJ5aEGXpQQP7/SY0a6ThAaMD92b/UIkAs8s8yqXoMQNIegOvCk/U/aOi7NZJP4D8AAAAA/////wAAAAAAAAAAAAAAAAAAAAAAAAAA/////////////////////////////////////wAAAAD/////AAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAA/////wAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAP////8AAAAABQAAAAAAAAAAAAAAAAAAAAAAAAD/////BQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAA/////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP////////////////////////////////////8AAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/////////////////////////////////////AAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAABQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/////////////////////////////////////wAAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAQAAAAAAAAABAAAAAAAAAAUAAAABAAAAAQAAAAAAAAAAAAAAAQAAAAEAAAAAAAAAAQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAEAAQAAAQEAAAAAAAEAAAABAAAAAQABAAAAAAAAAAAAAAAAAAAAAAcAAAAHAAAAAQAAAAIAAAAEAAAAAwAAAAAAAAAAAAAABwAAAAMAAAABAAAAAgAAAAUAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAAAAAACAAAAAQAAAAMAAAAOAAAABgAAAAsAAAACAAAABwAAAAEAAAAYAAAABQAAAAoAAAABAAAABgAAAAAAAAAmAAAABwAAAAwAAAADAAAACAAAAAIAAAAxAAAACQAAAA4AAAAAAAAABQAAAAQAAAA6AAAACAAAAA0AAAAEAAAACQAAAAMAAAA/AAAACwAAAAYAAAAPAAAACgAAABAAAABIAAAADAAAAAcAAAAQAAAACwAAABEAAABTAAAACgAAAAUAAAATAAAADgAAAA8AAABhAAAADQAAAAgAAAARAAAADAAAABIAAABrAAAADgAAAAkAAAASAAAADQAAABMAAAB1AAAADwAAABMAAAARAAAAEgAAABAAAAAGAAAAAgAAAAMAAAAFAAAABAAAAAAAAAAAAAAAAAAAAAYAAAACAAAAAwAAAAEAAAAFAAAABAAAAAAAAAAAAAAABwAAAAUAAAADAAAABAAAAAEAAAAAAAAAAgAAAAAAAAACAAAAAwAAAAEAAAAFAAAABAAAAAYAAAAAAAAAAAAAAGFsZ29zLmMAaDNOZWlnaGJvclJvdGF0aW9ucwBjb29yZGlqay5jAF91cEFwN0NoZWNrZWQAX3VwQXA3ckNoZWNrZWQAZGlyZWN0ZWRFZGdlLmMAZGlyZWN0ZWRFZGdlVG9Cb3VuZGFyeQBhZGphY2VudEZhY2VEaXJbdG1wRmlqay5mYWNlXVtmaWprLmZhY2VdID09IEtJAGZhY2VpamsuYwBfZmFjZUlqa1BlbnRUb0NlbGxCb3VuZGFyeQBhZGphY2VudEZhY2VEaXJbY2VudGVySUpLLmZhY2VdW2ZhY2UyXSA9PSBLSQBfZmFjZUlqa1RvQ2VsbEJvdW5kYXJ5AGgzSW5kZXguYwBjb21wYWN0Q2VsbHMAbGF0TG5nVG9DZWxsAGNlbGxUb0NoaWxkUG9zAHZhbGlkYXRlQ2hpbGRQb3MAbGF0TG5nLmMAY2VsbEFyZWFSYWRzMgBwb2x5Z29uLT5uZXh0ID09IE5VTEwAbGlua2VkR2VvLmMAYWRkTmV3TGlua2VkUG9seWdvbgBuZXh0ICE9IE5VTEwAbG9vcCAhPSBOVUxMAGFkZE5ld0xpbmtlZExvb3AAcG9seWdvbi0+Zmlyc3QgPT0gTlVMTABhZGRMaW5rZWRMb29wAGNvb3JkICE9IE5VTEwAYWRkTGlua2VkQ29vcmQAbG9vcC0+Zmlyc3QgPT0gTlVMTABpbm5lckxvb3BzICE9IE5VTEwAbm9ybWFsaXplTXVsdGlQb2x5Z29uAGJib3hlcyAhPSBOVUxMAGNhbmRpZGF0ZXMgIT0gTlVMTABmaW5kUG9seWdvbkZvckhvbGUAY2FuZGlkYXRlQkJveGVzICE9IE5VTEwAcmV2RGlyICE9IElOVkFMSURfRElHSVQAbG9jYWxpai5jAGNlbGxUb0xvY2FsSWprAGJhc2VDZWxsICE9IG9yaWdpbkJhc2VDZWxsACEob3JpZ2luT25QZW50ICYmIGluZGV4T25QZW50KQBiYXNlQ2VsbCA9PSBvcmlnaW5CYXNlQ2VsbABiYXNlQ2VsbCAhPSBJTlZBTElEX0JBU0VfQ0VMTABsb2NhbElqa1RvQ2VsbAAhX2lzQmFzZUNlbGxQZW50YWdvbihiYXNlQ2VsbCkAYmFzZUNlbGxSb3RhdGlvbnMgPj0gMABncmlkUGF0aENlbGxzADAAdmVydGV4LmMAY2VsbFRvVmVydGV4AGdyYXBoLT5idWNrZXRzICE9IE5VTEwAdmVydGV4R3JhcGguYwBpbml0VmVydGV4R3JhcGgAbm9kZSAhPSBOVUxMAGFkZFZlcnRleE5vZGU=";var Ts=24144;function xn(se){return se}function so(se){var _e=/\b__Z[\w\d_]+/g;return se.replace(_e,function(De){var Ue=De;return De===Ue?De:Ue+" ["+De+"]"})}function is(){var se=new Error;if(!se.stack){try{throw new Error(0)}catch(_e){se=_e}if(!se.stack)return"(no stack trace available)"}return se.stack.toString()}function Fn(){var se=is();return _.extraStackTrace&&(se+=`
`+_.extraStackTrace()),so(se)}function rs(se,_e,De,Ue){Be("Assertion failed: "+Tt(se)+", at: "+[_e?Tt(_e):"unknown filename",De,Ue?Tt(Ue):"unknown function"])}function qe(){return Gt.length}function An(se,_e,De){Jt.set(Jt.subarray(_e,_e+De),se)}function Ei(se){return _.___errno_location&&(ui[_.___errno_location()>>2]=se),se}function ns(se){Be("OOM")}function un(se){try{var _e=new ArrayBuffer(se);return _e.byteLength!=se?void 0:(new Int8Array(_e).set(Gt),ae(_e),Gi(_e),1)}catch{}}function $e(se){var _e=qe(),De=16777216,Ue=2147483648-De;if(se>Ue)return!1;for(var A=16777216,H=Math.max(_e,A);H<se;)H<=536870912?H=Lt(2*H,De):H=Math.min(Lt((3*H+2147483648)/4,De),Ue);var Ke=un(H);return!!Ke}var Vt=typeof atob=="function"?atob:function(se){var _e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",De="",Ue,A,H,Ke,mt,zt,ot,At=0;se=se.replace(/[^A-Za-z0-9\+\/\=]/g,"");do Ke=_e.indexOf(se.charAt(At++)),mt=_e.indexOf(se.charAt(At++)),zt=_e.indexOf(se.charAt(At++)),ot=_e.indexOf(se.charAt(At++)),Ue=Ke<<2|mt>>4,A=(mt&15)<<4|zt>>2,H=(zt&3)<<6|ot,De=De+String.fromCharCode(Ue),zt!==64&&(De=De+String.fromCharCode(A)),ot!==64&&(De=De+String.fromCharCode(H));while(At<se.length);return De};function Mt(se){try{for(var _e=Vt(se),De=new Uint8Array(_e.length),Ue=0;Ue<_e.length;++Ue)De[Ue]=_e.charCodeAt(Ue);return De}catch{throw new Error("Converting base64 string to bytes failed.")}}function Xi(se){if(oi(se))return Mt(se.slice(mr.length))}var cn={Math,Int8Array,Int32Array,Uint8Array,Float32Array,Float64Array},Bt={a:Be,b:ie,c:X,d:rs,e:Ei,f:qe,g:An,h:$e,i:ns,j:xn,k:so,l:un,m:is,n:Fn,o:Ts,p:Jn},Ve=function(se,_e,De){"almost asm";var Ue=new se.Int8Array(De),A=new se.Int32Array(De);new se.Uint8Array(De),new se.Float32Array(De);var H=new se.Float64Array(De),Ke=_e.o|0,mt=_e.p|0,zt=se.Math.floor,ot=se.Math.abs,At=se.Math.sqrt,Si=se.Math.pow,Et=se.Math.cos,gt=se.Math.sin,li=se.Math.tan,Ar=se.Math.acos,il=se.Math.asin,On=se.Math.atan,Yi=se.Math.atan2,Is=se.Math.ceil,Zt=se.Math.imul,oo=se.Math.min,Go=se.Math.max,Ci=se.Math.clz32,St=_e.b,ne=_e.c,_t=_e.d,qi=_e.e,jo=_e.f,Ms=_e.g,xi=_e.h,ti=_e.i,J=24160;function Ti(i){return Ue=new Int8Array(i),A=new Int32Array(i),H=new Float64Array(i),De=i,!0}function qo(i){i=i|0;var n=0;return n=J,J=J+i|0,J=J+15&-16,n|0}function Fr(){return J|0}function pa(i){i=i|0,J=i}function Vn(i,n){i=i|0,J=i}function rl(i,n){i=i|0,n=n|0;var s=0,l=0,c=0;return(i|0)<0?(n=2,n|0):(i|0)>13780509?(n=ia(15,n)|0,n|0):(s=((i|0)<0)<<31>>31,c=Qi(i|0,s|0,3,0)|0,l=ne()|0,s=yt(i|0,s|0,1,0)|0,s=Qi(c|0,l|0,s|0,ne()|0)|0,s=yt(s|0,ne()|0,1,0)|0,i=ne()|0,A[n>>2]=s,A[n+4>>2]=i,n=0,n|0)}function Zo(i,n,s,l){return i=i|0,n=n|0,s=s|0,l=l|0,ao(i,n,s,l,0)|0}function ao(i,n,s,l,c){i=i|0,n=n|0,s=s|0,l=l|0,c=c|0;var f=0,y=0,x=0,S=0,C=0;if(S=J,J=J+16|0,y=S,!(lo(i,n,s,l,c)|0))return l=0,J=S,l|0;do if((s|0)>=0){if((s|0)>13780509){if(f=ia(15,y)|0,f|0)break;x=y,y=A[x>>2]|0,x=A[x+4>>2]|0}else f=((s|0)<0)<<31>>31,C=Qi(s|0,f|0,3,0)|0,x=ne()|0,f=yt(s|0,f|0,1,0)|0,f=Qi(C|0,x|0,f|0,ne()|0)|0,f=yt(f|0,ne()|0,1,0)|0,x=ne()|0,A[y>>2]=f,A[y+4>>2]=x,y=f;if(g(l|0,0,y<<3|0)|0,c|0){g(c|0,0,y<<2|0)|0,f=sr(i,n,s,l,c,y,x,0)|0;break}f=ar(y,4)|0,f?(C=sr(i,n,s,l,f,y,x,0)|0,Ct(f),f=C):f=13}else f=2;while(!1);return C=f,J=S,C|0}function lo(i,n,s,l,c){i=i|0,n=n|0,s=s|0,l=l|0,c=c|0;var f=0,y=0,x=0,S=0,C=0,z=0,G=0,N=0,Z=0,Q=0,ee=0;if(ee=J,J=J+16|0,Z=ee,Q=ee+8|0,N=Z,A[N>>2]=i,A[N+4>>2]=n,(s|0)<0)return Q=2,J=ee,Q|0;if(f=l,A[f>>2]=i,A[f+4>>2]=n,f=(c|0)!=0,f&&(A[c>>2]=0),ai(i,n)|0)return Q=9,J=ee,Q|0;A[Q>>2]=0;e:do if((s|0)>=1)if(f)for(z=1,C=0,G=0,N=1,f=i;;){if(!(C|G)){if(f=zi(f,n,4,Q,Z)|0,f|0)break e;if(n=Z,f=A[n>>2]|0,n=A[n+4>>2]|0,ai(f,n)|0){f=9;break e}}if(f=zi(f,n,A[22384+(G<<2)>>2]|0,Q,Z)|0,f|0)break e;if(n=Z,f=A[n>>2]|0,n=A[n+4>>2]|0,i=l+(z<<3)|0,A[i>>2]=f,A[i+4>>2]=n,A[c+(z<<2)>>2]=N,i=C+1|0,y=(i|0)==(N|0),x=G+1|0,S=(x|0)==6,ai(f,n)|0){f=9;break e}if(N=N+(S&y&1)|0,(N|0)>(s|0)){f=0;break}else z=z+1|0,C=y?0:i,G=y?S?0:x:G}else for(z=1,C=0,G=0,N=1,f=i;;){if(!(C|G)){if(f=zi(f,n,4,Q,Z)|0,f|0)break e;if(n=Z,f=A[n>>2]|0,n=A[n+4>>2]|0,ai(f,n)|0){f=9;break e}}if(f=zi(f,n,A[22384+(G<<2)>>2]|0,Q,Z)|0,f|0)break e;if(n=Z,f=A[n>>2]|0,n=A[n+4>>2]|0,i=l+(z<<3)|0,A[i>>2]=f,A[i+4>>2]=n,i=C+1|0,y=(i|0)==(N|0),x=G+1|0,S=(x|0)==6,ai(f,n)|0){f=9;break e}if(N=N+(S&y&1)|0,(N|0)>(s|0)){f=0;break}else z=z+1|0,C=y?0:i,G=y?S?0:x:G}else f=0;while(!1);return Q=f,J=ee,Q|0}function sr(i,n,s,l,c,f,y,x){i=i|0,n=n|0,s=s|0,l=l|0,c=c|0,f=f|0,y=y|0,x=x|0;var S=0,C=0,z=0,G=0,N=0,Z=0,Q=0,ee=0,he=0,ge=0;if(ee=J,J=J+16|0,Z=ee+8|0,Q=ee,S=tn(i|0,n|0,f|0,y|0)|0,z=ne()|0,G=l+(S<<3)|0,he=G,ge=A[he>>2]|0,he=A[he+4>>2]|0,C=(ge|0)==(i|0)&(he|0)==(n|0),!((ge|0)==0&(he|0)==0|C))do S=yt(S|0,z|0,1,0)|0,S=$s(S|0,ne()|0,f|0,y|0)|0,z=ne()|0,G=l+(S<<3)|0,ge=G,he=A[ge>>2]|0,ge=A[ge+4>>2]|0,C=(he|0)==(i|0)&(ge|0)==(n|0);while(!((he|0)==0&(ge|0)==0|C));if(S=c+(S<<2)|0,C&&(A[S>>2]|0)<=(x|0)||(ge=G,A[ge>>2]=i,A[ge+4>>2]=n,A[S>>2]=x,(x|0)>=(s|0)))return ge=0,J=ee,ge|0;switch(C=x+1|0,A[Z>>2]=0,S=zi(i,n,2,Z,Q)|0,S|0){case 9:{N=9;break}case 0:{S=Q,S=sr(A[S>>2]|0,A[S+4>>2]|0,s,l,c,f,y,C)|0,S||(N=9);break}}e:do if((N|0)==9){switch(A[Z>>2]=0,S=zi(i,n,3,Z,Q)|0,S|0){case 9:break;case 0:{if(S=Q,S=sr(A[S>>2]|0,A[S+4>>2]|0,s,l,c,f,y,C)|0,S|0)break e;break}default:break e}switch(A[Z>>2]=0,S=zi(i,n,1,Z,Q)|0,S|0){case 9:break;case 0:{if(S=Q,S=sr(A[S>>2]|0,A[S+4>>2]|0,s,l,c,f,y,C)|0,S|0)break e;break}default:break e}switch(A[Z>>2]=0,S=zi(i,n,5,Z,Q)|0,S|0){case 9:break;case 0:{if(S=Q,S=sr(A[S>>2]|0,A[S+4>>2]|0,s,l,c,f,y,C)|0,S|0)break e;break}default:break e}switch(A[Z>>2]=0,S=zi(i,n,4,Z,Q)|0,S|0){case 9:break;case 0:{if(S=Q,S=sr(A[S>>2]|0,A[S+4>>2]|0,s,l,c,f,y,C)|0,S|0)break e;break}default:break e}switch(A[Z>>2]=0,S=zi(i,n,6,Z,Q)|0,S|0){case 9:break;case 0:{if(S=Q,S=sr(A[S>>2]|0,A[S+4>>2]|0,s,l,c,f,y,C)|0,S|0)break e;break}default:break e}return ge=0,J=ee,ge|0}while(!1);return ge=S,J=ee,ge|0}function zi(i,n,s,l,c){i=i|0,n=n|0,s=s|0,l=l|0,c=c|0;var f=0,y=0,x=0,S=0,C=0,z=0,G=0,N=0,Z=0,Q=0;if(s>>>0>6)return c=1,c|0;if(G=(A[l>>2]|0)%6|0,A[l>>2]=G,(G|0)>0){f=0;do s=as(s)|0,f=f+1|0;while((f|0)<(A[l>>2]|0))}if(G=Ge(i|0,n|0,45)|0,ne()|0,z=G&127,z>>>0>121)return c=5,c|0;S=ur(i,n)|0,f=Ge(i|0,n|0,52)|0,ne()|0,f=f&15;e:do if(!f)C=8;else{for(;;){if(y=(15-f|0)*3|0,x=Ge(i|0,n|0,y|0)|0,ne()|0,x=x&7,(x|0)==7){n=5;break}if(Q=(cr(f)|0)==0,f=f+-1|0,N=Oe(7,0,y|0)|0,n=n&~(ne()|0),Z=Oe(A[(Q?432:16)+(x*28|0)+(s<<2)>>2]|0,0,y|0)|0,y=ne()|0,s=A[(Q?640:224)+(x*28|0)+(s<<2)>>2]|0,i=Z|i&~N,n=y|n,!s){s=0;break e}if(!f){C=8;break e}}return n|0}while(!1);(C|0)==8&&(Q=A[848+(z*28|0)+(s<<2)>>2]|0,Z=Oe(Q|0,0,45)|0,i=Z|i,n=ne()|0|n&-1040385,s=A[4272+(z*28|0)+(s<<2)>>2]|0,(Q&127|0)==127&&(Q=Oe(A[848+(z*28|0)+20>>2]|0,0,45)|0,n=ne()|0|n&-1040385,s=A[4272+(z*28|0)+20>>2]|0,i=kn(Q|i,n)|0,n=ne()|0,A[l>>2]=(A[l>>2]|0)+1)),x=Ge(i|0,n|0,45)|0,ne()|0,x=x&127;e:do if(ci(x)|0){t:do if((ur(i,n)|0)==1){if((z|0)!=(x|0))if(Ho(x,A[7696+(z*28|0)>>2]|0)|0){i=Jo(i,n)|0,y=1,n=ne()|0;break}else _t(23313,22416,436,22424);switch(S|0){case 3:{i=kn(i,n)|0,n=ne()|0,A[l>>2]=(A[l>>2]|0)+1,y=0;break t}case 5:{i=Jo(i,n)|0,n=ne()|0,A[l>>2]=(A[l>>2]|0)+5,y=0;break t}case 0:return Q=9,Q|0;default:return Q=1,Q|0}}else y=0;while(!1);if((s|0)>0){f=0;do i=Ns(i,n)|0,n=ne()|0,f=f+1|0;while((f|0)!=(s|0))}if((z|0)!=(x|0)){if(!($o(x)|0)){if((y|0)!=0|(ur(i,n)|0)!=5)break;A[l>>2]=(A[l>>2]|0)+1;break}switch(G&127){case 8:case 118:break e}(ur(i,n)|0)!=3&&(A[l>>2]=(A[l>>2]|0)+1)}}else if((s|0)>0){f=0;do i=kn(i,n)|0,n=ne()|0,f=f+1|0;while((f|0)!=(s|0))}while(!1);return A[l>>2]=((A[l>>2]|0)+s|0)%6|0,Q=c,A[Q>>2]=i,A[Q+4>>2]=n,Q=0,Q|0}function ss(i,n,s,l){i=i|0,n=n|0,s=s|0,l=l|0;var c=0,f=0,y=0,x=0,S=0,C=0;for(x=J,J=J+16|0,f=x,y=x+8|0,c=(ai(i,n)|0)==0,c=c?1:2;;){if(A[y>>2]=0,C=(zi(i,n,c,y,f)|0)==0,S=f,C&((A[S>>2]|0)==(s|0)?(A[S+4>>2]|0)==(l|0):0)){i=4;break}if(c=c+1|0,c>>>0>=7){c=7,i=4;break}}return(i|0)==4?(J=x,c|0):0}function nl(i,n,s,l){i=i|0,n=n|0,s=s|0,l=l|0;var c=0,f=0,y=0,x=0,S=0,C=0,z=0,G=0,N=0,Z=0,Q=0;if(Q=J,J=J+16|0,N=Q,Z=Q+8|0,G=N,A[G>>2]=i,A[G+4>>2]=n,!s)return Z=l,A[Z>>2]=i,A[Z+4>>2]=n,Z=0,J=Q,Z|0;A[Z>>2]=0;e:do if(ai(i,n)|0)i=9;else{if(f=(s|0)>0,f){c=0,G=i;do{if(i=zi(G,n,4,Z,N)|0,i|0)break e;if(n=N,G=A[n>>2]|0,n=A[n+4>>2]|0,c=c+1|0,ai(G,n)|0){i=9;break e}}while((c|0)<(s|0));if(z=l,A[z>>2]=G,A[z+4>>2]=n,z=s+-1|0,f){C=0,i=1;do{if(c=22384+(C<<2)|0,(C|0)==5)for(y=A[c>>2]|0,f=0,c=i;;){if(i=N,i=zi(A[i>>2]|0,A[i+4>>2]|0,y,Z,N)|0,i|0)break e;if((f|0)!=(z|0))if(S=N,x=A[S>>2]|0,S=A[S+4>>2]|0,i=l+(c<<3)|0,A[i>>2]=x,A[i+4>>2]=S,!(ai(x,S)|0))i=c+1|0;else{i=9;break e}else i=c;if(f=f+1|0,(f|0)>=(s|0))break;c=i}else for(y=N,S=A[c>>2]|0,x=0,c=i,f=A[y>>2]|0,y=A[y+4>>2]|0;;){if(i=zi(f,y,S,Z,N)|0,i|0)break e;if(y=N,f=A[y>>2]|0,y=A[y+4>>2]|0,i=l+(c<<3)|0,A[i>>2]=f,A[i+4>>2]=y,i=c+1|0,ai(f,y)|0){i=9;break e}if(x=x+1|0,(x|0)>=(s|0))break;c=i}C=C+1|0}while(C>>>0<6);i=N,y=G,c=A[i>>2]|0,f=n,i=A[i+4>>2]|0}else y=G,c=G,f=n,i=n}else y=l,A[y>>2]=i,A[y+4>>2]=n,y=i,c=i,f=n,i=n;i=(y|0)==(c|0)&(f|0)==(i|0)?0:9}while(!1);return Z=i,J=Q,Z|0}function Hl(i,n,s,l){i=i|0,n=n|0,s=s|0,l=l|0;var c=0,f=0,y=0,x=0,S=0,C=0;if(x=J,J=J+48|0,c=x+16|0,f=x+8|0,y=x,s|0)return y=15,J=x,y|0;if(C=i,S=A[C+4>>2]|0,s=f,A[s>>2]=A[C>>2],A[s+4>>2]=S,Ra(f,c),n=co(c,n,y)|0,!n){if(s=A[f>>2]|0,f=A[i+8>>2]|0,(f|0)>0){c=A[i+12>>2]|0,n=0;do s=(A[c+(n<<3)>>2]|0)+s|0,n=n+1|0;while((n|0)<(f|0))}n=y,c=A[n>>2]|0,n=A[n+4>>2]|0,f=((s|0)<0)<<31>>31,(n|0)<(f|0)|(n|0)==(f|0)&c>>>0<s>>>0?(n=y,A[n>>2]=s,A[n+4>>2]=f,n=f):s=c,S=yt(s|0,n|0,12,0)|0,C=ne()|0,n=y,A[n>>2]=S,A[n+4>>2]=C,n=l,A[n>>2]=S,A[n+4>>2]=C,n=0}return C=n,J=x,C|0}function Qo(i,n,s,l,c,f,y){i=i|0,n=n|0,s=s|0,l=l|0,c=c|0,f=f|0,y=y|0;var x=0,S=0,C=0,z=0,G=0,N=0,Z=0,Q=0,ee=0,he=0,ge=0,oe=0,fe=0,pe=0,Fe=0,Me=0,Pe=0,Ce=0,vt=0,at=0,rt=0,et=0,ft=0,ut=0,Rt=0,dt=0,Pt=0,di=0,pi=0;if(Rt=J,J=J+64|0,rt=Rt+48|0,et=Rt+32|0,ft=Rt+24|0,Fe=Rt+8|0,Me=Rt,S=A[i>>2]|0,(S|0)<=0)return ut=0,J=Rt,ut|0;for(Pe=i+4|0,Ce=rt+8|0,vt=et+8|0,at=Fe+8|0,x=0,fe=0;;){C=A[Pe>>2]|0,oe=C+(fe<<4)|0,A[rt>>2]=A[oe>>2],A[rt+4>>2]=A[oe+4>>2],A[rt+8>>2]=A[oe+8>>2],A[rt+12>>2]=A[oe+12>>2],(fe|0)==(S+-1|0)?(A[et>>2]=A[C>>2],A[et+4>>2]=A[C+4>>2],A[et+8>>2]=A[C+8>>2],A[et+12>>2]=A[C+12>>2]):(oe=C+(fe+1<<4)|0,A[et>>2]=A[oe>>2],A[et+4>>2]=A[oe+4>>2],A[et+8>>2]=A[oe+8>>2],A[et+12>>2]=A[oe+12>>2]),S=Ds(rt,et,l,ft)|0;e:do if(S)C=0,x=S;else if(C=ft,S=A[C>>2]|0,C=A[C+4>>2]|0,(C|0)>0|(C|0)==0&S>>>0>0){ge=0,oe=0;t:for(;;){if(pi=+H[rt>>3],he=$t(S|0,C|0,ge|0,oe|0)|0,di=+(he>>>0)+4294967296*+(ne()|0),dt=+(S>>>0)+4294967296*+(C|0),Pt=+(ge>>>0)+4294967296*+(oe|0),H[Fe>>3]=pi*di/dt+ +H[et>>3]*Pt/dt,H[at>>3]=+H[Ce>>3]*di/dt+ +H[vt>>3]*Pt/dt,S=vo(Fe,l,Me)|0,S|0){x=S;break}he=Me,ee=A[he>>2]|0,he=A[he+4>>2]|0,N=tn(ee|0,he|0,n|0,s|0)|0,z=ne()|0,S=y+(N<<3)|0,G=S,C=A[G>>2]|0,G=A[G+4>>2]|0;i:do if((C|0)==0&(G|0)==0)pe=S,ut=16;else for(Z=0,Q=0;;){if((Z|0)>(s|0)|(Z|0)==(s|0)&Q>>>0>n>>>0){x=1;break t}if((C|0)==(ee|0)&(G|0)==(he|0))break i;if(S=yt(N|0,z|0,1,0)|0,N=$s(S|0,ne()|0,n|0,s|0)|0,z=ne()|0,Q=yt(Q|0,Z|0,1,0)|0,Z=ne()|0,S=y+(N<<3)|0,G=S,C=A[G>>2]|0,G=A[G+4>>2]|0,(C|0)==0&(G|0)==0){pe=S,ut=16;break}}while(!1);if((ut|0)==16&&(ut=0,!((ee|0)==0&(he|0)==0))&&(Q=pe,A[Q>>2]=ee,A[Q+4>>2]=he,Q=f+(A[c>>2]<<3)|0,A[Q>>2]=ee,A[Q+4>>2]=he,Q=c,Q=yt(A[Q>>2]|0,A[Q+4>>2]|0,1,0)|0,ee=ne()|0,he=c,A[he>>2]=Q,A[he+4>>2]=ee),ge=yt(ge|0,oe|0,1,0)|0,oe=ne()|0,C=ft,S=A[C>>2]|0,C=A[C+4>>2]|0,!((C|0)>(oe|0)|(C|0)==(oe|0)&S>>>0>ge>>>0)){C=1;break e}}C=0}else C=1;while(!1);if(fe=fe+1|0,!C){ut=21;break}if(S=A[i>>2]|0,(fe|0)>=(S|0)){x=0,ut=21;break}}return(ut|0)==21?(J=Rt,x|0):0}function ma(i,n,s,l){i=i|0,n=n|0,s=s|0,l=l|0;var c=0,f=0,y=0,x=0,S=0,C=0,z=0,G=0,N=0,Z=0,Q=0,ee=0,he=0,ge=0,oe=0,fe=0,pe=0,Fe=0,Me=0,Pe=0,Ce=0,vt=0,at=0,rt=0,et=0,ft=0,ut=0,Rt=0,dt=0,Pt=0,di=0;if(di=J,J=J+112|0,ut=di+80|0,S=di+72|0,Rt=di,dt=di+56|0,s|0)return Pt=15,J=di,Pt|0;if(C=i+8|0,Pt=Bi((A[C>>2]<<5)+32|0)|0,!Pt)return Pt=13,J=di,Pt|0;if(bl(i,Pt),et=i,ft=A[et+4>>2]|0,s=S,A[s>>2]=A[et>>2],A[s+4>>2]=ft,Ra(S,ut),s=co(ut,n,Rt)|0,s)et=0,ft=0;else{if(s=A[S>>2]|0,f=A[C>>2]|0,(f|0)>0){y=A[i+12>>2]|0,c=0;do s=(A[y+(c<<3)>>2]|0)+s|0,c=c+1|0;while((c|0)!=(f|0));c=s}else c=s;s=Rt,f=A[s>>2]|0,s=A[s+4>>2]|0,y=((c|0)<0)<<31>>31,(s|0)<(y|0)|(s|0)==(y|0)&f>>>0<c>>>0?(s=Rt,A[s>>2]=c,A[s+4>>2]=y,s=y):c=f,et=yt(c|0,s|0,12,0)|0,ft=ne()|0,s=Rt,A[s>>2]=et,A[s+4>>2]=ft,s=0}if(s|0)return Ct(Pt),Pt=s,J=di,Pt|0;if(c=ar(et,8)|0,!c)return Ct(Pt),Pt=13,J=di,Pt|0;if(x=ar(et,8)|0,!x)return Ct(Pt),Ct(c),Pt=13,J=di,Pt|0;at=ut,A[at>>2]=0,A[at+4>>2]=0,at=i,rt=A[at+4>>2]|0,s=S,A[s>>2]=A[at>>2],A[s+4>>2]=rt,s=Qo(S,et,ft,n,ut,c,x)|0;e:do if(s)Ct(c),Ct(x),Ct(Pt);else{t:do if((A[C>>2]|0)>0){for(y=i+12|0,f=0;s=Qo((A[y>>2]|0)+(f<<3)|0,et,ft,n,ut,c,x)|0,f=f+1|0,!(s|0);)if((f|0)>=(A[C>>2]|0))break t;Ct(c),Ct(x),Ct(Pt);break e}while(!1);(ft|0)>0|(ft|0)==0&et>>>0>0&&g(x|0,0,et<<3|0)|0,rt=ut,at=A[rt+4>>2]|0;t:do if((at|0)>0|(at|0)==0&(A[rt>>2]|0)>>>0>0){Pe=c,Ce=x,vt=c,at=x,rt=c,s=c,pe=c,Fe=x,Me=x,c=x;i:for(;;){for(he=0,ge=0,oe=0,fe=0,f=0,y=0;;){x=Rt,S=x+56|0;do A[x>>2]=0,x=x+4|0;while((x|0)<(S|0));if(n=Pe+(he<<3)|0,C=A[n>>2]|0,n=A[n+4>>2]|0,lo(C,n,1,Rt,0)|0){x=Rt,S=x+56|0;do A[x>>2]=0,x=x+4|0;while((x|0)<(S|0));x=ar(7,4)|0,x|0&&(sr(C,n,1,Rt,x,7,0,0)|0,Ct(x))}for(ee=0;;){Q=Rt+(ee<<3)|0,Z=A[Q>>2]|0,Q=A[Q+4>>2]|0;r:do if((Z|0)==0&(Q|0)==0)x=f,S=y;else{if(z=tn(Z|0,Q|0,et|0,ft|0)|0,C=ne()|0,x=l+(z<<3)|0,n=x,S=A[n>>2]|0,n=A[n+4>>2]|0,!((S|0)==0&(n|0)==0)){G=0,N=0;do{if((G|0)>(ft|0)|(G|0)==(ft|0)&N>>>0>et>>>0)break i;if((S|0)==(Z|0)&(n|0)==(Q|0)){x=f,S=y;break r}x=yt(z|0,C|0,1,0)|0,z=$s(x|0,ne()|0,et|0,ft|0)|0,C=ne()|0,N=yt(N|0,G|0,1,0)|0,G=ne()|0,x=l+(z<<3)|0,n=x,S=A[n>>2]|0,n=A[n+4>>2]|0}while(!((S|0)==0&(n|0)==0))}(Z|0)==0&(Q|0)==0?(x=f,S=y):(Kr(Z,Q,dt)|0,wl(i,Pt,dt)|0&&(N=yt(f|0,y|0,1,0)|0,y=ne()|0,G=x,A[G>>2]=Z,A[G+4>>2]=Q,f=Ce+(f<<3)|0,A[f>>2]=Z,A[f+4>>2]=Q,f=N),x=f,S=y)}while(!1);if(ee=ee+1|0,ee>>>0>=7)break;f=x,y=S}if(he=yt(he|0,ge|0,1,0)|0,ge=ne()|0,oe=yt(oe|0,fe|0,1,0)|0,fe=ne()|0,y=ut,f=A[y>>2]|0,y=A[y+4>>2]|0,(fe|0)<(y|0)|(fe|0)==(y|0)&oe>>>0<f>>>0)f=x,y=S;else break}if((y|0)>0|(y|0)==0&f>>>0>0){f=0,y=0;do fe=Pe+(f<<3)|0,A[fe>>2]=0,A[fe+4>>2]=0,f=yt(f|0,y|0,1,0)|0,y=ne()|0,fe=ut,oe=A[fe+4>>2]|0;while((y|0)<(oe|0)|((y|0)==(oe|0)?f>>>0<(A[fe>>2]|0)>>>0:0))}if(fe=ut,A[fe>>2]=x,A[fe+4>>2]=S,(S|0)>0|(S|0)==0&x>>>0>0)ee=c,he=Me,ge=rt,oe=Fe,fe=Ce,c=pe,Me=s,Fe=vt,pe=ee,s=he,rt=at,at=ge,vt=oe,Ce=Pe,Pe=fe;else break t}Ct(vt),Ct(at),Ct(Pt),s=1;break e}else s=x;while(!1);Ct(Pt),Ct(c),Ct(s),s=0}while(!1);return Pt=s,J=di,Pt|0}function sl(i,n,s){i=i|0,n=n|0,s=s|0;var l=0,c=0,f=0,y=0,x=0,S=0,C=0,z=0;if(z=J,J=J+176|0,S=z,(n|0)<1)return Tl(s,0,0),C=0,J=z,C|0;for(x=i,x=Ge(A[x>>2]|0,A[x+4>>2]|0,52)|0,ne()|0,Tl(s,(n|0)>6?n:6,x&15),x=0;l=i+(x<<3)|0,l=Zi(A[l>>2]|0,A[l+4>>2]|0,S)|0,!(l|0);){if(l=A[S>>2]|0,(l|0)>0){y=0;do f=S+8+(y<<4)|0,y=y+1|0,l=S+8+(((y|0)%(l|0)|0)<<4)|0,c=So(s,l,f)|0,c?ht(s,c)|0:wt(s,f,l)|0,l=A[S>>2]|0;while((y|0)<(l|0))}if(x=x+1|0,(x|0)>=(n|0)){l=0,C=13;break}}return(C|0)==13?(J=z,l|0):(or(s),C=l,J=z,C|0)}function Wl(i,n,s){i=i|0,n=n|0,s=s|0;var l=0,c=0,f=0,y=0;if(f=J,J=J+32|0,l=f,c=f+16|0,i=sl(i,n,c)|0,i|0)return s=i,J=f,s|0;if(A[s>>2]=0,A[s+4>>2]=0,A[s+8>>2]=0,i=Eo(c)|0,i|0)do{n=vl(s)|0;do na(n,i)|0,y=i+16|0,A[l>>2]=A[y>>2],A[l+4>>2]=A[y+4>>2],A[l+8>>2]=A[y+8>>2],A[l+12>>2]=A[y+12>>2],ht(c,i)|0,i=Ga(c,l)|0;while(i|0);i=Eo(c)|0}while(i|0);return or(c),i=Mn(s)|0,i?(us(s),y=i,J=f,y|0):(y=0,J=f,y|0)}function ci(i){return i=i|0,i>>>0>121?(i=0,i|0):(i=A[7696+(i*28|0)+16>>2]|0,i|0)}function $o(i){return i=i|0,(i|0)==4|(i|0)==117|0}function Ao(i){return i=i|0,A[11120+((A[i>>2]|0)*216|0)+((A[i+4>>2]|0)*72|0)+((A[i+8>>2]|0)*24|0)+(A[i+12>>2]<<3)>>2]|0}function ol(i){return i=i|0,A[11120+((A[i>>2]|0)*216|0)+((A[i+4>>2]|0)*72|0)+((A[i+8>>2]|0)*24|0)+(A[i+12>>2]<<3)+4>>2]|0}function al(i,n){i=i|0,n=n|0,i=7696+(i*28|0)|0,A[n>>2]=A[i>>2],A[n+4>>2]=A[i+4>>2],A[n+8>>2]=A[i+8>>2],A[n+12>>2]=A[i+12>>2]}function ga(i,n){i=i|0,n=n|0;var s=0,l=0;if(n>>>0>20)return n=-1,n|0;do if((A[11120+(n*216|0)>>2]|0)!=(i|0))if((A[11120+(n*216|0)+8>>2]|0)!=(i|0))if((A[11120+(n*216|0)+16>>2]|0)!=(i|0))if((A[11120+(n*216|0)+24>>2]|0)!=(i|0))if((A[11120+(n*216|0)+32>>2]|0)!=(i|0))if((A[11120+(n*216|0)+40>>2]|0)!=(i|0))if((A[11120+(n*216|0)+48>>2]|0)!=(i|0))if((A[11120+(n*216|0)+56>>2]|0)!=(i|0))if((A[11120+(n*216|0)+64>>2]|0)!=(i|0))if((A[11120+(n*216|0)+72>>2]|0)!=(i|0))if((A[11120+(n*216|0)+80>>2]|0)!=(i|0))if((A[11120+(n*216|0)+88>>2]|0)!=(i|0))if((A[11120+(n*216|0)+96>>2]|0)!=(i|0))if((A[11120+(n*216|0)+104>>2]|0)!=(i|0))if((A[11120+(n*216|0)+112>>2]|0)!=(i|0))if((A[11120+(n*216|0)+120>>2]|0)!=(i|0))if((A[11120+(n*216|0)+128>>2]|0)!=(i|0))if((A[11120+(n*216|0)+136>>2]|0)==(i|0))i=2,s=1,l=2;else{if((A[11120+(n*216|0)+144>>2]|0)==(i|0)){i=0,s=2,l=0;break}if((A[11120+(n*216|0)+152>>2]|0)==(i|0)){i=0,s=2,l=1;break}if((A[11120+(n*216|0)+160>>2]|0)==(i|0)){i=0,s=2,l=2;break}if((A[11120+(n*216|0)+168>>2]|0)==(i|0)){i=1,s=2,l=0;break}if((A[11120+(n*216|0)+176>>2]|0)==(i|0)){i=1,s=2,l=1;break}if((A[11120+(n*216|0)+184>>2]|0)==(i|0)){i=1,s=2,l=2;break}if((A[11120+(n*216|0)+192>>2]|0)==(i|0)){i=2,s=2,l=0;break}if((A[11120+(n*216|0)+200>>2]|0)==(i|0)){i=2,s=2,l=1;break}if((A[11120+(n*216|0)+208>>2]|0)==(i|0)){i=2,s=2,l=2;break}else i=-1;return i|0}else i=2,s=1,l=1;else i=2,s=1,l=0;else i=1,s=1,l=2;else i=1,s=1,l=1;else i=1,s=1,l=0;else i=0,s=1,l=2;else i=0,s=1,l=1;else i=0,s=1,l=0;else i=2,s=0,l=2;else i=2,s=0,l=1;else i=2,s=0,l=0;else i=1,s=0,l=2;else i=1,s=0,l=1;else i=1,s=0,l=0;else i=0,s=0,l=2;else i=0,s=0,l=1;else i=0,s=0,l=0;while(!1);return n=A[11120+(n*216|0)+(s*72|0)+(i*24|0)+(l<<3)+4>>2]|0,n|0}function Ho(i,n){return i=i|0,n=n|0,(A[7696+(i*28|0)+20>>2]|0)==(n|0)?(n=1,n|0):(n=(A[7696+(i*28|0)+24>>2]|0)==(n|0),n|0)}function bn(i,n){return i=i|0,n=n|0,A[848+(i*28|0)+(n<<2)>>2]|0}function Cs(i,n){return i=i|0,n=n|0,(A[848+(i*28|0)>>2]|0)==(n|0)?(n=0,n|0):(A[848+(i*28|0)+4>>2]|0)==(n|0)?(n=1,n|0):(A[848+(i*28|0)+8>>2]|0)==(n|0)?(n=2,n|0):(A[848+(i*28|0)+12>>2]|0)==(n|0)?(n=3,n|0):(A[848+(i*28|0)+16>>2]|0)==(n|0)?(n=4,n|0):(A[848+(i*28|0)+20>>2]|0)==(n|0)?(n=5,n|0):((A[848+(i*28|0)+24>>2]|0)==(n|0)?6:7)|0}function Or(){return 122}function Wo(i){i=i|0;var n=0,s=0,l=0;n=0;do Oe(n|0,0,45)|0,l=ne()|0|134225919,s=i+(n<<3)|0,A[s>>2]=-1,A[s+4>>2]=l,n=n+1|0;while((n|0)!=122);return 0}function uo(i){return i=i|0,+H[i+16>>3]<+H[i+24>>3]|0}function Ps(i,n){i=i|0,n=n|0;var s=0,l=0,c=0;return s=+H[n>>3],!(s>=+H[i+8>>3])||!(s<=+H[i>>3])?(n=0,n|0):(l=+H[i+16>>3],s=+H[i+24>>3],c=+H[n+8>>3],n=c>=s,i=c<=l&1,l<s?n&&(i=1):n||(i=0),n=(i|0)!=0,n|0)}function co(i,n,s){i=i|0,n=n|0,s=s|0;var l=0,c=0,f=0,y=0,x=0,S=0,C=0,z=0,G=0,N=0,Z=0,Q=0,ee=0,he=0;Q=J,J=J+288|0,z=Q+264|0,G=Q+96|0,C=Q,x=C,S=x+96|0;do A[x>>2]=0,x=x+4|0;while((x|0)<(S|0));return n=En(n,C)|0,n|0?(Z=n,J=Q,Z|0):(S=C,C=A[S>>2]|0,S=A[S+4>>2]|0,Kr(C,S,z)|0,Zi(C,S,G)|0,y=+gr(z,G+8|0),H[z>>3]=+H[i>>3],S=z+8|0,H[S>>3]=+H[i+16>>3],H[G>>3]=+H[i+8>>3],C=G+8|0,H[C>>3]=+H[i+24>>3],c=+gr(z,G),he=+H[S>>3]-+H[C>>3],f=+ot(+he),ee=+H[z>>3]-+H[G>>3],l=+ot(+ee),!(he==0|ee==0)&&(he=+v(+f,+l),he=+Is(+(c*c/+t(+(he/+t(+f,+l)),3)/(y*(y*2.59807621135)*.8))),H[Ke>>3]=he,N=~~he>>>0,Z=+ot(he)>=1?he>0?~~+oo(+zt(he/4294967296),4294967295)>>>0:~~+Is((he-+(~~he>>>0))/4294967296)>>>0:0,(A[Ke+4>>2]&2146435072|0)!=2146435072)?(G=(N|0)==0&(Z|0)==0,n=s,A[n>>2]=G?1:N,A[n+4>>2]=G?0:Z,n=0):n=1,Z=n,J=Q,Z|0)}function Ds(i,n,s,l){i=i|0,n=n|0,s=s|0,l=l|0;var c=0,f=0,y=0,x=0,S=0,C=0,z=0;C=J,J=J+288|0,y=C+264|0,x=C+96|0,S=C,c=S,f=c+96|0;do A[c>>2]=0,c=c+4|0;while((c|0)<(f|0));return s=En(s,S)|0,s|0?(l=s,J=C,l|0):(s=S,c=A[s>>2]|0,s=A[s+4>>2]|0,Kr(c,s,y)|0,Zi(c,s,x)|0,z=+gr(y,x+8|0),z=+Is(+(+gr(i,n)/(z*2))),H[Ke>>3]=z,s=~~z>>>0,c=+ot(z)>=1?z>0?~~+oo(+zt(z/4294967296),4294967295)>>>0:~~+Is((z-+(~~z>>>0))/4294967296)>>>0:0,(A[Ke+4>>2]&2146435072|0)==2146435072?(l=1,J=C,l|0):(S=(s|0)==0&(c|0)==0,A[l>>2]=S?1:s,A[l+4>>2]=S?0:c,l=0,J=C,l|0))}function Nn(i,n,s,l){i=i|0,n=n|0,s=s|0,l=l|0,A[i>>2]=n,A[i+4>>2]=s,A[i+8>>2]=l}function Wt(i,n){i=i|0,n=n|0;var s=0,l=0,c=0,f=0,y=0,x=0,S=0,C=0,z=0,G=0,N=0;G=n+8|0,A[G>>2]=0,S=+H[i>>3],y=+ot(+S),C=+H[i+8>>3],x=+ot(+C)/.8660254037844386,y=y+x*.5,s=~~y,i=~~x,y=y-+(s|0),x=x-+(i|0);do if(y<.5)if(y<.3333333333333333)if(A[n>>2]=s,x<(y+1)*.5){A[n+4>>2]=i;break}else{i=i+1|0,A[n+4>>2]=i;break}else if(N=1-y,i=(!(x<N)&1)+i|0,A[n+4>>2]=i,N<=x&x<y*2){s=s+1|0,A[n>>2]=s;break}else{A[n>>2]=s;break}else{if(!(y<.6666666666666666))if(s=s+1|0,A[n>>2]=s,x<y*.5){A[n+4>>2]=i;break}else{i=i+1|0,A[n+4>>2]=i;break}if(x<1-y){if(A[n+4>>2]=i,y*2+-1<x){A[n>>2]=s;break}}else i=i+1|0,A[n+4>>2]=i;s=s+1|0,A[n>>2]=s}while(!1);do if(S<0)if(i&1){z=(i+1|0)/2|0,z=$t(s|0,((s|0)<0)<<31>>31|0,z|0,((z|0)<0)<<31>>31|0)|0,s=~~(+(s|0)-((+(z>>>0)+4294967296*+(ne()|0))*2+1)),A[n>>2]=s;break}else{z=(i|0)/2|0,z=$t(s|0,((s|0)<0)<<31>>31|0,z|0,((z|0)<0)<<31>>31|0)|0,s=~~(+(s|0)-(+(z>>>0)+4294967296*+(ne()|0))*2),A[n>>2]=s;break}while(!1);z=n+4|0,C<0&&(s=s-((i<<1|1|0)/2|0)|0,A[n>>2]=s,i=0-i|0,A[z>>2]=i),l=i-s|0,(s|0)<0?(c=0-s|0,A[z>>2]=l,A[G>>2]=c,A[n>>2]=0,i=l,s=0):c=0,(i|0)<0&&(s=s-i|0,A[n>>2]=s,c=c-i|0,A[G>>2]=c,A[z>>2]=0,i=0),f=s-c|0,l=i-c|0,(c|0)<0&&(A[n>>2]=f,A[z>>2]=l,A[G>>2]=0,i=l,s=f,c=0),l=(i|0)<(s|0)?i:s,l=(c|0)<(l|0)?c:l,!((l|0)<=0)&&(A[n>>2]=s-l,A[z>>2]=i-l,A[G>>2]=c-l)}function Vi(i){i=i|0;var n=0,s=0,l=0,c=0,f=0,y=0;n=A[i>>2]|0,y=i+4|0,s=A[y>>2]|0,(n|0)<0&&(s=s-n|0,A[y>>2]=s,f=i+8|0,A[f>>2]=(A[f>>2]|0)-n,A[i>>2]=0,n=0),(s|0)<0?(n=n-s|0,A[i>>2]=n,f=i+8|0,c=(A[f>>2]|0)-s|0,A[f>>2]=c,A[y>>2]=0,s=0):(c=i+8|0,f=c,c=A[c>>2]|0),(c|0)<0&&(n=n-c|0,A[i>>2]=n,s=s-c|0,A[y>>2]=s,A[f>>2]=0,c=0),l=(s|0)<(n|0)?s:n,l=(c|0)<(l|0)?c:l,!((l|0)<=0)&&(A[i>>2]=n-l,A[y>>2]=s-l,A[f>>2]=c-l)}function Ni(i,n){i=i|0,n=n|0;var s=0,l=0;l=A[i+8>>2]|0,s=+((A[i+4>>2]|0)-l|0),H[n>>3]=+((A[i>>2]|0)-l|0)-s*.5,H[n+8>>3]=s*.8660254037844386}function hi(i,n,s){i=i|0,n=n|0,s=s|0,A[s>>2]=(A[n>>2]|0)+(A[i>>2]|0),A[s+4>>2]=(A[n+4>>2]|0)+(A[i+4>>2]|0),A[s+8>>2]=(A[n+8>>2]|0)+(A[i+8>>2]|0)}function ho(i,n,s){i=i|0,n=n|0,s=s|0,A[s>>2]=(A[i>>2]|0)-(A[n>>2]|0),A[s+4>>2]=(A[i+4>>2]|0)-(A[n+4>>2]|0),A[s+8>>2]=(A[i+8>>2]|0)-(A[n+8>>2]|0)}function fo(i,n){i=i|0,n=n|0;var s=0,l=0;s=Zt(A[i>>2]|0,n)|0,A[i>>2]=s,s=i+4|0,l=Zt(A[s>>2]|0,n)|0,A[s>>2]=l,i=i+8|0,n=Zt(A[i>>2]|0,n)|0,A[i>>2]=n}function os(i){i=i|0;var n=0,s=0,l=0,c=0,f=0,y=0,x=0;y=A[i>>2]|0,x=(y|0)<0,l=(A[i+4>>2]|0)-(x?y:0)|0,f=(l|0)<0,c=(f?0-l|0:0)+((A[i+8>>2]|0)-(x?y:0))|0,s=(c|0)<0,i=s?0:c,n=(f?0:l)-(s?c:0)|0,c=(x?0:y)-(f?l:0)-(s?c:0)|0,s=(n|0)<(c|0)?n:c,s=(i|0)<(s|0)?i:s,l=(s|0)>0,i=i-(l?s:0)|0,n=n-(l?s:0)|0;e:do switch(c-(l?s:0)|0){case 0:switch(n|0){case 0:return x=i|0?(i|0)==1?1:7:0,x|0;case 1:return x=i|0?(i|0)==1?3:7:2,x|0;default:break e}case 1:switch(n|0){case 0:return x=i|0?(i|0)==1?5:7:4,x|0;case 1:{if(!i)i=6;else break e;return i|0}default:break e}}while(!1);return x=7,x|0}function _a(i){i=i|0;var n=0,s=0,l=0,c=0,f=0,y=0,x=0;y=i+8|0,c=A[y>>2]|0,f=(A[i>>2]|0)-c|0,x=i+4|0,c=(A[x>>2]|0)-c|0;do if(f>>>0>715827881|c>>>0>715827881){if(s=(f|0)>0,s){if((2147483647-f|0)<(f|0)||(2147483647-(f<<1)|0)<(f|0))return x=1,x|0}else if((-2147483648-f|0)>(f|0)||(-2147483648-(f<<1)|0)>(f|0))return x=1,x|0;if(n=f*3|0,(c|0)>0){if((2147483647-c|0)<(c|0))return x=1,x|0}else if((-2147483648-c|0)>(c|0))return x=1,x|0;if(l=c<<1,(f|0)>-1){if((n|-2147483648|0)>=(c|0))return x=1,x|0}else if((n^-2147483648|0)<(c|0))return x=1,x|0;if(s){if((2147483647-f|0)<(l|0))n=1;else{s=l;break}return n|0}else{if((-2147483648-f|0)>(l|0))n=1;else{s=l;break}return n|0}}else s=c<<1,n=f*3|0;while(!1);l=fn(+(n-c|0)/7)|0,A[i>>2]=l,c=fn(+(s+f|0)/7)|0,A[x>>2]=c,A[y>>2]=0,s=(c|0)<(l|0),n=s?l:c,s=s?c:l;do if((s|0)<0){if((n|0)>0){if((n|-2147483648|0)<(s|0)&((s|0)!=-2147483648&(2147483647-n|0)>=(s|0)))break;_t(23313,22444,355,22455)}if((s|0)==-2147483648|(-2147483648-n|0)>(s|0)&&_t(23313,22444,355,22455),(n|0)>-1){if((n|-2147483648|0)<(s|0))break;_t(23313,22444,355,22455)}else{if((n^-2147483648|0)>=(s|0))break;_t(23313,22444,355,22455)}}while(!1);return n=c-l|0,(l|0)<0?(s=0-l|0,A[x>>2]=n,A[y>>2]=s,A[i>>2]=0,l=0):(n=c,s=0),(n|0)<0&&(l=l-n|0,A[i>>2]=l,s=s-n|0,A[y>>2]=s,A[x>>2]=0,n=0),f=l-s|0,c=n-s|0,(s|0)<0?(A[i>>2]=f,A[x>>2]=c,A[y>>2]=0,n=c,c=f,s=0):c=l,l=(n|0)<(c|0)?n:c,l=(s|0)<(l|0)?s:l,(l|0)<=0?(x=0,x|0):(A[i>>2]=c-l,A[x>>2]=n-l,A[y>>2]=s-l,x=0,x|0)}function ya(i){i=i|0;var n=0,s=0,l=0,c=0,f=0,y=0,x=0;y=i+8|0,c=A[y>>2]|0,f=(A[i>>2]|0)-c|0,x=i+4|0,c=(A[x>>2]|0)-c|0;do if(f>>>0>715827881|c>>>0>715827881){if(s=(f|0)>0,s){if((2147483647-f|0)<(f|0))return x=1,x|0}else if((-2147483648-f|0)>(f|0))return x=1,x|0;if(n=f<<1,(c|0)>0){if((2147483647-c|0)<(c|0)||(2147483647-(c<<1)|0)<(c|0))return x=1,x|0}else if((-2147483648-c|0)>(c|0)||(-2147483648-(c<<1)|0)>(c|0))return x=1,x|0;if(l=c*3|0,s){if((2147483647-n|0)<(c|0))return x=1,x|0}else if((-2147483648-n|0)>(c|0))return x=1,x|0;if((c|0)>-1){if((l|-2147483648|0)<(f|0)){s=l;break}else n=1;return n|0}else{if((l^-2147483648|0)<(f|0))n=1;else{s=l;break}return n|0}}else s=c*3|0,n=f<<1;while(!1);l=fn(+(n+c|0)/7)|0,A[i>>2]=l,c=fn(+(s-f|0)/7)|0,A[x>>2]=c,A[y>>2]=0,s=(c|0)<(l|0),n=s?l:c,s=s?c:l;do if((s|0)<0){if((n|0)>0){if((n|-2147483648|0)<(s|0)&((s|0)!=-2147483648&(2147483647-n|0)>=(s|0)))break;_t(23313,22444,404,22469)}if((s|0)==-2147483648|(-2147483648-n|0)>(s|0)&&_t(23313,22444,404,22469),(n|0)>-1){if((n|-2147483648|0)<(s|0))break;_t(23313,22444,404,22469)}else{if((n^-2147483648|0)>=(s|0))break;_t(23313,22444,404,22469)}}while(!1);return n=c-l|0,(l|0)<0?(s=0-l|0,A[x>>2]=n,A[y>>2]=s,A[i>>2]=0,l=0):(n=c,s=0),(n|0)<0&&(l=l-n|0,A[i>>2]=l,s=s-n|0,A[y>>2]=s,A[x>>2]=0,n=0),f=l-s|0,c=n-s|0,(s|0)<0?(A[i>>2]=f,A[x>>2]=c,A[y>>2]=0,n=c,c=f,s=0):c=l,l=(n|0)<(c|0)?n:c,l=(s|0)<(l|0)?s:l,(l|0)<=0?(x=0,x|0):(A[i>>2]=c-l,A[x>>2]=n-l,A[y>>2]=s-l,x=0,x|0)}function Xo(i){i=i|0;var n=0,s=0,l=0,c=0,f=0,y=0,x=0;y=i+8|0,s=A[y>>2]|0,n=(A[i>>2]|0)-s|0,x=i+4|0,s=(A[x>>2]|0)-s|0,l=fn(+((n*3|0)-s|0)/7)|0,A[i>>2]=l,n=fn(+((s<<1)+n|0)/7)|0,A[x>>2]=n,A[y>>2]=0,s=n-l|0,(l|0)<0?(f=0-l|0,A[x>>2]=s,A[y>>2]=f,A[i>>2]=0,n=s,l=0,s=f):s=0,(n|0)<0&&(l=l-n|0,A[i>>2]=l,s=s-n|0,A[y>>2]=s,A[x>>2]=0,n=0),f=l-s|0,c=n-s|0,(s|0)<0?(A[i>>2]=f,A[x>>2]=c,A[y>>2]=0,n=c,c=f,s=0):c=l,l=(n|0)<(c|0)?n:c,l=(s|0)<(l|0)?s:l,!((l|0)<=0)&&(A[i>>2]=c-l,A[x>>2]=n-l,A[y>>2]=s-l)}function Yo(i){i=i|0;var n=0,s=0,l=0,c=0,f=0,y=0,x=0;y=i+8|0,s=A[y>>2]|0,n=(A[i>>2]|0)-s|0,x=i+4|0,s=(A[x>>2]|0)-s|0,l=fn(+((n<<1)+s|0)/7)|0,A[i>>2]=l,n=fn(+((s*3|0)-n|0)/7)|0,A[x>>2]=n,A[y>>2]=0,s=n-l|0,(l|0)<0?(f=0-l|0,A[x>>2]=s,A[y>>2]=f,A[i>>2]=0,n=s,l=0,s=f):s=0,(n|0)<0&&(l=l-n|0,A[i>>2]=l,s=s-n|0,A[y>>2]=s,A[x>>2]=0,n=0),f=l-s|0,c=n-s|0,(s|0)<0?(A[i>>2]=f,A[x>>2]=c,A[y>>2]=0,n=c,c=f,s=0):c=l,l=(n|0)<(c|0)?n:c,l=(s|0)<(l|0)?s:l,!((l|0)<=0)&&(A[i>>2]=c-l,A[x>>2]=n-l,A[y>>2]=s-l)}function Bs(i){i=i|0;var n=0,s=0,l=0,c=0,f=0,y=0,x=0;n=A[i>>2]|0,y=i+4|0,s=A[y>>2]|0,x=i+8|0,l=A[x>>2]|0,c=s+(n*3|0)|0,A[i>>2]=c,s=l+(s*3|0)|0,A[y>>2]=s,n=(l*3|0)+n|0,A[x>>2]=n,l=s-c|0,(c|0)<0?(n=n-c|0,A[y>>2]=l,A[x>>2]=n,A[i>>2]=0,s=l,l=0):l=c,(s|0)<0&&(l=l-s|0,A[i>>2]=l,n=n-s|0,A[x>>2]=n,A[y>>2]=0,s=0),f=l-n|0,c=s-n|0,(n|0)<0?(A[i>>2]=f,A[y>>2]=c,A[x>>2]=0,l=f,n=0):c=s,s=(c|0)<(l|0)?c:l,s=(n|0)<(s|0)?n:s,!((s|0)<=0)&&(A[i>>2]=l-s,A[y>>2]=c-s,A[x>>2]=n-s)}function hn(i){i=i|0;var n=0,s=0,l=0,c=0,f=0,y=0,x=0;c=A[i>>2]|0,y=i+4|0,n=A[y>>2]|0,x=i+8|0,s=A[x>>2]|0,l=(n*3|0)+c|0,c=s+(c*3|0)|0,A[i>>2]=c,A[y>>2]=l,n=(s*3|0)+n|0,A[x>>2]=n,s=l-c|0,(c|0)<0?(n=n-c|0,A[y>>2]=s,A[x>>2]=n,A[i>>2]=0,c=0):s=l,(s|0)<0&&(c=c-s|0,A[i>>2]=c,n=n-s|0,A[x>>2]=n,A[y>>2]=0,s=0),f=c-n|0,l=s-n|0,(n|0)<0?(A[i>>2]=f,A[y>>2]=l,A[x>>2]=0,c=f,n=0):l=s,s=(l|0)<(c|0)?l:c,s=(n|0)<(s|0)?n:s,!((s|0)<=0)&&(A[i>>2]=c-s,A[y>>2]=l-s,A[x>>2]=n-s)}function va(i,n){i=i|0,n=n|0;var s=0,l=0,c=0,f=0,y=0,x=0;(n+-1|0)>>>0>=6||(c=(A[15440+(n*12|0)>>2]|0)+(A[i>>2]|0)|0,A[i>>2]=c,x=i+4|0,l=(A[15440+(n*12|0)+4>>2]|0)+(A[x>>2]|0)|0,A[x>>2]=l,y=i+8|0,n=(A[15440+(n*12|0)+8>>2]|0)+(A[y>>2]|0)|0,A[y>>2]=n,s=l-c|0,(c|0)<0?(n=n-c|0,A[x>>2]=s,A[y>>2]=n,A[i>>2]=0,l=0):(s=l,l=c),(s|0)<0&&(l=l-s|0,A[i>>2]=l,n=n-s|0,A[y>>2]=n,A[x>>2]=0,s=0),f=l-n|0,c=s-n|0,(n|0)<0?(A[i>>2]=f,A[x>>2]=c,A[y>>2]=0,l=f,n=0):c=s,s=(c|0)<(l|0)?c:l,s=(n|0)<(s|0)?n:s,!((s|0)<=0)&&(A[i>>2]=l-s,A[x>>2]=c-s,A[y>>2]=n-s))}function xa(i){i=i|0;var n=0,s=0,l=0,c=0,f=0,y=0,x=0;c=A[i>>2]|0,y=i+4|0,n=A[y>>2]|0,x=i+8|0,s=A[x>>2]|0,l=n+c|0,c=s+c|0,A[i>>2]=c,A[y>>2]=l,n=s+n|0,A[x>>2]=n,s=l-c|0,(c|0)<0?(n=n-c|0,A[y>>2]=s,A[x>>2]=n,A[i>>2]=0,l=0):(s=l,l=c),(s|0)<0&&(l=l-s|0,A[i>>2]=l,n=n-s|0,A[x>>2]=n,A[y>>2]=0,s=0),f=l-n|0,c=s-n|0,(n|0)<0?(A[i>>2]=f,A[y>>2]=c,A[x>>2]=0,l=f,n=0):c=s,s=(c|0)<(l|0)?c:l,s=(n|0)<(s|0)?n:s,!((s|0)<=0)&&(A[i>>2]=l-s,A[y>>2]=c-s,A[x>>2]=n-s)}function wn(i){i=i|0;var n=0,s=0,l=0,c=0,f=0,y=0,x=0;n=A[i>>2]|0,y=i+4|0,l=A[y>>2]|0,x=i+8|0,s=A[x>>2]|0,c=l+n|0,A[i>>2]=c,l=s+l|0,A[y>>2]=l,n=s+n|0,A[x>>2]=n,s=l-c|0,(c|0)<0?(n=n-c|0,A[y>>2]=s,A[x>>2]=n,A[i>>2]=0,l=0):(s=l,l=c),(s|0)<0&&(l=l-s|0,A[i>>2]=l,n=n-s|0,A[x>>2]=n,A[y>>2]=0,s=0),f=l-n|0,c=s-n|0,(n|0)<0?(A[i>>2]=f,A[y>>2]=c,A[x>>2]=0,l=f,n=0):c=s,s=(c|0)<(l|0)?c:l,s=(n|0)<(s|0)?n:s,!((s|0)<=0)&&(A[i>>2]=l-s,A[y>>2]=c-s,A[x>>2]=n-s)}function as(i){switch(i=i|0,i|0){case 1:{i=5;break}case 5:{i=4;break}case 4:{i=6;break}case 6:{i=2;break}case 2:{i=3;break}case 3:{i=1;break}}return i|0}function Un(i){switch(i=i|0,i|0){case 1:{i=3;break}case 3:{i=2;break}case 2:{i=6;break}case 6:{i=4;break}case 4:{i=5;break}case 5:{i=1;break}}return i|0}function ll(i){i=i|0;var n=0,s=0,l=0,c=0,f=0,y=0,x=0;n=A[i>>2]|0,y=i+4|0,s=A[y>>2]|0,x=i+8|0,l=A[x>>2]|0,c=s+(n<<1)|0,A[i>>2]=c,s=l+(s<<1)|0,A[y>>2]=s,n=(l<<1)+n|0,A[x>>2]=n,l=s-c|0,(c|0)<0?(n=n-c|0,A[y>>2]=l,A[x>>2]=n,A[i>>2]=0,s=l,l=0):l=c,(s|0)<0&&(l=l-s|0,A[i>>2]=l,n=n-s|0,A[x>>2]=n,A[y>>2]=0,s=0),f=l-n|0,c=s-n|0,(n|0)<0?(A[i>>2]=f,A[y>>2]=c,A[x>>2]=0,l=f,n=0):c=s,s=(c|0)<(l|0)?c:l,s=(n|0)<(s|0)?n:s,!((s|0)<=0)&&(A[i>>2]=l-s,A[y>>2]=c-s,A[x>>2]=n-s)}function Al(i){i=i|0;var n=0,s=0,l=0,c=0,f=0,y=0,x=0;c=A[i>>2]|0,y=i+4|0,n=A[y>>2]|0,x=i+8|0,s=A[x>>2]|0,l=(n<<1)+c|0,c=s+(c<<1)|0,A[i>>2]=c,A[y>>2]=l,n=(s<<1)+n|0,A[x>>2]=n,s=l-c|0,(c|0)<0?(n=n-c|0,A[y>>2]=s,A[x>>2]=n,A[i>>2]=0,c=0):s=l,(s|0)<0&&(c=c-s|0,A[i>>2]=c,n=n-s|0,A[x>>2]=n,A[y>>2]=0,s=0),f=c-n|0,l=s-n|0,(n|0)<0?(A[i>>2]=f,A[y>>2]=l,A[x>>2]=0,c=f,n=0):l=s,s=(l|0)<(c|0)?l:c,s=(n|0)<(s|0)?n:s,!((s|0)<=0)&&(A[i>>2]=c-s,A[y>>2]=l-s,A[x>>2]=n-s)}function ba(i,n){i=i|0,n=n|0;var s=0,l=0,c=0,f=0,y=0,x=0;return y=(A[i>>2]|0)-(A[n>>2]|0)|0,x=(y|0)<0,l=(A[i+4>>2]|0)-(A[n+4>>2]|0)-(x?y:0)|0,f=(l|0)<0,c=(x?0-y|0:0)+(A[i+8>>2]|0)-(A[n+8>>2]|0)+(f?0-l|0:0)|0,i=(c|0)<0,n=i?0:c,s=(f?0:l)-(i?c:0)|0,c=(x?0:y)-(f?l:0)-(i?c:0)|0,i=(s|0)<(c|0)?s:c,i=(n|0)<(i|0)?n:i,l=(i|0)>0,n=n-(l?i:0)|0,s=s-(l?i:0)|0,i=c-(l?i:0)|0,i=(i|0)>-1?i:0-i|0,s=(s|0)>-1?s:0-s|0,n=(n|0)>-1?n:0-n|0,n=(s|0)>(n|0)?s:n,((i|0)>(n|0)?i:n)|0}function Xl(i,n){i=i|0,n=n|0;var s=0;s=A[i+8>>2]|0,A[n>>2]=(A[i>>2]|0)-s,A[n+4>>2]=(A[i+4>>2]|0)-s}function wa(i,n){i=i|0,n=n|0;var s=0,l=0,c=0,f=0,y=0,x=0;l=A[i>>2]|0,A[n>>2]=l,c=A[i+4>>2]|0,y=n+4|0,A[y>>2]=c,x=n+8|0,A[x>>2]=0,s=(c|0)<(l|0),i=s?l:c,s=s?c:l;do if((s|0)<0){if((i|0)>0){if((i|-2147483648|0)<(s|0)&((s|0)!=-2147483648&(2147483647-i|0)>=(s|0)))break;return i=1,i|0}if((s|0)==-2147483648|(-2147483648-i|0)>(s|0))return n=1,n|0;if((i|0)>-1){if((i|-2147483648|0)<(s|0))break;return i=1,i|0}else{if((i^-2147483648|0)<(s|0))i=1;else break;return i|0}}while(!1);return i=c-l|0,(l|0)<0?(s=0-l|0,A[y>>2]=i,A[x>>2]=s,A[n>>2]=0,l=0):(i=c,s=0),(i|0)<0&&(l=l-i|0,A[n>>2]=l,s=s-i|0,A[x>>2]=s,A[y>>2]=0,i=0),f=l-s|0,c=i-s|0,(s|0)<0?(A[n>>2]=f,A[y>>2]=c,A[x>>2]=0,i=c,c=f,s=0):c=l,l=(i|0)<(c|0)?i:c,l=(s|0)<(l|0)?s:l,(l|0)<=0?(n=0,n|0):(A[n>>2]=c-l,A[y>>2]=i-l,A[x>>2]=s-l,n=0,n|0)}function po(i){i=i|0;var n=0,s=0,l=0,c=0;n=i+8|0,c=A[n>>2]|0,s=c-(A[i>>2]|0)|0,A[i>>2]=s,l=i+4|0,i=(A[l>>2]|0)-c|0,A[l>>2]=i,A[n>>2]=0-(i+s)}function ka(i){i=i|0;var n=0,s=0,l=0,c=0,f=0,y=0,x=0;s=A[i>>2]|0,n=0-s|0,A[i>>2]=n,y=i+8|0,A[y>>2]=0,x=i+4|0,l=A[x>>2]|0,c=l+s|0,(s|0)>0?(A[x>>2]=c,A[y>>2]=s,A[i>>2]=0,n=0,l=c):s=0,(l|0)<0?(f=n-l|0,A[i>>2]=f,s=s-l|0,A[y>>2]=s,A[x>>2]=0,c=f-s|0,n=0-s|0,(s|0)<0?(A[i>>2]=c,A[x>>2]=n,A[y>>2]=0,l=n,s=0):(l=0,c=f)):c=n,n=(l|0)<(c|0)?l:c,n=(s|0)<(n|0)?s:n,!((n|0)<=0)&&(A[i>>2]=c-n,A[x>>2]=l-n,A[y>>2]=s-n)}function Ea(i,n,s,l,c){i=i|0,n=n|0,s=s|0,l=l|0,c=c|0;var f=0,y=0,x=0,S=0,C=0,z=0,G=0;if(G=J,J=J+64|0,z=G,x=G+56|0,!(!0&(n&2013265920|0)==134217728&(!0&(l&2013265920|0)==134217728)))return c=5,J=G,c|0;if((i|0)==(s|0)&(n|0)==(l|0))return A[c>>2]=0,c=0,J=G,c|0;if(y=Ge(i|0,n|0,52)|0,ne()|0,y=y&15,C=Ge(s|0,l|0,52)|0,ne()|0,(y|0)!=(C&15|0))return c=12,J=G,c|0;if(f=y+-1|0,y>>>0>1){Os(i,n,f,z)|0,Os(s,l,f,x)|0,C=z,S=A[C>>2]|0,C=A[C+4>>2]|0;e:do if((S|0)==(A[x>>2]|0)&&(C|0)==(A[x+4>>2]|0)){y=(y^15)*3|0,f=Ge(i|0,n|0,y|0)|0,ne()|0,f=f&7,y=Ge(s|0,l|0,y|0)|0,ne()|0,y=y&7;do if((f|0)==0|(y|0)==0)A[c>>2]=1,f=0;else if((f|0)==7)f=5;else{if((f|0)==1|(y|0)==1&&ai(S,C)|0){f=5;break}if((A[15536+(f<<2)>>2]|0)!=(y|0)&&(A[15568+(f<<2)>>2]|0)!=(y|0))break e;A[c>>2]=1,f=0}while(!1);return c=f,J=G,c|0}while(!1)}f=z,y=f+56|0;do A[f>>2]=0,f=f+4|0;while((f|0)<(y|0));return Zo(i,n,1,z)|0,n=z,!((A[n>>2]|0)==(s|0)&&(A[n+4>>2]|0)==(l|0))&&(n=z+8|0,!((A[n>>2]|0)==(s|0)&&(A[n+4>>2]|0)==(l|0)))&&(n=z+16|0,!((A[n>>2]|0)==(s|0)&&(A[n+4>>2]|0)==(l|0)))&&(n=z+24|0,!((A[n>>2]|0)==(s|0)&&(A[n+4>>2]|0)==(l|0)))&&(n=z+32|0,!((A[n>>2]|0)==(s|0)&&(A[n+4>>2]|0)==(l|0)))&&(n=z+40|0,!((A[n>>2]|0)==(s|0)&&(A[n+4>>2]|0)==(l|0)))?(f=z+48|0,f=((A[f>>2]|0)==(s|0)?(A[f+4>>2]|0)==(l|0):0)&1):f=1,A[c>>2]=f,c=0,J=G,c|0}function zs(i,n,s,l,c){return i=i|0,n=n|0,s=s|0,l=l|0,c=c|0,s=ss(i,n,s,l)|0,(s|0)==7?(c=11,c|0):(l=Oe(s|0,0,56)|0,n=n&-2130706433|(ne()|0)|268435456,A[c>>2]=i|l,A[c+4>>2]=n,c=0,c|0)}function ul(i,n,s){return i=i|0,n=n|0,s=s|0,!0&(n&2013265920|0)==268435456?(A[s>>2]=i,A[s+4>>2]=n&-2130706433|134217728,s=0,s|0):(s=6,s|0)}function cl(i,n,s){i=i|0,n=n|0,s=s|0;var l=0,c=0,f=0;return c=J,J=J+16|0,l=c,A[l>>2]=0,!0&(n&2013265920|0)==268435456?(f=Ge(i|0,n|0,56)|0,ne()|0,l=zi(i,n&-2130706433|134217728,f&7,l,s)|0,J=c,l|0):(l=6,J=c,l|0)}function Sa(i,n){i=i|0,n=n|0;var s=0;switch(s=Ge(i|0,n|0,56)|0,ne()|0,s&7){case 0:case 7:return s=0,s|0}return s=n&-2130706433|134217728,!(!0&(n&2013265920|0)==268435456)||!0&(n&117440512|0)==16777216&(ai(i,s)|0)!=0?(s=0,s|0):(s=Fs(i,s)|0,s|0)}function ls(i,n,s){i=i|0,n=n|0,s=s|0;var l=0,c=0,f=0,y=0;return c=J,J=J+16|0,l=c,!0&(n&2013265920|0)==268435456?(f=n&-2130706433|134217728,y=s,A[y>>2]=i,A[y+4>>2]=f,A[l>>2]=0,n=Ge(i|0,n|0,56)|0,ne()|0,l=zi(i,f,n&7,l,s+8|0)|0,J=c,l|0):(l=6,J=c,l|0)}function hl(i,n,s){i=i|0,n=n|0,s=s|0;var l=0,c=0;return c=(ai(i,n)|0)==0,n=n&-2130706433,l=s,A[l>>2]=c?i:0,A[l+4>>2]=c?n|285212672:0,l=s+8|0,A[l>>2]=i,A[l+4>>2]=n|301989888,l=s+16|0,A[l>>2]=i,A[l+4>>2]=n|318767104,l=s+24|0,A[l>>2]=i,A[l+4>>2]=n|335544320,l=s+32|0,A[l>>2]=i,A[l+4>>2]=n|352321536,s=s+40|0,A[s>>2]=i,A[s+4>>2]=n|369098752,0}function Yr(i,n,s){i=i|0,n=n|0,s=s|0;var l=0,c=0,f=0,y=0;return y=J,J=J+16|0,c=y,f=n&-2130706433|134217728,!0&(n&2013265920|0)==268435456?(l=Ge(i|0,n|0,56)|0,ne()|0,l=yi(i,f,l&7)|0,(l|0)==-1?(A[s>>2]=0,f=6,J=y,f|0):(Ai(i,f,c)|0&&_t(23313,22484,282,22499),n=Ge(i|0,n|0,52)|0,ne()|0,n=n&15,ai(i,f)|0?Ia(c,n,l,2,s):fi(c,n,l,2,s),f=0,J=y,f|0)):(f=6,J=y,f|0)}function Ls(i,n,s){i=i|0,n=n|0,s=s|0;var l=0,c=0;l=J,J=J+16|0,c=l,fl(i,n,s,c),Wt(c,s+4|0),J=l}function fl(i,n,s,l){i=i|0,n=n|0,s=s|0,l=l|0;var c=0,f=0,y=0,x=0,S=0;if(x=J,J=J+16|0,S=x,Ta(i,s,S),f=+Ar(+(1-+H[S>>3]*.5)),f<1e-16){A[l>>2]=0,A[l+4>>2]=0,A[l+8>>2]=0,A[l+12>>2]=0,J=x;return}if(S=A[s>>2]|0,c=+H[15920+(S*24|0)>>3],c=+qs(c-+qs(+Er(15600+(S<<4)|0,i))),cr(n)|0?y=+qs(c+-.3334731722518321):y=c,c=+li(+f)/.381966011250105,(n|0)>0){i=0;do c=c*2.6457513110645907,i=i+1|0;while((i|0)!=(n|0))}f=+Et(+y)*c,H[l>>3]=f,y=+gt(+y)*c,H[l+8>>3]=y,J=x}function Ta(i,n,s){i=i|0,n=n|0,s=s|0;var l=0,c=0,f=0;if(f=J,J=J+32|0,c=f,Tr(i,c),A[n>>2]=0,H[s>>3]=5,l=+Pi(16400,c),l<+H[s>>3]&&(A[n>>2]=0,H[s>>3]=l),l=+Pi(16424,c),l<+H[s>>3]&&(A[n>>2]=1,H[s>>3]=l),l=+Pi(16448,c),l<+H[s>>3]&&(A[n>>2]=2,H[s>>3]=l),l=+Pi(16472,c),l<+H[s>>3]&&(A[n>>2]=3,H[s>>3]=l),l=+Pi(16496,c),l<+H[s>>3]&&(A[n>>2]=4,H[s>>3]=l),l=+Pi(16520,c),l<+H[s>>3]&&(A[n>>2]=5,H[s>>3]=l),l=+Pi(16544,c),l<+H[s>>3]&&(A[n>>2]=6,H[s>>3]=l),l=+Pi(16568,c),l<+H[s>>3]&&(A[n>>2]=7,H[s>>3]=l),l=+Pi(16592,c),l<+H[s>>3]&&(A[n>>2]=8,H[s>>3]=l),l=+Pi(16616,c),l<+H[s>>3]&&(A[n>>2]=9,H[s>>3]=l),l=+Pi(16640,c),l<+H[s>>3]&&(A[n>>2]=10,H[s>>3]=l),l=+Pi(16664,c),l<+H[s>>3]&&(A[n>>2]=11,H[s>>3]=l),l=+Pi(16688,c),l<+H[s>>3]&&(A[n>>2]=12,H[s>>3]=l),l=+Pi(16712,c),l<+H[s>>3]&&(A[n>>2]=13,H[s>>3]=l),l=+Pi(16736,c),l<+H[s>>3]&&(A[n>>2]=14,H[s>>3]=l),l=+Pi(16760,c),l<+H[s>>3]&&(A[n>>2]=15,H[s>>3]=l),l=+Pi(16784,c),l<+H[s>>3]&&(A[n>>2]=16,H[s>>3]=l),l=+Pi(16808,c),l<+H[s>>3]&&(A[n>>2]=17,H[s>>3]=l),l=+Pi(16832,c),l<+H[s>>3]&&(A[n>>2]=18,H[s>>3]=l),l=+Pi(16856,c),!(l<+H[s>>3])){J=f;return}A[n>>2]=19,H[s>>3]=l,J=f}function Xt(i,n,s,l,c){i=i|0,n=n|0,s=s|0,l=l|0,c=c|0;var f=0,y=0;if(f=+Ua(i),f<1e-16){n=15600+(n<<4)|0,A[c>>2]=A[n>>2],A[c+4>>2]=A[n+4>>2],A[c+8>>2]=A[n+8>>2],A[c+12>>2]=A[n+12>>2];return}if(y=+Yi(+ +H[i+8>>3],+ +H[i>>3]),(s|0)>0){i=0;do f=f/2.6457513110645907,i=i+1|0;while((i|0)!=(s|0))}l?(f=f/3,s=(cr(s)|0)==0,f=+On(+((s?f:f/2.6457513110645907)*.381966011250105))):(f=+On(+(f*.381966011250105)),cr(s)|0&&(y=+qs(y+.3334731722518321))),wo(15600+(n<<4)|0,+qs(+H[15920+(n*24|0)>>3]-y),f,c)}function bi(i,n,s){i=i|0,n=n|0,s=s|0;var l=0,c=0;l=J,J=J+16|0,c=l,Ni(i+4|0,c),Xt(c,A[i>>2]|0,n,0,s),J=l}function Ia(i,n,s,l,c){i=i|0,n=n|0,s=s|0,l=l|0,c=c|0;var f=0,y=0,x=0,S=0,C=0,z=0,G=0,N=0,Z=0,Q=0,ee=0,he=0,ge=0,oe=0,fe=0,pe=0,Fe=0,Me=0,Pe=0,Ce=0,vt=0,at=0,rt=0,et=0,ft=0,ut=0,Rt=0,dt=0;if(ut=J,J=J+272|0,f=ut+256|0,oe=ut+240|0,rt=ut,et=ut+224|0,ft=ut+208|0,fe=ut+176|0,pe=ut+160|0,Fe=ut+192|0,Me=ut+144|0,Pe=ut+128|0,Ce=ut+112|0,vt=ut+96|0,at=ut+80|0,A[f>>2]=n,A[oe>>2]=A[i>>2],A[oe+4>>2]=A[i+4>>2],A[oe+8>>2]=A[i+8>>2],A[oe+12>>2]=A[i+12>>2],Qt(oe,f,rt),A[c>>2]=0,oe=l+s+((l|0)==5&1)|0,(oe|0)<=(s|0)){J=ut;return}S=A[f>>2]|0,C=et+4|0,z=fe+4|0,G=s+5|0,N=16880+(S<<2)|0,Z=16960+(S<<2)|0,Q=Pe+8|0,ee=Ce+8|0,he=vt+8|0,ge=ft+4|0,x=s;e:for(;;){y=rt+(((x|0)%5|0)<<4)|0,A[ft>>2]=A[y>>2],A[ft+4>>2]=A[y+4>>2],A[ft+8>>2]=A[y+8>>2],A[ft+12>>2]=A[y+12>>2];do;while((Vr(ft,S,0,1)|0)==2);if((x|0)>(s|0)&(cr(n)|0)!=0){if(A[fe>>2]=A[ft>>2],A[fe+4>>2]=A[ft+4>>2],A[fe+8>>2]=A[ft+8>>2],A[fe+12>>2]=A[ft+12>>2],Ni(C,pe),l=A[fe>>2]|0,f=A[17040+(l*80|0)+(A[et>>2]<<2)>>2]|0,A[fe>>2]=A[18640+(l*80|0)+(f*20|0)>>2],y=A[18640+(l*80|0)+(f*20|0)+16>>2]|0,(y|0)>0){i=0;do xa(z),i=i+1|0;while((i|0)<(y|0))}switch(y=18640+(l*80|0)+(f*20|0)+4|0,A[Fe>>2]=A[y>>2],A[Fe+4>>2]=A[y+4>>2],A[Fe+8>>2]=A[y+8>>2],fo(Fe,(A[N>>2]|0)*3|0),hi(z,Fe,z),Vi(z),Ni(z,Me),Rt=+(A[Z>>2]|0),H[Pe>>3]=Rt*3,H[Q>>3]=0,dt=Rt*-1.5,H[Ce>>3]=dt,H[ee>>3]=Rt*2.598076211353316,H[vt>>3]=dt,H[he>>3]=Rt*-2.598076211353316,A[17040+((A[fe>>2]|0)*80|0)+(A[ft>>2]<<2)>>2]|0){case 1:{i=Ce,l=Pe;break}case 3:{i=vt,l=Ce;break}case 2:{i=Pe,l=vt;break}default:{i=12;break e}}Qs(pe,Me,l,i,at),Xt(at,A[fe>>2]|0,S,1,c+8+(A[c>>2]<<4)|0),A[c>>2]=(A[c>>2]|0)+1}if((x|0)<(G|0)&&(Ni(ge,fe),Xt(fe,A[ft>>2]|0,S,1,c+8+(A[c>>2]<<4)|0),A[c>>2]=(A[c>>2]|0)+1),A[et>>2]=A[ft>>2],A[et+4>>2]=A[ft+4>>2],A[et+8>>2]=A[ft+8>>2],A[et+12>>2]=A[ft+12>>2],x=x+1|0,(x|0)>=(oe|0)){i=3;break}}if((i|0)==3){J=ut;return}else(i|0)==12&&_t(22522,22569,571,22579)}function Qt(i,n,s){i=i|0,n=n|0,s=s|0;var l=0,c=0,f=0,y=0,x=0,S=0;S=J,J=J+128|0,l=S+64|0,c=S,f=l,y=20240,x=f+60|0;do A[f>>2]=A[y>>2],f=f+4|0,y=y+4|0;while((f|0)<(x|0));f=c,y=20304,x=f+60|0;do A[f>>2]=A[y>>2],f=f+4|0,y=y+4|0;while((f|0)<(x|0));x=(cr(A[n>>2]|0)|0)==0,l=x?l:c,c=i+4|0,ll(c),Al(c),cr(A[n>>2]|0)|0&&(hn(c),A[n>>2]=(A[n>>2]|0)+1),A[s>>2]=A[i>>2],n=s+4|0,hi(c,l,n),Vi(n),A[s+16>>2]=A[i>>2],n=s+20|0,hi(c,l+12|0,n),Vi(n),A[s+32>>2]=A[i>>2],n=s+36|0,hi(c,l+24|0,n),Vi(n),A[s+48>>2]=A[i>>2],n=s+52|0,hi(c,l+36|0,n),Vi(n),A[s+64>>2]=A[i>>2],s=s+68|0,hi(c,l+48|0,s),Vi(s),J=S}function Vr(i,n,s,l){i=i|0,n=n|0,s=s|0,l=l|0;var c=0,f=0,y=0,x=0,S=0,C=0,z=0,G=0,N=0,Z=0,Q=0;if(Q=J,J=J+32|0,N=Q+12|0,x=Q,Z=i+4|0,G=A[16960+(n<<2)>>2]|0,z=(l|0)!=0,G=z?G*3|0:G,c=A[Z>>2]|0,C=i+8|0,y=A[C>>2]|0,z){if(f=i+12|0,l=A[f>>2]|0,c=y+c+l|0,(c|0)==(G|0))return Z=1,J=Q,Z|0;S=f}else S=i+12|0,l=A[S>>2]|0,c=y+c+l|0;if((c|0)<=(G|0))return Z=0,J=Q,Z|0;do if((l|0)>0){if(l=A[i>>2]|0,(y|0)>0){f=18640+(l*80|0)+60|0,l=i;break}l=18640+(l*80|0)+40|0,s?(Nn(N,G,0,0),ho(Z,N,x),wn(x),hi(x,N,Z),f=l,l=i):(f=l,l=i)}else f=18640+((A[i>>2]|0)*80|0)+20|0,l=i;while(!1);if(A[l>>2]=A[f>>2],c=f+16|0,(A[c>>2]|0)>0){l=0;do xa(Z),l=l+1|0;while((l|0)<(A[c>>2]|0))}return i=f+4|0,A[N>>2]=A[i>>2],A[N+4>>2]=A[i+4>>2],A[N+8>>2]=A[i+8>>2],n=A[16880+(n<<2)>>2]|0,fo(N,z?n*3|0:n),hi(Z,N,Z),Vi(Z),z?l=((A[C>>2]|0)+(A[Z>>2]|0)+(A[S>>2]|0)|0)==(G|0)?1:2:l=2,Z=l,J=Q,Z|0}function wi(i,n){i=i|0,n=n|0;var s=0;do s=Vr(i,n,0,1)|0;while((s|0)==2);return s|0}function fi(i,n,s,l,c){i=i|0,n=n|0,s=s|0,l=l|0,c=c|0;var f=0,y=0,x=0,S=0,C=0,z=0,G=0,N=0,Z=0,Q=0,ee=0,he=0,ge=0,oe=0,fe=0,pe=0,Fe=0,Me=0,Pe=0,Ce=0,vt=0,at=0,rt=0;if(vt=J,J=J+240|0,f=vt+224|0,Fe=vt+208|0,Me=vt,Pe=vt+192|0,Ce=vt+176|0,he=vt+160|0,ge=vt+144|0,oe=vt+128|0,fe=vt+112|0,pe=vt+96|0,A[f>>2]=n,A[Fe>>2]=A[i>>2],A[Fe+4>>2]=A[i+4>>2],A[Fe+8>>2]=A[i+8>>2],A[Fe+12>>2]=A[i+12>>2],Rs(Fe,f,Me),A[c>>2]=0,ee=l+s+((l|0)==6&1)|0,(ee|0)<=(s|0)){J=vt;return}S=A[f>>2]|0,C=s+6|0,z=16960+(S<<2)|0,G=ge+8|0,N=oe+8|0,Z=fe+8|0,Q=Pe+4|0,y=0,x=s,l=-1;e:for(;;){if(f=(x|0)%6|0,i=Me+(f<<4)|0,A[Pe>>2]=A[i>>2],A[Pe+4>>2]=A[i+4>>2],A[Pe+8>>2]=A[i+8>>2],A[Pe+12>>2]=A[i+12>>2],i=y,y=Vr(Pe,S,0,1)|0,(x|0)>(s|0)&(cr(n)|0)!=0&&(i|0)!=1&&(A[Pe>>2]|0)!=(l|0)){switch(Ni(Me+(((f+5|0)%6|0)<<4)+4|0,Ce),Ni(Me+(f<<4)+4|0,he),at=+(A[z>>2]|0),H[ge>>3]=at*3,H[G>>3]=0,rt=at*-1.5,H[oe>>3]=rt,H[N>>3]=at*2.598076211353316,H[fe>>3]=rt,H[Z>>3]=at*-2.598076211353316,f=A[Fe>>2]|0,A[17040+(f*80|0)+(((l|0)==(f|0)?A[Pe>>2]|0:l)<<2)>>2]|0){case 1:{i=oe,l=ge;break}case 3:{i=fe,l=oe;break}case 2:{i=ge,l=fe;break}default:{i=8;break e}}Qs(Ce,he,l,i,pe),!(oa(Ce,pe)|0)&&!(oa(he,pe)|0)&&(Xt(pe,A[Fe>>2]|0,S,1,c+8+(A[c>>2]<<4)|0),A[c>>2]=(A[c>>2]|0)+1)}if((x|0)<(C|0)&&(Ni(Q,Ce),Xt(Ce,A[Pe>>2]|0,S,1,c+8+(A[c>>2]<<4)|0),A[c>>2]=(A[c>>2]|0)+1),x=x+1|0,(x|0)>=(ee|0)){i=3;break}else l=A[Pe>>2]|0}if((i|0)==3){J=vt;return}else(i|0)==8&&_t(22606,22569,736,22651)}function Rs(i,n,s){i=i|0,n=n|0,s=s|0;var l=0,c=0,f=0,y=0,x=0,S=0;S=J,J=J+160|0,l=S+80|0,c=S,f=l,y=20368,x=f+72|0;do A[f>>2]=A[y>>2],f=f+4|0,y=y+4|0;while((f|0)<(x|0));f=c,y=20448,x=f+72|0;do A[f>>2]=A[y>>2],f=f+4|0,y=y+4|0;while((f|0)<(x|0));x=(cr(A[n>>2]|0)|0)==0,l=x?l:c,c=i+4|0,ll(c),Al(c),cr(A[n>>2]|0)|0&&(hn(c),A[n>>2]=(A[n>>2]|0)+1),A[s>>2]=A[i>>2],n=s+4|0,hi(c,l,n),Vi(n),A[s+16>>2]=A[i>>2],n=s+20|0,hi(c,l+12|0,n),Vi(n),A[s+32>>2]=A[i>>2],n=s+36|0,hi(c,l+24|0,n),Vi(n),A[s+48>>2]=A[i>>2],n=s+52|0,hi(c,l+36|0,n),Vi(n),A[s+64>>2]=A[i>>2],n=s+68|0,hi(c,l+48|0,n),Vi(n),A[s+80>>2]=A[i>>2],s=s+84|0,hi(c,l+60|0,s),Vi(s),J=S}function dl(i,n){return i=i|0,n=n|0,n=Ge(i|0,n|0,52)|0,ne()|0,n&15|0}function Ko(i,n){return i=i|0,n=n|0,n=Ge(i|0,n|0,45)|0,ne()|0,n&127|0}function Fs(i,n){i=i|0,n=n|0;var s=0,l=0,c=0,f=0,y=0,x=0;if(!(!0&(n&-16777216|0)==134217728)||(y=Ge(i|0,n|0,45)|0,ne()|0,y=y&127,y>>>0>121))return n=0,n|0;s=Ge(i|0,n|0,52)|0,ne()|0,s=s&15;do if(s|0){for(c=1,l=0;;){if(f=Ge(i|0,n|0,(15-c|0)*3|0)|0,ne()|0,f=f&7,(f|0)!=0&(l^1))if((f|0)==1&(ci(y)|0)!=0){x=0,l=13;break}else l=1;if((f|0)==7){x=0,l=13;break}if(c>>>0<s>>>0)c=c+1|0;else{l=9;break}}if((l|0)==9){if((s|0)==15)x=1;else break;return x|0}else if((l|0)==13)return x|0}while(!1);for(;;){if(x=Ge(i|0,n|0,(14-s|0)*3|0)|0,ne()|0,!((x&7|0)==7&!0)){x=0,l=13;break}if(s>>>0<14)s=s+1|0;else{x=1,l=13;break}}return(l|0)==13?x|0:0}function Os(i,n,s,l){i=i|0,n=n|0,s=s|0,l=l|0;var c=0,f=0;if(f=Ge(i|0,n|0,52)|0,ne()|0,f=f&15,s>>>0>15)return l=4,l|0;if((f|0)<(s|0))return l=12,l|0;if((f|0)==(s|0))return A[l>>2]=i,A[l+4>>2]=n,l=0,l|0;if(c=Oe(s|0,0,52)|0,c=c|i,i=ne()|0|n&-15728641,(f|0)>(s|0))do n=Oe(7,0,(14-s|0)*3|0)|0,s=s+1|0,c=n|c,i=ne()|0|i;while((s|0)<(f|0));return A[l>>2]=c,A[l+4>>2]=i,l=0,l|0}function Vs(i,n,s,l){i=i|0,n=n|0,s=s|0,l=l|0;var c=0,f=0,y=0;if(f=Ge(i|0,n|0,52)|0,ne()|0,f=f&15,!((s|0)<16&(f|0)<=(s|0)))return l=4,l|0;c=s-f|0,s=Ge(i|0,n|0,45)|0,ne()|0;e:do if(!(ci(s&127)|0))s=Gn(7,0,c,((c|0)<0)<<31>>31)|0,c=ne()|0;else{t:do if(f|0){for(s=1;y=Oe(7,0,(15-s|0)*3|0)|0,!!((y&i|0)==0&((ne()|0)&n|0)==0);)if(s>>>0<f>>>0)s=s+1|0;else break t;s=Gn(7,0,c,((c|0)<0)<<31>>31)|0,c=ne()|0;break e}while(!1);s=Gn(7,0,c,((c|0)<0)<<31>>31)|0,s=Qi(s|0,ne()|0,5,0)|0,s=yt(s|0,ne()|0,-5,-1)|0,s=en(s|0,ne()|0,6,0)|0,s=yt(s|0,ne()|0,1,0)|0,c=ne()|0}while(!1);return y=l,A[y>>2]=s,A[y+4>>2]=c,y=0,y|0}function ai(i,n){i=i|0,n=n|0;var s=0,l=0,c=0;if(c=Ge(i|0,n|0,45)|0,ne()|0,!(ci(c&127)|0))return c=0,c|0;c=Ge(i|0,n|0,52)|0,ne()|0,c=c&15;e:do if(!c)s=0;else for(l=1;;){if(s=Ge(i|0,n|0,(15-l|0)*3|0)|0,ne()|0,s=s&7,s|0)break e;if(l>>>0<c>>>0)l=l+1|0;else{s=0;break}}while(!1);return c=(s|0)==0&1,c|0}function Ma(i,n,s,l){i=i|0,n=n|0,s=s|0,l=l|0;var c=0,f=0,y=0,x=0;if(y=J,J=J+16|0,f=y,Pa(f,i,n,s),n=f,i=A[n>>2]|0,n=A[n+4>>2]|0,(i|0)==0&(n|0)==0)return J=y,0;c=0,s=0;do x=l+(c<<3)|0,A[x>>2]=i,A[x+4>>2]=n,c=yt(c|0,s|0,1,0)|0,s=ne()|0,Da(f),x=f,i=A[x>>2]|0,n=A[x+4>>2]|0;while(!((i|0)==0&(n|0)==0));return J=y,0}function mo(i,n,s,l){return i=i|0,n=n|0,s=s|0,l=l|0,(l|0)<(s|0)?(s=n,l=i,St(s|0),l|0):(s=Oe(-1,-1,((l-s|0)*3|0)+3|0)|0,l=Oe(~s|0,~(ne()|0)|0,(15-l|0)*3|0)|0,s=~(ne()|0)&n,l=~l&i,St(s|0),l|0)}function go(i,n,s,l){i=i|0,n=n|0,s=s|0,l=l|0;var c=0;return c=Ge(i|0,n|0,52)|0,ne()|0,c=c&15,(s|0)<16&(c|0)<=(s|0)?((c|0)<(s|0)&&(c=Oe(-1,-1,((s+-1-c|0)*3|0)+3|0)|0,c=Oe(~c|0,~(ne()|0)|0,(15-s|0)*3|0)|0,n=~(ne()|0)&n,i=~c&i),c=Oe(s|0,0,52)|0,s=n&-15728641|(ne()|0),A[l>>2]=i|c,A[l+4>>2]=s,l=0,l|0):(l=4,l|0)}function _o(i,n,s,l){i=i|0,n=n|0,s=s|0,l=l|0;var c=0,f=0,y=0,x=0,S=0,C=0,z=0,G=0,N=0,Z=0,Q=0,ee=0,he=0,ge=0,oe=0,fe=0,pe=0,Fe=0,Me=0,Pe=0,Ce=0;if((s|0)==0&(l|0)==0)return Pe=0,Pe|0;if(c=i,f=A[c>>2]|0,c=A[c+4>>2]|0,!0&(c&15728640|0)==0){if(!((l|0)>0|(l|0)==0&s>>>0>0)||(Pe=n,A[Pe>>2]=f,A[Pe+4>>2]=c,(s|0)==1&(l|0)==0))return Pe=0,Pe|0;c=1;do Fe=i+(c<<3)|0,Me=A[Fe+4>>2]|0,Pe=n+(c<<3)|0,A[Pe>>2]=A[Fe>>2],A[Pe+4>>2]=Me,c=c+1|0;while(0<(l|0)|(l|0)==0&c>>>0<s>>>0);return c=0,c|0}if(pe=s<<3,Me=Bi(pe)|0,!Me)return Pe=13,Pe|0;if(d(Me|0,i|0,pe|0)|0,Fe=ar(s,8)|0,!Fe)return Ct(Me),Pe=13,Pe|0;e:do if(s|0){t:for(;;){c=Me,ge=A[c>>2]|0,c=A[c+4>>2]|0,oe=Ge(ge|0,c|0,52)|0,ne()|0,oe=oe&15,fe=oe+-1|0,he=(s|0)>0;i:do if((oe|0)!=0&he){if(Z=((s|0)<0)<<31>>31,Q=Oe(fe|0,0,52)|0,ee=ne()|0,fe>>>0>15){if(!((ge|0)==0&(c|0)==0)){Pe=17;break t}for(f=0;;){if(f=f+1|0,(f|0)>=(s|0))break i;if(l=Me+(f<<3)|0,ee=A[l>>2]|0,l=A[l+4>>2]|0,!((ee|0)==0&(l|0)==0)){c=l,Pe=17;break t}}}for(f=0,i=ge,l=c;;){if(!((i|0)==0&(l|0)==0)){if(!(!0&(l&117440512|0)==0)){Pe=22;break t}if(x=Ge(i|0,l|0,52)|0,ne()|0,x=x&15,(x|0)<(fe|0)){c=12,Pe=28;break t}if((x|0)!=(fe|0)&&(i=i|Q,l=l&-15728641|ee,x>>>0>=oe>>>0)){y=fe;do N=Oe(7,0,(14-y|0)*3|0)|0,y=y+1|0,i=N|i,l=ne()|0|l;while(y>>>0<x>>>0)}if(y=tn(i|0,l|0,s|0,Z|0)|0,ne()|0,C=Fe+(y<<3)|0,x=C,S=A[x>>2]|0,x=A[x+4>>2]|0,(S|0)==0&(x|0)==0)y=C;else for(N=0;;){if((N|0)>(s|0)){Pe=32;break t}if((S|0)==(i|0)&(x&-117440513|0)==(l|0)){z=Ge(S|0,x|0,56)|0,ne()|0,z=z&7,G=z+1|0,Ce=Ge(S|0,x|0,45)|0,ne()|0;r:do if(!(ci(Ce&127)|0))x=7;else{if(S=Ge(S|0,x|0,52)|0,ne()|0,S=S&15,!S){x=6;break}for(x=1;;){if(Ce=Oe(7,0,(15-x|0)*3|0)|0,!((Ce&i|0)==0&((ne()|0)&l|0)==0)){x=7;break r}if(x>>>0<S>>>0)x=x+1|0;else{x=6;break}}}while(!1);if((z+2|0)>>>0>x>>>0){Pe=42;break t}Ce=Oe(G|0,0,56)|0,l=ne()|0|l&-117440513,G=C,A[G>>2]=0,A[G+4>>2]=0,i=Ce|i}else y=(y+1|0)%(s|0)|0;if(C=Fe+(y<<3)|0,x=C,S=A[x>>2]|0,x=A[x+4>>2]|0,(S|0)==0&(x|0)==0){y=C;break}else N=N+1|0}Ce=y,A[Ce>>2]=i,A[Ce+4>>2]=l}if(f=f+1|0,(f|0)>=(s|0))break i;l=Me+(f<<3)|0,i=A[l>>2]|0,l=A[l+4>>2]|0}}while(!1);if((s+5|0)>>>0<11){Pe=85;break}if(ee=ar((s|0)/6|0,8)|0,!ee){Pe=49;break}i:do if(he){N=0,G=0;do{if(x=Fe+(N<<3)|0,l=x,f=A[l>>2]|0,l=A[l+4>>2]|0,!((f|0)==0&(l|0)==0)){S=Ge(f|0,l|0,56)|0,ne()|0,S=S&7,i=S+1|0,C=l&-117440513,Ce=Ge(f|0,l|0,45)|0,ne()|0;r:do if(ci(Ce&127)|0){if(z=Ge(f|0,l|0,52)|0,ne()|0,z=z&15,z|0)for(y=1;;){if(Ce=Oe(7,0,(15-y|0)*3|0)|0,!((f&Ce|0)==0&(C&(ne()|0)|0)==0))break r;if(y>>>0<z>>>0)y=y+1|0;else break}l=Oe(i|0,0,56)|0,f=l|f,l=ne()|0|C,i=x,A[i>>2]=f,A[i+4>>2]=l,i=S+2|0}while(!1);(i|0)==7&&(Ce=ee+(G<<3)|0,A[Ce>>2]=f,A[Ce+4>>2]=l&-117440513,G=G+1|0)}N=N+1|0}while((N|0)!=(s|0));if(he){if(N=((s|0)<0)<<31>>31,Z=Oe(fe|0,0,52)|0,Q=ne()|0,fe>>>0>15){if(!((ge|0)==0&(c|0)==0)){c=4,Pe=84;break t}for(c=0;;){if(c=c+1|0,(c|0)>=(s|0)){f=0,c=G;break i}if(Ce=Me+(c<<3)|0,!((A[Ce>>2]|0)==0&(A[Ce+4>>2]|0)==0)){c=4,Pe=84;break t}}}for(z=0,f=0,C=ge;;){do if(!((C|0)==0&(c|0)==0)){if(x=Ge(C|0,c|0,52)|0,ne()|0,x=x&15,(x|0)<(fe|0)){c=12,Pe=84;break t}do if((x|0)==(fe|0))l=C,x=c;else{if(l=C|Z,i=c&-15728641|Q,x>>>0<oe>>>0){x=i;break}y=fe;do Ce=Oe(7,0,(14-y|0)*3|0)|0,y=y+1|0,l=Ce|l,i=ne()|0|i;while(y>>>0<x>>>0);x=i}while(!1);for(y=tn(l|0,x|0,s|0,N|0)|0,ne()|0,i=0;;){if((i|0)>(s|0)){Pe=77;break t}if(Ce=Fe+(y<<3)|0,S=A[Ce+4>>2]|0,(S&-117440513|0)==(x|0)&&(A[Ce>>2]|0)==(l|0)){Pe=79;break}if(y=(y+1|0)%(s|0)|0,Ce=Fe+(y<<3)|0,(A[Ce>>2]|0)==(l|0)&&(A[Ce+4>>2]|0)==(x|0))break;i=i+1|0}if((Pe|0)==79&&(Pe=0,!0&(S&117440512|0)==100663296))break;Ce=n+(f<<3)|0,A[Ce>>2]=C,A[Ce+4>>2]=c,f=f+1|0}while(!1);if(c=z+1|0,(c|0)>=(s|0)){c=G;break i}Ce=Me+(c<<3)|0,z=c,C=A[Ce>>2]|0,c=A[Ce+4>>2]|0}}else f=0,c=G}else f=0,c=0;while(!1);if(g(Fe|0,0,pe|0)|0,d(Me|0,ee|0,c<<3|0)|0,Ct(ee),c)n=n+(f<<3)|0,s=c;else break e}if((Pe|0)==17)!0&(c&117440512|0)==0?(c=4,Pe=28):Pe=22;else if((Pe|0)==32)_t(23313,22674,362,22684);else{if((Pe|0)==42)return Ct(Me),Ct(Fe),Ce=10,Ce|0;if((Pe|0)==49)return Ct(Me),Ct(Fe),Ce=13,Ce|0;if((Pe|0)==77)_t(23313,22674,462,22684);else{if((Pe|0)==84)return Ct(ee),Ct(Me),Ct(Fe),Ce=c,Ce|0;if((Pe|0)==85){d(n|0,Me|0,s<<3|0)|0;break}}}if((Pe|0)==22)return Ct(Me),Ct(Fe),Ce=5,Ce|0;if((Pe|0)==28)return Ct(Me),Ct(Fe),Ce=c,Ce|0}while(!1);return Ct(Me),Ct(Fe),Ce=0,Ce|0}function Yl(i,n,s,l,c,f,y){i=i|0,n=n|0,s=s|0,l=l|0,c=c|0,f=f|0,y=y|0;var x=0,S=0,C=0,z=0,G=0,N=0,Z=0,Q=0,ee=0;if(ee=J,J=J+16|0,Q=ee,!((s|0)>0|(s|0)==0&n>>>0>0))return Q=0,J=ee,Q|0;if((y|0)>=16)return Q=12,J=ee,Q|0;N=0,Z=0,G=0,x=0;e:for(;;){if(C=i+(N<<3)|0,S=A[C>>2]|0,C=A[C+4>>2]|0,z=Ge(S|0,C|0,52)|0,ne()|0,(z&15|0)>(y|0)){x=12,S=11;break}if(Pa(Q,S,C,y),z=Q,C=A[z>>2]|0,z=A[z+4>>2]|0,(C|0)==0&(z|0)==0)S=G;else{S=G;do{if(!((x|0)<(f|0)|(x|0)==(f|0)&S>>>0<c>>>0)){S=10;break e}G=l+(S<<3)|0,A[G>>2]=C,A[G+4>>2]=z,S=yt(S|0,x|0,1,0)|0,x=ne()|0,Da(Q),G=Q,C=A[G>>2]|0,z=A[G+4>>2]|0}while(!((C|0)==0&(z|0)==0))}if(N=yt(N|0,Z|0,1,0)|0,Z=ne()|0,(Z|0)<(s|0)|(Z|0)==(s|0)&N>>>0<n>>>0)G=S;else{x=0,S=11;break}}return(S|0)==10?(Q=14,J=ee,Q|0):(S|0)==11?(J=ee,x|0):0}function Ca(i,n,s,l,c){i=i|0,n=n|0,s=s|0,l=l|0,c=c|0;var f=0,y=0,x=0,S=0,C=0,z=0,G=0,N=0;N=J,J=J+16|0,G=N;e:do if((s|0)>0|(s|0)==0&n>>>0>0){for(C=0,y=0,f=0,z=0;;){if(S=i+(C<<3)|0,x=A[S>>2]|0,S=A[S+4>>2]|0,!((x|0)==0&(S|0)==0)&&(S=(Vs(x,S,l,G)|0)==0,x=G,y=yt(A[x>>2]|0,A[x+4>>2]|0,y|0,f|0)|0,f=ne()|0,!S)){f=12;break}if(C=yt(C|0,z|0,1,0)|0,z=ne()|0,!((z|0)<(s|0)|(z|0)==(s|0)&C>>>0<n>>>0))break e}return J=N,f|0}else y=0,f=0;while(!1);return A[c>>2]=y,A[c+4>>2]=f,c=0,J=N,c|0}function Kl(i,n){return i=i|0,n=n|0,n=Ge(i|0,n|0,52)|0,ne()|0,n&1|0}function ur(i,n){i=i|0,n=n|0;var s=0,l=0,c=0;if(c=Ge(i|0,n|0,52)|0,ne()|0,c=c&15,!c)return c=0,c|0;for(l=1;;){if(s=Ge(i|0,n|0,(15-l|0)*3|0)|0,ne()|0,s=s&7,s|0){l=5;break}if(l>>>0<c>>>0)l=l+1|0;else{s=0,l=5;break}}return(l|0)==5?s|0:0}function Ns(i,n){i=i|0,n=n|0;var s=0,l=0,c=0,f=0,y=0,x=0,S=0;if(S=Ge(i|0,n|0,52)|0,ne()|0,S=S&15,!S)return x=n,S=i,St(x|0),S|0;for(x=1,s=0;;){f=(15-x|0)*3|0,l=Oe(7,0,f|0)|0,c=ne()|0,y=Ge(i|0,n|0,f|0)|0,ne()|0,f=Oe(as(y&7)|0,0,f|0)|0,y=ne()|0,i=f|i&~l,n=y|n&~c;e:do if(!s)if((f&l|0)==0&(y&c|0)==0)s=0;else if(l=Ge(i|0,n|0,52)|0,ne()|0,l=l&15,!l)s=1;else{s=1;t:for(;;){switch(y=Ge(i|0,n|0,(15-s|0)*3|0)|0,ne()|0,y&7){case 1:break t;case 0:break;default:{s=1;break e}}if(s>>>0<l>>>0)s=s+1|0;else{s=1;break e}}for(s=1;;)if(y=(15-s|0)*3|0,c=Ge(i|0,n|0,y|0)|0,ne()|0,f=Oe(7,0,y|0)|0,n=n&~(ne()|0),y=Oe(as(c&7)|0,0,y|0)|0,i=i&~f|y,n=n|(ne()|0),s>>>0<l>>>0)s=s+1|0;else{s=1;break}}while(!1);if(x>>>0<S>>>0)x=x+1|0;else break}return St(n|0),i|0}function kn(i,n){i=i|0,n=n|0;var s=0,l=0,c=0,f=0,y=0;if(l=Ge(i|0,n|0,52)|0,ne()|0,l=l&15,!l)return s=n,l=i,St(s|0),l|0;for(s=1;f=(15-s|0)*3|0,y=Ge(i|0,n|0,f|0)|0,ne()|0,c=Oe(7,0,f|0)|0,n=n&~(ne()|0),f=Oe(as(y&7)|0,0,f|0)|0,i=f|i&~c,n=ne()|0|n,s>>>0<l>>>0;)s=s+1|0;return St(n|0),i|0}function pl(i,n){i=i|0,n=n|0;var s=0,l=0,c=0,f=0,y=0,x=0,S=0;if(S=Ge(i|0,n|0,52)|0,ne()|0,S=S&15,!S)return x=n,S=i,St(x|0),S|0;for(x=1,s=0;;){f=(15-x|0)*3|0,l=Oe(7,0,f|0)|0,c=ne()|0,y=Ge(i|0,n|0,f|0)|0,ne()|0,f=Oe(Un(y&7)|0,0,f|0)|0,y=ne()|0,i=f|i&~l,n=y|n&~c;e:do if(!s)if((f&l|0)==0&(y&c|0)==0)s=0;else if(l=Ge(i|0,n|0,52)|0,ne()|0,l=l&15,!l)s=1;else{s=1;t:for(;;){switch(y=Ge(i|0,n|0,(15-s|0)*3|0)|0,ne()|0,y&7){case 1:break t;case 0:break;default:{s=1;break e}}if(s>>>0<l>>>0)s=s+1|0;else{s=1;break e}}for(s=1;;)if(c=(15-s|0)*3|0,f=Oe(7,0,c|0)|0,y=n&~(ne()|0),n=Ge(i|0,n|0,c|0)|0,ne()|0,n=Oe(Un(n&7)|0,0,c|0)|0,i=i&~f|n,n=y|(ne()|0),s>>>0<l>>>0)s=s+1|0;else{s=1;break}}while(!1);if(x>>>0<S>>>0)x=x+1|0;else break}return St(n|0),i|0}function Jo(i,n){i=i|0,n=n|0;var s=0,l=0,c=0,f=0,y=0;if(l=Ge(i|0,n|0,52)|0,ne()|0,l=l&15,!l)return s=n,l=i,St(s|0),l|0;for(s=1;y=(15-s|0)*3|0,f=Oe(7,0,y|0)|0,c=n&~(ne()|0),n=Ge(i|0,n|0,y|0)|0,ne()|0,n=Oe(Un(n&7)|0,0,y|0)|0,i=n|i&~f,n=ne()|0|c,s>>>0<l>>>0;)s=s+1|0;return St(n|0),i|0}function yo(i,n){i=i|0,n=n|0;var s=0,l=0,c=0,f=0,y=0,x=0,S=0,C=0,z=0;if(S=J,J=J+64|0,x=S+40|0,l=S+24|0,c=S+12|0,f=S,Oe(n|0,0,52)|0,s=ne()|0|134225919,!n)return(A[i+4>>2]|0)>2||(A[i+8>>2]|0)>2||(A[i+12>>2]|0)>2?(y=0,x=0,St(y|0),J=S,x|0):(Oe(Ao(i)|0,0,45)|0,y=ne()|0|s,x=-1,St(y|0),J=S,x|0);if(A[x>>2]=A[i>>2],A[x+4>>2]=A[i+4>>2],A[x+8>>2]=A[i+8>>2],A[x+12>>2]=A[i+12>>2],y=x+4|0,(n|0)>0)for(i=-1;A[l>>2]=A[y>>2],A[l+4>>2]=A[y+4>>2],A[l+8>>2]=A[y+8>>2],n&1?(Xo(y),A[c>>2]=A[y>>2],A[c+4>>2]=A[y+4>>2],A[c+8>>2]=A[y+8>>2],Bs(c)):(Yo(y),A[c>>2]=A[y>>2],A[c+4>>2]=A[y+4>>2],A[c+8>>2]=A[y+8>>2],hn(c)),ho(l,c,f),Vi(f),z=(15-n|0)*3|0,C=Oe(7,0,z|0)|0,s=s&~(ne()|0),z=Oe(os(f)|0,0,z|0)|0,i=z|i&~C,s=ne()|0|s,(n|0)>1;)n=n+-1|0;else i=-1;e:do if((A[y>>2]|0)<=2&&(A[x+8>>2]|0)<=2&&(A[x+12>>2]|0)<=2){if(l=Ao(x)|0,n=Oe(l|0,0,45)|0,n=n|i,i=ne()|0|s&-1040385,f=ol(x)|0,!(ci(l)|0)){if((f|0)<=0)break;for(c=0;;){if(l=Ge(n|0,i|0,52)|0,ne()|0,l=l&15,l)for(s=1;z=(15-s|0)*3|0,x=Ge(n|0,i|0,z|0)|0,ne()|0,C=Oe(7,0,z|0)|0,i=i&~(ne()|0),z=Oe(as(x&7)|0,0,z|0)|0,n=n&~C|z,i=i|(ne()|0),s>>>0<l>>>0;)s=s+1|0;if(c=c+1|0,(c|0)==(f|0))break e}}c=Ge(n|0,i|0,52)|0,ne()|0,c=c&15;t:do if(c){s=1;i:for(;;){switch(z=Ge(n|0,i|0,(15-s|0)*3|0)|0,ne()|0,z&7){case 1:break i;case 0:break;default:break t}if(s>>>0<c>>>0)s=s+1|0;else break t}if(Ho(l,A[x>>2]|0)|0)for(s=1;x=(15-s|0)*3|0,C=Oe(7,0,x|0)|0,z=i&~(ne()|0),i=Ge(n|0,i|0,x|0)|0,ne()|0,i=Oe(Un(i&7)|0,0,x|0)|0,n=n&~C|i,i=z|(ne()|0),s>>>0<c>>>0;)s=s+1|0;else for(s=1;z=(15-s|0)*3|0,x=Ge(n|0,i|0,z|0)|0,ne()|0,C=Oe(7,0,z|0)|0,i=i&~(ne()|0),z=Oe(as(x&7)|0,0,z|0)|0,n=n&~C|z,i=i|(ne()|0),s>>>0<c>>>0;)s=s+1|0}while(!1);if((f|0)>0){s=0;do n=Ns(n,i)|0,i=ne()|0,s=s+1|0;while((s|0)!=(f|0))}}else n=0,i=0;while(!1);return C=i,z=n,St(C|0),J=S,z|0}function cr(i){return i=i|0,(i|0)%2|0|0}function vo(i,n,s){i=i|0,n=n|0,s=s|0;var l=0,c=0;return c=J,J=J+16|0,l=c,n>>>0>15?(l=4,J=c,l|0):(A[i+4>>2]&2146435072|0)==2146435072||(A[i+8+4>>2]&2146435072|0)==2146435072?(l=3,J=c,l|0):(Ls(i,n,l),n=yo(l,n)|0,l=ne()|0,A[s>>2]=n,A[s+4>>2]=l,(n|0)==0&(l|0)==0&&_t(23313,22674,786,22697),l=0,J=c,l|0)}function ea(i,n,s){i=i|0,n=n|0,s=s|0;var l=0,c=0,f=0,y=0;if(c=s+4|0,f=Ge(i|0,n|0,52)|0,ne()|0,f=f&15,y=Ge(i|0,n|0,45)|0,ne()|0,l=(f|0)==0,ci(y&127)|0){if(l)return y=1,y|0;l=1}else{if(l)return y=0,y|0;!(A[c>>2]|0)&&!(A[s+8>>2]|0)?l=(A[s+12>>2]|0)!=0&1:l=1}for(s=1;s&1?Bs(c):hn(c),y=Ge(i|0,n|0,(15-s|0)*3|0)|0,ne()|0,va(c,y&7),s>>>0<f>>>0;)s=s+1|0;return l|0}function Ai(i,n,s){i=i|0,n=n|0,s=s|0;var l=0,c=0,f=0,y=0,x=0,S=0,C=0,z=0;if(z=J,J=J+16|0,S=z,C=Ge(i|0,n|0,45)|0,ne()|0,C=C&127,C>>>0>121)return A[s>>2]=0,A[s+4>>2]=0,A[s+8>>2]=0,A[s+12>>2]=0,C=5,J=z,C|0;e:do if(ci(C)|0&&(f=Ge(i|0,n|0,52)|0,ne()|0,f=f&15,(f|0)!=0)){l=1;t:for(;;){switch(x=Ge(i|0,n|0,(15-l|0)*3|0)|0,ne()|0,x&7){case 5:break t;case 0:break;default:{l=n;break e}}if(l>>>0<f>>>0)l=l+1|0;else{l=n;break e}}for(c=1,l=n;n=(15-c|0)*3|0,y=Oe(7,0,n|0)|0,x=l&~(ne()|0),l=Ge(i|0,l|0,n|0)|0,ne()|0,l=Oe(Un(l&7)|0,0,n|0)|0,i=i&~y|l,l=x|(ne()|0),c>>>0<f>>>0;)c=c+1|0}else l=n;while(!1);if(x=7696+(C*28|0)|0,A[s>>2]=A[x>>2],A[s+4>>2]=A[x+4>>2],A[s+8>>2]=A[x+8>>2],A[s+12>>2]=A[x+12>>2],!(ea(i,l,s)|0))return C=0,J=z,C|0;if(y=s+4|0,A[S>>2]=A[y>>2],A[S+4>>2]=A[y+4>>2],A[S+8>>2]=A[y+8>>2],f=Ge(i|0,l|0,52)|0,ne()|0,x=f&15,f&1?(hn(y),f=x+1|0):f=x,!(ci(C)|0))l=0;else{e:do if(!x)l=0;else for(n=1;;){if(c=Ge(i|0,l|0,(15-n|0)*3|0)|0,ne()|0,c=c&7,c|0){l=c;break e}if(n>>>0<x>>>0)n=n+1|0;else{l=0;break}}while(!1);l=(l|0)==4&1}if(!(Vr(s,f,l,0)|0))(f|0)!=(x|0)&&(A[y>>2]=A[S>>2],A[y+4>>2]=A[S+4>>2],A[y+8>>2]=A[S+8>>2]);else{if(ci(C)|0)do;while(Vr(s,f,0,0)|0);(f|0)!=(x|0)&&Yo(y)}return C=0,J=z,C|0}function Kr(i,n,s){i=i|0,n=n|0,s=s|0;var l=0,c=0,f=0;return f=J,J=J+16|0,l=f,c=Ai(i,n,l)|0,c|0?(J=f,c|0):(c=Ge(i|0,n|0,52)|0,ne()|0,bi(l,c&15,s),c=0,J=f,c|0)}function Zi(i,n,s){i=i|0,n=n|0,s=s|0;var l=0,c=0,f=0,y=0,x=0;if(y=J,J=J+16|0,f=y,l=Ai(i,n,f)|0,l|0)return f=l,J=y,f|0;l=Ge(i|0,n|0,45)|0,ne()|0,l=(ci(l&127)|0)==0,c=Ge(i|0,n|0,52)|0,ne()|0,c=c&15;e:do if(!l){if(c|0)for(l=1;;){if(x=Oe(7,0,(15-l|0)*3|0)|0,!((x&i|0)==0&((ne()|0)&n|0)==0))break e;if(l>>>0<c>>>0)l=l+1|0;else break}return Ia(f,c,0,5,s),x=0,J=y,x|0}while(!1);return fi(f,c,0,6,s),x=0,J=y,x|0}function Us(i,n,s){i=i|0,n=n|0,s=s|0;var l=0,c=0,f=0;if(c=Ge(i|0,n|0,45)|0,ne()|0,!(ci(c&127)|0))return c=2,A[s>>2]=c,0;if(c=Ge(i|0,n|0,52)|0,ne()|0,c=c&15,!c)return c=5,A[s>>2]=c,0;for(l=1;;){if(f=Oe(7,0,(15-l|0)*3|0)|0,!((f&i|0)==0&((ne()|0)&n|0)==0)){l=2,i=6;break}if(l>>>0<c>>>0)l=l+1|0;else{l=5,i=6;break}}return(i|0)==6&&(A[s>>2]=l),0}function Gs(i,n,s){i=i|0,n=n|0,s=s|0;var l=0,c=0,f=0,y=0,x=0,S=0,C=0,z=0,G=0;G=J,J=J+128|0,C=G+112|0,f=G+96|0,z=G,c=Ge(i|0,n|0,52)|0,ne()|0,x=c&15,A[C>>2]=x,y=Ge(i|0,n|0,45)|0,ne()|0,y=y&127;e:do if(ci(y)|0){if(x|0)for(l=1;;){if(S=Oe(7,0,(15-l|0)*3|0)|0,!((S&i|0)==0&((ne()|0)&n|0)==0)){c=0;break e}if(l>>>0<x>>>0)l=l+1|0;else break}if(c&1)c=1;else return S=Oe(x+1|0,0,52)|0,z=ne()|0|n&-15728641,C=Oe(7,0,(14-x|0)*3|0)|0,z=Gs((S|i)&~C,z&~(ne()|0),s)|0,J=G,z|0}else c=0;while(!1);if(l=Ai(i,n,f)|0,!l){c?(Qt(f,C,z),S=5):(Rs(f,C,z),S=6);e:do if(ci(y)|0)if(!x)i=5;else for(l=1;;){if(y=Oe(7,0,(15-l|0)*3|0)|0,!((y&i|0)==0&((ne()|0)&n|0)==0)){i=2;break e}if(l>>>0<x>>>0)l=l+1|0;else{i=5;break}}else i=2;while(!1);g(s|0,-1,i<<2|0)|0;e:do if(c)for(f=0;;){if(y=z+(f<<4)|0,wi(y,A[C>>2]|0)|0,y=A[y>>2]|0,x=A[s>>2]|0,(x|0)==-1|(x|0)==(y|0))l=s;else{c=0;do{if(c=c+1|0,c>>>0>=i>>>0){l=1;break e}l=s+(c<<2)|0,x=A[l>>2]|0}while(!((x|0)==-1|(x|0)==(y|0)))}if(A[l>>2]=y,f=f+1|0,f>>>0>=S>>>0){l=0;break}}else for(f=0;;){if(y=z+(f<<4)|0,Vr(y,A[C>>2]|0,0,1)|0,y=A[y>>2]|0,x=A[s>>2]|0,(x|0)==-1|(x|0)==(y|0))l=s;else{c=0;do{if(c=c+1|0,c>>>0>=i>>>0){l=1;break e}l=s+(c<<2)|0,x=A[l>>2]|0}while(!((x|0)==-1|(x|0)==(y|0)))}if(A[l>>2]=y,f=f+1|0,f>>>0>=S>>>0){l=0;break}}while(!1)}return z=l,J=G,z|0}function ta(){return 12}function En(i,n){i=i|0,n=n|0;var s=0,l=0,c=0,f=0,y=0,x=0,S=0;if(i>>>0>15)return x=4,x|0;if(Oe(i|0,0,52)|0,x=ne()|0|134225919,!i){s=0,l=0;do ci(l)|0&&(Oe(l|0,0,45)|0,y=x|(ne()|0),i=n+(s<<3)|0,A[i>>2]=-1,A[i+4>>2]=y,s=s+1|0),l=l+1|0;while((l|0)!=122);return s=0,s|0}s=0,y=0;do{if(ci(y)|0){for(Oe(y|0,0,45)|0,l=1,c=-1,f=x|(ne()|0);S=Oe(7,0,(15-l|0)*3|0)|0,c=c&~S,f=f&~(ne()|0),(l|0)!=(i|0);)l=l+1|0;S=n+(s<<3)|0,A[S>>2]=c,A[S+4>>2]=f,s=s+1|0}y=y+1|0}while((y|0)!=122);return s=0,s|0}function xo(i,n,s,l){i=i|0,n=n|0,s=s|0,l=l|0;var c=0,f=0,y=0,x=0,S=0,C=0,z=0,G=0,N=0,Z=0,Q=0,ee=0,he=0,ge=0,oe=0;if(oe=J,J=J+16|0,he=oe,ge=Ge(i|0,n|0,52)|0,ne()|0,ge=ge&15,s>>>0>15)return ge=4,J=oe,ge|0;if((ge|0)<(s|0))return ge=12,J=oe,ge|0;if((ge|0)!=(s|0))if(f=Oe(s|0,0,52)|0,f=f|i,x=ne()|0|n&-15728641,(ge|0)>(s|0)){S=s;do ee=Oe(7,0,(14-S|0)*3|0)|0,S=S+1|0,f=ee|f,x=ne()|0|x;while((S|0)<(ge|0));ee=f}else ee=f;else ee=i,x=n;Q=Ge(ee|0,x|0,45)|0,ne()|0;e:do if(ci(Q&127)|0){if(S=Ge(ee|0,x|0,52)|0,ne()|0,S=S&15,S|0)for(f=1;;){if(Q=Oe(7,0,(15-f|0)*3|0)|0,!((Q&ee|0)==0&((ne()|0)&x|0)==0)){C=33;break e}if(f>>>0<S>>>0)f=f+1|0;else break}if(Q=l,A[Q>>2]=0,A[Q+4>>2]=0,(ge|0)>(s|0)){for(Q=n&-15728641,Z=ge;;){if(N=Z,Z=Z+-1|0,Z>>>0>15|(ge|0)<(Z|0)){C=19;break}if((ge|0)!=(Z|0))if(f=Oe(Z|0,0,52)|0,f=f|i,S=ne()|0|Q,(ge|0)<(N|0))G=f;else{C=Z;do G=Oe(7,0,(14-C|0)*3|0)|0,C=C+1|0,f=G|f,S=ne()|0|S;while((C|0)<(ge|0));G=f}else G=i,S=n;if(z=Ge(G|0,S|0,45)|0,ne()|0,!(ci(z&127)|0))f=0;else{z=Ge(G|0,S|0,52)|0,ne()|0,z=z&15;t:do if(!z)f=0;else for(C=1;;){if(f=Ge(G|0,S|0,(15-C|0)*3|0)|0,ne()|0,f=f&7,f|0)break t;if(C>>>0<z>>>0)C=C+1|0;else{f=0;break}}while(!1);f=(f|0)==0&1}if(S=Ge(i|0,n|0,(15-N|0)*3|0)|0,ne()|0,S=S&7,(S|0)==7){c=5,C=42;break}if(f=(f|0)!=0,(S|0)==1&f){c=5,C=42;break}if(G=S+(((S|0)!=0&f)<<31>>31)|0,G|0&&(C=ge-N|0,C=Gn(7,0,C,((C|0)<0)<<31>>31)|0,z=ne()|0,f?(f=Qi(C|0,z|0,5,0)|0,f=yt(f|0,ne()|0,-5,-1)|0,f=en(f|0,ne()|0,6,0)|0,f=yt(f|0,ne()|0,1,0)|0,S=ne()|0):(f=C,S=z),N=G+-1|0,N=Qi(C|0,z|0,N|0,((N|0)<0)<<31>>31|0)|0,N=yt(f|0,S|0,N|0,ne()|0)|0,G=ne()|0,z=l,z=yt(N|0,G|0,A[z>>2]|0,A[z+4>>2]|0)|0,G=ne()|0,N=l,A[N>>2]=z,A[N+4>>2]=G),(Z|0)<=(s|0)){C=37;break}}if((C|0)==19)_t(23313,22674,1099,22710);else if((C|0)==37){y=l,c=A[y+4>>2]|0,y=A[y>>2]|0;break}else if((C|0)==42)return J=oe,c|0}else c=0,y=0}else C=33;while(!1);e:do if((C|0)==33)if(Q=l,A[Q>>2]=0,A[Q+4>>2]=0,(ge|0)>(s|0)){for(f=ge;;){if(c=Ge(i|0,n|0,(15-f|0)*3|0)|0,ne()|0,c=c&7,(c|0)==7){c=5;break}if(y=ge-f|0,y=Gn(7,0,y,((y|0)<0)<<31>>31)|0,c=Qi(y|0,ne()|0,c|0,0)|0,y=ne()|0,Q=l,y=yt(A[Q>>2]|0,A[Q+4>>2]|0,c|0,y|0)|0,c=ne()|0,Q=l,A[Q>>2]=y,A[Q+4>>2]=c,f=f+-1|0,(f|0)<=(s|0))break e}return J=oe,c|0}else c=0,y=0;while(!1);return Vs(ee,x,ge,he)|0&&_t(23313,22674,1063,22725),ge=he,he=A[ge+4>>2]|0,((c|0)>-1|(c|0)==-1&y>>>0>4294967295)&((he|0)>(c|0)|((he|0)==(c|0)?(A[ge>>2]|0)>>>0>y>>>0:0))?(ge=0,J=oe,ge|0):(_t(23313,22674,1139,22710),0)}function js(i,n,s,l,c,f){i=i|0,n=n|0,s=s|0,l=l|0,c=c|0,f=f|0;var y=0,x=0,S=0,C=0,z=0,G=0,N=0,Z=0,Q=0,ee=0;if(G=J,J=J+16|0,y=G,c>>>0>15)return f=4,J=G,f|0;if(x=Ge(s|0,l|0,52)|0,ne()|0,x=x&15,(x|0)>(c|0))return f=12,J=G,f|0;if(Vs(s,l,c,y)|0&&_t(23313,22674,1063,22725),z=y,C=A[z+4>>2]|0,!(((n|0)>-1|(n|0)==-1&i>>>0>4294967295)&((C|0)>(n|0)|((C|0)==(n|0)?(A[z>>2]|0)>>>0>i>>>0:0))))return f=2,J=G,f|0;z=c-x|0,c=Oe(c|0,0,52)|0,S=ne()|0|l&-15728641,C=f,A[C>>2]=c|s,A[C+4>>2]=S,C=Ge(s|0,l|0,45)|0,ne()|0;e:do if(ci(C&127)|0){if(x|0)for(y=1;;){if(C=Oe(7,0,(15-y|0)*3|0)|0,!((C&s|0)==0&((ne()|0)&l|0)==0))break e;if(y>>>0<x>>>0)y=y+1|0;else break}if((z|0)<1)return f=0,J=G,f|0;for(C=x^15,l=-1,S=1,y=1;;){x=z-S|0,x=Gn(7,0,x,((x|0)<0)<<31>>31)|0,s=ne()|0;do if(y)if(y=Qi(x|0,s|0,5,0)|0,y=yt(y|0,ne()|0,-5,-1)|0,y=en(y|0,ne()|0,6,0)|0,c=ne()|0,(n|0)>(c|0)|(n|0)==(c|0)&i>>>0>y>>>0){n=yt(i|0,n|0,-1,-1)|0,n=$t(n|0,ne()|0,y|0,c|0)|0,y=ne()|0,N=f,Q=A[N>>2]|0,N=A[N+4>>2]|0,ee=(C+l|0)*3|0,Z=Oe(7,0,ee|0)|0,N=N&~(ne()|0),l=en(n|0,y|0,x|0,s|0)|0,i=ne()|0,c=yt(l|0,i|0,2,0)|0,ee=Oe(c|0,ne()|0,ee|0)|0,N=ne()|0|N,c=f,A[c>>2]=ee|Q&~Z,A[c+4>>2]=N,i=Qi(l|0,i|0,x|0,s|0)|0,i=$t(n|0,y|0,i|0,ne()|0)|0,y=0,n=ne()|0;break}else{ee=f,Z=A[ee>>2]|0,ee=A[ee+4>>2]|0,Q=Oe(7,0,(C+l|0)*3|0)|0,ee=ee&~(ne()|0),y=f,A[y>>2]=Z&~Q,A[y+4>>2]=ee,y=1;break}else Z=f,c=A[Z>>2]|0,Z=A[Z+4>>2]|0,l=(C+l|0)*3|0,N=Oe(7,0,l|0)|0,Z=Z&~(ne()|0),ee=en(i|0,n|0,x|0,s|0)|0,y=ne()|0,l=Oe(ee|0,y|0,l|0)|0,Z=ne()|0|Z,Q=f,A[Q>>2]=l|c&~N,A[Q+4>>2]=Z,y=Qi(ee|0,y|0,x|0,s|0)|0,i=$t(i|0,n|0,y|0,ne()|0)|0,y=0,n=ne()|0;while(!1);if((z|0)>(S|0))l=~S,S=S+1|0;else{n=0;break}}return J=G,n|0}while(!1);if((z|0)<1)return ee=0,J=G,ee|0;for(c=x^15,y=1;;)if(Q=z-y|0,Q=Gn(7,0,Q,((Q|0)<0)<<31>>31)|0,ee=ne()|0,S=f,s=A[S>>2]|0,S=A[S+4>>2]|0,x=(c-y|0)*3|0,l=Oe(7,0,x|0)|0,S=S&~(ne()|0),N=en(i|0,n|0,Q|0,ee|0)|0,Z=ne()|0,x=Oe(N|0,Z|0,x|0)|0,S=ne()|0|S,C=f,A[C>>2]=x|s&~l,A[C+4>>2]=S,ee=Qi(N|0,Z|0,Q|0,ee|0)|0,i=$t(i|0,n|0,ee|0,ne()|0)|0,n=ne()|0,(z|0)<=(y|0)){n=0;break}else y=y+1|0;return J=G,n|0}function Pa(i,n,s,l){i=i|0,n=n|0,s=s|0,l=l|0;var c=0,f=0;c=Ge(n|0,s|0,52)|0,ne()|0,c=c&15,(n|0)==0&(s|0)==0|((l|0)>15|(c|0)>(l|0))?(l=-1,c=-1,n=0,s=0):(f=mo(n,s,c+1|0,l)|0,s=(ne()|0)&-15728641,n=Oe(l|0,0,52)|0,n=f|n,s=s|(ne()|0),f=(ai(n,s)|0)==0,l=f?-1:l),f=i,A[f>>2]=n,A[f+4>>2]=s,A[i+8>>2]=c,A[i+12>>2]=l}function Da(i){i=i|0;var n=0,s=0,l=0,c=0,f=0,y=0,x=0,S=0,C=0;if(s=i,n=A[s>>2]|0,s=A[s+4>>2]|0,!((n|0)==0&(s|0)==0)&&(l=Ge(n|0,s|0,52)|0,ne()|0,l=l&15,x=Oe(1,0,(l^15)*3|0)|0,n=yt(x|0,ne()|0,n|0,s|0)|0,s=ne()|0,x=i,A[x>>2]=n,A[x+4>>2]=s,x=i+8|0,y=A[x>>2]|0,!((l|0)<(y|0)))){for(S=i+12|0,f=l;;){if((f|0)==(y|0)){l=5;break}if(C=(f|0)==(A[S>>2]|0),c=(15-f|0)*3|0,l=Ge(n|0,s|0,c|0)|0,ne()|0,l=l&7,C&((l|0)==1&!0)){l=7;break}if(!((l|0)==7&!0)){l=10;break}if(C=Oe(1,0,c|0)|0,n=yt(n|0,s|0,C|0,ne()|0)|0,s=ne()|0,C=i,A[C>>2]=n,A[C+4>>2]=s,(f|0)>(y|0))f=f+-1|0;else{l=10;break}}if((l|0)==5){C=i,A[C>>2]=0,A[C+4>>2]=0,A[x>>2]=-1,A[S>>2]=-1;return}else if((l|0)==7){y=Oe(1,0,c|0)|0,y=yt(n|0,s|0,y|0,ne()|0)|0,x=ne()|0,C=i,A[C>>2]=y,A[C+4>>2]=x,A[S>>2]=f+-1;return}else if((l|0)==10)return}}function qs(i){i=+i;var n=0;return n=i<0?i+6.283185307179586:i,+(i>=6.283185307179586?n+-6.283185307179586:n)}function As(i,n){return i=i|0,n=n|0,+ot(+(+H[i>>3]-+H[n>>3]))<17453292519943298e-27?(n=+ot(+(+H[i+8>>3]-+H[n+8>>3]))<17453292519943298e-27,n|0):(n=0,n|0)}function ml(i,n){i=i|0,n=n|0;var s=0,l=0,c=0,f=0;return c=+H[n>>3],l=+H[i>>3],f=+gt(+((c-l)*.5)),s=+gt(+((+H[n+8>>3]-+H[i+8>>3])*.5)),s=f*f+s*(+Et(+c)*+Et(+l)*s),+(+Yi(+ +At(+s),+ +At(+(1-s)))*2)}function gr(i,n){i=i|0,n=n|0;var s=0,l=0,c=0,f=0;return c=+H[n>>3],l=+H[i>>3],f=+gt(+((c-l)*.5)),s=+gt(+((+H[n+8>>3]-+H[i+8>>3])*.5)),s=f*f+s*(+Et(+c)*+Et(+l)*s),+(+Yi(+ +At(+s),+ +At(+(1-s)))*2*6371.007180918475)}function bo(i,n){i=i|0,n=n|0;var s=0,l=0,c=0,f=0;return c=+H[n>>3],l=+H[i>>3],f=+gt(+((c-l)*.5)),s=+gt(+((+H[n+8>>3]-+H[i+8>>3])*.5)),s=f*f+s*(+Et(+c)*+Et(+l)*s),+(+Yi(+ +At(+s),+ +At(+(1-s)))*2*6371.007180918475*1e3)}function Er(i,n){i=i|0,n=n|0;var s=0,l=0,c=0,f=0,y=0;return f=+H[n>>3],l=+Et(+f),c=+H[n+8>>3]-+H[i+8>>3],y=l*+gt(+c),s=+H[i>>3],+ +Yi(+y,+(+gt(+f)*+Et(+s)-+Et(+c)*(l*+gt(+s))))}function wo(i,n,s,l){i=i|0,n=+n,s=+s,l=l|0;var c=0,f=0,y=0,x=0;if(s<1e-16){A[l>>2]=A[i>>2],A[l+4>>2]=A[i+4>>2],A[l+8>>2]=A[i+8>>2],A[l+12>>2]=A[i+12>>2];return}f=n<0?n+6.283185307179586:n,f=n>=6.283185307179586?f+-6.283185307179586:f;do if(f<1e-16)n=+H[i>>3]+s,H[l>>3]=n,c=l;else{if(c=+ot(+(f+-3.141592653589793))<1e-16,n=+H[i>>3],c){n=n-s,H[l>>3]=n,c=l;break}if(y=+Et(+s),s=+gt(+s),n=y*+gt(+n)+ +Et(+f)*(s*+Et(+n)),n=n>1?1:n,n=+il(+(n<-1?-1:n)),H[l>>3]=n,+ot(+(n+-1.5707963267948966))<1e-16){H[l>>3]=1.5707963267948966,H[l+8>>3]=0;return}if(+ot(+(n+1.5707963267948966))<1e-16){H[l>>3]=-1.5707963267948966,H[l+8>>3]=0;return}if(x=+Et(+n),f=s*+gt(+f)/x,s=+H[i>>3],n=(y-+gt(+n)*+gt(+s))/+Et(+s)/x,y=f>1?1:f,n=n>1?1:n,n=+H[i+8>>3]+ +Yi(+(y<-1?-1:y),+(n<-1?-1:n)),n>3.141592653589793)do n=n+-6.283185307179586;while(n>3.141592653589793);if(n<-3.141592653589793)do n=n+6.283185307179586;while(n<-3.141592653589793);H[l+8>>3]=n;return}while(!1);if(+ot(+(n+-1.5707963267948966))<1e-16){H[c>>3]=1.5707963267948966,H[l+8>>3]=0;return}if(+ot(+(n+1.5707963267948966))<1e-16){H[c>>3]=-1.5707963267948966,H[l+8>>3]=0;return}if(n=+H[i+8>>3],n>3.141592653589793)do n=n+-6.283185307179586;while(n>3.141592653589793);if(n<-3.141592653589793)do n=n+6.283185307179586;while(n<-3.141592653589793);H[l+8>>3]=n}function gl(i,n){return i=i|0,n=n|0,i>>>0>15?(n=4,n|0):(H[n>>3]=+H[20528+(i<<3)>>3],n=0,n|0)}function _l(i,n){return i=i|0,n=n|0,i>>>0>15?(n=4,n|0):(H[n>>3]=+H[20656+(i<<3)>>3],n=0,n|0)}function yl(i,n){return i=i|0,n=n|0,i>>>0>15?(n=4,n|0):(H[n>>3]=+H[20784+(i<<3)>>3],n=0,n|0)}function Sn(i,n){return i=i|0,n=n|0,i>>>0>15?(n=4,n|0):(H[n>>3]=+H[20912+(i<<3)>>3],n=0,n|0)}function ia(i,n){i=i|0,n=n|0;var s=0;return i>>>0>15?(n=4,n|0):(s=Gn(7,0,i,((i|0)<0)<<31>>31)|0,s=Qi(s|0,ne()|0,120,0)|0,i=ne()|0,A[n>>2]=s|2,A[n+4>>2]=i,n=0,n|0)}function Sr(i,n,s){i=i|0,n=n|0,s=s|0;var l=0,c=0,f=0,y=0,x=0,S=0,C=0,z=0,G=0,N=0;return N=+H[n>>3],z=+H[i>>3],S=+gt(+((N-z)*.5)),f=+H[n+8>>3],C=+H[i+8>>3],y=+gt(+((f-C)*.5)),x=+Et(+z),G=+Et(+N),y=S*S+y*(G*x*y),y=+Yi(+ +At(+y),+ +At(+(1-y)))*2,S=+H[s>>3],N=+gt(+((S-N)*.5)),l=+H[s+8>>3],f=+gt(+((l-f)*.5)),c=+Et(+S),f=N*N+f*(G*c*f),f=+Yi(+ +At(+f),+ +At(+(1-f)))*2,S=+gt(+((z-S)*.5)),l=+gt(+((C-l)*.5)),l=S*S+l*(x*c*l),l=+Yi(+ +At(+l),+ +At(+(1-l)))*2,c=(y+f+l)*.5,+(+On(+ +At(+(+li(+(c*.5))*+li(+((c-y)*.5))*+li(+((c-f)*.5))*+li(+((c-l)*.5)))))*4)}function Jr(i,n,s){i=i|0,n=n|0,s=s|0;var l=0,c=0,f=0,y=0,x=0;if(x=J,J=J+192|0,f=x+168|0,y=x,c=Kr(i,n,f)|0,c|0)return s=c,J=x,s|0;if(Zi(i,n,y)|0&&_t(23313,22742,386,22751),n=A[y>>2]|0,(n|0)>0){if(l=+Sr(y+8|0,y+8+(((n|0)!=1&1)<<4)|0,f)+0,(n|0)!=1){i=1;do c=i,i=i+1|0,l=l+ +Sr(y+8+(c<<4)|0,y+8+(((i|0)%(n|0)|0)<<4)|0,f);while((i|0)<(n|0))}}else l=0;return H[s>>3]=l,s=0,J=x,s|0}function ra(i,n,s){return i=i|0,n=n|0,s=s|0,i=Jr(i,n,s)|0,i|0||(H[s>>3]=+H[s>>3]*6371.007180918475*6371.007180918475),i|0}function Tn(i,n,s){return i=i|0,n=n|0,s=s|0,i=Jr(i,n,s)|0,i|0||(H[s>>3]=+H[s>>3]*6371.007180918475*6371.007180918475*1e3*1e3),i|0}function In(i,n,s){i=i|0,n=n|0,s=s|0;var l=0,c=0,f=0,y=0,x=0,S=0,C=0,z=0;if(x=J,J=J+176|0,y=x,i=Yr(i,n,y)|0,i|0)return y=i,J=x,y|0;if(H[s>>3]=0,i=A[y>>2]|0,(i|0)<=1)return y=0,J=x,y|0;n=i+-1|0,i=0,l=+H[y+8>>3],c=+H[y+16>>3],f=0;do i=i+1|0,C=l,l=+H[y+8+(i<<4)>>3],z=+gt(+((l-C)*.5)),S=c,c=+H[y+8+(i<<4)+8>>3],S=+gt(+((c-S)*.5)),S=z*z+S*(+Et(+l)*+Et(+C)*S),f=f+ +Yi(+ +At(+S),+ +At(+(1-S)))*2;while((i|0)<(n|0));return H[s>>3]=f,y=0,J=x,y|0}function Jl(i,n,s){i=i|0,n=n|0,s=s|0;var l=0,c=0,f=0,y=0,x=0,S=0,C=0,z=0;if(x=J,J=J+176|0,y=x,i=Yr(i,n,y)|0,i|0)return y=i,f=+H[s>>3],f=f*6371.007180918475,H[s>>3]=f,J=x,y|0;if(H[s>>3]=0,i=A[y>>2]|0,(i|0)<=1)return y=0,f=0,f=f*6371.007180918475,H[s>>3]=f,J=x,y|0;n=i+-1|0,i=0,l=+H[y+8>>3],c=+H[y+16>>3],f=0;do i=i+1|0,C=l,l=+H[y+8+(i<<4)>>3],z=+gt(+((l-C)*.5)),S=c,c=+H[y+8+(i<<4)+8>>3],S=+gt(+((c-S)*.5)),S=z*z+S*(+Et(+C)*+Et(+l)*S),f=f+ +Yi(+ +At(+S),+ +At(+(1-S)))*2;while((i|0)!=(n|0));return H[s>>3]=f,y=0,z=f,z=z*6371.007180918475,H[s>>3]=z,J=x,y|0}function Ba(i,n,s){i=i|0,n=n|0,s=s|0;var l=0,c=0,f=0,y=0,x=0,S=0,C=0,z=0;if(x=J,J=J+176|0,y=x,i=Yr(i,n,y)|0,i|0)return y=i,f=+H[s>>3],f=f*6371.007180918475,f=f*1e3,H[s>>3]=f,J=x,y|0;if(H[s>>3]=0,i=A[y>>2]|0,(i|0)<=1)return y=0,f=0,f=f*6371.007180918475,f=f*1e3,H[s>>3]=f,J=x,y|0;n=i+-1|0,i=0,l=+H[y+8>>3],c=+H[y+16>>3],f=0;do i=i+1|0,C=l,l=+H[y+8+(i<<4)>>3],z=+gt(+((l-C)*.5)),S=c,c=+H[y+8+(i<<4)+8>>3],S=+gt(+((c-S)*.5)),S=z*z+S*(+Et(+C)*+Et(+l)*S),f=f+ +Yi(+ +At(+S),+ +At(+(1-S)))*2;while((i|0)!=(n|0));return H[s>>3]=f,y=0,z=f,z=z*6371.007180918475,z=z*1e3,H[s>>3]=z,J=x,y|0}function vl(i){i=i|0;var n=0,s=0,l=0;return n=ar(1,12)|0,n||_t(22832,22787,49,22845),s=i+4|0,l=A[s>>2]|0,l|0?(l=l+8|0,A[l>>2]=n,A[s>>2]=n,n|0):(A[i>>2]|0&&_t(22862,22787,61,22885),l=i,A[l>>2]=n,A[s>>2]=n,n|0)}function na(i,n){i=i|0,n=n|0;var s=0,l=0;return l=Bi(24)|0,l||_t(22899,22787,78,22913),A[l>>2]=A[n>>2],A[l+4>>2]=A[n+4>>2],A[l+8>>2]=A[n+8>>2],A[l+12>>2]=A[n+12>>2],A[l+16>>2]=0,n=i+4|0,s=A[n>>2]|0,s|0?(A[s+16>>2]=l,A[n>>2]=l,l|0):(A[i>>2]|0&&_t(22928,22787,82,22913),A[i>>2]=l,A[n>>2]=l,l|0)}function us(i){i=i|0;var n=0,s=0,l=0,c=0;if(i)for(l=1;;){if(n=A[i>>2]|0,n|0)do{if(s=A[n>>2]|0,s|0)do c=s,s=A[s+16>>2]|0,Ct(c);while(s|0);c=n,n=A[n+8>>2]|0,Ct(c)}while(n|0);if(n=i,i=A[i+8>>2]|0,l||Ct(n),i)l=0;else break}}function Mn(i){i=i|0;var n=0,s=0,l=0,c=0,f=0,y=0,x=0,S=0,C=0,z=0,G=0,N=0,Z=0,Q=0,ee=0,he=0,ge=0,oe=0,fe=0,pe=0,Fe=0,Me=0,Pe=0,Ce=0,vt=0,at=0,rt=0,et=0,ft=0,ut=0,Rt=0,dt=0;if(c=i+8|0,A[c>>2]|0)return dt=1,dt|0;if(l=A[i>>2]|0,!l)return dt=0,dt|0;n=l,s=0;do s=s+1|0,n=A[n+8>>2]|0;while(n|0);if(s>>>0<2)return dt=0,dt|0;ut=Bi(s<<2)|0,ut||_t(22948,22787,317,22967),ft=Bi(s<<5)|0,ft||_t(22989,22787,321,22967),A[i>>2]=0,Me=i+4|0,A[Me>>2]=0,A[c>>2]=0,s=0,et=0,Fe=0,G=0;e:for(;;){if(z=A[l>>2]|0,z){f=0,y=z;do{if(S=+H[y+8>>3],n=y,y=A[y+16>>2]|0,C=(y|0)==0,c=C?z:y,x=+H[c+8>>3],+ot(+(S-x))>3.141592653589793){dt=14;break}f=f+(x-S)*(+H[n>>3]+ +H[c>>3])}while(!C);if((dt|0)==14){dt=0,f=0,n=z;do pe=+H[n+8>>3],rt=n+16|0,at=A[rt>>2]|0,at=at|0?at:z,fe=+H[at+8>>3],f=f+(+H[n>>3]+ +H[at>>3])*((fe<0?fe+6.283185307179586:fe)-(pe<0?pe+6.283185307179586:pe)),n=A[(n|0?rt:l)>>2]|0;while(n|0)}f>0?(A[ut+(et<<2)>>2]=l,et=et+1|0,c=Fe,n=G):dt=19}else dt=19;if((dt|0)==19){dt=0;do if(s){if(n=s+8|0,A[n>>2]|0){dt=21;break e}if(s=ar(1,12)|0,!s){dt=23;break e}A[n>>2]=s,c=s+4|0,y=s,n=G}else if(G){c=Me,y=G+8|0,n=l,s=i;break}else if(A[i>>2]|0){dt=27;break e}else{c=Me,y=i,n=l,s=i;break}while(!1);if(A[y>>2]=l,A[c>>2]=l,y=ft+(Fe<<5)|0,C=A[l>>2]|0,C){for(z=ft+(Fe<<5)+8|0,H[z>>3]=17976931348623157e292,G=ft+(Fe<<5)+24|0,H[G>>3]=17976931348623157e292,H[y>>3]=-17976931348623157e292,N=ft+(Fe<<5)+16|0,H[N>>3]=-17976931348623157e292,ge=17976931348623157e292,oe=-17976931348623157e292,c=0,Z=C,S=17976931348623157e292,ee=17976931348623157e292,he=-17976931348623157e292,x=-17976931348623157e292;f=+H[Z>>3],pe=+H[Z+8>>3],Z=A[Z+16>>2]|0,Q=(Z|0)==0,fe=+H[(Q?C:Z)+8>>3],f<S&&(H[z>>3]=f,S=f),pe<ee&&(H[G>>3]=pe,ee=pe),f>he?H[y>>3]=f:f=he,pe>x&&(H[N>>3]=pe,x=pe),ge=pe>0&pe<ge?pe:ge,oe=pe<0&pe>oe?pe:oe,c=c|+ot(+(pe-fe))>3.141592653589793,!Q;)he=f;c&&(H[N>>3]=oe,H[G>>3]=ge)}else A[y>>2]=0,A[y+4>>2]=0,A[y+8>>2]=0,A[y+12>>2]=0,A[y+16>>2]=0,A[y+20>>2]=0,A[y+24>>2]=0,A[y+28>>2]=0;c=Fe+1|0}if(rt=l+8|0,l=A[rt>>2]|0,A[rt>>2]=0,l)Fe=c,G=n;else{dt=45;break}}if((dt|0)==21)_t(22765,22787,35,22799);else if((dt|0)==23)_t(22819,22787,37,22799);else if((dt|0)==27)_t(22862,22787,61,22885);else if((dt|0)==45){e:do if((et|0)>0){for(rt=(c|0)==0,vt=c<<2,at=(i|0)==0,Ce=0,n=0;;){if(Pe=A[ut+(Ce<<2)>>2]|0,rt)dt=73;else{if(Fe=Bi(vt)|0,!Fe){dt=50;break}if(Me=Bi(vt)|0,!Me){dt=52;break}t:do if(at)s=0;else{for(c=0,s=0,y=i;l=ft+(c<<5)|0,st(A[y>>2]|0,l,A[Pe>>2]|0)|0?(A[Fe+(s<<2)>>2]=y,A[Me+(s<<2)>>2]=l,Q=s+1|0):Q=s,y=A[y+8>>2]|0,y;)c=c+1|0,s=Q;if((Q|0)>0)if(l=A[Fe>>2]|0,(Q|0)==1)s=l;else for(N=0,Z=-1,s=l,G=l;;){for(C=A[G>>2]|0,l=0,y=0;c=A[A[Fe+(y<<2)>>2]>>2]|0,(c|0)==(C|0)?z=l:z=l+((st(c,A[Me+(y<<2)>>2]|0,A[C>>2]|0)|0)&1)|0,y=y+1|0,(y|0)!=(Q|0);)l=z;if(c=(z|0)>(Z|0),s=c?G:s,l=N+1|0,(l|0)==(Q|0))break t;N=l,Z=c?z:Z,G=A[Fe+(l<<2)>>2]|0}else s=0}while(!1);if(Ct(Fe),Ct(Me),s){if(c=s+4|0,l=A[c>>2]|0,l)s=l+8|0;else if(A[s>>2]|0){dt=70;break}A[s>>2]=Pe,A[c>>2]=Pe}else dt=73}if((dt|0)==73){if(dt=0,n=A[Pe>>2]|0,n|0)do Me=n,n=A[n+16>>2]|0,Ct(Me);while(n|0);Ct(Pe),n=1}if(Ce=Ce+1|0,(Ce|0)>=(et|0)){Rt=n;break e}}(dt|0)==50?_t(23004,22787,249,23023):(dt|0)==52?_t(23042,22787,252,23023):(dt|0)==70&&_t(22862,22787,61,22885)}else Rt=0;while(!1);return Ct(ut),Ct(ft),dt=Rt,dt|0}return 0}function st(i,n,s){i=i|0,n=n|0,s=s|0;var l=0,c=0,f=0,y=0,x=0,S=0,C=0,z=0;if(!(Ps(n,s)|0)||(n=uo(n)|0,l=+H[s>>3],c=+H[s+8>>3],c=n&c<0?c+6.283185307179586:c,i=A[i>>2]|0,!i))return i=0,i|0;if(n){n=0,C=c,s=i;e:for(;;){for(;y=+H[s>>3],c=+H[s+8>>3],s=s+16|0,z=A[s>>2]|0,z=z|0?z:i,f=+H[z>>3],x=+H[z+8>>3],y>f?(S=y,y=x):(S=f,f=y,y=c,c=x),l=l==f|l==S?l+2220446049250313e-31:l,!!(l<f|l>S);)if(s=A[s>>2]|0,!s){s=22;break e}if(x=y<0?y+6.283185307179586:y,y=c<0?c+6.283185307179586:c,C=x==C|y==C?C+-2220446049250313e-31:C,S=x+(y-x)*((l-f)/(S-f)),(S<0?S+6.283185307179586:S)>C&&(n=n^1),s=A[s>>2]|0,!s){s=22;break}}if((s|0)==22)return n|0}else{n=0,C=c,s=i;e:for(;;){for(;y=+H[s>>3],c=+H[s+8>>3],s=s+16|0,z=A[s>>2]|0,z=z|0?z:i,f=+H[z>>3],x=+H[z+8>>3],y>f?(S=y,y=x):(S=f,f=y,y=c,c=x),l=l==f|l==S?l+2220446049250313e-31:l,!!(l<f|l>S);)if(s=A[s>>2]|0,!s){s=22;break e}if(C=y==C|c==C?C+-2220446049250313e-31:C,y+(c-y)*((l-f)/(S-f))>C&&(n=n^1),s=A[s>>2]|0,!s){s=22;break}}if((s|0)==22)return n|0}return 0}function Nr(i,n,s,l,c){i=i|0,n=n|0,s=s|0,l=l|0,c=c|0;var f=0,y=0,x=0,S=0,C=0,z=0,G=0,N=0,Z=0,Q=0,ee=0,he=0,ge=0,oe=0;if(oe=J,J=J+32|0,ge=oe+16|0,he=oe,f=Ge(i|0,n|0,52)|0,ne()|0,f=f&15,Z=Ge(s|0,l|0,52)|0,ne()|0,(f|0)!=(Z&15|0))return ge=12,J=oe,ge|0;if(C=Ge(i|0,n|0,45)|0,ne()|0,C=C&127,z=Ge(s|0,l|0,45)|0,ne()|0,z=z&127,C>>>0>121|z>>>0>121)return ge=5,J=oe,ge|0;if(Z=(C|0)!=(z|0),Z){if(x=Cs(C,z)|0,(x|0)==7)return ge=1,J=oe,ge|0;S=Cs(z,C)|0,(S|0)==7?_t(23066,23090,161,23100):(Q=x,y=S)}else Q=0,y=0;G=ci(C)|0,N=ci(z)|0,A[ge>>2]=0,A[ge+4>>2]=0,A[ge+8>>2]=0,A[ge+12>>2]=0;do if(Q){if(z=A[4272+(C*28|0)+(Q<<2)>>2]|0,x=(z|0)>0,N)if(x){C=0,S=s,x=l;do S=pl(S,x)|0,x=ne()|0,y=Un(y)|0,(y|0)==1&&(y=Un(1)|0),C=C+1|0;while((C|0)!=(z|0));z=y,C=S,S=x}else z=y,C=s,S=l;else if(x){C=0,S=s,x=l;do S=Jo(S,x)|0,x=ne()|0,y=Un(y)|0,C=C+1|0;while((C|0)!=(z|0));z=y,C=S,S=x}else z=y,C=s,S=l;if(ea(C,S,ge)|0,Z||_t(23115,23090,191,23100),x=(G|0)!=0,y=(N|0)!=0,x&y&&_t(23142,23090,192,23100),x){if(y=ur(i,n)|0,(y|0)==7){f=5;break}if(Ue[21872+(y*7|0)+Q>>0]|0){f=1;break}S=A[21040+(y*28|0)+(Q<<2)>>2]|0,C=S}else if(y){if(y=ur(C,S)|0,(y|0)==7){f=5;break}if(Ue[21872+(y*7|0)+z>>0]|0){f=1;break}C=0,S=A[21040+(z*28|0)+(y<<2)>>2]|0}else C=0,S=0;if((C|S|0)<0)f=5;else{if((S|0)>0){x=ge+4|0,y=0;do wn(x),y=y+1|0;while((y|0)!=(S|0))}if(A[he>>2]=0,A[he+4>>2]=0,A[he+8>>2]=0,va(he,Q),f|0)for(;cr(f)|0?Bs(he):hn(he),(f|0)>1;)f=f+-1|0;if((C|0)>0){f=0;do wn(he),f=f+1|0;while((f|0)!=(C|0))}ee=ge+4|0,hi(ee,he,ee),Vi(ee),ee=51}}else if(ea(s,l,ge)|0,(G|0)!=0&(N|0)!=0)if((z|0)!=(C|0)&&_t(23173,23090,261,23100),y=ur(i,n)|0,f=ur(s,l)|0,(y|0)==7|(f|0)==7)f=5;else if(Ue[21872+(y*7|0)+f>>0]|0)f=1;else if(y=A[21040+(y*28|0)+(f<<2)>>2]|0,(y|0)>0){x=ge+4|0,f=0;do wn(x),f=f+1|0;while((f|0)!=(y|0));ee=51}else ee=51;else ee=51;while(!1);return(ee|0)==51&&(f=ge+4|0,A[c>>2]=A[f>>2],A[c+4>>2]=A[f+4>>2],A[c+8>>2]=A[f+8>>2],f=0),ge=f,J=oe,ge|0}function Cn(i,n,s,l){i=i|0,n=n|0,s=s|0,l=l|0;var c=0,f=0,y=0,x=0,S=0,C=0,z=0,G=0,N=0,Z=0,Q=0,ee=0,he=0,ge=0,oe=0,fe=0;if(ee=J,J=J+48|0,C=ee+36|0,y=ee+24|0,x=ee+12|0,S=ee,c=Ge(i|0,n|0,52)|0,ne()|0,c=c&15,N=Ge(i|0,n|0,45)|0,ne()|0,N=N&127,N>>>0>121)return l=5,J=ee,l|0;if(z=ci(N)|0,Oe(c|0,0,52)|0,he=ne()|0|134225919,f=l,A[f>>2]=-1,A[f+4>>2]=he,!c)return c=os(s)|0,(c|0)==7||(c=bn(N,c)|0,(c|0)==127)?(he=1,J=ee,he|0):(Z=Oe(c|0,0,45)|0,Q=ne()|0,N=l,Q=A[N+4>>2]&-1040385|Q,he=l,A[he>>2]=A[N>>2]|Z,A[he+4>>2]=Q,he=0,J=ee,he|0);for(A[C>>2]=A[s>>2],A[C+4>>2]=A[s+4>>2],A[C+8>>2]=A[s+8>>2],s=c;;){if(f=s,s=s+-1|0,A[y>>2]=A[C>>2],A[y+4>>2]=A[C+4>>2],A[y+8>>2]=A[C+8>>2],cr(f)|0){if(c=_a(C)|0,c|0){s=13;break}A[x>>2]=A[C>>2],A[x+4>>2]=A[C+4>>2],A[x+8>>2]=A[C+8>>2],Bs(x)}else{if(c=ya(C)|0,c|0){s=13;break}A[x>>2]=A[C>>2],A[x+4>>2]=A[C+4>>2],A[x+8>>2]=A[C+8>>2],hn(x)}if(ho(y,x,S),Vi(S),c=l,oe=A[c>>2]|0,c=A[c+4>>2]|0,fe=(15-f|0)*3|0,ge=Oe(7,0,fe|0)|0,c=c&~(ne()|0),fe=Oe(os(S)|0,0,fe|0)|0,c=ne()|0|c,he=l,A[he>>2]=fe|oe&~ge,A[he+4>>2]=c,(f|0)<=1){s=14;break}}e:do if((s|0)!=13&&(s|0)==14)if((A[C>>2]|0)<=1&&(A[C+4>>2]|0)<=1&&(A[C+8>>2]|0)<=1){s=os(C)|0,c=bn(N,s)|0,(c|0)==127?S=0:S=ci(c)|0;t:do if(s){if(z){if(c=ur(i,n)|0,(c|0)==7){c=5;break e}if(f=A[21248+(c*28|0)+(s<<2)>>2]|0,(f|0)>0){c=s,s=0;do c=as(c)|0,s=s+1|0;while((s|0)!=(f|0))}else c=s;if((c|0)==1){c=9;break e}s=bn(N,c)|0,(s|0)==127&&_t(23200,23090,411,23230),ci(s)|0?_t(23245,23090,412,23230):(Q=s,Z=f,G=c)}else Q=c,Z=0,G=s;if(x=A[4272+(N*28|0)+(G<<2)>>2]|0,(x|0)<=-1&&_t(23276,23090,419,23230),!S){if((Z|0)<0){c=5;break e}if(Z|0){f=l,c=0,s=A[f>>2]|0,f=A[f+4>>2]|0;do s=kn(s,f)|0,f=ne()|0,fe=l,A[fe>>2]=s,A[fe+4>>2]=f,c=c+1|0;while((c|0)<(Z|0))}if((x|0)<=0){c=Q,s=58;break}for(f=l,c=0,s=A[f>>2]|0,f=A[f+4>>2]|0;;)if(s=kn(s,f)|0,f=ne()|0,fe=l,A[fe>>2]=s,A[fe+4>>2]=f,c=c+1|0,(c|0)==(x|0)){c=Q,s=58;break t}}if(y=Cs(Q,N)|0,(y|0)==7&&_t(23066,23090,428,23230),c=l,s=A[c>>2]|0,c=A[c+4>>2]|0,(x|0)>0){f=0;do s=kn(s,c)|0,c=ne()|0,fe=l,A[fe>>2]=s,A[fe+4>>2]=c,f=f+1|0;while((f|0)!=(x|0))}if(c=ur(s,c)|0,(c|0)==7&&_t(23313,23090,440,23230),s=$o(Q)|0,s=A[(s?21664:21456)+(y*28|0)+(c<<2)>>2]|0,(s|0)<0&&_t(23313,23090,454,23230),!s)c=Q,s=58;else{y=l,c=0,f=A[y>>2]|0,y=A[y+4>>2]|0;do f=Ns(f,y)|0,y=ne()|0,fe=l,A[fe>>2]=f,A[fe+4>>2]=y,c=c+1|0;while((c|0)<(s|0));c=Q,s=58}}else if((z|0)!=0&(S|0)!=0){if(s=ur(i,n)|0,f=l,f=ur(A[f>>2]|0,A[f+4>>2]|0)|0,(s|0)==7|(f|0)==7){c=5;break e}if(f=A[21248+(s*28|0)+(f<<2)>>2]|0,(f|0)<0){c=5;break e}if(!f)s=59;else{x=l,s=0,y=A[x>>2]|0,x=A[x+4>>2]|0;do y=kn(y,x)|0,x=ne()|0,fe=l,A[fe>>2]=y,A[fe+4>>2]=x,s=s+1|0;while((s|0)<(f|0));s=58}}else s=58;while(!1);if((s|0)==58&&S&&(s=59),(s|0)==59&&(fe=l,(ur(A[fe>>2]|0,A[fe+4>>2]|0)|0)==1)){c=9;break}fe=l,ge=A[fe>>2]|0,fe=A[fe+4>>2]&-1040385,oe=Oe(c|0,0,45)|0,fe=fe|(ne()|0),c=l,A[c>>2]=ge|oe,A[c+4>>2]=fe,c=0}else c=1;while(!1);return fe=c,J=ee,fe|0}function Zs(i,n,s,l,c,f){i=i|0,n=n|0,s=s|0,l=l|0,c=c|0,f=f|0;var y=0,x=0;return x=J,J=J+16|0,y=x,c?i=15:(i=Nr(i,n,s,l,y)|0,i||(Xl(y,f),i=0)),J=x,i|0}function xl(i,n,s,l,c){i=i|0,n=n|0,s=s|0,l=l|0,c=c|0;var f=0,y=0;return y=J,J=J+16|0,f=y,l?s=15:(s=wa(s,f)|0,s||(s=Cn(i,n,f,c)|0)),J=y,s|0}function Je(i,n,s,l,c){i=i|0,n=n|0,s=s|0,l=l|0,c=c|0;var f=0,y=0,x=0,S=0;return S=J,J=J+32|0,y=S+12|0,x=S,f=Nr(i,n,i,n,y)|0,f|0?(x=f,J=S,x|0):(i=Nr(i,n,s,l,x)|0,i|0?(x=i,J=S,x|0):(y=ba(y,x)|0,x=c,A[x>>2]=y,A[x+4>>2]=((y|0)<0)<<31>>31,x=0,J=S,x|0))}function za(i,n,s,l,c){i=i|0,n=n|0,s=s|0,l=l|0,c=c|0;var f=0,y=0,x=0,S=0;return S=J,J=J+32|0,y=S+12|0,x=S,f=Nr(i,n,i,n,y)|0,!f&&(f=Nr(i,n,s,l,x)|0,!f)?(l=ba(y,x)|0,l=yt(l|0,((l|0)<0)<<31>>31|0,1,0)|0,y=ne()|0,x=c,A[x>>2]=l,A[x+4>>2]=y,x=0,J=S,x|0):(x=f,J=S,x|0)}function La(i,n,s,l,c){i=i|0,n=n|0,s=s|0,l=l|0,c=c|0;var f=0,y=0,x=0,S=0,C=0,z=0,G=0,N=0,Z=0,Q=0,ee=0,he=0,ge=0,oe=0,fe=0,pe=0,Fe=0,Me=0,Pe=0,Ce=0;if(Pe=J,J=J+48|0,y=Pe+24|0,x=Pe+12|0,Me=Pe,f=Nr(i,n,i,n,y)|0,!f&&(f=Nr(i,n,s,l,x)|0,!f)){pe=ba(y,x)|0,Fe=((pe|0)<0)<<31>>31,A[y>>2]=0,A[y+4>>2]=0,A[y+8>>2]=0,A[x>>2]=0,A[x+4>>2]=0,A[x+8>>2]=0,Nr(i,n,i,n,y)|0&&_t(23313,23090,691,23299),Nr(i,n,s,l,x)|0&&_t(23313,23090,696,23299),po(y),po(x),pe?(G=A[y>>2]|0,Q=+(pe|0),ge=y+4|0,N=A[ge>>2]|0,oe=y+8|0,Z=A[oe>>2]|0,fe=y,l=G,f=N,s=Z,ee=+((A[x>>2]|0)-G|0)/Q,he=+((A[x+4>>2]|0)-N|0)/Q,Q=+((A[x+8>>2]|0)-Z|0)/Q):(f=y+4|0,s=y+8|0,ge=f,oe=s,fe=y,l=A[y>>2]|0,f=A[f>>2]|0,s=A[s>>2]|0,ee=0,he=0,Q=0),A[Me>>2]=l,Z=Me+4|0,A[Z>>2]=f,N=Me+8|0,A[N>>2]=s;e:do if((pe|0)<0)f=0;else for(z=0,G=0,f=l;;){C=+(G>>>0)+4294967296*+(z|0),Ce=ee*C+ +(f|0),S=he*C+ +(A[ge>>2]|0),C=Q*C+ +(A[oe>>2]|0),s=~~+a(+Ce),y=~~+a(+S),f=~~+a(+C),Ce=+ot(+(+(s|0)-Ce)),S=+ot(+(+(y|0)-S)),C=+ot(+(+(f|0)-C));do if(Ce>S&Ce>C)s=0-(y+f)|0,l=y;else if(x=0-s|0,S>C){l=x-f|0;break}else{l=y,f=x-y|0;break}while(!1);if(A[Me>>2]=s,A[Z>>2]=l,A[N>>2]=f,ka(Me),f=Cn(i,n,Me,c+(G<<3)|0)|0,f|0)break e;if(!((z|0)<(Fe|0)|(z|0)==(Fe|0)&G>>>0<pe>>>0)){f=0;break e}f=yt(G|0,z|0,1,0)|0,x=ne()|0,z=x,G=f,f=A[fe>>2]|0}while(!1);return Me=f,J=Pe,Me|0}return Me=f,J=Pe,Me|0}function Gn(i,n,s,l){i=i|0,n=n|0,s=s|0,l=l|0;var c=0,f=0,y=0;if((s|0)==0&(l|0)==0)return c=0,f=1,St(c|0),f|0;f=i,c=n,i=1,n=0;do y=(s&1|0)==0&!0,i=Qi((y?1:f)|0,(y?0:c)|0,i|0,n|0)|0,n=ne()|0,s=aa(s|0,l|0,1)|0,l=ne()|0,f=Qi(f|0,c|0,f|0,c|0)|0,c=ne()|0;while(!((s|0)==0&(l|0)==0));return St(n|0),i|0}function sa(i,n,s){i=i|0,n=n|0,s=s|0;var l=0,c=0,f=0,y=0,x=0,S=0,C=0,z=0,G=0,N=0;if(!(Ps(n,s)|0)||(n=uo(n)|0,l=+H[s>>3],c=+H[s+8>>3],c=n&c<0?c+6.283185307179586:c,N=A[i>>2]|0,(N|0)<=0))return N=0,N|0;if(G=A[i+4>>2]|0,n){n=0,z=c,s=-1,i=0;e:for(;;){for(C=i;y=+H[G+(C<<4)>>3],c=+H[G+(C<<4)+8>>3],i=(s+2|0)%(N|0)|0,f=+H[G+(i<<4)>>3],x=+H[G+(i<<4)+8>>3],y>f?(S=y,y=x):(S=f,f=y,y=c,c=x),l=l==f|l==S?l+2220446049250313e-31:l,!!(l<f|l>S);)if(s=C+1|0,(s|0)>=(N|0)){s=22;break e}else i=C,C=s,s=i;if(x=y<0?y+6.283185307179586:y,y=c<0?c+6.283185307179586:c,z=x==z|y==z?z+-2220446049250313e-31:z,S=x+(y-x)*((l-f)/(S-f)),(S<0?S+6.283185307179586:S)>z&&(n=n^1),i=C+1|0,(i|0)>=(N|0)){s=22;break}else s=C}if((s|0)==22)return n|0}else{n=0,z=c,s=-1,i=0;e:for(;;){for(C=i;y=+H[G+(C<<4)>>3],c=+H[G+(C<<4)+8>>3],i=(s+2|0)%(N|0)|0,f=+H[G+(i<<4)>>3],x=+H[G+(i<<4)+8>>3],y>f?(S=y,y=x):(S=f,f=y,y=c,c=x),l=l==f|l==S?l+2220446049250313e-31:l,!!(l<f|l>S);)if(s=C+1|0,(s|0)>=(N|0)){s=22;break e}else i=C,C=s,s=i;if(z=y==z|c==z?z+-2220446049250313e-31:z,y+(c-y)*((l-f)/(S-f))>z&&(n=n^1),i=C+1|0,(i|0)>=(N|0)){s=22;break}else s=C}if((s|0)==22)return n|0}return 0}function Ra(i,n){i=i|0,n=n|0;var s=0,l=0,c=0,f=0,y=0,x=0,S=0,C=0,z=0,G=0,N=0,Z=0,Q=0,ee=0,he=0,ge=0,oe=0;if(Q=A[i>>2]|0,!Q){A[n>>2]=0,A[n+4>>2]=0,A[n+8>>2]=0,A[n+12>>2]=0,A[n+16>>2]=0,A[n+20>>2]=0,A[n+24>>2]=0,A[n+28>>2]=0;return}if(ee=n+8|0,H[ee>>3]=17976931348623157e292,he=n+24|0,H[he>>3]=17976931348623157e292,H[n>>3]=-17976931348623157e292,ge=n+16|0,H[ge>>3]=-17976931348623157e292,!((Q|0)<=0)){for(N=A[i+4>>2]|0,C=17976931348623157e292,z=-17976931348623157e292,G=0,i=-1,f=17976931348623157e292,y=17976931348623157e292,S=-17976931348623157e292,l=-17976931348623157e292,Z=0;s=+H[N+(Z<<4)>>3],x=+H[N+(Z<<4)+8>>3],i=i+2|0,c=+H[N+(((i|0)==(Q|0)?0:i)<<4)+8>>3],s<f&&(H[ee>>3]=s,f=s),x<y&&(H[he>>3]=x,y=x),s>S?H[n>>3]=s:s=S,x>l&&(H[ge>>3]=x,l=x),C=x>0&x<C?x:C,z=x<0&x>z?x:z,G=G|+ot(+(x-c))>3.141592653589793,i=Z+1|0,(i|0)!=(Q|0);)oe=Z,S=s,Z=i,i=oe;G&&(H[ge>>3]=z,H[he>>3]=C)}}function bl(i,n){i=i|0,n=n|0;var s=0,l=0,c=0,f=0,y=0,x=0,S=0,C=0,z=0,G=0,N=0,Z=0,Q=0,ee=0,he=0,ge=0,oe=0,fe=0,pe=0,Fe=0,Me=0,Pe=0;if(Q=A[i>>2]|0,Q){if(ee=n+8|0,H[ee>>3]=17976931348623157e292,he=n+24|0,H[he>>3]=17976931348623157e292,H[n>>3]=-17976931348623157e292,ge=n+16|0,H[ge>>3]=-17976931348623157e292,(Q|0)>0){for(c=A[i+4>>2]|0,N=17976931348623157e292,Z=-17976931348623157e292,l=0,s=-1,S=17976931348623157e292,C=17976931348623157e292,G=-17976931348623157e292,y=-17976931348623157e292,oe=0;f=+H[c+(oe<<4)>>3],z=+H[c+(oe<<4)+8>>3],Me=s+2|0,x=+H[c+(((Me|0)==(Q|0)?0:Me)<<4)+8>>3],f<S&&(H[ee>>3]=f,S=f),z<C&&(H[he>>3]=z,C=z),f>G?H[n>>3]=f:f=G,z>y&&(H[ge>>3]=z,y=z),N=z>0&z<N?z:N,Z=z<0&z>Z?z:Z,l=l|+ot(+(z-x))>3.141592653589793,s=oe+1|0,(s|0)!=(Q|0);)Me=oe,G=f,oe=s,s=Me;l&&(H[ge>>3]=Z,H[he>>3]=N)}}else A[n>>2]=0,A[n+4>>2]=0,A[n+8>>2]=0,A[n+12>>2]=0,A[n+16>>2]=0,A[n+20>>2]=0,A[n+24>>2]=0,A[n+28>>2]=0;if(Me=i+8|0,s=A[Me>>2]|0,!((s|0)<=0)){Fe=i+12|0,pe=0;do if(c=A[Fe>>2]|0,l=pe,pe=pe+1|0,he=n+(pe<<5)|0,ge=A[c+(l<<3)>>2]|0,ge){if(oe=n+(pe<<5)+8|0,H[oe>>3]=17976931348623157e292,i=n+(pe<<5)+24|0,H[i>>3]=17976931348623157e292,H[he>>3]=-17976931348623157e292,fe=n+(pe<<5)+16|0,H[fe>>3]=-17976931348623157e292,(ge|0)>0){for(Q=A[c+(l<<3)+4>>2]|0,N=17976931348623157e292,Z=-17976931348623157e292,c=0,l=-1,ee=0,S=17976931348623157e292,C=17976931348623157e292,z=-17976931348623157e292,y=-17976931348623157e292;f=+H[Q+(ee<<4)>>3],G=+H[Q+(ee<<4)+8>>3],l=l+2|0,x=+H[Q+(((l|0)==(ge|0)?0:l)<<4)+8>>3],f<S&&(H[oe>>3]=f,S=f),G<C&&(H[i>>3]=G,C=G),f>z?H[he>>3]=f:f=z,G>y&&(H[fe>>3]=G,y=G),N=G>0&G<N?G:N,Z=G<0&G>Z?G:Z,c=c|+ot(+(G-x))>3.141592653589793,l=ee+1|0,(l|0)!=(ge|0);)Pe=ee,ee=l,z=f,l=Pe;c&&(H[fe>>3]=Z,H[i>>3]=N)}}else A[he>>2]=0,A[he+4>>2]=0,A[he+8>>2]=0,A[he+12>>2]=0,A[he+16>>2]=0,A[he+20>>2]=0,A[he+24>>2]=0,A[he+28>>2]=0,s=A[Me>>2]|0;while((pe|0)<(s|0))}}function wl(i,n,s){i=i|0,n=n|0,s=s|0;var l=0,c=0,f=0;if(!(sa(i,n,s)|0))return c=0,c|0;if(c=i+8|0,(A[c>>2]|0)<=0)return c=1,c|0;for(l=i+12|0,i=0;;){if(f=i,i=i+1|0,sa((A[l>>2]|0)+(f<<3)|0,n+(i<<5)|0,s)|0){i=0,l=6;break}if((i|0)>=(A[c>>2]|0)){i=1,l=6;break}}return(l|0)==6?i|0:0}function eA(){return 8}function Fa(){return 16}function Oa(){return 168}function Va(){return 8}function Na(){return 16}function _r(){return 12}function jn(){return 8}function ko(i){return i=i|0,+(+((A[i>>2]|0)>>>0)+4294967296*+(A[i+4>>2]|0))}function Ua(i){i=i|0;var n=0,s=0;return s=+H[i>>3],n=+H[i+8>>3],+ +At(+(s*s+n*n))}function Qs(i,n,s,l,c){i=i|0,n=n|0,s=s|0,l=l|0,c=c|0;var f=0,y=0,x=0,S=0,C=0,z=0,G=0,N=0;C=+H[i>>3],S=+H[n>>3]-C,x=+H[i+8>>3],y=+H[n+8>>3]-x,G=+H[s>>3],f=+H[l>>3]-G,N=+H[s+8>>3],z=+H[l+8>>3]-N,f=(f*(x-N)-(C-G)*z)/(S*z-y*f),H[c>>3]=C+S*f,H[c+8>>3]=x+y*f}function oa(i,n){return i=i|0,n=n|0,+ot(+(+H[i>>3]-+H[n>>3]))<11920928955078125e-23?(n=+ot(+(+H[i+8>>3]-+H[n+8>>3]))<11920928955078125e-23,n|0):(n=0,n|0)}function Pi(i,n){i=i|0,n=n|0;var s=0,l=0,c=0;return c=+H[i>>3]-+H[n>>3],l=+H[i+8>>3]-+H[n+8>>3],s=+H[i+16>>3]-+H[n+16>>3],+(c*c+l*l+s*s)}function Tr(i,n){i=i|0,n=n|0;var s=0,l=0,c=0;s=+H[i>>3],l=+Et(+s),s=+gt(+s),H[n+16>>3]=s,s=+H[i+8>>3],c=l*+Et(+s),H[n>>3]=c,s=l*+gt(+s),H[n+8>>3]=s}function yi(i,n,s){i=i|0,n=n|0,s=s|0;var l=0,c=0,f=0;if(f=J,J=J+16|0,c=f,l=ai(i,n)|0,(s+-1|0)>>>0>5||(l=(l|0)!=0,(s|0)==1&l))return c=-1,J=f,c|0;do if(qn(i,n,c)|0)l=-1;else if(l){l=((A[21936+(s<<2)>>2]|0)+5-(A[c>>2]|0)|0)%5|0;break}else{l=((A[21968+(s<<2)>>2]|0)+6-(A[c>>2]|0)|0)%6|0;break}while(!1);return c=l,J=f,c|0}function qn(i,n,s){i=i|0,n=n|0,s=s|0;var l=0,c=0,f=0,y=0,x=0,S=0,C=0;if(C=J,J=J+32|0,y=C+16|0,x=C,l=Ai(i,n,y)|0,l|0)return s=l,J=C,s|0;f=Ko(i,n)|0,S=ur(i,n)|0,al(f,x),l=ga(f,A[y>>2]|0)|0;e:do if(ci(f)|0){do switch(f|0){case 4:{i=0;break}case 14:{i=1;break}case 24:{i=2;break}case 38:{i=3;break}case 49:{i=4;break}case 58:{i=5;break}case 63:{i=6;break}case 72:{i=7;break}case 83:{i=8;break}case 97:{i=9;break}case 107:{i=10;break}case 117:{i=11;break}default:{l=1;break e}}while(!1);if(c=A[22e3+(i*24|0)+8>>2]|0,n=A[22e3+(i*24|0)+16>>2]|0,i=A[y>>2]|0,(i|0)!=(A[x>>2]|0)&&(x=$o(f)|0,i=A[y>>2]|0,x|(i|0)==(n|0)&&(l=(l+1|0)%6|0)),(S|0)==3&(i|0)==(n|0)){l=(l+5|0)%6|0,c=22;break}(S|0)==5&(i|0)==(c|0)&&(l=(l+1|0)%6|0),c=22}else c=22;while(!1);return(c|0)==22&&(A[s>>2]=l,l=0),s=l,J=C,s|0}function yr(i,n,s,l){i=i|0,n=n|0,s=s|0,l=l|0;var c=0,f=0,y=0,x=0,S=0,C=0,z=0,G=0,N=0,Z=0,Q=0,ee=0,he=0,ge=0,oe=0,fe=0;if(fe=J,J=J+32|0,oe=fe+24|0,he=fe+20|0,Q=fe+8|0,Z=fe+16|0,N=fe,S=(ai(i,n)|0)==0,S=S?6:5,z=Ge(i|0,n|0,52)|0,ne()|0,z=z&15,S>>>0<=s>>>0)return l=2,J=fe,l|0;G=(z|0)==0,!G&&(ee=Oe(7,0,(z^15)*3|0)|0,(ee&i|0)==0&((ne()|0)&n|0)==0)?c=s:f=4;e:do if((f|0)==4){if(c=(ai(i,n)|0)!=0,((c?4:5)|0)<(s|0)||qn(i,n,oe)|0||(f=(A[oe>>2]|0)+s|0,c?c=22288+(((f|0)%5|0)<<2)|0:c=22320+(((f|0)%6|0)<<2)|0,ee=A[c>>2]|0,(ee|0)==7))return l=1,J=fe,l|0;A[he>>2]=0,c=zi(i,n,ee,he,Q)|0;do if(!c){if(x=Q,C=A[x>>2]|0,x=A[x+4>>2]|0,y=x>>>0<n>>>0|(x|0)==(n|0)&C>>>0<i>>>0,f=y?C:i,y=y?x:n,!G&&(G=Oe(7,0,(z^15)*3|0)|0,(C&G|0)==0&(x&(ne()|0)|0)==0))c=s;else{if(x=(s+-1+S|0)%(S|0)|0,c=ai(i,n)|0,(x|0)<0&&_t(23313,23315,245,23324),S=(c|0)!=0,((S?4:5)|0)<(x|0)&&_t(23313,23315,245,23324),qn(i,n,oe)|0&&_t(23313,23315,245,23324),c=(A[oe>>2]|0)+x|0,S?c=22288+(((c|0)%5|0)<<2)|0:c=22320+(((c|0)%6|0)<<2)|0,x=A[c>>2]|0,(x|0)==7&&_t(23313,23315,245,23324),A[Z>>2]=0,c=zi(i,n,x,Z,N)|0,c|0)break;C=N,S=A[C>>2]|0,C=A[C+4>>2]|0;do if(C>>>0<y>>>0|(C|0)==(y|0)&S>>>0<f>>>0){if(ai(S,C)|0?f=ss(S,C,i,n)|0:f=A[22384+((((A[Z>>2]|0)+(A[22352+(x<<2)>>2]|0)|0)%6|0)<<2)>>2]|0,c=ai(S,C)|0,(f+-1|0)>>>0>5){c=-1,f=S,y=C;break}if(c=(c|0)!=0,(f|0)==1&c){c=-1,f=S,y=C;break}do if(qn(S,C,oe)|0)c=-1;else if(c){c=((A[21936+(f<<2)>>2]|0)+5-(A[oe>>2]|0)|0)%5|0;break}else{c=((A[21968+(f<<2)>>2]|0)+6-(A[oe>>2]|0)|0)%6|0;break}while(!1);f=S,y=C}else c=s;while(!1);x=Q,C=A[x>>2]|0,x=A[x+4>>2]|0}if((f|0)==(C|0)&(y|0)==(x|0)){if(S=(ai(C,x)|0)!=0,S?i=ss(C,x,i,n)|0:i=A[22384+((((A[he>>2]|0)+(A[22352+(ee<<2)>>2]|0)|0)%6|0)<<2)>>2]|0,c=ai(C,x)|0,(i+-1|0)>>>0<=5&&(ge=(c|0)!=0,!((i|0)==1&ge)))do if(qn(C,x,oe)|0)c=-1;else if(ge){c=((A[21936+(i<<2)>>2]|0)+5-(A[oe>>2]|0)|0)%5|0;break}else{c=((A[21968+(i<<2)>>2]|0)+6-(A[oe>>2]|0)|0)%6|0;break}while(!1);else c=-1;c=c+1|0,c=(c|0)==6|S&(c|0)==5?0:c}n=y,i=f;break e}while(!1);return l=c,J=fe,l|0}while(!1);return ge=Oe(c|0,0,56)|0,oe=ne()|0|n&-2130706433|536870912,A[l>>2]=ge|i,A[l+4>>2]=oe,l=0,J=fe,l|0}function kl(i,n,s){i=i|0,n=n|0,s=s|0;var l=0,c=0,f=0;return f=(ai(i,n)|0)==0,l=yr(i,n,0,s)|0,c=(l|0)==0,f?!c||(l=yr(i,n,1,s+8|0)|0,l|0)||(l=yr(i,n,2,s+16|0)|0,l|0)||(l=yr(i,n,3,s+24|0)|0,l|0)||(l=yr(i,n,4,s+32|0)|0,l)?(f=l,f|0):yr(i,n,5,s+40|0)|0:!c||(l=yr(i,n,1,s+8|0)|0,l|0)||(l=yr(i,n,2,s+16|0)|0,l|0)||(l=yr(i,n,3,s+24|0)|0,l|0)||(l=yr(i,n,4,s+32|0)|0,l|0)?(f=l,f|0):(f=s+40|0,A[f>>2]=0,A[f+4>>2]=0,f=0,f|0)}function El(i,n,s){i=i|0,n=n|0,s=s|0;var l=0,c=0,f=0,y=0,x=0,S=0;return S=J,J=J+192|0,c=S,f=S+168|0,y=Ge(i|0,n|0,56)|0,ne()|0,y=y&7,x=n&-2130706433|134217728,l=Ai(i,x,f)|0,l|0?(x=l,J=S,x|0):(n=Ge(i|0,n|0,52)|0,ne()|0,n=n&15,ai(i,x)|0?Ia(f,n,y,1,c):fi(f,n,y,1,c),x=c+8|0,A[s>>2]=A[x>>2],A[s+4>>2]=A[x+4>>2],A[s+8>>2]=A[x+8>>2],A[s+12>>2]=A[x+12>>2],x=0,J=S,x|0)}function Sl(i,n){i=i|0,n=n|0;var s=0,l=0,c=0,f=0;return c=J,J=J+16|0,s=c,!(!0&(n&2013265920|0)==536870912)||(l=n&-2130706433|134217728,!(Fs(i,l)|0))?(l=0,J=c,l|0):(f=Ge(i|0,n|0,56)|0,ne()|0,f=(yr(i,l,f&7,s)|0)==0,l=s,l=f&((A[l>>2]|0)==(i|0)?(A[l+4>>2]|0)==(n|0):0)&1,J=c,l|0)}function Tl(i,n,s){i=i|0,n=n|0,s=s|0;var l=0;(n|0)>0?(l=ar(n,4)|0,A[i>>2]=l,l||_t(23337,23360,40,23374)):A[i>>2]=0,A[i+4>>2]=n,A[i+8>>2]=0,A[i+12>>2]=s}function or(i){i=i|0;var n=0,s=0,l=0,c=0,f=0,y=0,x=0;c=i+4|0,f=i+12|0,y=i+8|0;e:for(;;){for(s=A[c>>2]|0,n=0;;){if((n|0)>=(s|0))break e;if(l=A[i>>2]|0,x=A[l+(n<<2)>>2]|0,!x)n=n+1|0;else break}n=l+(~~(+ot(+(+Si(10,+ +(15-(A[f>>2]|0)|0))*(+H[x>>3]+ +H[x+8>>3])))%+(s|0))>>>0<<2)|0,s=A[n>>2]|0;t:do if(s|0){if(l=x+32|0,(s|0)==(x|0))A[n>>2]=A[l>>2];else{if(s=s+32|0,n=A[s>>2]|0,!n)break;for(;(n|0)!=(x|0);)if(s=n+32|0,n=A[s>>2]|0,!n)break t;A[s>>2]=A[l>>2]}Ct(x),A[y>>2]=(A[y>>2]|0)+-1}while(!1)}Ct(A[i>>2]|0)}function Eo(i){i=i|0;var n=0,s=0,l=0;for(l=A[i+4>>2]|0,s=0;;){if((s|0)>=(l|0)){n=0,s=4;break}if(n=A[(A[i>>2]|0)+(s<<2)>>2]|0,!n)s=s+1|0;else{s=4;break}}return(s|0)==4?n|0:0}function ht(i,n){i=i|0,n=n|0;var s=0,l=0,c=0,f=0;if(s=~~(+ot(+(+Si(10,+ +(15-(A[i+12>>2]|0)|0))*(+H[n>>3]+ +H[n+8>>3])))%+(A[i+4>>2]|0))>>>0,s=(A[i>>2]|0)+(s<<2)|0,l=A[s>>2]|0,!l)return f=1,f|0;f=n+32|0;do if((l|0)!=(n|0)){if(s=A[l+32>>2]|0,!s)return f=1,f|0;for(c=s;;){if((c|0)==(n|0)){c=8;break}if(s=A[c+32>>2]|0,s)l=c,c=s;else{s=1,c=10;break}}if((c|0)==8){A[l+32>>2]=A[f>>2];break}else if((c|0)==10)return s|0}else A[s>>2]=A[f>>2];while(!1);return Ct(n),f=i+8|0,A[f>>2]=(A[f>>2]|0)+-1,f=0,f|0}function wt(i,n,s){i=i|0,n=n|0,s=s|0;var l=0,c=0,f=0,y=0;f=Bi(40)|0,f||_t(23390,23360,98,23403),A[f>>2]=A[n>>2],A[f+4>>2]=A[n+4>>2],A[f+8>>2]=A[n+8>>2],A[f+12>>2]=A[n+12>>2],c=f+16|0,A[c>>2]=A[s>>2],A[c+4>>2]=A[s+4>>2],A[c+8>>2]=A[s+8>>2],A[c+12>>2]=A[s+12>>2],A[f+32>>2]=0,c=~~(+ot(+(+Si(10,+ +(15-(A[i+12>>2]|0)|0))*(+H[n>>3]+ +H[n+8>>3])))%+(A[i+4>>2]|0))>>>0,c=(A[i>>2]|0)+(c<<2)|0,l=A[c>>2]|0;do if(!l)A[c>>2]=f;else{for(;!(As(l,n)|0&&As(l+16|0,s)|0);)if(c=A[l+32>>2]|0,l=c|0?c:l,!(A[l+32>>2]|0)){y=10;break}if((y|0)==10){A[l+32>>2]=f;break}return Ct(f),y=l,y|0}while(!1);return y=i+8|0,A[y>>2]=(A[y>>2]|0)+1,y=f,y|0}function So(i,n,s){i=i|0,n=n|0,s=s|0;var l=0,c=0;if(c=~~(+ot(+(+Si(10,+ +(15-(A[i+12>>2]|0)|0))*(+H[n>>3]+ +H[n+8>>3])))%+(A[i+4>>2]|0))>>>0,c=A[(A[i>>2]|0)+(c<<2)>>2]|0,!c)return s=0,s|0;if(!s){for(i=c;;){if(As(i,n)|0){l=10;break}if(i=A[i+32>>2]|0,!i){i=0,l=10;break}}if((l|0)==10)return i|0}for(i=c;;){if(As(i,n)|0&&As(i+16|0,s)|0){l=10;break}if(i=A[i+32>>2]|0,!i){i=0,l=10;break}}return(l|0)==10?i|0:0}function Ga(i,n){i=i|0,n=n|0;var s=0;if(s=~~(+ot(+(+Si(10,+ +(15-(A[i+12>>2]|0)|0))*(+H[n>>3]+ +H[n+8>>3])))%+(A[i+4>>2]|0))>>>0,i=A[(A[i>>2]|0)+(s<<2)>>2]|0,!i)return s=0,s|0;for(;;){if(As(i,n)|0){n=5;break}if(i=A[i+32>>2]|0,!i){i=0,n=5;break}}return(n|0)==5?i|0:0}function ja(){return 23424}function Di(i){return i=+i,+ +b(+i)}function fn(i){return i=+i,~~+Di(i)|0}function Bi(i){i=i|0;var n=0,s=0,l=0,c=0,f=0,y=0,x=0,S=0,C=0,z=0,G=0,N=0,Z=0,Q=0,ee=0,he=0,ge=0,oe=0,fe=0,pe=0,Fe=0;Fe=J,J=J+16|0,N=Fe;do if(i>>>0<245){if(C=i>>>0<11?16:i+11&-8,i=C>>>3,G=A[5857]|0,s=G>>>i,s&3|0)return n=(s&1^1)+i|0,i=23468+(n<<1<<2)|0,s=i+8|0,l=A[s>>2]|0,c=l+8|0,f=A[c>>2]|0,(f|0)==(i|0)?A[5857]=G&~(1<<n):(A[f+12>>2]=i,A[s>>2]=f),pe=n<<3,A[l+4>>2]=pe|3,pe=l+pe+4|0,A[pe>>2]=A[pe>>2]|1,pe=c,J=Fe,pe|0;if(z=A[5859]|0,C>>>0>z>>>0){if(s|0)return n=2<<i,n=s<<i&(n|0-n),n=(n&0-n)+-1|0,x=n>>>12&16,n=n>>>x,s=n>>>5&8,n=n>>>s,f=n>>>2&4,n=n>>>f,i=n>>>1&2,n=n>>>i,l=n>>>1&1,l=(s|x|f|i|l)+(n>>>l)|0,n=23468+(l<<1<<2)|0,i=n+8|0,f=A[i>>2]|0,x=f+8|0,s=A[x>>2]|0,(s|0)==(n|0)?(i=G&~(1<<l),A[5857]=i):(A[s+12>>2]=n,A[i>>2]=s,i=G),pe=l<<3,y=pe-C|0,A[f+4>>2]=C|3,c=f+C|0,A[c+4>>2]=y|1,A[f+pe>>2]=y,z|0&&(l=A[5862]|0,n=z>>>3,s=23468+(n<<1<<2)|0,n=1<<n,i&n?(i=s+8|0,n=A[i>>2]|0):(A[5857]=i|n,n=s,i=s+8|0),A[i>>2]=l,A[n+12>>2]=l,A[l+8>>2]=n,A[l+12>>2]=s),A[5859]=y,A[5862]=c,pe=x,J=Fe,pe|0;if(f=A[5858]|0,f){for(s=(f&0-f)+-1|0,c=s>>>12&16,s=s>>>c,l=s>>>5&8,s=s>>>l,y=s>>>2&4,s=s>>>y,x=s>>>1&2,s=s>>>x,S=s>>>1&1,S=A[23732+((l|c|y|x|S)+(s>>>S)<<2)>>2]|0,s=S,x=S,S=(A[S+4>>2]&-8)-C|0;i=A[s+16>>2]|0,!(!i&&(i=A[s+20>>2]|0,!i));)y=(A[i+4>>2]&-8)-C|0,c=y>>>0<S>>>0,s=i,x=c?i:x,S=c?y:S;if(y=x+C|0,y>>>0>x>>>0){c=A[x+24>>2]|0,n=A[x+12>>2]|0;do if((n|0)==(x|0)){if(i=x+20|0,n=A[i>>2]|0,!n&&(i=x+16|0,n=A[i>>2]|0,!n)){s=0;break}for(;;)if(l=n+20|0,s=A[l>>2]|0,s)n=s,i=l;else if(l=n+16|0,s=A[l>>2]|0,s)n=s,i=l;else break;A[i>>2]=0,s=n}else s=A[x+8>>2]|0,A[s+12>>2]=n,A[n+8>>2]=s,s=n;while(!1);do if(c|0){if(n=A[x+28>>2]|0,i=23732+(n<<2)|0,(x|0)==(A[i>>2]|0)){if(A[i>>2]=s,!s){A[5858]=f&~(1<<n);break}}else if(pe=c+16|0,A[((A[pe>>2]|0)==(x|0)?pe:c+20|0)>>2]=s,!s)break;A[s+24>>2]=c,n=A[x+16>>2]|0,n|0&&(A[s+16>>2]=n,A[n+24>>2]=s),n=A[x+20>>2]|0,n|0&&(A[s+20>>2]=n,A[n+24>>2]=s)}while(!1);return S>>>0<16?(pe=S+C|0,A[x+4>>2]=pe|3,pe=x+pe+4|0,A[pe>>2]=A[pe>>2]|1):(A[x+4>>2]=C|3,A[y+4>>2]=S|1,A[y+S>>2]=S,z|0&&(l=A[5862]|0,n=z>>>3,s=23468+(n<<1<<2)|0,n=1<<n,n&G?(i=s+8|0,n=A[i>>2]|0):(A[5857]=n|G,n=s,i=s+8|0),A[i>>2]=l,A[n+12>>2]=l,A[l+8>>2]=n,A[l+12>>2]=s),A[5859]=S,A[5862]=y),pe=x+8|0,J=Fe,pe|0}else G=C}else G=C}else G=C}else if(i>>>0<=4294967231)if(i=i+11|0,C=i&-8,l=A[5858]|0,l){c=0-C|0,i=i>>>8,i?C>>>0>16777215?S=31:(G=(i+1048320|0)>>>16&8,ee=i<<G,x=(ee+520192|0)>>>16&4,ee=ee<<x,S=(ee+245760|0)>>>16&2,S=14-(x|G|S)+(ee<<S>>>15)|0,S=C>>>(S+7|0)&1|S<<1):S=0,s=A[23732+(S<<2)>>2]|0;e:do if(!s)s=0,i=0,ee=61;else for(i=0,x=C<<((S|0)==31?0:25-(S>>>1)|0),f=0;;){if(y=(A[s+4>>2]&-8)-C|0,y>>>0<c>>>0)if(y)i=s,c=y;else{i=s,c=0,ee=65;break e}if(ee=A[s+20>>2]|0,s=A[s+16+(x>>>31<<2)>>2]|0,f=(ee|0)==0|(ee|0)==(s|0)?f:ee,s)x=x<<1;else{s=f,ee=61;break}}while(!1);if((ee|0)==61){if((s|0)==0&(i|0)==0){if(i=2<<S,i=(i|0-i)&l,!i){G=C;break}G=(i&0-i)+-1|0,y=G>>>12&16,G=G>>>y,f=G>>>5&8,G=G>>>f,x=G>>>2&4,G=G>>>x,S=G>>>1&2,G=G>>>S,s=G>>>1&1,i=0,s=A[23732+((f|y|x|S|s)+(G>>>s)<<2)>>2]|0}s?ee=65:(x=i,y=c)}if((ee|0)==65)for(f=s;;)if(G=(A[f+4>>2]&-8)-C|0,s=G>>>0<c>>>0,c=s?G:c,i=s?f:i,s=A[f+16>>2]|0,s||(s=A[f+20>>2]|0),s)f=s;else{x=i,y=c;break}if(x|0&&y>>>0<((A[5859]|0)-C|0)>>>0&&(z=x+C|0,z>>>0>x>>>0)){f=A[x+24>>2]|0,n=A[x+12>>2]|0;do if((n|0)==(x|0)){if(i=x+20|0,n=A[i>>2]|0,!n&&(i=x+16|0,n=A[i>>2]|0,!n)){n=0;break}for(;;)if(c=n+20|0,s=A[c>>2]|0,s)n=s,i=c;else if(c=n+16|0,s=A[c>>2]|0,s)n=s,i=c;else break;A[i>>2]=0}else pe=A[x+8>>2]|0,A[pe+12>>2]=n,A[n+8>>2]=pe;while(!1);do if(f){if(i=A[x+28>>2]|0,s=23732+(i<<2)|0,(x|0)==(A[s>>2]|0)){if(A[s>>2]=n,!n){l=l&~(1<<i),A[5858]=l;break}}else if(pe=f+16|0,A[((A[pe>>2]|0)==(x|0)?pe:f+20|0)>>2]=n,!n)break;A[n+24>>2]=f,i=A[x+16>>2]|0,i|0&&(A[n+16>>2]=i,A[i+24>>2]=n),i=A[x+20>>2]|0,i&&(A[n+20>>2]=i,A[i+24>>2]=n)}while(!1);e:do if(y>>>0<16)pe=y+C|0,A[x+4>>2]=pe|3,pe=x+pe+4|0,A[pe>>2]=A[pe>>2]|1;else{if(A[x+4>>2]=C|3,A[z+4>>2]=y|1,A[z+y>>2]=y,n=y>>>3,y>>>0<256){s=23468+(n<<1<<2)|0,i=A[5857]|0,n=1<<n,i&n?(i=s+8|0,n=A[i>>2]|0):(A[5857]=i|n,n=s,i=s+8|0),A[i>>2]=z,A[n+12>>2]=z,A[z+8>>2]=n,A[z+12>>2]=s;break}if(n=y>>>8,n?y>>>0>16777215?s=31:(fe=(n+1048320|0)>>>16&8,pe=n<<fe,oe=(pe+520192|0)>>>16&4,pe=pe<<oe,s=(pe+245760|0)>>>16&2,s=14-(oe|fe|s)+(pe<<s>>>15)|0,s=y>>>(s+7|0)&1|s<<1):s=0,n=23732+(s<<2)|0,A[z+28>>2]=s,i=z+16|0,A[i+4>>2]=0,A[i>>2]=0,i=1<<s,!(l&i)){A[5858]=l|i,A[n>>2]=z,A[z+24>>2]=n,A[z+12>>2]=z,A[z+8>>2]=z;break}n=A[n>>2]|0;t:do if((A[n+4>>2]&-8|0)!=(y|0)){for(l=y<<((s|0)==31?0:25-(s>>>1)|0);s=n+16+(l>>>31<<2)|0,i=A[s>>2]|0,!!i;)if((A[i+4>>2]&-8|0)==(y|0)){n=i;break t}else l=l<<1,n=i;A[s>>2]=z,A[z+24>>2]=n,A[z+12>>2]=z,A[z+8>>2]=z;break e}while(!1);fe=n+8|0,pe=A[fe>>2]|0,A[pe+12>>2]=z,A[fe>>2]=z,A[z+8>>2]=pe,A[z+12>>2]=n,A[z+24>>2]=0}while(!1);return pe=x+8|0,J=Fe,pe|0}else G=C}else G=C;else G=-1;while(!1);if(s=A[5859]|0,s>>>0>=G>>>0)return n=s-G|0,i=A[5862]|0,n>>>0>15?(pe=i+G|0,A[5862]=pe,A[5859]=n,A[pe+4>>2]=n|1,A[i+s>>2]=n,A[i+4>>2]=G|3):(A[5859]=0,A[5862]=0,A[i+4>>2]=s|3,pe=i+s+4|0,A[pe>>2]=A[pe>>2]|1),pe=i+8|0,J=Fe,pe|0;if(y=A[5860]|0,y>>>0>G>>>0)return oe=y-G|0,A[5860]=oe,pe=A[5863]|0,fe=pe+G|0,A[5863]=fe,A[fe+4>>2]=oe|1,A[pe+4>>2]=G|3,pe=pe+8|0,J=Fe,pe|0;if(A[5975]|0?i=A[5977]|0:(A[5977]=4096,A[5976]=4096,A[5978]=-1,A[5979]=-1,A[5980]=0,A[5968]=0,A[5975]=N&-16^1431655768,i=4096),x=G+48|0,S=G+47|0,f=i+S|0,c=0-i|0,C=f&c,C>>>0<=G>>>0||(i=A[5967]|0,i|0&&(z=A[5965]|0,N=z+C|0,N>>>0<=z>>>0|N>>>0>i>>>0)))return pe=0,J=Fe,pe|0;e:do if(A[5968]&4)n=0,ee=143;else{s=A[5863]|0;t:do if(s){for(l=23876;N=A[l>>2]|0,!(N>>>0<=s>>>0&&(N+(A[l+4>>2]|0)|0)>>>0>s>>>0);)if(i=A[l+8>>2]|0,i)l=i;else{ee=128;break t}if(n=f-y&c,n>>>0<2147483647)if(i=M(n|0)|0,(i|0)==((A[l>>2]|0)+(A[l+4>>2]|0)|0)){if((i|0)!=-1){y=n,f=i,ee=145;break e}}else l=i,ee=136;else n=0}else ee=128;while(!1);do if((ee|0)==128)if(s=M(0)|0,(s|0)!=-1&&(n=s,Z=A[5976]|0,Q=Z+-1|0,n=(Q&n|0?(Q+n&0-Z)-n|0:0)+C|0,Z=A[5965]|0,Q=n+Z|0,n>>>0>G>>>0&n>>>0<2147483647)){if(N=A[5967]|0,N|0&&Q>>>0<=Z>>>0|Q>>>0>N>>>0){n=0;break}if(i=M(n|0)|0,(i|0)==(s|0)){y=n,f=s,ee=145;break e}else l=i,ee=136}else n=0;while(!1);do if((ee|0)==136){if(s=0-n|0,!(x>>>0>n>>>0&(n>>>0<2147483647&(l|0)!=-1)))if((l|0)==-1){n=0;break}else{y=n,f=l,ee=145;break e}if(i=A[5977]|0,i=S-n+i&0-i,i>>>0>=2147483647){y=n,f=l,ee=145;break e}if((M(i|0)|0)==-1){M(s|0)|0,n=0;break}else{y=i+n|0,f=l,ee=145;break e}}while(!1);A[5968]=A[5968]|4,ee=143}while(!1);if((ee|0)==143&&C>>>0<2147483647&&(oe=M(C|0)|0,Q=M(0)|0,he=Q-oe|0,ge=he>>>0>(G+40|0)>>>0,!((oe|0)==-1|ge^1|oe>>>0<Q>>>0&((oe|0)!=-1&(Q|0)!=-1)^1))&&(y=ge?he:n,f=oe,ee=145),(ee|0)==145){n=(A[5965]|0)+y|0,A[5965]=n,n>>>0>(A[5966]|0)>>>0&&(A[5966]=n),S=A[5863]|0;e:do if(S){for(n=23876;;){if(i=A[n>>2]|0,s=A[n+4>>2]|0,(f|0)==(i+s|0)){ee=154;break}if(l=A[n+8>>2]|0,l)n=l;else break}if((ee|0)==154&&(fe=n+4|0,(A[n+12>>2]&8|0)==0)&&f>>>0>S>>>0&i>>>0<=S>>>0){A[fe>>2]=s+y,pe=(A[5860]|0)+y|0,oe=S+8|0,oe=oe&7|0?0-oe&7:0,fe=S+oe|0,oe=pe-oe|0,A[5863]=fe,A[5860]=oe,A[fe+4>>2]=oe|1,A[S+pe+4>>2]=40,A[5864]=A[5979];break}for(f>>>0<(A[5861]|0)>>>0&&(A[5861]=f),s=f+y|0,n=23876;;){if((A[n>>2]|0)==(s|0)){ee=162;break}if(i=A[n+8>>2]|0,i)n=i;else break}if((ee|0)==162&&!(A[n+12>>2]&8|0)){A[n>>2]=f,z=n+4|0,A[z>>2]=(A[z>>2]|0)+y,z=f+8|0,z=f+(z&7|0?0-z&7:0)|0,n=s+8|0,n=s+(n&7|0?0-n&7:0)|0,C=z+G|0,x=n-z-G|0,A[z+4>>2]=G|3;t:do if((S|0)==(n|0))pe=(A[5860]|0)+x|0,A[5860]=pe,A[5863]=C,A[C+4>>2]=pe|1;else{if((A[5862]|0)==(n|0)){pe=(A[5859]|0)+x|0,A[5859]=pe,A[5862]=C,A[C+4>>2]=pe|1,A[C+pe>>2]=pe;break}if(i=A[n+4>>2]|0,(i&3|0)==1){y=i&-8,l=i>>>3;i:do if(i>>>0<256)if(i=A[n+8>>2]|0,s=A[n+12>>2]|0,(s|0)==(i|0)){A[5857]=A[5857]&~(1<<l);break}else{A[i+12>>2]=s,A[s+8>>2]=i;break}else{f=A[n+24>>2]|0,i=A[n+12>>2]|0;do if((i|0)==(n|0)){if(s=n+16|0,l=s+4|0,i=A[l>>2]|0,i)s=l;else if(i=A[s>>2]|0,!i){i=0;break}for(;;)if(c=i+20|0,l=A[c>>2]|0,l)i=l,s=c;else if(c=i+16|0,l=A[c>>2]|0,l)i=l,s=c;else break;A[s>>2]=0}else pe=A[n+8>>2]|0,A[pe+12>>2]=i,A[i+8>>2]=pe;while(!1);if(!f)break;s=A[n+28>>2]|0,l=23732+(s<<2)|0;do if((A[l>>2]|0)!=(n|0)){if(pe=f+16|0,A[((A[pe>>2]|0)==(n|0)?pe:f+20|0)>>2]=i,!i)break i}else{if(A[l>>2]=i,i|0)break;A[5858]=A[5858]&~(1<<s);break i}while(!1);if(A[i+24>>2]=f,s=n+16|0,l=A[s>>2]|0,l|0&&(A[i+16>>2]=l,A[l+24>>2]=i),s=A[s+4>>2]|0,!s)break;A[i+20>>2]=s,A[s+24>>2]=i}while(!1);n=n+y|0,c=y+x|0}else c=x;if(n=n+4|0,A[n>>2]=A[n>>2]&-2,A[C+4>>2]=c|1,A[C+c>>2]=c,n=c>>>3,c>>>0<256){s=23468+(n<<1<<2)|0,i=A[5857]|0,n=1<<n,i&n?(i=s+8|0,n=A[i>>2]|0):(A[5857]=i|n,n=s,i=s+8|0),A[i>>2]=C,A[n+12>>2]=C,A[C+8>>2]=n,A[C+12>>2]=s;break}n=c>>>8;do if(!n)l=0;else{if(c>>>0>16777215){l=31;break}fe=(n+1048320|0)>>>16&8,pe=n<<fe,oe=(pe+520192|0)>>>16&4,pe=pe<<oe,l=(pe+245760|0)>>>16&2,l=14-(oe|fe|l)+(pe<<l>>>15)|0,l=c>>>(l+7|0)&1|l<<1}while(!1);if(n=23732+(l<<2)|0,A[C+28>>2]=l,i=C+16|0,A[i+4>>2]=0,A[i>>2]=0,i=A[5858]|0,s=1<<l,!(i&s)){A[5858]=i|s,A[n>>2]=C,A[C+24>>2]=n,A[C+12>>2]=C,A[C+8>>2]=C;break}n=A[n>>2]|0;i:do if((A[n+4>>2]&-8|0)!=(c|0)){for(l=c<<((l|0)==31?0:25-(l>>>1)|0);s=n+16+(l>>>31<<2)|0,i=A[s>>2]|0,!!i;)if((A[i+4>>2]&-8|0)==(c|0)){n=i;break i}else l=l<<1,n=i;A[s>>2]=C,A[C+24>>2]=n,A[C+12>>2]=C,A[C+8>>2]=C;break t}while(!1);fe=n+8|0,pe=A[fe>>2]|0,A[pe+12>>2]=C,A[fe>>2]=C,A[C+8>>2]=pe,A[C+12>>2]=n,A[C+24>>2]=0}while(!1);return pe=z+8|0,J=Fe,pe|0}for(n=23876;i=A[n>>2]|0,!(i>>>0<=S>>>0&&(pe=i+(A[n+4>>2]|0)|0,pe>>>0>S>>>0));)n=A[n+8>>2]|0;c=pe+-47|0,i=c+8|0,i=c+(i&7|0?0-i&7:0)|0,c=S+16|0,i=i>>>0<c>>>0?S:i,n=i+8|0,s=y+-40|0,oe=f+8|0,oe=oe&7|0?0-oe&7:0,fe=f+oe|0,oe=s-oe|0,A[5863]=fe,A[5860]=oe,A[fe+4>>2]=oe|1,A[f+s+4>>2]=40,A[5864]=A[5979],s=i+4|0,A[s>>2]=27,A[n>>2]=A[5969],A[n+4>>2]=A[5970],A[n+8>>2]=A[5971],A[n+12>>2]=A[5972],A[5969]=f,A[5970]=y,A[5972]=0,A[5971]=n,n=i+24|0;do fe=n,n=n+4|0,A[n>>2]=7;while((fe+8|0)>>>0<pe>>>0);if((i|0)!=(S|0)){if(f=i-S|0,A[s>>2]=A[s>>2]&-2,A[S+4>>2]=f|1,A[i>>2]=f,n=f>>>3,f>>>0<256){s=23468+(n<<1<<2)|0,i=A[5857]|0,n=1<<n,i&n?(i=s+8|0,n=A[i>>2]|0):(A[5857]=i|n,n=s,i=s+8|0),A[i>>2]=S,A[n+12>>2]=S,A[S+8>>2]=n,A[S+12>>2]=s;break}if(n=f>>>8,n?f>>>0>16777215?l=31:(fe=(n+1048320|0)>>>16&8,pe=n<<fe,oe=(pe+520192|0)>>>16&4,pe=pe<<oe,l=(pe+245760|0)>>>16&2,l=14-(oe|fe|l)+(pe<<l>>>15)|0,l=f>>>(l+7|0)&1|l<<1):l=0,s=23732+(l<<2)|0,A[S+28>>2]=l,A[S+20>>2]=0,A[c>>2]=0,n=A[5858]|0,i=1<<l,!(n&i)){A[5858]=n|i,A[s>>2]=S,A[S+24>>2]=s,A[S+12>>2]=S,A[S+8>>2]=S;break}n=A[s>>2]|0;t:do if((A[n+4>>2]&-8|0)!=(f|0)){for(l=f<<((l|0)==31?0:25-(l>>>1)|0);s=n+16+(l>>>31<<2)|0,i=A[s>>2]|0,!!i;)if((A[i+4>>2]&-8|0)==(f|0)){n=i;break t}else l=l<<1,n=i;A[s>>2]=S,A[S+24>>2]=n,A[S+12>>2]=S,A[S+8>>2]=S;break e}while(!1);fe=n+8|0,pe=A[fe>>2]|0,A[pe+12>>2]=S,A[fe>>2]=S,A[S+8>>2]=pe,A[S+12>>2]=n,A[S+24>>2]=0}}else pe=A[5861]|0,(pe|0)==0|f>>>0<pe>>>0&&(A[5861]=f),A[5969]=f,A[5970]=y,A[5972]=0,A[5866]=A[5975],A[5865]=-1,A[5870]=23468,A[5869]=23468,A[5872]=23476,A[5871]=23476,A[5874]=23484,A[5873]=23484,A[5876]=23492,A[5875]=23492,A[5878]=23500,A[5877]=23500,A[5880]=23508,A[5879]=23508,A[5882]=23516,A[5881]=23516,A[5884]=23524,A[5883]=23524,A[5886]=23532,A[5885]=23532,A[5888]=23540,A[5887]=23540,A[5890]=23548,A[5889]=23548,A[5892]=23556,A[5891]=23556,A[5894]=23564,A[5893]=23564,A[5896]=23572,A[5895]=23572,A[5898]=23580,A[5897]=23580,A[5900]=23588,A[5899]=23588,A[5902]=23596,A[5901]=23596,A[5904]=23604,A[5903]=23604,A[5906]=23612,A[5905]=23612,A[5908]=23620,A[5907]=23620,A[5910]=23628,A[5909]=23628,A[5912]=23636,A[5911]=23636,A[5914]=23644,A[5913]=23644,A[5916]=23652,A[5915]=23652,A[5918]=23660,A[5917]=23660,A[5920]=23668,A[5919]=23668,A[5922]=23676,A[5921]=23676,A[5924]=23684,A[5923]=23684,A[5926]=23692,A[5925]=23692,A[5928]=23700,A[5927]=23700,A[5930]=23708,A[5929]=23708,A[5932]=23716,A[5931]=23716,pe=y+-40|0,oe=f+8|0,oe=oe&7|0?0-oe&7:0,fe=f+oe|0,oe=pe-oe|0,A[5863]=fe,A[5860]=oe,A[fe+4>>2]=oe|1,A[f+pe+4>>2]=40,A[5864]=A[5979];while(!1);if(n=A[5860]|0,n>>>0>G>>>0)return oe=n-G|0,A[5860]=oe,pe=A[5863]|0,fe=pe+G|0,A[5863]=fe,A[fe+4>>2]=oe|1,A[pe+4>>2]=G|3,pe=pe+8|0,J=Fe,pe|0}return pe=ja()|0,A[pe>>2]=12,pe=0,J=Fe,pe|0}function Ct(i){i=i|0;var n=0,s=0,l=0,c=0,f=0,y=0,x=0,S=0;if(i){s=i+-8|0,c=A[5861]|0,i=A[i+-4>>2]|0,n=i&-8,S=s+n|0;do if(i&1)x=s,y=s;else{if(l=A[s>>2]|0,!(i&3)||(y=s+(0-l)|0,f=l+n|0,y>>>0<c>>>0))return;if((A[5862]|0)==(y|0)){if(i=S+4|0,n=A[i>>2]|0,(n&3|0)!=3){x=y,n=f;break}A[5859]=f,A[i>>2]=n&-2,A[y+4>>2]=f|1,A[y+f>>2]=f;return}if(s=l>>>3,l>>>0<256)if(i=A[y+8>>2]|0,n=A[y+12>>2]|0,(n|0)==(i|0)){A[5857]=A[5857]&~(1<<s),x=y,n=f;break}else{A[i+12>>2]=n,A[n+8>>2]=i,x=y,n=f;break}c=A[y+24>>2]|0,i=A[y+12>>2]|0;do if((i|0)==(y|0)){if(n=y+16|0,s=n+4|0,i=A[s>>2]|0,i)n=s;else if(i=A[n>>2]|0,!i){i=0;break}for(;;)if(l=i+20|0,s=A[l>>2]|0,s)i=s,n=l;else if(l=i+16|0,s=A[l>>2]|0,s)i=s,n=l;else break;A[n>>2]=0}else x=A[y+8>>2]|0,A[x+12>>2]=i,A[i+8>>2]=x;while(!1);if(c){if(n=A[y+28>>2]|0,s=23732+(n<<2)|0,(A[s>>2]|0)==(y|0)){if(A[s>>2]=i,!i){A[5858]=A[5858]&~(1<<n),x=y,n=f;break}}else if(x=c+16|0,A[((A[x>>2]|0)==(y|0)?x:c+20|0)>>2]=i,!i){x=y,n=f;break}A[i+24>>2]=c,n=y+16|0,s=A[n>>2]|0,s|0&&(A[i+16>>2]=s,A[s+24>>2]=i),n=A[n+4>>2]|0,n?(A[i+20>>2]=n,A[n+24>>2]=i,x=y,n=f):(x=y,n=f)}else x=y,n=f}while(!1);if(!(y>>>0>=S>>>0)&&(i=S+4|0,l=A[i>>2]|0,!!(l&1))){if(l&2)A[i>>2]=l&-2,A[x+4>>2]=n|1,A[y+n>>2]=n,c=n;else{if((A[5863]|0)==(S|0)){if(S=(A[5860]|0)+n|0,A[5860]=S,A[5863]=x,A[x+4>>2]=S|1,(x|0)!=(A[5862]|0))return;A[5862]=0,A[5859]=0;return}if((A[5862]|0)==(S|0)){S=(A[5859]|0)+n|0,A[5859]=S,A[5862]=y,A[x+4>>2]=S|1,A[y+S>>2]=S;return}c=(l&-8)+n|0,s=l>>>3;do if(l>>>0<256)if(n=A[S+8>>2]|0,i=A[S+12>>2]|0,(i|0)==(n|0)){A[5857]=A[5857]&~(1<<s);break}else{A[n+12>>2]=i,A[i+8>>2]=n;break}else{f=A[S+24>>2]|0,i=A[S+12>>2]|0;do if((i|0)==(S|0)){if(n=S+16|0,s=n+4|0,i=A[s>>2]|0,i)n=s;else if(i=A[n>>2]|0,!i){s=0;break}for(;;)if(l=i+20|0,s=A[l>>2]|0,s)i=s,n=l;else if(l=i+16|0,s=A[l>>2]|0,s)i=s,n=l;else break;A[n>>2]=0,s=i}else s=A[S+8>>2]|0,A[s+12>>2]=i,A[i+8>>2]=s,s=i;while(!1);if(f|0){if(i=A[S+28>>2]|0,n=23732+(i<<2)|0,(A[n>>2]|0)==(S|0)){if(A[n>>2]=s,!s){A[5858]=A[5858]&~(1<<i);break}}else if(l=f+16|0,A[((A[l>>2]|0)==(S|0)?l:f+20|0)>>2]=s,!s)break;A[s+24>>2]=f,i=S+16|0,n=A[i>>2]|0,n|0&&(A[s+16>>2]=n,A[n+24>>2]=s),i=A[i+4>>2]|0,i|0&&(A[s+20>>2]=i,A[i+24>>2]=s)}}while(!1);if(A[x+4>>2]=c|1,A[y+c>>2]=c,(x|0)==(A[5862]|0)){A[5859]=c;return}}if(i=c>>>3,c>>>0<256){s=23468+(i<<1<<2)|0,n=A[5857]|0,i=1<<i,n&i?(n=s+8|0,i=A[n>>2]|0):(A[5857]=n|i,i=s,n=s+8|0),A[n>>2]=x,A[i+12>>2]=x,A[x+8>>2]=i,A[x+12>>2]=s;return}i=c>>>8,i?c>>>0>16777215?l=31:(y=(i+1048320|0)>>>16&8,S=i<<y,f=(S+520192|0)>>>16&4,S=S<<f,l=(S+245760|0)>>>16&2,l=14-(f|y|l)+(S<<l>>>15)|0,l=c>>>(l+7|0)&1|l<<1):l=0,i=23732+(l<<2)|0,A[x+28>>2]=l,A[x+20>>2]=0,A[x+16>>2]=0,n=A[5858]|0,s=1<<l;e:do if(!(n&s))A[5858]=n|s,A[i>>2]=x,A[x+24>>2]=i,A[x+12>>2]=x,A[x+8>>2]=x;else{i=A[i>>2]|0;t:do if((A[i+4>>2]&-8|0)!=(c|0)){for(l=c<<((l|0)==31?0:25-(l>>>1)|0);s=i+16+(l>>>31<<2)|0,n=A[s>>2]|0,!!n;)if((A[n+4>>2]&-8|0)==(c|0)){i=n;break t}else l=l<<1,i=n;A[s>>2]=x,A[x+24>>2]=i,A[x+12>>2]=x,A[x+8>>2]=x;break e}while(!1);y=i+8|0,S=A[y>>2]|0,A[S+12>>2]=x,A[y>>2]=x,A[x+8>>2]=S,A[x+12>>2]=i,A[x+24>>2]=0}while(!1);if(S=(A[5865]|0)+-1|0,A[5865]=S,!(S|0)){for(i=23884;i=A[i>>2]|0,i;)i=i+8|0;A[5865]=-1}}}}function ar(i,n){i=i|0,n=n|0;var s=0;return i?(s=Zt(n,i)|0,(n|i)>>>0>65535&&(s=((s>>>0)/(i>>>0)|0|0)==(n|0)?s:-1)):s=0,i=Bi(s)|0,!i||!(A[i+-4>>2]&3)||g(i|0,0,s|0)|0,i|0}function yt(i,n,s,l){return i=i|0,n=n|0,s=s|0,l=l|0,s=i+s>>>0,St(n+l+(s>>>0<i>>>0|0)>>>0|0),s|0|0}function $t(i,n,s,l){return i=i|0,n=n|0,s=s|0,l=l|0,l=n-l-(s>>>0>i>>>0|0)>>>0,St(l|0),i-s>>>0|0|0}function cs(i){return i=i|0,(i?31-(Ci(i^i-1)|0)|0:32)|0}function hs(i,n,s,l,c){i=i|0,n=n|0,s=s|0,l=l|0,c=c|0;var f=0,y=0,x=0,S=0,C=0,z=0,G=0,N=0,Z=0,Q=0;if(z=i,S=n,C=S,y=s,N=l,x=N,!C)return f=(c|0)!=0,x?f?(A[c>>2]=i|0,A[c+4>>2]=n&0,N=0,c=0,St(N|0),c|0):(N=0,c=0,St(N|0),c|0):(f&&(A[c>>2]=(z>>>0)%(y>>>0),A[c+4>>2]=0),N=0,c=(z>>>0)/(y>>>0)>>>0,St(N|0),c|0);f=(x|0)==0;do if(y){if(!f){if(f=(Ci(x|0)|0)-(Ci(C|0)|0)|0,f>>>0<=31){G=f+1|0,x=31-f|0,n=f-31>>31,y=G,i=z>>>(G>>>0)&n|C<<x,n=C>>>(G>>>0)&n,f=0,x=z<<x;break}return c?(A[c>>2]=i|0,A[c+4>>2]=S|n&0,N=0,c=0,St(N|0),c|0):(N=0,c=0,St(N|0),c|0)}if(f=y-1|0,f&y|0){x=(Ci(y|0)|0)+33-(Ci(C|0)|0)|0,Q=64-x|0,G=32-x|0,S=G>>31,Z=x-32|0,n=Z>>31,y=x,i=G-1>>31&C>>>(Z>>>0)|(C<<G|z>>>(x>>>0))&n,n=n&C>>>(x>>>0),f=z<<Q&S,x=(C<<Q|z>>>(Z>>>0))&S|z<<G&x-33>>31;break}return c|0&&(A[c>>2]=f&z,A[c+4>>2]=0),(y|0)==1?(Z=S|n&0,Q=i|0|0,St(Z|0),Q|0):(Q=cs(y|0)|0,Z=C>>>(Q>>>0)|0,Q=C<<32-Q|z>>>(Q>>>0)|0,St(Z|0),Q|0)}else{if(f)return c|0&&(A[c>>2]=(C>>>0)%(y>>>0),A[c+4>>2]=0),Z=0,Q=(C>>>0)/(y>>>0)>>>0,St(Z|0),Q|0;if(!z)return c|0&&(A[c>>2]=0,A[c+4>>2]=(C>>>0)%(x>>>0)),Z=0,Q=(C>>>0)/(x>>>0)>>>0,St(Z|0),Q|0;if(f=x-1|0,!(f&x))return c|0&&(A[c>>2]=i|0,A[c+4>>2]=f&C|n&0),Z=0,Q=C>>>((cs(x|0)|0)>>>0),St(Z|0),Q|0;if(f=(Ci(x|0)|0)-(Ci(C|0)|0)|0,f>>>0<=30){n=f+1|0,x=31-f|0,y=n,i=C<<x|z>>>(n>>>0),n=C>>>(n>>>0),f=0,x=z<<x;break}return c?(A[c>>2]=i|0,A[c+4>>2]=S|n&0,Z=0,Q=0,St(Z|0),Q|0):(Z=0,Q=0,St(Z|0),Q|0)}while(!1);if(!y)C=x,S=0,x=0;else{G=s|0|0,z=N|l&0,C=yt(G|0,z|0,-1,-1)|0,s=ne()|0,S=x,x=0;do l=S,S=f>>>31|S<<1,f=x|f<<1,l=i<<1|l>>>31|0,N=i>>>31|n<<1|0,$t(C|0,s|0,l|0,N|0)|0,Q=ne()|0,Z=Q>>31|((Q|0)<0?-1:0)<<1,x=Z&1,i=$t(l|0,N|0,Z&G|0,(((Q|0)<0?-1:0)>>31|((Q|0)<0?-1:0)<<1)&z|0)|0,n=ne()|0,y=y-1|0;while(y|0);C=S,S=0}return y=0,c|0&&(A[c>>2]=i,A[c+4>>2]=n),Z=(f|0)>>>31|(C|y)<<1|(y<<1|f>>>31)&0|S,Q=(f<<1|0)&-2|x,St(Z|0),Q|0}function en(i,n,s,l){i=i|0,n=n|0,s=s|0,l=l|0;var c=0,f=0,y=0,x=0,S=0,C=0;return C=n>>31|((n|0)<0?-1:0)<<1,S=((n|0)<0?-1:0)>>31|((n|0)<0?-1:0)<<1,f=l>>31|((l|0)<0?-1:0)<<1,c=((l|0)<0?-1:0)>>31|((l|0)<0?-1:0)<<1,x=$t(C^i|0,S^n|0,C|0,S|0)|0,y=ne()|0,i=f^C,n=c^S,$t((hs(x,y,$t(f^s|0,c^l|0,f|0,c|0)|0,ne()|0,0)|0)^i|0,(ne()|0)^n|0,i|0,n|0)|0}function fs(i,n){i=i|0,n=n|0;var s=0,l=0,c=0,f=0;return f=i&65535,c=n&65535,s=Zt(c,f)|0,l=i>>>16,i=(s>>>16)+(Zt(c,l)|0)|0,c=n>>>16,n=Zt(c,f)|0,St((i>>>16)+(Zt(c,l)|0)+(((i&65535)+n|0)>>>16)|0),i+n<<16|s&65535|0|0}function Qi(i,n,s,l){i=i|0,n=n|0,s=s|0,l=l|0;var c=0,f=0;return c=i,f=s,s=fs(c,f)|0,i=ne()|0,St((Zt(n,f)|0)+(Zt(l,c)|0)+i|i&0|0),s|0|0|0}function $s(i,n,s,l){i=i|0,n=n|0,s=s|0,l=l|0;var c=0,f=0,y=0,x=0,S=0,C=0;return c=J,J=J+16|0,x=c|0,y=n>>31|((n|0)<0?-1:0)<<1,f=((n|0)<0?-1:0)>>31|((n|0)<0?-1:0)<<1,C=l>>31|((l|0)<0?-1:0)<<1,S=((l|0)<0?-1:0)>>31|((l|0)<0?-1:0)<<1,i=$t(y^i|0,f^n|0,y|0,f|0)|0,n=ne()|0,hs(i,n,$t(C^s|0,S^l|0,C|0,S|0)|0,ne()|0,x)|0,l=$t(A[x>>2]^y|0,A[x+4>>2]^f|0,y|0,f|0)|0,s=ne()|0,J=c,St(s|0),l|0}function tn(i,n,s,l){i=i|0,n=n|0,s=s|0,l=l|0;var c=0,f=0;return f=J,J=J+16|0,c=f|0,hs(i,n,s,l,c)|0,J=f,St(A[c+4>>2]|0),A[c>>2]|0|0}function aa(i,n,s){return i=i|0,n=n|0,s=s|0,(s|0)<32?(St(n>>s|0),i>>>s|(n&(1<<s)-1)<<32-s):(St(((n|0)<0?-1:0)|0),n>>s-32|0)}function Ge(i,n,s){return i=i|0,n=n|0,s=s|0,(s|0)<32?(St(n>>>s|0),i>>>s|(n&(1<<s)-1)<<32-s):(St(0),n>>>s-32|0)}function Oe(i,n,s){return i=i|0,n=n|0,s=s|0,(s|0)<32?(St(n<<s|(i&(1<<s)-1<<32-s)>>>32-s|0),i<<s):(St(i<<s-32|0),0)}function v(i,n){return i=+i,n=+n,i!=i?+n:n!=n?+i:+Go(+i,+n)}function t(i,n){return i=+i,n=+n,i!=i?+n:n!=n?+i:+oo(+i,+n)}function a(i){return i=+i,i>=0?+zt(i+.5):+Is(i-.5)}function d(i,n,s){i=i|0,n=n|0,s=s|0;var l=0,c=0,f=0;if((s|0)>=8192)return Ms(i|0,n|0,s|0)|0,i|0;if(f=i|0,c=i+s|0,(i&3)==(n&3)){for(;i&3;){if(!s)return f|0;Ue[i>>0]=Ue[n>>0]|0,i=i+1|0,n=n+1|0,s=s-1|0}for(s=c&-4|0,l=s-64|0;(i|0)<=(l|0);)A[i>>2]=A[n>>2],A[i+4>>2]=A[n+4>>2],A[i+8>>2]=A[n+8>>2],A[i+12>>2]=A[n+12>>2],A[i+16>>2]=A[n+16>>2],A[i+20>>2]=A[n+20>>2],A[i+24>>2]=A[n+24>>2],A[i+28>>2]=A[n+28>>2],A[i+32>>2]=A[n+32>>2],A[i+36>>2]=A[n+36>>2],A[i+40>>2]=A[n+40>>2],A[i+44>>2]=A[n+44>>2],A[i+48>>2]=A[n+48>>2],A[i+52>>2]=A[n+52>>2],A[i+56>>2]=A[n+56>>2],A[i+60>>2]=A[n+60>>2],i=i+64|0,n=n+64|0;for(;(i|0)<(s|0);)A[i>>2]=A[n>>2],i=i+4|0,n=n+4|0}else for(s=c-4|0;(i|0)<(s|0);)Ue[i>>0]=Ue[n>>0]|0,Ue[i+1>>0]=Ue[n+1>>0]|0,Ue[i+2>>0]=Ue[n+2>>0]|0,Ue[i+3>>0]=Ue[n+3>>0]|0,i=i+4|0,n=n+4|0;for(;(i|0)<(c|0);)Ue[i>>0]=Ue[n>>0]|0,i=i+1|0,n=n+1|0;return f|0}function g(i,n,s){i=i|0,n=n|0,s=s|0;var l=0,c=0,f=0,y=0;if(f=i+s|0,n=n&255,(s|0)>=67){for(;i&3;)Ue[i>>0]=n,i=i+1|0;for(l=f&-4|0,y=n|n<<8|n<<16|n<<24,c=l-64|0;(i|0)<=(c|0);)A[i>>2]=y,A[i+4>>2]=y,A[i+8>>2]=y,A[i+12>>2]=y,A[i+16>>2]=y,A[i+20>>2]=y,A[i+24>>2]=y,A[i+28>>2]=y,A[i+32>>2]=y,A[i+36>>2]=y,A[i+40>>2]=y,A[i+44>>2]=y,A[i+48>>2]=y,A[i+52>>2]=y,A[i+56>>2]=y,A[i+60>>2]=y,i=i+64|0;for(;(i|0)<(l|0);)A[i>>2]=y,i=i+4|0}for(;(i|0)<(f|0);)Ue[i>>0]=n,i=i+1|0;return f-s|0}function b(i){return i=+i,i>=0?+zt(i+.5):+Is(i-.5)}function M(i){i=i|0;var n=0,s=0,l=0;return l=jo()|0,s=A[mt>>2]|0,n=s+i|0,(i|0)>0&(n|0)<(s|0)|(n|0)<0?(ti(n|0)|0,qi(12),-1):(n|0)>(l|0)&&!(xi(n|0)|0)?(qi(12),-1):(A[mt>>2]=n,s|0)}return{___divdi3:en,___muldi3:Qi,___remdi3:$s,___uremdi3:tn,_areNeighborCells:Ea,_bitshift64Ashr:aa,_bitshift64Lshr:Ge,_bitshift64Shl:Oe,_calloc:ar,_cellAreaKm2:ra,_cellAreaM2:Tn,_cellAreaRads2:Jr,_cellToBoundary:Zi,_cellToCenterChild:go,_cellToChildPos:xo,_cellToChildren:Ma,_cellToChildrenSize:Vs,_cellToLatLng:Kr,_cellToLocalIj:Zs,_cellToParent:Os,_cellToVertex:yr,_cellToVertexes:kl,_cellsToDirectedEdge:zs,_cellsToLinkedMultiPolygon:Wl,_childPosToCell:js,_compactCells:_o,_destroyLinkedMultiPolygon:us,_directedEdgeToBoundary:Yr,_directedEdgeToCells:ls,_edgeLengthKm:Jl,_edgeLengthM:Ba,_edgeLengthRads:In,_emscripten_replace_memory:Ti,_free:Ct,_getBaseCellNumber:Ko,_getDirectedEdgeDestination:cl,_getDirectedEdgeOrigin:ul,_getHexagonAreaAvgKm2:gl,_getHexagonAreaAvgM2:_l,_getHexagonEdgeLengthAvgKm:yl,_getHexagonEdgeLengthAvgM:Sn,_getIcosahedronFaces:Gs,_getNumCells:ia,_getPentagons:En,_getRes0Cells:Wo,_getResolution:dl,_greatCircleDistanceKm:gr,_greatCircleDistanceM:bo,_greatCircleDistanceRads:ml,_gridDisk:Zo,_gridDiskDistances:ao,_gridDistance:Je,_gridPathCells:La,_gridPathCellsSize:za,_gridRingUnsafe:nl,_i64Add:yt,_i64Subtract:$t,_isPentagon:ai,_isResClassIII:Kl,_isValidCell:Fs,_isValidDirectedEdge:Sa,_isValidVertex:Sl,_latLngToCell:vo,_llvm_maxnum_f64:v,_llvm_minnum_f64:t,_llvm_round_f64:a,_localIjToCell:xl,_malloc:Bi,_maxFaceCount:Us,_maxGridDiskSize:rl,_maxPolygonToCellsSize:Hl,_memcpy:d,_memset:g,_originToDirectedEdges:hl,_pentagonCount:ta,_polygonToCells:ma,_readInt64AsDoubleFromPointer:ko,_res0CellCount:Or,_round:b,_sbrk:M,_sizeOfCellBoundary:Oa,_sizeOfCoordIJ:jn,_sizeOfGeoLoop:Va,_sizeOfGeoPolygon:Na,_sizeOfH3Index:eA,_sizeOfLatLng:Fa,_sizeOfLinkedGeoPolygon:_r,_uncompactCells:Yl,_uncompactCellsSize:Ca,_vertexToLatLng:El,establishStackSpace:Vn,stackAlloc:qo,stackRestore:pa,stackSave:Fr}}(cn,Bt,kt);_.___divdi3=Ve.___divdi3,_.___muldi3=Ve.___muldi3,_.___remdi3=Ve.___remdi3,_.___uremdi3=Ve.___uremdi3,_._areNeighborCells=Ve._areNeighborCells,_._bitshift64Ashr=Ve._bitshift64Ashr,_._bitshift64Lshr=Ve._bitshift64Lshr,_._bitshift64Shl=Ve._bitshift64Shl,_._calloc=Ve._calloc,_._cellAreaKm2=Ve._cellAreaKm2,_._cellAreaM2=Ve._cellAreaM2,_._cellAreaRads2=Ve._cellAreaRads2,_._cellToBoundary=Ve._cellToBoundary,_._cellToCenterChild=Ve._cellToCenterChild,_._cellToChildPos=Ve._cellToChildPos,_._cellToChildren=Ve._cellToChildren,_._cellToChildrenSize=Ve._cellToChildrenSize,_._cellToLatLng=Ve._cellToLatLng,_._cellToLocalIj=Ve._cellToLocalIj,_._cellToParent=Ve._cellToParent,_._cellToVertex=Ve._cellToVertex,_._cellToVertexes=Ve._cellToVertexes,_._cellsToDirectedEdge=Ve._cellsToDirectedEdge,_._cellsToLinkedMultiPolygon=Ve._cellsToLinkedMultiPolygon,_._childPosToCell=Ve._childPosToCell,_._compactCells=Ve._compactCells,_._destroyLinkedMultiPolygon=Ve._destroyLinkedMultiPolygon,_._directedEdgeToBoundary=Ve._directedEdgeToBoundary,_._directedEdgeToCells=Ve._directedEdgeToCells,_._edgeLengthKm=Ve._edgeLengthKm,_._edgeLengthM=Ve._edgeLengthM,_._edgeLengthRads=Ve._edgeLengthRads;var ae=_._emscripten_replace_memory=Ve._emscripten_replace_memory;_._free=Ve._free,_._getBaseCellNumber=Ve._getBaseCellNumber,_._getDirectedEdgeDestination=Ve._getDirectedEdgeDestination,_._getDirectedEdgeOrigin=Ve._getDirectedEdgeOrigin,_._getHexagonAreaAvgKm2=Ve._getHexagonAreaAvgKm2,_._getHexagonAreaAvgM2=Ve._getHexagonAreaAvgM2,_._getHexagonEdgeLengthAvgKm=Ve._getHexagonEdgeLengthAvgKm,_._getHexagonEdgeLengthAvgM=Ve._getHexagonEdgeLengthAvgM,_._getIcosahedronFaces=Ve._getIcosahedronFaces,_._getNumCells=Ve._getNumCells,_._getPentagons=Ve._getPentagons,_._getRes0Cells=Ve._getRes0Cells,_._getResolution=Ve._getResolution,_._greatCircleDistanceKm=Ve._greatCircleDistanceKm,_._greatCircleDistanceM=Ve._greatCircleDistanceM,_._greatCircleDistanceRads=Ve._greatCircleDistanceRads,_._gridDisk=Ve._gridDisk,_._gridDiskDistances=Ve._gridDiskDistances,_._gridDistance=Ve._gridDistance,_._gridPathCells=Ve._gridPathCells,_._gridPathCellsSize=Ve._gridPathCellsSize,_._gridRingUnsafe=Ve._gridRingUnsafe,_._i64Add=Ve._i64Add,_._i64Subtract=Ve._i64Subtract,_._isPentagon=Ve._isPentagon,_._isResClassIII=Ve._isResClassIII,_._isValidCell=Ve._isValidCell,_._isValidDirectedEdge=Ve._isValidDirectedEdge,_._isValidVertex=Ve._isValidVertex,_._latLngToCell=Ve._latLngToCell,_._llvm_maxnum_f64=Ve._llvm_maxnum_f64,_._llvm_minnum_f64=Ve._llvm_minnum_f64,_._llvm_round_f64=Ve._llvm_round_f64,_._localIjToCell=Ve._localIjToCell,_._malloc=Ve._malloc,_._maxFaceCount=Ve._maxFaceCount,_._maxGridDiskSize=Ve._maxGridDiskSize,_._maxPolygonToCellsSize=Ve._maxPolygonToCellsSize,_._memcpy=Ve._memcpy,_._memset=Ve._memset,_._originToDirectedEdges=Ve._originToDirectedEdges,_._pentagonCount=Ve._pentagonCount,_._polygonToCells=Ve._polygonToCells,_._readInt64AsDoubleFromPointer=Ve._readInt64AsDoubleFromPointer,_._res0CellCount=Ve._res0CellCount,_._round=Ve._round,_._sbrk=Ve._sbrk,_._sizeOfCellBoundary=Ve._sizeOfCellBoundary,_._sizeOfCoordIJ=Ve._sizeOfCoordIJ,_._sizeOfGeoLoop=Ve._sizeOfGeoLoop,_._sizeOfGeoPolygon=Ve._sizeOfGeoPolygon,_._sizeOfH3Index=Ve._sizeOfH3Index,_._sizeOfLatLng=Ve._sizeOfLatLng,_._sizeOfLinkedGeoPolygon=Ve._sizeOfLinkedGeoPolygon,_._uncompactCells=Ve._uncompactCells,_._uncompactCellsSize=Ve._uncompactCellsSize,_._vertexToLatLng=Ve._vertexToLatLng,_.establishStackSpace=Ve.establishStackSpace;var j=_.stackAlloc=Ve.stackAlloc,$=_.stackRestore=Ve.stackRestore,te=_.stackSave=Ve.stackSave;if(_.asm=Ve,_.cwrap=We,_.setValue=Ae,_.getValue=we,Mi){oi(Mi)||(Mi=L(Mi));{ts();var le=function(se){se.byteLength&&(se=new Uint8Array(se)),Jt.set(se,K),_.memoryInitializerRequest&&delete _.memoryInitializerRequest.response,ze()},ce=function(){V(Mi,le,function(){throw"could not load memory initializer "+Mi})},Ee=Xi(Mi);if(Ee)le(Ee.buffer);else if(_.memoryInitializerRequest){var ve=function(){var se=_.memoryInitializerRequest,_e=se.response;if(se.status!==200&&se.status!==0){var De=Xi(_.memoryInitializerRequestURL);if(De)_e=De.buffer;else{console.warn("a problem seems to have happened with Module.memoryInitializerRequest, status: "+se.status+", retrying "+Mi),ce();return}}le(_e)};_.memoryInitializerRequest.response?setTimeout(ve,0):_.memoryInitializerRequest.addEventListener("load",ve)}else ce()}}var de;Lr=function se(){de||be(),de||(Lr=se)};function be(se){if(pr>0||(Ye(),pr>0))return;function _e(){de||(de=!0,!xe&&(Dt(),ni(),_.onRuntimeInitialized&&_.onRuntimeInitialized(),Wi()))}_.setStatus?(_.setStatus("Running..."),setTimeout(function(){setTimeout(function(){_.setStatus("")},1),_e()},1)):_e()}_.run=be;function Be(se){throw _.onAbort&&_.onAbort(se),se+="",h(se),U(se),xe=!0,"abort("+se+"). Build with -s ASSERTIONS=1 for more info."}if(_.abort=Be,_.preInit)for(typeof _.preInit=="function"&&(_.preInit=[_.preInit]);_.preInit.length>0;)_.preInit.pop()();return be(),p}(typeof an=="object"?an:{}),Ht="number",Ft=Ht,bA=Ht,Nt=Ht,Ut=Ht,$r=Ht,xt=Ht,_x=[["sizeOfH3Index",Ht],["sizeOfLatLng",Ht],["sizeOfCellBoundary",Ht],["sizeOfGeoLoop",Ht],["sizeOfGeoPolygon",Ht],["sizeOfLinkedGeoPolygon",Ht],["sizeOfCoordIJ",Ht],["readInt64AsDoubleFromPointer",Ht],["isValidCell",bA,[Nt,Ut]],["latLngToCell",Ft,[Ht,Ht,$r,xt]],["cellToLatLng",Ft,[Nt,Ut,xt]],["cellToBoundary",Ft,[Nt,Ut,xt]],["maxGridDiskSize",Ft,[Ht,xt]],["gridDisk",Ft,[Nt,Ut,Ht,xt]],["gridDiskDistances",Ft,[Nt,Ut,Ht,xt,xt]],["gridRingUnsafe",Ft,[Nt,Ut,Ht,xt]],["maxPolygonToCellsSize",Ft,[xt,$r,Ht,xt]],["polygonToCells",Ft,[xt,$r,Ht,xt]],["cellsToLinkedMultiPolygon",Ft,[xt,Ht,xt]],["destroyLinkedMultiPolygon",null,[xt]],["compactCells",Ft,[xt,xt,Ht,Ht]],["uncompactCells",Ft,[xt,Ht,Ht,xt,Ht,$r]],["uncompactCellsSize",Ft,[xt,Ht,Ht,$r,xt]],["isPentagon",bA,[Nt,Ut]],["isResClassIII",bA,[Nt,Ut]],["getBaseCellNumber",Ht,[Nt,Ut]],["getResolution",Ht,[Nt,Ut]],["maxFaceCount",Ft,[Nt,Ut,xt]],["getIcosahedronFaces",Ft,[Nt,Ut,xt]],["cellToParent",Ft,[Nt,Ut,$r,xt]],["cellToChildren",Ft,[Nt,Ut,$r,xt]],["cellToCenterChild",Ft,[Nt,Ut,$r,xt]],["cellToChildrenSize",Ft,[Nt,Ut,$r,xt]],["cellToChildPos",Ft,[Nt,Ut,$r,xt]],["childPosToCell",Ft,[Ht,Ht,Nt,Ut,$r,xt]],["areNeighborCells",Ft,[Nt,Ut,Nt,Ut,xt]],["cellsToDirectedEdge",Ft,[Nt,Ut,Nt,Ut,xt]],["getDirectedEdgeOrigin",Ft,[Nt,Ut,xt]],["getDirectedEdgeDestination",Ft,[Nt,Ut,xt]],["isValidDirectedEdge",bA,[Nt,Ut]],["directedEdgeToCells",Ft,[Nt,Ut,xt]],["originToDirectedEdges",Ft,[Nt,Ut,xt]],["directedEdgeToBoundary",Ft,[Nt,Ut,xt]],["gridDistance",Ft,[Nt,Ut,Nt,Ut,xt]],["gridPathCells",Ft,[Nt,Ut,Nt,Ut,xt]],["gridPathCellsSize",Ft,[Nt,Ut,Nt,Ut,xt]],["cellToLocalIj",Ft,[Nt,Ut,Nt,Ut,Ht,xt]],["localIjToCell",Ft,[Nt,Ut,xt,Ht,xt]],["getHexagonAreaAvgM2",Ft,[$r,xt]],["getHexagonAreaAvgKm2",Ft,[$r,xt]],["getHexagonEdgeLengthAvgM",Ft,[$r,xt]],["getHexagonEdgeLengthAvgKm",Ft,[$r,xt]],["greatCircleDistanceM",Ht,[xt,xt]],["greatCircleDistanceKm",Ht,[xt,xt]],["greatCircleDistanceRads",Ht,[xt,xt]],["cellAreaM2",Ft,[Nt,Ut,xt]],["cellAreaKm2",Ft,[Nt,Ut,xt]],["cellAreaRads2",Ft,[Nt,Ut,xt]],["edgeLengthM",Ft,[Nt,Ut,xt]],["edgeLengthKm",Ft,[Nt,Ut,xt]],["edgeLengthRads",Ft,[Nt,Ut,xt]],["getNumCells",Ft,[$r,xt]],["getRes0Cells",Ft,[xt]],["res0CellCount",Ht],["getPentagons",Ft,[Ht,xt]],["pentagonCount",Ht],["cellToVertex",Ft,[Nt,Ut,Ht,xt]],["cellToVertexes",Ft,[Nt,Ut,xt]],["vertexToLatLng",Ft,[Nt,Ut,xt]],["isValidVertex",bA,[Nt,Ut]]],yx=0,vx=1,xx=2,bx=3,wx=4,kx=5,Ex=6,Sx=7,Tx=8,Ix=9,Mx=10,Cx=11,Px=12,Dx=13,Bx=14,zx=15,zr={};zr[yx]="Success";zr[vx]="The operation failed but a more specific error is not available";zr[xx]="Argument was outside of acceptable range";zr[bx]="Latitude or longitude arguments were outside of acceptable range";zr[wx]="Resolution argument was outside of acceptable range";zr[kx]="Cell argument was not valid";zr[Ex]="Directed edge argument was not valid";zr[Sx]="Undirected edge argument was not valid";zr[Tx]="Vertex argument was not valid";zr[Ix]="Pentagon distortion was encountered";zr[Mx]="Duplicate input";zr[Cx]="Cell arguments were not neighbors";zr[Px]="Cell arguments had incompatible resolutions";zr[Dx]="Memory allocation failed";zr[Bx]="Bounds of provided memory were insufficient";zr[zx]="Mode or flags argument was not valid";var Lx=1e3,Rx=1001,Mp=1002,Gu={};Gu[Lx]="Unknown unit";Gu[Rx]="Array length out of bounds";Gu[Mp]="Got unexpected null value for H3 index";var Fx="Unknown error";function Cp(p,_,E){var T=E&&"value"in E,D=new Error((p[_]||Fx)+" (code: "+_+(T?", value: "+E.value:"")+")");return D.code=_,D}function Ox(p,_){var E=arguments.length===2?{value:_}:{};return Cp(zr,p,E)}function Vx(p,_){var E=arguments.length===2?{value:_}:{};return Cp(Gu,p,E)}function Pp(p){if(p!==0)throw Ox(p)}var io={};_x.forEach(function(_){io[_[0]]=an.cwrap.apply(an,_)});var Ul=16,Nx=4,PA=8,kh=io.sizeOfH3Index(),Ux=io.sizeOfLatLng(),Gx=io.sizeOfCellBoundary();io.sizeOfGeoPolygon();io.sizeOfGeoLoop();io.sizeOfLinkedGeoPolygon();io.sizeOfCoordIJ();function jx(p){if(!p)throw Vx(Mp);return p}var qx=/[^0-9a-fA-F]/;function Zx(p){if(Array.isArray(p)&&p.length===2&&Number.isInteger(p[0])&&Number.isInteger(p[1]))return p;if(typeof p!="string"||qx.test(p))return[0,0];var _=parseInt(p.substring(0,p.length-8),Ul),E=parseInt(p.substring(p.length-8),Ul);return[E,_]}function ld(p){if(p>=0)return p.toString(Ul);p=p&2147483647;var _=Dp(8,p.toString(Ul)),E=(parseInt(_[0],Ul)+8).toString(Ul);return _=E+_.substring(1),_}function Qx(p,_){return ld(_)+Dp(8,ld(p))}function Dp(p,_){for(var E=p-_.length,T="",D=0;D<E;D++)T+="0";return T=T+_,T}function $x(p,_){_===void 0&&(_=0);var E=an.getValue(p+kh*_,"i32"),T=an.getValue(p+kh*_+Nx,"i32");return T?Qx(E,T):null}function Pu(p){return eb(an.getValue(p,"double"))}function Hx(p){return[Pu(p),Pu(p+PA)]}function Wx(p){return[Pu(p+PA),Pu(p)]}function Xx(p,_,E){for(var T=an.getValue(p,"i32"),D=p+PA,L=[],V=_?Wx:Hx,h=0;h<T*2;h+=2)L.push(V(D+PA*h));return E&&L.push(L[0]),L}function Yx(p,_,E){var T=an._malloc(Ux);an.HEAPF64.set([p,_].map(Jx),T/PA);var D=an._malloc(kh);try{return Pp(io.latLngToCell(T,E,D)),jx($x(D))}finally{an._free(D),an._free(T)}}function Kx(p,_){var E=an._malloc(Gx),T=Zx(p),D=T[0],L=T[1];try{return Pp(io.cellToBoundary(D,L,E)),Xx(E,_,_)}finally{an._free(E)}}function Jx(p){return p*Math.PI/180}function eb(p){return p*180/Math.PI}var tb={exports:{}},jc,Ad;function ib(){return Ad||(Ad=1,jc=function(_){return function E(T){return arguments.length===0||T!=null&&T["@@functional/placeholder"]===!0?E:_.apply(this,arguments)}}),jc}var qc,ud;function rb(){if(ud)return qc;ud=1;var p=ib();return qc=p(function(E){return E===null?"Null":E===void 0?"Undefined":Object.prototype.toString.call(E).slice(8,-1)}),qc}var Zc,cd;function Oh(){if(cd)return Zc;cd=1;function p(_){var E=typeof _;return!!_&&(E=="object"||E=="function")}return Zc=p,Zc}var Qc,hd;function nb(){if(hd)return Qc;hd=1;var p=Oh();function _(E){return p(E)?E:Object(E)}return Qc=_,Qc}var $c,fd;function sb(){if(fd)return $c;fd=1;var p=nb();function _(E){return function(T,D,L){for(var V=p(T),h=L(T),U=h.length,R=E?U:-1;E?R--:++R<U;){var ie=h[R];if(D(V[ie],ie,V)===!1)break}return T}}return $c=_,$c}var Hc,dd;function ob(){if(dd)return Hc;dd=1;var p=sb(),_=p();return Hc=_,Hc}var Wc,pd;function ab(){if(pd)return Wc;pd=1;function p(_){return function(E){return E==null?void 0:E[_]}}return Wc=p,Wc}var Xc,md;function lb(){if(md)return Xc;md=1;var p=ab(),_=p("length");return Xc=_,Xc}var Yc,gd;function Vh(){if(gd)return Yc;gd=1;var p=9007199254740991;function _(E){return typeof E=="number"&&E>-1&&E%1==0&&E<=p}return Yc=_,Yc}var Kc,_d;function Ab(){if(_d)return Kc;_d=1;var p=lb(),_=Vh();function E(T){return T!=null&&_(p(T))}return Kc=E,Kc}var Jc,yd;function ju(){if(yd)return Jc;yd=1;function p(_){return!!_&&typeof _=="object"}return Jc=p,Jc}var eh,vd;function Bp(){if(vd)return eh;vd=1;var p=Ab(),_=ju(),E=Object.prototype,T=E.hasOwnProperty,D=E.propertyIsEnumerable;function L(V){return _(V)&&p(V)&&T.call(V,"callee")&&!D.call(V,"callee")}return eh=L,eh}var th,xd;function ub(){if(xd)return th;xd=1;var p=Oh(),_="[object Function]",E=Object.prototype,T=E.toString;function D(L){return p(L)&&T.call(L)==_}return th=D,th}var ih,bd;function cb(){if(bd)return ih;bd=1;var p=ub(),_=ju(),E=/^\[object .+?Constructor\]$/,T=Object.prototype,D=Function.prototype.toString,L=T.hasOwnProperty,V=RegExp("^"+D.call(L).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function h(U){return U==null?!1:p(U)?V.test(D.call(U)):_(U)&&E.test(U)}return ih=h,ih}var rh,wd;function hb(){if(wd)return rh;wd=1;var p=cb();function _(E,T){var D=E==null?void 0:E[T];return p(D)?D:void 0}return rh=_,rh}var nh,kd;function fb(){if(kd)return nh;kd=1;var p=hb(),_=Vh(),E=ju(),T="[object Array]",D=Object.prototype,L=D.toString,V=p(Array,"isArray"),h=V||function(U){return E(U)&&_(U.length)&&L.call(U)==T};return nh=h,nh}var sh,Ed;function db(){if(Ed)return sh;Ed=1;var p=/^\d+$/,_=9007199254740991;function E(T,D){return T=typeof T=="number"||p.test(T)?+T:-1,D=D??_,T>-1&&T%1==0&&T<D}return sh=E,sh}var oh,Sd;function pb(){if(Sd)return oh;Sd=1;var p=Bp(),_=fb(),E=db(),T=Vh(),D=Oh(),L=Object.prototype,V=L.hasOwnProperty;function h(U){if(U==null)return[];D(U)||(U=Object(U));var R=U.length;R=R&&T(R)&&(_(U)||p(U))&&R||0;for(var ie=U.constructor,X=-1,K=typeof ie=="function"&&ie.prototype===U,Ae=Array(R),we=R>0;++X<R;)Ae[X]=X+"";for(var xe in U)!(we&&E(xe,R))&&!(xe=="constructor"&&(K||!V.call(U,xe)))&&Ae.push(xe);return Ae}return oh=h,oh}var ah,Td;function mb(){if(Td)return ah;Td=1;var p=ob(),_=pb();function E(T,D){return p(T,D,_)}return ah=E,ah}var lh,Id;function gb(){if(Id)return lh;Id=1;var p=mb(),_=Bp(),E=ju(),T="[object Object]",D=Object.prototype,L=D.hasOwnProperty,V=D.toString;function h(U){var R;if(!(E(U)&&V.call(U)==T&&!_(U))||!L.call(U,"constructor")&&(R=U.constructor,typeof R=="function"&&!(R instanceof R)))return!1;var ie;return p(U,function(X,K){ie=K}),ie===void 0||L.call(U,ie)}return lh=h,lh}(function(p){p.exports=function(_){var E={};function T(D){if(E[D])return E[D].exports;var L=E[D]={exports:{},id:D,loaded:!1};return _[D].call(L.exports,L,L.exports,T),L.loaded=!0,L.exports}return T.m=_,T.c=E,T.p="/lib/",T(0)}([function(_,E,T){_.exports=T(1)},function(_,E,T){Object.defineProperty(E,"__esModule",{value:!0}),E.union=T(2).default,E.any=T(12).default,E.nil=T(14).default,E.mapOf=T(16).default,E.arrayOf=T(18).default,E.record=T(20).default,E.optional=T(23).default,E.validate=T(25).default,E.deferred=T(26).default,E.createValidator=T(4).default,E.isValid=T(28).default},function(_,E,T){Object.defineProperty(E,"__esModule",{value:!0}),E.default=h;var D=T(3),L=V(D);function V(U){return U&&U.__esModule?U:{default:U}}function h(){for(var U=arguments.length,R=Array(U),ie=0;ie<U;ie++)R[ie]=arguments[ie];return new L.default(R)}},function(_,E,T){var D=function(){function ie(X,K){for(var Ae=0;Ae<K.length;Ae++){var we=K[Ae];we.enumerable=we.enumerable||!1,we.configurable=!0,"value"in we&&(we.writable=!0),Object.defineProperty(X,we.key,we)}}return function(X,K,Ae){return K&&ie(X.prototype,K),Ae&&ie(X,Ae),X}}();Object.defineProperty(E,"__esModule",{value:!0});var L=T(4),V=h(L);T(5),T(6);function h(ie){return ie&&ie.__esModule?ie:{default:ie}}function U(ie,X){if(!(ie instanceof X))throw new TypeError("Cannot call a class as a function")}var R=function(){function ie(X){U(this,ie),this.validators=[];var K=!0,Ae=!1,we=void 0;try{for(var xe=X[Symbol.iterator](),Te;!(K=(Te=xe.next()).done);K=!0){var Le=Te.value;this.validators.push((0,V.default)(Le))}}catch(Ze){Ae=!0,we=Ze}finally{try{!K&&xe.return&&xe.return()}finally{if(Ae)throw we}}}return D(ie,[{key:"isValid",value:function(K){var Ae=!0,we=!1,xe=void 0;try{for(var Te=this.validators[Symbol.iterator](),Le;!(Ae=(Le=Te.next()).done);Ae=!0){var Ze=Le.value;if(Ze.isValid(K))return!0}}catch(We){we=!0,xe=We}finally{try{!Ae&&Te.return&&Te.return()}finally{if(we)throw xe}}return!1}},{key:"getValidationResult",value:function(K){if(this.isValid(K))return{isValid:"true"};var Ae=this._getValidationDetails(K);return{isValid:"false",message:`Value doesn't match any of the expected variants.
Value: `+JSON.stringify(K)+`
Details: 
`+Ae.message,score:Ae.score}}},{key:"_getValidationDetails",value:function(K){var Ae=[],we=!0,xe=!1,Te=void 0;try{for(var Le=this.validators[Symbol.iterator](),Ze;!(we=(Ze=Le.next()).done);we=!0){var We=Ze.value;Ae.push(We.getValidationResult(K))}}catch(nt){xe=!0,Te=nt}finally{try{!we&&Le.return&&Le.return()}finally{if(xe)throw Te}}Ae.sort(function(nt,Tt){return nt.score<Tt.score?1:nt.score>Tt.score?-1:0}),Ae.length>3&&(Ae.length=3);var je=Ae.map(function(nt){return nt.message}).join(`
`);return{message:je,score:Ae[0].score}}}]),ie}();E.default=R},function(_,E,T){Object.defineProperty(E,"__esModule",{value:!0}),E.default=xe,T(5);var D=T(7),L=Ae(D),V=T(9),h=Ae(V),U=T(10),R=Ae(U),ie=T(3);Ae(ie);var X=T(11),K=Ae(X);function Ae(Te){return Te&&Te.__esModule?Te:{default:Te}}function we(Te){return Te&&typeof Symbol<"u"&&Te.constructor===Symbol?"symbol":typeof Te}function xe(Te){if(Te==null)throw Error("Null cannot be a valid validation descriptor");if(Te===String)return L.default;if(Te===Number)return h.default;if(Te===Boolean)return R.default;if((typeof Te>"u"?"undefined":we(Te))==="object"&&Te&&typeof Te.isValid=="function"&&typeof Te.getValidationResult=="function")return Te;if(typeof Te=="string"||typeof Te=="number"||typeof Te=="boolean")return new K.default(Te);throw new Error("Can't recognize this descriptor: "+Te)}},function(_,E,T){T(6)},function(_,E){},function(_,E,T){Object.defineProperty(E,"__esModule",{value:!0});var D=T(8),L=V(D);T(6),T(5);function V(U){return U&&U.__esModule?U:{default:U}}var h={isValid:function(R){return typeof R=="string"},getValidationResult:function(R){return h.isValid(R)?{isValid:"true"}:{isValid:"false",message:"String expected, "+(0,L.default)(R)+" given.",score:0}}};E.default=h},function(_,E){_.exports=rb()},function(_,E,T){Object.defineProperty(E,"__esModule",{value:!0});var D=T(8),L=V(D);T(6),T(5);function V(U){return U&&U.__esModule?U:{default:U}}var h={isValid:function(R){return typeof R=="number"},getValidationResult:function(R){return h.isValid(R)?{isValid:"true"}:{isValid:"false",message:"Number expected. '"+(0,L.default)(R)+"' given.",score:0}}};E.default=h},function(_,E,T){Object.defineProperty(E,"__esModule",{value:!0});var D=T(8),L=V(D);T(6),T(5);function V(U){return U&&U.__esModule?U:{default:U}}var h={isValid:function(R){return typeof R=="boolean"},getValidationResult:function(R){return h.isValid(R)?{isValid:"true"}:{isValid:"false",message:"Boolean expected. "+(0,L.default)(R)+" given.",score:0}}};E.default=h},function(_,E,T){var D=function(){function R(ie,X){for(var K=0;K<X.length;K++){var Ae=X[K];Ae.enumerable=Ae.enumerable||!1,Ae.configurable=!0,"value"in Ae&&(Ae.writable=!0),Object.defineProperty(ie,Ae.key,Ae)}}return function(ie,X,K){return X&&R(ie.prototype,X),K&&R(ie,K),ie}}();Object.defineProperty(E,"__esModule",{value:!0});var L=T(4);V(L),T(5),T(6);function V(R){return R&&R.__esModule?R:{default:R}}function h(R,ie){if(!(R instanceof ie))throw new TypeError("Cannot call a class as a function")}var U=function(){function R(ie){h(this,R),this.expectedValue=ie}return D(R,[{key:"isValid",value:function(X){return X===this.expectedValue}},{key:"getValidationResult",value:function(X){return this.isValid(X)?{isValid:"true"}:{isValid:"false",message:"Expected: "+JSON.stringify(this.expectedValue)+". Given: "+X,score:0}}}]),R}();E.default=U},function(_,E,T){Object.defineProperty(E,"__esModule",{value:!0});var D=T(13),L=V(D);function V(h){return h&&h.__esModule?h:{default:h}}E.default=L.default},function(_,E,T){Object.defineProperty(E,"__esModule",{value:!0});var D=T(8);L(D),T(6),T(5);function L(h){return h&&h.__esModule?h:{default:h}}var V={isValid:function(U){return!0},getValidationResult:function(U){return{isValid:"true"}}};E.default=V},function(_,E,T){Object.defineProperty(E,"__esModule",{value:!0});var D=T(15),L=V(D);function V(h){return h&&h.__esModule?h:{default:h}}E.default=L.default},function(_,E,T){Object.defineProperty(E,"__esModule",{value:!0});var D=T(8),L=V(D);T(6),T(5);function V(U){return U&&U.__esModule?U:{default:U}}var h={isValid:function(R){return R==null},getValidationResult:function(R){return h.isValid(R)?{isValid:"true"}:{isValid:"false",message:"Null expected. "+(0,L.default)(R)+" given.",score:0}}};E.default=h},function(_,E,T){Object.defineProperty(E,"__esModule",{value:!0}),E.default=h;var D=T(17),L=V(D);function V(U){return U&&U.__esModule?U:{default:U}}function h(U){return new L.default(U)}},function(_,E,T){var D=function(){function Ae(we,xe){for(var Te=0;Te<xe.length;Te++){var Le=xe[Te];Le.enumerable=Le.enumerable||!1,Le.configurable=!0,"value"in Le&&(Le.writable=!0),Object.defineProperty(we,Le.key,Le)}}return function(we,xe,Te){return xe&&Ae(we.prototype,xe),Te&&Ae(we,Te),we}}();Object.defineProperty(E,"__esModule",{value:!0});var L=T(8),V=R(L),h=T(4),U=R(h);T(6),T(5);function R(Ae){return Ae&&Ae.__esModule?Ae:{default:Ae}}function ie(Ae,we){if(!(Ae instanceof we))throw new TypeError("Cannot call a class as a function")}function X(Ae){return Ae&&typeof Symbol<"u"&&Ae.constructor===Symbol?"symbol":typeof Ae}var K=function(){function Ae(we){ie(this,Ae),this.validator=(0,U.default)(we)}return D(Ae,[{key:"isValid",value:function(xe){if(!((typeof xe>"u"?"undefined":X(xe))==="object"&&xe))return!1;var Te=Object.keys(xe),Le=!0,Ze=!1,We=void 0;try{for(var je=Te[Symbol.iterator](),nt;!(Le=(nt=je.next()).done);Le=!0){var Tt=nt.value,Ot=xe[Tt];if(this.validator.isValid(Ot)===!1)return!1}}catch(It){Ze=!0,We=It}finally{try{!Le&&je.return&&je.return()}finally{if(Ze)throw We}}return!0}},{key:"getValidationResult",value:function(xe){if(!((typeof xe>"u"?"undefined":X(xe))==="object"&&xe))return{isValid:"false",message:"Object expected. "+(0,V.default)(xe)+" given.",score:0};var Te=Object.keys(xe),Le=!0,Ze=!1,We=void 0;try{for(var je=Te[Symbol.iterator](),nt;!(Le=(nt=je.next()).done);Le=!0){var Tt=nt.value,Ot=xe[Tt],It=this.validator.getValidationResult(Ot);if(It.isValid==="false")return{isValid:"false",message:"Validation failed for key '"+Tt+"': "+It.message,score:1}}}catch(Kt){Ze=!0,We=Kt}finally{try{!Le&&je.return&&je.return()}finally{if(Ze)throw We}}return{isValid:"true"}}}]),Ae}();E.default=K},function(_,E,T){Object.defineProperty(E,"__esModule",{value:!0}),E.default=h;var D=T(19),L=V(D);function V(U){return U&&U.__esModule?U:{default:U}}function h(U){return new L.default(U)}},function(_,E,T){var D=function(){function K(Ae,we){for(var xe=0;xe<we.length;xe++){var Te=we[xe];Te.enumerable=Te.enumerable||!1,Te.configurable=!0,"value"in Te&&(Te.writable=!0),Object.defineProperty(Ae,Te.key,Te)}}return function(Ae,we,xe){return we&&K(Ae.prototype,we),xe&&K(Ae,xe),Ae}}();Object.defineProperty(E,"__esModule",{value:!0});var L=T(8),V=R(L),h=T(4),U=R(h);T(6),T(5);function R(K){return K&&K.__esModule?K:{default:K}}function ie(K,Ae){if(!(K instanceof Ae))throw new TypeError("Cannot call a class as a function")}var X=function(){function K(Ae){ie(this,K),this.validator=(0,U.default)(Ae)}return D(K,[{key:"isValid",value:function(we){if(!Array.isArray(we))return!1;var xe=!0,Te=!1,Le=void 0;try{for(var Ze=we[Symbol.iterator](),We;!(xe=(We=Ze.next()).done);xe=!0){var je=We.value;if(this.validator.isValid(je)===!1)return!1}}catch(nt){Te=!0,Le=nt}finally{try{!xe&&Ze.return&&Ze.return()}finally{if(Te)throw Le}}return!0}},{key:"getValidationResult",value:function(we){if(!Array.isArray(we))return{isValid:"false",message:"Array expected. "+(0,V.default)(we)+" given.",score:0};for(var xe=0;xe<we.length;xe++){var Te=we[xe],Le=this.validator.getValidationResult(Te);if(Le.isValid==="false")return{isValid:"false",message:"Validation failed on item #"+xe+": "+Le.message,score:1}}return{isValid:"true"}}}]),K}();E.default=X},function(_,E,T){Object.defineProperty(E,"__esModule",{value:!0}),E.default=h;var D=T(21),L=V(D);function V(U){return U&&U.__esModule?U:{default:U}}function h(U){return new L.default(U)}},function(_,E,T){var D=function(){function xe(Te,Le){for(var Ze=0;Ze<Le.length;Ze++){var We=Le[Ze];We.enumerable=We.enumerable||!1,We.configurable=!0,"value"in We&&(We.writable=!0),Object.defineProperty(Te,We.key,We)}}return function(Te,Le,Ze){return Le&&xe(Te.prototype,Le),Ze&&xe(Te,Ze),Te}}();Object.defineProperty(E,"__esModule",{value:!0});var L=T(8),V=X(L),h=T(22),U=X(h),R=T(4),ie=X(R);T(5),T(6);function X(xe){return xe&&xe.__esModule?xe:{default:xe}}function K(xe,Te){if(!(xe instanceof Te))throw new TypeError("Cannot call a class as a function")}function Ae(xe){return xe&&typeof Symbol<"u"&&xe.constructor===Symbol?"symbol":typeof xe}var we=function(){function xe(Te){if(K(this,xe),!((typeof Te>"u"?"undefined":Ae(Te))==="object"&&Te&&(0,U.default)(Te)))throw Error("A record must be defined by an object.");this.shape={};var Le=!0,Ze=!1,We=void 0;try{for(var je=Object.getOwnPropertyNames(Te)[Symbol.iterator](),nt;!(Le=(nt=je.next()).done);Le=!0){var Tt=nt.value;try{this.shape[Tt]=(0,ie.default)(Te[Tt])}catch(Kt){var Ot=Tt,It=Kt.stack;throw Kt.originalStack?(It=Kt.originalStack,Ot+="."+Kt.propertyName,Kt.propertyName=Ot):Kt.originalStack=Kt.stack,Kt.stack="Error defining prop '"+Ot+"': "+Kt.originalStack,Kt}}}catch(Kt){Ze=!0,We=Kt}finally{try{!Le&&je.return&&je.return()}finally{if(Ze)throw We}}}return D(xe,[{key:"isValid",value:function(Le){if(!((typeof Le>"u"?"undefined":Ae(Le))==="object"&&Le))return!1;var Ze=!0,We=!1,je=void 0;try{for(var nt=Object.keys(this.shape)[Symbol.iterator](),Tt;!(Ze=(Tt=nt.next()).done);Ze=!0){var Ot=Tt.value,It=this.shape[Ot];if(It.isValid(Le[Ot])===!1)return!1}}catch(Kt){We=!0,je=Kt}finally{try{!Ze&&nt.return&&nt.return()}finally{if(We)throw je}}return!0}},{key:"getValidationResult",value:function(Le){if(!((typeof Le>"u"?"undefined":Ae(Le))==="object"&&Le))return{isValid:"false",message:"Object expected, "+(0,V.default)(Le)+" given.",score:0};var Ze=0,We=!0,je=!1,nt=void 0;try{for(var Tt=Object.keys(this.shape)[Symbol.iterator](),Ot;!(We=(Ot=Tt.next()).done);We=!0){var It=Ot.value,Kt=this.shape[It],Lt=Kt.getValidationResult(Le[It]);if(Lt.isValid==="false")return{isValid:"false",message:"Error validating prop "+It+`:
 `+Lt.message,score:1+Ze};Ze++}}catch(kt){je=!0,nt=kt}finally{try{!We&&Tt.return&&Tt.return()}finally{if(je)throw nt}}return{isValid:"true"}}}]),xe}();E.default=we},function(_,E){_.exports=gb()},function(_,E,T){Object.defineProperty(E,"__esModule",{value:!0}),E.default=h;var D=T(24),L=V(D);function V(U){return U&&U.__esModule?U:{default:U}}function h(U){return new L.default(U)}},function(_,E,T){var D=function(){function ie(X,K){for(var Ae=0;Ae<K.length;Ae++){var we=K[Ae];we.enumerable=we.enumerable||!1,we.configurable=!0,"value"in we&&(we.writable=!0),Object.defineProperty(X,we.key,we)}}return function(X,K,Ae){return K&&ie(X.prototype,K),Ae&&ie(X,Ae),X}}();Object.defineProperty(E,"__esModule",{value:!0});var L=T(4),V=h(L);T(6),T(5);function h(ie){return ie&&ie.__esModule?ie:{default:ie}}function U(ie,X){if(!(ie instanceof X))throw new TypeError("Cannot call a class as a function")}var R=function(){function ie(X){U(this,ie),this.validator=(0,V.default)(X)}return D(ie,[{key:"isValid",value:function(K){return K?this.validator.isValid(K):!0}},{key:"getValidationResult",value:function(K){return K?this.validator.getValidationResult(K):{isValid:"true"}}}]),ie}();E.default=R},function(_,E,T){Object.defineProperty(E,"__esModule",{value:!0}),E.default=h;var D=T(4),L=V(D);function V(U){return U&&U.__esModule?U:{default:U}}function h(U,R){var ie=(0,L.default)(U),X=ie.getValidationResult(R);if(X.isValid==="false")throw Error(X.message);return R}},function(_,E,T){Object.defineProperty(E,"__esModule",{value:!0}),E.default=h;var D=T(27),L=V(D);function V(U){return U&&U.__esModule?U:{default:U}}function h(U){return new L.default(U)}},function(_,E,T){var D=function(){function X(K,Ae){for(var we=0;we<Ae.length;we++){var xe=Ae[we];xe.enumerable=xe.enumerable||!1,xe.configurable=!0,"value"in xe&&(xe.writable=!0),Object.defineProperty(K,xe.key,xe)}}return function(K,Ae,we){return Ae&&X(K.prototype,Ae),we&&X(K,we),K}}();Object.defineProperty(E,"__esModule",{value:!0});var L=T(8),V=U(L),h=T(4);U(h),T(6),T(5);function U(X){return X&&X.__esModule?X:{default:X}}function R(X,K){if(!(X instanceof K))throw new TypeError("Cannot call a class as a function")}var ie=function(){function X(K){if(R(this,X),typeof K!="function")throw Error("Deferred validator only accepts a function. "+(0,V.default)(K)+" given");this.deferredValidator=K}return D(X,[{key:"isValid",value:function(Ae){return this._getValidator().isValid(Ae)}},{key:"getValidationResult",value:function(Ae){return this._getValidator().getValidationResult(Ae)}},{key:"_getValidator",value:function(){return this.validator||(this.validator=this.deferredValidator()),this.validator}}]),X}();E.default=ie},function(_,E,T){Object.defineProperty(E,"__esModule",{value:!0}),E.default=h;var D=T(4),L=V(D);function V(U){return U&&U.__esModule?U:{default:U}}function h(U,R){var ie=(0,L.default)(U);return ie.isValid(R)}}])})(tb);function _b(p){let _,E,T,D;function L(U){p[6](U)}function V(U){p[7](U)}let h={style:"https://basemaps.cartocdn.com/gl/"+p[3]+"-gl-style/style.json",standardControls:!0,center:p[2],zoom:4};return p[0]!==void 0&&(h.map=p[0]),p[1]!==void 0&&(h.loaded=p[1]),_=new Rv({props:h}),yu.push(()=>Ef(_,"map",L)),yu.push(()=>Ef(_,"loaded",V)),{c(){Fo(_.$$.fragment)},l(U){Oo(_.$$.fragment,U)},m(U,R){Vo(_,U,R),D=!0},p(U,[R]){const ie={};!E&&R&1&&(E=!0,ie.map=U[0],kf(()=>E=!1)),!T&&R&2&&(T=!0,ie.loaded=U[1],kf(()=>T=!1)),_.$set(ie)},i(U){D||(dr(_.$$.fragment,U),D=!0)},o(U){Hr(_.$$.fragment,U),D=!1},d(U){No(_,U)}}}let Md=6;function yb(p,_,E){const T=[-119.449444,37.166111];let D,L=!1,V,h,U;const R=Pd();function ie(){R.length;let Te=R.map((Le,Ze)=>[Le[0],Le[1]]);return Te=Te.flat(),console.log(Te),["interpolate",["linear"],["get","pd"],...Te]}let{update:X}=_;Fg(()=>{fetch(`/phast/CA_hexbinned@${Md}_populated.json`).then(Te=>Te.json()).then(Te=>U=Te).then(()=>{console.log(ie());const Te=D.getStyle().layers;let Le;for(let Ze=0;Ze<Te.length;Ze++)if(Te[Ze].type==="symbol"){Le=Te[Ze].id;break}D.addSource("hexlayer",{type:"geojson",data:U}),D.addLayer({id:"hex",type:"fill",source:"hexlayer",layout:{},paint:{"fill-color":ie(),"fill-opacity":1}},Le),D.on("load",()=>{let Ze=gx(U);h=window.innerWidth/3,console.log(Ze),D.fitBounds(Ze,{padding:{top:50,left:10,bottom:50,right:h}}),console.log(),E(0,D._canvas.style.filter="none",D)}),D.on("click","hex",Ze=>{let We=Yx(Ze.lngLat.lat,Ze.lngLat.lng,Md);K(We,D),console.log(We),X({latlng:Ze.lngLat,hex:We,properties:Ze.features[0].properties})}),D.on("mouseenter","hex",()=>{D.getCanvas().style.cursor="pointer"}),D.on("mouseleave","hex",()=>{D.getCanvas().style.cursor=""})})});function K(Te,Le){let Ze,We,je,nt,Tt=Kx(Te).flat(),Ot=Tt.filter(function(Kt,Lt){return Lt%2==0}),It=Tt.filter(function(Kt,Lt){return Lt%2==1});console.log(Ot),console.log(It),Ze=Math.min(...Ot),We=Math.max(...Ot),je=Math.min(...It),nt=Math.max(...It),Le.fitBounds([[je,Ze],[nt,We]],{padding:{top:100,left:50,bottom:100,right:h},duration:750})}let Ae="positron";function we(Te){D=Te,E(0,D)}function xe(Te){L=Te,E(1,L)}return p.$$set=Te=>{"update"in Te&&E(4,X=Te.update)},p.$$.update=()=>{p.$$.dirty&35&&D&&L&&(E(5,V=D.getStyle().layers.filter(Te=>Te["source-layer"]==="place")),console.log(V))},[D,L,T,Ae,X,V,we,xe]}let vb=class extends Js{constructor(_){super(),eo(this,_,yb,_b,Ks,{update:4})}};function xb(p){let _,E,T,D,L,V;return _=new vb({props:{update:p[1]}}),T=new fv({props:{selectionData:p[0]}}),L=new Ug({}),{c(){Fo(_.$$.fragment),E=ws(),Fo(T.$$.fragment),D=ws(),Fo(L.$$.fragment)},l(h){Oo(_.$$.fragment,h),E=ks(h),Oo(T.$$.fragment,h),D=ks(h),Oo(L.$$.fragment,h)},m(h,U){Vo(_,h,U),lr(h,E,U),Vo(T,h,U),lr(h,D,U),Vo(L,h,U),V=!0},p(h,[U]){const R={};U&1&&(R.selectionData=h[0]),T.$set(R)},i(h){V||(dr(_.$$.fragment,h),dr(T.$$.fragment,h),dr(L.$$.fragment,h),V=!0)},o(h){Hr(_.$$.fragment,h),Hr(T.$$.fragment,h),Hr(L.$$.fragment,h),V=!1},d(h){h&&(ii(E),ii(D)),No(_,h),No(T,h),No(L,h)}}}function bb(p,_,E){let T={latlng:{lat:0,lng:0},hex:""};function D(L){console.log("updating!!"),E(0,T=L)}return[T,D]}class Tb extends Js{constructor(_){super(),eo(this,_,bb,xb,Ks,{})}}export{Tb as component};
