import{s as zA,e as Vy,t as hS,d as jy,f as Gy,h as fS,i as Kl,v as Zy,O as qy,k as YA,l as _w,m as dS,n as lp,P as Dw,Q as pS,p as Iu,R as Pw,o as PA,S as hf,T as vd,c as Ap,u as cp,g as up,a as hp,x as z_,U as B_,V as Ec,z as mS,W as _S,X as gw,Y as gS,b as bd,j as wd,r as yS}from"../chunks/scheduler.E4ipfQmR.js";import{S as Dc,i as Pc,t as es,g as ff,a as Is,c as df,f as L_,b as Mc,d as Sc,m as Ic,e as Cc}from"../chunks/index.ke5zcrb2.js";import{w as Wu,r as Uy}from"../chunks/index.soU_CCVS.js";function xS(ye){let te,Re,Te=`${ye[0].lat}, ${ye[0].lng}`,Ke;return{c(){te=Vy("div"),Re=Vy("h1"),Ke=hS(Te),this.h()},l(Ye){te=jy(Ye,"DIV",{class:!0});var Tt=Gy(te);Re=jy(Tt,"H1",{});var P=Gy(Re);Ke=fS(P,Te),P.forEach(Kl),Tt.forEach(Kl),this.h()},h(){Zy(te,"class",qy("modal")+" svelte-1lrhnes")},m(Ye,Tt){YA(Ye,te,Tt),_w(te,Re),_w(Re,Ke)},p(Ye,[Tt]){Tt&1&&Te!==(Te=`${Ye[0].lat}, ${Ye[0].lng}`)&&dS(Ke,Te)},i:lp,o:lp,d(Ye){Ye&&Kl(te)}}}function vS(ye,te,Re){let{selectedCoordinates:Te}=te;return ye.$$set=Ke=>{"selectedCoordinates"in Ke&&Re(0,Te=Ke.selectedCoordinates)},[Te]}class bS extends Dc{constructor(te){super(),Pc(this,te,vS,xS,zA,{selectedCoordinates:0})}}let wS=Date.now();function N_(ye){return`${ye}-${wS++}`}const Qy=Symbol.for("svelte-maplibre");function fp(){return pS(Qy)}function TS(ye){let te=new WeakMap;return Re=>{var Tt;let Te=te.get(Re.originalEvent);if(Te!==void 0)return Te;let Ye=(Tt=Re.target.queryRenderedFeatures(Re.point).find(P=>{var yt;return(yt=ye.get(P.layer.id))==null?void 0:yt.interactive}))==null?void 0:Tt.layer.id;return te.set(Re.originalEvent,Ye),Ye}}function ES(){let ye=new Map;return Dw(Qy,{map:Wu(null),source:Uy(null),layer:Uy(null),popupTarget:Uy(null),cluster:Wu(),loadedImages:Wu(new Set),minzoom:Wu(0),maxzoom:Wu(24),layerEvent:Wu(null),layerInfo:ye,eventTopMost:TS(ye)})}function yw(ye){return{subscribe:ye.subscribe}}function zw({key:ye,setPopupTarget:te=!1,setCluster:Re=!1,setMouseEvent:Te=!1}){let Ke=fp(),Ye=Wu(null),Tt=yw(Ye),P={...Ke,[ye]:yw(Ye)};if(te&&(P.popupTarget=Tt),Te){let yt=Wu(null);P.layerEvent=yt,Ke.layerEvent=yt}return Re&&(P.cluster=Wu()),Dw(Qy,P),{...Ke,self:Ye}}function MS(){return zw({key:"source",setCluster:!0})}function SS(ye=!0){return zw({key:"layer",setPopupTarget:ye,setMouseEvent:ye})}var Bw=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Lw(ye){return ye&&ye.__esModule&&Object.prototype.hasOwnProperty.call(ye,"default")?ye.default:ye}function IS(ye){if(ye.__esModule)return ye;var te=ye.default;if(typeof te=="function"){var Re=function Te(){return this instanceof Te?Reflect.construct(te,arguments,this.constructor):te.apply(this,arguments)};Re.prototype=te.prototype}else Re={};return Object.defineProperty(Re,"__esModule",{value:!0}),Object.keys(ye).forEach(function(Te){var Ke=Object.getOwnPropertyDescriptor(ye,Te);Object.defineProperty(Re,Te,Ke.get?Ke:{enumerable:!0,get:function(){return ye[Te]}})}),Re}var Rw={exports:{}};(function(ye,te){(function(Re,Te){ye.exports=Te()})(Bw,function(){var Re,Te,Ke;function Ye(P,yt){if(!Re)Re=yt;else if(!Te)Te=yt;else{var Ee="var sharedChunk = {}; ("+Re+")(sharedChunk); ("+Te+")(sharedChunk);",li={};Re(li),Ke=yt(li),typeof window<"u"&&(Ke.workerUrl=window.URL.createObjectURL(new Blob([Ee],{type:"text/javascript"})))}}Ye(["exports"],function(P){function yt(f,A,m,w){return new(m||(m=Promise))(function(D,U){function V(ae){try{ee(w.next(ae))}catch(fe){U(fe)}}function Y(ae){try{ee(w.throw(ae))}catch(fe){U(fe)}}function ee(ae){var fe;ae.done?D(ae.value):(fe=ae.value,fe instanceof m?fe:new m(function(_e){_e(fe)})).then(V,Y)}ee((w=w.apply(f,A||[])).next())})}function Ee(f){return f&&f.__esModule&&Object.prototype.hasOwnProperty.call(f,"default")?f.default:f}typeof SuppressedError=="function"&&SuppressedError;var li=Ot;function Ot(f,A){this.x=f,this.y=A}Ot.prototype={clone:function(){return new Ot(this.x,this.y)},add:function(f){return this.clone()._add(f)},sub:function(f){return this.clone()._sub(f)},multByPoint:function(f){return this.clone()._multByPoint(f)},divByPoint:function(f){return this.clone()._divByPoint(f)},mult:function(f){return this.clone()._mult(f)},div:function(f){return this.clone()._div(f)},rotate:function(f){return this.clone()._rotate(f)},rotateAround:function(f,A){return this.clone()._rotateAround(f,A)},matMult:function(f){return this.clone()._matMult(f)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(f){return this.x===f.x&&this.y===f.y},dist:function(f){return Math.sqrt(this.distSqr(f))},distSqr:function(f){var A=f.x-this.x,m=f.y-this.y;return A*A+m*m},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(f){return Math.atan2(this.y-f.y,this.x-f.x)},angleWith:function(f){return this.angleWithSep(f.x,f.y)},angleWithSep:function(f,A){return Math.atan2(this.x*A-this.y*f,this.x*f+this.y*A)},_matMult:function(f){var A=f[2]*this.x+f[3]*this.y;return this.x=f[0]*this.x+f[1]*this.y,this.y=A,this},_add:function(f){return this.x+=f.x,this.y+=f.y,this},_sub:function(f){return this.x-=f.x,this.y-=f.y,this},_mult:function(f){return this.x*=f,this.y*=f,this},_div:function(f){return this.x/=f,this.y/=f,this},_multByPoint:function(f){return this.x*=f.x,this.y*=f.y,this},_divByPoint:function(f){return this.x/=f.x,this.y/=f.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var f=this.y;return this.y=this.x,this.x=-f,this},_rotate:function(f){var A=Math.cos(f),m=Math.sin(f),w=m*this.x+A*this.y;return this.x=A*this.x-m*this.y,this.y=w,this},_rotateAround:function(f,A){var m=Math.cos(f),w=Math.sin(f),D=A.y+w*(this.x-A.x)+m*(this.y-A.y);return this.x=A.x+m*(this.x-A.x)-w*(this.y-A.y),this.y=D,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ot.convert=function(f){return f instanceof Ot?f:Array.isArray(f)?new Ot(f[0],f[1]):f};var Gt=Ee(li),Xr=Ti;function Ti(f,A,m,w){this.cx=3*f,this.bx=3*(m-f)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*A,this.by=3*(w-A)-this.cy,this.ay=1-this.cy-this.by,this.p1x=f,this.p1y=A,this.p2x=m,this.p2y=w}Ti.prototype={sampleCurveX:function(f){return((this.ax*f+this.bx)*f+this.cx)*f},sampleCurveY:function(f){return((this.ay*f+this.by)*f+this.cy)*f},sampleCurveDerivativeX:function(f){return(3*this.ax*f+2*this.bx)*f+this.cx},solveCurveX:function(f,A){if(A===void 0&&(A=1e-6),f<0)return 0;if(f>1)return 1;for(var m=f,w=0;w<8;w++){var D=this.sampleCurveX(m)-f;if(Math.abs(D)<A)return m;var U=this.sampleCurveDerivativeX(m);if(Math.abs(U)<1e-6)break;m-=D/U}var V=0,Y=1;for(m=f,w=0;w<20&&(D=this.sampleCurveX(m),!(Math.abs(D-f)<A));w++)f>D?V=m:Y=m,m=.5*(Y-V)+V;return m},solve:function(f,A){return this.sampleCurveY(this.solveCurveX(f,A))}};var cn=Ee(Xr);let qr,dr;function Tn(){return qr==null&&(qr=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),qr}function un(){if(dr==null&&(dr=!1,Tn())){const A=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(A){for(let w=0;w<5*5;w++){const D=4*w;A.fillStyle=`rgb(${D},${D+1},${D+2})`,A.fillRect(w%5,Math.floor(w/5),1,1)}const m=A.getImageData(0,0,5,5).data;for(let w=0;w<5*5*4;w++)if(w%4!=3&&m[w]!==w){dr=!0;break}}}return dr||!1}function _r(f,A,m,w){const D=new cn(f,A,m,w);return function(U){return D.solve(U)}}const ps=_r(.25,.1,.25,1);function En(f,A,m){return Math.min(m,Math.max(A,f))}function Ls(f,A,m){const w=m-A,D=((f-A)%w+w)%w+A;return D===A?m:D}function pn(f,...A){for(const m of A)for(const w in m)f[w]=m[w];return f}let As=1;function ct(f,A,m){const w={};for(const D in f)w[D]=A.call(m||this,f[D],D,f);return w}function Lt(f,A,m){const w={};for(const D in f)A.call(m||this,f[D],D,f)&&(w[D]=f[D]);return w}function fn(f){return Array.isArray(f)?f.map(fn):typeof f=="object"&&f?ct(f,fn):f}const mn={};function wi(f){mn[f]||(typeof console<"u"&&console.warn(f),mn[f]=!0)}function hr(f,A,m){return(m.y-f.y)*(A.x-f.x)>(A.y-f.y)*(m.x-f.x)}function kn(f){let A=0;for(let m,w,D=0,U=f.length,V=U-1;D<U;V=D++)m=f[D],w=f[V],A+=(w.x-m.x)*(m.y+w.y);return A}function Dn(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}let Rs=null;function Ao(f){return typeof ImageBitmap<"u"&&f instanceof ImageBitmap}const yo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function ts(f,A,m,w,D){return yt(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const U=new VideoFrame(f,{timestamp:0});try{const V=U==null?void 0:U.format;if(!V||!V.startsWith("BGR")&&!V.startsWith("RGB"))throw new Error(`Unrecognized format ${V}`);const Y=V.startsWith("BGR"),ee=new Uint8ClampedArray(w*D*4);if(yield U.copyTo(ee,function(ae,fe,_e,Se,Oe){const ce=4*Math.max(-fe,0),tt=(Math.max(0,_e)-_e)*Se*4+ce,at=4*Se,pt=Math.max(0,fe),Ct=Math.max(0,_e);return{rect:{x:pt,y:Ct,width:Math.min(ae.width,fe+Se)-pt,height:Math.min(ae.height,_e+Oe)-Ct},layout:[{offset:tt,stride:at}]}}(f,A,m,w,D)),Y)for(let ae=0;ae<ee.length;ae+=4){const fe=ee[ae];ee[ae]=ee[ae+2],ee[ae+2]=fe}return ee}finally{U.close()}})}let Ai,jr,Pn,Js;const Zn={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(f){const A=requestAnimationFrame(f);return{cancel:()=>cancelAnimationFrame(A)}},getImageData(f,A=0){return this.getImageCanvasContext(f).getImageData(-A,-A,f.width+2*A,f.height+2*A)},getImageCanvasContext(f){const A=window.document.createElement("canvas"),m=A.getContext("2d",{willReadFrequently:!0});if(!m)throw new Error("failed to create canvas 2d context");return A.width=f.width,A.height=f.height,m.drawImage(f,0,0,f.width,f.height),m},resolveURL:f=>(Pn||(Pn=document.createElement("a")),Pn.href=f,Pn.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(Js==null&&(Js=matchMedia("(prefers-reduced-motion: reduce)")),Js.matches)}},Pt={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};class nr extends Error{constructor(A,m,w,D){super(`AJAXError: ${m} (${A}): ${w}`),this.status=A,this.statusText=m,this.url=w,this.body=D}}const _n=Dn()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href,cs=f=>Pt.REGISTERED_PROTOCOLS[f.substring(0,f.indexOf("://"))];function aa(f,A){const m=new AbortController,w=new Request(f.url,{method:f.method||"GET",body:f.body,credentials:f.credentials,headers:f.headers,cache:f.cache,referrer:_n(),signal:m.signal});let D=!1,U=!1;return f.type==="json"&&w.headers.set("Accept","application/json"),U||fetch(w).then(V=>V.ok?(Y=>{(f.type==="arrayBuffer"||f.type==="image"?Y.arrayBuffer():f.type==="json"?Y.json():Y.text()).then(ee=>{U||(D=!0,A(null,ee,Y.headers.get("Cache-Control"),Y.headers.get("Expires")))}).catch(ee=>{U||A(new Error(ee.message))})})(V):V.blob().then(Y=>A(new nr(V.status,V.statusText,f.url,Y)))).catch(V=>{V.code!==20&&A(new Error(V.message))}),{cancel:()=>{U=!0,D||m.abort()}}}const Yo=function(f,A){if(/:\/\//.test(f.url)&&!/^https?:|^file:/.test(f.url)){if(Dn()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",f,A);if(!Dn())return(cs(f.url)||aa)(f,A)}if(!(/^file:/.test(m=f.url)||/^file:/.test(_n())&&!/^\w+:/.test(m))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return aa(f,A);if(Dn()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",f,A,void 0,!0)}var m;return function(w,D){const U=new XMLHttpRequest;U.open(w.method||"GET",w.url,!0),w.type!=="arrayBuffer"&&w.type!=="image"||(U.responseType="arraybuffer");for(const V in w.headers)U.setRequestHeader(V,w.headers[V]);return w.type==="json"&&(U.responseType="text",U.setRequestHeader("Accept","application/json")),U.withCredentials=w.credentials==="include",U.onerror=()=>{D(new Error(U.statusText))},U.onload=()=>{if((U.status>=200&&U.status<300||U.status===0)&&U.response!==null){let V=U.response;if(w.type==="json")try{V=JSON.parse(U.response)}catch(Y){return D(Y)}D(null,V,U.getResponseHeader("Cache-Control"),U.getResponseHeader("Expires"))}else{const V=new Blob([U.response],{type:U.getResponseHeader("Content-Type")});D(new nr(U.status,U.statusText,w.url,V))}},U.send(w.body),{cancel:()=>U.abort()}}(f,A)},Di=function(f,A){return Yo(pn(f,{type:"arrayBuffer"}),A)};function Ir(f){if(!f||f.indexOf("://")<=0||f.indexOf("data:image/")===0||f.indexOf("blob:")===0)return!0;const A=new URL(f),m=window.location;return A.protocol===m.protocol&&A.host===m.host}function $s(f,A,m){m[f]&&m[f].indexOf(A)!==-1||(m[f]=m[f]||[],m[f].push(A))}function Cs(f,A,m){if(m&&m[f]){const w=m[f].indexOf(A);w!==-1&&m[f].splice(w,1)}}class Zt{constructor(A,m={}){pn(this,m),this.type=A}}class Ue extends Zt{constructor(A,m={}){super("error",pn({error:A},m))}}class He{on(A,m){return this._listeners=this._listeners||{},$s(A,m,this._listeners),this}off(A,m){return Cs(A,m,this._listeners),Cs(A,m,this._oneTimeListeners),this}once(A,m){return m?(this._oneTimeListeners=this._oneTimeListeners||{},$s(A,m,this._oneTimeListeners),this):new Promise(w=>this.once(A,w))}fire(A,m){typeof A=="string"&&(A=new Zt(A,m||{}));const w=A.type;if(this.listens(w)){A.target=this;const D=this._listeners&&this._listeners[w]?this._listeners[w].slice():[];for(const Y of D)Y.call(this,A);const U=this._oneTimeListeners&&this._oneTimeListeners[w]?this._oneTimeListeners[w].slice():[];for(const Y of U)Cs(w,Y,this._oneTimeListeners),Y.call(this,A);const V=this._eventedParent;V&&(pn(A,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),V.fire(A))}else A instanceof Ue&&console.error(A.error);return this}listens(A){return this._listeners&&this._listeners[A]&&this._listeners[A].length>0||this._oneTimeListeners&&this._oneTimeListeners[A]&&this._oneTimeListeners[A].length>0||this._eventedParent&&this._eventedParent.listens(A)}setEventedParent(A,m){return this._eventedParent=A,this._eventedParentData=m,this}}var Be={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Rt=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Qt(f,A){const m={};for(const w in f)w!=="ref"&&(m[w]=f[w]);return Rt.forEach(w=>{w in A&&(m[w]=A[w])}),m}function ii(f,A){if(Array.isArray(f)){if(!Array.isArray(A)||f.length!==A.length)return!1;for(let m=0;m<f.length;m++)if(!ii(f[m],A[m]))return!1;return!0}if(typeof f=="object"&&f!==null&&A!==null){if(typeof A!="object"||Object.keys(f).length!==Object.keys(A).length)return!1;for(const m in f)if(!ii(f[m],A[m]))return!1;return!0}return f===A}const ti={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Ht(f,A,m){m.push({command:ti.addSource,args:[f,A[f]]})}function Ri(f,A,m){A.push({command:ti.removeSource,args:[f]}),m[f]=!0}function Zi(f,A,m,w){Ri(f,m,w),Ht(f,A,m)}function Yi(f,A,m){let w;for(w in f[m])if(Object.prototype.hasOwnProperty.call(f[m],w)&&w!=="data"&&!ii(f[m][w],A[m][w]))return!1;for(w in A[m])if(Object.prototype.hasOwnProperty.call(A[m],w)&&w!=="data"&&!ii(f[m][w],A[m][w]))return!1;return!0}function Yr(f,A,m,w,D,U){let V;for(V in A=A||{},f=f||{})Object.prototype.hasOwnProperty.call(f,V)&&(ii(f[V],A[V])||m.push({command:U,args:[w,V,A[V],D]}));for(V in A)Object.prototype.hasOwnProperty.call(A,V)&&!Object.prototype.hasOwnProperty.call(f,V)&&(ii(f[V],A[V])||m.push({command:U,args:[w,V,A[V],D]}))}function gn(f){return f.id}function rs(f,A){return f[A.id]=A,f}class ni{constructor(A,m,w,D){this.message=(A?`${A}: `:"")+w,D&&(this.identifier=D),m!=null&&m.__line__&&(this.line=m.__line__)}}function yn(f,...A){for(const m of A)for(const w in m)f[w]=m[w];return f}class vr extends Error{constructor(A,m){super(m),this.message=m,this.key=A}}class bs{constructor(A,m=[]){this.parent=A,this.bindings={};for(const[w,D]of m)this.bindings[w]=D}concat(A){return new bs(this,A)}get(A){if(this.bindings[A])return this.bindings[A];if(this.parent)return this.parent.get(A);throw new Error(`${A} not found in scope.`)}has(A){return!!this.bindings[A]||!!this.parent&&this.parent.has(A)}}const us={kind:"null"},pi={kind:"number"},br={kind:"string"},wr={kind:"boolean"},zn={kind:"color"},co={kind:"object"},Sr={kind:"value"},kt={kind:"collator"},we={kind:"formatted"},Ae={kind:"padding"},pe={kind:"resolvedImage"},Me={kind:"variableAnchorOffsetCollection"};function Le(f,A){return{kind:"array",itemType:f,N:A}}function Ne(f){if(f.kind==="array"){const A=Ne(f.itemType);return typeof f.N=="number"?`array<${A}, ${f.N}>`:f.itemType.kind==="value"?"array":`array<${A}>`}return f.kind}const $e=[us,pi,br,wr,zn,we,co,Le(Sr),Ae,pe,Me];function Qe(f,A){if(A.kind==="error")return null;if(f.kind==="array"){if(A.kind==="array"&&(A.N===0&&A.itemType.kind==="value"||!Qe(f.itemType,A.itemType))&&(typeof f.N!="number"||f.N===A.N))return null}else{if(f.kind===A.kind)return null;if(f.kind==="value"){for(const m of $e)if(!Qe(m,A))return null}}return`Expected ${Ne(f)} but found ${Ne(A)} instead.`}function Ge(f,A){return A.some(m=>m.kind===f.kind)}function We(f,A){return A.some(m=>m==="null"?f===null:m==="array"?Array.isArray(f):m==="object"?f&&!Array.isArray(f)&&typeof f=="object":m===typeof f)}function Et(f,A){return f.kind==="array"&&A.kind==="array"?f.itemType.kind===A.itemType.kind&&typeof f.N=="number":f.kind===A.kind}const xe=.96422,Ie=.82521,ut=4/29,zt=6/29,o=3*zt*zt,oe=zt*zt*zt,$t=Math.PI/180,_i=180/Math.PI;function mi(f){return(f%=360)<0&&(f+=360),f}function si([f,A,m,w]){let D,U;const V=gr((.2225045*(f=hi(f))+.7168786*(A=hi(A))+.0606169*(m=hi(m)))/1);f===A&&A===m?D=U=V:(D=gr((.4360747*f+.3850649*A+.1430804*m)/xe),U=gr((.0139322*f+.0971045*A+.7141733*m)/Ie));const Y=116*V-16;return[Y<0?0:Y,500*(D-V),200*(V-U),w]}function hi(f){return f<=.04045?f/12.92:Math.pow((f+.055)/1.055,2.4)}function gr(f){return f>oe?Math.pow(f,1/3):f/o+ut}function yi([f,A,m,w]){let D=(f+16)/116,U=isNaN(A)?D:D+A/500,V=isNaN(m)?D:D-m/200;return D=1*hn(D),U=xe*hn(U),V=Ie*hn(V),[Pi(3.1338561*U-1.6168667*D-.4906146*V),Pi(-.9787684*U+1.9161415*D+.033454*V),Pi(.0719453*U-.2289914*D+1.4052427*V),w]}function Pi(f){return(f=f<=.00304?12.92*f:1.055*Math.pow(f,1/2.4)-.055)<0?0:f>1?1:f}function hn(f){return f>zt?f*f*f:o*(f-ut)}function eo(f){return parseInt(f.padEnd(2,f),16)/255}function KA(f,A){return Vs(A?f/100:f,0,1)}function Vs(f,A,m){return Math.min(Math.max(A,f),m)}function js(f){return!f.some(Number.isNaN)}const Ro={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class en{constructor(A,m,w,D=1,U=!0){this.r=A,this.g=m,this.b=w,this.a=D,U||(this.r*=D,this.g*=D,this.b*=D,D||this.overwriteGetter("rgb",[A,m,w,D]))}static parse(A){if(A instanceof en)return A;if(typeof A!="string")return;const m=function(w){if((w=w.toLowerCase().trim())==="transparent")return[0,0,0,0];const D=Ro[w];if(D){const[V,Y,ee]=D;return[V/255,Y/255,ee/255,1]}if(w.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(w)){const V=w.length<6?1:2;let Y=1;return[eo(w.slice(Y,Y+=V)),eo(w.slice(Y,Y+=V)),eo(w.slice(Y,Y+=V)),eo(w.slice(Y,Y+V)||"ff")]}if(w.startsWith("rgb")){const V=w.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(V){const[Y,ee,ae,fe,_e,Se,Oe,ce,tt,at,pt,Ct]=V,bt=[fe||" ",Oe||" ",at].join("");if(bt==="  "||bt==="  /"||bt===",,"||bt===",,,"){const me=[ae,Se,tt].join(""),Vt=me==="%%%"?100:me===""?255:0;if(Vt){const oi=[Vs(+ee/Vt,0,1),Vs(+_e/Vt,0,1),Vs(+ce/Vt,0,1),pt?KA(+pt,Ct):1];if(js(oi))return oi}}return}}const U=w.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(U){const[V,Y,ee,ae,fe,_e,Se,Oe,ce]=U,tt=[ee||" ",fe||" ",Se].join("");if(tt==="  "||tt==="  /"||tt===",,"||tt===",,,"){const at=[+Y,Vs(+ae,0,100),Vs(+_e,0,100),Oe?KA(+Oe,ce):1];if(js(at))return function([pt,Ct,bt,me]){function Vt(oi){const Si=(oi+pt/30)%12,tr=Ct*Math.min(bt,1-bt);return bt-tr*Math.max(-1,Math.min(Si-3,9-Si,1))}return pt=mi(pt),Ct/=100,bt/=100,[Vt(0),Vt(8),Vt(4),me]}(at)}}}(A);return m?new en(...m,!1):void 0}get rgb(){const{r:A,g:m,b:w,a:D}=this,U=D||1/0;return this.overwriteGetter("rgb",[A/U,m/U,w/U,D])}get hcl(){return this.overwriteGetter("hcl",function(A){const[m,w,D,U]=si(A),V=Math.sqrt(w*w+D*D);return[Math.round(1e4*V)?mi(Math.atan2(D,w)*_i):NaN,V,m,U]}(this.rgb))}get lab(){return this.overwriteGetter("lab",si(this.rgb))}overwriteGetter(A,m){return Object.defineProperty(this,A,{value:m}),m}toString(){const[A,m,w,D]=this.rgb;return`rgba(${[A,m,w].map(U=>Math.round(255*U)).join(",")},${D})`}}en.black=new en(0,0,0,1),en.white=new en(1,1,1,1),en.transparent=new en(0,0,0,0),en.red=new en(1,0,0,1);class Ko{constructor(A,m,w){this.sensitivity=A?m?"variant":"case":m?"accent":"base",this.locale=w,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(A,m){return this.collator.compare(A,m)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class kr{constructor(A,m,w,D,U){this.text=A,this.image=m,this.scale=w,this.fontStack=D,this.textColor=U}}class gt{constructor(A){this.sections=A}static fromString(A){return new gt([new kr(A,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(A=>A.text.length!==0||A.image&&A.image.name.length!==0)}static factory(A){return A instanceof gt?A:gt.fromString(A)}toString(){return this.sections.length===0?"":this.sections.map(A=>A.text).join("")}}class Ci{constructor(A){this.values=A.slice()}static parse(A){if(A instanceof Ci)return A;if(typeof A=="number")return new Ci([A,A,A,A]);if(Array.isArray(A)&&!(A.length<1||A.length>4)){for(const m of A)if(typeof m!="number")return;switch(A.length){case 1:A=[A[0],A[0],A[0],A[0]];break;case 2:A=[A[0],A[1],A[0],A[1]];break;case 3:A=[A[0],A[1],A[2],A[1]]}return new Ci(A)}}toString(){return JSON.stringify(this.values)}}const et=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class ar{constructor(A){this.values=A.slice()}static parse(A){if(A instanceof ar)return A;if(Array.isArray(A)&&!(A.length<1)&&A.length%2==0){for(let m=0;m<A.length;m+=2){const w=A[m],D=A[m+1];if(typeof w!="string"||!et.has(w)||!Array.isArray(D)||D.length!==2||typeof D[0]!="number"||typeof D[1]!="number")return}return new ar(A)}}toString(){return JSON.stringify(this.values)}}class to{constructor(A){this.name=A.name,this.available=A.available}toString(){return this.name}static fromString(A){return A?new to({name:A,available:!1}):null}}function BA(f,A,m,w){return typeof f=="number"&&f>=0&&f<=255&&typeof A=="number"&&A>=0&&A<=255&&typeof m=="number"&&m>=0&&m<=255?w===void 0||typeof w=="number"&&w>=0&&w<=1?null:`Invalid rgba value [${[f,A,m,w].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof w=="number"?[f,A,m,w]:[f,A,m]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Dl(f){if(f===null||typeof f=="string"||typeof f=="boolean"||typeof f=="number"||f instanceof en||f instanceof Ko||f instanceof gt||f instanceof Ci||f instanceof ar||f instanceof to)return!0;if(Array.isArray(f)){for(const A of f)if(!Dl(A))return!1;return!0}if(typeof f=="object"){for(const A in f)if(!Dl(f[A]))return!1;return!0}return!1}function st(f){if(f===null)return us;if(typeof f=="string")return br;if(typeof f=="boolean")return wr;if(typeof f=="number")return pi;if(f instanceof en)return zn;if(f instanceof Ko)return kt;if(f instanceof gt)return we;if(f instanceof Ci)return Ae;if(f instanceof ar)return Me;if(f instanceof to)return pe;if(Array.isArray(f)){const A=f.length;let m;for(const w of f){const D=st(w);if(m){if(m===D)continue;m=Sr;break}m=D}return Le(m||Sr,A)}return co}function xn(f){const A=typeof f;return f===null?"":A==="string"||A==="number"||A==="boolean"?String(f):f instanceof en||f instanceof gt||f instanceof Ci||f instanceof ar||f instanceof to?f.toString():JSON.stringify(f)}class Ze{constructor(A,m){this.type=A,this.value=m}static parse(A,m){if(A.length!==2)return m.error(`'literal' expression requires exactly one argument, but found ${A.length-1} instead.`);if(!Dl(A[1]))return m.error("invalid value");const w=A[1];let D=st(w);const U=m.expectedType;return D.kind!=="array"||D.N!==0||!U||U.kind!=="array"||typeof U.N=="number"&&U.N!==0||(D=U),new Ze(D,w)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class hs{constructor(A){this.name="ExpressionEvaluationError",this.message=A}toJSON(){return this.message}}const Jl={string:br,number:pi,boolean:wr,object:co};class uo{constructor(A,m){this.type=A,this.args=m}static parse(A,m){if(A.length<2)return m.error("Expected at least one argument.");let w,D=1;const U=A[0];if(U==="array"){let Y,ee;if(A.length>2){const ae=A[1];if(typeof ae!="string"||!(ae in Jl)||ae==="object")return m.error('The item type argument of "array" must be one of string, number, boolean',1);Y=Jl[ae],D++}else Y=Sr;if(A.length>3){if(A[2]!==null&&(typeof A[2]!="number"||A[2]<0||A[2]!==Math.floor(A[2])))return m.error('The length argument to "array" must be a positive integer literal',2);ee=A[2],D++}w=Le(Y,ee)}else{if(!Jl[U])throw new Error(`Types doesn't contain name = ${U}`);w=Jl[U]}const V=[];for(;D<A.length;D++){const Y=m.parse(A[D],D,Sr);if(!Y)return null;V.push(Y)}return new uo(w,V)}evaluate(A){for(let m=0;m<this.args.length;m++){const w=this.args[m].evaluate(A);if(!Qe(this.type,st(w)))return w;if(m===this.args.length-1)throw new hs(`Expected value to be of type ${Ne(this.type)}, but found ${Ne(st(w))} instead.`)}throw new Error}eachChild(A){this.args.forEach(A)}outputDefined(){return this.args.every(A=>A.outputDefined())}}const JA={"to-boolean":wr,"to-color":zn,"to-number":pi,"to-string":br};class Wi{constructor(A,m){this.type=A,this.args=m}static parse(A,m){if(A.length<2)return m.error("Expected at least one argument.");const w=A[0];if(!JA[w])throw new Error(`Can't parse ${w} as it is not part of the known types`);if((w==="to-boolean"||w==="to-string")&&A.length!==2)return m.error("Expected one argument.");const D=JA[w],U=[];for(let V=1;V<A.length;V++){const Y=m.parse(A[V],V,Sr);if(!Y)return null;U.push(Y)}return new Wi(D,U)}evaluate(A){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(A);case"color":{let m,w;for(const D of this.args){if(m=D.evaluate(A),w=null,m instanceof en)return m;if(typeof m=="string"){const U=A.parseColor(m);if(U)return U}else if(Array.isArray(m)&&(w=m.length<3||m.length>4?`Invalid rbga value ${JSON.stringify(m)}: expected an array containing either three or four numeric values.`:BA(m[0],m[1],m[2],m[3]),!w))return new en(m[0]/255,m[1]/255,m[2]/255,m[3])}throw new hs(w||`Could not parse color from value '${typeof m=="string"?m:JSON.stringify(m)}'`)}case"padding":{let m;for(const w of this.args){m=w.evaluate(A);const D=Ci.parse(m);if(D)return D}throw new hs(`Could not parse padding from value '${typeof m=="string"?m:JSON.stringify(m)}'`)}case"variableAnchorOffsetCollection":{let m;for(const w of this.args){m=w.evaluate(A);const D=ar.parse(m);if(D)return D}throw new hs(`Could not parse variableAnchorOffsetCollection from value '${typeof m=="string"?m:JSON.stringify(m)}'`)}case"number":{let m=null;for(const w of this.args){if(m=w.evaluate(A),m===null)return 0;const D=Number(m);if(!isNaN(D))return D}throw new hs(`Could not convert ${JSON.stringify(m)} to number.`)}case"formatted":return gt.fromString(xn(this.args[0].evaluate(A)));case"resolvedImage":return to.fromString(xn(this.args[0].evaluate(A)));default:return xn(this.args[0].evaluate(A))}}eachChild(A){this.args.forEach(A)}outputDefined(){return this.args.every(A=>A.outputDefined())}}const dn=["Unknown","Point","LineString","Polygon"];class Jo{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?dn[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(A){let m=this._parseColorCache[A];return m||(m=this._parseColorCache[A]=en.parse(A)),m}}class Gs{constructor(A,m,w=[],D,U=new bs,V=[]){this.registry=A,this.path=w,this.key=w.map(Y=>`[${Y}]`).join(""),this.scope=U,this.errors=V,this.expectedType=D,this._isConstant=m}parse(A,m,w,D,U={}){return m?this.concat(m,w,D)._parse(A,U):this._parse(A,U)}_parse(A,m){function w(D,U,V){return V==="assert"?new uo(U,[D]):V==="coerce"?new Wi(U,[D]):D}if(A!==null&&typeof A!="string"&&typeof A!="boolean"&&typeof A!="number"||(A=["literal",A]),Array.isArray(A)){if(A.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const D=A[0];if(typeof D!="string")return this.error(`Expression name must be a string, but found ${typeof D} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const U=this.registry[D];if(U){let V=U.parse(A,this);if(!V)return null;if(this.expectedType){const Y=this.expectedType,ee=V.type;if(Y.kind!=="string"&&Y.kind!=="number"&&Y.kind!=="boolean"&&Y.kind!=="object"&&Y.kind!=="array"||ee.kind!=="value")if(Y.kind!=="color"&&Y.kind!=="formatted"&&Y.kind!=="resolvedImage"||ee.kind!=="value"&&ee.kind!=="string")if(Y.kind!=="padding"||ee.kind!=="value"&&ee.kind!=="number"&&ee.kind!=="array")if(Y.kind!=="variableAnchorOffsetCollection"||ee.kind!=="value"&&ee.kind!=="array"){if(this.checkSubtype(Y,ee))return null}else V=w(V,Y,m.typeAnnotation||"coerce");else V=w(V,Y,m.typeAnnotation||"coerce");else V=w(V,Y,m.typeAnnotation||"coerce");else V=w(V,Y,m.typeAnnotation||"assert")}if(!(V instanceof Ze)&&V.type.kind!=="resolvedImage"&&this._isConstant(V)){const Y=new Jo;try{V=new Ze(V.type,V.evaluate(Y))}catch(ee){return this.error(ee.message),null}}return V}return this.error(`Unknown expression "${D}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(A===void 0?"'undefined' value invalid. Use null instead.":typeof A=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof A} instead.`)}concat(A,m,w){const D=typeof A=="number"?this.path.concat(A):this.path,U=w?this.scope.concat(w):this.scope;return new Gs(this.registry,this._isConstant,D,m||null,U,this.errors)}error(A,...m){const w=`${this.key}${m.map(D=>`[${D}]`).join("")}`;this.errors.push(new vr(w,A))}checkSubtype(A,m){const w=Qe(A,m);return w&&this.error(w),w}}class Yn{constructor(A,m,w){this.type=kt,this.locale=w,this.caseSensitive=A,this.diacriticSensitive=m}static parse(A,m){if(A.length!==2)return m.error("Expected one argument.");const w=A[1];if(typeof w!="object"||Array.isArray(w))return m.error("Collator options argument must be an object.");const D=m.parse(w["case-sensitive"]!==void 0&&w["case-sensitive"],1,wr);if(!D)return null;const U=m.parse(w["diacritic-sensitive"]!==void 0&&w["diacritic-sensitive"],1,wr);if(!U)return null;let V=null;return w.locale&&(V=m.parse(w.locale,1,br),!V)?null:new Yn(D,U,V)}evaluate(A){return new Ko(this.caseSensitive.evaluate(A),this.diacriticSensitive.evaluate(A),this.locale?this.locale.evaluate(A):null)}eachChild(A){A(this.caseSensitive),A(this.diacriticSensitive),this.locale&&A(this.locale)}outputDefined(){return!1}}const xo=8192;function Fs(f,A){f[0]=Math.min(f[0],A[0]),f[1]=Math.min(f[1],A[1]),f[2]=Math.max(f[2],A[0]),f[3]=Math.max(f[3],A[1])}function Pl(f,A){return!(f[0]<=A[0]||f[2]>=A[2]||f[1]<=A[1]||f[3]>=A[3])}function $A(f,A){const m=(180+f[0])/360,w=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+f[1]*Math.PI/360)))/360,D=Math.pow(2,A.z);return[Math.round(m*D*xo),Math.round(w*D*xo)]}function ec(f,A,m){const w=f[0]-A[0],D=f[1]-A[1],U=f[0]-m[0],V=f[1]-m[1];return w*V-U*D==0&&w*U<=0&&D*V<=0}function zl(f,A){let m=!1;for(let V=0,Y=A.length;V<Y;V++){const ee=A[V];for(let ae=0,fe=ee.length;ae<fe-1;ae++){if(ec(f,ee[ae],ee[ae+1]))return!1;(D=ee[ae])[1]>(w=f)[1]!=(U=ee[ae+1])[1]>w[1]&&w[0]<(U[0]-D[0])*(w[1]-D[1])/(U[1]-D[1])+D[0]&&(m=!m)}}var w,D,U;return m}function fA(f,A){for(let m=0;m<A.length;m++)if(zl(f,A[m]))return!0;return!1}function ns(f,A,m,w){const D=w[0]-m[0],U=w[1]-m[1],V=(f[0]-m[0])*U-D*(f[1]-m[1]),Y=(A[0]-m[0])*U-D*(A[1]-m[1]);return V>0&&Y<0||V<0&&Y>0}function tc(f,A,m){for(const ae of m)for(let fe=0;fe<ae.length-1;++fe)if((Y=[(V=ae[fe+1])[0]-(U=ae[fe])[0],V[1]-U[1]])[0]*(ee=[(D=A)[0]-(w=f)[0],D[1]-w[1]])[1]-Y[1]*ee[0]!=0&&ns(w,D,U,V)&&ns(U,V,w,D))return!0;var w,D,U,V,Y,ee;return!1}function qn(f,A){for(let m=0;m<f.length;++m)if(!zl(f[m],A))return!1;for(let m=0;m<f.length-1;++m)if(tc(f[m],f[m+1],A))return!1;return!0}function dA(f,A){for(let m=0;m<A.length;m++)if(qn(f,A[m]))return!0;return!1}function Jt(f,A,m){const w=[];for(let D=0;D<f.length;D++){const U=[];for(let V=0;V<f[D].length;V++){const Y=$A(f[D][V],m);Fs(A,Y),U.push(Y)}w.push(U)}return w}function $i(f,A,m){const w=[];for(let D=0;D<f.length;D++){const U=Jt(f[D],A,m);w.push(U)}return w}function ss(f,A,m,w){if(f[0]<m[0]||f[0]>m[2]){const D=.5*w;let U=f[0]-m[0]>D?-w:m[0]-f[0]>D?w:0;U===0&&(U=f[0]-m[2]>D?-w:m[2]-f[0]>D?w:0),f[0]+=U}Fs(A,f)}function xt(f,A,m,w){const D=Math.pow(2,w.z)*xo,U=[w.x*xo,w.y*xo],V=[];for(const Y of f)for(const ee of Y){const ae=[ee.x+U[0],ee.y+U[1]];ss(ae,A,m,D),V.push(ae)}return V}function gi(f,A,m,w){const D=Math.pow(2,w.z)*xo,U=[w.x*xo,w.y*xo],V=[];for(const ee of f){const ae=[];for(const fe of ee){const _e=[fe.x+U[0],fe.y+U[1]];Fs(A,_e),ae.push(_e)}V.push(ae)}if(A[2]-A[0]<=D/2){(Y=A)[0]=Y[1]=1/0,Y[2]=Y[3]=-1/0;for(const ee of V)for(const ae of ee)ss(ae,A,m,D)}var Y;return V}class Fo{constructor(A,m){this.type=wr,this.geojson=A,this.geometries=m}static parse(A,m){if(A.length!==2)return m.error(`'within' expression requires exactly one argument, but found ${A.length-1} instead.`);if(Dl(A[1])){const w=A[1];if(w.type==="FeatureCollection")for(let D=0;D<w.features.length;++D){const U=w.features[D].geometry.type;if(U==="Polygon"||U==="MultiPolygon")return new Fo(w,w.features[D].geometry)}else if(w.type==="Feature"){const D=w.geometry.type;if(D==="Polygon"||D==="MultiPolygon")return new Fo(w,w.geometry)}else if(w.type==="Polygon"||w.type==="MultiPolygon")return new Fo(w,w)}return m.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(A){if(A.geometry()!=null&&A.canonicalID()!=null){if(A.geometryType()==="Point")return function(m,w){const D=[1/0,1/0,-1/0,-1/0],U=[1/0,1/0,-1/0,-1/0],V=m.canonicalID();if(w.type==="Polygon"){const Y=Jt(w.coordinates,U,V),ee=xt(m.geometry(),D,U,V);if(!Pl(D,U))return!1;for(const ae of ee)if(!zl(ae,Y))return!1}if(w.type==="MultiPolygon"){const Y=$i(w.coordinates,U,V),ee=xt(m.geometry(),D,U,V);if(!Pl(D,U))return!1;for(const ae of ee)if(!fA(ae,Y))return!1}return!0}(A,this.geometries);if(A.geometryType()==="LineString")return function(m,w){const D=[1/0,1/0,-1/0,-1/0],U=[1/0,1/0,-1/0,-1/0],V=m.canonicalID();if(w.type==="Polygon"){const Y=Jt(w.coordinates,U,V),ee=gi(m.geometry(),D,U,V);if(!Pl(D,U))return!1;for(const ae of ee)if(!qn(ae,Y))return!1}if(w.type==="MultiPolygon"){const Y=$i(w.coordinates,U,V),ee=gi(m.geometry(),D,U,V);if(!Pl(D,U))return!1;for(const ae of ee)if(!dA(ae,Y))return!1}return!0}(A,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class $o{constructor(A,m){this.type=m.type,this.name=A,this.boundExpression=m}static parse(A,m){if(A.length!==2||typeof A[1]!="string")return m.error("'var' expression requires exactly one string literal argument.");const w=A[1];return m.scope.has(w)?new $o(w,m.scope.get(w)):m.error(`Unknown variable "${w}". Make sure "${w}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(A){return this.boundExpression.evaluate(A)}eachChild(){}outputDefined(){return!1}}class vn{constructor(A,m,w,D){this.name=A,this.type=m,this._evaluate=w,this.args=D}evaluate(A){return this._evaluate(A,this.args)}eachChild(A){this.args.forEach(A)}outputDefined(){return!1}static parse(A,m){const w=A[0],D=vn.definitions[w];if(!D)return m.error(`Unknown expression "${w}". If you wanted a literal array, use ["literal", [...]].`,0);const U=Array.isArray(D)?D[0]:D.type,V=Array.isArray(D)?[[D[1],D[2]]]:D.overloads,Y=V.filter(([ae])=>!Array.isArray(ae)||ae.length===A.length-1);let ee=null;for(const[ae,fe]of Y){ee=new Gs(m.registry,la,m.path,null,m.scope);const _e=[];let Se=!1;for(let Oe=1;Oe<A.length;Oe++){const ce=A[Oe],tt=Array.isArray(ae)?ae[Oe-1]:ae.type,at=ee.parse(ce,1+_e.length,tt);if(!at){Se=!0;break}_e.push(at)}if(!Se)if(Array.isArray(ae)&&ae.length!==_e.length)ee.error(`Expected ${ae.length} arguments, but found ${_e.length} instead.`);else{for(let Oe=0;Oe<_e.length;Oe++){const ce=Array.isArray(ae)?ae[Oe]:ae.type,tt=_e[Oe];ee.concat(Oe+1).checkSubtype(ce,tt.type)}if(ee.errors.length===0)return new vn(w,U,fe,_e)}}if(Y.length===1)m.errors.push(...ee.errors);else{const ae=(Y.length?Y:V).map(([_e])=>{return Se=_e,Array.isArray(Se)?`(${Se.map(Ne).join(", ")})`:`(${Ne(Se.type)}...)`;var Se}).join(" | "),fe=[];for(let _e=1;_e<A.length;_e++){const Se=m.parse(A[_e],1+fe.length);if(!Se)return null;fe.push(Ne(Se.type))}m.error(`Expected arguments of type ${ae}, but found (${fe.join(", ")}) instead.`)}return null}static register(A,m){vn.definitions=m;for(const w in m)A[w]=vn}}function la(f){if(f instanceof $o)return la(f.boundExpression);if(f instanceof vn&&f.name==="error"||f instanceof Yn||f instanceof Fo)return!1;const A=f instanceof Wi||f instanceof uo;let m=!0;return f.eachChild(w=>{m=A?m&&la(w):m&&w instanceof Ze}),!!m&&$l(f)&&eA(f,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function $l(f){if(f instanceof vn&&(f.name==="get"&&f.args.length===1||f.name==="feature-state"||f.name==="has"&&f.args.length===1||f.name==="properties"||f.name==="geometry-type"||f.name==="id"||/^filter-/.test(f.name))||f instanceof Fo)return!1;let A=!0;return f.eachChild(m=>{A&&!$l(m)&&(A=!1)}),A}function Oo(f){if(f instanceof vn&&f.name==="feature-state")return!1;let A=!0;return f.eachChild(m=>{A&&!Oo(m)&&(A=!1)}),A}function eA(f,A){if(f instanceof vn&&A.indexOf(f.name)>=0)return!1;let m=!0;return f.eachChild(w=>{m&&!eA(w,A)&&(m=!1)}),m}function pA(f,A){const m=f.length-1;let w,D,U=0,V=m,Y=0;for(;U<=V;)if(Y=Math.floor((U+V)/2),w=f[Y],D=f[Y+1],w<=A){if(Y===m||A<D)return Y;U=Y+1}else{if(!(w>A))throw new hs("Input is not a number.");V=Y-1}return 0}class Kn{constructor(A,m,w){this.type=A,this.input=m,this.labels=[],this.outputs=[];for(const[D,U]of w)this.labels.push(D),this.outputs.push(U)}static parse(A,m){if(A.length-1<4)return m.error(`Expected at least 4 arguments, but found only ${A.length-1}.`);if((A.length-1)%2!=0)return m.error("Expected an even number of arguments.");const w=m.parse(A[1],1,pi);if(!w)return null;const D=[];let U=null;m.expectedType&&m.expectedType.kind!=="value"&&(U=m.expectedType);for(let V=1;V<A.length;V+=2){const Y=V===1?-1/0:A[V],ee=A[V+1],ae=V,fe=V+1;if(typeof Y!="number")return m.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',ae);if(D.length&&D[D.length-1][0]>=Y)return m.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',ae);const _e=m.parse(ee,fe,U);if(!_e)return null;U=U||_e.type,D.push([Y,_e])}return new Kn(U,w,D)}evaluate(A){const m=this.labels,w=this.outputs;if(m.length===1)return w[0].evaluate(A);const D=this.input.evaluate(A);if(D<=m[0])return w[0].evaluate(A);const U=m.length;return D>=m[U-1]?w[U-1].evaluate(A):w[pA(m,D)].evaluate(A)}eachChild(A){A(this.input);for(const m of this.outputs)A(m)}outputDefined(){return this.outputs.every(A=>A.outputDefined())}}function Wt(f,A,m){return f+m*(A-f)}function Ui(f,A,m){return f.map((w,D)=>Wt(w,A[D],m))}const sr={number:Wt,color:function(f,A,m,w="rgb"){switch(w){case"rgb":{const[D,U,V,Y]=Ui(f.rgb,A.rgb,m);return new en(D,U,V,Y,!1)}case"hcl":{const[D,U,V,Y]=f.hcl,[ee,ae,fe,_e]=A.hcl;let Se,Oe;if(isNaN(D)||isNaN(ee))isNaN(D)?isNaN(ee)?Se=NaN:(Se=ee,V!==1&&V!==0||(Oe=ae)):(Se=D,fe!==1&&fe!==0||(Oe=U));else{let Ct=ee-D;ee>D&&Ct>180?Ct-=360:ee<D&&D-ee>180&&(Ct+=360),Se=D+m*Ct}const[ce,tt,at,pt]=function([Ct,bt,me,Vt]){return Ct=isNaN(Ct)?0:Ct*$t,yi([me,Math.cos(Ct)*bt,Math.sin(Ct)*bt,Vt])}([Se,Oe??Wt(U,ae,m),Wt(V,fe,m),Wt(Y,_e,m)]);return new en(ce,tt,at,pt,!1)}case"lab":{const[D,U,V,Y]=yi(Ui(f.lab,A.lab,m));return new en(D,U,V,Y,!1)}}},array:Ui,padding:function(f,A,m){return new Ci(Ui(f.values,A.values,m))},variableAnchorOffsetCollection:function(f,A,m){const w=f.values,D=A.values;if(w.length!==D.length)throw new hs(`Cannot interpolate values of different length. from: ${f.toString()}, to: ${A.toString()}`);const U=[];for(let V=0;V<w.length;V+=2){if(w[V]!==D[V])throw new hs(`Cannot interpolate values containing mismatched anchors. from[${V}]: ${w[V]}, to[${V}]: ${D[V]}`);U.push(w[V]);const[Y,ee]=w[V+1],[ae,fe]=D[V+1];U.push([Wt(Y,ae,m),Wt(ee,fe,m)])}return new ar(U)}};class tn{constructor(A,m,w,D,U){this.type=A,this.operator=m,this.interpolation=w,this.input=D,this.labels=[],this.outputs=[];for(const[V,Y]of U)this.labels.push(V),this.outputs.push(Y)}static interpolationFactor(A,m,w,D){let U=0;if(A.name==="exponential")U=Aa(m,A.base,w,D);else if(A.name==="linear")U=Aa(m,1,w,D);else if(A.name==="cubic-bezier"){const V=A.controlPoints;U=new cn(V[0],V[1],V[2],V[3]).solve(Aa(m,1,w,D))}return U}static parse(A,m){let[w,D,U,...V]=A;if(!Array.isArray(D)||D.length===0)return m.error("Expected an interpolation type expression.",1);if(D[0]==="linear")D={name:"linear"};else if(D[0]==="exponential"){const ae=D[1];if(typeof ae!="number")return m.error("Exponential interpolation requires a numeric base.",1,1);D={name:"exponential",base:ae}}else{if(D[0]!=="cubic-bezier")return m.error(`Unknown interpolation type ${String(D[0])}`,1,0);{const ae=D.slice(1);if(ae.length!==4||ae.some(fe=>typeof fe!="number"||fe<0||fe>1))return m.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);D={name:"cubic-bezier",controlPoints:ae}}}if(A.length-1<4)return m.error(`Expected at least 4 arguments, but found only ${A.length-1}.`);if((A.length-1)%2!=0)return m.error("Expected an even number of arguments.");if(U=m.parse(U,2,pi),!U)return null;const Y=[];let ee=null;w==="interpolate-hcl"||w==="interpolate-lab"?ee=zn:m.expectedType&&m.expectedType.kind!=="value"&&(ee=m.expectedType);for(let ae=0;ae<V.length;ae+=2){const fe=V[ae],_e=V[ae+1],Se=ae+3,Oe=ae+4;if(typeof fe!="number")return m.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',Se);if(Y.length&&Y[Y.length-1][0]>=fe)return m.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',Se);const ce=m.parse(_e,Oe,ee);if(!ce)return null;ee=ee||ce.type,Y.push([fe,ce])}return Et(ee,pi)||Et(ee,zn)||Et(ee,Ae)||Et(ee,Me)||Et(ee,Le(pi))?new tn(ee,w,D,U,Y):m.error(`Type ${Ne(ee)} is not interpolatable.`)}evaluate(A){const m=this.labels,w=this.outputs;if(m.length===1)return w[0].evaluate(A);const D=this.input.evaluate(A);if(D<=m[0])return w[0].evaluate(A);const U=m.length;if(D>=m[U-1])return w[U-1].evaluate(A);const V=pA(m,D),Y=tn.interpolationFactor(this.interpolation,D,m[V],m[V+1]),ee=w[V].evaluate(A),ae=w[V+1].evaluate(A);switch(this.operator){case"interpolate":return sr[this.type.kind](ee,ae,Y);case"interpolate-hcl":return sr.color(ee,ae,Y,"hcl");case"interpolate-lab":return sr.color(ee,ae,Y,"lab")}}eachChild(A){A(this.input);for(const m of this.outputs)A(m)}outputDefined(){return this.outputs.every(A=>A.outputDefined())}}function Aa(f,A,m,w){const D=w-m,U=f-m;return D===0?0:A===1?U/D:(Math.pow(A,U)-1)/(Math.pow(A,D)-1)}class Dr{constructor(A,m){this.type=A,this.args=m}static parse(A,m){if(A.length<2)return m.error("Expectected at least one argument.");let w=null;const D=m.expectedType;D&&D.kind!=="value"&&(w=D);const U=[];for(const Y of A.slice(1)){const ee=m.parse(Y,1+U.length,w,void 0,{typeAnnotation:"omit"});if(!ee)return null;w=w||ee.type,U.push(ee)}if(!w)throw new Error("No output type");const V=D&&U.some(Y=>Qe(D,Y.type));return new Dr(V?Sr:w,U)}evaluate(A){let m,w=null,D=0;for(const U of this.args)if(D++,w=U.evaluate(A),w&&w instanceof to&&!w.available&&(m||(m=w.name),w=null,D===this.args.length&&(w=m)),w!==null)break;return w}eachChild(A){this.args.forEach(A)}outputDefined(){return this.args.every(A=>A.outputDefined())}}class ba{constructor(A,m){this.type=m.type,this.bindings=[].concat(A),this.result=m}evaluate(A){return this.result.evaluate(A)}eachChild(A){for(const m of this.bindings)A(m[1]);A(this.result)}static parse(A,m){if(A.length<4)return m.error(`Expected at least 3 arguments, but found ${A.length-1} instead.`);const w=[];for(let U=1;U<A.length-1;U+=2){const V=A[U];if(typeof V!="string")return m.error(`Expected string, but found ${typeof V} instead.`,U);if(/[^a-zA-Z0-9_]/.test(V))return m.error("Variable names must contain only alphanumeric characters or '_'.",U);const Y=m.parse(A[U+1],U+1);if(!Y)return null;w.push([V,Y])}const D=m.parse(A[A.length-1],A.length-1,m.expectedType,w);return D?new ba(w,D):null}outputDefined(){return this.result.outputDefined()}}class rl{constructor(A,m,w){this.type=A,this.index=m,this.input=w}static parse(A,m){if(A.length!==3)return m.error(`Expected 2 arguments, but found ${A.length-1} instead.`);const w=m.parse(A[1],1,pi),D=m.parse(A[2],2,Le(m.expectedType||Sr));return w&&D?new rl(D.type.itemType,w,D):null}evaluate(A){const m=this.index.evaluate(A),w=this.input.evaluate(A);if(m<0)throw new hs(`Array index out of bounds: ${m} < 0.`);if(m>=w.length)throw new hs(`Array index out of bounds: ${m} > ${w.length-1}.`);if(m!==Math.floor(m))throw new hs(`Array index must be an integer, but found ${m} instead.`);return w[m]}eachChild(A){A(this.index),A(this.input)}outputDefined(){return!1}}class ca{constructor(A,m){this.type=wr,this.needle=A,this.haystack=m}static parse(A,m){if(A.length!==3)return m.error(`Expected 2 arguments, but found ${A.length-1} instead.`);const w=m.parse(A[1],1,Sr),D=m.parse(A[2],2,Sr);return w&&D?Ge(w.type,[wr,br,pi,us,Sr])?new ca(w,D):m.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ne(w.type)} instead`):null}evaluate(A){const m=this.needle.evaluate(A),w=this.haystack.evaluate(A);if(!w)return!1;if(!We(m,["boolean","string","number","null"]))throw new hs(`Expected first argument to be of type boolean, string, number or null, but found ${Ne(st(m))} instead.`);if(!We(w,["string","array"]))throw new hs(`Expected second argument to be of type array or string, but found ${Ne(st(w))} instead.`);return w.indexOf(m)>=0}eachChild(A){A(this.needle),A(this.haystack)}outputDefined(){return!0}}class ho{constructor(A,m,w){this.type=pi,this.needle=A,this.haystack=m,this.fromIndex=w}static parse(A,m){if(A.length<=2||A.length>=5)return m.error(`Expected 3 or 4 arguments, but found ${A.length-1} instead.`);const w=m.parse(A[1],1,Sr),D=m.parse(A[2],2,Sr);if(!w||!D)return null;if(!Ge(w.type,[wr,br,pi,us,Sr]))return m.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ne(w.type)} instead`);if(A.length===4){const U=m.parse(A[3],3,pi);return U?new ho(w,D,U):null}return new ho(w,D)}evaluate(A){const m=this.needle.evaluate(A),w=this.haystack.evaluate(A);if(!We(m,["boolean","string","number","null"]))throw new hs(`Expected first argument to be of type boolean, string, number or null, but found ${Ne(st(m))} instead.`);if(!We(w,["string","array"]))throw new hs(`Expected second argument to be of type array or string, but found ${Ne(st(w))} instead.`);if(this.fromIndex){const D=this.fromIndex.evaluate(A);return w.indexOf(m,D)}return w.indexOf(m)}eachChild(A){A(this.needle),A(this.haystack),this.fromIndex&&A(this.fromIndex)}outputDefined(){return!1}}class Jn{constructor(A,m,w,D,U,V){this.inputType=A,this.type=m,this.input=w,this.cases=D,this.outputs=U,this.otherwise=V}static parse(A,m){if(A.length<5)return m.error(`Expected at least 4 arguments, but found only ${A.length-1}.`);if(A.length%2!=1)return m.error("Expected an even number of arguments.");let w,D;m.expectedType&&m.expectedType.kind!=="value"&&(D=m.expectedType);const U={},V=[];for(let ae=2;ae<A.length-1;ae+=2){let fe=A[ae];const _e=A[ae+1];Array.isArray(fe)||(fe=[fe]);const Se=m.concat(ae);if(fe.length===0)return Se.error("Expected at least one branch label.");for(const ce of fe){if(typeof ce!="number"&&typeof ce!="string")return Se.error("Branch labels must be numbers or strings.");if(typeof ce=="number"&&Math.abs(ce)>Number.MAX_SAFE_INTEGER)return Se.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof ce=="number"&&Math.floor(ce)!==ce)return Se.error("Numeric branch labels must be integer values.");if(w){if(Se.checkSubtype(w,st(ce)))return null}else w=st(ce);if(U[String(ce)]!==void 0)return Se.error("Branch labels must be unique.");U[String(ce)]=V.length}const Oe=m.parse(_e,ae,D);if(!Oe)return null;D=D||Oe.type,V.push(Oe)}const Y=m.parse(A[1],1,Sr);if(!Y)return null;const ee=m.parse(A[A.length-1],A.length-1,D);return ee?Y.type.kind!=="value"&&m.concat(1).checkSubtype(w,Y.type)?null:new Jn(w,D,Y,U,V,ee):null}evaluate(A){const m=this.input.evaluate(A);return(st(m)===this.inputType&&this.outputs[this.cases[m]]||this.otherwise).evaluate(A)}eachChild(A){A(this.input),this.outputs.forEach(A),A(this.otherwise)}outputDefined(){return this.outputs.every(A=>A.outputDefined())&&this.otherwise.outputDefined()}}class gl{constructor(A,m,w){this.type=A,this.branches=m,this.otherwise=w}static parse(A,m){if(A.length<4)return m.error(`Expected at least 3 arguments, but found only ${A.length-1}.`);if(A.length%2!=0)return m.error("Expected an odd number of arguments.");let w;m.expectedType&&m.expectedType.kind!=="value"&&(w=m.expectedType);const D=[];for(let V=1;V<A.length-1;V+=2){const Y=m.parse(A[V],V,wr);if(!Y)return null;const ee=m.parse(A[V+1],V+1,w);if(!ee)return null;D.push([Y,ee]),w=w||ee.type}const U=m.parse(A[A.length-1],A.length-1,w);if(!U)return null;if(!w)throw new Error("Can't infer output type");return new gl(w,D,U)}evaluate(A){for(const[m,w]of this.branches)if(m.evaluate(A))return w.evaluate(A);return this.otherwise.evaluate(A)}eachChild(A){for(const[m,w]of this.branches)A(m),A(w);A(this.otherwise)}outputDefined(){return this.branches.every(([A,m])=>m.outputDefined())&&this.otherwise.outputDefined()}}class Zs{constructor(A,m,w,D){this.type=A,this.input=m,this.beginIndex=w,this.endIndex=D}static parse(A,m){if(A.length<=2||A.length>=5)return m.error(`Expected 3 or 4 arguments, but found ${A.length-1} instead.`);const w=m.parse(A[1],1,Sr),D=m.parse(A[2],2,pi);if(!w||!D)return null;if(!Ge(w.type,[Le(Sr),br,Sr]))return m.error(`Expected first argument to be of type array or string, but found ${Ne(w.type)} instead`);if(A.length===4){const U=m.parse(A[3],3,pi);return U?new Zs(w.type,w,D,U):null}return new Zs(w.type,w,D)}evaluate(A){const m=this.input.evaluate(A),w=this.beginIndex.evaluate(A);if(!We(m,["string","array"]))throw new hs(`Expected first argument to be of type array or string, but found ${Ne(st(m))} instead.`);if(this.endIndex){const D=this.endIndex.evaluate(A);return m.slice(w,D)}return m.slice(w)}eachChild(A){A(this.input),A(this.beginIndex),this.endIndex&&A(this.endIndex)}outputDefined(){return!1}}function wa(f,A){return f==="=="||f==="!="?A.kind==="boolean"||A.kind==="string"||A.kind==="number"||A.kind==="null"||A.kind==="value":A.kind==="string"||A.kind==="number"||A.kind==="value"}function Bl(f,A,m,w){return w.compare(A,m)===0}function Ta(f,A,m){const w=f!=="=="&&f!=="!=";return class Fw{constructor(U,V,Y){this.type=wr,this.lhs=U,this.rhs=V,this.collator=Y,this.hasUntypedArgument=U.type.kind==="value"||V.type.kind==="value"}static parse(U,V){if(U.length!==3&&U.length!==4)return V.error("Expected two or three arguments.");const Y=U[0];let ee=V.parse(U[1],1,Sr);if(!ee)return null;if(!wa(Y,ee.type))return V.concat(1).error(`"${Y}" comparisons are not supported for type '${Ne(ee.type)}'.`);let ae=V.parse(U[2],2,Sr);if(!ae)return null;if(!wa(Y,ae.type))return V.concat(2).error(`"${Y}" comparisons are not supported for type '${Ne(ae.type)}'.`);if(ee.type.kind!==ae.type.kind&&ee.type.kind!=="value"&&ae.type.kind!=="value")return V.error(`Cannot compare types '${Ne(ee.type)}' and '${Ne(ae.type)}'.`);w&&(ee.type.kind==="value"&&ae.type.kind!=="value"?ee=new uo(ae.type,[ee]):ee.type.kind!=="value"&&ae.type.kind==="value"&&(ae=new uo(ee.type,[ae])));let fe=null;if(U.length===4){if(ee.type.kind!=="string"&&ae.type.kind!=="string"&&ee.type.kind!=="value"&&ae.type.kind!=="value")return V.error("Cannot use collator to compare non-string types.");if(fe=V.parse(U[3],3,kt),!fe)return null}return new Fw(ee,ae,fe)}evaluate(U){const V=this.lhs.evaluate(U),Y=this.rhs.evaluate(U);if(w&&this.hasUntypedArgument){const ee=st(V),ae=st(Y);if(ee.kind!==ae.kind||ee.kind!=="string"&&ee.kind!=="number")throw new hs(`Expected arguments for "${f}" to be (string, string) or (number, number), but found (${ee.kind}, ${ae.kind}) instead.`)}if(this.collator&&!w&&this.hasUntypedArgument){const ee=st(V),ae=st(Y);if(ee.kind!=="string"||ae.kind!=="string")return A(U,V,Y)}return this.collator?m(U,V,Y,this.collator.evaluate(U)):A(U,V,Y)}eachChild(U){U(this.lhs),U(this.rhs),this.collator&&U(this.collator)}outputDefined(){return!0}}}const nl=Ta("==",function(f,A,m){return A===m},Bl),Va=Ta("!=",function(f,A,m){return A!==m},function(f,A,m,w){return!Bl(0,A,m,w)}),ic=Ta("<",function(f,A,m){return A<m},function(f,A,m,w){return w.compare(A,m)<0}),mA=Ta(">",function(f,A,m){return A>m},function(f,A,m,w){return w.compare(A,m)>0}),LA=Ta("<=",function(f,A,m){return A<=m},function(f,A,m,w){return w.compare(A,m)<=0}),ea=Ta(">=",function(f,A,m){return A>=m},function(f,A,m,w){return w.compare(A,m)>=0});class fr{constructor(A,m,w,D,U){this.type=br,this.number=A,this.locale=m,this.currency=w,this.minFractionDigits=D,this.maxFractionDigits=U}static parse(A,m){if(A.length!==3)return m.error("Expected two arguments.");const w=m.parse(A[1],1,pi);if(!w)return null;const D=A[2];if(typeof D!="object"||Array.isArray(D))return m.error("NumberFormat options argument must be an object.");let U=null;if(D.locale&&(U=m.parse(D.locale,1,br),!U))return null;let V=null;if(D.currency&&(V=m.parse(D.currency,1,br),!V))return null;let Y=null;if(D["min-fraction-digits"]&&(Y=m.parse(D["min-fraction-digits"],1,pi),!Y))return null;let ee=null;return D["max-fraction-digits"]&&(ee=m.parse(D["max-fraction-digits"],1,pi),!ee)?null:new fr(w,U,V,Y,ee)}evaluate(A){return new Intl.NumberFormat(this.locale?this.locale.evaluate(A):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(A):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(A):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(A):void 0}).format(this.number.evaluate(A))}eachChild(A){A(this.number),this.locale&&A(this.locale),this.currency&&A(this.currency),this.minFractionDigits&&A(this.minFractionDigits),this.maxFractionDigits&&A(this.maxFractionDigits)}outputDefined(){return!1}}class ja{constructor(A){this.type=we,this.sections=A}static parse(A,m){if(A.length<2)return m.error("Expected at least one argument.");const w=A[1];if(!Array.isArray(w)&&typeof w=="object")return m.error("First argument must be an image or text section.");const D=[];let U=!1;for(let V=1;V<=A.length-1;++V){const Y=A[V];if(U&&typeof Y=="object"&&!Array.isArray(Y)){U=!1;let ee=null;if(Y["font-scale"]&&(ee=m.parse(Y["font-scale"],1,pi),!ee))return null;let ae=null;if(Y["text-font"]&&(ae=m.parse(Y["text-font"],1,Le(br)),!ae))return null;let fe=null;if(Y["text-color"]&&(fe=m.parse(Y["text-color"],1,zn),!fe))return null;const _e=D[D.length-1];_e.scale=ee,_e.font=ae,_e.textColor=fe}else{const ee=m.parse(A[V],1,Sr);if(!ee)return null;const ae=ee.type.kind;if(ae!=="string"&&ae!=="value"&&ae!=="null"&&ae!=="resolvedImage")return m.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");U=!0,D.push({content:ee,scale:null,font:null,textColor:null})}}return new ja(D)}evaluate(A){return new gt(this.sections.map(m=>{const w=m.content.evaluate(A);return st(w)===pe?new kr("",w,null,null,null):new kr(xn(w),null,m.scale?m.scale.evaluate(A):null,m.font?m.font.evaluate(A).join(","):null,m.textColor?m.textColor.evaluate(A):null)}))}eachChild(A){for(const m of this.sections)A(m.content),m.scale&&A(m.scale),m.font&&A(m.font),m.textColor&&A(m.textColor)}outputDefined(){return!1}}class RA{constructor(A){this.type=pe,this.input=A}static parse(A,m){if(A.length!==2)return m.error("Expected two arguments.");const w=m.parse(A[1],1,br);return w?new RA(w):m.error("No image name provided.")}evaluate(A){const m=this.input.evaluate(A),w=to.fromString(m);return w&&A.availableImages&&(w.available=A.availableImages.indexOf(m)>-1),w}eachChild(A){A(this.input)}outputDefined(){return!1}}class vo{constructor(A){this.type=pi,this.input=A}static parse(A,m){if(A.length!==2)return m.error(`Expected 1 argument, but found ${A.length-1} instead.`);const w=m.parse(A[1],1);return w?w.type.kind!=="array"&&w.type.kind!=="string"&&w.type.kind!=="value"?m.error(`Expected argument of type string or array, but found ${Ne(w.type)} instead.`):new vo(w):null}evaluate(A){const m=this.input.evaluate(A);if(typeof m=="string"||Array.isArray(m))return m.length;throw new hs(`Expected value to be of type string or array, but found ${Ne(st(m))} instead.`)}eachChild(A){A(this.input)}outputDefined(){return!1}}const fo={"==":nl,"!=":Va,">":mA,"<":ic,">=":ea,"<=":LA,array:uo,at:rl,boolean:uo,case:gl,coalesce:Dr,collator:Yn,format:ja,image:RA,in:ca,"index-of":ho,interpolate:tn,"interpolate-hcl":tn,"interpolate-lab":tn,length:vo,let:ba,literal:Ze,match:Jn,number:uo,"number-format":fr,object:uo,slice:Zs,step:Kn,string:uo,"to-boolean":Wi,"to-color":Wi,"to-number":Wi,"to-string":Wi,var:$o,within:Fo};function Ll(f,[A,m,w,D]){A=A.evaluate(f),m=m.evaluate(f),w=w.evaluate(f);const U=D?D.evaluate(f):1,V=BA(A,m,w,U);if(V)throw new hs(V);return new en(A/255,m/255,w/255,U,!1)}function tA(f,A){return f in A}function ms(f,A){const m=A[f];return m===void 0?null:m}function Ea(f){return{type:f}}function Rl(f){return{result:"success",value:f}}function qs(f){return{result:"error",value:f}}function fs(f){return f["property-type"]==="data-driven"||f["property-type"]==="cross-faded-data-driven"}function Fl(f){return!!f.expression&&f.expression.parameters.indexOf("zoom")>-1}function FA(f){return!!f.expression&&f.expression.interpolated}function Ur(f){return f instanceof Number?"number":f instanceof String?"string":f instanceof Boolean?"boolean":Array.isArray(f)?"array":f===null?"null":typeof f}function $n(f){return typeof f=="object"&&f!==null&&!Array.isArray(f)}function iA(f){return f}function Vi(f,A){const m=A.type==="color",w=f.stops&&typeof f.stops[0][0]=="object",D=w||!(w||f.property!==void 0),U=f.type||(FA(A)?"exponential":"interval");if(m||A.type==="padding"){const fe=m?en.parse:Ci.parse;(f=yn({},f)).stops&&(f.stops=f.stops.map(_e=>[_e[0],fe(_e[1])])),f.default=fe(f.default?f.default:A.default)}if(f.colorSpace&&(V=f.colorSpace)!=="rgb"&&V!=="hcl"&&V!=="lab")throw new Error(`Unknown color space: "${f.colorSpace}"`);var V;let Y,ee,ae;if(U==="exponential")Y=Ga;else if(U==="interval")Y=Sn;else if(U==="categorical"){Y=os,ee=Object.create(null);for(const fe of f.stops)ee[fe[0]]=fe[1];ae=typeof f.stops[0][0]}else{if(U!=="identity")throw new Error(`Unknown function type "${U}"`);Y=zc}if(w){const fe={},_e=[];for(let ce=0;ce<f.stops.length;ce++){const tt=f.stops[ce],at=tt[0].zoom;fe[at]===void 0&&(fe[at]={zoom:at,type:f.type,property:f.property,default:f.default,stops:[]},_e.push(at)),fe[at].stops.push([tt[0].value,tt[1]])}const Se=[];for(const ce of _e)Se.push([fe[ce].zoom,Vi(fe[ce],A)]);const Oe={name:"linear"};return{kind:"composite",interpolationType:Oe,interpolationFactor:tn.interpolationFactor.bind(void 0,Oe),zoomStops:Se.map(ce=>ce[0]),evaluate:({zoom:ce},tt)=>Ga({stops:Se,base:f.base},A,ce).evaluate(ce,tt)}}if(D){const fe=U==="exponential"?{name:"exponential",base:f.base!==void 0?f.base:1}:null;return{kind:"camera",interpolationType:fe,interpolationFactor:tn.interpolationFactor.bind(void 0,fe),zoomStops:f.stops.map(_e=>_e[0]),evaluate:({zoom:_e})=>Y(f,A,_e,ee,ae)}}return{kind:"source",evaluate(fe,_e){const Se=_e&&_e.properties?_e.properties[f.property]:void 0;return Se===void 0?Ma(f.default,A.default):Y(f,A,Se,ee,ae)}}}function Ma(f,A,m){return f!==void 0?f:A!==void 0?A:m!==void 0?m:void 0}function os(f,A,m,w,D){return Ma(typeof m===D?w[m]:void 0,f.default,A.default)}function Sn(f,A,m){if(Ur(m)!=="number")return Ma(f.default,A.default);const w=f.stops.length;if(w===1||m<=f.stops[0][0])return f.stops[0][1];if(m>=f.stops[w-1][0])return f.stops[w-1][1];const D=pA(f.stops.map(U=>U[0]),m);return f.stops[D][1]}function Ga(f,A,m){const w=f.base!==void 0?f.base:1;if(Ur(m)!=="number")return Ma(f.default,A.default);const D=f.stops.length;if(D===1||m<=f.stops[0][0])return f.stops[0][1];if(m>=f.stops[D-1][0])return f.stops[D-1][1];const U=pA(f.stops.map(fe=>fe[0]),m),V=function(fe,_e,Se,Oe){const ce=Oe-Se,tt=fe-Se;return ce===0?0:_e===1?tt/ce:(Math.pow(_e,tt)-1)/(Math.pow(_e,ce)-1)}(m,w,f.stops[U][0],f.stops[U+1][0]),Y=f.stops[U][1],ee=f.stops[U+1][1],ae=sr[A.type]||iA;return typeof Y.evaluate=="function"?{evaluate(...fe){const _e=Y.evaluate.apply(void 0,fe),Se=ee.evaluate.apply(void 0,fe);if(_e!==void 0&&Se!==void 0)return ae(_e,Se,V,f.colorSpace)}}:ae(Y,ee,V,f.colorSpace)}function zc(f,A,m){switch(A.type){case"color":m=en.parse(m);break;case"formatted":m=gt.fromString(m.toString());break;case"resolvedImage":m=to.fromString(m.toString());break;case"padding":m=Ci.parse(m);break;default:Ur(m)===A.type||A.type==="enum"&&A.values[m]||(m=void 0)}return Ma(m,f.default,A.default)}vn.register(fo,{error:[{kind:"error"},[br],(f,[A])=>{throw new hs(A.evaluate(f))}],typeof:[br,[Sr],(f,[A])=>Ne(st(A.evaluate(f)))],"to-rgba":[Le(pi,4),[zn],(f,[A])=>{const[m,w,D,U]=A.evaluate(f).rgb;return[255*m,255*w,255*D,U]}],rgb:[zn,[pi,pi,pi],Ll],rgba:[zn,[pi,pi,pi,pi],Ll],has:{type:wr,overloads:[[[br],(f,[A])=>tA(A.evaluate(f),f.properties())],[[br,co],(f,[A,m])=>tA(A.evaluate(f),m.evaluate(f))]]},get:{type:Sr,overloads:[[[br],(f,[A])=>ms(A.evaluate(f),f.properties())],[[br,co],(f,[A,m])=>ms(A.evaluate(f),m.evaluate(f))]]},"feature-state":[Sr,[br],(f,[A])=>ms(A.evaluate(f),f.featureState||{})],properties:[co,[],f=>f.properties()],"geometry-type":[br,[],f=>f.geometryType()],id:[Sr,[],f=>f.id()],zoom:[pi,[],f=>f.globals.zoom],"heatmap-density":[pi,[],f=>f.globals.heatmapDensity||0],"line-progress":[pi,[],f=>f.globals.lineProgress||0],accumulated:[Sr,[],f=>f.globals.accumulated===void 0?null:f.globals.accumulated],"+":[pi,Ea(pi),(f,A)=>{let m=0;for(const w of A)m+=w.evaluate(f);return m}],"*":[pi,Ea(pi),(f,A)=>{let m=1;for(const w of A)m*=w.evaluate(f);return m}],"-":{type:pi,overloads:[[[pi,pi],(f,[A,m])=>A.evaluate(f)-m.evaluate(f)],[[pi],(f,[A])=>-A.evaluate(f)]]},"/":[pi,[pi,pi],(f,[A,m])=>A.evaluate(f)/m.evaluate(f)],"%":[pi,[pi,pi],(f,[A,m])=>A.evaluate(f)%m.evaluate(f)],ln2:[pi,[],()=>Math.LN2],pi:[pi,[],()=>Math.PI],e:[pi,[],()=>Math.E],"^":[pi,[pi,pi],(f,[A,m])=>Math.pow(A.evaluate(f),m.evaluate(f))],sqrt:[pi,[pi],(f,[A])=>Math.sqrt(A.evaluate(f))],log10:[pi,[pi],(f,[A])=>Math.log(A.evaluate(f))/Math.LN10],ln:[pi,[pi],(f,[A])=>Math.log(A.evaluate(f))],log2:[pi,[pi],(f,[A])=>Math.log(A.evaluate(f))/Math.LN2],sin:[pi,[pi],(f,[A])=>Math.sin(A.evaluate(f))],cos:[pi,[pi],(f,[A])=>Math.cos(A.evaluate(f))],tan:[pi,[pi],(f,[A])=>Math.tan(A.evaluate(f))],asin:[pi,[pi],(f,[A])=>Math.asin(A.evaluate(f))],acos:[pi,[pi],(f,[A])=>Math.acos(A.evaluate(f))],atan:[pi,[pi],(f,[A])=>Math.atan(A.evaluate(f))],min:[pi,Ea(pi),(f,A)=>Math.min(...A.map(m=>m.evaluate(f)))],max:[pi,Ea(pi),(f,A)=>Math.max(...A.map(m=>m.evaluate(f)))],abs:[pi,[pi],(f,[A])=>Math.abs(A.evaluate(f))],round:[pi,[pi],(f,[A])=>{const m=A.evaluate(f);return m<0?-Math.round(-m):Math.round(m)}],floor:[pi,[pi],(f,[A])=>Math.floor(A.evaluate(f))],ceil:[pi,[pi],(f,[A])=>Math.ceil(A.evaluate(f))],"filter-==":[wr,[br,Sr],(f,[A,m])=>f.properties()[A.value]===m.value],"filter-id-==":[wr,[Sr],(f,[A])=>f.id()===A.value],"filter-type-==":[wr,[br],(f,[A])=>f.geometryType()===A.value],"filter-<":[wr,[br,Sr],(f,[A,m])=>{const w=f.properties()[A.value],D=m.value;return typeof w==typeof D&&w<D}],"filter-id-<":[wr,[Sr],(f,[A])=>{const m=f.id(),w=A.value;return typeof m==typeof w&&m<w}],"filter->":[wr,[br,Sr],(f,[A,m])=>{const w=f.properties()[A.value],D=m.value;return typeof w==typeof D&&w>D}],"filter-id->":[wr,[Sr],(f,[A])=>{const m=f.id(),w=A.value;return typeof m==typeof w&&m>w}],"filter-<=":[wr,[br,Sr],(f,[A,m])=>{const w=f.properties()[A.value],D=m.value;return typeof w==typeof D&&w<=D}],"filter-id-<=":[wr,[Sr],(f,[A])=>{const m=f.id(),w=A.value;return typeof m==typeof w&&m<=w}],"filter->=":[wr,[br,Sr],(f,[A,m])=>{const w=f.properties()[A.value],D=m.value;return typeof w==typeof D&&w>=D}],"filter-id->=":[wr,[Sr],(f,[A])=>{const m=f.id(),w=A.value;return typeof m==typeof w&&m>=w}],"filter-has":[wr,[Sr],(f,[A])=>A.value in f.properties()],"filter-has-id":[wr,[],f=>f.id()!==null&&f.id()!==void 0],"filter-type-in":[wr,[Le(br)],(f,[A])=>A.value.indexOf(f.geometryType())>=0],"filter-id-in":[wr,[Le(Sr)],(f,[A])=>A.value.indexOf(f.id())>=0],"filter-in-small":[wr,[br,Le(Sr)],(f,[A,m])=>m.value.indexOf(f.properties()[A.value])>=0],"filter-in-large":[wr,[br,Le(Sr)],(f,[A,m])=>function(w,D,U,V){for(;U<=V;){const Y=U+V>>1;if(D[Y]===w)return!0;D[Y]>w?V=Y-1:U=Y+1}return!1}(f.properties()[A.value],m.value,0,m.value.length-1)],all:{type:wr,overloads:[[[wr,wr],(f,[A,m])=>A.evaluate(f)&&m.evaluate(f)],[Ea(wr),(f,A)=>{for(const m of A)if(!m.evaluate(f))return!1;return!0}]]},any:{type:wr,overloads:[[[wr,wr],(f,[A,m])=>A.evaluate(f)||m.evaluate(f)],[Ea(wr),(f,A)=>{for(const m of A)if(m.evaluate(f))return!0;return!1}]]},"!":[wr,[wr],(f,[A])=>!A.evaluate(f)],"is-supported-script":[wr,[br],(f,[A])=>{const m=f.globals&&f.globals.isSupportedScript;return!m||m(A.evaluate(f))}],upcase:[br,[br],(f,[A])=>A.evaluate(f).toUpperCase()],downcase:[br,[br],(f,[A])=>A.evaluate(f).toLowerCase()],concat:[br,Ea(Sr),(f,A)=>A.map(m=>xn(m.evaluate(f))).join("")],"resolved-locale":[br,[kt],(f,[A])=>A.evaluate(f).resolvedLocale()]});class sl{constructor(A,m){var w;this.expression=A,this._warningHistory={},this._evaluator=new Jo,this._defaultValue=m?(w=m).type==="color"&&$n(w.default)?new en(0,0,0,0):w.type==="color"?en.parse(w.default)||null:w.type==="padding"?Ci.parse(w.default)||null:w.type==="variableAnchorOffsetCollection"?ar.parse(w.default)||null:w.default===void 0?null:w.default:null,this._enumValues=m&&m.type==="enum"?m.values:null}evaluateWithoutErrorHandling(A,m,w,D,U,V){return this._evaluator.globals=A,this._evaluator.feature=m,this._evaluator.featureState=w,this._evaluator.canonical=D,this._evaluator.availableImages=U||null,this._evaluator.formattedSection=V,this.expression.evaluate(this._evaluator)}evaluate(A,m,w,D,U,V){this._evaluator.globals=A,this._evaluator.feature=m||null,this._evaluator.featureState=w||null,this._evaluator.canonical=D,this._evaluator.availableImages=U||null,this._evaluator.formattedSection=V||null;try{const Y=this.expression.evaluate(this._evaluator);if(Y==null||typeof Y=="number"&&Y!=Y)return this._defaultValue;if(this._enumValues&&!(Y in this._enumValues))throw new hs(`Expected value to be one of ${Object.keys(this._enumValues).map(ee=>JSON.stringify(ee)).join(", ")}, but found ${JSON.stringify(Y)} instead.`);return Y}catch(Y){return this._warningHistory[Y.message]||(this._warningHistory[Y.message]=!0,typeof console<"u"&&console.warn(Y.message)),this._defaultValue}}}function _A(f){return Array.isArray(f)&&f.length>0&&typeof f[0]=="string"&&f[0]in fo}function No(f,A){const m=new Gs(fo,la,[],A?function(D){const U={color:zn,string:br,number:pi,enum:br,boolean:wr,formatted:we,padding:Ae,resolvedImage:pe,variableAnchorOffsetCollection:Me};return D.type==="array"?Le(U[D.value]||Sr,D.length):U[D.type]}(A):void 0),w=m.parse(f,void 0,void 0,void 0,A&&A.type==="string"?{typeAnnotation:"coerce"}:void 0);return w?Rl(new sl(w,A)):qs(m.errors)}class yl{constructor(A,m){this.kind=A,this._styleExpression=m,this.isStateDependent=A!=="constant"&&!Oo(m.expression)}evaluateWithoutErrorHandling(A,m,w,D,U,V){return this._styleExpression.evaluateWithoutErrorHandling(A,m,w,D,U,V)}evaluate(A,m,w,D,U,V){return this._styleExpression.evaluate(A,m,w,D,U,V)}}class Nn{constructor(A,m,w,D){this.kind=A,this.zoomStops=w,this._styleExpression=m,this.isStateDependent=A!=="camera"&&!Oo(m.expression),this.interpolationType=D}evaluateWithoutErrorHandling(A,m,w,D,U,V){return this._styleExpression.evaluateWithoutErrorHandling(A,m,w,D,U,V)}evaluate(A,m,w,D,U,V){return this._styleExpression.evaluate(A,m,w,D,U,V)}interpolationFactor(A,m,w){return this.interpolationType?tn.interpolationFactor(this.interpolationType,A,m,w):0}}function Bc(f,A){const m=No(f,A);if(m.result==="error")return m;const w=m.value.expression,D=$l(w);if(!D&&!fs(A))return qs([new vr("","data expressions not supported")]);const U=eA(w,["zoom"]);if(!U&&!Fl(A))return qs([new vr("","zoom expressions not supported")]);const V=ol(w);return V||U?V instanceof vr?qs([V]):V instanceof tn&&!FA(A)?qs([new vr("",'"interpolate" expressions cannot be used with this property')]):Rl(V?new Nn(D?"camera":"composite",m.value,V.labels,V instanceof tn?V.interpolation:void 0):new yl(D?"constant":"source",m.value)):qs([new vr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class gA{constructor(A,m){this._parameters=A,this._specification=m,yn(this,Vi(this._parameters,this._specification))}static deserialize(A){return new gA(A._parameters,A._specification)}static serialize(A){return{_parameters:A._parameters,_specification:A._specification}}}function ol(f){let A=null;if(f instanceof ba)A=ol(f.result);else if(f instanceof Dr){for(const m of f.args)if(A=ol(m),A)break}else(f instanceof Kn||f instanceof tn)&&f.input instanceof vn&&f.input.name==="zoom"&&(A=f);return A instanceof vr||f.eachChild(m=>{const w=ol(m);w instanceof vr?A=w:!A&&w?A=new vr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):A&&w&&A!==w&&(A=new vr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),A}function Za(f){if(f===!0||f===!1)return!0;if(!Array.isArray(f)||f.length===0)return!1;switch(f[0]){case"has":return f.length>=2&&f[1]!=="$id"&&f[1]!=="$type";case"in":return f.length>=3&&(typeof f[1]!="string"||Array.isArray(f[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return f.length!==3||Array.isArray(f[1])||Array.isArray(f[2]);case"any":case"all":for(const A of f.slice(1))if(!Za(A)&&typeof A!="boolean")return!1;return!0;default:return!0}}const Cu={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Os(f){if(f==null)return{filter:()=>!0,needGeometry:!1};Za(f)||(f=ua(f));const A=No(f,Cu);if(A.result==="error")throw new Error(A.value.map(m=>`${m.key}: ${m.message}`).join(", "));return{filter:(m,w,D)=>A.value.evaluate(m,w,{},D),needGeometry:po(f)}}function Qs(f,A){return f<A?-1:f>A?1:0}function po(f){if(!Array.isArray(f))return!1;if(f[0]==="within")return!0;for(let A=1;A<f.length;A++)if(po(f[A]))return!0;return!1}function ua(f){if(!f)return!0;const A=f[0];return f.length<=1?A!=="any":A==="=="?xl(f[1],f[2],"=="):A==="!="?io(xl(f[1],f[2],"==")):A==="<"||A===">"||A==="<="||A===">="?xl(f[1],f[2],A):A==="any"?(m=f.slice(1),["any"].concat(m.map(ua))):A==="all"?["all"].concat(f.slice(1).map(ua)):A==="none"?["all"].concat(f.slice(1).map(ua).map(io)):A==="in"?ou(f[1],f.slice(2)):A==="!in"?io(ou(f[1],f.slice(2))):A==="has"?rc(f[1]):A==="!has"?io(rc(f[1])):A!=="within"||f;var m}function xl(f,A,m){switch(f){case"$type":return[`filter-type-${m}`,A];case"$id":return[`filter-id-${m}`,A];default:return[`filter-${m}`,f,A]}}function ou(f,A){if(A.length===0)return!1;switch(f){case"$type":return["filter-type-in",["literal",A]];case"$id":return["filter-id-in",["literal",A]];default:return A.length>200&&!A.some(m=>typeof m!=typeof A[0])?["filter-in-large",f,["literal",A.sort(Qs)]]:["filter-in-small",f,["literal",A]]}}function rc(f){switch(f){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",f]}}function io(f){return["!",f]}function bo(f){const A=typeof f;if(A==="number"||A==="boolean"||A==="string"||f==null)return JSON.stringify(f);if(Array.isArray(f)){let D="[";for(const U of f)D+=`${bo(U)},`;return`${D}]`}const m=Object.keys(f).sort();let w="{";for(let D=0;D<m.length;D++)w+=`${JSON.stringify(m[D])}:${bo(f[m[D]])},`;return`${w}}`}function ta(f){let A="";for(const m of Rt)A+=`/${bo(f[m])}`;return A}function OA(f){const A=f.value;return A?[new ni(f.key,A,"constants have been deprecated as of v8")]:[]}function Rn(f){return f instanceof Number||f instanceof String||f instanceof Boolean?f.valueOf():f}function Sa(f){if(Array.isArray(f))return f.map(Sa);if(f instanceof Object&&!(f instanceof Number||f instanceof String||f instanceof Boolean)){const A={};for(const m in f)A[m]=Sa(f[m]);return A}return Rn(f)}function Un(f){const A=f.key,m=f.value,w=f.valueSpec||{},D=f.objectElementValidators||{},U=f.style,V=f.styleSpec,Y=f.validateSpec;let ee=[];const ae=Ur(m);if(ae!=="object")return[new ni(A,m,`object expected, ${ae} found`)];for(const fe in m){const _e=fe.split(".")[0],Se=w[_e]||w["*"];let Oe;if(D[_e])Oe=D[_e];else if(w[_e])Oe=Y;else if(D["*"])Oe=D["*"];else{if(!w["*"]){ee.push(new ni(A,m[fe],`unknown property "${fe}"`));continue}Oe=Y}ee=ee.concat(Oe({key:(A&&`${A}.`)+fe,value:m[fe],valueSpec:Se,style:U,styleSpec:V,object:m,objectKey:fe,validateSpec:Y},m))}for(const fe in w)D[fe]||w[fe].required&&w[fe].default===void 0&&m[fe]===void 0&&ee.push(new ni(A,m,`missing required property "${fe}"`));return ee}function qa(f){const A=f.value,m=f.valueSpec,w=f.style,D=f.styleSpec,U=f.key,V=f.arrayElementValidator||f.validateSpec;if(Ur(A)!=="array")return[new ni(U,A,`array expected, ${Ur(A)} found`)];if(m.length&&A.length!==m.length)return[new ni(U,A,`array length ${m.length} expected, length ${A.length} found`)];if(m["min-length"]&&A.length<m["min-length"])return[new ni(U,A,`array length at least ${m["min-length"]} expected, length ${A.length} found`)];let Y={type:m.value,values:m.values};D.$version<7&&(Y.function=m.function),Ur(m.value)==="object"&&(Y=m.value);let ee=[];for(let ae=0;ae<A.length;ae++)ee=ee.concat(V({array:A,arrayIndex:ae,value:A[ae],valueSpec:Y,validateSpec:f.validateSpec,style:w,styleSpec:D,key:`${U}[${ae}]`}));return ee}function al(f){const A=f.key,m=f.value,w=f.valueSpec;let D=Ur(m);return D==="number"&&m!=m&&(D="NaN"),D!=="number"?[new ni(A,m,`number expected, ${D} found`)]:"minimum"in w&&m<w.minimum?[new ni(A,m,`${m} is less than the minimum value ${w.minimum}`)]:"maximum"in w&&m>w.maximum?[new ni(A,m,`${m} is greater than the maximum value ${w.maximum}`)]:[]}function vl(f){const A=f.valueSpec,m=Rn(f.value.type);let w,D,U,V={};const Y=m!=="categorical"&&f.value.property===void 0,ee=!Y,ae=Ur(f.value.stops)==="array"&&Ur(f.value.stops[0])==="array"&&Ur(f.value.stops[0][0])==="object",fe=Un({key:f.key,value:f.value,valueSpec:f.styleSpec.function,validateSpec:f.validateSpec,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{stops:function(Oe){if(m==="identity")return[new ni(Oe.key,Oe.value,'identity function may not have a "stops" property')];let ce=[];const tt=Oe.value;return ce=ce.concat(qa({key:Oe.key,value:tt,valueSpec:Oe.valueSpec,validateSpec:Oe.validateSpec,style:Oe.style,styleSpec:Oe.styleSpec,arrayElementValidator:_e})),Ur(tt)==="array"&&tt.length===0&&ce.push(new ni(Oe.key,tt,"array must have at least one stop")),ce},default:function(Oe){return Oe.validateSpec({key:Oe.key,value:Oe.value,valueSpec:A,validateSpec:Oe.validateSpec,style:Oe.style,styleSpec:Oe.styleSpec})}}});return m==="identity"&&Y&&fe.push(new ni(f.key,f.value,'missing required property "property"')),m==="identity"||f.value.stops||fe.push(new ni(f.key,f.value,'missing required property "stops"')),m==="exponential"&&f.valueSpec.expression&&!FA(f.valueSpec)&&fe.push(new ni(f.key,f.value,"exponential functions not supported")),f.styleSpec.$version>=8&&(ee&&!fs(f.valueSpec)?fe.push(new ni(f.key,f.value,"property functions not supported")):Y&&!Fl(f.valueSpec)&&fe.push(new ni(f.key,f.value,"zoom functions not supported"))),m!=="categorical"&&!ae||f.value.property!==void 0||fe.push(new ni(f.key,f.value,'"property" property is required')),fe;function _e(Oe){let ce=[];const tt=Oe.value,at=Oe.key;if(Ur(tt)!=="array")return[new ni(at,tt,`array expected, ${Ur(tt)} found`)];if(tt.length!==2)return[new ni(at,tt,`array length 2 expected, length ${tt.length} found`)];if(ae){if(Ur(tt[0])!=="object")return[new ni(at,tt,`object expected, ${Ur(tt[0])} found`)];if(tt[0].zoom===void 0)return[new ni(at,tt,"object stop key must have zoom")];if(tt[0].value===void 0)return[new ni(at,tt,"object stop key must have value")];if(U&&U>Rn(tt[0].zoom))return[new ni(at,tt[0].zoom,"stop zoom values must appear in ascending order")];Rn(tt[0].zoom)!==U&&(U=Rn(tt[0].zoom),D=void 0,V={}),ce=ce.concat(Un({key:`${at}[0]`,value:tt[0],valueSpec:{zoom:{}},validateSpec:Oe.validateSpec,style:Oe.style,styleSpec:Oe.styleSpec,objectElementValidators:{zoom:al,value:Se}}))}else ce=ce.concat(Se({key:`${at}[0]`,value:tt[0],valueSpec:{},validateSpec:Oe.validateSpec,style:Oe.style,styleSpec:Oe.styleSpec},tt));return _A(Sa(tt[1]))?ce.concat([new ni(`${at}[1]`,tt[1],"expressions are not allowed in function stops.")]):ce.concat(Oe.validateSpec({key:`${at}[1]`,value:tt[1],valueSpec:A,validateSpec:Oe.validateSpec,style:Oe.style,styleSpec:Oe.styleSpec}))}function Se(Oe,ce){const tt=Ur(Oe.value),at=Rn(Oe.value),pt=Oe.value!==null?Oe.value:ce;if(w){if(tt!==w)return[new ni(Oe.key,pt,`${tt} stop domain type must match previous stop domain type ${w}`)]}else w=tt;if(tt!=="number"&&tt!=="string"&&tt!=="boolean")return[new ni(Oe.key,pt,"stop domain value must be a number, string, or boolean")];if(tt!=="number"&&m!=="categorical"){let Ct=`number expected, ${tt} found`;return fs(A)&&m===void 0&&(Ct+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ni(Oe.key,pt,Ct)]}return m!=="categorical"||tt!=="number"||isFinite(at)&&Math.floor(at)===at?m!=="categorical"&&tt==="number"&&D!==void 0&&at<D?[new ni(Oe.key,pt,"stop domain values must appear in ascending order")]:(D=at,m==="categorical"&&at in V?[new ni(Oe.key,pt,"stop domain values must be unique")]:(V[at]=!0,[])):[new ni(Oe.key,pt,`integer expected, found ${at}`)]}}function wo(f){const A=(f.expressionContext==="property"?Bc:No)(Sa(f.value),f.valueSpec);if(A.result==="error")return A.value.map(w=>new ni(`${f.key}${w.key}`,f.value,w.message));const m=A.value.expression||A.value._styleExpression.expression;if(f.expressionContext==="property"&&f.propertyKey==="text-font"&&!m.outputDefined())return[new ni(f.key,f.value,`Invalid data expression for "${f.propertyKey}". Output values must be contained as literals within the expression.`)];if(f.expressionContext==="property"&&f.propertyType==="layout"&&!Oo(m))return[new ni(f.key,f.value,'"feature-state" data expressions are not supported with layout properties.')];if(f.expressionContext==="filter"&&!Oo(m))return[new ni(f.key,f.value,'"feature-state" data expressions are not supported with filters.')];if(f.expressionContext&&f.expressionContext.indexOf("cluster")===0){if(!eA(m,["zoom","feature-state"]))return[new ni(f.key,f.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(f.expressionContext==="cluster-initial"&&!$l(m))return[new ni(f.key,f.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ia(f){const A=f.key,m=f.value,w=f.valueSpec,D=[];return Array.isArray(w.values)?w.values.indexOf(Rn(m))===-1&&D.push(new ni(A,m,`expected one of [${w.values.join(", ")}], ${JSON.stringify(m)} found`)):Object.keys(w.values).indexOf(Rn(m))===-1&&D.push(new ni(A,m,`expected one of [${Object.keys(w.values).join(", ")}], ${JSON.stringify(m)} found`)),D}function Ol(f){return Za(Sa(f.value))?wo(yn({},f,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Mt(f)}function Mt(f){const A=f.value,m=f.key;if(Ur(A)!=="array")return[new ni(m,A,`array expected, ${Ur(A)} found`)];const w=f.styleSpec;let D,U=[];if(A.length<1)return[new ni(m,A,"filter array must have at least 1 element")];switch(U=U.concat(Ia({key:`${m}[0]`,value:A[0],valueSpec:w.filter_operator,style:f.style,styleSpec:f.styleSpec})),Rn(A[0])){case"<":case"<=":case">":case">=":A.length>=2&&Rn(A[1])==="$type"&&U.push(new ni(m,A,`"$type" cannot be use with operator "${A[0]}"`));case"==":case"!=":A.length!==3&&U.push(new ni(m,A,`filter array for operator "${A[0]}" must have 3 elements`));case"in":case"!in":A.length>=2&&(D=Ur(A[1]),D!=="string"&&U.push(new ni(`${m}[1]`,A[1],`string expected, ${D} found`)));for(let V=2;V<A.length;V++)D=Ur(A[V]),Rn(A[1])==="$type"?U=U.concat(Ia({key:`${m}[${V}]`,value:A[V],valueSpec:w.geometry_type,style:f.style,styleSpec:f.styleSpec})):D!=="string"&&D!=="number"&&D!=="boolean"&&U.push(new ni(`${m}[${V}]`,A[V],`string, number, or boolean expected, ${D} found`));break;case"any":case"all":case"none":for(let V=1;V<A.length;V++)U=U.concat(Mt({key:`${m}[${V}]`,value:A[V],style:f.style,styleSpec:f.styleSpec}));break;case"has":case"!has":D=Ur(A[1]),A.length!==2?U.push(new ni(m,A,`filter array for "${A[0]}" operator must have 2 elements`)):D!=="string"&&U.push(new ni(`${m}[1]`,A[1],`string expected, ${D} found`));break;case"within":D=Ur(A[1]),A.length!==2?U.push(new ni(m,A,`filter array for "${A[0]}" operator must have 2 elements`)):D!=="object"&&U.push(new ni(`${m}[1]`,A[1],`object expected, ${D} found`))}return U}function nc(f,A){const m=f.key,w=f.validateSpec,D=f.style,U=f.styleSpec,V=f.value,Y=f.objectKey,ee=U[`${A}_${f.layerType}`];if(!ee)return[];const ae=Y.match(/^(.*)-transition$/);if(A==="paint"&&ae&&ee[ae[1]]&&ee[ae[1]].transition)return w({key:m,value:V,valueSpec:U.transition,style:D,styleSpec:U});const fe=f.valueSpec||ee[Y];if(!fe)return[new ni(m,V,`unknown property "${Y}"`)];let _e;if(Ur(V)==="string"&&fs(fe)&&!fe.tokens&&(_e=/^{([^}]+)}$/.exec(V)))return[new ni(m,V,`"${Y}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(_e[1])} }\`.`)];const Se=[];return f.layerType==="symbol"&&(Y==="text-field"&&D&&!D.glyphs&&Se.push(new ni(m,V,'use of "text-field" requires a style "glyphs" property')),Y==="text-font"&&$n(Sa(V))&&Rn(V.type)==="identity"&&Se.push(new ni(m,V,'"text-font" does not support identity functions'))),Se.concat(w({key:f.key,value:V,valueSpec:fe,style:D,styleSpec:U,expressionContext:"property",propertyType:A,propertyKey:Y}))}function ll(f){return nc(f,"paint")}function Al(f){return nc(f,"layout")}function Lc(f){let A=[];const m=f.value,w=f.key,D=f.style,U=f.styleSpec;m.type||m.ref||A.push(new ni(w,m,'either "type" or "ref" is required'));let V=Rn(m.type);const Y=Rn(m.ref);if(m.id){const ee=Rn(m.id);for(let ae=0;ae<f.arrayIndex;ae++){const fe=D.layers[ae];Rn(fe.id)===ee&&A.push(new ni(w,m.id,`duplicate layer id "${m.id}", previously used at line ${fe.id.__line__}`))}}if("ref"in m){let ee;["type","source","source-layer","filter","layout"].forEach(ae=>{ae in m&&A.push(new ni(w,m[ae],`"${ae}" is prohibited for ref layers`))}),D.layers.forEach(ae=>{Rn(ae.id)===Y&&(ee=ae)}),ee?ee.ref?A.push(new ni(w,m.ref,"ref cannot reference another ref layer")):V=Rn(ee.type):A.push(new ni(w,m.ref,`ref layer "${Y}" not found`))}else if(V!=="background")if(m.source){const ee=D.sources&&D.sources[m.source],ae=ee&&Rn(ee.type);ee?ae==="vector"&&V==="raster"?A.push(new ni(w,m.source,`layer "${m.id}" requires a raster source`)):ae!=="raster-dem"&&V==="hillshade"?A.push(new ni(w,m.source,`layer "${m.id}" requires a raster-dem source`)):ae==="raster"&&V!=="raster"?A.push(new ni(w,m.source,`layer "${m.id}" requires a vector source`)):ae!=="vector"||m["source-layer"]?ae==="raster-dem"&&V!=="hillshade"?A.push(new ni(w,m.source,"raster-dem source can only be used with layer type 'hillshade'.")):V!=="line"||!m.paint||!m.paint["line-gradient"]||ae==="geojson"&&ee.lineMetrics||A.push(new ni(w,m,`layer "${m.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):A.push(new ni(w,m,`layer "${m.id}" must specify a "source-layer"`)):A.push(new ni(w,m.source,`source "${m.source}" not found`))}else A.push(new ni(w,m,'missing required property "source"'));return A=A.concat(Un({key:w,value:m,valueSpec:U.layer,style:f.style,styleSpec:f.styleSpec,validateSpec:f.validateSpec,objectElementValidators:{"*":()=>[],type:()=>f.validateSpec({key:`${w}.type`,value:m.type,valueSpec:U.layer.type,style:f.style,styleSpec:f.styleSpec,validateSpec:f.validateSpec,object:m,objectKey:"type"}),filter:Ol,layout:ee=>Un({layer:m,key:ee.key,value:ee.value,style:ee.style,styleSpec:ee.styleSpec,validateSpec:ee.validateSpec,objectElementValidators:{"*":ae=>Al(yn({layerType:V},ae))}}),paint:ee=>Un({layer:m,key:ee.key,value:ee.value,style:ee.style,styleSpec:ee.styleSpec,validateSpec:ee.validateSpec,objectElementValidators:{"*":ae=>ll(yn({layerType:V},ae))}})}})),A}function To(f){const A=f.value,m=f.key,w=Ur(A);return w!=="string"?[new ni(m,A,`string expected, ${w} found`)]:[]}const ha={promoteId:function({key:f,value:A}){if(Ur(A)==="string")return To({key:f,value:A});{const m=[];for(const w in A)m.push(...To({key:`${f}.${w}`,value:A[w]}));return m}}};function Uo(f){const A=f.value,m=f.key,w=f.styleSpec,D=f.style,U=f.validateSpec;if(!A.type)return[new ni(m,A,'"type" is required')];const V=Rn(A.type);let Y;switch(V){case"vector":case"raster":return Y=Un({key:m,value:A,valueSpec:w[`source_${V.replace("-","_")}`],style:f.style,styleSpec:w,objectElementValidators:ha,validateSpec:U}),Y;case"raster-dem":return Y=function(ee){var ae;const fe=(ae=ee.sourceName)!==null&&ae!==void 0?ae:"",_e=ee.value,Se=ee.styleSpec,Oe=Se.source_raster_dem,ce=ee.style;let tt=[];const at=Ur(_e);if(_e===void 0)return tt;if(at!=="object")return tt.push(new ni("source_raster_dem",_e,`object expected, ${at} found`)),tt;const pt=Rn(_e.encoding)==="custom",Ct=["redFactor","greenFactor","blueFactor","baseShift"],bt=ee.value.encoding?`"${ee.value.encoding}"`:"Default";for(const me in _e)!pt&&Ct.includes(me)?tt.push(new ni(me,_e[me],`In "${fe}": "${me}" is only valid when "encoding" is set to "custom". ${bt} encoding found`)):Oe[me]?tt=tt.concat(ee.validateSpec({key:me,value:_e[me],valueSpec:Oe[me],validateSpec:ee.validateSpec,style:ce,styleSpec:Se})):tt.push(new ni(me,_e[me],`unknown property "${me}"`));return tt}({sourceName:m,value:A,style:f.style,styleSpec:w,validateSpec:U}),Y;case"geojson":if(Y=Un({key:m,value:A,valueSpec:w.source_geojson,style:D,styleSpec:w,validateSpec:U,objectElementValidators:ha}),A.cluster)for(const ee in A.clusterProperties){const[ae,fe]=A.clusterProperties[ee],_e=typeof ae=="string"?[ae,["accumulated"],["get",ee]]:ae;Y.push(...wo({key:`${m}.${ee}.map`,value:fe,validateSpec:U,expressionContext:"cluster-map"})),Y.push(...wo({key:`${m}.${ee}.reduce`,value:_e,validateSpec:U,expressionContext:"cluster-reduce"}))}return Y;case"video":return Un({key:m,value:A,valueSpec:w.source_video,style:D,validateSpec:U,styleSpec:w});case"image":return Un({key:m,value:A,valueSpec:w.source_image,style:D,validateSpec:U,styleSpec:w});case"canvas":return[new ni(m,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ia({key:`${m}.type`,value:A.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:D,validateSpec:U,styleSpec:w})}}function Qa(f){const A=f.value,m=f.styleSpec,w=m.light,D=f.style;let U=[];const V=Ur(A);if(A===void 0)return U;if(V!=="object")return U=U.concat([new ni("light",A,`object expected, ${V} found`)]),U;for(const Y in A){const ee=Y.match(/^(.*)-transition$/);U=U.concat(ee&&w[ee[1]]&&w[ee[1]].transition?f.validateSpec({key:Y,value:A[Y],valueSpec:m.transition,validateSpec:f.validateSpec,style:D,styleSpec:m}):w[Y]?f.validateSpec({key:Y,value:A[Y],valueSpec:w[Y],validateSpec:f.validateSpec,style:D,styleSpec:m}):[new ni(Y,A[Y],`unknown property "${Y}"`)])}return U}function NA(f){const A=f.value,m=f.styleSpec,w=m.terrain,D=f.style;let U=[];const V=Ur(A);if(A===void 0)return U;if(V!=="object")return U=U.concat([new ni("terrain",A,`object expected, ${V} found`)]),U;for(const Y in A)U=U.concat(w[Y]?f.validateSpec({key:Y,value:A[Y],valueSpec:w[Y],validateSpec:f.validateSpec,style:D,styleSpec:m}):[new ni(Y,A[Y],`unknown property "${Y}"`)]);return U}function cl(f){let A=[];const m=f.value,w=f.key;if(Array.isArray(m)){const D=[],U=[];for(const V in m)m[V].id&&D.includes(m[V].id)&&A.push(new ni(w,m,`all the sprites' ids must be unique, but ${m[V].id} is duplicated`)),D.push(m[V].id),m[V].url&&U.includes(m[V].url)&&A.push(new ni(w,m,`all the sprites' URLs must be unique, but ${m[V].url} is duplicated`)),U.push(m[V].url),A=A.concat(Un({key:`${w}[${V}]`,value:m[V],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:f.validateSpec}));return A}return To({key:w,value:m})}const sc={"*":()=>[],array:qa,boolean:function(f){const A=f.value,m=f.key,w=Ur(A);return w!=="boolean"?[new ni(m,A,`boolean expected, ${w} found`)]:[]},number:al,color:function(f){const A=f.key,m=f.value,w=Ur(m);return w!=="string"?[new ni(A,m,`color expected, ${w} found`)]:en.parse(String(m))?[]:[new ni(A,m,`color expected, "${m}" found`)]},constants:OA,enum:Ia,filter:Ol,function:vl,layer:Lc,object:Un,source:Uo,light:Qa,terrain:NA,string:To,formatted:function(f){return To(f).length===0?[]:wo(f)},resolvedImage:function(f){return To(f).length===0?[]:wo(f)},padding:function(f){const A=f.key,m=f.value;if(Ur(m)==="array"){if(m.length<1||m.length>4)return[new ni(A,m,`padding requires 1 to 4 values; ${m.length} values found`)];const w={type:"number"};let D=[];for(let U=0;U<m.length;U++)D=D.concat(f.validateSpec({key:`${A}[${U}]`,value:m[U],validateSpec:f.validateSpec,valueSpec:w}));return D}return al({key:A,value:m,valueSpec:{}})},variableAnchorOffsetCollection:function(f){const A=f.key,m=f.value,w=Ur(m),D=f.styleSpec;if(w!=="array"||m.length<1||m.length%2!=0)return[new ni(A,m,"variableAnchorOffsetCollection requires a non-empty array of even length")];let U=[];for(let V=0;V<m.length;V+=2)U=U.concat(Ia({key:`${A}[${V}]`,value:m[V],valueSpec:D.layout_symbol["text-anchor"]})),U=U.concat(qa({key:`${A}[${V+1}]`,value:m[V+1],valueSpec:{length:2,value:"number"},validateSpec:f.validateSpec,style:f.style,styleSpec:D}));return U},sprite:cl};function bl(f){const A=f.value,m=f.valueSpec,w=f.styleSpec;return f.validateSpec=bl,m.expression&&$n(Rn(A))?vl(f):m.expression&&_A(Sa(A))?wo(f):m.type&&sc[m.type]?sc[m.type](f):Un(yn({},f,{valueSpec:m.type?w[m.type]:m}))}function UA(f){const A=f.value,m=f.key,w=To(f);return w.length||(A.indexOf("{fontstack}")===-1&&w.push(new ni(m,A,'"glyphs" url must include a "{fontstack}" token')),A.indexOf("{range}")===-1&&w.push(new ni(m,A,'"glyphs" url must include a "{range}" token'))),w}function Vo(f,A=Be){let m=[];return m=m.concat(bl({key:"",value:f,valueSpec:A.$root,styleSpec:A,style:f,validateSpec:bl,objectElementValidators:{glyphs:UA,"*":()=>[]}})),f.constants&&(m=m.concat(OA({key:"constants",value:f.constants,style:f,styleSpec:A,validateSpec:bl}))),Ca(m)}function ia(f){return function(A){return f({...A,validateSpec:bl})}}function Ca(f){return[].concat(f).sort((A,m)=>A.line-m.line)}function ul(f){return function(...A){return Ca(f.apply(this,A))}}Vo.source=ul(ia(Uo)),Vo.sprite=ul(ia(cl)),Vo.glyphs=ul(ia(UA)),Vo.light=ul(ia(Qa)),Vo.terrain=ul(ia(NA)),Vo.layer=ul(ia(Lc)),Vo.filter=ul(ia(Ol)),Vo.paintProperty=ul(ia(ll)),Vo.layoutProperty=ul(ia(Al));const wl=Vo,ku=wl.light,oc=wl.paintProperty,au=wl.layoutProperty;function rA(f,A){let m=!1;if(A&&A.length)for(const w of A)f.fire(new Ue(new Error(w.message))),m=!0;return m}class hl{constructor(A,m,w){const D=this.cells=[];if(A instanceof ArrayBuffer){this.arrayBuffer=A;const V=new Int32Array(this.arrayBuffer);A=V[0],this.d=(m=V[1])+2*(w=V[2]);for(let ee=0;ee<this.d*this.d;ee++){const ae=V[3+ee],fe=V[3+ee+1];D.push(ae===fe?null:V.subarray(ae,fe))}const Y=V[3+D.length+1];this.keys=V.subarray(V[3+D.length],Y),this.bboxes=V.subarray(Y),this.insert=this._insertReadonly}else{this.d=m+2*w;for(let V=0;V<this.d*this.d;V++)D.push([]);this.keys=[],this.bboxes=[]}this.n=m,this.extent=A,this.padding=w,this.scale=m/A,this.uid=0;const U=w/m*A;this.min=-U,this.max=A+U}insert(A,m,w,D,U){this._forEachCell(m,w,D,U,this._insertCell,this.uid++,void 0,void 0),this.keys.push(A),this.bboxes.push(m),this.bboxes.push(w),this.bboxes.push(D),this.bboxes.push(U)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(A,m,w,D,U,V){this.cells[U].push(V)}query(A,m,w,D,U){const V=this.min,Y=this.max;if(A<=V&&m<=V&&Y<=w&&Y<=D&&!U)return Array.prototype.slice.call(this.keys);{const ee=[];return this._forEachCell(A,m,w,D,this._queryCell,ee,{},U),ee}}_queryCell(A,m,w,D,U,V,Y,ee){const ae=this.cells[U];if(ae!==null){const fe=this.keys,_e=this.bboxes;for(let Se=0;Se<ae.length;Se++){const Oe=ae[Se];if(Y[Oe]===void 0){const ce=4*Oe;(ee?ee(_e[ce+0],_e[ce+1],_e[ce+2],_e[ce+3]):A<=_e[ce+2]&&m<=_e[ce+3]&&w>=_e[ce+0]&&D>=_e[ce+1])?(Y[Oe]=!0,V.push(fe[Oe])):Y[Oe]=!1}}}}_forEachCell(A,m,w,D,U,V,Y,ee){const ae=this._convertToCellCoord(A),fe=this._convertToCellCoord(m),_e=this._convertToCellCoord(w),Se=this._convertToCellCoord(D);for(let Oe=ae;Oe<=_e;Oe++)for(let ce=fe;ce<=Se;ce++){const tt=this.d*ce+Oe;if((!ee||ee(this._convertFromCellCoord(Oe),this._convertFromCellCoord(ce),this._convertFromCellCoord(Oe+1),this._convertFromCellCoord(ce+1)))&&U.call(this,A,m,w,D,tt,V,Y,ee))return}}_convertFromCellCoord(A){return(A-this.padding)/this.scale}_convertToCellCoord(A){return Math.max(0,Math.min(this.d-1,Math.floor(A*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const A=this.cells,m=3+this.cells.length+1+1;let w=0;for(let V=0;V<this.cells.length;V++)w+=this.cells[V].length;const D=new Int32Array(m+w+this.keys.length+this.bboxes.length);D[0]=this.extent,D[1]=this.n,D[2]=this.padding;let U=m;for(let V=0;V<A.length;V++){const Y=A[V];D[3+V]=U,D.set(Y,U),U+=Y.length}return D[3+A.length]=U,D.set(this.keys,U),U+=this.keys.length,D[3+A.length+1]=U,D.set(this.bboxes,U),U+=this.bboxes.length,D.buffer}static serialize(A,m){const w=A.toArrayBuffer();return m&&m.push(w),{buffer:w}}static deserialize(A){return new hl(A.buffer)}}const Ha={};function Fi(f,A,m={}){if(Ha[f])throw new Error(`${f} is already registered.`);Object.defineProperty(A,"_classRegistryKey",{value:f,writeable:!1}),Ha[f]={klass:A,omit:m.omit||[],shallow:m.shallow||[]}}Fi("Object",Object),Fi("TransferableGridIndex",hl),Fi("Color",en),Fi("Error",Error),Fi("AJAXError",nr),Fi("ResolvedImage",to),Fi("StylePropertyFunction",gA),Fi("StyleExpression",sl,{omit:["_evaluator"]}),Fi("ZoomDependentExpression",Nn),Fi("ZoomConstantExpression",yl),Fi("CompoundExpression",vn,{omit:["_evaluate"]});for(const f in fo)fo[f]._classRegistryKey||Fi(`Expression_${f}`,fo[f]);function jo(f){return f&&typeof ArrayBuffer<"u"&&(f instanceof ArrayBuffer||f.constructor&&f.constructor.name==="ArrayBuffer")}function Wa(f,A){if(f==null||typeof f=="boolean"||typeof f=="number"||typeof f=="string"||f instanceof Boolean||f instanceof Number||f instanceof String||f instanceof Date||f instanceof RegExp||f instanceof Blob)return f;if(jo(f)||Ao(f))return A&&A.push(f),f;if(ArrayBuffer.isView(f)){const m=f;return A&&A.push(m.buffer),m}if(f instanceof ImageData)return A&&A.push(f.data.buffer),f;if(Array.isArray(f)){const m=[];for(const w of f)m.push(Wa(w,A));return m}if(typeof f=="object"){const m=f.constructor,w=m._classRegistryKey;if(!w)throw new Error("can't serialize object of unregistered class");if(!Ha[w])throw new Error(`${w} is not registered.`);const D=m.serialize?m.serialize(f,A):{};if(m.serialize){if(A&&D===A[A.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const U in f){if(!f.hasOwnProperty(U)||Ha[w].omit.indexOf(U)>=0)continue;const V=f[U];D[U]=Ha[w].shallow.indexOf(U)>=0?V:Wa(V,A)}f instanceof Error&&(D.message=f.message)}if(D.$name)throw new Error("$name property is reserved for worker serialization logic.");return w!=="Object"&&(D.$name=w),D}throw new Error("can't serialize object of type "+typeof f)}function fl(f){if(f==null||typeof f=="boolean"||typeof f=="number"||typeof f=="string"||f instanceof Boolean||f instanceof Number||f instanceof String||f instanceof Date||f instanceof RegExp||f instanceof Blob||jo(f)||Ao(f)||ArrayBuffer.isView(f)||f instanceof ImageData)return f;if(Array.isArray(f))return f.map(fl);if(typeof f=="object"){const A=f.$name||"Object";if(!Ha[A])throw new Error(`can't deserialize unregistered class ${A}`);const{klass:m}=Ha[A];if(!m)throw new Error(`can't deserialize unregistered class ${A}`);if(m.deserialize)return m.deserialize(f);const w=Object.create(m.prototype);for(const D of Object.keys(f)){if(D==="$name")continue;const U=f[D];w[D]=Ha[A].shallow.indexOf(D)>=0?U:fl(U)}return w}throw new Error("can't deserialize object of type "+typeof f)}class ac{constructor(){this.first=!0}update(A,m){const w=Math.floor(A);return this.first?(this.first=!1,this.lastIntegerZoom=w,this.lastIntegerZoomTime=0,this.lastZoom=A,this.lastFloorZoom=w,!0):(this.lastFloorZoom>w?(this.lastIntegerZoom=w+1,this.lastIntegerZoomTime=m):this.lastFloorZoom<w&&(this.lastIntegerZoom=w,this.lastIntegerZoomTime=m),A!==this.lastZoom&&(this.lastZoom=A,this.lastFloorZoom=w,!0))}}const Ei={"Latin-1 Supplement":f=>f>=128&&f<=255,Arabic:f=>f>=1536&&f<=1791,"Arabic Supplement":f=>f>=1872&&f<=1919,"Arabic Extended-A":f=>f>=2208&&f<=2303,"Hangul Jamo":f=>f>=4352&&f<=4607,"Unified Canadian Aboriginal Syllabics":f=>f>=5120&&f<=5759,Khmer:f=>f>=6016&&f<=6143,"Unified Canadian Aboriginal Syllabics Extended":f=>f>=6320&&f<=6399,"General Punctuation":f=>f>=8192&&f<=8303,"Letterlike Symbols":f=>f>=8448&&f<=8527,"Number Forms":f=>f>=8528&&f<=8591,"Miscellaneous Technical":f=>f>=8960&&f<=9215,"Control Pictures":f=>f>=9216&&f<=9279,"Optical Character Recognition":f=>f>=9280&&f<=9311,"Enclosed Alphanumerics":f=>f>=9312&&f<=9471,"Geometric Shapes":f=>f>=9632&&f<=9727,"Miscellaneous Symbols":f=>f>=9728&&f<=9983,"Miscellaneous Symbols and Arrows":f=>f>=11008&&f<=11263,"CJK Radicals Supplement":f=>f>=11904&&f<=12031,"Kangxi Radicals":f=>f>=12032&&f<=12255,"Ideographic Description Characters":f=>f>=12272&&f<=12287,"CJK Symbols and Punctuation":f=>f>=12288&&f<=12351,Hiragana:f=>f>=12352&&f<=12447,Katakana:f=>f>=12448&&f<=12543,Bopomofo:f=>f>=12544&&f<=12591,"Hangul Compatibility Jamo":f=>f>=12592&&f<=12687,Kanbun:f=>f>=12688&&f<=12703,"Bopomofo Extended":f=>f>=12704&&f<=12735,"CJK Strokes":f=>f>=12736&&f<=12783,"Katakana Phonetic Extensions":f=>f>=12784&&f<=12799,"Enclosed CJK Letters and Months":f=>f>=12800&&f<=13055,"CJK Compatibility":f=>f>=13056&&f<=13311,"CJK Unified Ideographs Extension A":f=>f>=13312&&f<=19903,"Yijing Hexagram Symbols":f=>f>=19904&&f<=19967,"CJK Unified Ideographs":f=>f>=19968&&f<=40959,"Yi Syllables":f=>f>=40960&&f<=42127,"Yi Radicals":f=>f>=42128&&f<=42191,"Hangul Jamo Extended-A":f=>f>=43360&&f<=43391,"Hangul Syllables":f=>f>=44032&&f<=55215,"Hangul Jamo Extended-B":f=>f>=55216&&f<=55295,"Private Use Area":f=>f>=57344&&f<=63743,"CJK Compatibility Ideographs":f=>f>=63744&&f<=64255,"Arabic Presentation Forms-A":f=>f>=64336&&f<=65023,"Vertical Forms":f=>f>=65040&&f<=65055,"CJK Compatibility Forms":f=>f>=65072&&f<=65103,"Small Form Variants":f=>f>=65104&&f<=65135,"Arabic Presentation Forms-B":f=>f>=65136&&f<=65279,"Halfwidth and Fullwidth Forms":f=>f>=65280&&f<=65519};function nA(f){for(const A of f)if(yA(A.charCodeAt(0)))return!0;return!1}function VA(f){for(const A of f)if(!fa(A.charCodeAt(0)))return!1;return!0}function fa(f){return!(Ei.Arabic(f)||Ei["Arabic Supplement"](f)||Ei["Arabic Extended-A"](f)||Ei["Arabic Presentation Forms-A"](f)||Ei["Arabic Presentation Forms-B"](f))}function yA(f){return!(f!==746&&f!==747&&(f<4352||!(Ei["Bopomofo Extended"](f)||Ei.Bopomofo(f)||Ei["CJK Compatibility Forms"](f)&&!(f>=65097&&f<=65103)||Ei["CJK Compatibility Ideographs"](f)||Ei["CJK Compatibility"](f)||Ei["CJK Radicals Supplement"](f)||Ei["CJK Strokes"](f)||!(!Ei["CJK Symbols and Punctuation"](f)||f>=12296&&f<=12305||f>=12308&&f<=12319||f===12336)||Ei["CJK Unified Ideographs Extension A"](f)||Ei["CJK Unified Ideographs"](f)||Ei["Enclosed CJK Letters and Months"](f)||Ei["Hangul Compatibility Jamo"](f)||Ei["Hangul Jamo Extended-A"](f)||Ei["Hangul Jamo Extended-B"](f)||Ei["Hangul Jamo"](f)||Ei["Hangul Syllables"](f)||Ei.Hiragana(f)||Ei["Ideographic Description Characters"](f)||Ei.Kanbun(f)||Ei["Kangxi Radicals"](f)||Ei["Katakana Phonetic Extensions"](f)||Ei.Katakana(f)&&f!==12540||!(!Ei["Halfwidth and Fullwidth Forms"](f)||f===65288||f===65289||f===65293||f>=65306&&f<=65310||f===65339||f===65341||f===65343||f>=65371&&f<=65503||f===65507||f>=65512&&f<=65519)||!(!Ei["Small Form Variants"](f)||f>=65112&&f<=65118||f>=65123&&f<=65126)||Ei["Unified Canadian Aboriginal Syllabics"](f)||Ei["Unified Canadian Aboriginal Syllabics Extended"](f)||Ei["Vertical Forms"](f)||Ei["Yijing Hexagram Symbols"](f)||Ei["Yi Syllables"](f)||Ei["Yi Radicals"](f))))}function lc(f){return!(yA(f)||function(A){return!!(Ei["Latin-1 Supplement"](A)&&(A===167||A===169||A===174||A===177||A===188||A===189||A===190||A===215||A===247)||Ei["General Punctuation"](A)&&(A===8214||A===8224||A===8225||A===8240||A===8241||A===8251||A===8252||A===8258||A===8263||A===8264||A===8265||A===8273)||Ei["Letterlike Symbols"](A)||Ei["Number Forms"](A)||Ei["Miscellaneous Technical"](A)&&(A>=8960&&A<=8967||A>=8972&&A<=8991||A>=8996&&A<=9e3||A===9003||A>=9085&&A<=9114||A>=9150&&A<=9165||A===9167||A>=9169&&A<=9179||A>=9186&&A<=9215)||Ei["Control Pictures"](A)&&A!==9251||Ei["Optical Character Recognition"](A)||Ei["Enclosed Alphanumerics"](A)||Ei["Geometric Shapes"](A)||Ei["Miscellaneous Symbols"](A)&&!(A>=9754&&A<=9759)||Ei["Miscellaneous Symbols and Arrows"](A)&&(A>=11026&&A<=11055||A>=11088&&A<=11097||A>=11192&&A<=11243)||Ei["CJK Symbols and Punctuation"](A)||Ei.Katakana(A)||Ei["Private Use Area"](A)||Ei["CJK Compatibility Forms"](A)||Ei["Small Form Variants"](A)||Ei["Halfwidth and Fullwidth Forms"](A)||A===8734||A===8756||A===8757||A>=9984&&A<=10087||A>=10102&&A<=10131||A===65532||A===65533)}(f))}function jA(f){return f>=1424&&f<=2303||Ei["Arabic Presentation Forms-A"](f)||Ei["Arabic Presentation Forms-B"](f)}function Ac(f,A){return!(!A&&jA(f)||f>=2304&&f<=3583||f>=3840&&f<=4255||Ei.Khmer(f))}function ks(f){for(const A of f)if(jA(A.charCodeAt(0)))return!0;return!1}const xA="deferred",GA="loading",ZA="loaded";let Ki=null,Po="unavailable",ka=null;const sA=function(f){f&&typeof f=="string"&&f.indexOf("NetworkError")>-1&&(Po="error"),Ki&&Ki(f)};function cc(){oA.fire(new Zt("pluginStateChange",{pluginStatus:Po,pluginURL:ka}))}const oA=new He,Tl=function(){return Po},Ds=function(){if(Po!==xA||!ka)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Po=GA,cc(),ka&&Di({url:ka},f=>{f?sA(f):(Po=ZA,cc())})},da={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Po===ZA||da.applyArabicShaping!=null,isLoading:()=>Po===GA,setState(f){if(!Dn())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");Po=f.pluginStatus,ka=f.pluginURL},isParsed(){if(!Dn())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return da.applyArabicShaping!=null&&da.processBidirectionalText!=null&&da.processStyledBidirectionalText!=null},getPluginURL(){if(!Dn())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return ka}};class Qn{constructor(A,m){this.zoom=A,m?(this.now=m.now,this.fadeDuration=m.fadeDuration,this.zoomHistory=m.zoomHistory,this.transition=m.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new ac,this.transition={})}isSupportedScript(A){return function(m,w){for(const D of m)if(!Ac(D.charCodeAt(0),w))return!1;return!0}(A,da.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const A=this.zoom,m=A-Math.floor(A),w=this.crossFadingFactor();return A>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:m+(1-m)*w}:{fromScale:.5,toScale:1,t:1-(1-w)*m}}}class Eo{constructor(A,m){this.property=A,this.value=m,this.expression=function(w,D){if($n(w))return new gA(w,D);if(_A(w)){const U=Bc(w,D);if(U.result==="error")throw new Error(U.value.map(V=>`${V.key}: ${V.message}`).join(", "));return U.value}{let U=w;return D.type==="color"&&typeof w=="string"?U=en.parse(w):D.type!=="padding"||typeof w!="number"&&!Array.isArray(w)?D.type==="variableAnchorOffsetCollection"&&Array.isArray(w)&&(U=ar.parse(w)):U=Ci.parse(w),{kind:"constant",evaluate:()=>U}}}(m===void 0?A.specification.default:m,A.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(A,m,w){return this.property.possiblyEvaluate(this,A,m,w)}}class pr{constructor(A){this.property=A,this.value=new Eo(A,void 0)}transitioned(A,m){return new uc(this.property,this.value,m,pn({},A.transition,this.transition),A.now)}untransitioned(){return new uc(this.property,this.value,null,{},0)}}class ra{constructor(A){this._properties=A,this._values=Object.create(A.defaultTransitionablePropertyValues)}getValue(A){return fn(this._values[A].value.value)}setValue(A,m){Object.prototype.hasOwnProperty.call(this._values,A)||(this._values[A]=new pr(this._values[A].property)),this._values[A].value=new Eo(this._values[A].property,m===null?void 0:fn(m))}getTransition(A){return fn(this._values[A].transition)}setTransition(A,m){Object.prototype.hasOwnProperty.call(this._values,A)||(this._values[A]=new pr(this._values[A].property)),this._values[A].transition=fn(m)||void 0}serialize(){const A={};for(const m of Object.keys(this._values)){const w=this.getValue(m);w!==void 0&&(A[m]=w);const D=this.getTransition(m);D!==void 0&&(A[`${m}-transition`]=D)}return A}transitioned(A,m){const w=new Nl(this._properties);for(const D of Object.keys(this._values))w._values[D]=this._values[D].transitioned(A,m._values[D]);return w}untransitioned(){const A=new Nl(this._properties);for(const m of Object.keys(this._values))A._values[m]=this._values[m].untransitioned();return A}}class uc{constructor(A,m,w,D,U){this.property=A,this.value=m,this.begin=U+D.delay||0,this.end=this.begin+D.duration||0,A.specification.transition&&(D.delay||D.duration)&&(this.prior=w)}possiblyEvaluate(A,m,w){const D=A.now||0,U=this.value.possiblyEvaluate(A,m,w),V=this.prior;if(V){if(D>this.end)return this.prior=null,U;if(this.value.isDataDriven())return this.prior=null,U;if(D<this.begin)return V.possiblyEvaluate(A,m,w);{const Y=(D-this.begin)/(this.end-this.begin);return this.property.interpolate(V.possiblyEvaluate(A,m,w),U,function(ee){if(ee<=0)return 0;if(ee>=1)return 1;const ae=ee*ee,fe=ae*ee;return 4*(ee<.5?fe:3*(ee-ae)+fe-.75)}(Y))}}return U}}class Nl{constructor(A){this._properties=A,this._values=Object.create(A.defaultTransitioningPropertyValues)}possiblyEvaluate(A,m,w){const D=new Da(this._properties);for(const U of Object.keys(this._values))D._values[U]=this._values[U].possiblyEvaluate(A,m,w);return D}hasTransition(){for(const A of Object.keys(this._values))if(this._values[A].prior)return!0;return!1}}class hc{constructor(A){this._properties=A,this._values=Object.create(A.defaultPropertyValues)}hasValue(A){return this._values[A].value!==void 0}getValue(A){return fn(this._values[A].value)}setValue(A,m){this._values[A]=new Eo(this._values[A].property,m===null?void 0:fn(m))}serialize(){const A={};for(const m of Object.keys(this._values)){const w=this.getValue(m);w!==void 0&&(A[m]=w)}return A}possiblyEvaluate(A,m,w){const D=new Da(this._properties);for(const U of Object.keys(this._values))D._values[U]=this._values[U].possiblyEvaluate(A,m,w);return D}}class Mo{constructor(A,m,w){this.property=A,this.value=m,this.parameters=w}isConstant(){return this.value.kind==="constant"}constantOr(A){return this.value.kind==="constant"?this.value.value:A}evaluate(A,m,w,D){return this.property.evaluate(this.value,this.parameters,A,m,w,D)}}class Da{constructor(A){this._properties=A,this._values=Object.create(A.defaultPossiblyEvaluatedValues)}get(A){return this._values[A]}}class Nt{constructor(A){this.specification=A}possiblyEvaluate(A,m){if(A.isDataDriven())throw new Error("Value should not be data driven");return A.expression.evaluate(m)}interpolate(A,m,w){const D=sr[this.specification.type];return D?D(A,m,w):A}}class Kt{constructor(A,m){this.specification=A,this.overrides=m}possiblyEvaluate(A,m,w,D){return new Mo(this,A.expression.kind==="constant"||A.expression.kind==="camera"?{kind:"constant",value:A.expression.evaluate(m,null,{},w,D)}:A.expression,m)}interpolate(A,m,w){if(A.value.kind!=="constant"||m.value.kind!=="constant")return A;if(A.value.value===void 0||m.value.value===void 0)return new Mo(this,{kind:"constant",value:void 0},A.parameters);const D=sr[this.specification.type];if(D){const U=D(A.value.value,m.value.value,w);return new Mo(this,{kind:"constant",value:U},A.parameters)}return A}evaluate(A,m,w,D,U,V){return A.kind==="constant"?A.value:A.evaluate(m,w,D,U,V)}}class aA extends Kt{possiblyEvaluate(A,m,w,D){if(A.value===void 0)return new Mo(this,{kind:"constant",value:void 0},m);if(A.expression.kind==="constant"){const U=A.expression.evaluate(m,null,{},w,D),V=A.property.specification.type==="resolvedImage"&&typeof U!="string"?U.name:U,Y=this._calculate(V,V,V,m);return new Mo(this,{kind:"constant",value:Y},m)}if(A.expression.kind==="camera"){const U=this._calculate(A.expression.evaluate({zoom:m.zoom-1}),A.expression.evaluate({zoom:m.zoom}),A.expression.evaluate({zoom:m.zoom+1}),m);return new Mo(this,{kind:"constant",value:U},m)}return new Mo(this,A.expression,m)}evaluate(A,m,w,D,U,V){if(A.kind==="source"){const Y=A.evaluate(m,w,D,U,V);return this._calculate(Y,Y,Y,m)}return A.kind==="composite"?this._calculate(A.evaluate({zoom:Math.floor(m.zoom)-1},w,D),A.evaluate({zoom:Math.floor(m.zoom)},w,D),A.evaluate({zoom:Math.floor(m.zoom)+1},w,D),m):A.value}_calculate(A,m,w,D){return D.zoom>D.zoomHistory.lastIntegerZoom?{from:A,to:m}:{from:w,to:m}}interpolate(A){return A}}class El{constructor(A){this.specification=A}possiblyEvaluate(A,m,w,D){if(A.value!==void 0){if(A.expression.kind==="constant"){const U=A.expression.evaluate(m,null,{},w,D);return this._calculate(U,U,U,m)}return this._calculate(A.expression.evaluate(new Qn(Math.floor(m.zoom-1),m)),A.expression.evaluate(new Qn(Math.floor(m.zoom),m)),A.expression.evaluate(new Qn(Math.floor(m.zoom+1),m)),m)}}_calculate(A,m,w,D){return D.zoom>D.zoomHistory.lastIntegerZoom?{from:A,to:m}:{from:w,to:m}}interpolate(A){return A}}class Ul{constructor(A){this.specification=A}possiblyEvaluate(A,m,w,D){return!!A.expression.evaluate(m,null,{},w,D)}interpolate(){return!1}}class $r{constructor(A){this.properties=A,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const m in A){const w=A[m];w.specification.overridable&&this.overridableProperties.push(m);const D=this.defaultPropertyValues[m]=new Eo(w,void 0),U=this.defaultTransitionablePropertyValues[m]=new pr(w);this.defaultTransitioningPropertyValues[m]=U.untransitioned(),this.defaultPossiblyEvaluatedValues[m]=D.possiblyEvaluate({})}}}Fi("DataDrivenProperty",Kt),Fi("DataConstantProperty",Nt),Fi("CrossFadedDataDrivenProperty",aA),Fi("CrossFadedProperty",El),Fi("ColorRampProperty",Ul);const pa="-transition";class Hn extends He{constructor(A,m){if(super(),this.id=A.id,this.type=A.type,this._featureFilter={filter:()=>!0,needGeometry:!1},A.type!=="custom"&&(this.metadata=A.metadata,this.minzoom=A.minzoom,this.maxzoom=A.maxzoom,A.type!=="background"&&(this.source=A.source,this.sourceLayer=A["source-layer"],this.filter=A.filter),m.layout&&(this._unevaluatedLayout=new hc(m.layout)),m.paint)){this._transitionablePaint=new ra(m.paint);for(const w in A.paint)this.setPaintProperty(w,A.paint[w],{validate:!1});for(const w in A.layout)this.setLayoutProperty(w,A.layout[w],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Da(m.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(A){return A==="visibility"?this.visibility:this._unevaluatedLayout.getValue(A)}setLayoutProperty(A,m,w={}){m!=null&&this._validate(au,`layers.${this.id}.layout.${A}`,A,m,w)||(A!=="visibility"?this._unevaluatedLayout.setValue(A,m):this.visibility=m)}getPaintProperty(A){return A.endsWith(pa)?this._transitionablePaint.getTransition(A.slice(0,-11)):this._transitionablePaint.getValue(A)}setPaintProperty(A,m,w={}){if(m!=null&&this._validate(oc,`layers.${this.id}.paint.${A}`,A,m,w))return!1;if(A.endsWith(pa))return this._transitionablePaint.setTransition(A.slice(0,-11),m||void 0),!1;{const D=this._transitionablePaint._values[A],U=D.property.specification["property-type"]==="cross-faded-data-driven",V=D.value.isDataDriven(),Y=D.value;this._transitionablePaint.setValue(A,m),this._handleSpecialPaintPropertyUpdate(A);const ee=this._transitionablePaint._values[A].value;return ee.isDataDriven()||V||U||this._handleOverridablePaintPropertyUpdate(A,Y,ee)}}_handleSpecialPaintPropertyUpdate(A){}_handleOverridablePaintPropertyUpdate(A,m,w){return!1}isHidden(A){return!!(this.minzoom&&A<this.minzoom)||!!(this.maxzoom&&A>=this.maxzoom)||this.visibility==="none"}updateTransitions(A){this._transitioningPaint=this._transitionablePaint.transitioned(A,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(A,m){A.getCrossfadeParameters&&(this._crossfadeParameters=A.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(A,void 0,m)),this.paint=this._transitioningPaint.possiblyEvaluate(A,void 0,m)}serialize(){const A={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(A.layout=A.layout||{},A.layout.visibility=this.visibility),Lt(A,(m,w)=>!(m===void 0||w==="layout"&&!Object.keys(m).length||w==="paint"&&!Object.keys(m).length))}_validate(A,m,w,D,U={}){return(!U||U.validate!==!1)&&rA(this,A.call(wl,{key:m,layerType:this.type,objectKey:w,value:D,styleSpec:Be,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const A in this.paint._values){const m=this.paint.get(A);if(m instanceof Mo&&fs(m.property.specification)&&(m.value.kind==="source"||m.value.kind==="composite")&&m.value.isStateDependent)return!0}return!1}}const x={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class T{constructor(A,m){this._structArray=A,this._pos1=m*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class M{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(A,m){return A._trim(),m&&(A.isTransferred=!0,m.push(A.arrayBuffer)),{length:A.length,arrayBuffer:A.arrayBuffer}}static deserialize(A){const m=Object.create(this.prototype);return m.arrayBuffer=A.arrayBuffer,m.length=A.length,m.capacity=A.arrayBuffer.byteLength/m.bytesPerElement,m._refreshViews(),m}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(A){this.reserve(A),this.length=A}reserve(A){if(A>this.capacity){this.capacity=Math.max(A,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const m=this.uint8;this._refreshViews(),m&&this.uint8.set(m)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function L(f,A=1){let m=0,w=0;return{members:f.map(D=>{const U=x[D.type].BYTES_PER_ELEMENT,V=m=j(m,Math.max(A,U)),Y=D.components||1;return w=Math.max(w,U),m+=U*Y,{name:D.name,type:D.type,components:Y,offset:V}}),size:j(m,Math.max(w,A)),alignment:A}}function j(f,A){return Math.ceil(f/A)*A}class H extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(A,m){const w=this.length;return this.resize(w+1),this.emplace(w,A,m)}emplace(A,m,w){const D=2*A;return this.int16[D+0]=m,this.int16[D+1]=w,A}}H.prototype.bytesPerElement=4,Fi("StructArrayLayout2i4",H);class Q extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(A,m,w){const D=this.length;return this.resize(D+1),this.emplace(D,A,m,w)}emplace(A,m,w,D){const U=3*A;return this.int16[U+0]=m,this.int16[U+1]=w,this.int16[U+2]=D,A}}Q.prototype.bytesPerElement=6,Fi("StructArrayLayout3i6",Q);class J extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(A,m,w,D){const U=this.length;return this.resize(U+1),this.emplace(U,A,m,w,D)}emplace(A,m,w,D,U){const V=4*A;return this.int16[V+0]=m,this.int16[V+1]=w,this.int16[V+2]=D,this.int16[V+3]=U,A}}J.prototype.bytesPerElement=8,Fi("StructArrayLayout4i8",J);class ue extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(A,m,w,D,U,V){const Y=this.length;return this.resize(Y+1),this.emplace(Y,A,m,w,D,U,V)}emplace(A,m,w,D,U,V,Y){const ee=6*A;return this.int16[ee+0]=m,this.int16[ee+1]=w,this.int16[ee+2]=D,this.int16[ee+3]=U,this.int16[ee+4]=V,this.int16[ee+5]=Y,A}}ue.prototype.bytesPerElement=12,Fi("StructArrayLayout2i4i12",ue);class Ce extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(A,m,w,D,U,V){const Y=this.length;return this.resize(Y+1),this.emplace(Y,A,m,w,D,U,V)}emplace(A,m,w,D,U,V,Y){const ee=4*A,ae=8*A;return this.int16[ee+0]=m,this.int16[ee+1]=w,this.uint8[ae+4]=D,this.uint8[ae+5]=U,this.uint8[ae+6]=V,this.uint8[ae+7]=Y,A}}Ce.prototype.bytesPerElement=8,Fi("StructArrayLayout2i4ub8",Ce);class ze extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(A,m){const w=this.length;return this.resize(w+1),this.emplace(w,A,m)}emplace(A,m,w){const D=2*A;return this.float32[D+0]=m,this.float32[D+1]=w,A}}ze.prototype.bytesPerElement=8,Fi("StructArrayLayout2f8",ze);class _t extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(A,m,w,D,U,V,Y,ee,ae,fe){const _e=this.length;return this.resize(_e+1),this.emplace(_e,A,m,w,D,U,V,Y,ee,ae,fe)}emplace(A,m,w,D,U,V,Y,ee,ae,fe,_e){const Se=10*A;return this.uint16[Se+0]=m,this.uint16[Se+1]=w,this.uint16[Se+2]=D,this.uint16[Se+3]=U,this.uint16[Se+4]=V,this.uint16[Se+5]=Y,this.uint16[Se+6]=ee,this.uint16[Se+7]=ae,this.uint16[Se+8]=fe,this.uint16[Se+9]=_e,A}}_t.prototype.bytesPerElement=20,Fi("StructArrayLayout10ui20",_t);class Xe extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(A,m,w,D,U,V,Y,ee,ae,fe,_e,Se){const Oe=this.length;return this.resize(Oe+1),this.emplace(Oe,A,m,w,D,U,V,Y,ee,ae,fe,_e,Se)}emplace(A,m,w,D,U,V,Y,ee,ae,fe,_e,Se,Oe){const ce=12*A;return this.int16[ce+0]=m,this.int16[ce+1]=w,this.int16[ce+2]=D,this.int16[ce+3]=U,this.uint16[ce+4]=V,this.uint16[ce+5]=Y,this.uint16[ce+6]=ee,this.uint16[ce+7]=ae,this.int16[ce+8]=fe,this.int16[ce+9]=_e,this.int16[ce+10]=Se,this.int16[ce+11]=Oe,A}}Xe.prototype.bytesPerElement=24,Fi("StructArrayLayout4i4ui4i24",Xe);class it extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(A,m,w){const D=this.length;return this.resize(D+1),this.emplace(D,A,m,w)}emplace(A,m,w,D){const U=3*A;return this.float32[U+0]=m,this.float32[U+1]=w,this.float32[U+2]=D,A}}it.prototype.bytesPerElement=12,Fi("StructArrayLayout3f12",it);class z extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(A){const m=this.length;return this.resize(m+1),this.emplace(m,A)}emplace(A,m){return this.uint32[1*A+0]=m,A}}z.prototype.bytesPerElement=4,Fi("StructArrayLayout1ul4",z);class l extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(A,m,w,D,U,V,Y,ee,ae){const fe=this.length;return this.resize(fe+1),this.emplace(fe,A,m,w,D,U,V,Y,ee,ae)}emplace(A,m,w,D,U,V,Y,ee,ae,fe){const _e=10*A,Se=5*A;return this.int16[_e+0]=m,this.int16[_e+1]=w,this.int16[_e+2]=D,this.int16[_e+3]=U,this.int16[_e+4]=V,this.int16[_e+5]=Y,this.uint32[Se+3]=ee,this.uint16[_e+8]=ae,this.uint16[_e+9]=fe,A}}l.prototype.bytesPerElement=20,Fi("StructArrayLayout6i1ul2ui20",l);class g extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(A,m,w,D,U,V){const Y=this.length;return this.resize(Y+1),this.emplace(Y,A,m,w,D,U,V)}emplace(A,m,w,D,U,V,Y){const ee=6*A;return this.int16[ee+0]=m,this.int16[ee+1]=w,this.int16[ee+2]=D,this.int16[ee+3]=U,this.int16[ee+4]=V,this.int16[ee+5]=Y,A}}g.prototype.bytesPerElement=12,Fi("StructArrayLayout2i2i2i12",g);class S extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(A,m,w,D,U){const V=this.length;return this.resize(V+1),this.emplace(V,A,m,w,D,U)}emplace(A,m,w,D,U,V){const Y=4*A,ee=8*A;return this.float32[Y+0]=m,this.float32[Y+1]=w,this.float32[Y+2]=D,this.int16[ee+6]=U,this.int16[ee+7]=V,A}}S.prototype.bytesPerElement=16,Fi("StructArrayLayout2f1f2i16",S);class k extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(A,m,w,D){const U=this.length;return this.resize(U+1),this.emplace(U,A,m,w,D)}emplace(A,m,w,D,U){const V=12*A,Y=3*A;return this.uint8[V+0]=m,this.uint8[V+1]=w,this.float32[Y+1]=D,this.float32[Y+2]=U,A}}k.prototype.bytesPerElement=12,Fi("StructArrayLayout2ub2f12",k);class F extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(A,m,w){const D=this.length;return this.resize(D+1),this.emplace(D,A,m,w)}emplace(A,m,w,D){const U=3*A;return this.uint16[U+0]=m,this.uint16[U+1]=w,this.uint16[U+2]=D,A}}F.prototype.bytesPerElement=6,Fi("StructArrayLayout3ui6",F);class Z extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(A,m,w,D,U,V,Y,ee,ae,fe,_e,Se,Oe,ce,tt,at,pt){const Ct=this.length;return this.resize(Ct+1),this.emplace(Ct,A,m,w,D,U,V,Y,ee,ae,fe,_e,Se,Oe,ce,tt,at,pt)}emplace(A,m,w,D,U,V,Y,ee,ae,fe,_e,Se,Oe,ce,tt,at,pt,Ct){const bt=24*A,me=12*A,Vt=48*A;return this.int16[bt+0]=m,this.int16[bt+1]=w,this.uint16[bt+2]=D,this.uint16[bt+3]=U,this.uint32[me+2]=V,this.uint32[me+3]=Y,this.uint32[me+4]=ee,this.uint16[bt+10]=ae,this.uint16[bt+11]=fe,this.uint16[bt+12]=_e,this.float32[me+7]=Se,this.float32[me+8]=Oe,this.uint8[Vt+36]=ce,this.uint8[Vt+37]=tt,this.uint8[Vt+38]=at,this.uint32[me+10]=pt,this.int16[bt+22]=Ct,A}}Z.prototype.bytesPerElement=48,Fi("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Z);class u extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(A,m,w,D,U,V,Y,ee,ae,fe,_e,Se,Oe,ce,tt,at,pt,Ct,bt,me,Vt,oi,Si,tr,Bi,ki,xi,Qi){const Ii=this.length;return this.resize(Ii+1),this.emplace(Ii,A,m,w,D,U,V,Y,ee,ae,fe,_e,Se,Oe,ce,tt,at,pt,Ct,bt,me,Vt,oi,Si,tr,Bi,ki,xi,Qi)}emplace(A,m,w,D,U,V,Y,ee,ae,fe,_e,Se,Oe,ce,tt,at,pt,Ct,bt,me,Vt,oi,Si,tr,Bi,ki,xi,Qi,Ii){const ci=32*A,ur=16*A;return this.int16[ci+0]=m,this.int16[ci+1]=w,this.int16[ci+2]=D,this.int16[ci+3]=U,this.int16[ci+4]=V,this.int16[ci+5]=Y,this.int16[ci+6]=ee,this.int16[ci+7]=ae,this.uint16[ci+8]=fe,this.uint16[ci+9]=_e,this.uint16[ci+10]=Se,this.uint16[ci+11]=Oe,this.uint16[ci+12]=ce,this.uint16[ci+13]=tt,this.uint16[ci+14]=at,this.uint16[ci+15]=pt,this.uint16[ci+16]=Ct,this.uint16[ci+17]=bt,this.uint16[ci+18]=me,this.uint16[ci+19]=Vt,this.uint16[ci+20]=oi,this.uint16[ci+21]=Si,this.uint16[ci+22]=tr,this.uint32[ur+12]=Bi,this.float32[ur+13]=ki,this.float32[ur+14]=xi,this.uint16[ci+30]=Qi,this.uint16[ci+31]=Ii,A}}u.prototype.bytesPerElement=64,Fi("StructArrayLayout8i15ui1ul2f2ui64",u);class h extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(A){const m=this.length;return this.resize(m+1),this.emplace(m,A)}emplace(A,m){return this.float32[1*A+0]=m,A}}h.prototype.bytesPerElement=4,Fi("StructArrayLayout1f4",h);class d extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(A,m,w){const D=this.length;return this.resize(D+1),this.emplace(D,A,m,w)}emplace(A,m,w,D){const U=3*A;return this.uint16[6*A+0]=m,this.float32[U+1]=w,this.float32[U+2]=D,A}}d.prototype.bytesPerElement=12,Fi("StructArrayLayout1ui2f12",d);class y extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(A,m,w){const D=this.length;return this.resize(D+1),this.emplace(D,A,m,w)}emplace(A,m,w,D){const U=4*A;return this.uint32[2*A+0]=m,this.uint16[U+2]=w,this.uint16[U+3]=D,A}}y.prototype.bytesPerElement=8,Fi("StructArrayLayout1ul2ui8",y);class b extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(A,m){const w=this.length;return this.resize(w+1),this.emplace(w,A,m)}emplace(A,m,w){const D=2*A;return this.uint16[D+0]=m,this.uint16[D+1]=w,A}}b.prototype.bytesPerElement=4,Fi("StructArrayLayout2ui4",b);class I extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(A){const m=this.length;return this.resize(m+1),this.emplace(m,A)}emplace(A,m){return this.uint16[1*A+0]=m,A}}I.prototype.bytesPerElement=2,Fi("StructArrayLayout1ui2",I);class R extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(A,m,w,D){const U=this.length;return this.resize(U+1),this.emplace(U,A,m,w,D)}emplace(A,m,w,D,U){const V=4*A;return this.float32[V+0]=m,this.float32[V+1]=w,this.float32[V+2]=D,this.float32[V+3]=U,A}}R.prototype.bytesPerElement=16,Fi("StructArrayLayout4f16",R);class N extends T{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new Gt(this.anchorPointX,this.anchorPointY)}}N.prototype.size=20;class W extends l{get(A){return new N(this,A)}}Fi("CollisionBoxArray",W);class K extends T{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(A){this._structArray.uint8[this._pos1+37]=A}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(A){this._structArray.uint8[this._pos1+38]=A}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(A){this._structArray.uint32[this._pos4+10]=A}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}K.prototype.size=48;class le extends Z{get(A){return new K(this,A)}}Fi("PlacedSymbolArray",le);class de extends T{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(A){this._structArray.uint32[this._pos4+12]=A}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}de.prototype.size=64;class ge extends u{get(A){return new de(this,A)}}Fi("SymbolInstanceArray",ge);class ke extends h{getoffsetX(A){return this.float32[1*A+0]}}Fi("GlyphOffsetArray",ke);class Pe extends Q{getx(A){return this.int16[3*A+0]}gety(A){return this.int16[3*A+1]}gettileUnitDistanceFromAnchor(A){return this.int16[3*A+2]}}Fi("SymbolLineVertexArray",Pe);class qe extends T{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}qe.prototype.size=12;class ht extends d{get(A){return new qe(this,A)}}Fi("TextAnchorOffsetArray",ht);class mt extends T{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}mt.prototype.size=8;class ot extends y{get(A){return new mt(this,A)}}Fi("FeatureIndexArray",ot);class ft extends H{}class dt extends H{}class ai extends H{}class Ut extends ue{}class Xt extends Ce{}class qt extends ze{}class or extends _t{}class qi extends Xe{}class ji extends it{}class Li extends z{}class ir extends g{}class Ji extends k{}class Or extends F{}class Xi extends b{}const Lr=L([{name:"a_pos",components:2,type:"Int16"}],4),{members:Bn}=Lr;class is{constructor(A=[]){this.segments=A}prepareSegment(A,m,w,D){let U=this.segments[this.segments.length-1];return A>is.MAX_VERTEX_ARRAY_LENGTH&&wi(`Max vertices per segment is ${is.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${A}`),(!U||U.vertexLength+A>is.MAX_VERTEX_ARRAY_LENGTH||U.sortKey!==D)&&(U={vertexOffset:m.length,primitiveOffset:w.length,vertexLength:0,primitiveLength:0},D!==void 0&&(U.sortKey=D),this.segments.push(U)),U}get(){return this.segments}destroy(){for(const A of this.segments)for(const m in A.vaos)A.vaos[m].destroy()}static simpleSegment(A,m,w,D){return new is([{vertexOffset:A,primitiveOffset:m,vertexLength:w,primitiveLength:D,vaos:{},sortKey:0}])}}function Ml(f,A){return 256*(f=En(Math.floor(f),0,255))+En(Math.floor(A),0,255)}is.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Fi("SegmentVector",is);const Sl=L([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Go={exports:{}},fc={exports:{}};fc.exports=function(f,A){var m,w,D,U,V,Y,ee,ae;for(w=f.length-(m=3&f.length),D=A,V=3432918353,Y=461845907,ae=0;ae<w;)ee=255&f.charCodeAt(ae)|(255&f.charCodeAt(++ae))<<8|(255&f.charCodeAt(++ae))<<16|(255&f.charCodeAt(++ae))<<24,++ae,D=27492+(65535&(U=5*(65535&(D=(D^=ee=(65535&(ee=(ee=(65535&ee)*V+(((ee>>>16)*V&65535)<<16)&4294967295)<<15|ee>>>17))*Y+(((ee>>>16)*Y&65535)<<16)&4294967295)<<13|D>>>19))+((5*(D>>>16)&65535)<<16)&4294967295))+((58964+(U>>>16)&65535)<<16);switch(ee=0,m){case 3:ee^=(255&f.charCodeAt(ae+2))<<16;case 2:ee^=(255&f.charCodeAt(ae+1))<<8;case 1:D^=ee=(65535&(ee=(ee=(65535&(ee^=255&f.charCodeAt(ae)))*V+(((ee>>>16)*V&65535)<<16)&4294967295)<<15|ee>>>17))*Y+(((ee>>>16)*Y&65535)<<16)&4294967295}return D^=f.length,D=2246822507*(65535&(D^=D>>>16))+((2246822507*(D>>>16)&65535)<<16)&4294967295,D=3266489909*(65535&(D^=D>>>13))+((3266489909*(D>>>16)&65535)<<16)&4294967295,(D^=D>>>16)>>>0};var Rc=fc.exports,ma={exports:{}};ma.exports=function(f,A){for(var m,w=f.length,D=A^w,U=0;w>=4;)m=1540483477*(65535&(m=255&f.charCodeAt(U)|(255&f.charCodeAt(++U))<<8|(255&f.charCodeAt(++U))<<16|(255&f.charCodeAt(++U))<<24))+((1540483477*(m>>>16)&65535)<<16),D=1540483477*(65535&D)+((1540483477*(D>>>16)&65535)<<16)^(m=1540483477*(65535&(m^=m>>>24))+((1540483477*(m>>>16)&65535)<<16)),w-=4,++U;switch(w){case 3:D^=(255&f.charCodeAt(U+2))<<16;case 2:D^=(255&f.charCodeAt(U+1))<<8;case 1:D=1540483477*(65535&(D^=255&f.charCodeAt(U)))+((1540483477*(D>>>16)&65535)<<16)}return D=1540483477*(65535&(D^=D>>>13))+((1540483477*(D>>>16)&65535)<<16),(D^=D>>>15)>>>0};var ro=Rc,Pa=ma.exports;Go.exports=ro,Go.exports.murmur3=ro,Go.exports.murmur2=Pa;var vA=Ee(Go.exports);class Hs{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(A,m,w,D){this.ids.push(mo(A)),this.positions.push(m,w,D)}getPositions(A){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const m=mo(A);let w=0,D=this.ids.length-1;for(;w<D;){const V=w+D>>1;this.ids[V]>=m?D=V:w=V+1}const U=[];for(;this.ids[w]===m;)U.push({index:this.positions[3*w],start:this.positions[3*w+1],end:this.positions[3*w+2]}),w++;return U}static serialize(A,m){const w=new Float64Array(A.ids),D=new Uint32Array(A.positions);return Xa(w,D,0,w.length-1),m&&m.push(w.buffer,D.buffer),{ids:w,positions:D}}static deserialize(A){const m=new Hs;return m.ids=A.ids,m.positions=A.positions,m.indexed=!0,m}}function mo(f){const A=+f;return!isNaN(A)&&A<=Number.MAX_SAFE_INTEGER?A:vA(String(f))}function Xa(f,A,m,w){for(;m<w;){const D=f[m+w>>1];let U=m-1,V=w+1;for(;;){do U++;while(f[U]<D);do V--;while(f[V]>D);if(U>=V)break;no(f,U,V),no(A,3*U,3*V),no(A,3*U+1,3*V+1),no(A,3*U+2,3*V+2)}V-m<w-V?(Xa(f,A,m,V),m=V+1):(Xa(f,A,V+1,w),w=V)}}function no(f,A,m){const w=f[A];f[A]=f[m],f[m]=w}Fi("FeaturePositionMap",Hs);class Vl{constructor(A,m){this.gl=A.gl,this.location=m}}class Xu extends Vl{constructor(A,m){super(A,m),this.current=0}set(A){this.current!==A&&(this.current=A,this.gl.uniform1f(this.location,A))}}class pf extends Vl{constructor(A,m){super(A,m),this.current=[0,0,0,0]}set(A){A[0]===this.current[0]&&A[1]===this.current[1]&&A[2]===this.current[2]&&A[3]===this.current[3]||(this.current=A,this.gl.uniform4f(this.location,A[0],A[1],A[2],A[3]))}}class kh extends Vl{constructor(A,m){super(A,m),this.current=en.transparent}set(A){A.r===this.current.r&&A.g===this.current.g&&A.b===this.current.b&&A.a===this.current.a||(this.current=A,this.gl.uniform4f(this.location,A.r,A.g,A.b,A.a))}}const Yu=new Float32Array(16);function Du(f){return[Ml(255*f.r,255*f.g),Ml(255*f.b,255*f.a)]}class lA{constructor(A,m,w){this.value=A,this.uniformNames=m.map(D=>`u_${D}`),this.type=w}setUniform(A,m,w){A.set(w.constantOr(this.value))}getBinding(A,m,w){return this.type==="color"?new kh(A,m):new Xu(A,m)}}class dc{constructor(A,m){this.uniformNames=m.map(w=>`u_${w}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(A,m){this.pixelRatioFrom=m.pixelRatio,this.pixelRatioTo=A.pixelRatio,this.patternFrom=m.tlbr,this.patternTo=A.tlbr}setUniform(A,m,w,D){const U=D==="u_pattern_to"?this.patternTo:D==="u_pattern_from"?this.patternFrom:D==="u_pixel_ratio_to"?this.pixelRatioTo:D==="u_pixel_ratio_from"?this.pixelRatioFrom:null;U&&A.set(U)}getBinding(A,m,w){return w.substr(0,9)==="u_pattern"?new pf(A,m):new Xu(A,m)}}class Il{constructor(A,m,w,D){this.expression=A,this.type=w,this.maxValue=0,this.paintVertexAttributes=m.map(U=>({name:`a_${U}`,type:"Float32",components:w==="color"?2:1,offset:0})),this.paintVertexArray=new D}populatePaintArray(A,m,w,D,U){const V=this.paintVertexArray.length,Y=this.expression.evaluate(new Qn(0),m,{},D,[],U);this.paintVertexArray.resize(A),this._setPaintValue(V,A,Y)}updatePaintArray(A,m,w,D){const U=this.expression.evaluate({zoom:0},w,D);this._setPaintValue(A,m,U)}_setPaintValue(A,m,w){if(this.type==="color"){const D=Du(w);for(let U=A;U<m;U++)this.paintVertexArray.emplace(U,D[0],D[1])}else{for(let D=A;D<m;D++)this.paintVertexArray.emplace(D,w);this.maxValue=Math.max(this.maxValue,Math.abs(w))}}upload(A){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=A.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class dl{constructor(A,m,w,D,U,V){this.expression=A,this.uniformNames=m.map(Y=>`u_${Y}_t`),this.type=w,this.useIntegerZoom=D,this.zoom=U,this.maxValue=0,this.paintVertexAttributes=m.map(Y=>({name:`a_${Y}`,type:"Float32",components:w==="color"?4:2,offset:0})),this.paintVertexArray=new V}populatePaintArray(A,m,w,D,U){const V=this.expression.evaluate(new Qn(this.zoom),m,{},D,[],U),Y=this.expression.evaluate(new Qn(this.zoom+1),m,{},D,[],U),ee=this.paintVertexArray.length;this.paintVertexArray.resize(A),this._setPaintValue(ee,A,V,Y)}updatePaintArray(A,m,w,D){const U=this.expression.evaluate({zoom:this.zoom},w,D),V=this.expression.evaluate({zoom:this.zoom+1},w,D);this._setPaintValue(A,m,U,V)}_setPaintValue(A,m,w,D){if(this.type==="color"){const U=Du(w),V=Du(D);for(let Y=A;Y<m;Y++)this.paintVertexArray.emplace(Y,U[0],U[1],V[0],V[1])}else{for(let U=A;U<m;U++)this.paintVertexArray.emplace(U,w,D);this.maxValue=Math.max(this.maxValue,Math.abs(w),Math.abs(D))}}upload(A){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=A.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(A,m){const w=this.useIntegerZoom?Math.floor(m.zoom):m.zoom,D=En(this.expression.interpolationFactor(w,this.zoom,this.zoom+1),0,1);A.set(D)}getBinding(A,m,w){return new Xu(A,m)}}class AA{constructor(A,m,w,D,U,V){this.expression=A,this.type=m,this.useIntegerZoom=w,this.zoom=D,this.layerId=V,this.zoomInPaintVertexArray=new U,this.zoomOutPaintVertexArray=new U}populatePaintArray(A,m,w){const D=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(A),this.zoomOutPaintVertexArray.resize(A),this._setPaintValues(D,A,m.patterns&&m.patterns[this.layerId],w)}updatePaintArray(A,m,w,D,U){this._setPaintValues(A,m,w.patterns&&w.patterns[this.layerId],U)}_setPaintValues(A,m,w,D){if(!D||!w)return;const{min:U,mid:V,max:Y}=w,ee=D[U],ae=D[V],fe=D[Y];if(ee&&ae&&fe)for(let _e=A;_e<m;_e++)this.zoomInPaintVertexArray.emplace(_e,ae.tl[0],ae.tl[1],ae.br[0],ae.br[1],ee.tl[0],ee.tl[1],ee.br[0],ee.br[1],ae.pixelRatio,ee.pixelRatio),this.zoomOutPaintVertexArray.emplace(_e,ae.tl[0],ae.tl[1],ae.br[0],ae.br[1],fe.tl[0],fe.tl[1],fe.br[0],fe.br[1],ae.pixelRatio,fe.pixelRatio)}upload(A){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=A.createVertexBuffer(this.zoomInPaintVertexArray,Sl.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=A.createVertexBuffer(this.zoomOutPaintVertexArray,Sl.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Ku{constructor(A,m,w){this.binders={},this._buffers=[];const D=[];for(const U in A.paint._values){if(!w(U))continue;const V=A.paint.get(U);if(!(V instanceof Mo&&fs(V.property.specification)))continue;const Y=mp(U,A.type),ee=V.value,ae=V.property.specification.type,fe=V.property.useIntegerZoom,_e=V.property.specification["property-type"],Se=_e==="cross-faded"||_e==="cross-faded-data-driven";if(ee.kind==="constant")this.binders[U]=Se?new dc(ee.value,Y):new lA(ee.value,Y,ae),D.push(`/u_${U}`);else if(ee.kind==="source"||Se){const Oe=Ed(U,ae,"source");this.binders[U]=Se?new AA(ee,ae,fe,m,Oe,A.id):new Il(ee,Y,ae,Oe),D.push(`/a_${U}`)}else{const Oe=Ed(U,ae,"composite");this.binders[U]=new dl(ee,Y,ae,fe,m,Oe),D.push(`/z_${U}`)}}this.cacheKey=D.sort().join("")}getMaxValue(A){const m=this.binders[A];return m instanceof Il||m instanceof dl?m.maxValue:0}populatePaintArrays(A,m,w,D,U){for(const V in this.binders){const Y=this.binders[V];(Y instanceof Il||Y instanceof dl||Y instanceof AA)&&Y.populatePaintArray(A,m,w,D,U)}}setConstantPatternPositions(A,m){for(const w in this.binders){const D=this.binders[w];D instanceof dc&&D.setConstantPatternPositions(A,m)}}updatePaintArrays(A,m,w,D,U){let V=!1;for(const Y in A){const ee=m.getPositions(Y);for(const ae of ee){const fe=w.feature(ae.index);for(const _e in this.binders){const Se=this.binders[_e];if((Se instanceof Il||Se instanceof dl||Se instanceof AA)&&Se.expression.isStateDependent===!0){const Oe=D.paint.get(_e);Se.expression=Oe.value,Se.updatePaintArray(ae.start,ae.end,fe,A[Y],U),V=!0}}}}return V}defines(){const A=[];for(const m in this.binders){const w=this.binders[m];(w instanceof lA||w instanceof dc)&&A.push(...w.uniformNames.map(D=>`#define HAS_UNIFORM_${D}`))}return A}getBinderAttributes(){const A=[];for(const m in this.binders){const w=this.binders[m];if(w instanceof Il||w instanceof dl)for(let D=0;D<w.paintVertexAttributes.length;D++)A.push(w.paintVertexAttributes[D].name);else if(w instanceof AA)for(let D=0;D<Sl.members.length;D++)A.push(Sl.members[D].name)}return A}getBinderUniforms(){const A=[];for(const m in this.binders){const w=this.binders[m];if(w instanceof lA||w instanceof dc||w instanceof dl)for(const D of w.uniformNames)A.push(D)}return A}getPaintVertexBuffers(){return this._buffers}getUniforms(A,m){const w=[];for(const D in this.binders){const U=this.binders[D];if(U instanceof lA||U instanceof dc||U instanceof dl){for(const V of U.uniformNames)if(m[V]){const Y=U.getBinding(A,m[V],V);w.push({name:V,property:D,binding:Y})}}}return w}setUniforms(A,m,w,D){for(const{name:U,property:V,binding:Y}of m)this.binders[V].setUniform(Y,D,w.get(V),U)}updatePaintBuffers(A){this._buffers=[];for(const m in this.binders){const w=this.binders[m];if(A&&w instanceof AA){const D=A.fromScale===2?w.zoomInPaintVertexBuffer:w.zoomOutPaintVertexBuffer;D&&this._buffers.push(D)}else(w instanceof Il||w instanceof dl)&&w.paintVertexBuffer&&this._buffers.push(w.paintVertexBuffer)}}upload(A){for(const m in this.binders){const w=this.binders[m];(w instanceof Il||w instanceof dl||w instanceof AA)&&w.upload(A)}this.updatePaintBuffers()}destroy(){for(const A in this.binders){const m=this.binders[A];(m instanceof Il||m instanceof dl||m instanceof AA)&&m.destroy()}}}class bA{constructor(A,m,w=()=>!0){this.programConfigurations={};for(const D of A)this.programConfigurations[D.id]=new Ku(D,m,w);this.needsUpload=!1,this._featureMap=new Hs,this._bufferOffset=0}populatePaintArrays(A,m,w,D,U,V){for(const Y in this.programConfigurations)this.programConfigurations[Y].populatePaintArrays(A,m,D,U,V);m.id!==void 0&&this._featureMap.add(m.id,w,this._bufferOffset,A),this._bufferOffset=A,this.needsUpload=!0}updatePaintArrays(A,m,w,D){for(const U of w)this.needsUpload=this.programConfigurations[U.id].updatePaintArrays(A,this._featureMap,m,U,D)||this.needsUpload}get(A){return this.programConfigurations[A]}upload(A){if(this.needsUpload){for(const m in this.programConfigurations)this.programConfigurations[m].upload(A);this.needsUpload=!1}}destroy(){for(const A in this.programConfigurations)this.programConfigurations[A].destroy()}}function mp(f,A){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[f]||[f.replace(`${A}-`,"").replace(/-/g,"_")]}function Ed(f,A,m){const w={color:{source:ze,composite:R},number:{source:h,composite:ze}},D=function(U){return{"line-pattern":{source:or,composite:or},"fill-pattern":{source:or,composite:or},"fill-extrusion-pattern":{source:or,composite:or}}[U]}(f);return D&&D[m]||w[A][m]}Fi("ConstantBinder",lA),Fi("CrossFadedConstantBinder",dc),Fi("SourceExpressionBinder",Il),Fi("CrossFadedCompositeBinder",AA),Fi("CompositeExpressionBinder",dl),Fi("ProgramConfiguration",Ku,{omit:["_buffers"]}),Fi("ProgramConfigurationSet",bA);const Ns=8192,mf=Math.pow(2,14)-1,Md=-mf-1;function Pu(f){const A=Ns/f.extent,m=f.loadGeometry();for(let w=0;w<m.length;w++){const D=m[w];for(let U=0;U<D.length;U++){const V=D[U],Y=Math.round(V.x*A),ee=Math.round(V.y*A);V.x=En(Y,Md,mf),V.y=En(ee,Md,mf),(Y<V.x||Y>V.x+1||ee<V.y||ee>V.y+1)&&wi("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return m}function lu(f,A){return{type:f.type,id:f.id,properties:f.properties,geometry:A?Pu(f):[]}}function Dh(f,A,m,w,D){f.emplaceBack(2*A+(w+1)/2,2*m+(D+1)/2)}class _f{constructor(A){this.zoom=A.zoom,this.overscaling=A.overscaling,this.layers=A.layers,this.layerIds=this.layers.map(m=>m.id),this.index=A.index,this.hasPattern=!1,this.layoutVertexArray=new dt,this.indexArray=new Or,this.segments=new is,this.programConfigurations=new bA(A.layers,A.zoom),this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id)}populate(A,m,w){const D=this.layers[0],U=[];let V=null,Y=!1;D.type==="circle"&&(V=D.layout.get("circle-sort-key"),Y=!V.isConstant());for(const{feature:ee,id:ae,index:fe,sourceLayerIndex:_e}of A){const Se=this.layers[0]._featureFilter.needGeometry,Oe=lu(ee,Se);if(!this.layers[0]._featureFilter.filter(new Qn(this.zoom),Oe,w))continue;const ce=Y?V.evaluate(Oe,{},w):void 0,tt={id:ae,properties:ee.properties,type:ee.type,sourceLayerIndex:_e,index:fe,geometry:Se?Oe.geometry:Pu(ee),patterns:{},sortKey:ce};U.push(tt)}Y&&U.sort((ee,ae)=>ee.sortKey-ae.sortKey);for(const ee of U){const{geometry:ae,index:fe,sourceLayerIndex:_e}=ee,Se=A[fe].feature;this.addFeature(ee,ae,fe,w),m.featureIndex.insert(Se,ae,fe,_e,this.index)}}update(A,m,w){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(A,m,this.stateDependentLayers,w)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(A){this.uploaded||(this.layoutVertexBuffer=A.createVertexBuffer(this.layoutVertexArray,Bn),this.indexBuffer=A.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(A),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(A,m,w,D){for(const U of m)for(const V of U){const Y=V.x,ee=V.y;if(Y<0||Y>=Ns||ee<0||ee>=Ns)continue;const ae=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,A.sortKey),fe=ae.vertexLength;Dh(this.layoutVertexArray,Y,ee,-1,-1),Dh(this.layoutVertexArray,Y,ee,1,-1),Dh(this.layoutVertexArray,Y,ee,1,1),Dh(this.layoutVertexArray,Y,ee,-1,1),this.indexArray.emplaceBack(fe,fe+1,fe+2),this.indexArray.emplaceBack(fe,fe+3,fe+2),ae.vertexLength+=4,ae.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,A,w,{},D)}}function Sd(f,A){for(let m=0;m<f.length;m++)if(Ju(A,f[m]))return!0;for(let m=0;m<A.length;m++)if(Ju(f,A[m]))return!0;return!!Cd(f,A)}function _p(f,A,m){return!!Ju(f,A)||!!Au(A,f,m)}function Id(f,A){if(f.length===1)return xp(A,f[0]);for(let m=0;m<A.length;m++){const w=A[m];for(let D=0;D<w.length;D++)if(Ju(f,w[D]))return!0}for(let m=0;m<f.length;m++)if(xp(A,f[m]))return!0;for(let m=0;m<A.length;m++)if(Cd(f,A[m]))return!0;return!1}function _a(f,A,m){if(f.length>1){if(Cd(f,A))return!0;for(let w=0;w<A.length;w++)if(Au(A[w],f,m))return!0}for(let w=0;w<f.length;w++)if(Au(f[w],A,m))return!0;return!1}function Cd(f,A){if(f.length===0||A.length===0)return!1;for(let m=0;m<f.length-1;m++){const w=f[m],D=f[m+1];for(let U=0;U<A.length-1;U++)if(gp(w,D,A[U],A[U+1]))return!0}return!1}function gp(f,A,m,w){return hr(f,m,w)!==hr(A,m,w)&&hr(f,A,m)!==hr(f,A,w)}function Au(f,A,m){const w=m*m;if(A.length===1)return f.distSqr(A[0])<w;for(let D=1;D<A.length;D++)if(yp(f,A[D-1],A[D])<w)return!0;return!1}function yp(f,A,m){const w=A.distSqr(m);if(w===0)return f.distSqr(A);const D=((f.x-A.x)*(m.x-A.x)+(f.y-A.y)*(m.y-A.y))/w;return f.distSqr(D<0?A:D>1?m:m.sub(A)._mult(D)._add(A))}function xp(f,A){let m,w,D,U=!1;for(let V=0;V<f.length;V++){m=f[V];for(let Y=0,ee=m.length-1;Y<m.length;ee=Y++)w=m[Y],D=m[ee],w.y>A.y!=D.y>A.y&&A.x<(D.x-w.x)*(A.y-w.y)/(D.y-w.y)+w.x&&(U=!U)}return U}function Ju(f,A){let m=!1;for(let w=0,D=f.length-1;w<f.length;D=w++){const U=f[w],V=f[D];U.y>A.y!=V.y>A.y&&A.x<(V.x-U.x)*(A.y-U.y)/(V.y-U.y)+U.x&&(m=!m)}return m}function q_(f,A,m){const w=m[0],D=m[2];if(f.x<w.x&&A.x<w.x||f.x>D.x&&A.x>D.x||f.y<w.y&&A.y<w.y||f.y>D.y&&A.y>D.y)return!1;const U=hr(f,A,m[0]);return U!==hr(f,A,m[1])||U!==hr(f,A,m[2])||U!==hr(f,A,m[3])}function Ph(f,A,m){const w=A.paint.get(f).value;return w.kind==="constant"?w.value:m.programConfigurations.get(A.id).getMaxValue(f)}function gf(f){return Math.sqrt(f[0]*f[0]+f[1]*f[1])}function $u(f,A,m,w,D){if(!A[0]&&!A[1])return f;const U=Gt.convert(A)._mult(D);m==="viewport"&&U._rotate(-w);const V=[];for(let Y=0;Y<f.length;Y++)V.push(f[Y].sub(U));return V}let vp,bp;Fi("CircleBucket",_f,{omit:["layers"]});var Q_={get paint(){return bp=bp||new $r({"circle-radius":new Kt(Be.paint_circle["circle-radius"]),"circle-color":new Kt(Be.paint_circle["circle-color"]),"circle-blur":new Kt(Be.paint_circle["circle-blur"]),"circle-opacity":new Kt(Be.paint_circle["circle-opacity"]),"circle-translate":new Nt(Be.paint_circle["circle-translate"]),"circle-translate-anchor":new Nt(Be.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Nt(Be.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Nt(Be.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Kt(Be.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Kt(Be.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Kt(Be.paint_circle["circle-stroke-opacity"])})},get layout(){return vp=vp||new $r({"circle-sort-key":new Kt(Be.layout_circle["circle-sort-key"])})}},Ws=1e-6,Fc=typeof Float32Array<"u"?Float32Array:Array;function kd(f){return f[0]=1,f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=1,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[10]=1,f[11]=0,f[12]=0,f[13]=0,f[14]=0,f[15]=1,f}function Oc(f,A,m){var w=A[0],D=A[1],U=A[2],V=A[3],Y=A[4],ee=A[5],ae=A[6],fe=A[7],_e=A[8],Se=A[9],Oe=A[10],ce=A[11],tt=A[12],at=A[13],pt=A[14],Ct=A[15],bt=m[0],me=m[1],Vt=m[2],oi=m[3];return f[0]=bt*w+me*Y+Vt*_e+oi*tt,f[1]=bt*D+me*ee+Vt*Se+oi*at,f[2]=bt*U+me*ae+Vt*Oe+oi*pt,f[3]=bt*V+me*fe+Vt*ce+oi*Ct,f[4]=(bt=m[4])*w+(me=m[5])*Y+(Vt=m[6])*_e+(oi=m[7])*tt,f[5]=bt*D+me*ee+Vt*Se+oi*at,f[6]=bt*U+me*ae+Vt*Oe+oi*pt,f[7]=bt*V+me*fe+Vt*ce+oi*Ct,f[8]=(bt=m[8])*w+(me=m[9])*Y+(Vt=m[10])*_e+(oi=m[11])*tt,f[9]=bt*D+me*ee+Vt*Se+oi*at,f[10]=bt*U+me*ae+Vt*Oe+oi*pt,f[11]=bt*V+me*fe+Vt*ce+oi*Ct,f[12]=(bt=m[12])*w+(me=m[13])*Y+(Vt=m[14])*_e+(oi=m[15])*tt,f[13]=bt*D+me*ee+Vt*Se+oi*at,f[14]=bt*U+me*ae+Vt*Oe+oi*pt,f[15]=bt*V+me*fe+Vt*ce+oi*Ct,f}Math.hypot||(Math.hypot=function(){for(var f=0,A=arguments.length;A--;)f+=arguments[A]*arguments[A];return Math.sqrt(f)});var jl,eh=Oc;function zu(f,A,m){var w=A[0],D=A[1],U=A[2],V=A[3];return f[0]=m[0]*w+m[4]*D+m[8]*U+m[12]*V,f[1]=m[1]*w+m[5]*D+m[9]*U+m[13]*V,f[2]=m[2]*w+m[6]*D+m[10]*U+m[14]*V,f[3]=m[3]*w+m[7]*D+m[11]*U+m[15]*V,f}jl=new Fc(4),Fc!=Float32Array&&(jl[0]=0,jl[1]=0,jl[2]=0,jl[3]=0);class Mi extends Hn{constructor(A){super(A,Q_)}createBucket(A){return new _f(A)}queryRadius(A){const m=A;return Ph("circle-radius",this,m)+Ph("circle-stroke-width",this,m)+gf(this.paint.get("circle-translate"))}queryIntersectsFeature(A,m,w,D,U,V,Y,ee){const ae=$u(A,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),V.angle,Y),fe=this.paint.get("circle-radius").evaluate(m,w)+this.paint.get("circle-stroke-width").evaluate(m,w),_e=this.paint.get("circle-pitch-alignment")==="map",Se=_e?ae:function(ce,tt){return ce.map(at=>Dd(at,tt))}(ae,ee),Oe=_e?fe*Y:fe;for(const ce of D)for(const tt of ce){const at=_e?tt:Dd(tt,ee);let pt=Oe;const Ct=zu([],[tt.x,tt.y,0,1],ee);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?pt*=Ct[3]/V.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(pt*=V.cameraToCenterDistance/Ct[3]),_p(Se,at,pt))return!0}return!1}}function Dd(f,A){const m=zu([],[f.x,f.y,0,1],A);return new Gt(m[0]/m[3],m[1]/m[3])}class Pd extends _f{}let Bu;Fi("HeatmapBucket",Pd,{omit:["layers"]});var th={get paint(){return Bu=Bu||new $r({"heatmap-radius":new Kt(Be.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Kt(Be.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Nt(Be.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ul(Be.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Nt(Be.paint_heatmap["heatmap-opacity"])})}};function zi(f,{width:A,height:m},w,D){if(D){if(D instanceof Uint8ClampedArray)D=new Uint8Array(D.buffer);else if(D.length!==A*m*w)throw new RangeError(`mismatched image size. expected: ${D.length} but got: ${A*m*w}`)}else D=new Uint8Array(A*m*w);return f.width=A,f.height=m,f.data=D,f}function yf(f,{width:A,height:m},w){if(A===f.width&&m===f.height)return;const D=zi({},{width:A,height:m},w);zd(f,D,{x:0,y:0},{x:0,y:0},{width:Math.min(f.width,A),height:Math.min(f.height,m)},w),f.width=A,f.height=m,f.data=D.data}function zd(f,A,m,w,D,U){if(D.width===0||D.height===0)return A;if(D.width>f.width||D.height>f.height||m.x>f.width-D.width||m.y>f.height-D.height)throw new RangeError("out of range source coordinates for image copy");if(D.width>A.width||D.height>A.height||w.x>A.width-D.width||w.y>A.height-D.height)throw new RangeError("out of range destination coordinates for image copy");const V=f.data,Y=A.data;if(V===Y)throw new Error("srcData equals dstData, so image is already copied");for(let ee=0;ee<D.height;ee++){const ae=((m.y+ee)*f.width+m.x)*U,fe=((w.y+ee)*A.width+w.x)*U;for(let _e=0;_e<D.width*U;_e++)Y[fe+_e]=V[ae+_e]}return A}class zh{constructor(A,m){zi(this,A,1,m)}resize(A){yf(this,A,1)}clone(){return new zh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(A,m,w,D,U){zd(A,m,w,D,U,1)}}class Cl{constructor(A,m){zi(this,A,4,m)}resize(A){yf(this,A,4)}replace(A,m){m?this.data.set(A):this.data=A instanceof Uint8ClampedArray?new Uint8Array(A.buffer):A}clone(){return new Cl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(A,m,w,D,U){zd(A,m,w,D,U,4)}}function Bd(f){const A={},m=f.resolution||256,w=f.clips?f.clips.length:1,D=f.image||new Cl({width:m,height:w});if(Math.log(m)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${m}`);const U=(V,Y,ee)=>{A[f.evaluationKey]=ee;const ae=f.expression.evaluate(A);D.data[V+Y+0]=Math.floor(255*ae.r/ae.a),D.data[V+Y+1]=Math.floor(255*ae.g/ae.a),D.data[V+Y+2]=Math.floor(255*ae.b/ae.a),D.data[V+Y+3]=Math.floor(255*ae.a)};if(f.clips)for(let V=0,Y=0;V<w;++V,Y+=4*m)for(let ee=0,ae=0;ee<m;ee++,ae+=4){const fe=ee/(m-1),{start:_e,end:Se}=f.clips[V];U(Y,ae,_e*(1-fe)+Se*fe)}else for(let V=0,Y=0;V<m;V++,Y+=4)U(0,Y,V/(m-1));return D}Fi("AlphaImage",zh),Fi("RGBAImage",Cl);class wp extends Hn{createBucket(A){return new Pd(A)}constructor(A){super(A,th),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(A){A==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Bd({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Tp;var H_={get paint(){return Tp=Tp||new $r({"hillshade-illumination-direction":new Nt(Be.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Nt(Be.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Nt(Be.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Nt(Be.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Nt(Be.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Nt(Be.paint_hillshade["hillshade-accent-color"])})}};class Ld extends Hn{constructor(A){super(A,H_)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const Rd=L([{name:"a_pos",components:2,type:"Int16"}],4),{members:Fd}=Rd;var Bh={exports:{}};function Ya(f,A,m){m=m||2;var w,D,U,V,Y,ee,ae,fe=A&&A.length,_e=fe?A[0]*m:f.length,Se=Nc(f,0,_e,m,!0),Oe=[];if(!Se||Se.next===Se.prev)return Oe;if(fe&&(Se=function(tt,at,pt,Ct){var bt,me,Vt,oi=[];for(bt=0,me=at.length;bt<me;bt++)(Vt=Nc(tt,at[bt]*Ct,bt<me-1?at[bt+1]*Ct:tt.length,Ct,!1))===Vt.next&&(Vt.steiner=!0),oi.push(Mp(Vt));for(oi.sort(_s),bt=0;bt<oi.length;bt++)pt=xf(oi[bt],pt);return pt}(f,A,Se,m)),f.length>80*m){w=U=f[0],D=V=f[1];for(var ce=m;ce<_e;ce+=m)(Y=f[ce])<w&&(w=Y),(ee=f[ce+1])<D&&(D=ee),Y>U&&(U=Y),ee>V&&(V=ee);ae=(ae=Math.max(U-w,V-D))!==0?32767/ae:0}return Lu(Se,Oe,m,w,D,ae,0),Oe}function Nc(f,A,m,w,D){var U,V;if(D===vf(f,A,m,w)>0)for(U=A;U<m;U+=w)V=Vd(U,f[U],f[U+1],V);else for(U=m-w;U>=A;U-=w)V=Vd(U,f[U],f[U+1],V);return V&&uu(V,V.next)&&(Zo(V),V=V.next),V}function cu(f,A){if(!f)return f;A||(A=f);var m,w=f;do if(m=!1,w.steiner||!uu(w,w.next)&&Ps(w.prev,w,w.next)!==0)w=w.next;else{if(Zo(w),(w=A=w.prev)===w.next)break;m=!0}while(m||w!==A);return A}function Lu(f,A,m,w,D,U,V){if(f){!V&&U&&function(fe,_e,Se,Oe){var ce=fe;do ce.z===0&&(ce.z=Ru(ce.x,ce.y,_e,Se,Oe)),ce.prevZ=ce.prev,ce.nextZ=ce.next,ce=ce.next;while(ce!==fe);ce.prevZ.nextZ=null,ce.prevZ=null,function(tt){var at,pt,Ct,bt,me,Vt,oi,Si,tr=1;do{for(pt=tt,tt=null,me=null,Vt=0;pt;){for(Vt++,Ct=pt,oi=0,at=0;at<tr&&(oi++,Ct=Ct.nextZ);at++);for(Si=tr;oi>0||Si>0&&Ct;)oi!==0&&(Si===0||!Ct||pt.z<=Ct.z)?(bt=pt,pt=pt.nextZ,oi--):(bt=Ct,Ct=Ct.nextZ,Si--),me?me.nextZ=bt:tt=bt,bt.prevZ=me,me=bt;pt=Ct}me.nextZ=null,tr*=2}while(Vt>1)}(ce)}(f,w,D,U);for(var Y,ee,ae=f;f.prev!==f.next;)if(Y=f.prev,ee=f.next,U?Nd(f,w,D,U):Od(f))A.push(Y.i/m|0),A.push(f.i/m|0),A.push(ee.i/m|0),Zo(f),f=ee.next,ae=ee.next;else if((f=ee)===ae){V?V===1?Lu(f=Ep(cu(f),A,m),A,m,w,D,U,2):V===2&&wA(f,A,m,w,D,U):Lu(cu(f),A,m,w,D,U,1);break}}}function Od(f){var A=f.prev,m=f,w=f.next;if(Ps(A,m,w)>=0)return!1;for(var D=A.x,U=m.x,V=w.x,Y=A.y,ee=m.y,ae=w.y,fe=D<U?D<V?D:V:U<V?U:V,_e=Y<ee?Y<ae?Y:ae:ee<ae?ee:ae,Se=D>U?D>V?D:V:U>V?U:V,Oe=Y>ee?Y>ae?Y:ae:ee>ae?ee:ae,ce=w.next;ce!==A;){if(ce.x>=fe&&ce.x<=Se&&ce.y>=_e&&ce.y<=Oe&&Fu(D,Y,U,ee,V,ae,ce.x,ce.y)&&Ps(ce.prev,ce,ce.next)>=0)return!1;ce=ce.next}return!0}function Nd(f,A,m,w){var D=f.prev,U=f,V=f.next;if(Ps(D,U,V)>=0)return!1;for(var Y=D.x,ee=U.x,ae=V.x,fe=D.y,_e=U.y,Se=V.y,Oe=Y<ee?Y<ae?Y:ae:ee<ae?ee:ae,ce=fe<_e?fe<Se?fe:Se:_e<Se?_e:Se,tt=Y>ee?Y>ae?Y:ae:ee>ae?ee:ae,at=fe>_e?fe>Se?fe:Se:_e>Se?_e:Se,pt=Ru(Oe,ce,A,m,w),Ct=Ru(tt,at,A,m,w),bt=f.prevZ,me=f.nextZ;bt&&bt.z>=pt&&me&&me.z<=Ct;){if(bt.x>=Oe&&bt.x<=tt&&bt.y>=ce&&bt.y<=at&&bt!==D&&bt!==V&&Fu(Y,fe,ee,_e,ae,Se,bt.x,bt.y)&&Ps(bt.prev,bt,bt.next)>=0||(bt=bt.prevZ,me.x>=Oe&&me.x<=tt&&me.y>=ce&&me.y<=at&&me!==D&&me!==V&&Fu(Y,fe,ee,_e,ae,Se,me.x,me.y)&&Ps(me.prev,me,me.next)>=0))return!1;me=me.nextZ}for(;bt&&bt.z>=pt;){if(bt.x>=Oe&&bt.x<=tt&&bt.y>=ce&&bt.y<=at&&bt!==D&&bt!==V&&Fu(Y,fe,ee,_e,ae,Se,bt.x,bt.y)&&Ps(bt.prev,bt,bt.next)>=0)return!1;bt=bt.prevZ}for(;me&&me.z<=Ct;){if(me.x>=Oe&&me.x<=tt&&me.y>=ce&&me.y<=at&&me!==D&&me!==V&&Fu(Y,fe,ee,_e,ae,Se,me.x,me.y)&&Ps(me.prev,me,me.next)>=0)return!1;me=me.nextZ}return!0}function Ep(f,A,m){var w=f;do{var D=w.prev,U=w.next.next;!uu(D,U)&&ri(D,w,w.next,U)&&as(D,U)&&as(U,D)&&(A.push(D.i/m|0),A.push(w.i/m|0),A.push(U.i/m|0),Zo(w),Zo(w.next),w=f=U),w=w.next}while(w!==f);return cu(w)}function wA(f,A,m,w,D,U){var V=f;do{for(var Y=V.next.next;Y!==V.prev;){if(V.i!==Y.i&&W_(V,Y)){var ee=Lh(V,Y);return V=cu(V,V.next),ee=cu(ee,ee.next),Lu(V,A,m,w,D,U,0),void Lu(ee,A,m,w,D,U,0)}Y=Y.next}V=V.next}while(V!==f)}function _s(f,A){return f.x-A.x}function xf(f,A){var m=function(D,U){var V,Y=U,ee=D.x,ae=D.y,fe=-1/0;do{if(ae<=Y.y&&ae>=Y.next.y&&Y.next.y!==Y.y){var _e=Y.x+(ae-Y.y)*(Y.next.x-Y.x)/(Y.next.y-Y.y);if(_e<=ee&&_e>fe&&(fe=_e,V=Y.x<Y.next.x?Y:Y.next,_e===ee))return V}Y=Y.next}while(Y!==U);if(!V)return null;var Se,Oe=V,ce=V.x,tt=V.y,at=1/0;Y=V;do ee>=Y.x&&Y.x>=ce&&ee!==Y.x&&Fu(ae<tt?ee:fe,ae,ce,tt,ae<tt?fe:ee,ae,Y.x,Y.y)&&(Se=Math.abs(ae-Y.y)/(ee-Y.x),as(Y,D)&&(Se<at||Se===at&&(Y.x>V.x||Y.x===V.x&&Ud(V,Y)))&&(V=Y,at=Se)),Y=Y.next;while(Y!==Oe);return V}(f,A);if(!m)return A;var w=Lh(m,f);return cu(w,w.next),cu(m,m.next)}function Ud(f,A){return Ps(f.prev,f,A.prev)<0&&Ps(A.next,f,f.next)<0}function Ru(f,A,m,w,D){return(f=1431655765&((f=858993459&((f=252645135&((f=16711935&((f=(f-m)*D|0)|f<<8))|f<<4))|f<<2))|f<<1))|(A=1431655765&((A=858993459&((A=252645135&((A=16711935&((A=(A-w)*D|0)|A<<8))|A<<4))|A<<2))|A<<1))<<1}function Mp(f){var A=f,m=f;do(A.x<m.x||A.x===m.x&&A.y<m.y)&&(m=A),A=A.next;while(A!==f);return m}function Fu(f,A,m,w,D,U,V,Y){return(D-V)*(A-Y)>=(f-V)*(U-Y)&&(f-V)*(w-Y)>=(m-V)*(A-Y)&&(m-V)*(U-Y)>=(D-V)*(w-Y)}function W_(f,A){return f.next.i!==A.i&&f.prev.i!==A.i&&!function(m,w){var D=m;do{if(D.i!==m.i&&D.next.i!==m.i&&D.i!==w.i&&D.next.i!==w.i&&ri(D,D.next,m,w))return!0;D=D.next}while(D!==m);return!1}(f,A)&&(as(f,A)&&as(A,f)&&function(m,w){var D=m,U=!1,V=(m.x+w.x)/2,Y=(m.y+w.y)/2;do D.y>Y!=D.next.y>Y&&D.next.y!==D.y&&V<(D.next.x-D.x)*(Y-D.y)/(D.next.y-D.y)+D.x&&(U=!U),D=D.next;while(D!==m);return U}(f,A)&&(Ps(f.prev,f,A.prev)||Ps(f,A.prev,A))||uu(f,A)&&Ps(f.prev,f,f.next)>0&&Ps(A.prev,A,A.next)>0)}function Ps(f,A,m){return(A.y-f.y)*(m.x-A.x)-(A.x-f.x)*(m.y-A.y)}function uu(f,A){return f.x===A.x&&f.y===A.y}function ri(f,A,m,w){var D=hu(Ps(f,A,m)),U=hu(Ps(f,A,w)),V=hu(Ps(m,w,f)),Y=hu(Ps(m,w,A));return D!==U&&V!==Y||!(D!==0||!Gi(f,m,A))||!(U!==0||!Gi(f,w,A))||!(V!==0||!Gi(m,f,w))||!(Y!==0||!Gi(m,A,w))}function Gi(f,A,m){return A.x<=Math.max(f.x,m.x)&&A.x>=Math.min(f.x,m.x)&&A.y<=Math.max(f.y,m.y)&&A.y>=Math.min(f.y,m.y)}function hu(f){return f>0?1:f<0?-1:0}function as(f,A){return Ps(f.prev,f,f.next)<0?Ps(f,A,f.next)>=0&&Ps(f,f.prev,A)>=0:Ps(f,A,f.prev)<0||Ps(f,f.next,A)<0}function Lh(f,A){var m=new ih(f.i,f.x,f.y),w=new ih(A.i,A.x,A.y),D=f.next,U=A.prev;return f.next=A,A.prev=f,m.next=D,D.prev=m,w.next=m,m.prev=w,U.next=w,w.prev=U,w}function Vd(f,A,m,w){var D=new ih(f,A,m);return w?(D.next=w.next,D.prev=w,w.next.prev=D,w.next=D):(D.prev=D,D.next=D),D}function Zo(f){f.next.prev=f.prev,f.prev.next=f.next,f.prevZ&&(f.prevZ.nextZ=f.nextZ),f.nextZ&&(f.nextZ.prevZ=f.prevZ)}function ih(f,A,m){this.i=f,this.x=A,this.y=m,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function vf(f,A,m,w){for(var D=0,U=A,V=m-w;U<m;U+=w)D+=(f[V]-f[U])*(f[U+1]+f[V+1]),V=U;return D}Bh.exports=Ya,Bh.exports.default=Ya,Ya.deviation=function(f,A,m,w){var D=A&&A.length,U=Math.abs(vf(f,0,D?A[0]*m:f.length,m));if(D)for(var V=0,Y=A.length;V<Y;V++)U-=Math.abs(vf(f,A[V]*m,V<Y-1?A[V+1]*m:f.length,m));var ee=0;for(V=0;V<w.length;V+=3){var ae=w[V]*m,fe=w[V+1]*m,_e=w[V+2]*m;ee+=Math.abs((f[ae]-f[_e])*(f[fe+1]-f[ae+1])-(f[ae]-f[fe])*(f[_e+1]-f[ae+1]))}return U===0&&ee===0?0:Math.abs((ee-U)/U)},Ya.flatten=function(f){for(var A=f[0][0].length,m={vertices:[],holes:[],dimensions:A},w=0,D=0;D<f.length;D++){for(var U=0;U<f[D].length;U++)for(var V=0;V<A;V++)m.vertices.push(f[D][U][V]);D>0&&m.holes.push(w+=f[D-1].length)}return m};var Gl=Ee(Bh.exports);function X_(f,A,m,w,D){Sp(f,A,m||0,w||f.length-1,D||gs)}function Sp(f,A,m,w,D){for(;w>m;){if(w-m>600){var U=w-m+1,V=A-m+1,Y=Math.log(U),ee=.5*Math.exp(2*Y/3),ae=.5*Math.sqrt(Y*ee*(U-ee)/U)*(V-U/2<0?-1:1);Sp(f,A,Math.max(m,Math.floor(A-V*ee/U+ae)),Math.min(w,Math.floor(A+(U-V)*ee/U+ae)),D)}var fe=f[A],_e=m,Se=w;for(fu(f,m,A),D(f[w],fe)>0&&fu(f,m,w);_e<Se;){for(fu(f,_e,Se),_e++,Se--;D(f[_e],fe)<0;)_e++;for(;D(f[Se],fe)>0;)Se--}D(f[m],fe)===0?fu(f,m,Se):fu(f,++Se,w),Se<=A&&(m=Se+1),A<=Se&&(w=Se-1)}}function fu(f,A,m){var w=f[A];f[A]=f[m],f[m]=w}function gs(f,A){return f<A?-1:f>A?1:0}function an(f,A){const m=f.length;if(m<=1)return[f];const w=[];let D,U;for(let V=0;V<m;V++){const Y=kn(f[V]);Y!==0&&(f[V].area=Math.abs(Y),U===void 0&&(U=Y<0),U===Y<0?(D&&w.push(D),D=[f[V]]):D.push(f[V]))}if(D&&w.push(D),A>1)for(let V=0;V<w.length;V++)w[V].length<=A||(X_(w[V],A,1,w[V].length-1,Ip),w[V]=w[V].slice(0,A));return w}function Ip(f,A){return A.area-f.area}function pl(f,A,m){const w=m.patternDependencies;let D=!1;for(const U of A){const V=U.paint.get(`${f}-pattern`);V.isConstant()||(D=!0);const Y=V.constantOr(null);Y&&(D=!0,w[Y.to]=!0,w[Y.from]=!0)}return D}function rh(f,A,m,w,D){const U=D.patternDependencies;for(const V of A){const Y=V.paint.get(`${f}-pattern`).value;if(Y.kind!=="constant"){let ee=Y.evaluate({zoom:w-1},m,{},D.availableImages),ae=Y.evaluate({zoom:w},m,{},D.availableImages),fe=Y.evaluate({zoom:w+1},m,{},D.availableImages);ee=ee&&ee.name?ee.name:ee,ae=ae&&ae.name?ae.name:ae,fe=fe&&fe.name?fe.name:fe,U[ee]=!0,U[ae]=!0,U[fe]=!0,m.patterns[V.id]={min:ee,mid:ae,max:fe}}}return m}class Uc{constructor(A){this.zoom=A.zoom,this.overscaling=A.overscaling,this.layers=A.layers,this.layerIds=this.layers.map(m=>m.id),this.index=A.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ai,this.indexArray=new Or,this.indexArray2=new Xi,this.programConfigurations=new bA(A.layers,A.zoom),this.segments=new is,this.segments2=new is,this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id)}populate(A,m,w){this.hasPattern=pl("fill",this.layers,m);const D=this.layers[0].layout.get("fill-sort-key"),U=!D.isConstant(),V=[];for(const{feature:Y,id:ee,index:ae,sourceLayerIndex:fe}of A){const _e=this.layers[0]._featureFilter.needGeometry,Se=lu(Y,_e);if(!this.layers[0]._featureFilter.filter(new Qn(this.zoom),Se,w))continue;const Oe=U?D.evaluate(Se,{},w,m.availableImages):void 0,ce={id:ee,properties:Y.properties,type:Y.type,sourceLayerIndex:fe,index:ae,geometry:_e?Se.geometry:Pu(Y),patterns:{},sortKey:Oe};V.push(ce)}U&&V.sort((Y,ee)=>Y.sortKey-ee.sortKey);for(const Y of V){const{geometry:ee,index:ae,sourceLayerIndex:fe}=Y;if(this.hasPattern){const _e=rh("fill",this.layers,Y,this.zoom,m);this.patternFeatures.push(_e)}else this.addFeature(Y,ee,ae,w,{});m.featureIndex.insert(A[ae].feature,ee,ae,fe,this.index)}}update(A,m,w){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(A,m,this.stateDependentLayers,w)}addFeatures(A,m,w){for(const D of this.patternFeatures)this.addFeature(D,D.geometry,D.index,m,w)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(A){this.uploaded||(this.layoutVertexBuffer=A.createVertexBuffer(this.layoutVertexArray,Fd),this.indexBuffer=A.createIndexBuffer(this.indexArray),this.indexBuffer2=A.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(A),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(A,m,w,D,U){for(const V of an(m,500)){let Y=0;for(const Oe of V)Y+=Oe.length;const ee=this.segments.prepareSegment(Y,this.layoutVertexArray,this.indexArray),ae=ee.vertexLength,fe=[],_e=[];for(const Oe of V){if(Oe.length===0)continue;Oe!==V[0]&&_e.push(fe.length/2);const ce=this.segments2.prepareSegment(Oe.length,this.layoutVertexArray,this.indexArray2),tt=ce.vertexLength;this.layoutVertexArray.emplaceBack(Oe[0].x,Oe[0].y),this.indexArray2.emplaceBack(tt+Oe.length-1,tt),fe.push(Oe[0].x),fe.push(Oe[0].y);for(let at=1;at<Oe.length;at++)this.layoutVertexArray.emplaceBack(Oe[at].x,Oe[at].y),this.indexArray2.emplaceBack(tt+at-1,tt+at),fe.push(Oe[at].x),fe.push(Oe[at].y);ce.vertexLength+=Oe.length,ce.primitiveLength+=Oe.length}const Se=Gl(fe,_e);for(let Oe=0;Oe<Se.length;Oe+=3)this.indexArray.emplaceBack(ae+Se[Oe],ae+Se[Oe+1],ae+Se[Oe+2]);ee.vertexLength+=Y,ee.primitiveLength+=Se.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,A,w,U,D)}}let bf,wf;Fi("FillBucket",Uc,{omit:["layers","patternFeatures"]});var Vc={get paint(){return wf=wf||new $r({"fill-antialias":new Nt(Be.paint_fill["fill-antialias"]),"fill-opacity":new Kt(Be.paint_fill["fill-opacity"]),"fill-color":new Kt(Be.paint_fill["fill-color"]),"fill-outline-color":new Kt(Be.paint_fill["fill-outline-color"]),"fill-translate":new Nt(Be.paint_fill["fill-translate"]),"fill-translate-anchor":new Nt(Be.paint_fill["fill-translate-anchor"]),"fill-pattern":new aA(Be.paint_fill["fill-pattern"])})},get layout(){return bf=bf||new $r({"fill-sort-key":new Kt(Be.layout_fill["fill-sort-key"])})}};class du extends Hn{constructor(A){super(A,Vc)}recalculate(A,m){super.recalculate(A,m);const w=this.paint._values["fill-outline-color"];w.value.kind==="constant"&&w.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(A){return new Uc(A)}queryRadius(){return gf(this.paint.get("fill-translate"))}queryIntersectsFeature(A,m,w,D,U,V,Y){return Id($u(A,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),V.angle,Y),D)}isTileClipped(){return!0}}const Tf=L([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Ef=L([{name:"a_centroid",components:2,type:"Int16"}],4),{members:jd}=Tf;var pc={},Gd=li,jc=pu;function pu(f,A,m,w,D){this.properties={},this.extent=m,this.type=0,this._pbf=f,this._geometry=-1,this._keys=w,this._values=D,f.readFields(Mf,this,A)}function Mf(f,A,m){f==1?A.id=m.readVarint():f==2?function(w,D){for(var U=w.readVarint()+w.pos;w.pos<U;){var V=D._keys[w.readVarint()],Y=D._values[w.readVarint()];D.properties[V]=Y}}(m,A):f==3?A.type=m.readVarint():f==4&&(A._geometry=m.pos)}function Zd(f){for(var A,m,w=0,D=0,U=f.length,V=U-1;D<U;V=D++)w+=((m=f[V]).x-(A=f[D]).x)*(A.y+m.y);return w}pu.types=["Unknown","Point","LineString","Polygon"],pu.prototype.loadGeometry=function(){var f=this._pbf;f.pos=this._geometry;for(var A,m=f.readVarint()+f.pos,w=1,D=0,U=0,V=0,Y=[];f.pos<m;){if(D<=0){var ee=f.readVarint();w=7&ee,D=ee>>3}if(D--,w===1||w===2)U+=f.readSVarint(),V+=f.readSVarint(),w===1&&(A&&Y.push(A),A=[]),A.push(new Gd(U,V));else{if(w!==7)throw new Error("unknown command "+w);A&&A.push(A[0].clone())}}return A&&Y.push(A),Y},pu.prototype.bbox=function(){var f=this._pbf;f.pos=this._geometry;for(var A=f.readVarint()+f.pos,m=1,w=0,D=0,U=0,V=1/0,Y=-1/0,ee=1/0,ae=-1/0;f.pos<A;){if(w<=0){var fe=f.readVarint();m=7&fe,w=fe>>3}if(w--,m===1||m===2)(D+=f.readSVarint())<V&&(V=D),D>Y&&(Y=D),(U+=f.readSVarint())<ee&&(ee=U),U>ae&&(ae=U);else if(m!==7)throw new Error("unknown command "+m)}return[V,ee,Y,ae]},pu.prototype.toGeoJSON=function(f,A,m){var w,D,U=this.extent*Math.pow(2,m),V=this.extent*f,Y=this.extent*A,ee=this.loadGeometry(),ae=pu.types[this.type];function fe(Oe){for(var ce=0;ce<Oe.length;ce++){var tt=Oe[ce];Oe[ce]=[360*(tt.x+V)/U-180,360/Math.PI*Math.atan(Math.exp((180-360*(tt.y+Y)/U)*Math.PI/180))-90]}}switch(this.type){case 1:var _e=[];for(w=0;w<ee.length;w++)_e[w]=ee[w][0];fe(ee=_e);break;case 2:for(w=0;w<ee.length;w++)fe(ee[w]);break;case 3:for(ee=function(Oe){var ce=Oe.length;if(ce<=1)return[Oe];for(var tt,at,pt=[],Ct=0;Ct<ce;Ct++){var bt=Zd(Oe[Ct]);bt!==0&&(at===void 0&&(at=bt<0),at===bt<0?(tt&&pt.push(tt),tt=[Oe[Ct]]):tt.push(Oe[Ct]))}return tt&&pt.push(tt),pt}(ee),w=0;w<ee.length;w++)for(D=0;D<ee[w].length;D++)fe(ee[w][D])}ee.length===1?ee=ee[0]:ae="Multi"+ae;var Se={type:"Feature",geometry:{type:ae,coordinates:ee},properties:this.properties};return"id"in this&&(Se.id=this.id),Se};var qd=jc,so=Sf;function Sf(f,A){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=f,this._keys=[],this._values=[],this._features=[],f.readFields(Qd,this,A),this.length=this._features.length}function Qd(f,A,m){f===15?A.version=m.readVarint():f===1?A.name=m.readString():f===5?A.extent=m.readVarint():f===2?A._features.push(m.pos):f===3?A._keys.push(m.readString()):f===4&&A._values.push(function(w){for(var D=null,U=w.readVarint()+w.pos;w.pos<U;){var V=w.readVarint()>>3;D=V===1?w.readString():V===2?w.readFloat():V===3?w.readDouble():V===4?w.readVarint64():V===5?w.readVarint():V===6?w.readSVarint():V===7?w.readBoolean():null}return D}(m))}Sf.prototype.feature=function(f){if(f<0||f>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[f];var A=this._pbf.readVarint()+this._pbf.pos;return new qd(this._pbf,A,this.extent,this._keys,this._values)};var Rh=so;function Ou(f,A,m){if(f===3){var w=new Rh(m,m.readVarint()+m.pos);w.length&&(A[w.name]=w)}}pc.VectorTile=function(f,A){this.layers=f.readFields(Ou,{},A)},pc.VectorTileFeature=jc,pc.VectorTileLayer=so;const Hd=pc.VectorTileFeature.types,Fh=Math.pow(2,13);function Gc(f,A,m,w,D,U,V,Y){f.emplaceBack(A,m,2*Math.floor(w*Fh)+V,D*Fh*2,U*Fh*2,Math.round(Y))}class Zc{constructor(A){this.zoom=A.zoom,this.overscaling=A.overscaling,this.layers=A.layers,this.layerIds=this.layers.map(m=>m.id),this.index=A.index,this.hasPattern=!1,this.layoutVertexArray=new Ut,this.centroidVertexArray=new ft,this.indexArray=new Or,this.programConfigurations=new bA(A.layers,A.zoom),this.segments=new is,this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id)}populate(A,m,w){this.features=[],this.hasPattern=pl("fill-extrusion",this.layers,m);for(const{feature:D,id:U,index:V,sourceLayerIndex:Y}of A){const ee=this.layers[0]._featureFilter.needGeometry,ae=lu(D,ee);if(!this.layers[0]._featureFilter.filter(new Qn(this.zoom),ae,w))continue;const fe={id:U,sourceLayerIndex:Y,index:V,geometry:ee?ae.geometry:Pu(D),properties:D.properties,type:D.type,patterns:{}};this.hasPattern?this.features.push(rh("fill-extrusion",this.layers,fe,this.zoom,m)):this.addFeature(fe,fe.geometry,V,w,{}),m.featureIndex.insert(D,fe.geometry,V,Y,this.index,!0)}}addFeatures(A,m,w){for(const D of this.features){const{geometry:U}=D;this.addFeature(D,U,D.index,m,w)}}update(A,m,w){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(A,m,this.stateDependentLayers,w)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(A){this.uploaded||(this.layoutVertexBuffer=A.createVertexBuffer(this.layoutVertexArray,jd),this.centroidVertexBuffer=A.createVertexBuffer(this.centroidVertexArray,Ef.members,!0),this.indexBuffer=A.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(A),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(A,m,w,D,U){const V={x:0,y:0,vertexCount:0};for(const Y of an(m,500)){let ee=0;for(const ce of Y)ee+=ce.length;let ae=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const ce of Y){if(ce.length===0||Wd(ce))continue;let tt=0;for(let at=0;at<ce.length;at++){const pt=ce[at];if(at>=1){const Ct=ce[at-1];if(!Oh(pt,Ct)){ae.vertexLength+4>is.MAX_VERTEX_ARRAY_LENGTH&&(ae=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const bt=pt.sub(Ct)._perp()._unit(),me=Ct.dist(pt);tt+me>32768&&(tt=0),Gc(this.layoutVertexArray,pt.x,pt.y,bt.x,bt.y,0,0,tt),Gc(this.layoutVertexArray,pt.x,pt.y,bt.x,bt.y,0,1,tt),V.x+=2*pt.x,V.y+=2*pt.y,V.vertexCount+=2,tt+=me,Gc(this.layoutVertexArray,Ct.x,Ct.y,bt.x,bt.y,0,0,tt),Gc(this.layoutVertexArray,Ct.x,Ct.y,bt.x,bt.y,0,1,tt),V.x+=2*Ct.x,V.y+=2*Ct.y,V.vertexCount+=2;const Vt=ae.vertexLength;this.indexArray.emplaceBack(Vt,Vt+2,Vt+1),this.indexArray.emplaceBack(Vt+1,Vt+2,Vt+3),ae.vertexLength+=4,ae.primitiveLength+=2}}}}if(ae.vertexLength+ee>is.MAX_VERTEX_ARRAY_LENGTH&&(ae=this.segments.prepareSegment(ee,this.layoutVertexArray,this.indexArray)),Hd[A.type]!=="Polygon")continue;const fe=[],_e=[],Se=ae.vertexLength;for(const ce of Y)if(ce.length!==0){ce!==Y[0]&&_e.push(fe.length/2);for(let tt=0;tt<ce.length;tt++){const at=ce[tt];Gc(this.layoutVertexArray,at.x,at.y,0,0,1,1,0),V.x+=at.x,V.y+=at.y,V.vertexCount+=1,fe.push(at.x),fe.push(at.y)}}const Oe=Gl(fe,_e);for(let ce=0;ce<Oe.length;ce+=3)this.indexArray.emplaceBack(Se+Oe[ce],Se+Oe[ce+2],Se+Oe[ce+1]);ae.primitiveLength+=Oe.length/3,ae.vertexLength+=ee}for(let Y=0;Y<V.vertexCount;Y++)this.centroidVertexArray.emplaceBack(Math.floor(V.x/V.vertexCount),Math.floor(V.y/V.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,A,w,U,D)}}function Oh(f,A){return f.x===A.x&&(f.x<0||f.x>Ns)||f.y===A.y&&(f.y<0||f.y>Ns)}function Wd(f){return f.every(A=>A.x<0)||f.every(A=>A.x>Ns)||f.every(A=>A.y<0)||f.every(A=>A.y>Ns)}let Nh;Fi("FillExtrusionBucket",Zc,{omit:["layers","features"]});var Xd={get paint(){return Nh=Nh||new $r({"fill-extrusion-opacity":new Nt(Be["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Kt(Be["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Nt(Be["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Nt(Be["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new aA(Be["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Kt(Be["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Kt(Be["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Nt(Be["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Cp extends Hn{constructor(A){super(A,Xd)}createBucket(A){return new Zc(A)}queryRadius(){return gf(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(A,m,w,D,U,V,Y,ee){const ae=$u(A,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),V.angle,Y),fe=this.paint.get("fill-extrusion-height").evaluate(m,w),_e=this.paint.get("fill-extrusion-base").evaluate(m,w),Se=function(ce,tt,at,pt){const Ct=[];for(const bt of ce){const me=[bt.x,bt.y,0,1];zu(me,me,tt),Ct.push(new Gt(me[0]/me[3],me[1]/me[3]))}return Ct}(ae,ee),Oe=function(ce,tt,at,pt){const Ct=[],bt=[],me=pt[8]*tt,Vt=pt[9]*tt,oi=pt[10]*tt,Si=pt[11]*tt,tr=pt[8]*at,Bi=pt[9]*at,ki=pt[10]*at,xi=pt[11]*at;for(const Qi of ce){const Ii=[],ci=[];for(const ur of Qi){const ui=ur.x,Qr=ur.y,Ts=pt[0]*ui+pt[4]*Qr+pt[12],ys=pt[1]*ui+pt[5]*Qr+pt[13],Io=pt[2]*ui+pt[6]*Qr+pt[14],La=pt[3]*ui+pt[7]*Qr+pt[15],$a=Io+oi,Co=La+Si,na=Ts+tr,Xs=ys+Bi,Hr=Io+ki,sa=La+xi,zs=new Gt((Ts+me)/Co,(ys+Vt)/Co);zs.z=$a/Co,Ii.push(zs);const Vn=new Gt(na/sa,Xs/sa);Vn.z=Hr/sa,ci.push(Vn)}Ct.push(Ii),bt.push(ci)}return[Ct,bt]}(D,_e,fe,ee);return function(ce,tt,at){let pt=1/0;Id(at,tt)&&(pt=Yd(at,tt[0]));for(let Ct=0;Ct<tt.length;Ct++){const bt=tt[Ct],me=ce[Ct];for(let Vt=0;Vt<bt.length-1;Vt++){const oi=bt[Vt],Si=[oi,bt[Vt+1],me[Vt+1],me[Vt],oi];Sd(at,Si)&&(pt=Math.min(pt,Yd(at,Si)))}}return pt!==1/0&&pt}(Oe[0],Oe[1],Se)}}function Nu(f,A){return f.x*A.x+f.y*A.y}function Yd(f,A){if(f.length===1){let m=0;const w=A[m++];let D;for(;!D||w.equals(D);)if(D=A[m++],!D)return 1/0;for(;m<A.length;m++){const U=A[m],V=f[0],Y=D.sub(w),ee=U.sub(w),ae=V.sub(w),fe=Nu(Y,Y),_e=Nu(Y,ee),Se=Nu(ee,ee),Oe=Nu(ae,Y),ce=Nu(ae,ee),tt=fe*Se-_e*_e,at=(Se*Oe-_e*ce)/tt,pt=(fe*ce-_e*Oe)/tt,Ct=w.z*(1-at-pt)+D.z*at+U.z*pt;if(isFinite(Ct))return Ct}return 1/0}{let m=1/0;for(const w of A)m=Math.min(m,w.z);return m}}const kp=L([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Dp}=kp,Pp=L([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:zp}=Pp,Bp=pc.VectorTileFeature.types,Lp=Math.cos(Math.PI/180*37.5),Kd=Math.pow(2,14)/.5;class If{constructor(A){this.zoom=A.zoom,this.overscaling=A.overscaling,this.layers=A.layers,this.layerIds=this.layers.map(m=>m.id),this.index=A.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(m=>{this.gradients[m.id]={}}),this.layoutVertexArray=new Xt,this.layoutVertexArray2=new qt,this.indexArray=new Or,this.programConfigurations=new bA(A.layers,A.zoom),this.segments=new is,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id)}populate(A,m,w){this.hasPattern=pl("line",this.layers,m);const D=this.layers[0].layout.get("line-sort-key"),U=!D.isConstant(),V=[];for(const{feature:Y,id:ee,index:ae,sourceLayerIndex:fe}of A){const _e=this.layers[0]._featureFilter.needGeometry,Se=lu(Y,_e);if(!this.layers[0]._featureFilter.filter(new Qn(this.zoom),Se,w))continue;const Oe=U?D.evaluate(Se,{},w):void 0,ce={id:ee,properties:Y.properties,type:Y.type,sourceLayerIndex:fe,index:ae,geometry:_e?Se.geometry:Pu(Y),patterns:{},sortKey:Oe};V.push(ce)}U&&V.sort((Y,ee)=>Y.sortKey-ee.sortKey);for(const Y of V){const{geometry:ee,index:ae,sourceLayerIndex:fe}=Y;if(this.hasPattern){const _e=rh("line",this.layers,Y,this.zoom,m);this.patternFeatures.push(_e)}else this.addFeature(Y,ee,ae,w,{});m.featureIndex.insert(A[ae].feature,ee,ae,fe,this.index)}}update(A,m,w){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(A,m,this.stateDependentLayers,w)}addFeatures(A,m,w){for(const D of this.patternFeatures)this.addFeature(D,D.geometry,D.index,m,w)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(A){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=A.createVertexBuffer(this.layoutVertexArray2,zp)),this.layoutVertexBuffer=A.createVertexBuffer(this.layoutVertexArray,Dp),this.indexBuffer=A.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(A),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(A){if(A.properties&&Object.prototype.hasOwnProperty.call(A.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(A.properties,"mapbox_clip_end"))return{start:+A.properties.mapbox_clip_start,end:+A.properties.mapbox_clip_end}}addFeature(A,m,w,D,U){const V=this.layers[0].layout,Y=V.get("line-join").evaluate(A,{}),ee=V.get("line-cap"),ae=V.get("line-miter-limit"),fe=V.get("line-round-limit");this.lineClips=this.lineFeatureClips(A);for(const _e of m)this.addLine(_e,A,Y,ee,ae,fe);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,A,w,U,D)}addLine(A,m,w,D,U,V){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let pt=0;pt<A.length-1;pt++)this.totalDistance+=A[pt].dist(A[pt+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const Y=Bp[m.type]==="Polygon";let ee=A.length;for(;ee>=2&&A[ee-1].equals(A[ee-2]);)ee--;let ae=0;for(;ae<ee-1&&A[ae].equals(A[ae+1]);)ae++;if(ee<(Y?3:2))return;w==="bevel"&&(U=1.05);const fe=this.overscaling<=16?15*Ns/(512*this.overscaling):0,_e=this.segments.prepareSegment(10*ee,this.layoutVertexArray,this.indexArray);let Se,Oe,ce,tt,at;this.e1=this.e2=-1,Y&&(Se=A[ee-2],at=A[ae].sub(Se)._unit()._perp());for(let pt=ae;pt<ee;pt++){if(ce=pt===ee-1?Y?A[ae+1]:void 0:A[pt+1],ce&&A[pt].equals(ce))continue;at&&(tt=at),Se&&(Oe=Se),Se=A[pt],at=ce?ce.sub(Se)._unit()._perp():tt,tt=tt||at;let Ct=tt.add(at);Ct.x===0&&Ct.y===0||Ct._unit();const bt=tt.x*at.x+tt.y*at.y,me=Ct.x*at.x+Ct.y*at.y,Vt=me!==0?1/me:1/0,oi=2*Math.sqrt(2-2*me),Si=me<Lp&&Oe&&ce,tr=tt.x*at.y-tt.y*at.x>0;if(Si&&pt>ae){const xi=Se.dist(Oe);if(xi>2*fe){const Qi=Se.sub(Se.sub(Oe)._mult(fe/xi)._round());this.updateDistance(Oe,Qi),this.addCurrentVertex(Qi,tt,0,0,_e),Oe=Qi}}const Bi=Oe&&ce;let ki=Bi?w:Y?"butt":D;if(Bi&&ki==="round"&&(Vt<V?ki="miter":Vt<=2&&(ki="fakeround")),ki==="miter"&&Vt>U&&(ki="bevel"),ki==="bevel"&&(Vt>2&&(ki="flipbevel"),Vt<U&&(ki="miter")),Oe&&this.updateDistance(Oe,Se),ki==="miter")Ct._mult(Vt),this.addCurrentVertex(Se,Ct,0,0,_e);else if(ki==="flipbevel"){if(Vt>100)Ct=at.mult(-1);else{const xi=Vt*tt.add(at).mag()/tt.sub(at).mag();Ct._perp()._mult(xi*(tr?-1:1))}this.addCurrentVertex(Se,Ct,0,0,_e),this.addCurrentVertex(Se,Ct.mult(-1),0,0,_e)}else if(ki==="bevel"||ki==="fakeround"){const xi=-Math.sqrt(Vt*Vt-1),Qi=tr?xi:0,Ii=tr?0:xi;if(Oe&&this.addCurrentVertex(Se,tt,Qi,Ii,_e),ki==="fakeround"){const ci=Math.round(180*oi/Math.PI/20);for(let ur=1;ur<ci;ur++){let ui=ur/ci;if(ui!==.5){const Ts=ui-.5;ui+=ui*Ts*(ui-1)*((1.0904+bt*(bt*(3.55645-1.43519*bt)-3.2452))*Ts*Ts+(.848013+bt*(.215638*bt-1.06021)))}const Qr=at.sub(tt)._mult(ui)._add(tt)._unit()._mult(tr?-1:1);this.addHalfVertex(Se,Qr.x,Qr.y,!1,tr,0,_e)}}ce&&this.addCurrentVertex(Se,at,-Qi,-Ii,_e)}else if(ki==="butt")this.addCurrentVertex(Se,Ct,0,0,_e);else if(ki==="square"){const xi=Oe?1:-1;this.addCurrentVertex(Se,Ct,xi,xi,_e)}else ki==="round"&&(Oe&&(this.addCurrentVertex(Se,tt,0,0,_e),this.addCurrentVertex(Se,tt,1,1,_e,!0)),ce&&(this.addCurrentVertex(Se,at,-1,-1,_e,!0),this.addCurrentVertex(Se,at,0,0,_e)));if(Si&&pt<ee-1){const xi=Se.dist(ce);if(xi>2*fe){const Qi=Se.add(ce.sub(Se)._mult(fe/xi)._round());this.updateDistance(Se,Qi),this.addCurrentVertex(Qi,at,0,0,_e),Se=Qi}}}}addCurrentVertex(A,m,w,D,U,V=!1){const Y=m.y*D-m.x,ee=-m.y-m.x*D;this.addHalfVertex(A,m.x+m.y*w,m.y-m.x*w,V,!1,w,U),this.addHalfVertex(A,Y,ee,V,!0,-D,U),this.distance>Kd/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(A,m,w,D,U,V))}addHalfVertex({x:A,y:m},w,D,U,V,Y,ee){const ae=.5*(this.lineClips?this.scaledDistance*(Kd-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((A<<1)+(U?1:0),(m<<1)+(V?1:0),Math.round(63*w)+128,Math.round(63*D)+128,1+(Y===0?0:Y<0?-1:1)|(63&ae)<<2,ae>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const fe=ee.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,fe),ee.primitiveLength++),V?this.e2=fe:this.e1=fe}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(A,m){this.distance+=A.dist(m),this.updateScaledDistance()}}let Rp,Fp;Fi("LineBucket",If,{omit:["layers","patternFeatures"]});var Mn={get paint(){return Fp=Fp||new $r({"line-opacity":new Kt(Be.paint_line["line-opacity"]),"line-color":new Kt(Be.paint_line["line-color"]),"line-translate":new Nt(Be.paint_line["line-translate"]),"line-translate-anchor":new Nt(Be.paint_line["line-translate-anchor"]),"line-width":new Kt(Be.paint_line["line-width"]),"line-gap-width":new Kt(Be.paint_line["line-gap-width"]),"line-offset":new Kt(Be.paint_line["line-offset"]),"line-blur":new Kt(Be.paint_line["line-blur"]),"line-dasharray":new El(Be.paint_line["line-dasharray"]),"line-pattern":new aA(Be.paint_line["line-pattern"]),"line-gradient":new Ul(Be.paint_line["line-gradient"])})},get layout(){return Rp=Rp||new $r({"line-cap":new Nt(Be.layout_line["line-cap"]),"line-join":new Kt(Be.layout_line["line-join"]),"line-miter-limit":new Nt(Be.layout_line["line-miter-limit"]),"line-round-limit":new Nt(Be.layout_line["line-round-limit"]),"line-sort-key":new Kt(Be.layout_line["line-sort-key"])})}};class Op extends Kt{possiblyEvaluate(A,m){return m=new Qn(Math.floor(m.zoom),{now:m.now,fadeDuration:m.fadeDuration,zoomHistory:m.zoomHistory,transition:m.transition}),super.possiblyEvaluate(A,m)}evaluate(A,m,w,D){return m=pn({},m,{zoom:Math.floor(m.zoom)}),super.evaluate(A,m,w,D)}}let Cf;class Y_ extends Hn{constructor(A){super(A,Mn),this.gradientVersion=0,Cf||(Cf=new Op(Mn.paint.properties["line-width"].specification),Cf.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(A){if(A==="line-gradient"){const m=this.gradientExpression();this.stepInterpolant=!!function(w){return w._styleExpression!==void 0}(m)&&m._styleExpression.expression instanceof Kn,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(A,m){super.recalculate(A,m),this.paint._values["line-floorwidth"]=Cf.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,A)}createBucket(A){return new If(A)}queryRadius(A){const m=A,w=Uh(Ph("line-width",this,m),Ph("line-gap-width",this,m)),D=Ph("line-offset",this,m);return w/2+Math.abs(D)+gf(this.paint.get("line-translate"))}queryIntersectsFeature(A,m,w,D,U,V,Y){const ee=$u(A,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),V.angle,Y),ae=Y/2*Uh(this.paint.get("line-width").evaluate(m,w),this.paint.get("line-gap-width").evaluate(m,w)),fe=this.paint.get("line-offset").evaluate(m,w);return fe&&(D=function(_e,Se){const Oe=[];for(let ce=0;ce<_e.length;ce++){const tt=_e[ce],at=[];for(let pt=0;pt<tt.length;pt++){const Ct=tt[pt-1],bt=tt[pt],me=tt[pt+1],Vt=pt===0?new Gt(0,0):bt.sub(Ct)._unit()._perp(),oi=pt===tt.length-1?new Gt(0,0):me.sub(bt)._unit()._perp(),Si=Vt._add(oi)._unit(),tr=Si.x*oi.x+Si.y*oi.y;tr!==0&&Si._mult(1/tr),at.push(Si._mult(Se)._add(bt))}Oe.push(at)}return Oe}(D,fe*Y)),function(_e,Se,Oe){for(let ce=0;ce<Se.length;ce++){const tt=Se[ce];if(_e.length>=3){for(let at=0;at<tt.length;at++)if(Ju(_e,tt[at]))return!0}if(_a(_e,tt,Oe))return!0}return!1}(ee,D,ae)}isTileClipped(){return!0}}function Uh(f,A){return A>0?A+2*f:f}const Np=L([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),K_=L([{name:"a_projected_pos",components:3,type:"Float32"}],4);L([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Up=L([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);L([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Jd=L([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),J_=L([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function $d(f,A,m){return f.sections.forEach(w=>{w.text=function(D,U,V){const Y=U.layout.get("text-transform").evaluate(V,{});return Y==="uppercase"?D=D.toLocaleUpperCase():Y==="lowercase"&&(D=D.toLocaleLowerCase()),da.applyArabicShaping&&(D=da.applyArabicShaping(D)),D}(w.text,A,m)}),f}L([{name:"triangle",components:3,type:"Uint16"}]),L([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),L([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),L([{type:"Float32",name:"offsetX"}]),L([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),L([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const qc={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var zo=24,kf=Oi,Vh=function(f,A,m,w,D){var U,V,Y=8*D-w-1,ee=(1<<Y)-1,ae=ee>>1,fe=-7,_e=m?D-1:0,Se=m?-1:1,Oe=f[A+_e];for(_e+=Se,U=Oe&(1<<-fe)-1,Oe>>=-fe,fe+=Y;fe>0;U=256*U+f[A+_e],_e+=Se,fe-=8);for(V=U&(1<<-fe)-1,U>>=-fe,fe+=w;fe>0;V=256*V+f[A+_e],_e+=Se,fe-=8);if(U===0)U=1-ae;else{if(U===ee)return V?NaN:1/0*(Oe?-1:1);V+=Math.pow(2,w),U-=ae}return(Oe?-1:1)*V*Math.pow(2,U-w)},mc=function(f,A,m,w,D,U){var V,Y,ee,ae=8*U-D-1,fe=(1<<ae)-1,_e=fe>>1,Se=D===23?Math.pow(2,-24)-Math.pow(2,-77):0,Oe=w?0:U-1,ce=w?1:-1,tt=A<0||A===0&&1/A<0?1:0;for(A=Math.abs(A),isNaN(A)||A===1/0?(Y=isNaN(A)?1:0,V=fe):(V=Math.floor(Math.log(A)/Math.LN2),A*(ee=Math.pow(2,-V))<1&&(V--,ee*=2),(A+=V+_e>=1?Se/ee:Se*Math.pow(2,1-_e))*ee>=2&&(V++,ee/=2),V+_e>=fe?(Y=0,V=fe):V+_e>=1?(Y=(A*ee-1)*Math.pow(2,D),V+=_e):(Y=A*Math.pow(2,_e-1)*Math.pow(2,D),V=0));D>=8;f[m+Oe]=255&Y,Oe+=ce,Y/=256,D-=8);for(V=V<<D|Y,ae+=D;ae>0;f[m+Oe]=255&V,Oe+=ce,V/=256,ae-=8);f[m+Oe-ce]|=128*tt};function Oi(f){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(f)?f:new Uint8Array(f||0),this.pos=0,this.type=0,this.length=this.buf.length}Oi.Varint=0,Oi.Fixed64=1,Oi.Bytes=2,Oi.Fixed32=5;var ei=4294967296,Pr=1/ei,Tr=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Bo(f){return f.type===Oi.Bytes?f.readVarint()+f.pos:f.pos+1}function qA(f,A,m){return m?4294967296*A+(f>>>0):4294967296*(A>>>0)+(f>>>0)}function Vp(f,A,m){var w=A<=16383?1:A<=2097151?2:A<=268435455?3:Math.floor(Math.log(A)/(7*Math.LN2));m.realloc(w);for(var D=m.pos-1;D>=f;D--)m.buf[D+w]=m.buf[D]}function xr(f,A){for(var m=0;m<f.length;m++)A.writeVarint(f[m])}function $_(f,A){for(var m=0;m<f.length;m++)A.writeSVarint(f[m])}function e0(f,A){for(var m=0;m<f.length;m++)A.writeFloat(f[m])}function eg(f,A){for(var m=0;m<f.length;m++)A.writeDouble(f[m])}function t0(f,A){for(var m=0;m<f.length;m++)A.writeBoolean(f[m])}function i0(f,A){for(var m=0;m<f.length;m++)A.writeFixed32(f[m])}function jh(f,A){for(var m=0;m<f.length;m++)A.writeSFixed32(f[m])}function nh(f,A){for(var m=0;m<f.length;m++)A.writeFixed64(f[m])}function Qc(f,A){for(var m=0;m<f.length;m++)A.writeSFixed64(f[m])}function Zl(f,A){return(f[A]|f[A+1]<<8|f[A+2]<<16)+16777216*f[A+3]}function cA(f,A,m){f[m]=A,f[m+1]=A>>>8,f[m+2]=A>>>16,f[m+3]=A>>>24}function mu(f,A){return(f[A]|f[A+1]<<8|f[A+2]<<16)+(f[A+3]<<24)}Oi.prototype={destroy:function(){this.buf=null},readFields:function(f,A,m){for(m=m||this.length;this.pos<m;){var w=this.readVarint(),D=w>>3,U=this.pos;this.type=7&w,f(D,A,this),this.pos===U&&this.skip(w)}return A},readMessage:function(f,A){return this.readFields(f,A,this.readVarint()+this.pos)},readFixed32:function(){var f=Zl(this.buf,this.pos);return this.pos+=4,f},readSFixed32:function(){var f=mu(this.buf,this.pos);return this.pos+=4,f},readFixed64:function(){var f=Zl(this.buf,this.pos)+Zl(this.buf,this.pos+4)*ei;return this.pos+=8,f},readSFixed64:function(){var f=Zl(this.buf,this.pos)+mu(this.buf,this.pos+4)*ei;return this.pos+=8,f},readFloat:function(){var f=Vh(this.buf,this.pos,!0,23,4);return this.pos+=4,f},readDouble:function(){var f=Vh(this.buf,this.pos,!0,52,8);return this.pos+=8,f},readVarint:function(f){var A,m,w=this.buf;return A=127&(m=w[this.pos++]),m<128?A:(A|=(127&(m=w[this.pos++]))<<7,m<128?A:(A|=(127&(m=w[this.pos++]))<<14,m<128?A:(A|=(127&(m=w[this.pos++]))<<21,m<128?A:function(D,U,V){var Y,ee,ae=V.buf;if(Y=(112&(ee=ae[V.pos++]))>>4,ee<128||(Y|=(127&(ee=ae[V.pos++]))<<3,ee<128)||(Y|=(127&(ee=ae[V.pos++]))<<10,ee<128)||(Y|=(127&(ee=ae[V.pos++]))<<17,ee<128)||(Y|=(127&(ee=ae[V.pos++]))<<24,ee<128)||(Y|=(1&(ee=ae[V.pos++]))<<31,ee<128))return qA(D,Y,U);throw new Error("Expected varint not more than 10 bytes")}(A|=(15&(m=w[this.pos]))<<28,f,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var f=this.readVarint();return f%2==1?(f+1)/-2:f/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var f=this.readVarint()+this.pos,A=this.pos;return this.pos=f,f-A>=12&&Tr?function(m,w,D){return Tr.decode(m.subarray(w,D))}(this.buf,A,f):function(m,w,D){for(var U="",V=w;V<D;){var Y,ee,ae,fe=m[V],_e=null,Se=fe>239?4:fe>223?3:fe>191?2:1;if(V+Se>D)break;Se===1?fe<128&&(_e=fe):Se===2?(192&(Y=m[V+1]))==128&&(_e=(31&fe)<<6|63&Y)<=127&&(_e=null):Se===3?(ee=m[V+2],(192&(Y=m[V+1]))==128&&(192&ee)==128&&((_e=(15&fe)<<12|(63&Y)<<6|63&ee)<=2047||_e>=55296&&_e<=57343)&&(_e=null)):Se===4&&(ee=m[V+2],ae=m[V+3],(192&(Y=m[V+1]))==128&&(192&ee)==128&&(192&ae)==128&&((_e=(15&fe)<<18|(63&Y)<<12|(63&ee)<<6|63&ae)<=65535||_e>=1114112)&&(_e=null)),_e===null?(_e=65533,Se=1):_e>65535&&(_e-=65536,U+=String.fromCharCode(_e>>>10&1023|55296),_e=56320|1023&_e),U+=String.fromCharCode(_e),V+=Se}return U}(this.buf,A,f)},readBytes:function(){var f=this.readVarint()+this.pos,A=this.buf.subarray(this.pos,f);return this.pos=f,A},readPackedVarint:function(f,A){if(this.type!==Oi.Bytes)return f.push(this.readVarint(A));var m=Bo(this);for(f=f||[];this.pos<m;)f.push(this.readVarint(A));return f},readPackedSVarint:function(f){if(this.type!==Oi.Bytes)return f.push(this.readSVarint());var A=Bo(this);for(f=f||[];this.pos<A;)f.push(this.readSVarint());return f},readPackedBoolean:function(f){if(this.type!==Oi.Bytes)return f.push(this.readBoolean());var A=Bo(this);for(f=f||[];this.pos<A;)f.push(this.readBoolean());return f},readPackedFloat:function(f){if(this.type!==Oi.Bytes)return f.push(this.readFloat());var A=Bo(this);for(f=f||[];this.pos<A;)f.push(this.readFloat());return f},readPackedDouble:function(f){if(this.type!==Oi.Bytes)return f.push(this.readDouble());var A=Bo(this);for(f=f||[];this.pos<A;)f.push(this.readDouble());return f},readPackedFixed32:function(f){if(this.type!==Oi.Bytes)return f.push(this.readFixed32());var A=Bo(this);for(f=f||[];this.pos<A;)f.push(this.readFixed32());return f},readPackedSFixed32:function(f){if(this.type!==Oi.Bytes)return f.push(this.readSFixed32());var A=Bo(this);for(f=f||[];this.pos<A;)f.push(this.readSFixed32());return f},readPackedFixed64:function(f){if(this.type!==Oi.Bytes)return f.push(this.readFixed64());var A=Bo(this);for(f=f||[];this.pos<A;)f.push(this.readFixed64());return f},readPackedSFixed64:function(f){if(this.type!==Oi.Bytes)return f.push(this.readSFixed64());var A=Bo(this);for(f=f||[];this.pos<A;)f.push(this.readSFixed64());return f},skip:function(f){var A=7&f;if(A===Oi.Varint)for(;this.buf[this.pos++]>127;);else if(A===Oi.Bytes)this.pos=this.readVarint()+this.pos;else if(A===Oi.Fixed32)this.pos+=4;else{if(A!==Oi.Fixed64)throw new Error("Unimplemented type: "+A);this.pos+=8}},writeTag:function(f,A){this.writeVarint(f<<3|A)},realloc:function(f){for(var A=this.length||16;A<this.pos+f;)A*=2;if(A!==this.length){var m=new Uint8Array(A);m.set(this.buf),this.buf=m,this.length=A}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(f){this.realloc(4),cA(this.buf,f,this.pos),this.pos+=4},writeSFixed32:function(f){this.realloc(4),cA(this.buf,f,this.pos),this.pos+=4},writeFixed64:function(f){this.realloc(8),cA(this.buf,-1&f,this.pos),cA(this.buf,Math.floor(f*Pr),this.pos+4),this.pos+=8},writeSFixed64:function(f){this.realloc(8),cA(this.buf,-1&f,this.pos),cA(this.buf,Math.floor(f*Pr),this.pos+4),this.pos+=8},writeVarint:function(f){(f=+f||0)>268435455||f<0?function(A,m){var w,D;if(A>=0?(w=A%4294967296|0,D=A/4294967296|0):(D=~(-A/4294967296),4294967295^(w=~(-A%4294967296))?w=w+1|0:(w=0,D=D+1|0)),A>=18446744073709552e3||A<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");m.realloc(10),function(U,V,Y){Y.buf[Y.pos++]=127&U|128,U>>>=7,Y.buf[Y.pos++]=127&U|128,U>>>=7,Y.buf[Y.pos++]=127&U|128,U>>>=7,Y.buf[Y.pos++]=127&U|128,Y.buf[Y.pos]=127&(U>>>=7)}(w,0,m),function(U,V){var Y=(7&U)<<4;V.buf[V.pos++]|=Y|((U>>>=3)?128:0),U&&(V.buf[V.pos++]=127&U|((U>>>=7)?128:0),U&&(V.buf[V.pos++]=127&U|((U>>>=7)?128:0),U&&(V.buf[V.pos++]=127&U|((U>>>=7)?128:0),U&&(V.buf[V.pos++]=127&U|((U>>>=7)?128:0),U&&(V.buf[V.pos++]=127&U)))))}(D,m)}(f,this):(this.realloc(4),this.buf[this.pos++]=127&f|(f>127?128:0),f<=127||(this.buf[this.pos++]=127&(f>>>=7)|(f>127?128:0),f<=127||(this.buf[this.pos++]=127&(f>>>=7)|(f>127?128:0),f<=127||(this.buf[this.pos++]=f>>>7&127))))},writeSVarint:function(f){this.writeVarint(f<0?2*-f-1:2*f)},writeBoolean:function(f){this.writeVarint(!!f)},writeString:function(f){f=String(f),this.realloc(4*f.length),this.pos++;var A=this.pos;this.pos=function(w,D,U){for(var V,Y,ee=0;ee<D.length;ee++){if((V=D.charCodeAt(ee))>55295&&V<57344){if(!Y){V>56319||ee+1===D.length?(w[U++]=239,w[U++]=191,w[U++]=189):Y=V;continue}if(V<56320){w[U++]=239,w[U++]=191,w[U++]=189,Y=V;continue}V=Y-55296<<10|V-56320|65536,Y=null}else Y&&(w[U++]=239,w[U++]=191,w[U++]=189,Y=null);V<128?w[U++]=V:(V<2048?w[U++]=V>>6|192:(V<65536?w[U++]=V>>12|224:(w[U++]=V>>18|240,w[U++]=V>>12&63|128),w[U++]=V>>6&63|128),w[U++]=63&V|128)}return U}(this.buf,f,this.pos);var m=this.pos-A;m>=128&&Vp(A,m,this),this.pos=A-1,this.writeVarint(m),this.pos+=m},writeFloat:function(f){this.realloc(4),mc(this.buf,f,this.pos,!0,23,4),this.pos+=4},writeDouble:function(f){this.realloc(8),mc(this.buf,f,this.pos,!0,52,8),this.pos+=8},writeBytes:function(f){var A=f.length;this.writeVarint(A),this.realloc(A);for(var m=0;m<A;m++)this.buf[this.pos++]=f[m]},writeRawMessage:function(f,A){this.pos++;var m=this.pos;f(A,this);var w=this.pos-m;w>=128&&Vp(m,w,this),this.pos=m-1,this.writeVarint(w),this.pos+=w},writeMessage:function(f,A,m){this.writeTag(f,Oi.Bytes),this.writeRawMessage(A,m)},writePackedVarint:function(f,A){A.length&&this.writeMessage(f,xr,A)},writePackedSVarint:function(f,A){A.length&&this.writeMessage(f,$_,A)},writePackedBoolean:function(f,A){A.length&&this.writeMessage(f,t0,A)},writePackedFloat:function(f,A){A.length&&this.writeMessage(f,e0,A)},writePackedDouble:function(f,A){A.length&&this.writeMessage(f,eg,A)},writePackedFixed32:function(f,A){A.length&&this.writeMessage(f,i0,A)},writePackedSFixed32:function(f,A){A.length&&this.writeMessage(f,jh,A)},writePackedFixed64:function(f,A){A.length&&this.writeMessage(f,nh,A)},writePackedSFixed64:function(f,A){A.length&&this.writeMessage(f,Qc,A)},writeBytesField:function(f,A){this.writeTag(f,Oi.Bytes),this.writeBytes(A)},writeFixed32Field:function(f,A){this.writeTag(f,Oi.Fixed32),this.writeFixed32(A)},writeSFixed32Field:function(f,A){this.writeTag(f,Oi.Fixed32),this.writeSFixed32(A)},writeFixed64Field:function(f,A){this.writeTag(f,Oi.Fixed64),this.writeFixed64(A)},writeSFixed64Field:function(f,A){this.writeTag(f,Oi.Fixed64),this.writeSFixed64(A)},writeVarintField:function(f,A){this.writeTag(f,Oi.Varint),this.writeVarint(A)},writeSVarintField:function(f,A){this.writeTag(f,Oi.Varint),this.writeSVarint(A)},writeStringField:function(f,A){this.writeTag(f,Oi.Bytes),this.writeString(A)},writeFloatField:function(f,A){this.writeTag(f,Oi.Fixed32),this.writeFloat(A)},writeDoubleField:function(f,A){this.writeTag(f,Oi.Fixed64),this.writeDouble(A)},writeBooleanField:function(f,A){this.writeVarintField(f,!!A)}};var _c=Ee(kf);const r0=3;function tg(f,A,m){f===1&&m.readMessage(ig,A)}function ig(f,A,m){if(f===3){const{id:w,bitmap:D,width:U,height:V,left:Y,top:ee,advance:ae}=m.readMessage(rg,{});A.push({id:w,bitmap:new zh({width:U+2*r0,height:V+2*r0},D),metrics:{width:U,height:V,left:Y,top:ee,advance:ae}})}}function rg(f,A,m){f===1?A.id=m.readVarint():f===2?A.bitmap=m.readBytes():f===3?A.width=m.readVarint():f===4?A.height=m.readVarint():f===5?A.left=m.readSVarint():f===6?A.top=m.readSVarint():f===7&&(A.advance=m.readVarint())}const n0=r0;function kl(f){let A=0,m=0;for(const V of f)A+=V.w*V.h,m=Math.max(m,V.w);f.sort((V,Y)=>Y.h-V.h);const w=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(A/.95)),m),h:1/0}];let D=0,U=0;for(const V of f)for(let Y=w.length-1;Y>=0;Y--){const ee=w[Y];if(!(V.w>ee.w||V.h>ee.h)){if(V.x=ee.x,V.y=ee.y,U=Math.max(U,V.y+V.h),D=Math.max(D,V.x+V.w),V.w===ee.w&&V.h===ee.h){const ae=w.pop();Y<w.length&&(w[Y]=ae)}else V.h===ee.h?(ee.x+=V.w,ee.w-=V.w):V.w===ee.w?(ee.y+=V.h,ee.h-=V.h):(w.push({x:ee.x+V.w,y:ee.y,w:ee.w-V.w,h:V.h}),ee.y+=V.h,ee.h-=V.h);break}}return{w:D,h:U,fill:A/(D*U)||0}}const Wn=1;class So{constructor(A,{pixelRatio:m,version:w,stretchX:D,stretchY:U,content:V}){this.paddedRect=A,this.pixelRatio=m,this.stretchX=D,this.stretchY=U,this.content=V,this.version=w}get tl(){return[this.paddedRect.x+Wn,this.paddedRect.y+Wn]}get br(){return[this.paddedRect.x+this.paddedRect.w-Wn,this.paddedRect.y+this.paddedRect.h-Wn]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Wn)/this.pixelRatio,(this.paddedRect.h-2*Wn)/this.pixelRatio]}}class s0{constructor(A,m){const w={},D={};this.haveRenderCallbacks=[];const U=[];this.addImages(A,w,U),this.addImages(m,D,U);const{w:V,h:Y}=kl(U),ee=new Cl({width:V||1,height:Y||1});for(const ae in A){const fe=A[ae],_e=w[ae].paddedRect;Cl.copy(fe.data,ee,{x:0,y:0},{x:_e.x+Wn,y:_e.y+Wn},fe.data)}for(const ae in m){const fe=m[ae],_e=D[ae].paddedRect,Se=_e.x+Wn,Oe=_e.y+Wn,ce=fe.data.width,tt=fe.data.height;Cl.copy(fe.data,ee,{x:0,y:0},{x:Se,y:Oe},fe.data),Cl.copy(fe.data,ee,{x:0,y:tt-1},{x:Se,y:Oe-1},{width:ce,height:1}),Cl.copy(fe.data,ee,{x:0,y:0},{x:Se,y:Oe+tt},{width:ce,height:1}),Cl.copy(fe.data,ee,{x:ce-1,y:0},{x:Se-1,y:Oe},{width:1,height:tt}),Cl.copy(fe.data,ee,{x:0,y:0},{x:Se+ce,y:Oe},{width:1,height:tt})}this.image=ee,this.iconPositions=w,this.patternPositions=D}addImages(A,m,w){for(const D in A){const U=A[D],V={x:0,y:0,w:U.data.width+2*Wn,h:U.data.height+2*Wn};w.push(V),m[D]=new So(V,U),U.hasRenderCallback&&this.haveRenderCallbacks.push(D)}}patchUpdatedImages(A,m){A.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const w in A.updatedImages)this.patchUpdatedImage(this.iconPositions[w],A.getImage(w),m),this.patchUpdatedImage(this.patternPositions[w],A.getImage(w),m)}patchUpdatedImage(A,m,w){if(!A||!m||A.version===m.version)return;A.version=m.version;const[D,U]=A.tl;w.update(m.data,void 0,{x:D,y:U})}}var Hc;Fi("ImagePosition",So),Fi("ImageAtlas",s0),P.ai=void 0,(Hc=P.ai||(P.ai={}))[Hc.none=0]="none",Hc[Hc.horizontal=1]="horizontal",Hc[Hc.vertical=2]="vertical",Hc[Hc.horizontalOnly=3]="horizontalOnly";const Gh=-17;class Zh{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(A,m){const w=new Zh;return w.scale=A||1,w.fontStack=m,w}static forImage(A){const m=new Zh;return m.imageName=A,m}}class Xn{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(A,m){const w=new Xn;for(let D=0;D<A.sections.length;D++){const U=A.sections[D];U.image?w.addImageSection(U):w.addTextSection(U,m)}return w}length(){return this.text.length}getSection(A){return this.sections[this.sectionIndex[A]]}getSectionIndex(A){return this.sectionIndex[A]}getCharCode(A){return this.text.charCodeAt(A)}verticalizePunctuation(){this.text=function(A){let m="";for(let w=0;w<A.length;w++){const D=A.charCodeAt(w+1)||null,U=A.charCodeAt(w-1)||null;m+=D&&lc(D)&&!qc[A[w+1]]||U&&lc(U)&&!qc[A[w-1]]||!qc[A[w]]?A[w]:qc[A[w]]}return m}(this.text)}trim(){let A=0;for(let w=0;w<this.text.length&&QA[this.text.charCodeAt(w)];w++)A++;let m=this.text.length;for(let w=this.text.length-1;w>=0&&w>=A&&QA[this.text.charCodeAt(w)];w--)m--;this.text=this.text.substring(A,m),this.sectionIndex=this.sectionIndex.slice(A,m)}substring(A,m){const w=new Xn;return w.text=this.text.substring(A,m),w.sectionIndex=this.sectionIndex.slice(A,m),w.sections=this.sections,w}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((A,m)=>Math.max(A,this.sections[m].scale),0)}addTextSection(A,m){this.text+=A.text,this.sections.push(Zh.forText(A.scale,A.fontStack||m));const w=this.sections.length-1;for(let D=0;D<A.text.length;++D)this.sectionIndex.push(w)}addImageSection(A){const m=A.image?A.image.name:"";if(m.length===0)return void wi("Can't add FormattedSection with an empty image.");const w=this.getNextImageSectionCharCode();w?(this.text+=String.fromCharCode(w),this.sections.push(Zh.forImage(m)),this.sectionIndex.push(this.sections.length-1)):wi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function sh(f,A,m,w,D,U,V,Y,ee,ae,fe,_e,Se,Oe,ce,tt){const at=Xn.fromFeature(f,D);let pt;_e===P.ai.vertical&&at.verticalizePunctuation();const{processBidirectionalText:Ct,processStyledBidirectionalText:bt}=da;if(Ct&&at.sections.length===1){pt=[];const oi=Ct(at.toString(),Pf(at,ae,U,A,w,Oe,ce));for(const Si of oi){const tr=new Xn;tr.text=Si,tr.sections=at.sections;for(let Bi=0;Bi<Si.length;Bi++)tr.sectionIndex.push(0);pt.push(tr)}}else if(bt){pt=[];const oi=bt(at.text,at.sectionIndex,Pf(at,ae,U,A,w,Oe,ce));for(const Si of oi){const tr=new Xn;tr.text=Si[0],tr.sectionIndex=Si[1],tr.sections=at.sections,pt.push(tr)}}else pt=function(oi,Si){const tr=[],Bi=oi.text;let ki=0;for(const xi of Si)tr.push(oi.substring(ki,xi)),ki=xi;return ki<Bi.length&&tr.push(oi.substring(ki,Bi.length)),tr}(at,Pf(at,ae,U,A,w,Oe,ce));const me=[],Vt={positionedLines:me,text:at.toString(),top:fe[1],bottom:fe[1],left:fe[0],right:fe[0],writingMode:_e,iconsInText:!1,verticalizable:!1};return function(oi,Si,tr,Bi,ki,xi,Qi,Ii,ci,ur,ui,Qr){let Ts=0,ys=Gh,Io=0,La=0;const $a=Ii==="right"?1:Ii==="left"?0:.5;let Co=0;for(const zs of ki){zs.trim();const Vn=zs.getMaxScale(),el=(Vn-1)*zo,qo={positionedGlyphs:[],lineOffset:0};oi.positionedLines[Co]=qo;const ga=qo.positionedGlyphs;let Ys=0;if(!zs.length()){ys+=xi,++Co;continue}for(let Qo=0;Qo<zs.length();Qo++){const ln=zs.getSection(Qo),Ra=zs.getSectionIndex(Qo),Fa=zs.getCharCode(Qo);let ko=0,_o=null,ya=null,TA=null,vc=zo;const Wl=!(ci===P.ai.horizontal||!ui&&!yA(Fa)||ui&&(QA[Fa]||(na=Fa,Ei.Arabic(na)||Ei["Arabic Supplement"](na)||Ei["Arabic Extended-A"](na)||Ei["Arabic Presentation Forms-A"](na)||Ei["Arabic Presentation Forms-B"](na))));if(ln.imageName){const ml=Bi[ln.imageName];if(!ml)continue;TA=ln.imageName,oi.iconsInText=oi.iconsInText||!0,ya=ml.paddedRect;const tl=ml.displaySize;ln.scale=ln.scale*zo/Qr,_o={width:tl[0],height:tl[1],left:Wn,top:-n0,advance:Wl?tl[1]:tl[0]},ko=el+(zo-tl[1]*ln.scale),vc=_o.advance;const Xl=Wl?tl[0]*ln.scale-zo*Vn:tl[1]*ln.scale-zo*Vn;Xl>0&&Xl>Ys&&(Ys=Xl)}else{const ml=tr[ln.fontStack],tl=ml&&ml[Fa];if(tl&&tl.rect)ya=tl.rect,_o=tl.metrics;else{const Xl=Si[ln.fontStack],xa=Xl&&Xl[Fa];if(!xa)continue;_o=xa.metrics}ko=(Vn-ln.scale)*zo}Wl?(oi.verticalizable=!0,ga.push({glyph:Fa,imageName:TA,x:Ts,y:ys+ko,vertical:Wl,scale:ln.scale,fontStack:ln.fontStack,sectionIndex:Ra,metrics:_o,rect:ya}),Ts+=vc*ln.scale+ur):(ga.push({glyph:Fa,imageName:TA,x:Ts,y:ys+ko,vertical:Wl,scale:ln.scale,fontStack:ln.fontStack,sectionIndex:Ra,metrics:_o,rect:ya}),Ts+=_o.advance*ln.scale+ur)}ga.length!==0&&(Io=Math.max(Ts-ur,Io),Gp(ga,0,ga.length-1,$a,Ys)),Ts=0;const Ks=xi*Vn+Ys;qo.lineOffset=Math.max(Ys,el),ys+=Ks,La=Math.max(Ks,La),++Co}var na;const Xs=ys-Gh,{horizontalAlign:Hr,verticalAlign:sa}=zf(Qi);(function(zs,Vn,el,qo,ga,Ys,Ks,Qo,ln){const Ra=(Vn-el)*ga;let Fa=0;Fa=Ys!==Ks?-Qo*qo-Gh:(-qo*ln+.5)*Ks;for(const ko of zs)for(const _o of ko.positionedGlyphs)_o.x+=Ra,_o.y+=Fa})(oi.positionedLines,$a,Hr,sa,Io,La,xi,Xs,ki.length),oi.top+=-sa*Xs,oi.bottom=oi.top+Xs,oi.left+=-Hr*Io,oi.right=oi.left+Io}(Vt,A,m,w,pt,V,Y,ee,_e,ae,Se,tt),!function(oi){for(const Si of oi)if(Si.positionedGlyphs.length!==0)return!1;return!0}(me)&&Vt}const QA={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},jp={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function o0(f,A,m,w,D,U){if(A.imageName){const V=w[A.imageName];return V?V.displaySize[0]*A.scale*zo/U+D:0}{const V=m[A.fontStack],Y=V&&V[f];return Y?Y.metrics.advance*A.scale+D:0}}function a0(f,A,m,w){const D=Math.pow(f-A,2);return w?f<A?D/2:2*D:D+Math.abs(m)*m}function ws(f,A,m){let w=0;return f===10&&(w-=1e4),m&&(w+=150),f!==40&&f!==65288||(w+=50),A!==41&&A!==65289||(w+=50),w}function Df(f,A,m,w,D,U){let V=null,Y=a0(A,m,D,U);for(const ee of w){const ae=a0(A-ee.x,m,D,U)+ee.badness;ae<=Y&&(V=ee,Y=ae)}return{index:f,x:A,priorBreak:V,badness:Y}}function HA(f){return f?HA(f.priorBreak).concat(f.index):[]}function Pf(f,A,m,w,D,U,V){if(U!=="point")return[];if(!f)return[];const Y=[],ee=function(Se,Oe,ce,tt,at,pt){let Ct=0;for(let bt=0;bt<Se.length();bt++){const me=Se.getSection(bt);Ct+=o0(Se.getCharCode(bt),me,tt,at,Oe,pt)}return Ct/Math.max(1,Math.ceil(Ct/ce))}(f,A,m,w,D,V),ae=f.text.indexOf("​")>=0;let fe=0;for(let Se=0;Se<f.length();Se++){const Oe=f.getSection(Se),ce=f.getCharCode(Se);if(QA[ce]||(fe+=o0(ce,Oe,w,D,A,V)),Se<f.length()-1){const tt=!((_e=ce)<11904||!(Ei["Bopomofo Extended"](_e)||Ei.Bopomofo(_e)||Ei["CJK Compatibility Forms"](_e)||Ei["CJK Compatibility Ideographs"](_e)||Ei["CJK Compatibility"](_e)||Ei["CJK Radicals Supplement"](_e)||Ei["CJK Strokes"](_e)||Ei["CJK Symbols and Punctuation"](_e)||Ei["CJK Unified Ideographs Extension A"](_e)||Ei["CJK Unified Ideographs"](_e)||Ei["Enclosed CJK Letters and Months"](_e)||Ei["Halfwidth and Fullwidth Forms"](_e)||Ei.Hiragana(_e)||Ei["Ideographic Description Characters"](_e)||Ei["Kangxi Radicals"](_e)||Ei["Katakana Phonetic Extensions"](_e)||Ei.Katakana(_e)||Ei["Vertical Forms"](_e)||Ei["Yi Radicals"](_e)||Ei["Yi Syllables"](_e)));(jp[ce]||tt||Oe.imageName)&&Y.push(Df(Se+1,fe,ee,Y,ws(ce,f.getCharCode(Se+1),tt&&ae),!1))}}var _e;return HA(Df(f.length(),fe,ee,Y,0,!0))}function zf(f){let A=.5,m=.5;switch(f){case"right":case"top-right":case"bottom-right":A=1;break;case"left":case"top-left":case"bottom-left":A=0}switch(f){case"bottom":case"bottom-right":case"bottom-left":m=1;break;case"top":case"top-right":case"top-left":m=0}return{horizontalAlign:A,verticalAlign:m}}function Gp(f,A,m,w,D){if(!w&&!D)return;const U=f[m],V=(f[m].x+U.metrics.advance*U.scale)*w;for(let Y=A;Y<=m;Y++)f[Y].x-=V,f[Y].y+=D}function Fn(f,A,m){const{horizontalAlign:w,verticalAlign:D}=zf(m),U=A[0]-f.displaySize[0]*w,V=A[1]-f.displaySize[1]*D;return{image:f,top:V,bottom:V+f.displaySize[1],left:U,right:U+f.displaySize[0]}}function Bf(f,A,m,w,D,U){const V=f.image;let Y;if(V.content){const at=V.content,pt=V.pixelRatio||1;Y=[at[0]/pt,at[1]/pt,V.displaySize[0]-at[2]/pt,V.displaySize[1]-at[3]/pt]}const ee=A.left*U,ae=A.right*U;let fe,_e,Se,Oe;m==="width"||m==="both"?(Oe=D[0]+ee-w[3],_e=D[0]+ae+w[1]):(Oe=D[0]+(ee+ae-V.displaySize[0])/2,_e=Oe+V.displaySize[0]);const ce=A.top*U,tt=A.bottom*U;return m==="height"||m==="both"?(fe=D[1]+ce-w[0],Se=D[1]+tt+w[2]):(fe=D[1]+(ce+tt-V.displaySize[1])/2,Se=fe+V.displaySize[1]),{image:V,top:fe,right:_e,bottom:Se,left:Oe,collisionPadding:Y}}const Ka=255,WA=128,Wc=Ka*WA;function l0(f,A){const{expression:m}=A;if(m.kind==="constant")return{kind:"constant",layoutSize:m.evaluate(new Qn(f+1))};if(m.kind==="source")return{kind:"source"};{const{zoomStops:w,interpolationType:D}=m;let U=0;for(;U<w.length&&w[U]<=f;)U++;U=Math.max(0,U-1);let V=U;for(;V<w.length&&w[V]<f+1;)V++;V=Math.min(w.length-1,V);const Y=w[U],ee=w[V];return m.kind==="composite"?{kind:"composite",minZoom:Y,maxZoom:ee,interpolationType:D}:{kind:"camera",minZoom:Y,maxZoom:ee,minSize:m.evaluate(new Qn(Y)),maxSize:m.evaluate(new Qn(ee)),interpolationType:D}}}function Er(f,A,m){let w="never";const D=f.get(A);return D?w=D:f.get(m)&&(w="always"),w}const A0=pc.VectorTileFeature.types,Us=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function qh(f,A,m,w,D,U,V,Y,ee,ae,fe,_e,Se){const Oe=Y?Math.min(Wc,Math.round(Y[0])):0,ce=Y?Math.min(Wc,Math.round(Y[1])):0;f.emplaceBack(A,m,Math.round(32*w),Math.round(32*D),U,V,(Oe<<1)+(ee?1:0),ce,16*ae,16*fe,256*_e,256*Se)}function Lf(f,A,m){f.emplaceBack(A.x,A.y,m),f.emplaceBack(A.x,A.y,m),f.emplaceBack(A.x,A.y,m),f.emplaceBack(A.x,A.y,m)}function Zp(f){for(const A of f.sections)if(ks(A.text))return!0;return!1}class Rf{constructor(A){this.layoutVertexArray=new qi,this.indexArray=new Or,this.programConfigurations=A,this.segments=new is,this.dynamicLayoutVertexArray=new ji,this.opacityVertexArray=new Li,this.hasVisibleVertices=!1,this.placedSymbolArray=new le}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(A,m,w,D){this.isEmpty()||(w&&(this.layoutVertexBuffer=A.createVertexBuffer(this.layoutVertexArray,Np.members),this.indexBuffer=A.createIndexBuffer(this.indexArray,m),this.dynamicLayoutVertexBuffer=A.createVertexBuffer(this.dynamicLayoutVertexArray,K_.members,!0),this.opacityVertexBuffer=A.createVertexBuffer(this.opacityVertexArray,Us,!0),this.opacityVertexBuffer.itemSize=1),(w||D)&&this.programConfigurations.upload(A))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Fi("SymbolBuffers",Rf);class Ff{constructor(A,m,w){this.layoutVertexArray=new A,this.layoutAttributes=m,this.indexArray=new w,this.segments=new is,this.collisionVertexArray=new Ji}upload(A){this.layoutVertexBuffer=A.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=A.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=A.createVertexBuffer(this.collisionVertexArray,Up.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Fi("CollisionBuffers",Ff);class Uu{constructor(A){this.collisionBoxArray=A.collisionBoxArray,this.zoom=A.zoom,this.overscaling=A.overscaling,this.layers=A.layers,this.layerIds=this.layers.map(V=>V.id),this.index=A.index,this.pixelRatio=A.pixelRatio,this.sourceLayerIndex=A.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=kd([]),this.placementViewportMatrix=kd([]);const m=this.layers[0]._unevaluatedLayout._values;this.textSizeData=l0(this.zoom,m["text-size"]),this.iconSizeData=l0(this.zoom,m["icon-size"]);const w=this.layers[0].layout,D=w.get("symbol-sort-key"),U=w.get("symbol-z-order");this.canOverlap=Er(w,"text-overlap","text-allow-overlap")!=="never"||Er(w,"icon-overlap","icon-allow-overlap")!=="never"||w.get("text-ignore-placement")||w.get("icon-ignore-placement"),this.sortFeaturesByKey=U!=="viewport-y"&&!D.isConstant(),this.sortFeaturesByY=(U==="viewport-y"||U==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,w.get("symbol-placement")==="point"&&(this.writingModes=w.get("text-writing-mode").map(V=>P.ai[V])),this.stateDependentLayerIds=this.layers.filter(V=>V.isStateDependent()).map(V=>V.id),this.sourceID=A.sourceID}createArrays(){this.text=new Rf(new bA(this.layers,this.zoom,A=>/^text/.test(A))),this.icon=new Rf(new bA(this.layers,this.zoom,A=>/^icon/.test(A))),this.glyphOffsetArray=new ke,this.lineVertexArray=new Pe,this.symbolInstances=new ge,this.textAnchorOffsets=new ht}calculateGlyphDependencies(A,m,w,D,U){for(let V=0;V<A.length;V++)if(m[A.charCodeAt(V)]=!0,(w||D)&&U){const Y=qc[A.charAt(V)];Y&&(m[Y.charCodeAt(0)]=!0)}}populate(A,m,w){const D=this.layers[0],U=D.layout,V=U.get("text-font"),Y=U.get("text-field"),ee=U.get("icon-image"),ae=(Y.value.kind!=="constant"||Y.value.value instanceof gt&&!Y.value.value.isEmpty()||Y.value.value.toString().length>0)&&(V.value.kind!=="constant"||V.value.value.length>0),fe=ee.value.kind!=="constant"||!!ee.value.value||Object.keys(ee.parameters).length>0,_e=U.get("symbol-sort-key");if(this.features=[],!ae&&!fe)return;const Se=m.iconDependencies,Oe=m.glyphDependencies,ce=m.availableImages,tt=new Qn(this.zoom);for(const{feature:at,id:pt,index:Ct,sourceLayerIndex:bt}of A){const me=D._featureFilter.needGeometry,Vt=lu(at,me);if(!D._featureFilter.filter(tt,Vt,w))continue;let oi,Si;if(me||(Vt.geometry=Pu(at)),ae){const Bi=D.getValueAndResolveTokens("text-field",Vt,w,ce),ki=gt.factory(Bi);Zp(ki)&&(this.hasRTLText=!0),(!this.hasRTLText||Tl()==="unavailable"||this.hasRTLText&&da.isParsed())&&(oi=$d(ki,D,Vt))}if(fe){const Bi=D.getValueAndResolveTokens("icon-image",Vt,w,ce);Si=Bi instanceof to?Bi:to.fromString(Bi)}if(!oi&&!Si)continue;const tr=this.sortFeaturesByKey?_e.evaluate(Vt,{},w):void 0;if(this.features.push({id:pt,text:oi,icon:Si,index:Ct,sourceLayerIndex:bt,geometry:Vt.geometry,properties:at.properties,type:A0[at.type],sortKey:tr}),Si&&(Se[Si.name]=!0),oi){const Bi=V.evaluate(Vt,{},w).join(","),ki=U.get("text-rotation-alignment")!=="viewport"&&U.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(P.ai.vertical)>=0;for(const xi of oi.sections)if(xi.image)Se[xi.image.name]=!0;else{const Qi=nA(oi.toString()),Ii=xi.fontStack||Bi,ci=Oe[Ii]=Oe[Ii]||{};this.calculateGlyphDependencies(xi.text,ci,ki,this.allowVerticalPlacement,Qi)}}}U.get("symbol-placement")==="line"&&(this.features=function(at){const pt={},Ct={},bt=[];let me=0;function Vt(Bi){bt.push(at[Bi]),me++}function oi(Bi,ki,xi){const Qi=Ct[Bi];return delete Ct[Bi],Ct[ki]=Qi,bt[Qi].geometry[0].pop(),bt[Qi].geometry[0]=bt[Qi].geometry[0].concat(xi[0]),Qi}function Si(Bi,ki,xi){const Qi=pt[ki];return delete pt[ki],pt[Bi]=Qi,bt[Qi].geometry[0].shift(),bt[Qi].geometry[0]=xi[0].concat(bt[Qi].geometry[0]),Qi}function tr(Bi,ki,xi){const Qi=xi?ki[0][ki[0].length-1]:ki[0][0];return`${Bi}:${Qi.x}:${Qi.y}`}for(let Bi=0;Bi<at.length;Bi++){const ki=at[Bi],xi=ki.geometry,Qi=ki.text?ki.text.toString():null;if(!Qi){Vt(Bi);continue}const Ii=tr(Qi,xi),ci=tr(Qi,xi,!0);if(Ii in Ct&&ci in pt&&Ct[Ii]!==pt[ci]){const ur=Si(Ii,ci,xi),ui=oi(Ii,ci,bt[ur].geometry);delete pt[Ii],delete Ct[ci],Ct[tr(Qi,bt[ui].geometry,!0)]=ui,bt[ur].geometry=null}else Ii in Ct?oi(Ii,ci,xi):ci in pt?Si(Ii,ci,xi):(Vt(Bi),pt[Ii]=me-1,Ct[ci]=me-1)}return bt.filter(Bi=>Bi.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((at,pt)=>at.sortKey-pt.sortKey)}update(A,m,w){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(A,m,this.layers,w),this.icon.programConfigurations.updatePaintArrays(A,m,this.layers,w))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(A){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(A),this.iconCollisionBox.upload(A)),this.text.upload(A,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(A,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(A,m){const w=this.lineVertexArray.length;if(A.segment!==void 0){let D=A.dist(m[A.segment+1]),U=A.dist(m[A.segment]);const V={};for(let Y=A.segment+1;Y<m.length;Y++)V[Y]={x:m[Y].x,y:m[Y].y,tileUnitDistanceFromAnchor:D},Y<m.length-1&&(D+=m[Y+1].dist(m[Y]));for(let Y=A.segment||0;Y>=0;Y--)V[Y]={x:m[Y].x,y:m[Y].y,tileUnitDistanceFromAnchor:U},Y>0&&(U+=m[Y-1].dist(m[Y]));for(let Y=0;Y<m.length;Y++){const ee=V[Y];this.lineVertexArray.emplaceBack(ee.x,ee.y,ee.tileUnitDistanceFromAnchor)}}return{lineStartIndex:w,lineLength:this.lineVertexArray.length-w}}addSymbols(A,m,w,D,U,V,Y,ee,ae,fe,_e,Se){const Oe=A.indexArray,ce=A.layoutVertexArray,tt=A.segments.prepareSegment(4*m.length,ce,Oe,this.canOverlap?V.sortKey:void 0),at=this.glyphOffsetArray.length,pt=tt.vertexLength,Ct=this.allowVerticalPlacement&&Y===P.ai.vertical?Math.PI/2:0,bt=V.text&&V.text.sections;for(let me=0;me<m.length;me++){const{tl:Vt,tr:oi,bl:Si,br:tr,tex:Bi,pixelOffsetTL:ki,pixelOffsetBR:xi,minFontScaleX:Qi,minFontScaleY:Ii,glyphOffset:ci,isSDF:ur,sectionIndex:ui}=m[me],Qr=tt.vertexLength,Ts=ci[1];qh(ce,ee.x,ee.y,Vt.x,Ts+Vt.y,Bi.x,Bi.y,w,ur,ki.x,ki.y,Qi,Ii),qh(ce,ee.x,ee.y,oi.x,Ts+oi.y,Bi.x+Bi.w,Bi.y,w,ur,xi.x,ki.y,Qi,Ii),qh(ce,ee.x,ee.y,Si.x,Ts+Si.y,Bi.x,Bi.y+Bi.h,w,ur,ki.x,xi.y,Qi,Ii),qh(ce,ee.x,ee.y,tr.x,Ts+tr.y,Bi.x+Bi.w,Bi.y+Bi.h,w,ur,xi.x,xi.y,Qi,Ii),Lf(A.dynamicLayoutVertexArray,ee,Ct),Oe.emplaceBack(Qr,Qr+1,Qr+2),Oe.emplaceBack(Qr+1,Qr+2,Qr+3),tt.vertexLength+=4,tt.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ci[0]),me!==m.length-1&&ui===m[me+1].sectionIndex||A.programConfigurations.populatePaintArrays(ce.length,V,V.index,{},Se,bt&&bt[ui])}A.placedSymbolArray.emplaceBack(ee.x,ee.y,at,this.glyphOffsetArray.length-at,pt,ae,fe,ee.segment,w?w[0]:0,w?w[1]:0,D[0],D[1],Y,0,!1,0,_e)}_addCollisionDebugVertex(A,m,w,D,U,V){return m.emplaceBack(0,0),A.emplaceBack(w.x,w.y,D,U,Math.round(V.x),Math.round(V.y))}addCollisionDebugVertices(A,m,w,D,U,V,Y){const ee=U.segments.prepareSegment(4,U.layoutVertexArray,U.indexArray),ae=ee.vertexLength,fe=U.layoutVertexArray,_e=U.collisionVertexArray,Se=Y.anchorX,Oe=Y.anchorY;this._addCollisionDebugVertex(fe,_e,V,Se,Oe,new Gt(A,m)),this._addCollisionDebugVertex(fe,_e,V,Se,Oe,new Gt(w,m)),this._addCollisionDebugVertex(fe,_e,V,Se,Oe,new Gt(w,D)),this._addCollisionDebugVertex(fe,_e,V,Se,Oe,new Gt(A,D)),ee.vertexLength+=4;const ce=U.indexArray;ce.emplaceBack(ae,ae+1),ce.emplaceBack(ae+1,ae+2),ce.emplaceBack(ae+2,ae+3),ce.emplaceBack(ae+3,ae),ee.primitiveLength+=4}addDebugCollisionBoxes(A,m,w,D){for(let U=A;U<m;U++){const V=this.collisionBoxArray.get(U);this.addCollisionDebugVertices(V.x1,V.y1,V.x2,V.y2,D?this.textCollisionBox:this.iconCollisionBox,V.anchorPoint,w)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Ff(ir,Jd.members,Xi),this.iconCollisionBox=new Ff(ir,Jd.members,Xi);for(let A=0;A<this.symbolInstances.length;A++){const m=this.symbolInstances.get(A);this.addDebugCollisionBoxes(m.textBoxStartIndex,m.textBoxEndIndex,m,!0),this.addDebugCollisionBoxes(m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m,!0),this.addDebugCollisionBoxes(m.iconBoxStartIndex,m.iconBoxEndIndex,m,!1),this.addDebugCollisionBoxes(m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex,m,!1)}}_deserializeCollisionBoxesForSymbol(A,m,w,D,U,V,Y,ee,ae){const fe={};for(let _e=m;_e<w;_e++){const Se=A.get(_e);fe.textBox={x1:Se.x1,y1:Se.y1,x2:Se.x2,y2:Se.y2,anchorPointX:Se.anchorPointX,anchorPointY:Se.anchorPointY},fe.textFeatureIndex=Se.featureIndex;break}for(let _e=D;_e<U;_e++){const Se=A.get(_e);fe.verticalTextBox={x1:Se.x1,y1:Se.y1,x2:Se.x2,y2:Se.y2,anchorPointX:Se.anchorPointX,anchorPointY:Se.anchorPointY},fe.verticalTextFeatureIndex=Se.featureIndex;break}for(let _e=V;_e<Y;_e++){const Se=A.get(_e);fe.iconBox={x1:Se.x1,y1:Se.y1,x2:Se.x2,y2:Se.y2,anchorPointX:Se.anchorPointX,anchorPointY:Se.anchorPointY},fe.iconFeatureIndex=Se.featureIndex;break}for(let _e=ee;_e<ae;_e++){const Se=A.get(_e);fe.verticalIconBox={x1:Se.x1,y1:Se.y1,x2:Se.x2,y2:Se.y2,anchorPointX:Se.anchorPointX,anchorPointY:Se.anchorPointY},fe.verticalIconFeatureIndex=Se.featureIndex;break}return fe}deserializeCollisionBoxes(A){this.collisionArrays=[];for(let m=0;m<this.symbolInstances.length;m++){const w=this.symbolInstances.get(m);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(A,w.textBoxStartIndex,w.textBoxEndIndex,w.verticalTextBoxStartIndex,w.verticalTextBoxEndIndex,w.iconBoxStartIndex,w.iconBoxEndIndex,w.verticalIconBoxStartIndex,w.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(A,m){const w=A.placedSymbolArray.get(m),D=w.vertexStartIndex+4*w.numGlyphs;for(let U=w.vertexStartIndex;U<D;U+=4)A.indexArray.emplaceBack(U,U+1,U+2),A.indexArray.emplaceBack(U+1,U+2,U+3)}getSortedSymbolIndexes(A){if(this.sortedAngle===A&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const m=Math.sin(A),w=Math.cos(A),D=[],U=[],V=[];for(let Y=0;Y<this.symbolInstances.length;++Y){V.push(Y);const ee=this.symbolInstances.get(Y);D.push(0|Math.round(m*ee.anchorX+w*ee.anchorY)),U.push(ee.featureIndex)}return V.sort((Y,ee)=>D[Y]-D[ee]||U[ee]-U[Y]),V}addToSortKeyRanges(A,m){const w=this.sortKeyRanges[this.sortKeyRanges.length-1];w&&w.sortKey===m?w.symbolInstanceEnd=A+1:this.sortKeyRanges.push({sortKey:m,symbolInstanceStart:A,symbolInstanceEnd:A+1})}sortFeatures(A){if(this.sortFeaturesByY&&this.sortedAngle!==A&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(A),this.sortedAngle=A,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const m of this.symbolInstanceIndexes){const w=this.symbolInstances.get(m);this.featureSortOrder.push(w.featureIndex),[w.rightJustifiedTextSymbolIndex,w.centerJustifiedTextSymbolIndex,w.leftJustifiedTextSymbolIndex].forEach((D,U,V)=>{D>=0&&V.indexOf(D)===U&&this.addIndicesForPlacedSymbol(this.text,D)}),w.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,w.verticalPlacedTextSymbolIndex),w.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,w.placedIconSymbolIndex),w.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,w.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let c0,u0;Fi("SymbolBucket",Uu,{omit:["layers","collisionBoxArray","features","compareText"]}),Uu.MAX_GLYPHS=65535,Uu.addDynamicAttributes=Lf;var mr={get paint(){return u0=u0||new $r({"icon-opacity":new Kt(Be.paint_symbol["icon-opacity"]),"icon-color":new Kt(Be.paint_symbol["icon-color"]),"icon-halo-color":new Kt(Be.paint_symbol["icon-halo-color"]),"icon-halo-width":new Kt(Be.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Kt(Be.paint_symbol["icon-halo-blur"]),"icon-translate":new Nt(Be.paint_symbol["icon-translate"]),"icon-translate-anchor":new Nt(Be.paint_symbol["icon-translate-anchor"]),"text-opacity":new Kt(Be.paint_symbol["text-opacity"]),"text-color":new Kt(Be.paint_symbol["text-color"],{runtimeType:zn,getOverride:f=>f.textColor,hasOverride:f=>!!f.textColor}),"text-halo-color":new Kt(Be.paint_symbol["text-halo-color"]),"text-halo-width":new Kt(Be.paint_symbol["text-halo-width"]),"text-halo-blur":new Kt(Be.paint_symbol["text-halo-blur"]),"text-translate":new Nt(Be.paint_symbol["text-translate"]),"text-translate-anchor":new Nt(Be.paint_symbol["text-translate-anchor"])})},get layout(){return c0=c0||new $r({"symbol-placement":new Nt(Be.layout_symbol["symbol-placement"]),"symbol-spacing":new Nt(Be.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Nt(Be.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Kt(Be.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Nt(Be.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Nt(Be.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Nt(Be.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Nt(Be.layout_symbol["icon-ignore-placement"]),"icon-optional":new Nt(Be.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Nt(Be.layout_symbol["icon-rotation-alignment"]),"icon-size":new Kt(Be.layout_symbol["icon-size"]),"icon-text-fit":new Nt(Be.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Nt(Be.layout_symbol["icon-text-fit-padding"]),"icon-image":new Kt(Be.layout_symbol["icon-image"]),"icon-rotate":new Kt(Be.layout_symbol["icon-rotate"]),"icon-padding":new Kt(Be.layout_symbol["icon-padding"]),"icon-keep-upright":new Nt(Be.layout_symbol["icon-keep-upright"]),"icon-offset":new Kt(Be.layout_symbol["icon-offset"]),"icon-anchor":new Kt(Be.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Nt(Be.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Nt(Be.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Nt(Be.layout_symbol["text-rotation-alignment"]),"text-field":new Kt(Be.layout_symbol["text-field"]),"text-font":new Kt(Be.layout_symbol["text-font"]),"text-size":new Kt(Be.layout_symbol["text-size"]),"text-max-width":new Kt(Be.layout_symbol["text-max-width"]),"text-line-height":new Nt(Be.layout_symbol["text-line-height"]),"text-letter-spacing":new Kt(Be.layout_symbol["text-letter-spacing"]),"text-justify":new Kt(Be.layout_symbol["text-justify"]),"text-radial-offset":new Kt(Be.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Nt(Be.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Kt(Be.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Kt(Be.layout_symbol["text-anchor"]),"text-max-angle":new Nt(Be.layout_symbol["text-max-angle"]),"text-writing-mode":new Nt(Be.layout_symbol["text-writing-mode"]),"text-rotate":new Kt(Be.layout_symbol["text-rotate"]),"text-padding":new Nt(Be.layout_symbol["text-padding"]),"text-keep-upright":new Nt(Be.layout_symbol["text-keep-upright"]),"text-transform":new Kt(Be.layout_symbol["text-transform"]),"text-offset":new Kt(Be.layout_symbol["text-offset"]),"text-allow-overlap":new Nt(Be.layout_symbol["text-allow-overlap"]),"text-overlap":new Nt(Be.layout_symbol["text-overlap"]),"text-ignore-placement":new Nt(Be.layout_symbol["text-ignore-placement"]),"text-optional":new Nt(Be.layout_symbol["text-optional"])})}};class Mr{constructor(A){if(A.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=A.property.overrides?A.property.overrides.runtimeType:us,this.defaultValue=A}evaluate(A){if(A.formattedSection){const m=this.defaultValue.property.overrides;if(m&&m.hasOverride(A.formattedSection))return m.getOverride(A.formattedSection)}return A.feature&&A.featureState?this.defaultValue.evaluate(A.feature,A.featureState):this.defaultValue.property.specification.default}eachChild(A){this.defaultValue.isConstant()||A(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Fi("FormatSectionOverride",Mr,{omit:["defaultValue"]});class oh extends Hn{constructor(A){super(A,mr)}recalculate(A,m){if(super.recalculate(A,m),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const w=this.layout.get("text-writing-mode");if(w){const D=[];for(const U of w)D.indexOf(U)<0&&D.push(U);this.layout._values["text-writing-mode"]=D}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(A,m,w,D){const U=this.layout.get(A).evaluate(m,{},w,D),V=this._unevaluatedLayout._values[A];return V.isDataDriven()||_A(V.value)||!U?U:function(Y,ee){return ee.replace(/{([^{}]+)}/g,(ae,fe)=>Y&&fe in Y?String(Y[fe]):"")}(m.properties,U)}createBucket(A){return new Uu(A)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const A of mr.paint.overridableProperties){if(!oh.hasPaintOverride(this.layout,A))continue;const m=this.paint.get(A),w=new Mr(m),D=new sl(w,m.property.specification);let U=null;U=m.value.kind==="constant"||m.value.kind==="source"?new yl("source",D):new Nn("composite",D,m.value.zoomStops),this.paint._values[A]=new Mo(m.property,U,m.parameters)}}_handleOverridablePaintPropertyUpdate(A,m,w){return!(!this.layout||m.isDataDriven()||w.isDataDriven())&&oh.hasPaintOverride(this.layout,A)}static hasPaintOverride(A,m){const w=A.get("text-field"),D=mr.paint.properties[m];let U=!1;const V=Y=>{for(const ee of Y)if(D.overrides&&D.overrides.hasOverride(ee))return void(U=!0)};if(w.value.kind==="constant"&&w.value.value instanceof gt)V(w.value.value.sections);else if(w.value.kind==="source"){const Y=ae=>{U||(ae instanceof Ze&&st(ae.value)===we?V(ae.value.sections):ae instanceof ja?V(ae.sections):ae.eachChild(Y))},ee=w.value;ee._styleExpression&&Y(ee._styleExpression.expression)}return U}}let gc;var qp={get paint(){return gc=gc||new $r({"background-color":new Nt(Be.paint_background["background-color"]),"background-pattern":new El(Be.paint_background["background-pattern"]),"background-opacity":new Nt(Be.paint_background["background-opacity"])})}};class Qp extends Hn{constructor(A){super(A,qp)}}let h0;var Hp={get paint(){return h0=h0||new $r({"raster-opacity":new Nt(Be.paint_raster["raster-opacity"]),"raster-hue-rotate":new Nt(Be.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Nt(Be.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Nt(Be.paint_raster["raster-brightness-max"]),"raster-saturation":new Nt(Be.paint_raster["raster-saturation"]),"raster-contrast":new Nt(Be.paint_raster["raster-contrast"]),"raster-resampling":new Nt(Be.paint_raster["raster-resampling"]),"raster-fade-duration":new Nt(Be.paint_raster["raster-fade-duration"])})}};class Wp extends Hn{constructor(A){super(A,Hp)}}class Xp extends Hn{constructor(A){super(A,{}),this.onAdd=m=>{this.implementation.onAdd&&this.implementation.onAdd(m,m.painter.context.gl)},this.onRemove=m=>{this.implementation.onRemove&&this.implementation.onRemove(m,m.painter.context.gl)},this.implementation=A}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Yp{constructor(A){this._callback=A,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const Of=63710088e-1;class Xc{constructor(A,m){if(isNaN(A)||isNaN(m))throw new Error(`Invalid LngLat object: (${A}, ${m})`);if(this.lng=+A,this.lat=+m,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Xc(Ls(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(A){const m=Math.PI/180,w=this.lat*m,D=A.lat*m,U=Math.sin(w)*Math.sin(D)+Math.cos(w)*Math.cos(D)*Math.cos((A.lng-this.lng)*m);return Of*Math.acos(Math.min(U,1))}static convert(A){if(A instanceof Xc)return A;if(Array.isArray(A)&&(A.length===2||A.length===3))return new Xc(Number(A[0]),Number(A[1]));if(!Array.isArray(A)&&typeof A=="object"&&A!==null)return new Xc(Number("lng"in A?A.lng:A.lon),Number(A.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const f0=2*Math.PI*Of;function yc(f){return f0*Math.cos(f*Math.PI/180)}function Kp(f){return(180+f)/360}function Rr(f){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+f*Math.PI/360)))/360}function Nf(f,A){return f/yc(A)}function uA(f){return 360*f-180}function Uf(f){return 360/Math.PI*Math.atan(Math.exp((180-360*f)*Math.PI/180))-90}class Qh{constructor(A,m,w=0){this.x=+A,this.y=+m,this.z=+w}static fromLngLat(A,m=0){const w=Xc.convert(A);return new Qh(Kp(w.lng),Rr(w.lat),Nf(m,w.lat))}toLngLat(){return new Xc(uA(this.x),Uf(this.y))}toAltitude(){return this.z*yc(Uf(this.y))}meterInMercatorCoordinateUnits(){return 1/f0*(A=Uf(this.y),1/Math.cos(A*Math.PI/180));var A}}function d0(f,A,m){var w=2*Math.PI*6378137/256/Math.pow(2,m);return[f*w-2*Math.PI*6378137/2,A*w-2*Math.PI*6378137/2]}class Vf{constructor(A,m,w){if(A<0||A>25||w<0||w>=Math.pow(2,A)||m<0||m>=Math.pow(2,A))throw new Error(`x=${m}, y=${w}, z=${A} outside of bounds. 0<=x<${Math.pow(2,A)}, 0<=y<${Math.pow(2,A)} 0<=z<=25 `);this.z=A,this.x=m,this.y=w,this.key=ah(0,A,A,m,w)}equals(A){return this.z===A.z&&this.x===A.x&&this.y===A.y}url(A,m,w){const D=(V=this.y,Y=this.z,ee=d0(256*(U=this.x),256*(V=Math.pow(2,Y)-V-1),Y),ae=d0(256*(U+1),256*(V+1),Y),ee[0]+","+ee[1]+","+ae[0]+","+ae[1]);var U,V,Y,ee,ae;const fe=function(_e,Se,Oe){let ce,tt="";for(let at=_e;at>0;at--)ce=1<<at-1,tt+=(Se&ce?1:0)+(Oe&ce?2:0);return tt}(this.z,this.x,this.y);return A[(this.x+this.y)%A.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(w==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,m>1?"@2x":"").replace(/{quadkey}/g,fe).replace(/{bbox-epsg-3857}/g,D)}isChildOf(A){const m=this.z-A.z;return m>0&&A.x===this.x>>m&&A.y===this.y>>m}getTilePoint(A){const m=Math.pow(2,this.z);return new Gt((A.x*m-this.x)*Ns,(A.y*m-this.y)*Ns)}toString(){return`${this.z}/${this.x}/${this.y}`}}class p0{constructor(A,m){this.wrap=A,this.canonical=m,this.key=ah(A,m.z,m.z,m.x,m.y)}}class ql{constructor(A,m,w,D,U){if(A<w)throw new Error(`overscaledZ should be >= z; overscaledZ = ${A}; z = ${w}`);this.overscaledZ=A,this.wrap=m,this.canonical=new Vf(w,+D,+U),this.key=ah(m,A,w,D,U)}clone(){return new ql(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(A){return this.overscaledZ===A.overscaledZ&&this.wrap===A.wrap&&this.canonical.equals(A.canonical)}scaledTo(A){if(A>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${A}; overscaledZ = ${this.overscaledZ}`);const m=this.canonical.z-A;return A>this.canonical.z?new ql(A,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ql(A,this.wrap,A,this.canonical.x>>m,this.canonical.y>>m)}calculateScaledKey(A,m){if(A>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${A}; overscaledZ = ${this.overscaledZ}`);const w=this.canonical.z-A;return A>this.canonical.z?ah(this.wrap*+m,A,this.canonical.z,this.canonical.x,this.canonical.y):ah(this.wrap*+m,A,A,this.canonical.x>>w,this.canonical.y>>w)}isChildOf(A){if(A.wrap!==this.wrap)return!1;const m=this.canonical.z-A.canonical.z;return A.overscaledZ===0||A.overscaledZ<this.overscaledZ&&A.canonical.x===this.canonical.x>>m&&A.canonical.y===this.canonical.y>>m}children(A){if(this.overscaledZ>=A)return[new ql(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const m=this.canonical.z+1,w=2*this.canonical.x,D=2*this.canonical.y;return[new ql(m,this.wrap,m,w,D),new ql(m,this.wrap,m,w+1,D),new ql(m,this.wrap,m,w,D+1),new ql(m,this.wrap,m,w+1,D+1)]}isLessThan(A){return this.wrap<A.wrap||!(this.wrap>A.wrap)&&(this.overscaledZ<A.overscaledZ||!(this.overscaledZ>A.overscaledZ)&&(this.canonical.x<A.canonical.x||!(this.canonical.x>A.canonical.x)&&this.canonical.y<A.canonical.y))}wrapped(){return new ql(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(A){return new ql(this.overscaledZ,A,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new p0(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(A){return this.canonical.getTilePoint(new Qh(A.x-this.wrap,A.y))}}function ah(f,A,m,w,D){(f*=2)<0&&(f=-1*f-1);const U=1<<m;return(U*U*f+U*D+w).toString(36)+m.toString(36)+A.toString(36)}Fi("CanonicalTileID",Vf),Fi("OverscaledTileID",ql,{omit:["posMatrix"]});class m0{constructor(A,m,w,D=1,U=1,V=1,Y=0){if(this.uid=A,m.height!==m.width)throw new RangeError("DEM tiles must be square");if(w&&!["mapbox","terrarium","custom"].includes(w))return void wi(`"${w}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=m.height;const ee=this.dim=m.height-2;switch(this.data=new Uint32Array(m.data.buffer),w){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=D,this.greenFactor=U,this.blueFactor=V,this.baseShift=Y;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let ae=0;ae<ee;ae++)this.data[this._idx(-1,ae)]=this.data[this._idx(0,ae)],this.data[this._idx(ee,ae)]=this.data[this._idx(ee-1,ae)],this.data[this._idx(ae,-1)]=this.data[this._idx(ae,0)],this.data[this._idx(ae,ee)]=this.data[this._idx(ae,ee-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(ee,-1)]=this.data[this._idx(ee-1,0)],this.data[this._idx(-1,ee)]=this.data[this._idx(0,ee-1)],this.data[this._idx(ee,ee)]=this.data[this._idx(ee-1,ee-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let ae=0;ae<ee;ae++)for(let fe=0;fe<ee;fe++){const _e=this.get(ae,fe);_e>this.max&&(this.max=_e),_e<this.min&&(this.min=_e)}}get(A,m){const w=new Uint8Array(this.data.buffer),D=4*this._idx(A,m);return this.unpack(w[D],w[D+1],w[D+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(A,m){if(A<-1||A>=this.dim+1||m<-1||m>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(m+1)*this.stride+(A+1)}unpack(A,m,w){return A*this.redFactor+m*this.greenFactor+w*this.blueFactor-this.baseShift}getPixels(){return new Cl({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(A,m,w){if(this.dim!==A.dim)throw new Error("dem dimension mismatch");let D=m*this.dim,U=m*this.dim+this.dim,V=w*this.dim,Y=w*this.dim+this.dim;switch(m){case-1:D=U-1;break;case 1:U=D+1}switch(w){case-1:V=Y-1;break;case 1:Y=V+1}const ee=-m*this.dim,ae=-w*this.dim;for(let fe=V;fe<Y;fe++)for(let _e=D;_e<U;_e++)this.data[this._idx(_e,fe)]=A.data[this._idx(_e+ee,fe+ae)]}}Fi("DEMData",m0);class _0{constructor(A){this._stringToNumber={},this._numberToString=[];for(let m=0;m<A.length;m++){const w=A[m];this._stringToNumber[w]=m,this._numberToString[m]=w}}encode(A){return this._stringToNumber[A]}decode(A){if(A>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${A} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[A]}}class Jp{constructor(A,m,w,D,U){this.type="Feature",this._vectorTileFeature=A,A._z=m,A._x=w,A._y=D,this.properties=A.properties,this.id=U}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(A){this._geometry=A}toJSON(){const A={geometry:this.geometry};for(const m in this)m!=="_geometry"&&m!=="_vectorTileFeature"&&(A[m]=this[m]);return A}}class jf{constructor(A,m){this.tileID=A,this.x=A.canonical.x,this.y=A.canonical.y,this.z=A.canonical.z,this.grid=new hl(Ns,16,0),this.grid3D=new hl(Ns,16,0),this.featureIndexArray=new ot,this.promoteId=m}insert(A,m,w,D,U,V){const Y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(w,D,U);const ee=V?this.grid3D:this.grid;for(let ae=0;ae<m.length;ae++){const fe=m[ae],_e=[1/0,1/0,-1/0,-1/0];for(let Se=0;Se<fe.length;Se++){const Oe=fe[Se];_e[0]=Math.min(_e[0],Oe.x),_e[1]=Math.min(_e[1],Oe.y),_e[2]=Math.max(_e[2],Oe.x),_e[3]=Math.max(_e[3],Oe.y)}_e[0]<Ns&&_e[1]<Ns&&_e[2]>=0&&_e[3]>=0&&ee.insert(Y,_e[0],_e[1],_e[2],_e[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new pc.VectorTile(new _c(this.rawTileData)).layers,this.sourceLayerCoder=new _0(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(A,m,w,D){this.loadVTLayers();const U=A.params||{},V=Ns/A.tileSize/A.scale,Y=Os(U.filter),ee=A.queryGeometry,ae=A.queryPadding*V,fe=$p(ee),_e=this.grid.query(fe.minX-ae,fe.minY-ae,fe.maxX+ae,fe.maxY+ae),Se=$p(A.cameraQueryGeometry),Oe=this.grid3D.query(Se.minX-ae,Se.minY-ae,Se.maxX+ae,Se.maxY+ae,(at,pt,Ct,bt)=>function(me,Vt,oi,Si,tr){for(const ki of me)if(Vt<=ki.x&&oi<=ki.y&&Si>=ki.x&&tr>=ki.y)return!0;const Bi=[new Gt(Vt,oi),new Gt(Vt,tr),new Gt(Si,tr),new Gt(Si,oi)];if(me.length>2){for(const ki of Bi)if(Ju(me,ki))return!0}for(let ki=0;ki<me.length-1;ki++)if(q_(me[ki],me[ki+1],Bi))return!0;return!1}(A.cameraQueryGeometry,at-ae,pt-ae,Ct+ae,bt+ae));for(const at of Oe)_e.push(at);_e.sort(Yc);const ce={};let tt;for(let at=0;at<_e.length;at++){const pt=_e[at];if(pt===tt)continue;tt=pt;const Ct=this.featureIndexArray.get(pt);let bt=null;this.loadMatchingFeature(ce,Ct.bucketIndex,Ct.sourceLayerIndex,Ct.featureIndex,Y,U.layers,U.availableImages,m,w,D,(me,Vt,oi)=>(bt||(bt=Pu(me)),Vt.queryIntersectsFeature(ee,me,oi,bt,this.z,A.transform,V,A.pixelPosMatrix)))}return ce}loadMatchingFeature(A,m,w,D,U,V,Y,ee,ae,fe,_e){const Se=this.bucketLayerIDs[m];if(V&&!function(at,pt){for(let Ct=0;Ct<at.length;Ct++)if(pt.indexOf(at[Ct])>=0)return!0;return!1}(V,Se))return;const Oe=this.sourceLayerCoder.decode(w),ce=this.vtLayers[Oe].feature(D);if(U.needGeometry){const at=lu(ce,!0);if(!U.filter(new Qn(this.tileID.overscaledZ),at,this.tileID.canonical))return}else if(!U.filter(new Qn(this.tileID.overscaledZ),ce))return;const tt=this.getId(ce,Oe);for(let at=0;at<Se.length;at++){const pt=Se[at];if(V&&V.indexOf(pt)<0)continue;const Ct=ee[pt];if(!Ct)continue;let bt={};tt&&fe&&(bt=fe.getState(Ct.sourceLayer||"_geojsonTileLayer",tt));const me=pn({},ae[pt]);me.paint=_u(me.paint,Ct.paint,ce,bt,Y),me.layout=_u(me.layout,Ct.layout,ce,bt,Y);const Vt=!_e||_e(ce,Ct,bt);if(!Vt)continue;const oi=new Jp(ce,this.z,this.x,this.y,tt);oi.layer=me;let Si=A[pt];Si===void 0&&(Si=A[pt]=[]),Si.push({featureIndex:D,feature:oi,intersectionZ:Vt})}}lookupSymbolFeatures(A,m,w,D,U,V,Y,ee){const ae={};this.loadVTLayers();const fe=Os(U);for(const _e of A)this.loadMatchingFeature(ae,w,D,_e,fe,V,Y,ee,m);return ae}hasLayer(A){for(const m of this.bucketLayerIDs)for(const w of m)if(A===w)return!0;return!1}getId(A,m){let w=A.id;return this.promoteId&&(w=A.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[m]],typeof w=="boolean"&&(w=Number(w))),w}}function _u(f,A,m,w,D){return ct(f,(U,V)=>{const Y=A instanceof Da?A.get(V):null;return Y&&Y.evaluate?Y.evaluate(m,w,D):Y})}function $p(f){let A=1/0,m=1/0,w=-1/0,D=-1/0;for(const U of f)A=Math.min(A,U.x),m=Math.min(m,U.y),w=Math.max(w,U.x),D=Math.max(D,U.y);return{minX:A,minY:m,maxX:w,maxY:D}}function Yc(f,A){return A-f}function Ql(f,A,m,w,D){const U=[];for(let V=0;V<f.length;V++){const Y=f[V];let ee;for(let ae=0;ae<Y.length-1;ae++){let fe=Y[ae],_e=Y[ae+1];fe.x<A&&_e.x<A||(fe.x<A?fe=new Gt(A,fe.y+(A-fe.x)/(_e.x-fe.x)*(_e.y-fe.y))._round():_e.x<A&&(_e=new Gt(A,fe.y+(A-fe.x)/(_e.x-fe.x)*(_e.y-fe.y))._round()),fe.y<m&&_e.y<m||(fe.y<m?fe=new Gt(fe.x+(m-fe.y)/(_e.y-fe.y)*(_e.x-fe.x),m)._round():_e.y<m&&(_e=new Gt(fe.x+(m-fe.y)/(_e.y-fe.y)*(_e.x-fe.x),m)._round()),fe.x>=w&&_e.x>=w||(fe.x>=w?fe=new Gt(w,fe.y+(w-fe.x)/(_e.x-fe.x)*(_e.y-fe.y))._round():_e.x>=w&&(_e=new Gt(w,fe.y+(w-fe.x)/(_e.x-fe.x)*(_e.y-fe.y))._round()),fe.y>=D&&_e.y>=D||(fe.y>=D?fe=new Gt(fe.x+(D-fe.y)/(_e.y-fe.y)*(_e.x-fe.x),D)._round():_e.y>=D&&(_e=new Gt(fe.x+(D-fe.y)/(_e.y-fe.y)*(_e.x-fe.x),D)._round()),ee&&fe.equals(ee[ee.length-1])||(ee=[fe],U.push(ee)),ee.push(_e)))))}}return U}Fi("FeatureIndex",jf,{omit:["rawTileData","sourceLayerCoder"]});class Kc extends Gt{constructor(A,m,w,D){super(A,m),this.angle=w,D!==void 0&&(this.segment=D)}clone(){return new Kc(this.x,this.y,this.angle,this.segment)}}function Hh(f,A,m,w,D){if(A.segment===void 0||m===0)return!0;let U=A,V=A.segment+1,Y=0;for(;Y>-m/2;){if(V--,V<0)return!1;Y-=f[V].dist(U),U=f[V]}Y+=f[V].dist(f[V+1]),V++;const ee=[];let ae=0;for(;Y<m/2;){const fe=f[V],_e=f[V+1];if(!_e)return!1;let Se=f[V-1].angleTo(fe)-fe.angleTo(_e);for(Se=Math.abs((Se+3*Math.PI)%(2*Math.PI)-Math.PI),ee.push({distance:Y,angleDelta:Se}),ae+=Se;Y-ee[0].distance>w;)ae-=ee.shift().angleDelta;if(ae>D)return!1;V++,Y+=fe.dist(_e)}return!0}function Gf(f){let A=0;for(let m=0;m<f.length-1;m++)A+=f[m].dist(f[m+1]);return A}function g0(f,A,m){return f?.6*A*m:0}function y0(f,A){return Math.max(f?f.right-f.left:0,A?A.right-A.left:0)}function em(f,A,m,w,D,U){const V=g0(m,D,U),Y=y0(m,w)*U;let ee=0;const ae=Gf(f)/2;for(let fe=0;fe<f.length-1;fe++){const _e=f[fe],Se=f[fe+1],Oe=_e.dist(Se);if(ee+Oe>ae){const ce=(ae-ee)/Oe,tt=sr.number(_e.x,Se.x,ce),at=sr.number(_e.y,Se.y,ce),pt=new Kc(tt,at,Se.angleTo(_e),fe);return pt._round(),!V||Hh(f,pt,Y,V,A)?pt:void 0}ee+=Oe}}function tm(f,A,m,w,D,U,V,Y,ee){const ae=g0(w,U,V),fe=y0(w,D),_e=fe*V,Se=f[0].x===0||f[0].x===ee||f[0].y===0||f[0].y===ee;return A-_e<A/4&&(A=_e+A/4),Wh(f,Se?A/2*Y%A:(fe/2+2*U)*V*Y%A,A,ae,m,_e,Se,!1,ee)}function Wh(f,A,m,w,D,U,V,Y,ee){const ae=U/2,fe=Gf(f);let _e=0,Se=A-m,Oe=[];for(let ce=0;ce<f.length-1;ce++){const tt=f[ce],at=f[ce+1],pt=tt.dist(at),Ct=at.angleTo(tt);for(;Se+m<_e+pt;){Se+=m;const bt=(Se-_e)/pt,me=sr.number(tt.x,at.x,bt),Vt=sr.number(tt.y,at.y,bt);if(me>=0&&me<ee&&Vt>=0&&Vt<ee&&Se-ae>=0&&Se+ae<=fe){const oi=new Kc(me,Vt,Ct,ce);oi._round(),w&&!Hh(f,oi,U,w,D)||Oe.push(oi)}}_e+=pt}return Y||Oe.length||V||(Oe=Wh(f,_e/2,m,w,D,U,V,!0,ee)),Oe}Fi("Anchor",Kc);const Vu=Wn;function x0(f,A,m,w){const D=[],U=f.image,V=U.pixelRatio,Y=U.paddedRect.w-2*Vu,ee=U.paddedRect.h-2*Vu,ae=f.right-f.left,fe=f.bottom-f.top,_e=U.stretchX||[[0,Y]],Se=U.stretchY||[[0,ee]],Oe=(xi,Qi)=>xi+Qi[1]-Qi[0],ce=_e.reduce(Oe,0),tt=Se.reduce(Oe,0),at=Y-ce,pt=ee-tt;let Ct=0,bt=ce,me=0,Vt=tt,oi=0,Si=at,tr=0,Bi=pt;if(U.content&&w){const xi=U.content;Ct=Xh(_e,0,xi[0]),me=Xh(Se,0,xi[1]),bt=Xh(_e,xi[0],xi[2]),Vt=Xh(Se,xi[1],xi[3]),oi=xi[0]-Ct,tr=xi[1]-me,Si=xi[2]-xi[0]-bt,Bi=xi[3]-xi[1]-Vt}const ki=(xi,Qi,Ii,ci)=>{const ur=Yh(xi.stretch-Ct,bt,ae,f.left),ui=lh(xi.fixed-oi,Si,xi.stretch,ce),Qr=Yh(Qi.stretch-me,Vt,fe,f.top),Ts=lh(Qi.fixed-tr,Bi,Qi.stretch,tt),ys=Yh(Ii.stretch-Ct,bt,ae,f.left),Io=lh(Ii.fixed-oi,Si,Ii.stretch,ce),La=Yh(ci.stretch-me,Vt,fe,f.top),$a=lh(ci.fixed-tr,Bi,ci.stretch,tt),Co=new Gt(ur,Qr),na=new Gt(ys,Qr),Xs=new Gt(ys,La),Hr=new Gt(ur,La),sa=new Gt(ui/V,Ts/V),zs=new Gt(Io/V,$a/V),Vn=A*Math.PI/180;if(Vn){const ga=Math.sin(Vn),Ys=Math.cos(Vn),Ks=[Ys,-ga,ga,Ys];Co._matMult(Ks),na._matMult(Ks),Hr._matMult(Ks),Xs._matMult(Ks)}const el=xi.stretch+xi.fixed,qo=Qi.stretch+Qi.fixed;return{tl:Co,tr:na,bl:Hr,br:Xs,tex:{x:U.paddedRect.x+Vu+el,y:U.paddedRect.y+Vu+qo,w:Ii.stretch+Ii.fixed-el,h:ci.stretch+ci.fixed-qo},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:sa,pixelOffsetBR:zs,minFontScaleX:Si/V/ae,minFontScaleY:Bi/V/fe,isSDF:m}};if(w&&(U.stretchX||U.stretchY)){const xi=v0(_e,at,ce),Qi=v0(Se,pt,tt);for(let Ii=0;Ii<xi.length-1;Ii++){const ci=xi[Ii],ur=xi[Ii+1];for(let ui=0;ui<Qi.length-1;ui++)D.push(ki(ci,Qi[ui],ur,Qi[ui+1]))}}else D.push(ki({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:Y+1},{fixed:0,stretch:ee+1}));return D}function Xh(f,A,m){let w=0;for(const D of f)w+=Math.max(A,Math.min(m,D[1]))-Math.max(A,Math.min(m,D[0]));return w}function v0(f,A,m){const w=[{fixed:-Vu,stretch:0}];for(const[D,U]of f){const V=w[w.length-1];w.push({fixed:D-V.stretch,stretch:V.stretch}),w.push({fixed:D-V.stretch,stretch:V.stretch+(U-D)})}return w.push({fixed:A+Vu,stretch:m}),w}function Yh(f,A,m,w){return f/A*m+w}function lh(f,A,m,w){return f-A*m/w}class Hl{constructor(A,m,w,D,U,V,Y,ee,ae,fe){if(this.boxStartIndex=A.length,ae){let _e=V.top,Se=V.bottom;const Oe=V.collisionPadding;Oe&&(_e-=Oe[1],Se+=Oe[3]);let ce=Se-_e;ce>0&&(ce=Math.max(10,ce),this.circleDiameter=ce)}else{let _e=V.top*Y-ee[0],Se=V.bottom*Y+ee[2],Oe=V.left*Y-ee[3],ce=V.right*Y+ee[1];const tt=V.collisionPadding;if(tt&&(Oe-=tt[0]*Y,_e-=tt[1]*Y,ce+=tt[2]*Y,Se+=tt[3]*Y),fe){const at=new Gt(Oe,_e),pt=new Gt(ce,_e),Ct=new Gt(Oe,Se),bt=new Gt(ce,Se),me=fe*Math.PI/180;at._rotate(me),pt._rotate(me),Ct._rotate(me),bt._rotate(me),Oe=Math.min(at.x,pt.x,Ct.x,bt.x),ce=Math.max(at.x,pt.x,Ct.x,bt.x),_e=Math.min(at.y,pt.y,Ct.y,bt.y),Se=Math.max(at.y,pt.y,Ct.y,bt.y)}A.emplaceBack(m.x,m.y,Oe,_e,ce,Se,w,D,U)}this.boxEndIndex=A.length}}class im{constructor(A=[],m=rm){if(this.data=A,this.length=this.data.length,this.compare=m,this.length>0)for(let w=(this.length>>1)-1;w>=0;w--)this._down(w)}push(A){this.data.push(A),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const A=this.data[0],m=this.data.pop();return this.length--,this.length>0&&(this.data[0]=m,this._down(0)),A}peek(){return this.data[0]}_up(A){const{data:m,compare:w}=this,D=m[A];for(;A>0;){const U=A-1>>1,V=m[U];if(w(D,V)>=0)break;m[A]=V,A=U}m[A]=D}_down(A){const{data:m,compare:w}=this,D=this.length>>1,U=m[A];for(;A<D;){let V=1+(A<<1),Y=m[V];const ee=V+1;if(ee<this.length&&w(m[ee],Y)<0&&(V=ee,Y=m[ee]),w(Y,U)>=0)break;m[A]=Y,A=V}m[A]=U}}function rm(f,A){return f<A?-1:f>A?1:0}function ng(f,A=1,m=!1){let w=1/0,D=1/0,U=-1/0,V=-1/0;const Y=f[0];for(let Oe=0;Oe<Y.length;Oe++){const ce=Y[Oe];(!Oe||ce.x<w)&&(w=ce.x),(!Oe||ce.y<D)&&(D=ce.y),(!Oe||ce.x>U)&&(U=ce.x),(!Oe||ce.y>V)&&(V=ce.y)}const ee=Math.min(U-w,V-D);let ae=ee/2;const fe=new im([],b0);if(ee===0)return new Gt(w,D);for(let Oe=w;Oe<U;Oe+=ee)for(let ce=D;ce<V;ce+=ee)fe.push(new gu(Oe+ae,ce+ae,ae,f));let _e=function(Oe){let ce=0,tt=0,at=0;const pt=Oe[0];for(let Ct=0,bt=pt.length,me=bt-1;Ct<bt;me=Ct++){const Vt=pt[Ct],oi=pt[me],Si=Vt.x*oi.y-oi.x*Vt.y;tt+=(Vt.x+oi.x)*Si,at+=(Vt.y+oi.y)*Si,ce+=3*Si}return new gu(tt/ce,at/ce,0,Oe)}(f),Se=fe.length;for(;fe.length;){const Oe=fe.pop();(Oe.d>_e.d||!_e.d)&&(_e=Oe,m&&console.log("found best %d after %d probes",Math.round(1e4*Oe.d)/1e4,Se)),Oe.max-_e.d<=A||(ae=Oe.h/2,fe.push(new gu(Oe.p.x-ae,Oe.p.y-ae,ae,f)),fe.push(new gu(Oe.p.x+ae,Oe.p.y-ae,ae,f)),fe.push(new gu(Oe.p.x-ae,Oe.p.y+ae,ae,f)),fe.push(new gu(Oe.p.x+ae,Oe.p.y+ae,ae,f)),Se+=4)}return m&&(console.log(`num probes: ${Se}`),console.log(`best distance: ${_e.d}`)),_e.p}function b0(f,A){return A.max-f.max}function gu(f,A,m,w){this.p=new Gt(f,A),this.h=m,this.d=function(D,U){let V=!1,Y=1/0;for(let ee=0;ee<U.length;ee++){const ae=U[ee];for(let fe=0,_e=ae.length,Se=_e-1;fe<_e;Se=fe++){const Oe=ae[fe],ce=ae[Se];Oe.y>D.y!=ce.y>D.y&&D.x<(ce.x-Oe.x)*(D.y-Oe.y)/(ce.y-Oe.y)+Oe.x&&(V=!V),Y=Math.min(Y,yp(D,Oe,ce))}}return(V?1:-1)*Math.sqrt(Y)}(this.p,w),this.max=this.d+this.h*Math.SQRT2}var za;P.aq=void 0,(za=P.aq||(P.aq={}))[za.center=1]="center",za[za.left=2]="left",za[za.right=3]="right",za[za.top=4]="top",za[za.bottom=5]="bottom",za[za["top-left"]=6]="top-left",za[za["top-right"]=7]="top-right",za[za["bottom-left"]=8]="bottom-left",za[za["bottom-right"]=9]="bottom-right";const Ba=7,w0=Number.POSITIVE_INFINITY;function Gr(f,A){return A[1]!==w0?function(m,w,D){let U=0,V=0;switch(w=Math.abs(w),D=Math.abs(D),m){case"top-right":case"top-left":case"top":V=D-Ba;break;case"bottom-right":case"bottom-left":case"bottom":V=-D+Ba}switch(m){case"top-right":case"bottom-right":case"right":U=-w;break;case"top-left":case"bottom-left":case"left":U=w}return[U,V]}(f,A[0],A[1]):function(m,w){let D=0,U=0;w<0&&(w=0);const V=w/Math.SQRT2;switch(m){case"top-right":case"top-left":U=V-Ba;break;case"bottom-right":case"bottom-left":U=-V+Ba;break;case"bottom":U=-w+Ba;break;case"top":U=w-Ba}switch(m){case"top-right":case"bottom-right":D=-V;break;case"top-left":case"bottom-left":D=V;break;case"left":D=w;break;case"right":D=-w}return[D,U]}(f,A[0])}function Zf(f,A,m){var w;const D=f.layout,U=(w=D.get("text-variable-anchor-offset"))===null||w===void 0?void 0:w.evaluate(A,{},m);if(U){const Y=U.values,ee=[];for(let ae=0;ae<Y.length;ae+=2){const fe=ee[ae]=Y[ae],_e=Y[ae+1].map(Se=>Se*zo);fe.startsWith("top")?_e[1]-=Ba:fe.startsWith("bottom")&&(_e[1]+=Ba),ee[ae+1]=_e}return new ar(ee)}const V=D.get("text-variable-anchor");if(V){let Y;Y=f._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[D.get("text-radial-offset").evaluate(A,{},m)*zo,w0]:D.get("text-offset").evaluate(A,{},m).map(ae=>ae*zo);const ee=[];for(const ae of V)ee.push(ae,Gr(ae,Y));return new ar(ee)}return null}function Ja(f){switch(f){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Jc(f,A,m,w,D,U,V,Y,ee,ae,fe){let _e=U.textMaxSize.evaluate(A,{});_e===void 0&&(_e=V);const Se=f.layers[0].layout,Oe=Se.get("icon-offset").evaluate(A,{},fe),ce=E0(m.horizontal),tt=V/24,at=f.tilePixelRatio*tt,pt=f.tilePixelRatio*_e/24,Ct=f.tilePixelRatio*Y,bt=f.tilePixelRatio*Se.get("symbol-spacing"),me=Se.get("text-padding")*f.tilePixelRatio,Vt=function(ci,ur,ui,Qr=1){const Ts=ci.get("icon-padding").evaluate(ur,{},ui),ys=Ts&&Ts.values;return[ys[0]*Qr,ys[1]*Qr,ys[2]*Qr,ys[3]*Qr]}(Se,A,fe,f.tilePixelRatio),oi=Se.get("text-max-angle")/180*Math.PI,Si=Se.get("text-rotation-alignment")!=="viewport"&&Se.get("symbol-placement")!=="point",tr=Se.get("icon-rotation-alignment")==="map"&&Se.get("symbol-placement")!=="point",Bi=Se.get("symbol-placement"),ki=bt/2,xi=Se.get("icon-text-fit");let Qi;w&&xi!=="none"&&(f.allowVerticalPlacement&&m.vertical&&(Qi=Bf(w,m.vertical,xi,Se.get("icon-text-fit-padding"),Oe,tt)),ce&&(w=Bf(w,ce,xi,Se.get("icon-text-fit-padding"),Oe,tt)));const Ii=(ci,ur)=>{ur.x<0||ur.x>=Ns||ur.y<0||ur.y>=Ns||function(ui,Qr,Ts,ys,Io,La,$a,Co,na,Xs,Hr,sa,zs,Vn,el,qo,ga,Ys,Ks,Qo,ln,Ra,Fa,ko,_o){const ya=ui.addToLineVertexArray(Qr,Ts);let TA,vc,Wl,ml,tl=0,Xl=0,xa=0,hh=0,fh=-1,Yf=-1;const _l={};let Kf=vA("");if(ui.allowVerticalPlacement&&ys.vertical){const il=Co.layout.get("text-rotate").evaluate(ln,{},ko)+90;Wl=new Hl(na,Qr,Xs,Hr,sa,ys.vertical,zs,Vn,el,il),$a&&(ml=new Hl(na,Qr,Xs,Hr,sa,$a,ga,Ys,el,il))}if(Io){const il=Co.layout.get("icon-rotate").evaluate(ln,{}),Oa=Co.layout.get("icon-text-fit")!=="none",$c=x0(Io,il,Fa,Oa),Na=$a?x0($a,il,Fa,Oa):void 0;vc=new Hl(na,Qr,Xs,Hr,sa,Io,ga,Ys,!1,il),tl=4*$c.length;const er=ui.iconSizeData;let bc=null;er.kind==="source"?(bc=[WA*Co.layout.get("icon-size").evaluate(ln,{})],bc[0]>Wc&&wi(`${ui.layerIds[0]}: Value for "icon-size" is >= ${Ka}. Reduce your "icon-size".`)):er.kind==="composite"&&(bc=[WA*Ra.compositeIconSizes[0].evaluate(ln,{},ko),WA*Ra.compositeIconSizes[1].evaluate(ln,{},ko)],(bc[0]>Wc||bc[1]>Wc)&&wi(`${ui.layerIds[0]}: Value for "icon-size" is >= ${Ka}. Reduce your "icon-size".`)),ui.addSymbols(ui.icon,$c,bc,Qo,Ks,ln,P.ai.none,Qr,ya.lineStartIndex,ya.lineLength,-1,ko),fh=ui.icon.placedSymbolArray.length-1,Na&&(Xl=4*Na.length,ui.addSymbols(ui.icon,Na,bc,Qo,Ks,ln,P.ai.vertical,Qr,ya.lineStartIndex,ya.lineLength,-1,ko),Yf=ui.icon.placedSymbolArray.length-1)}const Jf=Object.keys(ys.horizontal);for(const il of Jf){const Oa=ys.horizontal[il];if(!TA){Kf=vA(Oa.text);const Na=Co.layout.get("text-rotate").evaluate(ln,{},ko);TA=new Hl(na,Qr,Xs,Hr,sa,Oa,zs,Vn,el,Na)}const $c=Oa.positionedLines.length===1;if(xa+=T0(ui,Qr,Oa,La,Co,el,ln,qo,ya,ys.vertical?P.ai.horizontal:P.ai.horizontalOnly,$c?Jf:[il],_l,fh,Ra,ko),$c)break}ys.vertical&&(hh+=T0(ui,Qr,ys.vertical,La,Co,el,ln,qo,ya,P.ai.vertical,["vertical"],_l,Yf,Ra,ko));const sm=TA?TA.boxStartIndex:ui.collisionBoxArray.length,om=TA?TA.boxEndIndex:ui.collisionBoxArray.length,am=Wl?Wl.boxStartIndex:ui.collisionBoxArray.length,Ho=Wl?Wl.boxEndIndex:ui.collisionBoxArray.length,lm=vc?vc.boxStartIndex:ui.collisionBoxArray.length,Am=vc?vc.boxEndIndex:ui.collisionBoxArray.length,cm=ml?ml.boxStartIndex:ui.collisionBoxArray.length,sg=ml?ml.boxEndIndex:ui.collisionBoxArray.length;let EA=-1;const Jh=(il,Oa)=>il&&il.circleDiameter?Math.max(il.circleDiameter,Oa):Oa;EA=Jh(TA,EA),EA=Jh(Wl,EA),EA=Jh(vc,EA),EA=Jh(ml,EA);const $h=EA>-1?1:0;$h&&(EA*=_o/zo),ui.glyphOffsetArray.length>=Uu.MAX_GLYPHS&&wi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),ln.sortKey!==void 0&&ui.addToSortKeyRanges(ui.symbolInstances.length,ln.sortKey);const um=Zf(Co,ln,ko),[og,ag]=function(il,Oa){const $c=il.length,Na=Oa==null?void 0:Oa.values;if((Na==null?void 0:Na.length)>0)for(let er=0;er<Na.length;er+=2){const bc=Na[er+1];il.emplaceBack(P.aq[Na[er]],bc[0],bc[1])}return[$c,il.length]}(ui.textAnchorOffsets,um);ui.symbolInstances.emplaceBack(Qr.x,Qr.y,_l.right>=0?_l.right:-1,_l.center>=0?_l.center:-1,_l.left>=0?_l.left:-1,_l.vertical||-1,fh,Yf,Kf,sm,om,am,Ho,lm,Am,cm,sg,Xs,xa,hh,tl,Xl,$h,0,zs,EA,og,ag)}(f,ur,ci,m,w,D,Qi,f.layers[0],f.collisionBoxArray,A.index,A.sourceLayerIndex,f.index,at,[me,me,me,me],Si,ee,Ct,Vt,tr,Oe,A,U,ae,fe,V)};if(Bi==="line")for(const ci of Ql(A.geometry,0,0,Ns,Ns)){const ur=tm(ci,bt,oi,m.vertical||ce,w,24,pt,f.overscaling,Ns);for(const ui of ur)ce&&M0(f,ce.text,ki,ui)||Ii(ci,ui)}else if(Bi==="line-center"){for(const ci of A.geometry)if(ci.length>1){const ur=em(ci,oi,m.vertical||ce,w,24,pt);ur&&Ii(ci,ur)}}else if(A.type==="Polygon")for(const ci of an(A.geometry,0)){const ur=ng(ci,16);Ii(ci[0],new Kc(ur.x,ur.y,0))}else if(A.type==="LineString")for(const ci of A.geometry)Ii(ci,new Kc(ci[0].x,ci[0].y,0));else if(A.type==="Point")for(const ci of A.geometry)for(const ur of ci)Ii([ur],new Kc(ur.x,ur.y,0))}function T0(f,A,m,w,D,U,V,Y,ee,ae,fe,_e,Se,Oe,ce){const tt=function(Ct,bt,me,Vt,oi,Si,tr,Bi){const ki=Vt.layout.get("text-rotate").evaluate(Si,{})*Math.PI/180,xi=[];for(const Qi of bt.positionedLines)for(const Ii of Qi.positionedGlyphs){if(!Ii.rect)continue;const ci=Ii.rect||{};let ur=n0+1,ui=!0,Qr=1,Ts=0;const ys=(oi||Bi)&&Ii.vertical,Io=Ii.metrics.advance*Ii.scale/2;if(Bi&&bt.verticalizable&&(Ts=Qi.lineOffset/2-(Ii.imageName?-(zo-Ii.metrics.width*Ii.scale)/2:(Ii.scale-1)*zo)),Ii.imageName){const Qo=tr[Ii.imageName];ui=Qo.sdf,Qr=Qo.pixelRatio,ur=Wn/Qr}const La=oi?[Ii.x+Io,Ii.y]:[0,0];let $a=oi?[0,0]:[Ii.x+Io+me[0],Ii.y+me[1]-Ts],Co=[0,0];ys&&(Co=$a,$a=[0,0]);const na=Ii.metrics.isDoubleResolution?2:1,Xs=(Ii.metrics.left-ur)*Ii.scale-Io+$a[0],Hr=(-Ii.metrics.top-ur)*Ii.scale+$a[1],sa=Xs+ci.w/na*Ii.scale/Qr,zs=Hr+ci.h/na*Ii.scale/Qr,Vn=new Gt(Xs,Hr),el=new Gt(sa,Hr),qo=new Gt(Xs,zs),ga=new Gt(sa,zs);if(ys){const Qo=new Gt(-Io,Io-Gh),ln=-Math.PI/2,Ra=zo/2-Io,Fa=new Gt(5-Gh-Ra,-(Ii.imageName?Ra:0)),ko=new Gt(...Co);Vn._rotateAround(ln,Qo)._add(Fa)._add(ko),el._rotateAround(ln,Qo)._add(Fa)._add(ko),qo._rotateAround(ln,Qo)._add(Fa)._add(ko),ga._rotateAround(ln,Qo)._add(Fa)._add(ko)}if(ki){const Qo=Math.sin(ki),ln=Math.cos(ki),Ra=[ln,-Qo,Qo,ln];Vn._matMult(Ra),el._matMult(Ra),qo._matMult(Ra),ga._matMult(Ra)}const Ys=new Gt(0,0),Ks=new Gt(0,0);xi.push({tl:Vn,tr:el,bl:qo,br:ga,tex:ci,writingMode:bt.writingMode,glyphOffset:La,sectionIndex:Ii.sectionIndex,isSDF:ui,pixelOffsetTL:Ys,pixelOffsetBR:Ks,minFontScaleX:0,minFontScaleY:0})}return xi}(0,m,Y,D,U,V,w,f.allowVerticalPlacement),at=f.textSizeData;let pt=null;at.kind==="source"?(pt=[WA*D.layout.get("text-size").evaluate(V,{})],pt[0]>Wc&&wi(`${f.layerIds[0]}: Value for "text-size" is >= ${Ka}. Reduce your "text-size".`)):at.kind==="composite"&&(pt=[WA*Oe.compositeTextSizes[0].evaluate(V,{},ce),WA*Oe.compositeTextSizes[1].evaluate(V,{},ce)],(pt[0]>Wc||pt[1]>Wc)&&wi(`${f.layerIds[0]}: Value for "text-size" is >= ${Ka}. Reduce your "text-size".`)),f.addSymbols(f.text,tt,pt,Y,U,V,ae,A,ee.lineStartIndex,ee.lineLength,Se,ce);for(const Ct of fe)_e[Ct]=f.text.placedSymbolArray.length-1;return 4*tt.length}function E0(f){for(const A in f)return f[A];return null}function M0(f,A,m,w){const D=f.compareText;if(A in D){const U=D[A];for(let V=U.length-1;V>=0;V--)if(w.dist(U[V])<m)return!0}else D[A]=[];return D[A].push(w),!1}const S0=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class qf{static from(A){if(!(A instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[m,w]=new Uint8Array(A,0,2);if(m!==219)throw new Error("Data does not appear to be in a KDBush format.");const D=w>>4;if(D!==1)throw new Error(`Got v${D} data when expected v1.`);const U=S0[15&w];if(!U)throw new Error("Unrecognized array type.");const[V]=new Uint16Array(A,2,1),[Y]=new Uint32Array(A,4,1);return new qf(Y,V,U,A)}constructor(A,m=64,w=Float64Array,D){if(isNaN(A)||A<0)throw new Error(`Unpexpected numItems value: ${A}.`);this.numItems=+A,this.nodeSize=Math.min(Math.max(+m,2),65535),this.ArrayType=w,this.IndexArrayType=A<65536?Uint16Array:Uint32Array;const U=S0.indexOf(this.ArrayType),V=2*A*this.ArrayType.BYTES_PER_ELEMENT,Y=A*this.IndexArrayType.BYTES_PER_ELEMENT,ee=(8-Y%8)%8;if(U<0)throw new Error(`Unexpected typed array class: ${w}.`);D&&D instanceof ArrayBuffer?(this.data=D,this.ids=new this.IndexArrayType(this.data,8,A),this.coords=new this.ArrayType(this.data,8+Y+ee,2*A),this._pos=2*A,this._finished=!0):(this.data=new ArrayBuffer(8+V+Y+ee),this.ids=new this.IndexArrayType(this.data,8,A),this.coords=new this.ArrayType(this.data,8+Y+ee,2*A),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+U]),new Uint16Array(this.data,2,1)[0]=m,new Uint32Array(this.data,4,1)[0]=A)}add(A,m){const w=this._pos>>1;return this.ids[w]=w,this.coords[this._pos++]=A,this.coords[this._pos++]=m,w}finish(){const A=this._pos>>1;if(A!==this.numItems)throw new Error(`Added ${A} items when expected ${this.numItems}.`);return Qf(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(A,m,w,D){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:U,coords:V,nodeSize:Y}=this,ee=[0,U.length-1,0],ae=[];for(;ee.length;){const fe=ee.pop()||0,_e=ee.pop()||0,Se=ee.pop()||0;if(_e-Se<=Y){for(let at=Se;at<=_e;at++){const pt=V[2*at],Ct=V[2*at+1];pt>=A&&pt<=w&&Ct>=m&&Ct<=D&&ae.push(U[at])}continue}const Oe=Se+_e>>1,ce=V[2*Oe],tt=V[2*Oe+1];ce>=A&&ce<=w&&tt>=m&&tt<=D&&ae.push(U[Oe]),(fe===0?A<=ce:m<=tt)&&(ee.push(Se),ee.push(Oe-1),ee.push(1-fe)),(fe===0?w>=ce:D>=tt)&&(ee.push(Oe+1),ee.push(_e),ee.push(1-fe))}return ae}within(A,m,w){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:D,coords:U,nodeSize:V}=this,Y=[0,D.length-1,0],ee=[],ae=w*w;for(;Y.length;){const fe=Y.pop()||0,_e=Y.pop()||0,Se=Y.pop()||0;if(_e-Se<=V){for(let at=Se;at<=_e;at++)Cr(U[2*at],U[2*at+1],A,m)<=ae&&ee.push(D[at]);continue}const Oe=Se+_e>>1,ce=U[2*Oe],tt=U[2*Oe+1];Cr(ce,tt,A,m)<=ae&&ee.push(D[Oe]),(fe===0?A-w<=ce:m-w<=tt)&&(Y.push(Se),Y.push(Oe-1),Y.push(1-fe)),(fe===0?A+w>=ce:m+w>=tt)&&(Y.push(Oe+1),Y.push(_e),Y.push(1-fe))}return ee}}function Qf(f,A,m,w,D,U){if(D-w<=m)return;const V=w+D>>1;I0(f,A,V,w,D,U),Qf(f,A,m,w,V-1,1-U),Qf(f,A,m,V+1,D,1-U)}function I0(f,A,m,w,D,U){for(;D>w;){if(D-w>600){const ae=D-w+1,fe=m-w+1,_e=Math.log(ae),Se=.5*Math.exp(2*_e/3),Oe=.5*Math.sqrt(_e*Se*(ae-Se)/ae)*(fe-ae/2<0?-1:1);I0(f,A,m,Math.max(w,Math.floor(m-fe*Se/ae+Oe)),Math.min(D,Math.floor(m+(ae-fe)*Se/ae+Oe)),U)}const V=A[2*m+U];let Y=w,ee=D;for(Ah(f,A,w,m),A[2*D+U]>V&&Ah(f,A,w,D);Y<ee;){for(Ah(f,A,Y,ee),Y++,ee--;A[2*Y+U]<V;)Y++;for(;A[2*ee+U]>V;)ee--}A[2*w+U]===V?Ah(f,A,w,ee):(ee++,Ah(f,A,ee,D)),ee<=m&&(w=ee+1),m<=ee&&(D=ee-1)}}function Ah(f,A,m,w){ch(f,m,w),ch(A,2*m,2*w),ch(A,2*m+1,2*w+1)}function ch(f,A,m){const w=f[A];f[A]=f[m],f[m]=w}function Cr(f,A,m,w){const D=f-m,U=A-w;return D*D+U*U}var Kh;P.bh=void 0,(Kh=P.bh||(P.bh={})).create="create",Kh.load="load",Kh.fullLoad="fullLoad";let xc=null,uh=[];const Hf=1e3/60,Wf="loadTime",Xf="fullLoadTime",nm={mark(f){performance.mark(f)},frame(f){const A=f;xc!=null&&uh.push(A-xc),xc=A},clearMetrics(){xc=null,uh=[],performance.clearMeasures(Wf),performance.clearMeasures(Xf);for(const f in P.bh)performance.clearMarks(P.bh[f])},getPerformanceMetrics(){performance.measure(Wf,P.bh.create,P.bh.load),performance.measure(Xf,P.bh.create,P.bh.fullLoad);const f=performance.getEntriesByName(Wf)[0].duration,A=performance.getEntriesByName(Xf)[0].duration,m=uh.length,w=1/(uh.reduce((U,V)=>U+V,0)/m/1e3),D=uh.filter(U=>U>Hf).reduce((U,V)=>U+(V-Hf)/Hf,0);return{loadTime:f,fullLoadTime:A,fps:w,percentDroppedFrames:D/(m+D)*100,totalFrames:m}}};P.$=function(f,A,m){var w,D,U,V,Y,ee,ae,fe,_e,Se,Oe,ce,tt=m[0],at=m[1],pt=m[2];return A===f?(f[12]=A[0]*tt+A[4]*at+A[8]*pt+A[12],f[13]=A[1]*tt+A[5]*at+A[9]*pt+A[13],f[14]=A[2]*tt+A[6]*at+A[10]*pt+A[14],f[15]=A[3]*tt+A[7]*at+A[11]*pt+A[15]):(D=A[1],U=A[2],V=A[3],Y=A[4],ee=A[5],ae=A[6],fe=A[7],_e=A[8],Se=A[9],Oe=A[10],ce=A[11],f[0]=w=A[0],f[1]=D,f[2]=U,f[3]=V,f[4]=Y,f[5]=ee,f[6]=ae,f[7]=fe,f[8]=_e,f[9]=Se,f[10]=Oe,f[11]=ce,f[12]=w*tt+Y*at+_e*pt+A[12],f[13]=D*tt+ee*at+Se*pt+A[13],f[14]=U*tt+ae*at+Oe*pt+A[14],f[15]=V*tt+fe*at+ce*pt+A[15]),f},P.A=Fc,P.B=sr,P.C=class{constructor(f,A,m){this.receive=w=>{const D=w.data,U=D.id;if(U&&(!D.targetMapId||this.mapId===D.targetMapId))if(D.type==="<cancel>"){delete this.tasks[U];const V=this.cancelCallbacks[U];delete this.cancelCallbacks[U],V&&V()}else Dn()||D.mustQueue?(this.tasks[U]=D,this.taskQueue.push(U),this.invoker.trigger()):this.processTask(U,D)},this.process=()=>{if(!this.taskQueue.length)return;const w=this.taskQueue.shift(),D=this.tasks[w];delete this.tasks[w],this.taskQueue.length&&this.invoker.trigger(),D&&this.processTask(w,D)},this.target=f,this.parent=A,this.mapId=m,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},this.invoker=new Yp(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Dn()?f:window}send(f,A,m,w,D=!1){const U=Math.round(1e18*Math.random()).toString(36).substring(0,10);m&&(this.callbacks[U]=m);const V=[],Y={id:U,type:f,hasCallback:!!m,targetMapId:w,mustQueue:D,sourceMapId:this.mapId,data:Wa(A,V)};return this.target.postMessage(Y,{transfer:V}),{cancel:()=>{m&&delete this.callbacks[U],this.target.postMessage({id:U,type:"<cancel>",targetMapId:w,sourceMapId:this.mapId})}}}processTask(f,A){if(A.type==="<response>"){const m=this.callbacks[f];delete this.callbacks[f],m&&(A.error?m(fl(A.error)):m(null,fl(A.data)))}else{let m=!1;const w=[],D=A.hasCallback?(Y,ee)=>{m=!0,delete this.cancelCallbacks[f];const ae={id:f,type:"<response>",sourceMapId:this.mapId,error:Y?Wa(Y):null,data:Wa(ee,w)};this.target.postMessage(ae,{transfer:w})}:Y=>{m=!0};let U=null;const V=fl(A.data);if(this.parent[A.type])U=this.parent[A.type](A.sourceMapId,V,D);else if("getWorkerSource"in this.parent){const Y=A.type.split(".");U=this.parent.getWorkerSource(A.sourceMapId,Y[0],V.source)[Y[1]](V,D)}else D(new Error(`Could not find function ${A.type}`));!m&&U&&U.cancel&&(this.cancelCallbacks[f]=U.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},P.D=Nt,P.E=He,P.F=function(f,A){const m={};for(let w=0;w<A.length;w++){const D=A[w];D in f&&(m[D]=f[D])}return m},P.G=Kp,P.H=Rr,P.I=So,P.J=Tn,P.K=un,P.L=Xc,P.M=ts,P.N=Ns,P.O=ql,P.P=Gt,P.Q=L,P.R=Cl,P.S=is,P.T=ra,P.U=Qh,P.V=class extends J{},P.W=Vf,P.X=function(f,A){const m=window.document.createElement("video");m.muted=!0,m.onloadstart=function(){A(null,m)};for(let w=0;w<f.length;w++){const D=window.document.createElement("source");Ir(f[w])||(m.crossOrigin="Anonymous"),D.src=f[w],m.appendChild(D)}return{cancel:()=>{}}},P.Y=ni,P.Z=function(){var f=new Fc(16);return Fc!=Float32Array&&(f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[11]=0,f[12]=0,f[13]=0,f[14]=0),f[0]=1,f[5]=1,f[10]=1,f[15]=1,f},P._=yt,P.a=Ao,P.a$=class extends I{},P.a0=function(f,A,m){var w=m[0],D=m[1],U=m[2];return f[0]=A[0]*w,f[1]=A[1]*w,f[2]=A[2]*w,f[3]=A[3]*w,f[4]=A[4]*D,f[5]=A[5]*D,f[6]=A[6]*D,f[7]=A[7]*D,f[8]=A[8]*U,f[9]=A[9]*U,f[10]=A[10]*U,f[11]=A[11]*U,f[12]=A[12],f[13]=A[13],f[14]=A[14],f[15]=A[15],f},P.a1=Oc,P.a2=function(){return As++},P.a3=W,P.a4=Uu,P.a5=function(){da.isLoading()||da.isLoaded()||Tl()!=="deferred"||Ds()},P.a6=Os,P.a7=lu,P.a8=Qn,P.a9=Jp,P.aA=sA,P.aB=function(f){f=f.slice();const A=Object.create(null);for(let m=0;m<f.length;m++)A[f[m].id]=f[m];for(let m=0;m<f.length;m++)"ref"in f[m]&&(f[m]=Qt(f[m],A[f[m].ref]));return f},P.aC=function(f){if(f.type==="custom")return new Xp(f);switch(f.type){case"background":return new Qp(f);case"circle":return new Mi(f);case"fill":return new du(f);case"fill-extrusion":return new Cp(f);case"heatmap":return new wp(f);case"hillshade":return new Ld(f);case"line":return new Y_(f);case"raster":return new Wp(f);case"symbol":return new oh(f)}},P.aD=fn,P.aE=function(f,A){if(!f)return[{command:ti.setStyle,args:[A]}];let m=[];try{if(!ii(f.version,A.version))return[{command:ti.setStyle,args:[A]}];ii(f.center,A.center)||m.push({command:ti.setCenter,args:[A.center]}),ii(f.zoom,A.zoom)||m.push({command:ti.setZoom,args:[A.zoom]}),ii(f.bearing,A.bearing)||m.push({command:ti.setBearing,args:[A.bearing]}),ii(f.pitch,A.pitch)||m.push({command:ti.setPitch,args:[A.pitch]}),ii(f.sprite,A.sprite)||m.push({command:ti.setSprite,args:[A.sprite]}),ii(f.glyphs,A.glyphs)||m.push({command:ti.setGlyphs,args:[A.glyphs]}),ii(f.transition,A.transition)||m.push({command:ti.setTransition,args:[A.transition]}),ii(f.light,A.light)||m.push({command:ti.setLight,args:[A.light]});const w={},D=[];(function(V,Y,ee,ae){let fe;for(fe in Y=Y||{},V=V||{})Object.prototype.hasOwnProperty.call(V,fe)&&(Object.prototype.hasOwnProperty.call(Y,fe)||Ri(fe,ee,ae));for(fe in Y)Object.prototype.hasOwnProperty.call(Y,fe)&&(Object.prototype.hasOwnProperty.call(V,fe)?ii(V[fe],Y[fe])||(V[fe].type==="geojson"&&Y[fe].type==="geojson"&&Yi(V,Y,fe)?ee.push({command:ti.setGeoJSONSourceData,args:[fe,Y[fe].data]}):Zi(fe,Y,ee,ae)):Ht(fe,Y,ee))})(f.sources,A.sources,D,w);const U=[];f.layers&&f.layers.forEach(V=>{w[V.source]?m.push({command:ti.removeLayer,args:[V.id]}):U.push(V)}),m=m.concat(D),function(V,Y,ee){Y=Y||[];const ae=(V=V||[]).map(gn),fe=Y.map(gn),_e=V.reduce(rs,{}),Se=Y.reduce(rs,{}),Oe=ae.slice(),ce=Object.create(null);let tt,at,pt,Ct,bt,me,Vt;for(tt=0,at=0;tt<ae.length;tt++)pt=ae[tt],Object.prototype.hasOwnProperty.call(Se,pt)?at++:(ee.push({command:ti.removeLayer,args:[pt]}),Oe.splice(Oe.indexOf(pt,at),1));for(tt=0,at=0;tt<fe.length;tt++)pt=fe[fe.length-1-tt],Oe[Oe.length-1-tt]!==pt&&(Object.prototype.hasOwnProperty.call(_e,pt)?(ee.push({command:ti.removeLayer,args:[pt]}),Oe.splice(Oe.lastIndexOf(pt,Oe.length-at),1)):at++,me=Oe[Oe.length-tt],ee.push({command:ti.addLayer,args:[Se[pt],me]}),Oe.splice(Oe.length-tt,0,pt),ce[pt]=!0);for(tt=0;tt<fe.length;tt++)if(pt=fe[tt],Ct=_e[pt],bt=Se[pt],!ce[pt]&&!ii(Ct,bt))if(ii(Ct.source,bt.source)&&ii(Ct["source-layer"],bt["source-layer"])&&ii(Ct.type,bt.type)){for(Vt in Yr(Ct.layout,bt.layout,ee,pt,null,ti.setLayoutProperty),Yr(Ct.paint,bt.paint,ee,pt,null,ti.setPaintProperty),ii(Ct.filter,bt.filter)||ee.push({command:ti.setFilter,args:[pt,bt.filter]}),ii(Ct.minzoom,bt.minzoom)&&ii(Ct.maxzoom,bt.maxzoom)||ee.push({command:ti.setLayerZoomRange,args:[pt,bt.minzoom,bt.maxzoom]}),Ct)Object.prototype.hasOwnProperty.call(Ct,Vt)&&Vt!=="layout"&&Vt!=="paint"&&Vt!=="filter"&&Vt!=="metadata"&&Vt!=="minzoom"&&Vt!=="maxzoom"&&(Vt.indexOf("paint.")===0?Yr(Ct[Vt],bt[Vt],ee,pt,Vt.slice(6),ti.setPaintProperty):ii(Ct[Vt],bt[Vt])||ee.push({command:ti.setLayerProperty,args:[pt,Vt,bt[Vt]]}));for(Vt in bt)Object.prototype.hasOwnProperty.call(bt,Vt)&&!Object.prototype.hasOwnProperty.call(Ct,Vt)&&Vt!=="layout"&&Vt!=="paint"&&Vt!=="filter"&&Vt!=="metadata"&&Vt!=="minzoom"&&Vt!=="maxzoom"&&(Vt.indexOf("paint.")===0?Yr(Ct[Vt],bt[Vt],ee,pt,Vt.slice(6),ti.setPaintProperty):ii(Ct[Vt],bt[Vt])||ee.push({command:ti.setLayerProperty,args:[pt,Vt,bt[Vt]]}))}else ee.push({command:ti.removeLayer,args:[pt]}),me=Oe[Oe.lastIndexOf(pt)+1],ee.push({command:ti.addLayer,args:[bt,me]})}(U,A.layers,m)}catch(w){console.warn("Unable to compute style diff:",w),m=[{command:ti.setStyle,args:[A]}]}return m},P.aF=function(f){const A=[],m=f.id;return m===void 0&&A.push({message:`layers.${m}: missing required property "id"`}),f.render===void 0&&A.push({message:`layers.${m}: missing required method "render"`}),f.renderingMode&&f.renderingMode!=="2d"&&f.renderingMode!=="3d"&&A.push({message:`layers.${m}: property "renderingMode" must be either "2d" or "3d"`}),A},P.aG=function f(A,m){if(Array.isArray(A)){if(!Array.isArray(m)||A.length!==m.length)return!1;for(let w=0;w<A.length;w++)if(!f(A[w],m[w]))return!1;return!0}if(typeof A=="object"&&A!==null&&m!==null){if(typeof m!="object"||Object.keys(A).length!==Object.keys(m).length)return!1;for(const w in A)if(!f(A[w],m[w]))return!1;return!0}return A===m},P.aH=ct,P.aI=Lt,P.aJ=oA,P.aK=function(f){return f({pluginStatus:Po,pluginURL:ka}),oA.on("pluginStateChange",f),f},P.aL=class extends Vl{constructor(f,A){super(f,A),this.current=0}set(f){this.current!==f&&(this.current=f,this.gl.uniform1i(this.location,f))}},P.aM=Xu,P.aN=class extends Vl{constructor(f,A){super(f,A),this.current=Yu}set(f){if(f[12]!==this.current[12]||f[0]!==this.current[0])return this.current=f,void this.gl.uniformMatrix4fv(this.location,!1,f);for(let A=1;A<16;A++)if(f[A]!==this.current[A]){this.current=f,this.gl.uniformMatrix4fv(this.location,!1,f);break}}},P.aO=pf,P.aP=class extends Vl{constructor(f,A){super(f,A),this.current=[0,0,0]}set(f){f[0]===this.current[0]&&f[1]===this.current[1]&&f[2]===this.current[2]||(this.current=f,this.gl.uniform3f(this.location,f[0],f[1],f[2]))}},P.aQ=class extends Vl{constructor(f,A){super(f,A),this.current=[0,0]}set(f){f[0]===this.current[0]&&f[1]===this.current[1]||(this.current=f,this.gl.uniform2f(this.location,f[0],f[1]))}},P.aR=kh,P.aS=function(f,A,m,w,D,U,V){var Y=1/(A-m),ee=1/(w-D),ae=1/(U-V);return f[0]=-2*Y,f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=-2*ee,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[10]=2*ae,f[11]=0,f[12]=(A+m)*Y,f[13]=(D+w)*ee,f[14]=(V+U)*ae,f[15]=1,f},P.aT=en,P.aU=eh,P.aV=class extends S{},P.aW=J_,P.aX=class extends F{},P.aY=function(f){return f<=1?1:Math.pow(2,Math.ceil(Math.log(f)/Math.LN2))},P.aZ=Bd,P.a_=ft,P.aa=function(f){const A={};if(f.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(m,w,D,U)=>{const V=D||U;return A[w]=!V||V.toLowerCase(),""}),A["max-age"]){const m=parseInt(A["max-age"],10);isNaN(m)?delete A["max-age"]:A["max-age"]=m}return A},P.ab=function(f,A){const m=[];for(const w in f)w in A||m.push(w);return m},P.ac=function(f){if(Rs==null){const A=f.navigator?f.navigator.userAgent:null;Rs=!!f.safari||!(!A||!(/\b(iPad|iPhone|iPod)\b/.test(A)||A.match("Safari")&&!A.match("Chrome")))}return Rs},P.ad=En,P.ae=function(f,A,m){var w=Math.sin(m),D=Math.cos(m),U=A[0],V=A[1],Y=A[2],ee=A[3],ae=A[4],fe=A[5],_e=A[6],Se=A[7];return A!==f&&(f[8]=A[8],f[9]=A[9],f[10]=A[10],f[11]=A[11],f[12]=A[12],f[13]=A[13],f[14]=A[14],f[15]=A[15]),f[0]=U*D+ae*w,f[1]=V*D+fe*w,f[2]=Y*D+_e*w,f[3]=ee*D+Se*w,f[4]=ae*D-U*w,f[5]=fe*D-V*w,f[6]=_e*D-Y*w,f[7]=Se*D-ee*w,f},P.af=function(f){var A=new Fc(16);return A[0]=f[0],A[1]=f[1],A[2]=f[2],A[3]=f[3],A[4]=f[4],A[5]=f[5],A[6]=f[6],A[7]=f[7],A[8]=f[8],A[9]=f[9],A[10]=f[10],A[11]=f[11],A[12]=f[12],A[13]=f[13],A[14]=f[14],A[15]=f[15],A},P.ag=zu,P.ah=function(f,A){let m=0,w=0;if(f.kind==="constant")w=f.layoutSize;else if(f.kind!=="source"){const{interpolationType:D,minZoom:U,maxZoom:V}=f,Y=D?En(tn.interpolationFactor(D,A,U,V),0,1):0;f.kind==="camera"?w=sr.number(f.minSize,f.maxSize,Y):m=Y}return{uSizeT:m,uSize:w}},P.aj=function(f,{uSize:A,uSizeT:m},{lowerSize:w,upperSize:D}){return f.kind==="source"?w/WA:f.kind==="composite"?sr.number(w/WA,D/WA,m):A},P.ak=Lf,P.al=function(f,A,m,w){const D=A.y-f.y,U=A.x-f.x,V=w.y-m.y,Y=w.x-m.x,ee=V*U-Y*D;if(ee===0)return null;const ae=(Y*(f.y-m.y)-V*(f.x-m.x))/ee;return new Gt(f.x+ae*U,f.y+ae*D)},P.am=Ql,P.an=Sd,P.ao=kd,P.ap=zo,P.ar=Er,P.as=function(f,A){var m=A[0],w=A[1],D=A[2],U=A[3],V=A[4],Y=A[5],ee=A[6],ae=A[7],fe=A[8],_e=A[9],Se=A[10],Oe=A[11],ce=A[12],tt=A[13],at=A[14],pt=A[15],Ct=m*Y-w*V,bt=m*ee-D*V,me=m*ae-U*V,Vt=w*ee-D*Y,oi=w*ae-U*Y,Si=D*ae-U*ee,tr=fe*tt-_e*ce,Bi=fe*at-Se*ce,ki=fe*pt-Oe*ce,xi=_e*at-Se*tt,Qi=_e*pt-Oe*tt,Ii=Se*pt-Oe*at,ci=Ct*Ii-bt*Qi+me*xi+Vt*ki-oi*Bi+Si*tr;return ci?(f[0]=(Y*Ii-ee*Qi+ae*xi)*(ci=1/ci),f[1]=(D*Qi-w*Ii-U*xi)*ci,f[2]=(tt*Si-at*oi+pt*Vt)*ci,f[3]=(Se*oi-_e*Si-Oe*Vt)*ci,f[4]=(ee*ki-V*Ii-ae*Bi)*ci,f[5]=(m*Ii-D*ki+U*Bi)*ci,f[6]=(at*me-ce*Si-pt*bt)*ci,f[7]=(fe*Si-Se*me+Oe*bt)*ci,f[8]=(V*Qi-Y*ki+ae*tr)*ci,f[9]=(w*ki-m*Qi-U*tr)*ci,f[10]=(ce*oi-tt*me+pt*Ct)*ci,f[11]=(_e*me-fe*oi-Oe*Ct)*ci,f[12]=(Y*Bi-V*xi-ee*tr)*ci,f[13]=(m*xi-w*Bi+D*tr)*ci,f[14]=(tt*bt-ce*Vt-at*Ct)*ci,f[15]=(fe*Vt-_e*bt+Se*Ct)*ci,f):null},P.at=Ja,P.au=zf,P.av=qf,P.aw=function(){const f={},A=Be.$version;for(const m in Be.$root){const w=Be.$root[m];if(w.required){let D=null;D=m==="version"?A:w.type==="array"?[]:{},D!=null&&(f[m]=D)}}return f},P.ax=ti,P.ay=ac,P.az=_n,P.b=function(f,A){const m=new Blob([new Uint8Array(f)],{type:"image/png"});createImageBitmap(m).then(w=>{A(null,w)}).catch(w=>{A(new Error(`Could not load image because of ${w.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})},P.b0=Or,P.b1=function(f,A){var m=f[0],w=f[1],D=f[2],U=f[3],V=f[4],Y=f[5],ee=f[6],ae=f[7],fe=f[8],_e=f[9],Se=f[10],Oe=f[11],ce=f[12],tt=f[13],at=f[14],pt=f[15],Ct=A[0],bt=A[1],me=A[2],Vt=A[3],oi=A[4],Si=A[5],tr=A[6],Bi=A[7],ki=A[8],xi=A[9],Qi=A[10],Ii=A[11],ci=A[12],ur=A[13],ui=A[14],Qr=A[15];return Math.abs(m-Ct)<=Ws*Math.max(1,Math.abs(m),Math.abs(Ct))&&Math.abs(w-bt)<=Ws*Math.max(1,Math.abs(w),Math.abs(bt))&&Math.abs(D-me)<=Ws*Math.max(1,Math.abs(D),Math.abs(me))&&Math.abs(U-Vt)<=Ws*Math.max(1,Math.abs(U),Math.abs(Vt))&&Math.abs(V-oi)<=Ws*Math.max(1,Math.abs(V),Math.abs(oi))&&Math.abs(Y-Si)<=Ws*Math.max(1,Math.abs(Y),Math.abs(Si))&&Math.abs(ee-tr)<=Ws*Math.max(1,Math.abs(ee),Math.abs(tr))&&Math.abs(ae-Bi)<=Ws*Math.max(1,Math.abs(ae),Math.abs(Bi))&&Math.abs(fe-ki)<=Ws*Math.max(1,Math.abs(fe),Math.abs(ki))&&Math.abs(_e-xi)<=Ws*Math.max(1,Math.abs(_e),Math.abs(xi))&&Math.abs(Se-Qi)<=Ws*Math.max(1,Math.abs(Se),Math.abs(Qi))&&Math.abs(Oe-Ii)<=Ws*Math.max(1,Math.abs(Oe),Math.abs(Ii))&&Math.abs(ce-ci)<=Ws*Math.max(1,Math.abs(ce),Math.abs(ci))&&Math.abs(tt-ur)<=Ws*Math.max(1,Math.abs(tt),Math.abs(ur))&&Math.abs(at-ui)<=Ws*Math.max(1,Math.abs(at),Math.abs(ui))&&Math.abs(pt-Qr)<=Ws*Math.max(1,Math.abs(pt),Math.abs(Qr))},P.b2=function(f,A){return f[0]=A[0],f[1]=A[1],f[2]=A[2],f[3]=A[3],f[4]=A[4],f[5]=A[5],f[6]=A[6],f[7]=A[7],f[8]=A[8],f[9]=A[9],f[10]=A[10],f[11]=A[11],f[12]=A[12],f[13]=A[13],f[14]=A[14],f[15]=A[15],f},P.b3=function(f,A,m){return f[0]=A[0]*m[0],f[1]=A[1]*m[1],f[2]=A[2]*m[2],f[3]=A[3]*m[3],f},P.b4=function(f,A){return f[0]*A[0]+f[1]*A[1]+f[2]*A[2]+f[3]*A[3]},P.b5=Ls,P.b6=p0,P.b7=Nf,P.b8=function(f,A,m,w,D){var U,V=1/Math.tan(A/2);return f[0]=V/m,f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=V,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[11]=-1,f[12]=0,f[13]=0,f[15]=0,D!=null&&D!==1/0?(f[10]=(D+w)*(U=1/(w-D)),f[14]=2*D*w*U):(f[10]=-1,f[14]=-2*w),f},P.b9=function(f,A,m){var w=Math.sin(m),D=Math.cos(m),U=A[4],V=A[5],Y=A[6],ee=A[7],ae=A[8],fe=A[9],_e=A[10],Se=A[11];return A!==f&&(f[0]=A[0],f[1]=A[1],f[2]=A[2],f[3]=A[3],f[12]=A[12],f[13]=A[13],f[14]=A[14],f[15]=A[15]),f[4]=U*D+ae*w,f[5]=V*D+fe*w,f[6]=Y*D+_e*w,f[7]=ee*D+Se*w,f[8]=ae*D-U*w,f[9]=fe*D-V*w,f[10]=_e*D-Y*w,f[11]=Se*D-ee*w,f},P.bA=li,P.bB=kf,P.bC=No,P.bD=da,P.ba=_r,P.bb=ps,P.bc=function(f,A){return f[0]=A[0],f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=A[1],f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[10]=A[2],f[11]=0,f[12]=0,f[13]=0,f[14]=0,f[15]=1,f},P.bd=class extends Q{},P.be=Of,P.bf=uA,P.bg=nm,P.bi=nr,P.bj=function(f,A,m=!1){if(Po===xA||Po===GA||Po===ZA)throw new Error("setRTLTextPlugin cannot be called multiple times.");ka=Zn.resolveURL(f),Po=xA,Ki=A,cc(),m||Ds()},P.bk=Tl,P.bl=function(f,A){const m={};for(let D=0;D<f.length;D++){const U=A&&A[f[D].id]||ta(f[D]);A&&(A[f[D].id]=U);let V=m[U];V||(V=m[U]=[]),V.push(f[D])}const w=[];for(const D in m)w.push(m[D]);return w},P.bm=Fi,P.bn=_0,P.bo=jf,P.bp=s0,P.bq=function(f){f.bucket.createArrays(),f.bucket.tilePixelRatio=Ns/(512*f.bucket.overscaling),f.bucket.compareText={},f.bucket.iconsNeedLinear=!1;const A=f.bucket.layers[0],m=A.layout,w=A._unevaluatedLayout._values,D={layoutIconSize:w["icon-size"].possiblyEvaluate(new Qn(f.bucket.zoom+1),f.canonical),layoutTextSize:w["text-size"].possiblyEvaluate(new Qn(f.bucket.zoom+1),f.canonical),textMaxSize:w["text-size"].possiblyEvaluate(new Qn(18))};if(f.bucket.textSizeData.kind==="composite"){const{minZoom:ae,maxZoom:fe}=f.bucket.textSizeData;D.compositeTextSizes=[w["text-size"].possiblyEvaluate(new Qn(ae),f.canonical),w["text-size"].possiblyEvaluate(new Qn(fe),f.canonical)]}if(f.bucket.iconSizeData.kind==="composite"){const{minZoom:ae,maxZoom:fe}=f.bucket.iconSizeData;D.compositeIconSizes=[w["icon-size"].possiblyEvaluate(new Qn(ae),f.canonical),w["icon-size"].possiblyEvaluate(new Qn(fe),f.canonical)]}const U=m.get("text-line-height")*zo,V=m.get("text-rotation-alignment")!=="viewport"&&m.get("symbol-placement")!=="point",Y=m.get("text-keep-upright"),ee=m.get("text-size");for(const ae of f.bucket.features){const fe=m.get("text-font").evaluate(ae,{},f.canonical).join(","),_e=ee.evaluate(ae,{},f.canonical),Se=D.layoutTextSize.evaluate(ae,{},f.canonical),Oe=D.layoutIconSize.evaluate(ae,{},f.canonical),ce={horizontal:{},vertical:void 0},tt=ae.text;let at,pt=[0,0];if(tt){const me=tt.toString(),Vt=m.get("text-letter-spacing").evaluate(ae,{},f.canonical)*zo,oi=VA(me)?Vt:0,Si=m.get("text-anchor").evaluate(ae,{},f.canonical),tr=Zf(A,ae,f.canonical);if(!tr){const Ii=m.get("text-radial-offset").evaluate(ae,{},f.canonical);pt=Ii?Gr(Si,[Ii*zo,w0]):m.get("text-offset").evaluate(ae,{},f.canonical).map(ci=>ci*zo)}let Bi=V?"center":m.get("text-justify").evaluate(ae,{},f.canonical);const ki=m.get("symbol-placement"),xi=ki==="point"?m.get("text-max-width").evaluate(ae,{},f.canonical)*zo:0,Qi=()=>{f.bucket.allowVerticalPlacement&&nA(me)&&(ce.vertical=sh(tt,f.glyphMap,f.glyphPositions,f.imagePositions,fe,xi,U,Si,"left",oi,pt,P.ai.vertical,!0,ki,Se,_e))};if(!V&&tr){const Ii=new Set;if(Bi==="auto")for(let ur=0;ur<tr.values.length;ur+=2)Ii.add(Ja(tr.values[ur]));else Ii.add(Bi);let ci=!1;for(const ur of Ii)if(!ce.horizontal[ur])if(ci)ce.horizontal[ur]=ce.horizontal[0];else{const ui=sh(tt,f.glyphMap,f.glyphPositions,f.imagePositions,fe,xi,U,"center",ur,oi,pt,P.ai.horizontal,!1,ki,Se,_e);ui&&(ce.horizontal[ur]=ui,ci=ui.positionedLines.length===1)}Qi()}else{Bi==="auto"&&(Bi=Ja(Si));const Ii=sh(tt,f.glyphMap,f.glyphPositions,f.imagePositions,fe,xi,U,Si,Bi,oi,pt,P.ai.horizontal,!1,ki,Se,_e);Ii&&(ce.horizontal[Bi]=Ii),Qi(),nA(me)&&V&&Y&&(ce.vertical=sh(tt,f.glyphMap,f.glyphPositions,f.imagePositions,fe,xi,U,Si,Bi,oi,pt,P.ai.vertical,!1,ki,Se,_e))}}let Ct=!1;if(ae.icon&&ae.icon.name){const me=f.imageMap[ae.icon.name];me&&(at=Fn(f.imagePositions[ae.icon.name],m.get("icon-offset").evaluate(ae,{},f.canonical),m.get("icon-anchor").evaluate(ae,{},f.canonical)),Ct=!!me.sdf,f.bucket.sdfIcons===void 0?f.bucket.sdfIcons=Ct:f.bucket.sdfIcons!==Ct&&wi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(me.pixelRatio!==f.bucket.pixelRatio||m.get("icon-rotate").constantOr(1)!==0)&&(f.bucket.iconsNeedLinear=!0))}const bt=E0(ce.horizontal)||ce.vertical;f.bucket.iconsInText=!!bt&&bt.iconsInText,(bt||at)&&Jc(f.bucket,ae,ce,at,f.imageMap,D,Se,Oe,pt,Ct,f.canonical)}f.showCollisionBoxes&&f.bucket.generateCollisionDebugBuffers()},P.br=If,P.bs=Uc,P.bt=Zc,P.bu=class{constructor(f){this._marks={start:[f.url,"start"].join("#"),end:[f.url,"end"].join("#"),measure:f.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let f=performance.getEntriesByName(this._marks.measure);return f.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),f=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),f}},P.bv=_c,P.bw=pc,P.bx=function(f,A,m,w,D){return yt(this,void 0,void 0,function*(){if(un())try{return yield ts(f,A,m,w,D)}catch{}return function(U,V,Y,ee,ae){const fe=U.width,_e=U.height;Ai&&jr||(Ai=new OffscreenCanvas(fe,_e),jr=Ai.getContext("2d",{willReadFrequently:!0})),Ai.width=fe,Ai.height=_e,jr.drawImage(U,0,0,fe,_e);const Se=jr.getImageData(V,Y,ee,ae);return jr.clearRect(0,0,fe,_e),Se.data}(f,A,m,w,D)})},P.by=m0,P.bz=Ee,P.c=Pt,P.d=function(f,A){const m=new Image;m.onload=()=>{A(null,m),URL.revokeObjectURL(m.src),m.onload=null,window.requestAnimationFrame(()=>{m.src=yo})},m.onerror=()=>A(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const w=new Blob([new Uint8Array(f)],{type:"image/png"});m.src=f.byteLength?URL.createObjectURL(w):yo},P.e=pn,P.f=function(f,A){return Yo(pn(f,{type:"json"}),A)},P.g=cs,P.h=Zn,P.i=Dn,P.j=Ue,P.k=Zt,P.l=Di,P.m=Yo,P.n=function(f){return new _c(f).readFields(tg,[])},P.o=function(f,A,m){if(!f.length)return m(null,[]);let w=f.length;const D=new Array(f.length);let U=null;f.forEach((V,Y)=>{A(V,(ee,ae)=>{ee&&(U=ee),D[Y]=ae,--w==0&&m(U,D)})})},P.p=kl,P.q=zh,P.r=$r,P.s=Ir,P.t=ku,P.u=Ei,P.v=Be,P.w=wi,P.x=rA,P.y=wl,P.z=function([f,A,m]){return A+=90,A*=Math.PI/180,m*=Math.PI/180,{x:f*Math.cos(A)*Math.sin(m),y:f*Math.sin(A)*Math.sin(m),z:f*Math.cos(m)}}}),Ye(["./shared"],function(P){class yt{constructor(Ae){this.keyCache={},Ae&&this.replace(Ae)}replace(Ae){this._layerConfigs={},this._layers={},this.update(Ae,[])}update(Ae,pe){for(const Le of Ae){this._layerConfigs[Le.id]=Le;const Ne=this._layers[Le.id]=P.aC(Le);Ne._featureFilter=P.a6(Ne.filter),this.keyCache[Le.id]&&delete this.keyCache[Le.id]}for(const Le of pe)delete this.keyCache[Le],delete this._layerConfigs[Le],delete this._layers[Le];this.familiesBySource={};const Me=P.bl(Object.values(this._layerConfigs),this.keyCache);for(const Le of Me){const Ne=Le.map(xe=>this._layers[xe.id]),$e=Ne[0];if($e.visibility==="none")continue;const Qe=$e.source||"";let Ge=this.familiesBySource[Qe];Ge||(Ge=this.familiesBySource[Qe]={});const We=$e.sourceLayer||"_geojsonTileLayer";let Et=Ge[We];Et||(Et=Ge[We]=[]),Et.push(Ne)}}}class Ee{constructor(Ae){const pe={},Me=[];for(const Qe in Ae){const Ge=Ae[Qe],We=pe[Qe]={};for(const Et in Ge){const xe=Ge[+Et];if(!xe||xe.bitmap.width===0||xe.bitmap.height===0)continue;const Ie={x:0,y:0,w:xe.bitmap.width+2,h:xe.bitmap.height+2};Me.push(Ie),We[Et]={rect:Ie,metrics:xe.metrics}}}const{w:Le,h:Ne}=P.p(Me),$e=new P.q({width:Le||1,height:Ne||1});for(const Qe in Ae){const Ge=Ae[Qe];for(const We in Ge){const Et=Ge[+We];if(!Et||Et.bitmap.width===0||Et.bitmap.height===0)continue;const xe=pe[Qe][We].rect;P.q.copy(Et.bitmap,$e,{x:0,y:0},{x:xe.x+1,y:xe.y+1},Et.bitmap)}}this.image=$e,this.positions=pe}}P.bm("GlyphAtlas",Ee);class li{constructor(Ae){this.tileID=new P.O(Ae.tileID.overscaledZ,Ae.tileID.wrap,Ae.tileID.canonical.z,Ae.tileID.canonical.x,Ae.tileID.canonical.y),this.uid=Ae.uid,this.zoom=Ae.zoom,this.pixelRatio=Ae.pixelRatio,this.tileSize=Ae.tileSize,this.source=Ae.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Ae.showCollisionBoxes,this.collectResourceTiming=!!Ae.collectResourceTiming,this.returnDependencies=!!Ae.returnDependencies,this.promoteId=Ae.promoteId,this.inFlightDependencies=[],this.dependencySentinel=-1}parse(Ae,pe,Me,Le,Ne){this.status="parsing",this.data=Ae,this.collisionBoxArray=new P.a3;const $e=new P.bn(Object.keys(Ae.layers).sort()),Qe=new P.bo(this.tileID,this.promoteId);Qe.bucketLayerIDs=[];const Ge={},We={featureIndex:Qe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:Me},Et=pe.familiesBySource[this.source];for(const si in Et){const hi=Ae.layers[si];if(!hi)continue;hi.version===1&&P.w(`Vector tile source "${this.source}" layer "${si}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const gr=$e.encode(si),yi=[];for(let Pi=0;Pi<hi.length;Pi++){const hn=hi.feature(Pi),eo=Qe.getId(hn,si);yi.push({feature:hn,id:eo,index:Pi,sourceLayerIndex:gr})}for(const Pi of Et[si]){const hn=Pi[0];hn.source!==this.source&&P.w(`layer.source = ${hn.source} does not equal this.source = ${this.source}`),hn.minzoom&&this.zoom<Math.floor(hn.minzoom)||hn.maxzoom&&this.zoom>=hn.maxzoom||hn.visibility!=="none"&&(Ot(Pi,this.zoom,Me),(Ge[hn.id]=hn.createBucket({index:Qe.bucketLayerIDs.length,layers:Pi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:gr,sourceID:this.source})).populate(yi,We,this.tileID.canonical),Qe.bucketLayerIDs.push(Pi.map(eo=>eo.id)))}}let xe,Ie,ut,zt;const o=P.aH(We.glyphDependencies,si=>Object.keys(si).map(Number));this.inFlightDependencies.forEach(si=>si==null?void 0:si.cancel()),this.inFlightDependencies=[];const oe=++this.dependencySentinel;Object.keys(o).length?this.inFlightDependencies.push(Le.send("getGlyphs",{uid:this.uid,stacks:o,source:this.source,tileID:this.tileID,type:"glyphs"},(si,hi)=>{oe===this.dependencySentinel&&(xe||(xe=si,Ie=hi,mi.call(this)))})):Ie={};const $t=Object.keys(We.iconDependencies);$t.length?this.inFlightDependencies.push(Le.send("getImages",{icons:$t,source:this.source,tileID:this.tileID,type:"icons"},(si,hi)=>{oe===this.dependencySentinel&&(xe||(xe=si,ut=hi,mi.call(this)))})):ut={};const _i=Object.keys(We.patternDependencies);function mi(){if(xe)return Ne(xe);if(Ie&&ut&&zt){const si=new Ee(Ie),hi=new P.bp(ut,zt);for(const gr in Ge){const yi=Ge[gr];yi instanceof P.a4?(Ot(yi.layers,this.zoom,Me),P.bq({bucket:yi,glyphMap:Ie,glyphPositions:si.positions,imageMap:ut,imagePositions:hi.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):yi.hasPattern&&(yi instanceof P.br||yi instanceof P.bs||yi instanceof P.bt)&&(Ot(yi.layers,this.zoom,Me),yi.addFeatures(We,this.tileID.canonical,hi.patternPositions))}this.status="done",Ne(null,{buckets:Object.values(Ge).filter(gr=>!gr.isEmpty()),featureIndex:Qe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:si.image,imageAtlas:hi,glyphMap:this.returnDependencies?Ie:null,iconMap:this.returnDependencies?ut:null,glyphPositions:this.returnDependencies?si.positions:null})}}_i.length?this.inFlightDependencies.push(Le.send("getImages",{icons:_i,source:this.source,tileID:this.tileID,type:"patterns"},(si,hi)=>{oe===this.dependencySentinel&&(xe||(xe=si,zt=hi,mi.call(this)))})):zt={},mi.call(this)}}function Ot(we,Ae,pe){const Me=new P.a8(Ae);for(const Le of we)Le.recalculate(Me,pe)}function Gt(we,Ae){const pe=P.l(we.request,(Me,Le,Ne,$e)=>{if(Me)Ae(Me);else if(Le)try{const Qe=new P.bw.VectorTile(new P.bv(Le));Ae(null,{vectorTile:Qe,rawData:Le,cacheControl:Ne,expires:$e})}catch(Qe){const Ge=new Uint8Array(Le);let We=`Unable to parse the tile at ${we.request.url}, `;We+=Ge[0]===31&&Ge[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${Qe.messge}`,Ae(new Error(We))}});return()=>{pe.cancel(),Ae()}}class Xr{constructor(Ae,pe,Me,Le){this.actor=Ae,this.layerIndex=pe,this.availableImages=Me,this.loadVectorData=Le||Gt,this.fetching={},this.loading={},this.loaded={}}loadTile(Ae,pe){const Me=Ae.uid;this.loading||(this.loading={});const Le=!!(Ae&&Ae.request&&Ae.request.collectResourceTiming)&&new P.bu(Ae.request),Ne=this.loading[Me]=new li(Ae);Ne.abort=this.loadVectorData(Ae,($e,Qe)=>{if(delete this.loading[Me],$e||!Qe)return Ne.status="done",this.loaded[Me]=Ne,pe($e);const Ge=Qe.rawData,We={};Qe.expires&&(We.expires=Qe.expires),Qe.cacheControl&&(We.cacheControl=Qe.cacheControl);const Et={};if(Le){const xe=Le.finish();xe&&(Et.resourceTiming=JSON.parse(JSON.stringify(xe)))}Ne.vectorTile=Qe.vectorTile,Ne.parse(Qe.vectorTile,this.layerIndex,this.availableImages,this.actor,(xe,Ie)=>{if(delete this.fetching[Me],xe||!Ie)return pe(xe);pe(null,P.e({rawTileData:Ge.slice(0)},Ie,We,Et))}),this.loaded=this.loaded||{},this.loaded[Me]=Ne,this.fetching[Me]={rawTileData:Ge,cacheControl:We,resourceTiming:Et}})}reloadTile(Ae,pe){const Me=this.loaded,Le=Ae.uid;if(Me&&Me[Le]){const Ne=Me[Le];Ne.showCollisionBoxes=Ae.showCollisionBoxes,Ne.status==="parsing"?Ne.parse(Ne.vectorTile,this.layerIndex,this.availableImages,this.actor,($e,Qe)=>{if($e||!Qe)return pe($e,Qe);let Ge;if(this.fetching[Le]){const{rawTileData:We,cacheControl:Et,resourceTiming:xe}=this.fetching[Le];delete this.fetching[Le],Ge=P.e({rawTileData:We.slice(0)},Qe,Et,xe)}else Ge=Qe;pe(null,Ge)}):Ne.status==="done"&&(Ne.vectorTile?Ne.parse(Ne.vectorTile,this.layerIndex,this.availableImages,this.actor,pe):pe())}}abortTile(Ae,pe){const Me=this.loading,Le=Ae.uid;Me&&Me[Le]&&Me[Le].abort&&(Me[Le].abort(),delete Me[Le]),pe()}removeTile(Ae,pe){const Me=this.loaded,Le=Ae.uid;Me&&Me[Le]&&delete Me[Le],pe()}}class Ti{constructor(){this.loaded={}}loadTile(Ae,pe){return P._(this,void 0,void 0,function*(){const{uid:Me,encoding:Le,rawImageData:Ne,redFactor:$e,greenFactor:Qe,blueFactor:Ge,baseShift:We}=Ae,Et=Ne.width+2,xe=Ne.height+2,Ie=P.a(Ne)?new P.R({width:Et,height:xe},yield P.bx(Ne,-1,-1,Et,xe)):Ne,ut=new P.by(Me,Ie,Le,$e,Qe,Ge,We);this.loaded=this.loaded||{},this.loaded[Me]=ut,pe(null,ut)})}removeTile(Ae){const pe=this.loaded,Me=Ae.uid;pe&&pe[Me]&&delete pe[Me]}}function cn(we,Ae){if(we.length!==0){qr(we[0],Ae);for(var pe=1;pe<we.length;pe++)qr(we[pe],!Ae)}}function qr(we,Ae){for(var pe=0,Me=0,Le=0,Ne=we.length,$e=Ne-1;Le<Ne;$e=Le++){var Qe=(we[Le][0]-we[$e][0])*(we[$e][1]+we[Le][1]),Ge=pe+Qe;Me+=Math.abs(pe)>=Math.abs(Qe)?pe-Ge+Qe:Qe-Ge+pe,pe=Ge}pe+Me>=0!=!!Ae&&we.reverse()}var dr=P.bz(function we(Ae,pe){var Me,Le=Ae&&Ae.type;if(Le==="FeatureCollection")for(Me=0;Me<Ae.features.length;Me++)we(Ae.features[Me],pe);else if(Le==="GeometryCollection")for(Me=0;Me<Ae.geometries.length;Me++)we(Ae.geometries[Me],pe);else if(Le==="Feature")we(Ae.geometry,pe);else if(Le==="Polygon")cn(Ae.coordinates,pe);else if(Le==="MultiPolygon")for(Me=0;Me<Ae.coordinates.length;Me++)cn(Ae.coordinates[Me],pe);return Ae});const Tn=P.bw.VectorTileFeature.prototype.toGeoJSON;var un={exports:{}},_r=P.bA,ps=P.bw.VectorTileFeature,En=Ls;function Ls(we,Ae){this.options=Ae||{},this.features=we,this.length=we.length}function pn(we,Ae){this.id=typeof we.id=="number"?we.id:void 0,this.type=we.type,this.rawGeometry=we.type===1?[we.geometry]:we.geometry,this.properties=we.tags,this.extent=Ae||4096}Ls.prototype.feature=function(we){return new pn(this.features[we],this.options.extent)},pn.prototype.loadGeometry=function(){var we=this.rawGeometry;this.geometry=[];for(var Ae=0;Ae<we.length;Ae++){for(var pe=we[Ae],Me=[],Le=0;Le<pe.length;Le++)Me.push(new _r(pe[Le][0],pe[Le][1]));this.geometry.push(Me)}return this.geometry},pn.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var we=this.geometry,Ae=1/0,pe=-1/0,Me=1/0,Le=-1/0,Ne=0;Ne<we.length;Ne++)for(var $e=we[Ne],Qe=0;Qe<$e.length;Qe++){var Ge=$e[Qe];Ae=Math.min(Ae,Ge.x),pe=Math.max(pe,Ge.x),Me=Math.min(Me,Ge.y),Le=Math.max(Le,Ge.y)}return[Ae,Me,pe,Le]},pn.prototype.toGeoJSON=ps.prototype.toGeoJSON;var As=P.bB,ct=En;function Lt(we){var Ae=new As;return function(pe,Me){for(var Le in pe.layers)Me.writeMessage(3,fn,pe.layers[Le])}(we,Ae),Ae.finish()}function fn(we,Ae){var pe;Ae.writeVarintField(15,we.version||1),Ae.writeStringField(1,we.name||""),Ae.writeVarintField(5,we.extent||4096);var Me={keys:[],values:[],keycache:{},valuecache:{}};for(pe=0;pe<we.length;pe++)Me.feature=we.feature(pe),Ae.writeMessage(2,mn,Me);var Le=Me.keys;for(pe=0;pe<Le.length;pe++)Ae.writeStringField(3,Le[pe]);var Ne=Me.values;for(pe=0;pe<Ne.length;pe++)Ae.writeMessage(4,Rs,Ne[pe])}function mn(we,Ae){var pe=we.feature;pe.id!==void 0&&Ae.writeVarintField(1,pe.id),Ae.writeMessage(2,wi,we),Ae.writeVarintField(3,pe.type),Ae.writeMessage(4,Dn,pe)}function wi(we,Ae){var pe=we.feature,Me=we.keys,Le=we.values,Ne=we.keycache,$e=we.valuecache;for(var Qe in pe.properties){var Ge=pe.properties[Qe],We=Ne[Qe];if(Ge!==null){We===void 0&&(Me.push(Qe),Ne[Qe]=We=Me.length-1),Ae.writeVarint(We);var Et=typeof Ge;Et!=="string"&&Et!=="boolean"&&Et!=="number"&&(Ge=JSON.stringify(Ge));var xe=Et+":"+Ge,Ie=$e[xe];Ie===void 0&&(Le.push(Ge),$e[xe]=Ie=Le.length-1),Ae.writeVarint(Ie)}}}function hr(we,Ae){return(Ae<<3)+(7&we)}function kn(we){return we<<1^we>>31}function Dn(we,Ae){for(var pe=we.loadGeometry(),Me=we.type,Le=0,Ne=0,$e=pe.length,Qe=0;Qe<$e;Qe++){var Ge=pe[Qe],We=1;Me===1&&(We=Ge.length),Ae.writeVarint(hr(1,We));for(var Et=Me===3?Ge.length-1:Ge.length,xe=0;xe<Et;xe++){xe===1&&Me!==1&&Ae.writeVarint(hr(2,Et-1));var Ie=Ge[xe].x-Le,ut=Ge[xe].y-Ne;Ae.writeVarint(kn(Ie)),Ae.writeVarint(kn(ut)),Le+=Ie,Ne+=ut}Me===3&&Ae.writeVarint(hr(7,1))}}function Rs(we,Ae){var pe=typeof we;pe==="string"?Ae.writeStringField(1,we):pe==="boolean"?Ae.writeBooleanField(7,we):pe==="number"&&(we%1!=0?Ae.writeDoubleField(3,we):we<0?Ae.writeSVarintField(6,we):Ae.writeVarintField(5,we))}un.exports=Lt,un.exports.fromVectorTileJs=Lt,un.exports.fromGeojsonVt=function(we,Ae){Ae=Ae||{};var pe={};for(var Me in we)pe[Me]=new ct(we[Me].features,Ae),pe[Me].name=Me,pe[Me].version=Ae.version,pe[Me].extent=Ae.extent;return Lt({layers:pe})},un.exports.GeoJSONWrapper=ct;var Ao=P.bz(un.exports);const yo={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:we=>we},ts=Math.fround||(Ai=new Float32Array(1),we=>(Ai[0]=+we,Ai[0]));var Ai;const jr=3,Pn=5,Js=6;class Zn{constructor(Ae){this.options=Object.assign(Object.create(yo),Ae),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Ae){const{log:pe,minZoom:Me,maxZoom:Le}=this.options;pe&&console.time("total time");const Ne=`prepare ${Ae.length} points`;pe&&console.time(Ne),this.points=Ae;const $e=[];for(let Ge=0;Ge<Ae.length;Ge++){const We=Ae[Ge];if(!We.geometry)continue;const[Et,xe]=We.geometry.coordinates,Ie=ts(_n(Et)),ut=ts(cs(xe));$e.push(Ie,ut,1/0,Ge,-1,1),this.options.reduce&&$e.push(0)}let Qe=this.trees[Le+1]=this._createTree($e);pe&&console.timeEnd(Ne);for(let Ge=Le;Ge>=Me;Ge--){const We=+Date.now();Qe=this.trees[Ge]=this._createTree(this._cluster(Qe,Ge)),pe&&console.log("z%d: %d clusters in %dms",Ge,Qe.numItems,+Date.now()-We)}return pe&&console.timeEnd("total time"),this}getClusters(Ae,pe){let Me=((Ae[0]+180)%360+360)%360-180;const Le=Math.max(-90,Math.min(90,Ae[1]));let Ne=Ae[2]===180?180:((Ae[2]+180)%360+360)%360-180;const $e=Math.max(-90,Math.min(90,Ae[3]));if(Ae[2]-Ae[0]>=360)Me=-180,Ne=180;else if(Me>Ne){const xe=this.getClusters([Me,Le,180,$e],pe),Ie=this.getClusters([-180,Le,Ne,$e],pe);return xe.concat(Ie)}const Qe=this.trees[this._limitZoom(pe)],Ge=Qe.range(_n(Me),cs($e),_n(Ne),cs(Le)),We=Qe.data,Et=[];for(const xe of Ge){const Ie=this.stride*xe;Et.push(We[Ie+Pn]>1?Pt(We,Ie,this.clusterProps):this.points[We[Ie+jr]])}return Et}getChildren(Ae){const pe=this._getOriginId(Ae),Me=this._getOriginZoom(Ae),Le="No cluster with the specified id.",Ne=this.trees[Me];if(!Ne)throw new Error(Le);const $e=Ne.data;if(pe*this.stride>=$e.length)throw new Error(Le);const Qe=this.options.radius/(this.options.extent*Math.pow(2,Me-1)),Ge=Ne.within($e[pe*this.stride],$e[pe*this.stride+1],Qe),We=[];for(const Et of Ge){const xe=Et*this.stride;$e[xe+4]===Ae&&We.push($e[xe+Pn]>1?Pt($e,xe,this.clusterProps):this.points[$e[xe+jr]])}if(We.length===0)throw new Error(Le);return We}getLeaves(Ae,pe,Me){const Le=[];return this._appendLeaves(Le,Ae,pe=pe||10,Me=Me||0,0),Le}getTile(Ae,pe,Me){const Le=this.trees[this._limitZoom(Ae)],Ne=Math.pow(2,Ae),{extent:$e,radius:Qe}=this.options,Ge=Qe/$e,We=(Me-Ge)/Ne,Et=(Me+1+Ge)/Ne,xe={features:[]};return this._addTileFeatures(Le.range((pe-Ge)/Ne,We,(pe+1+Ge)/Ne,Et),Le.data,pe,Me,Ne,xe),pe===0&&this._addTileFeatures(Le.range(1-Ge/Ne,We,1,Et),Le.data,Ne,Me,Ne,xe),pe===Ne-1&&this._addTileFeatures(Le.range(0,We,Ge/Ne,Et),Le.data,-1,Me,Ne,xe),xe.features.length?xe:null}getClusterExpansionZoom(Ae){let pe=this._getOriginZoom(Ae)-1;for(;pe<=this.options.maxZoom;){const Me=this.getChildren(Ae);if(pe++,Me.length!==1)break;Ae=Me[0].properties.cluster_id}return pe}_appendLeaves(Ae,pe,Me,Le,Ne){const $e=this.getChildren(pe);for(const Qe of $e){const Ge=Qe.properties;if(Ge&&Ge.cluster?Ne+Ge.point_count<=Le?Ne+=Ge.point_count:Ne=this._appendLeaves(Ae,Ge.cluster_id,Me,Le,Ne):Ne<Le?Ne++:Ae.push(Qe),Ae.length===Me)break}return Ne}_createTree(Ae){const pe=new P.av(Ae.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Me=0;Me<Ae.length;Me+=this.stride)pe.add(Ae[Me],Ae[Me+1]);return pe.finish(),pe.data=Ae,pe}_addTileFeatures(Ae,pe,Me,Le,Ne,$e){for(const Qe of Ae){const Ge=Qe*this.stride,We=pe[Ge+Pn]>1;let Et,xe,Ie;if(We)Et=nr(pe,Ge,this.clusterProps),xe=pe[Ge],Ie=pe[Ge+1];else{const o=this.points[pe[Ge+jr]];Et=o.properties;const[oe,$t]=o.geometry.coordinates;xe=_n(oe),Ie=cs($t)}const ut={type:1,geometry:[[Math.round(this.options.extent*(xe*Ne-Me)),Math.round(this.options.extent*(Ie*Ne-Le))]],tags:Et};let zt;zt=We||this.options.generateId?pe[Ge+jr]:this.points[pe[Ge+jr]].id,zt!==void 0&&(ut.id=zt),$e.features.push(ut)}}_limitZoom(Ae){return Math.max(this.options.minZoom,Math.min(Math.floor(+Ae),this.options.maxZoom+1))}_cluster(Ae,pe){const{radius:Me,extent:Le,reduce:Ne,minPoints:$e}=this.options,Qe=Me/(Le*Math.pow(2,pe)),Ge=Ae.data,We=[],Et=this.stride;for(let xe=0;xe<Ge.length;xe+=Et){if(Ge[xe+2]<=pe)continue;Ge[xe+2]=pe;const Ie=Ge[xe],ut=Ge[xe+1],zt=Ae.within(Ge[xe],Ge[xe+1],Qe),o=Ge[xe+Pn];let oe=o;for(const $t of zt){const _i=$t*Et;Ge[_i+2]>pe&&(oe+=Ge[_i+Pn])}if(oe>o&&oe>=$e){let $t,_i=Ie*o,mi=ut*o,si=-1;const hi=((xe/Et|0)<<5)+(pe+1)+this.points.length;for(const gr of zt){const yi=gr*Et;if(Ge[yi+2]<=pe)continue;Ge[yi+2]=pe;const Pi=Ge[yi+Pn];_i+=Ge[yi]*Pi,mi+=Ge[yi+1]*Pi,Ge[yi+4]=hi,Ne&&($t||($t=this._map(Ge,xe,!0),si=this.clusterProps.length,this.clusterProps.push($t)),Ne($t,this._map(Ge,yi)))}Ge[xe+4]=hi,We.push(_i/oe,mi/oe,1/0,hi,-1,oe),Ne&&We.push(si)}else{for(let $t=0;$t<Et;$t++)We.push(Ge[xe+$t]);if(oe>1)for(const $t of zt){const _i=$t*Et;if(!(Ge[_i+2]<=pe)){Ge[_i+2]=pe;for(let mi=0;mi<Et;mi++)We.push(Ge[_i+mi])}}}}return We}_getOriginId(Ae){return Ae-this.points.length>>5}_getOriginZoom(Ae){return(Ae-this.points.length)%32}_map(Ae,pe,Me){if(Ae[pe+Pn]>1){const $e=this.clusterProps[Ae[pe+Js]];return Me?Object.assign({},$e):$e}const Le=this.points[Ae[pe+jr]].properties,Ne=this.options.map(Le);return Me&&Ne===Le?Object.assign({},Ne):Ne}}function Pt(we,Ae,pe){return{type:"Feature",id:we[Ae+jr],properties:nr(we,Ae,pe),geometry:{type:"Point",coordinates:[(Me=we[Ae],360*(Me-.5)),aa(we[Ae+1])]}};var Me}function nr(we,Ae,pe){const Me=we[Ae+Pn],Le=Me>=1e4?`${Math.round(Me/1e3)}k`:Me>=1e3?Math.round(Me/100)/10+"k":Me,Ne=we[Ae+Js],$e=Ne===-1?{}:Object.assign({},pe[Ne]);return Object.assign($e,{cluster:!0,cluster_id:we[Ae+jr],point_count:Me,point_count_abbreviated:Le})}function _n(we){return we/360+.5}function cs(we){const Ae=Math.sin(we*Math.PI/180),pe=.5-.25*Math.log((1+Ae)/(1-Ae))/Math.PI;return pe<0?0:pe>1?1:pe}function aa(we){const Ae=(180-360*we)*Math.PI/180;return 360*Math.atan(Math.exp(Ae))/Math.PI-90}function Yo(we,Ae,pe,Me){for(var Le,Ne=Me,$e=pe-Ae>>1,Qe=pe-Ae,Ge=we[Ae],We=we[Ae+1],Et=we[pe],xe=we[pe+1],Ie=Ae+3;Ie<pe;Ie+=3){var ut=Di(we[Ie],we[Ie+1],Ge,We,Et,xe);if(ut>Ne)Le=Ie,Ne=ut;else if(ut===Ne){var zt=Math.abs(Ie-$e);zt<Qe&&(Le=Ie,Qe=zt)}}Ne>Me&&(Le-Ae>3&&Yo(we,Ae,Le,Me),we[Le+2]=Ne,pe-Le>3&&Yo(we,Le,pe,Me))}function Di(we,Ae,pe,Me,Le,Ne){var $e=Le-pe,Qe=Ne-Me;if($e!==0||Qe!==0){var Ge=((we-pe)*$e+(Ae-Me)*Qe)/($e*$e+Qe*Qe);Ge>1?(pe=Le,Me=Ne):Ge>0&&(pe+=$e*Ge,Me+=Qe*Ge)}return($e=we-pe)*$e+(Qe=Ae-Me)*Qe}function Ir(we,Ae,pe,Me){var Le={id:we===void 0?null:we,type:Ae,geometry:pe,tags:Me,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ne){var $e=Ne.geometry,Qe=Ne.type;if(Qe==="Point"||Qe==="MultiPoint"||Qe==="LineString")$s(Ne,$e);else if(Qe==="Polygon"||Qe==="MultiLineString")for(var Ge=0;Ge<$e.length;Ge++)$s(Ne,$e[Ge]);else if(Qe==="MultiPolygon")for(Ge=0;Ge<$e.length;Ge++)for(var We=0;We<$e[Ge].length;We++)$s(Ne,$e[Ge][We])}(Le),Le}function $s(we,Ae){for(var pe=0;pe<Ae.length;pe+=3)we.minX=Math.min(we.minX,Ae[pe]),we.minY=Math.min(we.minY,Ae[pe+1]),we.maxX=Math.max(we.maxX,Ae[pe]),we.maxY=Math.max(we.maxY,Ae[pe+1])}function Cs(we,Ae,pe,Me){if(Ae.geometry){var Le=Ae.geometry.coordinates,Ne=Ae.geometry.type,$e=Math.pow(pe.tolerance/((1<<pe.maxZoom)*pe.extent),2),Qe=[],Ge=Ae.id;if(pe.promoteId?Ge=Ae.properties[pe.promoteId]:pe.generateId&&(Ge=Me||0),Ne==="Point")Zt(Le,Qe);else if(Ne==="MultiPoint")for(var We=0;We<Le.length;We++)Zt(Le[We],Qe);else if(Ne==="LineString")Ue(Le,Qe,$e,!1);else if(Ne==="MultiLineString"){if(pe.lineMetrics){for(We=0;We<Le.length;We++)Ue(Le[We],Qe=[],$e,!1),we.push(Ir(Ge,"LineString",Qe,Ae.properties));return}He(Le,Qe,$e,!1)}else if(Ne==="Polygon")He(Le,Qe,$e,!0);else{if(Ne!=="MultiPolygon"){if(Ne==="GeometryCollection"){for(We=0;We<Ae.geometry.geometries.length;We++)Cs(we,{id:Ge,geometry:Ae.geometry.geometries[We],properties:Ae.properties},pe,Me);return}throw new Error("Input data is not a valid GeoJSON object.")}for(We=0;We<Le.length;We++){var Et=[];He(Le[We],Et,$e,!0),Qe.push(Et)}}we.push(Ir(Ge,Ne,Qe,Ae.properties))}}function Zt(we,Ae){Ae.push(Be(we[0])),Ae.push(Rt(we[1])),Ae.push(0)}function Ue(we,Ae,pe,Me){for(var Le,Ne,$e=0,Qe=0;Qe<we.length;Qe++){var Ge=Be(we[Qe][0]),We=Rt(we[Qe][1]);Ae.push(Ge),Ae.push(We),Ae.push(0),Qe>0&&($e+=Me?(Le*We-Ge*Ne)/2:Math.sqrt(Math.pow(Ge-Le,2)+Math.pow(We-Ne,2))),Le=Ge,Ne=We}var Et=Ae.length-3;Ae[2]=1,Yo(Ae,0,Et,pe),Ae[Et+2]=1,Ae.size=Math.abs($e),Ae.start=0,Ae.end=Ae.size}function He(we,Ae,pe,Me){for(var Le=0;Le<we.length;Le++){var Ne=[];Ue(we[Le],Ne,pe,Me),Ae.push(Ne)}}function Be(we){return we/360+.5}function Rt(we){var Ae=Math.sin(we*Math.PI/180),pe=.5-.25*Math.log((1+Ae)/(1-Ae))/Math.PI;return pe<0?0:pe>1?1:pe}function Qt(we,Ae,pe,Me,Le,Ne,$e,Qe){if(Me/=Ae,Ne>=(pe/=Ae)&&$e<Me)return we;if($e<pe||Ne>=Me)return null;for(var Ge=[],We=0;We<we.length;We++){var Et=we[We],xe=Et.geometry,Ie=Et.type,ut=Le===0?Et.minX:Et.minY,zt=Le===0?Et.maxX:Et.maxY;if(ut>=pe&&zt<Me)Ge.push(Et);else if(!(zt<pe||ut>=Me)){var o=[];if(Ie==="Point"||Ie==="MultiPoint")ii(xe,o,pe,Me,Le);else if(Ie==="LineString")ti(xe,o,pe,Me,Le,!1,Qe.lineMetrics);else if(Ie==="MultiLineString")Ri(xe,o,pe,Me,Le,!1);else if(Ie==="Polygon")Ri(xe,o,pe,Me,Le,!0);else if(Ie==="MultiPolygon")for(var oe=0;oe<xe.length;oe++){var $t=[];Ri(xe[oe],$t,pe,Me,Le,!0),$t.length&&o.push($t)}if(o.length){if(Qe.lineMetrics&&Ie==="LineString"){for(oe=0;oe<o.length;oe++)Ge.push(Ir(Et.id,Ie,o[oe],Et.tags));continue}Ie!=="LineString"&&Ie!=="MultiLineString"||(o.length===1?(Ie="LineString",o=o[0]):Ie="MultiLineString"),Ie!=="Point"&&Ie!=="MultiPoint"||(Ie=o.length===3?"Point":"MultiPoint"),Ge.push(Ir(Et.id,Ie,o,Et.tags))}}}return Ge.length?Ge:null}function ii(we,Ae,pe,Me,Le){for(var Ne=0;Ne<we.length;Ne+=3){var $e=we[Ne+Le];$e>=pe&&$e<=Me&&(Ae.push(we[Ne]),Ae.push(we[Ne+1]),Ae.push(we[Ne+2]))}}function ti(we,Ae,pe,Me,Le,Ne,$e){for(var Qe,Ge,We=Ht(we),Et=Le===0?Yi:Yr,xe=we.start,Ie=0;Ie<we.length-3;Ie+=3){var ut=we[Ie],zt=we[Ie+1],o=we[Ie+2],oe=we[Ie+3],$t=we[Ie+4],_i=Le===0?ut:zt,mi=Le===0?oe:$t,si=!1;$e&&(Qe=Math.sqrt(Math.pow(ut-oe,2)+Math.pow(zt-$t,2))),_i<pe?mi>pe&&(Ge=Et(We,ut,zt,oe,$t,pe),$e&&(We.start=xe+Qe*Ge)):_i>Me?mi<Me&&(Ge=Et(We,ut,zt,oe,$t,Me),$e&&(We.start=xe+Qe*Ge)):Zi(We,ut,zt,o),mi<pe&&_i>=pe&&(Ge=Et(We,ut,zt,oe,$t,pe),si=!0),mi>Me&&_i<=Me&&(Ge=Et(We,ut,zt,oe,$t,Me),si=!0),!Ne&&si&&($e&&(We.end=xe+Qe*Ge),Ae.push(We),We=Ht(we)),$e&&(xe+=Qe)}var hi=we.length-3;ut=we[hi],zt=we[hi+1],o=we[hi+2],(_i=Le===0?ut:zt)>=pe&&_i<=Me&&Zi(We,ut,zt,o),hi=We.length-3,Ne&&hi>=3&&(We[hi]!==We[0]||We[hi+1]!==We[1])&&Zi(We,We[0],We[1],We[2]),We.length&&Ae.push(We)}function Ht(we){var Ae=[];return Ae.size=we.size,Ae.start=we.start,Ae.end=we.end,Ae}function Ri(we,Ae,pe,Me,Le,Ne){for(var $e=0;$e<we.length;$e++)ti(we[$e],Ae,pe,Me,Le,Ne,!1)}function Zi(we,Ae,pe,Me){we.push(Ae),we.push(pe),we.push(Me)}function Yi(we,Ae,pe,Me,Le,Ne){var $e=(Ne-Ae)/(Me-Ae);return we.push(Ne),we.push(pe+(Le-pe)*$e),we.push(1),$e}function Yr(we,Ae,pe,Me,Le,Ne){var $e=(Ne-pe)/(Le-pe);return we.push(Ae+(Me-Ae)*$e),we.push(Ne),we.push(1),$e}function gn(we,Ae){for(var pe=[],Me=0;Me<we.length;Me++){var Le,Ne=we[Me],$e=Ne.type;if($e==="Point"||$e==="MultiPoint"||$e==="LineString")Le=rs(Ne.geometry,Ae);else if($e==="MultiLineString"||$e==="Polygon"){Le=[];for(var Qe=0;Qe<Ne.geometry.length;Qe++)Le.push(rs(Ne.geometry[Qe],Ae))}else if($e==="MultiPolygon")for(Le=[],Qe=0;Qe<Ne.geometry.length;Qe++){for(var Ge=[],We=0;We<Ne.geometry[Qe].length;We++)Ge.push(rs(Ne.geometry[Qe][We],Ae));Le.push(Ge)}pe.push(Ir(Ne.id,$e,Le,Ne.tags))}return pe}function rs(we,Ae){var pe=[];pe.size=we.size,we.start!==void 0&&(pe.start=we.start,pe.end=we.end);for(var Me=0;Me<we.length;Me+=3)pe.push(we[Me]+Ae,we[Me+1],we[Me+2]);return pe}function ni(we,Ae){if(we.transformed)return we;var pe,Me,Le,Ne=1<<we.z,$e=we.x,Qe=we.y;for(pe=0;pe<we.features.length;pe++){var Ge=we.features[pe],We=Ge.geometry,Et=Ge.type;if(Ge.geometry=[],Et===1)for(Me=0;Me<We.length;Me+=2)Ge.geometry.push(yn(We[Me],We[Me+1],Ae,Ne,$e,Qe));else for(Me=0;Me<We.length;Me++){var xe=[];for(Le=0;Le<We[Me].length;Le+=2)xe.push(yn(We[Me][Le],We[Me][Le+1],Ae,Ne,$e,Qe));Ge.geometry.push(xe)}}return we.transformed=!0,we}function yn(we,Ae,pe,Me,Le,Ne){return[Math.round(pe*(we*Me-Le)),Math.round(pe*(Ae*Me-Ne))]}function vr(we,Ae,pe,Me,Le){for(var Ne=Ae===Le.maxZoom?0:Le.tolerance/((1<<Ae)*Le.extent),$e={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:pe,y:Me,z:Ae,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Qe=0;Qe<we.length;Qe++){$e.numFeatures++,bs($e,we[Qe],Ne,Le);var Ge=we[Qe].minX,We=we[Qe].minY,Et=we[Qe].maxX,xe=we[Qe].maxY;Ge<$e.minX&&($e.minX=Ge),We<$e.minY&&($e.minY=We),Et>$e.maxX&&($e.maxX=Et),xe>$e.maxY&&($e.maxY=xe)}return $e}function bs(we,Ae,pe,Me){var Le=Ae.geometry,Ne=Ae.type,$e=[];if(Ne==="Point"||Ne==="MultiPoint")for(var Qe=0;Qe<Le.length;Qe+=3)$e.push(Le[Qe]),$e.push(Le[Qe+1]),we.numPoints++,we.numSimplified++;else if(Ne==="LineString")us($e,Le,we,pe,!1,!1);else if(Ne==="MultiLineString"||Ne==="Polygon")for(Qe=0;Qe<Le.length;Qe++)us($e,Le[Qe],we,pe,Ne==="Polygon",Qe===0);else if(Ne==="MultiPolygon")for(var Ge=0;Ge<Le.length;Ge++){var We=Le[Ge];for(Qe=0;Qe<We.length;Qe++)us($e,We[Qe],we,pe,!0,Qe===0)}if($e.length){var Et=Ae.tags||null;if(Ne==="LineString"&&Me.lineMetrics){for(var xe in Et={},Ae.tags)Et[xe]=Ae.tags[xe];Et.mapbox_clip_start=Le.start/Le.size,Et.mapbox_clip_end=Le.end/Le.size}var Ie={geometry:$e,type:Ne==="Polygon"||Ne==="MultiPolygon"?3:Ne==="LineString"||Ne==="MultiLineString"?2:1,tags:Et};Ae.id!==null&&(Ie.id=Ae.id),we.features.push(Ie)}}function us(we,Ae,pe,Me,Le,Ne){var $e=Me*Me;if(Me>0&&Ae.size<(Le?$e:Me))pe.numPoints+=Ae.length/3;else{for(var Qe=[],Ge=0;Ge<Ae.length;Ge+=3)(Me===0||Ae[Ge+2]>$e)&&(pe.numSimplified++,Qe.push(Ae[Ge]),Qe.push(Ae[Ge+1])),pe.numPoints++;Le&&function(We,Et){for(var xe=0,Ie=0,ut=We.length,zt=ut-2;Ie<ut;zt=Ie,Ie+=2)xe+=(We[Ie]-We[zt])*(We[Ie+1]+We[zt+1]);if(xe>0===Et)for(Ie=0,ut=We.length;Ie<ut/2;Ie+=2){var o=We[Ie],oe=We[Ie+1];We[Ie]=We[ut-2-Ie],We[Ie+1]=We[ut-1-Ie],We[ut-2-Ie]=o,We[ut-1-Ie]=oe}}(Qe,Ne),we.push(Qe)}}function pi(we,Ae){var pe=(Ae=this.options=function(Le,Ne){for(var $e in Ne)Le[$e]=Ne[$e];return Le}(Object.create(this.options),Ae)).debug;if(pe&&console.time("preprocess data"),Ae.maxZoom<0||Ae.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Ae.promoteId&&Ae.generateId)throw new Error("promoteId and generateId cannot be used together.");var Me=function(Le,Ne){var $e=[];if(Le.type==="FeatureCollection")for(var Qe=0;Qe<Le.features.length;Qe++)Cs($e,Le.features[Qe],Ne,Qe);else Cs($e,Le.type==="Feature"?Le:{geometry:Le},Ne);return $e}(we,Ae);this.tiles={},this.tileCoords=[],pe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Ae.indexMaxZoom,Ae.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Me=function(Le,Ne){var $e=Ne.buffer/Ne.extent,Qe=Le,Ge=Qt(Le,1,-1-$e,$e,0,-1,2,Ne),We=Qt(Le,1,1-$e,2+$e,0,-1,2,Ne);return(Ge||We)&&(Qe=Qt(Le,1,-$e,1+$e,0,-1,2,Ne)||[],Ge&&(Qe=gn(Ge,1).concat(Qe)),We&&(Qe=Qe.concat(gn(We,-1)))),Qe}(Me,Ae),Me.length&&this.splitTile(Me,0,0,0),pe&&(Me.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function br(we,Ae,pe){return 32*((1<<we)*pe+Ae)+we}function wr(we,Ae){return Ae?we.properties[Ae]:we.id}function zn(we,Ae){if(we==null)return!0;if(we.type==="Feature")return wr(we,Ae)!=null;if(we.type==="FeatureCollection"){const pe=new Set;for(const Me of we.features){const Le=wr(Me,Ae);if(Le==null||pe.has(Le))return!1;pe.add(Le)}return!0}return!1}function co(we,Ae){const pe=new Map;if(we!=null)if(we.type==="Feature")pe.set(wr(we,Ae),we);else for(const Me of we.features)pe.set(wr(Me,Ae),Me);return pe}pi.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},pi.prototype.splitTile=function(we,Ae,pe,Me,Le,Ne,$e){for(var Qe=[we,Ae,pe,Me],Ge=this.options,We=Ge.debug;Qe.length;){Me=Qe.pop(),pe=Qe.pop(),Ae=Qe.pop(),we=Qe.pop();var Et=1<<Ae,xe=br(Ae,pe,Me),Ie=this.tiles[xe];if(!Ie&&(We>1&&console.time("creation"),Ie=this.tiles[xe]=vr(we,Ae,pe,Me,Ge),this.tileCoords.push({z:Ae,x:pe,y:Me}),We)){We>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Ae,pe,Me,Ie.numFeatures,Ie.numPoints,Ie.numSimplified),console.timeEnd("creation"));var ut="z"+Ae;this.stats[ut]=(this.stats[ut]||0)+1,this.total++}if(Ie.source=we,Le){if(Ae===Ge.maxZoom||Ae===Le)continue;var zt=1<<Le-Ae;if(pe!==Math.floor(Ne/zt)||Me!==Math.floor($e/zt))continue}else if(Ae===Ge.indexMaxZoom||Ie.numPoints<=Ge.indexMaxPoints)continue;if(Ie.source=null,we.length!==0){We>1&&console.time("clipping");var o,oe,$t,_i,mi,si,hi=.5*Ge.buffer/Ge.extent,gr=.5-hi,yi=.5+hi,Pi=1+hi;o=oe=$t=_i=null,mi=Qt(we,Et,pe-hi,pe+yi,0,Ie.minX,Ie.maxX,Ge),si=Qt(we,Et,pe+gr,pe+Pi,0,Ie.minX,Ie.maxX,Ge),we=null,mi&&(o=Qt(mi,Et,Me-hi,Me+yi,1,Ie.minY,Ie.maxY,Ge),oe=Qt(mi,Et,Me+gr,Me+Pi,1,Ie.minY,Ie.maxY,Ge),mi=null),si&&($t=Qt(si,Et,Me-hi,Me+yi,1,Ie.minY,Ie.maxY,Ge),_i=Qt(si,Et,Me+gr,Me+Pi,1,Ie.minY,Ie.maxY,Ge),si=null),We>1&&console.timeEnd("clipping"),Qe.push(o||[],Ae+1,2*pe,2*Me),Qe.push(oe||[],Ae+1,2*pe,2*Me+1),Qe.push($t||[],Ae+1,2*pe+1,2*Me),Qe.push(_i||[],Ae+1,2*pe+1,2*Me+1)}}},pi.prototype.getTile=function(we,Ae,pe){var Me=this.options,Le=Me.extent,Ne=Me.debug;if(we<0||we>24)return null;var $e=1<<we,Qe=br(we,Ae=(Ae%$e+$e)%$e,pe);if(this.tiles[Qe])return ni(this.tiles[Qe],Le);Ne>1&&console.log("drilling down to z%d-%d-%d",we,Ae,pe);for(var Ge,We=we,Et=Ae,xe=pe;!Ge&&We>0;)We--,Et=Math.floor(Et/2),xe=Math.floor(xe/2),Ge=this.tiles[br(We,Et,xe)];return Ge&&Ge.source?(Ne>1&&console.log("found parent tile z%d-%d-%d",We,Et,xe),Ne>1&&console.time("drilling down"),this.splitTile(Ge.source,We,Et,xe,we,Ae,pe),Ne>1&&console.timeEnd("drilling down"),this.tiles[Qe]?ni(this.tiles[Qe],Le):null):null};class Sr extends Xr{constructor(Ae,pe,Me,Le){super(Ae,pe,Me),this._dataUpdateable=new Map,this.loadGeoJSON=(Ne,$e)=>{const{promoteId:Qe}=Ne;if(Ne.request)return P.f(Ne.request,(Ge,We,Et,xe)=>{this._dataUpdateable=zn(We,Qe)?co(We,Qe):void 0,$e(Ge,We,Et,xe)});if(typeof Ne.data=="string")try{const Ge=JSON.parse(Ne.data);this._dataUpdateable=zn(Ge,Qe)?co(Ge,Qe):void 0,$e(null,Ge)}catch{$e(new Error(`Input data given to '${Ne.source}' is not a valid GeoJSON object.`))}else Ne.dataDiff?this._dataUpdateable?(function(Ge,We,Et){var xe,Ie,ut,zt;if(We.removeAll&&Ge.clear(),We.remove)for(const o of We.remove)Ge.delete(o);if(We.add)for(const o of We.add){const oe=wr(o,Et);oe!=null&&Ge.set(oe,o)}if(We.update)for(const o of We.update){let oe=Ge.get(o.id);if(oe==null)continue;const $t=!o.removeAllProperties&&(((xe=o.removeProperties)===null||xe===void 0?void 0:xe.length)>0||((Ie=o.addOrUpdateProperties)===null||Ie===void 0?void 0:Ie.length)>0);if((o.newGeometry||o.removeAllProperties||$t)&&(oe=Object.assign({},oe),Ge.set(o.id,oe),$t&&(oe.properties=Object.assign({},oe.properties))),o.newGeometry&&(oe.geometry=o.newGeometry),o.removeAllProperties)oe.properties={};else if(((ut=o.removeProperties)===null||ut===void 0?void 0:ut.length)>0)for(const _i of o.removeProperties)Object.prototype.hasOwnProperty.call(oe.properties,_i)&&delete oe.properties[_i];if(((zt=o.addOrUpdateProperties)===null||zt===void 0?void 0:zt.length)>0)for(const{key:_i,value:mi}of o.addOrUpdateProperties)oe.properties[_i]=mi}}(this._dataUpdateable,Ne.dataDiff,Qe),$e(null,{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())})):$e(new Error(`Cannot update existing geojson data in ${Ne.source}`)):$e(new Error(`Input data given to '${Ne.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},this.loadVectorData=this.loadGeoJSONTile,Le&&(this.loadGeoJSON=Le)}loadGeoJSONTile(Ae,pe){const Me=Ae.tileID.canonical;if(!this._geoJSONIndex)return pe(null,null);const Le=this._geoJSONIndex.getTile(Me.z,Me.x,Me.y);if(!Le)return pe(null,null);const Ne=new class{constructor(Qe){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=P.N,this.length=Qe.length,this._features=Qe}feature(Qe){return new class{constructor(Ge){this._feature=Ge,this.extent=P.N,this.type=Ge.type,this.properties=Ge.tags,"id"in Ge&&!isNaN(Ge.id)&&(this.id=parseInt(Ge.id,10))}loadGeometry(){if(this._feature.type===1){const Ge=[];for(const We of this._feature.geometry)Ge.push([new P.P(We[0],We[1])]);return Ge}{const Ge=[];for(const We of this._feature.geometry){const Et=[];for(const xe of We)Et.push(new P.P(xe[0],xe[1]));Ge.push(Et)}return Ge}}toGeoJSON(Ge,We,Et){return Tn.call(this,Ge,We,Et)}}(this._features[Qe])}}(Le.features);let $e=Ao(Ne);$e.byteOffset===0&&$e.byteLength===$e.buffer.byteLength||($e=new Uint8Array($e)),pe(null,{vectorTile:Ne,rawData:$e.buffer})}loadData(Ae,pe){var Me;(Me=this._pendingRequest)===null||Me===void 0||Me.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const Le=!!(Ae&&Ae.request&&Ae.request.collectResourceTiming)&&new P.bu(Ae.request);this._pendingCallback=pe,this._pendingRequest=this.loadGeoJSON(Ae,(Ne,$e)=>{if(delete this._pendingCallback,delete this._pendingRequest,Ne||!$e)return pe(Ne);if(typeof $e!="object")return pe(new Error(`Input data given to '${Ae.source}' is not a valid GeoJSON object.`));{dr($e,!0);try{if(Ae.filter){const Ge=P.bC(Ae.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ge.result==="error")throw new Error(Ge.value.map(Et=>`${Et.key}: ${Et.message}`).join(", "));$e={type:"FeatureCollection",features:$e.features.filter(Et=>Ge.value.evaluate({zoom:0},Et))}}this._geoJSONIndex=Ae.cluster?new Zn(function({superclusterOptions:Ge,clusterProperties:We}){if(!We||!Ge)return Ge;const Et={},xe={},Ie={accumulated:null,zoom:0},ut={properties:null},zt=Object.keys(We);for(const o of zt){const[oe,$t]=We[o],_i=P.bC($t),mi=P.bC(typeof oe=="string"?[oe,["accumulated"],["get",o]]:oe);Et[o]=_i.value,xe[o]=mi.value}return Ge.map=o=>{ut.properties=o;const oe={};for(const $t of zt)oe[$t]=Et[$t].evaluate(Ie,ut);return oe},Ge.reduce=(o,oe)=>{ut.properties=oe;for(const $t of zt)Ie.accumulated=o[$t],o[$t]=xe[$t].evaluate(Ie,ut)},Ge}(Ae)).load($e.features):function(Ge,We){return new pi(Ge,We)}($e,Ae.geojsonVtOptions)}catch(Ge){return pe(Ge)}this.loaded={};const Qe={};if(Le){const Ge=Le.finish();Ge&&(Qe.resourceTiming={},Qe.resourceTiming[Ae.source]=JSON.parse(JSON.stringify(Ge)))}pe(null,Qe)}})}reloadTile(Ae,pe){const Me=this.loaded;return Me&&Me[Ae.uid]?super.reloadTile(Ae,pe):this.loadTile(Ae,pe)}removeSource(Ae,pe){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),pe()}getClusterExpansionZoom(Ae,pe){try{pe(null,this._geoJSONIndex.getClusterExpansionZoom(Ae.clusterId))}catch(Me){pe(Me)}}getClusterChildren(Ae,pe){try{pe(null,this._geoJSONIndex.getChildren(Ae.clusterId))}catch(Me){pe(Me)}}getClusterLeaves(Ae,pe){try{pe(null,this._geoJSONIndex.getLeaves(Ae.clusterId,Ae.limit,Ae.offset))}catch(Me){pe(Me)}}}class kt{constructor(Ae){this.self=Ae,this.actor=new P.C(Ae,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:Xr,geojson:Sr},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(pe,Me)=>{if(this.workerSourceTypes[pe])throw new Error(`Worker source with name "${pe}" already registered.`);this.workerSourceTypes[pe]=Me},this.self.registerRTLTextPlugin=pe=>{if(P.bD.isParsed())throw new Error("RTL text plugin already registered.");P.bD.applyArabicShaping=pe.applyArabicShaping,P.bD.processBidirectionalText=pe.processBidirectionalText,P.bD.processStyledBidirectionalText=pe.processStyledBidirectionalText}}setReferrer(Ae,pe){this.referrer=pe}setImages(Ae,pe,Me){this.availableImages[Ae]=pe;for(const Le in this.workerSources[Ae]){const Ne=this.workerSources[Ae][Le];for(const $e in Ne)Ne[$e].availableImages=pe}Me()}setLayers(Ae,pe,Me){this.getLayerIndex(Ae).replace(pe),Me()}updateLayers(Ae,pe,Me){this.getLayerIndex(Ae).update(pe.layers,pe.removedIds),Me()}loadTile(Ae,pe,Me){this.getWorkerSource(Ae,pe.type,pe.source).loadTile(pe,Me)}loadDEMTile(Ae,pe,Me){this.getDEMWorkerSource(Ae,pe.source).loadTile(pe,Me)}reloadTile(Ae,pe,Me){this.getWorkerSource(Ae,pe.type,pe.source).reloadTile(pe,Me)}abortTile(Ae,pe,Me){this.getWorkerSource(Ae,pe.type,pe.source).abortTile(pe,Me)}removeTile(Ae,pe,Me){this.getWorkerSource(Ae,pe.type,pe.source).removeTile(pe,Me)}removeDEMTile(Ae,pe){this.getDEMWorkerSource(Ae,pe.source).removeTile(pe)}removeSource(Ae,pe,Me){if(!this.workerSources[Ae]||!this.workerSources[Ae][pe.type]||!this.workerSources[Ae][pe.type][pe.source])return;const Le=this.workerSources[Ae][pe.type][pe.source];delete this.workerSources[Ae][pe.type][pe.source],Le.removeSource!==void 0?Le.removeSource(pe,Me):Me()}loadWorkerSource(Ae,pe,Me){try{this.self.importScripts(pe.url),Me()}catch(Le){Me(Le.toString())}}syncRTLPluginState(Ae,pe,Me){try{P.bD.setState(pe);const Le=P.bD.getPluginURL();if(P.bD.isLoaded()&&!P.bD.isParsed()&&Le!=null){this.self.importScripts(Le);const Ne=P.bD.isParsed();Me(Ne?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Le}`),Ne)}}catch(Le){Me(Le.toString())}}getAvailableImages(Ae){let pe=this.availableImages[Ae];return pe||(pe=[]),pe}getLayerIndex(Ae){let pe=this.layerIndexes[Ae];return pe||(pe=this.layerIndexes[Ae]=new yt),pe}getWorkerSource(Ae,pe,Me){return this.workerSources[Ae]||(this.workerSources[Ae]={}),this.workerSources[Ae][pe]||(this.workerSources[Ae][pe]={}),this.workerSources[Ae][pe][Me]||(this.workerSources[Ae][pe][Me]=new this.workerSourceTypes[pe]({send:(Le,Ne,$e)=>{this.actor.send(Le,Ne,$e,Ae)}},this.getLayerIndex(Ae),this.getAvailableImages(Ae))),this.workerSources[Ae][pe][Me]}getDEMWorkerSource(Ae,pe){return this.demWorkerSources[Ae]||(this.demWorkerSources[Ae]={}),this.demWorkerSources[Ae][pe]||(this.demWorkerSources[Ae][pe]=new Ti),this.demWorkerSources[Ae][pe]}}return P.i()&&(self.worker=new kt(self)),kt}),Ye(["./shared"],function(P){var yt="3.6.2";class Ee{static testProp(l){if(!Ee.docStyle)return l[0];for(let g=0;g<l.length;g++)if(l[g]in Ee.docStyle)return l[g];return l[0]}static create(l,g,S){const k=window.document.createElement(l);return g!==void 0&&(k.className=g),S&&S.appendChild(k),k}static createNS(l,g){return window.document.createElementNS(l,g)}static disableDrag(){Ee.docStyle&&Ee.selectProp&&(Ee.userSelect=Ee.docStyle[Ee.selectProp],Ee.docStyle[Ee.selectProp]="none")}static enableDrag(){Ee.docStyle&&Ee.selectProp&&(Ee.docStyle[Ee.selectProp]=Ee.userSelect)}static setTransform(l,g){l.style[Ee.transformProp]=g}static addEventListener(l,g,S,k={}){l.addEventListener(g,S,"passive"in k?k:k.capture)}static removeEventListener(l,g,S,k={}){l.removeEventListener(g,S,"passive"in k?k:k.capture)}static suppressClickInternal(l){l.preventDefault(),l.stopPropagation(),window.removeEventListener("click",Ee.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",Ee.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",Ee.suppressClickInternal,!0)},0)}static mousePos(l,g){const S=l.getBoundingClientRect();return new P.P(g.clientX-S.left-l.clientLeft,g.clientY-S.top-l.clientTop)}static touchPos(l,g){const S=l.getBoundingClientRect(),k=[];for(let F=0;F<g.length;F++)k.push(new P.P(g[F].clientX-S.left-l.clientLeft,g[F].clientY-S.top-l.clientTop));return k}static mouseButton(l){return l.button}static remove(l){l.parentNode&&l.parentNode.removeChild(l)}}Ee.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,Ee.selectProp=Ee.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),Ee.transformProp=Ee.testProp(["transform","WebkitTransform"]);const li={supported:!1,testSupport:function(z){!Xr&&Gt&&(Ti?cn(z):Ot=z)}};let Ot,Gt,Xr=!1,Ti=!1;function cn(z){const l=z.createTexture();z.bindTexture(z.TEXTURE_2D,l);try{if(z.texImage2D(z.TEXTURE_2D,0,z.RGBA,z.RGBA,z.UNSIGNED_BYTE,Gt),z.isContextLost())return;li.supported=!0}catch{}z.deleteTexture(l),Xr=!0}var qr,dr;typeof document<"u"&&(Gt=document.createElement("img"),Gt.onload=function(){Ot&&cn(Ot),Ot=null,Ti=!0},Gt.onerror=function(){Xr=!0,Ot=null},Gt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(z){let l,g,S,k;z.resetRequestQueue=()=>{l=[],g=0,S=0,k={}},z.addThrottleControl=d=>{const y=S++;return k[y]=d,y},z.removeThrottleControl=d=>{delete k[d],u()},z.getImage=(d,y,b=!0)=>{li.supported&&(d.headers||(d.headers={}),d.headers.accept="image/webp,*/*");const I={requestParameters:d,supportImageRefresh:b,callback:y,cancelled:!1,completed:!1,cancel:()=>{I.completed||I.cancelled||(I.cancelled=!0,I.innerRequest&&(I.innerRequest.cancel(),g--),u())}};return l.push(I),u(),I};const F=d=>{const{requestParameters:y,supportImageRefresh:b,callback:I}=d;return P.e(y,{type:"image"}),(b!==!1||P.i()||P.g(y.url)||y.headers&&!Object.keys(y.headers).reduce((R,N)=>R&&N==="accept",!0)?P.m:h)(y,(R,N,W,K)=>{Z(d,I,R,N,W,K)})},Z=(d,y,b,I,R,N)=>{b?y(b):I instanceof HTMLImageElement||P.a(I)?y(null,I):I&&((W,K)=>{typeof createImageBitmap=="function"?P.b(W,K):P.d(W,K)})(I,(W,K)=>{W!=null?y(W):K!=null&&y(null,K,{cacheControl:R,expires:N})}),d.cancelled||(d.completed=!0,g--,u())},u=()=>{const d=(()=>{const y=Object.keys(k);let b=!1;if(y.length>0){for(const I of y)if(b=k[I](),b)break}return b})()?P.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:P.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let y=g;y<d&&l.length>0;y++){const b=l.shift();if(b.cancelled){y--;continue}const I=F(b);g++,b.innerRequest=I}},h=(d,y)=>{const b=new Image,I=d.url;let R=!1;const N=d.credentials;return N&&N==="include"?b.crossOrigin="use-credentials":(N&&N==="same-origin"||!P.s(I))&&(b.crossOrigin="anonymous"),b.fetchPriority="high",b.onload=()=>{y(null,b),b.onerror=b.onload=null},b.onerror=()=>{R||y(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")),b.onerror=b.onload=null},b.src=I,{cancel:()=>{R=!0,b.src=""}}}}(qr||(qr={})),qr.resetRequestQueue(),function(z){z.Glyphs="Glyphs",z.Image="Image",z.Source="Source",z.SpriteImage="SpriteImage",z.SpriteJSON="SpriteJSON",z.Style="Style",z.Tile="Tile",z.Unknown="Unknown"}(dr||(dr={}));class Tn{constructor(l){this._transformRequestFn=l}transformRequest(l,g){return this._transformRequestFn&&this._transformRequestFn(l,g)||{url:l}}normalizeSpriteURL(l,g,S){const k=function(F){const Z=F.match(un);if(!Z)throw new Error(`Unable to parse URL "${F}"`);return{protocol:Z[1],authority:Z[2],path:Z[3]||"/",params:Z[4]?Z[4].split("&"):[]}}(l);return k.path+=`${g}${S}`,function(F){const Z=F.params.length?`?${F.params.join("&")}`:"";return`${F.protocol}://${F.authority}${F.path}${Z}`}(k)}setTransformRequest(l){this._transformRequestFn=l}}const un=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function _r(z){var l=new P.A(3);return l[0]=z[0],l[1]=z[1],l[2]=z[2],l}var ps,En=function(z,l,g){return z[0]=l[0]-g[0],z[1]=l[1]-g[1],z[2]=l[2]-g[2],z};ps=new P.A(3),P.A!=Float32Array&&(ps[0]=0,ps[1]=0,ps[2]=0);var Ls=function(z){var l=z[0],g=z[1];return l*l+g*g};function pn(z){const l=[];if(typeof z=="string")l.push({id:"default",url:z});else if(z&&z.length>0){const g=[];for(const{id:S,url:k}of z){const F=`${S}${k}`;g.indexOf(F)===-1&&(g.push(F),l.push({id:S,url:k}))}}return l}function As(z,l,g,S,k){if(S)return void z(S);if(k!==Object.values(l).length||k!==Object.values(g).length)return;const F={};for(const Z in l){F[Z]={};const u=P.h.getImageCanvasContext(g[Z]),h=l[Z];for(const d in h){const{width:y,height:b,x:I,y:R,sdf:N,pixelRatio:W,stretchX:K,stretchY:le,content:de}=h[d];F[Z][d]={data:null,pixelRatio:W,sdf:N,stretchX:K,stretchY:le,content:de,spriteData:{width:y,height:b,x:I,y:R,context:u}}}}z(null,F)}(function(){var z=new P.A(2);P.A!=Float32Array&&(z[0]=0,z[1]=0)})();class ct{constructor(l,g,S,k){this.context=l,this.format=S,this.texture=l.gl.createTexture(),this.update(g,k)}update(l,g,S){const{width:k,height:F}=l,Z=!(this.size&&this.size[0]===k&&this.size[1]===F||S),{context:u}=this,{gl:h}=u;if(this.useMipmap=!!(g&&g.useMipmap),h.bindTexture(h.TEXTURE_2D,this.texture),u.pixelStoreUnpackFlipY.set(!1),u.pixelStoreUnpack.set(1),u.pixelStoreUnpackPremultiplyAlpha.set(this.format===h.RGBA&&(!g||g.premultiply!==!1)),Z)this.size=[k,F],l instanceof HTMLImageElement||l instanceof HTMLCanvasElement||l instanceof HTMLVideoElement||l instanceof ImageData||P.a(l)?h.texImage2D(h.TEXTURE_2D,0,this.format,this.format,h.UNSIGNED_BYTE,l):h.texImage2D(h.TEXTURE_2D,0,this.format,k,F,0,this.format,h.UNSIGNED_BYTE,l.data);else{const{x:d,y}=S||{x:0,y:0};l instanceof HTMLImageElement||l instanceof HTMLCanvasElement||l instanceof HTMLVideoElement||l instanceof ImageData||P.a(l)?h.texSubImage2D(h.TEXTURE_2D,0,d,y,h.RGBA,h.UNSIGNED_BYTE,l):h.texSubImage2D(h.TEXTURE_2D,0,d,y,k,F,h.RGBA,h.UNSIGNED_BYTE,l.data)}this.useMipmap&&this.isSizePowerOfTwo()&&h.generateMipmap(h.TEXTURE_2D)}bind(l,g,S){const{context:k}=this,{gl:F}=k;F.bindTexture(F.TEXTURE_2D,this.texture),S!==F.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(S=F.LINEAR),l!==this.filter&&(F.texParameteri(F.TEXTURE_2D,F.TEXTURE_MAG_FILTER,l),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_MIN_FILTER,S||l),this.filter=l),g!==this.wrap&&(F.texParameteri(F.TEXTURE_2D,F.TEXTURE_WRAP_S,g),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_WRAP_T,g),this.wrap=g)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:l}=this.context;l.deleteTexture(this.texture),this.texture=null}}function Lt(z){const{userImage:l}=z;return!!(l&&l.render&&l.render())&&(z.data.replace(new Uint8Array(l.data.buffer)),!0)}class fn extends P.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new P.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(l){if(this.loaded!==l&&(this.loaded=l,l)){for(const{ids:g,callback:S}of this.requestors)this._notify(g,S);this.requestors=[]}}getImage(l){const g=this.images[l];if(g&&!g.data&&g.spriteData){const S=g.spriteData;g.data=new P.R({width:S.width,height:S.height},S.context.getImageData(S.x,S.y,S.width,S.height).data),g.spriteData=null}return g}addImage(l,g){if(this.images[l])throw new Error(`Image id ${l} already exist, use updateImage instead`);this._validate(l,g)&&(this.images[l]=g)}_validate(l,g){let S=!0;const k=g.data||g.spriteData;return this._validateStretch(g.stretchX,k&&k.width)||(this.fire(new P.j(new Error(`Image "${l}" has invalid "stretchX" value`))),S=!1),this._validateStretch(g.stretchY,k&&k.height)||(this.fire(new P.j(new Error(`Image "${l}" has invalid "stretchY" value`))),S=!1),this._validateContent(g.content,g)||(this.fire(new P.j(new Error(`Image "${l}" has invalid "content" value`))),S=!1),S}_validateStretch(l,g){if(!l)return!0;let S=0;for(const k of l){if(k[0]<S||k[1]<k[0]||g<k[1])return!1;S=k[1]}return!0}_validateContent(l,g){if(!l)return!0;if(l.length!==4)return!1;const S=g.spriteData,k=S&&S.width||g.data.width,F=S&&S.height||g.data.height;return!(l[0]<0||k<l[0]||l[1]<0||F<l[1]||l[2]<0||k<l[2]||l[3]<0||F<l[3]||l[2]<l[0]||l[3]<l[1])}updateImage(l,g,S=!0){const k=this.getImage(l);if(S&&(k.data.width!==g.data.width||k.data.height!==g.data.height))throw new Error(`size mismatch between old image (${k.data.width}x${k.data.height}) and new image (${g.data.width}x${g.data.height}).`);g.version=k.version+1,this.images[l]=g,this.updatedImages[l]=!0}removeImage(l){const g=this.images[l];delete this.images[l],delete this.patterns[l],g.userImage&&g.userImage.onRemove&&g.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(l,g){let S=!0;if(!this.isLoaded())for(const k of l)this.images[k]||(S=!1);this.isLoaded()||S?this._notify(l,g):this.requestors.push({ids:l,callback:g})}_notify(l,g){const S={};for(const k of l){let F=this.getImage(k);F||(this.fire(new P.k("styleimagemissing",{id:k})),F=this.getImage(k)),F?S[k]={data:F.data.clone(),pixelRatio:F.pixelRatio,sdf:F.sdf,version:F.version,stretchX:F.stretchX,stretchY:F.stretchY,content:F.content,hasRenderCallback:!!(F.userImage&&F.userImage.render)}:P.w(`Image "${k}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}g(null,S)}getPixelSize(){const{width:l,height:g}=this.atlasImage;return{width:l,height:g}}getPattern(l){const g=this.patterns[l],S=this.getImage(l);if(!S)return null;if(g&&g.position.version===S.version)return g.position;if(g)g.position.version=S.version;else{const k={w:S.data.width+2,h:S.data.height+2,x:0,y:0},F=new P.I(k,S);this.patterns[l]={bin:k,position:F}}return this._updatePatternAtlas(),this.patterns[l].position}bind(l){const g=l.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new ct(l,this.atlasImage,g.RGBA),this.atlasTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE)}_updatePatternAtlas(){const l=[];for(const F in this.patterns)l.push(this.patterns[F].bin);const{w:g,h:S}=P.p(l),k=this.atlasImage;k.resize({width:g||1,height:S||1});for(const F in this.patterns){const{bin:Z}=this.patterns[F],u=Z.x+1,h=Z.y+1,d=this.getImage(F).data,y=d.width,b=d.height;P.R.copy(d,k,{x:0,y:0},{x:u,y:h},{width:y,height:b}),P.R.copy(d,k,{x:0,y:b-1},{x:u,y:h-1},{width:y,height:1}),P.R.copy(d,k,{x:0,y:0},{x:u,y:h+b},{width:y,height:1}),P.R.copy(d,k,{x:y-1,y:0},{x:u-1,y:h},{width:1,height:b}),P.R.copy(d,k,{x:0,y:0},{x:u+y,y:h},{width:1,height:b})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(l){for(const g of l){if(this.callbackDispatchedThisFrame[g])continue;this.callbackDispatchedThisFrame[g]=!0;const S=this.getImage(g);S||P.w(`Image with ID: "${g}" was not found`),Lt(S)&&this.updateImage(g,S)}}}const mn=1e20;function wi(z,l,g,S,k,F,Z,u,h){for(let d=l;d<l+S;d++)hr(z,g*F+d,F,k,Z,u,h);for(let d=g;d<g+k;d++)hr(z,d*F+l,1,S,Z,u,h)}function hr(z,l,g,S,k,F,Z){F[0]=0,Z[0]=-mn,Z[1]=mn,k[0]=z[l];for(let u=1,h=0,d=0;u<S;u++){k[u]=z[l+u*g];const y=u*u;do{const b=F[h];d=(k[u]-k[b]+y-b*b)/(u-b)/2}while(d<=Z[h]&&--h>-1);h++,F[h]=u,Z[h]=d,Z[h+1]=mn}for(let u=0,h=0;u<S;u++){for(;Z[h+1]<u;)h++;const d=F[h],y=u-d;z[l+u*g]=k[d]+y*y}}class kn{constructor(l,g){this.requestManager=l,this.localIdeographFontFamily=g,this.entries={}}setURL(l){this.url=l}getGlyphs(l,g){const S=[];for(const k in l)for(const F of l[k])S.push({stack:k,id:F});P.o(S,({stack:k,id:F},Z)=>{let u=this.entries[k];u||(u=this.entries[k]={glyphs:{},requests:{},ranges:{}});let h=u.glyphs[F];if(h!==void 0)return void Z(null,{stack:k,id:F,glyph:h});if(h=this._tinySDF(u,k,F),h)return u.glyphs[F]=h,void Z(null,{stack:k,id:F,glyph:h});const d=Math.floor(F/256);if(256*d>65535)return void Z(new Error("glyphs > 65535 not supported"));if(u.ranges[d])return void Z(null,{stack:k,id:F,glyph:h});if(!this.url)return void Z(new Error("glyphsUrl is not set"));let y=u.requests[d];y||(y=u.requests[d]=[],kn.loadGlyphRange(k,d,this.url,this.requestManager,(b,I)=>{if(I){for(const R in I)this._doesCharSupportLocalGlyph(+R)||(u.glyphs[+R]=I[+R]);u.ranges[d]=!0}for(const R of y)R(b,I);delete u.requests[d]})),y.push((b,I)=>{b?Z(b):I&&Z(null,{stack:k,id:F,glyph:I[F]||null})})},(k,F)=>{if(k)g(k);else if(F){const Z={};for(const{stack:u,id:h,glyph:d}of F)(Z[u]||(Z[u]={}))[h]=d&&{id:d.id,bitmap:d.bitmap.clone(),metrics:d.metrics};g(null,Z)}})}_doesCharSupportLocalGlyph(l){return!!this.localIdeographFontFamily&&(P.u["CJK Unified Ideographs"](l)||P.u["Hangul Syllables"](l)||P.u.Hiragana(l)||P.u.Katakana(l))}_tinySDF(l,g,S){const k=this.localIdeographFontFamily;if(!k||!this._doesCharSupportLocalGlyph(S))return;let F=l.tinySDF;if(!F){let u="400";/bold/i.test(g)?u="900":/medium/i.test(g)?u="500":/light/i.test(g)&&(u="200"),F=l.tinySDF=new kn.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:k,fontWeight:u})}const Z=F.draw(String.fromCharCode(S));return{id:S,bitmap:new P.q({width:Z.width||60,height:Z.height||60},Z.data),metrics:{width:Z.glyphWidth/2||24,height:Z.glyphHeight/2||24,left:Z.glyphLeft/2+.5||0,top:Z.glyphTop/2-27.5||-8,advance:Z.glyphAdvance/2||24,isDoubleResolution:!0}}}}kn.loadGlyphRange=function(z,l,g,S,k){const F=256*l,Z=F+255,u=S.transformRequest(g.replace("{fontstack}",z).replace("{range}",`${F}-${Z}`),dr.Glyphs);P.l(u,(h,d)=>{if(h)k(h);else if(d){const y={};for(const b of P.n(d))y[b.id]=b;k(null,y)}})},kn.TinySDF=class{constructor({fontSize:z=24,buffer:l=3,radius:g=8,cutoff:S=.25,fontFamily:k="sans-serif",fontWeight:F="normal",fontStyle:Z="normal"}={}){this.buffer=l,this.cutoff=S,this.radius=g;const u=this.size=z+4*l,h=this._createCanvas(u),d=this.ctx=h.getContext("2d",{willReadFrequently:!0});d.font=`${Z} ${F} ${z}px ${k}`,d.textBaseline="alphabetic",d.textAlign="left",d.fillStyle="black",this.gridOuter=new Float64Array(u*u),this.gridInner=new Float64Array(u*u),this.f=new Float64Array(u),this.z=new Float64Array(u+1),this.v=new Uint16Array(u)}_createCanvas(z){const l=document.createElement("canvas");return l.width=l.height=z,l}draw(z){const{width:l,actualBoundingBoxAscent:g,actualBoundingBoxDescent:S,actualBoundingBoxLeft:k,actualBoundingBoxRight:F}=this.ctx.measureText(z),Z=Math.ceil(g),u=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(F-k))),h=Math.min(this.size-this.buffer,Z+Math.ceil(S)),d=u+2*this.buffer,y=h+2*this.buffer,b=Math.max(d*y,0),I=new Uint8ClampedArray(b),R={data:I,width:d,height:y,glyphWidth:u,glyphHeight:h,glyphTop:Z,glyphLeft:0,glyphAdvance:l};if(u===0||h===0)return R;const{ctx:N,buffer:W,gridInner:K,gridOuter:le}=this;N.clearRect(W,W,u,h),N.fillText(z,W,W+Z);const de=N.getImageData(W,W,u,h);le.fill(mn,0,b),K.fill(0,0,b);for(let ge=0;ge<h;ge++)for(let ke=0;ke<u;ke++){const Pe=de.data[4*(ge*u+ke)+3]/255;if(Pe===0)continue;const qe=(ge+W)*d+ke+W;if(Pe===1)le[qe]=0,K[qe]=mn;else{const ht=.5-Pe;le[qe]=ht>0?ht*ht:0,K[qe]=ht<0?ht*ht:0}}wi(le,0,0,d,y,d,this.f,this.v,this.z),wi(K,W,W,u,h,d,this.f,this.v,this.z);for(let ge=0;ge<b;ge++){const ke=Math.sqrt(le[ge])-Math.sqrt(K[ge]);I[ge]=Math.round(255-255*(ke/this.radius+this.cutoff))}return R}};class Dn{constructor(){this.specification=P.v.light.position}possiblyEvaluate(l,g){return P.z(l.expression.evaluate(g))}interpolate(l,g,S){return{x:P.B.number(l.x,g.x,S),y:P.B.number(l.y,g.y,S),z:P.B.number(l.z,g.z,S)}}}let Rs;class Ao extends P.E{constructor(l){super(),Rs=Rs||new P.r({anchor:new P.D(P.v.light.anchor),position:new Dn,color:new P.D(P.v.light.color),intensity:new P.D(P.v.light.intensity)}),this._transitionable=new P.T(Rs),this.setLight(l),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(l,g={}){if(!this._validate(P.t,l,g))for(const S in l){const k=l[S];S.endsWith("-transition")?this._transitionable.setTransition(S.slice(0,-11),k):this._transitionable.setValue(S,k)}}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,g,S){return(!S||S.validate!==!1)&&P.x(this,l.call(P.y,P.e({value:g,style:{glyphs:!0,sprite:!0},styleSpec:P.v})))}}class yo{constructor(l,g){this.width=l,this.height=g,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(l,g){const S=l.join(",")+String(g);return this.dashEntry[S]||(this.dashEntry[S]=this.addDash(l,g)),this.dashEntry[S]}getDashRanges(l,g,S){const k=[];let F=l.length%2==1?-l[l.length-1]*S:0,Z=l[0]*S,u=!0;k.push({left:F,right:Z,isDash:u,zeroLength:l[0]===0});let h=l[0];for(let d=1;d<l.length;d++){u=!u;const y=l[d];F=h*S,h+=y,Z=h*S,k.push({left:F,right:Z,isDash:u,zeroLength:y===0})}return k}addRoundDash(l,g,S){const k=g/2;for(let F=-S;F<=S;F++){const Z=this.width*(this.nextRow+S+F);let u=0,h=l[u];for(let d=0;d<this.width;d++){d/h.right>1&&(h=l[++u]);const y=Math.abs(d-h.left),b=Math.abs(d-h.right),I=Math.min(y,b);let R;const N=F/S*(k+1);if(h.isDash){const W=k-Math.abs(N);R=Math.sqrt(I*I+W*W)}else R=k-Math.sqrt(I*I+N*N);this.data[Z+d]=Math.max(0,Math.min(255,R+128))}}}addRegularDash(l){for(let u=l.length-1;u>=0;--u){const h=l[u],d=l[u+1];h.zeroLength?l.splice(u,1):d&&d.isDash===h.isDash&&(d.left=h.left,l.splice(u,1))}const g=l[0],S=l[l.length-1];g.isDash===S.isDash&&(g.left=S.left-this.width,S.right=g.right+this.width);const k=this.width*this.nextRow;let F=0,Z=l[F];for(let u=0;u<this.width;u++){u/Z.right>1&&(Z=l[++F]);const h=Math.abs(u-Z.left),d=Math.abs(u-Z.right),y=Math.min(h,d);this.data[k+u]=Math.max(0,Math.min(255,(Z.isDash?y:-y)+128))}}addDash(l,g){const S=g?7:0,k=2*S+1;if(this.nextRow+k>this.height)return P.w("LineAtlas out of space"),null;let F=0;for(let u=0;u<l.length;u++)F+=l[u];if(F!==0){const u=this.width/F,h=this.getDashRanges(l,this.width,u);g?this.addRoundDash(h,u,S):this.addRegularDash(h)}const Z={y:(this.nextRow+S+.5)/this.height,height:2*S/this.height,width:F};return this.nextRow+=k,this.dirty=!0,Z}bind(l){const g=l.gl;this.texture?(g.bindTexture(g.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,g.texSubImage2D(g.TEXTURE_2D,0,0,0,this.width,this.height,g.ALPHA,g.UNSIGNED_BYTE,this.data))):(this.texture=g.createTexture(),g.bindTexture(g.TEXTURE_2D,this.texture),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.REPEAT),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,g.REPEAT),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,g.LINEAR),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,g.LINEAR),g.texImage2D(g.TEXTURE_2D,0,g.ALPHA,this.width,this.height,0,g.ALPHA,g.UNSIGNED_BYTE,this.data))}}class ts{constructor(l,g,S){this.workerPool=l,this.actors=[],this.currentActor=0,this.id=S;const k=this.workerPool.acquire(S);for(let F=0;F<k.length;F++){const Z=new P.C(k[F],g,S);Z.name=`Worker ${F}`,this.actors.push(Z)}if(!this.actors.length)throw new Error("No actors found")}broadcast(l,g,S){P.o(this.actors,(k,F)=>{k.send(l,g,F)},S=S||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(l=!0){this.actors.forEach(g=>{g.remove()}),this.actors=[],l&&this.workerPool.release(this.id)}}function Ai(z,l,g){const S=function(k,F){if(k)return g(k);if(F){const Z=P.F(P.e(F,z),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);F.vector_layers&&(Z.vectorLayers=F.vector_layers,Z.vectorLayerIds=Z.vectorLayers.map(u=>u.id)),g(null,Z)}};return z.url?P.f(l.transformRequest(z.url,dr.Source),S):P.h.frame(()=>S(null,z))}class jr{constructor(l,g){l&&(g?this.setSouthWest(l).setNorthEast(g):Array.isArray(l)&&(l.length===4?this.setSouthWest([l[0],l[1]]).setNorthEast([l[2],l[3]]):this.setSouthWest(l[0]).setNorthEast(l[1])))}setNorthEast(l){return this._ne=l instanceof P.L?new P.L(l.lng,l.lat):P.L.convert(l),this}setSouthWest(l){return this._sw=l instanceof P.L?new P.L(l.lng,l.lat):P.L.convert(l),this}extend(l){const g=this._sw,S=this._ne;let k,F;if(l instanceof P.L)k=l,F=l;else{if(!(l instanceof jr))return Array.isArray(l)?l.length===4||l.every(Array.isArray)?this.extend(jr.convert(l)):this.extend(P.L.convert(l)):l&&("lng"in l||"lon"in l)&&"lat"in l?this.extend(P.L.convert(l)):this;if(k=l._sw,F=l._ne,!k||!F)return this}return g||S?(g.lng=Math.min(k.lng,g.lng),g.lat=Math.min(k.lat,g.lat),S.lng=Math.max(F.lng,S.lng),S.lat=Math.max(F.lat,S.lat)):(this._sw=new P.L(k.lng,k.lat),this._ne=new P.L(F.lng,F.lat)),this}getCenter(){return new P.L((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new P.L(this.getWest(),this.getNorth())}getSouthEast(){return new P.L(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(l){const{lng:g,lat:S}=P.L.convert(l);let k=this._sw.lng<=g&&g<=this._ne.lng;return this._sw.lng>this._ne.lng&&(k=this._sw.lng>=g&&g>=this._ne.lng),this._sw.lat<=S&&S<=this._ne.lat&&k}static convert(l){return l instanceof jr?l:l&&new jr(l)}static fromLngLat(l,g=0){const S=360*g/40075017,k=S/Math.cos(Math.PI/180*l.lat);return new jr(new P.L(l.lng-k,l.lat-S),new P.L(l.lng+k,l.lat+S))}}class Pn{constructor(l,g,S){this.bounds=jr.convert(this.validateBounds(l)),this.minzoom=g||0,this.maxzoom=S||24}validateBounds(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]}contains(l){const g=Math.pow(2,l.z),S=Math.floor(P.G(this.bounds.getWest())*g),k=Math.floor(P.H(this.bounds.getNorth())*g),F=Math.ceil(P.G(this.bounds.getEast())*g),Z=Math.ceil(P.H(this.bounds.getSouth())*g);return l.x>=S&&l.x<F&&l.y>=k&&l.y<Z}}class Js extends P.E{constructor(l,g,S,k){if(super(),this.load=()=>{this._loaded=!1,this.fire(new P.k("dataloading",{dataType:"source"})),this._tileJSONRequest=Ai(this._options,this.map._requestManager,(F,Z)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),F?this.fire(new P.j(F)):Z&&(P.e(this,Z),Z.bounds&&(this.tileBounds=new Pn(Z.bounds,this.minzoom,this.maxzoom)),this.fire(new P.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new P.k("data",{dataType:"source",sourceDataType:"content"})))})},this.serialize=()=>P.e({},this._options),this.id=l,this.dispatcher=S,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,P.e(this,P.F(g,["url","scheme","tileSize","promoteId"])),this._options=P.e({type:"vector"},g),this._collectResourceTiming=g.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(k)}loaded(){return this._loaded}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}onAdd(l){this.map=l,this.load()}setSourceProperty(l){this._tileJSONRequest&&this._tileJSONRequest.cancel(),l(),this.load()}setTiles(l){return this.setSourceProperty(()=>{this._options.tiles=l}),this}setUrl(l){return this.setSourceProperty(()=>{this.url=l,this._options.url=l}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}loadTile(l,g){const S=l.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),k={request:this.map._requestManager.transformRequest(S,dr.Tile),uid:l.uid,tileID:l.tileID,zoom:l.tileID.overscaledZ,tileSize:this.tileSize*l.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function F(Z,u){return delete l.request,l.aborted?g(null):Z&&Z.status!==404?g(Z):(u&&u.resourceTiming&&(l.resourceTiming=u.resourceTiming),this.map._refreshExpiredTiles&&u&&l.setExpiryData(u),l.loadVectorData(u,this.map.painter),g(null),void(l.reloadCallback&&(this.loadTile(l,l.reloadCallback),l.reloadCallback=null)))}k.request.collectResourceTiming=this._collectResourceTiming,l.actor&&l.state!=="expired"?l.state==="loading"?l.reloadCallback=g:l.request=l.actor.send("reloadTile",k,F.bind(this)):(l.actor=this.dispatcher.getActor(),l.request=l.actor.send("loadTile",k,F.bind(this)))}abortTile(l){l.request&&(l.request.cancel(),delete l.request),l.actor&&l.actor.send("abortTile",{uid:l.uid,type:this.type,source:this.id},void 0)}unloadTile(l){l.unloadVectorData(),l.actor&&l.actor.send("removeTile",{uid:l.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class Zn extends P.E{constructor(l,g,S,k){super(),this.id=l,this.dispatcher=S,this.setEventedParent(k),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=P.e({type:"raster"},g),P.e(this,P.F(g,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new P.k("dataloading",{dataType:"source"})),this._tileJSONRequest=Ai(this._options,this.map._requestManager,(l,g)=>{this._tileJSONRequest=null,this._loaded=!0,l?this.fire(new P.j(l)):g&&(P.e(this,g),g.bounds&&(this.tileBounds=new Pn(g.bounds,this.minzoom,this.maxzoom)),this.fire(new P.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new P.k("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(l){this.map=l,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}setSourceProperty(l){this._tileJSONRequest&&this._tileJSONRequest.cancel(),l(),this.load()}setTiles(l){return this.setSourceProperty(()=>{this._options.tiles=l}),this}serialize(){return P.e({},this._options)}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}loadTile(l,g){const S=l.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);l.request=qr.getImage(this.map._requestManager.transformRequest(S,dr.Tile),(k,F,Z)=>{if(delete l.request,l.aborted)l.state="unloaded",g(null);else if(k)l.state="errored",g(k);else if(F){this.map._refreshExpiredTiles&&Z&&l.setExpiryData(Z);const u=this.map.painter.context,h=u.gl;l.texture=this.map.painter.getTileTexture(F.width),l.texture?l.texture.update(F,{useMipmap:!0}):(l.texture=new ct(u,F,h.RGBA,{useMipmap:!0}),l.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE,h.LINEAR_MIPMAP_NEAREST),u.extTextureFilterAnisotropic&&h.texParameterf(h.TEXTURE_2D,u.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,u.extTextureFilterAnisotropicMax)),l.state="loaded",g(null)}},this.map._refreshExpiredTiles)}abortTile(l,g){l.request&&(l.request.cancel(),delete l.request),g()}unloadTile(l,g){l.texture&&this.map.painter.saveTileTexture(l.texture),g()}hasTransition(){return!1}}class Pt extends Zn{constructor(l,g,S,k){super(l,g,S,k),this.type="raster-dem",this.maxzoom=22,this._options=P.e({type:"raster-dem"},g),this.encoding=g.encoding||"mapbox",this.redFactor=g.redFactor,this.greenFactor=g.greenFactor,this.blueFactor=g.blueFactor,this.baseShift=g.baseShift}loadTile(l,g){const S=l.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),k=this.map._requestManager.transformRequest(S,dr.Tile);function F(Z,u){Z&&(l.state="errored",g(Z)),u&&(l.dem=u,l.needsHillshadePrepare=!0,l.needsTerrainPrepare=!0,l.state="loaded",g(null))}l.neighboringTiles=this._getNeighboringTiles(l.tileID),l.request=qr.getImage(k,(Z,u,h)=>P._(this,void 0,void 0,function*(){if(delete l.request,l.aborted)l.state="unloaded",g(null);else if(Z)l.state="errored",g(Z);else if(u){this.map._refreshExpiredTiles&&l.setExpiryData(h);const d=P.a(u)&&P.J()?u:yield function(b){return P._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&P.K()){const I=b.width+2,R=b.height+2;try{return new P.R({width:I,height:R},yield P.M(b,-1,-1,I,R))}catch{}}return P.h.getImageData(b,1)})}(u),y={uid:l.uid,coord:l.tileID,source:this.id,rawImageData:d,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};l.actor&&l.state!=="expired"||(l.actor=this.dispatcher.getActor(),l.actor.send("loadDEMTile",y,F))}}),this.map._refreshExpiredTiles)}_getNeighboringTiles(l){const g=l.canonical,S=Math.pow(2,g.z),k=(g.x-1+S)%S,F=g.x===0?l.wrap-1:l.wrap,Z=(g.x+1+S)%S,u=g.x+1===S?l.wrap+1:l.wrap,h={};return h[new P.O(l.overscaledZ,F,g.z,k,g.y).key]={backfilled:!1},h[new P.O(l.overscaledZ,u,g.z,Z,g.y).key]={backfilled:!1},g.y>0&&(h[new P.O(l.overscaledZ,F,g.z,k,g.y-1).key]={backfilled:!1},h[new P.O(l.overscaledZ,l.wrap,g.z,g.x,g.y-1).key]={backfilled:!1},h[new P.O(l.overscaledZ,u,g.z,Z,g.y-1).key]={backfilled:!1}),g.y+1<S&&(h[new P.O(l.overscaledZ,F,g.z,k,g.y+1).key]={backfilled:!1},h[new P.O(l.overscaledZ,l.wrap,g.z,g.x,g.y+1).key]={backfilled:!1},h[new P.O(l.overscaledZ,u,g.z,Z,g.y+1).key]={backfilled:!1}),h}unloadTile(l){l.demTexture&&this.map.painter.saveTileTexture(l.demTexture),l.fbo&&(l.fbo.destroy(),delete l.fbo),l.dem&&delete l.dem,delete l.neighboringTiles,l.state="unloaded",l.actor&&l.actor.send("removeDEMTile",{uid:l.uid,source:this.id})}}class nr extends P.E{constructor(l,g,S,k){super(),this.load=()=>{this._updateWorkerData()},this.serialize=()=>P.e({},this._options,{type:this.type,data:this._data}),this.id=l,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=S.getActor(),this.setEventedParent(k),this._data=g.data,this._options=P.e({},g),this._collectResourceTiming=g.collectResourceTiming,g.maxzoom!==void 0&&(this.maxzoom=g.maxzoom),g.type&&(this.type=g.type),g.attribution&&(this.attribution=g.attribution),this.promoteId=g.promoteId;const F=P.N/this.tileSize;this.workerOptions=P.e({source:this.id,cluster:g.cluster||!1,geojsonVtOptions:{buffer:(g.buffer!==void 0?g.buffer:128)*F,tolerance:(g.tolerance!==void 0?g.tolerance:.375)*F,extent:P.N,maxZoom:this.maxzoom,lineMetrics:g.lineMetrics||!1,generateId:g.generateId||!1},superclusterOptions:{maxZoom:g.clusterMaxZoom!==void 0?g.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,g.clusterMinPoints||2),extent:P.N,radius:(g.clusterRadius||50)*F,log:!1,generateId:g.generateId||!1},clusterProperties:g.clusterProperties,filter:g.filter},g.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}onAdd(l){this.map=l,this.load()}setData(l){return this._data=l,this._updateWorkerData(),this}updateData(l){return this._updateWorkerData(l),this}setClusterOptions(l){return this.workerOptions.cluster=l.cluster,l&&(l.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=l.clusterRadius),l.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=l.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(l,g){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:l,source:this.id},g),this}getClusterChildren(l,g){return this.actor.send("geojson.getClusterChildren",{clusterId:l,source:this.id},g),this}getClusterLeaves(l,g,S,k){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:l,limit:g,offset:S},k),this}_updateWorkerData(l){const g=P.e({},this.workerOptions);l?g.dataDiff=l:typeof this._data=="string"?(g.request=this.map._requestManager.transformRequest(P.h.resolveURL(this._data),dr.Source),g.request.collectResourceTiming=this._collectResourceTiming):g.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new P.k("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,g,(S,k)=>{if(this._pendingLoads--,this._removed||k&&k.abandoned)return void this.fire(new P.k("dataabort",{dataType:"source"}));let F=null;if(k&&k.resourceTiming&&k.resourceTiming[this.id]&&(F=k.resourceTiming[this.id].slice(0)),S)return void this.fire(new P.j(S));const Z={dataType:"source"};this._collectResourceTiming&&F&&F.length>0&&P.e(Z,{resourceTiming:F}),this.fire(new P.k("data",Object.assign(Object.assign({},Z),{sourceDataType:"metadata"}))),this.fire(new P.k("data",Object.assign(Object.assign({},Z),{sourceDataType:"content"})))})}loaded(){return this._pendingLoads===0}loadTile(l,g){const S=l.actor?"reloadTile":"loadTile";l.actor=this.actor;const k={type:this.type,uid:l.uid,tileID:l.tileID,zoom:l.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};l.request=this.actor.send(S,k,(F,Z)=>(delete l.request,l.unloadVectorData(),l.aborted?g(null):F?g(F):(l.loadVectorData(Z,this.map.painter,S==="reloadTile"),g(null))))}abortTile(l){l.request&&(l.request.cancel(),delete l.request),l.aborted=!0}unloadTile(l){l.unloadVectorData(),this.actor.send("removeTile",{uid:l.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}hasTransition(){return!1}}var _n=P.Q([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class cs extends P.E{constructor(l,g,S,k){super(),this.load=(F,Z)=>{this._loaded=!1,this.fire(new P.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=qr.getImage(this.map._requestManager.transformRequest(this.url,dr.Image),(u,h)=>{this._request=null,this._loaded=!0,u?this.fire(new P.j(u)):h&&(this.image=h,F&&(this.coordinates=F),Z&&Z(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||!this.image)return;const F=this.map.painter.context,Z=F.gl;this.boundsBuffer||(this.boundsBuffer=F.createVertexBuffer(this._boundsArray,_n.members)),this.boundsSegments||(this.boundsSegments=P.S.simpleSegment(0,0,4,2)),this.texture||(this.texture=new ct(F,this.image,Z.RGBA),this.texture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE));let u=!1;for(const h in this.tiles){const d=this.tiles[h];d.state!=="loaded"&&(d.state="loaded",d.texture=this.texture,u=!0)}u&&this.fire(new P.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"image",url:this.options.url,coordinates:this.coordinates}),this.id=l,this.dispatcher=S,this.coordinates=g.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(k),this.options=g}loaded(){return this._loaded}updateImage(l){return l.url?(this._request&&(this._request.cancel(),this._request=null),this.options.url=l.url,this.load(l.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new P.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(l){this.map=l,this.load()}onRemove(){this._request&&(this._request.cancel(),this._request=null)}setCoordinates(l){this.coordinates=l;const g=l.map(P.U.fromLngLat);this.tileID=function(k){let F=1/0,Z=1/0,u=-1/0,h=-1/0;for(const I of k)F=Math.min(F,I.x),Z=Math.min(Z,I.y),u=Math.max(u,I.x),h=Math.max(h,I.y);const d=Math.max(u-F,h-Z),y=Math.max(0,Math.floor(-Math.log(d)/Math.LN2)),b=Math.pow(2,y);return new P.W(y,Math.floor((F+u)/2*b),Math.floor((Z+h)/2*b))}(g),this.minzoom=this.maxzoom=this.tileID.z;const S=g.map(k=>this.tileID.getTilePoint(k)._round());return this._boundsArray=new P.V,this._boundsArray.emplaceBack(S[0].x,S[0].y,0,0),this._boundsArray.emplaceBack(S[1].x,S[1].y,P.N,0),this._boundsArray.emplaceBack(S[3].x,S[3].y,0,P.N),this._boundsArray.emplaceBack(S[2].x,S[2].y,P.N,P.N),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new P.k("data",{dataType:"source",sourceDataType:"content"})),this}loadTile(l,g){this.tileID&&this.tileID.equals(l.tileID.canonical)?(this.tiles[String(l.tileID.wrap)]=l,l.buckets={},g(null)):(l.state="errored",g(null))}hasTransition(){return!1}}class aa extends cs{constructor(l,g,S,k){super(l,g,S,k),this.load=()=>{this._loaded=!1;const F=this.options;this.urls=[];for(const Z of F.urls)this.urls.push(this.map._requestManager.transformRequest(Z,dr.Source).url);P.X(this.urls,(Z,u)=>{this._loaded=!0,Z?this.fire(new P.j(Z)):u&&(this.video=u,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const F=this.map.painter.context,Z=F.gl;this.boundsBuffer||(this.boundsBuffer=F.createVertexBuffer(this._boundsArray,_n.members)),this.boundsSegments||(this.boundsSegments=P.S.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE),Z.texSubImage2D(Z.TEXTURE_2D,0,0,0,Z.RGBA,Z.UNSIGNED_BYTE,this.video)):(this.texture=new ct(F,this.video,Z.RGBA),this.texture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE));let u=!1;for(const h in this.tiles){const d=this.tiles[h];d.state!=="loaded"&&(d.state="loaded",d.texture=this.texture,u=!0)}u&&this.fire(new P.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"video",urls:this.urls,coordinates:this.coordinates}),this.roundZoom=!0,this.type="video",this.options=g}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(l){if(this.video){const g=this.video.seekable;l<g.start(0)||l>g.end(0)?this.fire(new P.j(new P.Y(`sources.${this.id}`,null,`Playback for this video can be set only between the ${g.start(0)} and ${g.end(0)}-second mark.`))):this.video.currentTime=l}}getVideo(){return this.video}onAdd(l){this.map||(this.map=l,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}hasTransition(){return this.video&&!this.video.paused}}class Yo extends cs{constructor(l,g,S,k){super(l,g,S,k),this.load=()=>{this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new P.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},this.prepare=()=>{let F=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,F=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,F=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const Z=this.map.painter.context,u=Z.gl;this.boundsBuffer||(this.boundsBuffer=Z.createVertexBuffer(this._boundsArray,_n.members)),this.boundsSegments||(this.boundsSegments=P.S.simpleSegment(0,0,4,2)),this.texture?(F||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new ct(Z,this.canvas,u.RGBA,{premultiply:!0});let h=!1;for(const d in this.tiles){const y=this.tiles[d];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture,h=!0)}h&&this.fire(new P.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"canvas",coordinates:this.coordinates}),g.coordinates?Array.isArray(g.coordinates)&&g.coordinates.length===4&&!g.coordinates.some(F=>!Array.isArray(F)||F.length!==2||F.some(Z=>typeof Z!="number"))||this.fire(new P.j(new P.Y(`sources.${l}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new P.j(new P.Y(`sources.${l}`,null,'missing required property "coordinates"'))),g.animate&&typeof g.animate!="boolean"&&this.fire(new P.j(new P.Y(`sources.${l}`,null,'optional "animate" property must be a boolean value'))),g.canvas?typeof g.canvas=="string"||g.canvas instanceof HTMLCanvasElement||this.fire(new P.j(new P.Y(`sources.${l}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new P.j(new P.Y(`sources.${l}`,null,'missing required property "canvas"'))),this.options=g,this.animate=g.animate===void 0||g.animate}getCanvas(){return this.canvas}onAdd(l){this.map=l,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const l of[this.canvas.width,this.canvas.height])if(isNaN(l)||l<=0)return!0;return!1}}const Di={},Ir=z=>{switch(z){case"geojson":return nr;case"image":return cs;case"raster":return Zn;case"raster-dem":return Pt;case"vector":return Js;case"video":return aa;case"canvas":return Yo}return Di[z]};function $s(z,l){const g=P.Z();return P.$(g,g,[1,1,0]),P.a0(g,g,[.5*z.width,.5*z.height,1]),P.a1(g,g,z.calculatePosMatrix(l.toUnwrapped()))}function Cs(z,l,g,S,k,F){const Z=function(b,I,R){if(b)for(const N of b){const W=I[N];if(W&&W.source===R&&W.type==="fill-extrusion")return!0}else for(const N in I){const W=I[N];if(W.source===R&&W.type==="fill-extrusion")return!0}return!1}(k&&k.layers,l,z.id),u=F.maxPitchScaleFactor(),h=z.tilesIn(S,u,Z);h.sort(Zt);const d=[];for(const b of h)d.push({wrappedTileID:b.tileID.wrapped().key,queryResults:b.tile.queryRenderedFeatures(l,g,z._state,b.queryGeometry,b.cameraQueryGeometry,b.scale,k,F,u,$s(z.transform,b.tileID))});const y=function(b){const I={},R={};for(const N of b){const W=N.queryResults,K=N.wrappedTileID,le=R[K]=R[K]||{};for(const de in W){const ge=W[de],ke=le[de]=le[de]||{},Pe=I[de]=I[de]||[];for(const qe of ge)ke[qe.featureIndex]||(ke[qe.featureIndex]=!0,Pe.push(qe))}}return I}(d);for(const b in y)y[b].forEach(I=>{const R=I.feature,N=z.getFeatureState(R.layer["source-layer"],R.id);R.source=R.layer.source,R.layer["source-layer"]&&(R.sourceLayer=R.layer["source-layer"]),R.state=N});return y}function Zt(z,l){const g=z.tileID,S=l.tileID;return g.overscaledZ-S.overscaledZ||g.canonical.y-S.canonical.y||g.wrap-S.wrap||g.canonical.x-S.canonical.x}class Ue{constructor(l,g){this.timeAdded=0,this.fadeEndTime=0,this.tileID=l,this.uid=P.a2(),this.uses=0,this.tileSize=g,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(l){const g=l+this.timeAdded;g<this.fadeEndTime||(this.fadeEndTime=g)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(l){this.demTexture&&l.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(l,g,S){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",l){l.featureIndex&&(this.latestFeatureIndex=l.featureIndex,l.rawTileData?(this.latestRawTileData=l.rawTileData,this.latestFeatureIndex.rawTileData=l.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=l.collisionBoxArray,this.buckets=function(k,F){const Z={};if(!F)return Z;for(const u of k){const h=u.layerIds.map(d=>F.getLayer(d)).filter(Boolean);if(h.length!==0){u.layers=h,u.stateDependentLayerIds&&(u.stateDependentLayers=u.stateDependentLayerIds.map(d=>h.filter(y=>y.id===d)[0]));for(const d of h)Z[d.id]=u}}return Z}(l.buckets,g.style),this.hasSymbolBuckets=!1;for(const k in this.buckets){const F=this.buckets[k];if(F instanceof P.a4){if(this.hasSymbolBuckets=!0,!S)break;F.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const k in this.buckets){const F=this.buckets[k];if(F instanceof P.a4&&F.hasRTLText){this.hasRTLText=!0,P.a5();break}}this.queryPadding=0;for(const k in this.buckets){const F=this.buckets[k];this.queryPadding=Math.max(this.queryPadding,g.style.getLayer(k).queryRadius(F))}l.imageAtlas&&(this.imageAtlas=l.imageAtlas),l.glyphAtlasImage&&(this.glyphAtlasImage=l.glyphAtlasImage)}else this.collisionBoxArray=new P.a3}unloadVectorData(){for(const l in this.buckets)this.buckets[l].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(l){return this.buckets[l.id]}upload(l){for(const S in this.buckets){const k=this.buckets[S];k.uploadPending()&&k.upload(l)}const g=l.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ct(l,this.imageAtlas.image,g.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ct(l,this.glyphAtlasImage,g.ALPHA),this.glyphAtlasImage=null)}prepare(l){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(l,this.imageAtlasTexture)}queryRenderedFeatures(l,g,S,k,F,Z,u,h,d,y){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:k,cameraQueryGeometry:F,scale:Z,tileSize:this.tileSize,pixelPosMatrix:y,transform:h,params:u,queryPadding:this.queryPadding*d},l,g,S):{}}querySourceFeatures(l,g){const S=this.latestFeatureIndex;if(!S||!S.rawTileData)return;const k=S.loadVTLayers(),F=g&&g.sourceLayer?g.sourceLayer:"",Z=k._geojsonTileLayer||k[F];if(!Z)return;const u=P.a6(g&&g.filter),{z:h,x:d,y}=this.tileID.canonical,b={z:h,x:d,y};for(let I=0;I<Z.length;I++){const R=Z.feature(I);if(u.needGeometry){const K=P.a7(R,!0);if(!u.filter(new P.a8(this.tileID.overscaledZ),K,this.tileID.canonical))continue}else if(!u.filter(new P.a8(this.tileID.overscaledZ),R))continue;const N=S.getId(R,F),W=new P.a9(R,h,d,y,N);W.tile=b,l.push(W)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(l){const g=this.expirationTime;if(l.cacheControl){const S=P.aa(l.cacheControl);S["max-age"]&&(this.expirationTime=Date.now()+1e3*S["max-age"])}else l.expires&&(this.expirationTime=new Date(l.expires).getTime());if(this.expirationTime){const S=Date.now();let k=!1;if(this.expirationTime>S)k=!1;else if(g)if(this.expirationTime<g)k=!0;else{const F=this.expirationTime-g;F?this.expirationTime=S+Math.max(F,3e4):k=!0}else k=!0;k?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(l,g){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(l).length===0)return;const S=this.latestFeatureIndex.loadVTLayers();for(const k in this.buckets){if(!g.style.hasLayer(k))continue;const F=this.buckets[k],Z=F.layers[0].sourceLayer||"_geojsonTileLayer",u=S[Z],h=l[Z];if(!u||!h||Object.keys(h).length===0)continue;F.update(h,u,this.imageAtlas&&this.imageAtlas.patternPositions||{});const d=g&&g.style&&g.style.getLayer(k);d&&(this.queryPadding=Math.max(this.queryPadding,d.queryRadius(F)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<P.h.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(l){this.symbolFadeHoldUntil=P.h.now()+l}setDependencies(l,g){const S={};for(const k of g)S[k]=!0;this.dependencies[l]=S}hasDependency(l,g){for(const S of l){const k=this.dependencies[S];if(k){for(const F of g)if(k[F])return!0}}return!1}}class He{constructor(l,g){this.max=l,this.onRemove=g,this.reset()}reset(){for(const l in this.data)for(const g of this.data[l])g.timeout&&clearTimeout(g.timeout),this.onRemove(g.value);return this.data={},this.order=[],this}add(l,g,S){const k=l.wrapped().key;this.data[k]===void 0&&(this.data[k]=[]);const F={value:g,timeout:void 0};if(S!==void 0&&(F.timeout=setTimeout(()=>{this.remove(l,F)},S)),this.data[k].push(F),this.order.push(k),this.order.length>this.max){const Z=this._getAndRemoveByKey(this.order[0]);Z&&this.onRemove(Z)}return this}has(l){return l.wrapped().key in this.data}getAndRemove(l){return this.has(l)?this._getAndRemoveByKey(l.wrapped().key):null}_getAndRemoveByKey(l){const g=this.data[l].shift();return g.timeout&&clearTimeout(g.timeout),this.data[l].length===0&&delete this.data[l],this.order.splice(this.order.indexOf(l),1),g.value}getByKey(l){const g=this.data[l];return g?g[0].value:null}get(l){return this.has(l)?this.data[l.wrapped().key][0].value:null}remove(l,g){if(!this.has(l))return this;const S=l.wrapped().key,k=g===void 0?0:this.data[S].indexOf(g),F=this.data[S][k];return this.data[S].splice(k,1),F.timeout&&clearTimeout(F.timeout),this.data[S].length===0&&delete this.data[S],this.onRemove(F.value),this.order.splice(this.order.indexOf(S),1),this}setMaxSize(l){for(this.max=l;this.order.length>this.max;){const g=this._getAndRemoveByKey(this.order[0]);g&&this.onRemove(g)}return this}filter(l){const g=[];for(const S in this.data)for(const k of this.data[S])l(k.value)||g.push(k);for(const S of g)this.remove(S.value.tileID,S)}}class Be{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(l,g,S){const k=String(g);if(this.stateChanges[l]=this.stateChanges[l]||{},this.stateChanges[l][k]=this.stateChanges[l][k]||{},P.e(this.stateChanges[l][k],S),this.deletedStates[l]===null){this.deletedStates[l]={};for(const F in this.state[l])F!==k&&(this.deletedStates[l][F]=null)}else if(this.deletedStates[l]&&this.deletedStates[l][k]===null){this.deletedStates[l][k]={};for(const F in this.state[l][k])S[F]||(this.deletedStates[l][k][F]=null)}else for(const F in S)this.deletedStates[l]&&this.deletedStates[l][k]&&this.deletedStates[l][k][F]===null&&delete this.deletedStates[l][k][F]}removeFeatureState(l,g,S){if(this.deletedStates[l]===null)return;const k=String(g);if(this.deletedStates[l]=this.deletedStates[l]||{},S&&g!==void 0)this.deletedStates[l][k]!==null&&(this.deletedStates[l][k]=this.deletedStates[l][k]||{},this.deletedStates[l][k][S]=null);else if(g!==void 0)if(this.stateChanges[l]&&this.stateChanges[l][k])for(S in this.deletedStates[l][k]={},this.stateChanges[l][k])this.deletedStates[l][k][S]=null;else this.deletedStates[l][k]=null;else this.deletedStates[l]=null}getState(l,g){const S=String(g),k=P.e({},(this.state[l]||{})[S],(this.stateChanges[l]||{})[S]);if(this.deletedStates[l]===null)return{};if(this.deletedStates[l]){const F=this.deletedStates[l][g];if(F===null)return{};for(const Z in F)delete k[Z]}return k}initializeTileState(l,g){l.setFeatureState(this.state,g)}coalesceChanges(l,g){const S={};for(const k in this.stateChanges){this.state[k]=this.state[k]||{};const F={};for(const Z in this.stateChanges[k])this.state[k][Z]||(this.state[k][Z]={}),P.e(this.state[k][Z],this.stateChanges[k][Z]),F[Z]=this.state[k][Z];S[k]=F}for(const k in this.deletedStates){this.state[k]=this.state[k]||{};const F={};if(this.deletedStates[k]===null)for(const Z in this.state[k])F[Z]={},this.state[k][Z]={};else for(const Z in this.deletedStates[k]){if(this.deletedStates[k][Z]===null)this.state[k][Z]={};else for(const u of Object.keys(this.deletedStates[k][Z]))delete this.state[k][Z][u];F[Z]=this.state[k][Z]}S[k]=S[k]||{},P.e(S[k],F)}if(this.stateChanges={},this.deletedStates={},Object.keys(S).length!==0)for(const k in l)l[k].setFeatureState(S,g)}}class Rt extends P.E{constructor(l,g,S){super(),this.id=l,this.dispatcher=S,this.on("data",k=>{k.dataType==="source"&&k.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&k.dataType==="source"&&k.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((k,F,Z,u)=>{const h=new(Ir(F.type))(k,F,Z,u);if(h.id!==k)throw new Error(`Expected Source id to be ${k} instead of ${h.id}`);return h})(l,g,S,this),this._tiles={},this._cache=new He(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Be,this._didEmitContent=!1,this._updated=!1}onAdd(l){this.map=l,this._maxTileCacheSize=l?l._maxTileCacheSize:null,this._maxTileCacheZoomLevels=l?l._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(l)}onRemove(l){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(l)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const l in this._tiles){const g=this._tiles[l];if(g.state!=="loaded"&&g.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const l=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,l&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(l,g){return this._source.loadTile(l,g)}_unloadTile(l){if(this._source.unloadTile)return this._source.unloadTile(l,()=>{})}_abortTile(l){this._source.abortTile&&this._source.abortTile(l,()=>{}),this._source.fire(new P.k("dataabort",{tile:l,coord:l.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(l){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const g in this._tiles){const S=this._tiles[g];S.upload(l),S.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(l=>l.tileID).sort(Qt).map(l=>l.key)}getRenderableIds(l){const g=[];for(const S in this._tiles)this._isIdRenderable(S,l)&&g.push(this._tiles[S]);return l?g.sort((S,k)=>{const F=S.tileID,Z=k.tileID,u=new P.P(F.canonical.x,F.canonical.y)._rotate(this.transform.angle),h=new P.P(Z.canonical.x,Z.canonical.y)._rotate(this.transform.angle);return F.overscaledZ-Z.overscaledZ||h.y-u.y||h.x-u.x}).map(S=>S.tileID.key):g.map(S=>S.tileID).sort(Qt).map(S=>S.key)}hasRenderableParent(l){const g=this.findLoadedParent(l,0);return!!g&&this._isIdRenderable(g.tileID.key)}_isIdRenderable(l,g){return this._tiles[l]&&this._tiles[l].hasData()&&!this._coveredTiles[l]&&(g||!this._tiles[l].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const l in this._tiles)this._tiles[l].state!=="errored"&&this._reloadTile(l,"reloading")}}_reloadTile(l,g){const S=this._tiles[l];S&&(S.state!=="loading"&&(S.state=g),this._loadTile(S,this._tileLoaded.bind(this,S,l,g)))}_tileLoaded(l,g,S,k){if(k)return l.state="errored",void(k.status!==404?this._source.fire(new P.j(k,{tile:l})):this.update(this.transform,this.terrain));l.timeAdded=P.h.now(),S==="expired"&&(l.refreshedUponExpiration=!0),this._setTileReloadTimer(g,l),this.getSource().type==="raster-dem"&&l.dem&&this._backfillDEM(l),this._state.initializeTileState(l,this.map?this.map.painter:null),l.aborted||this._source.fire(new P.k("data",{dataType:"source",tile:l,coord:l.tileID}))}_backfillDEM(l){const g=this.getRenderableIds();for(let k=0;k<g.length;k++){const F=g[k];if(l.neighboringTiles&&l.neighboringTiles[F]){const Z=this.getTileByID(F);S(l,Z),S(Z,l)}}function S(k,F){k.needsHillshadePrepare=!0,k.needsTerrainPrepare=!0;let Z=F.tileID.canonical.x-k.tileID.canonical.x;const u=F.tileID.canonical.y-k.tileID.canonical.y,h=Math.pow(2,k.tileID.canonical.z),d=F.tileID.key;Z===0&&u===0||Math.abs(u)>1||(Math.abs(Z)>1&&(Math.abs(Z+h)===1?Z+=h:Math.abs(Z-h)===1&&(Z-=h)),F.dem&&k.dem&&(k.dem.backfillBorder(F.dem,Z,u),k.neighboringTiles&&k.neighboringTiles[d]&&(k.neighboringTiles[d].backfilled=!0)))}}getTile(l){return this.getTileByID(l.key)}getTileByID(l){return this._tiles[l]}_retainLoadedChildren(l,g,S,k){for(const F in this._tiles){let Z=this._tiles[F];if(k[F]||!Z.hasData()||Z.tileID.overscaledZ<=g||Z.tileID.overscaledZ>S)continue;let u=Z.tileID;for(;Z&&Z.tileID.overscaledZ>g+1;){const d=Z.tileID.scaledTo(Z.tileID.overscaledZ-1);Z=this._tiles[d.key],Z&&Z.hasData()&&(u=d)}let h=u;for(;h.overscaledZ>g;)if(h=h.scaledTo(h.overscaledZ-1),l[h.key]){k[u.key]=u;break}}}findLoadedParent(l,g){if(l.key in this._loadedParentTiles){const S=this._loadedParentTiles[l.key];return S&&S.tileID.overscaledZ>=g?S:null}for(let S=l.overscaledZ-1;S>=g;S--){const k=l.scaledTo(S),F=this._getLoadedTile(k);if(F)return F}}_getLoadedTile(l){const g=this._tiles[l.key];return g&&g.hasData()?g:this._cache.getByKey(l.wrapped().key)}updateCacheSize(l){const g=Math.ceil(l.width/this._source.tileSize)+1,S=Math.ceil(l.height/this._source.tileSize)+1,k=Math.floor(g*S*(this._maxTileCacheZoomLevels===null?P.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),F=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,k):k;this._cache.setMaxSize(F)}handleWrapJump(l){const g=Math.round((l-(this._prevLng===void 0?l:this._prevLng))/360);if(this._prevLng=l,g){const S={};for(const k in this._tiles){const F=this._tiles[k];F.tileID=F.tileID.unwrapTo(F.tileID.wrap+g),S[F.tileID.key]=F}this._tiles=S;for(const k in this._timers)clearTimeout(this._timers[k]),delete this._timers[k];for(const k in this._tiles)this._setTileReloadTimer(k,this._tiles[k])}}update(l,g){if(this.transform=l,this.terrain=g,!this._sourceLoaded||this._paused)return;let S;this.updateCacheSize(l),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?S=l.getVisibleUnwrappedCoordinates(this._source.tileID).map(y=>new P.O(y.canonical.z,y.wrap,y.canonical.z,y.canonical.x,y.canonical.y)):(S=l.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:g}),this._source.hasTile&&(S=S.filter(y=>this._source.hasTile(y)))):S=[];const k=l.coveringZoomLevel(this._source),F=Math.max(k-Rt.maxOverzooming,this._source.minzoom),Z=Math.max(k+Rt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const y={};for(const b of S)if(b.canonical.z>this._source.minzoom){const I=b.scaledTo(b.canonical.z-1);y[I.key]=I;const R=b.scaledTo(Math.max(this._source.minzoom,Math.min(b.canonical.z,5)));y[R.key]=R}S=S.concat(Object.values(y))}const u=S.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,u&&this.fire(new P.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const h=this._updateRetainedTiles(S,k);if(ii(this._source.type)){const y={},b={},I=Object.keys(h),R=P.h.now();for(const N of I){const W=h[N],K=this._tiles[N];if(!K||K.fadeEndTime!==0&&K.fadeEndTime<=R)continue;const le=this.findLoadedParent(W,F);le&&(this._addTile(le.tileID),y[le.tileID.key]=le.tileID),b[N]=W}this._retainLoadedChildren(b,k,Z,h);for(const N in y)h[N]||(this._coveredTiles[N]=!0,h[N]=y[N]);if(g){const N={},W={};for(const K of S)this._tiles[K.key].hasData()?N[K.key]=K:W[K.key]=K;for(const K in W){const le=W[K].children(this._source.maxzoom);this._tiles[le[0].key]&&this._tiles[le[1].key]&&this._tiles[le[2].key]&&this._tiles[le[3].key]&&(N[le[0].key]=h[le[0].key]=le[0],N[le[1].key]=h[le[1].key]=le[1],N[le[2].key]=h[le[2].key]=le[2],N[le[3].key]=h[le[3].key]=le[3],delete W[K])}for(const K in W){const le=this.findLoadedParent(W[K],this._source.minzoom);if(le){N[le.tileID.key]=h[le.tileID.key]=le.tileID;for(const de in N)N[de].isChildOf(le.tileID)&&delete N[de]}}for(const K in this._tiles)N[K]||(this._coveredTiles[K]=!0)}}for(const y in h)this._tiles[y].clearFadeHold();const d=P.ab(this._tiles,h);for(const y of d){const b=this._tiles[y];b.hasSymbolBuckets&&!b.holdingForFade()?b.setHoldDuration(this.map._fadeDuration):b.hasSymbolBuckets&&!b.symbolFadeFinished()||this._removeTile(y)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const l in this._tiles)this._tiles[l].holdingForFade()&&this._removeTile(l)}_updateRetainedTiles(l,g){const S={},k={},F=Math.max(g-Rt.maxOverzooming,this._source.minzoom),Z=Math.max(g+Rt.maxUnderzooming,this._source.minzoom),u={};for(const h of l){const d=this._addTile(h);S[h.key]=h,d.hasData()||g<this._source.maxzoom&&(u[h.key]=h)}this._retainLoadedChildren(u,g,Z,S);for(const h of l){let d=this._tiles[h.key];if(d.hasData())continue;if(g+1>this._source.maxzoom){const b=h.children(this._source.maxzoom)[0],I=this.getTile(b);if(I&&I.hasData()){S[b.key]=b;continue}}else{const b=h.children(this._source.maxzoom);if(S[b[0].key]&&S[b[1].key]&&S[b[2].key]&&S[b[3].key])continue}let y=d.wasRequested();for(let b=h.overscaledZ-1;b>=F;--b){const I=h.scaledTo(b);if(k[I.key])break;if(k[I.key]=!0,d=this.getTile(I),!d&&y&&(d=this._addTile(I)),d){const R=d.hasData();if((y||R)&&(S[I.key]=I),y=d.wasRequested(),R)break}}}return S}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const l in this._tiles){const g=[];let S,k=this._tiles[l].tileID;for(;k.overscaledZ>0;){if(k.key in this._loadedParentTiles){S=this._loadedParentTiles[k.key];break}g.push(k.key);const F=k.scaledTo(k.overscaledZ-1);if(S=this._getLoadedTile(F),S)break;k=F}for(const F of g)this._loadedParentTiles[F]=S}}_addTile(l){let g=this._tiles[l.key];if(g)return g;g=this._cache.getAndRemove(l),g&&(this._setTileReloadTimer(l.key,g),g.tileID=l,this._state.initializeTileState(g,this.map?this.map.painter:null),this._cacheTimers[l.key]&&(clearTimeout(this._cacheTimers[l.key]),delete this._cacheTimers[l.key],this._setTileReloadTimer(l.key,g)));const S=g;return g||(g=new Ue(l,this._source.tileSize*l.overscaleFactor()),this._loadTile(g,this._tileLoaded.bind(this,g,l.key,g.state))),g.uses++,this._tiles[l.key]=g,S||this._source.fire(new P.k("dataloading",{tile:g,coord:g.tileID,dataType:"source"})),g}_setTileReloadTimer(l,g){l in this._timers&&(clearTimeout(this._timers[l]),delete this._timers[l]);const S=g.getExpiryTimeout();S&&(this._timers[l]=setTimeout(()=>{this._reloadTile(l,"expired"),delete this._timers[l]},S))}_removeTile(l){const g=this._tiles[l];g&&(g.uses--,delete this._tiles[l],this._timers[l]&&(clearTimeout(this._timers[l]),delete this._timers[l]),g.uses>0||(g.hasData()&&g.state!=="reloading"?this._cache.add(g.tileID,g,g.getExpiryTimeout()):(g.aborted=!0,this._abortTile(g),this._unloadTile(g))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const l in this._tiles)this._removeTile(l);this._cache.reset()}tilesIn(l,g,S){const k=[],F=this.transform;if(!F)return k;const Z=S?F.getCameraQueryGeometry(l):l,u=l.map(N=>F.pointCoordinate(N,this.terrain)),h=Z.map(N=>F.pointCoordinate(N,this.terrain)),d=this.getIds();let y=1/0,b=1/0,I=-1/0,R=-1/0;for(const N of h)y=Math.min(y,N.x),b=Math.min(b,N.y),I=Math.max(I,N.x),R=Math.max(R,N.y);for(let N=0;N<d.length;N++){const W=this._tiles[d[N]];if(W.holdingForFade())continue;const K=W.tileID,le=Math.pow(2,F.zoom-W.tileID.overscaledZ),de=g*W.queryPadding*P.N/W.tileSize/le,ge=[K.getTilePoint(new P.U(y,b)),K.getTilePoint(new P.U(I,R))];if(ge[0].x-de<P.N&&ge[0].y-de<P.N&&ge[1].x+de>=0&&ge[1].y+de>=0){const ke=u.map(qe=>K.getTilePoint(qe)),Pe=h.map(qe=>K.getTilePoint(qe));k.push({tile:W,tileID:K,queryGeometry:ke,cameraQueryGeometry:Pe,scale:le})}}return k}getVisibleCoordinates(l){const g=this.getRenderableIds(l).map(S=>this._tiles[S].tileID);for(const S of g)S.posMatrix=this.transform.calculatePosMatrix(S.toUnwrapped());return g}hasTransition(){if(this._source.hasTransition())return!0;if(ii(this._source.type)){const l=P.h.now();for(const g in this._tiles)if(this._tiles[g].fadeEndTime>=l)return!0}return!1}setFeatureState(l,g,S){this._state.updateState(l=l||"_geojsonTileLayer",g,S)}removeFeatureState(l,g,S){this._state.removeFeatureState(l=l||"_geojsonTileLayer",g,S)}getFeatureState(l,g){return this._state.getState(l=l||"_geojsonTileLayer",g)}setDependencies(l,g,S){const k=this._tiles[l];k&&k.setDependencies(g,S)}reloadTilesForDependencies(l,g){for(const S in this._tiles)this._tiles[S].hasDependency(l,g)&&this._reloadTile(S,"reloading");this._cache.filter(S=>!S.hasDependency(l,g))}}function Qt(z,l){const g=Math.abs(2*z.wrap)-+(z.wrap<0),S=Math.abs(2*l.wrap)-+(l.wrap<0);return z.overscaledZ-l.overscaledZ||S-g||l.canonical.y-z.canonical.y||l.canonical.x-z.canonical.x}function ii(z){return z==="raster"||z==="image"||z==="video"}Rt.maxOverzooming=10,Rt.maxUnderzooming=3;const ti="mapboxgl_preloaded_worker_pool";class Ht{constructor(){this.active={}}acquire(l){if(!this.workers)for(this.workers=[];this.workers.length<Ht.workerCount;)this.workers.push(new Worker(P.c.WORKER_URL));return this.active[l]=!0,this.workers.slice()}release(l){delete this.active[l],this.numActive()===0&&(this.workers.forEach(g=>{g.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[ti]}numActive(){return Object.keys(this.active).length}}const Ri=Math.floor(P.h.hardwareConcurrency/2);let Zi;function Yi(){return Zi||(Zi=new Ht),Zi}Ht.workerCount=P.ac(globalThis)?Math.max(Math.min(Ri,3),1):1;class Yr{constructor(l,g){this.reset(l,g)}reset(l,g){this.points=l||[],this._distances=[0];for(let S=1;S<this.points.length;S++)this._distances[S]=this._distances[S-1]+this.points[S].dist(this.points[S-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(g||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(l){if(this.points.length===1)return this.points[0];l=P.ad(l,0,1);let g=1,S=this._distances[g];const k=l*this.paddedLength+this.padding;for(;S<k&&g<this._distances.length;)S=this._distances[++g];const F=g-1,Z=this._distances[F],u=S-Z,h=u>0?(k-Z)/u:0;return this.points[F].mult(1-h).add(this.points[g].mult(h))}}function gn(z,l){let g=!0;return z==="always"||z!=="never"&&l!=="never"||(g=!1),g}class rs{constructor(l,g,S){const k=this.boxCells=[],F=this.circleCells=[];this.xCellCount=Math.ceil(l/S),this.yCellCount=Math.ceil(g/S);for(let Z=0;Z<this.xCellCount*this.yCellCount;Z++)k.push([]),F.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=g,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/g,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(l,g,S,k,F){this._forEachCell(g,S,k,F,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(g),this.bboxes.push(S),this.bboxes.push(k),this.bboxes.push(F)}insertCircle(l,g,S,k){this._forEachCell(g-k,S-k,g+k,S+k,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(g),this.circles.push(S),this.circles.push(k)}_insertBoxCell(l,g,S,k,F,Z){this.boxCells[F].push(Z)}_insertCircleCell(l,g,S,k,F,Z){this.circleCells[F].push(Z)}_query(l,g,S,k,F,Z,u){if(S<0||l>this.width||k<0||g>this.height)return[];const h=[];if(l<=0&&g<=0&&this.width<=S&&this.height<=k){if(F)return[{key:null,x1:l,y1:g,x2:S,y2:k}];for(let d=0;d<this.boxKeys.length;d++)h.push({key:this.boxKeys[d],x1:this.bboxes[4*d],y1:this.bboxes[4*d+1],x2:this.bboxes[4*d+2],y2:this.bboxes[4*d+3]});for(let d=0;d<this.circleKeys.length;d++){const y=this.circles[3*d],b=this.circles[3*d+1],I=this.circles[3*d+2];h.push({key:this.circleKeys[d],x1:y-I,y1:b-I,x2:y+I,y2:b+I})}}else this._forEachCell(l,g,S,k,this._queryCell,h,{hitTest:F,overlapMode:Z,seenUids:{box:{},circle:{}}},u);return h}query(l,g,S,k){return this._query(l,g,S,k,!1,null)}hitTest(l,g,S,k,F,Z){return this._query(l,g,S,k,!0,F,Z).length>0}hitTestCircle(l,g,S,k,F){const Z=l-S,u=l+S,h=g-S,d=g+S;if(u<0||Z>this.width||d<0||h>this.height)return!1;const y=[];return this._forEachCell(Z,h,u,d,this._queryCellCircle,y,{hitTest:!0,overlapMode:k,circle:{x:l,y:g,radius:S},seenUids:{box:{},circle:{}}},F),y.length>0}_queryCell(l,g,S,k,F,Z,u,h){const{seenUids:d,hitTest:y,overlapMode:b}=u,I=this.boxCells[F];if(I!==null){const N=this.bboxes;for(const W of I)if(!d.box[W]){d.box[W]=!0;const K=4*W,le=this.boxKeys[W];if(l<=N[K+2]&&g<=N[K+3]&&S>=N[K+0]&&k>=N[K+1]&&(!h||h(le))&&(!y||!gn(b,le.overlapMode))&&(Z.push({key:le,x1:N[K],y1:N[K+1],x2:N[K+2],y2:N[K+3]}),y))return!0}}const R=this.circleCells[F];if(R!==null){const N=this.circles;for(const W of R)if(!d.circle[W]){d.circle[W]=!0;const K=3*W,le=this.circleKeys[W];if(this._circleAndRectCollide(N[K],N[K+1],N[K+2],l,g,S,k)&&(!h||h(le))&&(!y||!gn(b,le.overlapMode))){const de=N[K],ge=N[K+1],ke=N[K+2];if(Z.push({key:le,x1:de-ke,y1:ge-ke,x2:de+ke,y2:ge+ke}),y)return!0}}}return!1}_queryCellCircle(l,g,S,k,F,Z,u,h){const{circle:d,seenUids:y,overlapMode:b}=u,I=this.boxCells[F];if(I!==null){const N=this.bboxes;for(const W of I)if(!y.box[W]){y.box[W]=!0;const K=4*W,le=this.boxKeys[W];if(this._circleAndRectCollide(d.x,d.y,d.radius,N[K+0],N[K+1],N[K+2],N[K+3])&&(!h||h(le))&&!gn(b,le.overlapMode))return Z.push(!0),!0}}const R=this.circleCells[F];if(R!==null){const N=this.circles;for(const W of R)if(!y.circle[W]){y.circle[W]=!0;const K=3*W,le=this.circleKeys[W];if(this._circlesCollide(N[K],N[K+1],N[K+2],d.x,d.y,d.radius)&&(!h||h(le))&&!gn(b,le.overlapMode))return Z.push(!0),!0}}}_forEachCell(l,g,S,k,F,Z,u,h){const d=this._convertToXCellCoord(l),y=this._convertToYCellCoord(g),b=this._convertToXCellCoord(S),I=this._convertToYCellCoord(k);for(let R=d;R<=b;R++)for(let N=y;N<=I;N++)if(F.call(this,l,g,S,k,this.xCellCount*N+R,Z,u,h))return}_convertToXCellCoord(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))}_convertToYCellCoord(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))}_circlesCollide(l,g,S,k,F,Z){const u=k-l,h=F-g,d=S+Z;return d*d>u*u+h*h}_circleAndRectCollide(l,g,S,k,F,Z,u){const h=(Z-k)/2,d=Math.abs(l-(k+h));if(d>h+S)return!1;const y=(u-F)/2,b=Math.abs(g-(F+y));if(b>y+S)return!1;if(d<=h||b<=y)return!0;const I=d-h,R=b-y;return I*I+R*R<=S*S}}function ni(z,l,g,S,k){const F=P.Z();return l?(P.a0(F,F,[1/k,1/k,1]),g||P.ae(F,F,S.angle)):P.a1(F,S.labelPlaneMatrix,z),F}function yn(z,l,g,S,k){if(l){const F=P.af(z);return P.a0(F,F,[k,k,1]),g||P.ae(F,F,-S.angle),F}return S.glCoordMatrix}function vr(z,l,g){let S;g?(S=[z.x,z.y,g(z.x,z.y),1],P.ag(S,S,l)):(S=[z.x,z.y,0,1],Le(S,S,l));const k=S[3];return{point:new P.P(S[0]/k,S[1]/k),signedDistanceFromCamera:k}}function bs(z,l){return .5+z/l*.5}function us(z,l){const g=z[0]/z[3],S=z[1]/z[3];return g>=-l[0]&&g<=l[0]&&S>=-l[1]&&S<=l[1]}function pi(z,l,g,S,k,F,Z,u,h,d){const y=S?z.textSizeData:z.iconSizeData,b=P.ah(y,g.transform.zoom),I=[256/g.width*2+1,256/g.height*2+1],R=S?z.text.dynamicLayoutVertexArray:z.icon.dynamicLayoutVertexArray;R.clear();const N=z.lineVertexArray,W=S?z.text.placedSymbolArray:z.icon.placedSymbolArray,K=g.transform.width/g.transform.height;let le=!1;for(let de=0;de<W.length;de++){const ge=W.get(de);if(ge.hidden||ge.writingMode===P.ai.vertical&&!le){Me(ge.numGlyphs,R);continue}let ke;if(le=!1,d?(ke=[ge.anchorX,ge.anchorY,d(ge.anchorX,ge.anchorY),1],P.ag(ke,ke,l)):(ke=[ge.anchorX,ge.anchorY,0,1],Le(ke,ke,l)),!us(ke,I)){Me(ge.numGlyphs,R);continue}const Pe=bs(g.transform.cameraToCenterDistance,ke[3]),qe=P.aj(y,b,ge),ht=Z?qe/Pe:qe*Pe,mt=new P.P(ge.anchorX,ge.anchorY),ot=vr(mt,k,d).point,ft={projections:{},offsets:{}},dt=zn(ge,ht,!1,u,l,k,F,z.glyphOffsetArray,N,R,ot,mt,ft,K,h,d);le=dt.useVertical,(dt.notEnoughRoom||le||dt.needsFlipping&&zn(ge,ht,!0,u,l,k,F,z.glyphOffsetArray,N,R,ot,mt,ft,K,h,d).notEnoughRoom)&&Me(ge.numGlyphs,R)}S?z.text.dynamicLayoutVertexBuffer.updateData(R):z.icon.dynamicLayoutVertexBuffer.updateData(R)}function br(z,l,g,S,k,F,Z,u,h,d,y,b,I){const R=u.glyphStartIndex+u.numGlyphs,N=u.lineStartIndex,W=u.lineStartIndex+u.lineLength,K=l.getoffsetX(u.glyphStartIndex),le=l.getoffsetX(R-1),de=Ae(z*K,g,S,k,F,Z,u.segment,N,W,h,d,y,b,I);if(!de)return null;const ge=Ae(z*le,g,S,k,F,Z,u.segment,N,W,h,d,y,b,I);return ge?{first:de,last:ge}:null}function wr(z,l,g,S){return z===P.ai.horizontal&&Math.abs(g.y-l.y)>Math.abs(g.x-l.x)*S?{useVertical:!0}:(z===P.ai.vertical?l.y<g.y:l.x>g.x)?{needsFlipping:!0}:null}function zn(z,l,g,S,k,F,Z,u,h,d,y,b,I,R,N,W){const K=l/24,le=z.lineOffsetX*K,de=z.lineOffsetY*K;let ge;if(z.numGlyphs>1){const ke=z.glyphStartIndex+z.numGlyphs,Pe=z.lineStartIndex,qe=z.lineStartIndex+z.lineLength,ht=br(K,u,le,de,g,y,b,z,h,F,I,N,W);if(!ht)return{notEnoughRoom:!0};const mt=vr(ht.first.point,Z,W).point,ot=vr(ht.last.point,Z,W).point;if(S&&!g){const ft=wr(z.writingMode,mt,ot,R);if(ft)return ft}ge=[ht.first];for(let ft=z.glyphStartIndex+1;ft<ke-1;ft++)ge.push(Ae(K*u.getoffsetX(ft),le,de,g,y,b,z.segment,Pe,qe,h,F,I,N,W));ge.push(ht.last)}else{if(S&&!g){const Pe=vr(b,k,W).point,qe=z.lineStartIndex+z.segment+1,ht=new P.P(h.getx(qe),h.gety(qe)),mt=vr(ht,k,W),ot=mt.signedDistanceFromCamera>0?mt.point:co(b,ht,Pe,1,k,W),ft=wr(z.writingMode,Pe,ot,R);if(ft)return ft}const ke=Ae(K*u.getoffsetX(z.glyphStartIndex),le,de,g,y,b,z.segment,z.lineStartIndex,z.lineStartIndex+z.lineLength,h,F,I,N,W);if(!ke)return{notEnoughRoom:!0};ge=[ke]}for(const ke of ge)P.ak(d,ke.point,ke.angle);return{}}function co(z,l,g,S,k,F){const Z=vr(z.add(z.sub(l)._unit()),k,F).point,u=g.sub(Z);return g.add(u._mult(S/u.mag()))}function Sr(z,l){const{projectionCache:g,lineVertexArray:S,labelPlaneMatrix:k,tileAnchorPoint:F,distanceFromAnchor:Z,getElevation:u,previousVertex:h,direction:d,absOffsetX:y}=l;if(g.projections[z])return g.projections[z];const b=new P.P(S.getx(z),S.gety(z)),I=vr(b,k,u);if(I.signedDistanceFromCamera>0)return g.projections[z]=I.point,I.point;const R=z-d;return co(Z===0?F:new P.P(S.getx(R),S.gety(R)),b,h,y-Z+1,k,u)}function kt(z,l,g){return z._unit()._perp()._mult(l*g)}function we(z,l,g,S,k,F,Z,u){const{projectionCache:h,direction:d}=u;if(h.offsets[z])return h.offsets[z];const y=g.add(l);if(z+d<S||z+d>=k)return h.offsets[z]=y,y;const b=Sr(z+d,u),I=kt(b.sub(g),Z,d),R=g.add(I),N=b.add(I);return h.offsets[z]=P.al(F,y,R,N)||y,h.offsets[z]}function Ae(z,l,g,S,k,F,Z,u,h,d,y,b,I,R){const N=S?z-l:z+l;let W=N>0?1:-1,K=0;S&&(W*=-1,K=Math.PI),W<0&&(K+=Math.PI);let le,de,ge=W>0?u+Z:u+Z+1,ke=k,Pe=k,qe=0,ht=0;const mt=Math.abs(N),ot=[];let ft;for(;qe+ht<=mt;){if(ge+=W,ge<u||ge>=h)return null;qe+=ht,Pe=ke,de=le;const Ut={projectionCache:b,lineVertexArray:d,labelPlaneMatrix:y,tileAnchorPoint:F,distanceFromAnchor:qe,getElevation:R,previousVertex:Pe,direction:W,absOffsetX:mt};if(ke=Sr(ge,Ut),g===0)ot.push(Pe),ft=ke.sub(Pe);else{let Xt;const qt=ke.sub(Pe);Xt=qt.mag()===0?kt(Sr(ge+W,Ut).sub(ke),g,W):kt(qt,g,W),de||(de=Pe.add(Xt)),le=we(ge,Xt,ke,u,h,de,g,Ut),ot.push(de),ft=le.sub(de)}ht=ft.mag()}const dt=ft._mult((mt-qe)/ht)._add(de||Pe),ai=K+Math.atan2(ke.y-Pe.y,ke.x-Pe.x);return ot.push(dt),{point:dt,angle:I?ai:0,path:ot}}const pe=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Me(z,l){for(let g=0;g<z;g++){const S=l.length;l.resize(S+4),l.float32.set(pe,3*S)}}function Le(z,l,g){const S=l[0],k=l[1];return z[0]=g[0]*S+g[4]*k+g[12],z[1]=g[1]*S+g[5]*k+g[13],z[3]=g[3]*S+g[7]*k+g[15],z}const Ne=100;class $e{constructor(l,g=new rs(l.width+200,l.height+200,25),S=new rs(l.width+200,l.height+200,25)){this.transform=l,this.grid=g,this.ignoredGrid=S,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+Ne,this.screenBottomBoundary=l.height+Ne,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(l,g,S,k,F,Z){const u=this.projectAndGetPerspectiveRatio(k,l.anchorPointX,l.anchorPointY,Z),h=S*u.perspectiveRatio,d=l.x1*h+u.point.x,y=l.y1*h+u.point.y,b=l.x2*h+u.point.x,I=l.y2*h+u.point.y;return!this.isInsideGrid(d,y,b,I)||g!=="always"&&this.grid.hitTest(d,y,b,I,g,F)||u.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[d,y,b,I],offscreen:this.isOffscreen(d,y,b,I)}}placeCollisionCircles(l,g,S,k,F,Z,u,h,d,y,b,I,R,N){const W=[],K=new P.P(g.anchorX,g.anchorY),le=vr(K,Z,N),de=bs(this.transform.cameraToCenterDistance,le.signedDistanceFromCamera),ge=(y?F/de:F*de)/P.ap,ke=vr(K,u,N).point,Pe=br(ge,k,g.lineOffsetX*ge,g.lineOffsetY*ge,!1,ke,K,g,S,u,{projections:{},offsets:{}},!1,N);let qe=!1,ht=!1,mt=!0;if(Pe){const ot=.5*I*de+R,ft=new P.P(-100,-100),dt=new P.P(this.screenRightBoundary,this.screenBottomBoundary),ai=new Yr,Ut=Pe.first,Xt=Pe.last;let qt=[];for(let ji=Ut.path.length-1;ji>=1;ji--)qt.push(Ut.path[ji]);for(let ji=1;ji<Xt.path.length;ji++)qt.push(Xt.path[ji]);const or=2.5*ot;if(h){const ji=qt.map(Li=>vr(Li,h,N));qt=ji.some(Li=>Li.signedDistanceFromCamera<=0)?[]:ji.map(Li=>Li.point)}let qi=[];if(qt.length>0){const ji=qt[0].clone(),Li=qt[0].clone();for(let ir=1;ir<qt.length;ir++)ji.x=Math.min(ji.x,qt[ir].x),ji.y=Math.min(ji.y,qt[ir].y),Li.x=Math.max(Li.x,qt[ir].x),Li.y=Math.max(Li.y,qt[ir].y);qi=ji.x>=ft.x&&Li.x<=dt.x&&ji.y>=ft.y&&Li.y<=dt.y?[qt]:Li.x<ft.x||ji.x>dt.x||Li.y<ft.y||ji.y>dt.y?[]:P.am([qt],ft.x,ft.y,dt.x,dt.y)}for(const ji of qi){ai.reset(ji,.25*ot);let Li=0;Li=ai.length<=.5*ot?1:Math.ceil(ai.paddedLength/or)+1;for(let ir=0;ir<Li;ir++){const Ji=ir/Math.max(Li-1,1),Or=ai.lerp(Ji),Xi=Or.x+Ne,Lr=Or.y+Ne;W.push(Xi,Lr,ot,0);const Bn=Xi-ot,is=Lr-ot,Ml=Xi+ot,Sl=Lr+ot;if(mt=mt&&this.isOffscreen(Bn,is,Ml,Sl),ht=ht||this.isInsideGrid(Bn,is,Ml,Sl),l!=="always"&&this.grid.hitTestCircle(Xi,Lr,ot,l,b)&&(qe=!0,!d))return{circles:[],offscreen:!1,collisionDetected:qe}}}}return{circles:!d&&qe||!ht||de<this.perspectiveRatioCutoff?[]:W,offscreen:mt,collisionDetected:qe}}queryRenderedSymbols(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const g=[];let S=1/0,k=1/0,F=-1/0,Z=-1/0;for(const y of l){const b=new P.P(y.x+Ne,y.y+Ne);S=Math.min(S,b.x),k=Math.min(k,b.y),F=Math.max(F,b.x),Z=Math.max(Z,b.y),g.push(b)}const u=this.grid.query(S,k,F,Z).concat(this.ignoredGrid.query(S,k,F,Z)),h={},d={};for(const y of u){const b=y.key;if(h[b.bucketInstanceId]===void 0&&(h[b.bucketInstanceId]={}),h[b.bucketInstanceId][b.featureIndex])continue;const I=[new P.P(y.x1,y.y1),new P.P(y.x2,y.y1),new P.P(y.x2,y.y2),new P.P(y.x1,y.y2)];P.an(g,I)&&(h[b.bucketInstanceId][b.featureIndex]=!0,d[b.bucketInstanceId]===void 0&&(d[b.bucketInstanceId]=[]),d[b.bucketInstanceId].push(b.featureIndex))}return d}insertCollisionBox(l,g,S,k,F,Z){(S?this.ignoredGrid:this.grid).insert({bucketInstanceId:k,featureIndex:F,collisionGroupID:Z,overlapMode:g},l[0],l[1],l[2],l[3])}insertCollisionCircles(l,g,S,k,F,Z){const u=S?this.ignoredGrid:this.grid,h={bucketInstanceId:k,featureIndex:F,collisionGroupID:Z,overlapMode:g};for(let d=0;d<l.length;d+=4)u.insertCircle(h,l[d],l[d+1],l[d+2])}projectAndGetPerspectiveRatio(l,g,S,k){let F;return k?(F=[g,S,k(g,S),1],P.ag(F,F,l)):(F=[g,S,0,1],Le(F,F,l)),{point:new P.P((F[0]/F[3]+1)/2*this.transform.width+Ne,(-F[1]/F[3]+1)/2*this.transform.height+Ne),perspectiveRatio:.5+this.transform.cameraToCenterDistance/F[3]*.5}}isOffscreen(l,g,S,k){return S<Ne||l>=this.screenRightBoundary||k<Ne||g>this.screenBottomBoundary}isInsideGrid(l,g,S,k){return S>=0&&l<this.gridRightBoundary&&k>=0&&g<this.gridBottomBoundary}getViewportMatrix(){const l=P.ao([]);return P.$(l,l,[-100,-100,0]),l}}function Qe(z,l,g){return l*(P.N/(z.tileSize*Math.pow(2,g-z.tileID.overscaledZ)))}class Ge{constructor(l,g,S,k){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?g:-g))):k&&S?1:0,this.placed=S}isHidden(){return this.opacity===0&&!this.placed}}class We{constructor(l,g,S,k,F){this.text=new Ge(l?l.text:null,g,S,F),this.icon=new Ge(l?l.icon:null,g,k,F)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Et{constructor(l,g,S){this.text=l,this.icon=g,this.skipFade=S}}class xe{constructor(){this.invProjMatrix=P.Z(),this.viewportMatrix=P.Z(),this.circles=[]}}class Ie{constructor(l,g,S,k,F){this.bucketInstanceId=l,this.featureIndex=g,this.sourceLayerIndex=S,this.bucketIndex=k,this.tileID=F}}class ut{constructor(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}}get(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){const g=++this.maxGroupID;this.collisionGroups[l]={ID:g,predicate:S=>S.collisionGroupID===g}}return this.collisionGroups[l]}}function zt(z,l,g,S,k){const{horizontalAlign:F,verticalAlign:Z}=P.au(z);return new P.P(-(F-.5)*l+S[0]*k,-(Z-.5)*g+S[1]*k)}function o(z,l,g,S,k,F){const{x1:Z,x2:u,y1:h,y2:d,anchorPointX:y,anchorPointY:b}=z,I=new P.P(l,g);return S&&I._rotate(k?F:-F),{x1:Z+I.x,y1:h+I.y,x2:u+I.x,y2:d+I.y,anchorPointX:y,anchorPointY:b}}class oe{constructor(l,g,S,k,F){this.transform=l.clone(),this.terrain=g,this.collisionIndex=new $e(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=S,this.retainedQueryData={},this.collisionGroups=new ut(k),this.collisionCircleArrays={},this.prevPlacement=F,F&&(F.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(l,g,S,k){const F=S.getBucket(g),Z=S.latestFeatureIndex;if(!F||!Z||g.id!==F.layerIds[0])return;const u=S.collisionBoxArray,h=F.layers[0].layout,d=Math.pow(2,this.transform.zoom-S.tileID.overscaledZ),y=S.tileSize/P.N,b=this.transform.calculatePosMatrix(S.tileID.toUnwrapped()),I=h.get("text-pitch-alignment")==="map",R=h.get("text-rotation-alignment")==="map",N=Qe(S,1,this.transform.zoom),W=ni(b,I,R,this.transform,N);let K=null;if(I){const de=yn(b,I,R,this.transform,N);K=P.a1([],this.transform.labelPlaneMatrix,de)}this.retainedQueryData[F.bucketInstanceId]=new Ie(F.bucketInstanceId,Z,F.sourceLayerIndex,F.index,S.tileID);const le={bucket:F,layout:h,posMatrix:b,textLabelPlaneMatrix:W,labelToScreenMatrix:K,scale:d,textPixelRatio:y,holdingForFade:S.holdingForFade(),collisionBoxArray:u,partiallyEvaluatedTextSize:P.ah(F.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(F.sourceID)};if(k)for(const de of F.sortKeyRanges){const{sortKey:ge,symbolInstanceStart:ke,symbolInstanceEnd:Pe}=de;l.push({sortKey:ge,symbolInstanceStart:ke,symbolInstanceEnd:Pe,parameters:le})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:F.symbolInstances.length,parameters:le})}attemptAnchorPlacement(l,g,S,k,F,Z,u,h,d,y,b,I,R,N,W,K){const le=P.aq[l.textAnchor],de=[l.textOffset0,l.textOffset1],ge=zt(le,S,k,de,F),ke=this.collisionIndex.placeCollisionBox(o(g,ge.x,ge.y,Z,u,this.transform.angle),b,h,d,y.predicate,K);if((!W||this.collisionIndex.placeCollisionBox(o(W,ge.x,ge.y,Z,u,this.transform.angle),b,h,d,y.predicate,K).box.length!==0)&&ke.box.length>0){let Pe;if(this.prevPlacement&&this.prevPlacement.variableOffsets[I.crossTileID]&&this.prevPlacement.placements[I.crossTileID]&&this.prevPlacement.placements[I.crossTileID].text&&(Pe=this.prevPlacement.variableOffsets[I.crossTileID].anchor),I.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[I.crossTileID]={textOffset:de,width:S,height:k,anchor:le,textBoxScale:F,prevAnchor:Pe},this.markUsedJustification(R,le,I,N),R.allowVerticalPlacement&&(this.markUsedOrientation(R,N,I),this.placedOrientations[I.crossTileID]=N),{shift:ge,placedGlyphBoxes:ke}}}placeLayerBucketPart(l,g,S){const{bucket:k,layout:F,posMatrix:Z,textLabelPlaneMatrix:u,labelToScreenMatrix:h,textPixelRatio:d,holdingForFade:y,collisionBoxArray:b,partiallyEvaluatedTextSize:I,collisionGroup:R}=l.parameters,N=F.get("text-optional"),W=F.get("icon-optional"),K=P.ar(F,"text-overlap","text-allow-overlap"),le=K==="always",de=P.ar(F,"icon-overlap","icon-allow-overlap"),ge=de==="always",ke=F.get("text-rotation-alignment")==="map",Pe=F.get("text-pitch-alignment")==="map",qe=F.get("icon-text-fit")!=="none",ht=F.get("symbol-z-order")==="viewport-y",mt=le&&(ge||!k.hasIconData()||W),ot=ge&&(le||!k.hasTextData()||N);!k.collisionArrays&&b&&k.deserializeCollisionBoxes(b);const ft=this.retainedQueryData[k.bucketInstanceId].tileID,dt=this.terrain?(Ut,Xt)=>this.terrain.getElevation(ft,Ut,Xt):null,ai=(Ut,Xt)=>{var qt,or;if(g[Ut.crossTileID])return;if(y)return void(this.placements[Ut.crossTileID]=new Et(!1,!1,!1));let qi=!1,ji=!1,Li=!0,ir=null,Ji={box:null,offscreen:null},Or={box:null,offscreen:null},Xi=null,Lr=null,Bn=null,is=0,Ml=0,Sl=0;Xt.textFeatureIndex?is=Xt.textFeatureIndex:Ut.useRuntimeCollisionCircles&&(is=Ut.featureIndex),Xt.verticalTextFeatureIndex&&(Ml=Xt.verticalTextFeatureIndex);const Go=Xt.textBox;if(Go){const ma=Hs=>{let mo=P.ai.horizontal;if(k.allowVerticalPlacement&&!Hs&&this.prevPlacement){const Xa=this.prevPlacement.placedOrientations[Ut.crossTileID];Xa&&(this.placedOrientations[Ut.crossTileID]=Xa,mo=Xa,this.markUsedOrientation(k,mo,Ut))}return mo},ro=(Hs,mo)=>{if(k.allowVerticalPlacement&&Ut.numVerticalGlyphVertices>0&&Xt.verticalTextBox){for(const Xa of k.writingModes)if(Xa===P.ai.vertical?(Ji=mo(),Or=Ji):Ji=Hs(),Ji&&Ji.box&&Ji.box.length)break}else Ji=Hs()},Pa=Ut.textAnchorOffsetStartIndex,vA=Ut.textAnchorOffsetEndIndex;if(vA===Pa){const Hs=(mo,Xa)=>{const no=this.collisionIndex.placeCollisionBox(mo,K,d,Z,R.predicate,dt);return no&&no.box&&no.box.length&&(this.markUsedOrientation(k,Xa,Ut),this.placedOrientations[Ut.crossTileID]=Xa),no};ro(()=>Hs(Go,P.ai.horizontal),()=>{const mo=Xt.verticalTextBox;return k.allowVerticalPlacement&&Ut.numVerticalGlyphVertices>0&&mo?Hs(mo,P.ai.vertical):{box:null,offscreen:null}}),ma(Ji&&Ji.box&&Ji.box.length)}else{let Hs=P.aq[(or=(qt=this.prevPlacement)===null||qt===void 0?void 0:qt.variableOffsets[Ut.crossTileID])===null||or===void 0?void 0:or.anchor];const mo=(no,Vl,Xu)=>{const pf=no.x2-no.x1,kh=no.y2-no.y1,Yu=Ut.textBoxScale,Du=qe&&de==="never"?Vl:null;let lA={box:[],offscreen:!1},dc=K==="never"?1:2,Il="never";Hs&&dc++;for(let dl=0;dl<dc;dl++){for(let AA=Pa;AA<vA;AA++){const Ku=k.textAnchorOffsets.get(AA);if(Hs&&Ku.textAnchor!==Hs)continue;const bA=this.attemptAnchorPlacement(Ku,no,pf,kh,Yu,ke,Pe,d,Z,R,Il,Ut,k,Xu,Du,dt);if(bA&&(lA=bA.placedGlyphBoxes,lA&&lA.box&&lA.box.length))return qi=!0,ir=bA.shift,lA}Hs?Hs=null:Il=K}return lA};ro(()=>mo(Go,Xt.iconBox,P.ai.horizontal),()=>{const no=Xt.verticalTextBox;return k.allowVerticalPlacement&&!(Ji&&Ji.box&&Ji.box.length)&&Ut.numVerticalGlyphVertices>0&&no?mo(no,Xt.verticalIconBox,P.ai.vertical):{box:null,offscreen:null}}),Ji&&(qi=Ji.box,Li=Ji.offscreen);const Xa=ma(Ji&&Ji.box);if(!qi&&this.prevPlacement){const no=this.prevPlacement.variableOffsets[Ut.crossTileID];no&&(this.variableOffsets[Ut.crossTileID]=no,this.markUsedJustification(k,no.anchor,Ut,Xa))}}}if(Xi=Ji,qi=Xi&&Xi.box&&Xi.box.length>0,Li=Xi&&Xi.offscreen,Ut.useRuntimeCollisionCircles){const ma=k.text.placedSymbolArray.get(Ut.centerJustifiedTextSymbolIndex),ro=P.aj(k.textSizeData,I,ma),Pa=F.get("text-padding");Lr=this.collisionIndex.placeCollisionCircles(K,ma,k.lineVertexArray,k.glyphOffsetArray,ro,Z,u,h,S,Pe,R.predicate,Ut.collisionCircleDiameter,Pa,dt),Lr.circles.length&&Lr.collisionDetected&&!S&&P.w("Collisions detected, but collision boxes are not shown"),qi=le||Lr.circles.length>0&&!Lr.collisionDetected,Li=Li&&Lr.offscreen}if(Xt.iconFeatureIndex&&(Sl=Xt.iconFeatureIndex),Xt.iconBox){const ma=ro=>{const Pa=qe&&ir?o(ro,ir.x,ir.y,ke,Pe,this.transform.angle):ro;return this.collisionIndex.placeCollisionBox(Pa,de,d,Z,R.predicate,dt)};Or&&Or.box&&Or.box.length&&Xt.verticalIconBox?(Bn=ma(Xt.verticalIconBox),ji=Bn.box.length>0):(Bn=ma(Xt.iconBox),ji=Bn.box.length>0),Li=Li&&Bn.offscreen}const fc=N||Ut.numHorizontalGlyphVertices===0&&Ut.numVerticalGlyphVertices===0,Rc=W||Ut.numIconVertices===0;if(fc||Rc?Rc?fc||(ji=ji&&qi):qi=ji&&qi:ji=qi=ji&&qi,qi&&Xi&&Xi.box&&this.collisionIndex.insertCollisionBox(Xi.box,K,F.get("text-ignore-placement"),k.bucketInstanceId,Or&&Or.box&&Ml?Ml:is,R.ID),ji&&Bn&&this.collisionIndex.insertCollisionBox(Bn.box,de,F.get("icon-ignore-placement"),k.bucketInstanceId,Sl,R.ID),Lr&&(qi&&this.collisionIndex.insertCollisionCircles(Lr.circles,K,F.get("text-ignore-placement"),k.bucketInstanceId,is,R.ID),S)){const ma=k.bucketInstanceId;let ro=this.collisionCircleArrays[ma];ro===void 0&&(ro=this.collisionCircleArrays[ma]=new xe);for(let Pa=0;Pa<Lr.circles.length;Pa+=4)ro.circles.push(Lr.circles[Pa+0]),ro.circles.push(Lr.circles[Pa+1]),ro.circles.push(Lr.circles[Pa+2]),ro.circles.push(Lr.collisionDetected?1:0)}if(Ut.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(k.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Ut.crossTileID]=new Et(qi||mt,ji||ot,Li||k.justReloaded),g[Ut.crossTileID]=!0};if(ht){if(l.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Ut=k.getSortedSymbolIndexes(this.transform.angle);for(let Xt=Ut.length-1;Xt>=0;--Xt){const qt=Ut[Xt];ai(k.symbolInstances.get(qt),k.collisionArrays[qt])}}else for(let Ut=l.symbolInstanceStart;Ut<l.symbolInstanceEnd;Ut++)ai(k.symbolInstances.get(Ut),k.collisionArrays[Ut]);if(S&&k.bucketInstanceId in this.collisionCircleArrays){const Ut=this.collisionCircleArrays[k.bucketInstanceId];P.as(Ut.invProjMatrix,Z),Ut.viewportMatrix=this.collisionIndex.getViewportMatrix()}k.justReloaded=!1}markUsedJustification(l,g,S,k){let F;F=k===P.ai.vertical?S.verticalPlacedTextSymbolIndex:{left:S.leftJustifiedTextSymbolIndex,center:S.centerJustifiedTextSymbolIndex,right:S.rightJustifiedTextSymbolIndex}[P.at(g)];const Z=[S.leftJustifiedTextSymbolIndex,S.centerJustifiedTextSymbolIndex,S.rightJustifiedTextSymbolIndex,S.verticalPlacedTextSymbolIndex];for(const u of Z)u>=0&&(l.text.placedSymbolArray.get(u).crossTileID=F>=0&&u!==F?0:S.crossTileID)}markUsedOrientation(l,g,S){const k=g===P.ai.horizontal||g===P.ai.horizontalOnly?g:0,F=g===P.ai.vertical?g:0,Z=[S.leftJustifiedTextSymbolIndex,S.centerJustifiedTextSymbolIndex,S.rightJustifiedTextSymbolIndex];for(const u of Z)l.text.placedSymbolArray.get(u).placedOrientation=k;S.verticalPlacedTextSymbolIndex&&(l.text.placedSymbolArray.get(S.verticalPlacedTextSymbolIndex).placedOrientation=F)}commit(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;const g=this.prevPlacement;let S=!1;this.prevZoomAdjustment=g?g.zoomAdjustment(this.transform.zoom):0;const k=g?g.symbolFadeChange(l):1,F=g?g.opacities:{},Z=g?g.variableOffsets:{},u=g?g.placedOrientations:{};for(const h in this.placements){const d=this.placements[h],y=F[h];y?(this.opacities[h]=new We(y,k,d.text,d.icon),S=S||d.text!==y.text.placed||d.icon!==y.icon.placed):(this.opacities[h]=new We(null,k,d.text,d.icon,d.skipFade),S=S||d.text||d.icon)}for(const h in F){const d=F[h];if(!this.opacities[h]){const y=new We(d,k,!1,!1);y.isHidden()||(this.opacities[h]=y,S=S||d.text.placed||d.icon.placed)}}for(const h in Z)this.variableOffsets[h]||!this.opacities[h]||this.opacities[h].isHidden()||(this.variableOffsets[h]=Z[h]);for(const h in u)this.placedOrientations[h]||!this.opacities[h]||this.opacities[h].isHidden()||(this.placedOrientations[h]=u[h]);if(g&&g.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");S?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=g?g.lastPlacementChangeTime:l)}updateLayerOpacities(l,g){const S={};for(const k of g){const F=k.getBucket(l);F&&k.latestFeatureIndex&&l.id===F.layerIds[0]&&this.updateBucketOpacities(F,S,k.collisionBoxArray)}}updateBucketOpacities(l,g,S){l.hasTextData()&&(l.text.opacityVertexArray.clear(),l.text.hasVisibleVertices=!1),l.hasIconData()&&(l.icon.opacityVertexArray.clear(),l.icon.hasVisibleVertices=!1),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();const k=l.layers[0],F=k.layout,Z=new We(null,0,!1,!1,!0),u=F.get("text-allow-overlap"),h=F.get("icon-allow-overlap"),d=k._unevaluatedLayout.hasValue("text-variable-anchor")||k._unevaluatedLayout.hasValue("text-variable-anchor-offset"),y=F.get("text-rotation-alignment")==="map",b=F.get("text-pitch-alignment")==="map",I=F.get("icon-text-fit")!=="none",R=new We(null,0,u&&(h||!l.hasIconData()||F.get("icon-optional")),h&&(u||!l.hasTextData()||F.get("text-optional")),!0);!l.collisionArrays&&S&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(S);const N=(W,K,le)=>{for(let de=0;de<K/4;de++)W.opacityVertexArray.emplaceBack(le);W.hasVisibleVertices=W.hasVisibleVertices||le!==eo};for(let W=0;W<l.symbolInstances.length;W++){const K=l.symbolInstances.get(W),{numHorizontalGlyphVertices:le,numVerticalGlyphVertices:de,crossTileID:ge}=K;let ke=this.opacities[ge];g[ge]?ke=Z:ke||(ke=R,this.opacities[ge]=ke),g[ge]=!0;const Pe=K.numIconVertices>0,qe=this.placedOrientations[K.crossTileID],ht=qe===P.ai.vertical,mt=qe===P.ai.horizontal||qe===P.ai.horizontalOnly;if(le>0||de>0){const ot=hn(ke.text);N(l.text,le,ht?eo:ot),N(l.text,de,mt?eo:ot);const ft=ke.text.isHidden();[K.rightJustifiedTextSymbolIndex,K.centerJustifiedTextSymbolIndex,K.leftJustifiedTextSymbolIndex].forEach(Ut=>{Ut>=0&&(l.text.placedSymbolArray.get(Ut).hidden=ft||ht?1:0)}),K.verticalPlacedTextSymbolIndex>=0&&(l.text.placedSymbolArray.get(K.verticalPlacedTextSymbolIndex).hidden=ft||mt?1:0);const dt=this.variableOffsets[K.crossTileID];dt&&this.markUsedJustification(l,dt.anchor,K,qe);const ai=this.placedOrientations[K.crossTileID];ai&&(this.markUsedJustification(l,"left",K,ai),this.markUsedOrientation(l,ai,K))}if(Pe){const ot=hn(ke.icon),ft=!(I&&K.verticalPlacedIconSymbolIndex&&ht);K.placedIconSymbolIndex>=0&&(N(l.icon,K.numIconVertices,ft?ot:eo),l.icon.placedSymbolArray.get(K.placedIconSymbolIndex).hidden=ke.icon.isHidden()),K.verticalPlacedIconSymbolIndex>=0&&(N(l.icon,K.numVerticalIconVertices,ft?eo:ot),l.icon.placedSymbolArray.get(K.verticalPlacedIconSymbolIndex).hidden=ke.icon.isHidden())}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){const ot=l.collisionArrays[W];if(ot){let ft=new P.P(0,0);if(ot.textBox||ot.verticalTextBox){let ai=!0;if(d){const Ut=this.variableOffsets[ge];Ut?(ft=zt(Ut.anchor,Ut.width,Ut.height,Ut.textOffset,Ut.textBoxScale),y&&ft._rotate(b?this.transform.angle:-this.transform.angle)):ai=!1}ot.textBox&&$t(l.textCollisionBox.collisionVertexArray,ke.text.placed,!ai||ht,ft.x,ft.y),ot.verticalTextBox&&$t(l.textCollisionBox.collisionVertexArray,ke.text.placed,!ai||mt,ft.x,ft.y)}const dt=!!(!mt&&ot.verticalIconBox);ot.iconBox&&$t(l.iconCollisionBox.collisionVertexArray,ke.icon.placed,dt,I?ft.x:0,I?ft.y:0),ot.verticalIconBox&&$t(l.iconCollisionBox.collisionVertexArray,ke.icon.placed,!dt,I?ft.x:0,I?ft.y:0)}}}if(l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.text.opacityVertexArray.length!==l.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${l.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${l.text.layoutVertexArray.length}) / 4`);if(l.icon.opacityVertexArray.length!==l.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${l.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${l.icon.layoutVertexArray.length}) / 4`);if(l.bucketInstanceId in this.collisionCircleArrays){const W=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=W.invProjMatrix,l.placementViewportMatrix=W.viewportMatrix,l.collisionCircleArray=W.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}}symbolFadeChange(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(l){return Math.max(0,(this.transform.zoom-l)/1.5)}hasTransitions(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(l,g){const S=this.zoomAtLastRecencyCheck===g?1-this.zoomAdjustment(g):1;return this.zoomAtLastRecencyCheck=g,this.commitTime+this.fadeDuration*S>l}setStale(){this.stale=!0}}function $t(z,l,g,S,k){z.emplaceBack(l?1:0,g?1:0,S||0,k||0),z.emplaceBack(l?1:0,g?1:0,S||0,k||0),z.emplaceBack(l?1:0,g?1:0,S||0,k||0),z.emplaceBack(l?1:0,g?1:0,S||0,k||0)}const _i=Math.pow(2,25),mi=Math.pow(2,24),si=Math.pow(2,17),hi=Math.pow(2,16),gr=Math.pow(2,9),yi=Math.pow(2,8),Pi=Math.pow(2,1);function hn(z){if(z.opacity===0&&!z.placed)return 0;if(z.opacity===1&&z.placed)return 4294967295;const l=z.placed?1:0,g=Math.floor(127*z.opacity);return g*_i+l*mi+g*si+l*hi+g*gr+l*yi+g*Pi+l}const eo=0;class KA{constructor(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&!l.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(l,g,S,k,F){const Z=this._bucketParts;for(;this._currentTileIndex<l.length;)if(g.getBucketParts(Z,k,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,F())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,Z.sort((u,h)=>u.sortKey-h.sortKey));this._currentPartIndex<Z.length;)if(g.placeLayerBucketPart(Z[this._currentPartIndex],this._seenCrossTileIDs,S),this._currentPartIndex++,F())return!0;return!1}}class Vs{constructor(l,g,S,k,F,Z,u,h){this.placement=new oe(l,g,Z,u,h),this._currentPlacementIndex=S.length-1,this._forceFullPlacement=k,this._showCollisionBoxes=F,this._done=!1}isDone(){return this._done}continuePlacement(l,g,S){const k=P.h.now(),F=()=>!this._forceFullPlacement&&P.h.now()-k>2;for(;this._currentPlacementIndex>=0;){const Z=g[l[this._currentPlacementIndex]],u=this.placement.collisionIndex.transform.zoom;if(Z.type==="symbol"&&(!Z.minzoom||Z.minzoom<=u)&&(!Z.maxzoom||Z.maxzoom>u)){if(this._inProgressLayer||(this._inProgressLayer=new KA(Z)),this._inProgressLayer.continuePlacement(S[Z.source],this.placement,this._showCollisionBoxes,Z,F))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(l){return this.placement.commit(l),this.placement}}const js=512/P.N/2;class Ro{constructor(l,g,S){this.tileID=l,this.bucketInstanceId=S,this._symbolsByKey={};const k=new Map;for(let F=0;F<g.length;F++){const Z=g.get(F),u=Z.key,h=k.get(u);h?h.push(Z):k.set(u,[Z])}for(const[F,Z]of k){const u={positions:Z.map(h=>({x:Math.floor(h.anchorX*js),y:Math.floor(h.anchorY*js)})),crossTileIDs:Z.map(h=>h.crossTileID)};if(u.positions.length>128){const h=new P.av(u.positions.length,16,Uint16Array);for(const{x:d,y}of u.positions)h.add(d,y);h.finish(),delete u.positions,u.index=h}this._symbolsByKey[F]=u}}getScaledCoordinates(l,g){const{x:S,y:k,z:F}=this.tileID.canonical,{x:Z,y:u,z:h}=g.canonical,d=js/Math.pow(2,h-F),y=(u*P.N+l.anchorY)*d,b=k*P.N*js;return{x:Math.floor((Z*P.N+l.anchorX)*d-S*P.N*js),y:Math.floor(y-b)}}findMatches(l,g,S){const k=this.tileID.canonical.z<g.canonical.z?1:Math.pow(2,this.tileID.canonical.z-g.canonical.z);for(let F=0;F<l.length;F++){const Z=l.get(F);if(Z.crossTileID)continue;const u=this._symbolsByKey[Z.key];if(!u)continue;const h=this.getScaledCoordinates(Z,g);if(u.index){const d=u.index.range(h.x-k,h.y-k,h.x+k,h.y+k).sort();for(const y of d){const b=u.crossTileIDs[y];if(!S[b]){S[b]=!0,Z.crossTileID=b;break}}}else if(u.positions)for(let d=0;d<u.positions.length;d++){const y=u.positions[d],b=u.crossTileIDs[d];if(Math.abs(y.x-h.x)<=k&&Math.abs(y.y-h.y)<=k&&!S[b]){S[b]=!0,Z.crossTileID=b;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:l})=>l)}}class en{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ko{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(l){const g=Math.round((l-this.lng)/360);if(g!==0)for(const S in this.indexes){const k=this.indexes[S],F={};for(const Z in k){const u=k[Z];u.tileID=u.tileID.unwrapTo(u.tileID.wrap+g),F[u.tileID.key]=u}this.indexes[S]=F}this.lng=l}addBucket(l,g,S){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===g.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(let F=0;F<g.symbolInstances.length;F++)g.symbolInstances.get(F).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]={});const k=this.usedCrossTileIDs[l.overscaledZ];for(const F in this.indexes){const Z=this.indexes[F];if(Number(F)>l.overscaledZ)for(const u in Z){const h=Z[u];h.tileID.isChildOf(l)&&h.findMatches(g.symbolInstances,l,k)}else{const u=Z[l.scaledTo(Number(F)).key];u&&u.findMatches(g.symbolInstances,l,k)}}for(let F=0;F<g.symbolInstances.length;F++){const Z=g.symbolInstances.get(F);Z.crossTileID||(Z.crossTileID=S.generate(),k[Z.crossTileID]=!0)}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new Ro(l,g.symbolInstances,g.bucketInstanceId),!0}removeBucketCrossTileIDs(l,g){for(const S of g.getCrossTileIDsLists())for(const k of S)delete this.usedCrossTileIDs[l][k]}removeStaleBuckets(l){let g=!1;for(const S in this.indexes){const k=this.indexes[S];for(const F in k)l[k[F].bucketInstanceId]||(this.removeBucketCrossTileIDs(S,k[F]),delete k[F],g=!0)}return g}}class kr{constructor(){this.layerIndexes={},this.crossTileIDs=new en,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(l,g,S){let k=this.layerIndexes[l.id];k===void 0&&(k=this.layerIndexes[l.id]=new Ko);let F=!1;const Z={};k.handleWrapJump(S);for(const u of g){const h=u.getBucket(l);h&&l.id===h.layerIds[0]&&(h.bucketInstanceId||(h.bucketInstanceId=++this.maxBucketInstanceId),k.addBucket(u.tileID,h,this.crossTileIDs)&&(F=!0),Z[h.bucketInstanceId]=!0)}return k.removeStaleBuckets(Z)&&(F=!0),F}pruneUnusedLayers(l){const g={};l.forEach(S=>{g[S]=!0});for(const S in this.layerIndexes)g[S]||delete this.layerIndexes[S]}}const gt=(z,l)=>P.x(z,l&&l.filter(g=>g.identifier!=="source.canvas")),Ci=P.F(P.ax,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setGlyphs","setSprite"]),et=P.F(P.ax,["setCenter","setZoom","setBearing","setPitch"]),ar=P.aw();class to extends P.E{constructor(l,g={}){super(),this.map=l,this.dispatcher=new ts(Yi(),this,l._getMapId()),this.imageManager=new fn,this.imageManager.setEventedParent(this),this.glyphManager=new kn(l._requestManager,g.localIdeographFontFamily),this.lineAtlas=new yo(256,512),this.crossTileSymbolIndex=new kr,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new P.ay,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",P.az());const S=this;this._rtlTextPluginCallback=to.registerForPluginStateChange(k=>{S.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:k.pluginStatus,pluginURL:k.pluginURL},(F,Z)=>{if(P.aA(F),Z&&Z.every(u=>u))for(const u in S.sourceCaches){const h=S.sourceCaches[u].getSource().type;h!=="vector"&&h!=="geojson"||S.sourceCaches[u].reload()}})}),this.on("data",k=>{if(k.dataType!=="source"||k.sourceDataType!=="metadata")return;const F=this.sourceCaches[k.sourceId];if(!F)return;const Z=F.getSource();if(Z&&Z.vectorLayerIds)for(const u in this._layers){const h=this._layers[u];h.source===Z.id&&this._validateLayer(h)}})}loadURL(l,g={},S){this.fire(new P.k("dataloading",{dataType:"style"})),g.validate=typeof g.validate!="boolean"||g.validate;const k=this.map._requestManager.transformRequest(l,dr.Style);this._request=P.f(k,(F,Z)=>{this._request=null,F?this.fire(new P.j(F)):Z&&this._load(Z,g,S)})}loadJSON(l,g={},S){this.fire(new P.k("dataloading",{dataType:"style"})),this._request=P.h.frame(()=>{this._request=null,g.validate=g.validate!==!1,this._load(l,g,S)})}loadEmpty(){this.fire(new P.k("dataloading",{dataType:"style"})),this._load(ar,{validate:!1})}_load(l,g,S){var k;const F=g.transformStyle?g.transformStyle(S,l):l;if(!g.validate||!gt(this,P.y(F))){this._loaded=!0,this.stylesheet=F;for(const Z in F.sources)this.addSource(Z,F.sources[Z],{validate:!1});F.sprite?this._loadSprite(F.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(F.glyphs),this._createLayers(),this.light=new Ao(this.stylesheet.light),this.map.setTerrain((k=this.stylesheet.terrain)!==null&&k!==void 0?k:null),this.fire(new P.k("data",{dataType:"style"})),this.fire(new P.k("style.load"))}}_createLayers(){const l=P.aB(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",l),this._order=l.map(g=>g.id),this._layers={},this._serializedLayers=null;for(const g of l){const S=P.aC(g);S.setEventedParent(this,{layer:{id:g.id}}),this._layers[g.id]=S}}_loadSprite(l,g=!1,S=void 0){this.imageManager.setLoaded(!1),this._spriteRequest=function(k,F,Z,u){const h=pn(k),d=h.length,y=Z>1?"@2x":"",b={},I={},R={};for(const{id:N,url:W}of h){const K=F.transformRequest(F.normalizeSpriteURL(W,y,".json"),dr.SpriteJSON),le=`${N}_${K.url}`;b[le]=P.f(K,(ke,Pe)=>{delete b[le],I[N]=Pe,As(u,I,R,ke,d)});const de=F.transformRequest(F.normalizeSpriteURL(W,y,".png"),dr.SpriteImage),ge=`${N}_${de.url}`;b[ge]=qr.getImage(de,(ke,Pe)=>{delete b[ge],R[N]=Pe,As(u,I,R,ke,d)})}return{cancel(){for(const N of Object.values(b))N.cancel()}}}(l,this.map._requestManager,this.map.getPixelRatio(),(k,F)=>{if(this._spriteRequest=null,k)this.fire(new P.j(k));else if(F)for(const Z in F){this._spritesImagesIds[Z]=[];const u=this._spritesImagesIds[Z]?this._spritesImagesIds[Z].filter(h=>!(h in F)):[];for(const h of u)this.imageManager.removeImage(h),this._changedImages[h]=!0;for(const h in F[Z]){const d=Z==="default"?h:`${Z}:${h}`;this._spritesImagesIds[Z].push(d),d in this.imageManager.images?this.imageManager.updateImage(d,F[Z][h],!1):this.imageManager.addImage(d,F[Z][h]),g&&(this._changedImages[d]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),g&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new P.k("data",{dataType:"style"})),S&&S(k)})}_unloadSprite(){for(const l of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(l),this._changedImages[l]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new P.k("data",{dataType:"style"}))}_validateLayer(l){const g=this.sourceCaches[l.source];if(!g)return;const S=l.sourceLayer;if(!S)return;const k=g.getSource();(k.type==="geojson"||k.vectorLayerIds&&k.vectorLayerIds.indexOf(S)===-1)&&this.fire(new P.j(new Error(`Source layer "${S}" does not exist on source "${k.id}" as specified by style layer "${l.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const l in this.sourceCaches)if(!this.sourceCaches[l].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(l){const g=this._serializedAllLayers();if(!l||l.length===0)return Object.values(g);const S=[];for(const k of l)g[k]&&S.push(g[k]);return S}_serializedAllLayers(){let l=this._serializedLayers;if(l)return l;l=this._serializedLayers={};const g=Object.keys(this._layers);for(const S of g){const k=this._layers[S];k.type!=="custom"&&(l[S]=k.serialize())}return l}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const l in this.sourceCaches)if(this.sourceCaches[l].hasTransition())return!0;for(const l in this._layers)if(this._layers[l].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(l){if(!this._loaded)return;const g=this._changed;if(this._changed){const k=Object.keys(this._updatedLayers),F=Object.keys(this._removedLayers);(k.length||F.length)&&this._updateWorkerLayers(k,F);for(const Z in this._updatedSources){const u=this._updatedSources[Z];if(u==="reload")this._reloadSource(Z);else{if(u!=="clear")throw new Error(`Invalid action ${u}`);this._clearSource(Z)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const Z in this._updatedPaintProps)this._layers[Z].updateTransitions(l);this.light.updateTransitions(l),this._resetUpdates()}const S={};for(const k in this.sourceCaches){const F=this.sourceCaches[k];S[k]=F.used,F.used=!1}for(const k of this._order){const F=this._layers[k];F.recalculate(l,this._availableImages),!F.isHidden(l.zoom)&&F.source&&(this.sourceCaches[F.source].used=!0)}for(const k in S){const F=this.sourceCaches[k];S[k]!==F.used&&F.fire(new P.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:k}))}this.light.recalculate(l),this.z=l.zoom,g&&this.fire(new P.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const l=Object.keys(this._changedImages);if(l.length){for(const g in this.sourceCaches)this.sourceCaches[g].reloadTilesForDependencies(["icons","patterns"],l);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const l in this.sourceCaches)this.sourceCaches[l].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(l,g){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(l),removedIds:g})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(l,g={}){this._checkLoaded();const S=this.serialize();if(l=g.transformStyle?g.transformStyle(S,l):l,gt(this,P.y(l)))return!1;(l=P.aD(l)).layers=P.aB(l.layers);const k=P.aE(S,l).filter(Z=>!(Z.command in et));if(k.length===0)return!1;const F=k.filter(Z=>!(Z.command in Ci));if(F.length>0)throw new Error(`Unimplemented: ${F.map(Z=>Z.command).join(", ")}.`);for(const Z of k)Z.command!=="setTransition"&&this[Z.command].apply(this,Z.args);return this.stylesheet=l,this._serializedLayers=null,!0}addImage(l,g){if(this.getImage(l))return this.fire(new P.j(new Error(`An image named "${l}" already exists.`)));this.imageManager.addImage(l,g),this._afterImageUpdated(l)}updateImage(l,g){this.imageManager.updateImage(l,g)}getImage(l){return this.imageManager.getImage(l)}removeImage(l){if(!this.getImage(l))return this.fire(new P.j(new Error(`An image named "${l}" does not exist.`)));this.imageManager.removeImage(l),this._afterImageUpdated(l)}_afterImageUpdated(l){this._availableImages=this.imageManager.listImages(),this._changedImages[l]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new P.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(l,g,S={}){if(this._checkLoaded(),this.sourceCaches[l]!==void 0)throw new Error(`Source "${l}" already exists.`);if(!g.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(g).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(g.type)>=0&&this._validate(P.y.source,`sources.${l}`,g,null,S))return;this.map&&this.map._collectResourceTiming&&(g.collectResourceTiming=!0);const k=this.sourceCaches[l]=new Rt(l,g,this.dispatcher);k.style=this,k.setEventedParent(this,()=>({isSourceLoaded:k.loaded(),source:k.serialize(),sourceId:l})),k.onAdd(this.map),this._changed=!0}removeSource(l){if(this._checkLoaded(),this.sourceCaches[l]===void 0)throw new Error("There is no source with this ID");for(const S in this._layers)if(this._layers[S].source===l)return this.fire(new P.j(new Error(`Source "${l}" cannot be removed while layer "${S}" is using it.`)));const g=this.sourceCaches[l];delete this.sourceCaches[l],delete this._updatedSources[l],g.fire(new P.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:l})),g.setEventedParent(null),g.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(l,g){if(this._checkLoaded(),this.sourceCaches[l]===void 0)throw new Error(`There is no source with this ID=${l}`);const S=this.sourceCaches[l].getSource();if(S.type!=="geojson")throw new Error(`geojsonSource.type is ${S.type}, which is !== 'geojson`);S.setData(g),this._changed=!0}getSource(l){return this.sourceCaches[l]&&this.sourceCaches[l].getSource()}addLayer(l,g,S={}){this._checkLoaded();const k=l.id;if(this.getLayer(k))return void this.fire(new P.j(new Error(`Layer "${k}" already exists on this map.`)));let F;if(l.type==="custom"){if(gt(this,P.aF(l)))return;F=P.aC(l)}else{if("source"in l&&typeof l.source=="object"&&(this.addSource(k,l.source),l=P.aD(l),l=P.e(l,{source:k})),this._validate(P.y.layer,`layers.${k}`,l,{arrayIndex:-1},S))return;F=P.aC(l),this._validateLayer(F),F.setEventedParent(this,{layer:{id:k}})}const Z=g?this._order.indexOf(g):this._order.length;if(g&&Z===-1)this.fire(new P.j(new Error(`Cannot add layer "${k}" before non-existing layer "${g}".`)));else{if(this._order.splice(Z,0,k),this._layerOrderChanged=!0,this._layers[k]=F,this._removedLayers[k]&&F.source&&F.type!=="custom"){const u=this._removedLayers[k];delete this._removedLayers[k],u.type!==F.type?this._updatedSources[F.source]="clear":(this._updatedSources[F.source]="reload",this.sourceCaches[F.source].pause())}this._updateLayer(F),F.onAdd&&F.onAdd(this.map)}}moveLayer(l,g){if(this._checkLoaded(),this._changed=!0,!this._layers[l])return void this.fire(new P.j(new Error(`The layer '${l}' does not exist in the map's style and cannot be moved.`)));if(l===g)return;const S=this._order.indexOf(l);this._order.splice(S,1);const k=g?this._order.indexOf(g):this._order.length;g&&k===-1?this.fire(new P.j(new Error(`Cannot move layer "${l}" before non-existing layer "${g}".`))):(this._order.splice(k,0,l),this._layerOrderChanged=!0)}removeLayer(l){this._checkLoaded();const g=this._layers[l];if(!g)return void this.fire(new P.j(new Error(`Cannot remove non-existing layer "${l}".`)));g.setEventedParent(null);const S=this._order.indexOf(l);this._order.splice(S,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[l]=g,delete this._layers[l],this._serializedLayers&&delete this._serializedLayers[l],delete this._updatedLayers[l],delete this._updatedPaintProps[l],g.onRemove&&g.onRemove(this.map)}getLayer(l){return this._layers[l]}getLayersOrder(){return[...this._order]}hasLayer(l){return l in this._layers}setLayerZoomRange(l,g,S){this._checkLoaded();const k=this.getLayer(l);k?k.minzoom===g&&k.maxzoom===S||(g!=null&&(k.minzoom=g),S!=null&&(k.maxzoom=S),this._updateLayer(k)):this.fire(new P.j(new Error(`Cannot set the zoom range of non-existing layer "${l}".`)))}setFilter(l,g,S={}){this._checkLoaded();const k=this.getLayer(l);if(k){if(!P.aG(k.filter,g))return g==null?(k.filter=void 0,void this._updateLayer(k)):void(this._validate(P.y.filter,`layers.${k.id}.filter`,g,null,S)||(k.filter=P.aD(g),this._updateLayer(k)))}else this.fire(new P.j(new Error(`Cannot filter non-existing layer "${l}".`)))}getFilter(l){return P.aD(this.getLayer(l).filter)}setLayoutProperty(l,g,S,k={}){this._checkLoaded();const F=this.getLayer(l);F?P.aG(F.getLayoutProperty(g),S)||(F.setLayoutProperty(g,S,k),this._updateLayer(F)):this.fire(new P.j(new Error(`Cannot style non-existing layer "${l}".`)))}getLayoutProperty(l,g){const S=this.getLayer(l);if(S)return S.getLayoutProperty(g);this.fire(new P.j(new Error(`Cannot get style of non-existing layer "${l}".`)))}setPaintProperty(l,g,S,k={}){this._checkLoaded();const F=this.getLayer(l);F?P.aG(F.getPaintProperty(g),S)||(F.setPaintProperty(g,S,k)&&this._updateLayer(F),this._changed=!0,this._updatedPaintProps[l]=!0):this.fire(new P.j(new Error(`Cannot style non-existing layer "${l}".`)))}getPaintProperty(l,g){return this.getLayer(l).getPaintProperty(g)}setFeatureState(l,g){this._checkLoaded();const S=l.source,k=l.sourceLayer,F=this.sourceCaches[S];if(F===void 0)return void this.fire(new P.j(new Error(`The source '${S}' does not exist in the map's style.`)));const Z=F.getSource().type;Z==="geojson"&&k?this.fire(new P.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):Z!=="vector"||k?(l.id===void 0&&this.fire(new P.j(new Error("The feature id parameter must be provided."))),F.setFeatureState(k,l.id,g)):this.fire(new P.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(l,g){this._checkLoaded();const S=l.source,k=this.sourceCaches[S];if(k===void 0)return void this.fire(new P.j(new Error(`The source '${S}' does not exist in the map's style.`)));const F=k.getSource().type,Z=F==="vector"?l.sourceLayer:void 0;F!=="vector"||Z?g&&typeof l.id!="string"&&typeof l.id!="number"?this.fire(new P.j(new Error("A feature id is required to remove its specific state property."))):k.removeFeatureState(Z,l.id,g):this.fire(new P.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(l){this._checkLoaded();const g=l.source,S=l.sourceLayer,k=this.sourceCaches[g];if(k!==void 0)return k.getSource().type!=="vector"||S?(l.id===void 0&&this.fire(new P.j(new Error("The feature id parameter must be provided."))),k.getFeatureState(S,l.id)):void this.fire(new P.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new P.j(new Error(`The source '${g}' does not exist in the map's style.`)))}getTransition(){return P.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const l=P.aH(this.sourceCaches,F=>F.serialize()),g=this._serializeByIds(this._order),S=this.map.getTerrain()||void 0,k=this.stylesheet;return P.aI({version:k.version,name:k.name,metadata:k.metadata,light:k.light,center:k.center,zoom:k.zoom,bearing:k.bearing,pitch:k.pitch,sprite:k.sprite,glyphs:k.glyphs,transition:k.transition,sources:l,layers:g,terrain:S},F=>F!==void 0)}_updateLayer(l){this._updatedLayers[l.id]=!0,l.source&&!this._updatedSources[l.source]&&this.sourceCaches[l.source].getSource().type!=="raster"&&(this._updatedSources[l.source]="reload",this.sourceCaches[l.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(l){const g=Z=>this._layers[Z].type==="fill-extrusion",S={},k=[];for(let Z=this._order.length-1;Z>=0;Z--){const u=this._order[Z];if(g(u)){S[u]=Z;for(const h of l){const d=h[u];if(d)for(const y of d)k.push(y)}}}k.sort((Z,u)=>u.intersectionZ-Z.intersectionZ);const F=[];for(let Z=this._order.length-1;Z>=0;Z--){const u=this._order[Z];if(g(u))for(let h=k.length-1;h>=0;h--){const d=k[h].feature;if(S[d.layer.id]<Z)break;F.push(d),k.pop()}else for(const h of l){const d=h[u];if(d)for(const y of d)F.push(y.feature)}}return F}queryRenderedFeatures(l,g,S){g&&g.filter&&this._validate(P.y.filter,"queryRenderedFeatures.filter",g.filter,null,g);const k={};if(g&&g.layers){if(!Array.isArray(g.layers))return this.fire(new P.j(new Error("parameters.layers must be an Array."))),[];for(const u of g.layers){const h=this._layers[u];if(!h)return this.fire(new P.j(new Error(`The layer '${u}' does not exist in the map's style and cannot be queried for features.`))),[];k[h.source]=!0}}const F=[];g.availableImages=this._availableImages;const Z=this._serializedAllLayers();for(const u in this.sourceCaches)g.layers&&!k[u]||F.push(Cs(this.sourceCaches[u],this._layers,Z,l,g,S));return this.placement&&F.push(function(u,h,d,y,b,I,R){const N={},W=I.queryRenderedSymbols(y),K=[];for(const le of Object.keys(W).map(Number))K.push(R[le]);K.sort(Zt);for(const le of K){const de=le.featureIndex.lookupSymbolFeatures(W[le.bucketInstanceId],h,le.bucketIndex,le.sourceLayerIndex,b.filter,b.layers,b.availableImages,u);for(const ge in de){const ke=N[ge]=N[ge]||[],Pe=de[ge];Pe.sort((qe,ht)=>{const mt=le.featureSortOrder;if(mt){const ot=mt.indexOf(qe.featureIndex);return mt.indexOf(ht.featureIndex)-ot}return ht.featureIndex-qe.featureIndex});for(const qe of Pe)ke.push(qe)}}for(const le in N)N[le].forEach(de=>{const ge=de.feature,ke=d[u[le].source].getFeatureState(ge.layer["source-layer"],ge.id);ge.source=ge.layer.source,ge.layer["source-layer"]&&(ge.sourceLayer=ge.layer["source-layer"]),ge.state=ke});return N}(this._layers,Z,this.sourceCaches,l,g,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(F)}querySourceFeatures(l,g){g&&g.filter&&this._validate(P.y.filter,"querySourceFeatures.filter",g.filter,null,g);const S=this.sourceCaches[l];return S?function(k,F){const Z=k.getRenderableIds().map(d=>k.getTileByID(d)),u=[],h={};for(let d=0;d<Z.length;d++){const y=Z[d],b=y.tileID.canonical.key;h[b]||(h[b]=!0,y.querySourceFeatures(u,F))}return u}(S,g):[]}addSourceType(l,g,S){return Ir(l)?S(new Error(`A source type called "${l}" already exists.`)):(((k,F)=>{Di[k]=F})(l,g),g.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:l,url:g.workerSourceURL},S):S(null,null))}getLight(){return this.light.getLight()}setLight(l,g={}){this._checkLoaded();const S=this.light.getLight();let k=!1;for(const Z in l)if(!P.aG(l[Z],S[Z])){k=!0;break}if(!k)return;const F={now:P.h.now(),transition:P.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(l,g),this.light.updateTransitions(F)}_validate(l,g,S,k,F={}){return(!F||F.validate!==!1)&&gt(this,l.call(P.y,P.e({key:g,style:this.serialize(),value:S,styleSpec:P.v},k)))}_remove(l=!0){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),P.aJ.off("pluginStateChange",this._rtlTextPluginCallback);for(const g in this._layers)this._layers[g].setEventedParent(null);for(const g in this.sourceCaches){const S=this.sourceCaches[g];S.setEventedParent(null),S.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(l)}_clearSource(l){this.sourceCaches[l].clearTiles()}_reloadSource(l){this.sourceCaches[l].resume(),this.sourceCaches[l].reload()}_updateSources(l){for(const g in this.sourceCaches)this.sourceCaches[g].update(l,this.map.terrain)}_generateCollisionBoxes(){for(const l in this.sourceCaches)this._reloadSource(l)}_updatePlacement(l,g,S,k,F=!1){let Z=!1,u=!1;const h={};for(const d of this._order){const y=this._layers[d];if(y.type!=="symbol")continue;if(!h[y.source]){const I=this.sourceCaches[y.source];h[y.source]=I.getRenderableIds(!0).map(R=>I.getTileByID(R)).sort((R,N)=>N.tileID.overscaledZ-R.tileID.overscaledZ||(R.tileID.isLessThan(N.tileID)?-1:1))}const b=this.crossTileSymbolIndex.addLayer(y,h[y.source],l.center.lng);Z=Z||b}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((F=F||this._layerOrderChanged||S===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(P.h.now(),l.zoom))&&(this.pauseablePlacement=new Vs(l,this.map.terrain,this._order,F,g,S,k,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,h),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(P.h.now()),u=!0),Z&&this.pauseablePlacement.placement.setStale()),u||Z)for(const d of this._order){const y=this._layers[d];y.type==="symbol"&&this.placement.updateLayerOpacities(y,h[y.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(P.h.now())}_releaseSymbolFadeTiles(){for(const l in this.sourceCaches)this.sourceCaches[l].releaseSymbolFadeTiles()}getImages(l,g,S){this.imageManager.getImages(g.icons,S),this._updateTilesForChangedImages();const k=this.sourceCaches[g.source];k&&k.setDependencies(g.tileID.key,g.type,g.icons)}getGlyphs(l,g,S){this.glyphManager.getGlyphs(g.stacks,S);const k=this.sourceCaches[g.source];k&&k.setDependencies(g.tileID.key,g.type,[""])}getResource(l,g,S){return P.m(g,S)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(l,g={}){this._checkLoaded(),l&&this._validate(P.y.glyphs,"glyphs",l,null,g)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=l,this.glyphManager.entries={},this.glyphManager.setURL(l))}addSprite(l,g,S={},k){this._checkLoaded();const F=[{id:l,url:g}],Z=[...pn(this.stylesheet.sprite),...F];this._validate(P.y.sprite,"sprite",Z,null,S)||(this.stylesheet.sprite=Z,this._loadSprite(F,!0,k))}removeSprite(l){this._checkLoaded();const g=pn(this.stylesheet.sprite);if(g.find(S=>S.id===l)){if(this._spritesImagesIds[l])for(const S of this._spritesImagesIds[l])this.imageManager.removeImage(S),this._changedImages[S]=!0;g.splice(g.findIndex(S=>S.id===l),1),this.stylesheet.sprite=g.length>0?g:void 0,delete this._spritesImagesIds[l],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new P.k("data",{dataType:"style"}))}else this.fire(new P.j(new Error(`Sprite "${l}" doesn't exists on this map.`)))}getSprite(){return pn(this.stylesheet.sprite)}setSprite(l,g={},S){this._checkLoaded(),l&&this._validate(P.y.sprite,"sprite",l,null,g)||(this.stylesheet.sprite=l,l?this._loadSprite(l,!0,S):(this._unloadSprite(),S&&S(null)))}}to.registerForPluginStateChange=P.aK;var BA=P.Q([{name:"a_pos",type:"Int16",components:2}]),Dl="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const st={prelude:xn(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:xn(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:xn(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:xn(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:xn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:xn(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:xn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:xn("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:xn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:xn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:xn(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:xn(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:xn(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:xn(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:xn(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:xn(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:xn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:xn(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:xn(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:xn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:xn(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:xn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:xn(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:xn(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:xn(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:xn(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:xn("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Dl),terrainDepth:xn("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Dl),terrainCoords:xn("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Dl)};function xn(z,l){const g=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,S=l.match(/attribute ([\w]+) ([\w]+)/g),k=z.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),F=l.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),Z=F?F.concat(k):k,u={};return{fragmentSource:z=z.replace(g,(h,d,y,b,I)=>(u[I]=!0,d==="define"?`
#ifndef HAS_UNIFORM_u_${I}
varying ${y} ${b} ${I};
#else
uniform ${y} ${b} u_${I};
#endif
`:`
#ifdef HAS_UNIFORM_u_${I}
    ${y} ${b} ${I} = u_${I};
#endif
`)),vertexSource:l=l.replace(g,(h,d,y,b,I)=>{const R=b==="float"?"vec2":"vec4",N=I.match(/color/)?"color":R;return u[I]?d==="define"?`
#ifndef HAS_UNIFORM_u_${I}
uniform lowp float u_${I}_t;
attribute ${y} ${R} a_${I};
varying ${y} ${b} ${I};
#else
uniform ${y} ${b} u_${I};
#endif
`:N==="vec4"?`
#ifndef HAS_UNIFORM_u_${I}
    ${I} = a_${I};
#else
    ${y} ${b} ${I} = u_${I};
#endif
`:`
#ifndef HAS_UNIFORM_u_${I}
    ${I} = unpack_mix_${N}(a_${I}, u_${I}_t);
#else
    ${y} ${b} ${I} = u_${I};
#endif
`:d==="define"?`
#ifndef HAS_UNIFORM_u_${I}
uniform lowp float u_${I}_t;
attribute ${y} ${R} a_${I};
#else
uniform ${y} ${b} u_${I};
#endif
`:N==="vec4"?`
#ifndef HAS_UNIFORM_u_${I}
    ${y} ${b} ${I} = a_${I};
#else
    ${y} ${b} ${I} = u_${I};
#endif
`:`
#ifndef HAS_UNIFORM_u_${I}
    ${y} ${b} ${I} = unpack_mix_${N}(a_${I}, u_${I}_t);
#else
    ${y} ${b} ${I} = u_${I};
#endif
`}),staticAttributes:S,staticUniforms:Z}}class Ze{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(l,g,S,k,F,Z,u,h,d){this.context=l;let y=this.boundPaintVertexBuffers.length!==k.length;for(let b=0;!y&&b<k.length;b++)this.boundPaintVertexBuffers[b]!==k[b]&&(y=!0);!this.vao||this.boundProgram!==g||this.boundLayoutVertexBuffer!==S||y||this.boundIndexBuffer!==F||this.boundVertexOffset!==Z||this.boundDynamicVertexBuffer!==u||this.boundDynamicVertexBuffer2!==h||this.boundDynamicVertexBuffer3!==d?this.freshBind(g,S,k,F,Z,u,h,d):(l.bindVertexArray.set(this.vao),u&&u.bind(),F&&F.dynamicDraw&&F.bind(),h&&h.bind(),d&&d.bind())}freshBind(l,g,S,k,F,Z,u,h){const d=l.numAttributes,y=this.context,b=y.gl;this.vao&&this.destroy(),this.vao=y.createVertexArray(),y.bindVertexArray.set(this.vao),this.boundProgram=l,this.boundLayoutVertexBuffer=g,this.boundPaintVertexBuffers=S,this.boundIndexBuffer=k,this.boundVertexOffset=F,this.boundDynamicVertexBuffer=Z,this.boundDynamicVertexBuffer2=u,this.boundDynamicVertexBuffer3=h,g.enableAttributes(b,l);for(const I of S)I.enableAttributes(b,l);Z&&Z.enableAttributes(b,l),u&&u.enableAttributes(b,l),h&&h.enableAttributes(b,l),g.bind(),g.setVertexAttribPointers(b,l,F);for(const I of S)I.bind(),I.setVertexAttribPointers(b,l,F);Z&&(Z.bind(),Z.setVertexAttribPointers(b,l,F)),k&&k.bind(),u&&(u.bind(),u.setVertexAttribPointers(b,l,F)),h&&(h.bind(),h.setVertexAttribPointers(b,l,F)),y.currentNumAttributes=d}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function hs(z){const l=[];for(let g=0;g<z.length;g++){if(z[g]===null)continue;const S=z[g].split(" ");l.push(S.pop())}return l}class Jl{constructor(l,g,S,k,F,Z){const u=l.gl;this.program=u.createProgram();const h=hs(g.staticAttributes),d=S?S.getBinderAttributes():[],y=h.concat(d),b=st.prelude.staticUniforms?hs(st.prelude.staticUniforms):[],I=g.staticUniforms?hs(g.staticUniforms):[],R=S?S.getBinderUniforms():[],N=b.concat(I).concat(R),W=[];for(const qe of N)W.indexOf(qe)<0&&W.push(qe);const K=S?S.defines():[];F&&K.push("#define OVERDRAW_INSPECTOR;"),Z&&K.push("#define TERRAIN3D;");const le=K.concat(st.prelude.fragmentSource,g.fragmentSource).join(`
`),de=K.concat(st.prelude.vertexSource,g.vertexSource).join(`
`),ge=u.createShader(u.FRAGMENT_SHADER);if(u.isContextLost())return void(this.failedToCreate=!0);if(u.shaderSource(ge,le),u.compileShader(ge),!u.getShaderParameter(ge,u.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${u.getShaderInfoLog(ge)}`);u.attachShader(this.program,ge);const ke=u.createShader(u.VERTEX_SHADER);if(u.isContextLost())return void(this.failedToCreate=!0);if(u.shaderSource(ke,de),u.compileShader(ke),!u.getShaderParameter(ke,u.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${u.getShaderInfoLog(ke)}`);u.attachShader(this.program,ke),this.attributes={};const Pe={};this.numAttributes=y.length;for(let qe=0;qe<this.numAttributes;qe++)y[qe]&&(u.bindAttribLocation(this.program,qe,y[qe]),this.attributes[y[qe]]=qe);if(u.linkProgram(this.program),!u.getProgramParameter(this.program,u.LINK_STATUS))throw new Error(`Program failed to link: ${u.getProgramInfoLog(this.program)}`);u.deleteShader(ke),u.deleteShader(ge);for(let qe=0;qe<W.length;qe++){const ht=W[qe];if(ht&&!Pe[ht]){const mt=u.getUniformLocation(this.program,ht);mt&&(Pe[ht]=mt)}}this.fixedUniforms=k(l,Pe),this.terrainUniforms=((qe,ht)=>({u_depth:new P.aL(qe,ht.u_depth),u_terrain:new P.aL(qe,ht.u_terrain),u_terrain_dim:new P.aM(qe,ht.u_terrain_dim),u_terrain_matrix:new P.aN(qe,ht.u_terrain_matrix),u_terrain_unpack:new P.aO(qe,ht.u_terrain_unpack),u_terrain_exaggeration:new P.aM(qe,ht.u_terrain_exaggeration)}))(l,Pe),this.binderUniforms=S?S.getUniforms(l,Pe):[]}draw(l,g,S,k,F,Z,u,h,d,y,b,I,R,N,W,K,le,de){const ge=l.gl;if(this.failedToCreate)return;if(l.program.set(this.program),l.setDepthMode(S),l.setStencilMode(k),l.setColorMode(F),l.setCullFace(Z),h){l.activeTexture.set(ge.TEXTURE2),ge.bindTexture(ge.TEXTURE_2D,h.depthTexture),l.activeTexture.set(ge.TEXTURE3),ge.bindTexture(ge.TEXTURE_2D,h.texture);for(const Pe in this.terrainUniforms)this.terrainUniforms[Pe].set(h[Pe])}for(const Pe in this.fixedUniforms)this.fixedUniforms[Pe].set(u[Pe]);W&&W.setUniforms(l,this.binderUniforms,R,{zoom:N});let ke=0;switch(g){case ge.LINES:ke=2;break;case ge.TRIANGLES:ke=3;break;case ge.LINE_STRIP:ke=1}for(const Pe of I.get()){const qe=Pe.vaos||(Pe.vaos={});(qe[d]||(qe[d]=new Ze)).bind(l,this,y,W?W.getPaintVertexBuffers():[],b,Pe.vertexOffset,K,le,de),ge.drawElements(g,Pe.primitiveLength*ke,ge.UNSIGNED_SHORT,Pe.primitiveOffset*ke*2)}}}function uo(z,l,g){const S=1/Qe(g,1,l.transform.tileZoom),k=Math.pow(2,g.tileID.overscaledZ),F=g.tileSize*Math.pow(2,l.transform.tileZoom)/k,Z=F*(g.tileID.canonical.x+g.tileID.wrap*k),u=F*g.tileID.canonical.y;return{u_image:0,u_texsize:g.imageAtlasTexture.size,u_scale:[S,z.fromScale,z.toScale],u_fade:z.t,u_pixel_coord_upper:[Z>>16,u>>16],u_pixel_coord_lower:[65535&Z,65535&u]}}const JA=(z,l,g,S)=>{const k=l.style.light,F=k.properties.get("position"),Z=[F.x,F.y,F.z],u=function(){var d=new P.A(9);return P.A!=Float32Array&&(d[1]=0,d[2]=0,d[3]=0,d[5]=0,d[6]=0,d[7]=0),d[0]=1,d[4]=1,d[8]=1,d}();k.properties.get("anchor")==="viewport"&&function(d,y){var b=Math.sin(y),I=Math.cos(y);d[0]=I,d[1]=b,d[2]=0,d[3]=-b,d[4]=I,d[5]=0,d[6]=0,d[7]=0,d[8]=1}(u,-l.transform.angle),function(d,y,b){var I=y[0],R=y[1],N=y[2];d[0]=I*b[0]+R*b[3]+N*b[6],d[1]=I*b[1]+R*b[4]+N*b[7],d[2]=I*b[2]+R*b[5]+N*b[8]}(Z,Z,u);const h=k.properties.get("color");return{u_matrix:z,u_lightpos:Z,u_lightintensity:k.properties.get("intensity"),u_lightcolor:[h.r,h.g,h.b],u_vertical_gradient:+g,u_opacity:S}},Wi=(z,l,g,S,k,F,Z)=>P.e(JA(z,l,g,S),uo(F,l,Z),{u_height_factor:-Math.pow(2,k.overscaledZ)/Z.tileSize/8}),dn=z=>({u_matrix:z}),Jo=(z,l,g,S)=>P.e(dn(z),uo(g,l,S)),Gs=(z,l)=>({u_matrix:z,u_world:l}),Yn=(z,l,g,S,k)=>P.e(Jo(z,l,g,S),{u_world:k}),xo=(z,l,g,S)=>{const k=z.transform;let F,Z;if(S.paint.get("circle-pitch-alignment")==="map"){const u=Qe(g,1,k.zoom);F=!0,Z=[u,u]}else F=!1,Z=k.pixelsToGLUnits;return{u_camera_to_center_distance:k.cameraToCenterDistance,u_scale_with_map:+(S.paint.get("circle-pitch-scale")==="map"),u_matrix:z.translatePosMatrix(l.posMatrix,g,S.paint.get("circle-translate"),S.paint.get("circle-translate-anchor")),u_pitch_with_map:+F,u_device_pixel_ratio:z.pixelRatio,u_extrude_scale:Z}},Fs=(z,l,g)=>{const S=Qe(g,1,l.zoom),k=Math.pow(2,l.zoom-g.tileID.overscaledZ),F=g.tileID.overscaleFactor();return{u_matrix:z,u_camera_to_center_distance:l.cameraToCenterDistance,u_pixels_to_tile_units:S,u_extrude_scale:[l.pixelsToGLUnits[0]/(S*k),l.pixelsToGLUnits[1]/(S*k)],u_overscale_factor:F}},Pl=(z,l,g=1)=>({u_matrix:z,u_color:l,u_overlay:0,u_overlay_scale:g}),$A=z=>({u_matrix:z}),ec=(z,l,g,S)=>({u_matrix:z,u_extrude_scale:Qe(l,1,g),u_intensity:S});function zl(z,l){const g=Math.pow(2,l.canonical.z),S=l.canonical.y;return[new P.U(0,S/g).toLngLat().lat,new P.U(0,(S+1)/g).toLngLat().lat]}const fA=(z,l,g,S)=>{const k=z.transform;return{u_matrix:Jt(z,l,g,S),u_ratio:1/Qe(l,1,k.zoom),u_device_pixel_ratio:z.pixelRatio,u_units_to_pixels:[1/k.pixelsToGLUnits[0],1/k.pixelsToGLUnits[1]]}},ns=(z,l,g,S,k)=>P.e(fA(z,l,g,k),{u_image:0,u_image_height:S}),tc=(z,l,g,S,k)=>{const F=z.transform,Z=dA(l,F);return{u_matrix:Jt(z,l,g,k),u_texsize:l.imageAtlasTexture.size,u_ratio:1/Qe(l,1,F.zoom),u_device_pixel_ratio:z.pixelRatio,u_image:0,u_scale:[Z,S.fromScale,S.toScale],u_fade:S.t,u_units_to_pixels:[1/F.pixelsToGLUnits[0],1/F.pixelsToGLUnits[1]]}},qn=(z,l,g,S,k,F)=>{const Z=z.lineAtlas,u=dA(l,z.transform),h=g.layout.get("line-cap")==="round",d=Z.getDash(S.from,h),y=Z.getDash(S.to,h),b=d.width*k.fromScale,I=y.width*k.toScale;return P.e(fA(z,l,g,F),{u_patternscale_a:[u/b,-d.height/2],u_patternscale_b:[u/I,-y.height/2],u_sdfgamma:Z.width/(256*Math.min(b,I)*z.pixelRatio)/2,u_image:0,u_tex_y_a:d.y,u_tex_y_b:y.y,u_mix:k.t})};function dA(z,l){return 1/Qe(z,1,l.tileZoom)}function Jt(z,l,g,S){return z.translatePosMatrix(S?S.posMatrix:l.tileID.posMatrix,l,g.paint.get("line-translate"),g.paint.get("line-translate-anchor"))}const $i=(z,l,g,S,k)=>{return{u_matrix:z,u_tl_parent:l,u_scale_parent:g,u_buffer_scale:1,u_fade_t:S.mix,u_opacity:S.opacity*k.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:k.paint.get("raster-brightness-min"),u_brightness_high:k.paint.get("raster-brightness-max"),u_saturation_factor:(Z=k.paint.get("raster-saturation"),Z>0?1-1/(1.001-Z):-Z),u_contrast_factor:(F=k.paint.get("raster-contrast"),F>0?1/(1-F):1+F),u_spin_weights:ss(k.paint.get("raster-hue-rotate"))};var F,Z};function ss(z){z*=Math.PI/180;const l=Math.sin(z),g=Math.cos(z);return[(2*g+1)/3,(-Math.sqrt(3)*l-g+1)/3,(Math.sqrt(3)*l-g+1)/3]}const xt=(z,l,g,S,k,F,Z,u,h,d)=>{const y=k.transform;return{u_is_size_zoom_constant:+(z==="constant"||z==="source"),u_is_size_feature_constant:+(z==="constant"||z==="camera"),u_size_t:l?l.uSizeT:0,u_size:l?l.uSize:0,u_camera_to_center_distance:y.cameraToCenterDistance,u_pitch:y.pitch/360*2*Math.PI,u_rotate_symbol:+g,u_aspect_ratio:y.width/y.height,u_fade_change:k.options.fadeDuration?k.symbolFadeChange:1,u_matrix:F,u_label_plane_matrix:Z,u_coord_matrix:u,u_is_text:+h,u_pitch_with_map:+S,u_texsize:d,u_texture:0}},gi=(z,l,g,S,k,F,Z,u,h,d,y)=>{const b=k.transform;return P.e(xt(z,l,g,S,k,F,Z,u,h,d),{u_gamma_scale:S?Math.cos(b._pitch)*b.cameraToCenterDistance:1,u_device_pixel_ratio:k.pixelRatio,u_is_halo:+y})},Fo=(z,l,g,S,k,F,Z,u,h,d)=>P.e(gi(z,l,g,S,k,F,Z,u,!0,h,!0),{u_texsize_icon:d,u_texture_icon:1}),$o=(z,l,g)=>({u_matrix:z,u_opacity:l,u_color:g}),vn=(z,l,g,S,k,F)=>P.e(function(Z,u,h,d){const y=h.imageManager.getPattern(Z.from.toString()),b=h.imageManager.getPattern(Z.to.toString()),{width:I,height:R}=h.imageManager.getPixelSize(),N=Math.pow(2,d.tileID.overscaledZ),W=d.tileSize*Math.pow(2,h.transform.tileZoom)/N,K=W*(d.tileID.canonical.x+d.tileID.wrap*N),le=W*d.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:y.tl,u_pattern_br_a:y.br,u_pattern_tl_b:b.tl,u_pattern_br_b:b.br,u_texsize:[I,R],u_mix:u.t,u_pattern_size_a:y.displaySize,u_pattern_size_b:b.displaySize,u_scale_a:u.fromScale,u_scale_b:u.toScale,u_tile_units_to_pixels:1/Qe(d,1,h.transform.tileZoom),u_pixel_coord_upper:[K>>16,le>>16],u_pixel_coord_lower:[65535&K,65535&le]}}(S,F,g,k),{u_matrix:z,u_opacity:l}),la={fillExtrusion:(z,l)=>({u_matrix:new P.aN(z,l.u_matrix),u_lightpos:new P.aP(z,l.u_lightpos),u_lightintensity:new P.aM(z,l.u_lightintensity),u_lightcolor:new P.aP(z,l.u_lightcolor),u_vertical_gradient:new P.aM(z,l.u_vertical_gradient),u_opacity:new P.aM(z,l.u_opacity)}),fillExtrusionPattern:(z,l)=>({u_matrix:new P.aN(z,l.u_matrix),u_lightpos:new P.aP(z,l.u_lightpos),u_lightintensity:new P.aM(z,l.u_lightintensity),u_lightcolor:new P.aP(z,l.u_lightcolor),u_vertical_gradient:new P.aM(z,l.u_vertical_gradient),u_height_factor:new P.aM(z,l.u_height_factor),u_image:new P.aL(z,l.u_image),u_texsize:new P.aQ(z,l.u_texsize),u_pixel_coord_upper:new P.aQ(z,l.u_pixel_coord_upper),u_pixel_coord_lower:new P.aQ(z,l.u_pixel_coord_lower),u_scale:new P.aP(z,l.u_scale),u_fade:new P.aM(z,l.u_fade),u_opacity:new P.aM(z,l.u_opacity)}),fill:(z,l)=>({u_matrix:new P.aN(z,l.u_matrix)}),fillPattern:(z,l)=>({u_matrix:new P.aN(z,l.u_matrix),u_image:new P.aL(z,l.u_image),u_texsize:new P.aQ(z,l.u_texsize),u_pixel_coord_upper:new P.aQ(z,l.u_pixel_coord_upper),u_pixel_coord_lower:new P.aQ(z,l.u_pixel_coord_lower),u_scale:new P.aP(z,l.u_scale),u_fade:new P.aM(z,l.u_fade)}),fillOutline:(z,l)=>({u_matrix:new P.aN(z,l.u_matrix),u_world:new P.aQ(z,l.u_world)}),fillOutlinePattern:(z,l)=>({u_matrix:new P.aN(z,l.u_matrix),u_world:new P.aQ(z,l.u_world),u_image:new P.aL(z,l.u_image),u_texsize:new P.aQ(z,l.u_texsize),u_pixel_coord_upper:new P.aQ(z,l.u_pixel_coord_upper),u_pixel_coord_lower:new P.aQ(z,l.u_pixel_coord_lower),u_scale:new P.aP(z,l.u_scale),u_fade:new P.aM(z,l.u_fade)}),circle:(z,l)=>({u_camera_to_center_distance:new P.aM(z,l.u_camera_to_center_distance),u_scale_with_map:new P.aL(z,l.u_scale_with_map),u_pitch_with_map:new P.aL(z,l.u_pitch_with_map),u_extrude_scale:new P.aQ(z,l.u_extrude_scale),u_device_pixel_ratio:new P.aM(z,l.u_device_pixel_ratio),u_matrix:new P.aN(z,l.u_matrix)}),collisionBox:(z,l)=>({u_matrix:new P.aN(z,l.u_matrix),u_camera_to_center_distance:new P.aM(z,l.u_camera_to_center_distance),u_pixels_to_tile_units:new P.aM(z,l.u_pixels_to_tile_units),u_extrude_scale:new P.aQ(z,l.u_extrude_scale),u_overscale_factor:new P.aM(z,l.u_overscale_factor)}),collisionCircle:(z,l)=>({u_matrix:new P.aN(z,l.u_matrix),u_inv_matrix:new P.aN(z,l.u_inv_matrix),u_camera_to_center_distance:new P.aM(z,l.u_camera_to_center_distance),u_viewport_size:new P.aQ(z,l.u_viewport_size)}),debug:(z,l)=>({u_color:new P.aR(z,l.u_color),u_matrix:new P.aN(z,l.u_matrix),u_overlay:new P.aL(z,l.u_overlay),u_overlay_scale:new P.aM(z,l.u_overlay_scale)}),clippingMask:(z,l)=>({u_matrix:new P.aN(z,l.u_matrix)}),heatmap:(z,l)=>({u_extrude_scale:new P.aM(z,l.u_extrude_scale),u_intensity:new P.aM(z,l.u_intensity),u_matrix:new P.aN(z,l.u_matrix)}),heatmapTexture:(z,l)=>({u_matrix:new P.aN(z,l.u_matrix),u_world:new P.aQ(z,l.u_world),u_image:new P.aL(z,l.u_image),u_color_ramp:new P.aL(z,l.u_color_ramp),u_opacity:new P.aM(z,l.u_opacity)}),hillshade:(z,l)=>({u_matrix:new P.aN(z,l.u_matrix),u_image:new P.aL(z,l.u_image),u_latrange:new P.aQ(z,l.u_latrange),u_light:new P.aQ(z,l.u_light),u_shadow:new P.aR(z,l.u_shadow),u_highlight:new P.aR(z,l.u_highlight),u_accent:new P.aR(z,l.u_accent)}),hillshadePrepare:(z,l)=>({u_matrix:new P.aN(z,l.u_matrix),u_image:new P.aL(z,l.u_image),u_dimension:new P.aQ(z,l.u_dimension),u_zoom:new P.aM(z,l.u_zoom),u_unpack:new P.aO(z,l.u_unpack)}),line:(z,l)=>({u_matrix:new P.aN(z,l.u_matrix),u_ratio:new P.aM(z,l.u_ratio),u_device_pixel_ratio:new P.aM(z,l.u_device_pixel_ratio),u_units_to_pixels:new P.aQ(z,l.u_units_to_pixels)}),lineGradient:(z,l)=>({u_matrix:new P.aN(z,l.u_matrix),u_ratio:new P.aM(z,l.u_ratio),u_device_pixel_ratio:new P.aM(z,l.u_device_pixel_ratio),u_units_to_pixels:new P.aQ(z,l.u_units_to_pixels),u_image:new P.aL(z,l.u_image),u_image_height:new P.aM(z,l.u_image_height)}),linePattern:(z,l)=>({u_matrix:new P.aN(z,l.u_matrix),u_texsize:new P.aQ(z,l.u_texsize),u_ratio:new P.aM(z,l.u_ratio),u_device_pixel_ratio:new P.aM(z,l.u_device_pixel_ratio),u_image:new P.aL(z,l.u_image),u_units_to_pixels:new P.aQ(z,l.u_units_to_pixels),u_scale:new P.aP(z,l.u_scale),u_fade:new P.aM(z,l.u_fade)}),lineSDF:(z,l)=>({u_matrix:new P.aN(z,l.u_matrix),u_ratio:new P.aM(z,l.u_ratio),u_device_pixel_ratio:new P.aM(z,l.u_device_pixel_ratio),u_units_to_pixels:new P.aQ(z,l.u_units_to_pixels),u_patternscale_a:new P.aQ(z,l.u_patternscale_a),u_patternscale_b:new P.aQ(z,l.u_patternscale_b),u_sdfgamma:new P.aM(z,l.u_sdfgamma),u_image:new P.aL(z,l.u_image),u_tex_y_a:new P.aM(z,l.u_tex_y_a),u_tex_y_b:new P.aM(z,l.u_tex_y_b),u_mix:new P.aM(z,l.u_mix)}),raster:(z,l)=>({u_matrix:new P.aN(z,l.u_matrix),u_tl_parent:new P.aQ(z,l.u_tl_parent),u_scale_parent:new P.aM(z,l.u_scale_parent),u_buffer_scale:new P.aM(z,l.u_buffer_scale),u_fade_t:new P.aM(z,l.u_fade_t),u_opacity:new P.aM(z,l.u_opacity),u_image0:new P.aL(z,l.u_image0),u_image1:new P.aL(z,l.u_image1),u_brightness_low:new P.aM(z,l.u_brightness_low),u_brightness_high:new P.aM(z,l.u_brightness_high),u_saturation_factor:new P.aM(z,l.u_saturation_factor),u_contrast_factor:new P.aM(z,l.u_contrast_factor),u_spin_weights:new P.aP(z,l.u_spin_weights)}),symbolIcon:(z,l)=>({u_is_size_zoom_constant:new P.aL(z,l.u_is_size_zoom_constant),u_is_size_feature_constant:new P.aL(z,l.u_is_size_feature_constant),u_size_t:new P.aM(z,l.u_size_t),u_size:new P.aM(z,l.u_size),u_camera_to_center_distance:new P.aM(z,l.u_camera_to_center_distance),u_pitch:new P.aM(z,l.u_pitch),u_rotate_symbol:new P.aL(z,l.u_rotate_symbol),u_aspect_ratio:new P.aM(z,l.u_aspect_ratio),u_fade_change:new P.aM(z,l.u_fade_change),u_matrix:new P.aN(z,l.u_matrix),u_label_plane_matrix:new P.aN(z,l.u_label_plane_matrix),u_coord_matrix:new P.aN(z,l.u_coord_matrix),u_is_text:new P.aL(z,l.u_is_text),u_pitch_with_map:new P.aL(z,l.u_pitch_with_map),u_texsize:new P.aQ(z,l.u_texsize),u_texture:new P.aL(z,l.u_texture)}),symbolSDF:(z,l)=>({u_is_size_zoom_constant:new P.aL(z,l.u_is_size_zoom_constant),u_is_size_feature_constant:new P.aL(z,l.u_is_size_feature_constant),u_size_t:new P.aM(z,l.u_size_t),u_size:new P.aM(z,l.u_size),u_camera_to_center_distance:new P.aM(z,l.u_camera_to_center_distance),u_pitch:new P.aM(z,l.u_pitch),u_rotate_symbol:new P.aL(z,l.u_rotate_symbol),u_aspect_ratio:new P.aM(z,l.u_aspect_ratio),u_fade_change:new P.aM(z,l.u_fade_change),u_matrix:new P.aN(z,l.u_matrix),u_label_plane_matrix:new P.aN(z,l.u_label_plane_matrix),u_coord_matrix:new P.aN(z,l.u_coord_matrix),u_is_text:new P.aL(z,l.u_is_text),u_pitch_with_map:new P.aL(z,l.u_pitch_with_map),u_texsize:new P.aQ(z,l.u_texsize),u_texture:new P.aL(z,l.u_texture),u_gamma_scale:new P.aM(z,l.u_gamma_scale),u_device_pixel_ratio:new P.aM(z,l.u_device_pixel_ratio),u_is_halo:new P.aL(z,l.u_is_halo)}),symbolTextAndIcon:(z,l)=>({u_is_size_zoom_constant:new P.aL(z,l.u_is_size_zoom_constant),u_is_size_feature_constant:new P.aL(z,l.u_is_size_feature_constant),u_size_t:new P.aM(z,l.u_size_t),u_size:new P.aM(z,l.u_size),u_camera_to_center_distance:new P.aM(z,l.u_camera_to_center_distance),u_pitch:new P.aM(z,l.u_pitch),u_rotate_symbol:new P.aL(z,l.u_rotate_symbol),u_aspect_ratio:new P.aM(z,l.u_aspect_ratio),u_fade_change:new P.aM(z,l.u_fade_change),u_matrix:new P.aN(z,l.u_matrix),u_label_plane_matrix:new P.aN(z,l.u_label_plane_matrix),u_coord_matrix:new P.aN(z,l.u_coord_matrix),u_is_text:new P.aL(z,l.u_is_text),u_pitch_with_map:new P.aL(z,l.u_pitch_with_map),u_texsize:new P.aQ(z,l.u_texsize),u_texsize_icon:new P.aQ(z,l.u_texsize_icon),u_texture:new P.aL(z,l.u_texture),u_texture_icon:new P.aL(z,l.u_texture_icon),u_gamma_scale:new P.aM(z,l.u_gamma_scale),u_device_pixel_ratio:new P.aM(z,l.u_device_pixel_ratio),u_is_halo:new P.aL(z,l.u_is_halo)}),background:(z,l)=>({u_matrix:new P.aN(z,l.u_matrix),u_opacity:new P.aM(z,l.u_opacity),u_color:new P.aR(z,l.u_color)}),backgroundPattern:(z,l)=>({u_matrix:new P.aN(z,l.u_matrix),u_opacity:new P.aM(z,l.u_opacity),u_image:new P.aL(z,l.u_image),u_pattern_tl_a:new P.aQ(z,l.u_pattern_tl_a),u_pattern_br_a:new P.aQ(z,l.u_pattern_br_a),u_pattern_tl_b:new P.aQ(z,l.u_pattern_tl_b),u_pattern_br_b:new P.aQ(z,l.u_pattern_br_b),u_texsize:new P.aQ(z,l.u_texsize),u_mix:new P.aM(z,l.u_mix),u_pattern_size_a:new P.aQ(z,l.u_pattern_size_a),u_pattern_size_b:new P.aQ(z,l.u_pattern_size_b),u_scale_a:new P.aM(z,l.u_scale_a),u_scale_b:new P.aM(z,l.u_scale_b),u_pixel_coord_upper:new P.aQ(z,l.u_pixel_coord_upper),u_pixel_coord_lower:new P.aQ(z,l.u_pixel_coord_lower),u_tile_units_to_pixels:new P.aM(z,l.u_tile_units_to_pixels)}),terrain:(z,l)=>({u_matrix:new P.aN(z,l.u_matrix),u_texture:new P.aL(z,l.u_texture),u_ele_delta:new P.aM(z,l.u_ele_delta)}),terrainDepth:(z,l)=>({u_matrix:new P.aN(z,l.u_matrix),u_ele_delta:new P.aM(z,l.u_ele_delta)}),terrainCoords:(z,l)=>({u_matrix:new P.aN(z,l.u_matrix),u_texture:new P.aL(z,l.u_texture),u_terrain_coords_id:new P.aM(z,l.u_terrain_coords_id),u_ele_delta:new P.aM(z,l.u_ele_delta)})};class $l{constructor(l,g,S){this.context=l;const k=l.gl;this.buffer=k.createBuffer(),this.dynamicDraw=!!S,this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),k.bufferData(k.ELEMENT_ARRAY_BUFFER,g.arrayBuffer,this.dynamicDraw?k.DYNAMIC_DRAW:k.STATIC_DRAW),this.dynamicDraw||delete g.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(l){const g=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),g.bufferSubData(g.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Oo={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class eA{constructor(l,g,S,k){this.length=g.length,this.attributes=S,this.itemSize=g.bytesPerElement,this.dynamicDraw=k,this.context=l;const F=l.gl;this.buffer=F.createBuffer(),l.bindVertexBuffer.set(this.buffer),F.bufferData(F.ARRAY_BUFFER,g.arrayBuffer,this.dynamicDraw?F.DYNAMIC_DRAW:F.STATIC_DRAW),this.dynamicDraw||delete g.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(l){if(l.length!==this.length)throw new Error(`Length of new data is ${l.length}, which doesn't match current length of ${this.length}`);const g=this.context.gl;this.bind(),g.bufferSubData(g.ARRAY_BUFFER,0,l.arrayBuffer)}enableAttributes(l,g){for(let S=0;S<this.attributes.length;S++){const k=g.attributes[this.attributes[S].name];k!==void 0&&l.enableVertexAttribArray(k)}}setVertexAttribPointers(l,g,S){for(let k=0;k<this.attributes.length;k++){const F=this.attributes[k],Z=g.attributes[F.name];Z!==void 0&&l.vertexAttribPointer(Z,F.components,l[Oo[F.type]],!1,this.itemSize,F.offset+this.itemSize*(S||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const pA=new WeakMap;function Kn(z){var l;if(pA.has(z))return pA.get(z);{const g=(l=z.getParameter(z.VERSION))===null||l===void 0?void 0:l.startsWith("WebGL 2.0");return pA.set(z,g),g}}class Wt{constructor(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(l){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ui extends Wt{getDefault(){return P.aT.transparent}set(l){const g=this.current;(l.r!==g.r||l.g!==g.g||l.b!==g.b||l.a!==g.a||this.dirty)&&(this.gl.clearColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class sr extends Wt{getDefault(){return 1}set(l){(l!==this.current||this.dirty)&&(this.gl.clearDepth(l),this.current=l,this.dirty=!1)}}class tn extends Wt{getDefault(){return 0}set(l){(l!==this.current||this.dirty)&&(this.gl.clearStencil(l),this.current=l,this.dirty=!1)}}class Aa extends Wt{getDefault(){return[!0,!0,!0,!0]}set(l){const g=this.current;(l[0]!==g[0]||l[1]!==g[1]||l[2]!==g[2]||l[3]!==g[3]||this.dirty)&&(this.gl.colorMask(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class Dr extends Wt{getDefault(){return!0}set(l){(l!==this.current||this.dirty)&&(this.gl.depthMask(l),this.current=l,this.dirty=!1)}}class ba extends Wt{getDefault(){return 255}set(l){(l!==this.current||this.dirty)&&(this.gl.stencilMask(l),this.current=l,this.dirty=!1)}}class rl extends Wt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(l){const g=this.current;(l.func!==g.func||l.ref!==g.ref||l.mask!==g.mask||this.dirty)&&(this.gl.stencilFunc(l.func,l.ref,l.mask),this.current=l,this.dirty=!1)}}class ca extends Wt{getDefault(){const l=this.gl;return[l.KEEP,l.KEEP,l.KEEP]}set(l){const g=this.current;(l[0]!==g[0]||l[1]!==g[1]||l[2]!==g[2]||this.dirty)&&(this.gl.stencilOp(l[0],l[1],l[2]),this.current=l,this.dirty=!1)}}class ho extends Wt{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const g=this.gl;l?g.enable(g.STENCIL_TEST):g.disable(g.STENCIL_TEST),this.current=l,this.dirty=!1}}class Jn extends Wt{getDefault(){return[0,1]}set(l){const g=this.current;(l[0]!==g[0]||l[1]!==g[1]||this.dirty)&&(this.gl.depthRange(l[0],l[1]),this.current=l,this.dirty=!1)}}class gl extends Wt{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const g=this.gl;l?g.enable(g.DEPTH_TEST):g.disable(g.DEPTH_TEST),this.current=l,this.dirty=!1}}class Zs extends Wt{getDefault(){return this.gl.LESS}set(l){(l!==this.current||this.dirty)&&(this.gl.depthFunc(l),this.current=l,this.dirty=!1)}}class wa extends Wt{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const g=this.gl;l?g.enable(g.BLEND):g.disable(g.BLEND),this.current=l,this.dirty=!1}}class Bl extends Wt{getDefault(){const l=this.gl;return[l.ONE,l.ZERO]}set(l){const g=this.current;(l[0]!==g[0]||l[1]!==g[1]||this.dirty)&&(this.gl.blendFunc(l[0],l[1]),this.current=l,this.dirty=!1)}}class Ta extends Wt{getDefault(){return P.aT.transparent}set(l){const g=this.current;(l.r!==g.r||l.g!==g.g||l.b!==g.b||l.a!==g.a||this.dirty)&&(this.gl.blendColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class nl extends Wt{getDefault(){return this.gl.FUNC_ADD}set(l){(l!==this.current||this.dirty)&&(this.gl.blendEquation(l),this.current=l,this.dirty=!1)}}class Va extends Wt{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const g=this.gl;l?g.enable(g.CULL_FACE):g.disable(g.CULL_FACE),this.current=l,this.dirty=!1}}class ic extends Wt{getDefault(){return this.gl.BACK}set(l){(l!==this.current||this.dirty)&&(this.gl.cullFace(l),this.current=l,this.dirty=!1)}}class mA extends Wt{getDefault(){return this.gl.CCW}set(l){(l!==this.current||this.dirty)&&(this.gl.frontFace(l),this.current=l,this.dirty=!1)}}class LA extends Wt{getDefault(){return null}set(l){(l!==this.current||this.dirty)&&(this.gl.useProgram(l),this.current=l,this.dirty=!1)}}class ea extends Wt{getDefault(){return this.gl.TEXTURE0}set(l){(l!==this.current||this.dirty)&&(this.gl.activeTexture(l),this.current=l,this.dirty=!1)}}class fr extends Wt{getDefault(){const l=this.gl;return[0,0,l.drawingBufferWidth,l.drawingBufferHeight]}set(l){const g=this.current;(l[0]!==g[0]||l[1]!==g[1]||l[2]!==g[2]||l[3]!==g[3]||this.dirty)&&(this.gl.viewport(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class ja extends Wt{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const g=this.gl;g.bindFramebuffer(g.FRAMEBUFFER,l),this.current=l,this.dirty=!1}}class RA extends Wt{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const g=this.gl;g.bindRenderbuffer(g.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class vo extends Wt{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const g=this.gl;g.bindTexture(g.TEXTURE_2D,l),this.current=l,this.dirty=!1}}class fo extends Wt{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const g=this.gl;g.bindBuffer(g.ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class Ll extends Wt{getDefault(){return null}set(l){const g=this.gl;g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class tA extends Wt{getDefault(){return null}set(l){var g;if(l===this.current&&!this.dirty)return;const S=this.gl;Kn(S)?S.bindVertexArray(l):(g=S.getExtension("OES_vertex_array_object"))===null||g===void 0||g.bindVertexArrayOES(l),this.current=l,this.dirty=!1}}class ms extends Wt{getDefault(){return 4}set(l){if(l===this.current&&!this.dirty)return;const g=this.gl;g.pixelStorei(g.UNPACK_ALIGNMENT,l),this.current=l,this.dirty=!1}}class Ea extends Wt{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const g=this.gl;g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,l),this.current=l,this.dirty=!1}}class Rl extends Wt{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const g=this.gl;g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,l),this.current=l,this.dirty=!1}}class qs extends Wt{constructor(l,g){super(l),this.context=l,this.parent=g}getDefault(){return null}}class fs extends qs{setDirty(){this.dirty=!0}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const g=this.gl;g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,l,0),this.current=l,this.dirty=!1}}class Fl extends qs{set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const g=this.gl;g.framebufferRenderbuffer(g.FRAMEBUFFER,g.DEPTH_ATTACHMENT,g.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class FA extends qs{set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const g=this.gl;g.framebufferRenderbuffer(g.FRAMEBUFFER,g.DEPTH_STENCIL_ATTACHMENT,g.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class Ur{constructor(l,g,S,k,F){this.context=l,this.width=g,this.height=S;const Z=l.gl,u=this.framebuffer=Z.createFramebuffer();if(this.colorAttachment=new fs(l,u),k)this.depthAttachment=F?new FA(l,u):new Fl(l,u);else if(F)throw new Error("Stencil cannot be setted without depth");if(Z.checkFramebufferStatus(Z.FRAMEBUFFER)!==Z.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const l=this.context.gl,g=this.colorAttachment.get();if(g&&l.deleteTexture(g),this.depthAttachment){const S=this.depthAttachment.get();S&&l.deleteRenderbuffer(S)}l.deleteFramebuffer(this.framebuffer)}}class $n{constructor(l,g,S){this.blendFunction=l,this.blendColor=g,this.mask=S}}$n.Replace=[1,0],$n.disabled=new $n($n.Replace,P.aT.transparent,[!1,!1,!1,!1]),$n.unblended=new $n($n.Replace,P.aT.transparent,[!0,!0,!0,!0]),$n.alphaBlended=new $n([1,771],P.aT.transparent,[!0,!0,!0,!0]);class iA{constructor(l){var g,S;if(this.gl=l,this.clearColor=new Ui(this),this.clearDepth=new sr(this),this.clearStencil=new tn(this),this.colorMask=new Aa(this),this.depthMask=new Dr(this),this.stencilMask=new ba(this),this.stencilFunc=new rl(this),this.stencilOp=new ca(this),this.stencilTest=new ho(this),this.depthRange=new Jn(this),this.depthTest=new gl(this),this.depthFunc=new Zs(this),this.blend=new wa(this),this.blendFunc=new Bl(this),this.blendColor=new Ta(this),this.blendEquation=new nl(this),this.cullFace=new Va(this),this.cullFaceSide=new ic(this),this.frontFace=new mA(this),this.program=new LA(this),this.activeTexture=new ea(this),this.viewport=new fr(this),this.bindFramebuffer=new ja(this),this.bindRenderbuffer=new RA(this),this.bindTexture=new vo(this),this.bindVertexBuffer=new fo(this),this.bindElementBuffer=new Ll(this),this.bindVertexArray=new tA(this),this.pixelStoreUnpack=new ms(this),this.pixelStoreUnpackPremultiplyAlpha=new Ea(this),this.pixelStoreUnpackFlipY=new Rl(this),this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE),Kn(l)){this.HALF_FLOAT=l.HALF_FLOAT;const k=l.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(g=l.RGBA16F)!==null&&g!==void 0?g:k==null?void 0:k.RGBA16F_EXT,this.RGB16F=(S=l.RGB16F)!==null&&S!==void 0?S:k==null?void 0:k.RGB16F_EXT,l.getExtension("EXT_color_buffer_float")}else{l.getExtension("EXT_color_buffer_half_float"),l.getExtension("OES_texture_half_float_linear");const k=l.getExtension("OES_texture_half_float");this.HALF_FLOAT=k==null?void 0:k.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(l,g){return new $l(this,l,g)}createVertexBuffer(l,g,S){return new eA(this,l,g,S)}createRenderbuffer(l,g,S){const k=this.gl,F=k.createRenderbuffer();return this.bindRenderbuffer.set(F),k.renderbufferStorage(k.RENDERBUFFER,l,g,S),this.bindRenderbuffer.set(null),F}createFramebuffer(l,g,S,k){return new Ur(this,l,g,S,k)}clear({color:l,depth:g,stencil:S}){const k=this.gl;let F=0;l&&(F|=k.COLOR_BUFFER_BIT,this.clearColor.set(l),this.colorMask.set([!0,!0,!0,!0])),g!==void 0&&(F|=k.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(g),this.depthMask.set(!0)),S!==void 0&&(F|=k.STENCIL_BUFFER_BIT,this.clearStencil.set(S),this.stencilMask.set(255)),k.clear(F)}setCullFace(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))}setDepthMode(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)}setStencilMode(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)}setColorMode(l){P.aG(l.blendFunction,$n.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor)),this.colorMask.set(l.mask)}createVertexArray(){var l;return Kn(this.gl)?this.gl.createVertexArray():(l=this.gl.getExtension("OES_vertex_array_object"))===null||l===void 0?void 0:l.createVertexArrayOES()}deleteVertexArray(l){var g;return Kn(this.gl)?this.gl.deleteVertexArray(l):(g=this.gl.getExtension("OES_vertex_array_object"))===null||g===void 0?void 0:g.deleteVertexArrayOES(l)}unbindVAO(){this.bindVertexArray.set(null)}}class Vi{constructor(l,g,S){this.func=l,this.mask=g,this.range=S}}Vi.ReadOnly=!1,Vi.ReadWrite=!0,Vi.disabled=new Vi(519,Vi.ReadOnly,[0,1]);const Ma=7680;class os{constructor(l,g,S,k,F,Z){this.test=l,this.ref=g,this.mask=S,this.fail=k,this.depthFail=F,this.pass=Z}}os.disabled=new os({func:519,mask:0},0,0,Ma,Ma,Ma);class Sn{constructor(l,g,S){this.enable=l,this.mode=g,this.frontFace=S}}let Ga;function zc(z,l,g,S,k,F,Z){const u=z.context,h=u.gl,d=z.useProgram("collisionBox"),y=[];let b=0,I=0;for(let ge=0;ge<S.length;ge++){const ke=S[ge],Pe=l.getTile(ke),qe=Pe.getBucket(g);if(!qe)continue;let ht=ke.posMatrix;k[0]===0&&k[1]===0||(ht=z.translatePosMatrix(ke.posMatrix,Pe,k,F));const mt=Z?qe.textCollisionBox:qe.iconCollisionBox,ot=qe.collisionCircleArray;if(ot.length>0){const ft=P.Z(),dt=ht;P.aU(ft,qe.placementInvProjMatrix,z.transform.glCoordMatrix),P.aU(ft,ft,qe.placementViewportMatrix),y.push({circleArray:ot,circleOffset:I,transform:dt,invTransform:ft,coord:ke}),b+=ot.length/4,I=b}mt&&d.draw(u,h.LINES,Vi.disabled,os.disabled,z.colorModeForRenderPass(),Sn.disabled,Fs(ht,z.transform,Pe),z.style.map.terrain&&z.style.map.terrain.getTerrainData(ke),g.id,mt.layoutVertexBuffer,mt.indexBuffer,mt.segments,null,z.transform.zoom,null,null,mt.collisionVertexBuffer)}if(!Z||!y.length)return;const R=z.useProgram("collisionCircle"),N=new P.aV;N.resize(4*b),N._trim();let W=0;for(const ge of y)for(let ke=0;ke<ge.circleArray.length/4;ke++){const Pe=4*ke,qe=ge.circleArray[Pe+0],ht=ge.circleArray[Pe+1],mt=ge.circleArray[Pe+2],ot=ge.circleArray[Pe+3];N.emplace(W++,qe,ht,mt,ot,0),N.emplace(W++,qe,ht,mt,ot,1),N.emplace(W++,qe,ht,mt,ot,2),N.emplace(W++,qe,ht,mt,ot,3)}(!Ga||Ga.length<2*b)&&(Ga=function(ge){const ke=2*ge,Pe=new P.aX;Pe.resize(ke),Pe._trim();for(let qe=0;qe<ke;qe++){const ht=6*qe;Pe.uint16[ht+0]=4*qe+0,Pe.uint16[ht+1]=4*qe+1,Pe.uint16[ht+2]=4*qe+2,Pe.uint16[ht+3]=4*qe+2,Pe.uint16[ht+4]=4*qe+3,Pe.uint16[ht+5]=4*qe+0}return Pe}(b));const K=u.createIndexBuffer(Ga,!0),le=u.createVertexBuffer(N,P.aW.members,!0);for(const ge of y){const ke={u_matrix:ge.transform,u_inv_matrix:ge.invTransform,u_camera_to_center_distance:(de=z.transform).cameraToCenterDistance,u_viewport_size:[de.width,de.height]};R.draw(u,h.TRIANGLES,Vi.disabled,os.disabled,z.colorModeForRenderPass(),Sn.disabled,ke,z.style.map.terrain&&z.style.map.terrain.getTerrainData(ge.coord),g.id,le,K,P.S.simpleSegment(0,2*ge.circleOffset,ge.circleArray.length,ge.circleArray.length/2),null,z.transform.zoom,null,null,null)}var de;le.destroy(),K.destroy()}Sn.disabled=new Sn(!1,1029,2305),Sn.backCCW=new Sn(!0,1029,2305);const sl=P.ao(new Float32Array(16));function _A(z,l,g,S,k,F){const{horizontalAlign:Z,verticalAlign:u}=P.au(z);return new P.P((-(Z-.5)*l/k+S[0])*F,(-(u-.5)*g/k+S[1])*F)}function No(z,l,g,S,k,F,Z,u,h,d,y){const b=z.text.placedSymbolArray,I=z.text.dynamicLayoutVertexArray,R=z.icon.dynamicLayoutVertexArray,N={};I.clear();for(let W=0;W<b.length;W++){const K=b.get(W),le=K.hidden||!K.crossTileID||z.allowVerticalPlacement&&!K.placedOrientation?null:S[K.crossTileID];if(le){const de=new P.P(K.anchorX,K.anchorY),ge=vr(de,g?Z:F,y),ke=bs(k.cameraToCenterDistance,ge.signedDistanceFromCamera);let Pe=P.aj(z.textSizeData,h,K)*ke/P.ap;g&&(Pe*=z.tilePixelRatio/u);const{width:qe,height:ht,anchor:mt,textOffset:ot,textBoxScale:ft}=le,dt=_A(mt,qe,ht,ot,ft,Pe),ai=g?vr(de.add(dt),F,y).point:ge.point.add(l?dt.rotate(-k.angle):dt),Ut=z.allowVerticalPlacement&&K.placedOrientation===P.ai.vertical?Math.PI/2:0;for(let Xt=0;Xt<K.numGlyphs;Xt++)P.ak(I,ai,Ut);d&&K.associatedIconIndex>=0&&(N[K.associatedIconIndex]={shiftedAnchor:ai,angle:Ut})}else Me(K.numGlyphs,I)}if(d){R.clear();const W=z.icon.placedSymbolArray;for(let K=0;K<W.length;K++){const le=W.get(K);if(le.hidden)Me(le.numGlyphs,R);else{const de=N[K];if(de)for(let ge=0;ge<le.numGlyphs;ge++)P.ak(R,de.shiftedAnchor,de.angle);else Me(le.numGlyphs,R)}}z.icon.dynamicLayoutVertexBuffer.updateData(R)}z.text.dynamicLayoutVertexBuffer.updateData(I)}function yl(z,l,g){return g.iconsInText&&l?"symbolTextAndIcon":z?"symbolSDF":"symbolIcon"}function Nn(z,l,g,S,k,F,Z,u,h,d,y,b){const I=z.context,R=I.gl,N=z.transform,W=u==="map",K=h==="map",le=u!=="viewport"&&g.layout.get("symbol-placement")!=="point",de=W&&!K&&!le,ge=!g.layout.get("symbol-sort-key").isConstant();let ke=!1;const Pe=z.depthModeForSublayer(0,Vi.ReadOnly),qe=g._unevaluatedLayout.hasValue("text-variable-anchor")||g._unevaluatedLayout.hasValue("text-variable-anchor-offset"),ht=[];for(const mt of S){const ot=l.getTile(mt),ft=ot.getBucket(g);if(!ft)continue;const dt=k?ft.text:ft.icon;if(!dt||!dt.segments.get().length||!dt.hasVisibleVertices)continue;const ai=dt.programConfigurations.get(g.id),Ut=k||ft.sdfIcons,Xt=k?ft.textSizeData:ft.iconSizeData,qt=K||N.pitch!==0,or=z.useProgram(yl(Ut,k,ft),ai),qi=P.ah(Xt,N.zoom),ji=z.style.map.terrain&&z.style.map.terrain.getTerrainData(mt);let Li,ir,Ji,Or,Xi=[0,0],Lr=null;if(k)ir=ot.glyphAtlasTexture,Ji=R.LINEAR,Li=ot.glyphAtlasTexture.size,ft.iconsInText&&(Xi=ot.imageAtlasTexture.size,Lr=ot.imageAtlasTexture,Or=qt||z.options.rotating||z.options.zooming||Xt.kind==="composite"||Xt.kind==="camera"?R.LINEAR:R.NEAREST);else{const Hs=g.layout.get("icon-size").constantOr(0)!==1||ft.iconsNeedLinear;ir=ot.imageAtlasTexture,Ji=Ut||z.options.rotating||z.options.zooming||Hs||qt?R.LINEAR:R.NEAREST,Li=ot.imageAtlasTexture.size}const Bn=Qe(ot,1,z.transform.zoom),is=ni(mt.posMatrix,K,W,z.transform,Bn),Ml=yn(mt.posMatrix,K,W,z.transform,Bn),Sl=qe&&ft.hasTextData(),Go=g.layout.get("icon-text-fit")!=="none"&&Sl&&ft.hasIconData();if(le){const Hs=z.style.map.terrain?(Xa,no)=>z.style.map.terrain.getElevation(mt,Xa,no):null,mo=g.layout.get("text-rotation-alignment")==="map";pi(ft,mt.posMatrix,z,k,is,Ml,K,d,mo,Hs)}const fc=z.translatePosMatrix(mt.posMatrix,ot,F,Z),Rc=le||k&&qe||Go?sl:is,ma=z.translatePosMatrix(Ml,ot,F,Z,!0),ro=Ut&&g.paint.get(k?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Pa;Pa=Ut?ft.iconsInText?Fo(Xt.kind,qi,de,K,z,fc,Rc,ma,Li,Xi):gi(Xt.kind,qi,de,K,z,fc,Rc,ma,k,Li,!0):xt(Xt.kind,qi,de,K,z,fc,Rc,ma,k,Li);const vA={program:or,buffers:dt,uniformValues:Pa,atlasTexture:ir,atlasTextureIcon:Lr,atlasInterpolation:Ji,atlasInterpolationIcon:Or,isSDF:Ut,hasHalo:ro};if(ge&&ft.canOverlap){ke=!0;const Hs=dt.segments.get();for(const mo of Hs)ht.push({segments:new P.S([mo]),sortKey:mo.sortKey,state:vA,terrainData:ji})}else ht.push({segments:dt.segments,sortKey:0,state:vA,terrainData:ji})}ke&&ht.sort((mt,ot)=>mt.sortKey-ot.sortKey);for(const mt of ht){const ot=mt.state;if(I.activeTexture.set(R.TEXTURE0),ot.atlasTexture.bind(ot.atlasInterpolation,R.CLAMP_TO_EDGE),ot.atlasTextureIcon&&(I.activeTexture.set(R.TEXTURE1),ot.atlasTextureIcon&&ot.atlasTextureIcon.bind(ot.atlasInterpolationIcon,R.CLAMP_TO_EDGE)),ot.isSDF){const ft=ot.uniformValues;ot.hasHalo&&(ft.u_is_halo=1,Bc(ot.buffers,mt.segments,g,z,ot.program,Pe,y,b,ft,mt.terrainData)),ft.u_is_halo=0}Bc(ot.buffers,mt.segments,g,z,ot.program,Pe,y,b,ot.uniformValues,mt.terrainData)}}function Bc(z,l,g,S,k,F,Z,u,h,d){const y=S.context;k.draw(y,y.gl.TRIANGLES,F,Z,u,Sn.disabled,h,d,g.id,z.layoutVertexBuffer,z.indexBuffer,l,g.paint,S.transform.zoom,z.programConfigurations.get(g.id),z.dynamicLayoutVertexBuffer,z.opacityVertexBuffer)}function gA(z,l,g,S,k){if(!g||!S||!S.imageAtlas)return;const F=S.imageAtlas.patternPositions;let Z=F[g.to.toString()],u=F[g.from.toString()];if(!Z&&u&&(Z=u),!u&&Z&&(u=Z),!Z||!u){const h=k.getPaintProperty(l);Z=F[h],u=F[h]}Z&&u&&z.setConstantPatternPositions(Z,u)}function ol(z,l,g,S,k,F,Z){const u=z.context.gl,h="fill-pattern",d=g.paint.get(h),y=d&&d.constantOr(1),b=g.getCrossfadeParameters();let I,R,N,W,K;Z?(R=y&&!g.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",I=u.LINES):(R=y?"fillPattern":"fill",I=u.TRIANGLES);const le=d.constantOr(null);for(const de of S){const ge=l.getTile(de);if(y&&!ge.patternsLoaded())continue;const ke=ge.getBucket(g);if(!ke)continue;const Pe=ke.programConfigurations.get(g.id),qe=z.useProgram(R,Pe),ht=z.style.map.terrain&&z.style.map.terrain.getTerrainData(de);y&&(z.context.activeTexture.set(u.TEXTURE0),ge.imageAtlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),Pe.updatePaintBuffers(b)),gA(Pe,h,le,ge,g);const mt=ht?de:null,ot=z.translatePosMatrix(mt?mt.posMatrix:de.posMatrix,ge,g.paint.get("fill-translate"),g.paint.get("fill-translate-anchor"));if(Z){W=ke.indexBuffer2,K=ke.segments2;const ft=[u.drawingBufferWidth,u.drawingBufferHeight];N=R==="fillOutlinePattern"&&y?Yn(ot,z,b,ge,ft):Gs(ot,ft)}else W=ke.indexBuffer,K=ke.segments,N=y?Jo(ot,z,b,ge):dn(ot);qe.draw(z.context,I,k,z.stencilModeForClipping(de),F,Sn.disabled,N,ht,g.id,ke.layoutVertexBuffer,W,K,g.paint,z.transform.zoom,Pe)}}function Za(z,l,g,S,k,F,Z){const u=z.context,h=u.gl,d="fill-extrusion-pattern",y=g.paint.get(d),b=y.constantOr(1),I=g.getCrossfadeParameters(),R=g.paint.get("fill-extrusion-opacity"),N=y.constantOr(null);for(const W of S){const K=l.getTile(W),le=K.getBucket(g);if(!le)continue;const de=z.style.map.terrain&&z.style.map.terrain.getTerrainData(W),ge=le.programConfigurations.get(g.id),ke=z.useProgram(b?"fillExtrusionPattern":"fillExtrusion",ge);b&&(z.context.activeTexture.set(h.TEXTURE0),K.imageAtlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE),ge.updatePaintBuffers(I)),gA(ge,d,N,K,g);const Pe=z.translatePosMatrix(W.posMatrix,K,g.paint.get("fill-extrusion-translate"),g.paint.get("fill-extrusion-translate-anchor")),qe=g.paint.get("fill-extrusion-vertical-gradient"),ht=b?Wi(Pe,z,qe,R,W,I,K):JA(Pe,z,qe,R);ke.draw(u,u.gl.TRIANGLES,k,F,Z,Sn.backCCW,ht,de,g.id,le.layoutVertexBuffer,le.indexBuffer,le.segments,g.paint,z.transform.zoom,ge,z.style.map.terrain&&le.centroidVertexBuffer)}}function Cu(z,l,g,S,k,F,Z){const u=z.context,h=u.gl,d=g.fbo;if(!d)return;const y=z.useProgram("hillshade"),b=z.style.map.terrain&&z.style.map.terrain.getTerrainData(l);u.activeTexture.set(h.TEXTURE0),h.bindTexture(h.TEXTURE_2D,d.colorAttachment.get()),y.draw(u,h.TRIANGLES,k,F,Z,Sn.disabled,((I,R,N,W)=>{const K=N.paint.get("hillshade-shadow-color"),le=N.paint.get("hillshade-highlight-color"),de=N.paint.get("hillshade-accent-color");let ge=N.paint.get("hillshade-illumination-direction")*(Math.PI/180);N.paint.get("hillshade-illumination-anchor")==="viewport"&&(ge-=I.transform.angle);const ke=!I.options.moving;return{u_matrix:W?W.posMatrix:I.transform.calculatePosMatrix(R.tileID.toUnwrapped(),ke),u_image:0,u_latrange:zl(0,R.tileID),u_light:[N.paint.get("hillshade-exaggeration"),ge],u_shadow:K,u_highlight:le,u_accent:de}})(z,g,S,b?l:null),b,S.id,z.rasterBoundsBuffer,z.quadTriangleIndexBuffer,z.rasterBoundsSegments)}function Os(z,l,g,S,k,F){const Z=z.context,u=Z.gl,h=l.dem;if(h&&h.data){const d=h.dim,y=h.stride,b=h.getPixels();if(Z.activeTexture.set(u.TEXTURE1),Z.pixelStoreUnpackPremultiplyAlpha.set(!1),l.demTexture=l.demTexture||z.getTileTexture(y),l.demTexture){const R=l.demTexture;R.update(b,{premultiply:!1}),R.bind(u.NEAREST,u.CLAMP_TO_EDGE)}else l.demTexture=new ct(Z,b,u.RGBA,{premultiply:!1}),l.demTexture.bind(u.NEAREST,u.CLAMP_TO_EDGE);Z.activeTexture.set(u.TEXTURE0);let I=l.fbo;if(!I){const R=new ct(Z,{width:d,height:d,data:null},u.RGBA);R.bind(u.LINEAR,u.CLAMP_TO_EDGE),I=l.fbo=Z.createFramebuffer(d,d,!0,!1),I.colorAttachment.set(R.texture)}Z.bindFramebuffer.set(I.framebuffer),Z.viewport.set([0,0,d,d]),z.useProgram("hillshadePrepare").draw(Z,u.TRIANGLES,S,k,F,Sn.disabled,((R,N)=>{const W=N.stride,K=P.Z();return P.aS(K,0,P.N,-P.N,0,0,1),P.$(K,K,[0,-P.N,0]),{u_matrix:K,u_image:1,u_dimension:[W,W],u_zoom:R.overscaledZ,u_unpack:N.getUnpackVector()}})(l.tileID,h),null,g.id,z.rasterBoundsBuffer,z.quadTriangleIndexBuffer,z.rasterBoundsSegments),l.needsHillshadePrepare=!1}}function Qs(z,l,g,S,k,F){const Z=S.paint.get("raster-fade-duration");if(!F&&Z>0){const u=P.h.now(),h=(u-z.timeAdded)/Z,d=l?(u-l.timeAdded)/Z:-1,y=g.getSource(),b=k.coveringZoomLevel({tileSize:y.tileSize,roundZoom:y.roundZoom}),I=!l||Math.abs(l.tileID.overscaledZ-b)>Math.abs(z.tileID.overscaledZ-b),R=I&&z.refreshedUponExpiration?1:P.ad(I?h:1-d,0,1);return z.refreshedUponExpiration&&h>=1&&(z.refreshedUponExpiration=!1),l?{opacity:1,mix:1-R}:{opacity:R,mix:0}}return{opacity:1,mix:0}}const po=new P.aT(1,0,0,1),ua=new P.aT(0,1,0,1),xl=new P.aT(0,0,1,1),ou=new P.aT(1,0,1,1),rc=new P.aT(0,1,1,1);function io(z,l,g,S){ta(z,0,l+g/2,z.transform.width,g,S)}function bo(z,l,g,S){ta(z,l-g/2,0,g,z.transform.height,S)}function ta(z,l,g,S,k,F){const Z=z.context,u=Z.gl;u.enable(u.SCISSOR_TEST),u.scissor(l*z.pixelRatio,g*z.pixelRatio,S*z.pixelRatio,k*z.pixelRatio),Z.clear({color:F}),u.disable(u.SCISSOR_TEST)}function OA(z,l,g){const S=z.context,k=S.gl,F=g.posMatrix,Z=z.useProgram("debug"),u=Vi.disabled,h=os.disabled,d=z.colorModeForRenderPass(),y="$debug",b=z.style.map.terrain&&z.style.map.terrain.getTerrainData(g);S.activeTexture.set(k.TEXTURE0);const I=l.getTileByID(g.key).latestRawTileData,R=Math.floor((I&&I.byteLength||0)/1024),N=l.getTile(g).tileSize,W=512/Math.min(N,512)*(g.overscaledZ/z.transform.zoom)*.5;let K=g.canonical.toString();g.overscaledZ!==g.canonical.z&&(K+=` => ${g.overscaledZ}`),function(le,de){le.initDebugOverlayCanvas();const ge=le.debugOverlayCanvas,ke=le.context.gl,Pe=le.debugOverlayCanvas.getContext("2d");Pe.clearRect(0,0,ge.width,ge.height),Pe.shadowColor="white",Pe.shadowBlur=2,Pe.lineWidth=1.5,Pe.strokeStyle="white",Pe.textBaseline="top",Pe.font="bold 36px Open Sans, sans-serif",Pe.fillText(de,5,5),Pe.strokeText(de,5,5),le.debugOverlayTexture.update(ge),le.debugOverlayTexture.bind(ke.LINEAR,ke.CLAMP_TO_EDGE)}(z,`${K} ${R}kB`),Z.draw(S,k.TRIANGLES,u,h,$n.alphaBlended,Sn.disabled,Pl(F,P.aT.transparent,W),null,y,z.debugBuffer,z.quadTriangleIndexBuffer,z.debugSegments),Z.draw(S,k.LINE_STRIP,u,h,d,Sn.disabled,Pl(F,P.aT.red),b,y,z.debugBuffer,z.tileBorderIndexBuffer,z.debugSegments)}function Rn(z,l,g){const S=z.context,k=S.gl,F=z.colorModeForRenderPass(),Z=new Vi(k.LEQUAL,Vi.ReadWrite,z.depthRangeFor3D),u=z.useProgram("terrain"),h=l.getTerrainMesh();S.bindFramebuffer.set(null),S.viewport.set([0,0,z.width,z.height]);for(const d of g){const y=z.renderToTexture.getTexture(d),b=l.getTerrainData(d.tileID);S.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,y.texture);const I={u_matrix:z.transform.calculatePosMatrix(d.tileID.toUnwrapped()),u_texture:0,u_ele_delta:l.getMeshFrameDelta(z.transform.zoom)};u.draw(S,k.TRIANGLES,Z,os.disabled,F,Sn.backCCW,I,b,"terrain",h.vertexBuffer,h.indexBuffer,h.segments)}}class Sa{constructor(l,g){this.context=new iA(l),this.transform=g,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:P.Z(),renderTime:0},this.setup(),this.numSublayers=Rt.maxUnderzooming+Rt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new kr}resize(l,g,S){if(this.width=Math.floor(l*S),this.height=Math.floor(g*S),this.pixelRatio=S,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const k of this.style._order)this.style._layers[k].resize()}setup(){const l=this.context,g=new P.a_;g.emplaceBack(0,0),g.emplaceBack(P.N,0),g.emplaceBack(0,P.N),g.emplaceBack(P.N,P.N),this.tileExtentBuffer=l.createVertexBuffer(g,BA.members),this.tileExtentSegments=P.S.simpleSegment(0,0,4,2);const S=new P.a_;S.emplaceBack(0,0),S.emplaceBack(P.N,0),S.emplaceBack(0,P.N),S.emplaceBack(P.N,P.N),this.debugBuffer=l.createVertexBuffer(S,BA.members),this.debugSegments=P.S.simpleSegment(0,0,4,5);const k=new P.V;k.emplaceBack(0,0,0,0),k.emplaceBack(P.N,0,P.N,0),k.emplaceBack(0,P.N,0,P.N),k.emplaceBack(P.N,P.N,P.N,P.N),this.rasterBoundsBuffer=l.createVertexBuffer(k,_n.members),this.rasterBoundsSegments=P.S.simpleSegment(0,0,4,2);const F=new P.a_;F.emplaceBack(0,0),F.emplaceBack(1,0),F.emplaceBack(0,1),F.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(F,BA.members),this.viewportSegments=P.S.simpleSegment(0,0,4,2);const Z=new P.a$;Z.emplaceBack(0),Z.emplaceBack(1),Z.emplaceBack(3),Z.emplaceBack(2),Z.emplaceBack(0),this.tileBorderIndexBuffer=l.createIndexBuffer(Z);const u=new P.b0;u.emplaceBack(0,1,2),u.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(u);const h=this.context.gl;this.stencilClearMode=new os({func:h.ALWAYS,mask:0},0,255,h.ZERO,h.ZERO,h.ZERO)}clearStencil(){const l=this.context,g=l.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const S=P.Z();P.aS(S,0,this.width,this.height,0,0,1),P.a0(S,S,[g.drawingBufferWidth,g.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(l,g.TRIANGLES,Vi.disabled,this.stencilClearMode,$n.disabled,Sn.disabled,$A(S),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(l,g){if(this.currentStencilSource===l.source||!l.isTileClipped()||!g||!g.length)return;this.currentStencilSource=l.source;const S=this.context,k=S.gl;this.nextStencilID+g.length>256&&this.clearStencil(),S.setColorMode($n.disabled),S.setDepthMode(Vi.disabled);const F=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const Z of g){const u=this._tileClippingMaskIDs[Z.key]=this.nextStencilID++,h=this.style.map.terrain&&this.style.map.terrain.getTerrainData(Z);F.draw(S,k.TRIANGLES,Vi.disabled,new os({func:k.ALWAYS,mask:0},u,255,k.KEEP,k.KEEP,k.REPLACE),$n.disabled,Sn.disabled,$A(Z.posMatrix),h,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const l=this.nextStencilID++,g=this.context.gl;return new os({func:g.NOTEQUAL,mask:255},l,255,g.KEEP,g.KEEP,g.REPLACE)}stencilModeForClipping(l){const g=this.context.gl;return new os({func:g.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,g.KEEP,g.KEEP,g.REPLACE)}stencilConfigForOverlap(l){const g=this.context.gl,S=l.sort((Z,u)=>u.overscaledZ-Z.overscaledZ),k=S[S.length-1].overscaledZ,F=S[0].overscaledZ-k+1;if(F>1){this.currentStencilSource=void 0,this.nextStencilID+F>256&&this.clearStencil();const Z={};for(let u=0;u<F;u++)Z[u+k]=new os({func:g.GEQUAL,mask:255},u+this.nextStencilID,255,g.KEEP,g.KEEP,g.REPLACE);return this.nextStencilID+=F,[Z,S]}return[{[k]:os.disabled},S]}colorModeForRenderPass(){const l=this.context.gl;return this._showOverdrawInspector?new $n([l.CONSTANT_COLOR,l.ONE],new P.aT(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?$n.unblended:$n.alphaBlended}depthModeForSublayer(l,g,S){if(!this.opaquePassEnabledForLayer())return Vi.disabled;const k=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new Vi(S||this.context.gl.LEQUAL,g,[k,k])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(l,g){this.style=l,this.options=g,this.lineAtlas=l.lineAtlas,this.imageManager=l.imageManager,this.glyphManager=l.glyphManager,this.symbolFadeChange=l.placement.symbolFadeChange(P.h.now()),this.imageManager.beginFrame();const S=this.style._order,k=this.style.sourceCaches,F={},Z={},u={};for(const h in k){const d=k[h];d.used&&d.prepare(this.context),F[h]=d.getVisibleCoordinates(),Z[h]=F[h].slice().reverse(),u[h]=d.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let h=0;h<S.length;h++)if(this.style._layers[S[h]].is3D()){this.opaquePassCutoff=h;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;const h=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!P.b1(this.terrainFacilitator.matrix,this.transform.projMatrix)||h.length)&&(P.b2(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(d,y){const b=d.context,I=b.gl,R=$n.unblended,N=new Vi(I.LEQUAL,Vi.ReadWrite,[0,1]),W=y.getTerrainMesh(),K=y.sourceCache.getRenderableTiles(),le=d.useProgram("terrainDepth");b.bindFramebuffer.set(y.getFramebuffer("depth").framebuffer),b.viewport.set([0,0,d.width/devicePixelRatio,d.height/devicePixelRatio]),b.clear({color:P.aT.transparent,depth:1});for(const de of K){const ge=y.getTerrainData(de.tileID),ke={u_matrix:d.transform.calculatePosMatrix(de.tileID.toUnwrapped()),u_ele_delta:y.getMeshFrameDelta(d.transform.zoom)};le.draw(b,I.TRIANGLES,N,os.disabled,R,Sn.backCCW,ke,ge,"terrain",W.vertexBuffer,W.indexBuffer,W.segments)}b.bindFramebuffer.set(null),b.viewport.set([0,0,d.width,d.height])}(this,this.style.map.terrain),function(d,y){const b=d.context,I=b.gl,R=$n.unblended,N=new Vi(I.LEQUAL,Vi.ReadWrite,[0,1]),W=y.getTerrainMesh(),K=y.getCoordsTexture(),le=y.sourceCache.getRenderableTiles(),de=d.useProgram("terrainCoords");b.bindFramebuffer.set(y.getFramebuffer("coords").framebuffer),b.viewport.set([0,0,d.width/devicePixelRatio,d.height/devicePixelRatio]),b.clear({color:P.aT.transparent,depth:1}),y.coordsIndex=[];for(const ge of le){const ke=y.getTerrainData(ge.tileID);b.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,K.texture);const Pe={u_matrix:d.transform.calculatePosMatrix(ge.tileID.toUnwrapped()),u_terrain_coords_id:(255-y.coordsIndex.length)/255,u_texture:0,u_ele_delta:y.getMeshFrameDelta(d.transform.zoom)};de.draw(b,I.TRIANGLES,N,os.disabled,R,Sn.backCCW,Pe,ke,"terrain",W.vertexBuffer,W.indexBuffer,W.segments),y.coordsIndex.push(ge.tileID.key)}b.bindFramebuffer.set(null),b.viewport.set([0,0,d.width,d.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(const h of S){const d=this.style._layers[h];if(!d.hasOffscreenPass()||d.isHidden(this.transform.zoom))continue;const y=Z[d.source];(d.type==="custom"||y.length)&&this.renderLayer(this,k[d.source],d,y)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:g.showOverdrawInspector?P.aT.black:P.aT.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=g.showOverdrawInspector,this.depthRangeFor3D=[0,1-(l._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=S.length-1;this.currentLayer>=0;this.currentLayer--){const h=this.style._layers[S[this.currentLayer]],d=k[h.source],y=F[h.source];this._renderTileClippingMasks(h,y),this.renderLayer(this,d,h,y)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<S.length;this.currentLayer++){const h=this.style._layers[S[this.currentLayer]],d=k[h.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(h))continue;const y=(h.type==="symbol"?u:Z)[h.source];this._renderTileClippingMasks(h,F[h.source]),this.renderLayer(this,d,h,y)}if(this.options.showTileBoundaries){const h=function(d,y){let b=null;const I=Object.values(d._layers).flatMap(K=>K.source&&!K.isHidden(y)?[d.sourceCaches[K.source]]:[]),R=I.filter(K=>K.getSource().type==="vector"),N=I.filter(K=>K.getSource().type!=="vector"),W=K=>{(!b||b.getSource().maxzoom<K.getSource().maxzoom)&&(b=K)};return R.forEach(K=>W(K)),b||N.forEach(K=>W(K)),b}(this.style,this.transform.zoom);h&&function(d,y,b){for(let I=0;I<b.length;I++)OA(d,y,b[I])}(this,h,h.getVisibleCoordinates())}this.options.showPadding&&function(h){const d=h.transform.padding;io(h,h.transform.height-(d.top||0),3,po),io(h,d.bottom||0,3,ua),bo(h,d.left||0,3,xl),bo(h,h.transform.width-(d.right||0),3,ou);const y=h.transform.centerPoint;(function(b,I,R,N){ta(b,I-1,R-10,2,20,N),ta(b,I-10,R-1,20,2,N)})(h,y.x,h.transform.height-y.y,rc)}(this),this.context.setDefault()}renderLayer(l,g,S,k){if(!S.isHidden(this.transform.zoom)&&(S.type==="background"||S.type==="custom"||(k||[]).length))switch(this.id=S.id,S.type){case"symbol":(function(F,Z,u,h,d){if(F.renderPass!=="translucent")return;const y=os.disabled,b=F.colorModeForRenderPass();(u._unevaluatedLayout.hasValue("text-variable-anchor")||u._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(I,R,N,W,K,le,de){const ge=R.transform,ke=K==="map",Pe=le==="map";for(const qe of I){const ht=W.getTile(qe),mt=ht.getBucket(N);if(!mt||!mt.text||!mt.text.segments.get().length)continue;const ot=P.ah(mt.textSizeData,ge.zoom),ft=Qe(ht,1,R.transform.zoom),dt=ni(qe.posMatrix,Pe,ke,R.transform,ft),ai=N.layout.get("icon-text-fit")!=="none"&&mt.hasIconData();if(ot){const Ut=Math.pow(2,ge.zoom-ht.tileID.overscaledZ);No(mt,ke,Pe,de,ge,dt,qe.posMatrix,Ut,ot,ai,R.style.map.terrain?(Xt,qt)=>R.style.map.terrain.getElevation(qe,Xt,qt):null)}}}(h,F,u,Z,u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),d),u.paint.get("icon-opacity").constantOr(1)!==0&&Nn(F,Z,u,h,!1,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),u.layout.get("icon-rotation-alignment"),u.layout.get("icon-pitch-alignment"),u.layout.get("icon-keep-upright"),y,b),u.paint.get("text-opacity").constantOr(1)!==0&&Nn(F,Z,u,h,!0,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),u.layout.get("text-keep-upright"),y,b),Z.map.showCollisionBoxes&&(zc(F,Z,u,h,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),!0),zc(F,Z,u,h,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),!1))})(l,g,S,k,this.style.placement.variableOffsets);break;case"circle":(function(F,Z,u,h){if(F.renderPass!=="translucent")return;const d=u.paint.get("circle-opacity"),y=u.paint.get("circle-stroke-width"),b=u.paint.get("circle-stroke-opacity"),I=!u.layout.get("circle-sort-key").isConstant();if(d.constantOr(1)===0&&(y.constantOr(1)===0||b.constantOr(1)===0))return;const R=F.context,N=R.gl,W=F.depthModeForSublayer(0,Vi.ReadOnly),K=os.disabled,le=F.colorModeForRenderPass(),de=[];for(let ge=0;ge<h.length;ge++){const ke=h[ge],Pe=Z.getTile(ke),qe=Pe.getBucket(u);if(!qe)continue;const ht=qe.programConfigurations.get(u.id),mt=F.useProgram("circle",ht),ot=qe.layoutVertexBuffer,ft=qe.indexBuffer,dt=F.style.map.terrain&&F.style.map.terrain.getTerrainData(ke),ai={programConfiguration:ht,program:mt,layoutVertexBuffer:ot,indexBuffer:ft,uniformValues:xo(F,ke,Pe,u),terrainData:dt};if(I){const Ut=qe.segments.get();for(const Xt of Ut)de.push({segments:new P.S([Xt]),sortKey:Xt.sortKey,state:ai})}else de.push({segments:qe.segments,sortKey:0,state:ai})}I&&de.sort((ge,ke)=>ge.sortKey-ke.sortKey);for(const ge of de){const{programConfiguration:ke,program:Pe,layoutVertexBuffer:qe,indexBuffer:ht,uniformValues:mt,terrainData:ot}=ge.state;Pe.draw(R,N.TRIANGLES,W,K,le,Sn.disabled,mt,ot,u.id,qe,ht,ge.segments,u.paint,F.transform.zoom,ke)}})(l,g,S,k);break;case"heatmap":(function(F,Z,u,h){if(u.paint.get("heatmap-opacity")!==0)if(F.renderPass==="offscreen"){const d=F.context,y=d.gl,b=os.disabled,I=new $n([y.ONE,y.ONE],P.aT.transparent,[!0,!0,!0,!0]);(function(R,N,W){const K=R.gl;R.activeTexture.set(K.TEXTURE1),R.viewport.set([0,0,N.width/4,N.height/4]);let le=W.heatmapFbo;if(le)K.bindTexture(K.TEXTURE_2D,le.colorAttachment.get()),R.bindFramebuffer.set(le.framebuffer);else{const de=K.createTexture();K.bindTexture(K.TEXTURE_2D,de),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_WRAP_S,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_WRAP_T,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_MIN_FILTER,K.LINEAR),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_MAG_FILTER,K.LINEAR),le=W.heatmapFbo=R.createFramebuffer(N.width/4,N.height/4,!1,!1),function(ge,ke,Pe,qe){var ht,mt;const ot=ge.gl,ft=(ht=ge.HALF_FLOAT)!==null&&ht!==void 0?ht:ot.UNSIGNED_BYTE,dt=(mt=ge.RGBA16F)!==null&&mt!==void 0?mt:ot.RGBA;ot.texImage2D(ot.TEXTURE_2D,0,dt,ke.width/4,ke.height/4,0,ot.RGBA,ft,null),qe.colorAttachment.set(Pe)}(R,N,de,le)}})(d,F,u),d.clear({color:P.aT.transparent});for(let R=0;R<h.length;R++){const N=h[R];if(Z.hasRenderableParent(N))continue;const W=Z.getTile(N),K=W.getBucket(u);if(!K)continue;const le=K.programConfigurations.get(u.id),de=F.useProgram("heatmap",le),{zoom:ge}=F.transform;de.draw(d,y.TRIANGLES,Vi.disabled,b,I,Sn.disabled,ec(N.posMatrix,W,ge,u.paint.get("heatmap-intensity")),null,u.id,K.layoutVertexBuffer,K.indexBuffer,K.segments,u.paint,F.transform.zoom,le)}d.viewport.set([0,0,F.width,F.height])}else F.renderPass==="translucent"&&(F.context.setColorMode(F.colorModeForRenderPass()),function(d,y){const b=d.context,I=b.gl,R=y.heatmapFbo;if(!R)return;b.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,R.colorAttachment.get()),b.activeTexture.set(I.TEXTURE1);let N=y.colorRampTexture;N||(N=y.colorRampTexture=new ct(b,y.colorRamp,I.RGBA)),N.bind(I.LINEAR,I.CLAMP_TO_EDGE),d.useProgram("heatmapTexture").draw(b,I.TRIANGLES,Vi.disabled,os.disabled,d.colorModeForRenderPass(),Sn.disabled,((W,K,le,de)=>{const ge=P.Z();P.aS(ge,0,W.width,W.height,0,0,1);const ke=W.context.gl;return{u_matrix:ge,u_world:[ke.drawingBufferWidth,ke.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:K.paint.get("heatmap-opacity")}})(d,y),null,y.id,d.viewportBuffer,d.quadTriangleIndexBuffer,d.viewportSegments,y.paint,d.transform.zoom)}(F,u))})(l,g,S,k);break;case"line":(function(F,Z,u,h){if(F.renderPass!=="translucent")return;const d=u.paint.get("line-opacity"),y=u.paint.get("line-width");if(d.constantOr(1)===0||y.constantOr(1)===0)return;const b=F.depthModeForSublayer(0,Vi.ReadOnly),I=F.colorModeForRenderPass(),R=u.paint.get("line-dasharray"),N=u.paint.get("line-pattern"),W=N.constantOr(1),K=u.paint.get("line-gradient"),le=u.getCrossfadeParameters(),de=W?"linePattern":R?"lineSDF":K?"lineGradient":"line",ge=F.context,ke=ge.gl;let Pe=!0;for(const qe of h){const ht=Z.getTile(qe);if(W&&!ht.patternsLoaded())continue;const mt=ht.getBucket(u);if(!mt)continue;const ot=mt.programConfigurations.get(u.id),ft=F.context.program.get(),dt=F.useProgram(de,ot),ai=Pe||dt.program!==ft,Ut=F.style.map.terrain&&F.style.map.terrain.getTerrainData(qe),Xt=N.constantOr(null);if(Xt&&ht.imageAtlas){const qi=ht.imageAtlas,ji=qi.patternPositions[Xt.to.toString()],Li=qi.patternPositions[Xt.from.toString()];ji&&Li&&ot.setConstantPatternPositions(ji,Li)}const qt=Ut?qe:null,or=W?tc(F,ht,u,le,qt):R?qn(F,ht,u,R,le,qt):K?ns(F,ht,u,mt.lineClipsArray.length,qt):fA(F,ht,u,qt);if(W)ge.activeTexture.set(ke.TEXTURE0),ht.imageAtlasTexture.bind(ke.LINEAR,ke.CLAMP_TO_EDGE),ot.updatePaintBuffers(le);else if(R&&(ai||F.lineAtlas.dirty))ge.activeTexture.set(ke.TEXTURE0),F.lineAtlas.bind(ge);else if(K){const qi=mt.gradients[u.id];let ji=qi.texture;if(u.gradientVersion!==qi.version){let Li=256;if(u.stepInterpolant){const ir=Z.getSource().maxzoom,Ji=qe.canonical.z===ir?Math.ceil(1<<F.transform.maxZoom-qe.canonical.z):1;Li=P.ad(P.aY(mt.maxLineLength/P.N*1024*Ji),256,ge.maxTextureSize)}qi.gradient=P.aZ({expression:u.gradientExpression(),evaluationKey:"lineProgress",resolution:Li,image:qi.gradient||void 0,clips:mt.lineClipsArray}),qi.texture?qi.texture.update(qi.gradient):qi.texture=new ct(ge,qi.gradient,ke.RGBA),qi.version=u.gradientVersion,ji=qi.texture}ge.activeTexture.set(ke.TEXTURE0),ji.bind(u.stepInterpolant?ke.NEAREST:ke.LINEAR,ke.CLAMP_TO_EDGE)}dt.draw(ge,ke.TRIANGLES,b,F.stencilModeForClipping(qe),I,Sn.disabled,or,Ut,u.id,mt.layoutVertexBuffer,mt.indexBuffer,mt.segments,u.paint,F.transform.zoom,ot,mt.layoutVertexBuffer2),Pe=!1}})(l,g,S,k);break;case"fill":(function(F,Z,u,h){const d=u.paint.get("fill-color"),y=u.paint.get("fill-opacity");if(y.constantOr(1)===0)return;const b=F.colorModeForRenderPass(),I=u.paint.get("fill-pattern"),R=F.opaquePassEnabledForLayer()&&!I.constantOr(1)&&d.constantOr(P.aT.transparent).a===1&&y.constantOr(0)===1?"opaque":"translucent";if(F.renderPass===R){const N=F.depthModeForSublayer(1,F.renderPass==="opaque"?Vi.ReadWrite:Vi.ReadOnly);ol(F,Z,u,h,N,b,!1)}if(F.renderPass==="translucent"&&u.paint.get("fill-antialias")){const N=F.depthModeForSublayer(u.getPaintProperty("fill-outline-color")?2:0,Vi.ReadOnly);ol(F,Z,u,h,N,b,!0)}})(l,g,S,k);break;case"fill-extrusion":(function(F,Z,u,h){const d=u.paint.get("fill-extrusion-opacity");if(d!==0&&F.renderPass==="translucent"){const y=new Vi(F.context.gl.LEQUAL,Vi.ReadWrite,F.depthRangeFor3D);if(d!==1||u.paint.get("fill-extrusion-pattern").constantOr(1))Za(F,Z,u,h,y,os.disabled,$n.disabled),Za(F,Z,u,h,y,F.stencilModeFor3D(),F.colorModeForRenderPass());else{const b=F.colorModeForRenderPass();Za(F,Z,u,h,y,os.disabled,b)}}})(l,g,S,k);break;case"hillshade":(function(F,Z,u,h){if(F.renderPass!=="offscreen"&&F.renderPass!=="translucent")return;const d=F.context,y=F.depthModeForSublayer(0,Vi.ReadOnly),b=F.colorModeForRenderPass(),[I,R]=F.renderPass==="translucent"?F.stencilConfigForOverlap(h):[{},h];for(const N of R){const W=Z.getTile(N);W.needsHillshadePrepare!==void 0&&W.needsHillshadePrepare&&F.renderPass==="offscreen"?Os(F,W,u,y,os.disabled,b):F.renderPass==="translucent"&&Cu(F,N,W,u,y,I[N.overscaledZ],b)}d.viewport.set([0,0,F.width,F.height])})(l,g,S,k);break;case"raster":(function(F,Z,u,h){if(F.renderPass!=="translucent"||u.paint.get("raster-opacity")===0||!h.length)return;const d=F.context,y=d.gl,b=Z.getSource(),I=F.useProgram("raster"),R=F.colorModeForRenderPass(),[N,W]=b instanceof cs?[{},h]:F.stencilConfigForOverlap(h),K=W[W.length-1].overscaledZ,le=!F.options.moving;for(const de of W){const ge=F.depthModeForSublayer(de.overscaledZ-K,u.paint.get("raster-opacity")===1?Vi.ReadWrite:Vi.ReadOnly,y.LESS),ke=Z.getTile(de);ke.registerFadeDuration(u.paint.get("raster-fade-duration"));const Pe=Z.findLoadedParent(de,0),qe=Qs(ke,Pe,Z,u,F.transform,F.style.map.terrain);let ht,mt;const ot=u.paint.get("raster-resampling")==="nearest"?y.NEAREST:y.LINEAR;d.activeTexture.set(y.TEXTURE0),ke.texture.bind(ot,y.CLAMP_TO_EDGE,y.LINEAR_MIPMAP_NEAREST),d.activeTexture.set(y.TEXTURE1),Pe?(Pe.texture.bind(ot,y.CLAMP_TO_EDGE,y.LINEAR_MIPMAP_NEAREST),ht=Math.pow(2,Pe.tileID.overscaledZ-ke.tileID.overscaledZ),mt=[ke.tileID.canonical.x*ht%1,ke.tileID.canonical.y*ht%1]):ke.texture.bind(ot,y.CLAMP_TO_EDGE,y.LINEAR_MIPMAP_NEAREST);const ft=F.style.map.terrain&&F.style.map.terrain.getTerrainData(de),dt=ft?de:null,ai=dt?dt.posMatrix:F.transform.calculatePosMatrix(de.toUnwrapped(),le),Ut=$i(ai,mt||[0,0],ht||1,qe,u);b instanceof cs?I.draw(d,y.TRIANGLES,ge,os.disabled,R,Sn.disabled,Ut,ft,u.id,b.boundsBuffer,F.quadTriangleIndexBuffer,b.boundsSegments):I.draw(d,y.TRIANGLES,ge,N[de.overscaledZ],R,Sn.disabled,Ut,ft,u.id,F.rasterBoundsBuffer,F.quadTriangleIndexBuffer,F.rasterBoundsSegments)}})(l,g,S,k);break;case"background":(function(F,Z,u,h){const d=u.paint.get("background-color"),y=u.paint.get("background-opacity");if(y===0)return;const b=F.context,I=b.gl,R=F.transform,N=R.tileSize,W=u.paint.get("background-pattern");if(F.isPatternMissing(W))return;const K=!W&&d.a===1&&y===1&&F.opaquePassEnabledForLayer()?"opaque":"translucent";if(F.renderPass!==K)return;const le=os.disabled,de=F.depthModeForSublayer(0,K==="opaque"?Vi.ReadWrite:Vi.ReadOnly),ge=F.colorModeForRenderPass(),ke=F.useProgram(W?"backgroundPattern":"background"),Pe=h||R.coveringTiles({tileSize:N,terrain:F.style.map.terrain});W&&(b.activeTexture.set(I.TEXTURE0),F.imageManager.bind(F.context));const qe=u.getCrossfadeParameters();for(const ht of Pe){const mt=h?ht.posMatrix:F.transform.calculatePosMatrix(ht.toUnwrapped()),ot=W?vn(mt,y,F,W,{tileID:ht,tileSize:N},qe):$o(mt,y,d),ft=F.style.map.terrain&&F.style.map.terrain.getTerrainData(ht);ke.draw(b,I.TRIANGLES,de,le,ge,Sn.disabled,ot,ft,u.id,F.tileExtentBuffer,F.quadTriangleIndexBuffer,F.tileExtentSegments)}})(l,0,S,k);break;case"custom":(function(F,Z,u){const h=F.context,d=u.implementation;if(F.renderPass==="offscreen"){const y=d.prerender;y&&(F.setCustomLayerDefaults(),h.setColorMode(F.colorModeForRenderPass()),y.call(d,h.gl,F.transform.customLayerMatrix()),h.setDirty(),F.setBaseState())}else if(F.renderPass==="translucent"){F.setCustomLayerDefaults(),h.setColorMode(F.colorModeForRenderPass()),h.setStencilMode(os.disabled);const y=d.renderingMode==="3d"?new Vi(F.context.gl.LEQUAL,Vi.ReadWrite,F.depthRangeFor3D):F.depthModeForSublayer(0,Vi.ReadOnly);h.setDepthMode(y),d.render(h.gl,F.transform.customLayerMatrix()),h.setDirty(),F.setBaseState(),h.bindFramebuffer.set(null)}})(l,0,S)}}translatePosMatrix(l,g,S,k,F){if(!S[0]&&!S[1])return l;const Z=F?k==="map"?this.transform.angle:0:k==="viewport"?-this.transform.angle:0;if(Z){const d=Math.sin(Z),y=Math.cos(Z);S=[S[0]*y-S[1]*d,S[0]*d+S[1]*y]}const u=[F?S[0]:Qe(g,S[0],this.transform.zoom),F?S[1]:Qe(g,S[1],this.transform.zoom),0],h=new Float32Array(16);return P.$(h,l,u),h}saveTileTexture(l){const g=this._tileTextures[l.size[0]];g?g.push(l):this._tileTextures[l.size[0]]=[l]}getTileTexture(l){const g=this._tileTextures[l];return g&&g.length>0?g.pop():null}isPatternMissing(l){if(!l)return!1;if(!l.from||!l.to)return!0;const g=this.imageManager.getPattern(l.from.toString()),S=this.imageManager.getPattern(l.to.toString());return!g||!S}useProgram(l,g){this.cache=this.cache||{};const S=l+(g?g.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[S]||(this.cache[S]=new Jl(this.context,st[l],g,la[l],this._showOverdrawInspector,this.style.map.terrain)),this.cache[S]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new ct(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:l,drawingBufferHeight:g}=this.context.gl;return this.width!==l||this.height!==g}}class Un{constructor(l,g){this.points=l,this.planes=g}static fromInvProjectionMatrix(l,g,S){const k=Math.pow(2,S),F=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(u=>{const h=1/(u=P.ag([],u,l))[3]/g*k;return P.b3(u,u,[h,h,1/u[3],h])}),Z=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(u=>{const h=function(I,R){var N=R[0],W=R[1],K=R[2],le=N*N+W*W+K*K;return le>0&&(le=1/Math.sqrt(le)),I[0]=R[0]*le,I[1]=R[1]*le,I[2]=R[2]*le,I}([],function(I,R,N){var W=R[0],K=R[1],le=R[2],de=N[0],ge=N[1],ke=N[2];return I[0]=K*ke-le*ge,I[1]=le*de-W*ke,I[2]=W*ge-K*de,I}([],En([],F[u[0]],F[u[1]]),En([],F[u[2]],F[u[1]]))),d=-((y=h)[0]*(b=F[u[1]])[0]+y[1]*b[1]+y[2]*b[2]);var y,b;return h.concat(d)});return new Un(F,Z)}}class qa{constructor(l,g){this.min=l,this.max=g,this.center=function(S,k,F){return S[0]=.5*k[0],S[1]=.5*k[1],S[2]=.5*k[2],S}([],function(S,k,F){return S[0]=k[0]+F[0],S[1]=k[1]+F[1],S[2]=k[2]+F[2],S}([],this.min,this.max))}quadrant(l){const g=[l%2==0,l<2],S=_r(this.min),k=_r(this.max);for(let F=0;F<g.length;F++)S[F]=g[F]?this.min[F]:this.center[F],k[F]=g[F]?this.center[F]:this.max[F];return k[2]=this.max[2],new qa(S,k)}distanceX(l){return Math.max(Math.min(this.max[0],l[0]),this.min[0])-l[0]}distanceY(l){return Math.max(Math.min(this.max[1],l[1]),this.min[1])-l[1]}intersects(l){const g=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let S=!0;for(let k=0;k<l.planes.length;k++){const F=l.planes[k];let Z=0;for(let u=0;u<g.length;u++)P.b4(F,g[u])>=0&&Z++;if(Z===0)return 0;Z!==g.length&&(S=!1)}if(S)return 2;for(let k=0;k<3;k++){let F=Number.MAX_VALUE,Z=-Number.MAX_VALUE;for(let u=0;u<l.points.length;u++){const h=l.points[u][k]-this.min[k];F=Math.min(F,h),Z=Math.max(Z,h)}if(Z<0||F>this.max[k]-this.min[k])return 0}return 1}}class al{constructor(l=0,g=0,S=0,k=0){if(isNaN(l)||l<0||isNaN(g)||g<0||isNaN(S)||S<0||isNaN(k)||k<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=g,this.left=S,this.right=k}interpolate(l,g,S){return g.top!=null&&l.top!=null&&(this.top=P.B.number(l.top,g.top,S)),g.bottom!=null&&l.bottom!=null&&(this.bottom=P.B.number(l.bottom,g.bottom,S)),g.left!=null&&l.left!=null&&(this.left=P.B.number(l.left,g.left,S)),g.right!=null&&l.right!=null&&(this.right=P.B.number(l.right,g.right,S)),this}getCenter(l,g){const S=P.ad((this.left+l-this.right)/2,0,l),k=P.ad((this.top+g-this.bottom)/2,0,g);return new P.P(S,k)}equals(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right}clone(){return new al(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class vl{constructor(l,g,S,k,F){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=F===void 0||!!F,this._minZoom=l||0,this._maxZoom=g||22,this._minPitch=S??0,this._maxPitch=k??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new P.L(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new al,this._posMatrixCache={},this._alignedPosMatrixCache={},this._minEleveationForCurrentTile=0}clone(){const l=new vl(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return l.apply(this),l}apply(l){this.tileSize=l.tileSize,this.latRange=l.latRange,this.width=l.width,this.height=l.height,this._center=l._center,this._elevation=l._elevation,this._minEleveationForCurrentTile=l._minEleveationForCurrentTile,this.zoom=l.zoom,this.angle=l.angle,this._fov=l._fov,this._pitch=l._pitch,this._unmodified=l._unmodified,this._edgeInsets=l._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))}get maxZoom(){return this._maxZoom}set maxZoom(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))}get minPitch(){return this._minPitch}set minPitch(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))}get maxPitch(){return this._maxPitch}set maxPitch(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new P.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(l){const g=-P.b5(l,-180,180)*Math.PI/180;this.angle!==g&&(this._unmodified=!1,this.angle=g,this._calcMatrices(),this.rotationMatrix=function(){var S=new P.A(4);return P.A!=Float32Array&&(S[1]=0,S[2]=0),S[0]=1,S[3]=1,S}(),function(S,k,F){var Z=k[0],u=k[1],h=k[2],d=k[3],y=Math.sin(F),b=Math.cos(F);S[0]=Z*b+h*y,S[1]=u*b+d*y,S[2]=Z*-y+h*b,S[3]=u*-y+d*b}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(l){const g=P.ad(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==g&&(this._unmodified=!1,this._pitch=g,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=l/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(l){const g=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==g&&(this._unmodified=!1,this._zoom=g,this.tileZoom=Math.max(0,Math.floor(g)),this.scale=this.zoomScale(g),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(l){l!==this._elevation&&(this._elevation=l,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(l){return this._edgeInsets.equals(l)}interpolatePadding(l,g,S){this._unmodified=!1,this._edgeInsets.interpolate(l,g,S),this._constrain(),this._calcMatrices()}coveringZoomLevel(l){const g=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,g)}getVisibleUnwrappedCoordinates(l){const g=[new P.b6(0,l)];if(this._renderWorldCopies){const S=this.pointCoordinate(new P.P(0,0)),k=this.pointCoordinate(new P.P(this.width,0)),F=this.pointCoordinate(new P.P(this.width,this.height)),Z=this.pointCoordinate(new P.P(0,this.height)),u=Math.floor(Math.min(S.x,k.x,F.x,Z.x)),h=Math.floor(Math.max(S.x,k.x,F.x,Z.x)),d=1;for(let y=u-d;y<=h+d;y++)y!==0&&g.push(new P.b6(y,l))}return g}coveringTiles(l){var g,S;let k=this.coveringZoomLevel(l);const F=k;if(l.minzoom!==void 0&&k<l.minzoom)return[];l.maxzoom!==void 0&&k>l.maxzoom&&(k=l.maxzoom);const Z=this.pointCoordinate(this.getCameraPoint()),u=P.U.fromLngLat(this.center),h=Math.pow(2,k),d=[h*Z.x,h*Z.y,0],y=[h*u.x,h*u.y,0],b=Un.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,k);let I=l.minzoom||0;!l.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(I=k);const R=l.terrain?2/Math.min(this.tileSize,l.tileSize)*this.tileSize:3,N=ge=>({aabb:new qa([ge*h,0,0],[(ge+1)*h,h,0]),zoom:0,x:0,y:0,wrap:ge,fullyVisible:!1}),W=[],K=[],le=k,de=l.reparseOverscaled?F:k;if(this._renderWorldCopies)for(let ge=1;ge<=3;ge++)W.push(N(-ge)),W.push(N(ge));for(W.push(N(0));W.length>0;){const ge=W.pop(),ke=ge.x,Pe=ge.y;let qe=ge.fullyVisible;if(!qe){const dt=ge.aabb.intersects(b);if(dt===0)continue;qe=dt===2}const ht=l.terrain?d:y,mt=ge.aabb.distanceX(ht),ot=ge.aabb.distanceY(ht),ft=Math.max(Math.abs(mt),Math.abs(ot));if(ge.zoom===le||ft>R+(1<<le-ge.zoom)-2&&ge.zoom>=I){const dt=le-ge.zoom,ai=d[0]-.5-(ke<<dt),Ut=d[1]-.5-(Pe<<dt);K.push({tileID:new P.O(ge.zoom===le?de:ge.zoom,ge.wrap,ge.zoom,ke,Pe),distanceSq:Ls([y[0]-.5-ke,y[1]-.5-Pe]),tileDistanceToCamera:Math.sqrt(ai*ai+Ut*Ut)})}else for(let dt=0;dt<4;dt++){const ai=(ke<<1)+dt%2,Ut=(Pe<<1)+(dt>>1),Xt=ge.zoom+1;let qt=ge.aabb.quadrant(dt);if(l.terrain){const or=new P.O(Xt,ge.wrap,Xt,ai,Ut),qi=l.terrain.getMinMaxElevation(or),ji=(g=qi.minElevation)!==null&&g!==void 0?g:this.elevation,Li=(S=qi.maxElevation)!==null&&S!==void 0?S:this.elevation;qt=new qa([qt.min[0],qt.min[1],ji],[qt.max[0],qt.max[1],Li])}W.push({aabb:qt,zoom:Xt,x:ai,y:Ut,wrap:ge.wrap,fullyVisible:qe})}}return K.sort((ge,ke)=>ge.distanceSq-ke.distanceSq).map(ge=>ge.tileID)}resize(l,g){this.width=l,this.height=g,this.pixelsToGLUnits=[2/l,-2/g],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(l){return Math.pow(2,l)}scaleZoom(l){return Math.log(l)/Math.LN2}project(l){const g=P.ad(l.lat,-this.maxValidLatitude,this.maxValidLatitude);return new P.P(P.G(l.lng)*this.worldSize,P.H(g)*this.worldSize)}unproject(l){return new P.U(l.x/this.worldSize,l.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(l){const g=this.pointLocation(this.centerPoint,l),S=l.getElevationForLngLatZoom(g,this.tileZoom);if(!(this.elevation-S))return;const k=this.getCameraPosition(),F=P.U.fromLngLat(k.lngLat,k.altitude),Z=P.U.fromLngLat(g,S),u=F.x-Z.x,h=F.y-Z.y,d=F.z-Z.z,y=Math.sqrt(u*u+h*h+d*d),b=this.scaleZoom(this.cameraToCenterDistance/y/this.tileSize);this._elevation=S,this._center=g,this.zoom=b}setLocationAtPoint(l,g){const S=this.pointCoordinate(g),k=this.pointCoordinate(this.centerPoint),F=this.locationCoordinate(l),Z=new P.U(F.x-(S.x-k.x),F.y-(S.y-k.y));this.center=this.coordinateLocation(Z),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(l,g){return g?this.coordinatePoint(this.locationCoordinate(l),g.getElevationForLngLatZoom(l,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(l))}pointLocation(l,g){return this.coordinateLocation(this.pointCoordinate(l,g))}locationCoordinate(l){return P.U.fromLngLat(l)}coordinateLocation(l){return l&&l.toLngLat()}pointCoordinate(l,g){if(g){const I=g.pointCoordinate(l);if(I!=null)return I}const S=[l.x,l.y,0,1],k=[l.x,l.y,1,1];P.ag(S,S,this.pixelMatrixInverse),P.ag(k,k,this.pixelMatrixInverse);const F=S[3],Z=k[3],u=S[1]/F,h=k[1]/Z,d=S[2]/F,y=k[2]/Z,b=d===y?0:(0-d)/(y-d);return new P.U(P.B.number(S[0]/F,k[0]/Z,b)/this.worldSize,P.B.number(u,h,b)/this.worldSize)}coordinatePoint(l,g=0,S=this.pixelMatrix){const k=[l.x*this.worldSize,l.y*this.worldSize,g,1];return P.ag(k,k,S),new P.P(k[0]/k[3],k[1]/k[3])}getBounds(){const l=Math.max(0,this.height/2-this.getHorizon());return new jr().extend(this.pointLocation(new P.P(0,l))).extend(this.pointLocation(new P.P(this.width,l))).extend(this.pointLocation(new P.P(this.width,this.height))).extend(this.pointLocation(new P.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new jr([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(l){l?(this.lngRange=[l.getWest(),l.getEast()],this.latRange=[l.getSouth(),l.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(l,g=!1){const S=l.key,k=g?this._alignedPosMatrixCache:this._posMatrixCache;if(k[S])return k[S];const F=l.canonical,Z=this.worldSize/this.zoomScale(F.z),u=F.x+Math.pow(2,F.z)*l.wrap,h=P.ao(new Float64Array(16));return P.$(h,h,[u*Z,F.y*Z,0]),P.a0(h,h,[Z/P.N,Z/P.N,1]),P.a1(h,g?this.alignedProjMatrix:this.projMatrix,h),k[S]=new Float32Array(h),k[S]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let l,g,S,k,F=-90,Z=90,u=-180,h=180;const d=this.size,y=this._unmodified;if(this.latRange){const R=this.latRange;F=P.H(R[1])*this.worldSize,Z=P.H(R[0])*this.worldSize,l=Z-F<d.y?d.y/(Z-F):0}if(this.lngRange){const R=this.lngRange;u=P.b5(P.G(R[0])*this.worldSize,0,this.worldSize),h=P.b5(P.G(R[1])*this.worldSize,0,this.worldSize),h<u&&(h+=this.worldSize),g=h-u<d.x?d.x/(h-u):0}const b=this.point,I=Math.max(g||0,l||0);if(I)return this.center=this.unproject(new P.P(g?(h+u)/2:b.x,l?(Z+F)/2:b.y)),this.zoom+=this.scaleZoom(I),this._unmodified=y,void(this._constraining=!1);if(this.latRange){const R=b.y,N=d.y/2;R-N<F&&(k=F+N),R+N>Z&&(k=Z-N)}if(this.lngRange){const R=(u+h)/2,N=P.b5(b.x,R-this.worldSize/2,R+this.worldSize/2),W=d.x/2;N-W<u&&(S=u+W),N+W>h&&(S=h-W)}S===void 0&&k===void 0||(this.center=this.unproject(new P.P(S!==void 0?S:b.x,k!==void 0?k:b.y)).wrap()),this._unmodified=y,this._constraining=!1}_calcMatrices(){if(!this.height)return;const l=this.centerOffset,g=this.point.x,S=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=P.b7(1,this.center.lat)*this.worldSize;let k=P.ao(new Float64Array(16));P.a0(k,k,[this.width/2,-this.height/2,1]),P.$(k,k,[1,-1,0]),this.labelPlaneMatrix=k,k=P.ao(new Float64Array(16)),P.a0(k,k,[1,-1,1]),P.$(k,k,[-1,-1,0]),P.a0(k,k,[2/this.width,2/this.height,1]),this.glCoordMatrix=k;const F=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),Z=Math.min(this.elevation,this._minEleveationForCurrentTile),u=F-Z*this._pixelPerMeter/Math.cos(this._pitch),h=Z<0?u:F,d=Math.PI/2+this._pitch,y=this._fov*(.5+l.y/this.height),b=Math.sin(y)*h/Math.sin(P.ad(Math.PI-d-y,.01,Math.PI-.01)),I=this.getHorizon(),R=2*Math.atan(I/this.cameraToCenterDistance)*(.5+l.y/(2*I)),N=Math.sin(R)*h/Math.sin(P.ad(Math.PI-d-R,.01,Math.PI-.01)),W=Math.min(b,N),K=1.01*(Math.cos(Math.PI/2-this._pitch)*W+h),le=this.height/50;k=new Float64Array(16),P.b8(k,this._fov,this.width/this.height,le,K),k[8]=2*-l.x/this.width,k[9]=2*l.y/this.height,P.a0(k,k,[1,-1,1]),P.$(k,k,[0,0,-this.cameraToCenterDistance]),P.b9(k,k,this._pitch),P.ae(k,k,this.angle),P.$(k,k,[-g,-S,0]),this.mercatorMatrix=P.a0([],k,[this.worldSize,this.worldSize,this.worldSize]),P.a0(k,k,[1,1,this._pixelPerMeter]),this.pixelMatrix=P.a1(new Float64Array(16),this.labelPlaneMatrix,k),P.$(k,k,[0,0,-this.elevation]),this.projMatrix=k,this.invProjMatrix=P.as([],k),this.pixelMatrix3D=P.a1(new Float64Array(16),this.labelPlaneMatrix,k);const de=this.width%2/2,ge=this.height%2/2,ke=Math.cos(this.angle),Pe=Math.sin(this.angle),qe=g-Math.round(g)+ke*de+Pe*ge,ht=S-Math.round(S)+ke*ge+Pe*de,mt=new Float64Array(k);if(P.$(mt,mt,[qe>.5?qe-1:qe,ht>.5?ht-1:ht,0]),this.alignedProjMatrix=mt,k=P.as(new Float64Array(16),this.pixelMatrix),!k)throw new Error("failed to invert matrix");this.pixelMatrixInverse=k,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const l=this.pointCoordinate(new P.P(0,0)),g=[l.x*this.worldSize,l.y*this.worldSize,0,1];return P.ag(g,g,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new P.P(0,l))}getCameraQueryGeometry(l){const g=this.getCameraPoint();if(l.length===1)return[l[0],g];{let S=g.x,k=g.y,F=g.x,Z=g.y;for(const u of l)S=Math.min(S,u.x),k=Math.min(k,u.y),F=Math.max(F,u.x),Z=Math.max(Z,u.y);return[new P.P(S,k),new P.P(F,k),new P.P(F,Z),new P.P(S,Z),new P.P(S,k)]}}}function wo(z,l){let g,S=!1,k=null,F=null;const Z=()=>{k=null,S&&(z.apply(F,g),k=setTimeout(Z,l),S=!1)};return(...u)=>(S=!0,F=this,g=u,k||Z(),k)}class Ia{constructor(l){this._getCurrentHash=()=>{const g=window.location.hash.replace("#","");if(this._hashName){let S;return g.split("&").map(k=>k.split("=")).forEach(k=>{k[0]===this._hashName&&(S=k)}),(S&&S[1]||"").split("/")}return g.split("/")},this._onHashChange=()=>{const g=this._getCurrentHash();if(g.length>=3&&!g.some(S=>isNaN(S))){const S=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(g[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+g[2],+g[1]],zoom:+g[0],bearing:S,pitch:+(g[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const g=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,g)}catch{}},this._updateHash=wo(this._updateHashUnthrottled,300),this._hashName=l&&encodeURIComponent(l)}addTo(l){return this._map=l,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(l){const g=this._map.getCenter(),S=Math.round(100*this._map.getZoom())/100,k=Math.ceil((S*Math.LN2+Math.log(512/360/.5))/Math.LN10),F=Math.pow(10,k),Z=Math.round(g.lng*F)/F,u=Math.round(g.lat*F)/F,h=this._map.getBearing(),d=this._map.getPitch();let y="";if(y+=l?`/${Z}/${u}/${S}`:`${S}/${u}/${Z}`,(h||d)&&(y+="/"+Math.round(10*h)/10),d&&(y+=`/${Math.round(d)}`),this._hashName){const b=this._hashName;let I=!1;const R=window.location.hash.slice(1).split("&").map(N=>{const W=N.split("=")[0];return W===b?(I=!0,`${W}=${y}`):N}).filter(N=>N);return I||R.push(`${b}=${y}`),`#${R.join("&")}`}return`#${y}`}}const Ol={linearity:.3,easing:P.ba(0,0,.3,1)},Mt=P.e({deceleration:2500,maxSpeed:1400},Ol),nc=P.e({deceleration:20,maxSpeed:1400},Ol),ll=P.e({deceleration:1e3,maxSpeed:360},Ol),Al=P.e({deceleration:1e3,maxSpeed:90},Ol);class Lc{constructor(l){this._map=l,this.clear()}clear(){this._inertiaBuffer=[]}record(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:P.h.now(),settings:l})}_drainInertiaBuffer(){const l=this._inertiaBuffer,g=P.h.now();for(;l.length>0&&g-l[0].time>160;)l.shift()}_onMoveEnd(l){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const g={zoom:0,bearing:0,pitch:0,pan:new P.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:F}of this._inertiaBuffer)g.zoom+=F.zoomDelta||0,g.bearing+=F.bearingDelta||0,g.pitch+=F.pitchDelta||0,F.panDelta&&g.pan._add(F.panDelta),F.around&&(g.around=F.around),F.pinchAround&&(g.pinchAround=F.pinchAround);const S=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,k={};if(g.pan.mag()){const F=ha(g.pan.mag(),S,P.e({},Mt,l||{}));k.offset=g.pan.mult(F.amount/g.pan.mag()),k.center=this._map.transform.center,To(k,F)}if(g.zoom){const F=ha(g.zoom,S,nc);k.zoom=this._map.transform.zoom+F.amount,To(k,F)}if(g.bearing){const F=ha(g.bearing,S,ll);k.bearing=this._map.transform.bearing+P.ad(F.amount,-179,179),To(k,F)}if(g.pitch){const F=ha(g.pitch,S,Al);k.pitch=this._map.transform.pitch+F.amount,To(k,F)}if(k.zoom||k.bearing){const F=g.pinchAround===void 0?g.around:g.pinchAround;k.around=F?this._map.unproject(F):this._map.getCenter()}return this.clear(),P.e(k,{noMoveStart:!0})}}function To(z,l){(!z.duration||z.duration<l.duration)&&(z.duration=l.duration,z.easing=l.easing)}function ha(z,l,g){const{maxSpeed:S,linearity:k,deceleration:F}=g,Z=P.ad(z*k/(l/1e3),-S,S),u=Math.abs(Z)/(F*k);return{easing:g.easing,duration:1e3*u,amount:Z*(u/2)}}class Uo extends P.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,g,S,k={}){const F=Ee.mousePos(g.getCanvasContainer(),S),Z=g.unproject(F);super(l,P.e({point:F,lngLat:Z,originalEvent:S},k)),this._defaultPrevented=!1,this.target=g}}class Qa extends P.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,g,S){const k=l==="touchend"?S.changedTouches:S.touches,F=Ee.touchPos(g.getCanvasContainer(),k),Z=F.map(h=>g.unproject(h)),u=F.reduce((h,d,y,b)=>h.add(d.div(b.length)),new P.P(0,0));super(l,{points:F,point:u,lngLats:Z,lngLat:g.unproject(u),originalEvent:S}),this._defaultPrevented=!1}}class NA extends P.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,g,S){super(l,{originalEvent:S}),this._defaultPrevented=!1}}class cl{constructor(l,g){this._map=l,this._clickTolerance=g.clickTolerance}reset(){delete this._mousedownPos}wheel(l){return this._firePreventable(new NA(l.type,this._map,l))}mousedown(l,g){return this._mousedownPos=g,this._firePreventable(new Uo(l.type,this._map,l))}mouseup(l){this._map.fire(new Uo(l.type,this._map,l))}click(l,g){this._mousedownPos&&this._mousedownPos.dist(g)>=this._clickTolerance||this._map.fire(new Uo(l.type,this._map,l))}dblclick(l){return this._firePreventable(new Uo(l.type,this._map,l))}mouseover(l){this._map.fire(new Uo(l.type,this._map,l))}mouseout(l){this._map.fire(new Uo(l.type,this._map,l))}touchstart(l){return this._firePreventable(new Qa(l.type,this._map,l))}touchmove(l){this._map.fire(new Qa(l.type,this._map,l))}touchend(l){this._map.fire(new Qa(l.type,this._map,l))}touchcancel(l){this._map.fire(new Qa(l.type,this._map,l))}_firePreventable(l){if(this._map.fire(l),l.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class sc{constructor(l){this._map=l}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(l){this._map.fire(new Uo(l.type,this._map,l))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Uo("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(l){this._delayContextMenu?this._contextMenuEvent=l:this._ignoreContextMenu||this._map.fire(new Uo(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class bl{constructor(l){this._map=l}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(l){return this.transform.pointLocation(P.P.convert(l),this._map.terrain)}}class UA{constructor(l,g){this._map=l,this._tr=new bl(l),this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=g.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(l,g){this.isEnabled()&&l.shiftKey&&l.button===0&&(Ee.disableDrag(),this._startPos=this._lastPos=g,this._active=!0)}mousemoveWindow(l,g){if(!this._active)return;const S=g;if(this._lastPos.equals(S)||!this._box&&S.dist(this._startPos)<this._clickTolerance)return;const k=this._startPos;this._lastPos=S,this._box||(this._box=Ee.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",l));const F=Math.min(k.x,S.x),Z=Math.max(k.x,S.x),u=Math.min(k.y,S.y),h=Math.max(k.y,S.y);Ee.setTransform(this._box,`translate(${F}px,${u}px)`),this._box.style.width=Z-F+"px",this._box.style.height=h-u+"px"}mouseupWindow(l,g){if(!this._active||l.button!==0)return;const S=this._startPos,k=g;if(this.reset(),Ee.suppressClick(),S.x!==k.x||S.y!==k.y)return this._map.fire(new P.k("boxzoomend",{originalEvent:l})),{cameraAnimation:F=>F.fitScreenCoordinates(S,k,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",l)}keydown(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(Ee.remove(this._box),this._box=null),Ee.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(l,g){return this._map.fire(new P.k(l,{originalEvent:g}))}}function Vo(z,l){if(z.length!==l.length)throw new Error(`The number of touches and points are not equal - touches ${z.length}, points ${l.length}`);const g={};for(let S=0;S<z.length;S++)g[z[S].identifier]=l[S];return g}class ia{constructor(l){this.reset(),this.numTouches=l.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(l,g,S){(this.centroid||S.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=l.timeStamp),S.length===this.numTouches&&(this.centroid=function(k){const F=new P.P(0,0);for(const Z of k)F._add(Z);return F.div(k.length)}(g),this.touches=Vo(S,g)))}touchmove(l,g,S){if(this.aborted||!this.centroid)return;const k=Vo(S,g);for(const F in this.touches){const Z=k[F];(!Z||Z.dist(this.touches[F])>30)&&(this.aborted=!0)}}touchend(l,g,S){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),S.length===0){const k=!this.aborted&&this.centroid;if(this.reset(),k)return k}}}class Ca{constructor(l){this.singleTap=new ia(l),this.numTaps=l.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(l,g,S){this.singleTap.touchstart(l,g,S)}touchmove(l,g,S){this.singleTap.touchmove(l,g,S)}touchend(l,g,S){const k=this.singleTap.touchend(l,g,S);if(k){const F=l.timeStamp-this.lastTime<500,Z=!this.lastTap||this.lastTap.dist(k)<30;if(F&&Z||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=k,this.count===this.numTaps)return this.reset(),k}}}class ul{constructor(l){this._tr=new bl(l),this._zoomIn=new Ca({numTouches:1,numTaps:2}),this._zoomOut=new Ca({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(l,g,S){this._zoomIn.touchstart(l,g,S),this._zoomOut.touchstart(l,g,S)}touchmove(l,g,S){this._zoomIn.touchmove(l,g,S),this._zoomOut.touchmove(l,g,S)}touchend(l,g,S){const k=this._zoomIn.touchend(l,g,S),F=this._zoomOut.touchend(l,g,S),Z=this._tr;return k?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:u=>u.easeTo({duration:300,zoom:Z.zoom+1,around:Z.unproject(k)},{originalEvent:l})}):F?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:u=>u.easeTo({duration:300,zoom:Z.zoom-1,around:Z.unproject(F)},{originalEvent:l})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class wl{constructor(l){this._enabled=!!l.enable,this._moveStateManager=l.moveStateManager,this._clickTolerance=l.clickTolerance||1,this._moveFunction=l.move,this._activateOnStart=!!l.activateOnStart,l.assignEvents(this),this.reset()}reset(l){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(l)}_move(...l){const g=this._moveFunction(...l);if(g.bearingDelta||g.pitchDelta||g.around||g.panDelta)return this._active=!0,g}dragStart(l,g){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(l)&&(this._moveStateManager.startMove(l),this._lastPoint=g.length?g[0]:g,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(l,g){if(!this.isEnabled())return;const S=this._lastPoint;if(!S)return;if(l.preventDefault(),!this._moveStateManager.isValidMoveEvent(l))return void this.reset(l);const k=g.length?g[0]:g;return!this._moved&&k.dist(S)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=k,this._move(S,k))}dragEnd(l){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(l)&&(this._moved&&Ee.suppressClick(),this.reset(l))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const ku={0:1,2:2};class oc{constructor(l){this._correctEvent=l.checkCorrectEvent}startMove(l){const g=Ee.mouseButton(l);this._eventButton=g}endMove(l){delete this._eventButton}isValidStartEvent(l){return this._correctEvent(l)}isValidMoveEvent(l){return!function(g,S){const k=ku[S];return g.buttons===void 0||(g.buttons&k)!==k}(l,this._eventButton)}isValidEndEvent(l){return Ee.mouseButton(l)===this._eventButton}}class au{constructor(){this._firstTouch=void 0}_isOneFingerTouch(l){return l.targetTouches.length===1}_isSameTouchEvent(l){return l.targetTouches[0].identifier===this._firstTouch}startMove(l){this._firstTouch=l.targetTouches[0].identifier}endMove(l){delete this._firstTouch}isValidStartEvent(l){return this._isOneFingerTouch(l)}isValidMoveEvent(l){return this._isOneFingerTouch(l)&&this._isSameTouchEvent(l)}isValidEndEvent(l){return this._isOneFingerTouch(l)&&this._isSameTouchEvent(l)}}const rA=z=>{z.mousedown=z.dragStart,z.mousemoveWindow=z.dragMove,z.mouseup=z.dragEnd,z.contextmenu=function(l){l.preventDefault()}},hl=({enable:z,clickTolerance:l,bearingDegreesPerPixelMoved:g=.8})=>{const S=new oc({checkCorrectEvent:k=>Ee.mouseButton(k)===0&&k.ctrlKey||Ee.mouseButton(k)===2});return new wl({clickTolerance:l,move:(k,F)=>({bearingDelta:(F.x-k.x)*g}),moveStateManager:S,enable:z,assignEvents:rA})},Ha=({enable:z,clickTolerance:l,pitchDegreesPerPixelMoved:g=-.5})=>{const S=new oc({checkCorrectEvent:k=>Ee.mouseButton(k)===0&&k.ctrlKey||Ee.mouseButton(k)===2});return new wl({clickTolerance:l,move:(k,F)=>({pitchDelta:(F.y-k.y)*g}),moveStateManager:S,enable:z,assignEvents:rA})};class Fi{constructor(l,g){this._minTouches=l.cooperativeGestures?2:1,this._clickTolerance=l.clickTolerance||1,this._map=g,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new P.P(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(l,g,S){return this._calculateTransform(l,g,S)}touchmove(l,g,S){if(this._map._cooperativeGestures&&(this._minTouches===2&&S.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(l,!1,S.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(S.length<this._minTouches))return l.preventDefault(),this._calculateTransform(l,g,S)}touchend(l,g,S){this._calculateTransform(l,g,S),this._active&&S.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(l,g,S){S.length>0&&(this._active=!0);const k=Vo(S,g),F=new P.P(0,0),Z=new P.P(0,0);let u=0;for(const d in k){const y=k[d],b=this._touches[d];b&&(F._add(y),Z._add(y.sub(b)),u++,k[d]=y)}if(this._touches=k,u<this._minTouches||!Z.mag())return;const h=Z.div(u);return this._sum._add(h),this._sum.mag()<this._clickTolerance?void 0:{around:F.div(u),panDelta:h}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class jo{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(l,g,S){this._firstTwoTouches||S.length<2||(this._firstTwoTouches=[S[0].identifier,S[1].identifier],this._start([g[0],g[1]]))}touchmove(l,g,S){if(!this._firstTwoTouches)return;l.preventDefault();const[k,F]=this._firstTwoTouches,Z=Wa(S,g,k),u=Wa(S,g,F);if(!Z||!u)return;const h=this._aroundCenter?null:Z.add(u).div(2);return this._move([Z,u],h,l)}touchend(l,g,S){if(!this._firstTwoTouches)return;const[k,F]=this._firstTwoTouches,Z=Wa(S,g,k),u=Wa(S,g,F);Z&&u||(this._active&&Ee.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Wa(z,l,g){for(let S=0;S<z.length;S++)if(z[S].identifier===g)return l[S]}function fl(z,l){return Math.log(z/l)/Math.LN2}class ac extends jo{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(l){this._startDistance=this._distance=l[0].dist(l[1])}_move(l,g){const S=this._distance;if(this._distance=l[0].dist(l[1]),this._active||!(Math.abs(fl(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:fl(this._distance,S),pinchAround:g}}}function Ei(z,l){return 180*z.angleWith(l)/Math.PI}class nA extends jo{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(l){this._startVector=this._vector=l[0].sub(l[1]),this._minDiameter=l[0].dist(l[1])}_move(l,g){const S=this._vector;if(this._vector=l[0].sub(l[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Ei(this._vector,S),pinchAround:g}}_isBelowThreshold(l){this._minDiameter=Math.min(this._minDiameter,l.mag());const g=25/(Math.PI*this._minDiameter)*360,S=Ei(l,this._startVector);return Math.abs(S)<g}}function VA(z){return Math.abs(z.y)>Math.abs(z.x)}class fa extends jo{constructor(l){super(),this._map=l}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(l,g,S){super.touchstart(l,g,S),this._currentTouchCount=S.length}_start(l){this._lastPoints=l,VA(l[0].sub(l[1]))&&(this._valid=!1)}_move(l,g,S){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const k=l[0].sub(this._lastPoints[0]),F=l[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(k,F,S.timeStamp),this._valid?(this._lastPoints=l,this._active=!0,{pitchDelta:(k.y+F.y)/2*-.5}):void 0}gestureBeginsVertically(l,g,S){if(this._valid!==void 0)return this._valid;const k=l.mag()>=2,F=g.mag()>=2;if(!k&&!F)return;if(!k||!F)return this._firstMove===void 0&&(this._firstMove=S),S-this._firstMove<100&&void 0;const Z=l.y>0==g.y>0;return VA(l)&&VA(g)&&Z}}const yA={panStep:100,bearingStep:15,pitchStep:10};class lc{constructor(l){this._tr=new bl(l);const g=yA;this._panStep=g.panStep,this._bearingStep=g.bearingStep,this._pitchStep=g.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(l){if(l.altKey||l.ctrlKey||l.metaKey)return;let g=0,S=0,k=0,F=0,Z=0;switch(l.keyCode){case 61:case 107:case 171:case 187:g=1;break;case 189:case 109:case 173:g=-1;break;case 37:l.shiftKey?S=-1:(l.preventDefault(),F=-1);break;case 39:l.shiftKey?S=1:(l.preventDefault(),F=1);break;case 38:l.shiftKey?k=1:(l.preventDefault(),Z=-1);break;case 40:l.shiftKey?k=-1:(l.preventDefault(),Z=1);break;default:return}return this._rotationDisabled&&(S=0,k=0),{cameraAnimation:u=>{const h=this._tr;u.easeTo({duration:300,easeId:"keyboardHandler",easing:jA,zoom:g?Math.round(h.zoom)+g*(l.shiftKey?2:1):h.zoom,bearing:h.bearing+S*this._bearingStep,pitch:h.pitch+k*this._pitchStep,offset:[-F*this._panStep,-Z*this._panStep],center:h.center},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function jA(z){return z*(2-z)}const Ac=4.000244140625;class ks{constructor(l,g){this._onTimeout=S=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(S)},this._map=l,this._tr=new bl(l),this._el=l.getCanvasContainer(),this._triggerRenderFrame=g,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(l){this._defaultZoomRate=l}setWheelZoomRate(l){this._wheelZoomRate=l}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!l&&l.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(l){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!l[this._map._metaKey])return;l.preventDefault()}let g=l.deltaMode===WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY;const S=P.h.now(),k=S-(this._lastWheelEventTime||0);this._lastWheelEventTime=S,g!==0&&g%Ac==0?this._type="wheel":g!==0&&Math.abs(g)<4?this._type="trackpad":k>400?(this._type=null,this._lastValue=g,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(k*g)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,g+=this._lastValue)),l.shiftKey&&g&&(g/=4),this._type&&(this._lastWheelEvent=l,this._delta-=g,this._active||this._start(l)),l.preventDefault()}_start(l){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const g=Ee.mousePos(this._el,l),S=this._tr;this._around=P.L.convert(this._aroundCenter?S.center:S.unproject(g)),this._aroundPoint=S.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const l=this._tr.transform;if(this._delta!==0){const u=this._type==="wheel"&&Math.abs(this._delta)>Ac?this._wheelZoomRate:this._defaultZoomRate;let h=2/(1+Math.exp(-Math.abs(this._delta*u)));this._delta<0&&h!==0&&(h=1/h);const d=typeof this._targetZoom=="number"?l.zoomScale(this._targetZoom):l.scale;this._targetZoom=Math.min(l.maxZoom,Math.max(l.minZoom,l.scaleZoom(d*h))),this._type==="wheel"&&(this._startZoom=l.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const g=typeof this._targetZoom=="number"?this._targetZoom:l.zoom,S=this._startZoom,k=this._easing;let F,Z=!1;if(this._type==="wheel"&&S&&k){const u=Math.min((P.h.now()-this._lastWheelEventTime)/200,1),h=k(u);F=P.B.number(S,g,h),u<1?this._frameId||(this._frameId=!0):Z=!0}else F=g,Z=!0;return this._active=!0,Z&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!Z,zoomDelta:F-l.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(l){let g=P.bb;if(this._prevEase){const S=this._prevEase,k=(P.h.now()-S.start)/S.duration,F=S.easing(k+.01)-S.easing(k),Z=.27/Math.sqrt(F*F+1e-4)*.01,u=Math.sqrt(.0729-Z*Z);g=P.ba(Z,u,.25,1)}return this._prevEase={start:P.h.now(),duration:l,easing:g},g}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class xA{constructor(l,g){this._clickZoom=l,this._tapZoom=g}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class GA{constructor(l){this._tr=new bl(l),this.reset()}reset(){this._active=!1}dblclick(l,g){return l.preventDefault(),{cameraAnimation:S=>{S.easeTo({duration:300,zoom:this._tr.zoom+(l.shiftKey?-1:1),around:this._tr.unproject(g)},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ZA{constructor(){this._tap=new Ca({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(l,g,S){if(!this._swipePoint)if(this._tapTime){const k=g[0],F=l.timeStamp-this._tapTime<500,Z=this._tapPoint.dist(k)<30;F&&Z?S.length>0&&(this._swipePoint=k,this._swipeTouch=S[0].identifier):this.reset()}else this._tap.touchstart(l,g,S)}touchmove(l,g,S){if(this._tapTime){if(this._swipePoint){if(S[0].identifier!==this._swipeTouch)return;const k=g[0],F=k.y-this._swipePoint.y;return this._swipePoint=k,l.preventDefault(),this._active=!0,{zoomDelta:F/128}}}else this._tap.touchmove(l,g,S)}touchend(l,g,S){if(this._tapTime)this._swipePoint&&S.length===0&&this.reset();else{const k=this._tap.touchend(l,g,S);k&&(this._tapTime=l.timeStamp,this._tapPoint=k)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ki{constructor(l,g,S){this._el=l,this._mousePan=g,this._touchPan=S}enable(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Po{constructor(l,g,S){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=g,this._mousePitch=S}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class ka{constructor(l,g,S,k){this._el=l,this._touchZoom=g,this._touchRotate=S,this._tapDragZoom=k,this._rotationDisabled=!1,this._enabled=!0}enable(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const sA=z=>z.zoom||z.drag||z.pitch||z.rotate;class cc extends P.k{}function oA(z){return z.panDelta&&z.panDelta.mag()||z.zoomDelta||z.bearingDelta||z.pitchDelta}class Tl{constructor(l,g){this.handleWindowEvent=k=>{this.handleEvent(k,`${k.type}Window`)},this.handleEvent=(k,F)=>{if(k.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const Z=k.type==="renderFrame"?void 0:k,u={needsRenderFrame:!1},h={},d={},y=k.touches,b=y?this._getMapTouches(y):void 0,I=b?Ee.touchPos(this._el,b):Ee.mousePos(this._el,k);for(const{handlerName:W,handler:K,allowed:le}of this._handlers){if(!K.isEnabled())continue;let de;this._blockedByActive(d,le,W)?K.reset():K[F||k.type]&&(de=K[F||k.type](k,I,b),this.mergeHandlerResult(u,h,de,W,Z),de&&de.needsRenderFrame&&this._triggerRenderFrame()),(de||K.isActive())&&(d[W]=K)}const R={};for(const W in this._previousActiveHandlers)d[W]||(R[W]=Z);this._previousActiveHandlers=d,(Object.keys(R).length||oA(u))&&(this._changes.push([u,h,R]),this._triggerRenderFrame()),(Object.keys(d).length||oA(u))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:N}=u;N&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],N(this._map))},this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Lc(l),this._bearingSnap=g.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(g);const S=this._el;this._listeners=[[S,"touchstart",{passive:!0}],[S,"touchmove",{passive:!1}],[S,"touchend",void 0],[S,"touchcancel",void 0],[S,"mousedown",void 0],[S,"mousemove",void 0],[S,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[S,"mouseover",void 0],[S,"mouseout",void 0],[S,"dblclick",void 0],[S,"click",void 0],[S,"keydown",{capture:!1}],[S,"keyup",void 0],[S,"wheel",{passive:!1}],[S,"contextmenu",void 0],[window,"blur",void 0]];for(const[k,F,Z]of this._listeners)Ee.addEventListener(k,F,k===document?this.handleWindowEvent:this.handleEvent,Z)}destroy(){for(const[l,g,S]of this._listeners)Ee.removeEventListener(l,g,l===document?this.handleWindowEvent:this.handleEvent,S)}_addDefaultHandlers(l){const g=this._map,S=g.getCanvasContainer();this._add("mapEvent",new cl(g,l));const k=g.boxZoom=new UA(g,l);this._add("boxZoom",k),l.interactive&&l.boxZoom&&k.enable();const F=new ul(g),Z=new GA(g);g.doubleClickZoom=new xA(Z,F),this._add("tapZoom",F),this._add("clickZoom",Z),l.interactive&&l.doubleClickZoom&&g.doubleClickZoom.enable();const u=new ZA;this._add("tapDragZoom",u);const h=g.touchPitch=new fa(g);this._add("touchPitch",h),l.interactive&&l.touchPitch&&g.touchPitch.enable(l.touchPitch);const d=hl(l),y=Ha(l);g.dragRotate=new Po(l,d,y),this._add("mouseRotate",d,["mousePitch"]),this._add("mousePitch",y,["mouseRotate"]),l.interactive&&l.dragRotate&&g.dragRotate.enable();const b=(({enable:le,clickTolerance:de})=>{const ge=new oc({checkCorrectEvent:ke=>Ee.mouseButton(ke)===0&&!ke.ctrlKey});return new wl({clickTolerance:de,move:(ke,Pe)=>({around:Pe,panDelta:Pe.sub(ke)}),activateOnStart:!0,moveStateManager:ge,enable:le,assignEvents:rA})})(l),I=new Fi(l,g);g.dragPan=new Ki(S,b,I),this._add("mousePan",b),this._add("touchPan",I,["touchZoom","touchRotate"]),l.interactive&&l.dragPan&&g.dragPan.enable(l.dragPan);const R=new nA,N=new ac;g.touchZoomRotate=new ka(S,N,R,u),this._add("touchRotate",R,["touchPan","touchZoom"]),this._add("touchZoom",N,["touchPan","touchRotate"]),l.interactive&&l.touchZoomRotate&&g.touchZoomRotate.enable(l.touchZoomRotate);const W=g.scrollZoom=new ks(g,()=>this._triggerRenderFrame());this._add("scrollZoom",W,["mousePan"]),l.interactive&&l.scrollZoom&&g.scrollZoom.enable(l.scrollZoom);const K=g.keyboard=new lc(g);this._add("keyboard",K),l.interactive&&l.keyboard&&g.keyboard.enable(),this._add("blockableMapEvent",new sc(g))}_add(l,g,S){this._handlers.push({handlerName:l,handler:g,allowed:S}),this._handlersById[l]=g}stop(l){if(!this._updatingCamera){for(const{handler:g}of this._handlers)g.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[]}}isActive(){for(const{handler:l}of this._handlers)if(l.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!sA(this._eventsInProgress)||this.isZooming()}_blockedByActive(l,g,S){for(const k in l)if(k!==S&&(!g||g.indexOf(k)<0))return!0;return!1}_getMapTouches(l){const g=[];for(const S of l)this._el.contains(S.target)&&g.push(S);return g}mergeHandlerResult(l,g,S,k,F){if(!S)return;P.e(l,S);const Z={handlerName:k,originalEvent:S.originalEvent||F};S.zoomDelta!==void 0&&(g.zoom=Z),S.panDelta!==void 0&&(g.drag=Z),S.pitchDelta!==void 0&&(g.pitch=Z),S.bearingDelta!==void 0&&(g.rotate=Z)}_applyChanges(){const l={},g={},S={};for(const[k,F,Z]of this._changes)k.panDelta&&(l.panDelta=(l.panDelta||new P.P(0,0))._add(k.panDelta)),k.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+k.zoomDelta),k.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+k.bearingDelta),k.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+k.pitchDelta),k.around!==void 0&&(l.around=k.around),k.pinchAround!==void 0&&(l.pinchAround=k.pinchAround),k.noInertia&&(l.noInertia=k.noInertia),P.e(g,F),P.e(S,Z);this._updateMapTransform(l,g,S),this._changes=[]}_updateMapTransform(l,g,S){const k=this._map,F=k._getTransformForUpdate(),Z=k.terrain;if(!(oA(l)||Z&&this._terrainMovement))return this._fireEvents(g,S,!0);let{panDelta:u,zoomDelta:h,bearingDelta:d,pitchDelta:y,around:b,pinchAround:I}=l;I!==void 0&&(b=I),k._stop(!0),b=b||k.transform.centerPoint;const R=F.pointLocation(u?b.sub(u):b);d&&(F.bearing+=d),y&&(F.pitch+=y),h&&(F.zoom+=h),Z?this._terrainMovement||!g.drag&&!g.zoom?g.drag&&this._terrainMovement?F.center=F.pointLocation(F.centerPoint.sub(u)):F.setLocationAtPoint(R,b):(this._terrainMovement=!0,this._map._elevationFreeze=!0,F.setLocationAtPoint(R,b),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,F.recalculateZoom(k.terrain)})):F.setLocationAtPoint(R,b),k._applyUpdatedTransform(F),this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(g,S,!0)}_fireEvents(l,g,S){const k=sA(this._eventsInProgress),F=sA(l),Z={};for(const y in l){const{originalEvent:b}=l[y];this._eventsInProgress[y]||(Z[`${y}start`]=b),this._eventsInProgress[y]=l[y]}!k&&F&&this._fireEvent("movestart",F.originalEvent);for(const y in Z)this._fireEvent(y,Z[y]);F&&this._fireEvent("move",F.originalEvent);for(const y in l){const{originalEvent:b}=l[y];this._fireEvent(y,b)}const u={};let h;for(const y in this._eventsInProgress){const{handlerName:b,originalEvent:I}=this._eventsInProgress[y];this._handlersById[b].isActive()||(delete this._eventsInProgress[y],h=g[b]||I,u[`${y}end`]=h)}for(const y in u)this._fireEvent(y,u[y]);const d=sA(this._eventsInProgress);if(S&&(k||F)&&!d){this._updatingCamera=!0;const y=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),b=I=>I!==0&&-this._bearingSnap<I&&I<this._bearingSnap;!y||!y.essential&&P.h.prefersReducedMotion?(this._map.fire(new P.k("moveend",{originalEvent:h})),b(this._map.getBearing())&&this._map.resetNorth()):(b(y.bearing||this._map.getBearing())&&(y.bearing=0),y.freezeElevation=!0,this._map.easeTo(y,{originalEvent:h})),this._updatingCamera=!1}}_fireEvent(l,g){this._map.fire(new P.k(l,g?{originalEvent:g}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(l=>{delete this._frameId,this.handleEvent(new cc("renderFrame",{timeStamp:l})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Ds extends P.E{constructor(l,g){super(),this._renderFrameCallback=()=>{const S=Math.min((P.h.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(S)),S<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=l,this._bearingSnap=g.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new P.L(this.transform.center.lng,this.transform.center.lat)}setCenter(l,g){return this.jumpTo({center:l},g)}panBy(l,g,S){return l=P.P.convert(l).mult(-1),this.panTo(this.transform.center,P.e({offset:l},g),S)}panTo(l,g,S){return this.easeTo(P.e({center:l},g),S)}getZoom(){return this.transform.zoom}setZoom(l,g){return this.jumpTo({zoom:l},g),this}zoomTo(l,g,S){return this.easeTo(P.e({zoom:l},g),S)}zoomIn(l,g){return this.zoomTo(this.getZoom()+1,l,g),this}zoomOut(l,g){return this.zoomTo(this.getZoom()-1,l,g),this}getBearing(){return this.transform.bearing}setBearing(l,g){return this.jumpTo({bearing:l},g),this}getPadding(){return this.transform.padding}setPadding(l,g){return this.jumpTo({padding:l},g),this}rotateTo(l,g,S){return this.easeTo(P.e({bearing:l},g),S)}resetNorth(l,g){return this.rotateTo(0,P.e({duration:1e3},l),g),this}resetNorthPitch(l,g){return this.easeTo(P.e({bearing:0,pitch:0,duration:1e3},l),g),this}snapToNorth(l,g){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(l,g):this}getPitch(){return this.transform.pitch}setPitch(l,g){return this.jumpTo({pitch:l},g),this}cameraForBounds(l,g){l=jr.convert(l);const S=g&&g.bearing||0;return this._cameraForBoxAndBearing(l.getNorthWest(),l.getSouthEast(),S,g)}_cameraForBoxAndBearing(l,g,S,k){const F={top:0,bottom:0,right:0,left:0};if(typeof(k=P.e({padding:F,offset:[0,0],maxZoom:this.transform.maxZoom},k)).padding=="number"){const Pe=k.padding;k.padding={top:Pe,bottom:Pe,right:Pe,left:Pe}}k.padding=P.e(F,k.padding);const Z=this.transform,u=Z.padding,h=Z.project(P.L.convert(l)),d=Z.project(P.L.convert(g)),y=h.rotate(-S*Math.PI/180),b=d.rotate(-S*Math.PI/180),I=new P.P(Math.max(y.x,b.x),Math.max(y.y,b.y)),R=new P.P(Math.min(y.x,b.x),Math.min(y.y,b.y)),N=I.sub(R),W=(Z.width-(u.left+u.right+k.padding.left+k.padding.right))/N.x,K=(Z.height-(u.top+u.bottom+k.padding.top+k.padding.bottom))/N.y;if(K<0||W<0)return void P.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const le=Math.min(Z.scaleZoom(Z.scale*Math.min(W,K)),k.maxZoom),de=P.P.convert(k.offset),ge=new P.P((k.padding.left-k.padding.right)/2,(k.padding.top-k.padding.bottom)/2).rotate(S*Math.PI/180),ke=de.add(ge).mult(Z.scale/Z.zoomScale(le));return{center:Z.unproject(h.add(d).div(2).sub(ke)),zoom:le,bearing:S}}fitBounds(l,g,S){return this._fitInternal(this.cameraForBounds(l,g),g,S)}fitScreenCoordinates(l,g,S,k,F){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(P.P.convert(l)),this.transform.pointLocation(P.P.convert(g)),S,k),k,F)}_fitInternal(l,g,S){return l?(delete(g=P.e(l,g)).padding,g.linear?this.easeTo(g,S):this.flyTo(g,S)):this}jumpTo(l,g){this.stop();const S=this._getTransformForUpdate();let k=!1,F=!1,Z=!1;return"zoom"in l&&S.zoom!==+l.zoom&&(k=!0,S.zoom=+l.zoom),l.center!==void 0&&(S.center=P.L.convert(l.center)),"bearing"in l&&S.bearing!==+l.bearing&&(F=!0,S.bearing=+l.bearing),"pitch"in l&&S.pitch!==+l.pitch&&(Z=!0,S.pitch=+l.pitch),l.padding==null||S.isPaddingEqual(l.padding)||(S.padding=l.padding),this._applyUpdatedTransform(S),this.fire(new P.k("movestart",g)).fire(new P.k("move",g)),k&&this.fire(new P.k("zoomstart",g)).fire(new P.k("zoom",g)).fire(new P.k("zoomend",g)),F&&this.fire(new P.k("rotatestart",g)).fire(new P.k("rotate",g)).fire(new P.k("rotateend",g)),Z&&this.fire(new P.k("pitchstart",g)).fire(new P.k("pitch",g)).fire(new P.k("pitchend",g)),this.fire(new P.k("moveend",g))}calculateCameraOptionsFromTo(l,g,S,k=0){const F=P.U.fromLngLat(l,g),Z=P.U.fromLngLat(S,k),u=Z.x-F.x,h=Z.y-F.y,d=Z.z-F.z,y=Math.hypot(u,h,d);if(y===0)throw new Error("Can't calculate camera options with same From and To");const b=Math.hypot(u,h),I=this.transform.scaleZoom(this.transform.cameraToCenterDistance/y/this.transform.tileSize),R=180*Math.atan2(u,-h)/Math.PI;let N=180*Math.acos(b/y)/Math.PI;return N=d<0?90-N:90+N,{center:Z.toLngLat(),zoom:I,pitch:N,bearing:R}}easeTo(l,g){this._stop(!1,l.easeId),((l=P.e({offset:[0,0],duration:500,easing:P.bb},l)).animate===!1||!l.essential&&P.h.prefersReducedMotion)&&(l.duration=0);const S=this._getTransformForUpdate(),k=this.getZoom(),F=this.getBearing(),Z=this.getPitch(),u=this.getPadding(),h="zoom"in l?+l.zoom:k,d="bearing"in l?this._normalizeBearing(l.bearing,F):F,y="pitch"in l?+l.pitch:Z,b="padding"in l?l.padding:S.padding,I=P.P.convert(l.offset);let R=S.centerPoint.add(I);const N=S.pointLocation(R),W=P.L.convert(l.center||N);this._normalizeCenter(W);const K=S.project(N),le=S.project(W).sub(K),de=S.zoomScale(h-k);let ge,ke;l.around&&(ge=P.L.convert(l.around),ke=S.locationPoint(ge));const Pe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||h!==k,this._rotating=this._rotating||F!==d,this._pitching=this._pitching||y!==Z,this._padding=!S.isPaddingEqual(b),this._easeId=l.easeId,this._prepareEase(g,l.noMoveStart,Pe),this.terrain&&this._prepareElevation(W),this._ease(qe=>{if(this._zooming&&(S.zoom=P.B.number(k,h,qe)),this._rotating&&(S.bearing=P.B.number(F,d,qe)),this._pitching&&(S.pitch=P.B.number(Z,y,qe)),this._padding&&(S.interpolatePadding(u,b,qe),R=S.centerPoint.add(I)),this.terrain&&!l.freezeElevation&&this._updateElevation(qe),ge)S.setLocationAtPoint(ge,ke);else{const ht=S.zoomScale(S.zoom-k),mt=h>k?Math.min(2,de):Math.max(.5,de),ot=Math.pow(mt,1-qe),ft=S.unproject(K.add(le.mult(qe*ot)).mult(ht));S.setLocationAtPoint(S.renderWorldCopies?ft.wrap():ft,R)}this._applyUpdatedTransform(S),this._fireMoveEvents(g)},qe=>{this.terrain&&this._finalizeElevation(),this._afterEase(g,qe)},l),this}_prepareEase(l,g,S={}){this._moving=!0,g||S.moving||this.fire(new P.k("movestart",l)),this._zooming&&!S.zooming&&this.fire(new P.k("zoomstart",l)),this._rotating&&!S.rotating&&this.fire(new P.k("rotatestart",l)),this._pitching&&!S.pitching&&this.fire(new P.k("pitchstart",l))}_prepareElevation(l){this._elevationCenter=l,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(l,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(l){this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const g=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(l<1&&g!==this._elevationTarget){const S=this._elevationTarget-this._elevationStart;this._elevationStart+=l*(S-(g-(S*l+this._elevationStart))/(1-l)),this._elevationTarget=g}this.transform.elevation=P.B.number(this._elevationStart,this._elevationTarget,l)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(l){if(!this.transformCameraUpdate)return;const g=l.clone(),{center:S,zoom:k,pitch:F,bearing:Z,elevation:u}=this.transformCameraUpdate(g);S&&(g.center=S),k!==void 0&&(g.zoom=k),F!==void 0&&(g.pitch=F),Z!==void 0&&(g.bearing=Z),u!==void 0&&(g.elevation=u),this.transform.apply(g)}_fireMoveEvents(l){this.fire(new P.k("move",l)),this._zooming&&this.fire(new P.k("zoom",l)),this._rotating&&this.fire(new P.k("rotate",l)),this._pitching&&this.fire(new P.k("pitch",l))}_afterEase(l,g){if(this._easeId&&g&&this._easeId===g)return;delete this._easeId;const S=this._zooming,k=this._rotating,F=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,S&&this.fire(new P.k("zoomend",l)),k&&this.fire(new P.k("rotateend",l)),F&&this.fire(new P.k("pitchend",l)),this.fire(new P.k("moveend",l))}flyTo(l,g){if(!l.essential&&P.h.prefersReducedMotion){const qt=P.F(l,["center","zoom","bearing","pitch","around"]);return this.jumpTo(qt,g)}this.stop(),l=P.e({offset:[0,0],speed:1.2,curve:1.42,easing:P.bb},l);const S=this._getTransformForUpdate(),k=this.getZoom(),F=this.getBearing(),Z=this.getPitch(),u=this.getPadding(),h="zoom"in l?P.ad(+l.zoom,S.minZoom,S.maxZoom):k,d="bearing"in l?this._normalizeBearing(l.bearing,F):F,y="pitch"in l?+l.pitch:Z,b="padding"in l?l.padding:S.padding,I=S.zoomScale(h-k),R=P.P.convert(l.offset);let N=S.centerPoint.add(R);const W=S.pointLocation(N),K=P.L.convert(l.center||W);this._normalizeCenter(K);const le=S.project(W),de=S.project(K).sub(le);let ge=l.curve;const ke=Math.max(S.width,S.height),Pe=ke/I,qe=de.mag();if("minZoom"in l){const qt=P.ad(Math.min(l.minZoom,k,h),S.minZoom,S.maxZoom),or=ke/S.zoomScale(qt-k);ge=Math.sqrt(or/qe*2)}const ht=ge*ge;function mt(qt){const or=(Pe*Pe-ke*ke+(qt?-1:1)*ht*ht*qe*qe)/(2*(qt?Pe:ke)*ht*qe);return Math.log(Math.sqrt(or*or+1)-or)}function ot(qt){return(Math.exp(qt)-Math.exp(-qt))/2}function ft(qt){return(Math.exp(qt)+Math.exp(-qt))/2}const dt=mt(!1);let ai=function(qt){return ft(dt)/ft(dt+ge*qt)},Ut=function(qt){return ke*((ft(dt)*(ot(or=dt+ge*qt)/ft(or))-ot(dt))/ht)/qe;var or},Xt=(mt(!0)-dt)/ge;if(Math.abs(qe)<1e-6||!isFinite(Xt)){if(Math.abs(ke-Pe)<1e-6)return this.easeTo(l,g);const qt=Pe<ke?-1:1;Xt=Math.abs(Math.log(Pe/ke))/ge,Ut=function(){return 0},ai=function(or){return Math.exp(qt*ge*or)}}return l.duration="duration"in l?+l.duration:1e3*Xt/("screenSpeed"in l?+l.screenSpeed/ge:+l.speed),l.maxDuration&&l.duration>l.maxDuration&&(l.duration=0),this._zooming=!0,this._rotating=F!==d,this._pitching=y!==Z,this._padding=!S.isPaddingEqual(b),this._prepareEase(g,!1),this.terrain&&this._prepareElevation(K),this._ease(qt=>{const or=qt*Xt,qi=1/ai(or);S.zoom=qt===1?h:k+S.scaleZoom(qi),this._rotating&&(S.bearing=P.B.number(F,d,qt)),this._pitching&&(S.pitch=P.B.number(Z,y,qt)),this._padding&&(S.interpolatePadding(u,b,qt),N=S.centerPoint.add(R)),this.terrain&&!l.freezeElevation&&this._updateElevation(qt);const ji=qt===1?K:S.unproject(le.add(de.mult(Ut(or))).mult(qi));S.setLocationAtPoint(S.renderWorldCopies?ji.wrap():ji,N),this._applyUpdatedTransform(S),this._fireMoveEvents(g)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(g)},l),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(l,g){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const S=this._onEaseEnd;delete this._onEaseEnd,S.call(this,g)}if(!l){const S=this.handlers;S&&S.stop(!1)}return this}_ease(l,g,S){S.animate===!1||S.duration===0?(l(1),g()):(this._easeStart=P.h.now(),this._easeOptions=S,this._onEaseFrame=l,this._onEaseEnd=g,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(l,g){l=P.b5(l,-180,180);const S=Math.abs(l-g);return Math.abs(l-360-g)<S&&(l-=360),Math.abs(l+360-g)<S&&(l+=360),l}_normalizeCenter(l){const g=this.transform;if(!g.renderWorldCopies||g.lngRange)return;const S=l.lng-g.center.lng;l.lng+=S>180?-360:S<-180?360:0}queryTerrainElevation(l){return this.terrain?this.terrain.getElevationForLngLatZoom(P.L.convert(l),this.transform.tileZoom)-this.transform.elevation:null}}class da{constructor(l={}){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=g=>{!g||g.sourceDataType!=="metadata"&&g.sourceDataType!=="visibility"&&g.dataType!=="style"&&g.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=l}getDefaultPosition(){return"bottom-right"}onAdd(l){return this._map=l,this._compact=this.options&&this.options.compact,this._container=Ee.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=Ee.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Ee.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){Ee.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(l,g){const S=this._map._getUIString(`AttributionControl.${g}`);l.title=S,l.setAttribute("aria-label",S)}_updateAttributions(){if(!this._map.style)return;let l=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=l.concat(this.options.customAttribution.map(k=>typeof k!="string"?"":k)):typeof this.options.customAttribution=="string"&&l.push(this.options.customAttribution)),this._map.style.stylesheet){const k=this._map.style.stylesheet;this.styleOwner=k.owner,this.styleId=k.id}const g=this._map.style.sourceCaches;for(const k in g){const F=g[k];if(F.used||F.usedForTerrain){const Z=F.getSource();Z.attribution&&l.indexOf(Z.attribution)<0&&l.push(Z.attribution)}}l=l.filter(k=>String(k).trim()),l.sort((k,F)=>k.length-F.length),l=l.filter((k,F)=>{for(let Z=F+1;Z<l.length;Z++)if(l[Z].indexOf(k)>=0)return!1;return!0});const S=l.join(" | ");S!==this._attribHTML&&(this._attribHTML=S,l.length?(this._innerContainer.innerHTML=S,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Qn{constructor(l={}){this._updateCompact=()=>{const g=this._container.children;if(g.length){const S=g[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&S.classList.add("maplibregl-compact"):S.classList.remove("maplibregl-compact")}},this.options=l}getDefaultPosition(){return"bottom-left"}onAdd(l){this._map=l,this._compact=this.options&&this.options.compact,this._container=Ee.create("div","maplibregl-ctrl");const g=Ee.create("a","maplibregl-ctrl-logo");return g.target="_blank",g.rel="noopener nofollow",g.href="https://maplibre.org/",g.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),g.setAttribute("rel","noopener nofollow"),this._container.appendChild(g),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){Ee.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Eo{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(l){const g=++this._id;return this._queue.push({callback:l,id:g,cancelled:!1}),g}remove(l){const g=this._currentlyRunning,S=g?this._queue.concat(g):this._queue;for(const k of S)if(k.id===l)return void(k.cancelled=!0)}run(l=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const g=this._currentlyRunning=this._queue;this._queue=[];for(const S of g)if(!S.cancelled&&(S.callback(l),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const pr={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"};var ra=P.Q([{name:"a_pos3d",type:"Int16",components:3}]);class uc extends P.E{constructor(l){super(),this.sourceCache=l,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,l.usedForTerrain=!0,l.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(l,g){this.sourceCache.update(l,g),this._renderableTilesKeys=[];const S={};for(const k of l.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:g}))S[k.key]=!0,this._renderableTilesKeys.push(k.key),this._tiles[k.key]||(k.posMatrix=new Float64Array(16),P.aS(k.posMatrix,0,P.N,0,P.N,0,1),this._tiles[k.key]=new Ue(k,this.tileSize));for(const k in this._tiles)S[k]||delete this._tiles[k]}freeRtt(l){for(const g in this._tiles){const S=this._tiles[g];(!l||S.tileID.equals(l)||S.tileID.isChildOf(l)||l.isChildOf(S.tileID))&&(S.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(l=>this.getTileByID(l))}getTileByID(l){return this._tiles[l]}getTerrainCoords(l){const g={};for(const S of this._renderableTilesKeys){const k=this._tiles[S].tileID;if(k.canonical.equals(l.canonical)){const F=l.clone();F.posMatrix=new Float64Array(16),P.aS(F.posMatrix,0,P.N,0,P.N,0,1),g[S]=F}else if(k.canonical.isChildOf(l.canonical)){const F=l.clone();F.posMatrix=new Float64Array(16);const Z=k.canonical.z-l.canonical.z,u=k.canonical.x-(k.canonical.x>>Z<<Z),h=k.canonical.y-(k.canonical.y>>Z<<Z),d=P.N>>Z;P.aS(F.posMatrix,0,d,0,d,0,1),P.$(F.posMatrix,F.posMatrix,[-u*d,-h*d,0]),g[S]=F}else if(l.canonical.isChildOf(k.canonical)){const F=l.clone();F.posMatrix=new Float64Array(16);const Z=l.canonical.z-k.canonical.z,u=l.canonical.x-(l.canonical.x>>Z<<Z),h=l.canonical.y-(l.canonical.y>>Z<<Z),d=P.N>>Z;P.aS(F.posMatrix,0,P.N,0,P.N,0,1),P.$(F.posMatrix,F.posMatrix,[u*d,h*d,0]),P.a0(F.posMatrix,F.posMatrix,[1/2**Z,1/2**Z,0]),g[S]=F}}return g}getSourceTile(l,g){const S=this.sourceCache._source;let k=l.overscaledZ-this.deltaZoom;if(k>S.maxzoom&&(k=S.maxzoom),k<S.minzoom)return null;this._sourceTileCache[l.key]||(this._sourceTileCache[l.key]=l.scaledTo(k).key);let F=this.sourceCache.getTileByID(this._sourceTileCache[l.key]);if((!F||!F.dem)&&g)for(;k>=S.minzoom&&(!F||!F.dem);)F=this.sourceCache.getTileByID(l.scaledTo(k--).key);return F}tilesAfterTime(l=Date.now()){return Object.values(this._tiles).filter(g=>g.timeAdded>=l)}}class Nl{constructor(l,g,S){this.painter=l,this.sourceCache=new uc(g),this.options=S,this.exaggeration=typeof S.exaggeration=="number"?S.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(l,g,S,k=P.N){var F;if(!(g>=0&&g<k&&S>=0&&S<k))return 0;const Z=this.getTerrainData(l),u=(F=Z.tile)===null||F===void 0?void 0:F.dem;if(!u)return 0;const h=function(N,W,K){var le=W[0],de=W[1];return N[0]=K[0]*le+K[4]*de+K[12],N[1]=K[1]*le+K[5]*de+K[13],N}([],[g/k*P.N,S/k*P.N],Z.u_terrain_matrix),d=[h[0]*u.dim,h[1]*u.dim],y=Math.floor(d[0]),b=Math.floor(d[1]),I=d[0]-y,R=d[1]-b;return u.get(y,b)*(1-I)*(1-R)+u.get(y+1,b)*I*(1-R)+u.get(y,b+1)*(1-I)*R+u.get(y+1,b+1)*I*R}getElevationForLngLatZoom(l,g){const{tileID:S,mercatorX:k,mercatorY:F}=this._getOverscaledTileIDFromLngLatZoom(l,g);return this.getElevation(S,k%P.N,F%P.N,P.N)}getElevation(l,g,S,k=P.N){return this.getDEMElevation(l,g,S,k)*this.exaggeration}getTerrainData(l){if(!this._emptyDemTexture){const k=this.painter.context,F=new P.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new ct(k,F,k.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new ct(k,new P.R({width:1,height:1}),k.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(k.gl.NEAREST,k.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=P.ao([])}const g=this.sourceCache.getSourceTile(l,!0);if(g&&g.dem&&(!g.demTexture||g.needsTerrainPrepare)){const k=this.painter.context;g.demTexture=this.painter.getTileTexture(g.dem.stride),g.demTexture?g.demTexture.update(g.dem.getPixels(),{premultiply:!1}):g.demTexture=new ct(k,g.dem.getPixels(),k.gl.RGBA,{premultiply:!1}),g.demTexture.bind(k.gl.NEAREST,k.gl.CLAMP_TO_EDGE),g.needsTerrainPrepare=!1}const S=g&&g+g.tileID.key+l.key;if(S&&!this._demMatrixCache[S]){const k=this.sourceCache.sourceCache._source.maxzoom;let F=l.canonical.z-g.tileID.canonical.z;l.overscaledZ>l.canonical.z&&(l.canonical.z>=k?F=l.canonical.z-k:P.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const Z=l.canonical.x-(l.canonical.x>>F<<F),u=l.canonical.y-(l.canonical.y>>F<<F),h=P.bc(new Float64Array(16),[1/(P.N<<F),1/(P.N<<F),0]);P.$(h,h,[Z*P.N,u*P.N,0]),this._demMatrixCache[l.key]={matrix:h,coord:l}}return{u_depth:2,u_terrain:3,u_terrain_dim:g&&g.dem&&g.dem.dim||1,u_terrain_matrix:S?this._demMatrixCache[l.key].matrix:this._emptyDemMatrix,u_terrain_unpack:g&&g.dem&&g.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(g&&g.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:g}}getFramebuffer(l){const g=this.painter,S=g.width/devicePixelRatio,k=g.height/devicePixelRatio;return!this._fbo||this._fbo.width===S&&this._fbo.height===k||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new ct(g.context,{width:S,height:k,data:null},g.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(g.context.gl.NEAREST,g.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new ct(g.context,{width:S,height:k,data:null},g.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(g.context.gl.NEAREST,g.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=g.context.createFramebuffer(S,k,!0,!1),this._fbo.depthAttachment.set(g.context.createRenderbuffer(g.context.gl.DEPTH_COMPONENT16,S,k))),this._fbo.colorAttachment.set(l==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const l=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const g=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let F=0,Z=0;F<this._coordsTextureSize;F++)for(let u=0;u<this._coordsTextureSize;u++,Z+=4)g[Z+0]=255&u,g[Z+1]=255&F,g[Z+2]=u>>8<<4|F>>8,g[Z+3]=0;const S=new P.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(g.buffer)),k=new ct(l,S,l.gl.RGBA,{premultiply:!1});return k.bind(l.gl.NEAREST,l.gl.CLAMP_TO_EDGE),this._coordsTexture=k,k}pointCoordinate(l){const g=new Uint8Array(4),S=this.painter.context,k=S.gl;S.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),k.readPixels(l.x,this.painter.height/devicePixelRatio-l.y-1,1,1,k.RGBA,k.UNSIGNED_BYTE,g),S.bindFramebuffer.set(null);const F=g[0]+(g[2]>>4<<8),Z=g[1]+((15&g[2])<<8),u=this.coordsIndex[255-g[3]],h=u&&this.sourceCache.getTileByID(u);if(!h)return null;const d=this._coordsTextureSize,y=(1<<h.tileID.canonical.z)*d;return new P.U(this._allowMercatorOverflow(l,(h.tileID.canonical.x*d+F)/y),(h.tileID.canonical.y*d+Z)/y,this.getElevation(h.tileID,F,Z,d))}getTerrainMesh(){if(this._mesh)return this._mesh;const l=this.painter.context,g=new P.bd,S=new P.b0,k=this.meshSize,F=P.N/k,Z=k*k;for(let b=0;b<=k;b++)for(let I=0;I<=k;I++)g.emplaceBack(I*F,b*F,0);for(let b=0;b<Z;b+=k+1)for(let I=0;I<k;I++)S.emplaceBack(I+b,k+I+b+1,k+I+b+2),S.emplaceBack(I+b,k+I+b+2,I+b+1);const u=g.length,h=u+2*(k+1);for(const b of[0,1])for(let I=0;I<=k;I++)for(const R of[0,1])g.emplaceBack(I*F,b*P.N,R);for(let b=0;b<2*k;b+=2)S.emplaceBack(h+b,h+b+1,h+b+3),S.emplaceBack(h+b,h+b+3,h+b+2),S.emplaceBack(u+b,u+b+3,u+b+1),S.emplaceBack(u+b,u+b+2,u+b+3);const d=g.length,y=d+2*(k+1);for(const b of[0,1])for(let I=0;I<=k;I++)for(const R of[0,1])g.emplaceBack(b*P.N,I*F,R);for(let b=0;b<2*k;b+=2)S.emplaceBack(d+b,d+b+1,d+b+3),S.emplaceBack(d+b,d+b+3,d+b+2),S.emplaceBack(y+b,y+b+3,y+b+1),S.emplaceBack(y+b,y+b+2,y+b+3);return this._mesh={indexBuffer:l.createIndexBuffer(S),vertexBuffer:l.createVertexBuffer(g,ra.members),segments:P.S.simpleSegment(0,0,g.length,S.length)},this._mesh}getMeshFrameDelta(l){return 2*Math.PI*P.be/Math.pow(2,l)/5}getMinTileElevationForLngLatZoom(l,g){var S;const{tileID:k}=this._getOverscaledTileIDFromLngLatZoom(l,g);return(S=this.getMinMaxElevation(k).minElevation)!==null&&S!==void 0?S:0}getMinMaxElevation(l){const g=this.getTerrainData(l).tile,S={minElevation:null,maxElevation:null};return g&&g.dem&&(S.minElevation=g.dem.min*this.exaggeration,S.maxElevation=g.dem.max*this.exaggeration),S}_getOverscaledTileIDFromLngLatZoom(l,g){const S=P.U.fromLngLat(l.wrap()),k=(1<<g)*P.N,F=S.x*k,Z=S.y*k,u=Math.floor(F/P.N),h=Math.floor(Z/P.N);return{tileID:new P.O(g,0,g,u,h),mercatorX:F,mercatorY:Z}}_allowMercatorOverflow(l,g){const S=l.x<this.painter.width/2;let k=P.bf(g);const F=this.painter.transform.center.lng;return S&&Math.sign(k)>0&&Math.sign(F)<0||!S&&Math.sign(k)<0&&Math.sign(F)>0?(k=360*Math.sign(F)+k,P.G(k)):g}}class hc{constructor(l,g,S){this._context=l,this._size=g,this._tileSize=S,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const l of this._objects)l.texture.destroy(),l.fbo.destroy()}_createObject(l){const g=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),S=new ct(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return S.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),g.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),g.colorAttachment.set(S.texture),{id:l,fbo:g,texture:S,stamp:-1,inUse:!1}}getObjectForId(l){return this._objects[l]}useObject(l){l.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(g=>l.id!==g),this._recentlyUsed.push(l.id)}stampObject(l){l.stamp=++this._stamp}getOrCreateFreeObject(){for(const g of this._recentlyUsed)if(!this._objects[g].inUse)return this._objects[g];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const l=this._createObject(this._objects.length);return this._objects.push(l),l}freeObject(l){l.inUse=!1}freeAllObjects(){for(const l of this._objects)this.freeObject(l)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(l=>!l.inUse)===!1}}const Mo={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Da{constructor(l,g){this.painter=l,this.terrain=g,this.pool=new hc(l.context,30,g.sourceCache.tileSize*g.qualityFactor)}destruct(){this.pool.destruct()}getTexture(l){return this.pool.getObjectForId(l.rtt[this._stacks.length-1].id).texture}prepareForRender(l,g){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=l._order.filter(S=>!l._layers[S].isHidden(g)),this._coordsDescendingInv={};for(const S in l.sourceCaches){this._coordsDescendingInv[S]={};const k=l.sourceCaches[S].getVisibleCoordinates();for(const F of k){const Z=this.terrain.sourceCache.getTerrainCoords(F);for(const u in Z)this._coordsDescendingInv[S][u]||(this._coordsDescendingInv[S][u]=[]),this._coordsDescendingInv[S][u].push(Z[u])}}this._coordsDescendingInvStr={};for(const S of l._order){const k=l._layers[S],F=k.source;if(Mo[k.type]&&!this._coordsDescendingInvStr[F]){this._coordsDescendingInvStr[F]={};for(const Z in this._coordsDescendingInv[F])this._coordsDescendingInvStr[F][Z]=this._coordsDescendingInv[F][Z].map(u=>u.key).sort().join()}}for(const S of this._renderableTiles)for(const k in this._coordsDescendingInvStr){const F=this._coordsDescendingInvStr[k][S.tileID.key];F&&F!==S.rttCoords[k]&&(S.rtt=[])}}renderLayer(l){if(l.isHidden(this.painter.transform.zoom))return!1;const g=l.type,S=this.painter,k=this._renderableLayerIds[this._renderableLayerIds.length-1]===l.id;if(Mo[g]&&(this._prevType&&Mo[this._prevType]||this._stacks.push([]),this._prevType=g,this._stacks[this._stacks.length-1].push(l.id),!k))return!0;if(Mo[this._prevType]||Mo[g]&&k){this._prevType=g;const F=this._stacks.length-1,Z=this._stacks[F]||[];for(const u of this._renderableTiles){if(this.pool.isFull()&&(Rn(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(u),u.rtt[F]){const d=this.pool.getObjectForId(u.rtt[F].id);if(d.stamp===u.rtt[F].stamp){this.pool.useObject(d);continue}}const h=this.pool.getOrCreateFreeObject();this.pool.useObject(h),this.pool.stampObject(h),u.rtt[F]={id:h.id,stamp:h.stamp},S.context.bindFramebuffer.set(h.fbo.framebuffer),S.context.clear({color:P.aT.transparent,stencil:0}),S.currentStencilSource=void 0;for(let d=0;d<Z.length;d++){const y=S.style._layers[Z[d]],b=y.source?this._coordsDescendingInv[y.source][u.tileID.key]:[u.tileID];S.context.viewport.set([0,0,h.fbo.width,h.fbo.height]),S._renderTileClippingMasks(y,b),S.renderLayer(S,S.style.sourceCaches[y.source],y,b),y.source&&(u.rttCoords[y.source]=this._coordsDescendingInvStr[y.source][u.tileID.key])}}return Rn(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Mo[g]}return!1}}const Nt=yt,Kt={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:P.c.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},aA=z=>{z.touchstart=z.dragStart,z.touchmoveWindow=z.dragMove,z.touchend=z.dragEnd},El={showCompass:!0,showZoom:!0,visualizePitch:!1};class Ul{constructor(l,g,S=!1){this.mousedown=Z=>{this.startMouse(P.e({},Z,{ctrlKey:!0,preventDefault:()=>Z.preventDefault()}),Ee.mousePos(this.element,Z)),Ee.addEventListener(window,"mousemove",this.mousemove),Ee.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=Z=>{this.moveMouse(Z,Ee.mousePos(this.element,Z))},this.mouseup=Z=>{this.mouseRotate.dragEnd(Z),this.mousePitch&&this.mousePitch.dragEnd(Z),this.offTemp()},this.touchstart=Z=>{Z.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Ee.touchPos(this.element,Z.targetTouches)[0],this.startTouch(Z,this._startPos),Ee.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),Ee.addEventListener(window,"touchend",this.touchend))},this.touchmove=Z=>{Z.targetTouches.length!==1?this.reset():(this._lastPos=Ee.touchPos(this.element,Z.targetTouches)[0],this.moveTouch(Z,this._lastPos))},this.touchend=Z=>{Z.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const k=l.dragRotate._mouseRotate.getClickTolerance(),F=l.dragRotate._mousePitch.getClickTolerance();this.element=g,this.mouseRotate=hl({clickTolerance:k,enable:!0}),this.touchRotate=(({enable:Z,clickTolerance:u,bearingDegreesPerPixelMoved:h=.8})=>{const d=new au;return new wl({clickTolerance:u,move:(y,b)=>({bearingDelta:(b.x-y.x)*h}),moveStateManager:d,enable:Z,assignEvents:aA})})({clickTolerance:k,enable:!0}),this.map=l,S&&(this.mousePitch=Ha({clickTolerance:F,enable:!0}),this.touchPitch=(({enable:Z,clickTolerance:u,pitchDegreesPerPixelMoved:h=-.5})=>{const d=new au;return new wl({clickTolerance:u,move:(y,b)=>({pitchDelta:(b.y-y.y)*h}),moveStateManager:d,enable:Z,assignEvents:aA})})({clickTolerance:F,enable:!0})),Ee.addEventListener(g,"mousedown",this.mousedown),Ee.addEventListener(g,"touchstart",this.touchstart,{passive:!1}),Ee.addEventListener(g,"touchcancel",this.reset)}startMouse(l,g){this.mouseRotate.dragStart(l,g),this.mousePitch&&this.mousePitch.dragStart(l,g),Ee.disableDrag()}startTouch(l,g){this.touchRotate.dragStart(l,g),this.touchPitch&&this.touchPitch.dragStart(l,g),Ee.disableDrag()}moveMouse(l,g){const S=this.map,{bearingDelta:k}=this.mouseRotate.dragMove(l,g)||{};if(k&&S.setBearing(S.getBearing()+k),this.mousePitch){const{pitchDelta:F}=this.mousePitch.dragMove(l,g)||{};F&&S.setPitch(S.getPitch()+F)}}moveTouch(l,g){const S=this.map,{bearingDelta:k}=this.touchRotate.dragMove(l,g)||{};if(k&&S.setBearing(S.getBearing()+k),this.touchPitch){const{pitchDelta:F}=this.touchPitch.dragMove(l,g)||{};F&&S.setPitch(S.getPitch()+F)}}off(){const l=this.element;Ee.removeEventListener(l,"mousedown",this.mousedown),Ee.removeEventListener(l,"touchstart",this.touchstart,{passive:!1}),Ee.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),Ee.removeEventListener(window,"touchend",this.touchend),Ee.removeEventListener(l,"touchcancel",this.reset),this.offTemp()}offTemp(){Ee.enableDrag(),Ee.removeEventListener(window,"mousemove",this.mousemove),Ee.removeEventListener(window,"mouseup",this.mouseup),Ee.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),Ee.removeEventListener(window,"touchend",this.touchend)}}let $r;function pa(z,l,g){if(z=new P.L(z.lng,z.lat),l){const S=new P.L(z.lng-360,z.lat),k=new P.L(z.lng+360,z.lat),F=g.locationPoint(z).distSqr(l);g.locationPoint(S).distSqr(l)<F?z=S:g.locationPoint(k).distSqr(l)<F&&(z=k)}for(;Math.abs(z.lng-g.center.lng)>180;){const S=g.locationPoint(z);if(S.x>=0&&S.y>=0&&S.x<=g.width&&S.y<=g.height)break;z.lng>g.center.lng?z.lng-=360:z.lng+=360}return z}const Hn={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function x(z,l,g){const S=z.classList;for(const k in Hn)S.remove(`maplibregl-${g}-anchor-${k}`);S.add(`maplibregl-${g}-anchor-${l}`)}class T extends P.E{constructor(l){if(super(),this._onKeyPress=g=>{const S=g.code,k=g.charCode||g.keyCode;S!=="Space"&&S!=="Enter"&&k!==32&&k!==13||this.togglePopup()},this._onMapClick=g=>{const S=g.originalEvent.target,k=this._element;this._popup&&(S===k||k.contains(S))&&this.togglePopup()},this._update=g=>{if(!this._map)return;const S=this._map.loaded()&&!this._map.isMoving();((g==null?void 0:g.type)==="terrain"||(g==null?void 0:g.type)==="render"&&!S)&&this._map.once("render",this._update),this._map.transform.renderWorldCopies&&(this._lngLat=pa(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let k="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?k=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(k=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let F="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?F="rotateX(0deg)":this._pitchAlignment==="map"&&(F=`rotateX(${this._map.getPitch()}deg)`),g&&g.type!=="moveend"||(this._pos=this._pos.round()),Ee.setTransform(this._element,`${Hn[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${F} ${k}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const Z=this._map.unproject(this._pos),u=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=Z.distanceTo(this._lngLat)>20*u?"0.2":"1.0",this._opacityTimeout=null},100))},this._onMove=g=>{if(!this._isDragging){const S=this._clickTolerance||this._map._clickTolerance;this._isDragging=g.point.dist(this._pointerdownPos)>=S}this._isDragging&&(this._pos=g.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new P.k("dragstart"))),this.fire(new P.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new P.k("dragend")),this._state="inactive"},this._addDragHandler=g=>{this._element.contains(g.originalEvent.target)&&(g.preventDefault(),this._positionDelta=g.point.sub(this._pos).add(this._offset),this._pointerdownPos=g.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=l&&l.anchor||"center",this._color=l&&l.color||"#3FB1CE",this._scale=l&&l.scale||1,this._draggable=l&&l.draggable||!1,this._clickTolerance=l&&l.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=l&&l.rotation||0,this._rotationAlignment=l&&l.rotationAlignment||"auto",this._pitchAlignment=l&&l.pitchAlignment&&l.pitchAlignment!=="auto"?l.pitchAlignment:this._rotationAlignment,l&&l.element)this._element=l.element,this._offset=P.P.convert(l&&l.offset||[0,0]);else{this._defaultMarker=!0,this._element=Ee.create("div"),this._element.setAttribute("aria-label","Map marker");const g=Ee.createNS("http://www.w3.org/2000/svg","svg"),S=41,k=27;g.setAttributeNS(null,"display","block"),g.setAttributeNS(null,"height",`${S}px`),g.setAttributeNS(null,"width",`${k}px`),g.setAttributeNS(null,"viewBox",`0 0 ${k} ${S}`);const F=Ee.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"stroke","none"),F.setAttributeNS(null,"stroke-width","1"),F.setAttributeNS(null,"fill","none"),F.setAttributeNS(null,"fill-rule","evenodd");const Z=Ee.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"fill-rule","nonzero");const u=Ee.createNS("http://www.w3.org/2000/svg","g");u.setAttributeNS(null,"transform","translate(3.0, 29.0)"),u.setAttributeNS(null,"fill","#000000");const h=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const le of h){const de=Ee.createNS("http://www.w3.org/2000/svg","ellipse");de.setAttributeNS(null,"opacity","0.04"),de.setAttributeNS(null,"cx","10.5"),de.setAttributeNS(null,"cy","5.80029008"),de.setAttributeNS(null,"rx",le.rx),de.setAttributeNS(null,"ry",le.ry),u.appendChild(de)}const d=Ee.createNS("http://www.w3.org/2000/svg","g");d.setAttributeNS(null,"fill",this._color);const y=Ee.createNS("http://www.w3.org/2000/svg","path");y.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),d.appendChild(y);const b=Ee.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"opacity","0.25"),b.setAttributeNS(null,"fill","#000000");const I=Ee.createNS("http://www.w3.org/2000/svg","path");I.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),b.appendChild(I);const R=Ee.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"transform","translate(6.0, 7.0)"),R.setAttributeNS(null,"fill","#FFFFFF");const N=Ee.createNS("http://www.w3.org/2000/svg","g");N.setAttributeNS(null,"transform","translate(8.0, 8.0)");const W=Ee.createNS("http://www.w3.org/2000/svg","circle");W.setAttributeNS(null,"fill","#000000"),W.setAttributeNS(null,"opacity","0.25"),W.setAttributeNS(null,"cx","5.5"),W.setAttributeNS(null,"cy","5.5"),W.setAttributeNS(null,"r","5.4999962");const K=Ee.createNS("http://www.w3.org/2000/svg","circle");K.setAttributeNS(null,"fill","#FFFFFF"),K.setAttributeNS(null,"cx","5.5"),K.setAttributeNS(null,"cy","5.5"),K.setAttributeNS(null,"r","5.4999962"),N.appendChild(W),N.appendChild(K),Z.appendChild(u),Z.appendChild(d),Z.appendChild(b),Z.appendChild(R),Z.appendChild(N),g.appendChild(Z),g.setAttributeNS(null,"height",S*this._scale+"px"),g.setAttributeNS(null,"width",k*this._scale+"px"),this._element.appendChild(g),this._offset=P.P.convert(l&&l.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",g=>{g.preventDefault()}),this._element.addEventListener("mousedown",g=>{g.preventDefault()}),x(this._element,this._anchor,"marker"),l&&l.className)for(const g of l.className.split(" "))this._element.classList.add(g);this._popup=null}addTo(l){return this.remove(),this._map=l,l.getCanvasContainer().appendChild(this._element),l.on("move",this._update),l.on("moveend",this._update),l.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),Ee.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(l){return this._lngLat=P.L.convert(l),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(l){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),l){if(!("offset"in l.options)){const k=Math.abs(13.5)/Math.SQRT2;l.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[k,-1*(38.1-13.5+k)],"bottom-right":[-k,-1*(38.1-13.5+k)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=l,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const l=this._popup;return l?(l.isOpen()?l.remove():l.addTo(this._map),this):this}getOffset(){return this._offset}setOffset(l){return this._offset=P.P.convert(l),this._update(),this}addClassName(l){this._element.classList.add(l)}removeClassName(l){this._element.classList.remove(l)}toggleClassName(l){return this._element.classList.toggle(l)}setDraggable(l){return this._draggable=!!l,this._map&&(l?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(l){return this._rotation=l||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(l){return this._rotationAlignment=l||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(l){return this._pitchAlignment=l&&l!=="auto"?l:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const M={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let L=0,j=!1;const H={maxWidth:100,unit:"metric"};function Q(z,l,g){const S=g&&g.maxWidth||100,k=z._container.clientHeight/2,F=z.unproject([0,k]),Z=z.unproject([S,k]),u=F.distanceTo(Z);if(g&&g.unit==="imperial"){const h=3.2808*u;h>5280?J(l,S,h/5280,z._getUIString("ScaleControl.Miles")):J(l,S,h,z._getUIString("ScaleControl.Feet"))}else g&&g.unit==="nautical"?J(l,S,u/1852,z._getUIString("ScaleControl.NauticalMiles")):u>=1e3?J(l,S,u/1e3,z._getUIString("ScaleControl.Kilometers")):J(l,S,u,z._getUIString("ScaleControl.Meters"))}function J(z,l,g,S){const k=function(F){const Z=Math.pow(10,`${Math.floor(F)}`.length-1);let u=F/Z;return u=u>=10?10:u>=5?5:u>=3?3:u>=2?2:u>=1?1:function(h){const d=Math.pow(10,Math.ceil(-Math.log(h)/Math.LN10));return Math.round(h*d)/d}(u),Z*u}(g);z.style.width=l*(k/g)+"px",z.innerHTML=`${k}&nbsp;${S}`}const ue={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Ce=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ze(z){if(z){if(typeof z=="number"){const l=Math.round(Math.abs(z)/Math.SQRT2);return{center:new P.P(0,0),top:new P.P(0,z),"top-left":new P.P(l,l),"top-right":new P.P(-l,l),bottom:new P.P(0,-z),"bottom-left":new P.P(l,-l),"bottom-right":new P.P(-l,-l),left:new P.P(z,0),right:new P.P(-z,0)}}if(z instanceof P.P||Array.isArray(z)){const l=P.P.convert(z);return{center:l,top:l,"top-left":l,"top-right":l,bottom:l,"bottom-left":l,"bottom-right":l,left:l,right:l}}return{center:P.P.convert(z.center||[0,0]),top:P.P.convert(z.top||[0,0]),"top-left":P.P.convert(z["top-left"]||[0,0]),"top-right":P.P.convert(z["top-right"]||[0,0]),bottom:P.P.convert(z.bottom||[0,0]),"bottom-left":P.P.convert(z["bottom-left"]||[0,0]),"bottom-right":P.P.convert(z["bottom-right"]||[0,0]),left:P.P.convert(z.left||[0,0]),right:P.P.convert(z.right||[0,0])}}return ze(new P.P(0,0))}const _t={extend:(z,...l)=>P.e(z,...l),run(z){z()},logToElement(z,l=!1,g="log"){const S=window.document.getElementById(g);S&&(l&&(S.innerHTML=""),S.innerHTML+=`<br>${z}`)}},Xe=yt;class it{static get version(){return Xe}static get workerCount(){return Ht.workerCount}static set workerCount(l){Ht.workerCount=l}static get maxParallelImageRequests(){return P.c.MAX_PARALLEL_IMAGE_REQUESTS}static set maxParallelImageRequests(l){P.c.MAX_PARALLEL_IMAGE_REQUESTS=l}static get workerUrl(){return P.c.WORKER_URL}static set workerUrl(l){P.c.WORKER_URL=l}static addProtocol(l,g){P.c.REGISTERED_PROTOCOLS[l]=g}static removeProtocol(l){delete P.c.REGISTERED_PROTOCOLS[l]}}return it.Map=class extends Ds{constructor(z){if(P.bg.mark(P.bh.create),(z=P.e({},Kt,z)).minZoom!=null&&z.maxZoom!=null&&z.minZoom>z.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(z.minPitch!=null&&z.maxPitch!=null&&z.minPitch>z.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(z.minPitch!=null&&z.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(z.maxPitch!=null&&z.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new vl(z.minZoom,z.maxZoom,z.minPitch,z.maxPitch,z.renderWorldCopies),{bearingSnap:z.bearingSnap}),this._cooperativeGesturesOnWheel=l=>{this._onCooperativeGesture(l,l[this._metaKey],1)},this._contextLost=l=>{l.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new P.k("webglcontextlost",{originalEvent:l}))},this._contextRestored=l=>{this._setupPainter(),this.resize(),this._update(),this.fire(new P.k("webglcontextrestored",{originalEvent:l}))},this._onMapScroll=l=>{if(l.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=z.interactive,this._cooperativeGestures=z.cooperativeGestures,this._metaKey=navigator.platform.indexOf("Mac")===0?"metaKey":"ctrlKey",this._maxTileCacheSize=z.maxTileCacheSize,this._maxTileCacheZoomLevels=z.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=z.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=z.preserveDrawingBuffer,this._antialias=z.antialias,this._trackResize=z.trackResize,this._bearingSnap=z.bearingSnap,this._refreshExpiredTiles=z.refreshExpiredTiles,this._fadeDuration=z.fadeDuration,this._crossSourceCollisions=z.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=z.collectResourceTiming,this._renderTaskQueue=new Eo,this._controls=[],this._mapId=P.a2(),this._locale=P.e({},pr,z.locale),this._clickTolerance=z.clickTolerance,this._overridePixelRatio=z.pixelRatio,this._maxCanvasSize=z.maxCanvasSize,this.transformCameraUpdate=z.transformCameraUpdate,this._imageQueueHandle=qr.addThrottleControl(()=>this.isMoving()),this._requestManager=new Tn(z.transformRequest),typeof z.container=="string"){if(this._container=document.getElementById(z.container),!this._container)throw new Error(`Container '${z.container}' not found.`)}else{if(!(z.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=z.container}if(z.maxBounds&&this.setMaxBounds(z.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let l=!1;const g=wo(S=>{this._trackResize&&!this._removed&&this.resize(S)._update()},50);this._resizeObserver=new ResizeObserver(S=>{l?g(S):l=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Tl(this,z),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=z.hash&&new Ia(typeof z.hash=="string"&&z.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:z.center,zoom:z.zoom,bearing:z.bearing,pitch:z.pitch}),z.bounds&&(this.resize(),this.fitBounds(z.bounds,P.e({},z.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=z.localIdeographFontFamily,this._validateStyle=z.validateStyle,z.style&&this.setStyle(z.style,{localIdeographFontFamily:z.localIdeographFontFamily}),z.attributionControl&&this.addControl(new da({customAttribution:z.customAttribution})),z.maplibreLogo&&this.addControl(new Qn,z.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",l=>{this._update(l.dataType==="style"),this.fire(new P.k(`${l.dataType}data`,l))}),this.on("dataloading",l=>{this.fire(new P.k(`${l.dataType}dataloading`,l))}),this.on("dataabort",l=>{this.fire(new P.k("sourcedataabort",l))})}_getMapId(){return this._mapId}addControl(z,l){if(l===void 0&&(l=z.getDefaultPosition?z.getDefaultPosition():"top-right"),!z||!z.onAdd)return this.fire(new P.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const g=z.onAdd(this);this._controls.push(z);const S=this._controlPositions[l];return l.indexOf("bottom")!==-1?S.insertBefore(g,S.firstChild):S.appendChild(g),this}removeControl(z){if(!z||!z.onRemove)return this.fire(new P.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const l=this._controls.indexOf(z);return l>-1&&this._controls.splice(l,1),z.onRemove(this),this}hasControl(z){return this._controls.indexOf(z)>-1}calculateCameraOptionsFromTo(z,l,g,S){return S==null&&this.terrain&&(S=this.terrain.getElevationForLngLatZoom(g,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(z,l,g,S)}resize(z){var l;const g=this._containerDimensions(),S=g[0],k=g[1],F=this._getClampedPixelRatio(S,k);if(this._resizeCanvas(S,k,F),this.painter.resize(S,k,F),this.painter.overLimit()){const u=this.painter.context.gl;this._maxCanvasSize=[u.drawingBufferWidth,u.drawingBufferHeight];const h=this._getClampedPixelRatio(S,k);this._resizeCanvas(S,k,h),this.painter.resize(S,k,h)}this.transform.resize(S,k),(l=this._requestedCameraState)===null||l===void 0||l.resize(S,k);const Z=!this._moving;return Z&&(this.stop(),this.fire(new P.k("movestart",z)).fire(new P.k("move",z))),this.fire(new P.k("resize",z)),Z&&this.fire(new P.k("moveend",z)),this}_getClampedPixelRatio(z,l){const{0:g,1:S}=this._maxCanvasSize,k=this.getPixelRatio(),F=z*k,Z=l*k;return Math.min(F>g?g/F:1,Z>S?S/Z:1)*k}getPixelRatio(){var z;return(z=this._overridePixelRatio)!==null&&z!==void 0?z:devicePixelRatio}setPixelRatio(z){this._overridePixelRatio=z,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(z){return this.transform.setMaxBounds(jr.convert(z)),this._update()}setMinZoom(z){if((z=z??-2)>=-2&&z<=this.transform.maxZoom)return this.transform.minZoom=z,this._update(),this.getZoom()<z&&this.setZoom(z),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(z){if((z=z??22)>=this.transform.minZoom)return this.transform.maxZoom=z,this._update(),this.getZoom()>z&&this.setZoom(z),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(z){if((z=z??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(z>=0&&z<=this.transform.maxPitch)return this.transform.minPitch=z,this._update(),this.getPitch()<z&&this.setPitch(z),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(z){if((z=z??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(z>=this.transform.minPitch)return this.transform.maxPitch=z,this._update(),this.getPitch()>z&&this.setPitch(z),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(z){return this.transform.renderWorldCopies=z,this._update()}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(z){return this._cooperativeGestures=z,this._cooperativeGestures?this._setupCooperativeGestures():this._destroyCooperativeGestures(),this}project(z){return this.transform.locationPoint(P.L.convert(z),this.style&&this.terrain)}unproject(z){return this.transform.pointLocation(P.P.convert(z),this.terrain)}isMoving(){var z;return this._moving||((z=this.handlers)===null||z===void 0?void 0:z.isMoving())}isZooming(){var z;return this._zooming||((z=this.handlers)===null||z===void 0?void 0:z.isZooming())}isRotating(){var z;return this._rotating||((z=this.handlers)===null||z===void 0?void 0:z.isRotating())}_createDelegatedListener(z,l,g){if(z==="mouseenter"||z==="mouseover"){let S=!1;return{layer:l,listener:g,delegates:{mousemove:F=>{const Z=this.getLayer(l)?this.queryRenderedFeatures(F.point,{layers:[l]}):[];Z.length?S||(S=!0,g.call(this,new Uo(z,this,F.originalEvent,{features:Z}))):S=!1},mouseout:()=>{S=!1}}}}if(z==="mouseleave"||z==="mouseout"){let S=!1;return{layer:l,listener:g,delegates:{mousemove:Z=>{(this.getLayer(l)?this.queryRenderedFeatures(Z.point,{layers:[l]}):[]).length?S=!0:S&&(S=!1,g.call(this,new Uo(z,this,Z.originalEvent)))},mouseout:Z=>{S&&(S=!1,g.call(this,new Uo(z,this,Z.originalEvent)))}}}}{const S=k=>{const F=this.getLayer(l)?this.queryRenderedFeatures(k.point,{layers:[l]}):[];F.length&&(k.features=F,g.call(this,k),delete k.features)};return{layer:l,listener:g,delegates:{[z]:S}}}}on(z,l,g){if(g===void 0)return super.on(z,l);const S=this._createDelegatedListener(z,l,g);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[z]=this._delegatedListeners[z]||[],this._delegatedListeners[z].push(S);for(const k in S.delegates)this.on(k,S.delegates[k]);return this}once(z,l,g){if(g===void 0)return super.once(z,l);const S=this._createDelegatedListener(z,l,g);for(const k in S.delegates)this.once(k,S.delegates[k]);return this}off(z,l,g){return g===void 0?super.off(z,l):(this._delegatedListeners&&this._delegatedListeners[z]&&(S=>{const k=this._delegatedListeners[z];for(let F=0;F<k.length;F++){const Z=k[F];if(Z.layer===l&&Z.listener===g){for(const u in Z.delegates)this.off(u,Z.delegates[u]);return k.splice(F,1),this}}})(),this)}queryRenderedFeatures(z,l){if(!this.style)return[];let g;const S=z instanceof P.P||Array.isArray(z),k=S?z:[[0,0],[this.transform.width,this.transform.height]];if(l=l||(S?{}:z)||{},k instanceof P.P||typeof k[0]=="number")g=[P.P.convert(k)];else{const F=P.P.convert(k[0]),Z=P.P.convert(k[1]);g=[F,new P.P(Z.x,F.y),Z,new P.P(F.x,Z.y),F]}return this.style.queryRenderedFeatures(g,l,this.transform)}querySourceFeatures(z,l){return this.style.querySourceFeatures(z,l)}setStyle(z,l){return(l=P.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},l)).diff!==!1&&l.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&z?(this._diffStyle(z,l),this):(this._localIdeographFontFamily=l.localIdeographFontFamily,this._updateStyle(z,l))}setTransformRequest(z){return this._requestManager.setTransformRequest(z),this}_getUIString(z){const l=this._locale[z];if(l==null)throw new Error(`Missing UI string '${z}'`);return l}_updateStyle(z,l){if(l.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(z,l));const g=this.style&&l.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!z)),z?(this.style=new to(this,l||{}),this.style.setEventedParent(this,{style:this.style}),typeof z=="string"?this.style.loadURL(z,l,g):this.style.loadJSON(z,l,g),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new to(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(z,l){if(typeof z=="string"){const g=this._requestManager.transformRequest(z,dr.Style);P.f(g,(S,k)=>{S?this.fire(new P.j(S)):k&&this._updateDiff(k,l)})}else typeof z=="object"&&this._updateDiff(z,l)}_updateDiff(z,l){try{this.style.setState(z,l)&&this._update(!0)}catch(g){P.w(`Unable to perform style diff: ${g.message||g.error||g}.  Rebuilding the style from scratch.`),this._updateStyle(z,l)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():P.w("There is no style added to the map.")}addSource(z,l){return this._lazyInitEmptyStyle(),this.style.addSource(z,l),this._update(!0)}isSourceLoaded(z){const l=this.style&&this.style.sourceCaches[z];if(l!==void 0)return l.loaded();this.fire(new P.j(new Error(`There is no source with ID '${z}'`)))}setTerrain(z){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),z){const l=this.style.sourceCaches[z.source];if(!l)throw new Error(`cannot load terrain, because there exists no source with ID: ${z.source}`);for(const g in this.style._layers){const S=this.style._layers[g];S.type==="hillshade"&&S.source===z.source&&P.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Nl(this.painter,l,z),this.painter.renderToTexture=new Da(this.painter,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=g=>{g.dataType==="style"?this.terrain.sourceCache.freeRtt():g.dataType==="source"&&g.tile&&(g.sourceId!==z.source||this._elevationFreeze||(this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(g.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0;return this.fire(new P.k("terrain",{terrain:z})),this}getTerrain(){var z,l;return(l=(z=this.terrain)===null||z===void 0?void 0:z.options)!==null&&l!==void 0?l:null}areTilesLoaded(){const z=this.style&&this.style.sourceCaches;for(const l in z){const g=z[l]._tiles;for(const S in g){const k=g[S];if(k.state!=="loaded"&&k.state!=="errored")return!1}}return!0}addSourceType(z,l,g){return this._lazyInitEmptyStyle(),this.style.addSourceType(z,l,g)}removeSource(z){return this.style.removeSource(z),this._update(!0)}getSource(z){return this.style.getSource(z)}addImage(z,l,g={}){const{pixelRatio:S=1,sdf:k=!1,stretchX:F,stretchY:Z,content:u}=g;if(this._lazyInitEmptyStyle(),!(l instanceof HTMLImageElement||P.a(l))){if(l.width===void 0||l.height===void 0)return this.fire(new P.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:h,height:d,data:y}=l,b=l;return this.style.addImage(z,{data:new P.R({width:h,height:d},new Uint8Array(y)),pixelRatio:S,stretchX:F,stretchY:Z,content:u,sdf:k,version:0,userImage:b}),b.onAdd&&b.onAdd(this,z),this}}{const{width:h,height:d,data:y}=P.h.getImageData(l);this.style.addImage(z,{data:new P.R({width:h,height:d},y),pixelRatio:S,stretchX:F,stretchY:Z,content:u,sdf:k,version:0})}}updateImage(z,l){const g=this.style.getImage(z);if(!g)return this.fire(new P.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const S=l instanceof HTMLImageElement||P.a(l)?P.h.getImageData(l):l,{width:k,height:F,data:Z}=S;if(k===void 0||F===void 0)return this.fire(new P.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(k!==g.data.width||F!==g.data.height)return this.fire(new P.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const u=!(l instanceof HTMLImageElement||P.a(l));return g.data.replace(Z,u),this.style.updateImage(z,g),this}getImage(z){return this.style.getImage(z)}hasImage(z){return z?!!this.style.getImage(z):(this.fire(new P.j(new Error("Missing required image id"))),!1)}removeImage(z){this.style.removeImage(z)}loadImage(z,l){qr.getImage(this._requestManager.transformRequest(z,dr.Image),l)}listImages(){return this.style.listImages()}addLayer(z,l){return this._lazyInitEmptyStyle(),this.style.addLayer(z,l),this._update(!0)}moveLayer(z,l){return this.style.moveLayer(z,l),this._update(!0)}removeLayer(z){return this.style.removeLayer(z),this._update(!0)}getLayer(z){return this.style.getLayer(z)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(z,l,g){return this.style.setLayerZoomRange(z,l,g),this._update(!0)}setFilter(z,l,g={}){return this.style.setFilter(z,l,g),this._update(!0)}getFilter(z){return this.style.getFilter(z)}setPaintProperty(z,l,g,S={}){return this.style.setPaintProperty(z,l,g,S),this._update(!0)}getPaintProperty(z,l){return this.style.getPaintProperty(z,l)}setLayoutProperty(z,l,g,S={}){return this.style.setLayoutProperty(z,l,g,S),this._update(!0)}getLayoutProperty(z,l){return this.style.getLayoutProperty(z,l)}setGlyphs(z,l={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(z,l),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(z,l,g={}){return this._lazyInitEmptyStyle(),this.style.addSprite(z,l,g,S=>{S||this._update(!0)}),this}removeSprite(z){return this._lazyInitEmptyStyle(),this.style.removeSprite(z),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(z,l={}){return this._lazyInitEmptyStyle(),this.style.setSprite(z,l,g=>{g||this._update(!0)}),this}setLight(z,l={}){return this._lazyInitEmptyStyle(),this.style.setLight(z,l),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(z,l){return this.style.setFeatureState(z,l),this._update()}removeFeatureState(z,l){return this.style.removeFeatureState(z,l),this._update()}getFeatureState(z){return this.style.getFeatureState(z)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let z=0,l=0;return this._container&&(z=this._container.clientWidth||400,l=this._container.clientHeight||300),[z,l]}_setupContainer(){const z=this._container;z.classList.add("maplibregl-map");const l=this._canvasContainer=Ee.create("div","maplibregl-canvas-container",z);this._interactive&&l.classList.add("maplibregl-interactive"),this._canvas=Ee.create("canvas","maplibregl-canvas",l),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const g=this._containerDimensions(),S=this._getClampedPixelRatio(g[0],g[1]);this._resizeCanvas(g[0],g[1],S);const k=this._controlContainer=Ee.create("div","maplibregl-control-container",z),F=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(Z=>{F[Z]=Ee.create("div",`maplibregl-ctrl-${Z} `,k)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){this._cooperativeGesturesScreen=Ee.create("div","maplibregl-cooperative-gesture-screen",this._container);let z=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(z=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use ⌘ + scroll to zoom the map"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${z}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,this._cooperativeGesturesScreen.setAttribute("aria-hidden","true"),this._canvasContainer.addEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.add("maplibregl-cooperative-gestures")}_destroyCooperativeGestures(){Ee.remove(this._cooperativeGesturesScreen),this._canvasContainer.removeEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.remove("maplibregl-cooperative-gestures")}_resizeCanvas(z,l,g){this._canvas.width=Math.floor(g*z),this._canvas.height=Math.floor(g*l),this._canvas.style.width=`${z}px`,this._canvas.style.height=`${l}px`}_setupPainter(){const z={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let l=null;this._canvas.addEventListener("webglcontextcreationerror",S=>{l={requestedAttributes:z},S&&(l.statusMessage=S.statusMessage,l.type=S.type)},{once:!0});const g=this._canvas.getContext("webgl2",z)||this._canvas.getContext("webgl",z);if(!g){const S="Failed to initialize WebGL";throw l?(l.message=S,new Error(JSON.stringify(l))):new Error(S)}this.painter=new Sa(g,this.transform),li.testSupport(g)}_onCooperativeGesture(z,l,g){return!l&&g<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(z){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||z,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(z){return this._update(),this._renderTaskQueue.add(z)}_cancelRenderFrame(z){this._renderTaskQueue.remove(z)}_render(z){const l=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(z),this._removed)return;let g=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const k=this.transform.zoom,F=P.h.now();this.style.zoomHistory.update(k,F);const Z=new P.a8(k,{now:F,fadeDuration:l,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),u=Z.crossFadingFactor();u===1&&u===this._crossFadingFactor||(g=!0,this._crossFadingFactor=u),this.style.update(Z)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,l,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:l,showPadding:this.showPadding}),this.fire(new P.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,P.bg.mark(P.bh.load),this.fire(new P.k("load"))),this.style&&(this.style.hasTransitions()||g)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const S=this._sourcesDirty||this._styleDirty||this._placementDirty;return S||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new P.k("idle")),!this._loaded||this._fullyLoaded||S||(this._fullyLoaded=!0,P.bg.mark(P.bh.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){var z;this._hash&&this._hash.remove();for(const g of this._controls)g.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),qr.removeThrottleControl(this._imageQueueHandle),(z=this._resizeObserver)===null||z===void 0||z.disconnect();const l=this.painter.context.gl.getExtension("WEBGL_lose_context");l&&l.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),Ee.remove(this._canvasContainer),Ee.remove(this._controlContainer),this._cooperativeGestures&&this._destroyCooperativeGestures(),this._container.classList.remove("maplibregl-map"),P.bg.clearMetrics(),this._removed=!0,this.fire(new P.k("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=P.h.frame(z=>{P.bg.frame(z),this._frame=null,this._render(z)}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(z){this._showTileBoundaries!==z&&(this._showTileBoundaries=z,this._update())}get showPadding(){return!!this._showPadding}set showPadding(z){this._showPadding!==z&&(this._showPadding=z,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(z){this._showCollisionBoxes!==z&&(this._showCollisionBoxes=z,z?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(z){this._showOverdrawInspector!==z&&(this._showOverdrawInspector=z,this._update())}get repaint(){return!!this._repaint}set repaint(z){this._repaint!==z&&(this._repaint=z,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(z){this._vertices=z,this._update()}get version(){return Nt}getCameraTargetElevation(){return this.transform.elevation}},it.NavigationControl=class{constructor(z){this._updateZoomButtons=()=>{const l=this._map.getZoom(),g=l===this._map.getMaxZoom(),S=l===this._map.getMinZoom();this._zoomInButton.disabled=g,this._zoomOutButton.disabled=S,this._zoomInButton.setAttribute("aria-disabled",g.toString()),this._zoomOutButton.setAttribute("aria-disabled",S.toString())},this._rotateCompassArrow=()=>{const l=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=l},this._setButtonTitle=(l,g)=>{const S=this._map._getUIString(`NavigationControl.${g}`);l.title=S,l.setAttribute("aria-label",S)},this.options=P.e({},El,z),this._container=Ee.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",l=>l.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",l=>this._map.zoomIn({},{originalEvent:l})),Ee.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",l=>this._map.zoomOut({},{originalEvent:l})),Ee.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",l=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:l}):this._map.resetNorth({},{originalEvent:l})}),this._compassIcon=Ee.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(z){return this._map=z,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ul(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){Ee.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(z,l){const g=Ee.create("button",z,this._container);return g.type="button",g.addEventListener("click",l),g}},it.GeolocateControl=class extends P.E{constructor(z){super(),this._onSuccess=l=>{if(this._map){if(this._isOutOfMapMaxBounds(l))return this._setErrorState(),this.fire(new P.k("outofmaxbounds",l)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=l,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(l),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(l),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new P.k("geolocate",l)),this._finish()}},this._updateCamera=l=>{const g=new P.L(l.coords.longitude,l.coords.latitude),S=l.coords.accuracy,k=this._map.getBearing(),F=P.e({bearing:k},this.options.fitBoundsOptions),Z=jr.fromLngLat(g,S);this._map.fitBounds(Z,F,{geolocateSource:!0})},this._updateMarker=l=>{if(l){const g=new P.L(l.coords.longitude,l.coords.latitude);this._accuracyCircleMarker.setLngLat(g).addTo(this._map),this._userLocationDotMarker.setLngLat(g).addTo(this._map),this._accuracy=l.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=l=>{if(this._map){if(this.options.trackUserLocation)if(l.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const g=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=g,this._geolocateButton.setAttribute("aria-label",g),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(l.code===3&&j)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new P.k("error",l)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=l=>{if(this._map){if(this._container.addEventListener("contextmenu",g=>g.preventDefault()),this._geolocateButton=Ee.create("button","maplibregl-ctrl-geolocate",this._container),Ee.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",l===!1){P.w("Geolocation support is not available so the GeolocateControl will be disabled.");const g=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=g,this._geolocateButton.setAttribute("aria-label",g)}else{const g=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=g,this._geolocateButton.setAttribute("aria-label",g)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Ee.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new T({element:this._dotElement}),this._circleElement=Ee.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new T({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",g=>{g.geolocateSource||this._watchState!=="ACTIVE_LOCK"||g.originalEvent&&g.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new P.k("trackuserlocationend")))})}},this.options=P.e({},M,z)}onAdd(z){return this._map=z,this._container=Ee.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(l,g=!1){$r===void 0||g?window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(S=>{$r=S.state!=="denied",l($r)}).catch(()=>{$r=!!window.navigator.geolocation,l($r)}):($r=!!window.navigator.geolocation,l($r)):l($r)}(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),Ee.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,L=0,j=!1}_isOutOfMapMaxBounds(z){const l=this._map.getMaxBounds(),g=z.coords;return l&&(g.longitude<l.getWest()||g.longitude>l.getEast()||g.latitude<l.getSouth()||g.latitude>l.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const z=this._map.getBounds(),l=z.getSouthEast(),g=z.getNorthEast(),S=l.distanceTo(g),k=Math.ceil(this._accuracy/(S/this._map._container.clientHeight)*2);this._circleElement.style.width=`${k}px`,this._circleElement.style.height=`${k}px`}trigger(){if(!this._setup)return P.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new P.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":L--,j=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new P.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new P.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let z;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),L++,L>1?(z={maximumAge:6e5,timeout:0},j=!0):(z=this.options.positionOptions,j=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,z)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},it.AttributionControl=da,it.LogoControl=Qn,it.ScaleControl=class{constructor(z){this._onMove=()=>{Q(this._map,this._container,this.options)},this.setUnit=l=>{this.options.unit=l,Q(this._map,this._container,this.options)},this.options=P.e({},H,z)}getDefaultPosition(){return"bottom-left"}onAdd(z){return this._map=z,this._container=Ee.create("div","maplibregl-ctrl maplibregl-ctrl-scale",z.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){Ee.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},it.FullscreenControl=class extends P.E{constructor(z={}){super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,z&&z.container&&(z.container instanceof HTMLElement?this._container=z.container:P.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(z){return this._map=z,this._container||(this._container=this._map.getContainer()),this._controlContainer=Ee.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){Ee.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const z=this._fullscreenButton=Ee.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);Ee.create("span","maplibregl-ctrl-icon",z).setAttribute("aria-hidden","true"),z.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const z=this._getTitle();this._fullscreenButton.setAttribute("aria-label",z),this._fullscreenButton.title=z}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new P.k("fullscreenstart")),this._map._cooperativeGestures&&(this._prevCooperativeGestures=this._map._cooperativeGestures,this._map.setCooperativeGestures())):(this.fire(new P.k("fullscreenend")),this._prevCooperativeGestures&&(this._map.setCooperativeGestures(this._prevCooperativeGestures),delete this._prevCooperativeGestures))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},it.TerrainControl=class{constructor(z){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))},this.options=z}onAdd(z){return this._map=z,this._container=Ee.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=Ee.create("button","maplibregl-ctrl-terrain",this._container),Ee.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){Ee.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},it.Popup=class extends P.E{constructor(z){super(),this.remove=()=>(this._content&&Ee.remove(this._content),this._container&&(Ee.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new P.k("close")),this),this._onMouseUp=l=>{this._update(l.point)},this._onMouseMove=l=>{this._update(l.point)},this._onDrag=l=>{this._update(l.point)},this._update=l=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=Ee.create("div","maplibregl-popup",this._map.getContainer()),this._tip=Ee.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const Z of this.options.className.split(" "))this._container.classList.add(Z);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=pa(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!l)return;const g=this._pos=this._trackPointer&&l?l:this._map.project(this._lngLat);let S=this.options.anchor;const k=ze(this.options.offset);if(!S){const Z=this._container.offsetWidth,u=this._container.offsetHeight;let h;h=g.y+k.bottom.y<u?["top"]:g.y>this._map.transform.height-u?["bottom"]:[],g.x<Z/2?h.push("left"):g.x>this._map.transform.width-Z/2&&h.push("right"),S=h.length===0?"bottom":h.join("-")}const F=g.add(k[S]).round();Ee.setTransform(this._container,`${Hn[S]} translate(${F.x}px,${F.y}px)`),x(this._container,S,"popup")},this._onClose=()=>{this.remove()},this.options=P.e(Object.create(ue),z)}addTo(z){return this._map&&this.remove(),this._map=z,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new P.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(z){return this._lngLat=P.L.convert(z),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(z){return this.setDOMContent(document.createTextNode(z))}setHTML(z){const l=document.createDocumentFragment(),g=document.createElement("body");let S;for(g.innerHTML=z;S=g.firstChild,S;)l.appendChild(S);return this.setDOMContent(l)}getMaxWidth(){var z;return(z=this._container)===null||z===void 0?void 0:z.style.maxWidth}setMaxWidth(z){return this.options.maxWidth=z,this._update(),this}setDOMContent(z){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=Ee.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(z),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(z){this._container&&this._container.classList.add(z)}removeClassName(z){this._container&&this._container.classList.remove(z)}setOffset(z){return this.options.offset=z,this._update(),this}toggleClassName(z){if(this._container)return this._container.classList.toggle(z)}_createCloseButton(){this.options.closeButton&&(this._closeButton=Ee.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const z=this._container.querySelector(Ce);z&&z.focus()}},it.Marker=T,it.Style=to,it.LngLat=P.L,it.LngLatBounds=jr,it.Point=P.P,it.MercatorCoordinate=P.U,it.Evented=P.E,it.AJAXError=P.bi,it.config=P.c,it.CanvasSource=Yo,it.GeoJSONSource=nr,it.ImageSource=cs,it.RasterDEMTileSource=Pt,it.RasterTileSource=Zn,it.VectorTileSource=Js,it.VideoSource=aa,it.setRTLTextPlugin=P.bj,it.getRTLTextPluginStatus=P.bk,it.prewarm=function(){Yi().acquire(ti)},it.clearPrewarmedResources=function(){const z=Zi;z&&(z.isPreloaded()&&z.numActive()===1?(z.release(ti),Zi=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},_t.extend(it,{isSafari:P.ac,getPerformanceMetrics:P.bg.getPerformanceMetrics}),it});var Tt=Ke;return Tt})})(Rw);var CS=Rw.exports;const dp=Lw(CS);function xw(ye){let te;return Re=>{if(Re)for(let Te in Re){let Ke=te==null?void 0:te[Te],Ye=Re[Te];Ke!==Ye&&ye(Te,Ye,Ke)}else if(te)for(let Te in te)ye(Te,void 0,te[Te]);te=Re}}function kS(ye,...te){let Re=[ye];for(let Te of te)if(Te)Array.isArray(Te)&&Te[0]===ye?Re.push(...Te.slice(1)):Re.push(Te);else continue;if(Re.length!==1)return Re.length===2?Re[1]:Re}function DS(ye){return ye===!0?["has","point_count"]:ye===!1?["!",["has","point_count"]]:void 0}var R_=PS;function PS(ye){var te,Re,Te;if(ye){if(Array.isArray(ye)){for(te=[],Re=ye.length,Te=0;Te<Re;Te++){var Ke=ye[Te];Ke!=null&&te.push(Ke)}return te}if(typeof ye=="object"){te={};var Ye=Object.keys(ye);for(Re=Ye.length,Te=0;Te<Re;Te++){var Tt=Ye[Te],P=ye[Tt];P!=null&&(te[Tt]=P)}return te}}}function vw(ye){let te=ye[0],Re,Te,Ke=bw(ye);return{c(){Ke.c(),Re=Iu()},l(Ye){Ke.l(Ye),Re=Iu()},m(Ye,Tt){Ke.m(Ye,Tt),YA(Ye,Re,Tt),Te=!0},p(Ye,Tt){Tt[0]&1&&zA(te,te=Ye[0])?(ff(),Is(Ke,1,1,lp),df(),Ke=bw(Ye),Ke.c(),es(Ke,1),Ke.m(Re.parentNode,Re)):Ke.p(Ye,Tt)},i(Ye){Te||(es(Ke),Te=!0)},o(Ye){Is(Ke),Te=!1},d(Ye){Ye&&Kl(Re),Ke.d(Ye)}}}function bw(ye){let te;const Re=ye[36].default,Te=Ap(Re,ye,ye[35],null);return{c(){Te&&Te.c()},l(Ke){Te&&Te.l(Ke)},m(Ke,Ye){Te&&Te.m(Ke,Ye),te=!0},p(Ke,Ye){Te&&Te.p&&(!te||Ye[1]&16)&&cp(Te,Re,Ke,Ke[35],te?hp(Re,Ke[35],Ye,null):up(Ke[35]),null)},i(Ke){te||(es(Te,Ke),te=!0)},o(Ke){Is(Te,Ke),te=!1},d(Ke){Te&&Te.d(Ke)}}}function zS(ye){let te,Re,Te=ye[0]&&vw(ye);return{c(){Te&&Te.c(),te=Iu()},l(Ke){Te&&Te.l(Ke),te=Iu()},m(Ke,Ye){Te&&Te.m(Ke,Ye),YA(Ke,te,Ye),Re=!0},p(Ke,Ye){Ke[0]?Te?(Te.p(Ke,Ye),Ye[0]&1&&es(Te,1)):(Te=vw(Ke),Te.c(),es(Te,1),Te.m(te.parentNode,te)):Te&&(ff(),Is(Te,1,1,()=>{Te=null}),df())},i(Ke){Re||(es(Te),Re=!0)},o(Ke){Is(Te),Re=!1},d(Ke){Ke&&Kl(te),Te&&Te.d(Ke)}}}function BS(ye,te,Re){let Te,Ke,Ye,Tt,P,yt,Ee,li,Ot,Gt,Xr,Ti,{$$slots:cn={},$$scope:qr}=te,{id:dr=N_("layer")}=te,{source:Tn=void 0}=te,{sourceLayer:un=void 0}=te,{beforeId:_r=void 0}=te,{beforeLayerType:ps=void 0}=te,{type:En}=te,{paint:Ls=void 0}=te,{layout:pn=void 0}=te,{filter:As=void 0}=te,{applyToClusters:ct=void 0}=te,{minzoom:Lt=void 0}=te,{maxzoom:fn=void 0}=te,{manageHoverState:mn=!1}=te,{hovered:wi=null}=te,{interactive:hr=!0}=te,{hoverCursor:kn=void 0}=te,{eventsIfTopMost:Dn=!1}=te;const Rs=Pw(),{map:Ao,source:yo,self:ts,minzoom:Ai,maxzoom:jr,eventTopMost:Pn,layerInfo:Js}=SS();PA(ye,Ao,Di=>Re(31,Ot=Di)),PA(ye,yo,Di=>Re(32,Gt=Di)),PA(ye,ts,Di=>Re(0,li=Di)),PA(ye,Ai,Di=>Re(34,Ti=Di)),PA(ye,jr,Di=>Re(33,Xr=Di)),hf(()=>{li&&Ot&&(Js.delete(li),Ot==null||Ot.removeLayer(li))});let Zn;function Pt(Di){var Zt,Ue;if(!hr||!li||!Ot||Dn&&Pn(Di)!==li)return;let Ir=Di.features??[],$s=(Ue=(Zt=Ir[0])==null?void 0:Zt.properties)==null?void 0:Ue.cluster_id,Cs={event:Di,map:Ot,clusterId:$s,layer:li,source:P,features:Ir};Rs(Di.type,Cs)}function nr(Di){var Zt,Ue;if(!hr||!li||!Ot||Dn&&Pn(Di)!==li)return;kn&&(Ot.getCanvas().style.cursor=kn);let Ir=Di.features??[];Re(6,wi=Ir[0]??null);let $s=(Ue=(Zt=Ir[0])==null?void 0:Zt.properties)==null?void 0:Ue.cluster_id;Rs("mouseenter",{event:Di,map:Ot,clusterId:$s,layer:li,source:P,features:Ir})}function _n(Di){var Zt,Ue,He;if(!hr||!Ot)return;if(Dn&&Pn(Di)!==li){Re(6,wi=null),mn&&Zn!==void 0&&(Ot==null||Ot.setFeatureState({source:P,sourceLayer:un,id:Zn},{hover:!1}),Zn=void 0);return}Ot.getCanvas().style.cursor=kn;let Ir=Di.features??[],$s=(Ue=(Zt=Ir[0])==null?void 0:Zt.properties)==null?void 0:Ue.cluster_id,Cs=(He=Ir[0])==null?void 0:He.id;Cs!==Zn&&(mn&&(Zn!==void 0&&(Ot==null||Ot.setFeatureState({source:P,id:Zn,sourceLayer:un},{hover:!1})),Ot==null||Ot.setFeatureState({source:P,id:Cs,sourceLayer:un},{hover:!0})),Zn=Cs,Re(6,wi=Ir[0]??null)),Rs("mousemove",{event:Di,map:Ot,clusterId:$s,layer:li,source:P,features:Ir})}function cs(Di){if(!(!hr||!li||!Ot)){if(kn&&(Ot.getCanvas().style.cursor=""),Re(6,wi=null),mn&&Zn!==void 0){const Ir={source:P,id:Zn,sourceLayer:un};Ot==null||Ot.setFeatureState(Ir,{hover:!1}),Zn=void 0}Rs("mouseleave",{map:Ot,layer:li,source:P})}}let aa=!0;function Yo(Di){Ot&&(Ot.off("click",Di,Pt),Ot.off("dblclick",Di,Pt),Ot.off("contextmenu",Di,Pt),Ot.off("mouseenter",Di,nr),Ot.off("mousemove",Di,_n),Ot.off("mouseleave",Di,cs))}return hf(()=>{Ot&&li&&Yo(li)}),ye.$$set=Di=>{"id"in Di&&Re(7,dr=Di.id),"source"in Di&&Re(8,Tn=Di.source),"sourceLayer"in Di&&Re(9,un=Di.sourceLayer),"beforeId"in Di&&Re(10,_r=Di.beforeId),"beforeLayerType"in Di&&Re(11,ps=Di.beforeLayerType),"type"in Di&&Re(12,En=Di.type),"paint"in Di&&Re(13,Ls=Di.paint),"layout"in Di&&Re(14,pn=Di.layout),"filter"in Di&&Re(15,As=Di.filter),"applyToClusters"in Di&&Re(16,ct=Di.applyToClusters),"minzoom"in Di&&Re(17,Lt=Di.minzoom),"maxzoom"in Di&&Re(18,fn=Di.maxzoom),"manageHoverState"in Di&&Re(19,mn=Di.manageHoverState),"hovered"in Di&&Re(6,wi=Di.hovered),"interactive"in Di&&Re(20,hr=Di.interactive),"hoverCursor"in Di&&Re(21,kn=Di.hoverCursor),"eventsIfTopMost"in Di&&Re(22,Dn=Di.eventsIfTopMost),"$$scope"in Di&&Re(35,qr=Di.$$scope)},ye.$$.update=()=>{if(ye.$$.dirty[0]&65536&&Re(30,Te=DS(ct)),ye.$$.dirty[0]&1073774592&&Re(24,Ke=kS("all",Te,As)),ye.$$.dirty[0]&131072|ye.$$.dirty[1]&8&&Re(26,Ye=Lt??Ti),ye.$$.dirty[0]&262144|ye.$$.dirty[1]&4&&Re(25,Tt=fn??Xr),ye.$$.dirty[0]&256|ye.$$.dirty[1]&2&&Re(29,P=Tn||Gt),ye.$$.dirty[0]&654343809|ye.$$.dirty[1]&1&&Ot&&li!==dr&&P){li&&(Yo(li),Js.delete(li));let Di=_r;if(!_r&&ps){let Ir=Ot.getStyle().layers,$s=typeof ps=="function"?ps:Zt=>Zt.type===ps,Cs=Ir==null?void 0:Ir.find($s);Cs&&(Di=Cs.id)}vd(ts,li=dr,li),Ot.addLayer(R_({id:li,type:En,source:P,"source-layer":un,filter:Ke,paint:Ls,layout:pn,minzoom:Ye,maxzoom:Tt}),Di),Re(23,aa=!0),Ot.on("click",li,Pt),Ot.on("dblclick",li,Pt),Ot.on("contextmenu",li,Pt),Ot.on("mouseenter",li,nr),Ot.on("mousemove",li,_n),Ot.on("mouseleave",li,cs)}ye.$$.dirty[0]&1048577&&li&&Js.set(li,{interactive:hr}),ye.$$.dirty[0]&1|ye.$$.dirty[1]&1&&Re(28,yt=li?xw((Di,Ir)=>Ot==null?void 0:Ot.setPaintProperty(li,Di,Ir)):void 0),ye.$$.dirty[0]&1|ye.$$.dirty[1]&1&&Re(27,Ee=li?xw((Di,Ir)=>Ot==null?void 0:Ot.setLayoutProperty(li,Di,Ir)):void 0),ye.$$.dirty[0]&268443648&&(yt==null||yt(Ls)),ye.$$.dirty[0]&134234112&&(Ee==null||Ee(pn)),ye.$$.dirty[0]&100663297|ye.$$.dirty[1]&1&&li&&(Ot==null||Ot.setLayerZoomRange(li,Ye,Tt)),ye.$$.dirty[0]&25165825|ye.$$.dirty[1]&1&&li&&(aa?Re(23,aa=!1):Ot==null||Ot.setFilter(li,Ke))},[li,Ao,yo,ts,Ai,jr,wi,dr,Tn,un,_r,ps,En,Ls,pn,As,ct,Lt,fn,mn,hr,kn,Dn,aa,Ke,Tt,Ye,Ee,yt,P,Te,Ot,Gt,Xr,Ti,qr,cn]}class Ow extends Dc{constructor(te){super(),Pc(this,te,BS,zS,zA,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}}function LS(ye){let te;const Re=ye[15].default,Te=Ap(Re,ye,ye[23],null);return{c(){Te&&Te.c()},l(Ke){Te&&Te.l(Ke)},m(Ke,Ye){Te&&Te.m(Ke,Ye),te=!0},p(Ke,Ye){Te&&Te.p&&(!te||Ye&8388608)&&cp(Te,Re,Ke,Ke[23],te?hp(Re,Ke[23],Ye,null):up(Ke[23]),null)},i(Ke){te||(es(Te,Ke),te=!0)},o(Ke){Is(Te,Ke),te=!1},d(Ke){Te&&Te.d(Ke)}}}function RS(ye){let te,Re,Te;function Ke(Tt){ye[16](Tt)}let Ye={id:ye[1],type:"fill",source:ye[2],sourceLayer:ye[3],beforeId:ye[4],beforeLayerType:ye[5],paint:ye[6],layout:ye[7],filter:ye[8],minzoom:ye[9],maxzoom:ye[10],hoverCursor:ye[11],manageHoverState:ye[12],eventsIfTopMost:ye[13],interactive:ye[14],$$slots:{default:[LS]},$$scope:{ctx:ye}};return ye[0]!==void 0&&(Ye.hovered=ye[0]),te=new Ow({props:Ye}),z_.push(()=>L_(te,"hovered",Ke)),te.$on("click",ye[17]),te.$on("dblclick",ye[18]),te.$on("contextmenu",ye[19]),te.$on("mouseenter",ye[20]),te.$on("mousemove",ye[21]),te.$on("mouseleave",ye[22]),{c(){Mc(te.$$.fragment)},l(Tt){Sc(te.$$.fragment,Tt)},m(Tt,P){Ic(te,Tt,P),Te=!0},p(Tt,[P]){const yt={};P&2&&(yt.id=Tt[1]),P&4&&(yt.source=Tt[2]),P&8&&(yt.sourceLayer=Tt[3]),P&16&&(yt.beforeId=Tt[4]),P&32&&(yt.beforeLayerType=Tt[5]),P&64&&(yt.paint=Tt[6]),P&128&&(yt.layout=Tt[7]),P&256&&(yt.filter=Tt[8]),P&512&&(yt.minzoom=Tt[9]),P&1024&&(yt.maxzoom=Tt[10]),P&2048&&(yt.hoverCursor=Tt[11]),P&4096&&(yt.manageHoverState=Tt[12]),P&8192&&(yt.eventsIfTopMost=Tt[13]),P&16384&&(yt.interactive=Tt[14]),P&8388608&&(yt.$$scope={dirty:P,ctx:Tt}),!Re&&P&1&&(Re=!0,yt.hovered=Tt[0],B_(()=>Re=!1)),te.$set(yt)},i(Tt){Te||(es(te.$$.fragment,Tt),Te=!0)},o(Tt){Is(te.$$.fragment,Tt),Te=!1},d(Tt){Cc(te,Tt)}}}function FS(ye,te,Re){let{$$slots:Te={},$$scope:Ke}=te,{id:Ye=N_("fill")}=te,{source:Tt=void 0}=te,{sourceLayer:P=void 0}=te,{beforeId:yt=void 0}=te,{beforeLayerType:Ee=void 0}=te,{paint:li}=te,{layout:Ot=void 0}=te,{filter:Gt=void 0}=te,{minzoom:Xr=void 0}=te,{maxzoom:Ti=void 0}=te,{hoverCursor:cn=void 0}=te,{manageHoverState:qr=!1}=te,{hovered:dr=null}=te,{eventsIfTopMost:Tn=!1}=te,{interactive:un=!0}=te;function _r(Lt){dr=Lt,Re(0,dr)}function ps(Lt){Ec.call(this,ye,Lt)}function En(Lt){Ec.call(this,ye,Lt)}function Ls(Lt){Ec.call(this,ye,Lt)}function pn(Lt){Ec.call(this,ye,Lt)}function As(Lt){Ec.call(this,ye,Lt)}function ct(Lt){Ec.call(this,ye,Lt)}return ye.$$set=Lt=>{"id"in Lt&&Re(1,Ye=Lt.id),"source"in Lt&&Re(2,Tt=Lt.source),"sourceLayer"in Lt&&Re(3,P=Lt.sourceLayer),"beforeId"in Lt&&Re(4,yt=Lt.beforeId),"beforeLayerType"in Lt&&Re(5,Ee=Lt.beforeLayerType),"paint"in Lt&&Re(6,li=Lt.paint),"layout"in Lt&&Re(7,Ot=Lt.layout),"filter"in Lt&&Re(8,Gt=Lt.filter),"minzoom"in Lt&&Re(9,Xr=Lt.minzoom),"maxzoom"in Lt&&Re(10,Ti=Lt.maxzoom),"hoverCursor"in Lt&&Re(11,cn=Lt.hoverCursor),"manageHoverState"in Lt&&Re(12,qr=Lt.manageHoverState),"hovered"in Lt&&Re(0,dr=Lt.hovered),"eventsIfTopMost"in Lt&&Re(13,Tn=Lt.eventsIfTopMost),"interactive"in Lt&&Re(14,un=Lt.interactive),"$$scope"in Lt&&Re(23,Ke=Lt.$$scope)},[dr,Ye,Tt,P,yt,Ee,li,Ot,Gt,Xr,Ti,cn,qr,Tn,un,Te,_r,ps,En,Ls,pn,As,ct,Ke]}class OS extends Dc{constructor(te){super(),Pc(this,te,FS,RS,zA,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function NS(ye,te,Re){let Te;const{map:Ke}=fp();PA(ye,Ke,yt=>Re(4,Te=yt));let{position:Ye="top-left"}=te,{container:Tt=void 0}=te,P=null;return hf(()=>{Te!=null&&Te.loaded()&&P&&Te.removeControl(P)}),ye.$$set=yt=>{"position"in yt&&Re(1,Ye=yt.position),"container"in yt&&Re(2,Tt=yt.container)},ye.$$.update=()=>{if(ye.$$.dirty&30&&Te&&!P){let yt;typeof Tt=="string"?yt=document.querySelector(Tt)??void 0:yt=Tt,Re(3,P=new dp.FullscreenControl({container:yt})),Te.addControl(P,Ye)}},[Ke,Ye,Tt,P,Te]}class US extends Dc{constructor(te){super(),Pc(this,te,NS,null,zA,{position:1,container:2})}}function VS(ye,te,Re,Te,Ke){let Ye=!1;ye.getSource(te)&&(Ye=!0,ye.removeSource(te));const Tt=()=>{Te(te)&&(ye.addSource(te,Re),Ke())};if(Ye){const P=()=>{te&&(ye.getSource(te)?setTimeout(P,1):Tt())};P()}else Tt()}function jS(ye,te,Re){mS().then(()=>{let Te=_S(ye);if(!Te)return;Te.getSource(te)===Re&&Te.removeSource(te)})}function ww(ye){let te=ye[0],Re,Te,Ke=Tw(ye);return{c(){Ke.c(),Re=Iu()},l(Ye){Ke.l(Ye),Re=Iu()},m(Ye,Tt){Ke.m(Ye,Tt),YA(Ye,Re,Tt),Te=!0},p(Ye,Tt){Tt&1&&zA(te,te=Ye[0])?(ff(),Is(Ke,1,1,lp),df(),Ke=Tw(Ye),Ke.c(),es(Ke,1),Ke.m(Re.parentNode,Re)):Ke.p(Ye,Tt)},i(Ye){Te||(es(Ke),Te=!0)},o(Ye){Is(Ke),Te=!1},d(Ye){Ye&&Kl(Re),Ke.d(Ye)}}}function Tw(ye){let te;const Re=ye[15].default,Te=Ap(Re,ye,ye[14],null);return{c(){Te&&Te.c()},l(Ke){Te&&Te.l(Ke)},m(Ke,Ye){Te&&Te.m(Ke,Ye),te=!0},p(Ke,Ye){Te&&Te.p&&(!te||Ye&16384)&&cp(Te,Re,Ke,Ke[14],te?hp(Re,Ke[14],Ye,null):up(Ke[14]),null)},i(Ke){te||(es(Te,Ke),te=!0)},o(Ke){Is(Te,Ke),te=!1},d(Ke){Te&&Te.d(Ke)}}}function GS(ye){let te,Re,Te=ye[0]&&ww(ye);return{c(){Te&&Te.c(),te=Iu()},l(Ke){Te&&Te.l(Ke),te=Iu()},m(Ke,Ye){Te&&Te.m(Ke,Ye),YA(Ke,te,Ye),Re=!0},p(Ke,[Ye]){Ke[0]?Te?(Te.p(Ke,Ye),Ye&1&&es(Te,1)):(Te=ww(Ke),Te.c(),es(Te,1),Te.m(te.parentNode,te)):Te&&(ff(),Is(Te,1,1,()=>{Te=null}),df())},i(Ke){Re||(es(Te),Re=!0)},o(Ke){Is(Te),Re=!1},d(Ke){Ke&&Kl(te),Te&&Te.d(Ke)}}}function ZS(ye,te,Re){let Te,Ke,Ye,{$$slots:Tt={},$$scope:P}=te,{id:yt=N_("geojson")}=te,{data:Ee}=te,{generateId:li=!1}=te,{promoteId:Ot=void 0}=te,{filter:Gt=void 0}=te,{lineMetrics:Xr=void 0}=te,{cluster:Ti=void 0}=te;const{map:cn,cluster:qr,self:dr}=MS();PA(ye,cn,_r=>Re(13,Ke=_r)),PA(ye,qr,_r=>Re(16,Ye=_r)),PA(ye,dr,_r=>Re(0,Te=_r));let Tn,un=!0;return hf(()=>{Te&&Tn&&Ke&&(jS(cn,Te,Tn),vd(dr,Te=null,Te),Re(11,Tn=void 0))}),ye.$$set=_r=>{"id"in _r&&Re(4,yt=_r.id),"data"in _r&&Re(5,Ee=_r.data),"generateId"in _r&&Re(6,li=_r.generateId),"promoteId"in _r&&Re(7,Ot=_r.promoteId),"filter"in _r&&Re(8,Gt=_r.filter),"lineMetrics"in _r&&Re(9,Xr=_r.lineMetrics),"cluster"in _r&&Re(10,Ti=_r.cluster),"$$scope"in _r&&Re(14,P=_r.$$scope)},ye.$$.update=()=>{ye.$$.dirty&1024&&vd(qr,Ye=Ti,Ye),ye.$$.dirty&12273&&Ke&&Te!==yt&&(vd(dr,Te=yt,Te),VS(Ke,Te,R_({type:"geojson",data:Ee,filter:Gt,lineMetrics:Xr,generateId:li,promoteId:Ot,cluster:!!Ti,clusterMinPoints:Ti==null?void 0:Ti.minPoints,clusterMaxZoom:Ti==null?void 0:Ti.maxZoom,clusterRadius:Ti==null?void 0:Ti.radius,clusterProperties:Ti==null?void 0:Ti.properties}),_r=>Ke&&_r===Te,()=>{Te&&(Re(11,Tn=Ke==null?void 0:Ke.getSource(Te)),Re(12,un=!0))})),ye.$$.dirty&8208&&(Ke==null||Ke.on("style.load",()=>{Re(11,Tn=Ke==null?void 0:Ke.getSource(yt))})),ye.$$.dirty&6176&&Tn&&(un?Re(12,un=!1):Tn.setData(Ee)),ye.$$.dirty&3072&&(Tn==null||Tn.setClusterOptions(R_({cluster:!!Ti,clusterMaxZoom:Ti==null?void 0:Ti.maxZoom,clusterRadius:Ti==null?void 0:Ti.radius})))},[Te,cn,qr,dr,yt,Ee,li,Ot,Gt,Xr,Ti,Tn,un,Ke,P,Tt]}class qS extends Dc{constructor(te){super(),Pc(this,te,ZS,GS,zA,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10})}}function QS(ye,te,Re){let Te;const{map:Ke}=fp();PA(ye,Ke,Gt=>Re(8,Te=Gt));let{position:Ye="top-left"}=te,{positionOptions:Tt=void 0}=te,{fitBoundsOptions:P=void 0}=te,{trackUserLocation:yt=!1}=te,{showAccuracyCircle:Ee=!0}=te,{showUserLocation:li=!0}=te,Ot=null;return hf(()=>{Te!=null&&Te.loaded()&&Ot&&Te.removeControl(Ot)}),ye.$$set=Gt=>{"position"in Gt&&Re(1,Ye=Gt.position),"positionOptions"in Gt&&Re(2,Tt=Gt.positionOptions),"fitBoundsOptions"in Gt&&Re(3,P=Gt.fitBoundsOptions),"trackUserLocation"in Gt&&Re(4,yt=Gt.trackUserLocation),"showAccuracyCircle"in Gt&&Re(5,Ee=Gt.showAccuracyCircle),"showUserLocation"in Gt&&Re(6,li=Gt.showUserLocation)},ye.$$.update=()=>{ye.$$.dirty&510&&Te&&!Ot&&(Re(7,Ot=new dp.GeolocateControl({positionOptions:Tt,fitBoundsOptions:P,trackUserLocation:yt,showAccuracyCircle:Ee,showUserLocation:li})),Te.addControl(Ot,Ye))},[Ke,Ye,Tt,P,yt,Ee,li,Ot,Te]}class HS extends Dc{constructor(te){super(),Pc(this,te,QS,null,zA,{position:1,positionOptions:2,fitBoundsOptions:3,trackUserLocation:4,showAccuracyCircle:5,showUserLocation:6})}}function WS(ye){let te;const Re=ye[15].default,Te=Ap(Re,ye,ye[23],null);return{c(){Te&&Te.c()},l(Ke){Te&&Te.l(Ke)},m(Ke,Ye){Te&&Te.m(Ke,Ye),te=!0},p(Ke,Ye){Te&&Te.p&&(!te||Ye&8388608)&&cp(Te,Re,Ke,Ke[23],te?hp(Re,Ke[23],Ye,null):up(Ke[23]),null)},i(Ke){te||(es(Te,Ke),te=!0)},o(Ke){Is(Te,Ke),te=!1},d(Ke){Te&&Te.d(Ke)}}}function XS(ye){let te,Re,Te;function Ke(Tt){ye[16](Tt)}let Ye={id:ye[1],type:"line",source:ye[2],sourceLayer:ye[3],beforeId:ye[4],beforeLayerType:ye[5],paint:ye[6],layout:ye[7],filter:ye[8],minzoom:ye[9],maxzoom:ye[10],hoverCursor:ye[11],manageHoverState:ye[12],eventsIfTopMost:ye[13],interactive:ye[14],$$slots:{default:[WS]},$$scope:{ctx:ye}};return ye[0]!==void 0&&(Ye.hovered=ye[0]),te=new Ow({props:Ye}),z_.push(()=>L_(te,"hovered",Ke)),te.$on("click",ye[17]),te.$on("dblclick",ye[18]),te.$on("contextmenu",ye[19]),te.$on("mouseenter",ye[20]),te.$on("mousemove",ye[21]),te.$on("mouseleave",ye[22]),{c(){Mc(te.$$.fragment)},l(Tt){Sc(te.$$.fragment,Tt)},m(Tt,P){Ic(te,Tt,P),Te=!0},p(Tt,[P]){const yt={};P&2&&(yt.id=Tt[1]),P&4&&(yt.source=Tt[2]),P&8&&(yt.sourceLayer=Tt[3]),P&16&&(yt.beforeId=Tt[4]),P&32&&(yt.beforeLayerType=Tt[5]),P&64&&(yt.paint=Tt[6]),P&128&&(yt.layout=Tt[7]),P&256&&(yt.filter=Tt[8]),P&512&&(yt.minzoom=Tt[9]),P&1024&&(yt.maxzoom=Tt[10]),P&2048&&(yt.hoverCursor=Tt[11]),P&4096&&(yt.manageHoverState=Tt[12]),P&8192&&(yt.eventsIfTopMost=Tt[13]),P&16384&&(yt.interactive=Tt[14]),P&8388608&&(yt.$$scope={dirty:P,ctx:Tt}),!Re&&P&1&&(Re=!0,yt.hovered=Tt[0],B_(()=>Re=!1)),te.$set(yt)},i(Tt){Te||(es(te.$$.fragment,Tt),Te=!0)},o(Tt){Is(te.$$.fragment,Tt),Te=!1},d(Tt){Cc(te,Tt)}}}function YS(ye,te,Re){let{$$slots:Te={},$$scope:Ke}=te,{id:Ye=N_("line")}=te,{source:Tt=void 0}=te,{sourceLayer:P=void 0}=te,{beforeId:yt=void 0}=te,{beforeLayerType:Ee=void 0}=te,{paint:li}=te,{layout:Ot=void 0}=te,{filter:Gt=void 0}=te,{minzoom:Xr=void 0}=te,{maxzoom:Ti=void 0}=te,{hoverCursor:cn=void 0}=te,{manageHoverState:qr=!1}=te,{hovered:dr=null}=te,{eventsIfTopMost:Tn=!1}=te,{interactive:un=!0}=te;function _r(Lt){dr=Lt,Re(0,dr)}function ps(Lt){Ec.call(this,ye,Lt)}function En(Lt){Ec.call(this,ye,Lt)}function Ls(Lt){Ec.call(this,ye,Lt)}function pn(Lt){Ec.call(this,ye,Lt)}function As(Lt){Ec.call(this,ye,Lt)}function ct(Lt){Ec.call(this,ye,Lt)}return ye.$$set=Lt=>{"id"in Lt&&Re(1,Ye=Lt.id),"source"in Lt&&Re(2,Tt=Lt.source),"sourceLayer"in Lt&&Re(3,P=Lt.sourceLayer),"beforeId"in Lt&&Re(4,yt=Lt.beforeId),"beforeLayerType"in Lt&&Re(5,Ee=Lt.beforeLayerType),"paint"in Lt&&Re(6,li=Lt.paint),"layout"in Lt&&Re(7,Ot=Lt.layout),"filter"in Lt&&Re(8,Gt=Lt.filter),"minzoom"in Lt&&Re(9,Xr=Lt.minzoom),"maxzoom"in Lt&&Re(10,Ti=Lt.maxzoom),"hoverCursor"in Lt&&Re(11,cn=Lt.hoverCursor),"manageHoverState"in Lt&&Re(12,qr=Lt.manageHoverState),"hovered"in Lt&&Re(0,dr=Lt.hovered),"eventsIfTopMost"in Lt&&Re(13,Tn=Lt.eventsIfTopMost),"interactive"in Lt&&Re(14,un=Lt.interactive),"$$scope"in Lt&&Re(23,Ke=Lt.$$scope)},[dr,Ye,Tt,P,yt,Ee,li,Ot,Gt,Xr,Ti,cn,qr,Tn,un,Te,_r,ps,En,Ls,pn,As,ct,Ke]}class KS extends Dc{constructor(te){super(),Pc(this,te,YS,XS,zA,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function JS(ye){let te=ye.getCenter(),Re=Math.round(ye.getZoom()*100)/100,Te=Math.ceil((Re*Math.LN2+Math.log(512/360/.5))/Math.LN10),Ke=Math.pow(10,Te),Ye=Math.round(te.lat*Ke)/Ke,Tt=Math.round(te.lng*Ke)/Ke,P=`${Re}/${Ye}/${Tt}`,yt=ye.getBearing(),Ee=ye.getPitch();return(yt||Ee)&&(P+=`/${Math.round(yt*10)/10}`),Ee&&(P+=`/${Math.round(Ee)}`),`#${P}`}function $S(ye){return ye.replace("#","").split("/").map(parseFloat)}var k_=Hy;function Hy(ye,te){return ye===te||ye!==ye&&te!==te?!0:typeof ye!=typeof te||{}.toString.call(ye)!={}.toString.call(te)||ye!==Object(ye)||!ye?!1:Array.isArray(ye)?Ew(ye,te):{}.toString.call(ye)=="[object Set]"?Ew(Array.from(ye),Array.from(te)):{}.toString.call(ye)=="[object Object]"?tI(ye,te):eI(ye,te)}function eI(ye,te){return ye.toString()===te.toString()}function Ew(ye,te){var Re=ye.length;if(Re!=te.length)return!1;for(var Te=0;Te<Re;Te++)if(!Hy(ye[Te],te[Te]))return!1;return!0}function tI(ye,te){var Re=Object.keys(ye),Te=Re.length;if(Te!=Object.keys(te).length)return!1;for(var Ke=0;Ke<Te;Ke++){var Ye=Re[Ke];if(!(te.hasOwnProperty(Ye)&&Hy(ye[Ye],te[Ye])))return!1}return!0}function iI(ye,te,Re){let Te;const{map:Ke}=fp();PA(ye,Ke,li=>Re(6,Te=li));let{position:Ye="top-left"}=te,{showCompass:Tt=!0}=te,{showZoom:P=!0}=te,{visualizePitch:yt=!1}=te,Ee=null;return hf(()=>{Te!=null&&Te.loaded()&&Ee&&Te.removeControl(Ee)}),ye.$$set=li=>{"position"in li&&Re(1,Ye=li.position),"showCompass"in li&&Re(2,Tt=li.showCompass),"showZoom"in li&&Re(3,P=li.showZoom),"visualizePitch"in li&&Re(4,yt=li.visualizePitch)},ye.$$.update=()=>{ye.$$.dirty&126&&Te&&!Ee&&(Re(5,Ee=new dp.NavigationControl({showCompass:Tt,showZoom:P,visualizePitch:yt})),Te.addControl(Ee,Ye))},[Ke,Ye,Tt,P,yt,Ee,Te]}class rI extends Dc{constructor(te){super(),Pc(this,te,iI,null,zA,{position:1,showCompass:2,showZoom:3,visualizePitch:4})}}function nI(ye,te,Re){let Te;const{map:Ke}=fp();PA(ye,Ke,Ee=>Re(5,Te=Ee));let{position:Ye="bottom-left"}=te,{maxWidth:Tt=void 0}=te,{unit:P="metric"}=te,yt=null;return hf(()=>{Te!=null&&Te.loaded()&&yt&&Te.removeControl(yt)}),ye.$$set=Ee=>{"position"in Ee&&Re(1,Ye=Ee.position),"maxWidth"in Ee&&Re(2,Tt=Ee.maxWidth),"unit"in Ee&&Re(3,P=Ee.unit)},ye.$$.update=()=>{ye.$$.dirty&62&&Te&&!yt&&(Re(4,yt=new dp.ScaleControl({maxWidth:Tt,unit:P})),Te.addControl(yt,Ye))},[Ke,Ye,Tt,P,yt,Te]}class sI extends Dc{constructor(te){super(),Pc(this,te,nI,null,zA,{position:1,maxWidth:2,unit:3})}}const oI=ye=>({map:ye[0]&8,loadedImages:ye[0]&16,allImagesLoaded:ye[0]&32}),Mw=ye=>({map:ye[3],loadedImages:ye[4],allImagesLoaded:ye[5]});function Sw(ye){let te,Re,Te=ye[2]&&Iw(ye);const Ke=ye[34].default,Ye=Ap(Ke,ye,ye[33],Mw);return{c(){Te&&Te.c(),te=bd(),Ye&&Ye.c()},l(Tt){Te&&Te.l(Tt),te=wd(Tt),Ye&&Ye.l(Tt)},m(Tt,P){Te&&Te.m(Tt,P),YA(Tt,te,P),Ye&&Ye.m(Tt,P),Re=!0},p(Tt,P){Tt[2]?Te?(Te.p(Tt,P),P[0]&4&&es(Te,1)):(Te=Iw(Tt),Te.c(),es(Te,1),Te.m(te.parentNode,te)):Te&&(ff(),Is(Te,1,1,()=>{Te=null}),df()),Ye&&Ye.p&&(!Re||P[0]&56|P[1]&4)&&cp(Ye,Ke,Tt,Tt[33],Re?hp(Ke,Tt[33],P,oI):up(Tt[33]),Mw)},i(Tt){Re||(es(Te),es(Ye,Tt),Re=!0)},o(Tt){Is(Te),Is(Ye,Tt),Re=!1},d(Tt){Tt&&Kl(te),Te&&Te.d(Tt),Ye&&Ye.d(Tt)}}}function Iw(ye){let te,Re,Te,Ke,Ye,Tt,P,yt;return te=new rI({props:{position:ye[6]}}),Te=new HS({props:{position:ye[6],fitBoundsOptions:{maxZoom:12}}}),Ye=new US({props:{position:ye[6]}}),P=new sI({props:{position:ye[6]}}),{c(){Mc(te.$$.fragment),Re=bd(),Mc(Te.$$.fragment),Ke=bd(),Mc(Ye.$$.fragment),Tt=bd(),Mc(P.$$.fragment)},l(Ee){Sc(te.$$.fragment,Ee),Re=wd(Ee),Sc(Te.$$.fragment,Ee),Ke=wd(Ee),Sc(Ye.$$.fragment,Ee),Tt=wd(Ee),Sc(P.$$.fragment,Ee)},m(Ee,li){Ic(te,Ee,li),YA(Ee,Re,li),Ic(Te,Ee,li),YA(Ee,Ke,li),Ic(Ye,Ee,li),YA(Ee,Tt,li),Ic(P,Ee,li),yt=!0},p(Ee,li){const Ot={};li[0]&64&&(Ot.position=Ee[6]),te.$set(Ot);const Gt={};li[0]&64&&(Gt.position=Ee[6]),Te.$set(Gt);const Xr={};li[0]&64&&(Xr.position=Ee[6]),Ye.$set(Xr);const Ti={};li[0]&64&&(Ti.position=Ee[6]),P.$set(Ti)},i(Ee){yt||(es(te.$$.fragment,Ee),es(Te.$$.fragment,Ee),es(Ye.$$.fragment,Ee),es(P.$$.fragment,Ee),yt=!0)},o(Ee){Is(te.$$.fragment,Ee),Is(Te.$$.fragment,Ee),Is(Ye.$$.fragment,Ee),Is(P.$$.fragment,Ee),yt=!1},d(Ee){Ee&&(Kl(Re),Kl(Ke),Kl(Tt)),Cc(te,Ee),Cc(Te,Ee),Cc(Ye,Ee),Cc(P,Ee)}}}function aI(ye){let te,Re,Te,Ke,Ye,Tt=ye[3]&&ye[0]&&Sw(ye);return{c(){te=Vy("div"),Tt&&Tt.c(),this.h()},l(P){te=jy(P,"DIV",{class:!0});var yt=Gy(te);Tt&&Tt.l(yt),yt.forEach(Kl),this.h()},h(){Zy(te,"class",Re=qy(ye[1])+" svelte-p00lfq"),gw(te,"expand-map",!ye[1])},m(P,yt){YA(P,te,yt),Tt&&Tt.m(te,null),Te=!0,Ke||(Ye=gS(ye[9].call(null,te)),Ke=!0)},p(P,yt){P[3]&&P[0]?Tt?(Tt.p(P,yt),yt[0]&9&&es(Tt,1)):(Tt=Sw(P),Tt.c(),es(Tt,1),Tt.m(te,null)):Tt&&(ff(),Is(Tt,1,1,()=>{Tt=null}),df()),(!Te||yt[0]&2&&Re!==(Re=qy(P[1])+" svelte-p00lfq"))&&Zy(te,"class",Re),(!Te||yt[0]&2)&&gw(te,"expand-map",!P[1])},i(P){Te||(es(Tt),Te=!0)},o(P){Is(Tt),Te=!1},d(P){P&&Kl(te),Tt&&Tt.d(),Ke=!1,Ye()}}}function lI(ye,te,Re){let Te,Ke,Ye,Tt,{$$slots:P={},$$scope:yt}=te,{map:Ee=null}=te,{class:li=void 0}=te,{style:Ot}=te,{diffStyleUpdates:Gt=!1}=te,{center:Xr=void 0}=te,{zoom:Ti=void 0}=te,{pitch:cn=0}=te,{bearing:qr=0}=te,{bounds:dr=void 0}=te,{hash:Tn=!1}=te,{loaded:un=!1}=te,{minZoom:_r=0}=te,{maxZoom:ps=22}=te,{zoomOnDoubleClick:En=!0}=te,{interactive:Ls=!0}=te,{attributionControl:pn=!0}=te,{cooperativeGestures:As=!1}=te,{preserveDrawingBuffer:ct=!1}=te,{maxBounds:Lt=void 0}=te,{images:fn=[]}=te,{standardControls:mn=!1}=te,{filterLayers:wi=void 0}=te,{transformRequest:hr=void 0}=te;const kn=Pw(),{map:Dn,loadedImages:Rs}=ES();PA(ye,Dn,Pt=>Re(3,Ye=Pt)),PA(ye,Rs,Pt=>Re(4,Tt=Pt));let Ao=new Set;function yo(Pt){Ye!=null&&Ye.loaded()&&("url"in Pt?(Ao.add(Pt.id),Ye.loadImage(Pt.url,(nr,_n)=>{Ao.delete(Pt.id),nr?kn("error",nr):_n&&(Ye==null||Ye.addImage(Pt.id,_n,Pt.options),Tt.add(Pt.id),Rs.set(Tt))})):(Ye.addImage(Pt.id,Pt.data,Pt.options),Tt.add(Pt.id),Rs.set(Tt)))}let ts,Ai,jr,Pn;function Js(Pt){if(Tn){let nr=$S(window.location.hash);nr.length>=3&&(Re(11,Ti=nr[0]),Re(10,Xr=[nr[2],nr[1]])),nr.length==5&&(Re(15,qr=nr[3]),Re(14,cn=nr[4]))}return vd(Dn,Ye=new dp.Map(R_({container:Pt,style:Ot,center:Xr,zoom:Ti,pitch:cn,bearing:qr,minZoom:_r,maxZoom:ps,interactive:Ls,preserveDrawingBuffer:ct,maxBounds:Lt,bounds:dr,attributionControl:pn,transformRequest:hr,cooperativeGestures:As})),Ye),Ye.on("load",nr=>{Re(0,un=!0),kn("load",Ye)}),Ye.on("error",nr=>kn("error",{...nr,map:Ye})),Ye.on("movestart",nr=>kn("movestart",{...nr,map:Ye})),Ye.on("moveend",nr=>{if(Re(10,Xr=nr.target.getCenter()),Re(11,Ti=nr.target.getZoom()),Re(12,dr=nr.target.getBounds()),kn("moveend",{...nr,map:Ye}),Tn){let _n=window.location.href.replace(/(#.+)?$/,JS(Ye));window.history.replaceState(window.history.state,"",_n)}}),Ye.on("zoomstart",nr=>kn("zoomstart",{...nr,map:Ye})),Ye.on("zoom",nr=>{Re(11,Ti=nr.target.getZoom()),kn("zoom",{...nr,map:Ye})}),Ye.on("zoomend",nr=>{Re(11,Ti=nr.target.getZoom()),kn("zoomend",{...nr,map:Ye})}),Ye.on("style.load",()=>{if(Ye){const nr=Ye.getStyle();if(Re(30,ts=nr.layers.map(_n=>_n.id)),Re(31,Ai=Object.keys(nr.sources)),Pn)for(const[_n,cs]of Object.entries(Pn))Ye.addSource(_n,cs);if(jr)for(const _n of jr)Ye.addLayer(_n)}}),Ye.on("styledata",nr=>{if(Ye&&wi){const _n=Ye.getStyle().layers;if(_n)for(let cs of _n)wi(cs)||Ye.setLayoutProperty(cs.id,"visibility","none")}kn("styledata",{...nr,map:Ye})}),{destroy(){Re(0,un=!1),Ye==null||Ye.remove(),vd(Dn,Ye=null,Ye)}}}let Zn=Ot;return ye.$$set=Pt=>{"map"in Pt&&Re(13,Ee=Pt.map),"class"in Pt&&Re(1,li=Pt.class),"style"in Pt&&Re(16,Ot=Pt.style),"diffStyleUpdates"in Pt&&Re(17,Gt=Pt.diffStyleUpdates),"center"in Pt&&Re(10,Xr=Pt.center),"zoom"in Pt&&Re(11,Ti=Pt.zoom),"pitch"in Pt&&Re(14,cn=Pt.pitch),"bearing"in Pt&&Re(15,qr=Pt.bearing),"bounds"in Pt&&Re(12,dr=Pt.bounds),"hash"in Pt&&Re(18,Tn=Pt.hash),"loaded"in Pt&&Re(0,un=Pt.loaded),"minZoom"in Pt&&Re(19,_r=Pt.minZoom),"maxZoom"in Pt&&Re(20,ps=Pt.maxZoom),"zoomOnDoubleClick"in Pt&&Re(21,En=Pt.zoomOnDoubleClick),"interactive"in Pt&&Re(22,Ls=Pt.interactive),"attributionControl"in Pt&&Re(23,pn=Pt.attributionControl),"cooperativeGestures"in Pt&&Re(24,As=Pt.cooperativeGestures),"preserveDrawingBuffer"in Pt&&Re(25,ct=Pt.preserveDrawingBuffer),"maxBounds"in Pt&&Re(26,Lt=Pt.maxBounds),"images"in Pt&&Re(27,fn=Pt.images),"standardControls"in Pt&&Re(2,mn=Pt.standardControls),"filterLayers"in Pt&&Re(28,wi=Pt.filterLayers),"transformRequest"in Pt&&Re(29,hr=Pt.transformRequest),"$$scope"in Pt&&Re(33,yt=Pt.$$scope)},ye.$$.update=()=>{if(ye.$$.dirty[0]&4&&Re(6,Te=typeof mn=="boolean"?void 0:mn),ye.$$.dirty[0]&8&&Re(13,Ee=Ye),ye.$$.dirty[0]&134217737&&un&&Ye!=null&&Ye.loaded())for(let Pt of fn)!Ao.has(Pt.id)&&!Ye.hasImage(Pt.id)&&yo(Pt);if(ye.$$.dirty[0]&134217744&&Re(5,Ke=fn.every(Pt=>Tt.has(Pt.id))),ye.$$.dirty[0]&1073938440|ye.$$.dirty[1]&3&&Ye&&!k_(Ot,Zn)){const Pt=Ye.getStyle();if(ts&&(jr=Pt.layers.filter(nr=>!ts.includes(nr.id))),Ai){const nr=Object.keys(Pt.sources).filter(_n=>!Ai.includes(_n));Pn={};for(const _n of nr)Pn[_n]=Pt.sources[_n]}Re(32,Zn=Ot),Ye.setStyle(Ot,{diff:Gt})}ye.$$.dirty[0]&1032&&Xr&&!k_(Xr,Ye==null?void 0:Ye.getCenter())&&(Ye==null||Ye.panTo(Xr)),ye.$$.dirty[0]&2056&&Ti&&!k_(Ti,Ye==null?void 0:Ye.getZoom())&&(Ye==null||Ye.zoomTo(Ti)),ye.$$.dirty[0]&4104&&dr&&!k_(dr,Ye==null?void 0:Ye.getBounds())&&(Ye==null||Ye.fitBounds(dr)),ye.$$.dirty[0]&2097160&&(En?Ye==null||Ye.doubleClickZoom.enable():Ye==null||Ye.doubleClickZoom.disable())},[un,li,mn,Ye,Tt,Ke,Te,Dn,Rs,Js,Xr,Ti,dr,Ee,cn,qr,Ot,Gt,Tn,_r,ps,En,Ls,pn,As,ct,Lt,fn,wi,hr,ts,Ai,Zn,yt,P]}class AI extends Dc{constructor(te){super(),Pc(this,te,lI,aI,zA,{map:13,class:1,style:16,diffStyleUpdates:17,center:10,zoom:11,pitch:14,bearing:15,bounds:12,hash:18,loaded:0,minZoom:19,maxZoom:20,zoomOnDoubleClick:21,interactive:22,attributionControl:23,cooperativeGestures:24,preserveDrawingBuffer:25,maxBounds:26,images:27,standardControls:2,filterLayers:28,transformRequest:29},null,[-1,-1])}}var pp=Uint8Array,Nw=Uint16Array,cI=Int32Array,uI=new pp([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),hI=new pp([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Uw=function(ye,te){for(var Re=new Nw(31),Te=0;Te<31;++Te)Re[Te]=te+=1<<ye[Te-1];for(var Ke=new cI(Re[30]),Te=1;Te<30;++Te)for(var Ye=Re[Te];Ye<Re[Te+1];++Ye)Ke[Ye]=Ye-Re[Te]<<5|Te;return{b:Re,r:Ke}},Vw=Uw(uI,2),fI=Vw.b,dI=Vw.r;fI[28]=258,dI[258]=28;Uw(hI,0);var pI=new Nw(32768);for(Ss=0;Ss<32768;++Ss)Hu=(Ss&43690)>>1|(Ss&21845)<<1,Hu=(Hu&52428)>>2|(Hu&13107)<<2,Hu=(Hu&61680)>>4|(Hu&3855)<<4,pI[Ss]=((Hu&65280)>>8|(Hu&255)<<8)>>1;var Hu,Ss,U_=new pp(288);for(Ss=0;Ss<144;++Ss)U_[Ss]=8;var Ss;for(Ss=144;Ss<256;++Ss)U_[Ss]=9;var Ss;for(Ss=256;Ss<280;++Ss)U_[Ss]=7;var Ss;for(Ss=280;Ss<288;++Ss)U_[Ss]=8;var Ss,mI=new pp(32);for(Ss=0;Ss<32;++Ss)mI[Ss]=5;var Ss,_I=new pp(0),gI=typeof TextDecoder<"u"&&new TextDecoder,yI=0;try{gI.decode(_I,{stream:!0}),yI=1}catch{}var V_={exports:{}},xI=bI,vI={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"};function bI(ye){if(!ye||!ye.type)return null;var te=vI[ye.type];if(!te)return null;if(te==="geometry")return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:ye}]};if(te==="feature")return{type:"FeatureCollection",features:[ye]};if(te==="featurecollection")return ye}function D_(ye){switch(ye&&ye.type||null){case"FeatureCollection":return ye.features=ye.features.reduce(function(te,Re){return te.concat(D_(Re))},[]),ye;case"Feature":return ye.geometry?D_(ye.geometry).map(function(te){var Re={type:"Feature",properties:JSON.parse(JSON.stringify(ye.properties)),geometry:te};return ye.id!==void 0&&(Re.id=ye.id),Re}):[ye];case"MultiPoint":return ye.coordinates.map(function(te){return{type:"Point",coordinates:te}});case"MultiPolygon":return ye.coordinates.map(function(te){return{type:"Polygon",coordinates:te}});case"MultiLineString":return ye.coordinates.map(function(te){return{type:"LineString",coordinates:te}});case"GeometryCollection":return ye.geometries.map(D_).reduce(function(te,Re){return te.concat(Re)},[]);case"Point":case"Polygon":case"LineString":return[ye]}}const wI=Object.freeze(Object.defineProperty({__proto__:null,default:D_},Symbol.toStringTag,{value:"Module"})),TI=IS(wI);var EI=function(te){return Re(te);function Re(Te){return Array.isArray(Te)&&Te.length&&typeof Te[0]=="number"?[Te]:Te.reduce(function(Ke,Ye){return Array.isArray(Ye)&&Array.isArray(Ye[0])?Ke.concat(Re(Ye)):(Ke.push(Ye),Ke)},[])}},MI=xI,P_=TI,SI=EI;P_ instanceof Function||(P_=P_.default);var II=function(ye){if(!ye)return[];var te=P_(MI(ye)),Re=[];return te.features.forEach(function(Te){Te.geometry&&(Re=Re.concat(SI(Te.geometry.coordinates)))}),Re};function Td(ye){return Object.prototype.toString.call(ye)}function CI(ye){return Td(ye)==="[object Date]"}function kI(ye){return Td(ye)==="[object RegExp]"}function DI(ye){return Td(ye)==="[object Error]"}function PI(ye){return Td(ye)==="[object Boolean]"}function zI(ye){return Td(ye)==="[object Number]"}function BI(ye){return Td(ye)==="[object String]"}var jw=Array.isArray||function(te){return Object.prototype.toString.call(te)==="[object Array]"};function j_(ye,te){if(ye.forEach)return ye.forEach(te);for(var Re=0;Re<ye.length;Re++)te(ye[Re],Re,ye)}var LI=Object.keys||function(te){var Re=[];for(var Te in te)Re.push(Te);return Re},RI=Object.prototype.propertyIsEnumerable,Cw=Object.getOwnPropertySymbols;function G_(ye){var te=LI(ye);if(Cw)for(var Re=Cw(ye),Te=0;Te<Re.length;Te++)RI.call(ye,Re[Te])&&te.push(Re[Te]);return te}var Z_=Object.prototype.hasOwnProperty||function(ye,te){return te in ye};function Gw(ye){if(typeof ye=="object"&&ye!==null){var te;if(jw(ye))te=[];else if(CI(ye))te=new Date(ye.getTime?ye.getTime():ye);else if(kI(ye))te=new RegExp(ye);else if(DI(ye))te={message:ye.message};else if(PI(ye)||zI(ye)||BI(ye))te=Object(ye);else if(Object.create&&Object.getPrototypeOf)te=Object.create(Object.getPrototypeOf(ye));else if(ye.constructor===Object)te={};else{var Re=ye.constructor&&ye.constructor.prototype||ye.__proto__||{},Te=function(){};Te.prototype=Re,te=new Te}return j_(G_(ye),function(Ke){te[Ke]=ye[Ke]}),te}return ye}function Zw(ye,te,Re){var Te=[],Ke=[],Ye=!0;return function Tt(P){var yt=Re?Gw(P):P,Ee={},li=!0,Ot={node:yt,node_:P,path:[].concat(Te),parent:Ke[Ke.length-1],parents:Ke,key:Te[Te.length-1],isRoot:Te.length===0,level:Te.length,circular:null,update:function(Ti,cn){Ot.isRoot||(Ot.parent.node[Ot.key]=Ti),Ot.node=Ti,cn&&(li=!1)},delete:function(Ti){delete Ot.parent.node[Ot.key],Ti&&(li=!1)},remove:function(Ti){jw(Ot.parent.node)?Ot.parent.node.splice(Ot.key,1):delete Ot.parent.node[Ot.key],Ti&&(li=!1)},keys:null,before:function(Ti){Ee.before=Ti},after:function(Ti){Ee.after=Ti},pre:function(Ti){Ee.pre=Ti},post:function(Ti){Ee.post=Ti},stop:function(){Ye=!1},block:function(){li=!1}};if(!Ye)return Ot;function Gt(){if(typeof Ot.node=="object"&&Ot.node!==null){(!Ot.keys||Ot.node_!==Ot.node)&&(Ot.keys=G_(Ot.node)),Ot.isLeaf=Ot.keys.length===0;for(var Ti=0;Ti<Ke.length;Ti++)if(Ke[Ti].node_===P){Ot.circular=Ke[Ti];break}}else Ot.isLeaf=!0,Ot.keys=null;Ot.notLeaf=!Ot.isLeaf,Ot.notRoot=!Ot.isRoot}Gt();var Xr=te.call(Ot,Ot.node);return Xr!==void 0&&Ot.update&&Ot.update(Xr),Ee.before&&Ee.before.call(Ot,Ot.node),li&&(typeof Ot.node=="object"&&Ot.node!==null&&!Ot.circular&&(Ke.push(Ot),Gt(),j_(Ot.keys,function(Ti,cn){Te.push(Ti),Ee.pre&&Ee.pre.call(Ot,Ot.node[Ti],Ti);var qr=Tt(Ot.node[Ti]);Re&&Z_.call(Ot.node,Ti)&&(Ot.node[Ti]=qr.node),qr.isLast=cn===Ot.keys.length-1,qr.isFirst=cn===0,Ee.post&&Ee.post.call(Ot,qr),Te.pop()}),Ke.pop()),Ee.after&&Ee.after.call(Ot,Ot.node)),Ot}(ye).node}function kc(ye){this.value=ye}kc.prototype.get=function(ye){for(var te=this.value,Re=0;Re<ye.length;Re++){var Te=ye[Re];if(!te||!Z_.call(te,Te))return;te=te[Te]}return te};kc.prototype.has=function(ye){for(var te=this.value,Re=0;Re<ye.length;Re++){var Te=ye[Re];if(!te||!Z_.call(te,Te))return!1;te=te[Te]}return!0};kc.prototype.set=function(ye,te){for(var Re=this.value,Te=0;Te<ye.length-1;Te++){var Ke=ye[Te];Z_.call(Re,Ke)||(Re[Ke]={}),Re=Re[Ke]}return Re[ye[Te]]=te,te};kc.prototype.map=function(ye){return Zw(this.value,ye,!0)};kc.prototype.forEach=function(ye){return this.value=Zw(this.value,ye,!1),this.value};kc.prototype.reduce=function(ye,te){var Re=arguments.length===1,Te=Re?this.value:te;return this.forEach(function(Ke){(!this.isRoot||!Re)&&(Te=ye.call(this,Te,Ke))}),Te};kc.prototype.paths=function(){var ye=[];return this.forEach(function(){ye.push(this.path)}),ye};kc.prototype.nodes=function(){var ye=[];return this.forEach(function(){ye.push(this.node)}),ye};kc.prototype.clone=function(){var ye=[],te=[];return function Re(Te){for(var Ke=0;Ke<ye.length;Ke++)if(ye[Ke]===Te)return te[Ke];if(typeof Te=="object"&&Te!==null){var Ye=Gw(Te);return ye.push(Te),te.push(Ye),j_(G_(Te),function(Tt){Ye[Tt]=Re(Te[Tt])}),ye.pop(),te.pop(),Ye}return Te}(this.value)};function qw(ye){return new kc(ye)}j_(G_(kc.prototype),function(ye){qw[ye]=function(te){var Re=[].slice.call(arguments,1),Te=new kc(te);return Te[ye].apply(Te,Re)}});var FI=qw,OI=hA;function hA(ye){if(!(this instanceof hA))return new hA(ye);this._bbox=ye||[1/0,1/0,-1/0,-1/0],this._valid=!!ye}hA.prototype.include=function(ye){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],ye[0]),this._bbox[1]=Math.min(this._bbox[1],ye[1]),this._bbox[2]=Math.max(this._bbox[2],ye[0]),this._bbox[3]=Math.max(this._bbox[3],ye[1]),this};hA.prototype.equals=function(ye){var te;return ye instanceof hA?te=ye.bbox():te=ye,this._bbox[0]==te[0]&&this._bbox[1]==te[1]&&this._bbox[2]==te[2]&&this._bbox[3]==te[3]};hA.prototype.center=function(ye){return this._valid?[(this._bbox[0]+this._bbox[2])/2,(this._bbox[1]+this._bbox[3])/2]:null};hA.prototype.union=function(ye){this._valid=!0;var te;return ye instanceof hA?te=ye.bbox():te=ye,this._bbox[0]=Math.min(this._bbox[0],te[0]),this._bbox[1]=Math.min(this._bbox[1],te[1]),this._bbox[2]=Math.max(this._bbox[2],te[2]),this._bbox[3]=Math.max(this._bbox[3],te[3]),this};hA.prototype.bbox=function(){return this._valid?this._bbox:null};hA.prototype.contains=function(ye){if(!ye)return this._fastContains();if(!this._valid)return null;var te=ye[0],Re=ye[1];return this._bbox[0]<=te&&this._bbox[1]<=Re&&this._bbox[2]>=te&&this._bbox[3]>=Re};hA.prototype.intersect=function(ye){if(!this._valid)return null;var te;return ye instanceof hA?te=ye.bbox():te=ye,!(this._bbox[0]>te[2]||this._bbox[2]<te[0]||this._bbox[3]<te[1]||this._bbox[1]>te[3])};hA.prototype._fastContains=function(){if(!this._valid)return new Function("return null;");var ye="return "+this._bbox[0]+"<= ll[0] &&"+this._bbox[1]+"<= ll[1] &&"+this._bbox[2]+">= ll[0] &&"+this._bbox[3]+">= ll[1]";return new Function("ll",ye)};hA.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null};var NI=II,UI=FI,VI=OI,Qw={features:["FeatureCollection"],coordinates:["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],geometry:["Feature"],geometries:["GeometryCollection"]},jI=Object.keys(Qw);V_.exports=function(ye){return Wy(ye).bbox()};V_.exports.polygon=function(ye){return Wy(ye).polygon()};V_.exports.bboxify=function(ye){return UI(ye).map(function(te){if(te){var Re=jI.some(function(Te){return te[Te]?Qw[Te].indexOf(te.type)!==-1:!1});Re&&(te.bbox=Wy(te).bbox(),this.update(te))}})};function Wy(ye){for(var te=VI(),Re=NI(ye),Te=0;Te<Re.length;Te++)te.include(Re[Te]);return te}var GI=V_.exports;const ZI=Lw(GI);function kw(ye){let te,Re;return te=new qS({props:{id:"hexagons",data:ye[2],$$slots:{default:[qI]},$$scope:{ctx:ye}}}),{c(){Mc(te.$$.fragment)},l(Te){Sc(te.$$.fragment,Te)},m(Te,Ke){Ic(te,Te,Ke),Re=!0},p(Te,Ke){const Ye={};Ke&4&&(Ye.data=Te[2]),Ke&128&&(Ye.$$scope={dirty:Ke,ctx:Te}),te.$set(Ye)},i(Te){Re||(es(te.$$.fragment,Te),Re=!0)},o(Te){Is(te.$$.fragment,Te),Re=!1},d(Te){Cc(te,Te)}}}function qI(ye){let te,Re,Te,Ke;return te=new OS({props:{id:"hex-fill",paint:{"fill-color":"#00ffff","fill-opacity":.5},beforeLayerType:"symbol",manageHoverState:!0}}),Te=new KS({props:{layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#0000ff","line-width":1},beforeLayerType:"symbol"}}),{c(){Mc(te.$$.fragment),Re=bd(),Mc(Te.$$.fragment)},l(Ye){Sc(te.$$.fragment,Ye),Re=wd(Ye),Sc(Te.$$.fragment,Ye)},m(Ye,Tt){Ic(te,Ye,Tt),YA(Ye,Re,Tt),Ic(Te,Ye,Tt),Ke=!0},p:lp,i(Ye){Ke||(es(te.$$.fragment,Ye),es(Te.$$.fragment,Ye),Ke=!0)},o(Ye){Is(te.$$.fragment,Ye),Is(Te.$$.fragment,Ye),Ke=!1},d(Ye){Ye&&Kl(Re),Cc(te,Ye),Cc(Te,Ye)}}}function QI(ye){let te,Re,Te=ye[2]&&kw(ye);return{c(){Te&&Te.c(),te=Iu()},l(Ke){Te&&Te.l(Ke),te=Iu()},m(Ke,Ye){Te&&Te.m(Ke,Ye),YA(Ke,te,Ye),Re=!0},p(Ke,Ye){Ke[2]?Te?(Te.p(Ke,Ye),Ye&4&&es(Te,1)):(Te=kw(Ke),Te.c(),es(Te,1),Te.m(te.parentNode,te)):Te&&(ff(),Is(Te,1,1,()=>{Te=null}),df())},i(Ke){Re||(es(Te),Re=!0)},o(Ke){Is(Te),Re=!1},d(Ke){Ke&&Kl(te),Te&&Te.d(Ke)}}}function HI(ye){let te,Re,Te,Ke;function Ye(yt){ye[3](yt)}function Tt(yt){ye[4](yt)}let P={style:"https://basemaps.cartocdn.com/gl/positron-gl-style/style.json",standardControls:!0,center:[-98.137,40.137],zoom:4,$$slots:{default:[QI]},$$scope:{ctx:ye}};return ye[0]!==void 0&&(P.map=ye[0]),ye[1]!==void 0&&(P.loaded=ye[1]),te=new AI({props:P}),z_.push(()=>L_(te,"map",Ye)),z_.push(()=>L_(te,"loaded",Tt)),{c(){Mc(te.$$.fragment)},l(yt){Sc(te.$$.fragment,yt)},m(yt,Ee){Ic(te,yt,Ee),Ke=!0},p(yt,[Ee]){const li={};Ee&132&&(li.$$scope={dirty:Ee,ctx:yt}),!Re&&Ee&1&&(Re=!0,li.map=yt[0],B_(()=>Re=!1)),!Te&&Ee&2&&(Te=!0,li.loaded=yt[1],B_(()=>Te=!1)),te.$set(li)},i(yt){Ke||(es(te.$$.fragment,yt),Ke=!0)},o(yt){Is(te.$$.fragment,yt),Ke=!1},d(yt){Cc(te,yt)}}}let WI=6;function XI(ye,te,Re){let Te,Ke=!1,Ye;yS(()=>{fetch(`/phast/CA_hexbinned@${WI}.json`).then(yt=>yt.json()).then(yt=>Re(2,Ye=yt)).then(()=>{let yt=ZI(Ye),Ee=window.innerWidth/3;console.log(yt),Te.fitBounds(yt,{padding:{top:50,left:10,bottom:50,right:Ee}})})});function Tt(yt){Te=yt,Re(0,Te)}function P(yt){Ke=yt,Re(1,Ke)}return ye.$$.update=()=>{ye.$$.dirty&3&&Te&&Ke&&Te.getStyle().layers.filter(yt=>yt["source-layer"]==="place")},[Te,Ke,Ye,Tt,P]}let YI=class extends Dc{constructor(te){super(),Pc(this,te,XI,HI,zA,{})}};var KI={exports:{}};(function(ye,te){var Re={};(function(Te,Ke){ye.exports=Ke()})(Bw,function(){var Te,Ke,Ye;function Tt(yt,Ee){if(!Te)Te=Ee;else if(!Ke)Ke=Ee;else{var li="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+Te+")(sharedChunk); ("+Ke+")(sharedChunk); self.onerror = null;",Ot={};Te(Ot),Ye=Ee(Ot),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(Ye.workerUrl=window.URL.createObjectURL(new Blob([li],{type:"text/javascript"})))}}Tt(["exports"],function(yt){var Ee=typeof self<"u"?self:{},li="3.1.2";let Ot;const Gt={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(Ot==null){const t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{Ot=Re.API_URL_REGEX!=null?new RegExp(Re.API_URL_REGEX):t}catch{Ot=t}}return Ot},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Gt.API_URL)return null;try{const t=new URL(Gt.API_URL);return t.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":t.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},Xr={supported:!1,testSupport:function(t){!qr&&cn&&(dr?Tn(t):Ti=t)}};let Ti,cn,qr=!1,dr=!1;function Tn(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,cn),t.isContextLost())return;Xr.supported=!0}catch{}t.deleteTexture(e),qr=!0}Ee.document&&(cn=Ee.document.createElement("img"),cn.onload=function(){Ti&&Tn(Ti),Ti=null,dr=!0},cn.onerror=function(){qr=!0,Ti=null},cn.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const un="01";function _r(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var ps=En;function En(t,e,i,r){this.cx=3*t,this.bx=3*(i-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(r-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=i,this.p2y=r}En.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(e===void 0&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var i=t,r=0;r<8;r++){var n=this.sampleCurveX(i)-t;if(Math.abs(n)<e)return i;var s=this.sampleCurveDerivativeX(i);if(Math.abs(s)<1e-6)break;i-=n/s}var a=0,c=1;for(i=t,r=0;r<20&&(n=this.sampleCurveX(i),!(Math.abs(n-t)<e));r++)t>n?a=i:c=i,i=.5*(c-a)+a;return i},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var Ls=_r(ps),pn=As;function As(t,e){this.x=t,this.y=e}As.prototype={clone:function(){return new As(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),i=Math.sin(t),r=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=r,this},_rotateAround:function(t,e){var i=Math.cos(t),r=Math.sin(t),n=e.y+r*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-r*(this.y-e.y),this.y=n,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},As.convert=function(t){return t instanceof As?t:Array.isArray(t)?new As(t[0],t[1]):t};var ct=_r(pn);function Lt(t,e){if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(!Lt(t[i],e[i]))return!1;return!0}if(typeof t=="object"&&t!==null&&e!==null){if(typeof e!="object"||Object.keys(t).length!==Object.keys(e).length)return!1;for(const i in t)if(!Lt(t[i],e[i]))return!1;return!0}return t===e}const fn=Math.PI/180,mn=180/Math.PI;function wi(t){return t*fn}function hr(t){return t*mn}const kn=[[0,0],[1,0],[1,1],[0,1]];function Dn(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,i=e*t;return 4*(t<.5?i:3*(t-e)+i-.75)}function Rs(t){let e=1/0,i=1/0,r=-1/0,n=-1/0;for(const s of t)e=Math.min(e,s.x),i=Math.min(i,s.y),r=Math.max(r,s.x),n=Math.max(n,s.y);return{min:new ct(e,i),max:new ct(r,n)}}function Ao(t,e,i=0,r=!0){const n=new ct(i,i),s=t.sub(n),a=e.add(n),c=[s,new ct(a.x,s.y),a,new ct(s.x,a.y)];return r&&c.push(s.clone()),c}function yo(t,e,i,r){const n=new Ls(t,e,i,r);return function(s){return n.solve(s)}}const ts=yo(.25,.1,.25,1);function Ai(t,e,i){return Math.min(i,Math.max(e,t))}function jr(t,e,i){return(i=Ai((i-t)/(e-t),0,1))*i*(3-2*i)}function Pn(t,e,i){const r=i-e,n=((t-e)%r+r)%r+e;return n===e?i:n}function Js(t,e,i){if(!t.length)return i(null,[]);let r=t.length;const n=new Array(t.length);let s=null;t.forEach((a,c)=>{e(a,(p,_)=>{p&&(s=p),n[c]=_,--r==0&&i(s,n)})})}function Zn(t){const e=[];for(const i in t)e.push(t[i]);return e}function Pt(t,...e){for(const i of e)for(const r in i)t[r]=i[r];return t}function nr(t,e){const i={};for(let r=0;r<e.length;r++){const n=e[r];n in t&&(i[n]=t[n])}return i}let _n=1;function cs(){return _n++}function aa(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function Yo(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function Di(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function Ir(t,e){t.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function $s(t,e){return t.indexOf(e,t.length-e.length)!==-1}function Cs(t,e,i){const r={};for(const n in t)r[n]=e.call(i||this,t[n],n,t);return r}function Zt(t,e,i){const r={};for(const n in t)e.call(i||this,t[n],n,t)&&(r[n]=t[n]);return r}function Ue(t){return Array.isArray(t)?t.map(Ue):typeof t=="object"&&t?Cs(t,Ue):t}const He={};function Be(t){He[t]||(typeof console<"u"&&console.warn(t),He[t]=!0)}function Rt(t,e,i){return(i.y-t.y)*(e.x-t.x)>(e.y-t.y)*(i.x-t.x)}function Qt(t){let e=0;for(let i,r,n=0,s=t.length,a=s-1;n<s;a=n++)i=t[n],r=t[a],e+=(r.x-i.x)*(i.y+r.y);return e}function ii([t,e,i]){const r=wi(e+90),n=wi(i);return{x:t*Math.cos(r)*Math.sin(n),y:t*Math.sin(r)*Math.sin(n),z:t*Math.cos(n),azimuthal:e,polar:i}}function ti(t,e,i){const r=Math.sqrt(t*t+e*e+i*i),n=r>0?Math.acos(i/r)*mn:0;let s=t!==0||e!==0?Math.atan2(-e,-t)*mn+90:0;return s<0&&(s+=360),[r,s,n]}function Ht(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Ri(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,r,n,s)=>{const a=n||s;return e[r]=!a||a.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let Zi=null;function Yi(){return!!Ee.document.fullscreenElement||!!Ee.document.webkitFullscreenElement}function Yr(t){try{const e=Ee[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function gn(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}function rs(t,e,i){t[4*e+0]=i[0],t[4*e+1]=i[1],t[4*e+2]=i[2],t[4*e+3]=i[3]}function ni(t,e){return[Math.pow(t[0],2.2)*e,Math.pow(t[1],2.2)*e,Math.pow(t[2],2.2)*e]}function yn(t){return[Math.pow(t[0],1/2.2),Math.pow(t[1],1/2.2),Math.pow(t[2],1/2.2)]}const vr="mapbox-tiles";let bs=500,us=50,pi,br;function wr(){try{return Ee.caches}catch{}}function zn(){wr()&&!pi&&(pi=Ee.caches.open(vr))}function co(t){const e=t.indexOf("?");if(e<0)return t;const i=function(n){const s=n.indexOf("?");return s>0?n.slice(s+1).split("&"):[]}(t),r=i.filter(n=>{const s=n.split("=");return s[0]==="language"||s[0]==="worldview"});return r.length?`${t.slice(0,e)}?${r.join("&")}`:t.slice(0,e)}let Sr=1/0;function kt(t){Sr++,Sr>us&&(t.getActor().send("enforceCacheSizeLimit",bs),Sr=0)}const we={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(we);class Ae extends Error{constructor(e,i,r){i===401&&zt(r)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=r}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const pe=Ht()?()=>self.worker&&self.worker.referrer:()=>(Ee.location.protocol==="blob:"?Ee.parent:Ee).location.href,Me=function(t,e){if(!(/^file:/.test(i=t.url)||/^file:/.test(pe())&&!/^\w+:/.test(i))){if(Ee.fetch&&Ee.Request&&Ee.AbortController&&Ee.Request.prototype.hasOwnProperty("signal"))return function(r,n){const s=new Ee.AbortController,a=new Ee.Request(r.url,{method:r.method||"GET",body:r.body,credentials:r.credentials,headers:r.headers,referrer:pe(),referrerPolicy:r.referrerPolicy,signal:s.signal});let c=!1,p=!1;const _=(v=a.url).indexOf("sku=")>0&&zt(v);var v;r.type==="json"&&a.headers.set("Accept","application/json");const E=(B,O,G)=>{if(p)return;if(B&&B.message!=="SecurityError"&&Be(B.toString()),O&&G)return C(O);const q=Date.now();Ee.fetch(a).then(X=>{if(X.ok){const $=_?X.clone():null;return C(X,$,q)}return n(new Ae(X.statusText,X.status,r.url))}).catch(X=>{X.name!=="AbortError"&&n(new Error(`${X.message} ${r.url}`))})},C=(B,O,G)=>{(r.type==="arrayBuffer"?B.arrayBuffer():r.type==="json"?B.json():B.text()).then(q=>{p||(O&&G&&function(X,$,re){if(zn(),!pi)return;const ne={status:$.status,statusText:$.statusText,headers:new Ee.Headers};$.headers.forEach((he,ve)=>ne.headers.set(ve,he));const ie=Ri($.headers.get("Cache-Control")||"");if(ie["no-store"])return;ie["max-age"]&&ne.headers.set("Expires",new Date(re+1e3*ie["max-age"]).toUTCString());const se=ne.headers.get("Expires");se&&(new Date(se).getTime()-re<42e4||function(he,ve){if(br===void 0)try{new Response(new ReadableStream),br=!0}catch{br=!1}br?ve(he.body):he.blob().then(ve)}($,he=>{const ve=new Ee.Response(he,ne);zn(),pi&&pi.then(be=>be.put(co(X.url),ve)).catch(be=>Be(be.message))}))}(a,O,G),c=!0,n(null,q,B.headers.get("Cache-Control"),B.headers.get("Expires")))}).catch(q=>{p||n(new Error(q.message))})};return _?function(B,O){if(zn(),!pi)return O(null);const G=co(B.url);pi.then(q=>{q.match(G).then(X=>{const $=function(re){if(!re)return!1;const ne=new Date(re.headers.get("Expires")||0),ie=Ri(re.headers.get("Cache-Control")||"");return ne>Date.now()&&!ie["no-cache"]}(X);q.delete(G),$&&q.put(G,X.clone()),O(null,X,$)}).catch(O)}).catch(O)}(a,E):E(null,null),{cancel:()=>{p=!0,c||s.abort()}}}(t,e);if(Ht()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var i;return function(r,n){const s=new Ee.XMLHttpRequest;s.open(r.method||"GET",r.url,!0),r.type==="arrayBuffer"&&(s.responseType="arraybuffer");for(const a in r.headers)s.setRequestHeader(a,r.headers[a]);return r.type==="json"&&(s.responseType="text",s.setRequestHeader("Accept","application/json")),s.withCredentials=r.credentials==="include",s.onerror=()=>{n(new Error(s.statusText))},s.onload=()=>{if((s.status>=200&&s.status<300||s.status===0)&&s.response!==null){let a=s.response;if(r.type==="json")try{a=JSON.parse(s.response)}catch(c){return n(c)}n(null,a,s.getResponseHeader("Cache-Control"),s.getResponseHeader("Expires"))}else n(new Ae(s.statusText,s.status,r.url))},s.send(r.body),{cancel:()=>s.abort()}}(t,e)},Le=function(t,e){return Me(Pt(t,{type:"json"}),e)},Ne=function(t,e){return Me(Pt(t,{type:"arrayBuffer"}),e)};function $e(t){const e=Ee.document.createElement("a");return e.href=t,e.protocol===Ee.document.location.protocol&&e.host===Ee.document.location.host}const Qe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Ge,We;Ge=[],We=0;const Et=function(t,e){if(Xr.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),We>=Gt.MAX_PARALLEL_IMAGE_REQUESTS){const s={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Ge.push(s),s}We++;let i=!1;const r=()=>{if(!i)for(i=!0,We--;Ge.length&&We<Gt.MAX_PARALLEL_IMAGE_REQUESTS;){const s=Ge.shift(),{requestParameters:a,callback:c,cancelled:p}=s;p||(s.cancel=Et(a,c).cancel)}},n=Ne(t,(s,a,c,p)=>{r(),s?e(s):a&&(Ee.createImageBitmap?function(_,v){const E=new Ee.Blob([new Uint8Array(_)],{type:"image/png"});Ee.createImageBitmap(E).then(C=>{v(null,C)}).catch(C=>{v(new Error(`Could not load image because of ${C.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(a,(_,v)=>e(_,v,c,p)):function(_,v){const E=new Ee.Image,C=Ee.URL;E.onload=()=>{v(null,E),C.revokeObjectURL(E.src),E.onload=null,Ee.requestAnimationFrame(()=>{E.src=Qe})},E.onerror=()=>v(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const B=new Ee.Blob([new Uint8Array(_)],{type:"image/png"});E.src=_.byteLength?C.createObjectURL(B):Qe}(a,(_,v)=>e(_,v,c,p)))});return{cancel:()=>{n.cancel(),r()}}},xe="NO_ACCESS_TOKEN";class Ie{constructor(e,i,r){this._transformRequestFn=e,this._customAccessToken=i,this._silenceAuthErrors=!!r,this._createSkuToken()}_createSkuToken(){const e=function(){let i="";for(let r=0;r<10;r++)i+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",un,i].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(e,i){return this._transformRequestFn&&this._transformRequestFn(e,i)||{url:e}}normalizeStyleURL(e,i){if(!ut(e))return e;const r=mi(e);return r.params.push(`sdk=js-${li}`),r.path=`/styles/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||i)}normalizeGlyphsURL(e,i){if(!ut(e))return e;const r=mi(e);return r.path=`/fonts/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||i)}normalizeModelURL(e,i){if(!ut(e))return e;const r=mi(e);return r.path=`/models/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||i)}normalizeSourceURL(e,i,r,n){if(!ut(e))return e;const s=mi(e);return s.path=`/v4/${s.authority}.json`,s.params.push("secure"),r&&s.params.push(`language=${r}`),n&&s.params.push(`worldview=${n}`),this._makeAPIURL(s,this._customAccessToken||i)}normalizeSpriteURL(e,i,r,n){const s=mi(e);return ut(e)?(s.path=`/styles/v1${s.path}/sprite${i}${r}`,this._makeAPIURL(s,this._customAccessToken||n)):(s.path+=`${i}${r}`,si(s))}normalizeTileURL(e,i,r){if(this._isSkuTokenExpired()&&this._createSkuToken(),e&&!ut(e))return e;const n=mi(e);n.path=n.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${i||r&&n.authority!=="raster"&&r===512?"@2x":""}${Xr.supported?".webp":"$1"}`),n.authority==="raster"?n.path=`/${Gt.RASTER_URL_PREFIX}${n.path}`:(n.path=n.path.replace(/^.+\/v4\//,"/"),n.path=`/${Gt.TILE_URL_VERSION}${n.path}`);const s=this._customAccessToken||function(a){for(const c of a){const p=c.match(/^access_token=(.*)$/);if(p)return p[1]}return null}(n.params)||Gt.ACCESS_TOKEN;return Gt.REQUIRE_ACCESS_TOKEN&&s&&this._skuToken&&n.params.push(`sku=${this._skuToken}`),this._makeAPIURL(n,s)}canonicalizeTileURL(e,i){const r=mi(e);if(!r.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!r.path.match(/\.[\w]+$/))return e;let n="mapbox://";r.path.match(/^\/raster\/v1\//)?n+=`raster/${r.path.replace(`/${Gt.RASTER_URL_PREFIX}/`,"")}`:n+=`tiles/${r.path.replace(`/${Gt.TILE_URL_VERSION}/`,"")}`;let s=r.params;return i&&(s=s.filter(a=>!a.match(/^access_token=/))),s.length&&(n+=`?${s.join("&")}`),n}canonicalizeTileset(e,i){const r=!!i&&ut(i),n=[];for(const s of e.tiles||[])zt(s)?n.push(this.canonicalizeTileURL(s,r)):n.push(s);return n}_makeAPIURL(e,i){const r="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",n=mi(Gt.API_URL);if(e.protocol=n.protocol,e.authority=n.authority,e.protocol==="http"){const s=e.params.indexOf("secure");s>=0&&e.params.splice(s,1)}if(n.path!=="/"&&(e.path=`${n.path}${e.path}`),!Gt.REQUIRE_ACCESS_TOKEN)return si(e);if(i=i||Gt.ACCESS_TOKEN,!this._silenceAuthErrors){if(!i)throw new Error(`An API access token is required to use Mapbox GL. ${r}`);if(i[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${r}`)}return e.params=e.params.filter(s=>s.indexOf("access_token")===-1),e.params.push(`access_token=${i||""}`),si(e)}}function ut(t){return t.indexOf("mapbox:")===0}function zt(t){return Gt.API_URL_REGEX.test(t)}function o(t){return Gt.API_CDN_URL_REGEX.test(t)}function oe(t){return Gt.API_STYLE_REGEX.test(t)&&!$t(t)}function $t(t){return Gt.API_SPRITE_REGEX.test(t)}const _i=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function mi(t){const e=t.match(_i);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function si(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}const hi="mapbox.eventData";function gr(t){if(!t)return null;const e=t.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(Ee.atob(e[1]).split("").map(i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class yi{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const i=gr(Gt.ACCESS_TOKEN);let r="";return r=i&&i.u?Ee.btoa(encodeURIComponent(i.u).replace(/%([0-9A-F]{2})/g,(n,s)=>String.fromCharCode(+("0x"+s)))):Gt.ACCESS_TOKEN||"",e?`${hi}.${e}:${r}`:`${hi}:${r}`}fetchEventData(){const e=Yr("localStorage"),i=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{const n=Ee.localStorage.getItem(i);n&&(this.eventData=JSON.parse(n));const s=Ee.localStorage.getItem(r);s&&(this.anonId=s)}catch{Be("Unable to read from LocalStorage")}}saveEventData(){const e=Yr("localStorage"),i=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{Ee.localStorage.setItem(r,this.anonId),Object.keys(this.eventData).length>=1&&Ee.localStorage.setItem(i,JSON.stringify(this.eventData))}catch{Be("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,i,r,n){if(!Gt.EVENTS_URL)return;const s=mi(Gt.EVENTS_URL);s.params.push(`access_token=${n||Gt.ACCESS_TOKEN||""}`);const a={event:this.type,created:new Date(e).toISOString()},c=i?Pt(a,i):a,p={url:si(s),headers:{"Content-Type":"text/plain"},body:JSON.stringify([c])};this.pendingRequest=function(_,v){return Me(Pt(_,{method:"POST"}),v)}(p,_=>{this.pendingRequest=null,r(_),this.saveEventData(),this.processRequests(n)})}queueRequest(e,i){this.queue.push(e),this.processRequests(i)}}const Pi=new class extends yi{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){Gt.EVENTS_URL&&Gt.ACCESS_TOKEN&&Array.isArray(t)&&t.some(i=>ut(i)||zt(i))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=gr(Gt.ACCESS_TOKEN),i=e?e.u:Gt.ACCESS_TOKEN;let r=i!==this.eventData.tokenU;Di(this.anonId)||(this.anonId=aa(),r=!0);const n=this.queue.shift();if(this.eventData.lastSuccess){const s=new Date(this.eventData.lastSuccess),a=new Date(n),c=(n-this.eventData.lastSuccess)/864e5;r=r||c>=1||c<-1||s.getDate()!==a.getDate()}else r=!0;r?this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:li,skuId:un,"enabled.telemetry":!1,userId:this.anonId},s=>{s||(this.eventData.lastSuccess=n,this.eventData.tokenU=i)},t):this.processRequests()}},hn=Pi.postTurnstileEvent.bind(Pi),eo=new class extends yi{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,i,r){this.skuToken=e,this.errorCb=r,Gt.EVENTS_URL&&(i||Gt.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(xe)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),Di(this.anonId)||(this.anonId=aa()),this.postEvent(i,{sdkIdentifier:"mapbox-gl-js",sdkVersion:li,skuId:un,skuToken:this.skuToken,userId:this.anonId},r=>{r?this.errorCb(r):e&&(this.success[e]=!0)},t))}},KA=eo.postMapLoadEvent.bind(eo),Vs=new class extends yi{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){Gt.EVENTS_URL&&(t||Gt.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:e,performanceData:i}=this.queue.shift(),r=function(n){const s=Ee.performance.getEntriesByType("resource"),a=Ee.performance.getEntriesByType("mark"),c=function(C){const B={};if(C){for(const O in C)if(O!=="other")for(const G of C[O]){const q=`${O}ResolveRangeMin`,X=`${O}ResolveRangeMax`,$=`${O}RequestCount`,re=`${O}RequestCachedCount`;B[q]=Math.min(B[q]||1/0,G.startTime),B[X]=Math.max(B[X]||-1/0,G.responseEnd);const ne=ie=>{B[ie]===void 0&&(B[ie]=0),++B[ie]};G.transferSize!==void 0&&G.transferSize===0&&ne(re),ne($)}}return B}(function(C,B){const O={};if(C)for(const G of C){const q=B(G);O[q]===void 0&&(O[q]=[]),O[q].push(G)}return O}(s,et)),p=Ee.devicePixelRatio,_=Ee.navigator.connection||Ee.navigator.mozConnection||Ee.navigator.webkitConnection,v={counters:[],metadata:[],attributes:[]},E=(C,B,O)=>{O!=null&&C.push({name:B,value:O.toString()})};for(const C in c)E(v.counters,C,c[C]);if(n.interactionRange[0]!==1/0&&n.interactionRange[1]!==-1/0&&(E(v.counters,"interactionRangeMin",n.interactionRange[0]),E(v.counters,"interactionRangeMax",n.interactionRange[1])),a)for(const C of Object.keys(gt)){const B=gt[C],O=a.find(G=>G.name===B);O&&E(v.counters,B,O.startTime)}return E(v.counters,"visibilityHidden",n.visibilityHidden),E(v.attributes,"style",function(C){if(C)for(const B of C){const O=B.name.split("?")[0];if(oe(O)){const G=O.split("/").slice(-2);if(G.length===2)return`mapbox://styles/${G[0]}/${G[1]}`}}}(s)),E(v.attributes,"terrainEnabled",n.terrainEnabled?"true":"false"),E(v.attributes,"fogEnabled",n.fogEnabled?"true":"false"),E(v.attributes,"projection",n.projection),E(v.attributes,"zoom",n.zoom),E(v.metadata,"devicePixelRatio",p),E(v.metadata,"connectionEffectiveType",_?_.effectiveType:void 0),E(v.metadata,"navigatorUserAgent",Ee.navigator.userAgent),E(v.metadata,"screenWidth",Ee.screen.width),E(v.metadata,"screenHeight",Ee.screen.height),E(v.metadata,"windowWidth",Ee.innerWidth),E(v.metadata,"windowHeight",Ee.innerHeight),E(v.metadata,"mapWidth",n.width/p),E(v.metadata,"mapHeight",n.height/p),E(v.metadata,"webglRenderer",n.renderer),E(v.metadata,"webglVendor",n.vendor),E(v.metadata,"sdkVersion",li),E(v.metadata,"sdkIdentifier","mapbox-gl-js"),v}(i);for(const n of r.metadata);for(const n of r.counters);for(const n of r.attributes);this.postEvent(e,r,()=>{},t)}},js=Vs.postPerformanceEvent.bind(Vs),Ro=new class extends yi{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,i,r){if(!Gt.API_URL||!Gt.SESSION_PATH)return;const n=mi(Gt.API_URL+Gt.SESSION_PATH);n.params.push(`sku=${e||""}`),n.params.push(`access_token=${r||Gt.ACCESS_TOKEN||""}`);const s={url:si(n),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(a,c){return Me(Pt(a,{method:"GET"}),c)}(s,a=>{this.pendingRequest=null,i(a),this.saveEventData(),this.processRequests(r)})}getSessionAPI(t,e,i,r){this.skuToken=e,this.errorCb=r,Gt.SESSION_PATH&&Gt.API_URL&&(i||Gt.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(xe)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||this.getSession(i,this.skuToken,r=>{r?this.errorCb(r):e&&(this.success[e]=!0)},t)}},en=Ro.getSessionAPI.bind(Ro),Ko=new Set;function kr(t,e){e?Ko.add(t):Ko.delete(t)}const gt={create:"create",load:"load",fullLoad:"fullLoad"},Ci={mark(t){Ee.performance.mark(t)},measure(t,e,i){Ee.performance.measure(t,e,i)}};function et(t){const e=t.name.split("?")[0];return o(e)&&e.includes("mapbox-gl.js")?"javascript":o(e)&&e.includes("mapbox-gl.css")?"css":function(i){return Gt.API_FONTS_REGEX.test(i)}(e)?"fontRange":$t(e)?"sprite":oe(e)?"style":function(i){return Gt.API_TILEJSON_REGEX.test(i)}(e)?"tilejson":"other"}const ar=Ee.performance;function to(t){const e=t?t.url.toString():void 0;return ar.getEntriesByName(e)}var BA=Dl;function Dl(t){return!function(e){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var r,n,s=new Blob([""],{type:"text/javascript"}),a=URL.createObjectURL(s);try{n=new Worker(a),r=!0}catch{r=!1}return n&&n.terminate(),URL.revokeObjectURL(a),r}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var r=document.createElement("canvas");r.width=r.height=1;var n=r.getContext("2d");if(!n)return!1;var s=n.getImageData(0,0,1,1);return s&&s.width===r.width}()?(st[i=e&&e.failIfMajorPerformanceCaveat]===void 0&&(st[i]=function(r){var n,s=function(a){var c=document.createElement("canvas"),p=Object.create(Dl.webGLContextAttributes);return p.failIfMajorPerformanceCaveat=a,c.getContext("webgl",p)||c.getContext("experimental-webgl",p)}(r);if(!s)return!1;try{n=s.createShader(s.VERTEX_SHADER)}catch{return!1}return!(!n||s.isContextLost())&&(s.shaderSource(n,"void main() {}"),s.compileShader(n),s.getShaderParameter(n,s.COMPILE_STATUS)===!0)}(i)),st[i]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var i}(t)}var st={};let xn,Ze,hs,Jl,uo;function JA(){return xn==null&&(xn=Ee.OffscreenCanvas&&new Ee.OffscreenCanvas(1,1).getContext("2d")&&typeof Ee.createImageBitmap=="function"),xn}Dl.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Wi={now:()=>Jl!==void 0?Jl:Ee.performance.now(),setNow(t){Jl=t},restoreNow(){Jl=void 0},frame(t){const e=Ee.requestAnimationFrame(t);return{cancel:()=>Ee.cancelAnimationFrame(e)}},getImageData(t,e=0){const{width:i,height:r}=t;uo||(uo=Ee.document.createElement("canvas"));const n=uo.getContext("2d",{willReadFrequently:!0});if(!n)throw new Error("failed to create canvas 2d context");return(i>uo.width||r>uo.height)&&(uo.width=i,uo.height=r),n.clearRect(-e,-e,i+2*e,r+2*e),n.drawImage(t,0,0,i,r),n.getImageData(-e,-e,i+2*e,r+2*e)},resolveURL:t=>(Ze||(Ze=Ee.document.createElement("a")),Ze.href=t,Ze.href),get devicePixelRatio(){return Ee.devicePixelRatio},get prefersReducedMotion(){return!!Ee.matchMedia&&(hs==null&&(hs=Ee.matchMedia("(prefers-reduced-motion: reduce)")),hs.matches)},hasCanvasFingerprintNoise(){if(!JA())return!1;const t=new Ee.OffscreenCanvas(85,1),e=t.getContext("2d",{willReadFrequently:!0});let i=0;for(let n=0;n<t.width;++n)e.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,e.fillRect(n,0,1,1);const r=e.getImageData(0,0,t.width,t.height);i=0;for(let n=0;n<r.data.length;++n)if(n%4!=3&&i++!==r.data[n])return!0;return!1}};function dn(t,e,i){const r=Ee.document.createElement(t);return e!==void 0&&(r.className=e),i&&i.appendChild(r),r}function Jo(t,e,i){const r=Ee.document.createElementNS("http://www.w3.org/2000/svg",t);for(const n of Object.keys(e))r.setAttributeNS(null,n,e[n]);return i&&i.appendChild(r),r}const Gs=Ee.document&&Ee.document.documentElement.style,Yn=Gs&&Gs.userSelect!==void 0?"userSelect":"WebkitUserSelect";let xo;function Fs(){Gs&&Yn&&(xo=Gs[Yn],Gs[Yn]="none")}function Pl(){Gs&&Yn&&(Gs[Yn]=xo)}function $A(t){t.preventDefault(),t.stopPropagation(),Ee.removeEventListener("click",$A,!0)}function ec(){Ee.addEventListener("click",$A,!0),Ee.setTimeout(()=>{Ee.removeEventListener("click",$A,!0)},0)}function zl(t,e){const i=t.getBoundingClientRect();return tc(t,i,e)}function fA(t,e){const i=t.getBoundingClientRect(),r=[];for(let n=0;n<e.length;n++)r.push(tc(t,i,e[n]));return r}function ns(t){return Ee.InstallTrigger!==void 0&&t.button===2&&t.ctrlKey&&Ee.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:t.button}function tc(t,e,i){const r=t.offsetWidth===e.width?1:t.offsetWidth/e.width;return new ct((i.clientX-e.left)*r,(i.clientY-e.top)*r)}function qn(t,e,i){i[t]&&i[t].indexOf(e)!==-1||(i[t]=i[t]||[],i[t].push(e))}function dA(t,e,i){if(i&&i[t]){const r=i[t].indexOf(e);r!==-1&&i[t].splice(r,1)}}class Jt{constructor(e,i={}){Pt(this,i),this.type=e}}class $i extends Jt{constructor(e,i={}){super("error",Pt({error:e},i))}}class ss{on(e,i){return this._listeners=this._listeners||{},qn(e,i,this._listeners),this}off(e,i){return dA(e,i,this._listeners),dA(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},qn(e,i,this._oneTimeListeners),this):new Promise(r=>this.once(e,r))}fire(e,i){typeof e=="string"&&(e=new Jt(e,i||{}));const r=e.type;if(this.listens(r)){e.target=this;const n=this._listeners&&this._listeners[r]?this._listeners[r].slice():[];for(const c of n)c.call(this,e);const s=this._oneTimeListeners&&this._oneTimeListeners[r]?this._oneTimeListeners[r].slice():[];for(const c of s)dA(r,c,this._oneTimeListeners),c.call(this,e);const a=this._eventedParent;a&&(Pt(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),a.fire(e))}else e instanceof $i&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}var xt=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","default":[0,1],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');class gi{constructor(e,i,r,n){this.message=(e?`${e}: `:"")+r,n&&(this.identifier=n),i!=null&&i.__line__&&(this.line=i.__line__)}}class Fo extends gi{}function $o(t,...e){for(const i of e)for(const r in i)t[r]=i[r];return t}function vn(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function la(t){if(Array.isArray(t))return t.map(la);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const i in t)e[i]=la(t[i]);return e}return vn(t)}class $l extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}var Oo=$l;class eA{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[r,n]of i)this.bindings[r]=n}concat(e){return new eA(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var pA=eA;const Kn={kind:"null"},Wt={kind:"number"},Ui={kind:"string"},sr={kind:"boolean"},tn={kind:"color"},Aa={kind:"object"},Dr={kind:"value"},ba={kind:"collator"},rl={kind:"formatted"},ca={kind:"resolvedImage"};function ho(t,e){return{kind:"array",itemType:t,N:e}}function Jn(t){if(t.kind==="array"){const e=Jn(t.itemType);return typeof t.N=="number"?`array<${e}, ${t.N}>`:t.itemType.kind==="value"?"array":`array<${e}>`}return t.kind}const gl=[Kn,Wt,Ui,sr,tn,rl,Aa,ho(Dr),ca];function Zs(t,e){if(e.kind==="error")return null;if(t.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Zs(t.itemType,e.itemType))&&(typeof t.N!="number"||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if(t.kind==="value"){for(const i of gl)if(!Zs(i,e))return null}}return`Expected ${Jn(t)} but found ${Jn(e)} instead.`}function wa(t,e){return e.some(i=>i.kind===t.kind)}function Bl(t,e){return e.some(i=>i==="null"?t===null:i==="array"?Array.isArray(t):i==="object"?t&&!Array.isArray(t)&&typeof t=="object":i===typeof t)}var Ta,nl={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Va(t){return(t=Math.round(t))<0?0:t>255?255:t}function ic(t){return Va(t[t.length-1]==="%"?parseFloat(t)/100*255:parseInt(t))}function mA(t){return(e=t[t.length-1]==="%"?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function LA(t,e,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?t+(e-t)*i*6:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t}try{Ta={}.parseCSSColor=function(t){var e,i=t.replace(/ /g,"").toLowerCase();if(i in nl)return nl[i].slice();if(i[0]==="#")return i.length===4?(e=parseInt(i.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:i.length===7&&(e=parseInt(i.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var r=i.indexOf("("),n=i.indexOf(")");if(r!==-1&&n+1===i.length){var s=i.substr(0,r),a=i.substr(r+1,n-(r+1)).split(","),c=1;switch(s){case"rgba":if(a.length!==4)return null;c=mA(a.pop());case"rgb":return a.length!==3?null:[ic(a[0]),ic(a[1]),ic(a[2]),c];case"hsla":if(a.length!==4)return null;c=mA(a.pop());case"hsl":if(a.length!==3)return null;var p=(parseFloat(a[0])%360+360)%360/360,_=mA(a[1]),v=mA(a[2]),E=v<=.5?v*(_+1):v+_-v*_,C=2*v-E;return[Va(255*LA(C,E,p+1/3)),Va(255*LA(C,E,p)),Va(255*LA(C,E,p-1/3)),c];default:return null}}return null}}catch{}class ea{constructor(e,i,r,n=1){this.r=e,this.g=i,this.b=r,this.a=n}static parse(e){if(!e)return;if(e instanceof ea)return e;if(typeof e!="string")return;const i=Ta(e);return i?new ea(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toString(){const[e,i,r,n]=this.toArray();return`rgba(${Math.round(e)},${Math.round(i)},${Math.round(r)},${n})`}toArray(){const{r:e,g:i,b:r,a:n}=this;return n===0?[0,0,0,0]:[255*e/n,255*i/n,255*r/n,n]}toArray01(){const{r:e,g:i,b:r,a:n}=this;return n===0?[0,0,0,0]:[e/n,i/n,r/n,n]}toArray01Scaled(e){const{r:i,g:r,b:n,a:s}=this;return s===0?[0,0,0]:[i/s*e,r/s*e,n/s*e]}toArray01PremultipliedAlpha(){const{r:e,g:i,b:r,a:n}=this;return[e,i,r,n]}toArray01Linear(){const{r:e,g:i,b:r,a:n}=this;return n===0?[0,0,0,0]:[Math.pow(e/n,2.2),Math.pow(i/n,2.2),Math.pow(r/n,2.2),n]}}ea.black=new ea(0,0,0,1),ea.white=new ea(1,1,1,1),ea.transparent=new ea(0,0,0,0),ea.red=new ea(1,0,0,1),ea.blue=new ea(0,0,1,1);var fr=ea;class ja{constructor(e,i,r){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class RA{constructor(e,i,r,n,s){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=r,this.fontStack=n,this.textColor=s}}class vo{constructor(e){this.sections=e}static fromString(e){return new vo([new RA(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.namePrimary.length!==0)}static factory(e){return e instanceof vo?e:vo.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){e.push(["image",i.image.namePrimary]);continue}e.push(i.text);const r={};i.fontStack&&(r["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(r["font-scale"]=i.scale),i.textColor&&(r["text-color"]=["rgba"].concat(i.textColor.toArray())),e.push(r)}return e}}class fo{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),this.available=e.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(e,i){return e?new fo({namePrimary:e,nameSecondary:i,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function Ll(t,e,i,r){return typeof t=="number"&&t>=0&&t<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?r===void 0||typeof r=="number"&&r>=0&&r<=1?null:`Invalid rgba value [${[t,e,i,r].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof r=="number"?[t,e,i,r]:[t,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function tA(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof fr||t instanceof ja||t instanceof vo||t instanceof fo)return!0;if(Array.isArray(t)){for(const e of t)if(!tA(e))return!1;return!0}if(typeof t=="object"){for(const e in t)if(!tA(t[e]))return!1;return!0}return!1}function ms(t){if(t===null)return Kn;if(typeof t=="string")return Ui;if(typeof t=="boolean")return sr;if(typeof t=="number")return Wt;if(t instanceof fr)return tn;if(t instanceof ja)return ba;if(t instanceof vo)return rl;if(t instanceof fo)return ca;if(Array.isArray(t)){const e=t.length;let i;for(const r of t){const n=ms(r);if(i){if(i===n)continue;i=Dr;break}i=n}return ho(i||Dr,e)}return Aa}function Ea(t){const e=typeof t;return t===null?"":e==="string"||e==="number"||e==="boolean"?String(t):t instanceof fr||t instanceof vo||t instanceof fo?t.toString():JSON.stringify(t)}class Rl{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!tA(e[1]))return i.error("invalid value");const r=e[1];let n=ms(r);const s=i.expectedType;return n.kind!=="array"||n.N!==0||!s||s.kind!=="array"||typeof s.N=="number"&&s.N!==0||(n=s),new Rl(n,r)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof fr?["rgba"].concat(this.value.toArray()):this.value instanceof vo?this.value.serialize():this.value}}var qs=Rl,fs=class{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}};const Fl={string:Ui,number:Wt,boolean:sr,object:Aa};class FA{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let r,n=1;const s=e[0];if(s==="array"){let c,p;if(e.length>2){const _=e[1];if(typeof _!="string"||!(_ in Fl)||_==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);c=Fl[_],n++}else c=Dr;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);p=e[2],n++}r=ho(c,p)}else r=Fl[s];const a=[];for(;n<e.length;n++){const c=i.parse(e[n],n,Dr);if(!c)return null;a.push(c)}return new FA(r,a)}evaluate(e){for(let i=0;i<this.args.length;i++){const r=this.args[i].evaluate(e);if(!Zs(this.type,ms(r)))return r;if(i===this.args.length-1)throw new fs(`Expected value to be of type ${Jn(this.type)}, but found ${Jn(ms(r))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,i=[e.kind];if(e.kind==="array"){const r=e.itemType;if(r.kind==="string"||r.kind==="number"||r.kind==="boolean"){i.push(r.kind);const n=e.N;(typeof n=="number"||this.args.length>1)&&i.push(n)}}return i.concat(this.args.map(r=>r.serialize()))}}var Ur=FA;class $n{constructor(e){this.type=rl,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const r=e[1];if(!Array.isArray(r)&&typeof r=="object")return i.error("First argument must be an image or text section.");const n=[];let s=!1;for(let a=1;a<=e.length-1;++a){const c=e[a];if(s&&typeof c=="object"&&!Array.isArray(c)){s=!1;let p=null;if(c["font-scale"]&&(p=i.parse(c["font-scale"],1,Wt),!p))return null;let _=null;if(c["text-font"]&&(_=i.parse(c["text-font"],1,ho(Ui)),!_))return null;let v=null;if(c["text-color"]&&(v=i.parse(c["text-color"],1,tn),!v))return null;const E=n[n.length-1];E.scale=p,E.font=_,E.textColor=v}else{const p=i.parse(e[a],1,Dr);if(!p)return null;const _=p.type.kind;if(_!=="string"&&_!=="value"&&_!=="null"&&_!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");s=!0,n.push({content:p,scale:null,font:null,textColor:null})}}return new $n(n)}evaluate(e){return new vo(this.sections.map(i=>{const r=i.content.evaluate(e);return ms(r)===ca?new RA("",r,null,null,null):new RA(Ea(r),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const r={};i.scale&&(r["font-scale"]=i.scale.serialize()),i.font&&(r["text-font"]=i.font.serialize()),i.textColor&&(r["text-color"]=i.textColor.serialize()),e.push(r)}return e}}class iA{constructor(e,i){this.type=ca,this.inputPrimary=e,this.inputSecondary=i}static parse(e,i){if(e.length<2)return i.error("Expected two or more arguments.");const r=i.parse(e[1],1,Ui);if(!r)return i.error("No image name provided.");if(e.length===2)return new iA(r);const n=i.parse(e[2],1,Ui);return n?new iA(r,n):i.error("Secondary image variant is not a string.")}evaluate(e){const i=fo.fromString(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0);return i&&e.availableImages&&(i.available=e.availableImages.indexOf(i.namePrimary)>-1,i.nameSecondary&&i.available&&e.availableImages&&(i.available=e.availableImages.indexOf(i.nameSecondary)>-1)),i}eachChild(e){e(this.inputPrimary),this.inputSecondary&&e(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function Vi(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}const Ma={"to-boolean":sr,"to-color":tn,"to-number":Wt,"to-string":Ui};class os{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const r=e[0],n=[];let s=Kn;if(r==="to-array"){if(!Array.isArray(e[1]))return null;const a=e[1].length;if(i.expectedType){if(i.expectedType.kind!=="array")return i.error(`Expected ${i.expectedType.kind} but found array.`);s=ho(i.expectedType.itemType,a)}else{if(!(a>0&&tA(e[1][0])))return null;s=ho(ms(e[1][0]),a)}for(let c=0;c<a;c++){const p=e[1][c];let _;if(Vi(p)==="array")_=i.parse(p,void 0,s.itemType);else{const v=Vi(p);if(v!==s.itemType.kind)return i.error(`Expected ${s.itemType.kind} but found ${v}.`);_=i.registry.literal.parse(["literal",p===void 0?null:p],i)}if(!_)return null;n.push(_)}}else{if((r==="to-boolean"||r==="to-string")&&e.length!==2)return i.error("Expected one argument.");s=Ma[r];for(let a=1;a<e.length;a++){const c=i.parse(e[a],a,Dr);if(!c)return null;n.push(c)}}return new os(s,n)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let i,r;for(const n of this.args){if(i=n.evaluate(e),r=null,i instanceof fr)return i;if(typeof i=="string"){const s=e.parseColor(i);if(s)return s}else if(Array.isArray(i)&&(r=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:Ll(i[0],i[1],i[2],i[3]),!r))return new fr(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new fs(r||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const r of this.args){if(i=r.evaluate(e),i===null)return 0;const n=Number(i);if(!isNaN(n))return n}throw new fs(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?vo.fromString(Ea(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?fo.fromString(Ea(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(i=>i.evaluate(e)):Ea(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new $n([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new iA(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}var Sn=os;const Ga=["Unknown","Point","LineString","Polygon"];var zc=class{constructor(t){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.options=t}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ga[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(t){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:i,y:r}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(i*e-t[0])+this.featureDistanceData.bearing[1]*(r*e-t[1])}return 0}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=fr.parse(t)),e}getConfig(t){return this.options?this.options.get(t):null}};class sl{constructor(e,i,r,n,s){this.name=e,this.type=i,this._evaluate=r,this.args=n,this._overloadIndex=s}evaluate(e){if(!this._evaluate){const i=sl.definitions[this.name];this._evaluate=Array.isArray(i)?i[2]:i.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){const r=e[0],n=sl.definitions[r];if(!n)return i.error(`Unknown expression "${r}". If you wanted a literal array, use ["literal", [...]].`,0);const s=Array.isArray(n)?n[0]:n.type,a=Array.isArray(n)?[[n[1],n[2]]]:n.overloads,c=[];let p=null,_=-1;for(const[v,E]of a){if(Array.isArray(v)&&v.length!==e.length-1)continue;c.push(v),_++,p=new Ac(i.registry,i.path,null,i.scope,void 0,i.options);const C=[];let B=!1;for(let O=1;O<e.length;O++){const G=e[O],q=Array.isArray(v)?v[O-1]:v.type,X=p.parse(G,1+C.length,q);if(!X){B=!0;break}C.push(X)}if(!B)if(Array.isArray(v)&&v.length!==C.length)p.error(`Expected ${v.length} arguments, but found ${C.length} instead.`);else{for(let O=0;O<C.length;O++){const G=Array.isArray(v)?v[O]:v.type,q=C[O];p.concat(O+1).checkSubtype(G,q.type)}if(p.errors.length===0)return new sl(r,s,E,C,_)}}if(c.length===1)i.errors.push(...p.errors);else{const v=(c.length?c:a.map(([C])=>C)).map(_A).join(" | "),E=[];for(let C=1;C<e.length;C++){const B=i.parse(e[C],1+E.length);if(!B)return null;E.push(Jn(B.type))}i.error(`Expected arguments of type ${v}, but found (${E.join(", ")}) instead.`)}return null}static register(e,i){sl.definitions=i;for(const r in i)e[r]=sl}}function _A(t){return Array.isArray(t)?`(${t.map(Jn).join(", ")})`:`(${Jn(t.type)}...)`}var No=sl;class yl{constructor(e,i,r){this.type=ba,this.locale=r,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const r=e[1];if(typeof r!="object"||Array.isArray(r))return i.error("Collator options argument must be an object.");const n=i.parse(r["case-sensitive"]!==void 0&&r["case-sensitive"],1,sr);if(!n)return null;const s=i.parse(r["diacritic-sensitive"]!==void 0&&r["diacritic-sensitive"],1,sr);if(!s)return null;let a=null;return r.locale&&(a=i.parse(r.locale,1,Ui),!a)?null:new yl(n,s,a)}evaluate(e){return new ja(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}var Nn={exports:{}};Nn.exports=function(){function t(r,n,s,a,c){for(;a>s;){if(a-s>600){var p=a-s+1,_=n-s+1,v=Math.log(p),E=.5*Math.exp(2*v/3),C=.5*Math.sqrt(v*E*(p-E)/p)*(_-p/2<0?-1:1);t(r,n,Math.max(s,Math.floor(n-_*E/p+C)),Math.min(a,Math.floor(n+(p-_)*E/p+C)),c)}var B=r[n],O=s,G=a;for(e(r,s,n),c(r[a],B)>0&&e(r,s,a);O<G;){for(e(r,O,G),O++,G--;c(r[O],B)<0;)O++;for(;c(r[G],B)>0;)G--}c(r[s],B)===0?e(r,s,G):e(r,++G,a),G<=n&&(s=G+1),n<=G&&(a=G-1)}}function e(r,n,s){var a=r[n];r[n]=r[s],r[s]=a}function i(r,n){return r<n?-1:r>n?1:0}return function(r,n,s,a,c){t(r,n,s||0,a||r.length-1,c||i)}}();var Bc=_r(Nn.exports);function gA(t){let e=0;for(let i,r,n=0,s=t.length,a=s-1;n<s;a=n++)i=t[n],r=t[a],e+=(r.x-i.x)*(i.y+r.y);return e}function ol(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function Za(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function Cu(t,e,i){const r=t[0]-e[0],n=t[1]-e[1],s=t[0]-i[0],a=t[1]-i[1];return r*a-s*n==0&&r*s<=0&&n*a<=0}function Os(t,e,i=!1){let r=!1;for(let c=0,p=e.length;c<p;c++){const _=e[c];for(let v=0,E=_.length,C=E-1;v<E;C=v++){const B=_[C],O=_[v];if(Cu(t,B,O))return i;(s=B)[1]>(n=t)[1]!=(a=O)[1]>n[1]&&n[0]<(a[0]-s[0])*(n[1]-s[1])/(a[1]-s[1])+s[0]&&(r=!r)}}var n,s,a;return r}function Qs(t,e,i,r){const n=r[0]-i[0],s=r[1]-i[1],a=(t[0]-i[0])*s-n*(t[1]-i[1]),c=(e[0]-i[0])*s-n*(e[1]-i[1]);return a>0&&c<0||a<0&&c>0}function po(t,e,i,r){return(n=[r[0]-i[0],r[1]-i[1]])[0]*(s=[e[0]-t[0],e[1]-t[1]])[1]-n[1]*s[0]!=0&&!(!Qs(t,e,i,r)||!Qs(i,r,t,e));var n,s}const ua=8192;function xl(t,e){const i=(180+t[0])/360,r=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,n=Math.pow(2,e.z);return[Math.round(i*n*ua),Math.round(r*n*ua)]}function ou(t,e){for(let i=0;i<e.length;i++)if(Os(t,e[i]))return!0;return!1}function rc(t,e,i){for(const r of i)for(let n=0,s=r.length,a=s-1;n<s;a=n++)if(po(t,e,r[a],r[n]))return!0;return!1}function io(t,e){for(let i=0;i<t.length;++i)if(!Os(t[i],e))return!1;for(let i=0;i<t.length-1;++i)if(rc(t[i],t[i+1],e))return!1;return!0}function bo(t,e){for(let i=0;i<e.length;i++)if(io(t,e[i]))return!0;return!1}function ta(t,e,i){const r=[];for(let n=0;n<t.length;n++){const s=[];for(let a=0;a<t[n].length;a++){const c=xl(t[n][a],i);ol(e,c),s.push(c)}r.push(s)}return r}function OA(t,e,i){const r=[];for(let n=0;n<t.length;n++){const s=ta(t[n],e,i);r.push(s)}return r}function Rn(t,e,i,r){if(t[0]<i[0]||t[0]>i[2]){const n=.5*r;let s=t[0]-i[0]>n?-r:i[0]-t[0]>n?r:0;s===0&&(s=t[0]-i[2]>n?-r:i[2]-t[0]>n?r:0),t[0]+=s}ol(e,t)}function Sa(t,e,i,r){const n=Math.pow(2,r.z)*ua,s=[r.x*ua,r.y*ua],a=[];if(!t)return a;for(const c of t)for(const p of c){const _=[p.x+s[0],p.y+s[1]];Rn(_,e,i,n),a.push(_)}return a}function Un(t,e,i,r){const n=Math.pow(2,r.z)*ua,s=[r.x*ua,r.y*ua],a=[];if(!t)return a;for(const p of t){const _=[];for(const v of p){const E=[v.x+s[0],v.y+s[1]];ol(e,E),_.push(E)}a.push(_)}if(e[2]-e[0]<=n/2){(c=e)[0]=c[1]=1/0,c[2]=c[3]=-1/0;for(const p of a)for(const _ of p)Rn(_,e,i,n)}var c;return a}class qa{constructor(e,i){this.type=sr,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(tA(e[1])){const r=e[1];if(r.type==="FeatureCollection")for(let n=0;n<r.features.length;++n){const s=r.features[n].geometry.type;if(s==="Polygon"||s==="MultiPolygon")return new qa(r,r.features[n].geometry)}else if(r.type==="Feature"){const n=r.geometry.type;if(n==="Polygon"||n==="MultiPolygon")return new qa(r,r.geometry)}else if(r.type==="Polygon"||r.type==="MultiPolygon")return new qa(r,r)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(i,r){const n=[1/0,1/0,-1/0,-1/0],s=[1/0,1/0,-1/0,-1/0],a=i.canonicalID();if(!a)return!1;if(r.type==="Polygon"){const c=ta(r.coordinates,s,a),p=Sa(i.geometry(),n,s,a);if(!Za(n,s))return!1;for(const _ of p)if(!Os(_,c))return!1}if(r.type==="MultiPolygon"){const c=OA(r.coordinates,s,a),p=Sa(i.geometry(),n,s,a);if(!Za(n,s))return!1;for(const _ of p)if(!ou(_,c))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(i,r){const n=[1/0,1/0,-1/0,-1/0],s=[1/0,1/0,-1/0,-1/0],a=i.canonicalID();if(!a)return!1;if(r.type==="Polygon"){const c=ta(r.coordinates,s,a),p=Un(i.geometry(),n,s,a);if(!Za(n,s))return!1;for(const _ of p)if(!io(_,c))return!1}if(r.type==="MultiPolygon"){const c=OA(r.coordinates,s,a),p=Un(i.geometry(),n,s,a);if(!Za(n,s))return!1;for(const _ of p)if(!bo(_,c))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var al=qa,vl={exports:{}};vl.exports=function(){var t={kilometers:1,miles:.621371192237334,nauticalmiles:.5399568034557235,meters:1e3,metres:1e3,yards:1093.6132983377079,feet:3280.839895013123,inches:39370.078740157485},e=1/298.257223563,i=e*(2-e),r=Math.PI/180,n=function(_,v){if(_===void 0)throw new Error("No latitude given.");if(v&&!t[v])throw new Error("Unknown unit "+v+". Use one of: "+Object.keys(t).join(", "));var E=6378.137*r*(v?t[v]:1),C=Math.cos(_*r),B=1/(1-i*(1-C*C)),O=Math.sqrt(B);this.kx=E*O*C,this.ky=E*O*B*(1-i)},s={units:{configurable:!0}};function a(_,v){return _[0]===v[0]&&_[1]===v[1]}function c(_,v,E){var C=p(v[0]-_[0]);return[_[0]+C*E,_[1]+(v[1]-_[1])*E]}function p(_){for(;_<-180;)_+=360;for(;_>180;)_-=360;return _}return n.fromTile=function(_,v,E){var C=Math.PI*(1-2*(_+.5)/Math.pow(2,v)),B=Math.atan(.5*(Math.exp(C)-Math.exp(-C)))/r;return new n(B,E)},s.units.get=function(){return t},n.prototype.distance=function(_,v){var E=p(_[0]-v[0])*this.kx,C=(_[1]-v[1])*this.ky;return Math.sqrt(E*E+C*C)},n.prototype.bearing=function(_,v){var E=p(v[0]-_[0])*this.kx;return Math.atan2(E,(v[1]-_[1])*this.ky)/r},n.prototype.destination=function(_,v,E){var C=E*r;return this.offset(_,Math.sin(C)*v,Math.cos(C)*v)},n.prototype.offset=function(_,v,E){return[_[0]+v/this.kx,_[1]+E/this.ky]},n.prototype.lineDistance=function(_){for(var v=0,E=0;E<_.length-1;E++)v+=this.distance(_[E],_[E+1]);return v},n.prototype.area=function(_){for(var v=0,E=0;E<_.length;E++)for(var C=_[E],B=0,O=C.length,G=O-1;B<O;G=B++)v+=p(C[B][0]-C[G][0])*(C[B][1]+C[G][1])*(E?-1:1);return Math.abs(v)/2*this.kx*this.ky},n.prototype.along=function(_,v){var E=0;if(v<=0)return _[0];for(var C=0;C<_.length-1;C++){var B=_[C],O=_[C+1],G=this.distance(B,O);if((E+=G)>v)return c(B,O,(v-(E-G))/G)}return _[_.length-1]},n.prototype.pointToSegmentDistance=function(_,v,E){var C=v[0],B=v[1],O=p(E[0]-C)*this.kx,G=(E[1]-B)*this.ky,q=0;return O===0&&G===0||((q=(p(_[0]-C)*this.kx*O+(_[1]-B)*this.ky*G)/(O*O+G*G))>1?(C=E[0],B=E[1]):q>0&&(C+=O/this.kx*q,B+=G/this.ky*q)),O=p(_[0]-C)*this.kx,G=(_[1]-B)*this.ky,Math.sqrt(O*O+G*G)},n.prototype.pointOnLine=function(_,v){for(var E,C,B,O,G=1/0,q=0;q<_.length-1;q++){var X=_[q][0],$=_[q][1],re=p(_[q+1][0]-X)*this.kx,ne=(_[q+1][1]-$)*this.ky,ie=0;re===0&&ne===0||((ie=(p(v[0]-X)*this.kx*re+(v[1]-$)*this.ky*ne)/(re*re+ne*ne))>1?(X=_[q+1][0],$=_[q+1][1]):ie>0&&(X+=re/this.kx*ie,$+=ne/this.ky*ie));var se=(re=p(v[0]-X)*this.kx)*re+(ne=(v[1]-$)*this.ky)*ne;se<G&&(G=se,E=X,C=$,B=q,O=ie)}return{point:[E,C],index:B,t:Math.max(0,Math.min(1,O))}},n.prototype.lineSlice=function(_,v,E){var C=this.pointOnLine(E,_),B=this.pointOnLine(E,v);if(C.index>B.index||C.index===B.index&&C.t>B.t){var O=C;C=B,B=O}var G=[C.point],q=C.index+1,X=B.index;!a(E[q],G[0])&&q<=X&&G.push(E[q]);for(var $=q+1;$<=X;$++)G.push(E[$]);return a(E[X],B.point)||G.push(B.point),G},n.prototype.lineSliceAlong=function(_,v,E){for(var C=0,B=[],O=0;O<E.length-1;O++){var G=E[O],q=E[O+1],X=this.distance(G,q);if((C+=X)>_&&B.length===0&&B.push(c(G,q,(_-(C-X))/X)),C>=v)return B.push(c(G,q,(v-(C-X))/X)),B;C>_&&B.push(q)}return B},n.prototype.bufferPoint=function(_,v){var E=v/this.ky,C=v/this.kx;return[_[0]-C,_[1]-E,_[0]+C,_[1]+E]},n.prototype.bufferBBox=function(_,v){var E=v/this.ky,C=v/this.kx;return[_[0]-C,_[1]-E,_[2]+C,_[3]+E]},n.prototype.insideBBox=function(_,v){return p(_[0]-v[0])>=0&&p(_[0]-v[2])<=0&&_[1]>=v[1]&&_[1]<=v[3]},Object.defineProperties(n,s),n}();var wo=_r(vl.exports),Ia={exports:{}};Ia.exports=function(){var t=function(i,r){if(i===void 0&&(i=[]),r===void 0&&(r=e),this.data=i,this.length=this.data.length,this.compare=r,this.length>0)for(var n=(this.length>>1)-1;n>=0;n--)this._down(n)};function e(i,r){return i<r?-1:i>r?1:0}return t.prototype.push=function(i){this.data.push(i),this.length++,this._up(this.length-1)},t.prototype.pop=function(){if(this.length!==0){var i=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),i}},t.prototype.peek=function(){return this.data[0]},t.prototype._up=function(i){for(var r=this.data,n=this.compare,s=r[i];i>0;){var a=i-1>>1,c=r[a];if(n(s,c)>=0)break;r[i]=c,i=a}r[i]=s},t.prototype._down=function(i){for(var r=this.data,n=this.compare,s=this.length>>1,a=r[i];i<s;){var c=1+(i<<1),p=r[c],_=c+1;if(_<this.length&&n(r[_],p)<0&&(c=_,p=r[_]),n(p,a)>=0)break;r[i]=p,i=c}r[i]=a},t}();var Ol=_r(Ia.exports),Mt=8192;function nc(t,e){return e.dist-t.dist}const ll=100,Al=50;function Lc(t){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}function To(t){return t[1]-t[0]+1}function ha(t,e){const i=t[1]>=t[0]&&t[1]<e;return i||console.warn("Distance Expression: Index is out of range"),i}function Uo(t,e){if(t[0]>t[1])return[null,null];const i=To(t);if(e){if(i===2)return[t,null];const r=Math.floor(i/2);return[[t[0],t[0]+r],[t[0]+r,t[1]]]}{if(i===1)return[t,null];const r=Math.floor(i/2)-1;return[[t[0],t[0]+r],[t[0]+r+1,t[1]]]}}function Qa(t,e){const i=[1/0,1/0,-1/0,-1/0];if(!ha(e,t.length))return i;for(let r=e[0];r<=e[1];++r)ol(i,t[r]);return i}function NA(t){const e=[1/0,1/0,-1/0,-1/0];for(let i=0;i<t.length;++i)for(let r=0;r<t[i].length;++r)ol(e,t[i][r]);return e}function cl(t,e,i){if(Lc(t)||Lc(e))return NaN;let r=0,n=0;return t[2]<e[0]&&(r=e[0]-t[2]),t[0]>e[2]&&(r=t[0]-e[2]),t[1]>e[3]&&(n=t[1]-e[3]),t[3]<e[1]&&(n=e[1]-t[3]),i.distance([0,0],[r,n])}function sc(t,e){const i=Math.pow(2,e.z);return[(n=(t.x/Mt+e.x)/i,360*n-180),(r=(t.y/Mt+e.y)/i,360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90)];var r,n}function bl(t,e){const i=[];for(let r=0;r<t.length;++r)i.push(sc(t[r],e));return i}function UA(t,e,i){const r=i.pointOnLine(e,t).point;return i.distance(t,r)}function Vo(t,e,i,r,n){const s=i.slice(r[0],r[1]+1);let a=1/0;for(let c=e[0];c<=e[1];++c)if((a=Math.min(a,UA(t[c],s,n)))===0)return 0;return a}function ia(t,e,i,r,n){const s=Math.min(n.pointToSegmentDistance(t,i,r),n.pointToSegmentDistance(e,i,r)),a=Math.min(n.pointToSegmentDistance(i,t,e),n.pointToSegmentDistance(r,t,e));return Math.min(s,a)}function Ca(t,e,i,r,n){if(!ha(e,t.length)||!ha(r,i.length))return NaN;let s=1/0;for(let a=e[0];a<e[1];++a)for(let c=r[0];c<r[1];++c){if(po(t[a],t[a+1],i[c],i[c+1]))return 0;s=Math.min(s,ia(t[a],t[a+1],i[c],i[c+1],n))}return s}function ul(t,e,i,r,n){if(!ha(e,t.length)||!ha(r,i.length))return NaN;let s=1/0;for(let a=e[0];a<=e[1];++a)for(let c=r[0];c<=r[1];++c)if((s=Math.min(s,n.distance(t[a],i[c])))===0)return s;return s}function wl(t,e,i){if(Os(t,e,!0))return 0;let r=1/0;for(const n of e){const s=n.length;if(s<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(n[0]!==n[s-1]&&(r=Math.min(r,i.pointToSegmentDistance(t,n[s-1],n[0])))===0||(r=Math.min(r,UA(t,n,i)))===0)return r}return r}function ku(t,e,i,r){if(!ha(e,t.length))return NaN;for(let s=e[0];s<=e[1];++s)if(Os(t[s],i,!0))return 0;let n=1/0;for(let s=e[0];s<e[1];++s)for(const a of i)for(let c=0,p=a.length,_=p-1;c<p;_=c++){if(po(t[s],t[s+1],a[_],a[c]))return 0;n=Math.min(n,ia(t[s],t[s+1],a[_],a[c],r))}return n}function oc(t,e){for(const i of t)for(let r=0;r<=i.length-1;++r)if(Os(i[r],e,!0))return!0;return!1}function au(t,e,i,r=1/0){const n=NA(t),s=NA(e);if(r!==1/0&&cl(n,s,i)>=r)return r;if(Za(n,s)){if(oc(t,e))return 0}else if(oc(e,t))return 0;let a=r;for(const c of t)for(let p=0,_=c.length,v=_-1;p<_;v=p++)for(const E of e)for(let C=0,B=E.length,O=B-1;C<B;O=C++){if(po(c[v],c[p],E[O],E[C]))return 0;a=Math.min(a,ia(c[v],c[p],E[O],E[C],i))}return a}function rA(t,e,i,r,n,s,a){if(s===null||a===null)return;const c=cl(Qa(r,s),Qa(n,a),i);c<e&&t.push({dist:c,range1:s,range2:a})}function hl(t,e,i,r,n=1/0){let s=Math.min(r.distance(t[0],i[0][0]),n);if(s===0)return s;const a=new Ol([{dist:0,range1:[0,t.length-1],range2:[0,0]}],nc),c=e?Al:ll,p=NA(i);for(;a.length;){const _=a.pop();if(_.dist>=s)continue;const v=_.range1;if(To(v)<=c){if(!ha(v,t.length))return NaN;if(e){const E=ku(t,v,i,r);if((s=Math.min(s,E))===0)return s}else for(let E=v[0];E<=v[1];++E){const C=wl(t[E],i,r);if((s=Math.min(s,C))===0)return s}}else{const E=Uo(v,e);if(E[0]!==null){const C=cl(Qa(t,E[0]),p,r);C<s&&a.push({dist:C,range1:E[0],range2:[0,0]})}if(E[1]!==null){const C=cl(Qa(t,E[1]),p,r);C<s&&a.push({dist:C,range1:E[1],range2:[0,0]})}}}return s}function Ha(t,e,i,r,n,s=1/0){let a=Math.min(s,n.distance(t[0],i[0]));if(a===0)return a;const c=new Ol([{dist:0,range1:[0,t.length-1],range2:[0,i.length-1]}],nc),p=e?Al:ll,_=r?Al:ll;for(;c.length;){const v=c.pop();if(v.dist>=a)continue;const E=v.range1,C=v.range2;if(To(E)<=p&&To(C)<=_){if(!ha(E,t.length)||!ha(C,i.length))return NaN;if(e&&r?a=Math.min(a,Ca(t,E,i,C,n)):e||r?e&&!r?a=Math.min(a,Vo(i,C,t,E,n)):!e&&r&&(a=Math.min(a,Vo(t,E,i,C,n))):a=Math.min(a,ul(t,E,i,C,n)),a===0)return a}else{const B=Uo(E,e),O=Uo(C,r);rA(c,a,n,t,i,B[0],O[0]),rA(c,a,n,t,i,B[0],O[1]),rA(c,a,n,t,i,B[1],O[0]),rA(c,a,n,t,i,B[1],O[1])}}return a}function Fi(t,e,i,r,n=1/0){let s=n;const a=Qa(t,[0,t.length-1]);for(const c of i)if(!(s!==1/0&&cl(a,Qa(c,[0,c.length-1]),r)>=s)&&(s=Math.min(s,Ha(t,e,c,!0,r,s)),s===0))return s;return s}function jo(t,e,i,r,n=1/0){let s=n;const a=Qa(t,[0,t.length-1]);for(const c of i){if(s!==1/0&&cl(a,NA(c),r)>=s)continue;const p=hl(t,e,c,r,s);if(isNaN(p))return p;if((s=Math.min(s,p))===0)return s}return s}function Wa(t){return t==="Point"||t==="MultiPoint"||t==="LineString"||t==="MultiLineString"||t==="Polygon"||t==="MultiPolygon"}class fl{constructor(e,i){this.type=Wt,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(tA(e[1])){const r=e[1];if(r.type==="FeatureCollection"){for(let n=0;n<r.features.length;++n)if(Wa(r.features[n].geometry.type))return new fl(r,r.features[n].geometry)}else if(r.type==="Feature"){if(Wa(r.geometry.type))return new fl(r,r.geometry)}else if(Wa(r.type))return new fl(r,r)}return i.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const i=e.geometry(),r=e.canonicalID();if(i!=null&&r!=null){if(e.geometryType()==="Point")return function(n,s,a){const c=[];for(const _ of n)for(const v of _)c.push(sc(v,s));const p=new wo(c[0][1],"meters");return a.type==="Point"||a.type==="MultiPoint"||a.type==="LineString"?Ha(c,!1,a.type==="Point"?[a.coordinates]:a.coordinates,a.type==="LineString",p):a.type==="MultiLineString"?Fi(c,!1,a.coordinates,p):a.type==="Polygon"||a.type==="MultiPolygon"?jo(c,!1,a.type==="Polygon"?[a.coordinates]:a.coordinates,p):null}(i,r,this.geometries);if(e.geometryType()==="LineString")return function(n,s,a){const c=[];for(const _ of n){const v=[];for(const E of _)v.push(sc(E,s));c.push(v)}const p=new wo(c[0][0][1],"meters");if(a.type==="Point"||a.type==="MultiPoint"||a.type==="LineString")return Fi(a.type==="Point"?[a.coordinates]:a.coordinates,a.type==="LineString",c,p);if(a.type==="MultiLineString"){let _=1/0;for(let v=0;v<a.coordinates.length;v++){const E=Fi(a.coordinates[v],!0,c,p,_);if(isNaN(E))return E;if((_=Math.min(_,E))===0)return _}return _}if(a.type==="Polygon"||a.type==="MultiPolygon"){let _=1/0;for(let v=0;v<c.length;v++){const E=jo(c[v],!0,a.type==="Polygon"?[a.coordinates]:a.coordinates,p,_);if(isNaN(E))return E;if((_=Math.min(_,E))===0)return _}return _}return null}(i,r,this.geometries);if(e.geometryType()==="Polygon")return function(n,s,a){const c=[];for(const _ of function(v,E){const C=v.length;if(C<=1)return[v];const B=[];let O,G;for(let q=0;q<C;q++){const X=gA(v[q]);X!==0&&(v[q].area=Math.abs(X),G===void 0&&(G=X<0),G===X<0?(O&&B.push(O),O=[v[q]]):O.push(v[q]))}return O&&B.push(O),B}(n)){const v=[];for(let E=0;E<_.length;++E)v.push(bl(_[E],s));c.push(v)}const p=new wo(c[0][0][0][1],"meters");if(a.type==="Point"||a.type==="MultiPoint"||a.type==="LineString")return jo(a.type==="Point"?[a.coordinates]:a.coordinates,a.type==="LineString",c,p);if(a.type==="MultiLineString"){let _=1/0;for(let v=0;v<a.coordinates.length;v++){const E=jo(a.coordinates[v],!0,c,p,_);if(isNaN(E))return E;if((_=Math.min(_,E))===0)return _}return _}return a.type==="Polygon"||a.type==="MultiPolygon"?function(_,v,E){let C=1/0;for(const B of _)for(const O of v){const G=au(B,O,E,C);if(isNaN(G))return G;if((C=Math.min(C,G))===0)return C}return C}(a.type==="Polygon"?[a.coordinates]:a.coordinates,c,p):null}(i,r,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}var ac=fl;function Ei(t){if(t instanceof No&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof al||t instanceof ac)return!1;let e=!0;return t.eachChild(i=>{e&&!Ei(i)&&(e=!1)}),e}function nA(t){if(t instanceof No&&t.name==="feature-state")return!1;let e=!0;return t.eachChild(i=>{e&&!nA(i)&&(e=!1)}),e}function VA(t){if(t instanceof No&&t.name==="config")return!1;let e=!0;return t.eachChild(i=>{e&&!VA(i)&&(e=!1)}),e}function fa(t,e){if(t instanceof No&&e.indexOf(t.name)>=0)return!1;let i=!0;return t.eachChild(r=>{i&&!fa(r,e)&&(i=!1)}),i}class yA{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const r=e[1];return i.scope.has(r)?new yA(r,i.scope.get(r)):i.error(`Unknown variable "${r}". Make sure "${r}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var lc=yA;class jA{constructor(e,i=[],r,n=new pA,s=[],a){this.registry=e,this.path=i,this.key=i.map(c=>`[${c}]`).join(""),this.scope=n,this.errors=s,this.expectedType=r,this.options=a}parse(e,i,r,n,s={}){return i||r?this.concat(i,r,n)._parse(e,s):this._parse(e,s)}_parse(e,i){function r(n,s,a){return a==="assert"?new Ur(s,[n]):a==="coerce"?new Sn(s,[n]):n}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const n=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(n){let s=n.parse(e,this);if(!s)return null;if(this.expectedType){const a=this.expectedType,c=s.type;if(a.kind!=="string"&&a.kind!=="number"&&a.kind!=="boolean"&&a.kind!=="object"&&a.kind!=="array"||c.kind!=="value")if(a.kind!=="color"&&a.kind!=="formatted"&&a.kind!=="resolvedImage"||c.kind!=="value"&&c.kind!=="string"){if(this.checkSubtype(a,c))return null}else s=r(s,a,i.typeAnnotation||"coerce");else s=r(s,a,i.typeAnnotation||"assert")}if(!(s instanceof qs)&&s.type.kind!=="resolvedImage"&&ks(s)){const a=new zc(this.options);try{s=new qs(s.type,s.evaluate(a))}catch(c){return this.error(c.message),null}}return s}return Sn.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,r){const n=typeof e=="number"?this.path.concat(e):this.path,s=r?this.scope.concat(r):this.scope;return new jA(this.registry,n,i||null,s,this.errors,this.options)}error(e,...i){const r=`${this.key}${i.map(n=>`[${n}]`).join("")}`;this.errors.push(new Oo(r,e))}checkSubtype(e,i){const r=Zs(e,i);return r&&this.error(r),r}}var Ac=jA;function ks(t){if(t instanceof lc)return ks(t.boundExpression);if(t instanceof No&&t.name==="error"||t instanceof No&&t.name==="config"||t instanceof yl||t instanceof al||t instanceof ac)return!1;const e=t instanceof Sn||t instanceof Ur;let i=!0;return t.eachChild(r=>{i=e?i&&ks(r):i&&r instanceof qs}),!!i&&Ei(t)&&fa(t,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light"])}function xA(t,e){const i=t.length-1;let r,n,s=0,a=i,c=0;for(;s<=a;)if(c=Math.floor((s+a)/2),r=t[c],n=t[c+1],r<=e){if(c===i||e<n)return c;s=c+1}else{if(!(r>e))throw new fs("Input is not a number.");a=c-1}return 0}class GA{constructor(e,i,r){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[n,s]of r)this.labels.push(n),this.outputs.push(s)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const r=i.parse(e[1],1,Wt);if(!r)return null;const n=[];let s=null;i.expectedType&&i.expectedType.kind!=="value"&&(s=i.expectedType);for(let a=1;a<e.length;a+=2){const c=a===1?-1/0:e[a],p=e[a+1],_=a,v=a+1;if(typeof c!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',_);if(n.length&&n[n.length-1][0]>=c)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',_);const E=i.parse(p,v,s);if(!E)return null;s=s||E.type,n.push([c,E])}return new GA(s,r,n)}evaluate(e){const i=this.labels,r=this.outputs;if(i.length===1)return r[0].evaluate(e);const n=this.input.evaluate(e);if(n<=i[0])return r[0].evaluate(e);const s=i.length;return n>=i[s-1]?r[s-1].evaluate(e):r[xA(i,n)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}var ZA=GA;function Ki(t,e,i){return t*(1-i)+e*i}function Po(t,e,i){return t.map((r,n)=>Ki(r,e[n],i))}var ka=Object.freeze({__proto__:null,array:Po,color:function(t,e,i){return new fr(Ki(t.r,e.r,i),Ki(t.g,e.g,i),Ki(t.b,e.b,i),Ki(t.a,e.a,i))},number:Ki});const sA=.95047,cc=1.08883,oA=4/29,Tl=6/29,Ds=3*Tl*Tl,da=Tl*Tl*Tl,Qn=Math.PI/180,Eo=180/Math.PI;function pr(t){return t>da?Math.pow(t,1/3):t/Ds+oA}function ra(t){return t>Tl?t*t*t:Ds*(t-oA)}function uc(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Nl(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function hc(t){const e=Nl(t.r),i=Nl(t.g),r=Nl(t.b),n=pr((.4124564*e+.3575761*i+.1804375*r)/sA),s=pr((.2126729*e+.7151522*i+.072175*r)/1);return{l:116*s-16,a:500*(n-s),b:200*(s-pr((.0193339*e+.119192*i+.9503041*r)/cc)),alpha:t.a}}function Mo(t){let e=(t.l+16)/116,i=isNaN(t.a)?e:e+t.a/500,r=isNaN(t.b)?e:e-t.b/200;return e=1*ra(e),i=sA*ra(i),r=cc*ra(r),new fr(uc(3.2404542*i-1.5371385*e-.4985314*r),uc(-.969266*i+1.8760108*e+.041556*r),uc(.0556434*i-.2040259*e+1.0572252*r),t.alpha)}function Da(t,e,i){const r=e-t;return t+i*(r>180||r<-180?r-360*Math.round(r/360):r)}const Nt={forward:hc,reverse:Mo,interpolate:function(t,e,i){return{l:Ki(t.l,e.l,i),a:Ki(t.a,e.a,i),b:Ki(t.b,e.b,i),alpha:Ki(t.alpha,e.alpha,i)}}},Kt={forward:function(t){const{l:e,a:i,b:r}=hc(t),n=Math.atan2(r,i)*Eo;return{h:n<0?n+360:n,c:Math.sqrt(i*i+r*r),l:e,alpha:t.a}},reverse:function(t){const e=t.h*Qn,i=t.c;return Mo({l:t.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:t.alpha})},interpolate:function(t,e,i){return{h:Da(t.h,e.h,i),c:Ki(t.c,e.c,i),l:Ki(t.l,e.l,i),alpha:Ki(t.alpha,e.alpha,i)}}};var aA=Object.freeze({__proto__:null,hcl:Kt,lab:Nt});class El{constructor(e,i,r,n,s){this.type=e,this.operator=i,this.interpolation=r,this.input=n,this.labels=[],this.outputs=[];for(const[a,c]of s)this.labels.push(a),this.outputs.push(c)}static interpolationFactor(e,i,r,n){let s=0;if(e.name==="exponential")s=Ul(i,e.base,r,n);else if(e.name==="linear")s=Ul(i,1,r,n);else if(e.name==="cubic-bezier"){const a=e.controlPoints;s=new Ls(a[0],a[1],a[2],a[3]).solve(Ul(i,1,r,n))}return s}static parse(e,i){let[r,n,s,...a]=e;if(!Array.isArray(n)||n.length===0)return i.error("Expected an interpolation type expression.",1);if(n[0]==="linear")n={name:"linear"};else if(n[0]==="exponential"){const _=n[1];if(typeof _!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);n={name:"exponential",base:_}}else{if(n[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(n[0])}`,1,0);{const _=n.slice(1);if(_.length!==4||_.some(v=>typeof v!="number"||v<0||v>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);n={name:"cubic-bezier",controlPoints:_}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(s=i.parse(s,2,Wt),!s)return null;const c=[];let p=null;r==="interpolate-hcl"||r==="interpolate-lab"?p=tn:i.expectedType&&i.expectedType.kind!=="value"&&(p=i.expectedType);for(let _=0;_<a.length;_+=2){const v=a[_],E=a[_+1],C=_+3,B=_+4;if(typeof v!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',C);if(c.length&&c[c.length-1][0]>=v)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',C);const O=i.parse(E,B,p);if(!O)return null;p=p||O.type,c.push([v,O])}return p.kind==="number"||p.kind==="color"||p.kind==="array"&&p.itemType.kind==="number"&&typeof p.N=="number"?new El(p,r,n,s,c):i.error(`Type ${Jn(p)} is not interpolatable.`)}evaluate(e){const i=this.labels,r=this.outputs;if(i.length===1)return r[0].evaluate(e);const n=this.input.evaluate(e);if(n<=i[0])return r[0].evaluate(e);const s=i.length;if(n>=i[s-1])return r[s-1].evaluate(e);const a=xA(i,n),c=El.interpolationFactor(this.interpolation,n,i[a],i[a+1]),p=r[a].evaluate(e),_=r[a+1].evaluate(e);return this.operator==="interpolate"?ka[this.type.kind.toLowerCase()](p,_,c):this.operator==="interpolate-hcl"?Kt.reverse(Kt.interpolate(Kt.forward(p),Kt.forward(_),c)):Nt.reverse(Nt.interpolate(Nt.forward(p),Nt.forward(_),c))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const i=[this.operator,e,this.input.serialize()];for(let r=0;r<this.labels.length;r++)i.push(this.labels[r],this.outputs[r].serialize());return i}}function Ul(t,e,i,r){const n=r-i,s=t-i;return n===0?0:e===1?s/n:(Math.pow(e,s)-1)/(Math.pow(e,n)-1)}var $r=El;class pa{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let r=null;const n=i.expectedType;n&&n.kind!=="value"&&(r=n);const s=[];for(const c of e.slice(1)){const p=i.parse(c,1+s.length,r,void 0,{typeAnnotation:"omit"});if(!p)return null;r=r||p.type,s.push(p)}const a=n&&s.some(c=>Zs(n,c.type));return new pa(a?Dr:r,s)}evaluate(e){let i,r=null,n=0;for(const s of this.args){if(n++,r=s.evaluate(e),r&&r instanceof fo&&!r.available&&(i||(i=r),r=null,n===this.args.length))return i;if(r!==null)break}return r}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}var Hn=pa;class x{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const r=[];for(let s=1;s<e.length-1;s+=2){const a=e[s];if(typeof a!="string")return i.error(`Expected string, but found ${typeof a} instead.`,s);if(/[^a-zA-Z0-9_]/.test(a))return i.error("Variable names must contain only alphanumeric characters or '_'.",s);const c=i.parse(e[s+1],s+1);if(!c)return null;r.push([a,c])}const n=i.parse(e[e.length-1],e.length-1,i.expectedType,r);return n?new x(r,n):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,r]of this.bindings)e.push(i,r.serialize());return e.push(this.result.serialize()),e}}var T=x;class M{constructor(e,i,r){this.type=e,this.index=i,this.input=r}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const r=i.parse(e[1],1,Wt),n=i.parse(e[2],2,ho(i.expectedType||Dr));return r&&n?new M(n.type.itemType,r,n):null}evaluate(e){const i=this.index.evaluate(e),r=this.input.evaluate(e);if(i<0)throw new fs(`Array index out of bounds: ${i} < 0.`);if(i>=r.length)throw new fs(`Array index out of bounds: ${i} > ${r.length-1}.`);if(i!==Math.floor(i))throw new fs(`Array index must be an integer, but found ${i} instead.`);return r[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var L=M;class j{constructor(e,i){this.type=sr,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const r=i.parse(e[1],1,Dr),n=i.parse(e[2],2,Dr);return r&&n?wa(r.type,[sr,Ui,Wt,Kn,Dr])?new j(r,n):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Jn(r.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(r==null)return!1;if(!Bl(i,["boolean","string","number","null"]))throw new fs(`Expected first argument to be of type boolean, string, number or null, but found ${Jn(ms(i))} instead.`);if(!Bl(r,["string","array"]))throw new fs(`Expected second argument to be of type array or string, but found ${Jn(ms(r))} instead.`);return r.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var H=j;class Q{constructor(e,i,r){this.type=Wt,this.needle=e,this.haystack=i,this.fromIndex=r}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const r=i.parse(e[1],1,Dr),n=i.parse(e[2],2,Dr);if(!r||!n)return null;if(!wa(r.type,[sr,Ui,Wt,Kn,Dr]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Jn(r.type)} instead`);if(e.length===4){const s=i.parse(e[3],3,Wt);return s?new Q(r,n,s):null}return new Q(r,n)}evaluate(e){const i=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!Bl(i,["boolean","string","number","null"]))throw new fs(`Expected first argument to be of type boolean, string, number or null, but found ${Jn(ms(i))} instead.`);if(!Bl(r,["string","array"]))throw new fs(`Expected second argument to be of type array or string, but found ${Jn(ms(r))} instead.`);if(this.fromIndex){const n=this.fromIndex.evaluate(e);return r.indexOf(i,n)}return r.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var J=Q;class ue{constructor(e,i,r,n,s,a){this.inputType=e,this.type=i,this.input=r,this.cases=n,this.outputs=s,this.otherwise=a}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let r,n;i.expectedType&&i.expectedType.kind!=="value"&&(n=i.expectedType);const s={},a=[];for(let _=2;_<e.length-1;_+=2){let v=e[_];const E=e[_+1];Array.isArray(v)||(v=[v]);const C=i.concat(_);if(v.length===0)return C.error("Expected at least one branch label.");for(const O of v){if(typeof O!="number"&&typeof O!="string")return C.error("Branch labels must be numbers or strings.");if(typeof O=="number"&&Math.abs(O)>Number.MAX_SAFE_INTEGER)return C.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof O=="number"&&Math.floor(O)!==O)return C.error("Numeric branch labels must be integer values.");if(r){if(C.checkSubtype(r,ms(O)))return null}else r=ms(O);if(s[String(O)]!==void 0)return C.error("Branch labels must be unique.");s[String(O)]=a.length}const B=i.parse(E,_,n);if(!B)return null;n=n||B.type,a.push(B)}const c=i.parse(e[1],1,Dr);if(!c)return null;const p=i.parse(e[e.length-1],e.length-1,n);return p?c.type.kind!=="value"&&i.concat(1).checkSubtype(r,c.type)?null:new ue(r,n,c,s,a,p):null}evaluate(e){const i=this.input.evaluate(e);return(ms(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),r=[],n={};for(const a of i){const c=n[this.cases[a]];c===void 0?(n[this.cases[a]]=r.length,r.push([this.cases[a],[a]])):r[c][1].push(a)}const s=a=>this.inputType.kind==="number"?Number(a):a;for(const[a,c]of r)e.push(c.length===1?s(c[0]):c.map(s)),e.push(this.outputs[a].serialize());return e.push(this.otherwise.serialize()),e}}var Ce=ue;class ze{constructor(e,i,r){this.type=e,this.branches=i,this.otherwise=r}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let r;i.expectedType&&i.expectedType.kind!=="value"&&(r=i.expectedType);const n=[];for(let a=1;a<e.length-1;a+=2){const c=i.parse(e[a],a,sr);if(!c)return null;const p=i.parse(e[a+1],a+1,r);if(!p)return null;n.push([c,p]),r=r||p.type}const s=i.parse(e[e.length-1],e.length-1,r);return s?new ze(r,n,s):null}evaluate(e){for(const[i,r]of this.branches)if(i.evaluate(e))return r.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,r]of this.branches)e(i),e(r);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}var _t=ze;class Xe{constructor(e,i,r,n){this.type=e,this.input=i,this.beginIndex=r,this.endIndex=n}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const r=i.parse(e[1],1,Dr),n=i.parse(e[2],2,Wt);if(!r||!n)return null;if(!wa(r.type,[ho(Dr),Ui,Dr]))return i.error(`Expected first argument to be of type array or string, but found ${Jn(r.type)} instead`);if(e.length===4){const s=i.parse(e[3],3,Wt);return s?new Xe(r.type,r,n,s):null}return new Xe(r.type,r,n)}evaluate(e){const i=this.input.evaluate(e),r=this.beginIndex.evaluate(e);if(!Bl(i,["string","array"]))throw new fs(`Expected first argument to be of type array or string, but found ${Jn(ms(i))} instead.`);if(this.endIndex){const n=this.endIndex.evaluate(e);return i.slice(r,n)}return i.slice(r)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var it=Xe;function z(t,e){return t==="=="||t==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function l(t,e,i,r){return r.compare(e,i)===0}function g(t,e,i){const r=t!=="=="&&t!=="!=";return class Hw{constructor(s,a,c){this.type=sr,this.lhs=s,this.rhs=a,this.collator=c,this.hasUntypedArgument=s.type.kind==="value"||a.type.kind==="value"}static parse(s,a){if(s.length!==3&&s.length!==4)return a.error("Expected two or three arguments.");const c=s[0];let p=a.parse(s[1],1,Dr);if(!p)return null;if(!z(c,p.type))return a.concat(1).error(`"${c}" comparisons are not supported for type '${Jn(p.type)}'.`);let _=a.parse(s[2],2,Dr);if(!_)return null;if(!z(c,_.type))return a.concat(2).error(`"${c}" comparisons are not supported for type '${Jn(_.type)}'.`);if(p.type.kind!==_.type.kind&&p.type.kind!=="value"&&_.type.kind!=="value")return a.error(`Cannot compare types '${Jn(p.type)}' and '${Jn(_.type)}'.`);r&&(p.type.kind==="value"&&_.type.kind!=="value"?p=new Ur(_.type,[p]):p.type.kind!=="value"&&_.type.kind==="value"&&(_=new Ur(p.type,[_])));let v=null;if(s.length===4){if(p.type.kind!=="string"&&_.type.kind!=="string"&&p.type.kind!=="value"&&_.type.kind!=="value")return a.error("Cannot use collator to compare non-string types.");if(v=a.parse(s[3],3,ba),!v)return null}return new Hw(p,_,v)}evaluate(s){const a=this.lhs.evaluate(s),c=this.rhs.evaluate(s);if(r&&this.hasUntypedArgument){const p=ms(a),_=ms(c);if(p.kind!==_.kind||p.kind!=="string"&&p.kind!=="number")throw new fs(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${p.kind}, ${_.kind}) instead.`)}if(this.collator&&!r&&this.hasUntypedArgument){const p=ms(a),_=ms(c);if(p.kind!=="string"||_.kind!=="string")return e(s,a,c)}return this.collator?i(s,a,c,this.collator.evaluate(s)):e(s,a,c)}eachChild(s){s(this.lhs),s(this.rhs),this.collator&&s(this.collator)}outputDefined(){return!0}serialize(){const s=[t];return this.eachChild(a=>{s.push(a.serialize())}),s}}}const S=g("==",function(t,e,i){return e===i},l),k=g("!=",function(t,e,i){return e!==i},function(t,e,i,r){return!l(0,e,i,r)}),F=g("<",function(t,e,i){return e<i},function(t,e,i,r){return r.compare(e,i)<0}),Z=g(">",function(t,e,i){return e>i},function(t,e,i,r){return r.compare(e,i)>0}),u=g("<=",function(t,e,i){return e<=i},function(t,e,i,r){return r.compare(e,i)<=0}),h=g(">=",function(t,e,i){return e>=i},function(t,e,i,r){return r.compare(e,i)>=0});class d{constructor(e,i,r,n,s,a){this.type=Ui,this.number=e,this.locale=i,this.currency=r,this.unit=n,this.minFractionDigits=s,this.maxFractionDigits=a}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const r=i.parse(e[1],1,Wt);if(!r)return null;const n=e[2];if(typeof n!="object"||Array.isArray(n))return i.error("NumberFormat options argument must be an object.");let s=null;if(n.locale&&(s=i.parse(n.locale,1,Ui),!s))return null;let a=null;if(n.currency&&(a=i.parse(n.currency,1,Ui),!a))return null;let c=null;if(n.unit&&(c=i.parse(n.unit,1,Ui),!c))return null;let p=null;if(n["min-fraction-digits"]&&(p=i.parse(n["min-fraction-digits"],1,Wt),!p))return null;let _=null;return n["max-fraction-digits"]&&(_=i.parse(n["max-fraction-digits"],1,Wt),!_)?null:new d(r,s,a,c,p,_)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class y{constructor(e){this.type=Wt,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const r=i.parse(e[1],1);return r?r.type.kind!=="array"&&r.type.kind!=="string"&&r.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${Jn(r.type)} instead.`):new y(r):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new fs(`Expected value to be of type string or array, but found ${Jn(ms(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}function b(t){return function(){t=1831565813+(t|=0)|0;let e=Math.imul(t^t>>>15,1|t);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const I={"==":S,"!=":k,">":Z,"<":F,">=":h,"<=":u,array:Ur,at:L,boolean:Ur,case:_t,coalesce:Hn,collator:yl,format:$n,image:iA,in:H,"index-of":J,interpolate:$r,"interpolate-hcl":$r,"interpolate-lab":$r,length:y,let:T,literal:qs,match:Ce,number:Ur,"number-format":d,object:Ur,slice:it,step:ZA,string:Ur,"to-boolean":Sn,"to-color":Sn,"to-number":Sn,"to-string":Sn,var:lc,within:al,distance:ac};function R(t,[e,i,r,n]){e=e.evaluate(t),i=i.evaluate(t),r=r.evaluate(t);const s=n?n.evaluate(t):1,a=Ll(e,i,r,s);if(a)throw new fs(a);return new fr(e/255*s,i/255*s,r/255*s,s)}function N(t,[e,i,r,n]){e=e.evaluate(t),i=i.evaluate(t),r=r.evaluate(t);const s=n?n.evaluate(t):1,a=function(_,v,E,C){return typeof _=="number"&&_>=0&&_<=360?typeof v=="number"&&v>=0&&v<=100&&typeof E=="number"&&E>=0&&E<=100?C===void 0||typeof C=="number"&&C>=0&&C<=1?null:`Invalid hsla value [${[_,v,E,C].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof C=="number"?[_,v,E,C]:[_,v,E]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof C=="number"?[_,v,E,C]:[_,v,E]).join(", ")}]: 'h' must be between 0 and 360.`}(e,i,r,s);if(a)throw new fs(a);const c=`hsla(${e}, ${i}%, ${r}%, ${s})`,p=fr.parse(c);if(!p)throw new fs(`Failed to parse HSLA color: ${c}`);return p}function W(t,e){return t in e}function K(t,e){const i=e[t];return i===void 0?null:i}function le(t,e){switch(t){case"string":return String(e);case"number":return+e;case"boolean":return!!e;case"color":return fr.parse(e)}return e}function de(t,e,i,r){return r!==void 0&&(t=r*Math.round(t/r)),e!==void 0&&t<e&&(t=e),i!==void 0&&t>i&&(t=i),t}function ge(t,e,i){i.length&&(e+=`${i}`);const r=t.getConfig(e);if(!r)return null;const{type:n,value:s,values:a,minValue:c,maxValue:p,stepValue:_}=r,v=r.default.evaluate(t);let E=s?s.evaluate(t):v;return n&&(E=le(n,E)),s!==void 0&&E!==void 0&&a&&!a.includes(E)&&(E=v,n&&(E=le(n,E))),E===void 0||c===void 0&&p===void 0&&_===void 0||(typeof E=="number"?E=de(E,c,p,_):Array.isArray(E)&&(E=E.map(C=>typeof C=="number"?de(C,c,p,_):C))),E}function ke(t){return{type:t}}No.register(I,{error:[{kind:"error"},[Ui],(t,[e])=>{throw new fs(e.evaluate(t))}],typeof:[Ui,[Dr],(t,[e])=>Jn(ms(e.evaluate(t)))],"to-rgba":[ho(Wt,4),[tn],(t,[e])=>e.evaluate(t).toArray()],rgb:[tn,[Wt,Wt,Wt],R],rgba:[tn,[Wt,Wt,Wt,Wt],R],hsl:[tn,[Wt,Wt,Wt],N],hsla:[tn,[Wt,Wt,Wt,Wt],N],has:{type:sr,overloads:[[[Ui],(t,[e])=>W(e.evaluate(t),t.properties())],[[Ui,Aa],(t,[e,i])=>W(e.evaluate(t),i.evaluate(t))]]},get:{type:Dr,overloads:[[[Ui],(t,[e])=>K(e.evaluate(t),t.properties())],[[Ui,Aa],(t,[e,i])=>K(e.evaluate(t),i.evaluate(t))]]},config:{type:Dr,overloads:[[[Ui],(t,[e])=>ge(t,e.evaluate(t),"")],[[Ui,Ui],(t,[e,i])=>ge(t,e.evaluate(t),i.evaluate(t))]]},"feature-state":[Dr,[Ui],(t,[e])=>K(e.evaluate(t),t.featureState||{})],properties:[Aa,[],t=>t.properties()],"geometry-type":[Ui,[],t=>t.geometryType()],id:[Dr,[],t=>t.id()],zoom:[Wt,[],t=>t.globals.zoom],pitch:[Wt,[],t=>t.globals.pitch||0],"distance-from-center":[Wt,[],t=>t.distanceFromCenter()],"measure-light":[Wt,[Ui],(t,[e])=>t.measureLight(e.evaluate(t))],"heatmap-density":[Wt,[],t=>t.globals.heatmapDensity||0],"line-progress":[Wt,[],t=>t.globals.lineProgress||0],"raster-value":[Wt,[],t=>t.globals.rasterValue||0],"sky-radial-progress":[Wt,[],t=>t.globals.skyRadialProgress||0],accumulated:[Dr,[],t=>t.globals.accumulated===void 0?null:t.globals.accumulated],"+":[Wt,ke(Wt),(t,e)=>{let i=0;for(const r of e)i+=r.evaluate(t);return i}],"*":[Wt,ke(Wt),(t,e)=>{let i=1;for(const r of e)i*=r.evaluate(t);return i}],"-":{type:Wt,overloads:[[[Wt,Wt],(t,[e,i])=>e.evaluate(t)-i.evaluate(t)],[[Wt],(t,[e])=>-e.evaluate(t)]]},"/":[Wt,[Wt,Wt],(t,[e,i])=>e.evaluate(t)/i.evaluate(t)],"%":[Wt,[Wt,Wt],(t,[e,i])=>e.evaluate(t)%i.evaluate(t)],ln2:[Wt,[],()=>Math.LN2],pi:[Wt,[],()=>Math.PI],e:[Wt,[],()=>Math.E],"^":[Wt,[Wt,Wt],(t,[e,i])=>Math.pow(e.evaluate(t),i.evaluate(t))],sqrt:[Wt,[Wt],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[Wt,[Wt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[Wt,[Wt],(t,[e])=>Math.log(e.evaluate(t))],log2:[Wt,[Wt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[Wt,[Wt],(t,[e])=>Math.sin(e.evaluate(t))],cos:[Wt,[Wt],(t,[e])=>Math.cos(e.evaluate(t))],tan:[Wt,[Wt],(t,[e])=>Math.tan(e.evaluate(t))],asin:[Wt,[Wt],(t,[e])=>Math.asin(e.evaluate(t))],acos:[Wt,[Wt],(t,[e])=>Math.acos(e.evaluate(t))],atan:[Wt,[Wt],(t,[e])=>Math.atan(e.evaluate(t))],min:[Wt,ke(Wt),(t,e)=>Math.min(...e.map(i=>i.evaluate(t)))],max:[Wt,ke(Wt),(t,e)=>Math.max(...e.map(i=>i.evaluate(t)))],abs:[Wt,[Wt],(t,[e])=>Math.abs(e.evaluate(t))],round:[Wt,[Wt],(t,[e])=>{const i=e.evaluate(t);return i<0?-Math.round(-i):Math.round(i)}],floor:[Wt,[Wt],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[Wt,[Wt],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[sr,[Ui,Dr],(t,[e,i])=>t.properties()[e.value]===i.value],"filter-id-==":[sr,[Dr],(t,[e])=>t.id()===e.value],"filter-type-==":[sr,[Ui],(t,[e])=>t.geometryType()===e.value],"filter-<":[sr,[Ui,Dr],(t,[e,i])=>{const r=t.properties()[e.value],n=i.value;return typeof r==typeof n&&r<n}],"filter-id-<":[sr,[Dr],(t,[e])=>{const i=t.id(),r=e.value;return typeof i==typeof r&&i<r}],"filter->":[sr,[Ui,Dr],(t,[e,i])=>{const r=t.properties()[e.value],n=i.value;return typeof r==typeof n&&r>n}],"filter-id->":[sr,[Dr],(t,[e])=>{const i=t.id(),r=e.value;return typeof i==typeof r&&i>r}],"filter-<=":[sr,[Ui,Dr],(t,[e,i])=>{const r=t.properties()[e.value],n=i.value;return typeof r==typeof n&&r<=n}],"filter-id-<=":[sr,[Dr],(t,[e])=>{const i=t.id(),r=e.value;return typeof i==typeof r&&i<=r}],"filter->=":[sr,[Ui,Dr],(t,[e,i])=>{const r=t.properties()[e.value],n=i.value;return typeof r==typeof n&&r>=n}],"filter-id->=":[sr,[Dr],(t,[e])=>{const i=t.id(),r=e.value;return typeof i==typeof r&&i>=r}],"filter-has":[sr,[Dr],(t,[e])=>e.value in t.properties()],"filter-has-id":[sr,[],t=>t.id()!==null&&t.id()!==void 0],"filter-type-in":[sr,[ho(Ui)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[sr,[ho(Dr)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[sr,[Ui,ho(Dr)],(t,[e,i])=>i.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[sr,[Ui,ho(Dr)],(t,[e,i])=>function(r,n,s,a){for(;s<=a;){const c=s+a>>1;if(n[c]===r)return!0;n[c]>r?a=c-1:s=c+1}return!1}(t.properties()[e.value],i.value,0,i.value.length-1)],all:{type:sr,overloads:[[[sr,sr],(t,[e,i])=>e.evaluate(t)&&i.evaluate(t)],[ke(sr),(t,e)=>{for(const i of e)if(!i.evaluate(t))return!1;return!0}]]},any:{type:sr,overloads:[[[sr,sr],(t,[e,i])=>e.evaluate(t)||i.evaluate(t)],[ke(sr),(t,e)=>{for(const i of e)if(i.evaluate(t))return!0;return!1}]]},"!":[sr,[sr],(t,[e])=>!e.evaluate(t)],"is-supported-script":[sr,[Ui],(t,[e])=>{const i=t.globals&&t.globals.isSupportedScript;return!i||i(e.evaluate(t))}],upcase:[Ui,[Ui],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[Ui,[Ui],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[Ui,ke(Dr),(t,e)=>e.map(i=>Ea(i.evaluate(t))).join("")],"resolved-locale":[Ui,[ba],(t,[e])=>e.evaluate(t).resolvedLocale()],random:[Wt,[Wt,Wt,Dr],(t,e)=>{const[i,r,n]=e.map(a=>a.evaluate(t));if(i>r||i===r)return i;let s;if(typeof n=="string")s=function(a){let c=0;if(a.length===0)return c;for(let p=0;p<a.length;p++)c=(c<<5)-c+a.charCodeAt(p),c&=c;return c}(n);else{if(typeof n!="number")throw new fs(`Invalid seed input: ${n}`);s=n}return i+b(s)()*(r-i)}]});var Pe=I;function qe(t){return{result:"success",value:t}}function ht(t){return{result:"error",value:t}}function mt(t,e){return!!t&&!!t.parameters&&t.parameters.indexOf(e)>-1}function ot(t){return t["property-type"]==="data-driven"}function ft(t){return mt(t.expression,"measure-light")}function dt(t){return mt(t.expression,"zoom")}function ai(t){return!!t.expression&&t.expression.interpolated}function Ut(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function Xt(t){return t}function qt(t,e){const i=e.type==="color",r=t.stops&&typeof t.stops[0][0]=="object",n=r||!(r||t.property!==void 0),s=t.type||(ai(e)?"exponential":"interval");if(i&&((t=$o({},t)).stops&&(t.stops=t.stops.map(_=>[_[0],fr.parse(_[1])])),t.default=fr.parse(t.default?t.default:e.default)),t.colorSpace&&t.colorSpace!=="rgb"&&!aA[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let a,c,p;if(s==="exponential")a=Li;else if(s==="interval")a=ji;else if(s==="categorical"){a=qi,c=Object.create(null);for(const _ of t.stops)c[_[0]]=_[1];p=typeof t.stops[0][0]}else{if(s!=="identity")throw new Error(`Unknown function type "${s}"`);a=ir}if(r){const _={},v=[];for(let B=0;B<t.stops.length;B++){const O=t.stops[B],G=O[0].zoom;_[G]===void 0&&(_[G]={zoom:G,type:t.type,property:t.property,default:t.default,stops:[]},v.push(G)),_[G].stops.push([O[0].value,O[1]])}const E=[];for(const B of v)E.push([_[B].zoom,qt(_[B],e)]);const C={name:"linear"};return{kind:"composite",interpolationType:C,interpolationFactor:$r.interpolationFactor.bind(void 0,C),zoomStops:E.map(B=>B[0]),evaluate:({zoom:B},O)=>Li({stops:E,base:t.base},e,B).evaluate(B,O)}}if(n){const _=s==="exponential"?{name:"exponential",base:t.base!==void 0?t.base:1}:null;return{kind:"camera",interpolationType:_,interpolationFactor:$r.interpolationFactor.bind(void 0,_),zoomStops:t.stops.map(v=>v[0]),evaluate:({zoom:v})=>a(t,e,v,c,p)}}return{kind:"source",evaluate(_,v){const E=v&&v.properties?v.properties[t.property]:void 0;return E===void 0?or(t.default,e.default):a(t,e,E,c,p)}}}function or(t,e,i){return t!==void 0?t:e!==void 0?e:i!==void 0?i:void 0}function qi(t,e,i,r,n){return or(typeof i===n?r[i]:void 0,t.default,e.default)}function ji(t,e,i){if(Vi(i)!=="number")return or(t.default,e.default);const r=t.stops.length;if(r===1||i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[r-1][0])return t.stops[r-1][1];const n=xA(t.stops.map(s=>s[0]),i);return t.stops[n][1]}function Li(t,e,i){const r=t.base!==void 0?t.base:1;if(Vi(i)!=="number")return or(t.default,e.default);const n=t.stops.length;if(n===1||i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[n-1][0])return t.stops[n-1][1];const s=xA(t.stops.map(v=>v[0]),i),a=function(v,E,C,B){const O=B-C,G=v-C;return O===0?0:E===1?G/O:(Math.pow(E,G)-1)/(Math.pow(E,O)-1)}(i,r,t.stops[s][0],t.stops[s+1][0]),c=t.stops[s][1],p=t.stops[s+1][1];let _=ka[e.type]||Xt;if(t.colorSpace&&t.colorSpace!=="rgb"){const v=aA[t.colorSpace];_=(E,C)=>v.reverse(v.interpolate(v.forward(E),v.forward(C),a))}return typeof c.evaluate=="function"?{evaluate(...v){const E=c.evaluate.apply(void 0,v),C=p.evaluate.apply(void 0,v);if(E!==void 0&&C!==void 0)return _(E,C,a)}}:_(c,p,a)}function ir(t,e,i){return e.type==="color"?i=fr.parse(i):e.type==="formatted"?i=vo.fromString(i.toString()):e.type==="resolvedImage"?i=fo.fromString(i.toString()):Vi(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),or(i,t.default,e.default)}class Ji{constructor(e,i,r){this.expression=e,this._warningHistory={},this._evaluator=new zc(r),this._defaultValue=i?function(n){return n.type==="color"&&(Ut(n.default)||Array.isArray(n.default))?new fr(0,0,0,0):n.type==="color"?fr.parse(n.default)||null:n.default===void 0?null:n.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null}evaluateWithoutErrorHandling(e,i,r,n,s,a,c,p){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=r,this._evaluator.canonical=n||null,this._evaluator.availableImages=s||null,this._evaluator.formattedSection=a,this._evaluator.featureTileCoord=c||null,this._evaluator.featureDistanceData=p||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,r,n,s,a,c,p){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=r||null,this._evaluator.canonical=n||null,this._evaluator.availableImages=s||null,this._evaluator.formattedSection=a||null,this._evaluator.featureTileCoord=c||null,this._evaluator.featureDistanceData=p||null;try{const _=this.expression.evaluate(this._evaluator);if(_==null||typeof _=="number"&&_!=_)return this._defaultValue;if(this._enumValues&&!(_ in this._enumValues))throw new fs(`Expected value to be one of ${Object.keys(this._enumValues).map(v=>JSON.stringify(v)).join(", ")}, but found ${JSON.stringify(_)} instead.`);return _}catch(_){return this._warningHistory[_.message]||(this._warningHistory[_.message]=!0,typeof console<"u"&&console.warn(_.message)),this._defaultValue}}}function Or(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in Pe}function Xi(t,e,i){const r=new Ac(Pe,[],e?function(s){const a={color:tn,string:Ui,number:Wt,enum:Ui,boolean:sr,formatted:rl,resolvedImage:ca};return s.type==="array"?ho(a[s.value]||Dr,s.length):a[s.type]}(e):void 0,void 0,void 0,i),n=r.parse(t,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return n?qe(new Ji(n,e,i)):ht(r.errors)}class Lr{constructor(e,i,r){this.kind=e,this._styleExpression=i,this.isLightConstant=r,this.isStateDependent=e!=="constant"&&!nA(i.expression),this.isConfigDependent=!VA(i.expression)}evaluateWithoutErrorHandling(e,i,r,n,s,a){return this._styleExpression.evaluateWithoutErrorHandling(e,i,r,n,s,a)}evaluate(e,i,r,n,s,a){return this._styleExpression.evaluate(e,i,r,n,s,a)}}class Bn{constructor(e,i,r,n,s){this.kind=e,this.zoomStops=r,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!nA(i.expression),this.isLightConstant=s,this.isConfigDependent=!VA(i.expression),this.interpolationType=n}evaluateWithoutErrorHandling(e,i,r,n,s,a){return this._styleExpression.evaluateWithoutErrorHandling(e,i,r,n,s,a)}evaluate(e,i,r,n,s,a){return this._styleExpression.evaluate(e,i,r,n,s,a)}interpolationFactor(e,i,r){return this.interpolationType?$r.interpolationFactor(this.interpolationType,e,i,r):0}}function is(t,e,i){if((t=Xi(t,e,i)).result==="error")return t;const r=t.value.expression,n=Ei(r);if(!n&&!ot(e))return ht([new Oo("","data expressions not supported")]);const s=fa(r,["zoom","pitch","distance-from-center"]);if(!s&&!dt(e))return ht([new Oo("","zoom expressions not supported")]);const a=fa(r,["measure-light"]);if(!a&&!ft(e))return ht([new Oo("","measure-light expression not supported")]);const c=e.expression&&e.expression.relaxZoomRestriction,p=Sl(r);return p||s||c?p instanceof Oo?ht([p]):p instanceof $r&&!ai(e)?ht([new Oo("",'"interpolate" expressions cannot be used with this property')]):qe(p?new Bn(n?"camera":"composite",t.value,p.labels,p instanceof $r?p.interpolation:void 0,a):new Lr(n?"constant":"source",t.value,a)):ht([new Oo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Ml{constructor(e,i){this._parameters=e,this._specification=i,$o(this,qt(this._parameters,this._specification))}static deserialize(e){return new Ml(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Sl(t){let e=null;if(t instanceof T)e=Sl(t.result);else if(t instanceof Hn){for(const i of t.args)if(e=Sl(i),e)break}else(t instanceof ZA||t instanceof $r)&&t.input instanceof No&&t.input.name==="zoom"&&(e=t);return e instanceof Oo||t.eachChild(i=>{const r=Sl(i);r instanceof Oo?e=r:e&&r&&e!==r&&(e=new Oo("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function Go(t){const e=t.key,i=t.value,r=t.valueSpec||{},n=t.objectElementValidators||{},s=t.style,a=t.styleSpec;let c=[];const p=Vi(i);if(p!=="object")return[new gi(e,i,`object expected, ${p} found`)];for(const _ in i){const v=_.split(".")[0];let E;n[v]?E=n[v]:r[v]?E=_a:n["*"]?E=n["*"]:r["*"]&&(E=_a),E?c=c.concat(E({key:(e&&`${e}.`)+_,value:i[_],valueSpec:r[v]||r["*"],style:s,styleSpec:a,object:i,objectKey:_},i)):c.push(new Fo(e,i[_],`unknown property "${_}"`))}for(const _ in r)n[_]||r[_].required&&r[_].default===void 0&&i[_]===void 0&&c.push(new gi(e,i,`missing required property "${_}"`));return c}function fc(t){const e=t.value,i=t.valueSpec,r=t.style,n=t.styleSpec,s=t.key,a=t.arrayElementValidator||_a;if(Vi(e)!=="array")return[new gi(s,e,`array expected, ${Vi(e)} found`)];if(i.length&&e.length!==i.length)return[new gi(s,e,`array length ${i.length} expected, length ${e.length} found`)];if(i["min-length"]&&e.length<i["min-length"])return[new gi(s,e,`array length at least ${i["min-length"]} expected, length ${e.length} found`)];let c={type:i.value,values:i.values,minimum:i.minimum,maximum:i.maximum,function:void 0};n.$version<7&&(c.function=i.function),Vi(i.value)==="object"&&(c=i.value);let p=[];for(let _=0;_<e.length;_++)p=p.concat(a({array:e,arrayIndex:_,value:e[_],valueSpec:c,style:r,styleSpec:n,key:`${s}[${_}]`},!0));return p}function Rc(t){const e=t.key,i=t.value,r=t.valueSpec;let n=Vi(i);if(n==="number"&&i!=i&&(n="NaN"),n!=="number")return[new gi(e,i,`number expected, ${n} found`)];if("minimum"in r){let s=r.minimum;if(Vi(r.minimum)==="array"&&(s=r.minimum[t.arrayIndex]),i<s)return[new gi(e,i,`${i} is less than the minimum value ${s}`)]}if("maximum"in r){let s=r.maximum;if(Vi(r.maximum)==="array"&&(s=r.maximum[t.arrayIndex]),i>s)return[new gi(e,i,`${i} is greater than the maximum value ${s}`)]}return[]}function ma(t){const e=t.valueSpec,i=vn(t.value.type);let r,n,s,a={};const c=i!=="categorical"&&t.value.property===void 0,p=!c,_=Vi(t.value.stops)==="array"&&Vi(t.value.stops[0])==="array"&&Vi(t.value.stops[0][0])==="object",v=Go({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(B){if(i==="identity")return[new gi(B.key,B.value,'identity function may not have a "stops" property')];let O=[];const G=B.value;return O=O.concat(fc({key:B.key,value:G,valueSpec:B.valueSpec,style:B.style,styleSpec:B.styleSpec,arrayElementValidator:E})),Vi(G)==="array"&&G.length===0&&O.push(new gi(B.key,G,"array must have at least one stop")),O},default:function(B){return _a({key:B.key,value:B.value,valueSpec:e,style:B.style,styleSpec:B.styleSpec})}}});return i==="identity"&&c&&v.push(new gi(t.key,t.value,'missing required property "property"')),i==="identity"||t.value.stops||v.push(new gi(t.key,t.value,'missing required property "stops"')),i==="exponential"&&t.valueSpec.expression&&!ai(t.valueSpec)&&v.push(new gi(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(p&&!ot(t.valueSpec)?v.push(new gi(t.key,t.value,"property functions not supported")):c&&!dt(t.valueSpec)&&v.push(new gi(t.key,t.value,"zoom functions not supported"))),i!=="categorical"&&!_||t.value.property!==void 0||v.push(new gi(t.key,t.value,'"property" property is required')),v;function E(B){let O=[];const G=B.value,q=B.key;if(Vi(G)!=="array")return[new gi(q,G,`array expected, ${Vi(G)} found`)];if(G.length!==2)return[new gi(q,G,`array length 2 expected, length ${G.length} found`)];if(_){if(Vi(G[0])!=="object")return[new gi(q,G,`object expected, ${Vi(G[0])} found`)];if(G[0].zoom===void 0)return[new gi(q,G,"object stop key must have zoom")];if(G[0].value===void 0)return[new gi(q,G,"object stop key must have value")];const X=vn(G[0].zoom);if(typeof X!="number")return[new gi(q,G[0].zoom,"stop zoom values must be numbers")];if(s&&s>X)return[new gi(q,G[0].zoom,"stop zoom values must appear in ascending order")];X!==s&&(s=X,n=void 0,a={}),O=O.concat(Go({key:`${q}[0]`,value:G[0],valueSpec:{zoom:{}},style:B.style,styleSpec:B.styleSpec,objectElementValidators:{zoom:Rc,value:C}}))}else O=O.concat(C({key:`${q}[0]`,value:G[0],valueSpec:{},style:B.style,styleSpec:B.styleSpec},G));return Or(la(G[1]))?O.concat([new gi(`${q}[1]`,G[1],"expressions are not allowed in function stops.")]):O.concat(_a({key:`${q}[1]`,value:G[1],valueSpec:e,style:B.style,styleSpec:B.styleSpec}))}function C(B,O){const G=Vi(B.value),q=vn(B.value),X=B.value!==null?B.value:O;if(r){if(G!==r)return[new gi(B.key,X,`${G} stop domain type must match previous stop domain type ${r}`)]}else r=G;if(G!=="number"&&G!=="string"&&G!=="boolean"&&typeof q!="number"&&typeof q!="string"&&typeof q!="boolean")return[new gi(B.key,X,"stop domain value must be a number, string, or boolean")];if(G!=="number"&&i!=="categorical"){let $=`number expected, ${G} found`;return ot(e)&&i===void 0&&($+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new gi(B.key,X,$)]}return i!=="categorical"||G!=="number"||typeof q=="number"&&isFinite(q)&&Math.floor(q)===q?i!=="categorical"&&G==="number"&&typeof q=="number"&&typeof n=="number"&&n!==void 0&&q<n?[new gi(B.key,X,"stop domain values must appear in ascending order")]:(n=q,i==="categorical"&&q in a?[new gi(B.key,X,"stop domain values must be unique")]:(a[q]=!0,[])):[new gi(B.key,X,`integer expected, found ${String(q)}`)]}}function ro(t){const e=(t.expressionContext==="property"?is:Xi)(la(t.value),t.valueSpec);if(e.result==="error")return e.value.map(r=>new gi(`${t.key}${r.key}`,t.value,r.message));const i=e.value.expression||e.value._styleExpression.expression;if(t.expressionContext==="property"&&t.propertyKey==="text-font"&&!i.outputDefined())return[new gi(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if(t.expressionContext==="property"&&t.propertyType==="layout"&&!nA(i))return[new gi(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if(t.expressionContext==="filter")return Pa(i,t);if(t.expressionContext&&t.expressionContext.indexOf("cluster")===0){if(!fa(i,["zoom","feature-state"]))return[new gi(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(t.expressionContext==="cluster-initial"&&!Ei(i))return[new gi(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Pa(t,e){const i=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const n of e.valueSpec.expression.parameters)i.delete(n);if(i.size===0)return[];const r=[];return t instanceof No&&i.has(t.name)?[new gi(e.key,e.value,`["${t.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(t.eachChild(n=>{r.push(...Pa(n,e))}),r)}function vA(t){const e=t.key,i=t.value,r=t.valueSpec,n=[];return Array.isArray(r.values)?r.values.indexOf(vn(i))===-1&&n.push(new gi(e,i,`expected one of [${r.values.join(", ")}], ${JSON.stringify(i)} found`)):Object.keys(r.values).indexOf(vn(i))===-1&&n.push(new gi(e,i,`expected one of [${Object.keys(r.values).join(", ")}], ${JSON.stringify(i)} found`)),n}function Hs(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!Hs(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function mo(t,e="fill"){if(t==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Hs(t)||(t=Yu(t));const i=t;let r=!0;try{r=function(_){if(!Vl(_))return _;let v=la(_);return no(v),v=Xa(v),v}(i)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(i,null,2)}
        `)}const n=xt[`filter_${e}`],s=Xi(r,n);let a=null;if(s.result==="error")throw new Error(s.value.map(_=>`${_.key}: ${_.message}`).join(", "));a=(_,v,E)=>s.value.evaluate(_,v,{},E);let c=null,p=null;if(r!==i){const _=Xi(i,n);if(_.result==="error")throw new Error(_.value.map(v=>`${v.key}: ${v.message}`).join(", "));c=(v,E,C,B,O)=>_.value.evaluate(v,E,{},C,void 0,void 0,B,O),p=!Ei(_.value.expression)}return{filter:a,dynamicFilter:c||void 0,needGeometry:kh(r),needFeature:!!p}}function Xa(t){if(!Array.isArray(t))return t;const e=function(i){if(Xu.has(i[0])){for(let r=1;r<i.length;r++)if(Vl(i[r]))return!0}return i}(t);return e===!0?e:e.map(i=>Xa(i))}function no(t){let e=!1;const i=[];if(t[0]==="case"){for(let r=1;r<t.length-1;r+=2)e=e||Vl(t[r]),i.push(t[r+1]);i.push(t[t.length-1])}else if(t[0]==="match"){e=e||Vl(t[1]);for(let r=2;r<t.length-1;r+=2)i.push(t[r+1]);i.push(t[t.length-1])}else if(t[0]==="step"){e=e||Vl(t[1]);for(let r=1;r<t.length-1;r+=2)i.push(t[r+1])}e&&(t.length=0,t.push("any",...i));for(let r=1;r<t.length;r++)no(t[r])}function Vl(t){if(!Array.isArray(t))return!1;if((e=t[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<t.length;i++)if(Vl(t[i]))return!0;return!1}const Xu=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function pf(t,e){return t<e?-1:t>e?1:0}function kh(t){if(!Array.isArray(t))return!1;if(t[0]==="within"||t[0]==="distance")return!0;for(let e=1;e<t.length;e++)if(kh(t[e]))return!0;return!1}function Yu(t){if(!t)return!0;const e=t[0];return t.length<=1?e!=="any":e==="=="?Du(t[1],t[2],"=="):e==="!="?Il(Du(t[1],t[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Du(t[1],t[2],e):e==="any"?(i=t.slice(1),["any"].concat(i.map(Yu))):e==="all"?["all"].concat(t.slice(1).map(Yu)):e==="none"?["all"].concat(t.slice(1).map(Yu).map(Il)):e==="in"?lA(t[1],t.slice(2)):e==="!in"?Il(lA(t[1],t.slice(2))):e==="has"?dc(t[1]):e!=="!has"||Il(dc(t[1]));var i}function Du(t,e,i){switch(t){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,t,e]}}function lA(t,e){if(e.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",t,["literal",e.sort(pf)]]:["filter-in-small",t,["literal",e]]}}function dc(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Il(t){return["!",t]}function dl(t){return Hs(la(t.value))?ro($o({},t,{expressionContext:"filter",valueSpec:t.styleSpec[`filter_${t.layerType||"fill"}`]})):AA(t)}function AA(t){const e=t.value,i=t.key;if(Vi(e)!=="array")return[new gi(i,e,`array expected, ${Vi(e)} found`)];const r=t.styleSpec;let n,s=[];if(e.length<1)return[new gi(i,e,"filter array must have at least 1 element")];switch(s=s.concat(vA({key:`${i}[0]`,value:e[0],valueSpec:r.filter_operator,style:t.style,styleSpec:t.styleSpec})),vn(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&vn(e[1])==="$type"&&s.push(new gi(i,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&s.push(new gi(i,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(n=Vi(e[1]),n!=="string"&&s.push(new gi(`${i}[1]`,e[1],`string expected, ${n} found`)));for(let a=2;a<e.length;a++)n=Vi(e[a]),vn(e[1])==="$type"?s=s.concat(vA({key:`${i}[${a}]`,value:e[a],valueSpec:r.geometry_type,style:t.style,styleSpec:t.styleSpec})):n!=="string"&&n!=="number"&&n!=="boolean"&&s.push(new gi(`${i}[${a}]`,e[a],`string, number, or boolean expected, ${n} found`));break;case"any":case"all":case"none":for(let a=1;a<e.length;a++)s=s.concat(AA({key:`${i}[${a}]`,value:e[a],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":n=Vi(e[1]),e.length!==2?s.push(new gi(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):n!=="string"&&s.push(new gi(`${i}[1]`,e[1],`string expected, ${n} found`))}return s}function Ku(t,e){const i=t.key,r=t.style,n=t.layer,s=t.styleSpec,a=t.value,c=t.objectKey,p=s[`${e}_${t.layerType}`];if(!p)return[];const _=c.match(/^(.*)-transition$/);if(e==="paint"&&_&&p[_[1]]&&p[_[1]].transition)return _a({key:i,value:a,valueSpec:s.transition,style:r,styleSpec:s});const v=t.valueSpec||p[c];if(!v)return[new Fo(i,a,`unknown property "${c}"`)];let E;if(Vi(a)==="string"&&ot(v)&&!v.tokens&&(E=/^{([^}]+)}$/.exec(a))){const B=`\`{ "type": "identity", "property": ${E?JSON.stringify(E[1]):'"_"'} }\``;return[new gi(i,a,`"${c}" does not support interpolation syntax
Use an identity property function instead: ${B}.`)]}const C=[];if(t.layerType==="symbol")c!=="text-field"||!r||r.glyphs||r.imports||C.push(new gi(i,a,'use of "text-field" requires a style "glyphs" property')),c==="text-font"&&Ut(la(a))&&vn(a.type)==="identity"&&C.push(new gi(i,a,'"text-font" does not support identity functions'));else if(t.layerType==="model"&&e==="paint"&&n&&n.layout&&n.layout.hasOwnProperty("model-id")&&ot(v)&&(ft(v)||dt(v))){const B=is(la(a),v),O=B.value.expression||B.value._styleExpression.expression;O&&!fa(O,["measure-light"])&&(c==="model-emissive-strength"&&Ei(O)&&nA(O)||C.push(new gi(i,a,`${c} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return C.concat(_a({key:t.key,value:a,valueSpec:v,style:r,styleSpec:s,expressionContext:"property",propertyType:e,propertyKey:c}))}function bA(t){return Ku(t,"paint")}function mp(t){return Ku(t,"layout")}function Ed(t){let e=[];const i=t.value,r=t.key,n=t.style,s=t.styleSpec;i.type||i.ref||e.push(new gi(r,i,'either "type" or "ref" is required'));let a=vn(i.type);const c=vn(i.ref);if(i.id){const p=vn(i.id);for(let _=0;_<t.arrayIndex;_++){const v=n.layers[_];vn(v.id)===p&&e.push(new gi(r,i.id,`duplicate layer id "${i.id}", previously used at line ${v.id.__line__}`))}}if("ref"in i){let p;["type","source","source-layer","filter","layout"].forEach(_=>{_ in i&&e.push(new gi(r,i[_],`"${_}" is prohibited for ref layers`))}),n.layers.forEach(_=>{vn(_.id)===c&&(p=_)}),p?p.ref?e.push(new gi(r,i.ref,"ref cannot reference another ref layer")):a=vn(p.type):typeof c=="string"&&e.push(new gi(r,i.ref,`ref layer "${c}" not found`))}else if(a!=="background"&&a!=="sky"&&a!=="slot")if(i.source){const p=n.sources&&n.sources[i.source],_=p&&vn(p.type);p?_==="vector"&&a==="raster"?e.push(new gi(r,i.source,`layer "${i.id}" requires a raster source`)):_==="raster"&&a!=="raster"?e.push(new gi(r,i.source,`layer "${i.id}" requires a vector source`)):_!=="vector"||i["source-layer"]?_==="raster-dem"&&a!=="hillshade"?e.push(new gi(r,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):a!=="line"||!i.paint||!i.paint["line-gradient"]&&!i.paint["line-trim-offset"]||_==="geojson"&&p.lineMetrics||e.push(new gi(r,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new gi(r,i,`layer "${i.id}" must specify a "source-layer"`)):e.push(new gi(r,i.source,`source "${i.source}" not found`))}else e.push(new gi(r,i,'missing required property "source"'));return e=e.concat(Go({key:r,value:i,valueSpec:s.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>_a({key:`${r}.type`,value:i.type,valueSpec:s.layer.type,style:t.style,styleSpec:t.styleSpec,object:i,objectKey:"type"}),filter:p=>dl($o({layerType:a},p)),layout:p=>Go({layer:i,key:p.key,value:p.value,valueSpec:{},style:p.style,styleSpec:p.styleSpec,objectElementValidators:{"*":_=>mp($o({layerType:a},_))}}),paint:p=>Go({layer:i,key:p.key,value:p.value,valueSpec:{},style:p.style,styleSpec:p.styleSpec,objectElementValidators:{"*":_=>bA($o({layerType:a,layer:i},_))}})}})),e}function Ns(t){const e=t.value,i=t.key,r=Vi(e);return r!=="string"?[new gi(i,e,`string expected, ${r} found`)]:[]}const mf={promoteId:function({key:t,value:e}){if(Vi(e)==="string")return Ns({key:t,value:e});{const i=[];for(const r in e)i.push(...Ns({key:`${t}.${r}`,value:e[r]}));return i}}};function Md(t){const e=t.value,i=t.key,r=t.styleSpec,n=t.style;if(!e.type)return[new gi(i,e,'"type" is required')];const s=vn(e.type);let a=[];switch(["vector","raster","raster-dem"].includes(s)&&(e.url||e.tiles||a.push(new gi(i,e,'Either "url" or "tiles" is required.'))),s){case"vector":case"raster":case"raster-dem":return a=a.concat(Go({key:i,value:e,valueSpec:r[`source_${s.replace("-","_")}`],style:t.style,styleSpec:r,objectElementValidators:mf})),a;case"geojson":if(a=Go({key:i,value:e,valueSpec:r.source_geojson,style:n,styleSpec:r,objectElementValidators:mf}),e.cluster)for(const c in e.clusterProperties){const[p,_]=e.clusterProperties[c],v=typeof p=="string"?[p,["accumulated"],["get",c]]:p;a.push(...ro({key:`${i}.${c}.map`,value:_,expressionContext:"cluster-map"})),a.push(...ro({key:`${i}.${c}.reduce`,value:v,expressionContext:"cluster-reduce"}))}return a;case"video":return Go({key:i,value:e,valueSpec:r.source_video,style:n,styleSpec:r});case"image":return Go({key:i,value:e,valueSpec:r.source_image,style:n,styleSpec:r});case"canvas":return[new gi(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return vA({key:`${i}.type`,value:e.type,valueSpec:{values:Pu(r)},style:n,styleSpec:r})}}function Pu(t){return t.source.reduce((e,i)=>{const r=t[i];return r.type.type==="enum"&&(e=e.concat(Object.keys(r.type.values))),e},[])}function lu(t){const e=t.value;let i=[];if(!e)return i;const r=Vi(e);return r!=="string"?(i=i.concat([new gi(t.key,e,`string expected, "${r}" found`)]),i):(function(n){const s=n.indexOf("://")===-1;try{return new URL(n,s?"http://example.com":void 0),!0}catch{return!1}}(e)||(i=i.concat([new gi(t.key,e,`invalid url "${e}"`)])),i)}function Dh(t){const e=t.value,i=t.styleSpec,r=i.light,n=t.style;let s=[];const a=Vi(e);if(e===void 0)return s;if(a!=="object")return s=s.concat([new gi("light",e,`object expected, ${a} found`)]),s;for(const c in e){const p=c.match(/^(.*)-transition$/);s=s.concat(p&&r[p[1]]&&r[p[1]].transition?_a({key:c,value:e[c],valueSpec:i.transition,style:n,styleSpec:i}):r[c]?_a({key:c,value:e[c],valueSpec:r[c],style:n,styleSpec:i}):[new gi(c,e[c],`unknown property "${c}"`)])}return s}function _f(t){const e=t.value;let i=[];if(!e)return i;const r=Vi(e);if(r!=="object")return i=i.concat([new gi("light-3d",e,`object expected, ${r} found`)]),i;const n=t.styleSpec,s=n["light-3d"],a=t.key,c=t.style,p=t.style.lights;for(const E of["type","id"])if(!(E in e))return i=i.concat([new gi("light-3d",e,`missing property ${E} on light`)]),i;if(e.type&&p)for(let E=0;E<t.arrayIndex;E++){const C=vn(e.type),B=p[E];vn(B.type)===C&&i.push(new gi(a,e.id,`duplicate light type "${e.type}", previously defined at line ${B.id.__line__}`))}const _=`properties_light_${e.type}`;if(!(_ in n))return i=i.concat([new gi("light-3d",e,`Invalid light type ${e.type}`)]),i;const v=n[_];for(const E in e)if(E==="properties"){const C=e[E],B=Vi(C);if(B!=="object")return i=i.concat([new gi("properties",C,`object expected, ${B} found`)]),i;for(const O in C)i=i.concat(v[O]?_a({key:O,value:C[O],valueSpec:v[O],style:c,styleSpec:n}):[new Fo(t.key,C[O],`unknown property "${O}"`)])}else{const C=E.match(/^(.*)-transition$/);i=i.concat(C&&s[C[1]]&&s[C[1]].transition?_a({key:E,value:e[E],valueSpec:n.transition,style:c,styleSpec:n}):s[E]?_a({key:E,value:e[E],valueSpec:s[E],style:c,styleSpec:n}):[new Fo(E,e[E],`unknown property "${E}"`)])}return i}function Sd(t){const e=t.value,i=t.key,r=t.style,n=t.styleSpec,s=n.terrain;let a=[];const c=Vi(e);if(e===void 0||c==="null")return a;if(c!=="object")return a=a.concat([new gi("terrain",e,`object expected, ${c} found`)]),a;for(const p in e){const _=p.match(/^(.*)-transition$/);a=a.concat(_&&s[_[1]]&&s[_[1]].transition?_a({key:p,value:e[p],valueSpec:n.transition,style:r,styleSpec:n}):s[p]?_a({key:p,value:e[p],valueSpec:s[p],style:r,styleSpec:n}):[new Fo(p,e[p],`unknown property "${p}"`)])}if(e.source){const p=r.sources&&r.sources[e.source],_=p&&vn(p.type);p?_!=="raster-dem"&&a.push(new gi(i,e.source,`terrain cannot be used with a source of type ${String(_)}, it only be used with a "raster-dem" source type`)):a.push(new gi(i,e.source,`source "${e.source}" not found`))}else a.push(new gi(i,e,'terrain is missing required property "source"'));return a}function _p(t){const e=t.value,i=t.style,r=t.styleSpec,n=r.fog;let s=[];const a=Vi(e);if(e===void 0)return s;if(a!=="object")return s=s.concat([new gi("fog",e,`object expected, ${a} found`)]),s;for(const c in e){const p=c.match(/^(.*)-transition$/);s=s.concat(p&&n[p[1]]&&n[p[1]].transition?_a({key:c,value:e[c],valueSpec:r.transition,style:i,styleSpec:r}):n[c]?_a({key:c,value:e[c],valueSpec:n[c],style:i,styleSpec:r}):[new Fo(c,e[c],`unknown property "${c}"`)])}return s}const Id={"*":()=>[],array:fc,boolean:function(t){const e=t.value,i=t.key,r=Vi(e);return r!=="boolean"?[new gi(i,e,`boolean expected, ${r} found`)]:[]},number:Rc,color:function(t){const e=t.key,i=t.value,r=Vi(i);return r!=="string"?[new gi(e,i,`color expected, ${r} found`)]:Ta(i)===null?[new gi(e,i,`color expected, "${i}" found`)]:[]},enum:vA,filter:dl,function:ma,layer:Ed,object:Go,source:Md,model:lu,light:Dh,"light-3d":_f,terrain:Sd,fog:_p,string:Ns,formatted:function(t){return Ns(t).length===0?[]:ro(t)},resolvedImage:function(t){return Ns(t).length===0?[]:ro(t)},projection:function(t){const e=t.value,i=t.styleSpec,r=i.projection,n=t.style;let s=[];const a=Vi(e);if(a==="object")for(const c in e)s=s.concat(_a({key:c,value:e[c],valueSpec:r[c],style:n,styleSpec:i}));else a!=="string"&&(s=s.concat([new gi("projection",e,`object or string expected, ${a} found`)]));return s},import:function(t){const{value:e,styleSpec:i}=t,{data:r,...n}=e;Object.defineProperty(n,"__line__",{value:e.__line__,enumerable:!1});let s=Go($o({},t,{value:n,valueSpec:i.import}));return vn(n.id)===""&&s.push(new gi(`${t.key}.id`,n,"import id can't be an empty string")),r&&(s=s.concat(gp(r,i,{key:`${t.key}.data`}))),s}};function _a(t,e=!1){const i=t.value,r=t.valueSpec,n=t.styleSpec;if(r.expression&&Ut(vn(i)))return ma(t);if(r.expression&&Or(la(i)))return ro(t);if(r.type&&Id[r.type]){const s=Id[r.type](t);return e===!0&&s.length>0&&Vi(t.value)==="array"?ro(t):s}return Go($o({},t,{valueSpec:r.type?n[r.type]:r}))}function Cd(t){const e=t.value,i=t.key,r=Ns(t);return r.length||(e.indexOf("{fontstack}")===-1&&r.push(new gi(i,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&r.push(new gi(i,e,'"glyphs" url must include a "{range}" token'))),r}function gp(t,e=xt,i={}){return _a({key:i.key||"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:Cd,"*":()=>[]}})}function Au(t,e=xt){return Ws(gp(t,e))}const yp=t=>Ws(Md(t)),xp=t=>Ws(Dh(t)),Ju=t=>Ws(_f(t)),q_=t=>Ws(Sd(t)),Ph=t=>Ws(_p(t)),gf=t=>Ws(Ed(t)),$u=t=>Ws(dl(t)),vp=t=>Ws(bA(t)),bp=t=>Ws(mp(t)),Q_=t=>Ws(lu(t));function Ws(t){return t.slice().sort((e,i)=>e.line&&i.line?e.line-i.line:0)}function Fc(t,e){let i=!1;if(e&&e.length)for(const r of e)r instanceof Fo?Be(r.message):(t.fire(new $i(new Error(r.message))),i=!0);return i}var kd=jl,Oc=3;function jl(t,e,i){var r=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var n=new Int32Array(this.arrayBuffer);t=n[0],this.d=(e=n[1])+2*(i=n[2]);for(var s=0;s<this.d*this.d;s++){var a=n[Oc+s],c=n[Oc+s+1];r.push(a===c?null:n.subarray(a,c))}var p=n[Oc+r.length+1];this.keys=n.subarray(n[Oc+r.length],p),this.bboxes=n.subarray(p),this.insert=this._insertReadonly}else{this.d=e+2*i;for(var _=0;_<this.d*this.d;_++)r.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=i,this.scale=e/t,this.uid=0;var v=i/e*t;this.min=-v,this.max=t+v}jl.prototype.insert=function(t,e,i,r,n){this._forEachCell(e,i,r,n,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(r),this.bboxes.push(n)},jl.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},jl.prototype._insertCell=function(t,e,i,r,n,s){this.cells[n].push(s)},jl.prototype.query=function(t,e,i,r,n){var s=this.min,a=this.max;if(t<=s&&e<=s&&a<=i&&a<=r&&!n)return Array.prototype.slice.call(this.keys);var c=[];return this._forEachCell(t,e,i,r,this._queryCell,c,{},n),c},jl.prototype._queryCell=function(t,e,i,r,n,s,a,c){var p=this.cells[n];if(p!==null)for(var _=this.keys,v=this.bboxes,E=0;E<p.length;E++){var C=p[E];if(a[C]===void 0){var B=4*C;(c?c(v[B+0],v[B+1],v[B+2],v[B+3]):t<=v[B+2]&&e<=v[B+3]&&i>=v[B+0]&&r>=v[B+1])?(a[C]=!0,s.push(_[C])):a[C]=!1}}},jl.prototype._forEachCell=function(t,e,i,r,n,s,a,c){for(var p=this._convertToCellCoord(t),_=this._convertToCellCoord(e),v=this._convertToCellCoord(i),E=this._convertToCellCoord(r),C=p;C<=v;C++)for(var B=_;B<=E;B++){var O=this.d*B+C;if((!c||c(this._convertFromCellCoord(C),this._convertFromCellCoord(B),this._convertFromCellCoord(C+1),this._convertFromCellCoord(B+1)))&&n.call(this,t,e,i,r,O,s,a,c))return}},jl.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},jl.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},jl.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=Oc+this.cells.length+1+1,i=0,r=0;r<this.cells.length;r++)i+=this.cells[r].length;var n=new Int32Array(e+i+this.keys.length+this.bboxes.length);n[0]=this.extent,n[1]=this.n,n[2]=this.padding;for(var s=e,a=0;a<t.length;a++){var c=t[a];n[Oc+a]=s,n.set(c,s),s+=c.length}return n[Oc+t.length]=s,n.set(this.keys,s),n[Oc+t.length+1]=s+=this.keys.length,n.set(this.bboxes,s),s+=this.bboxes.length,n.buffer};var eh=_r(kd);const zu={};function Mi(t,e,i={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),zu[e]={klass:t,omit:i.omit||[]}}Mi(Object,"Object"),eh.serialize=function(t,e){const i=t.toArrayBuffer();return e&&e.add(i),{buffer:i}},eh.deserialize=function(t){return new eh(t.buffer)},Object.defineProperty(eh,"name",{value:"Grid"}),Mi(eh,"Grid"),Mi(fr,"Color"),Mi(Error,"Error"),Mi(Ae,"AJAXError"),Mi(fo,"ResolvedImage"),Mi(Ml,"StylePropertyFunction"),Mi(Ji,"StyleExpression",{omit:["_evaluator"]}),Mi(Bn,"ZoomDependentExpression"),Mi(Lr,"ZoomConstantExpression"),Mi(No,"CompoundExpression",{omit:["_evaluate"]});for(const t in Pe)zu[Pe[t]._classRegistryKey]||Mi(Pe[t],`Expression${t}`);function Dd(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function Pd(t){return Ee.ImageBitmap&&t instanceof Ee.ImageBitmap}function Bu(t,e){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(Dd(t)||Pd(t))return e&&e.add(t),t;if(ArrayBuffer.isView(t)){const i=t;return e&&e.add(i.buffer),i}if(t instanceof Ee.ImageData)return e&&e.add(t.data.buffer),t;if(Array.isArray(t)){const i=[];for(const r of t)i.push(Bu(r,e));return i}if(t instanceof Map){const i={$name:"Map"};for(const[r,n]of t.entries())i[r]=Bu(n);return i}if(typeof t=="object"){const i=t.constructor,r=i._classRegistryKey;if(!r)throw new Error(`can't serialize object of unregistered class ${r}`);const n=i.serialize?i.serialize(t,e):{};if(!i.serialize){for(const s in t)t.hasOwnProperty(s)&&(zu[r].omit.indexOf(s)>=0||(n[s]=Bu(t[s],e)));t instanceof Error&&(n.message=t.message)}if(n.$name)throw new Error("$name property is reserved for worker serialization logic.");return r!=="Object"&&(n.$name=r),n}throw new Error("can't serialize object of type "+typeof t)}function th(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||Dd(t)||Pd(t)||ArrayBuffer.isView(t)||t instanceof Ee.ImageData)return t;if(Array.isArray(t))return t.map(th);if(typeof t=="object"){const e=t.$name||"Object";if(e==="Map"){const n=new Map;for(const s of Object.keys(t))s!=="$name"&&n.set(s,th(t[s]));return n}const{klass:i}=zu[e];if(!i)throw new Error(`can't deserialize unregistered class ${e}`);if(i.deserialize)return i.deserialize(t);const r=Object.create(i.prototype);for(const n of Object.keys(t))n!=="$name"&&(r[n]=th(t[n]));return r}throw new Error("can't deserialize object of type "+typeof t)}const zi={"Latin-1 Supplement":t=>t>=128&&t<=255,Arabic:t=>t>=1536&&t<=1791,"Arabic Supplement":t=>t>=1872&&t<=1919,"Arabic Extended-A":t=>t>=2208&&t<=2303,"Hangul Jamo":t=>t>=4352&&t<=4607,"Unified Canadian Aboriginal Syllabics":t=>t>=5120&&t<=5759,Khmer:t=>t>=6016&&t<=6143,"Unified Canadian Aboriginal Syllabics Extended":t=>t>=6320&&t<=6399,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"CJK Radicals Supplement":t=>t>=11904&&t<=12031,"Kangxi Radicals":t=>t>=12032&&t<=12255,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Bopomofo:t=>t>=12544&&t<=12591,"Hangul Compatibility Jamo":t=>t>=12592&&t<=12687,Kanbun:t=>t>=12688&&t<=12703,"Bopomofo Extended":t=>t>=12704&&t<=12735,"CJK Strokes":t=>t>=12736&&t<=12783,"Katakana Phonetic Extensions":t=>t>=12784&&t<=12799,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"CJK Unified Ideographs Extension A":t=>t>=13312&&t<=19903,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Yi Syllables":t=>t>=40960&&t<=42127,"Yi Radicals":t=>t>=42128&&t<=42191,"Hangul Jamo Extended-A":t=>t>=43360&&t<=43391,"Hangul Syllables":t=>t>=44032&&t<=55215,"Hangul Jamo Extended-B":t=>t>=55216&&t<=55295,"Private Use Area":t=>t>=57344&&t<=63743,"CJK Compatibility Ideographs":t=>t>=63744&&t<=64255,"Arabic Presentation Forms-A":t=>t>=64336&&t<=65023,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Arabic Presentation Forms-B":t=>t>=65136&&t<=65279,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519,"CJK Unified Ideographs Extension B":t=>t>=131072&&t<=173791};function yf(t){for(const e of t)if(Cl(e.charCodeAt(0)))return!0;return!1}function zd(t){for(const e of t)if(!zh(e.charCodeAt(0)))return!1;return!0}function zh(t){return!(zi.Arabic(t)||zi["Arabic Supplement"](t)||zi["Arabic Extended-A"](t)||zi["Arabic Presentation Forms-A"](t)||zi["Arabic Presentation Forms-B"](t))}function Cl(t){return!(t!==746&&t!==747&&(t<4352||!(zi["Bopomofo Extended"](t)||zi.Bopomofo(t)||zi["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||zi["CJK Compatibility Ideographs"](t)||zi["CJK Compatibility"](t)||zi["CJK Radicals Supplement"](t)||zi["CJK Strokes"](t)||!(!zi["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||zi["CJK Unified Ideographs Extension A"](t)||zi["CJK Unified Ideographs"](t)||zi["Enclosed CJK Letters and Months"](t)||zi["Hangul Compatibility Jamo"](t)||zi["Hangul Jamo Extended-A"](t)||zi["Hangul Jamo Extended-B"](t)||zi["Hangul Jamo"](t)||zi["Hangul Syllables"](t)||zi.Hiragana(t)||zi["Ideographic Description Characters"](t)||zi.Kanbun(t)||zi["Kangxi Radicals"](t)||zi["Katakana Phonetic Extensions"](t)||zi.Katakana(t)&&t!==12540||!(!zi["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!zi["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||zi["Unified Canadian Aboriginal Syllabics"](t)||zi["Unified Canadian Aboriginal Syllabics Extended"](t)||zi["Vertical Forms"](t)||zi["Yijing Hexagram Symbols"](t)||zi["Yi Syllables"](t)||zi["Yi Radicals"](t))))}function Bd(t){return!(Cl(t)||function(e){return!!(zi["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||zi["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||zi["Letterlike Symbols"](e)||zi["Number Forms"](e)||zi["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||zi["Control Pictures"](e)&&e!==9251||zi["Optical Character Recognition"](e)||zi["Enclosed Alphanumerics"](e)||zi["Geometric Shapes"](e)||zi["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||zi["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||zi["CJK Symbols and Punctuation"](e)||zi.Katakana(e)||zi["Private Use Area"](e)||zi["CJK Compatibility Forms"](e)||zi["Small Form Variants"](e)||zi["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(t))}function wp(t){return t>=1424&&t<=2303||zi["Arabic Presentation Forms-A"](t)||zi["Arabic Presentation Forms-B"](t)}function Tp(t,e){return!(!e&&wp(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||zi.Khmer(t))}function H_(t){for(const e of t)if(wp(e.charCodeAt(0)))return!0;return!1}const Ld="deferred",Rd="loading",Fd="loaded";let Bh=null,Ya="unavailable",Nc=null;const cu=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(Ya="error"),Bh&&Bh(t)};function Lu(){Od.fire(new Jt("pluginStateChange",{pluginStatus:Ya,pluginURL:Nc}))}const Od=new ss,Nd=function(){return Ya},Ep=function(){if(Ya!==Ld||!Nc)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Ya=Rd,Lu(),Nc&&Ne({url:Nc},t=>{t?cu(t):(Ya=Fd,Lu())})},wA={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Ya===Fd||wA.applyArabicShaping!=null,isLoading:()=>Ya===Rd,setState(t){Ya=t.pluginStatus,Nc=t.pluginURL},isParsed:()=>wA.applyArabicShaping!=null&&wA.processBidirectionalText!=null&&wA.processStyledBidirectionalText!=null,getPluginURL:()=>Nc};class _s{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch,this.brightness=i.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(i,r){for(const n of i)if(!Tp(n.charCodeAt(0),r))return!1;return!0}(e,wA.isLoaded())}}class xf{constructor(e,i,r){this.property=e,this.value=i,this.expression=function(n,s,a){if(Ut(n))return new Ml(n,s);if(Or(n)||Array.isArray(n)&&n.length>0){const c=is(n,s,a);if(c.result==="error")throw new Error(c.value.map(p=>`${p.key}: ${p.message}`).join(", "));return c.value}{let c=n;return typeof n=="string"&&s.type==="color"&&(c=fr.parse(n)),{kind:"constant",isConfigDependent:!1,evaluate:()=>c}}}(i===void 0?e.specification.default:i,e.specification,r)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,r){return this.property.possiblyEvaluate(this,e,i,r)}}class Ud{constructor(e,i){this.property=e,this.value=new xf(e,void 0,i)}transitioned(e,i){return new Mp(this.property,this.value,i,Pt({},e.transition,this.transition),e.now)}untransitioned(){return new Mp(this.property,this.value,null,{},0)}}class Ru{constructor(e,i){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._options=i,this.isConfigDependent=!1}getValue(e){return Ue(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new Ud(this._values[e].property,this._options)),this._values[e].value=new xf(this._values[e].property,i===null?void 0:Ue(i),this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].value.expression.isConfigDependent}setTransitionOrValue(e,i){i&&(this._options=i);const r=this._properties.properties;if(e)for(const n in e){const s=e[n];if($s(n,"-transition")){const a=n.slice(0,-11);r[a]&&this.setTransition(a,s)}else r[n]&&this.setValue(n,s)}}getTransition(e){return Ue(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new Ud(this._values[e].property)),this._values[e].transition=Ue(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const r=this.getValue(i);r!==void 0&&(e[i]=r);const n=this.getTransition(i);n!==void 0&&(e[`${i}-transition`]=n)}return e}transitioned(e,i){const r=new Fu(this._properties);for(const n of Object.keys(this._values))r._values[n]=this._values[n].transitioned(e,i._values[n]);return r}untransitioned(){const e=new Fu(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class Mp{constructor(e,i,r,n,s){const a=n.delay||0,c=n.duration||0;s=s||0,this.property=e,this.value=i,this.begin=s+a,this.end=this.begin+c,e.specification.transition&&(n.delay||n.duration)&&(this.prior=r)}possiblyEvaluate(e,i,r){const n=e.now||0,s=this.value.possiblyEvaluate(e,i,r),a=this.prior;if(a){if(n>this.end)return this.prior=null,s;if(this.value.isDataDriven())return this.prior=null,s;if(n<this.begin)return a.possiblyEvaluate(e,i,r);{const c=(n-this.begin)/(this.end-this.begin);return this.property.interpolate(a.possiblyEvaluate(e,i,r),s,Dn(c))}}return s}}class Fu{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,r){const n=new uu(this._properties);for(const s of Object.keys(this._values))n._values[s]=this._values[s].possiblyEvaluate(e,i,r);return n}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class W_{constructor(e,i){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._options=i,this.isConfigDependent=!1}getValue(e){return Ue(this._values[e].value)}setValue(e,i){this._values[e]=new xf(this._values[e].property,i===null?void 0:Ue(i),this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].expression.isConfigDependent}serialize(){const e={};for(const i of Object.keys(this._values)){const r=this.getValue(i);r!==void 0&&(e[i]=r)}return e}possiblyEvaluate(e,i,r){const n=new uu(this._properties);for(const s of Object.keys(this._values))n._values[s]=this._values[s].possiblyEvaluate(e,i,r);return n}}class Ps{constructor(e,i,r){this.property=e,this.value=i,this.parameters=r}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,r,n){return this.property.evaluate(this.value,this.parameters,e,i,r,n)}}class uu{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class ri{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,r){const n=ka[this.specification.type];return n?n(e,i,r):e}}class Gi{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,r,n){return new Ps(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(i,null,{},r,n)}:e.expression,i)}interpolate(e,i,r){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new Ps(this,{kind:"constant",value:void 0},e.parameters);const n=ka[this.specification.type];return n?new Ps(this,{kind:"constant",value:n(e.value.value,i.value.value,r)},e.parameters):e}evaluate(e,i,r,n,s,a){return e.kind==="constant"?e.value:e.evaluate(i,r,n,s,a)}}class hu{constructor(e){this.specification=e}possiblyEvaluate(e,i,r,n){return!!e.expression.evaluate(i,null,{},r,n)}interpolate(){return!1}}class as{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new _s(0,{});for(const r in e){const n=e[r];n.specification.overridable&&this.overridableProperties.push(r);const s=this.defaultPropertyValues[r]=new xf(n,void 0),a=this.defaultTransitionablePropertyValues[r]=new Ud(n);this.defaultTransitioningPropertyValues[r]=a.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=s.possiblyEvaluate(i)}}}Mi(Gi,"DataDrivenProperty"),Mi(ri,"DataConstantProperty"),Mi(hu,"ColorRampProperty");const Lh="";function Vd(t){return t.indexOf(Lh)>=0}function Zo(t,e){return e?`${t}${Lh}${e}`:t}function ih(t){const e=t.indexOf(Lh);return e>=0?t.slice(0,e):t}const vf="-transition";class Gl extends ss{constructor(e,i,r){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),this.options=r,e.slot&&(this.slot=e.slot),i.layout&&(this._unevaluatedLayout=new W_(i.layout,r),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),i.paint)){this._transitionablePaint=new Ru(i.paint,r);for(const n in e.paint)this.setPaintProperty(n,e.paint[n],{validate:!1});for(const n in e.layout)this.setLayoutProperty(n,e.layout[n],{validate:!1});this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new uu(i.paint)}}setScope(e){this.scope=e,this.fqid=Zo(this.id,e)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i,r={}){if(i!=null&&this._validate(bp,`layers.${this.id}.layout.${e}`,e,i,r))return;if(this.type==="custom"&&e==="visibility")return void(this.visibility=i);const n=this._unevaluatedLayout;n._properties.properties[e]&&(n.setValue(e,i),this.isConfigDependent=this.isConfigDependent||n.isConfigDependent,e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(e){return $s(e,vf)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i,r={}){if(i!=null&&this._validate(vp,`layers.${this.id}.paint.${e}`,e,i,r))return!1;const n=this._transitionablePaint,s=n._properties.properties;if($s(e,vf)){const C=e.slice(0,-11);return s[C]&&n.setTransition(C,i||void 0),!1}if(!s[e])return!1;const a=n._values[e],c=a.value.isDataDriven(),p=a.value;n.setValue(e,i),this.isConfigDependent=this.isConfigDependent||n.isConfigDependent,this._handleSpecialPaintPropertyUpdate(e);const _=n._values[e].value,v=_.isDataDriven(),E=$s(e,"pattern")||e==="line-dasharray";return v||c||E||this._handleOverridablePaintPropertyUpdate(e,p,_)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,i){return null}_handleOverridablePaintPropertyUpdate(e,i,r){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){return Zt({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,i)=>!(e===void 0||i==="layout"&&!Object.keys(e).length||i==="paint"&&!Object.keys(e).length))}_validate(e,i,r,n,s={}){return(!s||s.validate!==!1)&&Fc(this,e.call(Au,{key:i,layerType:this.type,objectKey:r,value:n,styleSpec:xt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof Ps&&ot(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=mo(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(){this._stats&&(this._stats.numRenderedVerticesInShadowPass=0,this._stats.numRenderedVerticesInTransparentPass=0)}}class X_{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(e,i){this._updatedSourceCaches[e]=i,this.setDirty()}discardSourceCacheUpdate(e){delete this._updatedSourceCaches[e]}updateLayer(e){const i=e.scope;this._updatedLayers[i]=this._updatedLayers[i]||new Set,this._updatedLayers[i].add(e.id),this.setDirty()}removeLayer(e){const i=e.scope;this._removedLayers[i]=this._removedLayers[i]||{},this._updatedLayers[i]=this._updatedLayers[i]||new Set,this._removedLayers[i][e.id]=e,this._updatedLayers[i].delete(e.id),this._updatedPaintProps.delete(e.fqid),this.setDirty()}getRemovedLayer(e){return this._removedLayers[e.scope]?this._removedLayers[e.scope][e.id]:null}discardLayerRemoval(e){this._removedLayers[e.scope]&&delete this._removedLayers[e.scope][e.id]}getLayerUpdatesByScope(){const e={};for(const i in this._updatedLayers)e[i]=e[i]||{},e[i].updatedIds=Array.from(this._updatedLayers[i].values());for(const i in this._removedLayers)e[i]=e[i]||{},e[i].removedIds=Object.keys(this._removedLayers[i]);return e}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(e){this._updatedPaintProps.add(e.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(e){this._updatedImages.add(e),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}const Sp={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class fu{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class gs{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function an(t,e=1){let i=0,r=0;return{members:t.map(n=>{const s=Sp[n.type].BYTES_PER_ELEMENT,a=i=Ip(i,Math.max(e,s)),c=n.components||1;return r=Math.max(r,s),i+=s*c,{name:n.name,type:n.type,components:c,offset:a}}),size:Ip(i,Math.max(r,e)),alignment:e}}function Ip(t,e){return Math.ceil(t/e)*e}class pl extends gs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,i)}emplace(e,i,r){const n=2*e;return this.int16[n+0]=i,this.int16[n+1]=r,e}}pl.prototype.bytesPerElement=4,Mi(pl,"StructArrayLayout2i4");class rh extends gs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,i,r)}emplace(e,i,r,n){const s=3*e;return this.int16[s+0]=i,this.int16[s+1]=r,this.int16[s+2]=n,e}}rh.prototype.bytesPerElement=6,Mi(rh,"StructArrayLayout3i6");class Uc extends gs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,r,n){const s=this.length;return this.resize(s+1),this.emplace(s,e,i,r,n)}emplace(e,i,r,n,s){const a=4*e;return this.int16[a+0]=i,this.int16[a+1]=r,this.int16[a+2]=n,this.int16[a+3]=s,e}}Uc.prototype.bytesPerElement=8,Mi(Uc,"StructArrayLayout4i8");class bf extends gs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,r,n,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,i,r,n,s)}emplace(e,i,r,n,s,a){const c=5*e;return this.int16[c+0]=i,this.int16[c+1]=r,this.int16[c+2]=n,this.int16[c+3]=s,this.int16[c+4]=a,e}}bf.prototype.bytesPerElement=10,Mi(bf,"StructArrayLayout5i10");class wf extends gs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,n,s,a,c){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,r,n,s,a,c)}emplace(e,i,r,n,s,a,c,p){const _=6*e,v=12*e,E=3*e;return this.int16[_+0]=i,this.int16[_+1]=r,this.uint8[v+4]=n,this.uint8[v+5]=s,this.uint8[v+6]=a,this.uint8[v+7]=c,this.float32[E+2]=p,e}}wf.prototype.bytesPerElement=12,Mi(wf,"StructArrayLayout2i4ub1f12");class Vc extends gs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,n){const s=this.length;return this.resize(s+1),this.emplace(s,e,i,r,n)}emplace(e,i,r,n,s){const a=4*e;return this.float32[a+0]=i,this.float32[a+1]=r,this.float32[a+2]=n,this.float32[a+3]=s,e}}Vc.prototype.bytesPerElement=16,Mi(Vc,"StructArrayLayout4f16");class du extends gs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,n,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,i,r,n,s)}emplace(e,i,r,n,s,a){const c=6*e,p=3*e;return this.uint16[c+0]=i,this.uint16[c+1]=r,this.uint16[c+2]=n,this.uint16[c+3]=s,this.float32[p+2]=a,e}}du.prototype.bytesPerElement=12,Mi(du,"StructArrayLayout4ui1f12");class Tf extends gs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,r,n){const s=this.length;return this.resize(s+1),this.emplace(s,e,i,r,n)}emplace(e,i,r,n,s){const a=4*e;return this.uint16[a+0]=i,this.uint16[a+1]=r,this.uint16[a+2]=n,this.uint16[a+3]=s,e}}Tf.prototype.bytesPerElement=8,Mi(Tf,"StructArrayLayout4ui8");class Ef extends gs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,r,n,s,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,r,n,s,a)}emplace(e,i,r,n,s,a,c){const p=6*e;return this.int16[p+0]=i,this.int16[p+1]=r,this.int16[p+2]=n,this.int16[p+3]=s,this.int16[p+4]=a,this.int16[p+5]=c,e}}Ef.prototype.bytesPerElement=12,Mi(Ef,"StructArrayLayout6i12");class jd extends gs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,r,n,s,a,c,p,_,v,E,C){const B=this.length;return this.resize(B+1),this.emplace(B,e,i,r,n,s,a,c,p,_,v,E,C)}emplace(e,i,r,n,s,a,c,p,_,v,E,C,B){const O=12*e;return this.int16[O+0]=i,this.int16[O+1]=r,this.int16[O+2]=n,this.int16[O+3]=s,this.uint16[O+4]=a,this.uint16[O+5]=c,this.uint16[O+6]=p,this.uint16[O+7]=_,this.int16[O+8]=v,this.int16[O+9]=E,this.int16[O+10]=C,this.int16[O+11]=B,e}}jd.prototype.bytesPerElement=24,Mi(jd,"StructArrayLayout4i4ui4i24");class pc extends gs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,n,s,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,r,n,s,a)}emplace(e,i,r,n,s,a,c){const p=10*e,_=5*e;return this.int16[p+0]=i,this.int16[p+1]=r,this.int16[p+2]=n,this.float32[_+2]=s,this.float32[_+3]=a,this.float32[_+4]=c,e}}pc.prototype.bytesPerElement=20,Mi(pc,"StructArrayLayout3i3f20");class Gd extends gs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}Gd.prototype.bytesPerElement=4,Mi(Gd,"StructArrayLayout1ul4");class jc extends gs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,i)}emplace(e,i,r){const n=2*e;return this.uint16[n+0]=i,this.uint16[n+1]=r,e}}jc.prototype.bytesPerElement=4,Mi(jc,"StructArrayLayout2ui4");class pu extends gs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,r,n,s,a,c,p,_,v,E,C,B){const O=this.length;return this.resize(O+1),this.emplace(O,e,i,r,n,s,a,c,p,_,v,E,C,B)}emplace(e,i,r,n,s,a,c,p,_,v,E,C,B,O){const G=20*e,q=10*e;return this.int16[G+0]=i,this.int16[G+1]=r,this.int16[G+2]=n,this.int16[G+3]=s,this.int16[G+4]=a,this.float32[q+3]=c,this.float32[q+4]=p,this.float32[q+5]=_,this.float32[q+6]=v,this.int16[G+14]=E,this.uint32[q+8]=C,this.uint16[G+18]=B,this.uint16[G+19]=O,e}}pu.prototype.bytesPerElement=40,Mi(pu,"StructArrayLayout5i4f1i1ul2ui40");class Mf extends gs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,r,n,s,a,c){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,r,n,s,a,c)}emplace(e,i,r,n,s,a,c,p){const _=8*e;return this.int16[_+0]=i,this.int16[_+1]=r,this.int16[_+2]=n,this.int16[_+4]=s,this.int16[_+5]=a,this.int16[_+6]=c,this.int16[_+7]=p,e}}Mf.prototype.bytesPerElement=16,Mi(Mf,"StructArrayLayout3i2i2i16");class Zd extends gs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,r,n,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,i,r,n,s)}emplace(e,i,r,n,s,a){const c=4*e,p=8*e;return this.float32[c+0]=i,this.float32[c+1]=r,this.float32[c+2]=n,this.int16[p+6]=s,this.int16[p+7]=a,e}}Zd.prototype.bytesPerElement=16,Mi(Zd,"StructArrayLayout2f1f2i16");class qd extends gs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,n){const s=this.length;return this.resize(s+1),this.emplace(s,e,i,r,n)}emplace(e,i,r,n,s){const a=12*e,c=3*e;return this.uint8[a+0]=i,this.uint8[a+1]=r,this.float32[c+1]=n,this.float32[c+2]=s,e}}qd.prototype.bytesPerElement=12,Mi(qd,"StructArrayLayout2ub2f12");class so extends gs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,i,r)}emplace(e,i,r,n){const s=3*e;return this.uint16[s+0]=i,this.uint16[s+1]=r,this.uint16[s+2]=n,e}}so.prototype.bytesPerElement=6,Mi(so,"StructArrayLayout3ui6");class Sf extends gs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,r,n,s,a,c,p,_,v,E,C,B,O,G,q,X,$,re,ne,ie){const se=this.length;return this.resize(se+1),this.emplace(se,e,i,r,n,s,a,c,p,_,v,E,C,B,O,G,q,X,$,re,ne,ie)}emplace(e,i,r,n,s,a,c,p,_,v,E,C,B,O,G,q,X,$,re,ne,ie,se){const he=30*e,ve=15*e,be=60*e;return this.int16[he+0]=i,this.int16[he+1]=r,this.int16[he+2]=n,this.float32[ve+2]=s,this.float32[ve+3]=a,this.uint16[he+8]=c,this.uint16[he+9]=p,this.uint32[ve+5]=_,this.uint32[ve+6]=v,this.uint32[ve+7]=E,this.uint16[he+16]=C,this.uint16[he+17]=B,this.uint16[he+18]=O,this.float32[ve+10]=G,this.float32[ve+11]=q,this.uint8[be+48]=X,this.uint8[be+49]=$,this.uint8[be+50]=re,this.uint32[ve+13]=ne,this.int16[he+28]=ie,this.uint8[be+58]=se,e}}Sf.prototype.bytesPerElement=60,Mi(Sf,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Qd extends gs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,r,n,s,a,c,p,_,v,E,C,B,O,G,q,X,$,re,ne,ie,se,he,ve,be,De,Ve,je,Je,Fe,nt,At){const vt=this.length;return this.resize(vt+1),this.emplace(vt,e,i,r,n,s,a,c,p,_,v,E,C,B,O,G,q,X,$,re,ne,ie,se,he,ve,be,De,Ve,je,Je,Fe,nt,At)}emplace(e,i,r,n,s,a,c,p,_,v,E,C,B,O,G,q,X,$,re,ne,ie,se,he,ve,be,De,Ve,je,Je,Fe,nt,At,vt){const rt=20*e,lt=40*e,wt=80*e;return this.float32[rt+0]=i,this.float32[rt+1]=r,this.int16[lt+4]=n,this.int16[lt+5]=s,this.int16[lt+6]=a,this.int16[lt+7]=c,this.int16[lt+8]=p,this.int16[lt+9]=_,this.int16[lt+10]=v,this.int16[lt+11]=E,this.int16[lt+12]=C,this.uint16[lt+13]=B,this.uint16[lt+14]=O,this.uint16[lt+15]=G,this.uint16[lt+16]=q,this.uint16[lt+17]=X,this.uint16[lt+18]=$,this.uint16[lt+19]=re,this.uint16[lt+20]=ne,this.uint16[lt+21]=ie,this.uint16[lt+22]=se,this.uint16[lt+23]=he,this.uint16[lt+24]=ve,this.uint16[lt+25]=be,this.uint16[lt+26]=De,this.uint16[lt+27]=Ve,this.uint32[rt+14]=je,this.float32[rt+15]=Je,this.float32[rt+16]=Fe,this.float32[rt+17]=nt,this.float32[rt+18]=At,this.uint8[wt+76]=vt,e}}Qd.prototype.bytesPerElement=80,Mi(Qd,"StructArrayLayout2f9i15ui1ul4f1ub80");class Rh extends gs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}Rh.prototype.bytesPerElement=4,Mi(Rh,"StructArrayLayout1f4");class Ou extends gs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,n,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,i,r,n,s)}emplace(e,i,r,n,s,a){const c=5*e;return this.float32[c+0]=i,this.float32[c+1]=r,this.float32[c+2]=n,this.float32[c+3]=s,this.float32[c+4]=a,e}}Ou.prototype.bytesPerElement=20,Mi(Ou,"StructArrayLayout5f20");class Hd extends gs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,n,s,a,c){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,r,n,s,a,c)}emplace(e,i,r,n,s,a,c,p){const _=7*e;return this.float32[_+0]=i,this.float32[_+1]=r,this.float32[_+2]=n,this.float32[_+3]=s,this.float32[_+4]=a,this.float32[_+5]=c,this.float32[_+6]=p,e}}Hd.prototype.bytesPerElement=28,Mi(Hd,"StructArrayLayout7f28");class Fh extends gs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,r,n){const s=this.length;return this.resize(s+1),this.emplace(s,e,i,r,n)}emplace(e,i,r,n,s){const a=6*e;return this.uint32[3*e+0]=i,this.uint16[a+2]=r,this.uint16[a+3]=n,this.uint16[a+4]=s,e}}Fh.prototype.bytesPerElement=12,Mi(Fh,"StructArrayLayout1ul3ui12");class Gc extends gs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}Gc.prototype.bytesPerElement=2,Mi(Gc,"StructArrayLayout1ui2");class Zc extends gs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,i,r)}emplace(e,i,r,n){const s=3*e;return this.float32[s+0]=i,this.float32[s+1]=r,this.float32[s+2]=n,e}}Zc.prototype.bytesPerElement=12,Mi(Zc,"StructArrayLayout3f12");class Oh extends gs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,i)}emplace(e,i,r){const n=2*e;return this.float32[n+0]=i,this.float32[n+1]=r,e}}Oh.prototype.bytesPerElement=8,Mi(Oh,"StructArrayLayout2f8");class Wd extends gs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,n,s,a,c,p,_,v,E,C,B,O,G,q){const X=this.length;return this.resize(X+1),this.emplace(X,e,i,r,n,s,a,c,p,_,v,E,C,B,O,G,q)}emplace(e,i,r,n,s,a,c,p,_,v,E,C,B,O,G,q,X){const $=16*e;return this.float32[$+0]=i,this.float32[$+1]=r,this.float32[$+2]=n,this.float32[$+3]=s,this.float32[$+4]=a,this.float32[$+5]=c,this.float32[$+6]=p,this.float32[$+7]=_,this.float32[$+8]=v,this.float32[$+9]=E,this.float32[$+10]=C,this.float32[$+11]=B,this.float32[$+12]=O,this.float32[$+13]=G,this.float32[$+14]=q,this.float32[$+15]=X,e}}Wd.prototype.bytesPerElement=64,Mi(Wd,"StructArrayLayout16f64");class Nh extends gs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,n,s,a,c){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,r,n,s,a,c)}emplace(e,i,r,n,s,a,c,p){const _=10*e,v=5*e;return this.uint16[_+0]=i,this.uint16[_+1]=r,this.uint16[_+2]=n,this.uint16[_+3]=s,this.float32[v+2]=a,this.float32[v+3]=c,this.float32[v+4]=p,e}}Nh.prototype.bytesPerElement=20,Mi(Nh,"StructArrayLayout4ui3f20");class Xd extends gs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint8[1*e+0]=i,e}}Xd.prototype.bytesPerElement=1,Mi(Xd,"StructArrayLayout1ub1");class Cp extends fu{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Cp.prototype.size=40;class Nu extends pu{get(e){return new Cp(this,e)}}Mi(Nu,"CollisionBoxArray");class Yd extends fu{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Yd.prototype.size=60;class kp extends Sf{get(e){return new Yd(this,e)}}Mi(kp,"PlacedSymbolArray");class Dp extends fu{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}Dp.prototype.size=80;class Pp extends Qd{get(e){return new Dp(this,e)}}Mi(Pp,"SymbolInstanceArray");class zp extends Rh{getoffsetX(e){return this.float32[1*e+0]}}Mi(zp,"GlyphOffsetArray");class Bp extends pl{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Mi(Bp,"SymbolLineVertexArray");class Lp extends fu{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Lp.prototype.size=12;class Kd extends Fh{get(e){return new Lp(this,e)}}Mi(Kd,"FeatureIndexArray");class If extends jc{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Mi(If,"FillExtrusionCentroidArray");const Rp=an([{name:"a_pos",components:2,type:"Int16"}],4),Fp=an([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Mn{constructor(e=[]){this.segments=e}_prepareSegment(e,i,r,n){let s=this.segments[this.segments.length-1];return e>Mn.MAX_VERTEX_ARRAY_LENGTH&&Be(`Max vertices per segment is ${Mn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!s||s.vertexLength+e>Mn.MAX_VERTEX_ARRAY_LENGTH||s.sortKey!==n)&&(s={vertexOffset:i,primitiveOffset:r,vertexLength:0,primitiveLength:0},n!==void 0&&(s.sortKey=n),this.segments.push(s)),s}prepareSegment(e,i,r,n){return this._prepareSegment(e,i.length,r.length,n)}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,r,n){return new Mn([{vertexOffset:e,primitiveOffset:i,vertexLength:r,primitiveLength:n,vaos:{},sortKey:0}])}}function Op(t,e){return 256*(t=Ai(Math.floor(t),0,255))+Ai(Math.floor(e),0,255)}Mn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Mi(Mn,"SegmentVector");const Cf=an([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Y_=an([{name:"a_dash",components:4,type:"Uint16"}]);var Uh={exports:{}},Np={exports:{}};(function(t){t.exports=function(e,i){var r,n,s,a,c,p,_,v;for(n=e.length-(r=3&e.length),s=i,c=3432918353,p=461845907,v=0;v<n;)_=255&e.charCodeAt(v)|(255&e.charCodeAt(++v))<<8|(255&e.charCodeAt(++v))<<16|(255&e.charCodeAt(++v))<<24,++v,s=27492+(65535&(a=5*(65535&(s=(s^=_=(65535&(_=(_=(65535&_)*c+(((_>>>16)*c&65535)<<16)&4294967295)<<15|_>>>17))*p+(((_>>>16)*p&65535)<<16)&4294967295)<<13|s>>>19))+((5*(s>>>16)&65535)<<16)&4294967295))+((58964+(a>>>16)&65535)<<16);switch(_=0,r){case 3:_^=(255&e.charCodeAt(v+2))<<16;case 2:_^=(255&e.charCodeAt(v+1))<<8;case 1:s^=_=(65535&(_=(_=(65535&(_^=255&e.charCodeAt(v)))*c+(((_>>>16)*c&65535)<<16)&4294967295)<<15|_>>>17))*p+(((_>>>16)*p&65535)<<16)&4294967295}return s^=e.length,s=2246822507*(65535&(s^=s>>>16))+((2246822507*(s>>>16)&65535)<<16)&4294967295,s=3266489909*(65535&(s^=s>>>13))+((3266489909*(s>>>16)&65535)<<16)&4294967295,(s^=s>>>16)>>>0}})(Np);var K_=Np.exports,Up={exports:{}};(function(t){t.exports=function(e,i){for(var r,n=e.length,s=i^n,a=0;n>=4;)r=1540483477*(65535&(r=255&e.charCodeAt(a)|(255&e.charCodeAt(++a))<<8|(255&e.charCodeAt(++a))<<16|(255&e.charCodeAt(++a))<<24))+((1540483477*(r>>>16)&65535)<<16),s=1540483477*(65535&s)+((1540483477*(s>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),n-=4,++a;switch(n){case 3:s^=(255&e.charCodeAt(a+2))<<16;case 2:s^=(255&e.charCodeAt(a+1))<<8;case 1:s=1540483477*(65535&(s^=255&e.charCodeAt(a)))+((1540483477*(s>>>16)&65535)<<16)}return s=1540483477*(65535&(s^=s>>>13))+((1540483477*(s>>>16)&65535)<<16),(s^=s>>>15)>>>0}})(Up);var Jd=K_,J_=Up.exports;Uh.exports=Jd,Uh.exports.murmur3=Jd,Uh.exports.murmur2=J_;var $d=_r(Uh.exports);class qc{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,i,r,n){this.ids.push(zo(e)),this.positions.push(i,r,n)}eachPosition(e,i){const r=zo(e);let n=0,s=this.ids.length-1;for(;n<s;){const a=n+s>>1;this.ids[a]>=r?s=a:n=a+1}for(;this.ids[n]===r;)i(this.positions[3*n],this.positions[3*n+1],this.positions[3*n+2]),n++}static serialize(e,i){const r=new Float64Array(e.ids),n=new Uint32Array(e.positions);return kf(r,n,0,r.length-1),i&&(i.add(r.buffer),i.add(n.buffer)),{ids:r,positions:n}}static deserialize(e){const i=new qc;let r;i.ids=e.ids,i.positions=e.positions;for(const n of i.ids)n!==r&&i.uniqueIds.push(n),r=n;return i.indexed=!0,i}}function zo(t){const e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:$d(String(t))}function kf(t,e,i,r){for(;i<r;){const n=t[i+r>>1];let s=i-1,a=r+1;for(;;){do s++;while(t[s]<n);do a--;while(t[a]>n);if(s>=a)break;Vh(t,s,a),Vh(e,3*s,3*a),Vh(e,3*s+1,3*a+1),Vh(e,3*s+2,3*a+2)}a-i<r-a?(kf(t,e,i,a),i=a+1):(kf(t,e,a+1,r),r=a)}}function Vh(t,e,i){const r=t[e];t[e]=t[i],t[i]=r}Mi(qc,"FeaturePositionMap");class mc{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}}class Oi extends mc{constructor(e){super(e),this.current=0}set(e,i,r){this.fetchUniformLocation(e,i)&&this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}}class ei extends mc{constructor(e){super(e),this.current=0}set(e,i,r){this.fetchUniformLocation(e,i)&&this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))}}class Pr extends mc{constructor(e){super(e),this.current=[0,0]}set(e,i,r){this.fetchUniformLocation(e,i)&&(r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1])))}}class Tr extends mc{constructor(e){super(e),this.current=[0,0,0]}set(e,i,r){this.fetchUniformLocation(e,i)&&(r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2])))}}class Bo extends mc{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,r){this.fetchUniformLocation(e,i)&&(r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3])))}}class qA extends mc{constructor(e){super(e),this.current=fr.transparent}set(e,i,r){this.fetchUniformLocation(e,i)&&(r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a)))}}const Vp=new Float32Array(16);class xr extends mc{constructor(e){super(e),this.current=Vp}set(e,i,r){if(this.fetchUniformLocation(e,i)){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let n=1;n<16;n++)if(r[n]!==this.current[n]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}}}const $_=new Float32Array(9);class e0 extends mc{constructor(e){super(e),this.current=$_}set(e,i,r){if(this.fetchUniformLocation(e,i)){for(let n=0;n<9;n++)if(r[n]!==this.current[n]){this.current=r,this.gl.uniformMatrix3fv(this.location,!1,r);break}}}}const eg=new Float32Array(4);class t0 extends mc{constructor(e){super(e),this.current=eg}set(e,i,r){if(this.fetchUniformLocation(e,i)){for(let n=0;n<4;n++)if(r[n]!==this.current[n]){this.current=r,this.gl.uniformMatrix2fv(this.location,!1,r);break}}}}function i0(t){return[Op(255*t.r,255*t.g),Op(255*t.b,255*t.a)]}class jh{constructor(e,i,r){this.value=e,this.uniformNames=i.map(n=>`u_${n}`),this.type=r}setUniform(e,i,r,n,s){i.set(e,s,n.constantOr(this.value))}getBinding(e,i){return this.type==="color"?new qA(e):new ei(e)}}class nh{constructor(e,i){this.uniformNames=i.map(r=>`u_${r}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,i,r,n,s){const a=s==="u_pattern"||s==="u_dash"?this.pattern:s==="u_pixel_ratio"?this.pixelRatio:null;a&&i.set(e,s,a)}getBinding(e,i){return i==="u_pattern"||i==="u_dash"?new Bo(e):new ei(e)}}class Qc{constructor(e,i,r,n){this.expression=e,this.type=r,this.maxValue=0,this.paintVertexAttributes=i.map(s=>({name:`a_${s}`,type:"Float32",components:r==="color"?2:1,offset:0})),this.paintVertexArray=new n}populatePaintArray(e,i,r,n,s,a,c){const p=this.paintVertexArray.length,_=this.expression.evaluate(new _s(0,{brightness:a}),i,{},s,n,c);this.paintVertexArray.resize(e),this._setPaintValue(p,e,_)}updatePaintArray(e,i,r,n,s,a,c){const p=this.expression.evaluate({zoom:0,brightness:c},r,n,void 0,s);this._setPaintValue(e,i,p)}_setPaintValue(e,i,r){if(this.type==="color"){const n=i0(r);for(let s=e;s<i;s++)this.paintVertexArray.emplace(s,n[0],n[1])}else{for(let n=e;n<i;n++)this.paintVertexArray.emplace(n,r);this.maxValue=Math.max(this.maxValue,Math.abs(r))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Zl{constructor(e,i,r,n,s,a){this.expression=e,this.uniformNames=i.map(c=>`u_${c}_t`),this.type=r,this.useIntegerZoom=n,this.zoom=s,this.maxValue=0,this.paintVertexAttributes=i.map(c=>({name:`a_${c}`,type:"Float32",components:r==="color"?4:2,offset:0})),this.paintVertexArray=new a}populatePaintArray(e,i,r,n,s,a,c){const p=this.expression.evaluate(new _s(this.zoom,{brightness:a}),i,{},s,n,c),_=this.expression.evaluate(new _s(this.zoom+1,{brightness:a}),i,{},s,n,c),v=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(v,e,p,_)}updatePaintArray(e,i,r,n,s,a,c){const p=this.expression.evaluate({zoom:this.zoom,brightness:c},r,n,void 0,s),_=this.expression.evaluate({zoom:this.zoom+1,brightness:c},r,n,void 0,s);this._setPaintValue(e,i,p,_)}_setPaintValue(e,i,r,n){if(this.type==="color"){const s=i0(r),a=i0(n);for(let c=e;c<i;c++)this.paintVertexArray.emplace(c,s[0],s[1],a[0],a[1])}else{for(let s=e;s<i;s++)this.paintVertexArray.emplace(s,r,n);this.maxValue=Math.max(this.maxValue,Math.abs(r),Math.abs(n))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,r,n,s){const a=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,c=Ai(this.expression.interpolationFactor(a,this.zoom,this.zoom+1),0,1);i.set(e,s,c)}getBinding(e,i){return new ei(e)}}class cA{constructor(e,i,r,n,s){this.expression=e,this.layerId=s,this.paintVertexAttributes=(r==="array"?Y_:Cf).members;for(let a=0;a<i.length;++a);this.paintVertexArray=new n}populatePaintArray(e,i,r){const n=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(n,e,i.patterns&&i.patterns[this.layerId],r)}updatePaintArray(e,i,r,n,s,a,c){this._setPaintValues(e,i,r.patterns&&r.patterns[this.layerId],a)}_setPaintValues(e,i,r,n){if(!n||!r)return;const s=n[r];if(!s)return;const{tl:a,br:c,pixelRatio:p}=s;for(let _=e;_<i;_++)this.paintVertexArray.emplace(_,a[0],a[1],c[0],c[1],p)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class mu{constructor(e,i,r=()=>!0){this.binders={},this._buffers=[];const n=[];for(const s in e.paint._values){const a=e.paint.get(s);if(!r(s)||!(a instanceof Ps&&ot(a.property.specification)))continue;const c=tg(s,e.type),p=a.value,_=a.property.specification.type,v=!!a.property.useIntegerZoom,E=s==="line-dasharray"||s.endsWith("pattern"),C=s==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(p.kind!=="constant"||C)if(p.kind==="source"||C||E){const B=n0(s,_,"source");this.binders[s]=E?new cA(p,c,_,B,e.id):new Qc(p,c,_,B),n.push(`/a_${s}`)}else{const B=n0(s,_,"composite");this.binders[s]=new Zl(p,c,_,v,i,B),n.push(`/z_${s}`)}else this.binders[s]=E?new nh(p.value,c):new jh(p.value,c,_),n.push(`/u_${s}`)}this.cacheKey=n.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof Qc||i instanceof Zl?i.maxValue:0}populatePaintArrays(e,i,r,n,s,a,c){for(const p in this.binders){const _=this.binders[p];(_ instanceof Qc||_ instanceof Zl||_ instanceof cA)&&_.populatePaintArray(e,i,r,n,s,a,c)}}setConstantPatternPositions(e){for(const i in this.binders){const r=this.binders[i];r instanceof nh&&r.setConstantPatternPositions(e)}}updatePaintArrays(e,i,r,n,s,a,c,p){let _=!1;const v=Object.keys(e),E=v.length!==0,C=E?v:i.uniqueIds;for(const B in this.binders){const O=this.binders[B];if((O instanceof Qc||O instanceof Zl||O instanceof cA)&&(O.expression.isStateDependent===!0||O.expression.isLightConstant===!1)){const G=s.paint.get(B);O.expression=G.value;for(const q of C){const X=e[q.toString()];i.eachPosition(q,($,re,ne)=>{const ie=n.feature($);O.updatePaintArray(re,ne,ie,X,a,c,p)})}if(!E)for(const q of r.uniqueIds){const X=e[q.toString()];r.eachPosition(q,($,re,ne)=>{const ie=n.feature($);O.updatePaintArray(re,ne,ie,X,a,c,p)})}_=!0}}return _}defines(){const e=[];for(const i in this.binders){const r=this.binders[i];(r instanceof jh||r instanceof nh)&&e.push(...r.uniformNames.map(n=>`#define HAS_UNIFORM_${n}`))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const r=this.binders[i];if(r instanceof Qc||r instanceof Zl||r instanceof cA)for(let n=0;n<r.paintVertexAttributes.length;n++)e.push(r.paintVertexAttributes[n].name)}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const r=this.binders[i];if(r instanceof jh||r instanceof nh||r instanceof Zl)for(const n of r.uniformNames)e.push(n)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const r in this.binders){const n=this.binders[r];if(n instanceof jh||n instanceof nh||n instanceof Zl)for(const s of n.uniformNames)i.push({name:s,property:r,binding:n.getBinding(e,s)})}return i}setUniforms(e,i,r,n,s){for(const{name:a,property:c,binding:p}of r)this.binders[c].setUniform(e,p,s,n.get(c),a)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const i=this.binders[e];(i instanceof Qc||i instanceof Zl||i instanceof cA)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}}upload(e){for(const i in this.binders){const r=this.binders[i];(r instanceof Qc||r instanceof Zl||r instanceof cA)&&r.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof Qc||i instanceof Zl||i instanceof cA)&&i.destroy()}}}class _c{constructor(e,i,r=()=>!0){this.programConfigurations={};for(const n of e)this.programConfigurations[n.id]=new mu(n,i,r);this.needsUpload=!1,this._featureMap=new qc,this._featureMapWithoutIds=new qc,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,i,r,n,s,a,c,p){for(const _ in this.programConfigurations)this.programConfigurations[_].populatePaintArrays(e,i,n,s,a,c,p);i.id!==void 0?this._featureMap.add(i.id,r,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,r,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,r,n,s,a){for(const c of r)this.needsUpload=this.programConfigurations[c.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,i,c,n,s,a||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const r0={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function tg(t,e){return r0[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}const ig={"line-pattern":{source:du,composite:du},"fill-pattern":{source:du,composite:du},"fill-extrusion-pattern":{source:du,composite:du},"line-dasharray":{source:Tf,composite:Tf}},rg={color:{source:Oh,composite:Vc},number:{source:Rh,composite:Oh}};function n0(t,e,i){const r=ig[t];return r&&r[i]||rg[e][i]}Mi(jh,"ConstantBinder"),Mi(nh,"PatternConstantBinder"),Mi(Qc,"SourceExpressionBinder"),Mi(cA,"PatternCompositeBinder"),Mi(Zl,"CompositeExpressionBinder"),Mi(mu,"ProgramConfiguration",{omit:["_buffers"]}),Mi(_c,"ProgramConfigurationSet");class kl{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof er?new er(e.lng,e.lat):er.convert(e),this}setSouthWest(e){return this._sw=e instanceof er?new er(e.lng,e.lat):er.convert(e),this}extend(e){const i=this._sw,r=this._ne;let n,s;if(e instanceof er)n=e,s=e;else{if(!(e instanceof kl))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(kl.convert(e)):this.extend(er.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(er.convert(e)):this;if(n=e._sw,s=e._ne,!n||!s)return this}return i||r?(i.lng=Math.min(n.lng,i.lng),i.lat=Math.min(n.lat,i.lat),r.lng=Math.max(s.lng,r.lng),r.lat=Math.max(s.lat,r.lat)):(this._sw=new er(n.lng,n.lat),this._ne=new er(s.lng,s.lat)),this}getCenter(){return new er((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new er(this.getWest(),this.getNorth())}getSouthEast(){return new er(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:r}=er.convert(e);let n=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(n=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=r&&r<=this._ne.lat&&n}static convert(e){return!e||e instanceof kl?e:new kl(e)}}var Wn={},So={};Object.defineProperty(So,"__esModule",{value:!0}),So.setMatrixArrayType=function(t){So.ARRAY_TYPE=Hc=t},So.toRadian=function(t){return t*Zh},So.equals=function(t,e){return Math.abs(t-e)<=s0*Math.max(1,Math.abs(t),Math.abs(e))},So.RANDOM=So.ARRAY_TYPE=So.EPSILON=void 0;var s0=1e-6;So.EPSILON=s0;var Hc=typeof Float32Array<"u"?Float32Array:Array;So.ARRAY_TYPE=Hc;var Gh=Math.random;So.RANDOM=Gh;var Zh=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Xn={};function sh(t){return sh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},sh(t)}Object.defineProperty(Xn,"__esModule",{value:!0}),Xn.create=function(){var t=new QA.ARRAY_TYPE(4);return QA.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},Xn.clone=function(t){var e=new QA.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Xn.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Xn.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},Xn.fromValues=function(t,e,i,r){var n=new QA.ARRAY_TYPE(4);return n[0]=t,n[1]=e,n[2]=i,n[3]=r,n},Xn.set=function(t,e,i,r,n){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t},Xn.transpose=function(t,e){if(t===e){var i=e[1];t[1]=e[2],t[2]=i}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},Xn.invert=function(t,e){var i=e[0],r=e[1],n=e[2],s=e[3],a=i*s-n*r;return a?(t[0]=s*(a=1/a),t[1]=-r*a,t[2]=-n*a,t[3]=i*a,t):null},Xn.adjoint=function(t,e){var i=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=i,t},Xn.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},Xn.multiply=o0,Xn.rotate=function(t,e,i){var r=e[0],n=e[1],s=e[2],a=e[3],c=Math.sin(i),p=Math.cos(i);return t[0]=r*p+s*c,t[1]=n*p+a*c,t[2]=r*-c+s*p,t[3]=n*-c+a*p,t},Xn.scale=function(t,e,i){var r=e[1],n=e[2],s=e[3],a=i[0],c=i[1];return t[0]=e[0]*a,t[1]=r*a,t[2]=n*c,t[3]=s*c,t},Xn.fromRotation=function(t,e){var i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=-i,t[3]=r,t},Xn.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},Xn.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Xn.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},Xn.LDU=function(t,e,i,r){return t[2]=r[2]/r[0],i[0]=r[0],i[1]=r[1],i[3]=r[3]-t[2]*i[1],[t,e,i]},Xn.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t},Xn.subtract=a0,Xn.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},Xn.equals=function(t,e){var i=t[0],r=t[1],n=t[2],s=t[3],a=e[0],c=e[1],p=e[2],_=e[3];return Math.abs(i-a)<=QA.EPSILON*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(r-c)<=QA.EPSILON*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(n-p)<=QA.EPSILON*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(s-_)<=QA.EPSILON*Math.max(1,Math.abs(s),Math.abs(_))},Xn.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t},Xn.multiplyScalarAndAdd=function(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t},Xn.sub=Xn.mul=void 0;var QA=function(t,e){if(t&&t.__esModule)return t;if(t===null||sh(t)!=="object"&&typeof t!="function")return{default:t};var i=jp(void 0);if(i&&i.has(t))return i.get(t);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in t)if(s!=="default"&&Object.prototype.hasOwnProperty.call(t,s)){var a=n?Object.getOwnPropertyDescriptor(t,s):null;a&&(a.get||a.set)?Object.defineProperty(r,s,a):r[s]=t[s]}return r.default=t,i&&i.set(t,r),r}(So);function jp(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(jp=function(r){return r?i:e})(t)}function o0(t,e,i){var r=e[0],n=e[1],s=e[2],a=e[3],c=i[0],p=i[1],_=i[2],v=i[3];return t[0]=r*c+s*p,t[1]=n*c+a*p,t[2]=r*_+s*v,t[3]=n*_+a*v,t}function a0(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}Xn.mul=o0,Xn.sub=a0;var ws={};function Df(t){return Df=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Df(t)}Object.defineProperty(ws,"__esModule",{value:!0}),ws.create=function(){var t=new HA.ARRAY_TYPE(6);return HA.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t},ws.clone=function(t){var e=new HA.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},ws.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},ws.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},ws.fromValues=function(t,e,i,r,n,s){var a=new HA.ARRAY_TYPE(6);return a[0]=t,a[1]=e,a[2]=i,a[3]=r,a[4]=n,a[5]=s,a},ws.set=function(t,e,i,r,n,s,a){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t[4]=s,t[5]=a,t},ws.invert=function(t,e){var i=e[0],r=e[1],n=e[2],s=e[3],a=e[4],c=e[5],p=i*s-r*n;return p?(t[0]=s*(p=1/p),t[1]=-r*p,t[2]=-n*p,t[3]=i*p,t[4]=(n*c-s*a)*p,t[5]=(r*a-i*c)*p,t):null},ws.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},ws.multiply=zf,ws.rotate=function(t,e,i){var r=e[0],n=e[1],s=e[2],a=e[3],c=e[4],p=e[5],_=Math.sin(i),v=Math.cos(i);return t[0]=r*v+s*_,t[1]=n*v+a*_,t[2]=r*-_+s*v,t[3]=n*-_+a*v,t[4]=c,t[5]=p,t},ws.scale=function(t,e,i){var r=e[1],n=e[2],s=e[3],a=e[4],c=e[5],p=i[0],_=i[1];return t[0]=e[0]*p,t[1]=r*p,t[2]=n*_,t[3]=s*_,t[4]=a,t[5]=c,t},ws.translate=function(t,e,i){var r=e[0],n=e[1],s=e[2],a=e[3],c=e[4],p=e[5],_=i[0],v=i[1];return t[0]=r,t[1]=n,t[2]=s,t[3]=a,t[4]=r*_+s*v+c,t[5]=n*_+a*v+p,t},ws.fromRotation=function(t,e){var i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=-i,t[3]=r,t[4]=0,t[5]=0,t},ws.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},ws.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},ws.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},ws.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)},ws.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t},ws.subtract=Gp,ws.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t},ws.multiplyScalarAndAdd=function(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t},ws.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},ws.equals=function(t,e){var i=t[0],r=t[1],n=t[2],s=t[3],a=t[4],c=t[5],p=e[0],_=e[1],v=e[2],E=e[3],C=e[4],B=e[5];return Math.abs(i-p)<=HA.EPSILON*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(r-_)<=HA.EPSILON*Math.max(1,Math.abs(r),Math.abs(_))&&Math.abs(n-v)<=HA.EPSILON*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(s-E)<=HA.EPSILON*Math.max(1,Math.abs(s),Math.abs(E))&&Math.abs(a-C)<=HA.EPSILON*Math.max(1,Math.abs(a),Math.abs(C))&&Math.abs(c-B)<=HA.EPSILON*Math.max(1,Math.abs(c),Math.abs(B))},ws.sub=ws.mul=void 0;var HA=function(t,e){if(t&&t.__esModule)return t;if(t===null||Df(t)!=="object"&&typeof t!="function")return{default:t};var i=Pf(void 0);if(i&&i.has(t))return i.get(t);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in t)if(s!=="default"&&Object.prototype.hasOwnProperty.call(t,s)){var a=n?Object.getOwnPropertyDescriptor(t,s):null;a&&(a.get||a.set)?Object.defineProperty(r,s,a):r[s]=t[s]}return r.default=t,i&&i.set(t,r),r}(So);function Pf(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(Pf=function(r){return r?i:e})(t)}function zf(t,e,i){var r=e[0],n=e[1],s=e[2],a=e[3],c=e[4],p=e[5],_=i[0],v=i[1],E=i[2],C=i[3],B=i[4],O=i[5];return t[0]=r*_+s*v,t[1]=n*_+a*v,t[2]=r*E+s*C,t[3]=n*E+a*C,t[4]=r*B+s*O+c,t[5]=n*B+a*O+p,t}function Gp(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t}ws.mul=zf,ws.sub=Gp;var Fn={};function Bf(t){return Bf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Bf(t)}Object.defineProperty(Fn,"__esModule",{value:!0}),Fn.create=function(){var t=new Ka.ARRAY_TYPE(9);return Ka.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},Fn.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},Fn.clone=function(t){var e=new Ka.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},Fn.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},Fn.fromValues=function(t,e,i,r,n,s,a,c,p){var _=new Ka.ARRAY_TYPE(9);return _[0]=t,_[1]=e,_[2]=i,_[3]=r,_[4]=n,_[5]=s,_[6]=a,_[7]=c,_[8]=p,_},Fn.set=function(t,e,i,r,n,s,a,c,p,_){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t[4]=s,t[5]=a,t[6]=c,t[7]=p,t[8]=_,t},Fn.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},Fn.transpose=function(t,e){if(t===e){var i=e[1],r=e[2],n=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=r,t[7]=n}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},Fn.invert=function(t,e){var i=e[0],r=e[1],n=e[2],s=e[3],a=e[4],c=e[5],p=e[6],_=e[7],v=e[8],E=v*a-c*_,C=-v*s+c*p,B=_*s-a*p,O=i*E+r*C+n*B;return O?(t[0]=E*(O=1/O),t[1]=(-v*r+n*_)*O,t[2]=(c*r-n*a)*O,t[3]=C*O,t[4]=(v*i-n*p)*O,t[5]=(-c*i+n*s)*O,t[6]=B*O,t[7]=(-_*i+r*p)*O,t[8]=(a*i-r*s)*O,t):null},Fn.adjoint=function(t,e){var i=e[0],r=e[1],n=e[2],s=e[3],a=e[4],c=e[5],p=e[6],_=e[7],v=e[8];return t[0]=a*v-c*_,t[1]=n*_-r*v,t[2]=r*c-n*a,t[3]=c*p-s*v,t[4]=i*v-n*p,t[5]=n*s-i*c,t[6]=s*_-a*p,t[7]=r*p-i*_,t[8]=i*a-r*s,t},Fn.determinant=function(t){var e=t[3],i=t[4],r=t[5],n=t[6],s=t[7],a=t[8];return t[0]*(a*i-r*s)+t[1]*(-a*e+r*n)+t[2]*(s*e-i*n)},Fn.multiply=Wc,Fn.translate=function(t,e,i){var r=e[0],n=e[1],s=e[2],a=e[3],c=e[4],p=e[5],_=e[6],v=e[7],E=e[8],C=i[0],B=i[1];return t[0]=r,t[1]=n,t[2]=s,t[3]=a,t[4]=c,t[5]=p,t[6]=C*r+B*a+_,t[7]=C*n+B*c+v,t[8]=C*s+B*p+E,t},Fn.rotate=function(t,e,i){var r=e[0],n=e[1],s=e[2],a=e[3],c=e[4],p=e[5],_=e[6],v=e[7],E=e[8],C=Math.sin(i),B=Math.cos(i);return t[0]=B*r+C*a,t[1]=B*n+C*c,t[2]=B*s+C*p,t[3]=B*a-C*r,t[4]=B*c-C*n,t[5]=B*p-C*s,t[6]=_,t[7]=v,t[8]=E,t},Fn.scale=function(t,e,i){var r=i[0],n=i[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=n*e[3],t[4]=n*e[4],t[5]=n*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},Fn.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},Fn.fromRotation=function(t,e){var i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=0,t[3]=-i,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},Fn.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},Fn.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},Fn.fromQuat=function(t,e){var i=e[0],r=e[1],n=e[2],s=e[3],a=i+i,c=r+r,p=n+n,_=i*a,v=r*a,E=r*c,C=n*a,B=n*c,O=n*p,G=s*a,q=s*c,X=s*p;return t[0]=1-E-O,t[3]=v-X,t[6]=C+q,t[1]=v+X,t[4]=1-_-O,t[7]=B-G,t[2]=C-q,t[5]=B+G,t[8]=1-_-E,t},Fn.normalFromMat4=function(t,e){var i=e[0],r=e[1],n=e[2],s=e[3],a=e[4],c=e[5],p=e[6],_=e[7],v=e[8],E=e[9],C=e[10],B=e[11],O=e[12],G=e[13],q=e[14],X=e[15],$=i*c-r*a,re=i*p-n*a,ne=i*_-s*a,ie=r*p-n*c,se=r*_-s*c,he=n*_-s*p,ve=v*G-E*O,be=v*q-C*O,De=v*X-B*O,Ve=E*q-C*G,je=E*X-B*G,Je=C*X-B*q,Fe=$*Je-re*je+ne*Ve+ie*De-se*be+he*ve;return Fe?(t[0]=(c*Je-p*je+_*Ve)*(Fe=1/Fe),t[1]=(p*De-a*Je-_*be)*Fe,t[2]=(a*je-c*De+_*ve)*Fe,t[3]=(n*je-r*Je-s*Ve)*Fe,t[4]=(i*Je-n*De+s*be)*Fe,t[5]=(r*De-i*je-s*ve)*Fe,t[6]=(G*he-q*se+X*ie)*Fe,t[7]=(q*ne-O*he-X*re)*Fe,t[8]=(O*se-G*ne+X*$)*Fe,t):null},Fn.projection=function(t,e,i){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/i,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t},Fn.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},Fn.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},Fn.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t},Fn.subtract=l0,Fn.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t},Fn.multiplyScalarAndAdd=function(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t[6]=e[6]+i[6]*r,t[7]=e[7]+i[7]*r,t[8]=e[8]+i[8]*r,t},Fn.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},Fn.equals=function(t,e){var i=t[0],r=t[1],n=t[2],s=t[3],a=t[4],c=t[5],p=t[6],_=t[7],v=t[8],E=e[0],C=e[1],B=e[2],O=e[3],G=e[4],q=e[5],X=e[6],$=e[7],re=e[8];return Math.abs(i-E)<=Ka.EPSILON*Math.max(1,Math.abs(i),Math.abs(E))&&Math.abs(r-C)<=Ka.EPSILON*Math.max(1,Math.abs(r),Math.abs(C))&&Math.abs(n-B)<=Ka.EPSILON*Math.max(1,Math.abs(n),Math.abs(B))&&Math.abs(s-O)<=Ka.EPSILON*Math.max(1,Math.abs(s),Math.abs(O))&&Math.abs(a-G)<=Ka.EPSILON*Math.max(1,Math.abs(a),Math.abs(G))&&Math.abs(c-q)<=Ka.EPSILON*Math.max(1,Math.abs(c),Math.abs(q))&&Math.abs(p-X)<=Ka.EPSILON*Math.max(1,Math.abs(p),Math.abs(X))&&Math.abs(_-$)<=Ka.EPSILON*Math.max(1,Math.abs(_),Math.abs($))&&Math.abs(v-re)<=Ka.EPSILON*Math.max(1,Math.abs(v),Math.abs(re))},Fn.sub=Fn.mul=void 0;var Ka=function(t,e){if(t&&t.__esModule)return t;if(t===null||Bf(t)!=="object"&&typeof t!="function")return{default:t};var i=WA(void 0);if(i&&i.has(t))return i.get(t);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in t)if(s!=="default"&&Object.prototype.hasOwnProperty.call(t,s)){var a=n?Object.getOwnPropertyDescriptor(t,s):null;a&&(a.get||a.set)?Object.defineProperty(r,s,a):r[s]=t[s]}return r.default=t,i&&i.set(t,r),r}(So);function WA(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(WA=function(r){return r?i:e})(t)}function Wc(t,e,i){var r=e[0],n=e[1],s=e[2],a=e[3],c=e[4],p=e[5],_=e[6],v=e[7],E=e[8],C=i[0],B=i[1],O=i[2],G=i[3],q=i[4],X=i[5],$=i[6],re=i[7],ne=i[8];return t[0]=C*r+B*a+O*_,t[1]=C*n+B*c+O*v,t[2]=C*s+B*p+O*E,t[3]=G*r+q*a+X*_,t[4]=G*n+q*c+X*v,t[5]=G*s+q*p+X*E,t[6]=$*r+re*a+ne*_,t[7]=$*n+re*c+ne*v,t[8]=$*s+re*p+ne*E,t}function l0(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t}Fn.mul=Wc,Fn.sub=l0;var Er={};function A0(t){return A0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},A0(t)}Object.defineProperty(Er,"__esModule",{value:!0}),Er.create=function(){var t=new Us.ARRAY_TYPE(16);return Us.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},Er.clone=function(t){var e=new Us.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},Er.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},Er.fromValues=function(t,e,i,r,n,s,a,c,p,_,v,E,C,B,O,G){var q=new Us.ARRAY_TYPE(16);return q[0]=t,q[1]=e,q[2]=i,q[3]=r,q[4]=n,q[5]=s,q[6]=a,q[7]=c,q[8]=p,q[9]=_,q[10]=v,q[11]=E,q[12]=C,q[13]=B,q[14]=O,q[15]=G,q},Er.set=function(t,e,i,r,n,s,a,c,p,_,v,E,C,B,O,G,q){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t[4]=s,t[5]=a,t[6]=c,t[7]=p,t[8]=_,t[9]=v,t[10]=E,t[11]=C,t[12]=B,t[13]=O,t[14]=G,t[15]=q,t},Er.identity=Lf,Er.transpose=function(t,e){if(t===e){var i=e[1],r=e[2],n=e[3],s=e[6],a=e[7],c=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=s,t[11]=e[14],t[12]=n,t[13]=a,t[14]=c}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},Er.invert=function(t,e){var i=e[0],r=e[1],n=e[2],s=e[3],a=e[4],c=e[5],p=e[6],_=e[7],v=e[8],E=e[9],C=e[10],B=e[11],O=e[12],G=e[13],q=e[14],X=e[15],$=i*c-r*a,re=i*p-n*a,ne=i*_-s*a,ie=r*p-n*c,se=r*_-s*c,he=n*_-s*p,ve=v*G-E*O,be=v*q-C*O,De=v*X-B*O,Ve=E*q-C*G,je=E*X-B*G,Je=C*X-B*q,Fe=$*Je-re*je+ne*Ve+ie*De-se*be+he*ve;return Fe?(t[0]=(c*Je-p*je+_*Ve)*(Fe=1/Fe),t[1]=(n*je-r*Je-s*Ve)*Fe,t[2]=(G*he-q*se+X*ie)*Fe,t[3]=(C*se-E*he-B*ie)*Fe,t[4]=(p*De-a*Je-_*be)*Fe,t[5]=(i*Je-n*De+s*be)*Fe,t[6]=(q*ne-O*he-X*re)*Fe,t[7]=(v*he-C*ne+B*re)*Fe,t[8]=(a*je-c*De+_*ve)*Fe,t[9]=(r*De-i*je-s*ve)*Fe,t[10]=(O*se-G*ne+X*$)*Fe,t[11]=(E*ne-v*se-B*$)*Fe,t[12]=(c*be-a*Ve-p*ve)*Fe,t[13]=(i*Ve-r*be+n*ve)*Fe,t[14]=(G*re-O*ie-q*$)*Fe,t[15]=(v*ie-E*re+C*$)*Fe,t):null},Er.adjoint=function(t,e){var i=e[0],r=e[1],n=e[2],s=e[3],a=e[4],c=e[5],p=e[6],_=e[7],v=e[8],E=e[9],C=e[10],B=e[11],O=e[12],G=e[13],q=e[14],X=e[15];return t[0]=c*(C*X-B*q)-E*(p*X-_*q)+G*(p*B-_*C),t[1]=-(r*(C*X-B*q)-E*(n*X-s*q)+G*(n*B-s*C)),t[2]=r*(p*X-_*q)-c*(n*X-s*q)+G*(n*_-s*p),t[3]=-(r*(p*B-_*C)-c*(n*B-s*C)+E*(n*_-s*p)),t[4]=-(a*(C*X-B*q)-v*(p*X-_*q)+O*(p*B-_*C)),t[5]=i*(C*X-B*q)-v*(n*X-s*q)+O*(n*B-s*C),t[6]=-(i*(p*X-_*q)-a*(n*X-s*q)+O*(n*_-s*p)),t[7]=i*(p*B-_*C)-a*(n*B-s*C)+v*(n*_-s*p),t[8]=a*(E*X-B*G)-v*(c*X-_*G)+O*(c*B-_*E),t[9]=-(i*(E*X-B*G)-v*(r*X-s*G)+O*(r*B-s*E)),t[10]=i*(c*X-_*G)-a*(r*X-s*G)+O*(r*_-s*c),t[11]=-(i*(c*B-_*E)-a*(r*B-s*E)+v*(r*_-s*c)),t[12]=-(a*(E*q-C*G)-v*(c*q-p*G)+O*(c*C-p*E)),t[13]=i*(E*q-C*G)-v*(r*q-n*G)+O*(r*C-n*E),t[14]=-(i*(c*q-p*G)-a*(r*q-n*G)+O*(r*p-n*c)),t[15]=i*(c*C-p*E)-a*(r*C-n*E)+v*(r*p-n*c),t},Er.determinant=function(t){var e=t[0],i=t[1],r=t[2],n=t[3],s=t[4],a=t[5],c=t[6],p=t[7],_=t[8],v=t[9],E=t[10],C=t[11],B=t[12],O=t[13],G=t[14],q=t[15];return(e*a-i*s)*(E*q-C*G)-(e*c-r*s)*(v*q-C*O)+(e*p-n*s)*(v*G-E*O)+(i*c-r*a)*(_*q-C*B)-(i*p-n*a)*(_*G-E*B)+(r*p-n*c)*(_*O-v*B)},Er.multiply=Zp,Er.translate=function(t,e,i){var r,n,s,a,c,p,_,v,E,C,B,O,G=i[0],q=i[1],X=i[2];return e===t?(t[12]=e[0]*G+e[4]*q+e[8]*X+e[12],t[13]=e[1]*G+e[5]*q+e[9]*X+e[13],t[14]=e[2]*G+e[6]*q+e[10]*X+e[14],t[15]=e[3]*G+e[7]*q+e[11]*X+e[15]):(n=e[1],s=e[2],a=e[3],c=e[4],p=e[5],_=e[6],v=e[7],E=e[8],C=e[9],B=e[10],O=e[11],t[0]=r=e[0],t[1]=n,t[2]=s,t[3]=a,t[4]=c,t[5]=p,t[6]=_,t[7]=v,t[8]=E,t[9]=C,t[10]=B,t[11]=O,t[12]=r*G+c*q+E*X+e[12],t[13]=n*G+p*q+C*X+e[13],t[14]=s*G+_*q+B*X+e[14],t[15]=a*G+v*q+O*X+e[15]),t},Er.scale=function(t,e,i){var r=i[0],n=i[1],s=i[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},Er.rotate=function(t,e,i,r){var n,s,a,c,p,_,v,E,C,B,O,G,q,X,$,re,ne,ie,se,he,ve,be,De,Ve,je=r[0],Je=r[1],Fe=r[2],nt=Math.hypot(je,Je,Fe);return nt<Us.EPSILON?null:(je*=nt=1/nt,Je*=nt,Fe*=nt,n=Math.sin(i),s=Math.cos(i),p=e[1],_=e[2],v=e[3],C=e[5],B=e[6],O=e[7],q=e[9],X=e[10],$=e[11],se=je*Je*(a=1-s)-Fe*n,he=Je*Je*a+s,ve=Fe*Je*a+je*n,be=je*Fe*a+Je*n,De=Je*Fe*a-je*n,Ve=Fe*Fe*a+s,t[0]=(c=e[0])*(re=je*je*a+s)+(E=e[4])*(ne=Je*je*a+Fe*n)+(G=e[8])*(ie=Fe*je*a-Je*n),t[1]=p*re+C*ne+q*ie,t[2]=_*re+B*ne+X*ie,t[3]=v*re+O*ne+$*ie,t[4]=c*se+E*he+G*ve,t[5]=p*se+C*he+q*ve,t[6]=_*se+B*he+X*ve,t[7]=v*se+O*he+$*ve,t[8]=c*be+E*De+G*Ve,t[9]=p*be+C*De+q*Ve,t[10]=_*be+B*De+X*Ve,t[11]=v*be+O*De+$*Ve,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},Er.rotateX=function(t,e,i){var r=Math.sin(i),n=Math.cos(i),s=e[4],a=e[5],c=e[6],p=e[7],_=e[8],v=e[9],E=e[10],C=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*n+_*r,t[5]=a*n+v*r,t[6]=c*n+E*r,t[7]=p*n+C*r,t[8]=_*n-s*r,t[9]=v*n-a*r,t[10]=E*n-c*r,t[11]=C*n-p*r,t},Er.rotateY=function(t,e,i){var r=Math.sin(i),n=Math.cos(i),s=e[0],a=e[1],c=e[2],p=e[3],_=e[8],v=e[9],E=e[10],C=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*n-_*r,t[1]=a*n-v*r,t[2]=c*n-E*r,t[3]=p*n-C*r,t[8]=s*r+_*n,t[9]=a*r+v*n,t[10]=c*r+E*n,t[11]=p*r+C*n,t},Er.rotateZ=function(t,e,i){var r=Math.sin(i),n=Math.cos(i),s=e[0],a=e[1],c=e[2],p=e[3],_=e[4],v=e[5],E=e[6],C=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*n+_*r,t[1]=a*n+v*r,t[2]=c*n+E*r,t[3]=p*n+C*r,t[4]=_*n-s*r,t[5]=v*n-a*r,t[6]=E*n-c*r,t[7]=C*n-p*r,t},Er.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},Er.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Er.fromRotation=function(t,e,i){var r,n,s,a=i[0],c=i[1],p=i[2],_=Math.hypot(a,c,p);return _<Us.EPSILON?null:(a*=_=1/_,c*=_,p*=_,r=Math.sin(e),n=Math.cos(e),t[0]=a*a*(s=1-n)+n,t[1]=c*a*s+p*r,t[2]=p*a*s-c*r,t[3]=0,t[4]=a*c*s-p*r,t[5]=c*c*s+n,t[6]=p*c*s+a*r,t[7]=0,t[8]=a*p*s+c*r,t[9]=c*p*s-a*r,t[10]=p*p*s+n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},Er.fromXRotation=function(t,e){var i=Math.sin(e),r=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=i,t[7]=0,t[8]=0,t[9]=-i,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Er.fromYRotation=function(t,e){var i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=0,t[2]=-i,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=i,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Er.fromZRotation=function(t,e){var i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=0,t[3]=0,t[4]=-i,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Er.fromRotationTranslation=Rf,Er.fromQuat2=function(t,e){var i=new Us.ARRAY_TYPE(3),r=-e[0],n=-e[1],s=-e[2],a=e[3],c=e[4],p=e[5],_=e[6],v=e[7],E=r*r+n*n+s*s+a*a;return E>0?(i[0]=2*(c*a+v*r+p*s-_*n)/E,i[1]=2*(p*a+v*n+_*r-c*s)/E,i[2]=2*(_*a+v*s+c*n-p*r)/E):(i[0]=2*(c*a+v*r+p*s-_*n),i[1]=2*(p*a+v*n+_*r-c*s),i[2]=2*(_*a+v*s+c*n-p*r)),Rf(t,e,i),t},Er.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},Er.getScaling=Ff,Er.getRotation=function(t,e){var i=new Us.ARRAY_TYPE(3);Ff(i,e);var r=1/i[0],n=1/i[1],s=1/i[2],a=e[0]*r,c=e[1]*n,p=e[2]*s,_=e[4]*r,v=e[5]*n,E=e[6]*s,C=e[8]*r,B=e[9]*n,O=e[10]*s,G=a+v+O,q=0;return G>0?(q=2*Math.sqrt(G+1),t[3]=.25*q,t[0]=(E-B)/q,t[1]=(C-p)/q,t[2]=(c-_)/q):a>v&&a>O?(q=2*Math.sqrt(1+a-v-O),t[3]=(E-B)/q,t[0]=.25*q,t[1]=(c+_)/q,t[2]=(C+p)/q):v>O?(q=2*Math.sqrt(1+v-a-O),t[3]=(C-p)/q,t[0]=(c+_)/q,t[1]=.25*q,t[2]=(E+B)/q):(q=2*Math.sqrt(1+O-a-v),t[3]=(c-_)/q,t[0]=(C+p)/q,t[1]=(E+B)/q,t[2]=.25*q),t},Er.fromRotationTranslationScale=function(t,e,i,r){var n=e[0],s=e[1],a=e[2],c=e[3],p=n+n,_=s+s,v=a+a,E=n*p,C=n*_,B=n*v,O=s*_,G=s*v,q=a*v,X=c*p,$=c*_,re=c*v,ne=r[0],ie=r[1],se=r[2];return t[0]=(1-(O+q))*ne,t[1]=(C+re)*ne,t[2]=(B-$)*ne,t[3]=0,t[4]=(C-re)*ie,t[5]=(1-(E+q))*ie,t[6]=(G+X)*ie,t[7]=0,t[8]=(B+$)*se,t[9]=(G-X)*se,t[10]=(1-(E+O))*se,t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t},Er.fromRotationTranslationScaleOrigin=function(t,e,i,r,n){var s=e[0],a=e[1],c=e[2],p=e[3],_=s+s,v=a+a,E=c+c,C=s*_,B=s*v,O=s*E,G=a*v,q=a*E,X=c*E,$=p*_,re=p*v,ne=p*E,ie=r[0],se=r[1],he=r[2],ve=n[0],be=n[1],De=n[2],Ve=(1-(G+X))*ie,je=(B+ne)*ie,Je=(O-re)*ie,Fe=(B-ne)*se,nt=(1-(C+X))*se,At=(q+$)*se,vt=(O+re)*he,rt=(q-$)*he,lt=(1-(C+G))*he;return t[0]=Ve,t[1]=je,t[2]=Je,t[3]=0,t[4]=Fe,t[5]=nt,t[6]=At,t[7]=0,t[8]=vt,t[9]=rt,t[10]=lt,t[11]=0,t[12]=i[0]+ve-(Ve*ve+Fe*be+vt*De),t[13]=i[1]+be-(je*ve+nt*be+rt*De),t[14]=i[2]+De-(Je*ve+At*be+lt*De),t[15]=1,t},Er.fromQuat=function(t,e){var i=e[0],r=e[1],n=e[2],s=e[3],a=i+i,c=r+r,p=n+n,_=i*a,v=r*a,E=r*c,C=n*a,B=n*c,O=n*p,G=s*a,q=s*c,X=s*p;return t[0]=1-E-O,t[1]=v+X,t[2]=C-q,t[3]=0,t[4]=v-X,t[5]=1-_-O,t[6]=B+G,t[7]=0,t[8]=C+q,t[9]=B-G,t[10]=1-_-E,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Er.frustum=function(t,e,i,r,n,s,a){var c=1/(i-e),p=1/(n-r),_=1/(s-a);return t[0]=2*s*c,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*s*p,t[6]=0,t[7]=0,t[8]=(i+e)*c,t[9]=(n+r)*p,t[10]=(a+s)*_,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*s*2*_,t[15]=0,t},Er.perspectiveNO=Uu,Er.perspectiveZO=function(t,e,i,r,n){var s,a=1/Math.tan(e/2);return t[0]=a/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,n!=null&&n!==1/0?(t[10]=n*(s=1/(r-n)),t[14]=n*r*s):(t[10]=-1,t[14]=-r),t},Er.perspectiveFromFieldOfView=function(t,e,i,r){var n=Math.tan(e.upDegrees*Math.PI/180),s=Math.tan(e.downDegrees*Math.PI/180),a=Math.tan(e.leftDegrees*Math.PI/180),c=Math.tan(e.rightDegrees*Math.PI/180),p=2/(a+c),_=2/(n+s);return t[0]=p,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=_,t[6]=0,t[7]=0,t[8]=-(a-c)*p*.5,t[9]=(n-s)*_*.5,t[10]=r/(i-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*i/(i-r),t[15]=0,t},Er.orthoNO=c0,Er.orthoZO=function(t,e,i,r,n,s,a){var c=1/(e-i),p=1/(r-n),_=1/(s-a);return t[0]=-2*c,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*p,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=_,t[11]=0,t[12]=(e+i)*c,t[13]=(n+r)*p,t[14]=s*_,t[15]=1,t},Er.lookAt=function(t,e,i,r){var n,s,a,c,p,_,v,E,C,B,O=e[0],G=e[1],q=e[2],X=r[0],$=r[1],re=r[2],ne=i[0],ie=i[1],se=i[2];return Math.abs(O-ne)<Us.EPSILON&&Math.abs(G-ie)<Us.EPSILON&&Math.abs(q-se)<Us.EPSILON?Lf(t):(v=O-ne,E=G-ie,C=q-se,n=$*(C*=B=1/Math.hypot(v,E,C))-re*(E*=B),s=re*(v*=B)-X*C,a=X*E-$*v,(B=Math.hypot(n,s,a))?(n*=B=1/B,s*=B,a*=B):(n=0,s=0,a=0),c=E*a-C*s,p=C*n-v*a,_=v*s-E*n,(B=Math.hypot(c,p,_))?(c*=B=1/B,p*=B,_*=B):(c=0,p=0,_=0),t[0]=n,t[1]=c,t[2]=v,t[3]=0,t[4]=s,t[5]=p,t[6]=E,t[7]=0,t[8]=a,t[9]=_,t[10]=C,t[11]=0,t[12]=-(n*O+s*G+a*q),t[13]=-(c*O+p*G+_*q),t[14]=-(v*O+E*G+C*q),t[15]=1,t)},Er.targetTo=function(t,e,i,r){var n=e[0],s=e[1],a=e[2],c=r[0],p=r[1],_=r[2],v=n-i[0],E=s-i[1],C=a-i[2],B=v*v+E*E+C*C;B>0&&(v*=B=1/Math.sqrt(B),E*=B,C*=B);var O=p*C-_*E,G=_*v-c*C,q=c*E-p*v;return(B=O*O+G*G+q*q)>0&&(O*=B=1/Math.sqrt(B),G*=B,q*=B),t[0]=O,t[1]=G,t[2]=q,t[3]=0,t[4]=E*q-C*G,t[5]=C*O-v*q,t[6]=v*G-E*O,t[7]=0,t[8]=v,t[9]=E,t[10]=C,t[11]=0,t[12]=n,t[13]=s,t[14]=a,t[15]=1,t},Er.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},Er.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},Er.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t[9]=e[9]+i[9],t[10]=e[10]+i[10],t[11]=e[11]+i[11],t[12]=e[12]+i[12],t[13]=e[13]+i[13],t[14]=e[14]+i[14],t[15]=e[15]+i[15],t},Er.subtract=u0,Er.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12]*i,t[13]=e[13]*i,t[14]=e[14]*i,t[15]=e[15]*i,t},Er.multiplyScalarAndAdd=function(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t[6]=e[6]+i[6]*r,t[7]=e[7]+i[7]*r,t[8]=e[8]+i[8]*r,t[9]=e[9]+i[9]*r,t[10]=e[10]+i[10]*r,t[11]=e[11]+i[11]*r,t[12]=e[12]+i[12]*r,t[13]=e[13]+i[13]*r,t[14]=e[14]+i[14]*r,t[15]=e[15]+i[15]*r,t},Er.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},Er.equals=function(t,e){var i=t[0],r=t[1],n=t[2],s=t[3],a=t[4],c=t[5],p=t[6],_=t[7],v=t[8],E=t[9],C=t[10],B=t[11],O=t[12],G=t[13],q=t[14],X=t[15],$=e[0],re=e[1],ne=e[2],ie=e[3],se=e[4],he=e[5],ve=e[6],be=e[7],De=e[8],Ve=e[9],je=e[10],Je=e[11],Fe=e[12],nt=e[13],At=e[14],vt=e[15];return Math.abs(i-$)<=Us.EPSILON*Math.max(1,Math.abs(i),Math.abs($))&&Math.abs(r-re)<=Us.EPSILON*Math.max(1,Math.abs(r),Math.abs(re))&&Math.abs(n-ne)<=Us.EPSILON*Math.max(1,Math.abs(n),Math.abs(ne))&&Math.abs(s-ie)<=Us.EPSILON*Math.max(1,Math.abs(s),Math.abs(ie))&&Math.abs(a-se)<=Us.EPSILON*Math.max(1,Math.abs(a),Math.abs(se))&&Math.abs(c-he)<=Us.EPSILON*Math.max(1,Math.abs(c),Math.abs(he))&&Math.abs(p-ve)<=Us.EPSILON*Math.max(1,Math.abs(p),Math.abs(ve))&&Math.abs(_-be)<=Us.EPSILON*Math.max(1,Math.abs(_),Math.abs(be))&&Math.abs(v-De)<=Us.EPSILON*Math.max(1,Math.abs(v),Math.abs(De))&&Math.abs(E-Ve)<=Us.EPSILON*Math.max(1,Math.abs(E),Math.abs(Ve))&&Math.abs(C-je)<=Us.EPSILON*Math.max(1,Math.abs(C),Math.abs(je))&&Math.abs(B-Je)<=Us.EPSILON*Math.max(1,Math.abs(B),Math.abs(Je))&&Math.abs(O-Fe)<=Us.EPSILON*Math.max(1,Math.abs(O),Math.abs(Fe))&&Math.abs(G-nt)<=Us.EPSILON*Math.max(1,Math.abs(G),Math.abs(nt))&&Math.abs(q-At)<=Us.EPSILON*Math.max(1,Math.abs(q),Math.abs(At))&&Math.abs(X-vt)<=Us.EPSILON*Math.max(1,Math.abs(X),Math.abs(vt))},Er.sub=Er.mul=Er.ortho=Er.perspective=void 0;var Us=function(t,e){if(t&&t.__esModule)return t;if(t===null||A0(t)!=="object"&&typeof t!="function")return{default:t};var i=qh(void 0);if(i&&i.has(t))return i.get(t);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in t)if(s!=="default"&&Object.prototype.hasOwnProperty.call(t,s)){var a=n?Object.getOwnPropertyDescriptor(t,s):null;a&&(a.get||a.set)?Object.defineProperty(r,s,a):r[s]=t[s]}return r.default=t,i&&i.set(t,r),r}(So);function qh(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(qh=function(r){return r?i:e})(t)}function Lf(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Zp(t,e,i){var r=e[0],n=e[1],s=e[2],a=e[3],c=e[4],p=e[5],_=e[6],v=e[7],E=e[8],C=e[9],B=e[10],O=e[11],G=e[12],q=e[13],X=e[14],$=e[15],re=i[0],ne=i[1],ie=i[2],se=i[3];return t[0]=re*r+ne*c+ie*E+se*G,t[1]=re*n+ne*p+ie*C+se*q,t[2]=re*s+ne*_+ie*B+se*X,t[3]=re*a+ne*v+ie*O+se*$,t[4]=(re=i[4])*r+(ne=i[5])*c+(ie=i[6])*E+(se=i[7])*G,t[5]=re*n+ne*p+ie*C+se*q,t[6]=re*s+ne*_+ie*B+se*X,t[7]=re*a+ne*v+ie*O+se*$,t[8]=(re=i[8])*r+(ne=i[9])*c+(ie=i[10])*E+(se=i[11])*G,t[9]=re*n+ne*p+ie*C+se*q,t[10]=re*s+ne*_+ie*B+se*X,t[11]=re*a+ne*v+ie*O+se*$,t[12]=(re=i[12])*r+(ne=i[13])*c+(ie=i[14])*E+(se=i[15])*G,t[13]=re*n+ne*p+ie*C+se*q,t[14]=re*s+ne*_+ie*B+se*X,t[15]=re*a+ne*v+ie*O+se*$,t}function Rf(t,e,i){var r=e[0],n=e[1],s=e[2],a=e[3],c=r+r,p=n+n,_=s+s,v=r*c,E=r*p,C=r*_,B=n*p,O=n*_,G=s*_,q=a*c,X=a*p,$=a*_;return t[0]=1-(B+G),t[1]=E+$,t[2]=C-X,t[3]=0,t[4]=E-$,t[5]=1-(v+G),t[6]=O+q,t[7]=0,t[8]=C+X,t[9]=O-q,t[10]=1-(v+B),t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t}function Ff(t,e){var i=e[4],r=e[5],n=e[6],s=e[8],a=e[9],c=e[10];return t[0]=Math.hypot(e[0],e[1],e[2]),t[1]=Math.hypot(i,r,n),t[2]=Math.hypot(s,a,c),t}function Uu(t,e,i,r,n){var s,a=1/Math.tan(e/2);return t[0]=a/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,n!=null&&n!==1/0?(t[10]=(n+r)*(s=1/(r-n)),t[14]=2*n*r*s):(t[10]=-1,t[14]=-2*r),t}function c0(t,e,i,r,n,s,a){var c=1/(e-i),p=1/(r-n),_=1/(s-a);return t[0]=-2*c,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*p,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*_,t[11]=0,t[12]=(e+i)*c,t[13]=(n+r)*p,t[14]=(a+s)*_,t[15]=1,t}function u0(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t[9]=e[9]-i[9],t[10]=e[10]-i[10],t[11]=e[11]-i[11],t[12]=e[12]-i[12],t[13]=e[13]-i[13],t[14]=e[14]-i[14],t[15]=e[15]-i[15],t}Er.perspective=Uu,Er.ortho=c0,Er.mul=Zp,Er.sub=u0;var mr={},Mr={};function oh(t){return oh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},oh(t)}Object.defineProperty(Mr,"__esModule",{value:!0}),Mr.create=Qp,Mr.clone=function(t){var e=new gc.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},Mr.length=h0,Mr.fromValues=function(t,e,i){var r=new gc.ARRAY_TYPE(3);return r[0]=t,r[1]=e,r[2]=i,r},Mr.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},Mr.set=function(t,e,i,r){return t[0]=e,t[1]=i,t[2]=r,t},Mr.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t},Mr.subtract=Hp,Mr.multiply=Wp,Mr.divide=Xp,Mr.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},Mr.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},Mr.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t},Mr.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t},Mr.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},Mr.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t},Mr.scaleAndAdd=function(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t},Mr.distance=Yp,Mr.squaredDistance=Of,Mr.squaredLength=Xc,Mr.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},Mr.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},Mr.normalize=function(t,e){var i=e[0],r=e[1],n=e[2],s=i*i+r*r+n*n;return s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t},Mr.dot=f0,Mr.cross=function(t,e,i){var r=e[0],n=e[1],s=e[2],a=i[0],c=i[1],p=i[2];return t[0]=n*p-s*c,t[1]=s*a-r*p,t[2]=r*c-n*a,t},Mr.lerp=function(t,e,i,r){var n=e[0],s=e[1],a=e[2];return t[0]=n+r*(i[0]-n),t[1]=s+r*(i[1]-s),t[2]=a+r*(i[2]-a),t},Mr.hermite=function(t,e,i,r,n,s){var a=s*s,c=a*(2*s-3)+1,p=a*(s-2)+s,_=a*(s-1),v=a*(3-2*s);return t[0]=e[0]*c+i[0]*p+r[0]*_+n[0]*v,t[1]=e[1]*c+i[1]*p+r[1]*_+n[1]*v,t[2]=e[2]*c+i[2]*p+r[2]*_+n[2]*v,t},Mr.bezier=function(t,e,i,r,n,s){var a=1-s,c=a*a,p=s*s,_=c*a,v=3*s*c,E=3*p*a,C=p*s;return t[0]=e[0]*_+i[0]*v+r[0]*E+n[0]*C,t[1]=e[1]*_+i[1]*v+r[1]*E+n[1]*C,t[2]=e[2]*_+i[2]*v+r[2]*E+n[2]*C,t},Mr.random=function(t,e){e=e||1;var i=2*gc.RANDOM()*Math.PI,r=2*gc.RANDOM()-1,n=Math.sqrt(1-r*r)*e;return t[0]=Math.cos(i)*n,t[1]=Math.sin(i)*n,t[2]=r*e,t},Mr.transformMat4=function(t,e,i){var r=e[0],n=e[1],s=e[2],a=i[3]*r+i[7]*n+i[11]*s+i[15];return t[0]=(i[0]*r+i[4]*n+i[8]*s+i[12])/(a=a||1),t[1]=(i[1]*r+i[5]*n+i[9]*s+i[13])/a,t[2]=(i[2]*r+i[6]*n+i[10]*s+i[14])/a,t},Mr.transformMat3=function(t,e,i){var r=e[0],n=e[1],s=e[2];return t[0]=r*i[0]+n*i[3]+s*i[6],t[1]=r*i[1]+n*i[4]+s*i[7],t[2]=r*i[2]+n*i[5]+s*i[8],t},Mr.transformQuat=function(t,e,i){var r=i[0],n=i[1],s=i[2],a=e[0],c=e[1],p=e[2],_=n*p-s*c,v=s*a-r*p,E=r*c-n*a,C=n*E-s*v,B=s*_-r*E,O=r*v-n*_,G=2*i[3];return v*=G,E*=G,B*=2,O*=2,t[0]=a+(_*=G)+(C*=2),t[1]=c+v+B,t[2]=p+E+O,t},Mr.rotateX=function(t,e,i,r){var n=[],s=[];return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],s[0]=n[0],s[1]=n[1]*Math.cos(r)-n[2]*Math.sin(r),s[2]=n[1]*Math.sin(r)+n[2]*Math.cos(r),t[0]=s[0]+i[0],t[1]=s[1]+i[1],t[2]=s[2]+i[2],t},Mr.rotateY=function(t,e,i,r){var n=[],s=[];return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],s[0]=n[2]*Math.sin(r)+n[0]*Math.cos(r),s[1]=n[1],s[2]=n[2]*Math.cos(r)-n[0]*Math.sin(r),t[0]=s[0]+i[0],t[1]=s[1]+i[1],t[2]=s[2]+i[2],t},Mr.rotateZ=function(t,e,i,r){var n=[],s=[];return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],s[0]=n[0]*Math.cos(r)-n[1]*Math.sin(r),s[1]=n[0]*Math.sin(r)+n[1]*Math.cos(r),s[2]=n[2],t[0]=s[0]+i[0],t[1]=s[1]+i[1],t[2]=s[2]+i[2],t},Mr.angle=function(t,e){var i=t[0],r=t[1],n=t[2],s=e[0],a=e[1],c=e[2],p=Math.sqrt(i*i+r*r+n*n)*Math.sqrt(s*s+a*a+c*c),_=p&&f0(t,e)/p;return Math.acos(Math.min(Math.max(_,-1),1))},Mr.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t},Mr.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},Mr.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},Mr.equals=function(t,e){var i=t[0],r=t[1],n=t[2],s=e[0],a=e[1],c=e[2];return Math.abs(i-s)<=gc.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(r-a)<=gc.EPSILON*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(n-c)<=gc.EPSILON*Math.max(1,Math.abs(n),Math.abs(c))},Mr.forEach=Mr.sqrLen=Mr.len=Mr.sqrDist=Mr.dist=Mr.div=Mr.mul=Mr.sub=void 0;var gc=function(t,e){if(t&&t.__esModule)return t;if(t===null||oh(t)!=="object"&&typeof t!="function")return{default:t};var i=qp(void 0);if(i&&i.has(t))return i.get(t);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in t)if(s!=="default"&&Object.prototype.hasOwnProperty.call(t,s)){var a=n?Object.getOwnPropertyDescriptor(t,s):null;a&&(a.get||a.set)?Object.defineProperty(r,s,a):r[s]=t[s]}return r.default=t,i&&i.set(t,r),r}(So);function qp(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(qp=function(r){return r?i:e})(t)}function Qp(){var t=new gc.ARRAY_TYPE(3);return gc.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function h0(t){return Math.hypot(t[0],t[1],t[2])}function Hp(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function Wp(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t}function Xp(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t}function Yp(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])}function Of(t,e){var i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2];return i*i+r*r+n*n}function Xc(t){var e=t[0],i=t[1],r=t[2];return e*e+i*i+r*r}function f0(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}Mr.sub=Hp,Mr.mul=Wp,Mr.div=Xp,Mr.dist=Yp,Mr.sqrDist=Of,Mr.len=h0,Mr.sqrLen=Xc;var yc,Kp=(yc=Qp(),function(t,e,i,r,n,s){var a,c;for(e||(e=3),i||(i=0),c=r?Math.min(r*e+i,t.length):t.length,a=i;a<c;a+=e)yc[0]=t[a],yc[1]=t[a+1],yc[2]=t[a+2],n(yc,yc,s),t[a]=yc[0],t[a+1]=yc[1],t[a+2]=yc[2];return t});Mr.forEach=Kp;var Rr={};function Nf(t){return Nf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Nf(t)}Object.defineProperty(Rr,"__esModule",{value:!0}),Rr.create=Qh,Rr.clone=function(t){var e=new uA.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Rr.fromValues=function(t,e,i,r){var n=new uA.ARRAY_TYPE(4);return n[0]=t,n[1]=e,n[2]=i,n[3]=r,n},Rr.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Rr.set=function(t,e,i,r,n){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t},Rr.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t},Rr.subtract=d0,Rr.multiply=Vf,Rr.divide=p0,Rr.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},Rr.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},Rr.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t[3]=Math.min(e[3],i[3]),t},Rr.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t[3]=Math.max(e[3],i[3]),t},Rr.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},Rr.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t},Rr.scaleAndAdd=function(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t},Rr.distance=ql,Rr.squaredDistance=ah,Rr.length=m0,Rr.squaredLength=_0,Rr.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},Rr.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},Rr.normalize=function(t,e){var i=e[0],r=e[1],n=e[2],s=e[3],a=i*i+r*r+n*n+s*s;return a>0&&(a=1/Math.sqrt(a)),t[0]=i*a,t[1]=r*a,t[2]=n*a,t[3]=s*a,t},Rr.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},Rr.cross=function(t,e,i,r){var n=i[0]*r[1]-i[1]*r[0],s=i[0]*r[2]-i[2]*r[0],a=i[0]*r[3]-i[3]*r[0],c=i[1]*r[2]-i[2]*r[1],p=i[1]*r[3]-i[3]*r[1],_=i[2]*r[3]-i[3]*r[2],v=e[0],E=e[1],C=e[2],B=e[3];return t[0]=E*_-C*p+B*c,t[1]=-v*_+C*a-B*s,t[2]=v*p-E*a+B*n,t[3]=-v*c+E*s-C*n,t},Rr.lerp=function(t,e,i,r){var n=e[0],s=e[1],a=e[2],c=e[3];return t[0]=n+r*(i[0]-n),t[1]=s+r*(i[1]-s),t[2]=a+r*(i[2]-a),t[3]=c+r*(i[3]-c),t},Rr.random=function(t,e){var i,r,n,s,a,c;e=e||1;do a=(i=2*uA.RANDOM()-1)*i+(r=2*uA.RANDOM()-1)*r;while(a>=1);do c=(n=2*uA.RANDOM()-1)*n+(s=2*uA.RANDOM()-1)*s;while(c>=1);var p=Math.sqrt((1-a)/c);return t[0]=e*i,t[1]=e*r,t[2]=e*n*p,t[3]=e*s*p,t},Rr.transformMat4=function(t,e,i){var r=e[0],n=e[1],s=e[2],a=e[3];return t[0]=i[0]*r+i[4]*n+i[8]*s+i[12]*a,t[1]=i[1]*r+i[5]*n+i[9]*s+i[13]*a,t[2]=i[2]*r+i[6]*n+i[10]*s+i[14]*a,t[3]=i[3]*r+i[7]*n+i[11]*s+i[15]*a,t},Rr.transformQuat=function(t,e,i){var r=e[0],n=e[1],s=e[2],a=i[0],c=i[1],p=i[2],_=i[3],v=_*r+c*s-p*n,E=_*n+p*r-a*s,C=_*s+a*n-c*r,B=-a*r-c*n-p*s;return t[0]=v*_+B*-a+E*-p-C*-c,t[1]=E*_+B*-c+C*-a-v*-p,t[2]=C*_+B*-p+v*-c-E*-a,t[3]=e[3],t},Rr.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},Rr.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Rr.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},Rr.equals=function(t,e){var i=t[0],r=t[1],n=t[2],s=t[3],a=e[0],c=e[1],p=e[2],_=e[3];return Math.abs(i-a)<=uA.EPSILON*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(r-c)<=uA.EPSILON*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(n-p)<=uA.EPSILON*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(s-_)<=uA.EPSILON*Math.max(1,Math.abs(s),Math.abs(_))},Rr.forEach=Rr.sqrLen=Rr.len=Rr.sqrDist=Rr.dist=Rr.div=Rr.mul=Rr.sub=void 0;var uA=function(t,e){if(t&&t.__esModule)return t;if(t===null||Nf(t)!=="object"&&typeof t!="function")return{default:t};var i=Uf(void 0);if(i&&i.has(t))return i.get(t);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in t)if(s!=="default"&&Object.prototype.hasOwnProperty.call(t,s)){var a=n?Object.getOwnPropertyDescriptor(t,s):null;a&&(a.get||a.set)?Object.defineProperty(r,s,a):r[s]=t[s]}return r.default=t,i&&i.set(t,r),r}(So);function Uf(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(Uf=function(r){return r?i:e})(t)}function Qh(){var t=new uA.ARRAY_TYPE(4);return uA.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function d0(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}function Vf(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t[3]=e[3]*i[3],t}function p0(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t[3]=e[3]/i[3],t}function ql(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3])}function ah(t,e){var i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2],s=e[3]-t[3];return i*i+r*r+n*n+s*s}function m0(t){return Math.hypot(t[0],t[1],t[2],t[3])}function _0(t){var e=t[0],i=t[1],r=t[2],n=t[3];return e*e+i*i+r*r+n*n}Rr.sub=d0,Rr.mul=Vf,Rr.div=p0,Rr.dist=ql,Rr.sqrDist=ah,Rr.len=m0,Rr.sqrLen=_0;var Jp=function(){var t=Qh();return function(e,i,r,n,s,a){var c,p;for(i||(i=4),r||(r=0),p=n?Math.min(n*i+r,e.length):e.length,c=r;c<p;c+=i)t[0]=e[c],t[1]=e[c+1],t[2]=e[c+2],t[3]=e[c+3],s(t,t,a),e[c]=t[0],e[c+1]=t[1],e[c+2]=t[2],e[c+3]=t[3];return e}}();function jf(t){return jf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},jf(t)}Rr.forEach=Jp,Object.defineProperty(mr,"__esModule",{value:!0}),mr.create=Gf,mr.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},mr.setAxisAngle=g0,mr.getAxisAngle=function(t,e){var i=2*Math.acos(e[3]),r=Math.sin(i/2);return r>_u.EPSILON?(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r):(t[0]=1,t[1]=0,t[2]=0),i},mr.getAngle=function(t,e){var i=Xh(t,e);return Math.acos(2*i*i-1)},mr.multiply=y0,mr.rotateX=function(t,e,i){i*=.5;var r=e[0],n=e[1],s=e[2],a=e[3],c=Math.sin(i),p=Math.cos(i);return t[0]=r*p+a*c,t[1]=n*p+s*c,t[2]=s*p-n*c,t[3]=a*p-r*c,t},mr.rotateY=function(t,e,i){i*=.5;var r=e[0],n=e[1],s=e[2],a=e[3],c=Math.sin(i),p=Math.cos(i);return t[0]=r*p-s*c,t[1]=n*p+a*c,t[2]=s*p+r*c,t[3]=a*p-n*c,t},mr.rotateZ=function(t,e,i){i*=.5;var r=e[0],n=e[1],s=e[2],a=e[3],c=Math.sin(i),p=Math.cos(i);return t[0]=r*p+n*c,t[1]=n*p-r*c,t[2]=s*p+a*c,t[3]=a*p-s*c,t},mr.calculateW=function(t,e){var i=e[0],r=e[1],n=e[2];return t[0]=i,t[1]=r,t[2]=n,t[3]=Math.sqrt(Math.abs(1-i*i-r*r-n*n)),t},mr.exp=em,mr.ln=tm,mr.pow=function(t,e,i){return tm(t,e),x0(t,t,i),em(t,t),t},mr.slerp=Wh,mr.random=function(t){var e=_u.RANDOM(),i=_u.RANDOM(),r=_u.RANDOM(),n=Math.sqrt(1-e),s=Math.sqrt(e);return t[0]=n*Math.sin(2*Math.PI*i),t[1]=n*Math.cos(2*Math.PI*i),t[2]=s*Math.sin(2*Math.PI*r),t[3]=s*Math.cos(2*Math.PI*r),t},mr.invert=function(t,e){var i=e[0],r=e[1],n=e[2],s=e[3],a=i*i+r*r+n*n+s*s,c=a?1/a:0;return t[0]=-i*c,t[1]=-r*c,t[2]=-n*c,t[3]=s*c,t},mr.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},mr.fromMat3=Vu,mr.fromEuler=function(t,e,i,r){var n=.5*Math.PI/180;e*=n,i*=n,r*=n;var s=Math.sin(e),a=Math.cos(e),c=Math.sin(i),p=Math.cos(i),_=Math.sin(r),v=Math.cos(r);return t[0]=s*p*v-a*c*_,t[1]=a*c*v+s*p*_,t[2]=a*p*_-s*c*v,t[3]=a*p*v+s*c*_,t},mr.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},mr.setAxes=mr.sqlerp=mr.rotationTo=mr.equals=mr.exactEquals=mr.normalize=mr.sqrLen=mr.squaredLength=mr.len=mr.length=mr.lerp=mr.dot=mr.scale=mr.mul=mr.add=mr.set=mr.copy=mr.fromValues=mr.clone=void 0;var _u=Hh(So),$p=Hh(Fn),Yc=Hh(Mr),Ql=Hh(Rr);function Kc(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(Kc=function(r){return r?i:e})(t)}function Hh(t,e){if(!e&&t&&t.__esModule)return t;if(t===null||jf(t)!=="object"&&typeof t!="function")return{default:t};var i=Kc(e);if(i&&i.has(t))return i.get(t);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in t)if(s!=="default"&&Object.prototype.hasOwnProperty.call(t,s)){var a=n?Object.getOwnPropertyDescriptor(t,s):null;a&&(a.get||a.set)?Object.defineProperty(r,s,a):r[s]=t[s]}return r.default=t,i&&i.set(t,r),r}function Gf(){var t=new _u.ARRAY_TYPE(4);return _u.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function g0(t,e,i){i*=.5;var r=Math.sin(i);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(i),t}function y0(t,e,i){var r=e[0],n=e[1],s=e[2],a=e[3],c=i[0],p=i[1],_=i[2],v=i[3];return t[0]=r*v+a*c+n*_-s*p,t[1]=n*v+a*p+s*c-r*_,t[2]=s*v+a*_+r*p-n*c,t[3]=a*v-r*c-n*p-s*_,t}function em(t,e){var i=e[0],r=e[1],n=e[2],s=e[3],a=Math.sqrt(i*i+r*r+n*n),c=Math.exp(s),p=a>0?c*Math.sin(a)/a:0;return t[0]=i*p,t[1]=r*p,t[2]=n*p,t[3]=c*Math.cos(a),t}function tm(t,e){var i=e[0],r=e[1],n=e[2],s=e[3],a=Math.sqrt(i*i+r*r+n*n),c=a>0?Math.atan2(a,s)/a:0;return t[0]=i*c,t[1]=r*c,t[2]=n*c,t[3]=.5*Math.log(i*i+r*r+n*n+s*s),t}function Wh(t,e,i,r){var n,s,a,c,p,_=e[0],v=e[1],E=e[2],C=e[3],B=i[0],O=i[1],G=i[2],q=i[3];return(s=_*B+v*O+E*G+C*q)<0&&(s=-s,B=-B,O=-O,G=-G,q=-q),1-s>_u.EPSILON?(n=Math.acos(s),a=Math.sin(n),c=Math.sin((1-r)*n)/a,p=Math.sin(r*n)/a):(c=1-r,p=r),t[0]=c*_+p*B,t[1]=c*v+p*O,t[2]=c*E+p*G,t[3]=c*C+p*q,t}function Vu(t,e){var i,r=e[0]+e[4]+e[8];if(r>0)i=Math.sqrt(r+1),t[3]=.5*i,t[0]=(e[5]-e[7])*(i=.5/i),t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{var n=0;e[4]>e[0]&&(n=1),e[8]>e[3*n+n]&&(n=2);var s=(n+1)%3,a=(n+2)%3;i=Math.sqrt(e[3*n+n]-e[3*s+s]-e[3*a+a]+1),t[n]=.5*i,t[3]=(e[3*s+a]-e[3*a+s])*(i=.5/i),t[s]=(e[3*s+n]+e[3*n+s])*i,t[a]=(e[3*a+n]+e[3*n+a])*i}return t}mr.clone=Ql.clone,mr.fromValues=Ql.fromValues,mr.copy=Ql.copy,mr.set=Ql.set,mr.add=Ql.add,mr.mul=y0;var x0=Ql.scale;mr.scale=x0;var Xh=Ql.dot;mr.dot=Xh,mr.lerp=Ql.lerp;var v0=Ql.length;mr.length=v0,mr.len=v0;var Yh=Ql.squaredLength;mr.squaredLength=Yh,mr.sqrLen=Yh;var lh=Ql.normalize;mr.normalize=lh,mr.exactEquals=Ql.exactEquals,mr.equals=Ql.equals;var Hl,im,rm,ng=(Hl=Yc.create(),im=Yc.fromValues(1,0,0),rm=Yc.fromValues(0,1,0),function(t,e,i){var r=Yc.dot(e,i);return r<-.999999?(Yc.cross(Hl,im,e),Yc.len(Hl)<1e-6&&Yc.cross(Hl,rm,e),Yc.normalize(Hl,Hl),g0(t,Hl,Math.PI),t):r>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(Yc.cross(Hl,e,i),t[0]=Hl[0],t[1]=Hl[1],t[2]=Hl[2],t[3]=1+r,lh(t,t))});mr.rotationTo=ng;var b0,gu,za=(b0=Gf(),gu=Gf(),function(t,e,i,r,n,s){return Wh(b0,e,n,s),Wh(gu,i,r,s),Wh(t,b0,gu,2*s*(1-s)),t});mr.sqlerp=za;var Ba,w0=(Ba=$p.create(),function(t,e,i,r){return Ba[0]=i[0],Ba[3]=i[1],Ba[6]=i[2],Ba[1]=r[0],Ba[4]=r[1],Ba[7]=r[2],Ba[2]=-e[0],Ba[5]=-e[1],Ba[8]=-e[2],lh(t,Vu(t,Ba))});mr.setAxes=w0;var Gr={};function Zf(t){return Zf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Zf(t)}Object.defineProperty(Gr,"__esModule",{value:!0}),Gr.create=function(){var t=new Ja.ARRAY_TYPE(8);return Ja.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t},Gr.clone=function(t){var e=new Ja.ARRAY_TYPE(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e},Gr.fromValues=function(t,e,i,r,n,s,a,c){var p=new Ja.ARRAY_TYPE(8);return p[0]=t,p[1]=e,p[2]=i,p[3]=r,p[4]=n,p[5]=s,p[6]=a,p[7]=c,p},Gr.fromRotationTranslationValues=function(t,e,i,r,n,s,a){var c=new Ja.ARRAY_TYPE(8);c[0]=t,c[1]=e,c[2]=i,c[3]=r;var p=.5*n,_=.5*s,v=.5*a;return c[4]=p*r+_*i-v*e,c[5]=_*r+v*t-p*i,c[6]=v*r+p*e-_*t,c[7]=-p*t-_*e-v*i,c},Gr.fromRotationTranslation=S0,Gr.fromTranslation=function(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t},Gr.fromRotation=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},Gr.fromMat4=function(t,e){var i=Jc.create();T0.getRotation(i,e);var r=new Ja.ARRAY_TYPE(3);return T0.getTranslation(r,e),S0(t,i,r),t},Gr.copy=qf,Gr.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},Gr.set=function(t,e,i,r,n,s,a,c,p){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t[4]=s,t[5]=a,t[6]=c,t[7]=p,t},Gr.getDual=function(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t},Gr.setDual=function(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t},Gr.getTranslation=function(t,e){var i=e[4],r=e[5],n=e[6],s=e[7],a=-e[0],c=-e[1],p=-e[2],_=e[3];return t[0]=2*(i*_+s*a+r*p-n*c),t[1]=2*(r*_+s*c+n*a-i*p),t[2]=2*(n*_+s*p+i*c-r*a),t},Gr.translate=function(t,e,i){var r=e[0],n=e[1],s=e[2],a=e[3],c=.5*i[0],p=.5*i[1],_=.5*i[2],v=e[4],E=e[5],C=e[6],B=e[7];return t[0]=r,t[1]=n,t[2]=s,t[3]=a,t[4]=a*c+n*_-s*p+v,t[5]=a*p+s*c-r*_+E,t[6]=a*_+r*p-n*c+C,t[7]=-r*c-n*p-s*_+B,t},Gr.rotateX=function(t,e,i){var r=-e[0],n=-e[1],s=-e[2],a=e[3],c=e[4],p=e[5],_=e[6],v=e[7],E=c*a+v*r+p*s-_*n,C=p*a+v*n+_*r-c*s,B=_*a+v*s+c*n-p*r,O=v*a-c*r-p*n-_*s;return Jc.rotateX(t,e,i),t[4]=E*(a=t[3])+O*(r=t[0])+C*(s=t[2])-B*(n=t[1]),t[5]=C*a+O*n+B*r-E*s,t[6]=B*a+O*s+E*n-C*r,t[7]=O*a-E*r-C*n-B*s,t},Gr.rotateY=function(t,e,i){var r=-e[0],n=-e[1],s=-e[2],a=e[3],c=e[4],p=e[5],_=e[6],v=e[7],E=c*a+v*r+p*s-_*n,C=p*a+v*n+_*r-c*s,B=_*a+v*s+c*n-p*r,O=v*a-c*r-p*n-_*s;return Jc.rotateY(t,e,i),t[4]=E*(a=t[3])+O*(r=t[0])+C*(s=t[2])-B*(n=t[1]),t[5]=C*a+O*n+B*r-E*s,t[6]=B*a+O*s+E*n-C*r,t[7]=O*a-E*r-C*n-B*s,t},Gr.rotateZ=function(t,e,i){var r=-e[0],n=-e[1],s=-e[2],a=e[3],c=e[4],p=e[5],_=e[6],v=e[7],E=c*a+v*r+p*s-_*n,C=p*a+v*n+_*r-c*s,B=_*a+v*s+c*n-p*r,O=v*a-c*r-p*n-_*s;return Jc.rotateZ(t,e,i),t[4]=E*(a=t[3])+O*(r=t[0])+C*(s=t[2])-B*(n=t[1]),t[5]=C*a+O*n+B*r-E*s,t[6]=B*a+O*s+E*n-C*r,t[7]=O*a-E*r-C*n-B*s,t},Gr.rotateByQuatAppend=function(t,e,i){var r=i[0],n=i[1],s=i[2],a=i[3],c=e[0],p=e[1],_=e[2],v=e[3];return t[0]=c*a+v*r+p*s-_*n,t[1]=p*a+v*n+_*r-c*s,t[2]=_*a+v*s+c*n-p*r,t[3]=v*a-c*r-p*n-_*s,t[4]=(c=e[4])*a+(v=e[7])*r+(p=e[5])*s-(_=e[6])*n,t[5]=p*a+v*n+_*r-c*s,t[6]=_*a+v*s+c*n-p*r,t[7]=v*a-c*r-p*n-_*s,t},Gr.rotateByQuatPrepend=function(t,e,i){var r=e[0],n=e[1],s=e[2],a=e[3],c=i[0],p=i[1],_=i[2],v=i[3];return t[0]=r*v+a*c+n*_-s*p,t[1]=n*v+a*p+s*c-r*_,t[2]=s*v+a*_+r*p-n*c,t[3]=a*v-r*c-n*p-s*_,t[4]=r*(v=i[7])+a*(c=i[4])+n*(_=i[6])-s*(p=i[5]),t[5]=n*v+a*p+s*c-r*_,t[6]=s*v+a*_+r*p-n*c,t[7]=a*v-r*c-n*p-s*_,t},Gr.rotateAroundAxis=function(t,e,i,r){if(Math.abs(r)<Ja.EPSILON)return qf(t,e);var n=Math.hypot(i[0],i[1],i[2]);r*=.5;var s=Math.sin(r),a=s*i[0]/n,c=s*i[1]/n,p=s*i[2]/n,_=Math.cos(r),v=e[0],E=e[1],C=e[2],B=e[3];t[0]=v*_+B*a+E*p-C*c,t[1]=E*_+B*c+C*a-v*p,t[2]=C*_+B*p+v*c-E*a,t[3]=B*_-v*a-E*c-C*p;var O=e[4],G=e[5],q=e[6],X=e[7];return t[4]=O*_+X*a+G*p-q*c,t[5]=G*_+X*c+q*a-O*p,t[6]=q*_+X*p+O*c-G*a,t[7]=X*_-O*a-G*c-q*p,t},Gr.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t},Gr.multiply=Qf,Gr.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t},Gr.lerp=function(t,e,i,r){var n=1-r;return I0(e,i)<0&&(r=-r),t[0]=e[0]*n+i[0]*r,t[1]=e[1]*n+i[1]*r,t[2]=e[2]*n+i[2]*r,t[3]=e[3]*n+i[3]*r,t[4]=e[4]*n+i[4]*r,t[5]=e[5]*n+i[5]*r,t[6]=e[6]*n+i[6]*r,t[7]=e[7]*n+i[7]*r,t},Gr.invert=function(t,e){var i=ch(e);return t[0]=-e[0]/i,t[1]=-e[1]/i,t[2]=-e[2]/i,t[3]=e[3]/i,t[4]=-e[4]/i,t[5]=-e[5]/i,t[6]=-e[6]/i,t[7]=e[7]/i,t},Gr.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t},Gr.normalize=function(t,e){var i=ch(e);if(i>0){i=Math.sqrt(i);var r=e[0]/i,n=e[1]/i,s=e[2]/i,a=e[3]/i,c=e[4],p=e[5],_=e[6],v=e[7],E=r*c+n*p+s*_+a*v;t[0]=r,t[1]=n,t[2]=s,t[3]=a,t[4]=(c-r*E)/i,t[5]=(p-n*E)/i,t[6]=(_-s*E)/i,t[7]=(v-a*E)/i}return t},Gr.str=function(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"},Gr.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]},Gr.equals=function(t,e){var i=t[0],r=t[1],n=t[2],s=t[3],a=t[4],c=t[5],p=t[6],_=t[7],v=e[0],E=e[1],C=e[2],B=e[3],O=e[4],G=e[5],q=e[6],X=e[7];return Math.abs(i-v)<=Ja.EPSILON*Math.max(1,Math.abs(i),Math.abs(v))&&Math.abs(r-E)<=Ja.EPSILON*Math.max(1,Math.abs(r),Math.abs(E))&&Math.abs(n-C)<=Ja.EPSILON*Math.max(1,Math.abs(n),Math.abs(C))&&Math.abs(s-B)<=Ja.EPSILON*Math.max(1,Math.abs(s),Math.abs(B))&&Math.abs(a-O)<=Ja.EPSILON*Math.max(1,Math.abs(a),Math.abs(O))&&Math.abs(c-G)<=Ja.EPSILON*Math.max(1,Math.abs(c),Math.abs(G))&&Math.abs(p-q)<=Ja.EPSILON*Math.max(1,Math.abs(p),Math.abs(q))&&Math.abs(_-X)<=Ja.EPSILON*Math.max(1,Math.abs(_),Math.abs(X))},Gr.sqrLen=Gr.squaredLength=Gr.len=Gr.length=Gr.dot=Gr.mul=Gr.setReal=Gr.getReal=void 0;var Ja=M0(So),Jc=M0(mr),T0=M0(Er);function E0(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(E0=function(r){return r?i:e})(t)}function M0(t,e){if(!e&&t&&t.__esModule)return t;if(t===null||Zf(t)!=="object"&&typeof t!="function")return{default:t};var i=E0(e);if(i&&i.has(t))return i.get(t);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in t)if(s!=="default"&&Object.prototype.hasOwnProperty.call(t,s)){var a=n?Object.getOwnPropertyDescriptor(t,s):null;a&&(a.get||a.set)?Object.defineProperty(r,s,a):r[s]=t[s]}return r.default=t,i&&i.set(t,r),r}function S0(t,e,i){var r=.5*i[0],n=.5*i[1],s=.5*i[2],a=e[0],c=e[1],p=e[2],_=e[3];return t[0]=a,t[1]=c,t[2]=p,t[3]=_,t[4]=r*_+n*p-s*c,t[5]=n*_+s*a-r*p,t[6]=s*_+r*c-n*a,t[7]=-r*a-n*c-s*p,t}function qf(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function Qf(t,e,i){var r=e[0],n=e[1],s=e[2],a=e[3],c=i[4],p=i[5],_=i[6],v=i[7],E=e[4],C=e[5],B=e[6],O=e[7],G=i[0],q=i[1],X=i[2],$=i[3];return t[0]=r*$+a*G+n*X-s*q,t[1]=n*$+a*q+s*G-r*X,t[2]=s*$+a*X+r*q-n*G,t[3]=a*$-r*G-n*q-s*X,t[4]=r*v+a*c+n*_-s*p+E*$+O*G+C*X-B*q,t[5]=n*v+a*p+s*c-r*_+C*$+O*q+B*G-E*X,t[6]=s*v+a*_+r*p-n*c+B*$+O*X+E*q-C*G,t[7]=a*v-r*c-n*p-s*_+O*$-E*G-C*q-B*X,t}Gr.getReal=Jc.copy,Gr.setReal=Jc.copy,Gr.mul=Qf;var I0=Jc.dot;Gr.dot=I0;var Ah=Jc.length;Gr.length=Ah,Gr.len=Ah;var ch=Jc.squaredLength;Gr.squaredLength=ch,Gr.sqrLen=ch;var Cr={};function Kh(t){return Kh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Kh(t)}Object.defineProperty(Cr,"__esModule",{value:!0}),Cr.create=Hf,Cr.clone=function(t){var e=new xc.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},Cr.fromValues=function(t,e){var i=new xc.ARRAY_TYPE(2);return i[0]=t,i[1]=e,i},Cr.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},Cr.set=function(t,e,i){return t[0]=e,t[1]=i,t},Cr.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t},Cr.subtract=Wf,Cr.multiply=Xf,Cr.divide=nm,Cr.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},Cr.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},Cr.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t},Cr.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t},Cr.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},Cr.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t},Cr.scaleAndAdd=function(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t},Cr.distance=f,Cr.squaredDistance=A,Cr.length=m,Cr.squaredLength=w,Cr.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},Cr.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},Cr.normalize=function(t,e){var i=e[0],r=e[1],n=i*i+r*r;return n>0&&(n=1/Math.sqrt(n)),t[0]=e[0]*n,t[1]=e[1]*n,t},Cr.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},Cr.cross=function(t,e,i){var r=e[0]*i[1]-e[1]*i[0];return t[0]=t[1]=0,t[2]=r,t},Cr.lerp=function(t,e,i,r){var n=e[0],s=e[1];return t[0]=n+r*(i[0]-n),t[1]=s+r*(i[1]-s),t},Cr.random=function(t,e){e=e||1;var i=2*xc.RANDOM()*Math.PI;return t[0]=Math.cos(i)*e,t[1]=Math.sin(i)*e,t},Cr.transformMat2=function(t,e,i){var r=e[0],n=e[1];return t[0]=i[0]*r+i[2]*n,t[1]=i[1]*r+i[3]*n,t},Cr.transformMat2d=function(t,e,i){var r=e[0],n=e[1];return t[0]=i[0]*r+i[2]*n+i[4],t[1]=i[1]*r+i[3]*n+i[5],t},Cr.transformMat3=function(t,e,i){var r=e[0],n=e[1];return t[0]=i[0]*r+i[3]*n+i[6],t[1]=i[1]*r+i[4]*n+i[7],t},Cr.transformMat4=function(t,e,i){var r=e[0],n=e[1];return t[0]=i[0]*r+i[4]*n+i[12],t[1]=i[1]*r+i[5]*n+i[13],t},Cr.rotate=function(t,e,i,r){var n=e[0]-i[0],s=e[1]-i[1],a=Math.sin(r),c=Math.cos(r);return t[0]=n*c-s*a+i[0],t[1]=n*a+s*c+i[1],t},Cr.angle=function(t,e){var i=t[0],r=t[1],n=e[0],s=e[1],a=Math.sqrt(i*i+r*r)*Math.sqrt(n*n+s*s);return Math.acos(Math.min(Math.max(a&&(i*n+r*s)/a,-1),1))},Cr.zero=function(t){return t[0]=0,t[1]=0,t},Cr.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},Cr.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},Cr.equals=function(t,e){var i=t[0],r=t[1],n=e[0],s=e[1];return Math.abs(i-n)<=xc.EPSILON*Math.max(1,Math.abs(i),Math.abs(n))&&Math.abs(r-s)<=xc.EPSILON*Math.max(1,Math.abs(r),Math.abs(s))},Cr.forEach=Cr.sqrLen=Cr.sqrDist=Cr.dist=Cr.div=Cr.mul=Cr.sub=Cr.len=void 0;var xc=function(t,e){if(t&&t.__esModule)return t;if(t===null||Kh(t)!=="object"&&typeof t!="function")return{default:t};var i=uh(void 0);if(i&&i.has(t))return i.get(t);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in t)if(s!=="default"&&Object.prototype.hasOwnProperty.call(t,s)){var a=n?Object.getOwnPropertyDescriptor(t,s):null;a&&(a.get||a.set)?Object.defineProperty(r,s,a):r[s]=t[s]}return r.default=t,i&&i.set(t,r),r}(So);function uh(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(uh=function(r){return r?i:e})(t)}function Hf(){var t=new xc.ARRAY_TYPE(2);return xc.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0),t}function Wf(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t}function Xf(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t}function nm(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t}function f(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1])}function A(t,e){var i=e[0]-t[0],r=e[1]-t[1];return i*i+r*r}function m(t){return Math.hypot(t[0],t[1])}function w(t){var e=t[0],i=t[1];return e*e+i*i}Cr.len=m,Cr.sub=Wf,Cr.mul=Xf,Cr.div=nm,Cr.dist=f,Cr.sqrDist=A,Cr.sqrLen=w;var D=function(){var t=Hf();return function(e,i,r,n,s,a){var c,p;for(i||(i=2),r||(r=0),p=n?Math.min(n*i+r,e.length):e.length,c=r;c<p;c+=i)t[0]=e[c],t[1]=e[c+1],s(t,t,a),e[c]=t[0],e[c+1]=t[1];return e}}();function U(t){return U=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},U(t)}Cr.forEach=D,Object.defineProperty(Wn,"__esModule",{value:!0});var V=Wn.vec4=me=Wn.vec3=Wn.vec2=Wn.quat2=at=Wn.quat=ce=Wn.mat4=Se=Wn.mat3=Wn.mat2d=ae=Wn.mat2=Wn.glMatrix=void 0,Y=Si(So);Wn.glMatrix=Y;var ee=Si(Xn),ae=Wn.mat2=ee,fe=Si(ws);Wn.mat2d=fe;var _e=Si(Fn),Se=Wn.mat3=_e,Oe=Si(Er),ce=Wn.mat4=Oe,tt=Si(mr),at=Wn.quat=tt,pt=Si(Gr);Wn.quat2=pt;var Ct=Si(Cr);Wn.vec2=Ct;var bt=Si(Mr),me=Wn.vec3=bt,Vt=Si(Rr);function oi(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(oi=function(r){return r?i:e})(t)}function Si(t,e){if(!e&&t&&t.__esModule)return t;if(t===null||U(t)!=="object"&&typeof t!="function")return{default:t};var i=oi(e);if(i&&i.has(t))return i.get(t);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in t)if(s!=="default"&&Object.prototype.hasOwnProperty.call(t,s)){var a=n?Object.getOwnPropertyDescriptor(t,s):null;a&&(a.get||a.set)?Object.defineProperty(r,s,a):r[s]=t[s]}return r.default=t,i&&i.set(t,r),r}V=Wn.vec4=Vt;const tr=an([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Bi}=tr,ki=an([{name:"a_pos_3",components:3,type:"Int16"}]);var xi=an([{name:"a_pos",type:"Int16",components:2}]),Qi={};(function(t,e){(function(i){function r(s,a,c){var p=n(256*s,256*(a=Math.pow(2,c)-a-1),c),_=n(256*(s+1),256*(a+1),c);return p[0]+","+p[1]+","+_[0]+","+_[1]}function n(s,a,c){var p=2*Math.PI*6378137/256/Math.pow(2,c);return[s*p-2*Math.PI*6378137/2,a*p-2*Math.PI*6378137/2]}i.getURL=function(s,a,c,p,_,v){return v=v||{},s+"?"+["bbox="+r(c,p,_),"format="+(v.format||"image/png"),"service="+(v.service||"WMS"),"version="+(v.version||"1.1.1"),"request="+(v.request||"GetMap"),"srs="+(v.srs||"EPSG:3857"),"width="+(v.width||256),"height="+(v.height||256),"layers="+a].join("&")},i.getTileBBox=r,i.getMercCoords=n,Object.defineProperty(i,"__esModule",{value:!0})})(e)})(0,Qi);var Ii=Qi;class ci{constructor(e,i,r){this.z=e,this.x=i,this.y=r,this.key=Qr(0,e,e,i,r)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i){const r=Ii.getTileBBox(this.x,this.y,this.z),n=function(s,a,c){let p,_="";for(let v=s;v>0;v--)p=1<<v-1,_+=(a&p?1:0)+(c&p?2:0);return _}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",n).replace("{bbox-epsg-3857}",r)}toString(){return`${this.z}/${this.x}/${this.y}`}}class ur{constructor(e,i){this.wrap=e,this.canonical=i,this.key=Qr(e,i.z,i.z,i.x,i.y)}}class ui{constructor(e,i,r,n,s){this.overscaledZ=e,this.wrap=i,this.canonical=new ci(r,+n,+s),this.key=i===0&&e===r?this.canonical.key:Qr(i,e,r,n,s)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new ui(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ui(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return Qr(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const r=this.canonical.z-e;return Qr(this.wrap*+i,e,e,this.canonical.x>>r,this.canonical.y>>r)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new ui(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,r=2*this.canonical.x,n=2*this.canonical.y;return[new ui(i,this.wrap,i,r,n),new ui(i,this.wrap,i,r+1,n),new ui(i,this.wrap,i,r,n+1),new ui(i,this.wrap,i,r+1,n+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new ui(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new ui(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new ur(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Qr(t,e,i,r,n){const s=1<<Math.min(i,22);let a=s*(n%s)+r%s;return t&&i<22&&(a+=s*s*((t<0?-2*t-1:2*t)%(1<<2*(22-i)))),16*(32*a+i)+(e-i)}const Ts=[t=>{let e=t.canonical.x-1,i=t.wrap;return e<0&&(e=(1<<t.canonical.z)-1,i--),new ui(t.overscaledZ,i,t.canonical.z,e,t.canonical.y)},t=>{let e=t.canonical.x+1,i=t.wrap;return e===1<<t.canonical.z&&(e=0,i++),new ui(t.overscaledZ,i,t.canonical.z,e,t.canonical.y)},t=>new ui(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,(t.canonical.y===0?1<<t.canonical.z:t.canonical.y)-1),t=>new ui(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y===(1<<t.canonical.z)-1?0:t.canonical.y+1)];Mi(ci,"CanonicalTileID"),Mi(ui,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});class ys{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,r){const n=me.dot(i,this.dir);if(Math.abs(n)<1e-6)return!1;const s=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/n;return r[0]=this.pos[0]+this.dir[0]*s,r[1]=this.pos[1]+this.dir[1]*s,r[2]=this.pos[2]+this.dir[2]*s,!0}closestPointOnSphere(e,i,r){if(me.equals(this.pos,e)||i===0)return r[0]=r[1]=r[2]=0,!1;const[n,s,a]=this.dir,c=this.pos[0]-e[0],p=this.pos[1]-e[1],_=this.pos[2]-e[2],v=n*n+s*s+a*a,E=2*(c*n+p*s+_*a),C=E*E-4*v*(c*c+p*p+_*_-i*i);if(C<0){const B=Math.max(-E/2,0),O=c+n*B,G=p+s*B,q=_+a*B,X=Math.hypot(O,G,q);return r[0]=O*i/X,r[1]=G*i/X,r[2]=q*i/X,!1}{const B=(-E-Math.sqrt(C))/(2*v);if(B<0){const O=Math.hypot(c,p,_);return r[0]=c*i/O,r[1]=p*i/O,r[2]=_*i/O,!1}return r[0]=c+n*B,r[1]=p+s*B,r[2]=_+a*B,!0}}}class Io{constructor(e,i,r,n,s){this.TL=e,this.TR=i,this.BR=r,this.BL=n,this.horizon=s}static fromInvProjectionMatrix(e,i,r){const n=[-1,1,1],s=[1,1,1],a=[1,-1,1],c=[-1,-1,1],p=me.transformMat4(n,n,e),_=me.transformMat4(s,s,e),v=me.transformMat4(a,a,e),E=me.transformMat4(c,c,e);return new Io(p,_,v,E,i/r)}}function La(t,e,i){let r=1/0,n=-1/0;const s=[];for(const a of t){me.sub(s,a,e);const c=me.dot(s,i);r=Math.min(r,c),n=Math.max(n,c)}return[r,n]}function $a(t,e){let i=!0;for(let r=0;r<t.planes.length;r++){const n=t.planes[r];let s=0;for(let a=0;a<e.length;a++)s+=me.dot(n,e[a])+n[3]>=0;if(s===0)return 0;s!==e.length&&(i=!1)}return i?2:1}function Co(t,e){for(const i of t.projections){const r=La(e,t.points[0],i.axis);if(i.projection[1]<r[0]||i.projection[0]>r[1])return 0}return 1}function na(t,e){let i=0;const r=[0,0,0,0];for(let n=0;n<t.length;n++)r[0]=t[n][0],r[1]=t[n][1],r[2]=t[n][2],r[3]=1,V.dot(r,e)>=0&&i++;return i}class Xs{constructor(e,i){this.points=e||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=Hr.fromPoints(this.points),this.projections=[],this.frustumEdges=[me.sub([],this.points[2],this.points[3]),me.sub([],this.points[0],this.points[3]),me.sub([],this.points[4],this.points[0]),me.sub([],this.points[5],this.points[1]),me.sub([],this.points[6],this.points[2]),me.sub([],this.points[7],this.points[3])];for(const r of this.frustumEdges){const n=[0,-r[2],r[1]],s=[r[2],0,-r[0]];this.projections.push({axis:n,projection:La(this.points,this.points[0],n)}),this.projections.push({axis:s,projection:La(this.points,this.points[0],s)})}}static fromInvProjectionMatrix(e,i,r,n){const s=Math.pow(2,r),a=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(_=>{const v=V.transformMat4([],_,e),E=1/v[3]/i*s;return V.mul(v,v,[E,E,n?1/v[3]:E,E])}),c=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(_=>{const v=me.sub([],a[_[0]],a[_[1]]),E=me.sub([],a[_[2]],a[_[1]]),C=me.normalize([],me.cross([],v,E)),B=-me.dot(C,a[_[1]]);return C.concat(B)}),p=[];for(let _=0;_<a.length;_++)p.push([a[_][0],a[_][1],a[_][2]]);return new Xs(p,c)}intersectsPrecise(e,i,r){for(let n=0;n<i.length;n++)if(!na(e,i[n]))return 0;for(let n=0;n<this.planes.length;n++)if(!na(e,this.planes[n]))return 0;for(const n of r)for(const s of this.frustumEdges){const a=me.cross([],n,s),c=me.length(a);if(c===0)continue;me.scale(a,a,1/c);const p=La(this.points,this.points[0],a),_=La(e,this.points[0],a);if(p[0]>_[1]||_[0]>p[1])return 0}return 1}}class Hr{static fromPoints(e){const i=[1/0,1/0,1/0],r=[-1/0,-1/0,-1/0];for(const n of e)me.min(i,i,n),me.max(r,r,n);return new Hr(i,r)}static fromTileIdAndHeight(e,i,r){const n=1<<e.canonical.z,s=e.canonical.x,a=e.canonical.y;return new Hr([s/n,a/n,i],[(s+1)/n,(a+1)/n,r])}static applyTransform(e,i){const r=e.getCorners();for(let n=0;n<r.length;++n)me.transformMat4(r[n],r[n],i);return Hr.fromPoints(r)}static projectAabbCorners(e,i){const r=e.getCorners();for(let n=0;n<r.length;++n)me.transformMat4(r[n],r[n],i);return r}constructor(e,i){this.min=e,this.max=i,this.center=me.scale([],me.add([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],r=me.clone(this.min),n=me.clone(this.max);for(let s=0;s<i.length;s++)r[s]=i[s]?this.min[s]:this.center[s],n[s]=i[s]?this.center[s]:this.max[s];return n[2]=this.max[2],new Hr(r,n)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?$a(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?$a(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,i){return i||this.intersects(e)?Co(e,this.getCorners()):0}intersectsPreciseFlat(e,i){return i||this.intersectsFlat(e)?Co(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let i=0;i<3;++i)if(this.min[i]>e.max[i]||e.min[i]>this.max[i])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e.min[i]),this.max[i]=Math.max(this.max[i],e.max[i])}encapsulatePoint(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e[i]),this.max[i]=Math.max(this.max[i],e[i])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}Mi(Hr,"Aabb");const sa=5,zs=6,Vn=Mt/Math.PI/2,el=16383,qo=64,ga=[qo,32,16],Ys=-Vn,Ks=Vn,Qo=[new Hr([Ys,Ys,Ys],[Ks,Ks,Ks]),new Hr([Ys,Ys,Ys],[0,0,Ks]),new Hr([0,Ys,Ys],[Ks,0,Ks]),new Hr([Ys,0,Ys],[0,Ks,Ks]),new Hr([0,0,Ys],[Ks,Ks,Ks])];function ln(t){return t*Vn/Oa}function Ra(t,e,i,r=!0){const n=me.scale([],t._camera.position,t.worldSize),s=[e,i,1,1];V.transformMat4(s,s,t.pixelMatrixInverse),V.scale(s,s,1/s[3]);const a=me.sub([],s,n),c=me.normalize([],a),p=t.globeMatrix,_=[p[12],p[13],p[14]],v=me.sub([],_,n),E=me.length(v),C=me.normalize([],v),B=t.worldSize/(2*Math.PI),O=me.dot(C,c),G=Math.asin(B/E);if(G<Math.acos(O)){if(!r)return null;const Ve=[],je=[];me.scale(Ve,c,E/O),me.normalize(je,me.sub(je,Ve,v)),me.normalize(c,me.add(c,v,me.scale(c,je,Math.tan(G)*E)))}const q=[];new ys(n,c).closestPointOnSphere(_,B,q);const X=me.normalize([],gn(p,0)),$=me.normalize([],gn(p,1)),re=me.normalize([],gn(p,2)),ne=me.dot(X,q),ie=me.dot($,q),se=me.dot(re,q),he=hr(Math.asin(-ie/B));let ve=hr(Math.atan2(ne,se));ve=t.center.lng+function(Ve,je){const Je=(je-Ve+180)%360-180;return Je<-180?Je+360:Je}(t.center.lng,ve);const be=Wo(ve),De=Ai(oa(he),0,1);return new Wr(be,De)}class Fa{constructor(e,i,r){this.a=me.sub([],e,r),this.b=me.sub([],i,r),this.center=r;const n=me.normalize([],this.a),s=me.normalize([],this.b);this.angle=Math.acos(me.dot(n,s))}}function ko(t,e){if(t.angle===0)return null;let i;return i=t.a[e]===0?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),i<0||i>1?null:function(r,n,s,a){const c=Math.sin(s);return r*(Math.sin((1-a)*s)/c)+n*(Math.sin(a*s)/c)}(t.a[e],t.b[e],t.angle,Ai(i,0,1))+t.center[e]}function _o(t){if(t.z<=1)return Qo[t.z+2*t.y+t.x];const e=tl(ml(t));return Hr.fromPoints(e)}function ya(t,e,i){return me.scale(t,t,1-i),me.scaleAndAdd(t,t,e,i)}function TA(t,e){const i=Ho(e.zoom);if(i===0)return _o(t);const r=ml(t),n=tl(r),s=Wo(r.getWest())*e.worldSize,a=Wo(r.getEast())*e.worldSize,c=oa(r.getNorth())*e.worldSize,p=oa(r.getSouth())*e.worldSize,_=[s,c,0],v=[a,c,0],E=[s,p,0],C=[a,p,0],B=ce.invert([],e.globeMatrix);return me.transformMat4(_,_,B),me.transformMat4(v,v,B),me.transformMat4(E,E,B),me.transformMat4(C,C,B),n[0]=ya(n[0],E,i),n[1]=ya(n[1],C,i),n[2]=ya(n[2],v,i),n[3]=ya(n[3],_,i),Hr.fromPoints(n)}function vc(t,e,i){for(const r of t)me.transformMat4(r,r,e),me.scale(r,r,i)}function Wl(t,e,i,r){const n=e/t.worldSize,s=t.globeMatrix;if(i.z<=1){const be=_o(i).getCorners();return vc(be,s,n),Hr.fromPoints(be)}const a=ml(i,r),c=tl(a);vc(c,s,n);const p=Number.MAX_VALUE,_=[-p,-p,-p],v=[p,p,p];if(a.contains(t.center)){for(const Ve of c)me.min(v,v,Ve),me.max(_,_,Ve);_[2]=0;const be=t.point,De=[be.x*n,be.y*n,0];return me.min(v,v,De),me.max(_,_,De),new Hr(v,_)}const E=[s[12]*n,s[13]*n,s[14]*n],C=a.getCenter(),B=Ai(t.center.lat,-oo,oo),O=Ai(C.lat,-oo,oo),G=Wo(t.center.lng),q=oa(B);let X=G-Wo(C.lng);const $=q-oa(O);X>.5?X-=1:X<-.5&&(X+=1);let re=0;if(Math.abs(X)>Math.abs($))re=X>=0?1:3;else{re=$>=0?0:2;const be=[s[4]*n,s[5]*n,s[6]*n],De=-Math.sin(wi($>=0?a.getSouth():a.getNorth()))*Vn;me.scaleAndAdd(E,E,be,De)}const ne=c[re],ie=c[(re+1)%4],se=new Fa(ne,ie,E),he=[ko(se,0)||ne[0],ko(se,1)||ne[1],ko(se,2)||ne[2]],ve=Ho(t.zoom);if(ve>0){const be=function({x:Ve,y:je,z:Je},Fe,nt,At,vt){const rt=1/(1<<Je);let lt=Ve*rt,wt=lt+rt,It=je*rt,St=It+rt,Bt=0;const Ft=(lt+wt)/2-At;return Ft>.5?Bt=-1:Ft<-.5&&(Bt=1),lt=((lt+Bt)*Fe-(At*=Fe))*nt+At,wt=((wt+Bt)*Fe-At)*nt+At,It=(It*Fe-(vt*=Fe))*nt+vt,St=(St*Fe-vt)*nt+vt,[[lt,St,0],[wt,St,0],[wt,It,0],[lt,It,0]]}(i,e,t._pixelsPerMercatorPixel,G,q);for(let Ve=0;Ve<c.length;Ve++)ya(c[Ve],be[Ve],ve);const De=me.add([],be[re],be[(re+1)%4]);me.scale(De,De,.5),ya(he,De,ve)}for(const be of c)me.min(v,v,be),me.max(_,_,be);return v[2]=Math.min(ne[2],ie[2]),me.min(v,v,he),me.max(_,_,he),new Hr(v,_)}function ml({x:t,y:e,z:i},r=!1){const n=1/(1<<i),s=new er(MA(t*n),e===(1<<i)-1&&r?-90:Lo((e+1)*n)),a=new er(MA((t+1)*n),e===0&&r?90:Lo(e*n));return new kl(s,a)}function tl(t){const e=wi(t.getNorth()),i=wi(t.getSouth()),r=Math.cos(e),n=Math.cos(i),s=Math.sin(e),a=Math.sin(i),c=t.getWest(),p=t.getEast();return[Xl(n,a,c),Xl(n,a,p),Xl(r,s,p),Xl(r,s,c)]}function Xl(t,e,i,r=Vn){return i=wi(i),[t*Math.sin(i)*r,-e*r,t*Math.cos(i)*r]}function xa(t,e,i){return Xl(Math.cos(wi(t)),Math.sin(wi(t)),e,i)}function hh(t,e,i,r){const n=1<<i.z,s=(t/Mt+i.x)/n;return xa(Lo((e/Mt+i.y)/n),MA(s),r)}function fh({min:t,max:e}){return el/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}const Yf=new Float64Array(16);function _l(t){const e=fh(t),i=ce.fromScaling(Yf,[e,e,e]);return ce.translate(i,i,me.negate([],t.min))}function Kf(t){const e=ce.fromTranslation(Yf,t.min),i=1/fh(t);return ce.scale(e,e,[i,i,i])}function Jf(t){const e=Mt/(2*Math.PI);return t/(2*Math.PI)/e}function sm(t,e){return Mt/(512*Math.pow(2,t))*fh(_o(e))}function om(t,e,i,r,n){const s=Jf(i),a=[t,e,-i/(2*Math.PI)],c=ce.identity(new Float64Array(16));return ce.translate(c,c,a),ce.scale(c,c,[s,s,s]),ce.rotateX(c,c,wi(-n)),ce.rotateY(c,c,wi(-r)),c}function am(t){const e=t.pixelsPerMeter,i=e/jn(1,t.center.lat),r=ce.identity(new Float64Array(16));return ce.translate(r,r,[t.point.x,t.point.y,0]),ce.scale(r,r,[i,i,e]),Float32Array.from(r)}function Ho(t){return jr(sa,zs,t)}function lm(t,e,i){const r=ce.identity(new Float64Array(16)),n=(e/(1<<t)-.5)*Math.PI*2;return ce.rotateY(r,i.globeMatrix,n),Float32Array.from(r)}function Am(t,e,i){const r=Ho(i.zoom),n=t.style.map._antialias,s=e.options.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return r===0&&!n&&!s}function cm(t,e,i,r){const n=e.getNorth(),s=e.getSouth(),a=e.getWest(),c=e.getEast(),p=1<<t.z,_=c-a,v=n-s,E=_/qo,C=-v/ga[i],B=[0,E,0,C,0,0,n,a,0];if(t.z>0){const O=180/r;Se.multiply(B,B,[O/_+1,0,0,0,O/v+1,0,-.5*O/E,.5*O/C,1])}return B[2]=p,B[5]=t.x,B[8]=t.y,B}function sg(t){const e=oo-5;t=Ai(t,-e,e)/e*90;const i=Math.pow(Math.abs(Math.sin(wi(t))),3);return Math.round(i*(ga.length-1))}function EA(t){const e=[0,0,0],i=ce.identity(new Float64Array(16));return ce.multiply(i,t.pixelMatrix,t.globeMatrix),me.transformMat4(e,e,i),new ct(e[0],e[1])}function Jh(t,e){const i=xa(e.lat,e.lng),r=function(s){const a=xa(s._center.lat,s._center.lng),c=me.fromValues(0,1,0);let p=me.cross([],c,a);const _=ce.fromRotation([],-s.angle,a);p=me.transformMat4(p,p,_),ce.fromRotation(_,-s._pitch,p);const v=me.normalize([],a);return me.scale(v,v,ln(s.cameraToCenterDistance/s.pixelsPerMeter)),me.transformMat4(v,v,_),me.add([],a,v)}(t),n=me.subtract([],r,i);return me.angle(n,i)}function $h(t,e){return Jh(t,e)>Math.PI/2*1.01}const um=wi(85),og=Math.cos(um),ag=Math.sin(um);class il{constructor(e){this._createGrid(e),this._createPoles(e)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const e of this._poleSegments)e.destroy();for(const e of this._gridSegments)e.withSkirts.destroy(),e.withoutSkirts.destroy()}_fillGridMeshWithLods(e,i){const r=new pl,n=new so,s=[],a=e+1+2,c=i[0]+1,p=i[0]+1+(1+i.length),_=(v,E,C)=>{let B=v===a-1?v-2:v===0?v:v-1;return B+=C?24575:0,[B,E]};for(let v=0;v<a;++v)r.emplaceBack(..._(v,0,!0));for(let v=0;v<c;++v)for(let E=0;E<a;++E)r.emplaceBack(..._(E,v,(E===0||E===a-1)&&!0));for(let v=0;v<i.length;++v){const E=i[v];for(let C=0;C<a;++C)r.emplaceBack(..._(C,E,!0))}for(let v=0;v<i.length;++v){const E=n.length,C=i[v]+1+2,B=new so;for(let q=0;q<C-1;q++){const X=q===C-2,$=X?a*(p-i.length+v-q):a;for(let re=0;re<a-1;re++){const ne=q*a+re;q===0||X||re===0||re===a-2?(B.emplaceBack(ne+1,ne,ne+$),B.emplaceBack(ne+$,ne+$+1,ne+1)):(n.emplaceBack(ne+1,ne,ne+$),n.emplaceBack(ne+$,ne+$+1,ne+1))}}const O=Mn.simpleSegment(0,E,r.length,n.length-E);for(let q=0;q<B.uint16.length;q+=3)n.emplaceBack(B.uint16[q],B.uint16[q+1],B.uint16[q+2]);const G=Mn.simpleSegment(0,E,r.length,n.length-E);s.push({withoutSkirts:O,withSkirts:G})}return{vertices:r,indices:n,segments:s}}_createGrid(e){const i=this._fillGridMeshWithLods(qo,ga);this._gridSegments=i.segments,this._gridBuffer=e.createVertexBuffer(i.vertices,xi.members),this._gridIndexBuffer=e.createIndexBuffer(i.indices,!0)}_createPoles(e){const i=new so;for(let c=0;c<=qo;c++)i.emplaceBack(0,c+1,c+2);this._poleIndexBuffer=e.createIndexBuffer(i,!0);const r=new Ou,n=new Ou,s=new Ou,a=new Ou;this._poleSegments=[];for(let c=0,p=0;c<sa;c++){const _=360/(1<<c);r.emplaceBack(0,-Vn,0,.5,0),n.emplaceBack(0,-Vn,0,.5,1),s.emplaceBack(0,-Vn,0,.5,.5),a.emplaceBack(0,-Vn,0,.5,.5);for(let v=0;v<=qo;v++){let E=v/qo,C=0;const B=Ki(0,_,E),[O,G,q]=Xl(og,ag,B,Vn);r.emplaceBack(O,G,q,E,C),n.emplaceBack(O,G,q,E,1-C);const X=wi(B);E=.5+.5*Math.sin(X),C=.5+.5*Math.cos(X),s.emplaceBack(O,G,q,E,C),a.emplaceBack(O,G,q,E,1-C)}this._poleSegments.push(Mn.simpleSegment(p,0,66,64)),p+=66}this._poleNorthVertexBuffer=e.createVertexBuffer(r,Bi,!1),this._poleSouthVertexBuffer=e.createVertexBuffer(n,Bi,!1),this._texturedPoleNorthVertexBuffer=e.createVertexBuffer(s,Bi,!1),this._texturedPoleSouthVertexBuffer=e.createVertexBuffer(a,Bi,!1)}getGridBuffers(e,i){return[this._gridBuffer,this._gridIndexBuffer,i?this._gridSegments[e].withSkirts:this._gridSegments[e].withoutSkirts]}getPoleBuffers(e,i){return[i?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,i?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[e]]}}const Oa=63710088e-1,$c=2*Math.PI*Oa;class Na{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Na(Pn(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,r=this.lat*i,n=e.lat*i,s=Math.sin(r)*Math.sin(n)+Math.cos(r)*Math.cos(n)*Math.cos((e.lng-this.lng)*i);return Oa*Math.acos(Math.min(s,1))}toBounds(e=0){const i=360*e/40075017,r=i/Math.cos(Math.PI/180*this.lat);return new kl(new Na(this.lng-r,this.lat-i),new Na(this.lng+r,this.lat+i))}toEcef(e){const i=ln(e);return xa(this.lat,this.lng,Vn+i)}static convert(e){if(e instanceof Na)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Na(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Na(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var er=Na;const bc=0,Ww=25.5;function hm(t){return $c*Math.cos(t*Math.PI/180)}function Wo(t){return(180+t)/360}function oa(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function jn(t,e){return t/hm(e)}function MA(t){return 360*t-180}function Lo(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function Xy(t,e){return t*hm(Lo(e))}const oo=85.051129;function Yy(t){return Math.cos(wi(Ai(t,-oo,oo)))}function dh(t,e){const i=Ai(e,bc,Ww),r=Math.pow(2,i);return Yy(t)*$c/(512*r)}function lg(t){return 1/Math.cos(t*Math.PI/180)}function C0(t,e=0){const i=Math.exp(Math.PI*(1-(t.y+e/Mt)/(1<<t.z)*2));return 80150034*i/(i*i+1)/Mt/(1<<t.z)}class Wr{constructor(e,i,r=0){this.x=+e,this.y=+i,this.z=+r}static fromLngLat(e,i=0){const r=er.convert(e);return new Wr(Wo(r.lng),oa(r.lat),jn(i,r.lat))}toLngLat(){return new er(MA(this.x),Lo(this.y))}toAltitude(){return Xy(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/$c*lg(Lo(this.y))}}function Ag(t,e,i,r,n,s,a,c,p){const _=(e+r)/2,v=(i+n)/2,E=new ct(_,v);c(E),function(C,B,O,G,q,X){const $=O-q,re=G-X;return Math.abs((G-B)*$-(O-C)*re)/Math.hypot($,re)}(E.x,E.y,s.x,s.y,a.x,a.y)>=p?(Ag(t,e,i,_,v,s,E,c,p),Ag(t,_,v,r,n,E,a,c,p)):t.push(a)}function Ky(t,e,i){let r=t[0],n=r.x,s=r.y;e(r);const a=[r];for(let c=1;c<t.length;c++){const p=t[c],{x:_,y:v}=p;e(p),Ag(a,n,s,_,v,r,p,e,i),n=_,s=v,r=p}return a}function cg(t,e,i,r){if(r(e,i)){const n=e.add(i)._mult(.5);cg(t,e,n,r),cg(t,n,i,r)}else t.push(i)}function Xw(t,e){let i=t[0];const r=[i];for(let n=1;n<t.length;n++){const s=t[n];cg(r,i,s,e),i=s}return r}const ug=Math.pow(2,14)-1,Jy=-ug-1;function Yw(t,e){const i=Math.round(t.x*e),r=Math.round(t.y*e);return t.x=Ai(i,Jy,ug),t.y=Ai(r,Jy,ug),(i<t.x||i>t.x+1||r<t.y||r>t.y+1)&&Be("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function yu(t,e,i){const r=t.loadGeometry(),n=t.extent,s=Mt/n;if(e&&i&&i.projection.isReprojectedInTileSpace){const a=1<<e.z,{scale:c,x:p,y:_,projection:v}=i,E=C=>{const B=MA((e.x+C.x/n)/a),O=Lo((e.y+C.y/n)/a),G=v.project(B,O);C.x=(G.x*c-p)*n,C.y=(G.y*c-_)*n};for(let C=0;C<r.length;C++)if(t.type!==1)r[C]=Ky(r[C],E,1);else{const B=[];for(const O of r[C])O.x<0||O.x>=n||O.y<0||O.y>=n||(E(O),B.push(O));r[C]=B}}for(const a of r)for(const c of a)Yw(c,s);return r}function ph(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?yu(t):[]}}function fm(t,e,i,r,n){t.emplaceBack(2*e+(r+1)/2,2*i+(n+1)/2)}function dm(t,e,i){t.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class hg{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new pl,this.indexArray=new so,this.segments=new Mn,this.programConfigurations=new _c(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,r,n){const s=this.layers[0],a=[];let c=null;s.type==="circle"&&(c=s.layout.get("circle-sort-key"));for(const{feature:_,id:v,index:E,sourceLayerIndex:C}of e){const B=this.layers[0]._featureFilter.needGeometry,O=ph(_,B);if(!this.layers[0]._featureFilter.filter(new _s(this.zoom),O,r))continue;const G=c?c.evaluate(O,{},r):void 0,q={id:v,properties:_.properties,type:_.type,sourceLayerIndex:C,index:E,geometry:B?O.geometry:yu(_,r,n),patterns:{},sortKey:G};a.push(q)}c&&a.sort((_,v)=>_.sortKey-v.sortKey);let p=null;n.projection.name==="globe"&&(this.globeExtVertexArray=new Ef,p=n.projection);for(const _ of a){const{geometry:v,index:E,sourceLayerIndex:C}=_,B=e[E].feature;this.addFeature(_,v,E,i.availableImages,r,p,i.brightness),i.featureIndex.insert(B,v,E,C,this.index)}}update(e,i,r,n,s){const a=Object.keys(e).length!==0;a&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,i,a?this.stateDependentLayers:this.layers,r,n,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Rp.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Fp.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,i,r,n,s,a,c){for(const p of i)for(const _ of p){const v=_.x,E=_.y;if(v<0||v>=Mt||E<0||E>=Mt)continue;if(a){const O=a.projectTilePoint(v,E,s),G=a.upVector(s,v,E),q=this.globeExtVertexArray;dm(q,O,G),dm(q,O,G),dm(q,O,G),dm(q,O,G)}const C=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),B=C.vertexLength;fm(this.layoutVertexArray,v,E,-1,-1),fm(this.layoutVertexArray,v,E,1,-1),fm(this.layoutVertexArray,v,E,1,1),fm(this.layoutVertexArray,v,E,-1,1),this.indexArray.emplaceBack(B,B+1,B+2),this.indexArray.emplaceBack(B,B+2,B+3),C.vertexLength+=4,C.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,{},n,s,c)}}function $y(t,e){for(let i=0;i<t.length;i++)if(mh(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(mh(t,e[i]))return!0;return!!fg(t,e)}function Kw(t,e,i){return!!mh(t,e)||!!dg(e,t,i)}function e1(t,e){if(t.length===1)return i1(e,t[0]);for(let i=0;i<e.length;i++){const r=e[i];for(let n=0;n<r.length;n++)if(mh(t,r[n]))return!0}for(let i=0;i<t.length;i++)if(i1(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(fg(t,e[i]))return!0;return!1}function Jw(t,e,i){if(t.length>1){if(fg(t,e))return!0;for(let r=0;r<e.length;r++)if(dg(e[r],t,i))return!0}for(let r=0;r<t.length;r++)if(dg(t[r],e,i))return!0;return!1}function fg(t,e){if(t.length===0||e.length===0)return!1;for(let i=0;i<t.length-1;i++){const r=t[i],n=t[i+1];for(let s=0;s<e.length-1;s++)if($w(r,n,e[s],e[s+1]))return!0}return!1}function $w(t,e,i,r){return Rt(t,i,r)!==Rt(e,i,r)&&Rt(t,e,i)!==Rt(t,e,r)}function dg(t,e,i){const r=i*i;if(e.length===1)return t.distSqr(e[0])<r;for(let n=1;n<e.length;n++)if(t1(t,e[n-1],e[n])<r)return!0;return!1}function t1(t,e,i){const r=e.distSqr(i);if(r===0)return t.distSqr(e);const n=((t.x-e.x)*(i.x-e.x)+(t.y-e.y)*(i.y-e.y))/r;return t.distSqr(n<0?e:n>1?i:i.sub(e)._mult(n)._add(e))}function i1(t,e){let i,r,n,s=!1;for(let a=0;a<t.length;a++){i=t[a];for(let c=0,p=i.length-1;c<i.length;p=c++)r=i[c],n=i[p],r.y>e.y!=n.y>e.y&&e.x<(n.x-r.x)*(e.y-r.y)/(n.y-r.y)+r.x&&(s=!s)}return s}function mh(t,e){let i=!1;for(let r=0,n=t.length-1;r<t.length;n=r++){const s=t[r],a=t[n];s.y>e.y!=a.y>e.y&&e.x<(a.x-s.x)*(e.y-s.y)/(a.y-s.y)+s.x&&(i=!i)}return i}function r1(t,e,i,r,n){for(const a of t)if(e<=a.x&&i<=a.y&&r>=a.x&&n>=a.y)return!0;const s=[new ct(e,i),new ct(e,n),new ct(r,n),new ct(r,i)];if(t.length>2){for(const a of s)if(mh(t,a))return!0}for(let a=0;a<t.length-1;a++)if(e2(t[a],t[a+1],s))return!0;return!1}function e2(t,e,i){const r=i[0],n=i[2];if(t.x<r.x&&e.x<r.x||t.x>n.x&&e.x>n.x||t.y<r.y&&e.y<r.y||t.y>n.y&&e.y>n.y)return!1;const s=Rt(t,e,i[0]);return s!==Rt(t,e,i[1])||s!==Rt(t,e,i[2])||s!==Rt(t,e,i[3])}function $f(t,e,i,r,n,s){let a=e.y-t.y,c=t.x-e.x;if(s=s||0){const p=a*a+c*c;if(p===0)return!0;const _=Math.sqrt(p);a/=_,c/=_}return!((i.x-t.x)*a+(i.y-t.y)*c-s<0||(r.x-t.x)*a+(r.y-t.y)*c-s<0||(n.x-t.x)*a+(n.y-t.y)*c-s<0)}function pg(t,e,i,r,n,s,a){return!($f(t,e,r,n,s,a)||$f(e,i,r,n,s,a)||$f(i,t,r,n,s,a)||$f(r,n,t,e,i,a)||$f(n,s,t,e,i,a)||$f(s,r,t,e,i,a))}function ed(t,e,i){const r=e.paint.get(t).value;return r.kind==="constant"?r.value:i.programConfigurations.get(e.id).getMaxValue(t)}function pm(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function n1(t,e,i,r,n){if(!e[0]&&!e[1])return t;const s=ct.convert(e)._mult(n);i==="viewport"&&s._rotate(-r);const a=[];for(let c=0;c<t.length;c++)a.push(t[c].sub(s));return a}function s1(t,e,i,r){const n=ct.convert(t)._mult(r);return e==="viewport"&&n._rotate(-i),n}Mi(hg,"CircleBucket",{omit:["layers"]});const t2=new as({"circle-sort-key":new Gi(xt.layout_circle["circle-sort-key"]),visibility:new ri(xt.layout_circle.visibility)});var i2={paint:new as({"circle-radius":new Gi(xt.paint_circle["circle-radius"]),"circle-color":new Gi(xt.paint_circle["circle-color"]),"circle-blur":new Gi(xt.paint_circle["circle-blur"]),"circle-opacity":new Gi(xt.paint_circle["circle-opacity"]),"circle-translate":new ri(xt.paint_circle["circle-translate"]),"circle-translate-anchor":new ri(xt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ri(xt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ri(xt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Gi(xt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Gi(xt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Gi(xt.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new ri(xt.paint_circle["circle-emissive-strength"])}),layout:t2};const r2=ce.create(),n2=(t,e,i,r,n,s)=>{const a=t.transform,c=a.projection.name==="globe";let p;if(s.paint.get("circle-pitch-alignment")==="map")if(c){const v=sm(a.zoom,e.canonical)*a._pixelsPerMercatorPixel;p=Float32Array.from([v,0,0,v])}else p=a.calculatePixelsToTileUnitsMatrix(i);else p=new Float32Array([a.pixelsToGLUnits[0],0,0,a.pixelsToGLUnits[1]]);const _={u_camera_to_center_distance:t.transform.getCameraToCenterDistance(a.projection),u_matrix:t.translatePosMatrix(e.projMatrix,i,s.paint.get("circle-translate"),s.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Wi.devicePixelRatio,u_extrude_scale:p,u_inv_rot_matrix:r2,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:s.paint.get("circle-emissive-strength")};if(c){_.u_inv_rot_matrix=r,_.u_merc_center=n,_.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],_.u_zoom_transition=Ho(a.zoom);const v=n[0]*Mt,E=n[1]*Mt;_.u_up_dir=a.projection.upVector(new ci(0,0,0),v,E)}return _},o1=t=>{const e=[];return t.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),t.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function a1(t,e,i,r,n,s,a,c,p){if(s&&t.queryGeometry.isAboveHorizon)return!1;s&&(p*=t.pixelToTileUnitsFactor);const _=t.tileID.canonical,v=i.projection.upVectorScale(_,i.center.lat,i.worldSize).metersToTile;for(const E of e)for(const C of E){const B=C.add(c),O=n&&i.elevation?i.elevation.exaggeration()*n.getElevationAt(B.x,B.y,!0):0,G=i.projection.projectTilePoint(B.x,B.y,_);if(O>0){const re=i.projection.upVector(_,B.x,B.y);G.x+=re[0]*v*O,G.y+=re[1]*v*O,G.z+=re[2]*v*O}const q=s?B:s2(G.x,G.y,G.z,r),X=s?t.tilespaceRays.map(re=>a2(re,O)):t.queryGeometry.screenGeometry,$=V.transformMat4([],[G.x,G.y,G.z,1],r);if(!a&&s?p*=$[3]/i.cameraToCenterDistance:a&&!s&&(p*=i.cameraToCenterDistance/$[3]),s){const re=Lo((C.y/Mt+_.y)/(1<<_.z));p/=i.projection.pixelsPerMeter(re,1)/jn(1,re)}if(Kw(X,q,p))return!0}return!1}function s2(t,e,i,r){const n=V.transformMat4([],[t,e,i,1],r);return new ct(n[0]/n[3],n[1]/n[3])}const l1=me.fromValues(0,0,0),o2=me.fromValues(0,0,1);function a2(t,e){const i=me.create();return l1[2]=e,t.intersectsPlane(l1,o2,i),new ct(i[0],i[1])}class A1 extends hg{}function c1(t,{width:e,height:i},r,n){if(n){if(n instanceof Uint8ClampedArray)n=new Uint8Array(n.buffer);else if(n.length!==e*i*r)throw new RangeError("mismatched image size")}else n=new Uint8Array(e*i*r);return t.width=e,t.height=i,t.data=n,t}function u1(t,e,i){const{width:r,height:n}=e;r===t.width&&n===t.height||(mg(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,r),height:Math.min(t.height,n)},i),t.width=r,t.height=n,t.data=e.data)}function mg(t,e,i,r,n,s){if(n.width===0||n.height===0)return e;if(n.width>t.width||n.height>t.height||i.x>t.width-n.width||i.y>t.height-n.height)throw new RangeError("out of range source coordinates for image copy");if(n.width>e.width||n.height>e.height||r.x>e.width-n.width||r.y>e.height-n.height)throw new RangeError("out of range destination coordinates for image copy");const a=t.data,c=e.data;for(let p=0;p<n.height;p++){const _=((i.y+p)*t.width+i.x)*s,v=((r.y+p)*e.width+r.x)*s;for(let E=0;E<n.width*s;E++)c[v+E]=a[_+E]}return e}Mi(A1,"HeatmapBucket",{omit:["layers"]});class ju{constructor(e,i){c1(this,e,1,i)}resize(e){u1(this,new ju(e),1)}clone(){return new ju({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,r,n,s){mg(e,i,r,n,s,1)}}class Do{constructor(e,i){c1(this,e,4,i)}resize(e){u1(this,new Do(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Do({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,r,n,s){mg(e,i,r,n,s,4)}}class h1{constructor(e,i){this.width=e.width,this.height=e.height,this.data=i instanceof Uint8Array?new Float32Array(i.buffer):i}}Mi(ju,"AlphaImage"),Mi(Do,"RGBAImage");const l2=new as({visibility:new ri(xt.layout_heatmap.visibility)});var A2={paint:new as({"heatmap-radius":new Gi(xt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Gi(xt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ri(xt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new hu(xt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ri(xt.paint_heatmap["heatmap-opacity"])}),layout:l2};function mm(t){const e={},i=t.resolution||256,r=t.clips?t.clips.length:1,n=t.image||new Do({width:i,height:r}),s=(a,c,p)=>{e[t.evaluationKey]=p;const _=t.expression.evaluate(e);_&&(n.data[a+c+0]=Math.floor(255*_.r/_.a),n.data[a+c+1]=Math.floor(255*_.g/_.a),n.data[a+c+2]=Math.floor(255*_.b/_.a),n.data[a+c+3]=Math.floor(255*_.a))};if(t.clips)for(let a=0,c=0;a<r;++a,c+=4*i)for(let p=0,_=0;p<i;p++,_+=4){const v=p/(i-1),{start:E,end:C}=t.clips[a];s(c,_,E*(1-v)+C*v)}else for(let a=0,c=0;a<i;a++,c+=4)s(0,c,a/(i-1));return n}const c2=new as({visibility:new ri(xt.layout_hillshade.visibility)});var u2={paint:new as({"hillshade-illumination-direction":new ri(xt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ri(xt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ri(xt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ri(xt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ri(xt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ri(xt.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new ri(xt.paint_hillshade["hillshade-emissive-strength"])}),layout:c2};const h2=an([{name:"a_pos",components:2,type:"Int16"}],4),{members:f2}=h2;var _g={exports:{}};function _m(t,e,i){i=i||2;var r,n,s,a,c,p,_,v=e&&e.length,E=v?e[0]*i:t.length,C=f1(t,0,E,i,!0),B=[];if(!C||C.next===C.prev)return B;if(v&&(C=function(G,q,X,$){var re,ne,ie,se=[];for(re=0,ne=q.length;re<ne;re++)(ie=f1(G,q[re]*$,re<ne-1?q[re+1]*$:G.length,$,!1))===ie.next&&(ie.steiner=!0),se.push(v2(ie));for(se.sort(g2),re=0;re<se.length;re++)X=y2(se[re],X);return X}(t,e,C,i)),t.length>80*i){r=s=t[0],n=a=t[1];for(var O=i;O<E;O+=i)(c=t[O])<r&&(r=c),(p=t[O+1])<n&&(n=p),c>s&&(s=c),p>a&&(a=p);_=(_=Math.max(s-r,a-n))!==0?32767/_:0}return k0(C,B,i,r,n,_,0),B}function f1(t,e,i,r,n){var s,a;if(n===xg(t,e,i,r)>0)for(s=e;s<i;s+=r)a=m1(s,t[s],t[s+1],a);else for(s=i-r;s>=e;s-=r)a=m1(s,t[s],t[s+1],a);return a&&gm(a,a.next)&&(P0(a),a=a.next),a}function ef(t,e){if(!t)return t;e||(e=t);var i,r=t;do if(i=!1,r.steiner||!gm(r,r.next)&&Xo(r.prev,r,r.next)!==0)r=r.next;else{if(P0(r),(r=e=r.prev)===r.next)break;i=!0}while(i||r!==e);return e}function k0(t,e,i,r,n,s,a){if(t){!a&&s&&function(v,E,C,B){var O=v;do O.z===0&&(O.z=gg(O.x,O.y,E,C,B)),O.prevZ=O.prev,O.nextZ=O.next,O=O.next;while(O!==v);O.prevZ.nextZ=null,O.prevZ=null,function(G){var q,X,$,re,ne,ie,se,he,ve=1;do{for(X=G,G=null,ne=null,ie=0;X;){for(ie++,$=X,se=0,q=0;q<ve&&(se++,$=$.nextZ);q++);for(he=ve;se>0||he>0&&$;)se!==0&&(he===0||!$||X.z<=$.z)?(re=X,X=X.nextZ,se--):(re=$,$=$.nextZ,he--),ne?ne.nextZ=re:G=re,re.prevZ=ne,ne=re;X=$}ne.nextZ=null,ve*=2}while(ie>1)}(O)}(t,r,n,s);for(var c,p,_=t;t.prev!==t.next;)if(c=t.prev,p=t.next,s?p2(t,r,n,s):d2(t))e.push(c.i/i|0),e.push(t.i/i|0),e.push(p.i/i|0),P0(t),t=p.next,_=p.next;else if((t=p)===_){a?a===1?k0(t=m2(ef(t),e,i),e,i,r,n,s,2):a===2&&_2(t,e,i,r,n,s):k0(ef(t),e,i,r,n,s,1);break}}}function d2(t){var e=t.prev,i=t,r=t.next;if(Xo(e,i,r)>=0)return!1;for(var n=e.x,s=i.x,a=r.x,c=e.y,p=i.y,_=r.y,v=n<s?n<a?n:a:s<a?s:a,E=c<p?c<_?c:_:p<_?p:_,C=n>s?n>a?n:a:s>a?s:a,B=c>p?c>_?c:_:p>_?p:_,O=r.next;O!==e;){if(O.x>=v&&O.x<=C&&O.y>=E&&O.y<=B&&td(n,c,s,p,a,_,O.x,O.y)&&Xo(O.prev,O,O.next)>=0)return!1;O=O.next}return!0}function p2(t,e,i,r){var n=t.prev,s=t,a=t.next;if(Xo(n,s,a)>=0)return!1;for(var c=n.x,p=s.x,_=a.x,v=n.y,E=s.y,C=a.y,B=c<p?c<_?c:_:p<_?p:_,O=v<E?v<C?v:C:E<C?E:C,G=c>p?c>_?c:_:p>_?p:_,q=v>E?v>C?v:C:E>C?E:C,X=gg(B,O,e,i,r),$=gg(G,q,e,i,r),re=t.prevZ,ne=t.nextZ;re&&re.z>=X&&ne&&ne.z<=$;){if(re.x>=B&&re.x<=G&&re.y>=O&&re.y<=q&&re!==n&&re!==a&&td(c,v,p,E,_,C,re.x,re.y)&&Xo(re.prev,re,re.next)>=0||(re=re.prevZ,ne.x>=B&&ne.x<=G&&ne.y>=O&&ne.y<=q&&ne!==n&&ne!==a&&td(c,v,p,E,_,C,ne.x,ne.y)&&Xo(ne.prev,ne,ne.next)>=0))return!1;ne=ne.nextZ}for(;re&&re.z>=X;){if(re.x>=B&&re.x<=G&&re.y>=O&&re.y<=q&&re!==n&&re!==a&&td(c,v,p,E,_,C,re.x,re.y)&&Xo(re.prev,re,re.next)>=0)return!1;re=re.prevZ}for(;ne&&ne.z<=$;){if(ne.x>=B&&ne.x<=G&&ne.y>=O&&ne.y<=q&&ne!==n&&ne!==a&&td(c,v,p,E,_,C,ne.x,ne.y)&&Xo(ne.prev,ne,ne.next)>=0)return!1;ne=ne.nextZ}return!0}function m2(t,e,i){var r=t;do{var n=r.prev,s=r.next.next;!gm(n,s)&&d1(n,r,r.next,s)&&D0(n,s)&&D0(s,n)&&(e.push(n.i/i|0),e.push(r.i/i|0),e.push(s.i/i|0),P0(r),P0(r.next),r=t=s),r=r.next}while(r!==t);return ef(r)}function _2(t,e,i,r,n,s){var a=t;do{for(var c=a.next.next;c!==a.prev;){if(a.i!==c.i&&b2(a,c)){var p=p1(a,c);return a=ef(a,a.next),p=ef(p,p.next),k0(a,e,i,r,n,s,0),void k0(p,e,i,r,n,s,0)}c=c.next}a=a.next}while(a!==t)}function g2(t,e){return t.x-e.x}function y2(t,e){var i=function(n,s){var a,c=s,p=n.x,_=n.y,v=-1/0;do{if(_<=c.y&&_>=c.next.y&&c.next.y!==c.y){var E=c.x+(_-c.y)*(c.next.x-c.x)/(c.next.y-c.y);if(E<=p&&E>v&&(v=E,a=c.x<c.next.x?c:c.next,E===p))return a}c=c.next}while(c!==s);if(!a)return null;var C,B=a,O=a.x,G=a.y,q=1/0;c=a;do p>=c.x&&c.x>=O&&p!==c.x&&td(_<G?p:v,_,O,G,_<G?v:p,_,c.x,c.y)&&(C=Math.abs(_-c.y)/(p-c.x),D0(c,n)&&(C<q||C===q&&(c.x>a.x||c.x===a.x&&x2(a,c)))&&(a=c,q=C)),c=c.next;while(c!==B);return a}(t,e);if(!i)return e;var r=p1(i,t);return ef(r,r.next),ef(i,i.next)}function x2(t,e){return Xo(t.prev,t,e.prev)<0&&Xo(e.next,t,t.next)<0}function gg(t,e,i,r,n){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*n|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*n|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function v2(t){var e=t,i=t;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==t);return i}function td(t,e,i,r,n,s,a,c){return(n-a)*(e-c)>=(t-a)*(s-c)&&(t-a)*(r-c)>=(i-a)*(e-c)&&(i-a)*(s-c)>=(n-a)*(r-c)}function b2(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(i,r){var n=i;do{if(n.i!==i.i&&n.next.i!==i.i&&n.i!==r.i&&n.next.i!==r.i&&d1(n,n.next,i,r))return!0;n=n.next}while(n!==i);return!1}(t,e)&&(D0(t,e)&&D0(e,t)&&function(i,r){var n=i,s=!1,a=(i.x+r.x)/2,c=(i.y+r.y)/2;do n.y>c!=n.next.y>c&&n.next.y!==n.y&&a<(n.next.x-n.x)*(c-n.y)/(n.next.y-n.y)+n.x&&(s=!s),n=n.next;while(n!==i);return s}(t,e)&&(Xo(t.prev,t,e.prev)||Xo(t,e.prev,e))||gm(t,e)&&Xo(t.prev,t,t.next)>0&&Xo(e.prev,e,e.next)>0)}function Xo(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function gm(t,e){return t.x===e.x&&t.y===e.y}function d1(t,e,i,r){var n=xm(Xo(t,e,i)),s=xm(Xo(t,e,r)),a=xm(Xo(i,r,t)),c=xm(Xo(i,r,e));return n!==s&&a!==c||!(n!==0||!ym(t,i,e))||!(s!==0||!ym(t,r,e))||!(a!==0||!ym(i,t,r))||!(c!==0||!ym(i,e,r))}function ym(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function xm(t){return t>0?1:t<0?-1:0}function D0(t,e){return Xo(t.prev,t,t.next)<0?Xo(t,e,t.next)>=0&&Xo(t,t.prev,e)>=0:Xo(t,e,t.prev)<0||Xo(t,t.next,e)<0}function p1(t,e){var i=new yg(t.i,t.x,t.y),r=new yg(e.i,e.x,e.y),n=t.next,s=e.prev;return t.next=e,e.prev=t,i.next=n,n.prev=i,r.next=i,i.prev=r,s.next=r,r.prev=s,r}function m1(t,e,i,r){var n=new yg(t,e,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function P0(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function yg(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function xg(t,e,i,r){for(var n=0,s=e,a=i-r;s<i;s+=r)n+=(t[a]-t[s])*(t[s+1]+t[a+1]),a=s;return n}_g.exports=_m,_g.exports.default=_m,_m.deviation=function(t,e,i,r){var n=e&&e.length,s=Math.abs(xg(t,0,n?e[0]*i:t.length,i));if(n)for(var a=0,c=e.length;a<c;a++)s-=Math.abs(xg(t,e[a]*i,a<c-1?e[a+1]*i:t.length,i));var p=0;for(a=0;a<r.length;a+=3){var _=r[a]*i,v=r[a+1]*i,E=r[a+2]*i;p+=Math.abs((t[_]-t[E])*(t[v+1]-t[_+1])-(t[_]-t[v])*(t[E+1]-t[_+1]))}return s===0&&p===0?0:Math.abs((p-s)/s)},_m.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},r=0,n=0;n<t.length;n++){for(var s=0;s<t[n].length;s++)for(var a=0;a<e;a++)i.vertices.push(t[n][s][a]);n>0&&i.holes.push(r+=t[n-1].length)}return i};var vm=_r(_g.exports);function vg(t,e){const i=t.length;if(i<=1)return[t];const r=[];let n,s;for(let a=0;a<i;a++){const c=Qt(t[a]);c!==0&&(t[a].area=Math.abs(c),s===void 0&&(s=c<0),s===c<0?(n&&r.push(n),n=[t[a]]):n.push(t[a]))}if(n&&r.push(n),e>1)for(let a=0;a<r.length;a++)r[a].length<=e||(Bc(r[a],e,1,r[a].length-1,w2),r[a]=r[a].slice(0,e));return r}function w2(t,e){return e.area-t.area}function bg(t,e,i){const r=i.patternDependencies;let n=!1;for(const s of e){const a=s.paint.get(`${t}-pattern`);a.isConstant()||(n=!0);const c=a.constantOr(null);c&&(n=!0,r[c]=!0)}return n}function wg(t,e,i,r,n){const s=n.patternDependencies;for(const a of e){const c=a.paint.get(`${t}-pattern`).value;if(c.kind!=="constant"){let p=c.evaluate({zoom:r},i,{},n.availableImages);p=p&&p.name?p.name:p,s[p]=!0,i.patterns[a.id]=p}}return i}class bm{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new pl,this.indexArray=new so,this.indexArray2=new jc,this.programConfigurations=new _c(e.layers,e.zoom),this.segments=new Mn,this.segments2=new Mn,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection}populate(e,i,r,n){this.hasPattern=bg("fill",this.layers,i);const s=this.layers[0].layout.get("fill-sort-key"),a=[];for(const{feature:c,id:p,index:_,sourceLayerIndex:v}of e){const E=this.layers[0]._featureFilter.needGeometry,C=ph(c,E);if(!this.layers[0]._featureFilter.filter(new _s(this.zoom),C,r))continue;const B=s?s.evaluate(C,{},r,i.availableImages):void 0,O={id:p,properties:c.properties,type:c.type,sourceLayerIndex:v,index:_,geometry:E?C.geometry:yu(c,r,n),patterns:{},sortKey:B};a.push(O)}s&&a.sort((c,p)=>c.sortKey-p.sortKey);for(const c of a){const{geometry:p,index:_,sourceLayerIndex:v}=c;if(this.hasPattern){const E=wg("fill",this.layers,c,this.zoom,i);this.patternFeatures.push(E)}else this.addFeature(c,p,_,r,{},i.availableImages,i.brightness);i.featureIndex.insert(e[_].feature,p,_,v,this.index)}}update(e,i,r,n,s){const a=Object.keys(e).length!==0;a&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,i,a?this.stateDependentLayers:this.layers,r,n,s)}addFeatures(e,i,r,n,s,a){for(const c of this.patternFeatures)this.addFeature(c,c.geometry,c.index,i,r,n,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,f2),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,i,r,n,s,a=[],c){for(const p of vg(i,500)){let _=0;for(const G of p)_+=G.length;const v=this.segments.prepareSegment(_,this.layoutVertexArray,this.indexArray),E=v.vertexLength,C=[],B=[];for(const G of p){if(G.length===0)continue;G!==p[0]&&B.push(C.length/2);const q=this.segments2.prepareSegment(G.length,this.layoutVertexArray,this.indexArray2),X=q.vertexLength;this.layoutVertexArray.emplaceBack(G[0].x,G[0].y),this.indexArray2.emplaceBack(X+G.length-1,X),C.push(G[0].x),C.push(G[0].y);for(let $=1;$<G.length;$++)this.layoutVertexArray.emplaceBack(G[$].x,G[$].y),this.indexArray2.emplaceBack(X+$-1,X+$),C.push(G[$].x),C.push(G[$].y);q.vertexLength+=G.length,q.primitiveLength+=G.length}const O=vm(C,B);for(let G=0;G<O.length;G+=3)this.indexArray.emplaceBack(E+O[G],E+O[G+1],E+O[G+2]);v.vertexLength+=_,v.primitiveLength+=O.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,s,a,n,c)}}Mi(bm,"FillBucket",{omit:["layers","patternFeatures"]});const T2=new as({"fill-sort-key":new Gi(xt.layout_fill["fill-sort-key"]),visibility:new ri(xt.layout_fill.visibility)});var E2={paint:new as({"fill-antialias":new ri(xt.paint_fill["fill-antialias"]),"fill-opacity":new Gi(xt.paint_fill["fill-opacity"]),"fill-color":new Gi(xt.paint_fill["fill-color"]),"fill-outline-color":new Gi(xt.paint_fill["fill-outline-color"]),"fill-translate":new ri(xt.paint_fill["fill-translate"]),"fill-translate-anchor":new ri(xt.paint_fill["fill-translate-anchor"]),"fill-pattern":new Gi(xt.paint_fill["fill-pattern"]),"fill-emissive-strength":new ri(xt.paint_fill["fill-emissive-strength"])}),layout:T2};const M2=an([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),S2=an([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),I2=an([{name:"a_centroid_pos",components:2,type:"Uint16"}]),C2=an([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),k2=an([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:D2}=M2;var wm={},P2=pn,_1=id;function id(t,e,i,r,n){this.properties={},this.extent=i,this.type=0,this._pbf=t,this._geometry=-1,this._keys=r,this._values=n,t.readFields(z2,this,e)}function z2(t,e,i){t==1?e.id=i.readVarint():t==2?function(r,n){for(var s=r.readVarint()+r.pos;r.pos<s;){var a=n._keys[r.readVarint()],c=n._values[r.readVarint()];n.properties[a]=c}}(i,e):t==3?e.type=i.readVarint():t==4&&(e._geometry=i.pos)}function B2(t){for(var e,i,r=0,n=0,s=t.length,a=s-1;n<s;a=n++)r+=((i=t[a]).x-(e=t[n]).x)*(e.y+i.y);return r}id.types=["Unknown","Point","LineString","Polygon"],id.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,i=t.readVarint()+t.pos,r=1,n=0,s=0,a=0,c=[];t.pos<i;){if(n<=0){var p=t.readVarint();r=7&p,n=p>>3}if(n--,r===1||r===2)s+=t.readSVarint(),a+=t.readSVarint(),r===1&&(e&&c.push(e),e=[]),e.push(new P2(s,a));else{if(r!==7)throw new Error("unknown command "+r);e&&e.push(e[0].clone())}}return e&&c.push(e),c},id.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,i=1,r=0,n=0,s=0,a=1/0,c=-1/0,p=1/0,_=-1/0;t.pos<e;){if(r<=0){var v=t.readVarint();i=7&v,r=v>>3}if(r--,i===1||i===2)(n+=t.readSVarint())<a&&(a=n),n>c&&(c=n),(s+=t.readSVarint())<p&&(p=s),s>_&&(_=s);else if(i!==7)throw new Error("unknown command "+i)}return[a,p,c,_]},id.prototype.toGeoJSON=function(t,e,i){var r,n,s=this.extent*Math.pow(2,i),a=this.extent*t,c=this.extent*e,p=this.loadGeometry(),_=id.types[this.type];function v(B){for(var O=0;O<B.length;O++){var G=B[O];B[O]=[360*(G.x+a)/s-180,360/Math.PI*Math.atan(Math.exp((180-360*(G.y+c)/s)*Math.PI/180))-90]}}switch(this.type){case 1:var E=[];for(r=0;r<p.length;r++)E[r]=p[r][0];v(p=E);break;case 2:for(r=0;r<p.length;r++)v(p[r]);break;case 3:for(p=function(B){var O=B.length;if(O<=1)return[B];for(var G,q,X=[],$=0;$<O;$++){var re=B2(B[$]);re!==0&&(q===void 0&&(q=re<0),q===re<0?(G&&X.push(G),G=[B[$]]):G.push(B[$]))}return G&&X.push(G),X}(p),r=0;r<p.length;r++)for(n=0;n<p[r].length;n++)v(p[r][n])}p.length===1?p=p[0]:_="Multi"+_;var C={type:"Feature",geometry:{type:_,coordinates:p},properties:this.properties};return"id"in this&&(C.id=this.id),C};var L2=_1,g1=y1;function y1(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(R2,this,e),this.length=this._features.length}function R2(t,e,i){t===15?e.version=i.readVarint():t===1?e.name=i.readString():t===5?e.extent=i.readVarint():t===2?e._features.push(i.pos):t===3?e._keys.push(i.readString()):t===4&&e._values.push(function(r){for(var n=null,s=r.readVarint()+r.pos;r.pos<s;){var a=r.readVarint()>>3;n=a===1?r.readString():a===2?r.readFloat():a===3?r.readDouble():a===4?r.readVarint64():a===5?r.readVarint():a===6?r.readSVarint():a===7?r.readBoolean():null}return n}(i))}y1.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new L2(this._pbf,e,this.extent,this._keys,this._values)};var F2=g1;function O2(t,e,i){if(t===3){var r=new F2(i,i.readVarint()+i.pos);r.length&&(e[r.name]=r)}}var Tg=wm.VectorTile=function(t,e){this.layers=t.readFields(O2,{},e)},Tm=wm.VectorTileFeature=_1;function Em(t,e,i,r){const n=[],s=r===0?(a,c,p,_,v,E)=>{a.push(new ct(E,p+(E-c)/(_-c)*(v-p)))}:(a,c,p,_,v,E)=>{a.push(new ct(c+(E-p)/(v-p)*(_-c),E))};for(const a of t){const c=[];for(const p of a){if(p.length<=2)continue;const _=[];for(let C=0;C<p.length-1;C++){const B=p[C].x,O=p[C].y,G=p[C+1].x,q=p[C+1].y,X=r===0?B:O,$=r===0?G:q;X<e?$>e&&s(_,B,O,G,q,e):X>i?$<i&&s(_,B,O,G,q,i):_.push(p[C]),$<e&&X>=e&&s(_,B,O,G,q,e),$>i&&X<=i&&s(_,B,O,G,q,i)}let v=p[p.length-1];const E=r===0?v.x:v.y;E>=e&&E<=i&&_.push(v),_.length&&(v=_[_.length-1],_[0].x===v.x&&_[0].y===v.y||_.push(_[0]),c.push(_))}c.length&&n.push(c)}return n}wm.VectorTileLayer=g1;class x1{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const r=e[i];this._stringToNumber[r]=i,this._numberToString[i]=r}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}var N2={read:function(t,e,i,r,n){var s,a,c=8*n-r-1,p=(1<<c)-1,_=p>>1,v=-7,E=i?n-1:0,C=i?-1:1,B=t[e+E];for(E+=C,s=B&(1<<-v)-1,B>>=-v,v+=c;v>0;s=256*s+t[e+E],E+=C,v-=8);for(a=s&(1<<-v)-1,s>>=-v,v+=r;v>0;a=256*a+t[e+E],E+=C,v-=8);if(s===0)s=1-_;else{if(s===p)return a?NaN:1/0*(B?-1:1);a+=Math.pow(2,r),s-=_}return(B?-1:1)*a*Math.pow(2,s-r)},write:function(t,e,i,r,n,s){var a,c,p,_=8*s-n-1,v=(1<<_)-1,E=v>>1,C=n===23?Math.pow(2,-24)-Math.pow(2,-77):0,B=r?0:s-1,O=r?1:-1,G=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(c=isNaN(e)?1:0,a=v):(a=Math.floor(Math.log(e)/Math.LN2),e*(p=Math.pow(2,-a))<1&&(a--,p*=2),(e+=a+E>=1?C/p:C*Math.pow(2,1-E))*p>=2&&(a++,p/=2),a+E>=v?(c=0,a=v):a+E>=1?(c=(e*p-1)*Math.pow(2,n),a+=E):(c=e*Math.pow(2,E-1)*Math.pow(2,n),a=0));n>=8;t[i+B]=255&c,B+=O,c/=256,n-=8);for(a=a<<n|c,_+=n;_>0;t[i+B]=255&a,B+=O,a/=256,_-=8);t[i+B-O]|=128*G}},v1=Es,Mm=N2;function Es(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Es.Varint=0,Es.Fixed64=1,Es.Bytes=2,Es.Fixed32=5;var Eg=4294967296,b1=1/Eg,w1=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Gu(t){return t.type===Es.Bytes?t.readVarint()+t.pos:t.pos+1}function rd(t,e,i){return i?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function T1(t,e,i){var r=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(r);for(var n=i.pos-1;n>=t;n--)i.buf[n+r]=i.buf[n]}function U2(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function V2(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function j2(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function G2(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function Z2(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function q2(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function Q2(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function H2(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function W2(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function Sm(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function nd(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function E1(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}Es.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var r=this.readVarint(),n=r>>3,s=this.pos;this.type=7&r,t(n,e,this),this.pos===s&&this.skip(r)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=Sm(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=E1(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=Sm(this.buf,this.pos)+Sm(this.buf,this.pos+4)*Eg;return this.pos+=8,t},readSFixed64:function(){var t=Sm(this.buf,this.pos)+E1(this.buf,this.pos+4)*Eg;return this.pos+=8,t},readFloat:function(){var t=Mm.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Mm.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,i,r=this.buf;return e=127&(i=r[this.pos++]),i<128?e:(e|=(127&(i=r[this.pos++]))<<7,i<128?e:(e|=(127&(i=r[this.pos++]))<<14,i<128?e:(e|=(127&(i=r[this.pos++]))<<21,i<128?e:function(n,s,a){var c,p,_=a.buf;if(c=(112&(p=_[a.pos++]))>>4,p<128||(c|=(127&(p=_[a.pos++]))<<3,p<128)||(c|=(127&(p=_[a.pos++]))<<10,p<128)||(c|=(127&(p=_[a.pos++]))<<17,p<128)||(c|=(127&(p=_[a.pos++]))<<24,p<128)||(c|=(1&(p=_[a.pos++]))<<31,p<128))return rd(n,c,s);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=r[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&w1?function(i,r,n){return w1.decode(i.subarray(r,n))}(this.buf,e,t):function(i,r,n){for(var s="",a=r;a<n;){var c,p,_,v=i[a],E=null,C=v>239?4:v>223?3:v>191?2:1;if(a+C>n)break;C===1?v<128&&(E=v):C===2?(192&(c=i[a+1]))==128&&(E=(31&v)<<6|63&c)<=127&&(E=null):C===3?(p=i[a+2],(192&(c=i[a+1]))==128&&(192&p)==128&&((E=(15&v)<<12|(63&c)<<6|63&p)<=2047||E>=55296&&E<=57343)&&(E=null)):C===4&&(p=i[a+2],_=i[a+3],(192&(c=i[a+1]))==128&&(192&p)==128&&(192&_)==128&&((E=(15&v)<<18|(63&c)<<12|(63&p)<<6|63&_)<=65535||E>=1114112)&&(E=null)),E===null?(E=65533,C=1):E>65535&&(E-=65536,s+=String.fromCharCode(E>>>10&1023|55296),E=56320|1023&E),s+=String.fromCharCode(E),a+=C}return s}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==Es.Bytes)return t.push(this.readVarint(e));var i=Gu(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==Es.Bytes)return t.push(this.readSVarint());var e=Gu(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Es.Bytes)return t.push(this.readBoolean());var e=Gu(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Es.Bytes)return t.push(this.readFloat());var e=Gu(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Es.Bytes)return t.push(this.readDouble());var e=Gu(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Es.Bytes)return t.push(this.readFixed32());var e=Gu(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Es.Bytes)return t.push(this.readSFixed32());var e=Gu(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Es.Bytes)return t.push(this.readFixed64());var e=Gu(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Es.Bytes)return t.push(this.readSFixed64());var e=Gu(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===Es.Varint)for(;this.buf[this.pos++]>127;);else if(e===Es.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Es.Fixed32)this.pos+=4;else{if(e!==Es.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),nd(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),nd(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),nd(this.buf,-1&t,this.pos),nd(this.buf,Math.floor(t*b1),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),nd(this.buf,-1&t,this.pos),nd(this.buf,Math.floor(t*b1),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,i){var r,n;if(e>=0?(r=e%4294967296|0,n=e/4294967296|0):(n=~(-e/4294967296),4294967295^(r=~(-e%4294967296))?r=r+1|0:(r=0,n=n+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),function(s,a,c){c.buf[c.pos++]=127&s|128,s>>>=7,c.buf[c.pos++]=127&s|128,s>>>=7,c.buf[c.pos++]=127&s|128,s>>>=7,c.buf[c.pos++]=127&s|128,c.buf[c.pos]=127&(s>>>=7)}(r,0,i),function(s,a){var c=(7&s)<<4;a.buf[a.pos++]|=c|((s>>>=3)?128:0),s&&(a.buf[a.pos++]=127&s|((s>>>=7)?128:0),s&&(a.buf[a.pos++]=127&s|((s>>>=7)?128:0),s&&(a.buf[a.pos++]=127&s|((s>>>=7)?128:0),s&&(a.buf[a.pos++]=127&s|((s>>>=7)?128:0),s&&(a.buf[a.pos++]=127&s)))))}(n,i)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(r,n,s){for(var a,c,p=0;p<n.length;p++){if((a=n.charCodeAt(p))>55295&&a<57344){if(!c){a>56319||p+1===n.length?(r[s++]=239,r[s++]=191,r[s++]=189):c=a;continue}if(a<56320){r[s++]=239,r[s++]=191,r[s++]=189,c=a;continue}a=c-55296<<10|a-56320|65536,c=null}else c&&(r[s++]=239,r[s++]=191,r[s++]=189,c=null);a<128?r[s++]=a:(a<2048?r[s++]=a>>6|192:(a<65536?r[s++]=a>>12|224:(r[s++]=a>>18|240,r[s++]=a>>12&63|128),r[s++]=a>>6&63|128),r[s++]=63&a|128)}return s}(this.buf,t,this.pos);var i=this.pos-e;i>=128&&T1(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),Mm.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Mm.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var r=this.pos-i;r>=128&&T1(i,r,this),this.pos=i-1,this.writeVarint(r),this.pos+=r},writeMessage:function(t,e,i){this.writeTag(t,Es.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,U2,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,V2,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,Z2,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,j2,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,G2,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,q2,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,Q2,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,H2,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,W2,e)},writeBytesField:function(t,e){this.writeTag(t,Es.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,Es.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,Es.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,Es.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,Es.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,Es.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,Es.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,Es.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,Es.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,Es.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};var Im=_r(v1);const X2=["tile","layer","source","sourceLayer","state"];class M1{constructor(e,i,r,n,s){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=r,this._y=n,this.properties=e.properties,this.id=s}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(const i of X2)this[i]!==void 0&&(e[i]=this[i]);return e}}class Y2{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,i,r){const n=String(i);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][n]=this.stateChanges[e][n]||{},Pt(this.stateChanges[e][n],r),this.deletedStates[e]===null){this.deletedStates[e]={};for(const s in this.state[e])s!==n&&(this.deletedStates[e][s]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][n]===null){this.deletedStates[e][n]={};for(const s in this.state[e][n])r[s]||(this.deletedStates[e][n][s]=null)}else for(const s in r)this.deletedStates[e]&&this.deletedStates[e][n]&&this.deletedStates[e][n][s]===null&&delete this.deletedStates[e][n][s]}removeFeatureState(e,i,r){if(this.deletedStates[e]===null)return;const n=String(i);if(this.deletedStates[e]=this.deletedStates[e]||{},r&&i!==void 0)this.deletedStates[e][n]!==null&&(this.deletedStates[e][n]=this.deletedStates[e][n]||{},this.deletedStates[e][n][r]=null);else if(i!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][n])for(r in this.deletedStates[e][n]={},this.stateChanges[e][n])this.deletedStates[e][n][r]=null;else this.deletedStates[e][n]=null;else this.deletedStates[e]=null}getState(e,i){const r=String(i),n=Pt({},(this.state[e]||{})[r],(this.stateChanges[e]||{})[r]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const s=this.deletedStates[e][i];if(s===null)return{};for(const a in s)delete n[a]}return n}initializeTileState(e,i){e.setFeatureState(this.state,i)}coalesceChanges(e,i){const r={};for(const n in this.stateChanges){this.state[n]=this.state[n]||{};const s={};for(const a in this.stateChanges[n])this.state[n][a]||(this.state[n][a]={}),Pt(this.state[n][a],this.stateChanges[n][a]),s[a]=this.state[n][a];r[n]=s}for(const n in this.deletedStates){this.state[n]=this.state[n]||{};const s={};if(this.deletedStates[n]===null)for(const a in this.state[n])s[a]={},this.state[n][a]={};else for(const a in this.deletedStates[n]){if(this.deletedStates[n][a]===null)this.state[n][a]={};else if(this.state[n][a])for(const c of Object.keys(this.deletedStates[n][a]))delete this.state[n][a][c];s[a]=this.state[n][a]}r[n]=r[n]||{},Pt(r[n],s)}if(this.stateChanges={},this.deletedStates={},Object.keys(r).length!==0)for(const n in e)e[n].setFeatureState(r,i)}}class S1{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const r=this.toIdx(e,i);return{min:this.minimums[r],max:this.maximums[r]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function I1(t,e,i,r){let n=0,s=Number.MAX_VALUE;for(let a=0;a<3;a++)if(Math.abs(r[a])<1e-15){if(i[a]<t[a]||i[a]>e[a])return null}else{const c=1/r[a];let p=(t[a]-i[a])*c,_=(e[a]-i[a])*c;if(p>_){const v=p;p=_,_=v}if(p>n&&(n=p),_<s&&(s=_),n>s)return null}return n}function C1(t,e,i,r,n,s,a,c,p,_,v){const E=r-t,C=n-e,B=s-i,O=a-t,G=c-e,q=p-i,X=v[1]*q-v[2]*G,$=v[2]*O-v[0]*q,re=v[0]*G-v[1]*O,ne=E*X+C*$+B*re;if(Math.abs(ne)<1e-15)return null;const ie=1/ne,se=_[0]-t,he=_[1]-e,ve=_[2]-i,be=(se*X+he*$+ve*re)*ie;if(be<0||be>1)return null;const De=he*B-ve*C,Ve=ve*E-se*B,je=se*C-he*E,Je=(v[0]*De+v[1]*Ve+v[2]*je)*ie;return Je<0||be+Je>1?null:(O*De+G*Ve+q*je)*ie}function k1(t,e,i){return(t-e)/(i-e)}function D1(t,e,i,r,n,s,a,c,p){const _=1<<i,v=s-r,E=a-n,C=(t+1)/_*v+r,B=(e+0)/_*E+n,O=(e+1)/_*E+n;c[0]=(t+0)/_*v+r,c[1]=B,p[0]=C,p[1]=O}class P1{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(s){const a=Math.ceil(Math.log2(s.dim/8)),c=[];let p=Math.ceil(Math.pow(2,a));const _=1/p,v=(B,O,G,q,X)=>{const $=q?1:0,re=(B+1)*G-$,ne=O*G,ie=(O+1)*G-$;X[0]=B*G,X[1]=ne,X[2]=re,X[3]=ie};let E=new S1(p);const C=[];for(let B=0;B<p*p;B++){v(B%p,Math.floor(B/p),_,!1,C);const O=_h(C[0],C[1],s),G=_h(C[2],C[1],s),q=_h(C[2],C[3],s),X=_h(C[0],C[3],s);E.minimums.push(Math.min(O,G,q,X)),E.maximums.push(Math.max(O,G,q,X)),E.leaves.push(1)}for(c.push(E),p/=2;p>=1;p/=2){const B=c[c.length-1];E=new S1(p);for(let O=0;O<p*p;O++){v(O%p,Math.floor(O/p),2,!0,C);const G=B.getElevation(C[0],C[1]),q=B.getElevation(C[2],C[1]),X=B.getElevation(C[2],C[3]),$=B.getElevation(C[0],C[3]),re=B.isLeaf(C[0],C[1]),ne=B.isLeaf(C[2],C[1]),ie=B.isLeaf(C[2],C[3]),se=B.isLeaf(C[0],C[3]),he=Math.min(G.min,q.min,X.min,$.min),ve=Math.max(G.max,q.max,X.max,$.max),be=re&&ne&&ie&&se;E.maximums.push(ve),E.minimums.push(he),E.leaves.push(ve-he<=5&&be?1:0)}c.push(E)}return c}(this.dem),r=i.length-1,n=i[r];this._addNode(n.minimums[0],n.maximums[0],n.leaves[0]),this._construct(i,0,0,r,0)}raycastRoot(e,i,r,n,s,a,c=1){return I1([e,i,-100],[r,n,this.maximums[0]*c],s,a)}raycast(e,i,r,n,s,a,c=1){if(!this.nodeCount)return null;const p=this.raycastRoot(e,i,r,n,s,a,c);if(p==null)return null;const _=[],v=[],E=[],C=[],B=[{idx:0,t:p,nodex:0,nodey:0,depth:0}];for(;B.length>0;){const{idx:O,t:G,nodex:q,nodey:X,depth:$}=B.pop();if(this.leaves[O]){D1(q,X,$,e,i,r,n,E,C);const ne=1<<$,ie=(q+0)/ne,se=(q+1)/ne,he=(X+0)/ne,ve=(X+1)/ne,be=_h(ie,he,this.dem)*c,De=_h(se,he,this.dem)*c,Ve=_h(se,ve,this.dem)*c,je=_h(ie,ve,this.dem)*c,Je=C1(E[0],E[1],be,C[0],E[1],De,C[0],C[1],Ve,s,a),Fe=C1(C[0],C[1],Ve,E[0],C[1],je,E[0],E[1],be,s,a),nt=Math.min(Je!==null?Je:Number.MAX_VALUE,Fe!==null?Fe:Number.MAX_VALUE);if(nt!==Number.MAX_VALUE)return nt;{const At=me.scaleAndAdd([],s,a,G);if(z1(be,De,je,Ve,k1(At[0],E[0],C[0]),k1(At[1],E[1],C[1]))>=At[2])return G}continue}let re=0;for(let ne=0;ne<this._siblingOffset.length;ne++){D1((q<<1)+this._siblingOffset[ne][0],(X<<1)+this._siblingOffset[ne][1],$+1,e,i,r,n,E,C),E[2]=-100,C[2]=this.maximums[this.childOffsets[O]+ne]*c;const ie=I1(E,C,s,a);if(ie!=null){const se=ie;_[ne]=se;let he=!1;for(let ve=0;ve<re&&!he;ve++)se>=_[v[ve]]&&(v.splice(ve,0,ne),he=!0);he||(v[re]=ne),re++}}for(let ne=0;ne<re;ne++){const ie=v[ne];B.push({idx:this.childOffsets[O]+ie,t:_[ie],nodex:(q<<1)+this._siblingOffset[ie][0],nodey:(X<<1)+this._siblingOffset[ie][1],depth:$+1})}}return null}_addNode(e,i,r){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(r),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,r,n,s){if(e[n].isLeaf(i,r)===1)return;this.childOffsets[s]||(this.childOffsets[s]=this.nodeCount);const a=n-1,c=e[a];let p=0,_=0;for(let v=0;v<this._siblingOffset.length;v++){const E=2*i+this._siblingOffset[v][0],C=2*r+this._siblingOffset[v][1],B=c.getElevation(E,C),O=c.isLeaf(E,C),G=this._addNode(B.min,B.max,O);O&&(p|=1<<v),_||(_=G)}for(let v=0;v<this._siblingOffset.length;v++)p&1<<v||this._construct(e,2*i+this._siblingOffset[v][0],2*r+this._siblingOffset[v][1],a,_+v)}}function z1(t,e,i,r,n,s){return Ki(Ki(t,i,s),Ki(e,r,s),n)}function _h(t,e,i){const r=i.dim,n=Ai(t*r-.5,0,r-1),s=Ai(e*r-.5,0,r-1),a=Math.floor(n),c=Math.floor(s),p=Math.min(a+1,r-1),_=Math.min(c+1,r-1);return z1(i.get(a,c),i.get(p,c),i.get(a,_),i.get(p,_),n-a,s-c)}const K2={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function J2(t,e,i){return(256*t*256+256*e+i)/10-1e4}function $2(t,e,i){return 256*t+e+i/256-32768}class Cm{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,r,n=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(r&&r!=="mapbox"&&r!=="terrarium")return Be(`"${r}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const s=this.dim=i.height-2,a=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.floatView=new Float32Array(i.data.buffer),this.borderReady=n,this._modifiedForSources={},!n){for(let p=0;p<s;p++)a[this._idx(-1,p)]=a[this._idx(0,p)],a[this._idx(s,p)]=a[this._idx(s-1,p)],a[this._idx(p,-1)]=a[this._idx(p,0)],a[this._idx(p,s)]=a[this._idx(p,s-1)];a[this._idx(-1,-1)]=a[this._idx(0,0)],a[this._idx(s,-1)]=a[this._idx(s-1,0)],a[this._idx(-1,s)]=a[this._idx(0,s-1)],a[this._idx(s,s)]=a[this._idx(s-1,s-1)]}const c=r==="terrarium"?$2:J2;for(let p=0;p<a.length;++p){const _=4*p;this.floatView[p]=c(this.pixels[_],this.pixels[_+1],this.pixels[_+2])}this._timestamp=Wi.now()}_buildQuadTree(){this._tree=new P1(this)}get(e,i,r=!1){r&&(e=Ai(e,-1,this.dim),i=Ai(i,-1,this.dim));const n=this._idx(e,i);return this.floatView[n]}set(e,i,r){const n=this._idx(e,i),s=this.floatView[n];return this.floatView[n]=r,r-s}static getUnpackVector(e){return K2[e]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}static pack(e,i){const r=[0,0,0,0],n=Cm.getUnpackVector(i);let s=Math.floor((e+n[3])/n[2]);return r[2]=s%256,s=Math.floor(s/256),r[1]=s%256,s=Math.floor(s/256),r[0]=s,r}getPixels(){return new h1({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,r){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let n=i*this.dim,s=i*this.dim+this.dim,a=r*this.dim,c=r*this.dim+this.dim;switch(i){case-1:n=s-1;break;case 1:s=n+1}switch(r){case-1:a=c-1;break;case 1:c=a+1}const p=-i*this.dim,_=-r*this.dim;for(let v=a;v<c;v++)for(let E=n;E<s;E++){const C=4*this._idx(E,v),B=4*this._idx(E+p,v+_);this.pixels[C+0]=e.pixels[B+0],this.pixels[C+1]=e.pixels[B+1],this.pixels[C+2]=e.pixels[B+2],this.pixels[C+3]=e.pixels[B+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Mi(Cm,"DEMData"),Mi(P1,"DemMinMaxQuadTree",{omit:["dem"]});class e3{isDataAvailableAtPoint(e){const i=this._source();if(this.isUsingMockSource()||!i||e.y<0||e.y>1)return!1;const r=i.getSource().maxzoom,n=1<<r,s=Math.floor(e.x),a=Math.floor((e.x-s)*n),c=Math.floor(e.y*n),p=this.findDEMTileFor(new ui(r,s,r,a,c));return!(!p||!p.dem)}getAtPointOrZero(e,i=0){return this.getAtPoint(e,i)||0}getAtPoint(e,i,r=!0){if(this.isUsingMockSource())return null;i==null&&(i=null);const n=this._source();if(!n||e.y<0||e.y>1)return i;const s=n.getSource().maxzoom,a=1<<s,c=Math.floor(e.x),p=e.x-c,_=new ui(s,c,s,Math.floor(p*a),Math.floor(e.y*a)),v=this.findDEMTileFor(_);if(!v||!v.dem)return i;const E=v.dem,C=1<<v.tileID.canonical.z,B=(p*C-v.tileID.canonical.x)*E.dim,O=(e.y*C-v.tileID.canonical.y)*E.dim,G=Math.floor(B),q=Math.floor(O);return(r?this.exaggeration():1)*Ki(Ki(E.get(G,q),E.get(G,q+1),O-q),Ki(E.get(G+1,q),E.get(G+1,q+1),O-q),B-G)}getAtTileOffset(e,i,r){const n=1<<e.canonical.z;return this.getAtPointOrZero(new Wr(e.wrap+(e.canonical.x+i/Mt)/n,(e.canonical.y+r/Mt)/n))}getAtTileOffsetFunc(e,i,r,n){return s=>{const a=this.getAtTileOffset(e,s.x,s.y),c=n.upVector(e.canonical,s.x,s.y),p=n.upVectorScale(e.canonical,i,r).metersToTile;return me.scale(c,c,a*p),c}}getForTilePoints(e,i,r,n){if(this.isUsingMockSource())return!1;const s=sd.create(this,e,n);return!!s&&(i.forEach(a=>{a[2]=this.exaggeration()*s.getElevationAt(a[0],a[1],r)}),!0)}getMinMaxForTile(e){if(this.isUsingMockSource())return null;const i=this.findDEMTileFor(e);if(!i||!i.dem)return null;const r=i.dem.tree,n=i.tileID,s=1<<e.canonical.z-n.canonical.z;let a=e.canonical.x/s-n.canonical.x,c=e.canonical.y/s-n.canonical.y,p=0;for(let _=0;_<e.canonical.z-n.canonical.z&&!r.leaves[p];_++){a*=2,c*=2;const v=2*Math.floor(c)+Math.floor(a);p=r.childOffsets[p]+v,a%=1,c%=1}return{min:this.exaggeration()*r.minimums[p],max:this.exaggeration()*r.maximums[p]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(e,i,r){throw new Error("Pure virtual method called.")}pointCoordinate(e){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(e){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const e=this.visibleDemTiles;if(e.length===0)return null;let i=!1,r=Number.MAX_VALUE,n=Number.MIN_VALUE;for(const s of e){const a=this.getMinMaxForTile(s.tileID);a&&(r=Math.min(r,a.min),n=Math.max(n,a.max),i=!0)}return i?{min:r,max:n}:null}}class sd{constructor(e,i,r){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=r}static create(e,i,r){const n=r||e.findDEMTileFor(i);if(!n||!n.dem)return;const s=n.dem,a=n.tileID,c=1<<i.canonical.z-a.canonical.z;return new sd(n,s.dim/Mt/c,[(i.canonical.x/c-a.canonical.x)*s.dim,(i.canonical.y/c-a.canonical.y)*s.dim])}tileCoordToPixel(e,i){const r=i*this._scale+this._offset[1],n=Math.floor(e*this._scale+this._offset[0]),s=Math.floor(r);return new ct(n,s)}getElevationAt(e,i,r,n){const s=e*this._scale+this._offset[0],a=i*this._scale+this._offset[1],c=Math.floor(s),p=Math.floor(a),_=this._dem;return n=!!n,r?Ki(Ki(_.get(c,p,n),_.get(c,p+1,n),a-p),Ki(_.get(c+1,p,n),_.get(c+1,p+1,n),a-p),s-c):_.get(c,p,n)}getElevationAtPixel(e,i,r){return this._dem.get(e,i,!!r)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*jn(1,e)*this._dem.stride}}class Mg{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new eh(Mt,16,0),this.featureIndexArray=new Kd,this.promoteId=i}insert(e,i,r,n,s,a=0){const c=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(r,n,s,a);const p=this.grid;for(let _=0;_<i.length;_++){const v=i[_],E=[1/0,1/0,-1/0,-1/0];for(let C=0;C<v.length;C++){const B=v[C];E[0]=Math.min(E[0],B.x),E[1]=Math.min(E[1],B.y),E[2]=Math.max(E[2],B.x),E[3]=Math.max(E[3],B.y)}E[0]<Mt&&E[1]<Mt&&E[2]>=0&&E[3]>=0&&p.insert(c,E[0],E[1],E[2],E[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Tg(new Im(this.rawTileData)).layers,this.sourceLayerCoder=new x1(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i,r,n){this.loadVTLayers();const s=e.params||{},a=mo(s.filter),c=e.tileResult,p=e.transform,_=c.bufferedTilespaceBounds,v=this.grid.query(_.min.x,_.min.y,_.max.x,_.max.y,(O,G,q,X)=>r1(c.bufferedTilespaceGeometry,O,G,q,X));v.sort(t3);let E=null;p.elevation&&v.length>0&&(E=sd.create(p.elevation,this.tileID));const C={};let B;for(let O=0;O<v.length;O++){const G=v[O];if(G===B)continue;B=G;const q=this.featureIndexArray.get(G);let X=null;this.loadMatchingFeature(C,q,a,s.layers,s.availableImages,i,r,n,($,re,ne,ie=0)=>(X||(X=yu($,this.tileID.canonical,e.tileTransform)),re.queryIntersectsFeature(c,$,ne,X,this.z,e.transform,e.pixelPosMatrix,E,ie)))}return C}loadMatchingFeature(e,i,r,n,s,a,c,p,_){const{featureIndex:v,bucketIndex:E,sourceLayerIndex:C,layoutVertexArrayOffset:B}=i,O=this.bucketLayerIDs[E];if(n&&!function($,re){for(let ne=0;ne<$.length;ne++)if(re.indexOf($[ne])>=0)return!0;return!1}(n,O))return;const G=this.sourceLayerCoder.decode(C),q=this.vtLayers[G].feature(v);if(r.needGeometry){const $=ph(q,!0);if(!r.filter(new _s(this.tileID.overscaledZ),$,this.tileID.canonical))return}else if(!r.filter(new _s(this.tileID.overscaledZ),q))return;const X=this.getId(q,G);for(let $=0;$<O.length;$++){const re=O[$];if(n&&n.indexOf(re)<0)continue;const ne=a[re];if(!ne)continue;let ie={};X!==void 0&&p&&(ie=p.getState(ne.sourceLayer||"_geojsonTileLayer",X));const se=Pt({},c[re]);se.paint=B1(se.paint,ne.paint,q,ie,s),se.layout=B1(se.layout,ne.layout,q,ie,s);const he=!_||_(q,ne,ie,B);if(!he)continue;const ve=new M1(q,this.z,this.x,this.y,X);ve.layer=se;let be=e[re];be===void 0&&(be=e[re]=[]),be.push({featureIndex:v,feature:ve,intersectionZ:he})}}lookupSymbolFeatures(e,i,r,n,s,a,c,p){const _={};this.loadVTLayers();const v=mo(s);for(const E of e)this.loadMatchingFeature(_,{bucketIndex:r,sourceLayerIndex:n,featureIndex:E,layoutVertexArrayOffset:0},v,a,c,p,i);return _}loadFeature(e){const{featureIndex:i,sourceLayerIndex:r}=e;this.loadVTLayers();const n=this.sourceLayerCoder.decode(r),s=this.vtFeatures[n];if(s[i])return s[i];const a=this.vtLayers[n].feature(i);return s[i]=a,a}hasLayer(e){for(const i of this.bucketLayerIDs)for(const r of i)if(e===r)return!0;return!1}getId(e,i){let r=e.id;if(this.promoteId){const n=typeof this.promoteId=="string"?this.promoteId:this.promoteId[i];n!=null&&(r=e.properties[n]),typeof r=="boolean"&&(r=Number(r))}return r}}function B1(t,e,i,r,n){return Cs(t,(s,a)=>{const c=e instanceof uu?e.get(a):null;return c&&c.evaluate?c.evaluate(i,r,n):c})}function t3(t,e){return e-t}Mi(Mg,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const i3=an([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),r3=an([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),n3=an([{name:"a_projected_pos",components:4,type:"Float32"}],4);an([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const s3=an([{name:"a_z_offset",components:1,type:"Float32"}],4),o3=an([{name:"a_texb",components:2,type:"Uint16"}]),a3=an([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),l3=an([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);an([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const L1=an([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),A3=an([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);an([{name:"triangle",components:3,type:"Uint16"}]),an([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),an([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),an([{type:"Float32",name:"offsetX"}]),an([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var va=24;const eu=128;function Sg(t,e){const{expression:i}=e;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new _s(t+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:r,interpolationType:n}=i;let s=0;for(;s<r.length&&r[s]<=t;)s++;s=Math.max(0,s-1);let a=s;for(;a<r.length&&r[a]<t+1;)a++;a=Math.min(r.length-1,a);const c=r[s],p=r[a];return i.kind==="composite"?{kind:"composite",minZoom:c,maxZoom:p,interpolationType:n}:{kind:"camera",minZoom:c,maxZoom:p,minSize:i.evaluate(new _s(c)),maxSize:i.evaluate(new _s(p)),interpolationType:n}}}function z0(t,{uSize:e,uSizeT:i},{lowerSize:r,upperSize:n}){return t.kind==="source"?r/eu:t.kind==="composite"?Ki(r/eu,n/eu,i):e}function xu(t,e){let i=0,r=0;if(t.kind==="constant")r=t.layoutSize;else if(t.kind!=="source"){const{interpolationType:n,minZoom:s,maxZoom:a}=t,c=n?Ai($r.interpolationFactor(n,e,s,a),0,1):0;t.kind==="camera"?r=Ki(t.minSize,t.maxSize,c):i=c}return{uSizeT:i,uSize:r}}var c3=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:eu,evaluateSizeForFeature:z0,evaluateSizeForZoom:xu,getSizeData:Sg});function u3(t,e,i){return t.sections.forEach(r=>{r.text=function(n,s,a){const c=s.layout.get("text-transform").evaluate(a,{});return c==="uppercase"?n=n.toLocaleUpperCase():c==="lowercase"&&(n=n.toLocaleLowerCase()),wA.applyArabicShaping&&(n=wA.applyArabicShaping(n)),n}(r.text,e,i)}),t}const B0={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function h3(t){return t==="︶"||t==="﹈"||t==="︸"||t==="﹄"||t==="﹂"||t==="︾"||t==="︼"||t==="︺"||t==="︘"||t==="﹀"||t==="︐"||t==="︓"||t==="︔"||t==="｀"||t==="￣"||t==="︑"||t==="︒"}function f3(t){return t==="︵"||t==="﹇"||t==="︷"||t==="﹃"||t==="﹁"||t==="︽"||t==="︻"||t==="︹"||t==="︗"||t==="︿"}const Ig=3;function d3(t,e,i){e.glyphs=[],t===1&&i.readMessage(p3,e)}function p3(t,e,i){if(t===3){const{id:r,bitmap:n,width:s,height:a,left:c,top:p,advance:_}=i.readMessage(m3,{});e.glyphs.push({id:r,bitmap:new ju({width:s+2*Ig,height:a+2*Ig},n),metrics:{width:s,height:a,left:c,top:p,advance:_}})}else t===4?e.ascender=i.readSVarint():t===5&&(e.descender=i.readSVarint())}function m3(t,e,i){t===1?e.id=i.readVarint():t===2?e.bitmap=i.readBytes():t===3?e.width=i.readVarint():t===4?e.height=i.readVarint():t===5?e.left=i.readSVarint():t===6?e.top=i.readSVarint():t===7&&(e.advance=i.readVarint())}const R1=Ig,Ms={horizontal:1,vertical:2,horizontalOnly:3},F1=-17;class L0{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,i){const r=new L0;return r.scale=e||1,r.fontStack=i,r}static forImage(e){const i=new L0;return i.imageName=e,i}}class od{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i){const r=new od;for(let n=0;n<e.sections.length;n++){const s=e.sections[n];s.image?r.addImageSection(s):r.addTextSection(s,i)}return r}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(i,r){let n="";for(let s=0;s<i.length;s++){const a=i.charCodeAt(s+1)||null,c=i.charCodeAt(s-1)||null;n+=!r&&(a&&Bd(a)&&!B0[i[s+1]]||c&&Bd(c)&&!B0[i[s-1]])||!B0[i[s]]?i[s]:B0[i[s]]}return n}(this.text,e)}trim(){let e=0;for(let r=0;r<this.text.length&&km[this.text.charCodeAt(r)];r++)e++;let i=this.text.length;for(let r=this.text.length-1;r>=0&&r>=e&&km[this.text.charCodeAt(r)];r--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const r=new od;return r.text=this.text.substring(e,i),r.sectionIndex=this.sectionIndex.slice(e,i),r.sections=this.sections,r}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(L0.forText(e.scale,e.fontStack||i));const r=this.sections.length-1;for(let n=0;n<e.text.length;++n)this.sectionIndex.push(r)}addImageSection(e){const i=e.image?e.image.namePrimary:"";if(i.length===0)return void Be("Can't add FormattedSection with an empty image.");const r=this.getNextImageSectionCharCode();r?(this.text+=String.fromCodePoint(r),this.sections.push(L0.forImage(i)),this.sectionIndex.push(this.sections.length-1)):Be("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Cg(t,e,i,r,n,s,a,c,p,_,v,E,C,B,O){const G=od.fromFeature(t,n);E===Ms.vertical&&G.verticalizePunctuation(C);let q=[];const X=function(se,he,ve,be,De,Ve){if(!se)return[];const je=[],Je=function(vt,rt,lt,wt,It,St){let Bt=0;for(let Ft=0;Ft<vt.length();Ft++){const jt=vt.getSection(Ft);Bt+=O1(vt.getCodePoint(Ft),jt,wt,It,rt,St)}return Bt/Math.max(1,Math.ceil(Bt/lt))}(se,he,ve,be,De,Ve),Fe=se.text.indexOf("​")>=0;let nt=0;for(let vt=0;vt<se.length();vt++){const rt=se.getSection(vt),lt=se.getCodePoint(vt);if(km[lt]||(nt+=O1(lt,rt,be,De,he,Ve)),vt<se.length()-1){const wt=!((At=lt)<11904||!(zi["Bopomofo Extended"](At)||zi.Bopomofo(At)||zi["CJK Compatibility Forms"](At)||zi["CJK Compatibility Ideographs"](At)||zi["CJK Compatibility"](At)||zi["CJK Radicals Supplement"](At)||zi["CJK Strokes"](At)||zi["CJK Symbols and Punctuation"](At)||zi["CJK Unified Ideographs Extension A"](At)||zi["CJK Unified Ideographs"](At)||zi["Enclosed CJK Letters and Months"](At)||zi["Halfwidth and Fullwidth Forms"](At)||zi.Hiragana(At)||zi["Ideographic Description Characters"](At)||zi["Kangxi Radicals"](At)||zi["Katakana Phonetic Extensions"](At)||zi.Katakana(At)||zi["Vertical Forms"](At)||zi["Yi Radicals"](At)||zi["Yi Syllables"](At)));(_3[lt]||wt||rt.imageName)&&je.push(U1(vt+1,nt,Je,je,g3(lt,se.getCodePoint(vt+1),wt&&Fe),!1))}}var At;return V1(U1(se.length(),nt,Je,je,0,!0))}(G,_,s,e,r,B),{processBidirectionalText:$,processStyledBidirectionalText:re}=wA;if($&&G.sections.length===1){const se=$(G.toString(),X);for(const he of se){const ve=new od;ve.text=he,ve.sections=G.sections;for(let be=0;be<he.length;be++)ve.sectionIndex.push(0);q.push(ve)}}else if(re){const se=re(G.text,G.sectionIndex,X);for(const he of se){const ve=new od;ve.text=he[0],ve.sectionIndex=he[1],ve.sections=G.sections,q.push(ve)}}else q=function(se,he){const ve=[],be=se.text;let De=0;for(const Ve of he)ve.push(se.substring(De,Ve)),De=Ve;return De<be.length&&ve.push(se.substring(De,be.length)),ve}(G,X);const ne=[],ie={positionedLines:ne,text:G.toString(),top:v[1],bottom:v[1],left:v[0],right:v[0],writingMode:E,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(se,he,ve,be,De,Ve,je,Je,Fe,nt,At,vt){let rt=0,lt=0,wt=0;const It=Je==="right"?1:Je==="left"?0:.5;let St=!1;for(const fi of De){const di=fi.getSections();for(const vi of di){if(vi.imageName)continue;const bi=he[vi.fontStack];if(bi&&(St=bi.ascender!==void 0&&bi.descender!==void 0,!St))break}if(!St)break}let Bt=0;for(const fi of De){fi.trim();const di=fi.getMaxScale(),vi=(di-1)*va,bi={positionedGlyphs:[],lineOffset:0};se.positionedLines[Bt]=bi;const Ar=bi.positionedGlyphs;let Ni=0;if(!fi.length()){lt+=Ve,++Bt;continue}let rn=0,Vr=0;for(let rr=0;rr<fi.length();rr++){const Hi=fi.getSection(rr),Zr=fi.getSectionIndex(rr),Kr=fi.getCodePoint(rr);let zr=Hi.scale,Gn=null,ao=null,On=null,ds=va,go=0;const lo=!(Fe===Ms.horizontal||!At&&!Cl(Kr)||At&&(km[Kr]||(Ft=Kr,zi.Arabic(Ft)||zi["Arabic Supplement"](Ft)||zi["Arabic Extended-A"](Ft)||zi["Arabic Presentation Forms-A"](Ft)||zi["Arabic Presentation Forms-B"](Ft))));if(Hi.imageName){const vs=be[Hi.imageName];if(!vs)continue;On=Hi.imageName,se.iconsInText=se.iconsInText||!0,ao=vs.paddedRect;const Ln=vs.displaySize;zr=zr*va/vt,Gn={width:Ln[0],height:Ln[1],left:0,top:-R1,advance:lo?Ln[1]:Ln[0],localGlyph:!1},go=St?-Gn.height*zr:F1+di*va-Ln[1]*zr,ds=Gn.advance;const Ua=(lo?Ln[0]:Ln[1])*zr-va*di;Ua>0&&Ua>Ni&&(Ni=Ua)}else{const vs=ve[Hi.fontStack];if(!vs)continue;vs[Kr]&&(ao=vs[Kr]);const Ln=he[Hi.fontStack];if(!Ln)continue;const Ua=Ln.glyphs[Kr];if(!Ua)continue;if(Gn=Ua.metrics,ds=Kr!==8203?va:0,St){const Mu=Ln.ascender!==void 0?Math.abs(Ln.ascender):0,qu=Ln.descender!==void 0?Math.abs(Ln.descender):0,Qu=(Mu+qu)*zr;rn<Qu&&(rn=Qu,Vr=(Mu-qu)/2*zr),go=-Mu*zr}else go=F1+(di-zr)*va}lo?(se.verticalizable=!0,Ar.push({glyph:Kr,imageName:On,x:rt,y:lt+go,vertical:lo,scale:zr,localGlyph:Gn.localGlyph,fontStack:Hi.fontStack,sectionIndex:Zr,metrics:Gn,rect:ao}),rt+=ds*zr+nt):(Ar.push({glyph:Kr,imageName:On,x:rt,y:lt+go,vertical:lo,scale:zr,localGlyph:Gn.localGlyph,fontStack:Hi.fontStack,sectionIndex:Zr,metrics:Gn,rect:ao}),rt+=Gn.advance*zr+nt)}Ar.length!==0&&(wt=Math.max(rt-nt,wt),St?j1(Ar,It,Ni,Vr,Ve*di/2):j1(Ar,It,Ni,0,Ve/2)),rt=0;const cr=Ve*di+Ni;bi.lineOffset=Math.max(Ni,vi),lt+=cr,++Bt}var Ft;const jt=lt,{horizontalAlign:Dt,verticalAlign:Yt}=Dm(je);(function(fi,di,vi,bi,Ar,Ni){const rn=(di-vi)*Ar,Vr=-Ni*bi;for(const cr of fi)for(const rr of cr.positionedGlyphs)rr.x+=rn,rr.y+=Vr})(se.positionedLines,It,Dt,Yt,wt,jt),se.top+=-Yt*jt,se.bottom=se.top+jt,se.left+=-Dt*wt,se.right=se.left+wt,se.hasBaseline=St}(ie,e,i,r,q,a,c,p,E,_,C,O),!function(se){for(const he of se)if(he.positionedGlyphs.length!==0)return!1;return!0}(ne)&&ie}const km={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},_3={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function O1(t,e,i,r,n,s){if(e.imageName){const a=r[e.imageName];return a?a.displaySize[0]*e.scale*va/s+n:0}{const a=i[e.fontStack],c=a&&a.glyphs[t];return c?c.metrics.advance*e.scale+n:0}}function N1(t,e,i,r){const n=Math.pow(t-e,2);return r?t<e?n/2:2*n:n+Math.abs(i)*i}function g3(t,e,i){let r=0;return t===10&&(r-=1e4),i&&(r+=150),t!==40&&t!==65288||(r+=50),e!==41&&e!==65289||(r+=50),r}function U1(t,e,i,r,n,s){let a=null,c=N1(e,i,n,s);for(const p of r){const _=N1(e-p.x,i,n,s)+p.badness;_<=c&&(a=p,c=_)}return{index:t,x:e,priorBreak:a,badness:c}}function V1(t){return t?V1(t.priorBreak).concat(t.index):[]}function Dm(t){let e=.5,i=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function j1(t,e,i,r,n){if(!(e||i||r||n))return;const s=t.length-1,a=t[s],c=(a.x+a.metrics.advance*a.scale)*e;for(let p=0;p<=s;p++)t[p].x-=c,t[p].y+=i+r+n}function y3(t,e,i,r){const{horizontalAlign:n,verticalAlign:s}=Dm(r),a=i[0]-t.displaySize[0]*n,c=i[1]-t.displaySize[1]*s;return{imagePrimary:t,imageSecondary:e,top:c,bottom:c+t.displaySize[1],left:a,right:a+t.displaySize[0]}}function G1(t,e,i,r,n,s){const a=t.imagePrimary;let c;if(a.content){const q=a.content,X=a.pixelRatio||1;c=[q[0]/X,q[1]/X,a.displaySize[0]-q[2]/X,a.displaySize[1]-q[3]/X]}const p=e.left*s,_=e.right*s;let v,E,C,B;i==="width"||i==="both"?(B=n[0]+p-r[3],E=n[0]+_+r[1]):(B=n[0]+(p+_-a.displaySize[0])/2,E=B+a.displaySize[0]);const O=e.top*s,G=e.bottom*s;return i==="height"||i==="both"?(v=n[1]+O-r[0],C=n[1]+G+r[2]):(v=n[1]+(O+G-a.displaySize[1])/2,C=v+a.displaySize[1]),{imagePrimary:a,imageSecondary:void 0,top:v,right:E,bottom:C,left:B,collisionPadding:c}}class Zu extends ct{constructor(e,i,r,n,s){super(e,i),this.angle=n,this.z=r,s!==void 0&&(this.segment=s)}clone(){return new Zu(this.x,this.y,this.z,this.angle,this.segment)}}function Z1(t,e,i,r,n){if(e.segment===void 0)return!0;let s=e,a=e.segment+1,c=0;for(;c>-i/2;){if(a--,a<0)return!1;c-=t[a].dist(s),s=t[a]}c+=t[a].dist(t[a+1]),a++;const p=[];let _=0;for(;c<i/2;){const v=t[a],E=t[a+1];if(!E)return!1;let C=t[a-1].angleTo(v)-v.angleTo(E);for(C=Math.abs((C+3*Math.PI)%(2*Math.PI)-Math.PI),p.push({distance:c,angleDelta:C}),_+=C;c-p[0].distance>r;)_-=p.shift().angleDelta;if(_>n)return!1;a++,c+=v.dist(E)}return!0}function q1(t){let e=0;for(let i=0;i<t.length-1;i++)e+=t[i].dist(t[i+1]);return e}function Q1(t,e,i){return t?.6*e*i:0}function H1(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function x3(t,e,i,r,n,s){const a=Q1(i,n,s),c=H1(i,r)*s;let p=0;const _=q1(t)/2;for(let v=0;v<t.length-1;v++){const E=t[v],C=t[v+1],B=E.dist(C);if(p+B>_){const O=(_-p)/B,G=Ki(E.x,C.x,O),q=Ki(E.y,C.y,O),X=new Zu(G,q,0,C.angleTo(E),v);return!a||Z1(t,X,c,a,e)?X:void 0}p+=B}}function v3(t,e,i,r,n,s,a,c,p){const _=Q1(r,s,a),v=H1(r,n),E=v*a,C=t[0].x===0||t[0].x===p||t[0].y===0||t[0].y===p;return e-E<e/4&&(e=E+e/4),W1(t,C?e/2*c%e:(v/2+2*s)*a*c%e,e,_,i,E,C,!1,p)}function W1(t,e,i,r,n,s,a,c,p){const _=s/2,v=q1(t);let E=0,C=e-i,B=[];for(let O=0;O<t.length-1;O++){const G=t[O],q=t[O+1],X=G.dist(q),$=q.angleTo(G);for(;C+i<E+X;){C+=i;const re=(C-E)/X,ne=Ki(G.x,q.x,re),ie=Ki(G.y,q.y,re);if(ne>=0&&ne<p&&ie>=0&&ie<p&&C-_>=0&&C+_<=v){const se=new Zu(ne,ie,0,$,O);r&&!Z1(t,se,s,r,n)||B.push(se)}}E+=X}return c||B.length||a||(B=W1(t,E/2,i,r,n,s,a,!0,p)),B}function X1(t,e,i,r,n){const s=[];for(let a=0;a<t.length;a++){const c=t[a];let p;for(let _=0;_<c.length-1;_++){let v=c[_],E=c[_+1];v.x<e&&E.x<e||(v.x<e?v=new ct(e,v.y+(e-v.x)/(E.x-v.x)*(E.y-v.y))._round():E.x<e&&(E=new ct(e,v.y+(e-v.x)/(E.x-v.x)*(E.y-v.y))._round()),v.y<i&&E.y<i||(v.y<i?v=new ct(v.x+(i-v.y)/(E.y-v.y)*(E.x-v.x),i)._round():E.y<i&&(E=new ct(v.x+(i-v.y)/(E.y-v.y)*(E.x-v.x),i)._round()),v.x>=r&&E.x>=r||(v.x>=r?v=new ct(r,v.y+(r-v.x)/(E.x-v.x)*(E.y-v.y))._round():E.x>=r&&(E=new ct(r,v.y+(r-v.x)/(E.x-v.x)*(E.y-v.y))._round()),v.y>=n&&E.y>=n||(v.y>=n?v=new ct(v.x+(n-v.y)/(E.y-v.y)*(E.x-v.x),n)._round():E.y>=n&&(E=new ct(v.x+(n-v.y)/(E.y-v.y)*(E.x-v.x),n)._round()),p&&v.equals(p[p.length-1])||(p=[v],s.push(p)),p.push(E)))))}}return s}function kg(t){let e=0,i=0;for(const a of t)e+=a.w*a.h,i=Math.max(i,a.w);t.sort((a,c)=>c.h-a.h);const r=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let n=0,s=0;for(const a of t)for(let c=r.length-1;c>=0;c--){const p=r[c];if(!(a.w>p.w||a.h>p.h)){if(a.x=p.x,a.y=p.y,s=Math.max(s,a.y+a.h),n=Math.max(n,a.x+a.w),a.w===p.w&&a.h===p.h){const _=r.pop();c<r.length&&(r[c]=_)}else a.h===p.h?(p.x+=a.w,p.w-=a.w):a.w===p.w?(p.y+=a.h,p.h-=a.h):(r.push({x:p.x+a.w,y:p.y,w:p.w-a.w,h:a.h}),p.y+=a.h,p.h-=a.h);break}}return{w:n,h:s,fill:e/(n*s)||0}}Mi(Zu,"Anchor");const SA=1;class Dg{constructor(e,{pixelRatio:i,version:r,stretchX:n,stretchY:s,content:a}){this.paddedRect=e,this.pixelRatio=i,this.stretchX=n,this.stretchY=s,this.content=a,this.version=r}get tl(){return[this.paddedRect.x+SA,this.paddedRect.y+SA]}get br(){return[this.paddedRect.x+this.paddedRect.w-SA,this.paddedRect.y+this.paddedRect.h-SA]}get displaySize(){return[(this.paddedRect.w-2*SA)/this.pixelRatio,(this.paddedRect.h-2*SA)/this.pixelRatio]}}class Y1{constructor(e,i){const r={},n={};this.haveRenderCallbacks=[];const s=[];this.addImages(e,r,s),this.addImages(i,n,s);const{w:a,h:c}=kg(s),p=new Do({width:a||1,height:c||1});for(const _ in e){const v=e[_],E=r[_].paddedRect;Do.copy(v.data,p,{x:0,y:0},{x:E.x+SA,y:E.y+SA},v.data)}for(const _ in i){const v=i[_],E=n[_].paddedRect,C=E.x+SA,B=E.y+SA,O=v.data.width,G=v.data.height;Do.copy(v.data,p,{x:0,y:0},{x:C,y:B},v.data),Do.copy(v.data,p,{x:0,y:G-1},{x:C,y:B-1},{width:O,height:1}),Do.copy(v.data,p,{x:0,y:0},{x:C,y:B+G},{width:O,height:1}),Do.copy(v.data,p,{x:O-1,y:0},{x:C-1,y:B},{width:1,height:G}),Do.copy(v.data,p,{x:0,y:0},{x:C+O,y:B},{width:1,height:G})}this.image=p,this.iconPositions=r,this.patternPositions=n}addImages(e,i,r){for(const n in e){const s=e[n],a={x:0,y:0,w:s.data.width+2*SA,h:s.data.height+2*SA};r.push(a),i[n]=new Dg(a,s),s.hasRenderCallback&&this.haveRenderCallbacks.push(n)}}patchUpdatedImages(e,i,r){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(n=>e.hasImage(n,r)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,r);for(const n in e.getUpdatedImages(r))this.patchUpdatedImage(this.iconPositions[n],e.getImage(n,r),i),this.patchUpdatedImage(this.patternPositions[n],e.getImage(n,r),i)}patchUpdatedImage(e,i,r){if(!e||!i||e.version===i.version)return;e.version=i.version;const[n,s]=e.tl;r.update(i.data,void 0,{x:n,y:s})}}Mi(Dg,"ImagePosition"),Mi(Y1,"ImageAtlas");const R0=1e20;function K1(t,e,i,r,n,s,a,c,p){for(let _=e;_<e+r;_++)J1(t,i*s+_,s,n,a,c,p);for(let _=i;_<i+n;_++)J1(t,_*s+e,1,r,a,c,p)}function J1(t,e,i,r,n,s,a){s[0]=0,a[0]=-R0,a[1]=R0,n[0]=t[e];for(let c=1,p=0,_=0;c<r;c++){n[c]=t[e+c*i];const v=c*c;do{const E=s[p];_=(n[c]-n[E]+v-E*E)/(c-E)/2}while(_<=a[p]&&--p>-1);p++,s[p]=c,a[p]=_,a[p+1]=R0}for(let c=0,p=0;c<r;c++){for(;a[p+1]<c;)p++;const _=s[p],v=c-_;t[e+c*i]=n[_]+v*v}}const tu=2;class ad{constructor(e,i,r){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=r,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,i){this.urls[i]=e}getGlyphs(e,i,r){const n=[],s=this.urls[i]||Gt.GLYPHS_URL;for(const a in e)for(const c of e[a])n.push({stack:a,id:c});Js(n,({stack:a,id:c},p)=>{let _=this.entries[a];_||(_=this.entries[a]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let v=_.glyphs[c];if(v!==void 0)return void p(null,{stack:a,id:c,glyph:v});if(v=this._tinySDF(_,a,c),v)return _.glyphs[c]=v,void p(null,{stack:a,id:c,glyph:v});const E=Math.floor(c/256);if(256*E>65535)return void p(new Error("glyphs > 65535 not supported"));if(_.ranges[E])return void p(null,{stack:a,id:c,glyph:v});let C=_.requests[E];C||(C=_.requests[E]=[],ad.loadGlyphRange(a,E,s,this.requestManager,(B,O)=>{if(O){_.ascender=O.ascender,_.descender=O.descender;for(const G in O.glyphs)this._doesCharSupportLocalGlyph(+G)||(_.glyphs[+G]=O.glyphs[+G]);_.ranges[E]=!0}for(const G of C)G(B,O);delete _.requests[E]})),C.push((B,O)=>{B?p(B):O&&p(null,{stack:a,id:c,glyph:O.glyphs[c]||null})})},(a,c)=>{if(a)r(a);else if(c){const p={};for(const{stack:_,id:v,glyph:E}of c)p[_]===void 0&&(p[_]={}),p[_].glyphs===void 0&&(p[_].glyphs={}),p[_].glyphs[v]=E&&{id:E.id,bitmap:E.bitmap.clone(),metrics:E.metrics},p[_].ascender=this.entries[_].ascender,p[_].descender=this.entries[_].descender;r(null,p)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==0&&(this.localGlyphMode===2?!!this.localFontFamily:!!this.localFontFamily&&(zi["CJK Unified Ideographs"](e)||zi["Hangul Syllables"](e)||zi.Hiragana(e)||zi.Katakana(e)||zi["CJK Symbols and Punctuation"](e)||zi["CJK Unified Ideographs Extension A"](e)||zi["CJK Unified Ideographs Extension B"](e)))}_tinySDF(e,i,r){const n=this.localFontFamily;if(!n||!this._doesCharSupportLocalGlyph(r))return;let s=e.tinySDF;if(!s){let G="400";/bold/i.test(i)?G="900":/medium/i.test(i)?G="500":/light/i.test(i)&&(G="200"),s=e.tinySDF=new ad.TinySDF({fontFamily:n,fontWeight:G,fontSize:24*tu,buffer:3*tu,radius:8*tu}),s.fontWeight=G}if(this.localGlyphs[s.fontWeight][r])return this.localGlyphs[s.fontWeight][r];const a=String.fromCodePoint(r),{data:c,width:p,height:_,glyphWidth:v,glyphHeight:E,glyphLeft:C,glyphTop:B,glyphAdvance:O}=s.draw(a);return this.localGlyphs[s.fontWeight][r]={id:r,bitmap:new ju({width:p,height:_},c),metrics:{width:v/tu,height:E/tu,left:C/tu,top:B/tu-27,advance:O/tu,localGlyph:!0}}}}ad.loadGlyphRange=function(t,e,i,r,n){const s=256*e,a=s+255,c=r.transformRequest(r.normalizeGlyphsURL(i).replace("{fontstack}",t).replace("{range}",`${s}-${a}`),we.Glyphs);Ne(c,(p,_)=>{if(p)n(p);else if(_){const v={},E=function(C){return new Im(C).readFields(d3,{})}(_);for(const C of E.glyphs)v[C.id]=C;n(null,{glyphs:v,ascender:E.ascender,descender:E.descender})}})},ad.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:i=8,cutoff:r=.25,fontFamily:n="sans-serif",fontWeight:s="normal",fontStyle:a="normal"}={}){this.buffer=e,this.cutoff=r,this.radius=i;const c=this.size=t+4*e,p=this._createCanvas(c),_=this.ctx=p.getContext("2d",{willReadFrequently:!0});_.font=`${a} ${s} ${t}px ${n}`,_.textBaseline="alphabetic",_.textAlign="left",_.fillStyle="black",this.gridOuter=new Float64Array(c*c),this.gridInner=new Float64Array(c*c),this.f=new Float64Array(c),this.z=new Float64Array(c+1),this.v=new Uint16Array(c)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:r,actualBoundingBoxLeft:n,actualBoundingBoxRight:s}=this.ctx.measureText(t),a=Math.ceil(i),c=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(s-n))),p=Math.min(this.size-this.buffer,a+Math.ceil(r)),_=c+2*this.buffer,v=p+2*this.buffer,E=Math.max(_*v,0),C=new Uint8ClampedArray(E),B={data:C,width:_,height:v,glyphWidth:c,glyphHeight:p,glyphTop:a,glyphLeft:0,glyphAdvance:e};if(c===0||p===0)return B;const{ctx:O,buffer:G,gridInner:q,gridOuter:X}=this;O.clearRect(G,G,c,p),O.fillText(t,G,G+a);const $=O.getImageData(G,G,c,p);X.fill(R0,0,E),q.fill(0,0,E);for(let re=0;re<p;re++)for(let ne=0;ne<c;ne++){const ie=$.data[4*(re*c+ne)+3]/255;if(ie===0)continue;const se=(re+G)*_+ne+G;if(ie===1)X[se]=0,q[se]=R0;else{const he=.5-ie;X[se]=he>0?he*he:0,q[se]=he<0?he*he:0}}K1(X,0,0,_,v,_,this.f,this.v,this.z),K1(q,G,G,c,p,_,this.f,this.v,this.z);for(let re=0;re<E;re++){const ne=Math.sqrt(X[re])-Math.sqrt(q[re]);C[re]=Math.round(255-255*(ne/this.radius+this.cutoff))}return B}};const gh=SA;function $1(t,e,i,r){const n=[],s=t.imagePrimary,a=s.pixelRatio,c=s.paddedRect.w-2*gh,p=s.paddedRect.h-2*gh,_=t.right-t.left,v=t.bottom-t.top,E=s.stretchX||[[0,c]],C=s.stretchY||[[0,p]],B=(Ve,je)=>Ve+je[1]-je[0],O=E.reduce(B,0),G=C.reduce(B,0),q=c-O,X=p-G;let $=0,re=O,ne=0,ie=G,se=0,he=q,ve=0,be=X;if(s.content&&r){const Ve=s.content;$=Pm(E,0,Ve[0]),ne=Pm(C,0,Ve[1]),re=Pm(E,Ve[0],Ve[2]),ie=Pm(C,Ve[1],Ve[3]),se=Ve[0]-$,ve=Ve[1]-ne,he=Ve[2]-Ve[0]-re,be=Ve[3]-Ve[1]-ie}const De=(Ve,je,Je,Fe)=>{const nt=zm(Ve.stretch-$,re,_,t.left),At=Bm(Ve.fixed-se,he,Ve.stretch,O),vt=zm(je.stretch-ne,ie,v,t.top),rt=Bm(je.fixed-ve,be,je.stretch,G),lt=zm(Je.stretch-$,re,_,t.left),wt=Bm(Je.fixed-se,he,Je.stretch,O),It=zm(Fe.stretch-ne,ie,v,t.top),St=Bm(Fe.fixed-ve,be,Fe.stretch,G),Bt=new ct(nt,vt),Ft=new ct(lt,vt),jt=new ct(lt,It),Dt=new ct(nt,It),Yt=new ct(At/a,rt/a),fi=new ct(wt/a,St/a),di=e*Math.PI/180;if(di){const Vr=Math.sin(di),cr=Math.cos(di),rr=[cr,-Vr,Vr,cr];Bt._matMult(rr),Ft._matMult(rr),Dt._matMult(rr),jt._matMult(rr)}const vi=Ve.stretch+Ve.fixed,bi=Je.stretch+Je.fixed,Ar=je.stretch+je.fixed,Ni=Fe.stretch+Fe.fixed,rn=t.imageSecondary;return{tl:Bt,tr:Ft,bl:Dt,br:jt,texPrimary:{x:s.paddedRect.x+gh+vi,y:s.paddedRect.y+gh+Ar,w:bi-vi,h:Ni-Ar},texSecondary:rn?{x:rn.paddedRect.x+gh+vi,y:rn.paddedRect.y+gh+Ar,w:bi-vi,h:Ni-Ar}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Yt,pixelOffsetBR:fi,minFontScaleX:he/a/_,minFontScaleY:be/a/v,isSDF:i}};if(r&&(s.stretchX||s.stretchY)){const Ve=ex(E,q,O),je=ex(C,X,G);for(let Je=0;Je<Ve.length-1;Je++){const Fe=Ve[Je],nt=Ve[Je+1];for(let At=0;At<je.length-1;At++)n.push(De(Fe,je[At],nt,je[At+1]))}}else n.push(De({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:c+1},{fixed:0,stretch:p+1}));return n}function Pm(t,e,i){let r=0;for(const n of t)r+=Math.max(e,Math.min(i,n[1]))-Math.max(e,Math.min(i,n[0]));return r}function ex(t,e,i){const r=[{fixed:-gh,stretch:0}];for(const[n,s]of t){const a=r[r.length-1];r.push({fixed:n-a.stretch,stretch:a.stretch}),r.push({fixed:n-a.stretch,stretch:a.stretch+(s-n)})}return r.push({fixed:e+gh,stretch:i}),r}function zm(t,e,i,r){return t/e*i+r}function Bm(t,e,i,r){return t-e*i/r}function b3(t,e,i,r){const n=e+t.positionedLines[r].lineOffset;return r===0?i+n/2:i+(n+(e+t.positionedLines[r-1].lineOffset))/2}function w3(t,e=1,i=!1){let r=1/0,n=1/0,s=-1/0,a=-1/0;const c=t[0];for(let B=0;B<c.length;B++){const O=c[B];(!B||O.x<r)&&(r=O.x),(!B||O.y<n)&&(n=O.y),(!B||O.x>s)&&(s=O.x),(!B||O.y>a)&&(a=O.y)}const p=Math.min(s-r,a-n);let _=p/2;const v=new Ol([],T3);if(p===0)return new ct(r,n);for(let B=r;B<s;B+=p)for(let O=n;O<a;O+=p)v.push(new ld(B+_,O+_,_,t));let E=function(B){let O=0,G=0,q=0;const X=B[0];for(let $=0,re=X.length,ne=re-1;$<re;ne=$++){const ie=X[$],se=X[ne],he=ie.x*se.y-se.x*ie.y;G+=(ie.x+se.x)*he,q+=(ie.y+se.y)*he,O+=3*he}return new ld(G/O,q/O,0,B)}(t),C=v.length;for(;v.length;){const B=v.pop();(B.d>E.d||!E.d)&&(E=B,i&&console.log("found best %d after %d probes",Math.round(1e4*B.d)/1e4,C)),B.max-E.d<=e||(_=B.h/2,v.push(new ld(B.p.x-_,B.p.y-_,_,t)),v.push(new ld(B.p.x+_,B.p.y-_,_,t)),v.push(new ld(B.p.x-_,B.p.y+_,_,t)),v.push(new ld(B.p.x+_,B.p.y+_,_,t)),C+=4)}return i&&(console.log(`num probes: ${C}`),console.log(`best distance: ${E.d}`)),E.p}function T3(t,e){return e.max-t.max}class ld{constructor(e,i,r,n){this.p=new ct(e,i),this.h=r,this.d=function(s,a){let c=!1,p=1/0;for(let _=0;_<a.length;_++){const v=a[_];for(let E=0,C=v.length,B=C-1;E<C;B=E++){const O=v[E],G=v[B];O.y>s.y!=G.y>s.y&&s.x<(G.x-O.x)*(s.y-O.y)/(G.y-O.y)+O.x&&(c=!c),p=Math.min(p,t1(s,O,G))}}return(c?1:-1)*Math.sqrt(p)}(this.p,n),this.max=this.d+this.h*Math.SQRT2}}const Ad=7,Pg=Number.POSITIVE_INFINITY,E3=Math.sqrt(2);function zg(t,[e,i]){let r=0,n=0;if(i===Pg){e<0&&(e=0);const s=e/E3;switch(t){case"top-right":case"top-left":n=s-Ad;break;case"bottom-right":case"bottom-left":n=-s+Ad;break;case"bottom":n=-e+Ad;break;case"top":n=e-Ad}switch(t){case"top-right":case"bottom-right":r=-s;break;case"top-left":case"bottom-left":r=s;break;case"left":r=e;break;case"right":r=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),t){case"top-right":case"top-left":case"top":n=i-Ad;break;case"bottom-right":case"bottom-left":case"bottom":n=-i+Ad}switch(t){case"top-right":case"bottom-right":case"right":r=-e;break;case"top-left":case"bottom-left":case"left":r=e}}return[r,n]}function M3(t,e,i,r,n,s,a,c,p,_,v){t.createArrays(),t.tilePixelRatio=Mt/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const E=t.layers[0].layout,C=t.layers[0]._unevaluatedLayout._values,B={};if(t.textSizeData.kind==="composite"){const{minZoom:X,maxZoom:$}=t.textSizeData;B.compositeTextSizes=[C["text-size"].possiblyEvaluate(new _s(X),c),C["text-size"].possiblyEvaluate(new _s($),c)]}if(t.iconSizeData.kind==="composite"){const{minZoom:X,maxZoom:$}=t.iconSizeData;B.compositeIconSizes=[C["icon-size"].possiblyEvaluate(new _s(X),c),C["icon-size"].possiblyEvaluate(new _s($),c)]}B.layoutTextSize=C["text-size"].possiblyEvaluate(new _s(p+1),c),B.layoutIconSize=C["icon-size"].possiblyEvaluate(new _s(p+1),c),B.textMaxSize=C["text-size"].possiblyEvaluate(new _s(18),c);const O=E.get("text-rotation-alignment")==="map"&&E.get("symbol-placement")!=="point",G=E.get("text-size");let q=!1;for(const X of t.features)if(X.icon&&X.icon.nameSecondary){q=!0;break}for(const X of t.features){const $=E.get("text-font").evaluate(X,{},c).join(","),re=G.evaluate(X,{},c),ne=B.layoutTextSize.evaluate(X,{},c),ie=(B.layoutIconSize.evaluate(X,{},c),{horizontal:{},vertical:void 0}),se=X.text;let he,ve=[0,0];if(se){const Ve=se.toString(),je=E.get("text-letter-spacing").evaluate(X,{},c)*va,Je=E.get("text-line-height").evaluate(X,{},c)*va,Fe=zd(Ve)?je:0,nt=E.get("text-anchor").evaluate(X,{},c),At=E.get("text-variable-anchor");if(!At){const It=E.get("text-radial-offset").evaluate(X,{},c);ve=It?zg(nt,[It*va,Pg]):E.get("text-offset").evaluate(X,{},c).map(St=>St*va)}let vt=O?"center":E.get("text-justify").evaluate(X,{},c);const rt=E.get("symbol-placement")==="point",lt=rt?E.get("text-max-width").evaluate(X,{},c)*va:1/0,wt=It=>{t.allowVerticalPlacement&&yf(Ve)&&(ie.vertical=Cg(se,e,i,n,$,lt,Je,nt,It,Fe,ve,Ms.vertical,!0,ne,re))};if(!O&&At){const It=vt==="auto"?At.map(Bt=>Bg(Bt)):[vt];let St=!1;for(let Bt=0;Bt<It.length;Bt++){const Ft=It[Bt];if(!ie.horizontal[Ft])if(St)ie.horizontal[Ft]=ie.horizontal[0];else{const jt=Cg(se,e,i,n,$,lt,Je,"center",Ft,Fe,ve,Ms.horizontal,!1,ne,re);jt&&(ie.horizontal[Ft]=jt,St=jt.positionedLines.length===1)}}wt("left")}else{if(vt==="auto"&&(vt=Bg(nt)),rt||E.get("text-writing-mode").indexOf("horizontal")>=0||!yf(Ve)){const It=Cg(se,e,i,n,$,lt,Je,nt,vt,Fe,ve,Ms.horizontal,!1,ne,re);It&&(ie.horizontal[vt]=It)}wt(rt?"left":vt)}}let be=!1;if(X.icon&&X.icon.namePrimary){const Ve=r[X.icon.namePrimary];Ve&&(he=y3(n[X.icon.namePrimary],X.icon.nameSecondary?n[X.icon.nameSecondary]:void 0,E.get("icon-offset").evaluate(X,{},c),E.get("icon-anchor").evaluate(X,{},c)),be=Ve.sdf,t.sdfIcons===void 0?t.sdfIcons=Ve.sdf:t.sdfIcons!==Ve.sdf&&Be("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ve.pixelRatio!==t.pixelRatio||E.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}const De=ix(ie.horizontal)||ie.vertical;t.iconsInText||(t.iconsInText=!!De&&De.iconsInText),(De||he)&&S3(t,X,ie,he,r,B,ne,0,ve,be,a,c,_,v,q)}s&&t.generateCollisionDebugBuffers(p,t.collisionBoxArray)}function Bg(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function S3(t,e,i,r,n,s,a,c,p,_,v,E,C,B,O){let G=s.textMaxSize.evaluate(e,{},E);G===void 0&&(G=a);const q=t.layers[0].layout,X=q.get("icon-offset").evaluate(e,{},E),$=ix(i.horizontal)||i.vertical,re=C.name==="globe",ne=va,ie=a/ne,se=t.tilePixelRatio*G/ne,he=(nt=t.overscaling,t.zoom>18&&nt>2&&(nt>>=1),Math.max(Mt/(512*nt),1)*q.get("symbol-spacing")),ve=q.get("text-padding")*t.tilePixelRatio,be=q.get("icon-padding")*t.tilePixelRatio,De=wi(q.get("text-max-angle")),Ve=q.get("text-rotation-alignment")==="map"&&q.get("symbol-placement")!=="point",je=q.get("icon-rotation-alignment")==="map"&&q.get("symbol-placement")!=="point",Je=q.get("symbol-placement"),Fe=he/2;var nt;const At=q.get("icon-text-fit").evaluate(e,{},E),vt=q.get("icon-text-fit-padding").evaluate(e,{},E),rt=At!=="none";let lt;t.hasAnyIconTextFit===!1&&rt&&(t.hasAnyIconTextFit=!0),r&&rt&&(t.allowVerticalPlacement&&i.vertical&&(lt=G1(r,i.vertical,At,vt,X,ie)),$&&(r=G1(r,$,At,vt,X,ie)));const wt=(It,St,Bt)=>{if(St.x<0||St.x>=Mt||St.y<0||St.y>=Mt)return;let Ft=null;if(re){const{x:jt,y:Dt,z:Yt}=C.projectTilePoint(St.x,St.y,Bt);Ft={anchor:new Zu(jt,Dt,Yt,0,void 0),up:C.upVector(Bt,St.x,St.y)}}(function(jt,Dt,Yt,fi,di,vi,bi,Ar,Ni,rn,Vr,cr,rr,Hi,Zr,Kr,zr,Gn,ao,On,ds,go,lo,vs,Ln,Ua,Mu){const qu=jt.addToLineVertexArray(Dt,fi);let Qu,np,sp,C_,lw,Aw,cw,uw=0,hw=0,fw=0,dw=0,By=-1,Ly=-1;const Su={};let pw=$d("");const cf=Yt?Yt.anchor:Dt,Ry=Ni.layout.get("icon-text-fit").evaluate(ds,{},Ln)!=="none";let Fy=0,Oy=0;if(Ni._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Fy,Oy]=Ni.layout.get("text-offset").evaluate(ds,{},Ln).map(CA=>CA*va):(Fy=Ni.layout.get("text-radial-offset").evaluate(ds,{},Ln)*va,Oy=Pg),jt.allowVerticalPlacement&&di.vertical){const CA=di.vertical;if(Zr)Aw=Lg(CA),Ar&&(cw=Lg(Ar));else{const kA=Ni.layout.get("text-rotate").evaluate(ds,{},Ln)+90;sp=Lm(rn,cf,Dt,Vr,cr,rr,CA,Hi,kA,Kr),Ar&&(C_=Lm(rn,cf,Dt,Vr,cr,rr,Ar,Gn,kA))}}if(vi){const CA=Ni.layout.get("icon-rotate").evaluate(ds,{},Ln),kA=$1(vi,CA,lo,Ry),xd=Ar?$1(Ar,CA,lo,Ry):void 0;np=Lm(rn,cf,Dt,Vr,cr,rr,vi,Gn,CA),uw=4*kA.length;const mw=jt.iconSizeData;let uf=null;mw.kind==="source"?(uf=[eu*Ni.layout.get("icon-size").evaluate(ds,{},Ln)],uf[0]>yh&&Be(`${jt.layerIds[0]}: Value for "icon-size" is >= ${F0}. Reduce your "icon-size".`)):mw.kind==="composite"&&(uf=[eu*go.compositeIconSizes[0].evaluate(ds,{},Ln),eu*go.compositeIconSizes[1].evaluate(ds,{},Ln)],(uf[0]>yh||uf[1]>yh)&&Be(`${jt.layerIds[0]}: Value for "icon-size" is >= ${F0}. Reduce your "icon-size".`)),jt.addSymbols(jt.icon,kA,uf,On,ao,ds,!1,Yt,Dt,qu.lineStartIndex,qu.lineLength,-1,vs,Ln,Ua,Mu),By=jt.icon.placedSymbolArray.length-1,xd&&(hw=4*xd.length,jt.addSymbols(jt.icon,xd,uf,On,ao,ds,Ms.vertical,Yt,Dt,qu.lineStartIndex,qu.lineLength,-1,vs,Ln,Ua,Mu),Ly=jt.icon.placedSymbolArray.length-1)}for(const CA in di.horizontal){const kA=di.horizontal[CA];Qu||(pw=$d(kA.text),Zr?lw=Lg(kA):Qu=Lm(rn,cf,Dt,Vr,cr,rr,kA,Hi,Ni.layout.get("text-rotate").evaluate(ds,{},Ln),Kr));const xd=kA.positionedLines.length===1;if(fw+=tx(jt,Yt,Dt,kA,bi,Ni,Zr,ds,Kr,qu,di.vertical?Ms.horizontal:Ms.horizontalOnly,xd?Object.keys(di.horizontal):[CA],Su,By,go,vs,Ln,Ua),xd)break}di.vertical&&(dw+=tx(jt,Yt,Dt,di.vertical,bi,Ni,Zr,ds,Kr,qu,Ms.vertical,["vertical"],Su,Ly,go,vs,Ln,Ua));let Sh=-1;const Ny=(CA,kA)=>CA?Math.max(CA,kA):kA;Sh=Ny(lw,Sh),Sh=Ny(Aw,Sh),Sh=Ny(cw,Sh);const uS=Sh>-1?1:0;jt.glyphOffsetArray.length>=j0.MAX_GLYPHS&&Be("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),ds.sortKey!==void 0&&jt.addToSortKeyRanges(jt.symbolInstances.length,ds.sortKey),jt.symbolInstances.emplaceBack(Dt.x,Dt.y,cf.x,cf.y,cf.z,Su.right>=0?Su.right:-1,Su.center>=0?Su.center:-1,Su.left>=0?Su.left:-1,Su.vertical>=0?Su.vertical:-1,By,Ly,pw,Qu!==void 0?Qu:jt.collisionBoxArray.length,Qu!==void 0?Qu+1:jt.collisionBoxArray.length,sp!==void 0?sp:jt.collisionBoxArray.length,sp!==void 0?sp+1:jt.collisionBoxArray.length,np!==void 0?np:jt.collisionBoxArray.length,np!==void 0?np+1:jt.collisionBoxArray.length,C_||jt.collisionBoxArray.length,C_?C_+1:jt.collisionBoxArray.length,Vr,fw,dw,uw,hw,uS,0,Fy,Oy,Sh,0,Ry?1:0)})(t,St,Ft,It,i,r,n,lt,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,ve,Ve,p,0,be,je,X,e,s,_,v,E,B,O)};if(Je==="line")for(const It of X1(e.geometry,0,0,Mt,Mt)){const St=v3(It,he,De,i.vertical||$,r,ne,se,t.overscaling,Mt);for(const Bt of St)$&&I3(t,$.text,Fe,Bt)||wt(It,Bt,E)}else if(Je==="line-center"){for(const It of e.geometry)if(It.length>1){const St=x3(It,De,i.vertical||$,r,ne,se);St&&wt(It,St,E)}}else if(e.type==="Polygon")for(const It of vg(e.geometry,0)){const St=w3(It,16);wt(It[0],new Zu(St.x,St.y,0,0,void 0),E)}else if(e.type==="LineString")for(const It of e.geometry)wt(It,new Zu(It[0].x,It[0].y,0,0,void 0),E);else if(e.type==="Point")for(const It of e.geometry)for(const St of It)wt([St],new Zu(St.x,St.y,0,0,void 0),E)}const F0=255,yh=F0*eu;function tx(t,e,i,r,n,s,a,c,p,_,v,E,C,B,O,G,q,X){const $=function(ie,se,he,ve,be,De,Ve,je){const Je=[];if(se.positionedLines.length===0)return Je;const Fe=ve.layout.get("text-rotate").evaluate(De,{})*Math.PI/180,nt=function(wt){const It=wt[0],St=wt[1],Bt=It*St;return Bt>0?[It,-St]:Bt<0?[-It,St]:It===0?[St,It]:[St,-It]}(he);let At=Math.abs(se.top-se.bottom);for(const wt of se.positionedLines)At-=wt.lineOffset;const vt=se.positionedLines.length,rt=At/vt;let lt=se.top-he[1];for(let wt=0;wt<vt;++wt){const It=se.positionedLines[wt];lt=b3(se,rt,lt,wt);for(const St of It.positionedGlyphs){if(!St.rect)continue;const Bt=St.rect||{};let Ft=R1+1,jt=!0,Dt=1,Yt=0;if(St.imageName){const On=Ve[St.imageName];if(!On)continue;if(On.sdf){Be("SDF images are not supported in formatted text and will be ignored.");continue}jt=!1,Dt=On.pixelRatio,Ft=SA/Dt}const fi=(be||je)&&St.vertical,di=St.metrics.advance*St.scale/2,vi=St.metrics,bi=St.rect;if(bi===null)continue;je&&se.verticalizable&&(Yt=St.imageName?di-St.metrics.width*St.scale/2:0);const Ar=be?[St.x+di,St.y]:[0,0];let Ni=[0,0],rn=[0,0],Vr=!1;be||(fi?(rn=[St.x+di+nt[0],St.y+nt[1]-Yt],Vr=!0):Ni=[St.x+di+he[0],St.y+he[1]-Yt]);const cr=bi.w*St.scale/(Dt*(St.localGlyph?tu:1)),rr=bi.h*St.scale/(Dt*(St.localGlyph?tu:1));let Hi,Zr,Kr,zr;if(fi){const On=St.y-lt,ds=new ct(-di,di-On),go=-Math.PI/2,lo=new ct(...rn);Hi=new ct(-di+Ni[0],Ni[1]),Hi._rotateAround(go,ds)._add(lo),Hi.x+=-On+di,Hi.y-=(vi.left-Ft)*St.scale;const vs=St.imageName?vi.advance*St.scale:va*St.scale,Ln=String.fromCodePoint(St.glyph);h3(Ln)?Hi.x+=(1-Ft)*St.scale:f3(Ln)?Hi.x+=vs-vi.height*St.scale+(-Ft-1)*St.scale:Hi.x+=St.imageName||vi.width+2*Ft===bi.w&&vi.height+2*Ft===bi.h?(vs-rr)/2:(vs-(vi.height+2*Ft)*St.scale)/2,Zr=new ct(Hi.x,Hi.y-cr),Kr=new ct(Hi.x+rr,Hi.y),zr=new ct(Hi.x+rr,Hi.y-cr)}else{const On=(vi.left-Ft)*St.scale-di+Ni[0],ds=(-vi.top-Ft)*St.scale+Ni[1],go=On+cr,lo=ds+rr;Hi=new ct(On,ds),Zr=new ct(go,ds),Kr=new ct(On,lo),zr=new ct(go,lo)}if(Fe){let On;On=be?new ct(0,0):Vr?new ct(nt[0],nt[1]):new ct(he[0],he[1]),Hi._rotateAround(Fe,On),Zr._rotateAround(Fe,On),Kr._rotateAround(Fe,On),zr._rotateAround(Fe,On)}const Gn=new ct(0,0),ao=new ct(0,0);Je.push({tl:Hi,tr:Zr,bl:Kr,br:zr,texPrimary:Bt,texSecondary:void 0,writingMode:se.writingMode,glyphOffset:Ar,sectionIndex:St.sectionIndex,isSDF:jt,pixelOffsetTL:Gn,pixelOffsetBR:ao,minFontScaleX:0,minFontScaleY:0})}}return Je}(0,r,p,s,a,c,n,t.allowVerticalPlacement),re=t.textSizeData;let ne=null;re.kind==="source"?(ne=[eu*s.layout.get("text-size").evaluate(c,{},q)],ne[0]>yh&&Be(`${t.layerIds[0]}: Value for "text-size" is >= ${F0}. Reduce your "text-size".`)):re.kind==="composite"&&(ne=[eu*O.compositeTextSizes[0].evaluate(c,{},q),eu*O.compositeTextSizes[1].evaluate(c,{},q)],(ne[0]>yh||ne[1]>yh)&&Be(`${t.layerIds[0]}: Value for "text-size" is >= ${F0}. Reduce your "text-size".`)),t.addSymbols(t.text,$,ne,p,a,c,v,e,i,_.lineStartIndex,_.lineLength,B,G,q,X,!1);for(const ie of E)C[ie]=t.text.placedSymbolArray.length-1;return 4*$.length}function ix(t){for(const e in t)return t[e];return null}function Lm(t,e,i,r,n,s,a,c,p,_){let v=a.top,E=a.bottom,C=a.left,B=a.right;const O=a.collisionPadding;if(O&&(C-=O[0],v-=O[1],B+=O[2],E+=O[3]),p){const G=new ct(C,v),q=new ct(B,v),X=new ct(C,E),$=new ct(B,E),re=wi(p);let ne=new ct(0,0);_&&(ne=new ct(_[0],_[1])),G._rotateAround(re,ne),q._rotateAround(re,ne),X._rotateAround(re,ne),$._rotateAround(re,ne),C=Math.min(G.x,q.x,X.x,$.x),B=Math.max(G.x,q.x,X.x,$.x),v=Math.min(G.y,q.y,X.y,$.y),E=Math.max(G.y,q.y,X.y,$.y)}return t.emplaceBack(e.x,e.y,e.z,i.x,i.y,C,v,B,E,c,r,n,s),t.length-1}function Lg(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function I3(t,e,i,r){const n=t.compareText;if(e in n){const s=n[e];for(let a=s.length-1;a>=0;a--)if(r.dist(s[a])<i)return!0}else n[e]=[];return n[e].push(r),!1}function rx(t,e){const i=t.fovAboveCenter,r=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,n=(t._camera.position[2]*t.worldSize-r)/Math.cos(t._pitch),s=Math.sin(i)*n/Math.sin(Math.max(Math.PI/2-t._pitch-i,.01)),a=Math.sin(t._pitch)*s+n;return Math.min(1.01*a,n*(1/t._horizonShift))}function tf(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};const i=Math.pow(2,-t.z),r=t.x*i,n=(t.x+1)*i,s=t.y*i,a=(t.y+1)*i,c=MA(r),p=MA(n),_=Lo(s),v=Lo(a),E=e.project(c,_),C=e.project(p,_),B=e.project(p,v),O=e.project(c,v);let G=Math.min(E.x,C.x,B.x,O.x),q=Math.min(E.y,C.y,B.y,O.y),X=Math.max(E.x,C.x,B.x,O.x),$=Math.max(E.y,C.y,B.y,O.y);const re=i/16;function ne(se,he,ve,be,De,Ve){const je=(ve+De)/2,Je=(be+Ve)/2,Fe=e.project(MA(je),Lo(Je)),nt=Math.max(0,G-Fe.x,q-Fe.y,Fe.x-X,Fe.y-$);G=Math.min(G,Fe.x),X=Math.max(X,Fe.x),q=Math.min(q,Fe.y),$=Math.max($,Fe.y),nt>re&&(ne(se,Fe,ve,be,je,Je),ne(Fe,he,je,Je,De,Ve))}ne(E,C,r,s,n,s),ne(C,B,n,s,n,a),ne(B,O,n,a,r,a),ne(O,E,r,a,r,s),G-=re,q-=re,X+=re,$+=re;const ie=1/Math.max(X-G,$-q);return{scale:ie,x:G*ie,y:q*ie,x2:X*ie,y2:$*ie,projection:e}}function nx(t,e,i,r,n,s,a,c,p){if(p.name==="globe")return Wl(t,e,new ci(i,r,n),!1);const _=tf({z:i,x:r,y:n},p);return new Hr([(s+_.x/_.scale)*e,e*(_.y/_.scale),a],[(s+_.x2/_.scale)*e,e*(_.y2/_.scale),c])}function sx(t,{x:e,y:i},r=0){return new ct(((e-r)*t.scale-t.x)*Mt,(i*t.scale-t.y)*Mt)}function ox(t,e,i=0){return me.fromValues(((e.x-i)*t.scale-t.x)*Mt,(e.y*t.scale-t.y)*Mt,Xy(e.z,e.y))}const C3=ce.identity(new Float32Array(16));class xh{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new er(0,0)}projectTilePoint(e,i,r){return{x:e,y:i,z:0}}locationPoint(e,i,r=!0){return e._coordinatePoint(e.locationCoordinate(i),r)}pixelsPerMeter(e,i){return jn(1,e)*i}pixelSpaceConversion(e,i,r){return 1}farthestPixelDistance(e){return rx(e,e.pixelsPerMeter)}pointCoordinate(e,i,r,n){const s=e.horizonLineFromTop(!1),a=new ct(i,Math.max(s,r));return e.rayIntersectionCoordinate(e.pointRayIntersection(a,n))}pointCoordinate3D(e,i,r){const n=new ct(i,r);if(e.elevation)return e.elevation.pointCoordinate(n);{const s=this.pointCoordinate(e,n.x,n.y,0);return[s.x,s.y,s.z]}}isPointAboveHorizon(e,i){if(e.elevation)return!this.pointCoordinate3D(e,i.x,i.y);const r=e.horizonLineFromTop();return i.y<r}createInversionMatrix(e,i){return C3}createTileMatrix(e,i,r){let n,s,a;const c=r.canonical,p=ce.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const _=tf(c,this);n=1,s=_.x+r.wrap*_.scale,a=_.y,ce.scale(p,p,[n/_.scale,n/_.scale,e.pixelsPerMeter/i])}else n=i/e.zoomScale(c.z),s=(c.x+Math.pow(2,c.z)*r.wrap)*n,a=c.y*n;return ce.translate(p,p,[s,a,0]),ce.scale(p,p,[n/Mt,n/Mt,1]),p}upVector(e,i,r){return[0,0,1]}upVectorScale(e,i,r){return{metersToTile:1}}}class k3 extends xh{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,r]=this.parallels=e.parallels||[29.5,45.5],n=Math.sin(wi(i));this.n=(n+Math.sin(wi(r)))/2,this.c=1+n*(2*this.n-n),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:r,c:n,r0:s}=this,a=wi(e-this.center[0]),c=wi(i),p=Math.sqrt(n-2*r*Math.sin(c))/r;return{x:p*Math.sin(a*r),y:p*Math.cos(a*r)-s,z:0}}unproject(e,i){const{n:r,c:n,r0:s}=this,a=s+i;let c=Math.atan2(e,Math.abs(a))*Math.sign(a);a*r<0&&(c-=Math.PI*Math.sign(e)*Math.sign(a));const p=wi(this.center[0])*r;c=Pn(c,-Math.PI-p,Math.PI-p);const _=Ai(hr(c/r)+this.center[0],-180,180),v=Math.asin(Ai((n-(e*e+a*a)*r*r)/(2*r),-1,1)),E=Ai(hr(v),-oo,oo);return new er(_,E)}}const O0=1.340264,N0=-.081106,U0=893e-6,V0=.003796,Rm=Math.sqrt(3)/2;class D3 extends xh{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const r=Math.asin(Rm*Math.sin(i)),n=r*r,s=n*n*n;return{x:.5*(e*Math.cos(r)/(Rm*(O0+3*N0*n+s*(7*U0+9*V0*n)))/Math.PI+.5),y:1-.5*(r*(O0+N0*n+s*(U0+V0*n))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let r=i=(2*(1-i)-1)*Math.PI,n=r*r,s=n*n*n;for(let v,E,C,B=0;B<12&&(E=r*(O0+N0*n+s*(U0+V0*n))-i,C=O0+3*N0*n+s*(7*U0+9*V0*n),v=E/C,r=Ai(r-v,-Math.PI/3,Math.PI/3),n=r*r,s=n*n*n,!(Math.abs(v)<1e-12));++B);const a=Rm*e*(O0+3*N0*n+s*(7*U0+9*V0*n))/Math.cos(r),c=Math.asin(Math.sin(r)/Rm),p=Ai(180*a/Math.PI,-180,180),_=Ai(180*c/Math.PI,-oo,oo);return new er(p,_)}}class P3 extends xh{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const r=360*(e-.5),n=Ai(360*(.5-i),-oo,oo);return new er(r,n)}}const cd=Math.PI/2;function Fm(t){return Math.tan((cd+t)/2)}class z3 extends xh{constructor(e){super(e),this.center=e.center||[0,30];const[i,r]=this.parallels=e.parallels||[30,30];let n=wi(i),s=wi(r);this.southernCenter=n+s<0,this.southernCenter&&(n=-n,s=-s);const a=Math.cos(n),c=Fm(n);this.n=n===s?Math.sin(n):Math.log(a/Math.cos(s))/Math.log(Fm(s)/c),this.f=a*Math.pow(Fm(n),this.n)/this.n}project(e,i){i=wi(i),this.southernCenter&&(i=-i),e=wi(e-this.center[0]);const r=1e-6,{n,f:s}=this;s>0?i<-cd+r&&(i=-cd+r):i>cd-r&&(i=cd-r);const a=s/Math.pow(Fm(i),n);let c=a*Math.sin(n*e),p=s-a*Math.cos(n*e);return c=.5*(c/Math.PI+.5),p=.5*(p/Math.PI+.5),{x:c,y:this.southernCenter?p:1-p,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:r,f:n}=this,s=n-i,a=Math.sign(s),c=Math.sign(r)*Math.sqrt(e*e+s*s);let p=Math.atan2(e,Math.abs(s))*a;s*r<0&&(p-=Math.PI*Math.sign(e)*a);const _=Ai(hr(p/r)+this.center[0],-180,180),v=Ai(hr(2*Math.atan(Math.pow(n/c,1/r))-cd),-oo,oo);return new er(_,this.southernCenter?-v:v)}}class ax extends xh{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:Wo(e),y:oa(i),z:0}}unproject(e,i){const r=MA(e),n=Lo(i);return new er(r,n)}}const lx=wi(oo);class B3 extends xh{project(e,i){const r=(i=wi(i))*i,n=r*r;return{x:.5*((e=wi(e))*(.8707-.131979*r+n*(n*(.003971*r-.001529*n)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+r*(.015085+n*(.028874*r-.044475-.005916*n)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let r=i=(2*(1-i)-1)*Math.PI,n=25,s=0,a=r*r;do{a=r*r;const _=a*a;s=(r*(1.007226+a*(.015085+_*(.028874*a-.044475-.005916*_)))-i)/(1.007226+a*(.045255+_*(.259866*a-.311325-.005916*11*_))),r=Ai(r-s,-lx,lx)}while(Math.abs(s)>1e-6&&--n>0);a=r*r;const c=Ai(hr(e/(.8707+a*(a*(a*a*a*(.003971-.001529*a)-.013791)-.131979))),-180,180),p=hr(r);return new er(c,p)}}const Ax=wi(oo);class L3 extends xh{project(e,i){i=wi(i),e=wi(e);const r=Math.cos(i),n=2/Math.PI,s=Math.acos(r*Math.cos(e/2)),a=Math.sin(s)/s,c=.5*(e*n+2*r*Math.sin(e/2)/a)||0,p=.5*(i+Math.sin(i)/a)||0;return{x:.5*(c/Math.PI+.5),y:1-.5*(p/Math.PI+1),z:0}}unproject(e,i){let r=e=(2*e-.5)*Math.PI,n=i=(2*(1-i)-1)*Math.PI,s=25;const a=1e-6;let c=0,p=0;do{const _=Math.cos(n),v=Math.sin(n),E=2*v*_,C=v*v,B=_*_,O=Math.cos(r/2),G=Math.sin(r/2),q=2*O*G,X=G*G,$=1-B*O*O,re=$?1/$:0,ne=$?Math.acos(_*O)*Math.sqrt(1/$):0,ie=.5*(2*ne*_*G+2*r/Math.PI)-e,se=.5*(ne*v+n)-i,he=.5*re*(B*X+ne*_*O*C)+1/Math.PI,ve=re*(q*E/4-ne*v*G),be=.125*re*(E*G-ne*v*B*q),De=.5*re*(C*O+ne*X*_)+.5,Ve=ve*be-De*he;c=(se*ve-ie*De)/Ve,p=(ie*be-se*he)/Ve,r=Ai(r-c,-Math.PI,Math.PI),n=Ai(n-p,-Ax,Ax)}while((Math.abs(c)>a||Math.abs(p)>a)&&--s>0);return new er(hr(r),hr(n))}}class cx extends xh{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(wi(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:r,cosPhi:n}=this;return{x:wi(e)*n*r+.5,y:-Math.sin(wi(i))/n*r+.5,z:0}}unproject(e,i){const{scale:r,cosPhi:n}=this,s=-(i-.5)/r,a=Ai(hr((e-.5)/r)/n,-180,180),c=Math.asin(Ai(s*n,-1,1)),p=Ai(hr(c),-oo,oo);return new er(a,p)}}class R3 extends ax{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,r){const n=hh(e,i,r),s=_l(_o(r));return me.transformMat4(n,n,s),{x:n[0],y:n[1],z:n[2]}}locationPoint(e,i){const r=xa(i.lat,i.lng),n=me.normalize([],r),s=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude,a=jn(1,0)*Mt*s;me.scaleAndAdd(r,r,n,a);const c=ce.identity(new Float64Array(16));return ce.multiply(c,e.pixelMatrix,e.globeMatrix),me.transformMat4(r,r,c),new ct(r[0],r[1])}pixelsPerMeter(e,i){return jn(1,0)*i}pixelSpaceConversion(e,i,r){const n=jn(1,e)*i,s=Ki(jn(1,45)*i,n,r);return this.pixelsPerMeter(e,i)/s}createTileMatrix(e,i,r){const n=Kf(_o(r.canonical));return ce.multiply(new Float64Array(16),e.globeMatrix,n)}createInversionMatrix(e,i){const{center:r}=e,n=_l(_o(i));return ce.rotateY(n,n,wi(r.lng)),ce.rotateX(n,n,wi(r.lat)),ce.scale(n,n,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(n)}pointCoordinate(e,i,r,n){return Ra(e,i,r,!0)||new Wr(0,0)}pointCoordinate3D(e,i,r){const n=this.pointCoordinate(e,i,r,0);return[n.x,n.y,n.z]}isPointAboveHorizon(e,i){return!Ra(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=function(n,s){const a=n.cameraToCenterDistance,c=n._centerAltitude*s,p=n._camera,_=n._camera.forward(),v=me.add([],me.scale([],_,-a),[0,0,c]),E=n.worldSize/(2*Math.PI),C=[0,0,-E],B=n.width/n.height,O=Math.tan(n.fovAboveCenter),G=me.scale([],p.up(),O),q=me.scale([],p.right(),O*B),X=me.normalize([],me.add([],me.add([],_,G),q)),$=[];let re;if(new ys(v,X).closestPointOnSphere(C,E,$)){const ne=me.add([],$,C),ie=me.sub([],ne,v);re=Math.cos(n.fovAboveCenter)*me.length(ie)}else{const ne=me.sub([],v,C),ie=me.sub([],C,v);me.normalize(ie,ie);const se=me.length(ne)-E;re=Math.sqrt(se*(se+2*E));const he=Math.acos(re/(E+se))-Math.acos(me.dot(_,ie));re*=Math.cos(he)}return 1.01*re}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),r=Ho(e.zoom);if(r>0){const n=rx(e,jn(1,e.center.lat)*e.worldSize),s=e.worldSize/(2*Math.PI),a=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Ki(i,n+s*(1-Math.cos(a)),Math.pow(r,10))}return i}upVector(e,i,r){return hh(i,r,e,1)}upVectorScale(e){return{metersToTile:ln(fh(_o(e)))}}}function Om(t){const e=t.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new ax(t);case"equirectangular":return new P3(t);case"naturalEarth":return new B3(t);case"equalEarth":return new D3(t);case"winkelTripel":return new L3(t);case"albers":return i?new cx(t):new k3(t);case"lambertConformalConic":return i?new cx(t):new z3(t);case"globe":return new R3(t)}throw new Error(`Invalid projection name: ${t.name}`)}const F3=new as({"symbol-placement":new ri(xt.layout_symbol["symbol-placement"]),"symbol-spacing":new ri(xt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ri(xt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Gi(xt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ri(xt.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new ri(xt.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new ri(xt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new ri(xt.layout_symbol["icon-ignore-placement"]),"icon-optional":new ri(xt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ri(xt.layout_symbol["icon-rotation-alignment"]),"icon-size":new Gi(xt.layout_symbol["icon-size"]),"icon-text-fit":new Gi(xt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Gi(xt.layout_symbol["icon-text-fit-padding"]),"icon-image":new Gi(xt.layout_symbol["icon-image"]),"icon-rotate":new Gi(xt.layout_symbol["icon-rotate"]),"icon-padding":new ri(xt.layout_symbol["icon-padding"]),"icon-keep-upright":new ri(xt.layout_symbol["icon-keep-upright"]),"icon-offset":new Gi(xt.layout_symbol["icon-offset"]),"icon-anchor":new Gi(xt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ri(xt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ri(xt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ri(xt.layout_symbol["text-rotation-alignment"]),"text-field":new Gi(xt.layout_symbol["text-field"]),"text-font":new Gi(xt.layout_symbol["text-font"]),"text-size":new Gi(xt.layout_symbol["text-size"]),"text-max-width":new Gi(xt.layout_symbol["text-max-width"]),"text-line-height":new Gi(xt.layout_symbol["text-line-height"]),"text-letter-spacing":new Gi(xt.layout_symbol["text-letter-spacing"]),"text-justify":new Gi(xt.layout_symbol["text-justify"]),"text-radial-offset":new Gi(xt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ri(xt.layout_symbol["text-variable-anchor"]),"text-anchor":new Gi(xt.layout_symbol["text-anchor"]),"text-max-angle":new ri(xt.layout_symbol["text-max-angle"]),"text-writing-mode":new ri(xt.layout_symbol["text-writing-mode"]),"text-rotate":new Gi(xt.layout_symbol["text-rotate"]),"text-padding":new ri(xt.layout_symbol["text-padding"]),"text-keep-upright":new ri(xt.layout_symbol["text-keep-upright"]),"text-transform":new Gi(xt.layout_symbol["text-transform"]),"text-offset":new Gi(xt.layout_symbol["text-offset"]),"text-allow-overlap":new ri(xt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new ri(xt.layout_symbol["text-ignore-placement"]),"text-optional":new ri(xt.layout_symbol["text-optional"]),visibility:new ri(xt.layout_symbol.visibility)});var Rg={paint:new as({"icon-opacity":new Gi(xt.paint_symbol["icon-opacity"]),"icon-emissive-strength":new Gi(xt.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Gi(xt.paint_symbol["text-emissive-strength"]),"icon-color":new Gi(xt.paint_symbol["icon-color"]),"icon-halo-color":new Gi(xt.paint_symbol["icon-halo-color"]),"icon-halo-width":new Gi(xt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Gi(xt.paint_symbol["icon-halo-blur"]),"icon-translate":new ri(xt.paint_symbol["icon-translate"]),"icon-translate-anchor":new ri(xt.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Gi(xt.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Gi(xt.paint_symbol["text-opacity"]),"text-color":new Gi(xt.paint_symbol["text-color"],{runtimeType:tn,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new Gi(xt.paint_symbol["text-halo-color"]),"text-halo-width":new Gi(xt.paint_symbol["text-halo-width"]),"text-halo-blur":new Gi(xt.paint_symbol["text-halo-blur"]),"text-translate":new ri(xt.paint_symbol["text-translate"]),"text-translate-anchor":new ri(xt.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new ri(xt.paint_symbol["icon-color-saturation"])}),layout:F3};class ux{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Kn,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Mi(ux,"FormatSectionOverride",{omit:["defaultValue"]});class Nm extends Gl{constructor(e,i){super(e,Rg,i)}recalculate(e,i){super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const r=this.layout.get("text-writing-mode");if(r){const n=[];for(const s of r)n.indexOf(s)<0&&n.push(s);this.layout._values["text-writing-mode"]=n}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,i,r,n){const s=this.layout.get(e).evaluate(i,{},r,n),a=this._unevaluatedLayout._values[e];return a.isDataDriven()||Or(a.value)||!s?s:function(c,p){return p.replace(/{([^{}]+)}/g,(_,v)=>v in c?String(c[v]):"")}(i.properties,s)}createBucket(e){return new j0(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Rg.paint.overridableProperties){if(!Nm.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),r=new ux(i),n=new Ji(r,i.property.specification);let s=null;s=i.value.kind==="constant"||i.value.kind==="source"?new Lr("source",n):new Bn("composite",n,i.value.zoomStops,i.value._interpolationType),this.paint._values[e]=new Ps(i.property,s,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,r){return!(!this.layout||i.isDataDriven()||r.isDataDriven())&&Nm.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const r=e.get("text-field"),n=Rg.paint.properties[i];let s=!1;const a=c=>{for(const p of c)if(n.overrides&&n.overrides.hasOverride(p))return void(s=!0)};if(r.value.kind==="constant"&&r.value.value instanceof vo)a(r.value.value.sections);else if(r.value.kind==="source"){const c=_=>{s||(_ instanceof qs&&ms(_.value)===rl?a(_.value.sections):_ instanceof $n?a(_.sections):_.eachChild(c))},p=r.value;p._styleExpression&&c(p._styleExpression.expression)}return s}getProgramIds(){const e=this.paint.get("icon-opacity").constantOr(1)!==0,i=this.paint.get("text-opacity").constantOr(1)!==0,r=[];return e&&r.push("symbolIcon"),i&&r.push("symbolSDF"),r}getDefaultProgramParams(e,i){return{config:new mu(this,i),overrideFog:!1}}}const O3=Tm.types,N3=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Um(t,e,i,r,n,s,a,c,p,_,v,E,C){const B=c?Math.min(yh,Math.round(c[0])):0,O=c?Math.min(yh,Math.round(c[1])):0;t.emplaceBack(e,i,Math.round(32*r),Math.round(32*n),s,a,(B<<1)+(p?1:0),O,16*_,16*v,256*E,256*C)}function Vm(t,e,i){t.emplaceBack(e,i)}function jm(t,e,i,r,n,s,a){t.emplaceBack(e,i,r,n,s,a)}function Gm(t,e,i,r,n){const s=5*e+2;t.float32[s+0]=i,t.float32[s+1]=r,t.float32[s+2]=n}function ud(t,e,i,r,n){t.emplaceBack(e,i,r,n),t.emplaceBack(e,i,r,n),t.emplaceBack(e,i,r,n),t.emplaceBack(e,i,r,n)}function U3(t){for(const e of t.sections)if(H_(e.text))return!0;return!1}class Fg{constructor(e){this.layoutVertexArray=new jd,this.indexArray=new so,this.programConfigurations=e,this.segments=new Mn,this.dynamicLayoutVertexArray=new Vc,this.opacityVertexArray=new Gd,this.placedSymbolArray=new kp,this.iconTransitioningVertexArray=new jc,this.globeExtVertexArray=new pc,this.zOffsetVertexArray=new Rh}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,i,r,n,s){this.isEmpty()||(r&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,i3.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,n3.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,N3,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,o3.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,r3.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||s)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,s3.members,!0)),this.opacityVertexBuffer.itemSize=1),(r||n)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}Mi(Fg,"SymbolBuffers");class Og{constructor(e,i,r){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new r,this.segments=new Mn,this.collisionVertexArray=new qd,this.collisionVertexArrayExt=new Vc}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,a3.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,l3.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Mi(Og,"CollisionBuffers");class Zm{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ce.identity([]),this.placementViewportMatrix=ce.identity([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Sg(this.zoom,i["text-size"]),this.iconSizeData=Sg(this.zoom,i["icon-size"]);const r=this.layers[0].layout,n=r.get("symbol-sort-key"),s=r.get("symbol-z-order");this.canOverlap=r.get("text-allow-overlap")||r.get("icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement"),this.sortFeaturesByKey=s!=="viewport-y"&&n.constantOr(1)!==void 0,this.sortFeaturesByY=(s==="viewport-y"||s==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=r.get("text-writing-mode").map(a=>Ms[a]),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=r.get("symbol-z-elevate")}createArrays(){this.text=new Fg(new _c(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Fg(new _c(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new zp,this.lineVertexArray=new Bp,this.symbolInstances=new Pp}calculateGlyphDependencies(e,i,r,n,s){for(let a=0;a<e.length;a++){const c=e.codePointAt(a);if(c===void 0)break;if(i[c]=!0,n&&s&&c<=65535){const p=B0[e.charAt(a)];p&&(i[p.charCodeAt(0)]=!0)}}}populate(e,i,r,n){const s=this.layers[0],a=s.layout,c=this.projection.name==="globe",p=a.get("text-font"),_=a.get("text-field"),v=a.get("icon-image"),E=(_.value.kind!=="constant"||_.value.value instanceof vo&&!_.value.value.isEmpty()||_.value.value.toString().length>0)&&(p.value.kind!=="constant"||p.value.value.length>0),C=v.value.kind!=="constant"||!!v.value.value||Object.keys(v.parameters).length>0,B=a.get("symbol-sort-key");if(this.features=[],!E&&!C)return;const O=i.iconDependencies,G=i.glyphDependencies,q=i.availableImages,X=new _s(this.zoom);for(const{feature:$,id:re,index:ne,sourceLayerIndex:ie}of e){const se=s._featureFilter.needGeometry,he=ph($,se);if(!s._featureFilter.filter(X,he,r))continue;if(se||(he.geometry=yu($,r,n)),c&&$.type!==1&&r.z<=5){const Ve=he.geometry,je=.98078528056,Je=(Fe,nt)=>{const At=hh(Fe.x,Fe.y,r,1),vt=hh(nt.x,nt.y,r,1);return me.dot(At,vt)<je};for(let Fe=0;Fe<Ve.length;Fe++)Ve[Fe]=Xw(Ve[Fe],Je)}let ve,be;if(E){const Ve=s.getValueAndResolveTokens("text-field",he,r,q),je=vo.factory(Ve);U3(je)&&(this.hasRTLText=!0),(!this.hasRTLText||Nd()==="unavailable"||this.hasRTLText&&wA.isParsed())&&(ve=u3(je,s,he))}if(C){const Ve=s.getValueAndResolveTokens("icon-image",he,r,q);be=Ve instanceof fo?Ve:fo.fromString(Ve)}if(!ve&&!be)continue;const De=this.sortFeaturesByKey?B.evaluate(he,{},r):void 0;if(this.features.push({id:re,text:ve,icon:be,index:ne,sourceLayerIndex:ie,geometry:he.geometry,properties:$.properties,type:O3[$.type],sortKey:De}),be&&(O[be.namePrimary]=!0,be.nameSecondary&&(O[be.nameSecondary]=!0)),ve){const Ve=p.evaluate(he,{},r).join(","),je=a.get("text-rotation-alignment")==="map"&&a.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ms.vertical)>=0;for(const Je of ve.sections)if(Je.image)O[Je.image.namePrimary]=!0;else{const Fe=yf(ve.toString()),nt=Je.fontStack||Ve,At=G[nt]=G[nt]||{};this.calculateGlyphDependencies(Je.text,At,je,this.allowVerticalPlacement,Fe)}}}a.get("symbol-placement")==="line"&&(this.features=function($){const re={},ne={},ie=[];let se=0;function he(Ve){ie.push($[Ve]),se++}function ve(Ve,je,Je){const Fe=ne[Ve];return delete ne[Ve],ne[je]=Fe,ie[Fe].geometry[0].pop(),ie[Fe].geometry[0]=ie[Fe].geometry[0].concat(Je[0]),Fe}function be(Ve,je,Je){const Fe=re[je];return delete re[je],re[Ve]=Fe,ie[Fe].geometry[0].shift(),ie[Fe].geometry[0]=Je[0].concat(ie[Fe].geometry[0]),Fe}function De(Ve,je,Je){const Fe=Je?je[0][je[0].length-1]:je[0][0];return`${Ve}:${Fe.x}:${Fe.y}`}for(let Ve=0;Ve<$.length;Ve++){const je=$[Ve],Je=je.geometry,Fe=je.text?je.text.toString():null;if(!Fe){he(Ve);continue}const nt=De(Fe,Je),At=De(Fe,Je,!0);if(nt in ne&&At in re&&ne[nt]!==re[At]){const vt=be(nt,At,Je),rt=ve(nt,At,ie[vt].geometry);delete re[nt],delete ne[At],ne[De(Fe,ie[rt].geometry,!0)]=rt,ie[vt].geometry=null}else nt in ne?ve(nt,At,Je):At in re?be(nt,At,Je):(he(Ve),re[nt]=se-1,ne[At]=se-1)}return ie.filter(Ve=>Ve.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort(($,re)=>$.sortKey-re.sortKey)}update(e,i,r,n,s){const a=Object.keys(e).length!==0;if(a&&!this.stateDependentLayers.length)return;const c=a?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(e,i,c,r,n,s),this.icon.programConfigurations.updatePaintArrays(e,i,c,r,n,s)}updateZOffset(){const e=(s,a,c)=>{r+=a,r>s.length&&s.resize(r);for(let p=-a;p<0;p++)s.emplace(p+r,c)},i=(s,a,c)=>{n+=a,n>s.length&&s.resize(n);for(let p=-a;p<0;p++)s.emplace(p+n,c)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let r=0,n=0;for(let s=0;s<this.symbolInstances.length;s++){const a=this.symbolInstances.get(s),{numHorizontalGlyphVertices:c,numVerticalGlyphVertices:p,numIconVertices:_}=a,v=a.zOffset,E=_>0;if((c>0||p>0)&&(e(this.text.zOffsetVertexArray,c,v),e(this.text.zOffsetVertexArray,p,v)),E){const{placedIconSymbolIndex:C,verticalPlacedIconSymbolIndex:B}=a;C>=0&&i(this.icon.zOffsetVertexArray,_,v),B>=0&&i(this.icon.zOffsetVertexArray,a.numVerticalIconVertices,v)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Om(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const r=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:n,y:s}of i)this.lineVertexArray.emplaceBack(n,s);return{lineStartIndex:r,lineLength:this.lineVertexArray.length-r}}addSymbols(e,i,r,n,s,a,c,p,_,v,E,C,B,O,G,q){const X=e.indexArray,$=e.layoutVertexArray,re=e.globeExtVertexArray,ne=e.segments.prepareSegment(4*i.length,$,X,this.canOverlap?a.sortKey:void 0),ie=this.glyphOffsetArray.length,se=ne.vertexLength,he=this.allowVerticalPlacement&&c===Ms.vertical?Math.PI/2:0,ve=a.text&&a.text.sections;for(let De=0;De<i.length;De++){const{tl:Ve,tr:je,bl:Je,br:Fe,texPrimary:nt,texSecondary:At,pixelOffsetTL:vt,pixelOffsetBR:rt,minFontScaleX:lt,minFontScaleY:wt,glyphOffset:It,isSDF:St,sectionIndex:Bt}=i[De],Ft=ne.vertexLength,jt=It[1];if(Um($,_.x,_.y,Ve.x,jt+Ve.y,nt.x,nt.y,r,St,vt.x,vt.y,lt,wt),Um($,_.x,_.y,je.x,jt+je.y,nt.x+nt.w,nt.y,r,St,rt.x,vt.y,lt,wt),Um($,_.x,_.y,Je.x,jt+Je.y,nt.x,nt.y+nt.h,r,St,vt.x,rt.y,lt,wt),Um($,_.x,_.y,Fe.x,jt+Fe.y,nt.x+nt.w,nt.y+nt.h,r,St,rt.x,rt.y,lt,wt),p){const{x:Dt,y:Yt,z:fi}=p.anchor,[di,vi,bi]=p.up;jm(re,Dt,Yt,fi,di,vi,bi),jm(re,Dt,Yt,fi,di,vi,bi),jm(re,Dt,Yt,fi,di,vi,bi),jm(re,Dt,Yt,fi,di,vi,bi),ud(e.dynamicLayoutVertexArray,Dt,Yt,fi,he)}else ud(e.dynamicLayoutVertexArray,_.x,_.y,_.z,he);if(q){const Dt=At||nt;Vm(e.iconTransitioningVertexArray,Dt.x,Dt.y),Vm(e.iconTransitioningVertexArray,Dt.x+Dt.w,Dt.y),Vm(e.iconTransitioningVertexArray,Dt.x,Dt.y+Dt.h),Vm(e.iconTransitioningVertexArray,Dt.x+Dt.w,Dt.y+Dt.h)}X.emplaceBack(Ft,Ft+1,Ft+2),X.emplaceBack(Ft+1,Ft+2,Ft+3),ne.vertexLength+=4,ne.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(It[0]),De!==i.length-1&&Bt===i[De+1].sectionIndex||e.programConfigurations.populatePaintArrays($.length,a,a.index,{},B,O,G,ve&&ve[Bt])}const be=p?p.anchor:_;e.placedSymbolArray.emplaceBack(be.x,be.y,be.z,_.x,_.y,ie,this.glyphOffsetArray.length-ie,se,v,E,_.segment,r?r[0]:0,r?r[1]:0,n[0],n[1],c,0,!1,0,C,0)}_commitLayoutVertex(e,i,r,n,s,a,c){e.emplaceBack(i,r,n,s,a,Math.round(c.x),Math.round(c.y))}_addCollisionDebugVertices(e,i,r,n,s,a,c){const p=r.segments.prepareSegment(4,r.layoutVertexArray,r.indexArray),_=p.vertexLength,v=c.tileAnchorX,E=c.tileAnchorY;for(let B=0;B<4;B++)r.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(r.collisionVertexArrayExt,i,e.padding,c.zOffset),this._commitLayoutVertex(r.layoutVertexArray,n,s,a,v,E,new ct(e.x1,e.y1)),this._commitLayoutVertex(r.layoutVertexArray,n,s,a,v,E,new ct(e.x2,e.y1)),this._commitLayoutVertex(r.layoutVertexArray,n,s,a,v,E,new ct(e.x2,e.y2)),this._commitLayoutVertex(r.layoutVertexArray,n,s,a,v,E,new ct(e.x1,e.y2)),p.vertexLength+=4;const C=r.indexArray;C.emplaceBack(_,_+1),C.emplaceBack(_+1,_+2),C.emplaceBack(_+2,_+3),C.emplaceBack(_+3,_),p.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,r,n,s,a){for(let c=n;c<s;c++){const p=r.get(c),_=this.getSymbolInstanceTextSize(e,a,i,c);this._addCollisionDebugVertices(p,_,this.textCollisionBox,p.projectedAnchorX,p.projectedAnchorY,p.projectedAnchorZ,a)}}_addIconDebugCollisionBoxes(e,i,r,n,s,a){for(let c=n;c<s;c++){const p=r.get(c),_=this.getSymbolInstanceIconSize(e,i,a.placedIconSymbolIndex);this._addCollisionDebugVertices(p,_,this.iconCollisionBox,p.projectedAnchorX,p.projectedAnchorY,p.projectedAnchorZ,a)}}generateCollisionDebugBuffers(e,i){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Og(Mf,L1.members,jc),this.iconCollisionBox=new Og(Mf,L1.members,jc);const r=xu(this.iconSizeData,e),n=xu(this.textSizeData,e);for(let s=0;s<this.symbolInstances.length;s++){const a=this.symbolInstances.get(s);this._addTextDebugCollisionBoxes(n,e,i,a.textBoxStartIndex,a.textBoxEndIndex,a),this._addTextDebugCollisionBoxes(n,e,i,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a),this._addIconDebugCollisionBoxes(r,e,i,a.iconBoxStartIndex,a.iconBoxEndIndex,a),this._addIconDebugCollisionBoxes(r,e,i,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex,a)}}getSymbolInstanceTextSize(e,i,r,n){const s=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:n),a=z0(this.textSizeData,e,s)/va;return this.tilePixelRatio*a}getSymbolInstanceIconSize(e,i,r){const n=this.icon.placedSymbolArray.get(r),s=z0(this.iconSizeData,e,n);return this.tilePixelRatio*s}_commitDebugCollisionVertexUpdate(e,i,r,n){e.emplaceBack(i,-r,-r,n),e.emplaceBack(i,r,-r,n),e.emplaceBack(i,r,r,n),e.emplaceBack(i,-r,r,n)}_updateTextDebugCollisionBoxes(e,i,r,n,s,a){for(let c=n;c<s;c++){const p=r.get(c),_=this.getSymbolInstanceTextSize(e,a,i,c);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,_,p.padding,a.zOffset)}}_updateIconDebugCollisionBoxes(e,i,r,n,s,a){for(let c=n;c<s;c++){const p=r.get(c),_=this.getSymbolInstanceIconSize(e,i,a.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,_,p.padding,a.zOffset)}}updateCollisionDebugBuffers(e,i){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const r=xu(this.iconSizeData,e),n=xu(this.textSizeData,e);for(let s=0;s<this.symbolInstances.length;s++){const a=this.symbolInstances.get(s);this._updateTextDebugCollisionBoxes(n,e,i,a.textBoxStartIndex,a.textBoxEndIndex,a),this._updateTextDebugCollisionBoxes(n,e,i,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a),this._updateIconDebugCollisionBoxes(r,e,i,a.iconBoxStartIndex,a.iconBoxEndIndex,a),this._updateIconDebugCollisionBoxes(r,e,i,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex,a)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,r,n,s,a,c,p,_){const v={};if(i<r){const{x1:E,y1:C,x2:B,y2:O,padding:G,projectedAnchorX:q,projectedAnchorY:X,projectedAnchorZ:$,tileAnchorX:re,tileAnchorY:ne,featureIndex:ie}=e.get(i);v.textBox={x1:E,y1:C,x2:B,y2:O,padding:G,projectedAnchorX:q,projectedAnchorY:X,projectedAnchorZ:$,tileAnchorX:re,tileAnchorY:ne},v.textFeatureIndex=ie}if(n<s){const{x1:E,y1:C,x2:B,y2:O,padding:G,projectedAnchorX:q,projectedAnchorY:X,projectedAnchorZ:$,tileAnchorX:re,tileAnchorY:ne,featureIndex:ie}=e.get(n);v.verticalTextBox={x1:E,y1:C,x2:B,y2:O,padding:G,projectedAnchorX:q,projectedAnchorY:X,projectedAnchorZ:$,tileAnchorX:re,tileAnchorY:ne},v.verticalTextFeatureIndex=ie}if(a<c){const{x1:E,y1:C,x2:B,y2:O,padding:G,projectedAnchorX:q,projectedAnchorY:X,projectedAnchorZ:$,tileAnchorX:re,tileAnchorY:ne,featureIndex:ie}=e.get(a);v.iconBox={x1:E,y1:C,x2:B,y2:O,padding:G,projectedAnchorX:q,projectedAnchorY:X,projectedAnchorZ:$,tileAnchorX:re,tileAnchorY:ne},v.iconFeatureIndex=ie}if(p<_){const{x1:E,y1:C,x2:B,y2:O,padding:G,projectedAnchorX:q,projectedAnchorY:X,projectedAnchorZ:$,tileAnchorX:re,tileAnchorY:ne,featureIndex:ie}=e.get(p);v.verticalIconBox={x1:E,y1:C,x2:B,y2:O,padding:G,projectedAnchorX:q,projectedAnchorY:X,projectedAnchorZ:$,tileAnchorX:re,tileAnchorY:ne},v.verticalIconFeatureIndex=ie}return v}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const r=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,r.textBoxStartIndex,r.textBoxEndIndex,r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r.iconBoxStartIndex,r.iconBoxEndIndex,r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,i){const r=e.placedSymbolArray.get(i),n=r.vertexStartIndex+4*r.numGlyphs;for(let s=r.vertexStartIndex;s<n;s+=4)e.indexArray.emplaceBack(s,s+1,s+2),e.indexArray.emplaceBack(s+1,s+2,s+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),r=Math.cos(e),n=[],s=[],a=[];for(let c=0;c<this.symbolInstances.length;++c){a.push(c);const p=this.symbolInstances.get(c);n.push(0|Math.round(i*p.tileAnchorX+r*p.tileAnchorY)),s.push(p.featureIndex)}return a.sort((c,p)=>n[c]-n[p]||s[p]-s[c]),a}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,i)=>this.symbolInstances.get(i).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,i){const r=this.sortKeyRanges[this.sortKeyRanges.length-1];r&&r.sortKey===i?r.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const r=this.symbolInstances.get(i);this.featureSortOrder.push(r.featureIndex);const{rightJustifiedTextSymbolIndex:n,centerJustifiedTextSymbolIndex:s,leftJustifiedTextSymbolIndex:a,verticalPlacedTextSymbolIndex:c,placedIconSymbolIndex:p,verticalPlacedIconSymbolIndex:_}=r;n>=0&&this.addIndicesForPlacedSymbol(this.text,n),s>=0&&s!==n&&this.addIndicesForPlacedSymbol(this.text,s),a>=0&&a!==s&&a!==n&&this.addIndicesForPlacedSymbol(this.text,a),c>=0&&this.addIndicesForPlacedSymbol(this.text,c),p>=0&&this.addIndicesForPlacedSymbol(this.icon,p),_>=0&&this.addIndicesForPlacedSymbol(this.icon,_)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Mi(Zm,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Zm.MAX_GLYPHS=65535,Zm.addDynamicAttributes=ud;var j0=Zm;const V3=an([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:j3}=V3,G3=an([{name:"a_packed",components:4,type:"Float32"}]),{members:Z3}=G3,q3=Tm.types,Q3=Math.cos(Math.PI/180*37.5);class qm{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new wf,this.layoutVertexArray2=new Vc,this.indexArray=new so,this.programConfigurations=new _c(e.layers,e.zoom),this.segments=new Mn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,r,n){this.hasPattern=bg("line",this.layers,i);const s=this.layers[0].layout.get("line-sort-key"),a=[];for(const{feature:v,id:E,index:C,sourceLayerIndex:B}of e){const O=this.layers[0]._featureFilter.needGeometry,G=ph(v,O);if(!this.layers[0]._featureFilter.filter(new _s(this.zoom),G,r))continue;const q=s?s.evaluate(G,{},r):void 0,X={id:E,properties:v.properties,type:v.type,sourceLayerIndex:B,index:C,geometry:O?G.geometry:yu(v,r,n),patterns:{},sortKey:q};a.push(X)}s&&a.sort((v,E)=>v.sortKey-E.sortKey);const{lineAtlas:c,featureIndex:p}=i,_=this.addConstantDashes(c);for(const v of a){const{geometry:E,index:C,sourceLayerIndex:B}=v;if(_&&this.addFeatureDashes(v,c),this.hasPattern){const O=wg("line",this.layers,v,this.zoom,i);this.patternFeatures.push(O)}else this.addFeature(v,E,C,r,c.positions,i.availableImages,i.brightness);p.insert(e[C].feature,E,C,B,this.index)}}addConstantDashes(e){let i=!1;for(const r of this.layers){const n=r.paint.get("line-dasharray").value,s=r.layout.get("line-cap").value;if(n.kind!=="constant"||s.kind!=="constant")i=!0;else{const a=s.value,c=n.value;if(!c)continue;e.addDash(c,a)}}return i}addFeatureDashes(e,i){const r=this.zoom;for(const n of this.layers){const s=n.paint.get("line-dasharray").value,a=n.layout.get("line-cap").value;if(s.kind==="constant"&&a.kind==="constant")continue;let c,p;if(s.kind==="constant"){if(c=s.value,!c)continue}else c=s.evaluate({zoom:r},e);p=a.kind==="constant"?a.value:a.evaluate({zoom:r},e),i.addDash(c,p),e.patterns[n.id]=i.getKey(c,p)}}update(e,i,r,n,s){const a=Object.keys(e).length!==0;a&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,i,a?this.stateDependentLayers:this.layers,r,n,s)}addFeatures(e,i,r,n,s,a){for(const c of this.patternFeatures)this.addFeature(c,c.geometry,c.index,i,r,n,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Z3)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,j3),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,r,n,s,a,c){const p=this.layers[0].layout,_=p.get("line-join").evaluate(e,{}),v=p.get("line-cap").evaluate(e,{}),E=p.get("line-miter-limit"),C=p.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const B of i)this.addLine(B,e,_,v,E,C);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,s,a,n,c)}addLine(e,i,r,n,s,a){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let X=0;X<e.length-1;X++)this.totalDistance+=e[X].dist(e[X+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const c=q3[i.type]==="Polygon";let p=e.length;for(;p>=2&&e[p-1].equals(e[p-2]);)p--;let _=0;for(;_<p-1&&e[_].equals(e[_+1]);)_++;if(p<(c?3:2))return;r==="bevel"&&(s=1.05);const v=this.overscaling<=16?15*Mt/(512*this.overscaling):0,E=this.segments.prepareSegment(10*p,this.layoutVertexArray,this.indexArray);let C,B,O,G,q;this.e1=this.e2=-1,c&&(C=e[p-2],q=e[_].sub(C)._unit()._perp());for(let X=_;X<p;X++){if(O=X===p-1?c?e[_+1]:void 0:e[X+1],O&&e[X].equals(O))continue;q&&(G=q),C&&(B=C),C=e[X],q=O?O.sub(C)._unit()._perp():G,G=G||q;let $=G.add(q);$.x===0&&$.y===0||$._unit();const re=G.x*q.x+G.y*q.y,ne=$.x*q.x+$.y*q.y,ie=ne!==0?1/ne:1/0,se=2*Math.sqrt(2-2*ne),he=ne<Q3&&B&&O,ve=G.x*q.y-G.y*q.x>0;if(he&&X>_){const Ve=C.dist(B);if(Ve>2*v){const je=C.sub(C.sub(B)._mult(v/Ve)._round());this.updateDistance(B,je),this.addCurrentVertex(je,G,0,0,E),B=je}}const be=B&&O;let De=be?r:c?"butt":n;if(be&&De==="round"&&(ie<a?De="miter":ie<=2&&(De="fakeround")),De==="miter"&&ie>s&&(De="bevel"),De==="bevel"&&(ie>2&&(De="flipbevel"),ie<s&&(De="miter")),B&&this.updateDistance(B,C),De==="miter")$._mult(ie),this.addCurrentVertex(C,$,0,0,E);else if(De==="flipbevel"){if(ie>100)$=q.mult(-1);else{const Ve=ie*G.add(q).mag()/G.sub(q).mag();$._perp()._mult(Ve*(ve?-1:1))}this.addCurrentVertex(C,$,0,0,E),this.addCurrentVertex(C,$.mult(-1),0,0,E)}else if(De==="bevel"||De==="fakeround"){const Ve=-Math.sqrt(ie*ie-1),je=ve?Ve:0,Je=ve?0:Ve;if(B&&this.addCurrentVertex(C,G,je,Je,E),De==="fakeround"){const Fe=Math.round(180*se/Math.PI/20);for(let nt=1;nt<Fe;nt++){let At=nt/Fe;if(At!==.5){const rt=At-.5;At+=At*rt*(At-1)*((1.0904+re*(re*(3.55645-1.43519*re)-3.2452))*rt*rt+(.848013+re*(.215638*re-1.06021)))}const vt=q.sub(G)._mult(At)._add(G)._unit()._mult(ve?-1:1);this.addHalfVertex(C,vt.x,vt.y,!1,ve,0,E)}}O&&this.addCurrentVertex(C,q,-je,-Je,E)}else if(De==="butt")this.addCurrentVertex(C,$,0,0,E);else if(De==="square"){const Ve=B?1:-1;B||this.addCurrentVertex(C,$,Ve,Ve,E),this.addCurrentVertex(C,$,0,0,E),B&&this.addCurrentVertex(C,$,Ve,Ve,E)}else De==="round"&&(B&&(this.addCurrentVertex(C,G,0,0,E),this.addCurrentVertex(C,G,1,1,E,!0)),O&&(this.addCurrentVertex(C,q,-1,-1,E,!0),this.addCurrentVertex(C,q,0,0,E)));if(he&&X<p-1){const Ve=C.dist(O);if(Ve>2*v){const je=C.add(O.sub(C)._mult(v/Ve)._round());this.updateDistance(C,je),this.addCurrentVertex(je,q,0,0,E),C=je}}}}addCurrentVertex(e,i,r,n,s,a=!1){const c=i.y*n-i.x,p=-i.y-i.x*n;this.addHalfVertex(e,i.x+i.y*r,i.y-i.x*r,a,!1,r,s),this.addHalfVertex(e,c,p,a,!0,-n,s)}addHalfVertex({x:e,y:i},r,n,s,a,c,p){this.layoutVertexArray.emplaceBack((e<<1)+(s?1:0),(i<<1)+(a?1:0),Math.round(63*r)+128,Math.round(63*n)+128,1+(c===0?0:c<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const _=p.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,_),p.primitiveLength++),a?this.e2=_:this.e1=_}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,i){this.distance+=e.dist(i),this.updateScaledDistance()}}Mi(qm,"LineBucket",{omit:["layers","patternFeatures"]});class Bs{constructor(e,i,r,n){this.context=e,this.format=r,this.texture=e.gl.createTexture(),this.update(i,n)}update(e,i,r){const{width:n,height:s}=e,{context:a}=this,{gl:c}=a,{HTMLImageElement:p,HTMLCanvasElement:_,HTMLVideoElement:v,ImageData:E,ImageBitmap:C}=Ee;if(c.bindTexture(c.TEXTURE_2D,this.texture),a.pixelStoreUnpackFlipY.set(!1),a.pixelStoreUnpack.set(1),a.pixelStoreUnpackPremultiplyAlpha.set(this.format===c.RGBA&&(!i||i.premultiply!==!1)),r||this.size&&this.size[0]===n&&this.size[1]===s){const{x:B,y:O}=r||{x:0,y:0};if(e instanceof p||e instanceof _||e instanceof v||e instanceof E||C&&e instanceof C)c.texSubImage2D(c.TEXTURE_2D,0,B,O,c.RGBA,c.UNSIGNED_BYTE,e);else{let G=this.format,q=c.UNSIGNED_BYTE;this.format===c.R32F&&(G=c.RED,q=c.FLOAT),c.texSubImage2D(c.TEXTURE_2D,0,B,O,n,s,G,q,e.data)}}else if(this.size=[n,s],e instanceof p||e instanceof _||e instanceof v||e instanceof E||C&&e instanceof C){let B=this.format;this.format===c.R8&&(B=c.RED),c.texImage2D(c.TEXTURE_2D,0,this.format,B,c.UNSIGNED_BYTE,e)}else{let B=this.format,O=this.format,G=c.UNSIGNED_BYTE;this.format===c.DEPTH_COMPONENT&&(B=c.DEPTH_COMPONENT16,G=c.UNSIGNED_SHORT),this.format===c.R32F&&(G=c.FLOAT,O=c.RED),c.texImage2D(c.TEXTURE_2D,0,B,n,s,0,O,G,e.data)}this.useMipmap=!!(i&&i.useMipmap),this.useMipmap&&c.generateMipmap(c.TEXTURE_2D)}bind(e,i){const{context:r}=this,{gl:n}=r;n.bindTexture(n.TEXTURE_2D,this.texture),e!==this.minFilter&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,this.useMipmap?e===n.NEAREST?n.NEAREST_MIPMAP_NEAREST:n.LINEAR_MIPMAP_NEAREST:e),this.minFilter=e),i!==this.wrapS&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,i),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,i),this.wrapS=i)}bindExtraParam(e,i,r,n){const{context:s}=this,{gl:a}=s;a.bindTexture(a.TEXTURE_2D,this.texture),i!==this.magFilter&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,i),this.magFilter=i),e!==this.minFilter&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,this.useMipmap?e===a.NEAREST?a.NEAREST_MIPMAP_NEAREST:a.LINEAR_MIPMAP_NEAREST:e),this.minFilter=e),r!==this.wrapS&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,r),this.wrapS=r),n!==this.wrapT&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,n),this.wrapT=n)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Qm{constructor(e,i){this.context=e,this.texture=i}bind(e,i){const{context:r}=this,{gl:n}=r;n.bindTexture(n.TEXTURE_2D,this.texture),e!==this.minFilter&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,e),this.minFilter=e),i!==this.wrapS&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,i),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,i),this.wrapS=i)}}const wc=32,vu=33,vh=new Uint16Array(8184);for(let t=0;t<2046;t++){let e=t+2,i=0,r=0,n=0,s=0,a=0,c=0;for(1&e?n=s=a=wc:i=r=c=wc;(e>>=1)>1;){const _=i+n>>1,v=r+s>>1;1&e?(n=i,s=r,i=a,r=c):(i=n,r=s,n=a,s=c),a=_,c=v}const p=4*t;vh[p+0]=i,vh[p+1]=r,vh[p+2]=n,vh[p+3]=s}const bu=new Uint16Array(2178),bh=new Uint8Array(1089),Hm=new Uint16Array(1089);function hx(t){return t===0?-.03125:t===32?.03125:0}var Ng=an([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const fx={type:2,extent:Mt,loadGeometry:()=>[[new ct(0,0),new ct(Mt+1,0),new ct(Mt+1,Mt+1),new ct(0,Mt+1),new ct(0,0)]]};class G0{constructor(e,i,r,n,s){this.tileID=e,this.uid=cs(),this.uses=0,this.tileSize=i,this.tileZoom=r,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=s,n&&n.style&&(this._lastUpdatedBrightness=n.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",n&&n.transform&&(this.projection=n.transform.projection)}registerFadeDuration(e){const i=e+this.timeAdded;i<Wi.now()||this.fadeEndTime&&i<this.fadeEndTime||(this.fadeEndTime=i)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=tf(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,i,r){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(n,s){const a={};if(!s)return a;for(const c of n){const p=c.layerIds.map(_=>s.getLayer(_)).filter(Boolean);if(p.length!==0){c.layers=p,c.stateDependentLayerIds&&(c.stateDependentLayers=c.stateDependentLayerIds.map(_=>p.filter(v=>v.id===_)[0]));for(const _ of p)a[_.fqid]=c}}return a}(e.buckets,i.style),this.hasSymbolBuckets=!1;for(const n in this.buckets){const s=this.buckets[n];if(s instanceof j0){if(this.hasSymbolBuckets=!0,!r)break;s.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const n in this.buckets){const s=this.buckets[n];if(s instanceof j0&&s.hasRTLText){this.hasRTLText=!0,wA.isLoading()||wA.isLoaded()||Nd()!=="deferred"||Ep();break}}this.queryPadding=0;for(const n in this.buckets){const s=this.buckets[n],a=i.style.getOwnLayer(n);if(!a)continue;const c=a.queryRadius(s);this.queryPadding=Math.max(this.queryPadding,c)}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas),this._lastUpdatedBrightness=e.brightness}else this.collisionBoxArray=new Nu}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.fqid]}upload(e){for(const r in this.buckets){const n=this.buckets[r];n.uploadPending()&&n.upload(e)}const i=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Bs(e,this.imageAtlas.image,i.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Bs(e,this.glyphAtlasImage,i.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Bs(e,this.lineAtlas.image,i.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e,i,r){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture,r),!i||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const n=i.style.getBrightness();(this._lastUpdatedBrightness||n)&&(this._lastUpdatedBrightness&&n&&Math.abs(this._lastUpdatedBrightness-n)<.001||(this._lastUpdatedBrightness=n,this.updateBuckets(void 0,i)))}queryRenderedFeatures(e,i,r,n,s,a,c,p){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:n,pixelPosMatrix:c,transform:a,params:s,tileTransform:this.tileTransform},e,i,r):{}}querySourceFeatures(e,i){const r=this.latestFeatureIndex;if(!r||!r.rawTileData)return;const n=r.loadVTLayers(),s=i?i.sourceLayer:"",a=n._geojsonTileLayer||n[s];if(!a)return;const c=mo(i&&i.filter),{z:p,x:_,y:v}=this.tileID.canonical,E={z:p,x:_,y:v};for(let C=0;C<a.length;C++){const B=a.feature(C);if(c.needGeometry){const q=ph(B,!0);if(!c.filter(new _s(this.tileID.overscaledZ),q,this.tileID.canonical))continue}else if(!c.filter(new _s(this.tileID.overscaledZ),B))continue;const O=r.getId(B,s),G=new M1(B,p,_,v,O);G.tile=E,e.push(G)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}bucketsLoaded(){for(const e in this.buckets)if(this.buckets[e].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const i=this.expirationTime;if(e.cacheControl){const r=Ri(e.cacheControl);r["max-age"]&&(this.expirationTime=Date.now()+1e3*r["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const r=Date.now();let n=!1;if(this.expirationTime>r)n=!1;else if(i)if(this.expirationTime<i)n=!0;else{const s=this.expirationTime-i;s?this.expirationTime=r+Math.max(s,3e4):n=!0}else n=!0;n?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,i){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(e).length!==0&&i&&this.updateBuckets(e,i)}updateBuckets(e,i){if(!this.latestFeatureIndex)return;const r=this.latestFeatureIndex.loadVTLayers(),n=i.style.listImages(),s=i.style.getBrightness();for(const a in this.buckets){if(!i.style.hasLayer(a))continue;const c=this.buckets[a],p=c.layers[0].sourceLayer||"_geojsonTileLayer",_=r[p];let v={};if(e&&(v=e[p],!_||!v||Object.keys(v).length===0))continue;if(c.update(v,_,n,this.imageAtlas&&this.imageAtlas.patternPositions||{},s),c instanceof qm||c instanceof bm){const C=i.style.getOwnSourceCache(c.layers[0].source);i._terrain&&i._terrain.enabled&&C&&c.programConfigurations.needsUpload&&i._terrain._clearRenderCacheForTile(C.id,this.tileID)}const E=i&&i.style&&i.style.getOwnLayer(a);E&&(this.queryPadding=Math.max(this.queryPadding,E.queryRadius(c)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Wi.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Wi.now()+e}setTexture(e,i){const r=i.context,n=r.gl;this.texture=this.texture||i.getTileTexture(e.width),this.texture&&this.texture instanceof Bs?this.texture.update(e,{useMipmap:!0}):(this.texture=new Bs(r,e,n.RGBA,{useMipmap:!0}),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE))}setDependencies(e,i){const r={};for(const n of i)r[n]=!0;this.dependencies[e]=r}hasDependency(e,i){for(const r of e){const n=this.dependencies[r];if(n){for(const s of i)if(n[s])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,i){if(!i||i.name==="mercator"||this._tileDebugBuffer)return;const r=yu(fx,this.tileID.canonical,this.tileTransform)[0],n=new pl,s=new Gc;for(let a=0;a<r.length;a++){const{x:c,y:p}=r[a];n.emplaceBack(c,p),s.emplaceBack(a)}s.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(s),this._tileDebugBuffer=e.createVertexBuffer(n,xi.members),this._tileDebugSegments=Mn.simpleSegment(0,0,n.length,s.length)}_makeTileBoundsBuffers(e,i){if(this._tileBoundsBuffer||!i||i.name==="mercator")return;const r=yu(fx,this.tileID.canonical,this.tileTransform)[0];let n,s;if(this.isRaster){const a=function(c,p){const _=tf(c,p),v=Math.pow(2,c.z);for(let q=0;q<vu;q++)for(let X=0;X<vu;X++){const $=MA((c.x+(X+hx(X))/wc)/v),re=Lo((c.y+(q+hx(q))/wc)/v),ne=p.project($,re),ie=q*vu+X;bu[2*ie+0]=Math.round((ne.x*_.scale-_.x)*Mt),bu[2*ie+1]=Math.round((ne.y*_.scale-_.y)*Mt)}bh.fill(0),Hm.fill(0);for(let q=2045;q>=0;q--){const X=4*q,$=vh[X+0],re=vh[X+1],ne=vh[X+2],ie=vh[X+3],se=$+ne>>1,he=re+ie>>1,ve=se+he-re,be=he+$-se,De=re*vu+$,Ve=ie*vu+ne,je=he*vu+se,Je=Math.hypot((bu[2*De+0]+bu[2*Ve+0])/2-bu[2*je+0],(bu[2*De+1]+bu[2*Ve+1])/2-bu[2*je+1])>=16;bh[je]=bh[je]||(Je?1:0),q<1022&&(bh[je]=bh[je]||bh[(re+be>>1)*vu+($+ve>>1)]||bh[(ie+be>>1)*vu+(ne+ve>>1)])}const E=new Uc,C=new so;let B=0;function O(q,X){const $=X*vu+q;return Hm[$]===0&&(E.emplaceBack(bu[2*$+0],bu[2*$+1],q*Mt/wc,X*Mt/wc),Hm[$]=++B),Hm[$]-1}function G(q,X,$,re,ne,ie){const se=q+$>>1,he=X+re>>1;if(Math.abs(q-ne)+Math.abs(X-ie)>1&&bh[he*vu+se])G(ne,ie,q,X,se,he),G($,re,ne,ie,se,he);else{const ve=O(q,X),be=O($,re),De=O(ne,ie);C.emplaceBack(ve,be,De)}}return G(0,0,wc,wc,wc,0),G(wc,wc,0,0,0,wc),{vertices:E,indices:C}}(this.tileID.canonical,i);n=a.vertices,s=a.indices}else{n=new Uc,s=new so;for(const{x:c,y:p}of r)n.emplaceBack(c,p,0,0);const a=vm(n.int16,void 0,4);for(let c=0;c<a.length;c+=3)s.emplaceBack(a[c],a[c+1],a[c+2])}this._tileBoundsBuffer=e.createVertexBuffer(n,Ng.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(s),this._tileBoundsSegments=Mn.simpleSegment(0,0,n.length,s.length)}_makeGlobeTileDebugBuffers(e,i){const r=i.projection;if(!r||r.name!=="globe"||i.freezeTileCoverage)return;const n=this.tileID.canonical,s=_l(TA(n,i)),a=Ho(i.zoom);let c;a>0&&(c=ce.invert(new Float64Array(16),i.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,n,i,s,c,a),this._makeGlobeTileDebugTextBuffer(e,n,i,s,c,a)}_globePoint(e,i,r,n,s,a,c){let p=hh(e,i,r);if(a){const _=1<<r.z,v=Wo(n.center.lng),E=oa(n.center.lat),C=(r.x+.5)/_-v;let B=0;C>.5?B=-1:C<-.5&&(B=1);let O=(e/Mt+r.x)/_+B,G=(i/Mt+r.y)/_;O=(O-v)*n._pixelsPerMercatorPixel+v,G=(G-E)*n._pixelsPerMercatorPixel+E;const q=[O*n.worldSize,G*n.worldSize,0];me.transformMat4(q,q,a),p=ya(p,q,c)}return me.transformMat4(p,p,s)}_makeGlobeTileDebugBorderBuffer(e,i,r,n,s,a){const c=new pl,p=new Gc,_=new rh,v=(C,B,O,G,q)=>{const X=(O-C)/(q-1),$=(G-B)/(q-1),re=c.length;for(let ne=0;ne<q;ne++){const ie=C+ne*X,se=B+ne*$;c.emplaceBack(ie,se);const he=this._globePoint(ie,se,i,r,n,s,a);_.emplaceBack(he[0],he[1],he[2]),p.emplaceBack(re+ne)}},E=Mt;v(0,0,E,0,16),v(E,0,E,E,16),v(E,E,0,E,16),v(0,E,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(p),this._tileDebugBuffer=e.createVertexBuffer(c,xi.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(_,ki.members),this._tileDebugSegments=Mn.simpleSegment(0,0,c.length,p.length)}_makeGlobeTileDebugTextBuffer(e,i,r,n,s,a){const c=Mt/4,p=new pl,_=new so,v=new rh,E=25;_.reserve(32),p.reserve(E),v.reserve(E);const C=(B,O)=>E*B+O;for(let B=0;B<E;B++){const O=B*c;for(let G=0;G<E;G++){const q=G*c;p.emplaceBack(q,O);const X=this._globePoint(q,O,i,r,n,s,a);v.emplaceBack(X[0],X[1],X[2])}}for(let B=0;B<4;B++)for(let O=0;O<4;O++){const G=C(B,O),q=C(B,O+1),X=C(B+1,O),$=C(B+1,O+1);_.emplaceBack(G,q,X),_.emplaceBack(X,q,$)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(_),this._tileDebugTextBuffer=e.createVertexBuffer(p,xi.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(v,ki.members),this._tileDebugTextSegments=Mn.simpleSegment(0,0,E,32)}destroy(e=!1){for(const i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!e&&this.texture&&this.texture instanceof Bs&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.latestFeatureIndex=null,this.state="unloaded"}}class H3{constructor(e,i){this.max=e,this.onRemove=i,this.reset()}reset(){for(const e in this.data)for(const i of this.data[e])i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value);return this.data={},this.order=[],this}add(e,i,r){const n=e.wrapped().key;this.data[n]===void 0&&(this.data[n]=[]);const s={value:i,timeout:void 0};if(r!==void 0&&(s.timeout=setTimeout(()=>{this.remove(e,s)},r)),this.data[n].push(s),this.order.push(n),this.order.length>this.max){const a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const i=this.data[e].shift();return i.timeout&&clearTimeout(i.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),i.value}getByKey(e){const i=this.data[e];return i?i[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,i){if(!this.has(e))return this;const r=e.wrapped().key,n=i===void 0?0:this.data[r].indexOf(i),s=this.data[r][n];return this.data[r].splice(n,1),s.timeout&&clearTimeout(s.timeout),this.data[r].length===0&&delete this.data[r],this.onRemove(s.value),this.order.splice(this.order.indexOf(r),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const i=this._getAndRemoveByKey(this.order[0]);i&&this.onRemove(i)}return this}filter(e){const i=[];for(const r in this.data)for(const n of this.data[r])e(n.value)||i.push(n);for(const r of i)this.remove(r.value.tileID,r)}}class wh{constructor(e,i,r,n){this.id=wh.uniqueIdxCounter,wh.uniqueIdxCounter++,this.context=e;const s=e.gl;this.buffer=s.createBuffer(),this.dynamicDraw=!!r,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),s.bufferData(s.ELEMENT_ARRAY_BUFFER,i.arrayBuffer,this.dynamicDraw?s.DYNAMIC_DRAW:s.STATIC_DRAW),this.dynamicDraw||n||i.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){this.id=wh.uniqueIdxCounter,wh.uniqueIdxCounter++;const i=this.context.gl;this.context.unbindVAO(),this.bind(),i.bufferSubData(i.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}wh.uniqueIdxCounter=0;const W3={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class X3{constructor(e,i,r,n,s,a){this.length=i.length,this.attributes=r,this.itemSize=i.bytesPerElement,this.dynamicDraw=n,this.instanceCount=a,this.context=e;const c=e.gl;this.buffer=c.createBuffer(),e.bindVertexBuffer.set(this.buffer),c.bufferData(c.ARRAY_BUFFER,i.arrayBuffer,this.dynamicDraw?c.DYNAMIC_DRAW:c.STATIC_DRAW),this.dynamicDraw||s||i.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){const i=this.context.gl;this.bind(),i.bufferSubData(i.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,i){for(let r=0;r<this.attributes.length;r++){const n=i.attributes[this.attributes[r].name];n!==void 0&&e.enableVertexAttribArray(n)}}setVertexAttribPointers(e,i,r){for(let n=0;n<this.attributes.length;n++){const s=this.attributes[n],a=i.attributes[s.name];a!==void 0&&e.vertexAttribPointer(a,s.components,e[W3[s.type]],!1,this.itemSize,s.offset+this.itemSize*(r||0))}}setVertexAttribDivisor(e,i,r){for(let n=0;n<this.attributes.length;n++){const s=i.attributes[this.attributes[n].name];s!==void 0&&this.instanceCount&&this.instanceCount>0&&e.vertexAttribDivisor(s,r)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class xs{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Y3 extends xs{getDefault(){return fr.transparent}set(e){const i=this.current;(e.r!==i.r||e.g!==i.g||e.b!==i.b||e.a!==i.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class K3 extends xs{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class J3 extends xs{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class $3 extends xs{getDefault(){return[!0,!0,!0,!0]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||e[2]!==i[2]||e[3]!==i[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class eT extends xs{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class tT extends xs{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class iT extends xs{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const i=this.current;(e.func!==i.func||e.ref!==i.ref||e.mask!==i.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class rT extends xs{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||e[2]!==i[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class nT extends xs{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;e?i.enable(i.STENCIL_TEST):i.disable(i.STENCIL_TEST),this.current=e,this.dirty=!1}}class sT extends xs{getDefault(){return[0,1]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class oT extends xs{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;e?i.enable(i.DEPTH_TEST):i.disable(i.DEPTH_TEST),this.current=e,this.dirty=!1}}class aT extends xs{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class lT extends xs{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;e?i.enable(i.BLEND):i.disable(i.BLEND),this.current=e,this.dirty=!1}}class AT extends xs{getDefault(){const e=this.gl;return[e.ONE,e.ZERO,e.ONE,e.ZERO]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||e[2]!==i[2]||e[3]!==i[3]||this.dirty)&&(this.gl.blendFuncSeparate(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class cT extends xs{getDefault(){return fr.transparent}set(e){const i=this.current;(e.r!==i.r||e.g!==i.g||e.b!==i.b||e.a!==i.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class uT extends xs{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(e,e),this.current=e,this.dirty=!1)}}class hT extends xs{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;e?i.enable(i.CULL_FACE):i.disable(i.CULL_FACE),this.current=e,this.dirty=!1}}class fT extends xs{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class dT extends xs{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}let pT=class extends xs{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}};class mT extends xs{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class _T extends xs{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||e[2]!==i[2]||e[3]!==i[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class gT extends xs{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.bindFramebuffer(i.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class yT extends xs{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.bindRenderbuffer(i.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class xT extends xs{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.bindTexture(i.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class vT extends xs{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.bindBuffer(i.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class bT extends xs{getDefault(){return null}set(e){const i=this.gl;i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class wT extends xs{getDefault(){return null}set(e){this.gl&&(e!==this.current||this.dirty)&&(this.gl.bindVertexArray(e),this.current=e,this.dirty=!1)}}class TT extends xs{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.pixelStorei(i.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class ET extends xs{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class MT extends xs{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class Ug extends xs{constructor(e,i){super(e),this.context=e,this.parent=i}getDefault(){return null}}class ST extends Ug{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const i=this.gl;i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class dx extends Ug{attachment(){return this.gl.DEPTH_ATTACHMENT}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const i=this.gl;i.framebufferRenderbuffer(i.FRAMEBUFFER,this.attachment(),i.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class IT extends Ug{attachment(){return this.gl.DEPTH_ATTACHMENT}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const i=this.gl;i.framebufferTexture2D(i.FRAMEBUFFER,this.attachment(),i.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class CT extends dx{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class kT{constructor(e,i,r,n,s){this.context=e,this.width=i,this.height=r;const a=this.framebuffer=e.gl.createFramebuffer();n&&(this.colorAttachment=new ST(e,a)),s&&(this.depthAttachmentType=s,this.depthAttachment=s==="renderbuffer"?new dx(e,a):new IT(e,a))}destroy(){const e=this.context.gl;if(this.colorAttachment){const i=this.colorAttachment.get();i&&e.deleteTexture(i)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const i=this.depthAttachment.get();i&&e.deleteRenderbuffer(i)}else{const i=this.depthAttachment.get();i&&e.deleteTexture(i)}e.deleteFramebuffer(this.framebuffer)}}class lr{constructor(e,i,r){this.func=e,this.mask=i,this.range=r}}lr.ReadOnly=!1,lr.ReadWrite=!0,lr.disabled=new lr(519,lr.ReadOnly,[0,1]);const Vg=7680;class Br{constructor(e,i,r,n,s,a){this.test=e,this.ref=i,this.mask=r,this.fail=n,this.depthFail=s,this.pass=a}}Br.disabled=new Br({func:519,mask:0},0,0,Vg,Vg,Vg);const Wm=771;class An{constructor(e,i,r,n){this.blendFunction=e,this.blendColor=i,this.mask=r,this.blendEquation=n}}An.Replace=[1,0,1,0],An.disabled=new An(An.Replace,fr.transparent,[!1,!1,!1,!1]),An.unblended=new An(An.Replace,fr.transparent,[!0,!0,!0,!0]),An.alphaBlended=new An([1,Wm,1,Wm],fr.transparent,[!0,!0,!0,!0]),An.multiply=new An([774,0,774,0],fr.transparent,[!0,!0,!0,!0]);const jg=1029,Gg=2305;class Fr{constructor(e,i,r){this.enable=e,this.mode=i,this.frontFace=r}}Fr.disabled=new Fr(!1,jg,Gg),Fr.backCCW=new Fr(!0,jg,Gg),Fr.backCW=new Fr(!0,jg,2304),Fr.frontCW=new Fr(!0,1028,2304),Fr.frontCCW=new Fr(!0,1028,Gg);class DT{constructor(e,i){this.gl=e,this.clearColor=new Y3(this),this.clearDepth=new K3(this),this.clearStencil=new J3(this),this.colorMask=new $3(this),this.depthMask=new eT(this),this.stencilMask=new tT(this),this.stencilFunc=new iT(this),this.stencilOp=new rT(this),this.stencilTest=new nT(this),this.depthRange=new sT(this),this.depthTest=new oT(this),this.depthFunc=new aT(this),this.blend=new lT(this),this.blendFunc=new AT(this),this.blendColor=new cT(this),this.blendEquation=new uT(this),this.cullFace=new hT(this),this.cullFaceSide=new fT(this),this.frontFace=new dT(this),this.program=new pT(this),this.activeTexture=new mT(this),this.viewport=new _T(this),this.bindFramebuffer=new gT(this),this.bindRenderbuffer=new yT(this),this.bindTexture=new xT(this),this.bindVertexBuffer=new vT(this),this.bindElementBuffer=new bT(this),this.bindVertexArrayOES=new wT(this),this.pixelStoreUnpack=new TT(this),this.pixelStoreUnpackPremultiplyAlpha=new ET(this),this.pixelStoreUnpackFlipY=new MT(this),this.options=i?{...i}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=e.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=e.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=e.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=e.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=e.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=e.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,i,r){return new wh(this,e,i,r)}createVertexBuffer(e,i,r,n,s){return new X3(this,e,i,r,n,s)}createRenderbuffer(e,i,r){const n=this.gl,s=n.createRenderbuffer();return this.bindRenderbuffer.set(s),n.renderbufferStorage(n.RENDERBUFFER,e,i,r),this.bindRenderbuffer.set(null),s}createFramebuffer(e,i,r,n){return new kT(this,e,i,r,n)}clear({color:e,depth:i,stencil:r,colorMask:n}){const s=this.gl;let a=0;e&&(a|=s.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set(n||[!0,!0,!0,!0])),i!==void 0&&(a|=s.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(i),this.depthMask.set(!0)),r!==void 0&&(a|=s.STENCIL_BUFFER_BIT,this.clearStencil.set(r),this.stencilMask.set(255)),s.clear(a)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){Lt(e.blendFunction,An.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor),e.blendEquation?this.blendEquation.set(e.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(e.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}class iu extends ss{constructor(e,i,r){super(),this.id=e,this._onlySymbols=r,i.on("data",n=>{n.dataType==="source"&&n.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&n.dataType==="source"&&n.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),i.on("error",()=>{this._sourceErrored=!0}),this._source=i,this._tiles={},this._cache=new H3(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=i.minTileCacheSize,this._maxTileCacheSize=i.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Y2,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const i=this._tiles[e];if(i.state!=="errored"&&(i.state!=="loaded"||!i.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,i){return e.isSymbolTile=this._onlySymbols,e.isExtraShadowCaster=this._shadowCasterTiles[e.tileID.key],this._source.loadTile(e,i)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const i in this._tiles){const r=this._tiles[i];r.upload(e),r.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Zn(this._tiles).map(e=>e.tileID).sort(px).map(e=>e.key)}getRenderableIds(e,i){const r=[];for(const n in this._tiles)this._isIdRenderable(+n,e,i)&&r.push(this._tiles[n]);return e?r.sort((n,s)=>{const a=n.tileID,c=s.tileID,p=new ct(a.canonical.x,a.canonical.y)._rotate(this.transform.angle),_=new ct(c.canonical.x,c.canonical.y)._rotate(this.transform.angle);return a.overscaledZ-c.overscaledZ||_.y-p.y||_.x-p.x}).map(n=>n.tileID.key):r.map(n=>n.tileID).sort(px).map(n=>n.key)}hasRenderableParent(e){const i=this.findLoadedParent(e,0);return!!i&&this._isIdRenderable(i.tileID.key)}_isIdRenderable(e,i,r){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(i||!this._tiles[e].holdingForFade())&&(r||!this._shadowCasterTiles[e])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,i){const r=this._tiles[e];r&&(r.state!=="loading"&&(r.state=i),this._loadTile(r,this._tileLoaded.bind(this,r,e,i)))}_tileLoaded(e,i,r,n){if(n)if(e.state="errored",n.status!==404)this._source.fire(new $i(n,{tile:e}));else{if(!(e.tileID.key in this._loadedParentTiles))return void this._source.fire(new Jt("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id}));if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const s=this.map.painter.terrain;this.update(this.transform,s.getScaledDemTileSize(),!0),s.resetTileLookupCache(this.id)}else this.update(this.transform)}else e.timeAdded=Wi.now(),r==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(i,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Jt("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const i=this.getRenderableIds();for(let n=0;n<i.length;n++){const s=i[n];if(e.neighboringTiles&&e.neighboringTiles[s]){const a=this.getTileByID(s);r(e,a),r(a,e)}}function r(n,s){if(!n.dem||n.dem.borderReady)return;n.needsHillshadePrepare=!0,n.needsDEMTextureUpload=!0;let a=s.tileID.canonical.x-n.tileID.canonical.x;const c=s.tileID.canonical.y-n.tileID.canonical.y,p=Math.pow(2,n.tileID.canonical.z),_=s.tileID.key;a===0&&c===0||Math.abs(c)>1||(Math.abs(a)>1&&(Math.abs(a+p)===1?a+=p:Math.abs(a-p)===1&&(a-=p)),s.dem&&n.dem&&(n.dem.backfillBorder(s.dem,a,c),n.neighboringTiles&&n.neighboringTiles[_]&&(n.neighboringTiles[_].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,i,r,n){for(const s in this._tiles){let a=this._tiles[s];if(n[s]||!a.hasData()||a.tileID.overscaledZ<=i||a.tileID.overscaledZ>r)continue;let c=a.tileID;for(;a&&a.tileID.overscaledZ>i+1;){const _=a.tileID.scaledTo(a.tileID.overscaledZ-1);a=this._tiles[_.key],a&&a.hasData()&&(c=_)}let p=c;for(;p.overscaledZ>i;)if(p=p.scaledTo(p.overscaledZ-1),e[p.key]){n[c.key]=c;break}}}findLoadedParent(e,i){if(e.key in this._loadedParentTiles){const r=this._loadedParentTiles[e.key];return r&&r.tileID.overscaledZ>=i?r:null}for(let r=e.overscaledZ-1;r>=i;r--){const n=e.scaledTo(r),s=this._getLoadedTile(n);if(s)return s}}_getLoadedTile(e){const i=this._tiles[e.key];return i&&i.hasData()?i:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,i){i=i||this._source.tileSize;const r=Math.ceil(e.width/i)+1,n=Math.ceil(e.height/i)+1,s=Math.floor(r*n*5),a=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,s):s,c=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,a):a;this._cache.setMaxSize(c)}handleWrapJump(e){const i=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,i){const r={};for(const n in this._tiles){const s=this._tiles[n];s.tileID=s.tileID.unwrapTo(s.tileID.wrap+i),r[s.tileID.key]=s}this._tiles=r;for(const n in this._timers)clearTimeout(this._timers[n]),delete this._timers[n];for(const n in this._tiles)this._setTileReloadTimer(+n,this._tiles[n])}}update(e,i,r,n){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!r)return;let s;if(this.updateCacheSize(e,i),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?s=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(p=>new ui(p.canonical.z,p.wrap,p.canonical.z,p.canonical.x,p.canonical.y)):(s=e.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!r,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(s=s.filter(p=>this._source.hasTile(p)))):s=[],s.length>0&&this.castsShadows&&n&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Zg(this._source.type)){const p=e.coveringZoomLevel({tileSize:i||this._source.tileSize,roundZoom:this._source.roundZoom&&!r}),_=Math.min(p,this._source.maxzoom),v=e.extendTileCoverForShadows(s,n,_);for(const E of v)this._shadowCasterTiles[E.key]=!0,s.push(E)}const a=this._updateRetainedTiles(s);if(Zg(this._source.type)&&s.length!==0){const p={},_={},v=Object.keys(a);for(const C of v){const B=a[C],O=this._tiles[C];if(!O||O.fadeEndTime&&O.fadeEndTime<=Wi.now())continue;const G=this.findLoadedParent(B,Math.max(B.overscaledZ-iu.maxOverzooming,this._source.minzoom));G&&(this._addTile(G.tileID),p[G.tileID.key]=G.tileID),_[C]=B}const E=s[s.length-1].overscaledZ;for(const C in this._tiles){const B=this._tiles[C];if(a[C]||!B.hasData())continue;let O=B.tileID;for(;O.overscaledZ>E;){O=O.scaledTo(O.overscaledZ-1);const G=this._tiles[O.key];if(G&&G.hasData()&&_[O.key]){a[C]=B.tileID;break}}}for(const C in p)a[C]||(this._coveredTiles[C]=!0,a[C]=p[C])}for(const p in a)this._tiles[p].clearFadeHold();const c=function(p,_){const v=[];for(const E in p)E in _||v.push(E);return v}(this._tiles,a);for(const p of c){const _=this._tiles[p];_.hasSymbolBuckets&&!_.holdingForFade()?_.setHoldDuration(this.map._fadeDuration):_.hasSymbolBuckets&&!_.symbolFadeFinished()||this._removeTile(+p)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const i={};if(e.length===0)return i;const r={},n=e.reduce((_,v)=>Math.min(_,v.overscaledZ),1/0),s=e[0].overscaledZ,a=Math.max(s-iu.maxOverzooming,this._source.minzoom),c=Math.max(s+iu.maxUnderzooming,this._source.minzoom),p={};for(const _ of e){const v=this._addTile(_);i[_.key]=_,v.hasData()||n<this._source.maxzoom&&(p[_.key]=_)}this._retainLoadedChildren(p,n,c,i);for(const _ of e){let v=this._tiles[_.key];if(v.hasData())continue;if(_.canonical.z>=this._source.maxzoom){const C=_.children(this._source.maxzoom)[0],B=this.getTile(C);if(B&&B.hasData()){i[C.key]=C;continue}}else{const C=_.children(this._source.maxzoom);if(i[C[0].key]&&i[C[1].key]&&i[C[2].key]&&i[C[3].key])continue}let E=v.wasRequested();for(let C=_.overscaledZ-1;C>=a;--C){const B=_.scaledTo(C);if(r[B.key]||(r[B.key]=!0,v=this.getTile(B),!v&&E&&(v=this._addTile(B)),v&&(i[B.key]=B,E=v.wasRequested(),v.hasData())))break}}return i}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const i=[];let r,n=this._tiles[e].tileID;for(;n.overscaledZ>0;){if(n.key in this._loadedParentTiles){r=this._loadedParentTiles[n.key];break}i.push(n.key);const s=n.scaledTo(n.overscaledZ-1);if(r=this._getLoadedTile(s),r)break;n=s}for(const s of i)this._loadedParentTiles[s]=r}}_addTile(e){let i=this._tiles[e.key];if(i)return i.isExtraShadowCaster!==!0||this._shadowCasterTiles[e.key]||this._reloadTile(e.key,"reloading"),i;i=this._cache.getAndRemove(e),i&&(this._setTileReloadTimer(e.key,i),i.tileID=e,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,i)));const r=!!i;if(!r){const n=this.map?this.map.painter:null;i=new G0(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,n,this._isRaster),this._loadTile(i,this._tileLoaded.bind(this,i,e.key,i.state))}return i?(i.uses++,this._tiles[e.key]=i,r||this._source.fire(new Jt("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i):null}_setTileReloadTimer(e,i){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const r=i.getExpiryTimeout();r&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},r))}_removeTile(e){const i=this._tiles[e];i&&(i.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),i.uses>0||(i.hasData()&&i.state!=="reloading"?this._cache.add(i.tileID,i,i.getExpiryTimeout()):(i.aborted=!0,this._abortTile(i),this._unloadTile(i))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,i,r){const n=[],s=this.transform;if(!s)return n;const a=s.projection.name==="globe",c=Wo(s.center.lng);for(const p in this._tiles){const _=this._tiles[p];if(r&&_.clearQueryDebugViz(),_.holdingForFade())continue;let v;if(a){const E=_.tileID.canonical;if(E.z===0){const C=[Math.abs(Ai(c,...Z0(E,-1))-c),Math.abs(Ai(c,...Z0(E,1))-c)];v=[0,2*C.indexOf(Math.min(...C))-1]}else{const C=[Math.abs(Ai(c,...Z0(E,-1))-c),Math.abs(Ai(c,...Z0(E,0))-c),Math.abs(Ai(c,...Z0(E,1))-c)];v=[C.indexOf(Math.min(...C))-1]}}else v=[0];for(const E of v){const C=e.containsTile(_,s,i,E);C&&n.push(C)}}return n}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(e){return this._getRenderableCoordinates(e)}_getRenderableCoordinates(e,i){const r=this.getRenderableIds(e,i).map(s=>this._tiles[s].tileID),n=this.transform.projection.name==="globe";for(const s of r)s.projMatrix=this.transform.calculateProjMatrix(s.toUnwrapped()),s.expandedProjMatrix=n?this.transform.calculateProjMatrix(s.toUnwrapped(),!1,!0):s.projMatrix;return r}sortCoordinatesByDistance(e){const i=e.slice(),r=this.transform._camera.position,n=this.transform._camera.forward(),s={};for(const a of i){const c=1/(1<<a.canonical.z);s[a.key]=((a.canonical.x+.5)*c+a.wrap-r[0])*n[0]+((a.canonical.y+.5)*c-r[1])*n[1]-r[2]*n[2]}return i.sort((a,c)=>s[a.key]-s[c.key]),i}hasTransition(){if(this._source.hasTransition())return!0;if(Zg(this._source.type))for(const e in this._tiles){const i=this._tiles[e];if(i.fadeEndTime!==void 0&&i.fadeEndTime>=Wi.now())return!0}return!1}setFeatureState(e,i,r){this._state.updateState(e=e||"_geojsonTileLayer",i,r)}removeFeatureState(e,i,r){this._state.removeFeatureState(e=e||"_geojsonTileLayer",i,r)}getFeatureState(e,i){return this._state.getState(e=e||"_geojsonTileLayer",i)}setDependencies(e,i,r){const n=this._tiles[e];n&&n.setDependencies(i,r)}reloadTilesForDependencies(e,i){for(const r in this._tiles)this._tiles[r].hasDependency(e,i)&&this._reloadTile(+r,"reloading");this._cache.filter(r=>!r.hasDependency(e,i))}_preloadTiles(e,i){if(!this._sourceLoaded){const c=()=>{this._sourceLoaded&&(this._source.off("data",c),this._preloadTiles(e,i))};return void this._source.on("data",c)}const r=new Map,n=Array.isArray(e)?e:[e],s=this.map.painter.terrain,a=this.usedForTerrain&&s?s.getScaledDemTileSize():this._source.tileSize;for(const c of n){const p=c.coveringTiles({tileSize:a,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const _ of p)r.set(_.key,_);this.usedForTerrain&&c.updateElevation(!1)}Js(Array.from(r.values()),(c,p)=>{const _=new G0(c,this._source.tileSize*c.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(_,v=>{this._source.type==="raster-dem"&&_.dem&&this._backfillDEM(_),p(v,_)})},i)}}function px(t,e){const i=Math.abs(2*t.wrap)-+(t.wrap<0),r=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||r-i||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function Zg(t){return t==="raster"||t==="image"||t==="video"||t==="custom"}function Z0(t,e){const i=1<<t.z;return[t.x/i+e,(t.x+1)/i+e]}iu.maxOverzooming=10,iu.maxUnderzooming=3;const PT=an([{name:"a_pos_3f",components:3,type:"Float32"}]),zT=an([{name:"a_color_3f",components:3,type:"Float32"}]),BT=an([{name:"a_color_4f",components:4,type:"Float32"}]),LT=an([{name:"a_uv_2f",components:2,type:"Float32"}]),RT=an([{name:"a_normal_3f",components:3,type:"Float32"}]),FT=an([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),OT=an([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class qg{constructor(e=0,i=0,r=0,n=0){if(isNaN(e)||e<0||isNaN(i)||i<0||isNaN(r)||r<0||isNaN(n)||n<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=i,this.left=r,this.right=n}interpolate(e,i,r){return i.top!=null&&e.top!=null&&(this.top=Ki(e.top,i.top,r)),i.bottom!=null&&e.bottom!=null&&(this.bottom=Ki(e.bottom,i.bottom,r)),i.left!=null&&e.left!=null&&(this.left=Ki(e.left,i.left,r)),i.right!=null&&e.right!=null&&(this.right=Ki(e.right,i.right,r)),this}getCenter(e,i){const r=Ai((this.left+e-this.right)/2,0,e),n=Ai((this.top+i-this.bottom)/2,0,i);return new ct(r,n)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new qg(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function mx(t,e){const i=gn(t,3);ce.fromQuat(t,e),rs(t,3,i)}function Qg(t,e){const i=at.identity([]);return at.rotateZ(i,i,-e),at.rotateX(i,i,-t),i}function _x(t,e){const i=[t[0],t[1],0],r=[e[0],e[1],0];if(me.length(i)>=1e-15){const a=me.normalize([],i);me.scale(r,a,me.dot(r,a)),e[0]=r[0],e[1]=r[1]}const n=me.cross([],e,t);if(me.len(n)<1e-15)return null;const s=Math.atan2(-n[1],n[0]);return Qg(Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2]),s)}class gx{constructor(e,i){this.position=e,this.orientation=i}get position(){return this._position}set position(e){if(e){const i=e instanceof Wr?e:new Wr(e[0],e[1],e[2]);this._renderWorldCopies&&(i.x=Pn(i.x,0,1)),this._position=i}else this._position=null}lookAtPoint(e,i){if(this.orientation=null,!this.position)return;const r=this.position,n=this._elevation?this._elevation.getAtPointOrZero(Wr.fromLngLat(e)):0,s=Wr.fromLngLat(e,n),a=[s.x-r.x,s.y-r.y,s.z-r.z];i||(i=[0,0,1]),i[2]=Math.abs(i[2]),this.orientation=_x(a,i)}setPitchBearing(e,i){this.orientation=Qg(wi(e),wi(-i))}}class Xm{constructor(e,i){this._transform=ce.identity([]),this.orientation=i,this.position=e}get mercatorPosition(){const e=this.position;return new Wr(e[0],e[1],e[2])}get position(){const e=gn(this._transform,3);return[e[0],e[1],e[2]]}set position(e){var i;e&&rs(this._transform,3,[(i=e)[0],i[1],i[2],1])}get orientation(){return this._orientation}set orientation(e){this._orientation=e||at.identity([]),e&&mx(this._transform,this._orientation)}getPitchBearing(){const e=this.forward(),i=this.right();return{bearing:Math.atan2(-i[1],i[0]),pitch:Math.atan2(Math.sqrt(e[0]*e[0]+e[1]*e[1]),-e[2])}}setPitchBearing(e,i){this._orientation=Qg(e,i),mx(this._transform,this._orientation)}forward(){const e=gn(this._transform,2);return[-e[0],-e[1],-e[2]]}up(){const e=gn(this._transform,1);return[-e[0],-e[1],-e[2]]}right(){const e=gn(this._transform,0);return[e[0],e[1],e[2]]}getCameraToWorld(e,i){const r=new Float64Array(16);return ce.invert(r,this.getWorldToCamera(e,i)),r}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(e,i,r){const n=this.position;me.scale(n,n,-e);const s=new Float64Array(16);return ce.fromScaling(s,[r,r,r]),ce.translate(s,s,n),s[10]*=i,s}getWorldToCamera(e,i){const r=new Float64Array(16),n=new Float64Array(4),s=this.position;return at.conjugate(n,this._orientation),me.scale(s,s,-e),ce.fromQuat(r,n),ce.translate(r,r,s),r[1]*=-1,r[5]*=-1,r[9]*=-1,r[13]*=-1,r[8]*=i,r[9]*=i,r[10]*=i,r[11]*=i,r}getCameraToClipPerspective(e,i,r,n){const s=new Float64Array(16);return ce.perspective(s,e,i,r,n),s}getCameraToClipOrthographic(e,i,r,n,s,a){const c=new Float64Array(16);return ce.ortho(c,e,i,r,n,s,a),c}getDistanceToElevation(e,i=!1){const r=e===0?0:jn(e,i?Lo(this.position[1]):this.position[1]),n=this.forward();return(r-this.position[2])/n[2]}clone(){return new Xm([...this.position],[...this.orientation])}}function yx(t,e){const i=q0(t.projection,t.zoom,t.width,t.height),r=function(s,a,c,p,_){const v=new er(c.lng-180*Th,c.lat),E=new er(c.lng+180*Th,c.lat),C=s.project(v.lng,v.lat),B=s.project(E.lng,E.lat),O=-Math.atan2(B.y-C.y,B.x-C.x),G=Wr.fromLngLat(c);G.y=Ai(G.y,-1+Th,1-Th);const q=G.toLngLat(),X=s.project(q.lng,q.lat),$=Wr.fromLngLat(q);$.x+=Th;const re=$.toLngLat(),ne=s.project(re.lng,re.lat),ie=bx(ne.x-X.x,ne.y-X.y,O),se=Wr.fromLngLat(q);se.y+=Th;const he=se.toLngLat(),ve=s.project(he.lng,he.lat),be=bx(ve.x-X.x,ve.y-X.y,O),De=Math.abs(ie.x)/Math.abs(be.y),Ve=ce.identity([]);ce.rotateZ(Ve,Ve,-O*(1-(_?0:p)));const je=ce.identity([]);return ce.scale(je,je,[1,1-(1-De)*p,1]),je[4]=-be.x/be.y*p,ce.rotateZ(je,je,O),ce.multiply(je,Ve,je),je}(t.projection,0,t.center,i,e),n=xx(t);return ce.scale(r,r,[n,n,1]),r}function xx(t){const e=t.projection,i=q0(t.projection,t.zoom,t.width,t.height),r=vx(e,t.center),n=vx(e,er.convert(e.center));return Math.pow(2,r*i+(1-i)*n)}function q0(t,e,i,r,n=1/0){const s=t.range;if(!s)return 0;const a=Math.min(n,Math.max(i,r)),c=Math.log(a/1024)/Math.LN2;return jr(s[0]+c,s[1]+c,e)}const Th=1/4e4;function vx(t,e){const i=Ai(e.lat,-oo,oo),r=new er(e.lng-180*Th,i),n=new er(e.lng+180*Th,i),s=t.project(r.lng,i),a=t.project(n.lng,i),c=Wr.fromLngLat(r),p=Wr.fromLngLat(n),_=a.x-s.x,v=a.y-s.y,E=p.x-c.x,C=p.y-c.y,B=Math.sqrt((E*E+C*C)/(_*_+v*v));return Math.log(B)/Math.LN2}function bx(t,e,i){const r=Math.cos(i),n=Math.sin(i);return{x:t*r-e*n,y:t*n+e*r}}function rf(t,e,i){return e*(Mt/(t.tileSize*Math.pow(2,i-t.tileID.overscaledZ)))}const hd={unknown:0,flipRequired:1,flipNotRequired:2},NT=Math.tan(85*Math.PI/180);function Ym(t,e,i,r,n,s,a){const c=ce.create();if(i)if(s.name==="globe"){const p=function(_,v){const{x:E,y:C}=_.point,B=om(E,C,_.worldSize/_._pixelsPerMercatorPixel,0,0);return ce.multiply(B,B,Kf(_o(v)))}(n,e);ce.multiply(c,c,p)}else{const p=ae.invert([],a);c[0]=p[0],c[1]=p[1],c[4]=p[2],c[5]=p[3],r||ce.rotateZ(c,c,n.angle)}else ce.multiply(c,n.labelPlaneMatrix,t);return c}function wx(t,e,i,r,n,s,a){const c=Ym(t,e,i,r,n,s,a);return s.name==="globe"&&i||(c[2]=c[6]=c[10]=c[14]=0),c}function Tx(t,e,i,r,n,s,a){if(i){if(s.name==="globe"){const c=Ym(t,e,i,r,n,s,a);return ce.invert(c,c),ce.multiply(c,t,c),c}{const c=ce.clone(t),p=ce.identity([]);return p[0]=a[0],p[1]=a[1],p[4]=a[2],p[5]=a[3],ce.multiply(c,c,p),r||ce.rotateZ(c,c,-n.angle),c}}return n.glCoordMatrix}function ru(t,e,i,r){const n=[t,e,i,1];i?V.transformMat4(n,n,r):Dx(n,n,r);const s=n[3];return n[0]/=s,n[1]/=s,n[2]/=s,n}function Ex(t,e){return Math.min(.5+t/e*.5,1.5)}function UT(t,e){const i=t[0]/t[3],r=t[1]/t[3];return i>=-e[0]&&i<=e[0]&&r>=-e[1]&&r<=e[1]}function VT(t,e,i,r,n,s,a,c,p,_){const v=i.transform,E=r?t.textSizeData:t.iconSizeData,C=xu(E,i.transform.zoom),B=v.projection.name==="globe",O=[256/i.width*2+1,256/i.height*2+1],G=r?t.text.dynamicLayoutVertexArray:t.icon.dynamicLayoutVertexArray;G.clear();let q=null;B&&(q=r?t.text.globeExtVertexArray:t.icon.globeExtVertexArray);const X=t.lineVertexArray,$=r?t.text.placedSymbolArray:t.icon.placedSymbolArray,re=i.transform.width/i.transform.height;let ne,ie=!1;for(let se=0;se<$.length;se++){const he=$.get(se),{numGlyphs:ve,writingMode:be}=he;if(be!==Ms.vertical||ie||ne===Ms.horizontal||(ie=!0),ne=be,(he.hidden||be===Ms.vertical)&&!ie){fd(ve,G);continue}ie=!1;const De=new ct(he.tileAnchorX,he.tileAnchorY);let{x:Ve,y:je,z:Je}=v.projection.projectTilePoint(De.x,De.y,_.canonical);if(p){const[Bt,Ft,jt]=p(De);Ve+=Bt,je+=Ft,Je+=jt}const Fe=[Ve,je,Je,1];if(V.transformMat4(Fe,Fe,e),!UT(Fe,O)){fd(ve,G);continue}const nt=Fe[3],At=Ex(i.transform.getCameraToCenterDistance(v.projection),nt),vt=z0(E,C,he),rt=a?vt/At:vt*At,lt=ru(Ve,je,Je,n);if(lt[3]<=0){fd(ve,G);continue}let wt={};const It=a?null:p,St=Ix(he,rt,!1,c,e,n,s,t.glyphOffsetArray,X,G,q,lt,De,wt,re,It,v.projection,_,a);ie=St.useVertical,It&&St.needsFlipping&&(wt={}),(St.notEnoughRoom||ie||St.needsFlipping&&Ix(he,rt,!0,c,e,n,s,t.glyphOffsetArray,X,G,q,lt,De,wt,re,It,v.projection,_,a).notEnoughRoom)&&fd(ve,G)}r?(t.text.dynamicLayoutVertexBuffer.updateData(G),q&&t.text.globeExtVertexBuffer&&t.text.globeExtVertexBuffer.updateData(q)):(t.icon.dynamicLayoutVertexBuffer.updateData(G),q&&t.icon.globeExtVertexBuffer&&t.icon.globeExtVertexBuffer.updateData(q))}function Mx(t,e,i,r,n,s,a,c,p,_,v,E,C,B,O,G){const{lineStartIndex:q,glyphStartIndex:X,segment:$}=c,re=X+c.numGlyphs,ne=q+c.lineLength,ie=e.getoffsetX(X),se=e.getoffsetX(re-1),he=Km(t*ie,i,r,n,s,a,$,q,ne,p,_,v,E,C,!0,B,O,G);if(!he)return null;const ve=Km(t*se,i,r,n,s,a,$,q,ne,p,_,v,E,C,!0,B,O,G);return ve?{first:he,last:ve}:null}function Sx(t,e,i,r){return t===Ms.horizontal&&Math.abs(r)>Math.abs(i)?{useVertical:!0}:t===Ms.vertical?r>0?{needsFlipping:!0}:null:e!==hd.unknown&&function(n,s){return n===0||Math.abs(s/n)>NT}(i,r)?e===hd.flipRequired?{needsFlipping:!0}:null:i<0?{needsFlipping:!0}:null}function Ix(t,e,i,r,n,s,a,c,p,_,v,E,C,B,O,G,q,X,$){const re=e/24,ne=t.lineOffsetX*re,ie=t.lineOffsetY*re,{lineStartIndex:se,glyphStartIndex:he,numGlyphs:ve,segment:be,writingMode:De,flipState:Ve}=t,je=se+t.lineLength,Je=Fe=>{if(v){const[rt,lt,wt]=Fe.up,It=_.length;Gm(v,It+0,rt,lt,wt),Gm(v,It+1,rt,lt,wt),Gm(v,It+2,rt,lt,wt),Gm(v,It+3,rt,lt,wt)}const[nt,At,vt]=Fe.point;ud(_,nt,At,vt,Fe.angle)};if(ve>1){const Fe=Mx(re,c,ne,ie,i,E,C,t,p,s,B,G,!1,q,X,$);if(!Fe)return{notEnoughRoom:!0};if(r&&!i){let[nt,At,vt]=Fe.first.point,[rt,lt,wt]=Fe.last.point;[nt,At]=ru(nt,At,vt,a),[rt,lt]=ru(rt,lt,wt,a);const It=Sx(De,Ve,(rt-nt)*O,lt-At);if(t.flipState=It&&It.needsFlipping?hd.flipRequired:hd.flipNotRequired,It)return It}Je(Fe.first);for(let nt=he+1;nt<he+ve-1;nt++){const At=Km(re*c.getoffsetX(nt),ne,ie,i,E,C,be,se,je,p,s,B,G,!1,!1,q,X,$);if(!At)return _.length-=4*(nt-he),{notEnoughRoom:!0};Je(At)}Je(Fe.last)}else{if(r&&!i){const nt=ru(C.x,C.y,0,n),At=se+be+1,vt=new ct(p.getx(At),p.gety(At)),rt=ru(vt.x,vt.y,0,n),lt=rt[3]>0?rt:kx(C,vt,nt,1,n,void 0,q,X.canonical),wt=Sx(De,Ve,(lt[0]-nt[0])*O,lt[1]-nt[1]);if(t.flipState=wt&&wt.needsFlipping?hd.flipRequired:hd.flipNotRequired,wt)return wt}const Fe=Km(re*c.getoffsetX(he),ne,ie,i,E,C,be,se,je,p,s,B,G,!1,!1,q,X,$);if(!Fe)return{notEnoughRoom:!0};Je(Fe)}return{}}function Cx(t,e,i,r,n){const{x:s,y:a,z:c}=r.projectTilePoint(t.x,t.y,e);if(!n)return ru(s,a,c,i);const[p,_,v]=n(t);return ru(s+p,a+_,c+v,i)}function kx(t,e,i,r,n,s,a,c){const p=Cx(t.sub(e)._unit()._add(t),c,n,a,s);return me.sub(p,i,p),me.normalize(p,p),me.scaleAndAdd(p,i,p,r)}function Km(t,e,i,r,n,s,a,c,p,_,v,E,C,B,O,G,q,X){const $=r?t-e:t+e;let re=$>0?1:-1,ne=0;r&&(re*=-1,ne=Math.PI),re<0&&(ne+=Math.PI);let ie=c+a+(re>0?0:1)|0,se=n,he=n,ve=0,be=0;const De=Math.abs($),Ve=[],je=[];let Je=s,Fe=Je;const nt=()=>kx(Fe,Je,he,De-ve+1,v,C,G,q.canonical);for(;ve+be<=De;){if(ie+=re,ie<c||ie>=p)return null;if(he=se,Fe=Je,Ve.push(he),B&&je.push(Fe),Je=new ct(_.getx(ie),_.gety(ie)),se=E[ie],!se){const Ft=Cx(Je,q.canonical,v,G,C);se=Ft[3]>0?E[ie]=Ft:nt()}ve+=be,be=me.distance(he,se)}O&&C&&(E[ie]&&(se=nt(),be=me.distance(he,se)),E[ie]=se);const At=(De-ve)/be,vt=Je.sub(Fe)._mult(At)._add(Fe),rt=me.sub([],se,he),lt=me.scaleAndAdd([],he,rt,At);let wt=[0,0,1],It=rt[0],St=rt[1];if(X&&(wt=G.upVector(q.canonical,vt.x,vt.y),wt[0]!==0||wt[1]!==0||wt[2]!==1)){const Ft=[wt[2],0,-wt[0]],jt=me.cross([],wt,Ft);me.normalize(Ft,Ft),me.normalize(jt,jt),It=me.dot(rt,Ft),St=me.dot(rt,jt)}if(i){const Ft=me.cross([],wt,rt);me.normalize(Ft,Ft),me.scaleAndAdd(lt,lt,Ft,i*re)}const Bt=ne+Math.atan2(St,It);return Ve.push(lt),B&&je.push(vt),{point:lt,angle:Bt,path:Ve,tilePath:je,up:wt}}function fd(t,e){const i=e.length,r=i+4*t;e.resize(r),e.float32.fill(-1/0,4*i,4*r)}function Dx(t,e,i){const r=e[0],n=e[1];return t[0]=i[0]*r+i[4]*n+i[12],t[1]=i[1]*r+i[5]*n+i[13],t[3]=i[3]*r+i[7]*n+i[15],t}const Px=(t,e,i)=>(1-i)*t+i*e,zx=t=>t*t*t*t*t;class Hg{constructor(e,i,r,n,s,a,c){this.tileSize=512,this._renderWorldCopies=s===void 0||s,this._minZoom=e||0,this._maxZoom=i||22,this._minPitch=r??0,this._maxPitch=n??60,this.setProjection(a),this.setMaxBounds(c),this.width=0,this.height=0,this._center=new er(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new qg,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Xm,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const e=new Hg(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return e._elevation=this._elevation,e._centerAltitude=this._centerAltitude,e._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,e.tileSize=this.tileSize,e.mercatorFromTransition=this.mercatorFromTransition,e.width=this.width,e.height=this.height,e.cameraElevationReference=this.cameraElevationReference,e._center=this._center,e._setZoom(this.zoom),e._seaLevelZoom=this._seaLevelZoom,e.angle=this.angle,e._fov=this._fov,e._pitch=this._pitch,e._nearZ=this._nearZ,e._farZ=this._farZ,e._averageElevation=this._averageElevation,e._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,e._unmodified=this._unmodified,e._edgeInsets=this._edgeInsets.clone(),e._camera=this._camera.clone(),e._calcMatrices(),e.freezeTileCoverage=this.freezeTileCoverage,e.frustumCorners=this.frustumCorners,e}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(e){this._elevation!==e&&(this._elevation=e,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(e,i=!1){const r=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||r)&&this._updateCameraOnTerrain(),(e||r)&&this._constrainCamera(i),this._calcMatrices()}getProjection(){return nr(this.projection,["name","center","parallels"])}setProjection(e){this.projectionOptions=e||{name:"mercator"};const i=this.projection?this.getProjection():void 0;this.projection=Om(this.projectionOptions);const r=!Lt(i,this.getProjection());return r&&this._calcMatrices(),this.mercatorFromTransition=!1,r}setOrthographicProjectionAtLowPitch(e){return this._orthographicProjectionAtLowPitch!==e&&(this._orthographicProjectionAtLowPitch=e,this._calcMatrices(),!0)}setMercatorFromTransition(){const e=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=Om({name:"mercator"});const i=e!==this.projection.name;return i&&this._calcMatrices(),i}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const e=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(e))}get cameraWorldSize(){const e=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(e))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return jn(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new ct(this.width,this.height)}get bearing(){return Pn(this.rotation,-180,180)}set bearing(e){this.rotation=e}get rotation(){return-this.angle/Math.PI*180}set rotation(e){const i=-e*Math.PI/180;this.angle!==i&&(this._unmodified=!1,this.angle=i,this._calcMatrices(),this.rotationMatrix=ae.create(),ae.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){const i=Ai(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==i&&(this._unmodified=!1,this._pitch=i,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const e=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/e)}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=wi(e),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(e){this._averageElevation=e,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(e){const i=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==i&&(this._unmodified=!1,this._setZoom(i),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(e){this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom}_updateCameraOnTerrain(){const e=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,i=this.elevation&&e===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||e===Number.NEGATIVE_INFINITY&&(!i||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const r=this._elevation;i||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&r.exaggeration()&&this._centerAltitudeValidForExaggeration!==r.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*r.exaggeration(),this._centerAltitudeValidForExaggeration=r.exaggeration()):(this._centerAltitude=e||0,this._centerAltitudeValidForExaggeration=r.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const e=this._elevation,i=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],r=this.horizonLineFromTop();let n=0,s=0;for(let a=0;a<i.length;a++){const c=new ct(i[a][0]*this.width,r+i[a][1]*(this.height-r)),p=e.pointCoordinate(c);if(!p)continue;const _=1/Math.hypot(p[0]-this._camera.position[0],p[1]-this._camera.position[1]);n+=p[3]*_,s+=_}return s===0?NaN:n/s}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const e=this._seaLevelZoom,i=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),r=this.pixelsPerMeter/this.worldSize*i,n=this._mercatorZfromZoom(e),s=this._mercatorZfromZoom(this._maxZoom),a=Math.max(n-r,s);this._setZoom(this._zoomFromMercatorZ(a))}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}computeZoomRelativeTo(e){const i=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,e.toAltitude()));let r;r=e.z<this._camera.position[2]?[i.x,i.y,i.z]:[e.x,e.y,e.z];const n=me.length(me.sub([],this._camera.position,r));return Ai(this._zoomFromMercatorZ(n),this._minZoom,this._maxZoom)}setFreeCameraOptions(e){if(!this.height||!e.position&&!e.orientation)return;this._updateCameraState();let i=!1;if(e.orientation&&!at.exactEquals(e.orientation,this._camera.orientation)&&(i=this._setCameraOrientation(e.orientation)),e.position){const r=[e.position.x,e.position.y,e.position.z];me.exactEquals(r,this._camera.position)||(this._setCameraPosition(r),i=!0)}i&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const e=this._camera.position,i=new gx;return i.position=new Wr(e[0],e[1],e[2]),i.orientation=this._camera.orientation,i._elevation=this.elevation,i._renderWorldCopies=this.renderWorldCopies,i}_setCameraOrientation(e){if(!at.length(e))return!1;at.normalize(e,e);const i=me.transformQuat([],[0,0,-1],e),r=me.transformQuat([],[0,-1,0],e);if(r[2]<0)return!1;const n=_x(i,r);return!!n&&(this._camera.orientation=n,!0)}_setCameraPosition(e){const i=this.zoomScale(this.minZoom)*this.tileSize,r=this.zoomScale(this.maxZoom)*this.tileSize,n=this.cameraToCenterDistance;e[2]=Ai(e[2],n/r,n/i),this._camera.position=e}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,i,r){this._unmodified=!1,this._edgeInsets.interpolate(e,i,r),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const i=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,i)}getVisibleUnwrappedCoordinates(e){const i=[new ur(0,e)];if(this.renderWorldCopies){const r=this.pointCoordinate(new ct(0,0)),n=this.pointCoordinate(new ct(this.width,0)),s=this.pointCoordinate(new ct(this.width,this.height)),a=this.pointCoordinate(new ct(0,this.height)),c=Math.floor(Math.min(r.x,n.x,s.x,a.x)),p=Math.floor(Math.max(r.x,n.x,s.x,a.x)),_=1;for(let v=c-_;v<=p+_;v++)v!==0&&i.push(new ur(v,e))}return i}isLODDisabled(e){return(!e||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(e,i,r){let n=[];if(i[0]===0&&i[1]===0)return n;for(const a of e){const c=a.canonical,p=a.overscaledZ,_=a.wrap,v=1<<c.z,E=c.x+1<v,C=c.x>0,B=c.y+1<v,O=c.y>0,G=a.wrap-(C?0:1),q=a.wrap+(E?0:1),X=C?c.x-1:v-1,$=E?c.x+1:0;i[0]<0?(n.push(new ui(p,q,c.z,$,c.y)),i[1]<0&&B&&(n.push(new ui(p,_,c.z,c.x,c.y+1)),n.push(new ui(p,q,c.z,$,c.y+1))),i[1]>0&&O&&(n.push(new ui(p,_,c.z,c.x,c.y-1)),n.push(new ui(p,q,c.z,$,c.y-1)))):i[0]>0?(n.push(new ui(p,G,c.z,X,c.y)),i[1]<0&&B&&(n.push(new ui(p,_,c.z,c.x,c.y+1)),n.push(new ui(p,G,c.z,X,c.y+1))),i[1]>0&&O&&(n.push(new ui(p,_,c.z,c.x,c.y-1)),n.push(new ui(p,G,c.z,X,c.y-1)))):i[1]<0&&B?n.push(new ui(p,_,c.z,c.x,c.y+1)):O&&n.push(new ui(p,_,c.z,c.x,c.y-1))}if(n.length>1){n.sort((p,_)=>p.overscaledZ-_.overscaledZ||p.wrap-_.wrap||p.canonical.z-_.canonical.z||p.canonical.x-_.canonical.x||p.canonical.y-_.canonical.y);let a=0,c=0;for(;c<n.length;)n[c].equals(n[a])?++c:n[++a]=n[c++];n.length=a+1}const s=[];for(const a of n)n.some(c=>a.isChildOf(c))||s.push(a);return n=s.filter(a=>!e.some(c=>!!(a.overscaledZ<r&&c.isChildOf(a))||a.equals(c)||a.isChildOf(c))),n}coveringTiles(e){let i=this.coveringZoomLevel(e);const r=i,n=this.elevation&&this.elevation.exaggeration(),s=n&&!e.isTerrainDEM,a=this.projection.name==="mercator";if(e.minzoom!==void 0&&i<e.minzoom)return[];e.maxzoom!==void 0&&i>e.maxzoom&&(i=e.maxzoom);const c=this.locationCoordinate(this.center),p=this.center.lat,_=1<<i,v=[_*c.x,_*c.y,0],E=this.projection.name==="globe",C=!E,B=Xs.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,i,C),O=E?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),G=_*jn(1,this.center.lat),q=this._camera.position[2]/jn(1,this.center.lat),X=[_*O.x,_*O.y,q*(C?1:G)],$=E||n,re=this.cameraToCenterDistance/e.tileSize*(e.roundZoom?1:.502),ne=this.isLODDisabled(!0)?i:0;let ie;if(this._elevation&&e.isTerrainDEM)ie=1e4*this._elevation.exaggeration();else if(this._elevation){const rt=this._elevation.getMinMaxForVisibleTiles();ie=rt?rt.max:this._centerAltitude}else ie=this._centerAltitude;const se=e.isTerrainDEM?-ie:this._elevation?this._elevation.getMinElevationBelowMSL():0,he=this.projection.isReprojectedInTileSpace?xx(this):1,ve=rt=>{const wt=new Wr(rt.x+25e-6,rt.y,rt.z),It=new Wr(rt.x,rt.y+25e-6,rt.z),St=rt.toLngLat(),Bt=wt.toLngLat(),Ft=It.toLngLat(),jt=this.locationCoordinate(St),Dt=this.locationCoordinate(Bt),Yt=this.locationCoordinate(Ft),fi=Math.hypot(Dt.x-jt.x,Dt.y-jt.y),di=Math.hypot(Yt.x-jt.x,Yt.y-jt.y);return Math.sqrt(fi*di)*he/25e-6},be=rt=>{const lt=ie,wt=se;return{aabb:nx(this,_,0,0,0,rt,wt,lt,this.projection),zoom:0,x:0,y:0,minZ:wt,maxZ:lt,wrap:rt,fullyVisible:!1}},De=[];let Ve=[];const je=i,Je=e.reparseOverscaled?r:i,Fe=rt=>rt*rt,nt=Fe((q-this._centerAltitude)*G),At=rt=>{if(!this._elevation||!rt.tileID||!a)return;const lt=this._elevation.getMinMaxForTile(rt.tileID),wt=rt.aabb;lt?(wt.min[2]=lt.min,wt.max[2]=lt.max,wt.center[2]=(wt.min[2]+wt.max[2])/2):(rt.shouldSplit=vt(rt),rt.shouldSplit||(wt.min[2]=wt.max[2]=wt.center[2]=this._centerAltitude))},vt=rt=>{if(rt.zoom<ne)return!0;if(rt.zoom===je)return!1;if(rt.shouldSplit!=null)return rt.shouldSplit;const lt=rt.aabb.distanceX(X),wt=rt.aabb.distanceY(X);let It=nt,St=1;if(E){It=Fe(rt.aabb.distanceZ(X));const jt=Math.pow(2,rt.zoom),Dt=Lo((rt.y+1)/jt),Yt=Lo(rt.y/jt),fi=Math.min(Math.max(p,Dt),Yt),di=hm(fi)/hm(p);if(St=fi===p?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,di/this._mercatorScaleRatio),this.zoom<=sa&&rt.zoom===je-1&&di>=.9)return!0}else if(s&&(It=Fe(rt.aabb.distanceZ(X)*G)),this.projection.isReprojectedInTileSpace&&r<=5){const jt=Math.pow(2,rt.zoom),Dt=ve(new Wr((rt.x+.5)/jt,(rt.y+.5)/jt));St=Dt>.85?1:Dt}const Bt=lt*lt+wt*wt+It,Ft=Fe((1<<je-rt.zoom)*re*St*((jt,Dt)=>{if(Dt*Fe(.707)<jt)return 1;const Yt=Math.sqrt(Dt/jt);return Yt/(1.4144271570014144+(Math.pow(1.1,Yt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(It,nt),Bt));return Bt<Ft};if(this.renderWorldCopies)for(let rt=1;rt<=3;rt++)De.push(be(-rt)),De.push(be(rt));for(De.push(be(0));De.length>0;){const rt=De.pop(),lt=rt.x,wt=rt.y;let It=rt.fullyVisible;const St=()=>this.projection.name==="globe"&&(rt.y===0||rt.y===(1<<rt.zoom)-1);if(!It){let Bt=$?rt.aabb.intersects(B):rt.aabb.intersectsFlat(B);if(Bt===0&&St()){const Ft=new ci(rt.zoom,lt,wt);Bt=Wl(this,_,Ft,!0).intersects(B)}if(Bt===0)continue;It=Bt===2}if(rt.zoom!==je&&vt(rt))for(let Bt=0;Bt<4;Bt++){const Ft=(lt<<1)+Bt%2,jt=(wt<<1)+(Bt>>1),Dt={aabb:a?rt.aabb.quadrant(Bt):nx(this,_,rt.zoom+1,Ft,jt,rt.wrap,rt.minZ,rt.maxZ,this.projection),zoom:rt.zoom+1,x:Ft,y:jt,wrap:rt.wrap,fullyVisible:It,tileID:void 0,shouldSplit:void 0,minZ:rt.minZ,maxZ:rt.maxZ};s&&!E&&(Dt.tileID=new ui(rt.zoom+1===je?Je:rt.zoom+1,rt.wrap,rt.zoom+1,Ft,jt),At(Dt)),De.push(Dt)}else{const Bt=rt.zoom===je?Je:rt.zoom;if(e.minzoom&&e.minzoom>Bt)continue;if(!It){let Yt=$?rt.aabb.intersectsPrecise(B):rt.aabb.intersectsPreciseFlat(B);if(Yt===0&&St()){const fi=new ci(rt.zoom,lt,wt);Yt=Wl(this,_,fi,!0).intersectsPrecise(B)}if(Yt===0)continue}const Ft=v[0]-(.5+lt+(rt.wrap<<rt.zoom))*(1<<i-rt.zoom),jt=v[1]-.5-wt,Dt=rt.tileID?rt.tileID:new ui(Bt,rt.wrap,rt.zoom,lt,wt);Ve.push({tileID:Dt,distanceSq:Ft*Ft+jt*jt})}}if(this.fogCullDistSq){const rt=this.fogCullDistSq,lt=this.horizonLineFromTop();Ve=Ve.filter(wt=>{const It=[0,0,0,1],St=[Mt,Mt,0,1],Bt=this.calculateFogTileMatrix(wt.tileID.toUnwrapped());V.transformMat4(It,It,Bt),V.transformMat4(St,St,Bt);const Ft=function(Yt,fi,di){let vi=0;for(let bi=0;bi<2;++bi)Yt[bi]>0&&(vi+=(Yt[bi]-0)*(Yt[bi]-0)),fi[bi]<0&&(vi+=(0-fi[bi])*(0-fi[bi]));return vi}(V.min([],It,St),V.max([],It,St));if(Ft===0)return!0;let jt=!1;const Dt=this._elevation;if(Dt&&Ft>rt&&lt!==0){const Yt=this.calculateProjMatrix(wt.tileID.toUnwrapped());let fi;e.isTerrainDEM||(fi=Dt.getMinMaxForTile(wt.tileID)),fi||(fi={min:se,max:ie});const di=function(bi){const Ar=Math.round((bi+45+360)%360/90)%4;return kn[Ar]}(this.rotation),vi=[di[0]*Mt,di[1]*Mt,fi.max];me.transformMat4(vi,vi,Yt),jt=(1-vi[1])*this.height*.5<lt}return Ft<rt||jt})}return Ve.sort((rt,lt)=>rt.distanceSq-lt.distanceSq).map(rt=>rt.tileID)}resize(e,i){this.width=e,this.height=i,this.pixelsToGLUnits=[2/e,-2/i],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(e){const i=Ai(e.lat,-oo,oo),r=this.projection.project(e.lng,i);return new ct(r.x*this.worldSize,r.y*this.worldSize)}unproject(e){return this.projection.unproject(e.x/this.worldSize,e.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/jn(1,this.center.lat)/this.worldSize}setLocationAtPoint(e,i){let r,n;const s=this.centerPoint;if(this.projection.name==="globe"){const c=this.worldSize;r=(i.x-s.x)/c,n=(i.y-s.y)/c}else{const c=this.pointCoordinate(i),p=this.pointCoordinate(s);r=c.x-p.x,n=c.y-p.y}const a=this.locationCoordinate(e);this.setLocation(new Wr(a.x-r,a.y-n))}setLocation(e){this.center=this.coordinateLocation(e),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(e){return this.projection.locationPoint(this,e)}locationPoint3D(e){return this.projection.locationPoint(this,e,!0)}pointLocation(e){return this.coordinateLocation(this.pointCoordinate(e))}pointLocation3D(e){return this.coordinateLocation(this.pointCoordinate3D(e))}locationCoordinate(e,i){const r=i?jn(i,e.lat):void 0,n=this.projection.project(e.lng,e.lat);return new Wr(n.x,n.y,r)}coordinateLocation(e){return this.projection.unproject(e.x,e.y)}pointRayIntersection(e,i){const r=i??this._centerAltitude,n=[e.x,e.y,0,1],s=[e.x,e.y,1,1];V.transformMat4(n,n,this.pixelMatrixInverse),V.transformMat4(s,s,this.pixelMatrixInverse);const a=s[3];V.scale(n,n,1/n[3]),V.scale(s,s,1/a);const c=n[2],p=s[2];return{p0:n,p1:s,t:c===p?0:(r-c)/(p-c)}}screenPointToMercatorRay(e){const i=[e.x,e.y,0,1],r=[e.x,e.y,1,1];return V.transformMat4(i,i,this.pixelMatrixInverse),V.transformMat4(r,r,this.pixelMatrixInverse),V.scale(i,i,1/i[3]),V.scale(r,r,1/r[3]),i[2]=jn(i[2],this._center.lat)*this.worldSize,r[2]=jn(r[2],this._center.lat)*this.worldSize,V.scale(i,i,1/this.worldSize),V.scale(r,r,1/this.worldSize),new ys([i[0],i[1],i[2]],me.normalize([],me.sub([],r,i)))}rayIntersectionCoordinate(e){const{p0:i,p1:r,t:n}=e,s=jn(i[2],this._center.lat),a=jn(r[2],this._center.lat);return new Wr(Ki(i[0],r[0],n)/this.worldSize,Ki(i[1],r[1],n)/this.worldSize,Ki(s,a,n))}pointCoordinate(e,i=this._centerAltitude){return this.projection.pointCoordinate(this,e.x,e.y,i)}pointCoordinate3D(e){if(!this.elevation)return this.pointCoordinate(e);let i=this.projection.pointCoordinate3D(this,e.x,e.y);if(i)return new Wr(i[0],i[1],i[2]);let r=0,n=this.horizonLineFromTop();if(e.y>n)return this.pointCoordinate(e);const s=.02*n,a=e.clone();for(let c=0;c<10&&n-r>s;c++){a.y=Ki(r,n,.66);const p=this.projection.pointCoordinate3D(this,a.x,a.y);p?(n=a.y,i=p):r=a.y}return i?new Wr(i[0],i[1],i[2]):this.pointCoordinate(e)}isPointAboveHorizon(e){return this.projection.isPointAboveHorizon(this,e)}isPointOnSurface(e){if(e.y<0||e.y>this.height||e.x<0||e.x>this.width)return!1;if(this.elevation||this.zoom>=zs)return!this.isPointAboveHorizon(e);const i=this.pointCoordinate(e);return i.y>=0&&i.y<=1}_coordinatePoint(e,i){const r=i&&this.elevation?this.elevation.getAtPointOrZero(e,this._centerAltitude):this._centerAltitude,n=[e.x*this.worldSize,e.y*this.worldSize,r+e.toAltitude(),1];return V.transformMat4(n,n,this.pixelMatrix),n[3]>0?new ct(n[0]/n[3],n[1]/n[3]):new ct(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:e,left:i}=this._edgeInsets,r=this.height-this._edgeInsets.bottom,n=this.width-this._edgeInsets.right,s=this.pointLocation3D(new ct(i,e)),a=this.pointLocation3D(new ct(n,e)),c=this.pointLocation3D(new ct(n,r)),p=this.pointLocation3D(new ct(i,r));let _=Math.min(s.lng,a.lng,c.lng,p.lng),v=Math.max(s.lng,a.lng,c.lng,p.lng),E=Math.min(s.lat,a.lat,c.lat,p.lat),C=Math.max(s.lat,a.lat,c.lat,p.lat);const B=Math.pow(2,-this.zoom)/16*270,O=this.projection.name==="globe"?1:4,G=(q,X,$,re,ne)=>{const ie=(q+$)/2,se=(X+re)/2,he=new ct(ie,se),{lng:ve,lat:be}=this.pointLocation3D(he),De=Math.max(0,_-ve,E-be,ve-v,be-C);_=Math.min(_,ve),v=Math.max(v,ve),E=Math.min(E,be),C=Math.max(C,be),(ne<O||De>B)&&(G(q,X,ie,se,ne+1),G(ie,se,$,re,ne+1))};if(G(i,e,n,e,1),G(n,e,n,r,1),G(n,r,i,r,1),G(i,r,i,e,1),this.projection.name==="globe"){const[q,X]=function($){const re=ce.identity(new Float64Array(16));ce.multiply(re,$.pixelMatrix,$.globeMatrix);const ne=[0,Ys,0],ie=[0,Ks,0];return me.transformMat4(ne,ne,re),me.transformMat4(ie,ie,re),[ne[0]>0&&ne[0]<=$.width&&ne[1]>0&&ne[1]<=$.height&&!$h($,new er($.center.lat,90)),ie[0]>0&&ie[0]<=$.width&&ie[1]>0&&ie[1]<=$.height&&!$h($,new er($.center.lat,-90))]}(this);q?(C=90,v=180,_=-180):X&&(E=-90,v=180,_=-180)}return new kl(new er(_,E),new er(v,C))}_getBoundsRectangular(e,i){const{top:r,left:n}=this._edgeInsets,s=this.height-this._edgeInsets.bottom,a=this.width-this._edgeInsets.right,c=new ct(n,r),p=new ct(a,r),_=new ct(a,s),v=new ct(n,s);let E=this.pointCoordinate(c,e),C=this.pointCoordinate(p,e);const B=this.pointCoordinate(_,i),O=this.pointCoordinate(v,i),G=(q,X)=>(X.y-q.y)/(X.x-q.x);return E.y>1&&C.y>=0?E=new Wr((1-O.y)/G(O,E)+O.x,1):E.y<0&&C.y<=1&&(E=new Wr(-O.y/G(O,E)+O.x,0)),C.y>1&&E.y>=0?C=new Wr((1-B.y)/G(B,C)+B.x,1):C.y<0&&E.y<=1&&(C=new Wr(-B.y/G(B,C)+B.x,0)),new kl().extend(this.coordinateLocation(E)).extend(this.coordinateLocation(C)).extend(this.coordinateLocation(O)).extend(this.coordinateLocation(B))}_getBoundsRectangularTerrain(){const e=this.elevation;if(!e.visibleDemTiles.length||e.isUsingMockSource())return this._getBoundsRectangular(0,0);const i=e.visibleDemTiles.reduce((r,n)=>{if(n.dem){const s=n.dem.tree;r.min=Math.min(r.min,s.minimums[0]),r.max=Math.max(r.max,s.maximums[0])}return r},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(i.min*e.exaggeration(),i.max*e.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(e=!0){const i=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,r=this.height/2-i*(1-this._horizonShift);return e?Math.max(0,r):r}getMaxBounds(){return this.maxBounds}setMaxBounds(e){this.maxBounds=e,this.minLat=-oo,this.maxLat=oo,this.minLng=-180,this.maxLng=180,e&&(this.minLat=e.getSouth(),this.maxLat=e.getNorth(),this.minLng=e.getWest(),this.maxLng=e.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=Wo(this.minLng)*this.tileSize,this.worldMaxX=Wo(this.maxLng)*this.tileSize,this.worldMinY=oa(this.maxLat)*this.tileSize,this.worldMaxY=oa(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(e,i){return this.projection.createTileMatrix(this,i,e)}calculateDistanceTileData(e){const i=e.key,r=this._distanceTileDataCache;if(r[i])return r[i];const n=e.canonical,s=1/this.height,a=this.cameraWorldSize,c=a/this.zoomScale(n.z),p=(n.x+Math.pow(2,n.z)*e.wrap)*c,_=n.y*c,v=this.point;v.x*=a/this.worldSize,v.y*=a/this.worldSize;const E=this.angle,C=Math.sin(-E),B=-Math.cos(-E);return r[i]={bearing:[C,B],center:[(v.x-p)*s,(v.y-_)*s],scale:c/Mt*s},r[i]}calculateFogTileMatrix(e){const i=e.key,r=this._fogTileMatrixCache;if(r[i])return r[i];const n=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,e);return ce.multiply(n,this.worldToFogMatrix,n),r[i]=new Float32Array(n),r[i]}calculateProjMatrix(e,i=!1,r=!1){const n=e.key;let s;if(s=r?this._expandedProjMatrixCache:i?this._alignedProjMatrixCache:this._projMatrixCache,s[n])return s[n];const a=this.calculatePosMatrix(e,this.worldSize);let c;return c=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:r?this.expandedFarZProjMatrix:i?this.alignedProjMatrix:this.projMatrix,ce.multiply(a,c,a),s[n]=new Float32Array(a),s[n]}calculatePixelsToTileUnitsMatrix(e){const i=e.tileID.key,r=this._pixelsToTileUnitsCache;if(r[i])return r[i];const n=function(s,a){const{scale:c}=s.tileTransform,p=c*Mt/(s.tileSize*Math.pow(2,a.zoom-s.tileID.overscaledZ+s.tileID.canonical.z));return ae.scale(new Float32Array(4),a.inverseAdjustmentMatrix,[p,p])}(e,this);return r[i]=n,r[i]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const e=1/this.worldSize,i=ce.fromScaling([],[e,e,e]);return ce.multiply(i,i,this.globeMatrix),i}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const e=this._elevation;this._updateCameraState();const i=jn(1,this._center.lat)*this.worldSize,r=this._computeCameraPosition(i),n=this._camera.forward(),s=jn(1,this._center.lat);r[2]/=s,n[2]/=s,me.normalize(n,n);const a=e.raycast(r,n,e.exaggeration());if(a){const c=me.scaleAndAdd([],r,n,a),p=new Wr(c[0],c[1],jn(c[2],Lo(c[1]))),_=(p.z+me.length([p.x-r[0],p.y-r[1],p.z-r[2]*s]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(_),this._centerAltitude=p.toAltitude(),this._center=this.coordinateLocation(p),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(e=!1){if(!this._elevation)return;const i=this._elevation,r=jn(1,this._center.lat)*this.worldSize,n=this._computeCameraPosition(r),s=i.getAtPointOrZero(new Wr(...n)),a=this.pixelsPerMeter/this.worldSize*s,c=this._minimumHeightOverTerrain(),p=n[2]-a;if(p<=c)if(p<0||e){const _=this.locationCoordinate(this._center,this._centerAltitude),v=[n[0],n[1],_.z-n[2]],E=me.length(v);v[2]-=(c-p)/this._pixelsPerMercatorPixel;const C=me.length(v);if(C===0)return;me.scale(v,v,E/C*this._pixelsPerMercatorPixel),this._camera.position=[n[0],n[1],_.z*this._pixelsPerMercatorPixel-v[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const e=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||e){const C=this.center;return C.lat=Ai(C.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!e)&&(C.lng=Ai(C.lng,this.minLng,this.maxLng)),this.center=C,void(this._constraining=!1)}const i=this._unmodified,{x:r,y:n}=this.point;let s=0,a=r,c=n;const p=this.width/2,_=this.height/2,v=this.worldMinY*this.scale,E=this.worldMaxY*this.scale;if(n-_<v&&(c=v+_),n+_>E&&(c=E-_),E-v<this.height&&(s=Math.max(s,this.height/(E-v)),c=(E+v)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const C=this.worldMinX*this.scale,B=this.worldMaxX*this.scale,O=this.worldSize/2-(C+B)/2;a=(r+O+this.worldSize)%this.worldSize-O,a-p<C&&(a=C+p),a+p>B&&(a=B-p),B-C<this.width&&(s=Math.max(s,this.width/(B-C)),a=(B+C)/2)}a===r&&c===n||(this.center=this.unproject(new ct(a,c))),s&&(this.zoom+=this.scaleZoom(s)),this._constrainCamera(),this._unmodified=i,this._constraining=!1}_minZoomForBounds(){let e=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(e=Math.max(e,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),e}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const e=this.centerOffset,i=this.projection.name==="globe",r=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=jn(1,this.center.lat)/jn(1,45));const n=q0(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,n),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const s=this.projection.zAxisUnit==="meters"?r:1,a=this._camera.getWorldToCamera(this.worldSize,s);let c;const p=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(p[8]=2*-e.x/this.width,p[9]=2*e.y/this.height,this.isOrthographic){let be=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),De=be*this.aspect,Ve=-De,je=-be;De-=e.x,Ve-=e.x,be+=e.y,je+=e.y,c=this._camera.getCameraToClipOrthographic(Ve,De,je,be,this._nearZ,this._farZ),((Je,Fe,nt,At)=>{for(let vt=0;vt<16;vt++)Je[vt]=Px(Fe[vt],nt[vt],At)})(c,c,p,zx(this.pitch>=15?1:this.pitch/15))}else c=p;const _=ce.mul([],p,a);let v=ce.mul([],c,a);if(this.projection.isReprojectedInTileSpace){const be=this.locationCoordinate(this.center),De=ce.identity([]);ce.translate(De,De,[be.x*this.worldSize,be.y*this.worldSize,0]),ce.multiply(De,De,yx(this)),ce.translate(De,De,[-be.x*this.worldSize,-be.y*this.worldSize,0]),ce.multiply(v,v,De),ce.multiply(_,_,De),this.inverseAdjustmentMatrix=function(Ve){const je=yx(Ve,!0);return ae.invert([],[je[0],je[1],je[4],je[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=ce.scale([],v,[this.worldSize,this.worldSize,this.worldSize/s,1]),this.projMatrix=v,this.invProjMatrix=ce.invert(new Float64Array(16),this.projMatrix),i){const be=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);be[8]=2*-e.x/this.width,be[9]=2*e.y/this.height,this.expandedFarZProjMatrix=ce.mul([],be,a)}else this.expandedFarZProjMatrix=this.projMatrix;const E=ce.invert([],c);this.frustumCorners=Io.fromInvProjectionMatrix(E,this.horizonLineFromTop(),this.height),this.cameraFrustum=Xs.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!i);const C=new Float32Array(16);ce.identity(C),ce.scale(C,C,[1,-1,1]),ce.rotateX(C,C,this._pitch),ce.rotateZ(C,C,this.angle);const B=ce.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=ce.clone(B);const O=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;B[8]=2*-e.x/this.width,B[9]=2*(e.y+O)/this.height,this.skyboxMatrix=ce.multiply(C,B,C);const G=this.point,q=G.x,X=G.y,$=this.width%2/2,re=this.height%2/2,ne=Math.cos(this.angle),ie=Math.sin(this.angle),se=q-Math.round(q)+ne*$+ie*re,he=X-Math.round(X)+ne*re+ie*$,ve=new Float64Array(v);if(ce.translate(ve,ve,[se>.5?se-1:se,he>.5?he-1:he,0]),this.alignedProjMatrix=ve,v=ce.create(),ce.scale(v,v,[this.width/2,-this.height/2,1]),ce.translate(v,v,[1,-1,0]),this.labelPlaneMatrix=v,v=ce.create(),ce.scale(v,v,[1,-1,1]),ce.translate(v,v,[-1,-1,0]),ce.scale(v,v,[2/this.width,2/this.height,1]),this.glCoordMatrix=v,this.pixelMatrix=ce.multiply(new Float64Array(16),this.labelPlaneMatrix,_),this._calcFogMatrices(),this._distanceTileDataCache={},v=ce.invert(new Float64Array(16),this.pixelMatrix),!v)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=v,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=function(De){const{x:Ve,y:je}=De.point,{lng:Je,lat:Fe}=De._center;return om(Ve,je,De.worldSize,Je,Fe)}(this);const be=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=me.transformMat4(be,be,a),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=v;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const e=this.cameraWorldSizeForFog,i=this.cameraPixelsPerMeter,r=this._camera.position,n=1/this.height/this._pixelsPerMercatorPixel,s=[e,e,i];me.scale(s,s,n),me.scale(r,r,-1),me.multiply(r,r,s);const a=ce.create();ce.translate(a,a,r),ce.scale(a,a,s),this.mercatorFogMatrix=a,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(e,i,n)}_computeCameraPosition(e){const i=(e=e||this.pixelsPerMeter)/this.pixelsPerMeter,r=this._camera.forward(),n=this.point,s=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*i-e/this.worldSize*this._centerAltitude;return[n.x/this.worldSize-r[0]*s,n.y/this.worldSize-r[1]*s,e/this.worldSize*this._centerAltitude-r[2]*s]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(e){const i=this._maxCameraBoundsDistance()*Math.cos(this._pitch),r=this._camera.position[2],n=e[2];let s=1;this.projection.wrap&&(this.center=this.center.wrap()),n>0&&(s=Math.min((i-r)/n,1)),this._camera.position=me.scaleAndAdd([],this._camera.position,e,s),this._updateStateFromCamera()}_updateStateFromCamera(){const e=this._camera.position,i=this._camera.forward(),{pitch:r,bearing:n}=this._camera.getPitchBearing(),s=jn(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,a=this._mercatorZfromZoom(this._maxZoom)*Math.cos(wi(this._maxPitch)),c=Math.max((e[2]-s)/Math.cos(r),a),p=this._zoomFromMercatorZ(c);me.scaleAndAdd(e,e,i,c),this._pitch=Ai(r,wi(this.minPitch),wi(this.maxPitch)),this.angle=Pn(n,-Math.PI,Math.PI),this._setZoom(Ai(p,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new Wr(e[0],e[1],e[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(e){return Math.pow(2,e)*this.tileSize}_mercatorZfromZoom(e){return this.cameraToCenterDistance/this._worldSizeFromZoom(e)}_minimumHeightOverTerrain(){const e=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(e)}_zoomFromMercatorZ(e){return this.scaleZoom(this.cameraToCenterDistance/(e*this.tileSize))}zoomFromMercatorZAdjusted(e){let i=0,r=zs,n=0,s=1/0;for(;r-i>1e-6&&r>i;){const a=i+.5*(r-i),c=this.tileSize*Math.pow(2,a),p=this.getCameraToCenterDistance(this.projection,a,c),_=this.scaleZoom(p/(e*this.tileSize)),v=Math.abs(a-_);v<s&&(s=v,n=a),a<_?i=a:r=a}return n}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(Be("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(e,i){const r=Math.min(e.x,i.x),n=Math.max(e.x,i.x),s=Math.min(e.y,i.y),a=Math.max(e.y,i.y);if(s<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const c=[new ct(r,s),new ct(n,a),new ct(r,a),new ct(n,s)],p=this.renderWorldCopies?-3:0,_=this.renderWorldCopies?4:1;for(const v of c){const E=this.pointRayIntersection(v);if(E.t<0)return!0;const C=this.rayIntersectionCoordinate(E);if(C.x<p||C.y<0||C.x>_||C.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+hr(this.fovAboveCenter)>88||this.anyCornerOffEdge(new ct(0,0),new ct(this.width,this.height))}zoomDeltaToMovement(e,i){const r=me.length(me.sub([],this._camera.position,e)),n=this._zoomFromMercatorZ(r)+i;return r-this._mercatorZfromZoom(n)}getCameraPoint(){if(this.projection.name==="globe"){const e=function([i,r,n],s){const a=[i,r,n,1];V.transformMat4(a,a,s);const c=a[3]=Math.max(a[3],1e-6);return a[0]/=c,a[1]/=c,a[2]/=c,a}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new ct(e[0],e[1])}{const e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new ct(0,e))}}getCameraToCenterDistance(e,i=this.zoom,r=this.worldSize){const n=q0(e,i,this.width,this.height,1024),s=e.pixelSpaceConversion(this.center.lat,r,n);let a=.5/Math.tan(.5*this._fov)*this.height*s;return this.isOrthographic&&(a=Px(1,a,zx(this.pitch>=15?1:this.pitch/15))),a}getWorldToCameraMatrix(){const e=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&ce.multiply(e,e,this.globeMatrix),e}getFrustum(e){return Xs.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,e,this.projection.zAxisUnit==="meters")}}function Bx(t,e,i){ce.identity(t),ce.rotateZ(t,t,wi(e[2])),ce.rotateX(t,t,wi(e[0])),ce.rotateY(t,t,wi(e[1])),ce.scale(t,t,i),ce.multiply(t,t,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Jm(t,e,i,r,n,s,a,c){const p=[i[0]-e[0],i[1]-e[1],0],_=[r[0]-e[0],r[1]-e[1],0];if(me.length(p)<1e-12||me.length(_)<1e-12)return at.identity(t);const v=me.cross([],p,_);me.normalize(v,v),me.subtract(_,r,e),p[2]=(s-n)*c,_[2]=(a-n)*c;const E=p;return me.cross(E,p,_),me.normalize(E,E),at.rotationTo(t,v,E)}function Lx(t,e,i=!1){const r=Ho(e.zoom),n=function(s,a,c){const p=a.worldSize,_=[s[12],s[13],s[14]],v=Lo(_[1]/p),E=MA(_[0]/p),C=ce.identity([]),B=jn(1,v)*p,O=jn(1,0)*p*dh(v,a.zoom),G=1/Jf(p);let q=O*G;if(c){const ne=q0(a.projection,a.zoom,a.width,a.height,1024);q=G*a.projection.pixelSpaceConversion(a.center.lat,p,ne)}const X=xa(v,E);me.add(X,X,me.scale([],me.normalize([],X),B*q*_[2]));const $=function(ne){const ie=[ne[0],ne[1],ne[2]];let se=[0,1,0];const he=me.cross([],se,ie);return me.cross(se,ie,he),me.squaredLength(se)===0&&(se=[0,1,0],me.cross(he,ie,se)),me.normalize(he,he),me.normalize(se,se),me.normalize(ie,ie),[he[0],he[1],he[2],0,se[0],se[1],se[2],0,ie[0],ie[1],ie[2],0,ne[0],ne[1],ne[2],1]}(X);ce.scale(C,C,[q,q,q*B]),ce.translate(C,C,[-_[0],-_[1],-_[2]]);const re=ce.multiply([],a.globeMatrix,$);return ce.multiply(re,re,C),ce.multiply(re,re,s),re}(t,e,i);if(r>0){const s=function(a,c){const p=c.worldSize,_=jn(1,0)*p*dh(c.center.lat,c.zoom)/Jf(p),v=jn(1,c.center.lat)*p,E=ce.identity([]);return ce.rotateY(E,E,wi(c.center.lng)),ce.rotateX(E,E,wi(c.center.lat)),ce.translate(E,E,[0,0,Vn]),ce.scale(E,E,[_,_,_*v]),ce.translate(E,E,[c.point.x-.5*p,c.point.y-.5*p,0]),ce.multiply(E,E,a),ce.multiply(E,c.globeMatrix,E)}(t,e);return function(a,c,p){const _=(O,G,q)=>{const X=me.length(O),$=me.length(G),re=ya(O,G,q);return me.scale(re,re,1/me.length(re)*Ki(X,$,q))},v=_([a[0],a[1],a[2]],[c[0],c[1],c[2]],p),E=_([a[4],a[5],a[6]],[c[4],c[5],c[6]],p),C=_([a[8],a[9],a[10]],[c[8],c[9],c[10]],p),B=ya([a[12],a[13],a[14]],[c[12],c[13],c[14]],p);return[v[0],v[1],v[2],0,E[0],E[1],E[2],0,C[0],C[1],C[2],0,B[0],B[1],B[2],1]}(n,s,r)}return n}const nf=64,jT=[1,1,1];class Rx{constructor(e,i,r,n){this.id=e,this.position=i!=null?new er(i[0],i[1]):new er(0,0),this.orientation=r??[0,0,0],this.nodes=n,this.uploaded=!1,this.aabb=new Hr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(e,i){if(ce.multiply(e.matrix,i,e.matrix),e.meshes)for(const r of e.meshes){const n=Hr.applyTransform(r.aabb,e.matrix);this.aabb.encapsulate(n)}if(e.children)for(const r of e.children)this._applyTransformations(r,e.matrix)}computeBoundsAndApplyParent(){const e=ce.identity([]);for(const i of this.nodes)this._applyTransformations(i,e)}_positionModelOnTerrain(e,i){const r=e.elevation;if(!r)return 0;const n=Hr.projectAabbCorners(this.aabb,this.matrix),s=jn(1,this.position.lat)*e.worldSize,a=function(X,$){const re=[0,0,1],ne=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const ie of ne){const se=X[ie.corners[0]],he=X[ie.corners[1]],ve=X[ie.corners[2]],be=[he[0]-se[0],he[1]-se[1],$*(he[2]-se[2])],De=me.cross(be,be,[ve[0]-se[0],ve[1]-se[1],$*(ve[2]-se[2])]);me.normalize(De,De),ie.dotProductWithUp=me.dot(De,re)}return ne.sort((ie,se)=>ie.dotProductWithUp-se.dotProductWithUp),ne[0].corners}(n,s),c=n[a[0]],p=n[a[1]],_=n[a[2]],v=n[a[3]],E=r.getAtPointOrZero(new Wr(c[0]/e.worldSize,c[1]/e.worldSize),0),C=r.getAtPointOrZero(new Wr(p[0]/e.worldSize,p[1]/e.worldSize),0),B=r.getAtPointOrZero(new Wr(_[0]/e.worldSize,_[1]/e.worldSize),0),O=r.getAtPointOrZero(new Wr(v[0]/e.worldSize,v[1]/e.worldSize),0),G=(E+O)/2,q=(C+B)/2;return G>q?C<B?Jm(i,p,v,c,C,O,E,s):Jm(i,_,c,v,B,E,O,s):E<O?Jm(i,c,p,_,E,C,B,s):Jm(i,v,_,p,O,B,C,s),Math.max(G,q)}computeModelMatrix(e,i,r,n,s,a,c=!1){const p=e.transform,_=p.zoom,v=p.project(this.position),E=dh(this.position.lat,_),C=1/E;ce.identity(this.matrix),ce.translate(this.matrix,this.matrix,[v.x+n[0]*C,v.y+n[1]*C,n[2]]);let B=1,O=1;const G=p.worldSize;if(c){if(p.projection.name==="mercator"){let re=0;p.elevation&&(re=p.elevation.getAtPointOrZero(new Wr(v.x/G,v.y/G),0));const ne=V.transformMat4([],[v.x,v.y,re,1],p.projMatrix)[3]/p.cameraToCenterDistance;B=ne,O=ne*dh(p.center.lat,_)}else if(p.projection.name==="globe"){const re=Lx(this.matrix,p),ne=ce.multiply([],p.projMatrix,re),ie=[0,0,0,1];V.transformMat4(ie,ie,ne);const se=ie[3]/p.cameraToCenterDistance,he=Ho(_),ve=p.projection.pixelsPerMeter(this.position.lat,G)*dh(this.position.lat,_),be=p.projection.pixelsPerMeter(p.center.lat,G)*dh(p.center.lat,_);B=se/Ki(ve,Yy(p.center.lat),he),O=se*E/ve,B*=be,O*=be}}else B=C;ce.scale(this.matrix,this.matrix,[B,B,O]);const q=[...this.matrix],X=this.orientation,$=[];if(Bx($,[X[0]+i[0],X[1]+i[1],X[2]+i[2]],r),ce.multiply(this.matrix,q,$),s&&p.elevation){let re=0;const ne=[];if(a&&p.elevation){re=this._positionModelOnTerrain(p,ne);const ie=ce.fromQuat([],ne),se=ce.multiply([],ie,$);ce.multiply(this.matrix,q,se)}else re=p.elevation.getAtPointOrZero(new Wr(v.x/G,v.y/G),0);re!==0&&(this.matrix[14]+=re)}}upload(e){if(!this.uploaded){for(const i of this.nodes)Wg(i,e);for(const i of this.nodes)$m(i);this.uploaded=!0}}destroy(){for(const e of this.nodes)e_(e)}}function Q0(t,e,i=!1){t.uploaded||(t.gfxTexture=new Bs(e,t.image,i?e.gl.R8:e.gl.RGBA,{useMipmap:t.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),t.uploaded=!0,t.image=null)}function GT(t,e,i){t.indexBuffer=e.createIndexBuffer(t.indexArray,!1,!0),t.vertexBuffer=e.createVertexBuffer(t.vertexArray,PT.members,!1,!0),t.normalArray&&(t.normalBuffer=e.createVertexBuffer(t.normalArray,RT.members,!1,!0)),t.texcoordArray&&(t.texcoordBuffer=e.createVertexBuffer(t.texcoordArray,LT.members,!1,!0)),t.colorArray&&(t.colorBuffer=e.createVertexBuffer(t.colorArray,(t.colorArray.bytesPerElement===12?zT:BT).members,!1,!0)),t.featureArray&&(t.pbrBuffer=e.createVertexBuffer(t.featureArray,OT.members,!0)),t.segments=Mn.simpleSegment(0,0,t.vertexArray.length,t.indexArray.length);const r=t.material;r.pbrMetallicRoughness.baseColorTexture&&Q0(r.pbrMetallicRoughness.baseColorTexture,e),r.pbrMetallicRoughness.metallicRoughnessTexture&&Q0(r.pbrMetallicRoughness.metallicRoughnessTexture,e),r.normalTexture&&Q0(r.normalTexture,e),r.occlusionTexture&&Q0(r.occlusionTexture,e,i),r.emissionTexture&&Q0(r.emissionTexture,e)}function Wg(t,e,i){if(t.meshes)for(const r of t.meshes)GT(r,e,i);if(t.children)for(const r of t.children)Wg(r,e,i)}function $m(t){if(t.meshes)for(const e of t.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(t.children)for(const e of t.children)$m(e)}function e_(t){if(t.meshes)for(const i of t.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((e=i.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(t.children)for(const i of t.children)e_(i)}class Fx{constructor(e,i){this.feature=e,this.instancedDataOffset=i,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class Ox{constructor(){this.instancedDataArray=new Wd,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class Nx{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0}}populate(e,i,r,n){this.tileToMeter=C0(r);const s=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:a,id:c,index:p,sourceLayerIndex:_}of e){const v=ph(a,s);if(!this.layers[0]._featureFilter.filter(new _s(this.zoom),v,r))continue;const E={id:c,sourceLayerIndex:_,index:p,geometry:s?v.geometry:yu(a,r,n),properties:a.properties,type:a.type,patterns:{}},C=this.addFeature(E,E.geometry,v);C&&i.featureIndex.insert(a,E.geometry,p,_,this.index,this.instancesPerModel[C].instancedDataArray.length)}this.lookup=null}update(e,i,r,n){for(const s in this.instancesPerModel){const a=this.instancesPerModel[s];for(const c in e)a.idToFeaturesIndex.hasOwnProperty(c)&&this.evaluate(a.features[a.idToFeaturesIndex[c]],e[c],a,!0)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const i in this.instancesPerModel){const r=this.instancesPerModel[i];for(const n of r.features){const s=this.layers[0],a=n.feature,c=this.canonical,p=s.paint.get("model-rotation").evaluate(a,{},c),_=s.paint.get("model-scale").evaluate(a,{},c),v=s.paint.get("model-translation").evaluate(a,{},c);me.exactEquals(n.rotation,p)&&me.exactEquals(n.scale,_)&&me.exactEquals(n.translation,v)||(this.evaluate(n,n.featureStates,r,!0),e=!0)}}return e}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const i in this.instancesPerModel){const r=this.instancesPerModel[i];r.instancedDataArray.length<0||r.instancedDataArray.length===0||(r.instancedDataBuffer?r.instancedDataBuffer.updateData(r.instancedDataArray):r.instancedDataBuffer=e.createVertexBuffer(r.instancedDataArray,FT.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const e in this.instancesPerModel){const i=this.instancesPerModel[e];i.instancedDataArray.length!==0&&i.instancedDataBuffer&&i.instancedDataBuffer.destroy()}}addFeature(e,i,r){const n=this.layers[0],s=n.layout.get("model-id").evaluate(r,{},this.canonical);if(!s)return Be(`modelId is not evaluated for layer ${n.id} and it is not going to get rendered.`),s;this.instancesPerModel[s]||(this.instancesPerModel[s]=new Ox);const a=this.instancesPerModel[s],c=a.instancedDataArray,p=new Fx(r,c.length);for(const _ of i)for(const v of _){if(v.x<0||v.x>=Mt||v.y<0||v.y>=Mt)continue;const E=(this.lookupDim-1)/Mt,C=this.lookupDim*(v.y*E|0)+v.x*E|0;if(this.lookup){if(this.lookup[C]!==0)continue;this.lookup[C]=1}this.instanceCount++;const B=c.length;c.resize(B+1),a.instancesEvaluatedElevation.push(0),c.float32[16*B]=v.x,c.float32[16*B+1]=v.y}return p.instancedDataCount=a.instancedDataArray.length-p.instancedDataOffset,p.instancedDataCount>0&&(e.id&&(a.idToFeaturesIndex[e.id]=a.features.length),a.features.push(p),this.evaluate(p,{},a,!1)),s}evaluate(e,i,r,n){const s=this.layers[0],a=e.feature,c=this.canonical,p=e.rotation=s.paint.get("model-rotation").evaluate(a,i,c),_=e.scale=s.paint.get("model-scale").evaluate(a,i,c),v=e.translation=s.paint.get("model-translation").evaluate(a,i,c),E=s.paint.get("model-color").evaluate(a,i,c);E.a=s.paint.get("model-color-mix-intensity").evaluate(a,i,c);const C=[];this.maxVerticalOffset<v[2]&&(this.maxVerticalOffset=v[2]),this.maxScale=Math.max(Math.max(this.maxScale,_[0]),Math.max(_[1],_[2])),Bx(C,p,_);const B=Math.round(100*E.a)+E.b/1.05;for(let O=0;O<e.instancedDataCount;++O){const G=e.instancedDataOffset+O,q=16*G,X=r.instancedDataArray.float32;let $=0;n&&($=X[q+6]-r.instancesEvaluatedElevation[G]);const re=0|X[q+1];X[q]=(0|X[q])+E.r/1.05,X[q+1]=re+E.g/1.05,X[q+2]=B,X[q+3]=1/(c.z>10?this.tileToMeter:C0(c,re)),X[q+4]=v[0],X[q+5]=v[1],X[q+6]=v[2]+$,X[q+7]=C[0],X[q+8]=C[1],X[q+9]=C[2],X[q+10]=C[4],X[q+11]=C[5],X[q+12]=C[6],X[q+13]=C[8],X[q+14]=C[9],X[q+15]=C[10],r.instancesEvaluatedElevation[G]=v[2]}}}Mi(Nx,"ModelBucket",{omit:["layers"]}),Mi(Ox,"PerModelAttributes"),Mi(Fx,"ModelFeature");const ZT=new as({visibility:new ri(xt.layout_model.visibility),"model-id":new Gi(xt.layout_model["model-id"])});var qT={paint:new as({"model-opacity":new ri(xt.paint_model["model-opacity"]),"model-rotation":new Gi(xt.paint_model["model-rotation"]),"model-scale":new Gi(xt.paint_model["model-scale"]),"model-translation":new Gi(xt.paint_model["model-translation"]),"model-color":new Gi(xt.paint_model["model-color"]),"model-color-mix-intensity":new Gi(xt.paint_model["model-color-mix-intensity"]),"model-type":new ri(xt.paint_model["model-type"]),"model-cast-shadows":new ri(xt.paint_model["model-cast-shadows"]),"model-receive-shadows":new ri(xt.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new ri(xt.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Gi(xt.paint_model["model-emissive-strength"]),"model-roughness":new Gi(xt.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Gi(xt.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new ri(xt.paint_model["model-cutoff-fade-range"])}),layout:ZT};const Xg=new Float32Array(262144),sf=new Uint8Array(262144);function Ux(t){let e=0;if(t.meshes)for(const i of t.meshes)e=Math.max(e,i.aabb.max[2]);if(t.children)for(const i of t.children)e=Math.max(e,Ux(i));return e}const Vx=["","wall","door","roof","window","lamp","logo"];class jx{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:e.id,geometry:[],properties:{height:Ux(e)}}}}class Gx{constructor(e,i,r,n){this.nodes=e,this.id=i,this.modelTraits|=1,this.uploaded=!1,this.hasPattern=!1,r&&(this.modelTraits|=4),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=n,this.dirty=!0,this.needsUpload=!1}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const i=this.getNodesInfo();for(const r of i){const n=r.node;this.uploaded?this.updatePbrBuffer(n):Wg(n,e,!0)}for(const r of i)$m(r.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let i=!1;if(!e.meshes)return i;for(const r of e.meshes)r.pbrBuffer&&(r.pbrBuffer.updateData(r.featureArray),i=!0);return i}needsReEvaluation(e,i,r){const n=e.transform.projectionOptions,s=e.style.getBrightness(),a=this.brightness!==s;return!!(!this.uploaded||this.dirty||n.name!==this.projection.name||H0(r.paint.get("model-color").value,a)||H0(r.paint.get("model-color-mix-intensity").value,a)||H0(r.paint.get("model-roughness").value,a)||H0(r.paint.get("model-emissive-strength").value,a)||H0(r.paint.get("model-height-based-emissive-strength-multiplier").value,a))&&(this.projection=n,this.brightness=s,!0)}evaluateScale(e,i){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const r=this.getNodesInfo(),n=this.id.canonical;for(const s of r){const a=s.feature;s.evaluatedScale=i.paint.get("model-scale").evaluate(a,{},n)}}evaluate(e){const i=this.getNodesInfo();for(const r of i){if(!r.node.meshes)continue;const n=r.feature,s=r.node.meshes&&r.node.meshes[0].featureData,a=r.evaluatedColor[2],c=r.evaluatedRMEA[2],p=this.id.canonical;if(r.hasTranslucentParts=!1,s){for(let _=0;_<Vx.length;_++){const v=Vx[_];v.length&&(n.properties.part=v);const E=e.paint.get("model-color").evaluate(n,{},p),C=e.paint.get("model-color-mix-intensity").evaluate(n,{},p);r.evaluatedColor[_]=[E.r,E.g,E.b,C],r.evaluatedRMEA[_][0]=e.paint.get("model-roughness").evaluate(n,{},p),r.evaluatedRMEA[_][2]=e.paint.get("model-emissive-strength").evaluate(n,{},p),r.evaluatedRMEA[_][3]=E.a,r.emissionHeightBasedParams[_]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(n,{},p),!r.hasTranslucentParts&&E.a<1&&(r.hasTranslucentParts=!0)}delete n.properties.part,HT(r,a!==r.evaluatedColor[2]||c!==r.evaluatedRMEA[2])}r.evaluatedScale=e.paint.get("model-scale").evaluate(n,{},p),this.updatePbrBuffer(r.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,i,r,n){const s=e.findDEMTileFor(r);if(s&&(s.tileID.canonical!==this.terrainTile||i!==this.terrainExaggeration)){if(s.dem&&s.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=s.tileID.overscaledZ;const a=sd.create(e,r,s);if(!a)return;4&this.modelTraits&&this.updateDEM(e,a,r,n);for(const c of this.getNodesInfo()){const p=c.node;if(!p.footprint||!p.footprint.vertices||!p.footprint.vertices.length)continue;const _=p.footprint.vertices;let v=a.getElevationAt(_[0].x,_[0].y,!0,!0);for(let E=1;E<_.length;E++)v=Math.min(v,a.getElevationAt(_[E].x,_[E].y,!0,!0));p.elevation=v}}this.terrainTile=s.tileID.canonical,this.terrainExaggeration=i}}updateDEM(e,i,r,n){let s=i._dem._modifiedForSources[n];if(s===void 0&&(i._dem._modifiedForSources[n]=[],s=i._dem._modifiedForSources[n]),s.includes(r.canonical))return;const a=i._dem.dim;s.push(r.canonical);let c=!1;for(const p of this.getNodesInfo()){const _=p.node;if(!_.footprint||!_.footprint.grid)continue;const v=_.footprint.grid,E=i.tileCoordToPixel(v.min.x,v.min.y),C=i.tileCoordToPixel(v.max.x,v.max.y),B=Math.min(Math.min(a-C.y,E.x),Math.min(E.y,a-C.x));if(B<0)continue;const O=Ai(B,2,5);let G=Math.max(0,E.x-O),q=Math.max(0,E.y-O),X=Math.min(C.x+O,a-1),$=Math.min(C.y+O,a-1);for(let se=q;se<=$;++se)for(let he=G;he<=X;++he)sf[se*a+he]=255;let re=0,ne=0;for(let se=0;se<v.cellsY;++se)for(let he=0;he<v.cellsX;++he){if(!v.cells[se*v.cellsX+he])continue;const ve=i.tileCoordToPixel(v.min.x+he/v.xScale,v.min.y+se/v.yScale),be=i.tileCoordToPixel(v.min.x+(he+1)/v.xScale,v.min.y+(se+1)/v.yScale);for(let De=ve.y;De<=Math.min(be.y+1,a-1);++De)for(let Ve=ve.x;Ve<=Math.min(be.x+1,a-1);++Ve)sf[De*a+Ve]===255&&(sf[De*a+Ve]=0,re+=i.getElevationAtPixel(Ve,De),ne++)}const ie=re/ne;G=Math.max(1,E.x-O),q=Math.max(1,E.y-O),X=Math.min(C.x+O,a-2),$=Math.min(C.y+O,a-2),c=!0;for(let se=q;se<=$;++se)for(let he=G;he<=X;++he)sf[se*a+he]===0&&(Xg[se*a+he]=i._dem.set(he,se,ie));for(let se=1;se<O;++se){G=Math.max(1,E.x-se),q=Math.max(1,E.y-se),X=Math.min(C.x+se,a-2),$=Math.min(C.y+se,a-2);for(let he=q;he<=$;++he)for(let ve=G;ve<=X;++ve){const be=he*a+ve;if(sf[be]===255){let De=0,Ve=0,je=-1,Je=-1;for(let Fe=-1;Fe<=1;++Fe)for(let nt=-1;nt<=1;++nt){const At=(he+Fe)*a+ve+nt;if(sf[At]>=se)continue;const vt=Xg[At],rt=Math.abs(vt);rt>Ve&&(De=vt,Ve=rt,je=nt,Je=Fe)}if(Ve>.1){const Fe=1-(se+.5*Math.abs(je*Je))/O;let nt=i._dem.get(ve,he)+De*Fe;const At=i._dem.get(ve+je,he+Je),vt=i._dem.get(ve-je,he-Je,!0);(nt-At)*(nt-vt)>0&&(nt=(At+vt)/2),Xg[be]=i._dem.set(ve,he,nt),sf[be]=se}}}}}c&&(i._demTile.needsDEMTextureUpload=!0,i._dem._timestamp=Wi.now())}getNodesInfo(){if(!this.nodesInfo){this.nodesInfo=[];for(const e of this.nodes)this.nodesInfo.push(new jx(e));this.freeNodes()}return this.nodesInfo}freeNodes(){if(this.nodes){for(const e of this.nodes)e_(e);this.nodes.splice(0,this.nodes.length)}}destroy(){this.freeNodes();const e=this.getNodesInfo();for(const i of e)$m(i.node),e_(i.node)}isEmpty(){return!this.nodes.length}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const r=i.getReplacementRegionsForTile(e.toUnwrapped()),n=this.getNodesInfo();for(let s=0;s<this.nodesInfo.length;s++){const a=n[s].node;n[s].hiddenByReplacement=!!a.footprint&&!r.find(c=>c.footprint===a.footprint)}}getHeightAtTileCoord(e,i){const r=this.getNodesInfo(),n=[];for(let s=0;s<this.nodesInfo.length;s++){const a=r[s],c=a.node.meshes[0];if(e<c.aabb.min[0]||i<c.aabb.min[1]||e>c.aabb.max[0]||i>c.aabb.max[1])continue;const p=(e-c.aabb.min[0])/(c.aabb.max[0]-c.aabb.min[0])*nf|0,_=Math.min(63,(i-c.aabb.min[1])/(c.aabb.max[1]-c.aabb.min[1])*nf|0)*nf+Math.min(63,p);if(!(c.heightmap[_]<0&&a.node.footprint))return a.hiddenByReplacement?void 0:{height:c.heightmap[_],maxHeight:a.feature.properties.height,hidden:!1,verticalScale:a.evaluatedScale[2]};if(a.node.footprint.grid.query(new ct(e,i),new ct(e,i),n),n.length>0)return{height:void 0,maxHeight:a.feature.properties.height,hidden:a.hiddenByReplacement,verticalScale:a.evaluatedScale[2]}}}}function H0(t,e){return!t.isLightConstant&&e}function QT(t,e,i,r,n,s,a,c){let p=(61440&e|(61440&e)>>4)>>8,_=(3840&e|(3840&e)>>4)>>4,v=240&e|(240&e)>>4;i[3]>0&&(p=Ki(p,255*i[0],i[3]),_=Ki(_,255*i[1],i[3]),v=Ki(v,255*i[2],i[3]));const E=p<<8|_,C=v<<8|Math.floor(255*r[3]),B=function(se){const he=Ai(se,0,2);return Math.min(Math.round(.5*he*255),255)}(r[2])<<8|15*r[0]<<4|15*r[1],O=Ai(n[0],0,1),G=Ai(n[1],0,1),q=Ai(n[2],0,1),X=Ai(n[3],0,1);let $,re,ne,ie;if(O!==G&&a!==s&&G!==O){const se=a-s;re=1/(se*(G-O)),ne=-(s+se*O)/(se*(G-O));const he=Ai(n[4],-1,1);ie=Math.pow(10,he),$=255*q<<8|255*X}else $=65535,re=0,ne=1,ie=1;if(t.emplaceBack(E,C,B,$,re,ne,ie),c){const se=c.length;c.clear();for(let he=0;he<se;he++)c.emplaceBack(E,C,B,$,re,ne,ie)}}function HT(t,e){const i=t.node;let r=0;for(const n of i.meshes){if(i.lights&&i.lightMeshIndex===r||!n.featureData)continue;n.featureArray=new Nh,n.featureArray.reserve(n.featureData.length);let s=e;for(const a of n.featureData){let c;const p=65535&a,_=(15&p)<8?15&p:0,v=a>>16&65535,E=t.evaluatedRMEA[_],C=t.evaluatedColor[_],B=t.emissionHeightBasedParams[_];if(s&&_===2&&i.lights&&(c=new Nh,c.resize(10*i.lights.length)),QT(n.featureArray,v,C,E,B,n.aabb.min[2],n.aabb.max[2],c),c&&s){s=!1;const O=i.meshes[i.lightMeshIndex];O.featureArray=c,O.featureArray._trim()}}n.featureArray._trim(),r++}}Mi(Gx,"Tiled3dModelBucket",{omit:["layers"]}),Mi(jx,"Tiled3dModelFeature");class WT{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[]}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(e){const i=Qx(new ct(0,0),new ct(Mt,Mt),e),r=[];for(const n of this._activeRegions){if(n.hiddenByOverlap||!qx(i,n))continue;const s=XT(n.min,n.max,e);r.push({min:s.min,max:s.max,sourceId:this._sourceIds[n.priority],footprint:n.footprint,footprintTileId:n.tileId})}return r}setSources(e){this._setSources(e.map(i=>({getSourceId:()=>i.cache.id,getFootprints:()=>{const r=[];for(const n of i.cache.getVisibleCoordinates()){const s=i.cache.getTile(n).buckets[i.layer];if(s)for(const a of s.getNodesInfo()){const c=a.node;c.footprint&&r.push({footprint:c.footprint,id:n.toUnwrapped()})}}return r}})))}_addSource(e){const i=e.getFootprints();if(i.length!==0){for(const r of i){if(!r.footprint)continue;const n=Qx(r.footprint.min,r.footprint.max,r.id);this._activeRegions.push({min:n.min,max:n.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:r.id,footprint:r.footprint})}this._sourceIds.push(e.getSourceId())}}_computeReplacement(){this._activeRegions.sort((i,r)=>i.priority-r.priority||t_(i.min,r.min)||t_(i.max,r.max));let e=this._activeRegions.length!==this._prevRegions.length;if(!e){let i=0,r=0;for(;!e&&i!==this._activeRegions.length;){const n=this._activeRegions[i],s=this._prevRegions[r];e=n.priority!==s.priority||!Zx(n,s),++i,++r}}if(e){++this._updateTime;const i=r=>{const n=this._activeRegions;if(r>=n.length)return r;const s=n[r].priority;for(;r<n.length&&n[r].priority===s;)++r;return r};if(this._sourceIds.length>1){let r=0,n=i(r);for(;r!==n;){let s=r;const a=r;for(;s!==n;){const c=this._activeRegions[s];c.hiddenByOverlap=!1;for(let p=0;p<a;p++){const _=this._activeRegions[p];if(!_.hiddenByOverlap&&qx(c,_)&&(c.hiddenByOverlap=Wx(c.footprint,c.tileId,_.footprint,_.tileId),c.hiddenByOverlap))break}++s}r=n,n=i(r)}}}}_setSources(e){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let i=e.length-1;i>=0;i--)this._addSource(e[i]);this._computeReplacement()}}function t_(t,e){return t.x-e.x||t.y-e.y}function Zx(t,e){return t_(t.min,e.min)===0&&t_(t.max,e.max)===0}function qx(t,e){return!(t.min.x>e.max.x||t.max.x<e.min.x||t.min.y>e.max.y||t.max.y<e.min.y)}function Qx(t,e,i){const r=1/Mt,n=1/(1<<i.canonical.z),s=(e.x*r+i.canonical.x)*n+i.wrap,a=(e.y*r+i.canonical.y)*n;return{min:new ct((t.x*r+i.canonical.x)*n+i.wrap,(t.y*r+i.canonical.y)*n),max:new ct(s,a)}}function XT(t,e,i){const r=1<<i.canonical.z,n=((e.x-i.wrap)*r-i.canonical.x)*Mt,s=(e.y*r-i.canonical.y)*Mt;return{min:new ct(((t.x-i.wrap)*r-i.canonical.x)*Mt,(t.y*r-i.canonical.y)*Mt),max:new ct(n,s)}}function Hx(t,e,i,r,n,s,a){const c=t.indices,p=t.vertices,_=[];for(let v=r;v<r+n;v+=3){const E=e[i[v+0]+s],C=e[i[v+1]+s],B=e[i[v+2]+s],O=Math.min(E.x,C.x,B.x),G=Math.max(E.x,C.x,B.x),q=Math.min(E.y,C.y,B.y),X=Math.max(E.y,C.y,B.y);_.length=0,t.grid.query(new ct(O,q),new ct(G,X),_);for(let $=0;$<_.length;$++){const re=_[$];if(pg(p[c[3*re+0]],p[c[3*re+1]],p[c[3*re+2]],E,C,B,a))return!0}}return!1}function Wx(t,e,i,r){if(!t||!i)return!1;let n=t.vertices;if(!e.canonical.equals(r.canonical)||e.wrap!==r.wrap){if(i.vertices.length<t.vertices.length)return Wx(i,r,t,e);const s=e.canonical,a=r.canonical,c=Math.pow(2,a.z-s.z);n=t.vertices.map(p=>new ct(p.x*s.x*Mt*c-a.x*Mt,p.y*s.y*Mt*c-a.y*Mt))}return Hx(i,n,t.indices,0,t.indices.length,0,0)}const YT=Tm.types,KT=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],JT=["fill-extrusion-flood-light-ground-radius"],$T=Math.pow(2,13),eE=Math.pow(2,15)-1,Xx=new ct(0,1),wu=2147483648;function W0(t,e,i,r,n,s,a,c){t.emplaceBack((e<<1)+a,(i<<1)+s,(Math.floor(r*$T)<<1)+n,Math.round(c))}function i_(t,e,i,r,n,s){t.emplaceBack(e.x,e.y,(i.x<<1)+r,(i.y<<1)+n,s)}function X0(t,e,i){t.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class Yx{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class Kx{constructor(){this.centroidXY=new ct(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new ct(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new ct(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new ct(this.max.x-this.min.x,this.max.y-this.min.y)}}class Jx{constructor(){this.acc=new ct(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,i){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=i.x,e.min.y=e.max.y=i.y)}appendEdge(e,i,r){this.accCount++,this.acc._add(i);let n=!!this.borders;i.x<e.min.x?(e.min.x=i.x,n=!0):i.x>e.max.x&&(e.max.x=i.x,n=!0),i.y<e.min.y?(e.min.y=i.y,n=!0):i.y>e.max.y&&(e.max.y=i.y,n=!0),((i.x===0||i.x===Mt)&&i.x===r.x)!=((i.y===0||i.y===Mt)&&i.y===r.y)&&this.processBorderOverlap(i,r),n&&this.checkBorderIntersection(i,r)}checkBorderIntersection(e,i){i.x<0!=e.x<0&&this.addBorderIntersection(0,Ki(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>Mt!=e.x>Mt&&this.addBorderIntersection(1,Ki(i.y,e.y,(Mt-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,Ki(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>Mt!=e.y>Mt&&this.addBorderIntersection(3,Ki(i.x,e.x,(Mt-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const r=this.borders[e];i<r[0]&&(r[0]=i),i>r[1]&&(r[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const r=e.x===0?0:1;this.addBorderIntersection(r,i.y),this.addBorderIntersection(r,e.y)}else{const r=e.y===0?2:3;this.addBorderIntersection(r,i.x),this.addBorderIntersection(r,e.x)}}centroid(){return this.accCount===0?new ct(0,0):new ct(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0):0}}function $x(t,e){const i=t.add(e)._unit(),r=Ai(t.x*i.x+t.y*i.y,-1,1);var n,s,a;return n=Math.acos(r),Math.min(4,Math.max(-4,Math.tan(n)))/4*eE*((s=t).x*(a=e).y-s.y*a.x<0?-1:1)}const tE=[t=>t.x<0,t=>t.x>Mt,t=>t.y<0,t=>t.y>Mt];function iE(t,e,i,r){const n=[4];if(r===0)return n;i._mult(r);const s=t.sub(i),a=e.sub(i),c=[t,e,s,a];for(let p=0;p<4;p++)for(const _ of c)if(tE[p](_)){n.push(p);break}return n}class ev{constructor(e){this.vertexArray=new bf,this.indexArray=new so,this.programConfigurations=new _c(e.layers,e.zoom,i=>JT.includes(i)),this._segments=new Mn,this.hiddenByLandmarkVertexArray=new Xd,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Mn}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,i,r,n=!1){const s=e.length;if(s>2){let a=Math.max(0,this._segments.get().length-1);const c=this._segments._prepareSegment(4*s,this.vertexArray.length,2*this._segmentToGroundQuads[a].length);let p;a!==this._segments.get().length-1&&(a++,this._segmentToGroundQuads[a]=[],this._segmentToRegionTriCounts[a]=[0,0,0,0,0]);{const _=e[0],v=e[1];p=$x(_.sub(e[s-1])._perp()._unit(),v.sub(_)._perp()._unit())}for(let _=0;_<s;_++){const v=_===s-1?0:_+1,E=e[_],C=e[v],B=e[v===s-1?0:v+1],O=C.sub(E)._perp()._unit(),G=$x(O,B.sub(C)._perp()._unit()),q=p,X=G;if(Yg(E,C,i)||n&&rv(E,i)&&rv(C,i)){p=G;continue}const $=c.vertexLength;i_(this.vertexArray,E,C,1,1,q),i_(this.vertexArray,E,C,1,0,q),i_(this.vertexArray,E,C,0,1,X),i_(this.vertexArray,E,C,0,0,X),c.vertexLength+=4;const re=iE(E,C,O,r);for(const ne of re)this._segmentToGroundQuads[a].push({id:$,region:ne}),this._segmentToRegionTriCounts[a][ne]+=2,c.primitiveLength+=2;p=G}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),i=e.length;for(let r=0;r<i;r++)this._segmentToGroundQuads[r].sort((n,s)=>n.region-s.region);for(let r=0;r<i;r++){const n=this._segmentToGroundQuads[r],s=e[r],a=this._segmentToRegionTriCounts[r];a.reduce((p,_)=>p+_,0);let c=0;for(let p=0;p<=4;p++){const _=a[p];if(_!==0){let v=this.regionSegments[p];v||(v=this.regionSegments[p]=new Mn);const E={vertexOffset:s.vertexOffset,primitiveOffset:s.primitiveOffset+c,vertexLength:s.vertexLength,primitiveLength:_};v.get().push(E)}c+=_}for(let p=0;p<n.length;p++){const _=n[p].id;this.indexArray.emplaceBack(_,_+1,_+3),this.indexArray.emplaceBack(_,_+3,_+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,i,r,n,s,a){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,i,r,n,s,a)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,S2.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,i,r,n,s,a){this.hasData()&&this.programConfigurations.updatePaintArrays(e,i,r,n,s,a)}updateHiddenByLandmark(e){if(!this.hasData())return;const i=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;const r=e.flags&wu?1:0;for(let n=e.groundVertexArrayOffset;n<i;++n)this.hiddenByLandmarkVertexArray.emplace(n,r);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,C2.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const i=this.regionSegments[e];i&&i.destroy()}}}}class Y0{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new so,this.footprintVertices=new pl,this.footprintSegments=[],this.layoutVertexArray=new Uc,this.centroidVertexArray=new If,this.indexArray=new so,this.programConfigurations=new _c(e.layers,e.zoom,i=>KT.includes(i)),this.segments=new Mn,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.groundEffect=new ev(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}populate(e,i,r,n){this.features=[],this.hasPattern=bg("fill-extrusion",this.layers,i),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=C0(r),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:s,id:a,index:c,sourceLayerIndex:p}of e){const _=this.layers[0]._featureFilter.needGeometry,v=ph(s,_);if(!this.layers[0]._featureFilter.filter(new _s(this.zoom),v,r))continue;const E={id:a,sourceLayerIndex:p,index:c,geometry:_?v.geometry:yu(s,r,n),properties:s.properties,type:s.type,patterns:{}},C=this.layoutVertexArray.length;this.hasPattern?this.features.push(wg("fill-extrusion",this.layers,E,this.zoom,i)):this.addFeature(E,E.geometry,c,r,{},i.availableImages,n,i.brightness),i.featureIndex.insert(s,E.geometry,c,p,this.index,C)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,i,r,n,s,a){for(const c of this.features){const{geometry:p}=c;this.addFeature(c,p,c.index,i,r,n,s,a)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,i,r,n,s){const a=Object.keys(e).length!==0;if(a&&!this.stateDependentLayers.length)return;const c=a?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(e,i,c,r,n,s),this.groundEffect.update(e,i,c,r,n,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,D2),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,k2.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,I2.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,r,n,s,a,c,p){const _=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,v=[new ct(0,0),new ct(Mt,Mt)],E=c.projection,C=E.name==="globe",B=YT[e.type]==="Polygon",O=new Jx;O.centroidDataIndex=this.centroidData.length;const G=new Kx,q=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},n)<=0,X=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},n);G.height=X,G.vertexArrayOffset=this.layoutVertexArray.length,G.groundVertexArrayOffset=this.groundEffect.vertexArray.length,C&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Ef);const $=vg(i,500);for(let ve=$.length-1;ve>=0;ve--){const be=$[ve];(be.length===0||(re=be[0]).every(De=>De.x<=0)||re.every(De=>De.x>=Mt)||re.every(De=>De.y<=0)||re.every(De=>De.y>=Mt))&&$.splice(ve,1)}var re;let ne;if(C)ne=av($,v,n);else{ne=[];for(const ve of $)ne.push({polygon:ve,bounds:v})}const ie=B?this.edgeRadius:0,se=ie>0&&this.zoom<17,he=(ve,be)=>{if(ve.length===0)return!1;const De=ve[ve.length-1];return be.x===De.x&&be.y===De.y};for(const{polygon:ve,bounds:be}of ne){let De=0,Ve=0;for(const nt of ve)B&&!nt[0].equals(nt[nt.length-1])&&nt.push(nt[0]),Ve+=B?nt.length-1:nt.length;const je=this.segments.prepareSegment((B?5:4)*Ve,this.layoutVertexArray,this.indexArray);G.footprintSegIdx<0&&(G.footprintSegIdx=this.footprintSegments.length),G.polygonSegIdx<0&&(G.polygonSegIdx=this.polygonSegments.length);const Je={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Fe=new Yx;if(Fe.vertexOffset=this.footprintVertices.length,Fe.indexOffset=3*this.footprintIndices.length,Fe.ringIndices=[],B){const nt=[],At=[];De=je.vertexLength;for(let rt=0;rt<ve.length;rt++){const lt=ve[rt];lt.length&&rt!==0&&At.push(nt.length/2);const wt=[];let It,St;It=lt[1].sub(lt[0])._perp()._unit(),Fe.ringIndices.push(lt.length-1);for(let Bt=1;Bt<lt.length;Bt++){const Ft=lt[Bt],jt=lt[Bt===lt.length-1?1:Bt+1],Dt=Ft.clone();if(ie){St=jt.sub(Ft)._perp()._unit();const Yt=It.add(St)._unit(),fi=ie*Math.min(4,1/(It.x*Yt.x+It.y*Yt.y));Dt.x+=fi*Yt.x,Dt.y+=fi*Yt.y,Dt.x=Math.round(Dt.x),Dt.y=Math.round(Dt.y),It=St}!q||ie!==0&&!se||he(wt,Dt)||wt.push(Dt),W0(this.layoutVertexArray,Dt.x,Dt.y,0,0,1,1,0),je.vertexLength++,this.footprintVertices.emplaceBack(Ft.x,Ft.y),nt.push(Ft.x,Ft.y),C&&X0(this.layoutVertexExtArray,E.projectTilePoint(Dt.x,Dt.y,n),E.upVector(n,Dt.x,Dt.y))}q&&(ie===0||se)&&(wt.length!==0&&he(wt,wt[0])&&wt.pop(),this.groundEffect.addData(wt,be,_))}const vt=vm(nt,At);for(let rt=0;rt<vt.length;rt+=3)this.footprintIndices.emplaceBack(Fe.vertexOffset+vt[rt+0],Fe.vertexOffset+vt[rt+1],Fe.vertexOffset+vt[rt+2]),this.indexArray.emplaceBack(De+vt[rt],De+vt[rt+2],De+vt[rt+1]),je.primitiveLength++;Fe.indexCount+=vt.length,Fe.vertexCount+=this.footprintVertices.length-Fe.vertexOffset}for(let nt=0;nt<ve.length;nt++){const At=ve[nt];O.startRing(G,At[0]);let vt=At.length>4&&nv(At[At.length-2],At[0],At[1]),rt=ie?rE(At[At.length-2],At[0],At[1],ie):0;const lt=[];let wt,It,St;It=At[1].sub(At[0])._perp()._unit();let Bt=!0;for(let Ft=1,jt=0;Ft<At.length;Ft++){let Dt=At[Ft-1],Yt=At[Ft];const fi=At[Ft===At.length-1?1:Ft+1];if(O.appendEdge(G,Yt,Dt),Yg(Yt,Dt,be)){ie&&(It=fi.sub(Yt)._perp()._unit(),Bt=!Bt);continue}const di=Yt.sub(Dt)._perp(),vi=di.x/(Math.abs(di.x)+Math.abs(di.y)),bi=di.y>0?1:0,Ar=Dt.dist(Yt);if(jt+Ar>32768&&(jt=0),ie){St=fi.sub(Yt)._perp()._unit();let cr=iv(Dt,Yt,fi,tv(It,St),ie);isNaN(cr)&&(cr=0);const rr=Yt.sub(Dt)._unit();Dt=Dt.add(rr.mult(rt))._round(),Yt=Yt.add(rr.mult(-cr))._round(),rt=cr,It=St,q&&this.zoom>=17&&(he(lt,Dt)||lt.push(Dt),he(lt,Yt)||lt.push(Yt))}const Ni=je.vertexLength,rn=At.length>4&&nv(Dt,Yt,fi);let Vr=sv(jt,vt,Bt);if(W0(this.layoutVertexArray,Dt.x,Dt.y,vi,bi,0,0,Vr),W0(this.layoutVertexArray,Dt.x,Dt.y,vi,bi,0,1,Vr),jt+=Ar,Vr=sv(jt,rn,!Bt),vt=rn,W0(this.layoutVertexArray,Yt.x,Yt.y,vi,bi,0,0,Vr),W0(this.layoutVertexArray,Yt.x,Yt.y,vi,bi,0,1,Vr),je.vertexLength+=4,this.indexArray.emplaceBack(Ni+0,Ni+1,Ni+2),this.indexArray.emplaceBack(Ni+1,Ni+3,Ni+2),je.primitiveLength+=2,ie){const cr=De+(Ft===1?At.length-2:Ft-2),rr=Ft===1?De:cr+1;if(this.indexArray.emplaceBack(Ni+1,cr,Ni+3),this.indexArray.emplaceBack(cr,rr,Ni+3),je.primitiveLength+=2,wt===void 0&&(wt=Ni),!Yg(fi,At[Ft],be)){const Hi=Ft===At.length-1?wt:je.vertexLength;this.indexArray.emplaceBack(Ni+2,Ni+3,Hi),this.indexArray.emplaceBack(Ni+3,Hi+1,Hi),this.indexArray.emplaceBack(Ni+3,rr,Hi+1),je.primitiveLength+=3}Bt=!Bt}if(C){const cr=this.layoutVertexExtArray,rr=E.projectTilePoint(Dt.x,Dt.y,n),Hi=E.projectTilePoint(Yt.x,Yt.y,n),Zr=E.upVector(n,Dt.x,Dt.y),Kr=E.upVector(n,Yt.x,Yt.y);X0(cr,rr,Zr),X0(cr,rr,Zr),X0(cr,Hi,Kr),X0(cr,Hi,Kr)}}B&&(De+=At.length-1),q&&ie&&this.zoom>=17&&(lt.length!==0&&he(lt,lt[0])&&lt.pop(),this.groundEffect.addData(lt,be,_,ie>0))}this.footprintSegments.push(Fe),Je.triangleCount=this.indexArray.length-Je.triangleArrayOffset,this.polygonSegments.push(Je),++G.footprintSegLen,++G.polygonSegLen}if(G.vertexCount=this.layoutVertexArray.length-G.vertexArrayOffset,G.groundVertexCount=this.groundEffect.vertexArray.length-G.groundVertexArrayOffset,G.vertexCount!==0){if(G.centroidXY=O.borders?Xx:this.encodeCentroid(O,G),this.centroidData.push(G),O.borders){this.featuresOnBorder.push(O);const ve=this.featuresOnBorder.length-1;for(let be=0;be<O.borders.length;be++)O.borders[be][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[be].push(ve)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,s,a,n,p),this.groundEffect.addPaintPropertiesData(e,r,s,a,n,p),this.maxHeight=Math.max(this.maxHeight,X)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((i,r)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[r].borders[e][0])}splitToSubtiles(){const e=[];for(let c=0;c<this.centroidData.length;c++){const p=this.centroidData[c],_=+(p.min.y+p.max.y>Mt),v=2*_+(+(p.min.x+p.max.x>Mt)^_);for(let E=0;E<p.polygonSegLen;E++){const C=p.polygonSegIdx+E;e.push({centroidIdx:c,subtile:v,polygonSegmentIdx:C,triangleSegmentIdx:this.polygonSegments[C].triangleSegIdx})}}const i=new so;e.sort((c,p)=>c.triangleSegmentIdx===p.triangleSegmentIdx?c.subtile-p.subtile:c.triangleSegmentIdx-p.triangleSegmentIdx);let r=0,n=0,s=0;for(const c of e){if(c.triangleSegmentIdx!==r)break;s++}const a=e.length;for(;n!==e.length;){r=e[n].triangleSegmentIdx;let c=0,p=n,_=n;for(let v=p;v<s&&e[v].subtile===c;v++)_++;for(;p!==s;){const v=e[p];c=v.subtile;const E=this.centroidData[v.centroidIdx].min.clone(),C=this.centroidData[v.centroidIdx].max.clone(),B={vertexOffset:this.segments.segments[r].vertexOffset,primitiveOffset:i.length,vertexLength:this.segments.segments[r].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let O=p;O<_;O++){const G=e[O],q=this.polygonSegments[G.polygonSegmentIdx],X=this.centroidData[G.centroidIdx].min,$=this.centroidData[G.centroidIdx].max,re=this.indexArray.uint16;for(let ne=q.triangleArrayOffset;ne<q.triangleArrayOffset+q.triangleCount;ne++)i.emplaceBack(re[3*ne],re[3*ne+1],re[3*ne+2]);B.primitiveLength+=q.triangleCount,E.x=Math.min(E.x,X.x),E.y=Math.min(E.y,X.y),C.x=Math.max(C.x,$.x),C.y=Math.max(C.y,$.y)}B.primitiveLength>0&&this.triangleSubSegments.push({segment:B,min:E,max:C}),p=_;for(let O=p;O<s&&e[O].subtile===e[p].subtile;O++)_++}n=s;for(let v=n;v<a&&e[v].triangleSegmentIdx===e[n].triangleSegmentIdx;v++)s++}i._trim(),this.indexArray=i}getVisibleSegments(e,i,r){let n=0,s=0;const a=1<<e.canonical.z;if(i){const G=i.getMinMaxForTile(e);G&&(n=G.min,s=G.max)}s+=this.maxHeight;const c=e.toUnwrapped();let p;const _=[c.canonical.x/a+c.wrap,c.canonical.y/a],v=[(c.canonical.x+1)/a+c.wrap,(c.canonical.y+1)/a],E=new Mn,C=(G,q,X)=>[G[0]*(1-X[0])+q[0]*X[0],G[1]*(1-X[1])+q[1]*X[1]],B=[],O=[];for(const G of this.triangleSubSegments){B[0]=G.min.x/Mt,B[1]=G.min.y/Mt,O[0]=G.max.x/Mt,O[1]=G.max.y/Mt;const q=C(_,v,B),X=C(_,v,O);if(new Hr([q[0],q[1],n],[X[0],X[1],s]).intersectsPrecise(r)===0){p&&(E.segments.push(p),p=void 0);continue}const $=G.segment;p&&p.vertexOffset!==$.vertexOffset&&(E.segments.push(p),p=void 0),p?(p.vertexLength+=$.vertexLength,p.primitiveLength+=$.primitiveLength):p={vertexOffset:$.vertexOffset,primitiveLength:$.primitiveLength,vertexLength:$.vertexLength,primitiveOffset:$.primitiveOffset,sortKey:void 0,vaos:{}}}return p&&E.segments.push(p),E}encodeCentroid(e,i){const r=e.centroid(),n=i.span(),s=Math.min(7,Math.round(n.x*this.tileToMeter/10)),a=Math.min(7,Math.round(n.y*this.tileToMeter/10));return new ct(Ai(r.x,1,Mt-1)<<3|s,Ai(r.y,1,Mt-1)<<3|a)}showCentroid(e){const i=this.centroidData[e.centroidDataIndex];i.flags&=wu,i.centroidXY.x=0,i.centroidXY.y=0,this.writeCentroidToBuffer(i)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const i=e.vertexArrayOffset,r=e.vertexCount+e.vertexArrayOffset,n=e.flags&wu?Xx:e.centroidXY,s=this.centroidVertexArray.geta_centroid_pos0(i);if(this.centroidVertexArray.geta_centroid_pos1(i)!==n.y||s!==n.x){for(let a=i;a<r;++a)this.centroidVertexArray.emplace(a,n.x,n.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const r=i.getReplacementRegionsForTile(e.toUnwrapped());if(function(s,a){if(s.length!==a.length)return!1;for(let c=0;c<s.length;c++)if(s[c].sourceId!==a[c].sourceId||!Zx(s[c],a[c]))return!1;return!0}(this.activeReplacements,r))return;if(this.activeReplacements=r,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const s of this.centroidData)s.flags&=2147483647;const n=[];for(const s of this.activeReplacements){const a=Math.pow(2,s.footprintTileId.canonical.z-e.canonical.z);for(const c of this.centroidData)if(!(c.flags&wu||s.min.x>c.max.x||c.min.x>s.max.x||s.min.y>c.max.y||c.min.y>s.max.y))for(let p=0;p<c.footprintSegLen;p++){const _=this.footprintSegments[c.footprintSegIdx+p];if(n.length=0,nE(this.footprintVertices,_.vertexOffset,_.vertexCount,s.footprintTileId.canonical,e.canonical,n),Hx(s.footprint,n,this.footprintIndices.uint16,_.indexOffset,_.indexCount,-_.vertexOffset,-a)){c.flags|=wu;break}}}for(const s of this.centroidData)this.writeCentroidToBuffer(s);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,i,r){let n=!1;for(let s=0;s<r.footprintSegLen;s++){const a=this.footprintSegments[r.footprintSegIdx+s];let c=0;for(const p of a.ringIndices){for(let _=c,v=p+c-1;_<p+c;v=_++){const E=this.footprintVertices.int16[2*(_+a.vertexOffset)+0],C=this.footprintVertices.int16[2*(_+a.vertexOffset)+1],B=this.footprintVertices.int16[2*(v+a.vertexOffset)+1];C>i!=B>i&&e<(this.footprintVertices.int16[2*(v+a.vertexOffset)+0]-E)*(i-C)/(B-C)+E&&(n=!n)}c=p}}return n}getHeightAtTileCoord(e,i){let r=Number.NEGATIVE_INFINITY,n=!0;const s=4*(e+Mt)*Mt+(i+Mt);if(this.partLookup.hasOwnProperty(s)){const a=this.partLookup[s];return a?{height:a.height,hidden:!!(a.flags&wu)}:void 0}for(const a of this.centroidData)e>a.max.x||a.min.x>e||i>a.max.y||a.min.y>i||this.footprintContainsPoint(e,i,a)&&a&&a.height>r&&(r=a.height,this.partLookup[s]=a,n=!!(a.flags&wu));if(r!==Number.NEGATIVE_INFINITY)return{height:r,hidden:n};this.partLookup[s]=void 0}}function tv(t,e){const i=t.add(e)._unit();return t.x*i.x+t.y*i.y}function rE(t,e,i,r){const n=e.sub(t)._perp()._unit(),s=i.sub(e)._perp()._unit();return iv(t,e,i,tv(n,s),r)}function iv(t,e,i,r,n){const s=Math.sqrt(1-r*r);return Math.min(t.dist(e)/3,e.dist(i)/3,n*s/r)}function Yg(t,e,i){return t.x<i[0].x&&e.x<i[0].x||t.x>i[1].x&&e.x>i[1].x||t.y<i[0].y&&e.y<i[0].y||t.y>i[1].y&&e.y>i[1].y}function rv(t,e){return t.x<e[0].x||t.x>e[1].x||t.y<e[0].y||t.y>e[1].y}function nv(t,e,i){if(t.x<0||t.x>=Mt||e.x<0||e.x>=Mt||i.x<0||i.x>=Mt)return!1;const r=i.sub(e),n=r.perp(),s=t.sub(e);return(r.x*s.x+r.y*s.y)/Math.sqrt((r.x*r.x+r.y*r.y)*(s.x*s.x+s.y*s.y))>-.866&&n.x*s.x+n.y*s.y<0}function sv(t,e,i){const r=e?2|t:-3&t;return i?1|r:-2&r}function ov(){const t=Math.PI/32,e=Math.tan(t),i=Oa;return i*Math.sqrt(1+2*e*e)-i}function av(t,e,i){const r=1<<i.z,n=MA(i.x/r),s=MA((i.x+1)/r),a=Lo(i.y/r),c=Lo((i.y+1)/r);return function(p,_,v,E,C=0,B){const O=[];if(!p.length||!v||!E)return O;const G=(se,he)=>{for(const ve of se)O.push({polygon:ve,bounds:he})},q=Math.ceil(Math.log2(v)),X=Math.ceil(Math.log2(E)),$=q-X,re=[];for(let se=0;se<Math.abs($);se++)re.push($>0?0:1);for(let se=0;se<Math.min(q,X);se++)re.push(0),re.push(1);let ne=p;if(ne=Em(ne,_[0].y-C,_[1].y+C,1),ne=Em(ne,_[0].x-C,_[1].x+C,0),!ne.length)return O;const ie=[];for(re.length?ie.push({polygons:ne,bounds:_,depth:0}):G(ne,_);ie.length;){const se=ie.pop(),he=se.depth,ve=re[he],be=se.bounds[0],De=se.bounds[1],Ve=ve===0?be.x:be.y,je=ve===0?De.x:De.y,Je=B?B(ve,Ve,je):.5*(Ve+je),Fe=Em(se.polygons,Ve-C,Je+C,ve),nt=Em(se.polygons,Je-C,je+C,ve);if(Fe.length){const At=[be,new ct(ve===0?Je:De.x,ve===1?Je:De.y)];re.length>he+1?ie.push({polygons:Fe,bounds:At,depth:he+1}):G(Fe,At)}if(nt.length){const At=[new ct(ve===0?Je:be.x,ve===1?Je:be.y),De];re.length>he+1?ie.push({polygons:nt,bounds:At,depth:he+1}):G(nt,At)}}return O}(t,e,Math.ceil((s-n)/11.25),Math.ceil((a-c)/11.25),1,(p,_,v)=>{if(p===0)return .5*(_+v);{const E=Lo((i.y+_/Mt)/r);return(oa(.5*(Lo((i.y+v/Mt)/r)+E))*r-i.y)*Mt}})}function nE(t,e,i,r,n,s){const a=Math.pow(2,r.z-n.z);for(let c=0;c<i;c++){let p=t.int16[2*(c+e)+0],_=t.int16[2*(c+e)+1];p=(p+n.x*Mt)*a-r.x*Mt,_=(_+n.y*Mt)*a-r.y*Mt,s.push(new ct(p,_))}}Mi(Y0,"FillExtrusionBucket",{omit:["layers","features"]}),Mi(Kx,"PartData"),Mi(Yx,"FootprintSegment"),Mi(Jx,"BorderCentroidData"),Mi(ev,"GroundEffect");const sE=new as({visibility:new ri(xt["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new ri(xt["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var oE={paint:new as({"fill-extrusion-opacity":new ri(xt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Gi(xt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ri(xt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ri(xt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Gi(xt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Gi(xt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Gi(xt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ri(xt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new ri(xt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new ri(xt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new ri(xt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new ri(xt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new ri(xt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new ri(xt["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new ri(xt["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Gi(xt["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Gi(xt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new ri(xt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new ri(xt["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new ri(xt["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new ri(xt["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new ri(xt["paint_fill-extrusion"]["fill-extrusion-emissive-strength"])}),layout:sE};class dd extends ct{constructor(e,i,r){super(e,i),this.z=r}}function K0(t,e){return t.x*e.x+t.y*e.y}function lv(t,e){if(t.length===1){let i=0;const r=e[i++];let n;for(;!n||r.equals(n);)if(n=e[i++],!n)return 1/0;for(;i<e.length;i++){const s=e[i],a=t[0],c=n.sub(r),p=s.sub(r),_=a.sub(r),v=K0(c,c),E=K0(c,p),C=K0(p,p),B=K0(_,c),O=K0(_,p),G=v*C-E*E,q=(C*B-E*O)/G,X=(v*O-E*B)/G,$=r.z*(1-q-X)+n.z*q+s.z*X;if(isFinite($))return $}return 1/0}{let i=1/0;for(const r of e)i=Math.min(i,r.z);return i}}function Av(t,e,i,r,n,s,a,c){const p=a*n.getElevationAt(t,e,!0,!0),_=s[0]!==0,v=_?s[1]===0?a*(s[0]/7-450):a*function(E,C,B){const O=Math.floor(C[0]/8),G=Math.floor(C[1]/8),q=10*(C[0]-8*O),X=10*(C[1]-8*G),$=E.getElevationAt(O,G,!0,!0),re=E.getMeterToDEM(B),ne=Math.floor(.5*(q*re-1)),ie=Math.floor(.5*(X*re-1)),se=E.tileCoordToPixel(O,G),he=2*ne+1,ve=2*ie+1,be=function(nt,At,vt,rt,lt){return[nt.getElevationAtPixel(At,vt,!0),nt.getElevationAtPixel(At+lt,vt,!0),nt.getElevationAtPixel(At,vt+lt,!0),nt.getElevationAtPixel(At+rt,vt+lt,!0)]}(E,se.x-ne,se.y-ie,he,ve),De=Math.abs(be[0]-be[1]),Ve=Math.abs(be[2]-be[3]),je=Math.abs(be[0]-be[2])+Math.abs(be[1]-be[3]),Je=Math.min(.25,.5*re*(De+Ve)/he),Fe=Math.min(.25,.5*re*je/ve);return $+Math.max(Je*q,Fe*X)}(n,s,c):p;return{base:p+(i===0)?-1:i,top:_?Math.max(v+r,p+i+2):p+r}}const aE=new as({"line-cap":new Gi(xt.layout_line["line-cap"]),"line-join":new Gi(xt.layout_line["line-join"]),"line-miter-limit":new ri(xt.layout_line["line-miter-limit"]),"line-round-limit":new ri(xt.layout_line["line-round-limit"]),"line-sort-key":new Gi(xt.layout_line["line-sort-key"]),visibility:new ri(xt.layout_line.visibility)});var cv={paint:new as({"line-opacity":new Gi(xt.paint_line["line-opacity"]),"line-color":new Gi(xt.paint_line["line-color"]),"line-translate":new ri(xt.paint_line["line-translate"]),"line-translate-anchor":new ri(xt.paint_line["line-translate-anchor"]),"line-width":new Gi(xt.paint_line["line-width"]),"line-gap-width":new Gi(xt.paint_line["line-gap-width"]),"line-offset":new Gi(xt.paint_line["line-offset"]),"line-blur":new Gi(xt.paint_line["line-blur"]),"line-dasharray":new Gi(xt.paint_line["line-dasharray"]),"line-pattern":new Gi(xt.paint_line["line-pattern"]),"line-gradient":new hu(xt.paint_line["line-gradient"]),"line-trim-offset":new ri(xt.paint_line["line-trim-offset"]),"line-emissive-strength":new ri(xt.paint_line["line-emissive-strength"]),"line-border-width":new Gi(xt.paint_line["line-border-width"]),"line-border-color":new Gi(xt.paint_line["line-border-color"])}),layout:aE};const lE=(t,e,i,r,n,s,a)=>{const c=t.transform,p=c.calculatePixelsToTileUnitsMatrix(e);return{u_matrix:hv(t,e,i,r),u_pixels_to_tile_units:p,u_device_pixel_ratio:s,u_units_to_pixels:[1/c.pixelsToGLUnits[0],1/c.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:n,u_texsize:dv(i)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:uv(e,t.transform),u_alpha_discard_threshold:0,u_trim_offset:a,u_emissive_strength:i.paint.get("line-emissive-strength")}},AE=(t,e,i,r,n)=>{const s=t.transform;return{u_matrix:hv(t,e,i,r),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:s.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:n,u_image:0,u_tile_units_to_pixels:uv(e,s),u_units_to_pixels:[1/s.pixelsToGLUnits[0],1/s.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function uv(t,e){return 1/rf(t,1,e.tileZoom)}function hv(t,e,i,r){return t.translatePosMatrix(r||e.tileID.projMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const fv=t=>{const e=[];dv(t)&&e.push("RENDER_LINE_DASH"),t.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const i=t.paint.get("line-trim-offset");return i[0]===0&&i[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),t.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER"),e};function dv(t){const e=t.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}const pv=new class extends Gi{possiblyEvaluate(t,e){return e=new _s(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,i,r){return e=Pt({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,i,r)}}(cv.paint.properties["line-width"].specification);function mv(t,e){return e>0?e+2*t:t}pv.useIntegerZoom=!0;const cE=new as({visibility:new ri(xt.layout_background.visibility)});var uE={paint:new as({"background-color":new ri(xt.paint_background["background-color"]),"background-pattern":new ri(xt.paint_background["background-pattern"]),"background-opacity":new ri(xt.paint_background["background-opacity"]),"background-emissive-strength":new ri(xt.paint_background["background-emissive-strength"])}),layout:cE};const hE=new as({visibility:new ri(xt.layout_raster.visibility)});var fE={paint:new as({"raster-opacity":new ri(xt.paint_raster["raster-opacity"]),"raster-color":new hu(xt.paint_raster["raster-color"]),"raster-color-mix":new ri(xt.paint_raster["raster-color-mix"]),"raster-color-range":new ri(xt.paint_raster["raster-color-range"]),"raster-hue-rotate":new ri(xt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ri(xt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ri(xt.paint_raster["raster-brightness-max"]),"raster-saturation":new ri(xt.paint_raster["raster-saturation"]),"raster-contrast":new ri(xt.paint_raster["raster-contrast"]),"raster-resampling":new ri(xt.paint_raster["raster-resampling"]),"raster-fade-duration":new ri(xt.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new ri(xt.paint_raster["raster-emissive-strength"]),"raster-array-band":new ri(xt.paint_raster["raster-array-band"]),"raster-elevation":new ri(xt.paint_raster["raster-elevation"])}),layout:hE};function _v(t,e,i,r,n,s,a,c){const p=[t,i,n,e,r,s,1,1,1],_=[a,c,1],v=Se.adjoint([],p),[E,C,B]=me.transformMat3(_,_,Se.transpose(v,v));return Se.multiply(p,[E,0,0,0,C,0,0,0,B],p)}class Tc extends ss{constructor(e,i,r,n){super(),this.id=e,this.dispatcher=r,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(n),this.options=i,this._dirty=!1}load(e,i){if(this._loaded=i||!1,this.fire(new Jt("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=Et(this.map._requestManager.transformRequest(this.url,we.Image),(r,n)=>{if(this._imageRequest=null,this._loaded=!0,r)this.fire(new $i(r));else if(n){const{HTMLImageElement:s}=Ee;this.image=n instanceof s?Wi.getImageData(n):n,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading()}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Qm(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Jt("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Qm||this.texture.destroy()}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let i=e[0][1],r=e[0][1];for(const s of e)s[1]>r&&(r=s[1]),s[1]<i&&(i=s[1]);const n=(r+i)/2;if(n>oo?this.onNorthPole=!0:n<-oo&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const s=e.map(Wr.fromLngLat);this.tileID=function(a){let c=1/0,p=1/0,_=-1/0,v=-1/0;for(const O of a)c=Math.min(c,O.x),p=Math.min(p,O.y),_=Math.max(_,O.x),v=Math.max(v,O.y);const E=Math.max(_-c,v-p),C=Math.max(0,Math.floor(-Math.log(E)/Math.LN2)),B=Math.pow(2,C);return new ci(C,Math.floor((c+_)/2*B),Math.floor((p+v)/2*B))}(s),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Jt("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(e){for(const p in this.tiles){const _=this.tiles[p];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture)}if(this._boundsArray)return;const i=tf(this.tileID,this.map.transform.projection),[r,n,s,a]=this.coordinates.map(p=>{const _=i.projection.project(p[0],p[1]);return sx(i,_)._round()});this.perspectiveTransform=function(p,_,v,E,C,B,O,G,q,X){const $=_v(0,0,p,0,0,_,p,_),re=_v(v,E,C,B,O,G,q,X);return Se.multiply(re,Se.adjoint($,$),re),[re[6]/re[8]*p/Mt,re[7]/re[8]*_/Mt]}(this.width,this.height,r.x,r.y,n.x,n.y,a.x,a.y,s.x,s.y);const c=this._boundsArray=new Uc;c.emplaceBack(r.x,r.y,0,0),c.emplaceBack(n.x,n.y,Mt,0),c.emplaceBack(a.x,a.y,0,Mt),c.emplaceBack(s.x,s.y,Mt,Mt),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=e.createVertexBuffer(c,Ng.members),this.boundsSegments=Mn.simpleSegment(0,0,4,2)}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const i=this.map.painter.context,r=i.gl;!this._dirty||this.texture instanceof Qm||(this.texture?this.texture.update(this.image):(this.texture=new Bs(i,this.image,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(i)}loadTile(e,i){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},i(null)):(e.state="errored",i(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class dE extends Gl{constructor(e){super(e,{}),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}const pE=new as({visibility:new ri(xt.layout_sky.visibility)});var mE={paint:new as({"sky-type":new ri(xt.paint_sky["sky-type"]),"sky-atmosphere-sun":new ri(xt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new ri(xt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new ri(xt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new ri(xt.paint_sky["sky-gradient-radius"]),"sky-gradient":new hu(xt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new ri(xt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new ri(xt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new ri(xt.paint_sky["sky-opacity"])}),layout:pE};function Kg(t,e,i){const r=[0,0,1],n=at.identity([]);return at.rotateY(n,n,i?-wi(t)+Math.PI:wi(t)),at.rotateX(n,n,-wi(e)),me.transformQuat(r,r,n),me.normalize(r,r)}var _E={paint:new as({})};const gE={circle:class extends Gl{constructor(t,e){super(t,i2,e)}createBucket(t){return new hg(t)}queryRadius(t){const e=t;return ed("circle-radius",this,e)+ed("circle-stroke-width",this,e)+pm(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,i,r,n,s,a,c){const p=s1(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),s.angle,t.pixelToTileUnitsFactor),_=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return a1(t,r,s,a,c,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",p,_)}getProgramIds(){return["circle"]}getDefaultProgramParams(t,e){const i=o1(this);return{config:new mu(this,e),defines:i,overrideFog:!1}}},heatmap:class extends Gl{createBucket(t){return new A1(t)}constructor(t,e){super(t,A2,e),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=mm({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return ed("heatmap-radius",this,t)}queryIntersectsFeature(t,e,i,r,n,s,a,c){const p=this.paint.get("heatmap-radius").evaluate(e,i);return a1(t,r,s,a,c,!0,!0,new ct(0,0),p)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(t,e){return t==="heatmap"?{config:new mu(this,e),overrideFog:!1}:{}}},hillshade:class extends Gl{constructor(t,e){super(t,u2,e)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(t,e){return{overrideFog:!1}}},fill:class extends Gl{constructor(t,e){super(t,E2,e)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(t,e){return{config:new mu(this,e),overrideFog:!1}}recalculate(t,e){super.recalculate(t,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new bm(t)}queryRadius(){return pm(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,i,r,n,s){return!t.queryGeometry.isAboveHorizon&&e1(n1(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),s.angle,t.pixelToTileUnitsFactor),r)}isTileClipped(){return!0}},"fill-extrusion":class extends Gl{constructor(t,e){super(t,oE,e),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new Y0(t)}queryRadius(){return pm(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(t,e,i,r,n,s,a,c,p){const _=s1(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),s.angle,t.pixelToTileUnitsFactor),v=this.paint.get("fill-extrusion-height").evaluate(e,i),E=this.paint.get("fill-extrusion-base").evaluate(e,i),C=[0,0],B=c&&s.elevation,O=s.elevation?s.elevation.exaggeration():1,G=t.tile.getBucket(this);if(B&&G instanceof Y0){const ne=G.centroidVertexArray,ie=p+1;ie<ne.length&&(C[0]=ne.geta_centroid_pos0(ie),C[1]=ne.geta_centroid_pos1(ie))}if(C[0]===0&&C[1]===1)return!1;s.projection.name==="globe"&&(r=av([r],[new ct(0,0),new ct(Mt,Mt)],t.tileID.canonical).map(ne=>ne.polygon).flat());const q=B?c:null,[X,$]=function(ne,ie,se,he,ve,be,De,Ve,je,Je,Fe){return ne.projection.name==="globe"?function(nt,At,vt,rt,lt,wt,It,St,Bt,Ft,jt){const Dt=[],Yt=[],fi=nt.projection.upVectorScale(jt,nt.center.lat,nt.worldSize).metersToTile,di=[0,0,0,1],vi=[0,0,0,1],bi=(Ni,rn,Vr,cr)=>{Ni[0]=rn,Ni[1]=Vr,Ni[2]=cr,Ni[3]=1},Ar=ov();vt>0&&(vt+=Ar),rt+=Ar;for(const Ni of At){const rn=[],Vr=[];for(const cr of Ni){const rr=cr.x+lt.x,Hi=cr.y+lt.y,Zr=nt.projection.projectTilePoint(rr,Hi,jt),Kr=nt.projection.upVector(jt,cr.x,cr.y);let zr=vt,Gn=rt;if(It){const ao=Av(rr,Hi,vt,rt,It,St,Bt,Ft);zr+=ao.base,Gn+=ao.top}vt!==0?bi(di,Zr.x+Kr[0]*fi*zr,Zr.y+Kr[1]*fi*zr,Zr.z+Kr[2]*fi*zr):bi(di,Zr.x,Zr.y,Zr.z),bi(vi,Zr.x+Kr[0]*fi*Gn,Zr.y+Kr[1]*fi*Gn,Zr.z+Kr[2]*fi*Gn),me.transformMat4(di,di,wt),me.transformMat4(vi,vi,wt),rn.push(new dd(di[0],di[1],di[2])),Vr.push(new dd(vi[0],vi[1],vi[2]))}Dt.push(rn),Yt.push(Vr)}return[Dt,Yt]}(ne,ie,se,he,ve,be,De,Ve,je,Je,Fe):De?function(nt,At,vt,rt,lt,wt,It,St,Bt){const Ft=[],jt=[],Dt=[0,0,0,1];for(const Yt of nt){const fi=[],di=[];for(const vi of Yt){const bi=vi.x+rt.x,Ar=vi.y+rt.y,Ni=Av(bi,Ar,At,vt,wt,It,St,Bt);Dt[0]=bi,Dt[1]=Ar,Dt[2]=Ni.base,Dt[3]=1,V.transformMat4(Dt,Dt,lt),Dt[3]=Math.max(Dt[3],1e-5);const rn=new dd(Dt[0]/Dt[3],Dt[1]/Dt[3],Dt[2]/Dt[3]);Dt[0]=bi,Dt[1]=Ar,Dt[2]=Ni.top,Dt[3]=1,V.transformMat4(Dt,Dt,lt),Dt[3]=Math.max(Dt[3],1e-5);const Vr=new dd(Dt[0]/Dt[3],Dt[1]/Dt[3],Dt[2]/Dt[3]);fi.push(rn),di.push(Vr)}Ft.push(fi),jt.push(di)}return[Ft,jt]}(ie,se,he,ve,be,De,Ve,je,Je):function(nt,At,vt,rt,lt){const wt=[],It=[],St=lt[8]*At,Bt=lt[9]*At,Ft=lt[10]*At,jt=lt[11]*At,Dt=lt[8]*vt,Yt=lt[9]*vt,fi=lt[10]*vt,di=lt[11]*vt;for(const vi of nt){const bi=[],Ar=[];for(const Ni of vi){const rn=Ni.x+rt.x,Vr=Ni.y+rt.y,cr=lt[0]*rn+lt[4]*Vr+lt[12],rr=lt[1]*rn+lt[5]*Vr+lt[13],Hi=lt[2]*rn+lt[6]*Vr+lt[14],Zr=lt[3]*rn+lt[7]*Vr+lt[15],Kr=cr+St,zr=rr+Bt,Gn=Hi+Ft,ao=Math.max(Zr+jt,1e-5),On=cr+Dt,ds=rr+Yt,go=Hi+fi,lo=Math.max(Zr+di,1e-5);bi.push(new dd(Kr/ao,zr/ao,Gn/ao)),Ar.push(new dd(On/lo,ds/lo,go/lo))}wt.push(bi),It.push(Ar)}return[wt,It]}(ie,se,he,ve,be)}(s,r,E,v,_,a,q,C,O,s.center.lat,t.tileID.canonical),re=t.queryGeometry;return function(ne,ie,se){let he=1/0;e1(se,ie)&&(he=lv(se,ie[0]));for(let ve=0;ve<ie.length;ve++){const be=ie[ve],De=ne[ve];for(let Ve=0;Ve<be.length-1;Ve++){const je=be[Ve],Je=[je,be[Ve+1],De[Ve+1],De[Ve],je];$y(se,Je)&&(he=Math.min(he,lv(se,Je)))}}return he!==1/0&&he}(X,$,re.isPointQuery()?re.screenBounds:re.screenGeometry)}},line:class extends Gl{constructor(t,e){super(t,cv,e),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof ZA,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=pv.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new qm(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(t,e){const i=fv(this);return{config:new mu(this,e),defines:i,overrideFog:!1}}queryRadius(t){const e=t,i=mv(ed("line-width",this,e),ed("line-gap-width",this,e)),r=ed("line-offset",this,e);return i/2+Math.abs(r)+pm(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,i,r,n,s){if(t.queryGeometry.isAboveHorizon)return!1;const a=n1(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),s.angle,t.pixelToTileUnitsFactor),c=t.pixelToTileUnitsFactor/2*mv(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),p=this.paint.get("line-offset").evaluate(e,i);return p&&(r=function(_,v){const E=[],C=new ct(0,0);for(let B=0;B<_.length;B++){const O=_[B],G=[];for(let q=0;q<O.length;q++){const X=O[q],$=O[q+1],re=q===0?C:X.sub(O[q-1])._unit()._perp(),ne=q===O.length-1?C:$.sub(X)._unit()._perp(),ie=re._add(ne)._unit();ie._mult(1/(ie.x*ne.x+ie.y*ne.y)),G.push(ie._mult(v)._add(X))}E.push(G)}return E}(r,p*t.pixelToTileUnitsFactor)),function(_,v,E){for(let C=0;C<v.length;C++){const B=v[C];if(_.length>=3){for(let O=0;O<B.length;O++)if(mh(_,B[O]))return!0}if(Jw(_,B,E))return!0}return!1}(a,r,c)}isTileClipped(){return!0}},symbol:Nm,background:class extends Gl{constructor(t,e){super(t,uE,e)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(t,e){return{overrideFog:!1}}},raster:class extends Gl{constructor(t,e){super(t,fE,e),this._updateColorRamp()}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}isLayerDraped(t){return!(t&&t._source instanceof Tc)||!t._source.onNorthPole&&!t._source.onSouthPole&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(t){t!=="raster-color"&&t!=="raster-color-range"||this._updateColorRamp()}_updateColorRamp(){if(!this.hasColorMap())return;const t=this._transitionablePaint._values["raster-color"].value.expression,[e,i]=this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0});this.colorRamp=mm({expression:t,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:e,end:i}],resolution:256}),this.colorRampTexture=null}},sky:class extends Gl{constructor(t,e){super(t,mE,e),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="sky-gradient"?this._updateColorRamp():t!=="sky-atmosphere-sun"&&t!=="sky-atmosphere-halo-color"&&t!=="sky-atmosphere-color"&&t!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=mm({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if(this.paint.get("sky-type")==="atmosphere"){const r=this.paint.get("sky-atmosphere-sun"),n=!r,s=t.style.light,a=s.properties.get("position");return n&&s.properties.get("anchor")==="viewport"&&Be("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),n?Kg(a.azimuthal,90-a.polar,e):Kg(r[0],90-r[1],e)}const i=this.paint.get("sky-gradient-center");return Kg(i[0],90-i[1],e)}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return t==="atmosphere"?["skyboxCapture","skybox"]:t==="gradient"?["skyboxGradient"]:null}},slot:class extends Gl{constructor(t,e){super(t,_E)}},model:class extends Gl{constructor(t,e){super(t,qT,e)}createBucket(t){return new Nx(t)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(){return 0}queryIntersectsFeature(){return!1}_handleOverridablePaintPropertyUpdate(t,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven()||t!=="model-color"&&t!=="model-color-mix-intensity"&&t!=="model-rotation"&&t!=="model-scale"&&t!=="model-translation"&&t!=="model-emissive-strength")}_isPropertyZoomDependent(t){const e=this._transitionablePaint._values[t];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof Bn}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}}};function r_(t,e){return t.type==="custom"?new dE(t):new gE[t.type](t,e)}function yE(t){const{userImage:e}=t;return!!(e&&e.render&&e.render())&&(t.data.replace(new Uint8Array(e.data.buffer)),!0)}class xE extends ss{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(e){this.images[e]={},this.loaded[e]=!1,this.updatedImages[e]={},this.patterns[e]={},this.callbackDispatchedThisFrame[e]={},this.atlasImage[e]=new Do({width:1,height:1})}isLoaded(){for(const e in this.loaded)if(!this.loaded[e])return!1;return!0}setLoaded(e,i){if(this.loaded[i]!==e&&(this.loaded[i]=e,e)){for(const{ids:r,callback:n}of this.requestors)this._notify(r,i,n);this.requestors=[]}}hasImage(e,i){return!!this.getImage(e,i)}getImage(e,i){return this.images[i][e]}addImage(e,i,r){this._validate(e,r)&&(this.images[i][e]=r)}_validate(e,i){let r=!0;return this._validateStretch(i.stretchX,i.data&&i.data.width)||(this.fire(new $i(new Error(`Image "${e}" has invalid "stretchX" value`))),r=!1),this._validateStretch(i.stretchY,i.data&&i.data.height)||(this.fire(new $i(new Error(`Image "${e}" has invalid "stretchY" value`))),r=!1),this._validateContent(i.content,i)||(this.fire(new $i(new Error(`Image "${e}" has invalid "content" value`))),r=!1),r}_validateStretch(e,i){if(!e)return!0;let r=0;for(const n of e){if(n[0]<r||n[1]<n[0]||i<n[1])return!1;r=n[1]}return!0}_validateContent(e,i){return!(e&&(e.length!==4||e[0]<0||i.data.width<e[0]||e[1]<0||i.data.height<e[1]||e[2]<0||i.data.width<e[2]||e[3]<0||i.data.height<e[3]||e[2]<e[0]||e[3]<e[1]))}updateImage(e,i,r){r.version=this.images[i][e].version+1,this.images[i][e]=r,this.updatedImages[i][e]=!0}removeImage(e,i){const r=this.images[i][e];delete this.images[i][e],delete this.patterns[i][e],r.userImage&&r.userImage.onRemove&&r.userImage.onRemove()}listImages(e){return Object.keys(this.images[e])}getImages(e,i,r){let n=!0;const s=!!this.loaded[i];if(!s)for(const a of e)this.images[i][a]||(n=!1);s||n?this._notify(e,i,r):this.requestors.push({ids:e,scope:i,callback:r})}getUpdatedImages(e){return this.updatedImages[e]}_notify(e,i,r){const n={};for(const s of e){this.images[i][s]||this.fire(new Jt("styleimagemissing",{id:s}));const a=this.images[i][s];a?n[s]={data:a.data.clone(),pixelRatio:a.pixelRatio,sdf:a.sdf,version:a.version,stretchX:a.stretchX,stretchY:a.stretchY,content:a.content,hasRenderCallback:!!(a.userImage&&a.userImage.render)}:Be(`Image "${s}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}r(null,n)}getPixelSize(e){const{width:i,height:r}=this.atlasImage[e];return{width:i,height:r}}getPattern(e,i){const r=this.patterns[i][e],n=this.getImage(e,i);if(!n)return null;if(r&&r.position.version===n.version)return r.position;if(r)r.position.version=n.version;else{const s={w:n.data.width+2,h:n.data.height+2,x:0,y:0},a=new Dg(s,n);this.patterns[i][e]={bin:s,position:a}}return this._updatePatternAtlas(i),this.patterns[i][e].position}bind(e,i){const r=e.gl;let n=this.atlasTexture[i];n?this.dirty&&(n.update(this.atlasImage[i]),this.dirty=!1):(n=new Bs(e,this.atlasImage[i],r.RGBA),this.atlasTexture[i]=n),n.bind(r.LINEAR,r.CLAMP_TO_EDGE)}_updatePatternAtlas(e){const i=[];for(const a in this.patterns[e])i.push(this.patterns[e][a].bin);const{w:r,h:n}=kg(i),s=this.atlasImage[e];s.resize({width:r||1,height:n||1});for(const a in this.patterns[e]){const{bin:c}=this.patterns[e][a],p=c.x+1,_=c.y+1,v=this.images[e][a].data,E=v.width,C=v.height;Do.copy(v,s,{x:0,y:0},{x:p,y:_},{width:E,height:C}),Do.copy(v,s,{x:0,y:C-1},{x:p,y:_-1},{width:E,height:1}),Do.copy(v,s,{x:0,y:0},{x:p,y:_+C},{width:E,height:1}),Do.copy(v,s,{x:E-1,y:0},{x:p-1,y:_},{width:1,height:C}),Do.copy(v,s,{x:0,y:0},{x:p+E,y:_},{width:1,height:C})}this.dirty=!0}beginFrame(){for(const e in this.images)this.callbackDispatchedThisFrame[e]={}}dispatchRenderCallbacks(e,i){for(const r of e){if(this.callbackDispatchedThisFrame[i][r])continue;this.callbackDispatchedThisFrame[i][r]=!0;const n=this.images[i][r];yE(n)&&this.updateImage(r,i,n)}}}const vE=new as({anchor:new ri(xt.light.anchor),position:new class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return ii(t.expression.evaluate(e))}interpolate(t,e,i){return{x:Ki(t.x,e.x,i),y:Ki(t.y,e.y,i),z:Ki(t.z,e.z,i),azimuthal:Ki(t.azimuthal,e.azimuthal,i),polar:Ki(t.polar,e.polar,i)}}}(xt.light.position),color:new ri(xt.light.color),intensity:new ri(xt.light.intensity)});class gv extends ss{constructor(e,i="flat"){super(),this._transitionable=new Ru(vE),this.setLight(e,i),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,i,r={}){this._validate(xp,e,r)||(this._transitionable.setTransitionOrValue(e),this.id=i)}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,i,r){return(!r||r.validate!==!1)&&Fc(this,e.call(Au,Pt({value:i,style:{glyphs:!0,sprite:!0},styleSpec:xt})))}}const bE=new as({source:new ri(xt.terrain.source),exaggeration:new ri(xt.terrain.exaggeration)});let wE=class extends ss{constructor(t,e,i,r){super(),this.scope=i,this._transitionable=new Ru(bE,r),this._transitionable.setTransitionOrValue(t,r),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=e}get(){return this._transitionable.serialize()}set(t,e){this._transitionable.setTransitionOrValue(t,e)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}getExaggeration(t){return this._transitioning.possiblyEvaluate(new _s(t)).get("exaggeration")}isZoomDependent(){const t=this._transitionable._values.exaggeration;return t!=null&&t.value!=null&&t.value.expression!=null&&t.value.expression instanceof Bn}};const yv=45,xv=65,of=.05;function n_(t,e,i,r){const n=jr(yv,xv,i),[s,a]=vv(t,r);let c=1-Math.min(1,Math.exp((e-s)/(a-s)*-6));return c*=c*c,c=Math.min(1,1.00747*c),c*n*t.alpha}function vv(t,e){const i=.5/Math.tan(.5*e);return[t.range[0]+i,t.range[1]+i]}function bv(t,e,i,r,n){const s=me.transformMat4([],[e,i,r],n.mercatorFogMatrix);return n_(t,me.length(s),n.pitch,n._fov)}function wv(t,e,i,r,n,s,a){const c=[[i,r,0],[n,r,0],[n,s,0],[i,s,0]];let p=Number.MAX_VALUE,_=-Number.MAX_VALUE;for(const v of c){const E=me.transformMat4([],v,e),C=me.length(E);p=Math.min(p,C),_=Math.max(_,C)}return[n_(t,p,a.pitch,a._fov),n_(t,_,a.pitch,a._fov)]}const TE=new as({range:new ri(xt.fog.range),color:new ri(xt.fog.color),"high-color":new ri(xt.fog["high-color"]),"space-color":new ri(xt.fog["space-color"]),"horizon-blend":new ri(xt.fog["horizon-blend"]),"star-intensity":new ri(xt.fog["star-intensity"]),"vertical-range":new ri(xt.fog["vertical-range"])});class EE extends ss{constructor(e,i){super(),this._transitionable=new Ru(TE),this.set(e),this._transitioning=this._transitionable.untransitioned(),this._transform=i}get state(){const e=this._transform,i=e.projection.name==="globe",r=Ho(e.zoom),n=this.properties.get("range"),s=[.5,3];return{range:i?[Ki(s[0],n[0],r),Ki(s[1],n[1],r)]:n,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(e,i={}){if(this._validate(Ph,e,i))return;const r=Pt({},e);for(const n of Object.keys(xt.fog))r[n]===void 0&&(r[n]=xt.fog[n].default);this._transitionable.setTransitionOrValue(r)}getOpacity(e){if(!this._transform.projection.supportsFog)return 0;const i=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:jr(yv,xv,e))*i.a}getOpacityAtLatLng(e,i){return this._transform.projection.supportsFog?function(r,n,s){const a=Wr.fromLngLat(n),c=s.elevation?s.elevation.getAtPointOrZero(a):0;return bv(r,a.x,a.y,c,s)}(this.state,e,i):0}getOpacityForTile(e){if(!this._transform.projection.supportsFog)return[1,1];const i=this._transform.calculateFogTileMatrix(e.toUnwrapped());return wv(this.state,i,0,0,Mt,Mt,this._transform)}getOpacityForBounds(e,i,r,n,s){return this._transform.projection.supportsFog?wv(this.state,e,i,r,n,s,this._transform):[1,1]}getFovAdjustedRange(e){return this._transform.projection.supportsFog?vv(this.state,e):[0,1]}isVisibleOnFrustum(e){if(!this._transform.projection.supportsFog)return!1;const i=[4,5,6,7];for(const r of i){const n=e.points[r];let s;if(n[2]>=0)s=n;else{const a=e.points[r-4];s=Po(a,n,a[2]/(a[2]-n[2]))}if(bv(this.state,s[0],s[1],0,this._transform)>=of)return!0}return!1}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,i,r){return(!r||r.validate!==!1)&&Fc(this,e.call(Au,Pt({value:i,style:{glyphs:!0,sprite:!0},styleSpec:xt})))}}class ME{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class SE{constructor(){this.tasks={},this.taskQueue=[],Ir(["process"],this),this.invoker=new ME(this.process),this.nextId=0}add(e,i){const r=this.nextId++,n=function({type:s,isSymbolTile:a,zoom:c}){return c=c||0,s==="message"?0:s!=="maybePrepare"||a?s!=="parseTile"||a?s==="parseTile"&&a?300-c:s==="maybePrepare"&&a?400-c:500:200-c:100-c}(i);if(n===0){Ht();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[r]={fn:e,metadata:i,priority:n,id:r},this.taskQueue.push(r),this.invoker.trigger(),{cancel:()=>{delete this.tasks[r]}}}process(){Ht();try{if(this.taskQueue=this.taskQueue.filter(r=>!!this.tasks[r]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let n=0;n<this.taskQueue.length;n++){const s=this.tasks[this.taskQueue[n]];s.priority<i&&(i=s.priority,e=n)}if(e===null)return null;const r=this.taskQueue[e];return this.taskQueue.splice(e,1),r}remove(){this.invoker.remove()}}class Tv{constructor(e,i,r){this.target=e,this.parent=i,this.mapId=r,this.callbacks={},this.cancelCallbacks={},Ir(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new SE}send(e,i,r,n,s=!1,a){const c=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(r.metadata=a,this.callbacks[c]=r);const p=new Set;return this.target.postMessage({id:c,type:e,hasCallback:!!r,targetMapId:n,mustQueue:s,sourceMapId:this.mapId,data:Bu(i,p)},p),{cancel:()=>{r&&delete this.callbacks[c],this.target.postMessage({id:c,type:"<cancel>",targetMapId:n,sourceMapId:this.mapId})}}}receive(e){const i=e.data,r=i.id;if(r&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){const n=this.cancelCallbacks[r];delete this.cancelCallbacks[r],n&&n.cancel()}else if(i.mustQueue||Ht()){const n=this.callbacks[r];this.cancelCallbacks[r]=this.scheduler.add(()=>this.processTask(r,i),n&&n.metadata||{type:"message"})}else this.processTask(r,i)}processTask(e,i){if(i.type==="<response>"){const r=this.callbacks[e];delete this.callbacks[e],r&&(i.error?r(th(i.error)):r(null,th(i.data)))}else{const r=new Set,n=i.hasCallback?(a,c)=>{delete this.cancelCallbacks[e],this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:a?Bu(a):null,data:Bu(c,r)},r)}:a=>{},s=th(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,s,n);else if(this.parent.getWorkerSource){const a=i.type.split(".");this.parent.getWorkerSource(i.sourceMapId,a[0],s.source,s.scope)[a[1]](s,n)}else n(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}class af{constructor(e,i){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=cs();const r=this.workerPool.acquire(this.id);for(let n=0;n<r.length;n++){const s=new af.Actor(r[n],i,this.id);s.name=`Worker ${n}`,this.actors.push(s)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,i,r){Js(this.actors,(n,s)=>{n.send(e,i,s)},r=r||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}af.Actor=Tv;class Ev extends ss{constructor(e,i,r,n){super(),this.scope=r,this._options=e,this.properties=new uu(i),this._transitionable=new Ru(i,new Map(n)),this._transitionable.setTransitionOrValue(e.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(e){this._transitionable.setTransitionOrValue(this._options.properties,new Map(e))}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(e,i){this._options=e,this._transitionable.setTransitionOrValue(e.properties,i)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}const IE=new as({color:new ri(xt.properties_light_ambient.color),intensity:new ri(xt.properties_light_ambient.intensity)}),CE=new as({direction:new class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return function([i,r]){const n=ii([1,i,r]);return{x:n.x,y:n.y,z:n.z}}(t.expression.evaluate(e))}interpolate(t,e,i){return{x:Ki(t.x,e.x,i),y:Ki(t.y,e.y,i),z:Ki(t.z,e.z,i)}}}(xt.properties_light_directional.direction),color:new ri(xt.properties_light_directional.color),intensity:new ri(xt.properties_light_directional.intensity),"cast-shadows":new ri(xt.properties_light_directional["cast-shadows"]),"shadow-intensity":new ri(xt.properties_light_directional["shadow-intensity"])});class Jg{constructor(e,i,r,n){this.screenBounds=e,this.cameraPoint=i,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=r,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,n)}static createFromScreenPoints(e,i){let r,n;if(e instanceof ct||typeof e[0]=="number"){const s=ct.convert(e);r=[s],n=i.isPointAboveHorizon(s)}else{const s=ct.convert(e[0]),a=ct.convert(e[1]);r=[s,a],n=Ao(s,a).every(c=>i.isPointAboveHorizon(c))}return new Jg(r,i.getCameraPoint(),n,i)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(e){return Ao(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],e)}bufferedCameraGeometry(e){const i=this.screenBounds[0],r=this.screenBounds.length===1?this.screenBounds[0].add(new ct(1,1)):this.screenBounds[1],n=Ao(i,r,0,!1);return this.cameraPoint.y>r.y&&(this.cameraPoint.x>i.x&&this.cameraPoint.x<r.x?n.splice(3,0,this.cameraPoint):this.cameraPoint.x>=r.x?n[2]=this.cameraPoint:this.cameraPoint.x<=i.x&&(n[3]=this.cameraPoint)),function(s,a){const c=[];for(let p=0;p<s.length;p++){const _=Pn(p-1,-1,s.length-1),v=Pn(p+1,-1,s.length-1),E=s[p],C=s[v],B=s[_].sub(E).unit(),O=C.sub(E).unit(),G=O.angleWithSep(B.x,B.y),q=B.add(O).unit().mult(-1*a/Math.sin(G/2));c.push(E.add(q))}return c}(n,e)}bufferedCameraGeometryGlobe(e){const i=this.screenBounds[0],r=this.screenBounds.length===1?this.screenBounds[0].add(new ct(1,1)):this.screenBounds[1],n=Ao(i,r,e),s=this.cameraPoint.clone();switch(3*((s.y>i.y)+(s.y>r.y))+((s.x>i.x)+(s.x>r.x))){case 0:n[0]=s,n[4]=s.clone();break;case 1:n.splice(1,0,s);break;case 2:n[1]=s;break;case 3:n.splice(4,0,s);break;case 5:n.splice(2,0,s);break;case 6:n[3]=s;break;case 7:n.splice(3,0,s);break;case 8:n[2]=s}return n}containsTile(e,i,r,n=0){const s=e.queryPadding/i._pixelsPerMercatorPixel+1,a=r?this._bufferedCameraMercator(s,i):this._bufferedScreenMercator(s,i);let c=e.tileID.wrap+(a.unwrapped?n:0);const p=a.polygon.map(q=>sx(e.tileTransform,q,c));if(!r1(p,0,0,Mt,Mt))return;c=e.tileID.wrap+(this.screenGeometryMercator.unwrapped?n:0);const _=this.screenGeometryMercator.polygon.map(q=>ox(e.tileTransform,q,c)),v=_.map(q=>new ct(q[0],q[1])),E=i.getFreeCameraOptions().position||new Wr(0,0,0),C=ox(e.tileTransform,E,c),B=_.map(q=>{const X=me.sub(q,q,C);return me.normalize(X,X),new ys(C,X)}),O=rf(e,1,i.zoom)*i._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:v,tilespaceRays:B,bufferedTilespaceGeometry:p,bufferedTilespaceBounds:(G=Rs(p),G.min.x=Ai(G.min.x,0,Mt),G.min.y=Ai(G.min.y,0,Mt),G.max.x=Ai(G.max.x,0,Mt),G.max.y=Ai(G.max.y,0,Mt),G),tile:e,tileID:e.tileID,pixelToTileUnitsFactor:O};var G}_bufferedScreenMercator(e,i){const r=Mv(e);if(this._screenRaycastCache[r])return this._screenRaycastCache[r];{let n;return n=i.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(e),i):{polygon:this.bufferedScreenGeometry(e).map(s=>i.pointCoordinate3D(s)),unwrapped:!0},this._screenRaycastCache[r]=n,n}}_bufferedCameraMercator(e,i){const r=Mv(e);if(this._cameraRaycastCache[r])return this._cameraRaycastCache[r];{let n;return n=i.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(e),i):{polygon:this.bufferedCameraGeometry(e).map(s=>i.pointCoordinate3D(s)),unwrapped:!0},this._cameraRaycastCache[r]=n,n}}_projectAndResample(e,i){const r=function(s,a){const c=ce.multiply([],a.pixelMatrix,a.globeMatrix),p=[0,-Vn,0,1],_=[0,Vn,0,1],v=[0,0,0,1];V.transformMat4(p,p,c),V.transformMat4(_,_,c),V.transformMat4(v,v,c);const E=new ct(p[0]/p[3],p[1]/p[3]),C=new ct(_[0]/_[3],_[1]/_[3]),B=mh(s,E)&&p[3]<v[3],O=mh(s,C)&&_[3]<v[3];if(!B&&!O)return null;const G=function(he,ve,be){for(let De=1;De<he.length;De++){const Ve=J0(ve.pointCoordinate3D(he[De-1]).x),je=J0(ve.pointCoordinate3D(he[De]).x);if(be<0){if(Ve<je)return{idx:De,t:-Ve/(je-1-Ve)}}else if(je<Ve)return{idx:De,t:(1-Ve)/(je+1-Ve)}}return null}(s,a,B?-1:1);if(!G)return null;const{idx:q,t:X}=G;let $=q>1?$g(s.slice(0,q),a):[],re=q<s.length?$g(s.slice(q),a):[];$=$.map(he=>new ct(J0(he.x),he.y)),re=re.map(he=>new ct(J0(he.x),he.y));const ne=[...$];ne.length===0&&ne.push(re[re.length-1]);const ie=Ki(ne[ne.length-1].y,(re.length===0?$[0]:re[0]).y,X);let se;return se=B?[new ct(0,ie),new ct(0,0),new ct(1,0),new ct(1,ie)]:[new ct(1,ie),new ct(1,1),new ct(0,1),new ct(0,ie)],ne.push(...se),re.length===0?ne.push($[0]):ne.push(...re),{polygon:ne.map(he=>new Wr(he.x,he.y)),unwrapped:!1}}(e,i);if(r)return r;const n=function(s,a){let c=!1,p=-1/0,_=0;for(let E=0;E<s.length-1;E++)s[E].x>p&&(p=s[E].x,_=E);for(let E=0;E<s.length-1;E++){const C=(_+E)%(s.length-1),B=s[C],O=s[C+1];Math.abs(B.x-O.x)>.5&&(B.x<O.x?(B.x+=1,C===0&&(s[s.length-1].x+=1)):(O.x+=1,C+1===s.length-1&&(s[0].x+=1)),c=!0)}const v=Wo(a.center.lng);return c&&v<Math.abs(v-1)&&s.forEach(E=>{E.x-=1}),{polygon:s,unwrapped:c}}($g(e,i).map(s=>new ct(J0(s.x),s.y)),i);return{polygon:n.polygon.map(s=>new Wr(s.x,s.y)),unwrapped:n.unwrapped}}}function $g(t,e){return Ky(t,i=>{const r=e.pointCoordinate3D(i);i.x=r.x,i.y=r.y},1/256)}function J0(t){return t<0?1+t%1:t%1}function Mv(t){return 100*t|0}function ey(t,e,i,r,n){const s=function(a,c){if(a)return n(a);if(c){t.url&&c.tiles&&t.tiles&&delete t.tiles;const p=nr(Pt(c,t),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);c.vector_layers&&(p.vectorLayers=c.vector_layers,p.vectorLayerIds=p.vectorLayers.map(_=>_.id)),p.tiles=e.canonicalizeTileset(p,t.url),n(null,p)}};return t.url?Le(e.transformRequest(e.normalizeSourceURL(t.url,null,i,r),we.Source),s):Wi.frame(()=>s(null,t))}class s_{constructor(e,i,r){this.bounds=kl.convert(this.validateBounds(e)),this.minzoom=i||0,this.maxzoom=r||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const i=Math.pow(2,e.z),r=Math.floor(Wo(this.bounds.getWest())*i),n=Math.floor(oa(this.bounds.getNorth())*i),s=Math.ceil(Wo(this.bounds.getEast())*i),a=Math.ceil(oa(this.bounds.getSouth())*i);return e.x>=r&&e.x<s&&e.y>=n&&e.y<a}}class Sv{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new ju({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const r=this.getKey(e,i);return this.positions[r]}trim(){const e=this.width,i=this.height=Yo(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,r){const n=[];let s=e.length%2==1?-e[e.length-1]*r:0,a=e[0]*r,c=!0;n.push({left:s,right:a,isDash:c,zeroLength:e[0]===0});let p=e[0];for(let _=1;_<e.length;_++){c=!c;const v=e[_];s=p*r,p+=v,a=p*r,n.push({left:s,right:a,isDash:c,zeroLength:v===0})}return n}addRoundDash(e,i,r){const n=i/2;for(let s=-r;s<=r;s++){const a=this.width*(this.nextRow+r+s);let c=0,p=e[c];for(let _=0;_<this.width;_++){_/p.right>1&&(p=e[++c]);const v=Math.abs(_-p.left),E=Math.abs(_-p.right),C=Math.min(v,E);let B;const O=s/r*(n+1);if(p.isDash){const G=n-Math.abs(O);B=Math.sqrt(C*C+G*G)}else B=n-Math.sqrt(C*C+O*O);this.image.data[a+_]=Math.max(0,Math.min(255,B+128))}}}addRegularDash(e,i){for(let p=e.length-1;p>=0;--p){const _=e[p],v=e[p+1];_.zeroLength?e.splice(p,1):v&&v.isDash===_.isDash&&(v.left=_.left,e.splice(p,1))}const r=e[0],n=e[e.length-1];r.isDash===n.isDash&&(r.left=n.left-this.width,n.right=r.right+this.width);const s=this.width*this.nextRow;let a=0,c=e[a];for(let p=0;p<this.width;p++){p/c.right>1&&(c=e[++a]);const _=Math.abs(p-c.left),v=Math.abs(p-c.right),E=Math.min(_,v);this.image.data[s+p]=Math.max(0,Math.min(255,(c.isDash?E:-E)+i+128))}}addDash(e,i){const r=this.getKey(e,i);if(this.positions[r])return this.positions[r];const n=i==="round",s=n?7:0,a=2*s+1;if(this.nextRow+a>this.height)return Be("LineAtlas out of space"),null;e.length===0&&e.push(1);let c=0;for(let v=0;v<e.length;v++)e[v]<0&&(Be("Negative value is found in line dasharray, replacing values with 0"),e[v]=0),c+=e[v];if(c!==0){const v=this.width/c,E=this.getDashRanges(e,this.width,v);n?this.addRoundDash(E,v,s):this.addRegularDash(E,i==="square"?.5*v:0)}const p=this.nextRow+s;this.nextRow+=a;const _={tl:[p,s],br:[c,0]};return this.positions[r]=_,_}}Mi(Sv,"LineAtlas");const Iv=1*tu;class Cv{constructor(e){const i={},r=[];for(const c in e){const p=e[c],_=i[c]={};for(const v in p.glyphs){const E=p.glyphs[+v];if(!E||E.bitmap.width===0||E.bitmap.height===0)continue;const C=E.metrics.localGlyph?Iv:1,B={x:0,y:0,w:E.bitmap.width+2*C,h:E.bitmap.height+2*C};r.push(B),_[v]=B}}const{w:n,h:s}=kg(r),a=new ju({width:n||1,height:s||1});for(const c in e){const p=e[c];for(const _ in p.glyphs){const v=p.glyphs[+_];if(!v||v.bitmap.width===0||v.bitmap.height===0)continue;const E=i[c][_],C=v.metrics.localGlyph?Iv:1;ju.copy(v.bitmap,a,{x:0,y:0},{x:E.x+C,y:E.y+C},v.bitmap)}}this.image=a,this.positions=i}}Mi(Cv,"GlyphAtlas");class kE{constructor(e){this.tileID=new ui(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.scope=e.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.promoteId=e.promoteId,this.isSymbolTile=e.isSymbolTile,this.tileTransform=tf(e.tileID.canonical,e.projection),this.projection=e.projection,this.brightness=e.brightness,this.extraShadowCaster=!!e.extraShadowCaster}parse(e,i,r,n,s){this.status="parsing",this.data=e,this.collisionBoxArray=new Nu;const a=new x1(Object.keys(e.layers).sort()),c=new Mg(this.tileID,this.promoteId);c.bucketLayerIDs=[];const p={},_=new Sv(256,256),v={featureIndex:c,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:_,availableImages:r,brightness:this.brightness},E=i.familiesBySource[this.source];for(const $ in E){const re=e.layers[$];if(!re)continue;let ne=!1,ie=!1,se=!1;for(const be of E[$])be[0].type==="symbol"?ne=!0:ie=!0,be[0].is3D()&&be[0].type!=="model"&&(se=!0);if(this.extraShadowCaster&&!se||this.isSymbolTile===!0&&!ne||this.isSymbolTile===!1&&!ie)continue;re.version===1&&Be(`Vector tile source "${this.source}" layer "${$}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const he=a.encode($),ve=[];for(let be=0;be<re.length;be++){const De=re.feature(be),Ve=c.getId(De,$);ve.push({feature:De,id:Ve,index:be,sourceLayerIndex:he})}for(const be of E[$]){const De=be[0];(!this.extraShadowCaster||De.is3D()&&De.type!=="model")&&(this.isSymbolTile!==void 0&&De.type==="symbol"!==this.isSymbolTile||De.minzoom&&this.zoom<Math.floor(De.minzoom)||De.maxzoom&&this.zoom>=De.maxzoom||De.visibility!=="none"&&(ty(be,this.zoom,v.brightness,r),(p[De.id]=De.createBucket({index:c.bucketLayerIDs.length,layers:be,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:he,sourceID:this.source,projection:this.projection.spec})).populate(ve,v,this.tileID.canonical,this.tileTransform),c.bucketLayerIDs.push(be.map(Ve=>Ve.id))))}}let C,B,O,G;_.trim();const q={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},X=()=>{if(C)return this.status="done",s(C);if(this.extraShadowCaster)this.status="done",s(null,{buckets:Zn(p).filter($=>!$.isEmpty()),featureIndex:c,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:v.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(B&&O&&G){const $=new Cv(B),re=new Y1(O,G);for(const ne in p){const ie=p[ne];ie instanceof j0?(ty(ie.layers,this.zoom,v.brightness,r),M3(ie,B,$.positions,O,re.iconPositions,this.showCollisionBoxes,r,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):ie.hasPattern&&(ie instanceof qm||ie instanceof bm||ie instanceof Y0)&&(ty(ie.layers,this.zoom,v.brightness,r),ie.addFeatures(v,this.tileID.canonical,re.patternPositions,r,this.tileTransform,this.brightness))}this.status="done",s(null,{buckets:Zn(p).filter(ne=>!ne.isEmpty()),featureIndex:c,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:$.image,lineAtlas:_,imageAtlas:re,brightness:v.brightness})}};if(!this.extraShadowCaster){const $=Cs(v.glyphDependencies,ie=>Object.keys(ie).map(Number));Object.keys($).length?n.send("getGlyphs",{uid:this.uid,stacks:$,scope:this.scope},(ie,se)=>{C||(C=ie,B=se,X())},void 0,!1,q):B={};const re=Object.keys(v.iconDependencies);re.length?n.send("getImages",{icons:re,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(ie,se)=>{C||(C=ie,O=se,X())},void 0,!1,q):O={};const ne=Object.keys(v.patternDependencies);ne.length?n.send("getImages",{icons:ne,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(ie,se)=>{C||(C=ie,G=se,X())},void 0,!1,q):G={}}X()}}function ty(t,e,i,r){const n=new _s(e,{brightness:i});for(const s of t)s.recalculate(n,r)}class kv{constructor(e){this.entries={},this.scheduler=e}request(e,i,r,n){const s=this.entries[e]=this.entries[e]||{callbacks:[]};if(s.result){const[a,c]=s.result;return this.scheduler?this.scheduler.add(()=>{n(a,c)},i):n(a,c),()=>{}}return s.callbacks.push(n),s.cancel||(s.cancel=r((a,c)=>{s.result=[a,c];for(const p of s.callbacks)this.scheduler?this.scheduler.add(()=>{p(a,c)},i):p(a,c);setTimeout(()=>delete this.entries[e],3e3)})),()=>{s.result||(s.callbacks=s.callbacks.filter(a=>a!==n),s.callbacks.length||(s.cancel(),delete this.entries[e]))}}}function Dv(t,e,i){const r=JSON.stringify(t.request);return t.data&&(this.deduped.entries[r]={result:[null,t.data]}),this.deduped.request(r,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},n=>{const s=Ne(t.request,(a,c,p,_)=>{a?n(a):c&&n(null,{vectorTile:i?void 0:new Tg(new Im(c)),rawData:c,cacheControl:p,expires:_})});return()=>{s.cancel(),n()}},e)}class Pv extends ss{constructor(e,i,r,n){if(super(),this.id=e,this.dispatcher=r,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Pt(this,nr(i,["url","scheme","tileSize","promoteId"])),this._options=Pt({type:"vector"},i),this._collectResourceTiming=!!i.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(n),this._tileWorkers={},this._deduped=new kv}load(e){this._loaded=!1,this.fire(new Jt("dataloading",{dataType:"source"}));const i=Array.isArray(this.map._language)?this.map._language.join():this.map._language,r=this.map._worldview;this._tileJSONRequest=ey(this._options,this.map._requestManager,i,r,(n,s)=>{this._tileJSONRequest=null,this._loaded=!0,n?(i&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${i}`),r&&r.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${r}`),this.fire(new $i(n))):s&&(Pt(this,s),s.bounds&&(this.tileBounds=new s_(s.bounds,this.minzoom,this.maxzoom)),hn(s.tiles,this.map._requestManager._customAccessToken),this.fire(new Jt("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new Jt("data",{dataType:"source",sourceDataType:"content"}))),e&&e(n)})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}reload(){this.cancelTileJSONRequest();const e=Zo(this.id,this.scope);this.load(()=>this.map.style.clearSource(e))}setTiles(e){return this._options.tiles=e,this.reload(),this}setUrl(e){return this.url=e,this._options.url=e,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return Pt({},this._options)}loadTile(e,i){const r=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme)),n={request:this.map._requestManager.transformRequest(r,we.Tile),data:void 0,uid:e.uid,tileID:e.tileID,tileZoom:e.tileZoom,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:Wi.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:e.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:e.isExtraShadowCaster};if(n.request.collectResourceTiming=this._collectResourceTiming,e.actor&&e.state!=="expired")e.state==="loading"?e.reloadCallback=i:e.request=e.actor.send("reloadTile",n,s.bind(this));else if(e.actor=this._tileWorkers[r]=this._tileWorkers[r]||this.dispatcher.getActor(),this.dispatcher.ready)e.request=e.actor.send("loadTile",n,s.bind(this),void 0,!0);else{const a=Dv.call({deduped:this._deduped},n,(c,p)=>{c||!p?s.call(this,c):(n.data={cacheControl:p.cacheControl,expires:p.expires,rawData:p.rawData.slice(0)},e.actor&&e.actor.send("loadTile",n,s.bind(this),void 0,!0))},!0);e.request={cancel:a}}function s(a,c){return delete e.request,e.aborted?i(null):a&&a.status!==404?i(a):(c&&c.resourceTiming&&(e.resourceTiming=c.resourceTiming),this.map._refreshExpiredTiles&&c&&e.setExpiryData(c),e.loadVectorData(c,this.map.painter),kt(this.dispatcher),i(null),void(e.reloadCallback&&(this.loadTile(e,e.reloadCallback),e.reloadCallback=null)))}}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.actor&&e.actor.send("abortTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(e){e.actor&&e.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope}),e.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class iy extends ss{constructor(e,i,r,n){super(),this.id=e,this.dispatcher=r,this.setEventedParent(n),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Pt({type:"raster"},i),Pt(this,nr(i,["url","scheme","tileSize"]))}load(e){this._loaded=!1,this.fire(new Jt("dataloading",{dataType:"source"})),this._tileJSONRequest=ey(this._options,this.map._requestManager,null,null,(i,r)=>{this._tileJSONRequest=null,this._loaded=!0,i?this.fire(new $i(i)):r&&(Pt(this,r),r.bounds&&(this.tileBounds=new s_(r.bounds,this.minzoom,this.maxzoom)),hn(r.tiles),this.fire(new Jt("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new Jt("data",{dataType:"source",sourceDataType:"content"}))),e&&e(i)})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}reload(){this.cancelTileJSONRequest();const e=Zo(this.id,this.scope);this.load(()=>this.map.style.clearSource(e))}setTiles(e){return this._options.tiles=e,this.reload(),this}setUrl(e){return this.url=e,this._options.url=e,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return Pt({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e,i){const r=Wi.devicePixelRatio>=2,n=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),r,this.tileSize);e.request=Et(this.map._requestManager.transformRequest(n,we.Tile),(s,a,c,p)=>(delete e.request,e.aborted?(e.state="unloaded",i(null)):s?(e.state="errored",i(s)):a?(this.map._refreshExpiredTiles&&e.setExpiryData({cacheControl:c,expires:p}),e.setTexture(a,this.map.painter),e.state="loaded",kt(this.dispatcher),void i(null)):i(null)))}abortTile(e,i){e.request&&(e.request.cancel(),delete e.request),i()}unloadTile(e,i){e.texture&&e.texture instanceof Bs?(e.destroy(!0),e.texture&&e.texture instanceof Bs&&this.map.painter.saveTileTexture(e.texture)):e.destroy(),i()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function DE(){return I_.workerClass!=null?new I_.workerClass:new Ee.Worker(I_.workerUrl)}const ry="mapboxgl_preloaded_worker_pool";class pd{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<pd.workerCount;)this.workers.push(new DE);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(i=>{i.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[ry]}numActive(){return Object.keys(this.active).length}}let $0;function ep(){return $0||($0=new pd),$0}pd.workerCount=2;let o_,ny,nu,sy=null;function zv(){return Ht()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:ny||Gt.DRACO_URL}const oy=5123,ay=5126,ly={5120:Int8Array,5121:Uint8Array,5122:Int16Array,[oy]:Uint16Array,5125:Uint32Array,[ay]:Float32Array},PE={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",[oy]:"DT_UINT16",5125:"DT_UINT32",[ay]:"DT_FLOAT32"},Ay={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function Bv(t,e,i){const r=i.json.bufferViews.length,n=i.buffers.length;e.bufferView=r,i.json.bufferViews[r]={buffer:n,byteLength:t.byteLength},i.buffers[n]=t}const cy="KHR_draco_mesh_compression";function zE(t,e){const i=t.extensions&&t.extensions[cy];if(!i)return;const r=new nu.Decoder,n=Ov(e,i.bufferView),s=new nu.Mesh;if(!r.DecodeArrayToMesh(n,n.byteLength,s))throw new Error("Failed to decode Draco mesh");const a=e.json.accessors[t.indices],c=ly[a.componentType],p=a.count*c.BYTES_PER_ELEMENT,_=nu._malloc(p);c===Uint16Array?r.GetTrianglesUInt16Array(s,p,_):r.GetTrianglesUInt32Array(s,p,_),Bv(nu.memory.buffer.slice(_,_+p),a,e),nu._free(_);for(const v of Object.keys(i.attributes)){const E=r.GetAttributeByUniqueId(s,i.attributes[v]),C=e.json.accessors[t.attributes[v]],B=PE[C.componentType],O=C.count*Ay[C.type]*ly[C.componentType].BYTES_PER_ELEMENT,G=nu._malloc(O);r.GetAttributeDataArrayForAllPoints(s,E,nu[B],O,G),Bv(nu.memory.buffer.slice(G,G+O),C,e),nu._free(G)}r.destroy(),s.destroy(),delete t.extensions[cy]}const Lv=1179937895,Rv=new TextDecoder("utf8");function Fv(t,e){return new URL(t,e).href}function BE(t,e,i,r){return fetch(Fv(t.uri,r)).then(n=>n.arrayBuffer()).then(n=>{e.buffers[i]=n})}function Ov(t,e){const i=t.json.bufferViews[e];return new Uint8Array(t.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function LE(t,e,i,r){if(t.uri){const n=Fv(t.uri,r);return fetch(n).then(s=>s.blob()).then(s=>Ee.createImageBitmap(s)).then(s=>{e.images[i]=s})}if(t.bufferView!==void 0){const n=Ov(e,t.bufferView),s=new Ee.Blob([n],{type:t.mimeType});return Ee.createImageBitmap(s).then(a=>{e.images[i]=a})}}function Nv(t,e=0,i){const r={json:null,images:[],buffers:[]};if(new Uint32Array(t,e,1)[0]===Lv){const _=new Uint32Array(t,e);let v=2;const E=(_[v++]>>2)-3,C=_[v++]>>2;if(v++,r.json=JSON.parse(Rv.decode(_.subarray(v,v+C))),v+=C,v<E){const B=_[v++];v++;const O=e+(v<<2);r.buffers[0]=t.slice(O,O+B)}}else r.json=JSON.parse(Rv.decode(new Uint8Array(t,e)));const{buffers:n,images:s,meshes:a,extensionsUsed:c}=r.json;let p=Promise.resolve();if(n){const _=[];for(let v=0;v<n.length;v++){const E=n[v];E.uri?_.push(BE(E,r,v,i)):r.buffers[v]||(r.buffers[v]=null)}p=Promise.all(_)}return p.then(()=>{const _=[],v=c&&c.includes(cy);if(v&&_.push(function(){if(!nu)return o_||(o_=function(E){let C,B=null;function O(){C=new Uint8Array(B.buffer)}function G(){throw new Error("Unexpected Draco error.")}const q={a:{a:G,d:function(X,$,re){return C.copyWithin(X,$,$+re)},c:function(X){const $=C.length,re=Math.max(X>>>0,Math.ceil(1.2*$)),ne=Math.ceil((re-$)/65536);try{return B.grow(ne),O(),!0}catch{return!1}},b:G}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(E,q):E.then(X=>X.arrayBuffer()).then(X=>WebAssembly.instantiate(X,q))).then(X=>{const{Rb:$,Qb:re,P:ne,T:ie,X:se,Ja:he,La:ve,Qa:be,Va:De,Wa:Ve,eb:je,jb:Je,f:Fe,e:nt,yb:At,zb:vt,Ab:rt,Bb:lt,Db:wt,Gb:It}=X.instance.exports;B=nt;const St=(()=>{let Bt=0,Ft=0,jt=0,Dt=0;return Yt=>{jt&&($(Dt),$(Bt),Ft+=jt,jt=Bt=0),Bt||(Ft+=128,Bt=re(Ft));const fi=Yt.length+7&-8;let di=Bt;fi>=Ft&&(jt=fi,di=Dt=re(fi));for(let vi=0;vi<Yt.length;vi++)C[di+vi]=Yt[vi];return di}})();return O(),Fe(),{memory:nt,_free:$,_malloc:re,Mesh:class{constructor(){this.ptr=ne()}destroy(){ie(this.ptr)}},Decoder:class{constructor(){this.ptr=he()}destroy(){Je(this.ptr)}DecodeArrayToMesh(Bt,Ft,jt){const Dt=St(Bt),Yt=ve(this.ptr,Dt,Ft,jt.ptr);return!!se(Yt)}GetAttributeByUniqueId(Bt,Ft){return{ptr:be(this.ptr,Bt.ptr,Ft)}}GetTrianglesUInt16Array(Bt,Ft,jt){De(this.ptr,Bt.ptr,Ft,jt)}GetTrianglesUInt32Array(Bt,Ft,jt){Ve(this.ptr,Bt.ptr,Ft,jt)}GetAttributeDataArrayForAllPoints(Bt,Ft,jt,Dt,Yt){je(this.ptr,Bt.ptr,Ft.ptr,jt,Dt,Yt)}},DT_INT8:At(),DT_UINT8:vt(),DT_INT16:rt(),DT_UINT16:lt(),DT_UINT32:wt(),DT_FLOAT32:It()}})}(fetch(zv())),o_.then(E=>{nu=E,o_=void 0}))}()),s)for(let E=0;E<s.length;E++)_.push(LE(s[E],r,E,i));return(_.length?Promise.all(_):Promise.resolve()).then(()=>{if(v&&a)for(const{primitives:E}of a)for(const C of E)zE(C,r);return r})})}function Uv(t){return fetch(t).then(e=>e.arrayBuffer()).then(e=>Nv(e,0,t))}class Vv{constructor(e,i,r){if(this.triangleCount=i.length/3,this.min=new ct(0,0),this.max=new ct(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0||r===0)return;const n=e.map(v=>v.x),s=e.map(v=>v.y);this.min=new ct(Math.min(...n),Math.min(...s)),this.max=new ct(Math.max(...n),Math.max(...s));const a=this.max.sub(this.min);a.x=Math.max(a.x,1),a.y=Math.max(a.y,1);const c=Math.max(a.x,a.y)/r;this.cellsX=Math.max(1,Math.ceil(a.x/c)),this.cellsY=Math.max(1,Math.ceil(a.y/c)),this.xScale=1/c,this.yScale=1/c;const p=[];for(let v=0;v<this.triangleCount;v++){const E=e[i[3*v+0]].sub(this.min),C=e[i[3*v+1]].sub(this.min),B=e[i[3*v+2]].sub(this.min),O=Eh(Math.floor(Math.min(E.x,C.x,B.x)),this.xScale,this.cellsX),G=Eh(Math.floor(Math.max(E.x,C.x,B.x)),this.xScale,this.cellsX),q=Eh(Math.floor(Math.min(E.y,C.y,B.y)),this.yScale,this.cellsY),X=Eh(Math.floor(Math.max(E.y,C.y,B.y)),this.yScale,this.cellsY),$=new ct(0,0),re=new ct(0,0),ne=new ct(0,0),ie=new ct(0,0);for(let se=q;se<=X;++se){$.y=re.y=se*c,ne.y=ie.y=(se+1)*c;for(let he=O;he<=G;++he)$.x=ne.x=he*c,re.x=ie.x=(he+1)*c,(pg(E,C,B,$,re,ie)||pg(E,C,B,$,ie,ne))&&p.push({cellIdx:se*this.cellsX+he,triIdx:v})}}if(p.length===0)return;p.sort((v,E)=>v.cellIdx-E.cellIdx||v.triIdx-E.triIdx);let _=0;for(;_<p.length;){const v=p[_].cellIdx,E={start:this.payload.length,len:0};for(;_<p.length&&p[_].cellIdx===v;)++E.len,this.payload.push(p[_++].triIdx);this.cells[v]=E}}query(e,i,r){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>i.x||e.y>this.max.y||this.min.y>i.y)return;this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8)));for(let p=0;p<this.lookup.length;p++)this.lookup[p]=0;const n=Eh(e.x-this.min.x,this.xScale,this.cellsX),s=Eh(i.x-this.min.x,this.xScale,this.cellsX),a=Eh(e.y-this.min.y,this.yScale,this.cellsY),c=Eh(i.y-this.min.y,this.yScale,this.cellsY);for(let p=a;p<=c;p++)for(let _=n;_<=s;_++){const v=this.cells[p*this.cellsX+_];if(v)for(let E=0;E<v.len;E++){const C=this.payload[v.start+E],B=Math.floor(C/8),O=1<<C%8;if(!(this.lookup[B]&O)&&(this.lookup[B]|=O,r.push(C),r.length===this.triangleCount))return}}}}function Eh(t,e,i){return Math.max(0,Math.min(i-1,Math.floor(t*e)))}function lf(t,e){const i=t.json.bufferViews[e.bufferView];return new ly[e.componentType](t.buffers[i.buffer],(e.byteOffset||0)+(i.byteOffset||0),e.count*Ay[e.type])}function RE(t,e,i){const r=t.indices,n=t.attributes,s={};s.indexArray=new so;const a=e.json.accessors[r],c=a.count/3;s.indexArray.reserve(c);const p=lf(e,a);for(let C=0;C<c;C++)s.indexArray.emplaceBack(p[3*C],p[3*C+1],p[3*C+2]);s.indexArray._trim(),s.vertexArray=new Zc;const _=e.json.accessors[n.POSITION];s.vertexArray.reserve(_.count);const v=lf(e,_);for(let C=0;C<_.count;C++)s.vertexArray.emplaceBack(v[3*C],v[3*C+1],v[3*C+2]);if(s.vertexArray._trim(),s.aabb=new Hr(_.min,_.max),s.centroid=function(C,B){const O=[0,0,0],G=C.length;if(G>0){for(let q=0;q<G;q++){const X=3*C[q];O[0]+=B[X],O[1]+=B[X+1],O[2]+=B[X+2]}O[0]/=G,O[1]/=G,O[2]/=G}return O}(p,v),n.COLOR_0!==void 0){const C=e.json.accessors[n.COLOR_0],B=Ay[C.type];if(C.componentType===ay){s.colorArray=B===3?new Zc:new Vc,s.colorArray.reserve(C.count);const O=lf(e,C);if(B===3)for(let G=0;G<C.count;G++)s.colorArray.emplaceBack(O[3*G],O[3*G+1],O[3*G+2]);else for(let G=0;G<C.count;G++)s.colorArray.emplaceBack(O[4*G],O[4*G+1],O[4*G+2],O[4*G+3]);s.colorArray._trim()}else if(C.componentType===oy&&B===4){s.colorArray=new Vc,s.colorArray.resize(C.count);const O=lf(e,C),G=1/65535,q=s.colorArray.float32;for(let X=0;X<4*O.length;++X)q[X]=O[X]*G}else Be(`glTF color buffer parsing for accessor ${JSON.stringify(C)} is not supported`)}if(n.NORMAL!==void 0){s.normalArray=new Zc;const C=e.json.accessors[n.NORMAL];s.normalArray.reserve(C.count);const B=lf(e,C);for(let O=0;O<C.count;O++)s.normalArray.emplaceBack(B[3*O],B[3*O+1],B[3*O+2]);s.normalArray._trim()}if(n.TEXCOORD_0!==void 0&&i.length>0){s.texcoordArray=new Oh;const C=e.json.accessors[n.TEXCOORD_0];s.texcoordArray.reserve(C.count);const B=lf(e,C);for(let O=0;O<C.count;O++)s.texcoordArray.emplaceBack(B[2*O],B[2*O+1]);s.texcoordArray._trim()}const E=t.material;return s.material=function(C,B){const{emissiveFactor:O=[0,0,0],alphaMode:G="OPAQUE",alphaCutoff:q=.5,normalTexture:X,occlusionTexture:$,emissiveTexture:re,doubleSided:ne}=C,{baseColorFactor:ie=[1,1,1,1],metallicFactor:se=1,roughnessFactor:he=1,baseColorTexture:ve,metallicRoughnessTexture:be}=C.pbrMetallicRoughness||{};return{pbrMetallicRoughness:{baseColorFactor:new fr(...ie),metallicFactor:se,roughnessFactor:he,baseColorTexture:ve?B[ve.index]:void 0,metallicRoughnessTexture:be?B[be.index]:void 0},doubleSided:ne,emissiveFactor:O,alphaMode:G,alphaCutoff:q,normalTexture:X?B[X.index]:void 0,occlusionTexture:$?B[$.index]:void 0,emissionTexture:re?B[re.index]:void 0,defined:C.defined===void 0}}(E!==void 0?e.json.materials[E]:{defined:!1},i),n._FEATURE_RGBA4444!==void 0&&(s.featureData=new Uint32Array(lf(e,e.json.accessors[n._FEATURE_RGBA4444]).buffer)),s}function jv(t,e,i){const{matrix:r,rotation:n,translation:s,scale:a,mesh:c,extras:p,children:_}=t,v={};if(v.matrix=r||ce.fromRotationTranslationScale([],n||[0,0,0,1],s||[0,0,0],a||[1,1,1]),c!==void 0){v.meshes=i[c];const E=v.anchor=[0,0];for(const C of v.meshes){const{min:B,max:O}=C.aabb;E[0]+=B[0]+O[0],E[1]+=B[1]+O[1]}E[0]=Math.floor(E[0]/v.meshes.length/2),E[1]=Math.floor(E[1]/v.meshes.length/2)}if(p&&(p.id&&(v.id=p.id),p.lights&&(v.lights=function(E){if(!E.length)return[];const C=function(X){const $=atob(X),re=new Uint8Array($.length);for(let ne=0;ne<$.length;ne++)re[ne]=$.codePointAt(ne);return re}(E),B=[],O=C.length/24,G=new Uint16Array(C.buffer),q=new Float32Array(C.buffer);for(let X=0;X<O;X++){const $=G[2*X*6]/30,re=G[2*X*6+1]/30,ne=G[2*X*6+10]/100,ie=q[6*X+1],se=q[6*X+2],he=q[6*X+3],ve=q[6*X+4],be=he-ie,De=ve-se,Ve=Math.hypot(be,De);B.push({pos:[ie+.5*be,se+.5*De,re],normal:[De/Ve,-be/Ve,0],width:Ve,height:$,depth:ne,points:[ie,se,he,ve]})}return B}(p.lights))),_){const E=[];for(const C of _)E.push(jv(e.json.nodes[C],e,i));v.children=E}return v}function FE(t){if(t.vertices.length===0||t.indices.length===0)return null;const[e,i]=[t.vertices[0].clone(),t.vertices[0].clone()];for(let a=1;a<t.vertices.length;++a){const c=t.vertices[a];e.x=Math.min(e.x,c.x),e.y=Math.min(e.y,c.y),i.x=Math.max(i.x,c.x),i.y=Math.max(i.y,c.y)}const r=Math.ceil(Math.max(i.x-e.x,i.y-e.y)/256),n=Math.max(8,r),s=new Vv(t.vertices,t.indices,n);return{vertices:t.vertices,indices:t.indices,grid:s,min:e,max:i}}function OE(t){if(!t.extras||!t.extras.ground)return null;const e=t.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const i=e[0];if(!i||!Array.isArray(i)||i.length===0)return null;const r=[];for(const a of i){if(!Array.isArray(a)||a.length!==2)continue;const c=a[0],p=a[1];typeof c=="number"&&typeof p=="number"&&r.push(new ct(c,p))}if(r.length<3)return null;r.length>1&&r[r.length-1].equals(r[0])&&r.pop();let n=0;for(let a=0;a<r.length;a++){const c=r[a],p=r[(a+1)%r.length],_=r[(a+2)%r.length];n+=(c.x-p.x)*(_.y-p.y)-(_.x-p.x)*(c.y-p.y)}n>0&&r.reverse();const s=vm(r.flatMap(a=>[a.x,a.y]),[]);return s.length===0?null:{vertices:r,indices:s}}function NE(t){const e=[],i=[];let r=0;for(const n of t){r=e.length;const s=n.vertexArray.float32,a=n.indexArray.uint16;for(let c=0;c<n.vertexArray.length;c++)e.push(new ct(s[3*c+0],s[3*c+1]));for(let c=0;c<3*n.indexArray.length;c++)i.push(a[c]+r)}if(i.length%3!=0)return null;for(let n=0;n<i.length;n+=3){const s=e[i[n+0]],a=e[i[n+1]],c=e[i[n+2]];(s.x-a.x)*(c.y-a.y)-(c.x-a.x)*(s.y-a.y)>0&&([i[n+1],i[n+2]]=[i[n+2],i[n+1]])}return{vertices:e,indices:i}}function uy(t){const e=function(p,_){const v=[],E=Ee.WebGL2RenderingContext;if(p.json.textures)for(const C of p.json.textures){const B={magFilter:E.LINEAR,minFilter:E.NEAREST,wrapS:E.REPEAT,wrapT:E.REPEAT};C.sampler!==void 0&&Object.assign(B,p.json.samplers[C.sampler]),v.push({image:_[C.source],sampler:B,uploaded:!1})}return v}(t,t.images),i=function(p,_){const v=[];for(const E of p.json.meshes){const C=[];for(const B of E.primitives)C.push(RE(B,p,_));v.push(C)}return v}(t,e),{scenes:r,scene:n,nodes:s}=t.json,a=r?r[n||0].nodes:s,c=[];for(const p of a)c.push(jv(s[p],t,i));return function(p,_,v){const E={},C=new Set;for(let B=0;B<p.length;B++){const O=v[_[B]];if(!O.extras)continue;const G=O.extras["mapbox:footprint:version"],q=O.extras["mapbox:footprint:id"];(G||q)&&C.add(B),G==="1.0.0"&&q&&(E[q]=B)}for(let B=0;B<p.length;B++){if(C.has(B))continue;const O=p[B],G=v[_[B]];if(!G.extras)continue;let q=null;O.id in E&&(q=NE(p[E[O.id]].meshes)),q||(q=OE(G)),q&&(O.footprint=FE(q))}if(C.size>0){const B=Array.from(C.values()).sort((O,G)=>O-G);for(let O=B.length-1;O>=0;O--)p.splice(B[O],1)}}(c,a,t.json.nodes),c}function UE(t){t.heightmap=new Float32Array(4096),t.heightmap.fill(-1);const e=t.vertexArray.float32,i=t.aabb.min[0]-1,r=t.aabb.min[1]-1,n=nf/(t.aabb.max[0]-i+2),s=nf/(t.aabb.max[1]-r+2);for(let a=0;a<e.length;a+=3){const c=e[a+2],p=(e[a+0]-i)*n|0,_=(e[a+1]-r)*s|0;c>t.heightmap[_*nf+p]&&(t.heightmap[_*nf+p]=c)}}function VE(t,e){const i={};i.indexArray=new so,i.indexArray.reserve(4*t.length),i.vertexArray=new Zc,i.vertexArray.reserve(10*t.length),i.colorArray=new Vc,i.vertexArray.reserve(10*t.length);let r=0;for(const a of t){const c=Math.min(10,Math.max(4,1.3*a.height))*e,p=[-a.normal[1],a.normal[0],0],_=Math.min(.29,.1*a.width/a.depth),v=a.width-2*a.depth*e*(_+.01),E=me.scaleAndAdd([],a.pos,p,v/2),C=me.scaleAndAdd([],a.pos,p,-v/2),B=[E[0],E[1],E[2]+a.height],O=[C[0],C[1],C[2]+a.height],G=me.scaleAndAdd([],a.normal,p,_);me.scale(G,G,c);const q=me.scaleAndAdd([],a.normal,p,-_);me.scale(q,q,c),me.add(G,E,G),me.add(q,C,q),E[2]+=.1,C[2]+=.1,i.vertexArray.emplaceBack(G[0],G[1],G[2]),i.vertexArray.emplaceBack(q[0],q[1],q[2]),i.vertexArray.emplaceBack(E[0],E[1],E[2]),i.vertexArray.emplaceBack(C[0],C[1],C[2]),i.vertexArray.emplaceBack(B[0],B[1],B[2]),i.vertexArray.emplaceBack(O[0],O[1],O[2]),i.vertexArray.emplaceBack(E[0],E[1],E[2]),i.vertexArray.emplaceBack(C[0],C[1],C[2]),i.vertexArray.emplaceBack(G[0],G[1],G[2]),i.vertexArray.emplaceBack(q[0],q[1],q[2]);const X=v/c/2;i.colorArray.emplaceBack(-X-_,-1,X,.8),i.colorArray.emplaceBack(X+_,-1,X,.8),i.colorArray.emplaceBack(-X,0,X,1.3),i.colorArray.emplaceBack(X,0,X,1.3),i.colorArray.emplaceBack(X+_,-.8,X,.7),i.colorArray.emplaceBack(X+_,-.8,X,.7),i.colorArray.emplaceBack(0,0,X,1.3),i.colorArray.emplaceBack(0,0,X,1.3),i.colorArray.emplaceBack(X+_,-1.2,X,.8),i.colorArray.emplaceBack(X+_,-1.2,X,.8),i.indexArray.emplaceBack(6+r,4+r,8+r),i.indexArray.emplaceBack(7+r,9+r,5+r),i.indexArray.emplaceBack(0+r,1+r,2+r),i.indexArray.emplaceBack(1+r,3+r,2+r),r+=10}const n={defined:!0,emissiveFactor:[0,0,0]},s={};return s.baseColorFactor=fr.white,n.pbrMetallicRoughness=s,i.material=n,i.aabb=new Hr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}Mi(Vv,"TriangleGridIndex");const hy={vector:Pv,raster:iy,"raster-dem":class extends iy{constructor(t,e,i,r){super(t,e,i,r),this.type="raster-dem",this.maxzoom=22,this._options=Pt({type:"raster-dem"},e),this.encoding=e.encoding||"mapbox"}loadTile(t,e){const i=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function r(n,s){n&&(t.state="errored",e(n)),s&&(t.dem=s,t.dem.onDeserialize(),t.needsHillshadePrepare=!0,t.needsDEMTextureUpload=!0,t.state="loaded",e(null))}t.request=Et(this.map._requestManager.transformRequest(i,we.Tile),(function(n,s,a,c){if(delete t.request,t.aborted)t.state="unloaded",e(null);else if(n)t.state="errored",e(n);else if(s){this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:a,expires:c});const _=Ee.ImageBitmap&&s instanceof Ee.ImageBitmap&&JA(),v=1-(s.width-((p=s.width)<=1?1:Math.pow(2,Math.floor(Math.log(p)/Math.LN2))))/2;v<1||t.neighboringTiles||(t.neighboringTiles=this._getNeighboringTiles(t.tileID));const E=_?s:Wi.getImageData(s,v),C={uid:t.uid,coord:t.tileID,source:this.id,scope:this.scope,rawImageData:E,encoding:this.encoding,padding:v};t.actor&&t.state!=="expired"||(t.actor=this.dispatcher.getActor(),t.actor.send("loadDEMTile",C,r.bind(this),void 0,!0))}var p}).bind(this))}_getNeighboringTiles(t){const e=t.canonical,i=Math.pow(2,e.z),r=(e.x-1+i)%i,n=e.x===0?t.wrap-1:t.wrap,s=(e.x+1+i)%i,a=e.x+1===i?t.wrap+1:t.wrap,c={};return c[new ui(t.overscaledZ,n,e.z,r,e.y).key]={backfilled:!1},c[new ui(t.overscaledZ,a,e.z,s,e.y).key]={backfilled:!1},e.y>0&&(c[new ui(t.overscaledZ,n,e.z,r,e.y-1).key]={backfilled:!1},c[new ui(t.overscaledZ,t.wrap,e.z,e.x,e.y-1).key]={backfilled:!1},c[new ui(t.overscaledZ,a,e.z,s,e.y-1).key]={backfilled:!1}),e.y+1<i&&(c[new ui(t.overscaledZ,n,e.z,r,e.y+1).key]={backfilled:!1},c[new ui(t.overscaledZ,t.wrap,e.z,e.x,e.y+1).key]={backfilled:!1},c[new ui(t.overscaledZ,a,e.z,s,e.y+1).key]={backfilled:!1}),c}},geojson:class extends ss{constructor(t,e,i,r){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=i.getActor(),this.setEventedParent(r),this._data=e.data,this._options=Pt({},e),this._collectResourceTiming=e.collectResourceTiming,e.maxzoom!==void 0&&(this.maxzoom=e.maxzoom),e.type&&(this.type=e.type),e.attribution&&(this.attribution=e.attribution),this.promoteId=e.promoteId;const n=Mt/this.tileSize;this.workerOptions=Pt({source:this.id,scope:this.scope,cluster:e.cluster||!1,geojsonVtOptions:{buffer:(e.buffer!==void 0?e.buffer:128)*n,tolerance:(e.tolerance!==void 0?e.tolerance:.375)*n,extent:Mt,maxZoom:this.maxzoom,lineMetrics:e.lineMetrics||!1,generateId:e.generateId||!1},superclusterOptions:{maxZoom:e.clusterMaxZoom!==void 0?e.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,e.clusterMinPoints||2),extent:Mt,radius:(e.clusterRadius!==void 0?e.clusterRadius:50)*n,log:!1,generateId:e.generateId||!1},clusterProperties:e.clusterProperties,filter:e.filter},e.workerOptions)}onAdd(t){this.map=t,this.setData(this._data)}setData(t){return this._data=t,this._updateWorkerData(),this}getClusterExpansionZoom(t,e){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id,scope:this.scope},e),this}getClusterChildren(t,e){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id,scope:this.scope},e),this}getClusterLeaves(t,e,i,r){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:t,limit:e,offset:i},r),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new Jt("dataloading",{dataType:"source"})),this._loaded=!1;const t=Pt({},this.workerOptions);t.scope=this.scope;const e=this._data;typeof e=="string"?(t.request=this.map._requestManager.transformRequest(Wi.resolveURL(e),we.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(e),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,(i,r)=>{if(this._loaded=!0,this._pendingLoad=null,i)this.fire(new $i(i));else{const n={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&r&&r.resourceTiming&&r.resourceTiming[this.id]&&(n.resourceTiming=r.resourceTiming[this.id]),this.fire(new Jt("data",n)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(t,e){const i=t.actor?"reloadTile":"loadTile";t.actor=this.actor;const r={type:this.type,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,scope:this.scope,pixelRatio:Wi.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0};t.request=this.actor.send(i,r,(n,s)=>(delete t.request,t.destroy(),t.aborted?e(null):n?e(n):(t.loadVectorData(s,this.map.painter,i==="reloadTile"),e(null))),void 0,i==="loadTile")}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0}unloadTile(t){this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Pt({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Tc{constructor(t,e,i,r){super(t,e,i,r),this.roundZoom=!0,this.type="video",this.options=e}load(){this._loaded=!1;const t=this.options;this.urls=[];for(const e of t.urls)this.urls.push(this.map._requestManager.transformRequest(e,we.Source).url);(function(e,i){const r=Ee.document.createElement("video");r.muted=!0,r.onloadstart=function(){i(null,r)};for(let n=0;n<e.length;n++){const s=Ee.document.createElement("source");$e(e[n])||(r.crossOrigin="Anonymous"),s.src=e[n],r.appendChild(s)}})(this.urls,(e,i)=>{this._loaded=!0,e?this.fire(new $i(e)):i&&(this.video=i,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const e=this.video.seekable;t<e.start(0)||t>e.end(0)?this.fire(new $i(new gi(`sources.${this.id}`,null,`Playback for this video can be set only between the ${e.start(0)} and ${e.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,e=t.gl;this.texture?this.video.paused||(this.texture.bind(e.LINEAR,e.CLAMP_TO_EDGE),e.texSubImage2D(e.TEXTURE_2D,0,0,0,e.RGBA,e.UNSIGNED_BYTE,this.video)):(this.texture=new Bs(t,this.video,e.RGBA),this.texture.bind(e.LINEAR,e.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(t)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Tc,model:class extends ss{constructor(t,e,i,r){super(),this.id=t,this.type="model",this.models=[],this._loaded=!1,this._options=e}load(){const t=[];for(const e in this._options.models){const i=this._options.models[e],r=Uv(this.map._requestManager.transformRequest(i.uri,we.Model).url).then(n=>{if(!n)return;const s=uy(n),a=new Rx(e,i.position,i.orientation,s);a.computeBoundsAndApplyParent(),this.models.push(a)}).catch(n=>{this.fire(new $i(new Error(`Could not load model ${e} from ${i.uri}: ${n.message}`)))});t.push(r)}return Promise.allSettled(t).then(()=>{this._loaded=!0,this.fire(new Jt("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(e=>{this.fire(new $i(new Error(`Could not load models: ${e.message}`)))})}onAdd(t){this.map=t,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(t,e){}serialize(){return{type:"model"}}},"batched-model":class extends ss{constructor(t,e,i,r){super(),this.type="batched-model",this.id=t,this.tileSize=512,this._options=e,this.tiles=this._options.tiles,this.maxzoom=e.maxzoom||19,this.minzoom=e.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=i,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(r)}onAdd(t){this.map=t,this.load()}load(t){this._loaded=!1,this.fire(new Jt("dataloading",{dataType:"source"}));const e=Array.isArray(this.map._language)?this.map._language.join():this.map._language,i=this.map._worldview;this._tileJSONRequest=ey(this._options,this.map._requestManager,e,i,(r,n)=>{this._tileJSONRequest=null,this._loaded=!0,r?(e&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${e}`),i&&i.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${i}`),this.fire(new $i(r))):n&&(Pt(this,n),n.bounds&&(this.tileBounds=new s_(n.bounds,this.minzoom,this.maxzoom)),hn(n.tiles,this.map._requestManager._customAccessToken),this.fire(new Jt("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new Jt("data",{dataType:"source",sourceDataType:"content"}))),t&&t(r)})}hasTransition(){return!1}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loaded(){return this._loaded}loadTile(t,e){const i=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme)),r={request:this.map._requestManager.transformRequest(i,we.Tile),data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(t.actor&&t.state!=="expired")if(t.state==="loading")t.reloadCallback=e;else{if(t.buckets){const s=Object.values(t.buckets);for(const a of s)a.dirty=!0;return void(t.state="loaded")}t.request=t.actor.send("reloadTile",r,n.bind(this))}else t.actor=this.dispatcher.getActor(),t.request=t.actor.send("loadTile",r,n.bind(this),void 0,!0);function n(s,a){return t.aborted?e(null):s&&s.status!==404?e(s):(a&&(a.resourceTiming&&(t.resourceTiming=a.resourceTiming),this.map._refreshExpiredTiles&&t.setExpiryData(a),t.buckets={...t.buckets,...a.buckets}),t.state="loaded",void e(null))}}serialize(){return Pt({},this._options)}},canvas:class extends Tc{constructor(t,e,i,r){super(t,e,i,r),e.coordinates?Array.isArray(e.coordinates)&&e.coordinates.length===4&&!e.coordinates.some(n=>!Array.isArray(n)||n.length!==2||n.some(s=>typeof s!="number"))||this.fire(new $i(new gi(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new $i(new gi(`sources.${t}`,null,'missing required property "coordinates"'))),e.animate&&typeof e.animate!="boolean"&&this.fire(new $i(new gi(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),e.canvas?typeof e.canvas=="string"||e.canvas instanceof Ee.HTMLCanvasElement||this.fire(new $i(new gi(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new $i(new gi(`sources.${t}`,null,'missing required property "canvas"'))),this.options=e,this.animate=e.animate===void 0||e.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof Ee.HTMLCanvasElement?this.options.canvas:Ee.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new $i(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const e=this.map.painter.context;this.texture?!t&&!this._playing||this.texture instanceof Qm||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Bs(e,this.canvas,e.gl.RGBA,{premultiply:!0}),this._prepareData(e)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}},custom:class extends ss{constructor(t,e,i,r){super(),this.id=t,this.type="custom",this._dataType="raster",this._dispatcher=i,this._implementation=e,this.setEventedParent(r),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new $i(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new $i(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new s_(this._implementation.bounds,this.minzoom,this.maxzoom)),e.update=this._update.bind(this),e.clearTiles=this._clearTiles.bind(this),e.coveringTiles=this._coveringTiles.bind(this),Pt(this,nr(e,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return nr(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new Jt("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new Jt("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(t){this._map=t,this._loaded=!1,this.fire(new Jt("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(t),this.load()}onRemove(t){this._implementation.onRemove&&this._implementation.onRemove(t)}hasTile(t){if(this._implementation.hasTile){const{x:e,y:i,z:r}=t.canonical;return this._implementation.hasTile({x:e,y:i,z:r})}return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,e){const{x:i,y:r,z:n}=t.tileID.canonical,s=new Ee.AbortController;t.request=Promise.resolve(this._implementation.loadTile({x:i,y:r,z:n},{signal:s.signal})).then((function(a){return delete t.request,t.aborted?(t.state="unloaded",e(null)):a===void 0?(t.state="errored",e(null)):a===null?(this.loadTileData(t,{width:this.tileSize,height:this.tileSize,data:null}),t.state="loaded",e(null)):function(c){return c instanceof Ee.ImageData||c instanceof Ee.HTMLCanvasElement||c instanceof Ee.ImageBitmap||c instanceof Ee.HTMLImageElement}(a)?(this.loadTileData(t,a),t.state="loaded",void e(null)):(t.state="errored",e(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(a=>{a.code!==20&&(t.state="errored",e(a))}),t.request.cancel=()=>s.abort()}loadTileData(t,e){t.setTexture(e,this._map.painter)}unloadTile(t,e){if(t.texture&&t.texture instanceof Bs?(t.destroy(!0),t.texture&&t.texture instanceof Bs&&this._map.painter.saveTileTexture(t.texture)):t.destroy(),this._implementation.unloadTile){const{x:i,y:r,z:n}=t.tileID.canonical;this._implementation.unloadTile({x:i,y:r,z:n})}e()}abortTile(t,e){t.request&&t.request.cancel&&(t.request.cancel(),delete t.request),e()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(t=>({x:t.canonical.x,y:t.canonical.y,z:t.canonical.z}))}_clearTiles(){const t=Zo(this.id,this.scope);this._map.style.clearSource(t)}_update(){this.fire(new Jt("data",{dataType:"source",sourceDataType:"content"}))}}},fy=function(t,e,i,r){const n=new hy[e.type](t,e,i,r);if(n.id!==t)throw new Error(`Expected Source id to be ${t} instead of ${n.id}`);return Ir(["load","abort","unload","serialize","prepare"],n),n};function jE(t,e){const i=ce.identity([]);return ce.scale(i,i,[.5*t.width,.5*-t.height,1]),ce.translate(i,i,[1,-1,0]),ce.multiply(i,i,t.calculateProjMatrix(e.toUnwrapped())),Float32Array.from(i)}function GE(t,e,i,r,n,s,a,c=!1){const p=t.tilesIn(r,a,c);p.sort(Gv);const _=[];for(const E of p)_.push({wrappedTileID:E.tile.tileID.wrapped().key,queryResults:E.tile.queryRenderedFeatures(e,i,t._state,E,n,s,jE(t.transform,E.tile.tileID),c)});const v=function(E){const C={},B={};for(const O of E){const G=O.queryResults,q=O.wrappedTileID,X=B[q]=B[q]||{};for(const $ in G){const re=G[$],ne=X[$]=X[$]||{},ie=C[$]=C[$]||[];for(const se of re)ne[se.featureIndex]||(ne[se.featureIndex]=!0,ie.push(se))}}return C}(_);for(const E in v)v[E].forEach(C=>{const B=C.feature,O=B.layer;O&&O.type!=="background"&&O.type!=="sky"&&O.type!=="slot"&&(B.source=O.source,O["source-layer"]&&(B.sourceLayer=O["source-layer"]),B.state=B.id!==void 0?t.getFeatureState(O["source-layer"],B.id):{})});return v}function ZE(t,e){const i=t.getRenderableIds().map(s=>t.getTileByID(s)),r=[],n={};for(let s=0;s<i.length;s++){const a=i[s],c=a.tileID.canonical.key;n[c]||(n[c]=!0,a.querySourceFeatures(r,e))}return r}function Gv(t,e){const i=t.tileID,r=e.tileID;return i.overscaledZ-r.overscaledZ||i.canonical.y-r.canonical.y||i.wrap-r.wrap||i.canonical.x-r.canonical.x}class qE{constructor(e){this.style=e}processLayersChanged(){this.layers=[];for(const e in this.style._mergedLayers){const i=this.style._mergedLayers[e];if(i.type==="fill-extrusion")this.layers.push(i);else if(i.type==="model"){const r=this.style.getLayerSource(i);r&&r.type==="batched-model"&&this.layers.push(i)}}}updateZOffset(e,i){this.currentBuildingBuckets=[];for(let n=0;n<this.layers.length;++n){const s=this.layers[n],a=this.style.getLayerSourceCache(s);let c=1;s.type==="fill-extrusion"&&(c=s.paint.get("fill-extrusion-opacity")>0?s.paint.get("fill-extrusion-vertical-scale"):0);let p=a?a.getTile(i):null;if(!p&&a&&i.canonical.z>a.getSource().minzoom){let _=i.scaledTo(Math.min(a.getSource().maxzoom,i.overscaledZ-1));for(;_.overscaledZ>=a.getSource().minzoom&&(p=a.getTile(_),!p&&_.overscaledZ!==0);)_=_.scaledTo(_.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:p?p.getBucket(s):null,tileID:p?p.tileID:i,verticalScale:c})}e.hasAnyZOffset=!1;let r=!1;for(let n=0;n<e.symbolInstances.length;n++){const s=e.symbolInstances.get(n),a=s.zOffset,c=this._getHeightAtTileOffset(i,s.tileAnchorX,s.tileAnchorY);s.zOffset=c!==-1?c:a,r||a===s.zOffset||(r=!0),e.hasAnyZOffset||s.zOffset===0||(e.hasAnyZOffset=!0)}r&&(e.zOffsetBuffersNeedUpload=!0,e.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(e,i,r,n){let s=i,a=r;if(e.canonical.z!==n.canonical.z){const c=n.canonical,p=1/(1<<e.canonical.z-c.z);s=(i+e.canonical.x*Mt)*p-c.x*Mt|0,a=(r+e.canonical.y*Mt)*p-c.y*Mt|0}return{tileX:s,tileY:a}}_getHeightAtTileOffset(e,i,r){let n;for(let s=0;s<this.layers.length;++s){if(this.layers[s].type!=="fill-extrusion")continue;const{bucket:a,tileID:c,verticalScale:p}=this.currentBuildingBuckets[s];if(!a)continue;const{tileX:_,tileY:v}=this._mapCoordToOverlappingTile(e,i,r,c),E=a.getHeightAtTileCoord(_,v);if(E&&E.height!==void 0){if(!E.hidden)return E.height*p;n=E.height}}for(let s=0;s<this.layers.length;++s){if(this.layers[s].type!=="model")continue;const{bucket:a,tileID:c}=this.currentBuildingBuckets[s];if(!a)continue;const{tileX:p,tileY:_}=this._mapCoordToOverlappingTile(e,i,r,c),v=a.getHeightAtTileCoord(p,_);if(v&&!v.hidden)return v.height===void 0&&n!==void 0?Math.min(v.maxHeight,n)*v.verticalScale:(v.height||0)*v.verticalScale}return-1}}var Zv=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function QE(t,e){const i={};for(const r in t)r!=="ref"&&(i[r]=t[r]);return Zv.forEach(r=>{r in e&&(i[r]=e[r])}),i}function qv(t){t=t.slice();const e=Object.create(null);for(let i=0;i<t.length;i++)e[t[i].id]=t[i];for(let i=0;i<t.length;i++)"ref"in t[i]&&(t[i]=QE(t[i],e[t[i].ref]));return t}const bn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",setImportUrl:"setImportUrl",setImportData:"setImportData",setImportConfig:"setImportConfig"};function Qv(t,e,i){i.push({command:bn.addSource,args:[t,e[t]]})}function Hv(t,e,i){e.push({command:bn.removeSource,args:[t]}),i[t]=!0}function HE(t,e,i,r){Hv(t,i,r),Qv(t,e,i)}function WE(t,e,i){let r;for(r in t[i])if(t[i].hasOwnProperty(r)&&r!=="data"&&!Lt(t[i][r],e[i][r]))return!1;for(r in e[i])if(e[i].hasOwnProperty(r)&&r!=="data"&&!Lt(t[i][r],e[i][r]))return!1;return!0}function a_(t,e,i,r,n,s){let a;for(a in e=e||{},t=t||{})t.hasOwnProperty(a)&&(Lt(t[a],e[a])||i.push({command:s,args:[r,a,e[a],n]}));for(a in e)e.hasOwnProperty(a)&&!t.hasOwnProperty(a)&&(Lt(t[a],e[a])||i.push({command:s,args:[r,a,e[a],n]}))}function l_(t){return t.id}function A_(t,e){return t[e.id]=e,t}class XE{constructor(e,i){this.reset(e,i)}reset(e,i){this.points=e||[],this._distances=[0];for(let r=1;r<this.points.length;r++)this._distances[r]=this._distances[r-1]+this.points[r].dist(this.points[r-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(i||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=Ai(e,0,1);let i=1,r=this._distances[i];const n=e*this.paddedLength+this.padding;for(;r<n&&i<this._distances.length;)r=this._distances[++i];const s=i-1,a=this._distances[s],c=r-a,p=c>0?(n-a)/c:0;return this.points[s].mult(1-p).add(this.points[i].mult(p))}}class Wv{constructor(e,i,r){const n=this.boxCells=[],s=this.circleCells=[];this.xCellCount=Math.ceil(e/r),this.yCellCount=Math.ceil(i/r);for(let a=0;a<this.xCellCount*this.yCellCount;a++)n.push([]),s.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=i,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/i,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,i,r,n,s){this._forEachCell(i,r,n,s,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(i),this.bboxes.push(r),this.bboxes.push(n),this.bboxes.push(s)}insertCircle(e,i,r,n){this._forEachCell(i-n,r-n,i+n,r+n,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(i),this.circles.push(r),this.circles.push(n)}_insertBoxCell(e,i,r,n,s,a){this.boxCells[s].push(a)}_insertCircleCell(e,i,r,n,s,a){this.circleCells[s].push(a)}_query(e,i,r,n,s,a){if(r<0||e>this.width||n<0||i>this.height)return!s&&[];const c=[];if(e<=0&&i<=0&&this.width<=r&&this.height<=n){if(s)return!0;for(let p=0;p<this.boxKeys.length;p++)c.push({key:this.boxKeys[p],x1:this.bboxes[4*p],y1:this.bboxes[4*p+1],x2:this.bboxes[4*p+2],y2:this.bboxes[4*p+3]});for(let p=0;p<this.circleKeys.length;p++){const _=this.circles[3*p],v=this.circles[3*p+1],E=this.circles[3*p+2];c.push({key:this.circleKeys[p],x1:_-E,y1:v-E,x2:_+E,y2:v+E})}return a?c.filter(a):c}return this._forEachCell(e,i,r,n,this._queryCell,c,{hitTest:s,seenUids:{box:{},circle:{}}},a),s?c.length>0:c}_queryCircle(e,i,r,n,s){const a=e-r,c=e+r,p=i-r,_=i+r;if(c<0||a>this.width||_<0||p>this.height)return!n&&[];const v=[];return this._forEachCell(a,p,c,_,this._queryCellCircle,v,{hitTest:n,circle:{x:e,y:i,radius:r},seenUids:{box:{},circle:{}}},s),n?v.length>0:v}query(e,i,r,n,s){return this._query(e,i,r,n,!1,s)}hitTest(e,i,r,n,s){return this._query(e,i,r,n,!0,s)}hitTestCircle(e,i,r,n){return this._queryCircle(e,i,r,!0,n)}_queryCell(e,i,r,n,s,a,c,p){const _=c.seenUids,v=this.boxCells[s];if(v!==null){const C=this.bboxes;for(const B of v)if(!_.box[B]){_.box[B]=!0;const O=4*B;if(e<=C[O+2]&&i<=C[O+3]&&r>=C[O+0]&&n>=C[O+1]&&(!p||p(this.boxKeys[B]))){if(c.hitTest)return a.push(!0),!0;a.push({key:this.boxKeys[B],x1:C[O],y1:C[O+1],x2:C[O+2],y2:C[O+3]})}}}const E=this.circleCells[s];if(E!==null){const C=this.circles;for(const B of E)if(!_.circle[B]){_.circle[B]=!0;const O=3*B;if(this._circleAndRectCollide(C[O],C[O+1],C[O+2],e,i,r,n)&&(!p||p(this.circleKeys[B]))){if(c.hitTest)return a.push(!0),!0;{const G=C[O],q=C[O+1],X=C[O+2];a.push({key:this.circleKeys[B],x1:G-X,y1:q-X,x2:G+X,y2:q+X})}}}}}_queryCellCircle(e,i,r,n,s,a,c,p){const _=c.circle,v=c.seenUids,E=this.boxCells[s];if(E!==null){const B=this.bboxes;for(const O of E)if(!v.box[O]){v.box[O]=!0;const G=4*O;if(this._circleAndRectCollide(_.x,_.y,_.radius,B[G+0],B[G+1],B[G+2],B[G+3])&&(!p||p(this.boxKeys[O])))return a.push(!0),!0}}const C=this.circleCells[s];if(C!==null){const B=this.circles;for(const O of C)if(!v.circle[O]){v.circle[O]=!0;const G=3*O;if(this._circlesCollide(B[G],B[G+1],B[G+2],_.x,_.y,_.radius)&&(!p||p(this.circleKeys[O])))return a.push(!0),!0}}}_forEachCell(e,i,r,n,s,a,c,p){const _=this._convertToXCellCoord(e),v=this._convertToYCellCoord(i),E=this._convertToXCellCoord(r),C=this._convertToYCellCoord(n);for(let B=_;B<=E;B++)for(let O=v;O<=C;O++)if(s.call(this,e,i,r,n,this.xCellCount*O+B,a,c,p))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,i,r,n,s,a){const c=n-e,p=s-i,_=r+a;return _*_>c*c+p*p}_circleAndRectCollide(e,i,r,n,s,a,c){const p=(a-n)/2,_=Math.abs(e-(n+p));if(_>p+r)return!1;const v=(c-s)/2,E=Math.abs(i-(s+v));if(E>v+r)return!1;if(_<=p||E<=v)return!0;const C=_-p,B=E-v;return C*C+B*B<=r*r}}const Tu=100;class YE{constructor(e,i,r=new Wv(e.width+200,e.height+200,25),n=new Wv(e.width+200,e.height+200,25)){this.transform=e,this.grid=r,this.ignoredGrid=n,this.pitchfactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+Tu,this.screenBottomBoundary=e.height+Tu,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.fogState=i}placeCollisionBox(e,i,r,n,s,a,c,p){let _=r.projectedAnchorX,v=r.projectedAnchorY,E=r.projectedAnchorZ;const C=r.elevation,B=r.tileID,O=e.getProjection();if(C&&B){const[se,he,ve]=O.upVector(B.canonical,r.tileAnchorX,r.tileAnchorY),be=O.upVectorScale(B.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;_+=se*C*be,v+=he*C*be,E+=ve*C*be}const G=this.projectAndGetPerspectiveRatio(c,_,v,E,r.tileID,O.name==="globe"||!!C||this.transform.pitch>0,O),q=a*G.perspectiveRatio,X=(r.x1*i+n.x-r.padding)*q+G.point.x,$=(r.y1*i+n.y-r.padding)*q+G.point.y,re=(r.x2*i+n.x+r.padding)*q+G.point.x,ne=(r.y2*i+n.y+r.padding)*q+G.point.y,ie=G.perspectiveRatio<=.55||G.occluded;return!this.isInsideGrid(X,$,re,ne)||!s&&this.grid.hitTest(X,$,re,ne,p)||ie?{box:[],offscreen:!1,occluded:G.occluded}:{box:[X,$,re,ne],offscreen:this.isOffscreen(X,$,re,ne),occluded:!1}}placeCollisionCircles(e,i,r,n,s,a,c,p,_,v,E,C,B,O,G){const q=[],X=this.transform.elevation,$=e.getProjection(),re=X?X.getAtTileOffsetFunc(G,this.transform.center.lat,this.transform.worldSize,$):null,ne=new ct(r.tileAnchorX,r.tileAnchorY);let{x:ie,y:se,z:he}=$.projectTilePoint(ne.x,ne.y,G.canonical);if(re){const[vt,rt,lt]=re(ne);ie+=vt,se+=rt,he+=lt}const ve=$.name==="globe",be=this.projectAndGetPerspectiveRatio(c,ie,se,he,G,ve||!!X||this.transform.pitch>0,$),{perspectiveRatio:De}=be,Ve=(E?a/De:a*De)/va,je=ru(ie,se,he,p),Je=be.signedDistanceFromCamera>0?Mx(Ve,s,r.lineOffsetX*Ve,r.lineOffsetY*Ve,!1,je,ne,r,n,p,{},X&&!E?re:null,E&&!!X,$,G,E):null;let Fe=!1,nt=!1,At=!0;if(Je&&!be.occluded){const vt=.5*B*De+O,rt=new ct(-100,-100),lt=new ct(this.screenRightBoundary,this.screenBottomBoundary),wt=new XE,{first:It,last:St}=Je,Bt=It.path.length;let Ft=[];for(let Yt=Bt-1;Yt>=1;Yt--)Ft.push(It.path[Yt]);for(let Yt=1;Yt<St.path.length;Yt++)Ft.push(St.path[Yt]);const jt=2.5*vt;_&&(Ft=Ft.map(([Yt,fi,di],vi)=>(re&&!ve&&(di=re(vi<Bt-1?It.tilePath[Bt-1-vi]:St.tilePath[vi-Bt+2])[2]),ru(Yt,fi,di,_))),Ft.some(Yt=>Yt[3]<=0)&&(Ft=[]));let Dt=[];if(Ft.length>0){let Yt=1/0,fi=-1/0,di=1/0,vi=-1/0;for(const bi of Ft)Yt=Math.min(Yt,bi[0]),di=Math.min(di,bi[1]),fi=Math.max(fi,bi[0]),vi=Math.max(vi,bi[1]);fi>=rt.x&&Yt<=lt.x&&vi>=rt.y&&di<=lt.y&&(Dt=[Ft.map(bi=>new ct(bi[0],bi[1]))],(Yt<rt.x||fi>lt.x||di<rt.y||vi>lt.y)&&(Dt=X1(Dt,rt.x,rt.y,lt.x,lt.y)))}for(const Yt of Dt){wt.reset(Yt,.25*vt);let fi=0;fi=wt.length<=.5*vt?1:Math.ceil(wt.paddedLength/jt)+1;for(let di=0;di<fi;di++){const vi=di/Math.max(fi-1,1),bi=wt.lerp(vi),Ar=bi.x+Tu,Ni=bi.y+Tu;q.push(Ar,Ni,vt,0);const rn=Ar-vt,Vr=Ni-vt,cr=Ar+vt,rr=Ni+vt;if(At=At&&this.isOffscreen(rn,Vr,cr,rr),nt=nt||this.isInsideGrid(rn,Vr,cr,rr),!i&&this.grid.hitTestCircle(Ar,Ni,vt,C)&&(Fe=!0,!v))return{circles:[],offscreen:!1,collisionDetected:Fe,occluded:!1}}}}return{circles:!v&&Fe||!nt?[]:q,offscreen:At,collisionDetected:Fe,occluded:be.occluded}}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const i=[];let r=1/0,n=1/0,s=-1/0,a=-1/0;for(const v of e){const E=new ct(v.x+Tu,v.y+Tu);r=Math.min(r,E.x),n=Math.min(n,E.y),s=Math.max(s,E.x),a=Math.max(a,E.y),i.push(E)}const c=this.grid.query(r,n,s,a).concat(this.ignoredGrid.query(r,n,s,a)),p={},_={};for(const v of c){const E=v.key;p[E.bucketInstanceId]===void 0&&(p[E.bucketInstanceId]={}),p[E.bucketInstanceId][E.featureIndex]||$y(i,[new ct(v.x1,v.y1),new ct(v.x2,v.y1),new ct(v.x2,v.y2),new ct(v.x1,v.y2)])&&(p[E.bucketInstanceId][E.featureIndex]=!0,_[E.bucketInstanceId]===void 0&&(_[E.bucketInstanceId]=[]),_[E.bucketInstanceId].push(E.featureIndex))}return _}insertCollisionBox(e,i,r,n,s){(i?this.ignoredGrid:this.grid).insert({bucketInstanceId:r,featureIndex:n,collisionGroupID:s},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,i,r,n,s){const a=i?this.ignoredGrid:this.grid,c={bucketInstanceId:r,featureIndex:n,collisionGroupID:s};for(let p=0;p<e.length;p+=4)a.insertCircle(c,e[p],e[p+1],e[p+2])}projectAndGetPerspectiveRatio(e,i,r,n,s,a,c){const p=[i,r,n,1];let _=!1;n||this.transform.pitch>0?(V.transformMat4(p,p,e),this.fogState&&s&&c.name!=="globe"&&(_=function(C,B,O,G,q,X){const $=X.calculateFogTileMatrix(q),re=[B,O,G];return me.transformMat4(re,re,$),n_(C,me.length(re),X.pitch,X._fov)}(this.fogState,i,r,n,s.toUnwrapped(),this.transform)>.9)):Dx(p,p,e);const v=p[3];return{point:new ct((p[0]/v+1)/2*this.transform.width+Tu,(-p[1]/v+1)/2*this.transform.height+Tu),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(c)/v*.5,1.5),signedDistanceFromCamera:v,occluded:a&&p[2]>v||_}}isOffscreen(e,i,r,n){return r<Tu||e>=this.screenRightBoundary||n<Tu||i>this.screenBottomBoundary}isInsideGrid(e,i,r,n){return r>=0&&e<this.gridRightBoundary&&n>=0&&i<this.gridBottomBoundary}getViewportMatrix(){const e=ce.identity([]);return ce.translate(e,e,[-100,-100,0]),e}}function dy(t,e,i){const r=e.createTileMatrix(t,t.worldSize,i.toUnwrapped());return ce.multiply(new Float32Array(16),t.projMatrix,r)}function KE(t,e,i){if(e.projection.name===i.projection.name)return t.projMatrix;const r=i.clone();return r.setProjection(e.projection),dy(r,e.getProjection(),t)}function py(t,e,i){return e.name===i.projection.name?t.projMatrix:dy(i,e,t)}class Xv{constructor(e,i,r,n){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?i:-i))):n&&r?1:0,this.placed=r}isHidden(){return this.opacity===0&&!this.placed}}class tp{constructor(e,i,r,n,s,a=!1){this.text=new Xv(e?e.text:null,i,r,s),this.icon=new Xv(e?e.icon:null,i,n,s),this.clipped=a}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class my{constructor(e,i,r,n=!1){this.text=e,this.icon=i,this.skipFade=r,this.clipped=n}}class JE{constructor(){this.invProjMatrix=ce.create(),this.viewportMatrix=ce.create(),this.circles=[]}}class $E{constructor(e,i,r,n,s){this.bucketInstanceId=e,this.featureIndex=i,this.sourceLayerIndex=r,this.bucketIndex=n,this.tileID=s}}class eM{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const i=++this.maxGroupID;this.collisionGroups[e]={ID:i,predicate:r=>r.collisionGroupID===i}}return this.collisionGroups[e]}}function Yv(t,e,i,r,n){const{horizontalAlign:s,verticalAlign:a}=Dm(t),c=-(s-.5)*e,p=-(a-.5)*i,_=zg(t,r);return new ct(c+_[0]*n,p+_[1]*n)}function _y(t,e,i,r,n){const s=new ct(t,e);return i&&s._rotate(r?n:-n),s}class tM{constructor(e,i,r,n,s,a){this.transform=e.clone(),this.projection=e.projection.name,this.collisionIndex=new YE(this.transform,s),this.buildingIndex=a,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=i,this.retainedQueryData={},this.collisionGroups=new eM(r),this.collisionCircleArrays={},this.prevPlacement=n,n&&(n.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(e,i,r,n){const s=r.getBucket(i),a=r.latestFeatureIndex;if(!s||!a||i.fqid!==s.layerIds[0])return;const c=s.layers[0].layout,p=r.collisionBoxArray,_=Math.pow(2,this.transform.zoom-r.tileID.overscaledZ),v=r.tileSize/Mt,E=r.tileID.toUnwrapped();this.transform.setProjection(s.projection);const C=(B=r.tileID,O=s.getProjection(),G=this.transform,O.name===this.projection?G.calculateProjMatrix(B.toUnwrapped()):dy(G,O,B));var B,O,G;const q=c.get("text-pitch-alignment")==="map",X=c.get("text-rotation-alignment")==="map";i.compileFilter();const $=i.dynamicFilter(),re=i.dynamicFilterNeedsFeature(),ne=this.transform.calculatePixelsToTileUnitsMatrix(r),ie=wx(C,r.tileID.canonical,q,X,this.transform,s.getProjection(),ne);let se=null;if(q){const be=Tx(C,r.tileID.canonical,q,X,this.transform,s.getProjection(),ne);se=ce.multiply([],this.transform.labelPlaneMatrix,be)}let he=null;$&&r.latestFeatureIndex&&(he={unwrappedTileID:E,dynamicFilter:$,dynamicFilterNeedsFeature:re,featureIndex:r.latestFeatureIndex}),this.retainedQueryData[s.bucketInstanceId]=new $E(s.bucketInstanceId,a,s.sourceLayerIndex,s.index,r.tileID);const ve={bucket:s,layout:c,posMatrix:C,textLabelPlaneMatrix:ie,labelToScreenMatrix:se,clippingData:he,scale:_,textPixelRatio:v,holdingForFade:r.holdingForFade(),collisionBoxArray:p,partiallyEvaluatedTextSize:xu(s.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:xu(s.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(s.sourceID)};if(n)for(const be of s.sortKeyRanges){const{sortKey:De,symbolInstanceStart:Ve,symbolInstanceEnd:je}=be;e.push({sortKey:De,symbolInstanceStart:Ve,symbolInstanceEnd:je,parameters:ve})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:s.symbolInstances.length,parameters:ve})}attemptAnchorPlacement(e,i,r,n,s,a,c,p,_,v,E,C,B,O,G,q,X,$){const{textOffset0:re,textOffset1:ne,crossTileID:ie}=C,se=[re,ne],he=Yv(e,r,n,se,s),ve=this.collisionIndex.placeCollisionBox(O,s,i,_y(he.x,he.y,a,c,this.transform.angle),E,p,_,v.predicate);if(q){const be=O.getSymbolInstanceIconSize($,this.transform.zoom,C.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(O,be,q,_y(he.x,he.y,a,c,this.transform.angle),E,p,_,v.predicate).box.length===0)return}if(ve.box.length>0){let be;return this.prevPlacement&&this.prevPlacement.variableOffsets[ie]&&this.prevPlacement.placements[ie]&&this.prevPlacement.placements[ie].text&&(be=this.prevPlacement.variableOffsets[ie].anchor),this.variableOffsets[ie]={textOffset:se,width:r,height:n,anchor:e,textScale:s,prevAnchor:be},this.markUsedJustification(O,e,C,G),O.allowVerticalPlacement&&(this.markUsedOrientation(O,G,C),this.placedOrientations[ie]=G),{shift:he,placedGlyphBoxes:ve}}}placeLayerBucketPart(e,i,r,n){const{bucket:s,layout:a,posMatrix:c,textLabelPlaneMatrix:p,labelToScreenMatrix:_,clippingData:v,textPixelRatio:E,holdingForFade:C,collisionBoxArray:B,partiallyEvaluatedTextSize:O,partiallyEvaluatedIconSize:G,collisionGroup:q}=e.parameters,X=a.get("text-optional"),$=a.get("icon-optional"),re=a.get("text-allow-overlap"),ne=a.get("icon-allow-overlap"),ie=a.get("text-rotation-alignment")==="map",se=a.get("text-pitch-alignment")==="map",he=a.get("symbol-z-order")==="viewport-y",ve=a.get("symbol-z-elevate");this.transform.setProjection(s.projection);let be=re&&(ne||!s.hasIconData()||$),De=ne&&(re||!s.hasTextData()||X);!s.collisionArrays&&B&&s.deserializeCollisionBoxes(B),r&&n&&s.updateCollisionDebugBuffers(this.transform.zoom,B);const Ve=(je,Je,Fe)=>{const{crossTileID:nt,numVerticalGlyphVertices:At}=je;if(v){const cr={zoom:this.transform.zoom,pitch:this.transform.pitch};let rr=null;if(v.dynamicFilterNeedsFeature){const Hi=this.retainedQueryData[s.bucketInstanceId];rr=v.featureIndex.loadFeature({featureIndex:je.featureIndex,bucketIndex:Hi.bucketIndex,sourceLayerIndex:Hi.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,v.dynamicFilter)(cr,rr,this.retainedQueryData[s.bucketInstanceId].tileID.canonical,new ct(je.tileAnchorX,je.tileAnchorY),this.transform.calculateDistanceTileData(v.unwrappedTileID)))return this.placements[nt]=new my(!1,!1,!1,!0),void i.add(nt)}if(i.has(nt))return;if(C)return void(this.placements[nt]=new my(!1,!1,!1));let vt=!1,rt=!1,lt=!0,wt=!1,It=!1,St=null,Bt={box:null,offscreen:null,occluded:null},Ft={box:null,offscreen:null,occluded:null},jt=null,Dt=null,Yt=null,fi=0,di=0,vi=0;Fe.textFeatureIndex?fi=Fe.textFeatureIndex:je.useRuntimeCollisionCircles&&(fi=je.featureIndex),Fe.verticalTextFeatureIndex&&(di=Fe.verticalTextFeatureIndex);const bi=cr=>{cr.tileID=this.retainedQueryData[s.bucketInstanceId].tileID;const rr=this.transform.elevation;cr.elevation=je.zOffset+(rr?rr.getAtTileOffset(cr.tileID,cr.tileAnchorX,cr.tileAnchorY):0)},Ar=Fe.textBox;if(Ar){bi(Ar);const cr=Hi=>{let Zr=Ms.horizontal;if(s.allowVerticalPlacement&&!Hi&&this.prevPlacement){const Kr=this.prevPlacement.placedOrientations[nt];Kr&&(this.placedOrientations[nt]=Kr,Zr=Kr,this.markUsedOrientation(s,Zr,je))}return Zr},rr=(Hi,Zr)=>{if(s.allowVerticalPlacement&&At>0&&Fe.verticalTextBox){for(const Kr of s.writingModes)if(Kr===Ms.vertical?(Bt=Zr(),Ft=Bt):Bt=Hi(),Bt&&Bt.box&&Bt.box.length)break}else Bt=Hi()};if(a.get("text-variable-anchor")){let Hi=a.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[nt]){const zr=this.prevPlacement.variableOffsets[nt];Hi.indexOf(zr.anchor)>0&&(Hi=Hi.filter(Gn=>Gn!==zr.anchor),Hi.unshift(zr.anchor))}const Zr=(zr,Gn,ao)=>{const On=s.getSymbolInstanceTextSize(O,je,this.transform.zoom,Je),ds=(zr.x2-zr.x1)*On+2*zr.padding,go=(zr.y2-zr.y1)*On+2*zr.padding,lo=je.hasIconTextFit&&!ne?Gn:null;lo&&bi(lo);let vs={box:[],offscreen:!1,occluded:!1};const Ln=re?2*Hi.length:Hi.length;for(let Ua=0;Ua<Ln;++Ua){const Mu=this.attemptAnchorPlacement(Hi[Ua%Hi.length],zr,ds,go,On,ie,se,E,c,q,Ua>=Hi.length,je,Je,s,ao,lo,O,G);if(Mu&&(vs=Mu.placedGlyphBoxes,vs&&vs.box&&vs.box.length)){vt=!0,St=Mu.shift;break}}return vs};rr(()=>Zr(Ar,Fe.iconBox,Ms.horizontal),()=>{const zr=Fe.verticalTextBox;return zr&&bi(zr),s.allowVerticalPlacement&&!(Bt&&Bt.box&&Bt.box.length)&&At>0&&zr?Zr(zr,Fe.verticalIconBox,Ms.vertical):{box:null,offscreen:null,occluded:null}}),Bt&&(vt=Bt.box,lt=Bt.offscreen,wt=Bt.occluded);const Kr=cr(!(!Bt||!Bt.box));if(!vt&&this.prevPlacement){const zr=this.prevPlacement.variableOffsets[nt];zr&&(this.variableOffsets[nt]=zr,this.markUsedJustification(s,zr.anchor,je,Kr))}}else{const Hi=(Zr,Kr)=>{const zr=s.getSymbolInstanceTextSize(O,je,this.transform.zoom,Je),Gn=this.collisionIndex.placeCollisionBox(s,zr,Zr,new ct(0,0),re,E,c,q.predicate);return Gn&&Gn.box&&Gn.box.length&&(this.markUsedOrientation(s,Kr,je),this.placedOrientations[nt]=Kr),Gn};rr(()=>Hi(Ar,Ms.horizontal),()=>{const Zr=Fe.verticalTextBox;return s.allowVerticalPlacement&&At>0&&Zr?(bi(Zr),Hi(Zr,Ms.vertical)):{box:null,offscreen:null,occluded:null}}),cr(!!(Bt&&Bt.box&&Bt.box.length))}}if(jt=Bt,vt=jt&&jt.box&&jt.box.length>0,lt=jt&&jt.offscreen,wt=jt&&jt.occluded,je.useRuntimeCollisionCircles){const cr=s.text.placedSymbolArray.get(je.centerJustifiedTextSymbolIndex>=0?je.centerJustifiedTextSymbolIndex:je.verticalPlacedTextSymbolIndex),rr=z0(s.textSizeData,O,cr),Hi=a.get("text-padding");Dt=this.collisionIndex.placeCollisionCircles(s,re,cr,s.lineVertexArray,s.glyphOffsetArray,rr,c,p,_,r,se,q.predicate,je.collisionCircleDiameter*rr/va,Hi,this.retainedQueryData[s.bucketInstanceId].tileID),vt=re||Dt.circles.length>0&&!Dt.collisionDetected,lt=lt&&Dt.offscreen,wt=Dt.occluded}if(Fe.iconFeatureIndex&&(vi=Fe.iconFeatureIndex),Fe.iconBox){const cr=rr=>{bi(rr);const Hi=je.hasIconTextFit&&St?_y(St.x,St.y,ie,se,this.transform.angle):new ct(0,0),Zr=s.getSymbolInstanceIconSize(G,this.transform.zoom,je.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(s,Zr,rr,Hi,ne,E,c,q.predicate)};Ft&&Ft.box&&Ft.box.length&&Fe.verticalIconBox?(Yt=cr(Fe.verticalIconBox),rt=Yt.box.length>0):(Yt=cr(Fe.iconBox),rt=Yt.box.length>0),lt=lt&&Yt.offscreen,It=Yt.occluded}const Ni=X||je.numHorizontalGlyphVertices===0&&At===0,rn=$||je.numIconVertices===0;if(Ni||rn?rn?Ni||(rt=rt&&vt):vt=rt&&vt:rt=vt=rt&&vt,vt&&jt&&jt.box&&this.collisionIndex.insertCollisionBox(jt.box,a.get("text-ignore-placement"),s.bucketInstanceId,Ft&&Ft.box&&di?di:fi,q.ID),rt&&Yt&&this.collisionIndex.insertCollisionBox(Yt.box,a.get("icon-ignore-placement"),s.bucketInstanceId,vi,q.ID),Dt&&(vt&&this.collisionIndex.insertCollisionCircles(Dt.circles,a.get("text-ignore-placement"),s.bucketInstanceId,fi,q.ID),r)){const cr=s.bucketInstanceId;let rr=this.collisionCircleArrays[cr];rr===void 0&&(rr=this.collisionCircleArrays[cr]=new JE);for(let Hi=0;Hi<Dt.circles.length;Hi+=4)rr.circles.push(Dt.circles[Hi+0]),rr.circles.push(Dt.circles[Hi+1]),rr.circles.push(Dt.circles[Hi+2]),rr.circles.push(Dt.collisionDetected?1:0)}const Vr=s.projection.name!=="globe";be=be&&(Vr||!wt),De=De&&(Vr||!It),this.placements[nt]=new my(vt||be,rt||De,lt||s.justReloaded),i.add(nt)};if(ve&&this.buildingIndex&&(this.buildingIndex.updateZOffset(s,this.retainedQueryData[s.bucketInstanceId].tileID),s.updateZOffset()),he){const je=s.getSortedSymbolIndexes(this.transform.angle);for(let Je=je.length-1;Je>=0;--Je){const Fe=je[Je];Ve(s.symbolInstances.get(Fe),Fe,s.collisionArrays[Fe])}s.hasAnyZOffset&&Be(`${s.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(s.hasAnyZOffset){const je=s.getSortedIndexesByZOffset();for(let Je=0;Je<je.length;++Je){const Fe=je[Je];Ve(s.symbolInstances.get(Fe),Fe,s.collisionArrays[Fe])}}else for(let je=e.symbolInstanceStart;je<e.symbolInstanceEnd;je++)Ve(s.symbolInstances.get(je),je,s.collisionArrays[je]);if(r&&s.bucketInstanceId in this.collisionCircleArrays){const je=this.collisionCircleArrays[s.bucketInstanceId];ce.invert(je.invProjMatrix,c),je.viewportMatrix=this.collisionIndex.getViewportMatrix()}s.justReloaded=!1}markUsedJustification(e,i,r,n){const{leftJustifiedTextSymbolIndex:s,centerJustifiedTextSymbolIndex:a,rightJustifiedTextSymbolIndex:c,verticalPlacedTextSymbolIndex:p,crossTileID:_}=r,v=Bg(i),E=n===Ms.vertical?p:v==="left"?s:v==="center"?a:v==="right"?c:-1;s>=0&&(e.text.placedSymbolArray.get(s).crossTileID=E>=0&&s!==E?0:_),a>=0&&(e.text.placedSymbolArray.get(a).crossTileID=E>=0&&a!==E?0:_),c>=0&&(e.text.placedSymbolArray.get(c).crossTileID=E>=0&&c!==E?0:_),p>=0&&(e.text.placedSymbolArray.get(p).crossTileID=E>=0&&p!==E?0:_)}markUsedOrientation(e,i,r){const n=i===Ms.horizontal||i===Ms.horizontalOnly?i:0,s=i===Ms.vertical?i:0,{leftJustifiedTextSymbolIndex:a,centerJustifiedTextSymbolIndex:c,rightJustifiedTextSymbolIndex:p,verticalPlacedTextSymbolIndex:_}=r,v=e.text.placedSymbolArray;a>=0&&(v.get(a).placedOrientation=n),c>=0&&(v.get(c).placedOrientation=n),p>=0&&(v.get(p).placedOrientation=n),_>=0&&(v.get(_).placedOrientation=s)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const i=this.prevPlacement;let r=!1;this.prevZoomAdjustment=i?i.zoomAdjustment(this.transform.zoom):0;const n=i?i.symbolFadeChange(e):1,s=i?i.opacities:{},a=i?i.variableOffsets:{},c=i?i.placedOrientations:{};for(const p in this.placements){const _=this.placements[p],v=s[p];v?(this.opacities[p]=new tp(v,n,_.text,_.icon,null,_.clipped),r=r||_.text!==v.text.placed||_.icon!==v.icon.placed):(this.opacities[p]=new tp(null,n,_.text,_.icon,_.skipFade,_.clipped),r=r||_.text||_.icon)}for(const p in s){const _=s[p];if(!this.opacities[p]){const v=new tp(_,n,!1,!1);v.isHidden()||(this.opacities[p]=v,r=r||_.text.placed||_.icon.placed)}}for(const p in a)this.variableOffsets[p]||!this.opacities[p]||this.opacities[p].isHidden()||(this.variableOffsets[p]=a[p]);for(const p in c)this.placedOrientations[p]||!this.opacities[p]||this.opacities[p].isHidden()||(this.placedOrientations[p]=c[p]);r?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=i?i.lastPlacementChangeTime:e)}updateLayerOpacities(e,i){const r=new Set;for(const n of i){const s=n.getBucket(e);s&&n.latestFeatureIndex&&e.fqid===s.layerIds[0]&&(this.updateBucketOpacities(s,r,n.collisionBoxArray),s.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(s,n.tileID),s.updateZOffset()))}}updateBucketOpacities(e,i,r){e.hasTextData()&&e.text.opacityVertexArray.clear(),e.hasIconData()&&e.icon.opacityVertexArray.clear(),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const n=e.layers[0].layout,s=!!e.layers[0].dynamicFilter(),a=new tp(null,0,!1,!1,!0),c=n.get("text-allow-overlap"),p=n.get("icon-allow-overlap"),_=n.get("text-variable-anchor"),v=n.get("text-rotation-alignment")==="map",E=n.get("text-pitch-alignment")==="map",C=new tp(null,0,c&&(p||!e.hasIconData()||n.get("icon-optional")),p&&(c||!e.hasTextData()||n.get("text-optional")),!0);!e.collisionArrays&&r&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(r);const B=(G,q,X)=>{for(let $=0;$<q/4;$++)G.opacityVertexArray.emplaceBack(X)};let O=0;for(let G=0;G<e.symbolInstances.length;G++){const q=e.symbolInstances.get(G),{numHorizontalGlyphVertices:X,numVerticalGlyphVertices:$,crossTileID:re,numIconVertices:ne}=q,ie=i.has(re);let se=this.opacities[re];ie?se=a:se||(se=C,this.opacities[re]=se),i.add(re);const he=X>0||$>0,ve=ne>0,be=this.placedOrientations[re],De=be===Ms.vertical,Ve=be===Ms.horizontal||be===Ms.horizontalOnly;if(!he&&!ve||se.isHidden()||O++,he){const je=Kv(se.text);B(e.text,X,De?u_:je),B(e.text,$,Ve?u_:je);const Je=se.text.isHidden(),{leftJustifiedTextSymbolIndex:Fe,centerJustifiedTextSymbolIndex:nt,rightJustifiedTextSymbolIndex:At,verticalPlacedTextSymbolIndex:vt}=q,rt=e.text.placedSymbolArray,lt=Je||De?1:0;Fe>=0&&(rt.get(Fe).hidden=lt),nt>=0&&(rt.get(nt).hidden=lt),At>=0&&(rt.get(At).hidden=lt),vt>=0&&(rt.get(vt).hidden=Je||Ve?1:0);const wt=this.variableOffsets[re];wt&&this.markUsedJustification(e,wt.anchor,q,be);const It=this.placedOrientations[re];It&&(this.markUsedJustification(e,"left",q,It),this.markUsedOrientation(e,It,q))}if(ve){const je=Kv(se.icon),{placedIconSymbolIndex:Je,verticalPlacedIconSymbolIndex:Fe}=q,nt=e.icon.placedSymbolArray,At=se.icon.isHidden()?1:0;Je>=0&&(B(e.icon,ne,De?u_:je),nt.get(Je).hidden=At),Fe>=0&&(B(e.icon,q.numVerticalIconVertices,Ve?u_:je),nt.get(Fe).hidden=At)}if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const je=e.collisionArrays[G];if(je){let Je=new ct(0,0),Fe=!0;if(je.textBox||je.verticalTextBox){if(_){const At=this.variableOffsets[re];At?(Je=Yv(At.anchor,At.width,At.height,At.textOffset,At.textScale),v&&Je._rotate(E?this.transform.angle:-this.transform.angle)):Fe=!1}s&&(Fe=!se.clipped),je.textBox&&c_(e.textCollisionBox.collisionVertexArray,se.text.placed,!Fe||De,Je.x,Je.y),je.verticalTextBox&&c_(e.textCollisionBox.collisionVertexArray,se.text.placed,!Fe||Ve,Je.x,Je.y)}const nt=Fe&&!!(!Ve&&je.verticalIconBox);je.iconBox&&c_(e.iconCollisionBox.collisionVertexArray,se.icon.placed,nt,q.hasIconTextFit?Je.x:0,q.hasIconTextFit?Je.y:0),je.verticalIconBox&&c_(e.iconCollisionBox.collisionVertexArray,se.icon.placed,!nt,q.hasIconTextFit?Je.x:0,q.hasIconTextFit?Je.y:0)}}}if(e.fullyClipped=O===0,e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.bucketInstanceId in this.collisionCircleArrays){const G=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=G.invProjMatrix,e.placementViewportMatrix=G.viewportMatrix,e.collisionCircleArray=G.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,i){const r=this.zoomAtLastRecencyCheck===i?1-this.zoomAdjustment(i):1;return this.zoomAtLastRecencyCheck=i,this.commitTime+this.fadeDuration*r>e}setStale(){this.stale=!0}}function c_(t,e,i,r,n){t.emplaceBack(e?1:0,i?1:0,r||0,n||0),t.emplaceBack(e?1:0,i?1:0,r||0,n||0),t.emplaceBack(e?1:0,i?1:0,r||0,n||0),t.emplaceBack(e?1:0,i?1:0,r||0,n||0)}const iM=Math.pow(2,25),rM=Math.pow(2,24),nM=Math.pow(2,17),sM=Math.pow(2,16),oM=Math.pow(2,9),aM=Math.pow(2,8),lM=Math.pow(2,1);function Kv(t){if(t.opacity===0&&!t.placed)return 0;if(t.opacity===1&&t.placed)return 4294967295;const e=t.placed?1:0,i=Math.floor(127*t.opacity);return i*iM+e*rM+i*nM+e*sM+i*oM+e*aM+i*lM+e}const u_=0;class AM{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&e.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(e,i,r,n,s){const a=this._bucketParts;for(;this._currentTileIndex<e.length;)if(i.getBucketParts(a,n,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,s())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,a.sort((c,p)=>c.sortKey-p.sortKey));this._currentPartIndex<a.length;){const c=a[this._currentPartIndex];if(i.placeLayerBucketPart(c,this._seenCrossTileIDs,r,c.symbolInstanceStart===0),this._currentPartIndex++,s())return!0}return!1}}class cM{constructor(e,i,r,n,s,a,c,p,_){this.placement=new tM(e,s,a,c,p,_),this._currentPlacementIndex=i.length-1,this._forceFullPlacement=r,this._showCollisionBoxes=n,this._done=!1}isDone(){return this._done}continuePlacement(e,i,r,n){const s=Wi.now(),a=()=>{const c=Wi.now()-s;return!this._forceFullPlacement&&c>2};for(;this._currentPlacementIndex>=0;){const c=i[e[this._currentPlacementIndex]],p=this.placement.collisionIndex.transform.zoom;if(c.type==="symbol"&&(!c.minzoom||c.minzoom<=p)&&(!c.maxzoom||c.maxzoom>p)){const _=c,v=_.layout.get("symbol-z-elevate"),E=this._inProgressLayer=this._inProgressLayer||new AM(_),C=Zo(c.source,c.scope);if(E.continuePlacement(v?n[C]:r[C],this.placement,this._showCollisionBoxes,c,a))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const Jv=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class h_{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,r]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const n=r>>4;if(n!==1)throw new Error(`Got v${n} data when expected v1.`);const s=Jv[15&r];if(!s)throw new Error("Unrecognized array type.");const[a]=new Uint16Array(e,2,1),[c]=new Uint32Array(e,4,1);return new h_(c,a,s,e)}constructor(e,i=64,r=Float64Array,n){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=r,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const s=Jv.indexOf(this.ArrayType),a=2*e*this.ArrayType.BYTES_PER_ELEMENT,c=e*this.IndexArrayType.BYTES_PER_ELEMENT,p=(8-c%8)%8;if(s<0)throw new Error(`Unexpected typed array class: ${r}.`);n&&n instanceof ArrayBuffer?(this.data=n,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+c+p,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+a+c+p),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+c+p,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+s]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const r=this._pos>>1;return this.ids[r]=r,this.coords[this._pos++]=e,this.coords[this._pos++]=i,r}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return gy(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,r,n){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:s,coords:a,nodeSize:c}=this,p=[0,s.length-1,0],_=[];for(;p.length;){const v=p.pop()||0,E=p.pop()||0,C=p.pop()||0;if(E-C<=c){for(let q=C;q<=E;q++){const X=a[2*q],$=a[2*q+1];X>=e&&X<=r&&$>=i&&$<=n&&_.push(s[q])}continue}const B=C+E>>1,O=a[2*B],G=a[2*B+1];O>=e&&O<=r&&G>=i&&G<=n&&_.push(s[B]),(v===0?e<=O:i<=G)&&(p.push(C),p.push(B-1),p.push(1-v)),(v===0?r>=O:n>=G)&&(p.push(B+1),p.push(E),p.push(1-v))}return _}within(e,i,r){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:n,coords:s,nodeSize:a}=this,c=[0,n.length-1,0],p=[],_=r*r;for(;c.length;){const v=c.pop()||0,E=c.pop()||0,C=c.pop()||0;if(E-C<=a){for(let q=C;q<=E;q++)eb(s[2*q],s[2*q+1],e,i)<=_&&p.push(n[q]);continue}const B=C+E>>1,O=s[2*B],G=s[2*B+1];eb(O,G,e,i)<=_&&p.push(n[B]),(v===0?e-r<=O:i-r<=G)&&(c.push(C),c.push(B-1),c.push(1-v)),(v===0?e+r>=O:i+r>=G)&&(c.push(B+1),c.push(E),c.push(1-v))}return p}}function gy(t,e,i,r,n,s){if(n-r<=i)return;const a=r+n>>1;$v(t,e,a,r,n,s),gy(t,e,i,r,a-1,1-s),gy(t,e,i,a+1,n,1-s)}function $v(t,e,i,r,n,s){for(;n>r;){if(n-r>600){const _=n-r+1,v=i-r+1,E=Math.log(_),C=.5*Math.exp(2*E/3),B=.5*Math.sqrt(E*C*(_-C)/_)*(v-_/2<0?-1:1);$v(t,e,i,Math.max(r,Math.floor(i-v*C/_+B)),Math.min(n,Math.floor(i+(_-v)*C/_+B)),s)}const a=e[2*i+s];let c=r,p=n;for(ip(t,e,r,i),e[2*n+s]>a&&ip(t,e,r,n);c<p;){for(ip(t,e,c,p),c++,p--;e[2*c+s]<a;)c++;for(;e[2*p+s]>a;)p--}e[2*r+s]===a?ip(t,e,r,p):(p++,ip(t,e,p,n)),p<=i&&(r=p+1),i<=p&&(n=p-1)}}function ip(t,e,i,r){yy(t,i,r),yy(e,2*i,2*r),yy(e,2*i+1,2*r+1)}function yy(t,e,i){const r=t[e];t[e]=t[i],t[i]=r}function eb(t,e,i,r){const n=t-i,s=e-r;return n*n+s*s}const xy=512/Mt/2;class uM{constructor(e,i,r){this.tileID=e,this.bucketInstanceId=r,this.index=new h_(i.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const n=e.canonical.x*Mt,s=e.canonical.y*Mt;for(let a=0;a<i.length;a++){const{key:c,crossTileID:p,tileAnchorX:_,tileAnchorY:v}=i.get(a),E=Math.floor((n+_)*xy),C=Math.floor((s+v)*xy);this.index.add(E,C),this.keys.push(c),this.crossTileIDs.push(p)}this.index.finish()}findMatches(e,i,r){const n=this.tileID.canonical.z<i.canonical.z?1:Math.pow(2,this.tileID.canonical.z-i.canonical.z),s=xy/Math.pow(2,i.canonical.z-this.tileID.canonical.z),a=i.canonical.x*Mt,c=i.canonical.y*Mt;for(let p=0;p<e.length;p++){const _=e.get(p);if(_.crossTileID)continue;const{key:v,tileAnchorX:E,tileAnchorY:C}=_,B=Math.floor((a+E)*s),O=Math.floor((c+C)*s),G=this.index.range(B-n,O-n,B+n,O+n);for(const q of G){const X=this.crossTileIDs[q];if(this.keys[q]===v&&!r.has(X)){r.add(X),_.crossTileID=X;break}}}}}class hM{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class fM{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const i=Math.round((e-this.lng)/360);if(i!==0)for(const r in this.indexes){const n=this.indexes[r],s={};for(const a in n){const c=n[a];c.tileID=c.tileID.unwrapTo(c.tileID.wrap+i),s[c.tileID.key]=c}this.indexes[r]=s}this.lng=e}addBucket(e,i,r){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===i.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let s=0;s<i.symbolInstances.length;s++)i.symbolInstances.get(s).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]=new Set);const n=this.usedCrossTileIDs[e.overscaledZ];for(const s in this.indexes){const a=this.indexes[s];if(Number(s)>e.overscaledZ)for(const c in a){const p=a[c];p.tileID.isChildOf(e)&&p.findMatches(i.symbolInstances,e,n)}else{const c=a[e.scaledTo(Number(s)).key];c&&c.findMatches(i.symbolInstances,e,n)}}for(let s=0;s<i.symbolInstances.length;s++){const a=i.symbolInstances.get(s);a.crossTileID||(a.crossTileID=r.generate(),n.add(a.crossTileID))}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new uM(e,i.symbolInstances,i.bucketInstanceId),!0}removeBucketCrossTileIDs(e,i){for(const r of i.crossTileIDs)this.usedCrossTileIDs[e].delete(r)}removeStaleBuckets(e){let i=!1;for(const r in this.indexes){const n=this.indexes[r];for(const s in n)e[n[s].bucketInstanceId]||(this.removeBucketCrossTileIDs(r,n[s]),delete n[s],i=!0)}return i}}class dM{constructor(){this.layerIndexes={},this.crossTileIDs=new hM,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,i,r,n){let s=this.layerIndexes[e.fqid];s===void 0&&(s=this.layerIndexes[e.fqid]=new fM);let a=!1;const c={};n.name!=="globe"&&s.handleWrapJump(r);for(const p of i){const _=p.getBucket(e);_&&e.fqid===_.layerIds[0]&&(_.bucketInstanceId||(_.bucketInstanceId=++this.maxBucketInstanceId),s.addBucket(p.tileID,_,this.crossTileIDs)&&(a=!0),c[_.bucketInstanceId]=!0)}return s.removeStaleBuckets(c)&&(a=!0),a}pruneUnusedLayers(e){const i={};e.forEach(r=>{i[r]=!0});for(const r in this.layerIndexes)i[r]||delete this.layerIndexes[r]}}var tb=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w-0.0001;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,ib="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",rb=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture(u_depth,uv-df.xz)),unpack_depth(texture(u_depth,uv+df.xz)),unpack_depth(texture(u_depth,uv-df.zy)),unpack_depth(texture(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,nb=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,sb=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,ob=`#ifdef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);vec4 _raTexLinearCoord(vec2 texCoord,vec2 texResolution,out vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return (texCoord.xxyy+vec2(1.5,0.5).xyxy)/texResolution.xxyy;}vec2 _raTexLinearMix(vec2 fxy,vec4 colorMix,float colorOffset,vec4 t00,vec4 t10,vec4 t01,vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(vec2 texCoord,vec2 texResolution,vec4 colorMix,float colorOffset) {vec2 fxy;vec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texture(u_image0,c.yz),texture(u_image0,c.xz),texture(u_image0,c.yw),texture(u_image0,c.xw)
);}vec2 raTexture2D_image1_linear(vec2 texCoord,vec2 texResolution,vec4 colorMix,float colorOffset) {vec2 fxy;vec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texture(u_image1,c.yz),texture(u_image1,c.xz),texture(u_image1,c.yw),texture(u_image1,c.xw)
);}vec2 raTexture2D_image0_nearest(vec2 texCoord,vec2 texResolution,vec4 colorMix,float colorOffset) {vec4 t=texture(u_image0,texCoord);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(vec2 texCoord,vec2 texResolution,vec4 colorMix,float colorOffset) {vec4 t=texture(u_image1,texCoord);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,ab=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,lb=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef NATIVE
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Ab=[];p_(tb,Ab);const f_={"_prelude_fog.vertex.glsl":nb,"_prelude_terrain.vertex.glsl":rb,"_prelude_shadow.vertex.glsl":ab,"_prelude_fog.fragment.glsl":sb,"_prelude_shadow.fragment.glsl":lb,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":ob},d_={};In("",rb),In(sb,nb),In(lb,ab),In(ob,"");const cb=In(`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif`,`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`),ub=tb;var hb={background:In(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:In(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:In(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:In("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:In(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:In(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:In("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:In("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:In("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:In(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:In(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:In(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in vec2 v_pos;in vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;out vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:In(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:In(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
uniform float u_emissive_strength;in float v_height;void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,v_depth);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef RENDER_CUTOFF
color*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
#ifdef RENDER_CUTOFF
invariant gl_Position;
#endif
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),fillExtrusionDepth:In(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:In(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
out vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:In(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,v_depth));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);v_depth=gl_Position.w;
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:In(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;HANDLE_WIREFRAME_DEBUG;
#endif
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;
#ifdef FORCE_ABS_FL_GROUND_RADIUS
fl_ground_radius=abs(flood_light_ground_radius);
#endif
float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:In(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:In(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:In(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trimmed,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:In(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture(u_image,pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting_ground(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:In(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform vec4 u_tl_br;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#elif defined(PROJECTION_GLOBE_VIEW)
in vec2 a_pos;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec2 globe_tl=vec2(u_tl_br.x,u_tl_br.y);vec2 globe_br=vec2(u_tl_br.z,u_tl_br.w);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=1.0-((mercatorY-globe_br.y)/(globe_tl.y-globe_br.y));float mercatorX=mercatorXfromLng(latLng[1]);float uvX=(mercatorX-globe_br.x)/(globe_tl.x-globe_br.x);vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);uv=vec2(uvX,uvY);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
uv=a_texture_pos/8192.0;
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),symbolIcon:In(`#include "_prelude_lighting.glsl"
uniform sampler2D u_texture;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
in float v_fade_opacity;in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
uniform mediump float u_icon_saturation;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
lowp float alpha=opacity*v_fade_opacity;vec4 out_color;
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b)*alpha;
#else
out_color=texture(u_texture,v_tex_a)*alpha;
#endif
#ifdef SATURATION
vec3 luma=vec3(dot(out_color.rgb,vec3(0.2126,0.7152,0.0722)));out_color.rgb=mix(luma,out_color.rgb,u_icon_saturation);
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
v_tex_a=a_tex/u_texsize;
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
v_fade_opacity=out_fade_opacity;}`),symbolSDF:In(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}`),symbolTextAndIcon:In(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}`),terrainRaster:In(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,v_depth,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:In("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:In(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,ib),skyboxGradient:In(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,ib),skyboxCapture:In(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:In(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:In(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:In(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture(u_depthTexture,coord));return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
texColor.rgb=sRGBToLinear(texColor.rgb);if(u_baseTextureIsAlpha) {if (texColor.w < 0.5) {discard;}albedo*=mix(vec4(texColor.rgb,texColor.a),vec4(texColor.a),float(u_baseTextureIsAlpha));} else {albedo*=texColor;}
#endif
return vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 diffuse=getDiffuseShadedColor(getBaseColor().rgb,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(diffuse,1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
ao=(texture(u_occlusionTexture,uv_2f).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);color=mix(color,v_color_mix.rgb,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=u_matrix*pos;pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=local_pos;
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1);v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:In(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=u_matrix*pos;
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:In(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`)};function p_(t,e){const i=t.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let r of i)if(r=r.trim(),r[0]==="#"&&r.includes("if")&&!r.includes("endif")){r=r.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const n=r.split(" ");for(const s of n)e.includes(s)||e.push(s)}}function In(t,e){const i=/#include\s+"([^"]+)"/g,r=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let n=e.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);n&&(n=n.map(_=>{const v=_.split(" ");return v[v.length-1]}),n=[...new Set(n)]);const s={},a=[],c=[];t=t.replace(i,(_,v)=>(c.push(v),"")),e=e.replace(i,(_,v)=>(a.push(v),""));let p=[...Ab];p_(t,p),p_(e,p);for(const _ of[...a,...c])f_[_]||console.error(`Undefined include: ${_}`),d_[_]||(d_[_]=[],p_(f_[_],d_[_])),p=[...p,...d_[_]];return{fragmentSource:t=t.replace(r,(_,v,E,C,B)=>(s[B]=!0,v==="define"?`
#ifndef HAS_UNIFORM_u_${B}
in ${E} ${C} ${B};
#else
uniform ${E} ${C} u_${B};
#endif
`:v==="initialize"?`
#ifdef HAS_UNIFORM_u_${B}
    ${E} ${C} ${B} = u_${B};
#endif
`:v==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${B}
    in ${E} ${C} ${B};
#endif
`:v==="initialize-attribute"?"":void 0)),vertexSource:e=e.replace(r,(_,v,E,C,B)=>{const O=C==="float"?"vec2":C,G=B.match(/color/)?"color":O;return v==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${B}
in ${E} ${C} a_${B};
#endif
`:s[B]?v==="define"?`
#ifndef HAS_UNIFORM_u_${B}
uniform lowp float u_${B}_t;
in ${E} ${O} a_${B};
out ${E} ${C} ${B};
#else
uniform ${E} ${C} u_${B};
#endif
`:v==="initialize"?G==="vec4"?`
#ifndef HAS_UNIFORM_u_${B}
    ${B} = a_${B};
#else
    ${E} ${C} ${B} = u_${B};
#endif
`:`
#ifndef HAS_UNIFORM_u_${B}
    ${B} = unpack_mix_${G}(a_${B}, u_${B}_t);
#else
    ${E} ${C} ${B} = u_${B};
#endif
`:v==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${B}
    in ${E} ${C} a_${B};
    out ${E} ${C} ${B};
#endif
`:v==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${B}
    ${B} = a_${B};
#endif
`:void 0:v==="define"?`
#ifndef HAS_UNIFORM_u_${B}
uniform lowp float u_${B}_t;
in ${E} ${O} a_${B};
#else
uniform ${E} ${C} u_${B};
#endif
`:v==="define-instanced"?G==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${B}0;
in vec4 a_${B}1;
in vec4 a_${B}2;
in vec4 a_${B}3;
#else
uniform ${E} ${C} u_${B};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${E} ${O} a_${B};
#else
uniform ${E} ${C} u_${B};
#endif
`:v==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${B}
    ${E} ${C} ${B} = a_${B};
#endif
`:G==="vec4"?`
#ifndef HAS_UNIFORM_u_${B}
    ${E} ${C} ${B} = a_${B};
#else
    ${E} ${C} ${B} = u_${B};
#endif
`:`
#ifndef HAS_UNIFORM_u_${B}
    ${E} ${C} ${B} = unpack_mix_${G}(a_${B}, u_${B}_t);
#else
    ${E} ${C} ${B} = u_${B};
#endif
`}),staticAttributes:n,usedDefines:p,vertexIncludes:a,fragmentIncludes:c}}class pM{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(e,i,r,n,s,a,c,p){this.context=e;let _=this.boundPaintVertexBuffers.length!==n.length;for(let E=0;!_&&E<n.length;E++)this.boundPaintVertexBuffers[E]!==n[E]&&(_=!0);let v=this.boundDynamicVertexBuffers.length!==c.length;for(let E=0;!v&&E<c.length;E++)this.boundDynamicVertexBuffers[E]!==c[E]&&(v=!0);if(!this.vao||this.boundProgram!==i||this.boundLayoutVertexBuffer!==r||_||v||this.boundIndexBuffer!==s||this.boundVertexOffset!==a)this.freshBind(i,r,n,s,a,c,p);else{e.bindVertexArrayOES.set(this.vao);for(const E of c)E&&(E.bind(),p&&E.instanceCount&&E.setVertexAttribDivisor(e.gl,i,p));s&&s.dynamicDraw&&s.bind()}}freshBind(e,i,r,n,s,a,c){const p=e.numAttributes,_=this.context,v=_.gl;this.vao&&this.destroy(),this.vao=_.gl.createVertexArray(),_.bindVertexArrayOES.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=i,this.boundPaintVertexBuffers=r,this.boundIndexBuffer=n,this.boundVertexOffset=s,this.boundDynamicVertexBuffers=a,i.enableAttributes(v,e),i.bind(),i.setVertexAttribPointers(v,e,s);for(const E of r)E.enableAttributes(v,e),E.bind(),E.setVertexAttribPointers(v,e,s);for(const E of a)E&&(E.enableAttributes(v,e),E.bind(),E.setVertexAttribPointers(v,e,s),c&&E.instanceCount&&E.setVertexAttribDivisor(v,e,c));n&&n.bind(),_.currentNumAttributes=p}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function mM(t,e){const i=Math.pow(2,e.canonical.z),r=e.canonical.y;return[new Wr(0,r/i).toLngLat().lat,new Wr(0,(r+1)/i).toLngLat().lat]}function _M(t,e,i,r,n,s,a){const c=t.context,p=c.gl,_=i.hillshadeFBO;if(!_)return;t.prepareDrawTile();const v=t.isTileAffectedByFog(e),E=t.getOrCreateProgram("hillshade",{overrideFog:v});c.activeTexture.set(p.TEXTURE0),p.bindTexture(p.TEXTURE_2D,_.colorAttachment.get());const C=((q,X,$,re)=>{const ne=$.paint.get("hillshade-shadow-color"),ie=$.paint.get("hillshade-highlight-color"),se=$.paint.get("hillshade-accent-color"),he=$.paint.get("hillshade-emissive-strength");let ve=wi($.paint.get("hillshade-illumination-direction"));if($.paint.get("hillshade-illumination-anchor")==="viewport")ve-=q.transform.angle;else if(q.style&&q.style.enable3dLights()&&q.style.directionalLight){const De=q.style.directionalLight.properties.get("direction");ve=wi(ti(De.x,De.y,De.z)[1])}const be=!q.options.moving;return{u_matrix:re||q.transform.calculateProjMatrix(X.tileID.toUnwrapped(),be),u_image:0,u_latrange:mM(0,X.tileID),u_light:[$.paint.get("hillshade-exaggeration"),ve],u_shadow:ne,u_highlight:ie,u_emissive_strength:he,u_accent:se}})(t,i,r,t.terrain?e.projMatrix:null);t.uploadCommonUniforms(c,E,e.toUnwrapped());const{tileBoundsBuffer:B,tileBoundsIndexBuffer:O,tileBoundsSegments:G}=t.getTileBoundsBuffers(i);E.draw(t,p.TRIANGLES,n,s,a,Fr.disabled,C,r.id,B,O,G)}function fb(t,e,i){if(!e.needsDEMTextureUpload)return;const r=t.context,n=r.gl;r.pixelStoreUnpackPremultiplyAlpha.set(!1),e.demTexture=e.demTexture||t.getTileTexture(i.stride);const s=i.getPixels();e.demTexture?e.demTexture.update(s,{premultiply:!1}):e.demTexture=new Bs(r,s,n.R32F,{premultiply:!1}),e.needsDEMTextureUpload=!1}function gM(t,e,i){const r=t.context,n=r.gl;if(!e.dem)return;const s=e.dem;if(r.activeTexture.set(n.TEXTURE1),fb(t,e,s),!e.demTexture)return;e.demTexture.bind(n.NEAREST,n.CLAMP_TO_EDGE);const a=s.dim;r.activeTexture.set(n.TEXTURE0);let c=e.hillshadeFBO;if(!c){const C=new Bs(r,{width:a,height:a,data:null},n.RGBA);C.bind(n.LINEAR,n.CLAMP_TO_EDGE),c=e.hillshadeFBO=r.createFramebuffer(a,a,!0,"renderbuffer"),c.colorAttachment.set(C.texture)}r.bindFramebuffer.set(c.framebuffer),r.viewport.set([0,0,a,a]);const{tileBoundsBuffer:p,tileBoundsIndexBuffer:_,tileBoundsSegments:v}=t.getMercatorTileBoundsBuffers(),E=[];t.linearFloatFilteringSupported()&&E.push("TERRAIN_DEM_FLOAT_FORMAT"),t.getOrCreateProgram("hillshadePrepare",{defines:E}).draw(t,n.TRIANGLES,lr.disabled,Br.disabled,An.unblended,Fr.disabled,((C,B)=>{const O=B.stride,G=ce.create();return ce.ortho(G,0,Mt,-Mt,0,0,1),ce.translate(G,G,[0,-Mt,0]),{u_matrix:G,u_image:1,u_dimension:[O,O],u_zoom:C.overscaledZ}})(e.tileID,s),i.id,p,_,v),e.needsHillshadePrepare=!1}const db=t=>({u_matrix:new xr(t),u_image0:new Oi(t),u_skirt_height:new ei(t),u_ground_shadow_factor:new Tr(t)}),pb=(t,e,i)=>({u_matrix:t,u_image0:0,u_skirt_height:e,u_ground_shadow_factor:i}),mb=(t,e,i,r,n,s,a,c,p,_,v,E,C,B,O)=>({u_proj_matrix:Float32Array.from(t),u_globe_matrix:e,u_normalize_matrix:Float32Array.from(r),u_merc_matrix:i,u_zoom_transition:n,u_merc_center:s,u_image0:0,u_frustum_tl:a,u_frustum_tr:c,u_frustum_br:p,u_frustum_bl:_,u_globe_pos:v,u_globe_radius:E,u_viewport:C,u_grid_matrix:O?Float32Array.from(O):new Float32Array(9),u_skirt_height:B}),md=(t,e)=>{if(e>0&&t.terrain&&Be("Cutoff is currently disabled on terrain"),e<=0||t.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,0]}};const i=t.transform,r=Math.max(Math.abs(i._zoom-(t.minCutoffZoom-1)),1),n=i.isLODDisabled(!1)?jr(60,45,i.pitch):jr(30,15,i.pitch),s=i._farZ-i._nearZ,a=e*i.height,c=((1-(p=n))*(.75*i.cameraToCenterDistance)+p*(i._farZ+a))*r;var p;return{shouldRenderCutoff:n<1,uniformValues:{u_cutoff_params:[i._nearZ,i._farZ,(c-i._nearZ)/s,(c-a-i._nearZ)/s]}}};function _b(t,e){return t!=null&&e!=null&&!(!t.hasData()||!e.hasData())&&t.demTexture!=null&&e.demTexture!=null&&t.tileID.key!==e.tileID.key}const _d=new class{constructor(){this.operations={}}newMorphing(t,e,i,r,n){if(t in this.operations){const s=this.operations[t];s.to.tileID.key!==i.tileID.key&&(s.queued=i)}else this.operations[t]={startTime:r,phase:0,duration:n,from:e,to:i,queued:null}}getMorphValuesForProxy(t){if(!(t in this.operations))return null;const e=this.operations[t];return{from:e.from,to:e.to,phase:e.phase}}update(t){for(const e in this.operations){const i=this.operations[e];for(i.phase=(t-i.startTime)/i.duration;i.phase>=1||!this._validOp(i);)if(!this._nextOp(i,t)){delete this.operations[e];break}}}_nextOp(t,e){return!!t.queued&&(t.from=t.to,t.to=t.queued,t.queued=null,t.phase=0,t.startTime=e,!0)}_validOp(t){return t.from.hasData()&&t.to.hasData()}},gb={0:null,1:"TERRAIN_VERTEX_MORPHING"};function yb(t,e,i){if(e===0)return 0;const r=e<1&&i===514?.25/e:1;return 6*Math.pow(1.5,22-t)*Math.max(e,1)*r}function yM(t,e){const i=1<<t.z;return!e&&(t.x===0||t.x===i-1)||t.y===0||t.y===i-1}const vy=t=>({u_matrix:t});function xb(t,e,i,r,n){if(n>0){const s=Wi.now(),a=(s-t.timeAdded)/n,c=e?(s-e.timeAdded)/n:-1,p=i.getSource(),_=r.coveringZoomLevel({tileSize:p.tileSize,roundZoom:p.roundZoom}),v=!e||Math.abs(e.tileID.overscaledZ-_)>Math.abs(t.tileID.overscaledZ-_),E=v&&t.refreshedUponExpiration?1:Ai(v?a:1-c,0,1);return t.refreshedUponExpiration&&a>=1&&(t.refreshedUponExpiration=!1),e?{opacity:1,mix:1-E}:{opacity:E,mix:0}}return{opacity:1,mix:0}}class xM extends iu{constructor(e){const i={type:"raster-dem",maxzoom:e.transform.maxZoom},r=new af(ep(),null),n=fy("mock-dem",i,r,e.style);super("mock-dem",n,!1),n.setEventedParent(this),this._sourceLoaded=!0}_loadTile(e,i){e.state="loaded",i(null)}}class vM extends iu{constructor(e){const i=fy("proxy",{type:"geojson",maxzoom:e.transform.maxZoom},new af(ep(),null),e.style);super("proxy",i,!1),i.setEventedParent(this),this.map=this.getSource().map=e,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(e,i,r){if(e.freezeTileCoverage)return;this.transform=e;const n=e.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((s,a)=>{if(s[a.key]="",!this._tiles[a.key]){const c=new G0(a,this._source.tileSize*a.overscaleFactor(),e.tileZoom);c.state="loaded",this._tiles[a.key]=c}return s},{});for(const s in this._tiles)s in n||(this.freeFBO(s),this._tiles[s].unloadVectorData(),delete this._tiles[s])}freeFBO(e){const i=this.proxyCachedFBO[e];if(i!==void 0){const r=Object.values(i);this.renderCachePool.push(...r),delete this.proxyCachedFBO[e]}}deallocRenderCache(){this.renderCache.forEach(e=>e.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class vb extends ui{constructor(e,i,r){super(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y),this.proxyTileKey=i,this.projMatrix=r}}class bM extends e3{constructor(e,i){super(),this.painter=e,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[r,n,s]=function(p){const _=new pl,v=new so,E=131;_.reserve(17161),v.reserve(33800);const C=Mt/128,B=Mt+C/2,O=B+C;for(let q=-C;q<O;q+=C)for(let X=-C;X<O;X+=C){const $=X<0||X>B||q<0||q>B?24575:0,re=Ai(Math.round(X),0,Mt),ne=Ai(Math.round(q),0,Mt);_.emplaceBack(re+$,ne)}const G=(q,X)=>{const $=X*E+q;v.emplaceBack($+1,$,$+E),v.emplaceBack($+E,$+E+1,$+1)};for(let q=1;q<129;q++)for(let X=1;X<129;X++)G(X,q);return[0,129].forEach(q=>{for(let X=0;X<130;X++)G(X,q),G(q,X)}),[_,v,32768]}(),a=e.context;this.gridBuffer=a.createVertexBuffer(r,xi.members),this.gridIndexBuffer=a.createIndexBuffer(n),this.gridSegments=Mn.simpleSegment(0,0,r.length,n.length),this.gridNoSkirtSegments=Mn.simpleSegment(0,0,r.length,s),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new vM(i.map),this.orthoMatrix=ce.create(),ce.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,Mt,0,Mt,0,1);const c=a.gl;this._overlapStencilMode=new Br({func:c.GEQUAL,mask:255},0,255,c.KEEP,c.KEEP,c.REPLACE),this._previousZoom=e.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=i,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new xM(i.map),this._pendingGroundEffectLayers=[]}set style(e){e.on("data",this._onStyleDataEvent.bind(this)),this._style=e,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(e,i,r){if(e&&e.terrain){this._style!==e&&(this.style=e,this._evaluationZoom=void 0);const n=e.terrain.properties,s=e.terrain.drapeRenderMode===0,a=e.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=Wi.now();const c=e.terrain&&e.terrain.scope,p=n.get("source"),_=s?this._mockSourceCache:e.getSourceCache(p,c);if(!_)return void Be(`Couldn't find terrain source "${p}".`);if(this.sourceCache=_,this._exaggeration=a?this.calculateExaggeration(i):n.get("exaggeration"),!i.projection.requiresDraping&&a&&this._exaggeration===0)return void this._disable();this.enabled=!0;const v=()=>{this.sourceCache.used&&Be(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const E=this.getScaledDemTileSize();this.sourceCache.update(i,E,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,v(),this._initializing=!0),v(),i.updateElevation(!0,r),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(i),this._emptyDEMTextureDirty=!0,this._previousZoom=i.zoom}else this._disable()}calculateExaggeration(e){const i=this._previousCameraAltitude,r=e.getFreeCameraOptions().position.z/e.pixelsPerMeter*e.worldSize;this._previousCameraAltitude=r;const n=i!=null?r-i:Number.MAX_VALUE;if(Math.abs(n)<2)return this._exaggeration;const s=e.zoom,a=this._style.terrain;if(!this._previousUpdateTimestamp)return a.getExaggeration(s);let c=s-this._previousZoom;const p=this._previousUpdateTimestamp;let _=s;this._evaluationZoom!=null&&(_=this._evaluationZoom,Math.abs(s-_)>.5&&(c=.5*(s-_+c)),c*n<0&&(_+=c)),this._evaluationZoom=_;const v=a.getExaggeration(_),E=v===a.getExaggeration(Math.max(0,_-.1));if(E&&Math.abs(v-this._exaggeration)<.01)return v;let C=Math.min(.1,.00375*(this._updateTimestamp-p));return(E||v<.1||Math.abs(c)<1e-4)&&(C=Math.min(.2,4*C)),Ki(this._exaggeration,v,C)}resetTileLookupCache(e){this._findCoveringTileCache[e]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(e){e.coord&&e.dataType==="source"?this._clearRenderCacheForTile(e.sourceCacheId,e.coord):e.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const e in this._style._mergedSourceCaches)this._style._mergedSourceCaches[e].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(e=>e.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const e=2*this.proxySourceCache.getSource().tileSize;return[e,e]}set useVertexMorphing(e){this._useVertexMorphing=e}updateTileBinding(e){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const i=this.proxySourceCache,r=this.painter.transform;this._initializing&&(this._initializing=r._centerAltitude===0&&this.getAtPointOrZero(Wr.fromLngLat(r.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const n=this.proxyCoords=i.getIds().map(p=>{const _=i.getTileByID(p).tileID;return _.projMatrix=r.calculateProjMatrix(_.toUnwrapped()),_});(function(p,_){const v=_.transform.pointCoordinate(_.transform.getCameraPoint()),E=new ct(v.x,v.y);p.sort((C,B)=>{if(B.overscaledZ-C.overscaledZ)return B.overscaledZ-C.overscaledZ;const O=new ct(C.canonical.x+(1<<C.canonical.z)*C.wrap,C.canonical.y),G=new ct(B.canonical.x+(1<<B.canonical.z)*B.wrap,B.canonical.y),q=E.mult(1<<C.canonical.z);return q.x-=.5,q.y-=.5,q.distSqr(O)-q.distSqr(G)})})(n,this.painter);const s=this.proxyToSource||{};this.proxyToSource={},n.forEach(p=>{this.proxyToSource[p.key]={}}),this.terrainTileForTile={};const a=this._style._mergedSourceCaches;for(const p in a){const _=a[p];if(!_.used||(_!==this.sourceCache&&this.resetTileLookupCache(_.id),this._setupProxiedCoordsForOrtho(_,e[p],s),_.usedForTerrain))continue;const v=e[p];_.getSource().reparseOverscaled&&this._assignTerrainTiles(v)}this.proxiedCoords[i.id]=n.map(p=>new vb(p,p.key,this.orthoMatrix)),this._assignTerrainTiles(n),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(s),this.renderingToTexture=!1;const c={};this._visibleDemTiles=[];for(const p of this.proxyCoords){const _=this.terrainTileForTile[p.key];if(!_)continue;const v=_.tileID.key;v in c||(this._visibleDemTiles.push(_),c[v]=v)}}_assignTerrainTiles(e){this._initializing||e.forEach(i=>{if(this.terrainTileForTile[i.key])return;const r=this._findTileCoveringTileID(i,this.sourceCache);r&&(this.terrainTileForTile[i.key]=r)})}_prepareDEMTextures(){const e=this.painter.context,i=e.gl;for(const r in this.terrainTileForTile){const n=this.terrainTileForTile[r],s=n.dem;!s||n.demTexture&&!n.needsDEMTextureUpload||(e.activeTexture.set(i.TEXTURE1),fb(this.painter,n,s))}}_prepareDemTileUniforms(e,i,r,n){if(!i||i.demTexture==null)return!1;const s=e.tileID.canonical,a=Math.pow(2,i.tileID.canonical.z-s.z),c=n||"";return r[`u_dem_tl${c}`]=[s.x*a%1,s.y*a%1],r[`u_dem_scale${c}`]=a,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const e=this.painter.context,i=e.gl;if(!this._emptyDepthBufferTexture){const r=new Do({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new Bs(e,r,i.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let e=0;const i=this._visibleDemTiles.reduce((r,n)=>{if(!n.dem)return r;const s=n.dem.tree.minimums[0];return s>0&&e++,r+s},0);return e?i/e:0}_updateEmptyDEMTexture(){const e=this.painter.context,i=e.gl;e.activeTexture.set(i.TEXTURE2);const r=this._getLoadedAreaMinimum(),[n,s]=(()=>{const c=new h1({width:1,height:1},new Float32Array([r]));return[i.R32F,c]})();this._emptyDEMTextureDirty=!1;let a=this._emptyDEMTexture;return a?a.update(s,{premultiply:!1}):a=this._emptyDEMTexture=new Bs(e,s,n,{premultiply:!1}),a}setupElevationDraw(e,i,r){const n=this.painter.context,s=n.gl,a={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0};a.u_exaggeration=this.exaggeration();let c=null,p=null,_=1;if(r&&r.morphing&&this._useVertexMorphing){const C=r.morphing.srcDemTile,B=r.morphing.dstDemTile;_=r.morphing.phase,C&&B&&(this._prepareDemTileUniforms(e,C,a,"_prev")&&(p=C),this._prepareDemTileUniforms(e,B,a)&&(c=B))}const v=C=>C&&C.demTexture&&this.painter.linearFloatFilteringSupported()?s.LINEAR:s.NEAREST,E=C=>{a.u_dem_size=C.size[0]===1?1:C.size[0]-2};if(p&&c)n.activeTexture.set(s.TEXTURE2),c.demTexture.bind(v(c),s.CLAMP_TO_EDGE),n.activeTexture.set(s.TEXTURE4),p.demTexture.bind(v(p),s.CLAMP_TO_EDGE),c.demTexture&&E(c.demTexture),a.u_dem_lerp=_;else{c=this.terrainTileForTile[e.tileID.key],n.activeTexture.set(s.TEXTURE2);const C=this._prepareDemTileUniforms(e,c,a)?c.demTexture:this.emptyDEMTexture;C.bind(v(c),s.CLAMP_TO_EDGE),E(C)}if(n.activeTexture.set(s.TEXTURE3),r&&r.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(s.NEAREST,s.CLAMP_TO_EDGE),this._depthFBO&&(a.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(s.NEAREST,s.CLAMP_TO_EDGE),a.u_depth_size_inv=[1,1]),r&&r.useMeterToDem&&c){const C=(1<<c.tileID.canonical.z)*jn(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;a.u_meter_to_dem=C}if(r&&r.labelPlaneMatrixInv&&(a.u_label_plane_matrix_inv=r.labelPlaneMatrixInv),i.setTerrainUniformValues(n,a),this.painter.transform.projection.name==="globe"){const C=this.globeUniformValues(this.painter.transform,e.tileID.canonical,r&&r.useDenormalizedUpVectorScale);i.setGlobeUniformValues(n,C)}}globeUniformValues(e,i,r){const n=e.projection;return{u_tile_tl_up:n.upVector(i,0,0),u_tile_tr_up:n.upVector(i,Mt,0),u_tile_br_up:n.upVector(i,Mt,Mt),u_tile_bl_up:n.upVector(i,0,Mt),u_tile_up_scale:r?ln(1):n.upVectorScale(i,e.center.lat,e.worldSize).metersToTile}}renderToBackBuffer(e){const i=this.painter,r=this.painter.context;e.length!==0&&(r.bindFramebuffer.set(null),r.viewport.set([0,0,i.width,i.height]),i.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(n,s,a,c,p){if(n.transform.projection.name==="globe")(function(_,v,E,C,B){const O=_.context,G=O.gl;let q,X;const $=_.transform,re=Am(_,O,$),ne=(Je,Fe)=>{if(X===Fe)return;const nt=[gb[Fe],"PROJECTION_GLOBE_VIEW"];re&&nt.push("CUSTOM_ANTIALIASING");const At=_.isTileAffectedByFog(Je);q=_.getOrCreateProgram("globeRaster",{defines:nt,overrideFog:At}),X=Fe},ie=_.colorModeForRenderPass(),se=new lr(G.LEQUAL,lr.ReadWrite,_.depthRangeFor3D);_d.update(B);const he=am($),ve=[Wo($.center.lng),oa($.center.lat)],be=_.globeSharedBuffers,De=[$.width*Wi.devicePixelRatio,$.height*Wi.devicePixelRatio],Ve=Float32Array.from($.globeMatrix),je={useDenormalizedUpVectorScale:!0};{const Je=_.transform,Fe=yb(Je.zoom,v.exaggeration(),v.sourceCache._source.tileSize);X=-1;const nt=G.TRIANGLES;for(const At of C){const vt=E.getTile(At),rt=Br.disabled,lt=v.prevTerrainTileForTile[At.key],wt=v.terrainTileForTile[At.key];_b(lt,wt)&&_d.newMorphing(At.key,lt,wt,B,250),O.activeTexture.set(G.TEXTURE0),vt.texture&&vt.texture.bind(G.LINEAR,G.CLAMP_TO_EDGE);const It=_d.getMorphValuesForProxy(At.key),St=It?1:0;It&&$o(je,{morphing:{srcDemTile:It.from,dstDemTile:It.to,phase:Dn(It.phase)}});const Bt=ml(At.canonical),Ft=sg(Bt.getCenter().lat),jt=cm(At.canonical,Bt,Ft,Je.worldSize/Je._pixelsPerMercatorPixel),Dt=_l(_o(At.canonical)),Yt=mb(Je.expandedFarZProjMatrix,Ve,he,Dt,Ho(Je.zoom),ve,Je.frustumCorners.TL,Je.frustumCorners.TR,Je.frustumCorners.BR,Je.frustumCorners.BL,Je.globeCenterInViewSpace,Je.globeRadius,De,Fe,jt);if(ne(At,St),q&&(v.setupElevationDraw(vt,q,je),_.uploadCommonUniforms(O,q,At.toUnwrapped()),be)){const[fi,di,vi]=be.getGridBuffers(Ft,Fe!==0);q.draw(_,nt,se,rt,ie,Fr.backCCW,Yt,"globe_raster",fi,di,vi)}}}if(be&&(_.renderDefaultNorthPole||_.renderDefaultSouthPole)){const Je=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];re&&Je.push("CUSTOM_ANTIALIASING"),q=_.getOrCreateProgram("globeRaster",{defines:Je});for(const Fe of C){const{x:nt,y:At,z:vt}=Fe.canonical,rt=At===0,lt=At===(1<<vt)-1,[wt,It,St,Bt]=be.getPoleBuffers(vt,!1);if(Bt&&(rt||lt)){const Ft=E.getTile(Fe);O.activeTexture.set(G.TEXTURE0),Ft.texture&&Ft.texture.bind(G.LINEAR,G.CLAMP_TO_EDGE);let jt=lm(vt,nt,$);const Dt=_l(_o(Fe.canonical)),Yt=(fi,di)=>fi.draw(_,G.TRIANGLES,se,Br.disabled,ie,Fr.disabled,mb($.expandedFarZProjMatrix,jt,jt,Dt,0,ve,$.frustumCorners.TL,$.frustumCorners.TR,$.frustumCorners.BR,$.frustumCorners.BL,$.globeCenterInViewSpace,$.globeRadius,De,0),"globe_pole_raster",di,St,Bt);v.setupElevationDraw(Ft,q,je),_.uploadCommonUniforms(O,q,Fe.toUnwrapped()),rt&&_.renderDefaultNorthPole&&Yt(q,wt),lt&&_.renderDefaultSouthPole&&(jt=ce.scale(ce.create(),jt,[1,-1,1]),Yt(q,It))}}}})(n,s,a,c,p);else{const _=n.context,v=_.gl;let E,C;const B=n.shadowRenderer,O=md(n,n.longestCutoffRange),G=ie=>{if(C===ie)return;const se=[];se.push(gb[ie]),O.shouldRenderCutoff&&se.push("RENDER_CUTOFF"),E=n.getOrCreateProgram("terrainRaster",{defines:se}),C=ie},q=n.colorModeForRenderPass(),X=new lr(v.LEQUAL,lr.ReadWrite,n.depthRangeFor3D);_d.update(p);const $=n.transform,re=yb($.zoom,s.exaggeration(),s.sourceCache._source.tileSize);let ne=[0,0,0];if(B){const ie=n.style.directionalLight,se=n.style.ambientLight;ie&&se&&(ne=My(ie,se))}{C=-1;const ie=v.TRIANGLES,[se,he]=[s.gridIndexBuffer,s.gridSegments];for(const ve of c){const be=a.getTile(ve),De=Br.disabled,Ve=s.prevTerrainTileForTile[ve.key],je=s.terrainTileForTile[ve.key];_b(Ve,je)&&_d.newMorphing(ve.key,Ve,je,p,250),_.activeTexture.set(v.TEXTURE0),be.texture&&be.texture.bind(v.LINEAR,v.CLAMP_TO_EDGE);const Je=_d.getMorphValuesForProxy(ve.key),Fe=Je?1:0;let nt;Je&&(nt={morphing:{srcDemTile:Je.from,dstDemTile:Je.to,phase:Dn(Je.phase)}});const At=pb(ve.projMatrix,yM(ve.canonical,$.renderWorldCopies)?re/10:re,ne);if(G(Fe),!E)continue;s.setupElevationDraw(be,E,nt);const vt=ve.toUnwrapped();B&&B.setupShadows(vt,E),n.uploadCommonUniforms(_,E,vt,null,O),E.draw(n,ie,X,De,q,Fr.backCCW,At,"terrain_raster",s.gridBuffer,se,he)}}}}(i,this,this.proxySourceCache,e,this._updateTimestamp),this.renderingToTexture=!0,i.gpuTimingDeferredRenderEnd(),e.splice(0,e.length))}renderBatch(e){if(this._drapedRenderBatches.length===0)return e+1;this.renderingToTexture=!0;const i=this.painter,r=this.painter.context,n=this.proxySourceCache,s=this.proxiedCoords[n.id],a=this._drapedRenderBatches.shift(),c=i.style.order,p=[];let _=0;for(const v of s){const E=n.getTileByID(v.proxyTileKey),C=n.proxyCachedFBO[v.key]?n.proxyCachedFBO[v.key][e]:void 0,B=C!==void 0?n.renderCache[C]:this.pool[_++],O=C!==void 0;if(E.texture=B.tex,O&&!B.dirty){p.push(E.tileID);continue}let G;r.bindFramebuffer.set(B.fb.framebuffer),this.renderedToTile=!1,B.dirty&&(r.clear({color:fr.transparent,stencil:0}),B.dirty=!1);for(let q=a.start;q<=a.end;++q){const X=i.style._mergedLayers[c[q]];if(X.isHidden(i.transform.zoom))continue;const $=i.style.getLayerSourceCache(X),re=$?this.proxyToSource[v.key][$.id]:[v];if(!re)continue;const ne=re;r.viewport.set([0,0,B.fb.width,B.fb.height]),G!==($?$.id:null)&&(this._setupStencil(B,re,X,$),G=$?$.id:null),i.renderLayer(i,$,X,ne)}if(this._drapedRenderBatches.length===0)for(const q of this._pendingGroundEffectLayers){const X=i.style._mergedLayers[c[q]];if(X.isHidden(i.transform.zoom))continue;const $=i.style.getLayerSourceCache(X),re=$?this.proxyToSource[v.key][$.id]:[v];if(!re)continue;const ne=re;r.viewport.set([0,0,B.fb.width,B.fb.height]),G!==($?$.id:null)&&(this._setupStencil(B,re,X,$),G=$?$.id:null),i.renderLayer(i,$,X,ne)}this.renderedToTile?(B.dirty=!0,p.push(E.tileID)):O||--_,_===5&&(_=0,this.renderToBackBuffer(p))}return this.renderToBackBuffer(p),this.renderingToTexture=!1,r.bindFramebuffer.set(null),r.viewport.set([0,0,i.width,i.height]),a.end+1}postRender(){}isLayerOrderingCorrect(e){const i=e.order.length;let r=-1,n=i;for(let s=0;s<i;++s)this._style.isLayerDraped(e._mergedLayers[e.order[s]])?r=Math.max(r,s):n=Math.min(n,s);return n>r}getMinElevationBelowMSL(){let e=0;return this._visibleDemTiles.filter(i=>i.dem).forEach(i=>{e=Math.min(e,i.dem.tree.minimums[0])}),e===0?e:(e-30)*this._exaggeration}raycast(e,i,r){if(!this._visibleDemTiles)return null;const n=this._visibleDemTiles.filter(s=>s.dem).map(s=>{const a=s.tileID,c=1<<a.overscaledZ,{x:p,y:_}=a.canonical,v=p/c,E=(p+1)/c,C=_/c,B=(_+1)/c;return{minx:v,miny:C,maxx:E,maxy:B,t:s.dem.tree.raycastRoot(v,C,E,B,e,i,r),tile:s}});n.sort((s,a)=>(s.t!==null?s.t:Number.MAX_VALUE)-(a.t!==null?a.t:Number.MAX_VALUE));for(const s of n){if(s.t==null)return null;const a=s.tile.dem.tree.raycast(s.minx,s.miny,s.maxx,s.maxy,e,i,r);if(a!=null)return a}return null}_createFBO(){const e=this.painter.context,i=e.gl,r=this.drapeBufferSize;e.activeTexture.set(i.TEXTURE0);const n=new Bs(e,{width:r[0],height:r[1],data:null},i.RGBA);n.bind(i.LINEAR,i.CLAMP_TO_EDGE);const s=e.createFramebuffer(r[0],r[1],!0,null);return s.colorAttachment.set(n.texture),s.depthAttachment=new CT(e,s.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=e.createRenderbuffer(e.gl.DEPTH_STENCIL,r[0],r[1]),this._stencilRef=0,s.depthAttachment.set(this._sharedDepthStencil),e.clear({stencil:0})):s.depthAttachment.set(this._sharedDepthStencil),e.extTextureFilterAnisotropic&&i.texParameterf(i.TEXTURE_2D,e.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,e.extTextureFilterAnisotropicMax),{fb:s,tex:n,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.hasLightTransitions())return!0;for(const e in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[e].hasTransition())return!0;return this._style.order.some(e=>{const i=this._style._mergedLayers[e],r=i.isHidden(this.painter.transform.zoom);return i.type==="custom"?!r&&i.shouldRedrape():!r&&i.hasTransition()})}_clearLineLayersFromRenderCache(){let e=!1;for(const r of this._style.getSources())if(r instanceof Pv){e=!0;break}if(!e)return;const i={};for(let r=0;r<this._style.order.length;++r){const n=this._style._mergedLayers[this._style.order[r]],s=this._style.getLayerSourceCache(n);if(s&&!i[s.id]&&!n.isHidden(this.painter.transform.zoom)&&n.type==="line"&&n.widthExpression()instanceof Bn){i[s.id]=!0;for(const a of this.proxyCoords){const c=this.proxyToSource[a.key][s.id];if(c)for(const p of c)this._clearRenderCacheForTile(s.id,p)}}}}_clearRasterLayersFromRenderCache(){let e=!1;for(const r in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[r]._source instanceof iy){e=!0;break}if(!e)return;const i={};for(let r=0;r<this._style.order.length;++r){const n=this._style._mergedLayers[this._style.order[r]],s=this._style.getLayerSourceCache(n);if(!s||i[s.id]||n.isHidden(this.painter.transform.zoom)||n.type!=="raster")continue;const a=n.paint.get("raster-fade-duration");for(const c of this.proxyCoords){const p=this.proxyToSource[c.key][s.id];if(p)for(const _ of p){const v=xb(s.getTile(_),s.findLoadedParent(_,0),s,this.painter.transform,a);(v.opacity!==1||v.mix!==0)&&this._clearRenderCacheForTile(s.id,_)}}}}_setupDrapedRenderBatches(){const e=this._style.order,i=e.length;if(i===0)return;const r=[];this._pendingGroundEffectLayers=[];let n,s=0,a=this._style._mergedLayers[e[s]];for(;!this._style.isLayerDraped(a)&&a.isHidden(this.painter.transform.zoom)&&++s<i;)a=this._style._mergedLayers[e[s]];for(;s<i;++s){const c=this._style._mergedLayers[e[s]];c.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(c)?n===void 0&&(n=s):(c.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(s),n!==void 0&&(r.push({start:n,end:s-1}),n=void 0)))}if(n!==void 0&&r.push({start:n,end:s-1}),r.length!==0){const c=r[r.length-1];this._pendingGroundEffectLayers.every(_=>_>c.end)||Be("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=r}_setupRenderCache(e){const i=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,i.renderCache.length>i.renderCachePool.length){const a=Object.values(i.proxyCachedFBO);i.proxyCachedFBO={};for(let c=0;c<a.length;++c){const p=Object.values(a[c]);i.renderCachePool.push(...p)}}return}this._clearRasterLayersFromRenderCache();const r=this.proxyCoords,n=this._tilesDirty;for(let a=r.length-1;a>=0;a--){const c=r[a];if(i.getTileByID(c.key),i.proxyCachedFBO[c.key]!==void 0){const p=e[c.key],_=this.proxyToSource[c.key];let v=0;for(const E in _){const C=_[E],B=p[E];if(!B||B.length!==C.length||C.some((O,G)=>O!==B[G]||n[E]&&n[E].hasOwnProperty(O.key))){v=-1;break}++v}for(const E in i.proxyCachedFBO[c.key])i.renderCache[i.proxyCachedFBO[c.key][E]].dirty=v<0||v!==Object.values(p).length}}const s=[...this._drapedRenderBatches];s.sort((a,c)=>c.end-c.start-(a.end-a.start));for(const a of s)for(const c of r){if(i.proxyCachedFBO[c.key])continue;let p=i.renderCachePool.pop();p===void 0&&i.renderCache.length<50&&(p=i.renderCache.length,i.renderCache.push(this._createFBO())),p!==void 0&&(i.proxyCachedFBO[c.key]={},i.proxyCachedFBO[c.key][a.start]=p,i.renderCache[p].dirty=!0)}this._tilesDirty={}}_setupStencil(e,i,r,n){if(!n||!this._sourceTilesOverlap[n.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const s=this.painter.context,a=s.gl;if(i.length<=1)return void(this._overlapStencilType=!1);let c;if(r.isTileClipped())c=i.length,this._overlapStencilMode.test={func:a.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(i[0].overscaledZ>i[i.length-1].overscaledZ))return void(this._overlapStencilType=!1);c=1,this._overlapStencilMode.test={func:a.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+c>255&&(s.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=c,this._overlapStencilMode.ref=this._stencilRef,r.isTileClipped()&&this._renderTileClippingMasks(i,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(e){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[e.key]),this._overlapStencilMode):Br.disabled}_renderTileClippingMasks(e,i){const r=this.painter,n=this.painter.context,s=n.gl;r._tileClippingMaskIDs={},n.setColorMode(An.disabled),n.setDepthMode(lr.disabled);const a=r.getOrCreateProgram("clippingMask");for(const c of e){const p=r._tileClippingMaskIDs[c.key]=--i;a.draw(r,s.TRIANGLES,lr.disabled,new Br({func:s.ALWAYS,mask:0},p,255,s.KEEP,s.KEEP,s.REPLACE),An.disabled,Fr.disabled,vy(c.projMatrix),"$clipping",r.tileExtentBuffer,r.quadTriangleIndexBuffer,r.tileExtentSegments)}}pointCoordinate(e){const i=this.painter.transform;if(e.x<0||e.x>i.width||e.y<0||e.y>i.height)return null;const r=[e.x,e.y,1,1];V.transformMat4(r,r,i.pixelMatrixInverse),V.scale(r,r,1/r[3]),r[0]/=i.worldSize,r[1]/=i.worldSize;const n=i._camera.position,s=jn(1,i.center.lat),a=[n[0],n[1],n[2]/s,0],c=me.subtract([],r.slice(0,3),a);me.normalize(c,c);const p=this.raycast(a,c,this._exaggeration);return p!==null&&p?(me.scaleAndAdd(a,a,c,p),a[3]=a[2],a[2]*=s,a):null}drawDepth(){const e=this.painter,i=e.context,r=this.proxySourceCache,n=Math.ceil(e.width),s=Math.ceil(e.height);if(!this._depthFBO||this._depthFBO.width===n&&this._depthFBO.height===s||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const a=i.gl,c=i.createFramebuffer(n,s,!0,"renderbuffer");i.activeTexture.set(a.TEXTURE0);const p=new Bs(i,{width:n,height:s,data:null},a.RGBA);p.bind(a.NEAREST,a.CLAMP_TO_EDGE),c.colorAttachment.set(p.texture);const _=i.createRenderbuffer(i.gl.DEPTH_COMPONENT16,n,s);c.depthAttachment.set(_),this._depthFBO=c,this._depthTexture=p}i.bindFramebuffer.set(this._depthFBO.framebuffer),i.viewport.set([0,0,n,s]),function(a,c,p,_){if(a.transform.projection.name==="globe")return;const v=a.context,E=v.gl;v.clear({depth:1});const C=a.getOrCreateProgram("terrainDepth"),B=new lr(E.LESS,lr.ReadWrite,a.depthRangeFor3D);for(const O of _){const G=p.getTile(O),q=pb(O.projMatrix,0,[0,0,0]);c.setupElevationDraw(G,C),C.draw(a,E.TRIANGLES,B,Br.disabled,An.unblended,Fr.backCCW,q,"terrain_depth",c.gridBuffer,c.gridIndexBuffer,c.gridNoSkirtSegments)}}(e,this,r,this.proxyCoords)}_setupProxiedCoordsForOrtho(e,i,r){if(e.getSource()instanceof Tc)return this._setupProxiedCoordsForImageSource(e,i,r);this._findCoveringTileCache[e.id]=this._findCoveringTileCache[e.id]||{};const n=this.proxiedCoords[e.id]=[],s=this.proxyCoords;for(let c=0;c<s.length;c++){const p=s[c],_=this._findTileCoveringTileID(p,e);if(_){const v=this._createProxiedId(p,_,r[p.key]&&r[p.key][e.id]);n.push(v),this.proxyToSource[p.key][e.id]=[v]}}let a=!1;for(let c=0;c<i.length;c++){const p=e.getTile(i[c]);if(!p||!p.hasData())continue;const _=this._findTileCoveringTileID(p.tileID,this.proxySourceCache);if(_&&_.tileID.canonical.z!==p.tileID.canonical.z){const v=this.proxyToSource[_.tileID.key][e.id],E=this._createProxiedId(_.tileID,p,r[_.tileID.key]&&r[_.tileID.key][e.id]);v?v.splice(v.length-1,0,E):this.proxyToSource[_.tileID.key][e.id]=[E],n.push(E),a=!0}}this._sourceTilesOverlap[e.id]=a}_setupProxiedCoordsForImageSource(e,i,r){if(!e.getSource().loaded())return;const n=this.proxiedCoords[e.id]=[],s=this.proxyCoords,a=e.getSource(),c=a.tileID;if(!c)return;const p=new ct(c.x,c.y)._div(1<<c.z),_=a.coordinates.map(Wr.fromLngLat).reduce((E,C)=>(E.min.x=Math.min(E.min.x,C.x-p.x),E.min.y=Math.min(E.min.y,C.y-p.y),E.max.x=Math.max(E.max.x,C.x-p.x),E.max.y=Math.max(E.max.y,C.y-p.y),E),{min:new ct(Number.MAX_VALUE,Number.MAX_VALUE),max:new ct(-Number.MAX_VALUE,-Number.MAX_VALUE)}),v=(E,C)=>{const B=E.wrap+E.canonical.x/(1<<E.canonical.z),O=E.canonical.y/(1<<E.canonical.z),G=Mt/(1<<E.canonical.z),q=C.wrap+C.canonical.x/(1<<C.canonical.z),X=C.canonical.y/(1<<C.canonical.z);return B+G<q+_.min.x||B>q+_.max.x||O+G<X+_.min.y||O>X+_.max.y};for(let E=0;E<s.length;E++){const C=s[E];for(let B=0;B<i.length;B++){const O=e.getTile(i[B]);if(!O||!O.hasData()||v(C,O.tileID))continue;const G=this._createProxiedId(C,O,r[C.key]&&r[C.key][e.id]),q=this.proxyToSource[C.key][e.id];q?q.push(G):this.proxyToSource[C.key][e.id]=[G],n.push(G)}}}_createProxiedId(e,i,r){let n=this.orthoMatrix;if(r){const s=r.find(a=>a.key===i.tileID.key);if(s)return s}if(i.tileID.key!==e.key){const s=e.canonical.z-i.tileID.canonical.z;let a,c,p;n=ce.create();const _=i.tileID.wrap-e.wrap<<e.overscaledZ;s>0?(a=Mt>>s,c=a*((i.tileID.canonical.x<<s)-e.canonical.x+_),p=a*((i.tileID.canonical.y<<s)-e.canonical.y)):(a=Mt<<-s,c=Mt*(i.tileID.canonical.x-(e.canonical.x+_<<-s)),p=Mt*(i.tileID.canonical.y-(e.canonical.y<<-s))),ce.ortho(n,0,a,0,a,0,1),ce.translate(n,n,[c,p,0])}return new vb(i.tileID,e.key,n)}_findTileCoveringTileID(e,i){let r=i.getTile(e);if(r&&r.hasData())return r;const n=this._findCoveringTileCache[i.id],s=n[e.key];if(r=s?i.getTileByID(s):null,r&&r.hasData()||s===null)return r;let a=r?r.tileID:e,c=a.overscaledZ;const p=i.getSource().minzoom,_=[];if(!s){const E=i.getSource().maxzoom;if(e.canonical.z>=E){const C=e.canonical.z-E;i.getSource().reparseOverscaled?(c=Math.max(e.canonical.z+2,i.transform.tileZoom),a=new ui(c,e.wrap,E,e.canonical.x>>C,e.canonical.y>>C)):C!==0&&(c=E,a=new ui(c,e.wrap,E,e.canonical.x>>C,e.canonical.y>>C))}a.key!==e.key&&(_.push(a.key),r=i.getTile(a))}const v=E=>{_.forEach(C=>{n[C]=E}),_.length=0};for(c-=1;c>=p&&(!r||!r.hasData());c--){r&&v(r.tileID.key);const E=a.calculateScaledKey(c);if(r=i.getTileByID(E),r&&r.hasData())break;const C=n[E];if(C===null)break;C===void 0?_.push(E):r=i.getTileByID(C)}return v(r?r.tileID.key:null),r&&r.hasData()?r:null}findDEMTileFor(e){return this.enabled?this._findTileCoveringTileID(e,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(e,i){let r=this._tilesDirty[e];r||(r=this._tilesDirty[e]={}),r[i.key]=!0}}function wM(t,e,i){const r=function(c,p,_){const v=me.dot(p,c),E=me.dot(_,[.2126,.7152,.0722]),C=(O,G,q)=>(1-q)*O+q*G,B=C(1-.3*Math.min(E,1),1,Math.min(v+1,1));return C(.92,1,Math.asin(Ai(p[2],-1,1))/Math.PI+.5)*B}(t,[0,0,1],e),n=[0,0,0];me.scale(n,i.slice(0,3),r);const s=[0,0,0];me.scale(s,e.slice(0,3),t[2]);const a=[0,0,0];return me.add(a,n,s),yn(a)}const TM=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],EM=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class bb{static cacheKey(e,i,r,n){let s=`${i}${n?n.cacheKey:""}`;for(const a of r)e.usedDefines.includes(a)&&(s+=`/${a}`);return s}constructor(e,i,r,n,s,a){const c=e.gl;this.program=c.createProgram(),this.configuration=n,this.name=i,this.fixedDefines=[...a];const p=n?n.getBinderAttributes():[],_=(r.staticAttributes||[]).concat(p);let v=n?n.defines():[];v=v.concat(a.map(q=>`#define ${q}`));const E=`#version 300 es
`;let C=E+v.concat("precision mediump float;",ub,cb.fragmentSource).join(`
`);for(const q of r.fragmentIncludes)C+=`
${f_[q]}`;C+=`
${r.fragmentSource}`;let B=E+v.concat("precision highp float;",ub,cb.vertexSource).join(`
`);for(const q of r.vertexIncludes)B+=`
${f_[q]}`;B+=`
${r.vertexSource}`;const O=c.createShader(c.FRAGMENT_SHADER);if(c.isContextLost())return void(this.failedToCreate=!0);c.shaderSource(O,C),c.compileShader(O),c.attachShader(this.program,O);const G=c.createShader(c.VERTEX_SHADER);if(c.isContextLost())this.failedToCreate=!0;else{c.shaderSource(G,B),c.compileShader(G),c.attachShader(this.program,G),this.attributes={},this.numAttributes=_.length;for(let q=0;q<this.numAttributes;q++)if(_[q]){const X=_[q].startsWith("a_")?_[q]:`a_${_[q]}`;c.bindAttribLocation(this.program,q,X),this.attributes[X]=q}c.linkProgram(this.program),c.deleteShader(G),c.deleteShader(O),this.fixedUniforms=s(e),this.binderUniforms=n?n.getUniforms(e):[],a.includes("TERRAIN")&&(this.terrainUniforms=(q=>({u_dem:new Oi(q),u_dem_prev:new Oi(q),u_dem_tl:new Pr(q),u_dem_scale:new ei(q),u_dem_tl_prev:new Pr(q),u_dem_scale_prev:new ei(q),u_dem_size:new ei(q),u_dem_lerp:new ei(q),u_exaggeration:new ei(q),u_depth:new Oi(q),u_depth_size_inv:new Pr(q),u_meter_to_dem:new ei(q),u_label_plane_matrix_inv:new xr(q)}))(e)),a.includes("GLOBE")&&(this.globeUniforms=(q=>({u_tile_tl_up:new Tr(q),u_tile_tr_up:new Tr(q),u_tile_br_up:new Tr(q),u_tile_bl_up:new Tr(q),u_tile_up_scale:new ei(q)}))(e)),a.includes("FOG")&&(this.fogUniforms=(q=>({u_fog_matrix:new xr(q),u_fog_range:new Pr(q),u_fog_color:new Bo(q),u_fog_horizon_blend:new ei(q),u_fog_vertical_limit:new Pr(q),u_fog_temporal_offset:new ei(q),u_frustum_tl:new Tr(q),u_frustum_tr:new Tr(q),u_frustum_br:new Tr(q),u_frustum_bl:new Tr(q),u_globe_pos:new Tr(q),u_globe_radius:new ei(q),u_globe_transition:new ei(q),u_is_globe:new Oi(q),u_viewport:new Pr(q)}))(e)),a.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(q=>({u_cutoff_params:new Bo(q)}))(e)),a.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(q=>({u_lighting_ambient_color:new Tr(q),u_lighting_directional_dir:new Tr(q),u_lighting_directional_color:new Tr(q),u_ground_radiance:new Tr(q)}))(e)),a.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(q=>({u_light_matrix_0:new xr(q),u_light_matrix_1:new xr(q),u_fade_range:new Pr(q),u_shadow_normal_offset:new Tr(q),u_shadow_intensity:new ei(q),u_shadow_texel_size:new ei(q),u_shadow_map_resolution:new ei(q),u_shadow_direction:new Tr(q),u_shadow_bias:new Tr(q),u_shadowmap_0:new Oi(q),u_shadowmap_1:new Oi(q)}))(e))}}setTerrainUniformValues(e,i){if(!this.terrainUniforms)return;const r=this.terrainUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const n in i)r[n]&&r[n].set(this.program,n,i[n])}}setGlobeUniformValues(e,i){if(!this.globeUniforms)return;const r=this.globeUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const n in i)r[n]&&r[n].set(this.program,n,i[n])}}setFogUniformValues(e,i){if(!this.fogUniforms)return;const r=this.fogUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const n in i)r[n].set(this.program,n,i[n])}}setCutoffUniformValues(e,i){if(!this.cutoffUniforms)return;const r=this.cutoffUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const n in i)r[n].set(this.program,n,i[n])}}setLightsUniformValues(e,i){if(!this.lightsUniforms)return;const r=this.lightsUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const n in i)r[n].set(this.program,n,i[n])}}setShadowUniformValues(e,i){if(this.failedToCreate||!this.shadowUniforms)return;const r=this.shadowUniforms;e.program.set(this.program);for(const n in i)r[n].set(this.program,n,i[n])}_drawDebugWireframe(e,i,r,n,s,a,c,p,_,v){const E=e.options.wireframe;if(E.terrain===!1&&E.layers2D===!1&&E.layers3D===!1)return;const C=e.context;if(!(!(!E.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!E.layers2D||e._terrain&&e._terrain.renderingToTexture||!TM.includes(this.name))||!(!E.layers3D||!EM.includes(this.name))))return;const B=C.gl,O=e.wireframeDebugCache.getLinesFromTrianglesBuffer(e.frameCounter,s,C);if(!O)return;const G=[...this.fixedDefines];G.push("DEBUG_WIREFRAME");const q=e.getOrCreateProgram(this.name,{config:this.configuration,defines:G});C.program.set(q.program);const X=(ne,ie,se)=>{if(ie[ne]&&se[ne])for(const he in ie[ne])se[ne][he]&&se[ne][he].set(se.program,he,ie[ne][he].current)};_&&_.setUniforms(q.program,C,q.binderUniforms,c,{zoom:p}),X("fixedUniforms",this,q),X("terrainUniforms",this,q),X("globeUniforms",this,q),X("fogUniforms",this,q),X("lightsUniforms",this,q),X("shadowUniforms",this,q),O.bind(),C.setColorMode(new An([B.ONE,B.ONE_MINUS_SRC_ALPHA,B.ZERO,B.ONE],fr.transparent,[!0,!0,!0,!1])),C.setDepthMode(new lr(i.func===B.LESS?B.LEQUAL:i.func,lr.ReadOnly,i.range)),C.setStencilMode(Br.disabled);const $=3*a.primitiveLength*2,re=3*a.primitiveOffset*2*2;v&&v>1?B.drawElementsInstanced(B.LINES,$,B.UNSIGNED_SHORT,re,v):B.drawElements(B.LINES,$,B.UNSIGNED_SHORT,re),s.bind(),C.program.set(this.program),C.setDepthMode(i),C.setStencilMode(r),C.setColorMode(n)}draw(e,i,r,n,s,a,c,p,_,v,E,C,B,O,G,q){const X=e.context,$=X.gl;if(this.failedToCreate)return;X.program.set(this.program),X.setDepthMode(r),X.setStencilMode(n),X.setColorMode(s),X.setCullFace(a);for(const ie of Object.keys(this.fixedUniforms))this.fixedUniforms[ie].set(this.program,ie,c[ie]);O&&O.setUniforms(this.program,X,this.binderUniforms,C,{zoom:B});const re={[$.LINES]:2,[$.TRIANGLES]:3,[$.LINE_STRIP]:1}[i],ne=q&&q>0?1:void 0;for(const ie of E.get()){const se=ie.vaos||(ie.vaos={});(se[p]||(se[p]=new pM)).bind(X,this,_,O?O.getPaintVertexBuffers():[],v,ie.vertexOffset,G||[],ne),q&&q>1?$.drawElementsInstanced(i,ie.primitiveLength*re,$.UNSIGNED_SHORT,ie.primitiveOffset*re*2,q):$.drawElements(i,ie.primitiveLength*re,$.UNSIGNED_SHORT,ie.primitiveOffset*re*2),i===$.TRIANGLES&&this._drawDebugWireframe(e,r,n,s,v,ie,C,B,O,q)}}}function wb(t,e){const i=Math.pow(2,e.tileID.overscaledZ),r=e.tileSize*Math.pow(2,t.transform.tileZoom)/i,n=r*(e.tileID.canonical.x+e.tileID.wrap*i),s=r*e.tileID.canonical.y;return{u_image:0,u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/rf(e,1,t.transform.tileZoom),u_pixel_coord_upper:[n>>16,s>>16],u_pixel_coord_lower:[65535&n,65535&s]}}const MM=ce.create(),Tb=(t,e,i,r,n,s,a,c,p,_,v,E,C,B,O,G)=>{const q=e.style.light,X=q.properties.get("position"),$=[X.x,X.y,X.z],re=Se.create();q.properties.get("anchor")==="viewport"&&(Se.fromRotation(re,-e.transform.angle),me.transformMat3($,$,re));const ne=q.properties.get("color"),ie=e.transform,se={u_matrix:t,u_lightpos:$,u_lightintensity:q.properties.get("intensity"),u_lightcolor:[ne.r,ne.g,ne.b],u_vertical_gradient:+i,u_opacity:r,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:MM,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:n,u_edge_radius:s,u_flood_light_color:E,u_vertical_scale:C,u_flood_light_intensity:B,u_ground_shadow_factor:O,u_emissive_strength:G};return ie.projection.name==="globe"&&(se.u_tile_id=[a.canonical.x,a.canonical.y,1<<a.canonical.z],se.u_zoom_transition=p,se.u_inv_rot_matrix=v,se.u_merc_center=_,se.u_up_dir=ie.projection.upVector(new ci(0,0,0),_[0]*Mt,_[1]*Mt),se.u_height_lift=c),se},SM=(t,e,i)=>({u_matrix:t,u_edge_radius:e,u_vertical_scale:i}),IM=(t,e,i,r,n,s,a,c,p,_,v,E,C,B)=>{const O=Tb(t,e,i,r,n,s,a,p,_,v,E,C,B,1,[0,0,0],0),G={u_height_factor:-Math.pow(2,a.overscaledZ)/c.tileSize/8};return Pt(O,wb(e,c),G)},Eb=(t,e)=>({u_matrix:t,u_emissive_strength:e}),Mb=(t,e,i,r)=>Pt(Eb(t,e),wb(i,r)),CM=(t,e,i)=>({u_matrix:t,u_world:i,u_emissive_strength:e}),kM=(t,e,i,r,n)=>Pt(Mb(t,e,i,r),{u_world:n}),DM=(t,e,i,r)=>{const n=Mt/i.tileSize;return{u_matrix:t,u_camera_to_center_distance:e.getCameraToCenterDistance(r),u_extrude_scale:[e.pixelsToGLUnits[0]/n,e.pixelsToGLUnits[1]/n]}},Sb=(t,e,i=1)=>({u_matrix:t,u_color:e,u_overlay:0,u_overlay_scale:i}),PM=ce.create(),zM=(t,e,i,r,n,s,a)=>{const c=t.transform,p=c.projection.name==="globe",_=p?sm(c.zoom,e.canonical)*c._pixelsPerMercatorPixel:rf(i,1,s),v={u_matrix:e.projMatrix,u_extrude_scale:_,u_intensity:a,u_inv_rot_matrix:PM,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(p){v.u_inv_rot_matrix=r,v.u_merc_center=n,v.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],v.u_zoom_transition=Ho(c.zoom);const E=n[0]*Mt,C=n[1]*Mt;v.u_up_dir=c.projection.upVector(new ci(0,0,0),E,C)}return v},Ib=(t,e,i,r,n,s,a,c,p,_,v,E,C,B,O,G,q,X,$,re,ne,ie)=>{return{u_matrix:t,u_normalize_matrix:e,u_globe_matrix:i,u_merc_matrix:r,u_grid_matrix:n,u_tl_parent:s,u_scale_parent:v,u_fade_t:E.mix,u_opacity:E.opacity*C.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:C.paint.get("raster-brightness-min"),u_brightness_high:C.paint.get("raster-brightness-max"),u_saturation_factor:(he=C.paint.get("raster-saturation"),he>0?1-1/(1.001-he):-he),u_contrast_factor:(se=C.paint.get("raster-contrast"),se>0?1/(1-se):1+se),u_spin_weights:BM(C.paint.get("raster-hue-rotate")),u_perspective_transform:B,u_raster_elevation:O,u_tl_br:a,u_zoom_transition:c,u_merc_center:p,u_cutoff_params:_,u_colorization_mix:LM(q,$),u_colorization_offset:RM(X,$),u_color_ramp:G,u_texture_offset:[ne/(re+2*ne),re/(re+2*ne)],u_texture_res:[re+2*ne,re+2*ne],u_emissive_strength:ie};var se,he};function BM(t){t*=Math.PI/180;const e=Math.sin(t),i=Math.cos(t);return[(2*i+1)/3,(-Math.sqrt(3)*e-i+1)/3,(Math.sqrt(3)*e-i+1)/3]}function LM([t,e,i,r],[n,s]){if(n===s)return[0,0,0,0];const a=259/257/(s-n);return[t*a,e*a,i*a,r*a]}function RM(t,[e,i]){return e===i?0:((t-e)/(i-e)*259-1)/257}const Cb=ce.create(),kb=(t,e,i,r,n,s,a,c,p,_,v,E,C,B,O,G,q,X)=>{const $=n.transform,re={u_is_size_zoom_constant:+(t==="constant"||t==="source"),u_is_size_feature_constant:+(t==="constant"||t==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:$.getCameraToCenterDistance(G),u_rotate_symbol:+i,u_aspect_ratio:$.width/$.height,u_fade_change:n.options.fadeDuration?n.symbolFadeChange:1,u_matrix:s,u_label_plane_matrix:a,u_coord_matrix:c,u_is_text:+p,u_pitch_with_map:+r,u_texsize:_,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Cb,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Cb,u_up_vector:[0,-1,0],u_icon_transition:X||0,u_icon_saturation:q};return G.name==="globe"&&(re.u_tile_id=[v.canonical.x,v.canonical.y,1<<v.canonical.z],re.u_zoom_transition=E,re.u_inv_rot_matrix=B,re.u_merc_center=C,re.u_camera_forward=$._camera.forward(),re.u_ecef_origin=function(ne,ie){const se=[0,0,0],he=_l(_o(ie.canonical));return me.transformMat4(se,se,he),me.transformMat4(se,se,ne),se}($.globeMatrix,v.toUnwrapped()),re.u_tile_matrix=Float32Array.from($.globeMatrix),re.u_up_vector=O),re},Db=(t,e,i,r,n,s,a,c,p,_,v,E,C,B,O,G,q)=>Pt(kb(t,e,i,r,n,s,a,c,p,_,E,C,B,O,G,q,1),{u_gamma_scale:r?n.transform.getCameraToCenterDistance(q)*Math.cos(n.terrain?0:n.transform._pitch):1,u_device_pixel_ratio:Wi.devicePixelRatio,u_is_halo:+v,undefined:void 0}),FM=(t,e,i,r,n,s,a,c,p,_,v,E,C,B,O,G)=>Pt(Db(t,e,i,r,n,s,a,c,!0,p,!0,v,E,C,B,O,G),{u_texsize_icon:_,u_texture_icon:1}),OM=(t,e,i,r)=>({u_matrix:t,u_emissive_strength:e,u_opacity:i,u_color:r}),NM=(t,e,i,r,n,s,a)=>Pt(function(c,p,_,v){const E=_.imageManager.getPattern(c.toString(),p),{width:C,height:B}=_.imageManager.getPixelSize(p),O=Math.pow(2,v.tileID.overscaledZ),G=v.tileSize*Math.pow(2,_.transform.tileZoom)/O,q=G*(v.tileID.canonical.x+v.tileID.wrap*O),X=G*v.tileID.canonical.y;return{u_image:0,u_pattern_tl:E.tl,u_pattern_br:E.br,u_texsize:[C,B],u_pattern_size:E.displaySize,u_tile_units_to_pixels:1/rf(v,1,_.transform.tileZoom),u_pixel_coord_upper:[q>>16,X>>16],u_pixel_coord_lower:[65535&q,65535&X]}}(n,s,r,a),{u_matrix:t,u_emissive_strength:e,u_opacity:i}),IA={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,ShadowMap0:10},by=(t,e,i,r,n,s,a,c,p,_,v,E,C=[0,0,0])=>{const B=r.style.light,O=B.properties.get("position"),G=[-O.x,-O.y,O.z],q=Se.create();B.properties.get("anchor")==="viewport"&&(Se.fromRotation(q,-r.transform.angle),me.transformMat3(G,G,q));const X=_.alphaMode==="MASK",$=B.properties.get("color"),re=E.paint.get("model-ambient-occlusion-intensity"),ne=E.paint.get("model-color").constantOr(fr.white),ie=E.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:t,u_lighting_matrix:e,u_normal_matrix:i,u_lightpos:G,u_lightintensity:B.properties.get("intensity"),u_lightcolor:[$.r,$.g,$.b],u_camera_pos:C,u_opacity:n,u_baseTextureIsAlpha:0,u_alphaMask:+X,u_alphaCutoff:_.alphaCutoff,u_baseColorFactor:[s.r,s.g,s.b,s.a],u_emissiveFactor:[a[0],a[1],a[2],1],u_metallicFactor:c,u_roughnessFactor:p,u_baseColorTexture:IA.BaseColor,u_metallicRoughnessTexture:IA.MetallicRoughness,u_normalTexture:IA.Normal,u_occlusionTexture:IA.Occlusion,u_emissionTexture:IA.Emission,u_color_mix:[ne.r,ne.g,ne.b,ie],u_aoIntensity:re,u_emissive_strength:v}},Pb=new Float32Array(16),zb=(t,e=Pb,i=Pb)=>({u_matrix:t,u_instance:e,u_node_matrix:i}),UM={fillExtrusion:t=>({u_matrix:new xr(t),u_lightpos:new Tr(t),u_lightintensity:new ei(t),u_lightcolor:new Tr(t),u_vertical_gradient:new ei(t),u_opacity:new ei(t),u_edge_radius:new ei(t),u_ao:new Pr(t),u_tile_id:new Tr(t),u_zoom_transition:new ei(t),u_inv_rot_matrix:new xr(t),u_merc_center:new Pr(t),u_up_dir:new Tr(t),u_height_lift:new ei(t),u_flood_light_color:new Tr(t),u_vertical_scale:new ei(t),u_flood_light_intensity:new ei(t),u_ground_shadow_factor:new Tr(t),u_emissive_strength:new ei(t)}),fillExtrusionDepth:t=>({u_matrix:new xr(t),u_edge_radius:new ei(t),u_vertical_scale:new ei(t)}),fillExtrusionPattern:t=>({u_matrix:new xr(t),u_lightpos:new Tr(t),u_lightintensity:new ei(t),u_lightcolor:new Tr(t),u_vertical_gradient:new ei(t),u_height_factor:new ei(t),u_edge_radius:new ei(t),u_ao:new Pr(t),u_tile_id:new Tr(t),u_zoom_transition:new ei(t),u_inv_rot_matrix:new xr(t),u_merc_center:new Pr(t),u_up_dir:new Tr(t),u_height_lift:new ei(t),u_image:new Oi(t),u_texsize:new Pr(t),u_pixel_coord_upper:new Pr(t),u_pixel_coord_lower:new Pr(t),u_tile_units_to_pixels:new ei(t),u_opacity:new ei(t)}),fillExtrusionGroundEffect:t=>({u_matrix:new xr(t),u_opacity:new ei(t),u_ao_pass:new ei(t),u_meter_to_tile:new ei(t),u_ao:new Pr(t),u_flood_light_intensity:new ei(t),u_flood_light_color:new Tr(t),u_attenuation:new ei(t),u_edge_radius:new ei(t),u_fb:new Oi(t),u_fb_size:new ei(t)}),fill:t=>({u_matrix:new xr(t),u_emissive_strength:new ei(t)}),fillPattern:t=>({u_matrix:new xr(t),u_emissive_strength:new ei(t),u_image:new Oi(t),u_texsize:new Pr(t),u_pixel_coord_upper:new Pr(t),u_pixel_coord_lower:new Pr(t),u_tile_units_to_pixels:new ei(t)}),fillOutline:t=>({u_matrix:new xr(t),u_emissive_strength:new ei(t),u_world:new Pr(t)}),fillOutlinePattern:t=>({u_matrix:new xr(t),u_emissive_strength:new ei(t),u_world:new Pr(t),u_image:new Oi(t),u_texsize:new Pr(t),u_pixel_coord_upper:new Pr(t),u_pixel_coord_lower:new Pr(t),u_tile_units_to_pixels:new ei(t)}),circle:t=>({u_camera_to_center_distance:new ei(t),u_extrude_scale:new t0(t),u_device_pixel_ratio:new ei(t),u_matrix:new xr(t),u_inv_rot_matrix:new xr(t),u_merc_center:new Pr(t),u_tile_id:new Tr(t),u_zoom_transition:new ei(t),u_up_dir:new Tr(t),u_emissive_strength:new ei(t)}),collisionBox:t=>({u_matrix:new xr(t),u_camera_to_center_distance:new ei(t),u_extrude_scale:new Pr(t)}),collisionCircle:t=>({u_matrix:new xr(t),u_inv_matrix:new xr(t),u_camera_to_center_distance:new ei(t),u_viewport_size:new Pr(t)}),debug:t=>({u_color:new qA(t),u_matrix:new xr(t),u_overlay:new Oi(t),u_overlay_scale:new ei(t)}),clippingMask:t=>({u_matrix:new xr(t)}),heatmap:t=>({u_extrude_scale:new ei(t),u_intensity:new ei(t),u_matrix:new xr(t),u_inv_rot_matrix:new xr(t),u_merc_center:new Pr(t),u_tile_id:new Tr(t),u_zoom_transition:new ei(t),u_up_dir:new Tr(t)}),heatmapTexture:t=>({u_image:new Oi(t),u_color_ramp:new Oi(t),u_opacity:new ei(t)}),hillshade:t=>({u_matrix:new xr(t),u_image:new Oi(t),u_latrange:new Pr(t),u_light:new Pr(t),u_shadow:new qA(t),u_highlight:new qA(t),u_emissive_strength:new ei(t),u_accent:new qA(t)}),hillshadePrepare:t=>({u_matrix:new xr(t),u_image:new Oi(t),u_dimension:new Pr(t),u_zoom:new ei(t)}),line:t=>({u_matrix:new xr(t),u_pixels_to_tile_units:new t0(t),u_device_pixel_ratio:new ei(t),u_units_to_pixels:new Pr(t),u_dash_image:new Oi(t),u_gradient_image:new Oi(t),u_image_height:new ei(t),u_texsize:new Pr(t),u_tile_units_to_pixels:new ei(t),u_alpha_discard_threshold:new ei(t),u_trim_offset:new Pr(t),u_emissive_strength:new ei(t)}),linePattern:t=>({u_matrix:new xr(t),u_texsize:new Pr(t),u_pixels_to_tile_units:new t0(t),u_device_pixel_ratio:new ei(t),u_image:new Oi(t),u_units_to_pixels:new Pr(t),u_tile_units_to_pixels:new ei(t),u_alpha_discard_threshold:new ei(t)}),raster:t=>({u_matrix:new xr(t),u_normalize_matrix:new xr(t),u_globe_matrix:new xr(t),u_merc_matrix:new xr(t),u_grid_matrix:new e0(t),u_tl_parent:new Pr(t),u_scale_parent:new ei(t),u_fade_t:new ei(t),u_opacity:new ei(t),u_image0:new Oi(t),u_image1:new Oi(t),u_brightness_low:new ei(t),u_brightness_high:new ei(t),u_saturation_factor:new ei(t),u_contrast_factor:new ei(t),u_spin_weights:new Tr(t),u_perspective_transform:new Pr(t),u_raster_elevation:new ei(t),u_tl_br:new Bo(t),u_zoom_transition:new ei(t),u_merc_center:new Pr(t),u_cutoff_params:new Bo(t),u_colorization_mix:new Bo(t),u_colorization_offset:new ei(t),u_color_ramp:new Oi(t),u_texture_offset:new Pr(t),u_texture_res:new Pr(t),u_emissive_strength:new ei(t)}),symbolIcon:t=>({u_is_size_zoom_constant:new Oi(t),u_is_size_feature_constant:new Oi(t),u_size_t:new ei(t),u_size:new ei(t),u_camera_to_center_distance:new ei(t),u_rotate_symbol:new Oi(t),u_aspect_ratio:new ei(t),u_fade_change:new ei(t),u_matrix:new xr(t),u_label_plane_matrix:new xr(t),u_coord_matrix:new xr(t),u_is_text:new Oi(t),u_pitch_with_map:new Oi(t),u_texsize:new Pr(t),u_tile_id:new Tr(t),u_zoom_transition:new ei(t),u_inv_rot_matrix:new xr(t),u_merc_center:new Pr(t),u_camera_forward:new Tr(t),u_tile_matrix:new xr(t),u_up_vector:new Tr(t),u_ecef_origin:new Tr(t),u_texture:new Oi(t),u_icon_transition:new ei(t),u_icon_saturation:new ei(t)}),symbolSDF:t=>({u_is_size_zoom_constant:new Oi(t),u_is_size_feature_constant:new Oi(t),u_size_t:new ei(t),u_size:new ei(t),u_camera_to_center_distance:new ei(t),u_rotate_symbol:new Oi(t),u_aspect_ratio:new ei(t),u_fade_change:new ei(t),u_matrix:new xr(t),u_label_plane_matrix:new xr(t),u_coord_matrix:new xr(t),u_is_text:new Oi(t),u_pitch_with_map:new Oi(t),u_texsize:new Pr(t),u_texture:new Oi(t),u_gamma_scale:new ei(t),u_device_pixel_ratio:new ei(t),u_tile_id:new Tr(t),u_zoom_transition:new ei(t),u_inv_rot_matrix:new xr(t),u_merc_center:new Pr(t),u_camera_forward:new Tr(t),u_tile_matrix:new xr(t),u_up_vector:new Tr(t),u_ecef_origin:new Tr(t),u_is_halo:new Oi(t)}),symbolTextAndIcon:t=>({u_is_size_zoom_constant:new Oi(t),u_is_size_feature_constant:new Oi(t),u_size_t:new ei(t),u_size:new ei(t),u_camera_to_center_distance:new ei(t),u_rotate_symbol:new Oi(t),u_aspect_ratio:new ei(t),u_fade_change:new ei(t),u_matrix:new xr(t),u_label_plane_matrix:new xr(t),u_coord_matrix:new xr(t),u_is_text:new Oi(t),u_pitch_with_map:new Oi(t),u_texsize:new Pr(t),u_texsize_icon:new Pr(t),u_texture:new Oi(t),u_texture_icon:new Oi(t),u_gamma_scale:new ei(t),u_device_pixel_ratio:new ei(t),u_is_halo:new Oi(t)}),background:t=>({u_matrix:new xr(t),u_emissive_strength:new ei(t),u_opacity:new ei(t),u_color:new qA(t)}),backgroundPattern:t=>({u_matrix:new xr(t),u_emissive_strength:new ei(t),u_opacity:new ei(t),u_image:new Oi(t),u_pattern_tl:new Pr(t),u_pattern_br:new Pr(t),u_texsize:new Pr(t),u_pattern_size:new Pr(t),u_pixel_coord_upper:new Pr(t),u_pixel_coord_lower:new Pr(t),u_tile_units_to_pixels:new ei(t)}),terrainRaster:db,terrainDepth:db,skybox:t=>({u_matrix:new xr(t),u_sun_direction:new Tr(t),u_cubemap:new Oi(t),u_opacity:new ei(t),u_temporal_offset:new ei(t)}),skyboxGradient:t=>({u_matrix:new xr(t),u_color_ramp:new Oi(t),u_center_direction:new Tr(t),u_radius:new ei(t),u_opacity:new ei(t),u_temporal_offset:new ei(t)}),skyboxCapture:t=>({u_matrix_3f:new e0(t),u_sun_direction:new Tr(t),u_sun_intensity:new ei(t),u_color_tint_r:new Bo(t),u_color_tint_m:new Bo(t),u_luminance:new ei(t)}),globeRaster:t=>({u_proj_matrix:new xr(t),u_globe_matrix:new xr(t),u_normalize_matrix:new xr(t),u_merc_matrix:new xr(t),u_zoom_transition:new ei(t),u_merc_center:new Pr(t),u_image0:new Oi(t),u_grid_matrix:new e0(t),u_skirt_height:new ei(t),u_frustum_tl:new Tr(t),u_frustum_tr:new Tr(t),u_frustum_br:new Tr(t),u_frustum_bl:new Tr(t),u_globe_pos:new Tr(t),u_globe_radius:new ei(t),u_viewport:new Pr(t)}),globeAtmosphere:t=>({u_frustum_tl:new Tr(t),u_frustum_tr:new Tr(t),u_frustum_br:new Tr(t),u_frustum_bl:new Tr(t),u_horizon:new ei(t),u_transition:new ei(t),u_fadeout_range:new ei(t),u_color:new Bo(t),u_high_color:new Bo(t),u_space_color:new Bo(t),u_temporal_offset:new ei(t),u_horizon_angle:new ei(t)}),model:t=>({u_matrix:new xr(t),u_lighting_matrix:new xr(t),u_normal_matrix:new xr(t),u_lightpos:new Tr(t),u_lightintensity:new ei(t),u_lightcolor:new Tr(t),u_camera_pos:new Tr(t),u_opacity:new ei(t),u_baseColorFactor:new Bo(t),u_emissiveFactor:new Bo(t),u_metallicFactor:new ei(t),u_roughnessFactor:new ei(t),u_baseTextureIsAlpha:new Oi(t),u_alphaMask:new Oi(t),u_alphaCutoff:new ei(t),u_baseColorTexture:new Oi(t),u_metallicRoughnessTexture:new Oi(t),u_normalTexture:new Oi(t),u_occlusionTexture:new Oi(t),u_emissionTexture:new Oi(t),u_color_mix:new Bo(t),u_aoIntensity:new ei(t),u_emissive_strength:new ei(t)}),modelDepth:t=>({u_matrix:new xr(t),u_instance:new xr(t),u_node_matrix:new xr(t)}),groundShadow:t=>({u_matrix:new xr(t),u_ground_shadow_factor:new Tr(t)}),stars:t=>({u_matrix:new xr(t),u_up:new Tr(t),u_right:new Tr(t),u_intensity_multiplier:new ei(t)})};let m_;function Bb(t,e,i,r,n,s,a){const c=t.context,p=c.gl,_=t.transform,v=t.getOrCreateProgram("collisionBox"),E=[];let C=0,B=0;for(let ne=0;ne<r.length;ne++){const ie=r[ne],se=e.getTile(ie),he=se.getBucket(i);if(!he)continue;const ve=KE(ie,he,_);let be=ve;n[0]===0&&n[1]===0||(be=t.translatePosMatrix(ve,se,n,s));const De=a?he.textCollisionBox:he.iconCollisionBox,Ve=he.collisionCircleArray;if(Ve.length>0){const je=ce.create(),Je=be;ce.mul(je,he.placementInvProjMatrix,_.glCoordMatrix),ce.mul(je,je,he.placementViewportMatrix),E.push({circleArray:Ve,circleOffset:B,transform:Je,invTransform:je,projection:he.getProjection()}),C+=Ve.length/4,B=C}De&&(t.terrain&&t.terrain.setupElevationDraw(se,v),v.draw(t,p.LINES,lr.disabled,Br.disabled,t.colorModeForRenderPass(),Fr.disabled,DM(be,_,se,he.getProjection()),i.id,De.layoutVertexBuffer,De.indexBuffer,De.segments,null,_.zoom,null,[De.collisionVertexBuffer,De.collisionVertexBufferExt]))}if(!a||!E.length)return;const O=t.getOrCreateProgram("collisionCircle"),G=new Zd;G.resize(4*C),G._trim();let q=0;for(const ne of E)for(let ie=0;ie<ne.circleArray.length/4;ie++){const se=4*ie,he=ne.circleArray[se+0],ve=ne.circleArray[se+1],be=ne.circleArray[se+2],De=ne.circleArray[se+3];G.emplace(q++,he,ve,be,De,0),G.emplace(q++,he,ve,be,De,1),G.emplace(q++,he,ve,be,De,2),G.emplace(q++,he,ve,be,De,3)}(!m_||m_.length<2*C)&&(m_=function(ne){const ie=2*ne,se=new so;se.resize(ie),se._trim();for(let he=0;he<ie;he++){const ve=6*he;se.uint16[ve+0]=4*he+0,se.uint16[ve+1]=4*he+1,se.uint16[ve+2]=4*he+2,se.uint16[ve+3]=4*he+2,se.uint16[ve+4]=4*he+3,se.uint16[ve+5]=4*he+0}return se}(C));const X=c.createIndexBuffer(m_,!0),$=c.createVertexBuffer(G,A3.members,!0);for(const ne of E){const ie={u_matrix:ne.transform,u_inv_matrix:ne.invTransform,u_camera_to_center_distance:(re=_).getCameraToCenterDistance(ne.projection),u_viewport_size:[re.width,re.height]};O.draw(t,p.TRIANGLES,lr.disabled,Br.disabled,t.colorModeForRenderPass(),Fr.disabled,ie,i.id,$,X,Mn.simpleSegment(0,2*ne.circleOffset,ne.circleArray.length,ne.circleArray.length/2),null,_.zoom)}var re;$.destroy(),X.destroy()}const Lb=ce.create();function VM({width:t,height:e,anchor:i,textOffset:r,textScale:n},s){const{horizontalAlign:a,verticalAlign:c}=Dm(i),p=-(a-.5)*t,_=-(c-.5)*e,v=zg(i,r);return new ct((p/n+v[0])*s,(_/n+v[1])*s)}function jM(t,e,i,r,n,s,a,c,p,_,v){const E=t.text.placedSymbolArray,C=t.text.dynamicLayoutVertexArray,B=t.icon.dynamicLayoutVertexArray,O={},G=t.getProjection(),q=py(c,G,s),X=s.elevation,$=G.upVectorScale(c.canonical,s.center.lat,s.worldSize).metersToTile;C.clear();for(let re=0;re<E.length;re++){const ne=E.get(re),{tileAnchorX:ie,tileAnchorY:se,numGlyphs:he}=ne,ve=ne.hidden||!ne.crossTileID||t.allowVerticalPlacement&&!ne.placedOrientation?null:r[ne.crossTileID];if(ve){let be=0,De=0,Ve=0;if(X){const wt=X?X.getAtTileOffset(c,ie,se):0,[It,St,Bt]=G.upVector(c.canonical,ie,se);be=wt*It*$,De=wt*St*$,Ve=wt*Bt*$}let[je,Je,Fe,nt]=ru(ne.projectedAnchorX+be,ne.projectedAnchorY+De,ne.projectedAnchorZ+Ve,i?q:a);const At=Ex(s.getCameraToCenterDistance(G),nt);let vt=n.evaluateSizeForFeature(t.textSizeData,_,ne)*At/va;i&&(vt*=t.tilePixelRatio/p);const rt=VM(ve,vt);i?({x:je,y:Je,z:Fe}=G.projectTilePoint(ie+rt.x,se+rt.y,c.canonical),[je,Je,Fe]=ru(je+be,Je+De,Fe+Ve,a)):(e&&rt._rotate(-s.angle),je+=rt.x,Je+=rt.y,Fe=0);const lt=t.allowVerticalPlacement&&ne.placedOrientation===Ms.vertical?Math.PI/2:0;for(let wt=0;wt<he;wt++)ud(C,je,Je,Fe,lt);v&&ne.associatedIconIndex>=0&&(O[ne.associatedIconIndex]={x:je,y:Je,z:Fe,angle:lt})}else fd(he,C)}if(v){B.clear();const re=t.icon.placedSymbolArray;for(let ne=0;ne<re.length;ne++){const ie=re.get(ne),{numGlyphs:se}=ie,he=O[ne];if(ie.hidden||!he)fd(se,B);else{const{x:ve,y:be,z:De,angle:Ve}=he;for(let je=0;je<se;je++)ud(B,ve,be,De,Ve)}}t.icon.dynamicLayoutVertexBuffer.updateData(B)}t.text.dynamicLayoutVertexBuffer.updateData(C)}function GM(t,e,i){return i.iconsInText&&e?"symbolTextAndIcon":t?"symbolSDF":"symbolIcon"}function Rb(t,e,i,r,n,s,a,c,p,_,v,E,C){const B=t.context,O=B.gl,G=t.transform,q=c==="map",X=p==="map",$=q&&i.layout.get("symbol-placement")!=="point",re=q&&!X&&!$,ne=i.layout.get("symbol-sort-key").constantOr(1)!==void 0;let ie=!1;const se=t.depthModeForSublayer(0,lr.ReadOnly),he=[Wo(G.center.lng),oa(G.center.lat)],ve=i.layout.get("text-variable-anchor"),be=G.projection.name==="globe",De=[],Ve=[0,-1,0];let je=Ve;!be&&!G.mercatorFromTransition||q||(je=function(Je){const Fe=Je._camera.getWorldToCamera(Je.worldSize,1),nt=ce.multiply([],Fe,Je.globeMatrix);ce.invert(nt,nt);const At=[0,0,0],vt=[0,1,0,0];return V.transformMat4(vt,vt,nt),At[0]=vt[0],At[1]=vt[1],At[2]=vt[2],me.normalize(At,At),At}(G));for(const Je of r){const Fe=e.getTile(Je),nt=Fe.getBucket(i);if(!nt||nt.projection.name==="mercator"&&be)continue;const At=n?nt.text:nt.icon;if(!At||nt.fullyClipped||!At.segments.get().length)continue;const vt=At.programConfigurations.get(i.id),rt=n||nt.sdfIcons,lt=n?nt.textSizeData:nt.iconSizeData,wt=X||G.pitch!==0,It=xu(lt,G.zoom);let St,Bt,Ft,jt,Dt=[0,0],Yt=null;if(n)Bt=Fe.glyphAtlasTexture?Fe.glyphAtlasTexture:null,Ft=O.LINEAR,St=Fe.glyphAtlasTexture?Fe.glyphAtlasTexture.size:[0,0],nt.iconsInText&&(Dt=Fe.imageAtlasTexture?Fe.imageAtlasTexture.size:[0,0],Yt=Fe.imageAtlasTexture?Fe.imageAtlasTexture:null,jt=wt||t.options.rotating||t.options.zooming||lt.kind==="composite"||lt.kind==="camera"?O.LINEAR:O.NEAREST);else{const vs=i.layout.get("icon-size").constantOr(0)!==1||nt.iconsNeedLinear;Bt=Fe.imageAtlasTexture?Fe.imageAtlasTexture:null,Ft=rt||t.options.rotating||t.options.zooming||vs||wt?O.LINEAR:O.NEAREST,St=Fe.imageAtlasTexture?Fe.imageAtlasTexture.size:[0,0]}const fi=nt.projection.name==="globe",di=fi?je:Ve,vi=fi?Ho(G.zoom):0,bi=py(Je,nt.getProjection(),G),Ar=G.calculatePixelsToTileUnitsMatrix(Fe),Ni=Ym(bi,Fe.tileID.canonical,X,q,G,nt.getProjection(),Ar),rn=t.terrain&&X&&$?ce.invert(ce.create(),Ni):Lb,Vr=Tx(bi,Fe.tileID.canonical,X,q,G,nt.getProjection(),Ar),cr=ve&&nt.hasTextData(),rr=nt.hasIconTextFit()&&cr&&nt.hasIconData();if($){const vs=G.elevation,Ln=vs?vs.getAtTileOffsetFunc(Je,G.center.lat,G.worldSize,nt.getProjection()):null,Ua=wx(bi,Fe.tileID.canonical,X,q,G,nt.getProjection(),Ar);VT(nt,bi,t,n,Ua,Vr,X,_,Ln,Je)}const Hi=$||n&&ve||rr,Zr=t.translatePosMatrix(bi,Fe,s,a),Kr=Hi?Lb:Ni,zr=t.translatePosMatrix(Vr,Fe,s,a,!0),Gn=nt.getProjection().createInversionMatrix(G,Je.canonical),ao=i.paint.get("icon-image-cross-fade").constantOr(0),On=[];t.terrainRenderModeElevated()&&X&&On.push("PITCH_WITH_MAP_TERRAIN"),fi&&(On.push("PROJECTION_GLOBE_VIEW"),Hi&&On.push("PROJECTED_POS_ON_VIEWPORT")),ao>0&&On.push("ICON_TRANSITION"),At.zOffsetVertexBuffer&&On.push("Z_OFFSET");const ds=rt&&i.paint.get(n?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let go;rt?go=nt.iconsInText?FM(lt.kind,It,re,X,t,Zr,Kr,zr,St,Dt,Je,vi,he,Gn,di,nt.getProjection()):Db(lt.kind,It,re,X,t,Zr,Kr,zr,n,St,!0,Je,vi,he,Gn,di,nt.getProjection()):(v<1&&On.push("SATURATION"),go=kb(lt.kind,It,re,X,t,Zr,Kr,zr,n,St,Je,vi,he,Gn,di,nt.getProjection(),v,ao));const lo={program:t.getOrCreateProgram(GM(rt,n,nt),{config:vt,defines:On}),buffers:At,uniformValues:go,atlasTexture:Bt,atlasTextureIcon:Yt,atlasInterpolation:Ft,atlasInterpolationIcon:jt,isSDF:rt,hasHalo:ds,tile:Fe,labelPlaneMatrixInv:rn};if(ne&&nt.canOverlap){ie=!0;const vs=At.segments.get();for(const Ln of vs)De.push({segments:new Mn([Ln]),sortKey:Ln.sortKey,state:lo})}else De.push({segments:At.segments,sortKey:0,state:lo})}ie&&De.sort((Je,Fe)=>Je.sortKey-Fe.sortKey);for(const Je of De){const Fe=Je.state;if(t.terrain&&t.terrain.setupElevationDraw(Fe.tile,Fe.program,{useDepthForOcclusion:G.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Fe.labelPlaneMatrixInv}),B.activeTexture.set(O.TEXTURE0),Fe.atlasTexture&&Fe.atlasTexture.bind(Fe.atlasInterpolation,O.CLAMP_TO_EDGE),Fe.atlasTextureIcon&&(B.activeTexture.set(O.TEXTURE1),Fe.atlasTextureIcon&&Fe.atlasTextureIcon.bind(Fe.atlasInterpolationIcon,O.CLAMP_TO_EDGE)),t.uploadCommonLightUniforms(t.context,Fe.program),Fe.hasHalo){const nt=Fe.uniformValues;nt.u_is_halo=1,wy(Fe.buffers,Je.segments,i,t,Fe.program,se,E,C,nt,2),nt.u_is_halo=0}else{if(Fe.isSDF){const nt=Fe.uniformValues;Fe.hasHalo&&(nt.u_is_halo=1,wy(Fe.buffers,Je.segments,i,t,Fe.program,se,E,C,nt,1)),nt.u_is_halo=0}wy(Fe.buffers,Je.segments,i,t,Fe.program,se,E,C,Fe.uniformValues,1)}}}function wy(t,e,i,r,n,s,a,c,p,_){const v=[t.dynamicLayoutVertexBuffer,t.opacityVertexBuffer,t.iconTransitioningVertexBuffer,t.globeExtVertexBuffer,t.zOffsetVertexBuffer];n.draw(r,r.context.gl.TRIANGLES,s,a,c,Fr.disabled,p,i.id,t.layoutVertexBuffer,t.indexBuffer,e,i.paint,r.transform.zoom,t.programConfigurations.get(i.id),v,_)}function Fb(t,e,i,r,n,s,a){const c=t.context.gl,p=i.paint.get("fill-pattern"),_=p&&p.constantOr(1);let v,E,C,B,O;a?(E=_&&!i.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",v=c.LINES):(E=_?"fillPattern":"fill",v=c.TRIANGLES);for(const G of r){const q=e.getTile(G);if(_&&!q.patternsLoaded())continue;const X=q.getBucket(i);if(!X)continue;t.prepareDrawTile();const $=X.programConfigurations.get(i.id),re=t.isTileAffectedByFog(G),ne=t.getOrCreateProgram(E,{config:$,overrideFog:re});_&&(t.context.activeTexture.set(c.TEXTURE0),q.imageAtlasTexture&&q.imageAtlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE),$.updatePaintBuffers());const ie=p.constantOr(null);if(ie&&q.imageAtlas){const ve=q.imageAtlas.patternPositions[ie.toString()];ve&&$.setConstantPatternPositions(ve)}const se=t.translatePosMatrix(G.projMatrix,q,i.paint.get("fill-translate"),i.paint.get("fill-translate-anchor")),he=i.paint.get("fill-emissive-strength");if(a){B=X.indexBuffer2,O=X.segments2;const ve=t.terrain&&t.terrain.renderingToTexture?t.terrain.drapeBufferSize:[c.drawingBufferWidth,c.drawingBufferHeight];C=E==="fillOutlinePattern"&&_?kM(se,he,t,q,ve):CM(se,he,ve)}else B=X.indexBuffer,O=X.segments,C=_?Mb(se,he,t,q):Eb(se,he);t.uploadCommonUniforms(t.context,ne,G.toUnwrapped()),ne.draw(t,v,n,t.stencilModeForClipping(G),s,Fr.disabled,C,i.id,X.layoutVertexBuffer,B,O,i.paint,t.transform.zoom,$,void 0)}}function __(t,e,i,r,n,s,a,c){i.resetLayerRenderingStats();const p=t.context,_=p.gl,v=t.transform,E=i.paint.get("fill-extrusion-pattern"),C=E.constantOr(1),B=i.paint.get("fill-extrusion-opacity"),O=t.style.enable3dLights(),G=i.paint.get(O&&!C?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),q=[i.paint.get("fill-extrusion-ambient-occlusion-intensity"),G],X=i.layout.get("fill-extrusion-edge-radius"),$=X>0&&!i.paint.get("fill-extrusion-rounded-roof"),re=$?0:X,ne=v.projection.name==="globe"?ov():0,ie=v.projection.name==="globe",se=ie?Ho(v.zoom):0,he=[Wo(v.center.lng),oa(v.center.lat)],ve=i.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),be=i.paint.get("fill-extrusion-flood-light-intensity"),De=i.paint.get("fill-extrusion-vertical-scale"),Ve=md(t,i.paint.get("fill-extrusion-cutoff-fade-range")),je=i.paint.get("fill-extrusion-emissive-strength"),Je=[];let Fe;ie&&Je.push("PROJECTION_GLOBE_VIEW"),q[0]>0&&Je.push("FAUX_AO"),$&&Je.push("ZERO_ROOF_RADIUS"),c&&Je.push("HAS_CENTROID"),be>0&&Je.push("FLOOD_LIGHT"),Ve.shouldRenderCutoff&&Je.push("RENDER_CUTOFF");const nt=t.renderPass==="shadow",At=t.shadowRenderer,vt=nt&&!!At;t.shadowRenderer&&(t.shadowRenderer.useNormalOffset=!0);let rt=[0,0,0];if(At){const It=t.style.directionalLight,St=t.style.ambientLight;It&&St&&(rt=My(It,St)),Fe=Je.concat(["SHADOWS_SINGLE_CASCADE"])}const lt=vt?"fillExtrusionDepth":C?"fillExtrusionPattern":"fillExtrusion",wt=i.getLayerRenderingStats();for(const It of r){const St=e.getTile(It),Bt=St.getBucket(i);if(!Bt||Bt.projection.name!==v.projection.name)continue;let Ft=!1;At&&(Ft=At.getMaxCascadeForTile(It.toUnwrapped())===0);const jt=t.isTileAffectedByFog(It),Dt=Bt.programConfigurations.get(i.id),Yt=t.getOrCreateProgram(lt,{config:Dt,defines:Ft?Fe:Je,overrideFog:jt});if(t.terrain&&t.terrain.setupElevationDraw(St,Yt,{useMeterToDem:!0}),!Bt.centroidVertexBuffer){const Ni=Yt.attributes.a_centroid_pos;Ni!==void 0&&_.vertexAttrib2f(Ni,0,0)}!nt&&At&&At.setupShadows(St.tileID.toUnwrapped(),Yt,"vector-tile",St.tileID.overscaledZ),C&&(t.context.activeTexture.set(_.TEXTURE0),St.imageAtlasTexture&&St.imageAtlasTexture.bind(_.LINEAR,_.CLAMP_TO_EDGE),Dt.updatePaintBuffers());const fi=E.constantOr(null);if(fi&&St.imageAtlas){const Ni=St.imageAtlas.patternPositions[fi.toString()];Ni&&Dt.setConstantPatternPositions(Ni)}const di=i.paint.get("fill-extrusion-vertical-gradient");let vi;if(nt&&At){if(WM(St.tileID,Bt,t))continue;const Ni=At.calculateShadowPassMatrixFromTile(St.tileID.toUnwrapped());vi=SM(Ni,re,De)}else{const Ni=t.translatePosMatrix(It.expandedProjMatrix,St,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),rn=v.projection.createInversionMatrix(v,It.canonical);vi=C?IM(Ni,t,di,B,q,re,It,St,ne,se,he,rn,ve,De):Tb(Ni,t,di,B,q,re,It,ne,se,he,rn,ve,De,be,rt,je)}t.uploadCommonUniforms(p,Yt,It.toUnwrapped(),null,Ve);let bi=Bt.segments;if(v.projection.name==="mercator"&&!nt&&(bi=Bt.getVisibleSegments(St.tileID,t.terrain,t.transform.getFrustum(0)),!bi.get().length))continue;if(wt)if(nt)for(const Ni of bi.get())wt.numRenderedVerticesInShadowPass+=Ni.primitiveLength;else for(const Ni of bi.get())wt.numRenderedVerticesInTransparentPass+=Ni.primitiveLength;const Ar=[];(t.terrain||c)&&Ar.push(Bt.centroidVertexBuffer),ie&&Ar.push(Bt.layoutVertexExtBuffer),Yt.draw(t,p.gl.TRIANGLES,n,s,a,Fr.backCCW,vi,i.id,Bt.layoutVertexBuffer,Bt.indexBuffer,bi,i.paint,t.transform.zoom,Dt,Ar)}t.shadowRenderer&&(t.shadowRenderer.useNormalOffset=!1)}function gd(t,e,i,r,n,s,a,c,p,_,v,E,C,B,O,G,q,X,$){const re=t.context,ne=re.gl,ie=t.transform,se=t.transform.zoom,he=[],ve=md(t,i.paint.get("fill-extrusion-cutoff-fade-range"));_==="clear"?(he.push("CLEAR_SUBPASS"),$&&(he.push("CLEAR_FROM_TEXTURE"),re.activeTexture.set(ne.TEXTURE0),$.bind(ne.LINEAR,ne.CLAMP_TO_EDGE))):_==="sdf"&&he.push("SDF_SUBPASS"),q&&he.push("HAS_CENTROID"),ve.shouldRenderCutoff&&he.push("RENDER_CUTOFF");const be=i.layout.get("fill-extrusion-edge-radius"),De=(Ve,je,Je,Fe,nt)=>{const At=je.programConfigurations.get(i.id),vt=t.isTileAffectedByFog(Ve),rt=t.getOrCreateProgram("fillExtrusionGroundEffect",{config:At,defines:he,overrideFog:vt}),lt=((It,St,Bt,Ft,jt,Dt,Yt,fi,di,vi,bi)=>({u_matrix:St,u_opacity:Bt,u_ao_pass:Ft?1:0,u_meter_to_tile:jt,u_ao:Dt,u_flood_light_intensity:Yt,u_flood_light_color:fi,u_attenuation:di,u_edge_radius:vi,u_fb:0,u_fb_size:bi}))(0,Fe,v,p,nt,[E,C*nt],B,O,G,se>=17?0:be*nt,$?$.size[0]:0),wt=[];q&&wt.push(je.hiddenByLandmarkVertexBuffer),t.uploadCommonUniforms(re,rt,Ve.toUnwrapped(),null,ve),rt.draw(t,re.gl.TRIANGLES,n,s,a,c,lt,i.id,je.vertexBuffer,je.indexBuffer,Je,i.paint,se,At,wt)};for(const Ve of r){const je=e.getTile(Ve),Je=je.getBucket(i);if(!Je||Je.projection.name!==ie.projection.name||!Je.groundEffect||Je.groundEffect&&!Je.groundEffect.hasData())continue;const Fe=Je.groundEffect,nt=1/Je.tileToMeter;{const At=t.translatePosMatrix(Ve.projMatrix,je,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),vt=Fe.getDefaultSegment();De(Ve,Fe,vt,At,nt)}if(X)for(let At=0;At<4;At++){const vt=Ts[At](Ve),rt=e.getTile(vt);if(!rt)continue;const lt=rt.getBucket(i);if(!lt||lt.projection.name!==ie.projection.name||!lt.groundEffect||lt.groundEffect&&!lt.groundEffect.hasData())continue;const wt=lt.groundEffect;let It,St;At===0?(It=[-Mt,0,0],St=1):At===1?(It=[Mt,0,0],St=0):At===2?(It=[0,-Mt,0],St=3):(It=[0,Mt,0],St=2);const Bt=wt.regionSegments[St];if(!Bt)continue;const Ft=new Float32Array(16);ce.translate(Ft,Ve.projMatrix,It),De(Ve,wt,Bt,t.translatePosMatrix(Ft,je,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),nt)}}}function ZM(t,e,i,r,n,s,a){r.centroidVertexArray.length===0&&r.createCentroidsBuffer();const c=s?s.findDEMTileFor(i):null;if(!(c&&c.dem||a))return;const p=X=>{const $=e.getSource().minzoom,re=ie=>{const se=e.getTileByID(ie);if(se&&se.hasData())return se.getBucket(n)},ne=[0,-1,1];for(const ie of ne){if(X.overscaledZ+ie<$)continue;const se=re(X.calculateScaledKey(X.overscaledZ+ie));if(se)return se}},_=[0,0,0],v=(X,$)=>(_[0]=Math.min(X.min.y,$.min.y),_[1]=Math.max(X.max.y,$.max.y),_[2]=Mt-$.min.x>X.max.x?$.min.x-Mt:X.max.x,_),E=(X,$)=>(_[0]=Math.min(X.min.x,$.min.x),_[1]=Math.max(X.max.x,$.max.x),_[2]=Mt-$.min.y>X.max.y?$.min.y-Mt:X.max.y,_),C=[(X,$)=>v(X,$),(X,$)=>v($,X),(X,$)=>E(X,$),(X,$)=>E($,X)],B=(X,$,re,ne,ie,se,he)=>{if(!s)return 0;const ve=[[se?re:X,se?X:re,0],[se?re:$,se?$:re,0]],be=he<0?Mt+he:he,De=[se?be:(X+$)/2,se?(X+$)/2:be,0];return re===0&&he<0||re!==0&&he>0?s.getForTilePoints(ie,[De],!0,ne):ve.push(De),s.getForTilePoints(i,ve,!0,c),Math.max(ve[0][2],ve[1][2],De[2])/s.exaggeration()};for(let X=0;X<4;X++){const $=r.borderFeatureIndices[X];if($.length===0)continue;const re=Ts[X](i),ne=p(re);if(!(ne&&ne instanceof Y0)||r.borderDoneWithNeighborZ[X]===ne.canonical.z)continue;ne.centroidVertexArray.length===0&&ne.createCentroidsBuffer();const ie=s?s.findDEMTileFor(re):null;if(!(ie&&ie.dem||a))continue;const se=(X<2?1:5)-X,he=ne.borderDoneWithNeighborZ[se]!==r.canonical.z,ve=ne.borderFeatureIndices[se];let be=0;if(r.canonical.z!==ne.canonical.z){for(const De of $)r.showCentroid(r.featuresOnBorder[De]);if(he)for(const De of ve)ne.showCentroid(ne.featuresOnBorder[De]);r.borderDoneWithNeighborZ[X]=ne.canonical.z,ne.borderDoneWithNeighborZ[se]=r.canonical.z}for(const De of $){const Ve=r.featuresOnBorder[De],je=r.centroidData[Ve.centroidDataIndex],Je=Ve.borders[X];let Fe;for(;be<ve.length;){Fe=ne.featuresOnBorder[ve[be]];const nt=Fe.borders[se];if(nt[1]>Je[0]+3||nt[0]>Je[0]-3)break;ne.showCentroid(Fe),be++}if(Fe&&be<ve.length){const nt=be;let At=0;for(;!(Fe.borders[se][0]>Je[1]-3)&&(At++,++be!==ve.length);)Fe=ne.featuresOnBorder[ve[be]];if(Fe=ne.featuresOnBorder[ve[nt]],At>1){const lt=Fe.borders[se];Math.abs(Je[0]-lt[0])<3&&Math.abs(Je[1]-lt[1])<3&&(At=1,be=nt+1)}else if(At===0){r.showCentroid(Ve);continue}const vt=ne.centroidData[Fe.centroidDataIndex];a&&At===1&&(((G=je).flags|(q=vt).flags)&wu?(G.flags|=wu,q.flags|=wu):(G.flags&=2147483647,q.flags&=2147483647));let rt=new ct(0,0);if(At>1)be=nt;else if(ie&&ie.dem&&!(Ve.intersectsCount()>1||Fe.intersectsCount()>1)){const lt=C[X](je,vt),wt=X%2?Mt-1:0;O=B(lt[0],Math.min(Mt-1,lt[1]),wt,ie,re,X<2,lt[2]),rt=new ct(Math.ceil(7*(O+450)),0)}je.centroidXY=vt.centroidXY=rt,r.writeCentroidToBuffer(je),ne.writeCentroidToBuffer(vt)}else r.showCentroid(Ve)}r.borderDoneWithNeighborZ[X]=ne.canonical.z,ne.borderDoneWithNeighborZ[se]=r.canonical.z}var O,G,q;(r.needsCentroidUpdate||!r.centroidVertexBuffer&&r.centroidVertexArray.length!==0)&&r.uploadCentroid(t)}const qM=[1,0,0],QM=[0,1,0],HM=[0,0,1];function WM(t,e,i){const r=i.transform,n=i.shadowRenderer;if(!n)return!0;const s=t.toUnwrapped(),a=r.tileSize*n._cascades[i.currentShadowCascade].scale;let c=e.maxHeight;if(r.elevation){const G=r.elevation.getMinMaxForTile(t);G&&(c+=G.max)}const p=[...n.shadowDirection];p[2]=-p[2];const _=n.computeSimplifiedTileShadowVolume(s,c,a,p);if(!_)return!1;const v=[qM,QM,HM,p,[p[0],0,p[2]],[0,p[1],p[2]]],E=r.projection.name==="globe",C=r.scaleZoom(a),B=Xs.fromInvProjectionMatrix(r.invProjMatrix,r.worldSize,C,!E),O=n.getCurrentCascadeFrustum();return B.intersectsPrecise(_.vertices,_.planes,v)===0||O.intersectsPrecise(_.vertices,_.planes,v)===0}function XM(t){const e=t._nearZ,i=t.projection.farthestPixelDistance(t),r=i-e,n=.2*t.height,s=e+n;return[e,i,(s-n-e)/r,(s-e)/r]}const YM=new fr(1,0,0,1),KM=new fr(0,1,0,1),JM=new fr(0,0,1,1),$M=new fr(1,0,1,1),e4=new fr(0,1,1,1);function t4(t,e,i){const r=t.context,n=t.transform,s=r.gl,a=n.projection.name==="globe",c=a?["PROJECTION_GLOBE_VIEW"]:[];let p=i.projMatrix;if(a&&Ho(n.zoom)>0){const De=Kf(TA(i.canonical,n));p=ce.multiply(new Float32Array(16),n.globeMatrix,De),ce.multiply(p,n.projMatrix,p)}const _=t.getOrCreateProgram("debug",{defines:c}),v=e.getTileByID(i.key);t.terrain&&t.terrain.setupElevationDraw(v,_);const E=lr.disabled,C=Br.disabled,B=t.colorModeForRenderPass(),O="$debug";r.activeTexture.set(s.TEXTURE0),t.emptyTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE),a?v._makeGlobeTileDebugBuffers(t.context,n):v._makeDebugTileBoundsBuffers(t.context,n.projection);const G=v._tileDebugBuffer||t.debugBuffer,q=v._tileDebugIndexBuffer||t.debugIndexBuffer,X=v._tileDebugSegments||t.debugSegments;_.draw(t,s.LINE_STRIP,E,C,B,Fr.disabled,Sb(p,fr.red),O,G,q,X,null,null,null,[v._globeTileDebugBorderBuffer]);const $=v.latestRawTileData,re=Math.floor(($&&$.byteLength||0)/1024),ne=e.getTile(i).tileSize,ie=512/Math.min(ne,512)*(i.overscaledZ/n.zoom)*.5;let se=i.canonical.toString();i.overscaledZ!==i.canonical.z&&(se+=` => ${i.overscaledZ}`),se+=` ${re}kb`,function(De,Ve){De.initDebugOverlayCanvas();const je=De.debugOverlayCanvas,Je=De.context.gl,Fe=De.debugOverlayCanvas.getContext("2d");Fe.clearRect(0,0,je.width,je.height),Fe.shadowColor="white",Fe.shadowBlur=2,Fe.lineWidth=1.5,Fe.strokeStyle="white",Fe.textBaseline="top",Fe.font="bold 36px Open Sans, sans-serif",Fe.fillText(Ve,5,5),Fe.strokeText(Ve,5,5),De.debugOverlayTexture.update(je),De.debugOverlayTexture.bind(Je.LINEAR,Je.CLAMP_TO_EDGE)}(t,se);const he=v._tileDebugTextBuffer||t.debugBuffer,ve=v._tileDebugTextIndexBuffer||t.quadTriangleIndexBuffer,be=v._tileDebugTextSegments||t.debugSegments;_.draw(t,s.TRIANGLES,E,C,An.alphaBlended,Fr.disabled,Sb(p,fr.transparent,ie),O,he,ve,be,null,null,null,[v._globeTileDebugTextBuffer])}function Ob(t,e,i,r){g_(t,0,e+i/2,t.transform.width,i,r)}function Nb(t,e,i,r){g_(t,e-i/2,0,i,t.transform.height,r)}function g_(t,e,i,r,n,s){const a=t.context,c=a.gl;c.enable(c.SCISSOR_TEST),c.scissor(e*Wi.devicePixelRatio,i*Wi.devicePixelRatio,r*Wi.devicePixelRatio,n*Wi.devicePixelRatio),a.clear({color:s}),c.disable(c.SCISSOR_TEST)}const i4=an([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:r4}=i4;function Mh(t,e,i,r){t.emplaceBack(e,i,r)}class Ub{constructor(e){this.vertexArray=new Zc,this.indices=new so,Mh(this.vertexArray,-1,-1,1),Mh(this.vertexArray,1,-1,1),Mh(this.vertexArray,-1,1,1),Mh(this.vertexArray,1,1,1),Mh(this.vertexArray,-1,-1,-1),Mh(this.vertexArray,1,-1,-1),Mh(this.vertexArray,-1,1,-1),Mh(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=e.createVertexBuffer(this.vertexArray,r4),this.indexBuffer=e.createIndexBuffer(this.indices),this.segment=Mn.simpleSegment(0,0,36,12)}}function yd(t,e,i,r,n,s){const a=t.context.gl,c=e.paint.get("sky-atmosphere-color"),p=e.paint.get("sky-atmosphere-halo-color"),_=e.paint.get("sky-atmosphere-sun-intensity"),v=((E,C,B,O,G)=>({u_matrix_3f:E,u_sun_direction:C,u_sun_intensity:B,u_color_tint_r:[O.r,O.g,O.b,O.a],u_color_tint_m:[G.r,G.g,G.b,G.a],u_luminance:5e-5}))(Se.fromMat4(Se.create(),r),n,_,c,p);a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_CUBE_MAP_POSITIVE_X+s,e.skyboxTexture,0),i.draw(t,a.TRIANGLES,lr.disabled,Br.disabled,An.unblended,Fr.frontCW,v,"skyboxCapture",e.skyboxGeometry.vertexBuffer,e.skyboxGeometry.indexBuffer,e.skyboxGeometry.segment)}const n4=an([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class s4{constructor(e){const i=new Ou;i.emplaceBack(-1,1,1,0,0),i.emplaceBack(1,1,1,1,0),i.emplaceBack(1,-1,1,1,1),i.emplaceBack(-1,-1,1,0,1);const r=new so;r.emplaceBack(0,1,2),r.emplaceBack(2,3,0),this.vertexBuffer=e.createVertexBuffer(i,n4.members),this.indexBuffer=e.createIndexBuffer(r),this.segments=Mn.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const o4=an([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class a4{constructor(){this.colorModeAlphaBlendedWriteRGB=new An([1,Wm,1,Wm],fr.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new An([1,0,1,0],fr.transparent,[!1,!1,!1,!0])}update(e){const i=e.context;if(!this.atmosphereBuffer){this.atmosphereBuffer=new s4(i);const r=100,n=200,s=function(v){const E=b(30),C=[];for(let B=0;B<16e3;++B){const O=2*Math.PI*E(),G=Math.acos(1-2*E())-.5*Math.PI;C.push(me.fromValues(Math.cos(G)*Math.cos(O),Math.cos(G)*Math.sin(O),Math.sin(G)))}return C}(),a=b(300),c=new Hd,p=new so;let _=0;for(let v=0;v<s.length;++v){const E=me.scale([],s[v],200),C=Math.max(0,1+.01*r*(1*a()-.5)),B=Math.max(0,1+.01*n*(1*a()-.5));c.emplaceBack(E[0],E[1],E[2],-1,-1,C,B),c.emplaceBack(E[0],E[1],E[2],1,-1,C,B),c.emplaceBack(E[0],E[1],E[2],1,1,C,B),c.emplaceBack(E[0],E[1],E[2],-1,1,C,B),p.emplaceBack(_+0,_+1,_+2),p.emplaceBack(_+0,_+2,_+3),_+=4}this.starsVx=i.createVertexBuffer(c,o4.members),this.starsIdx=i.createIndexBuffer(p),this.starsSegments=Mn.simpleSegment(0,0,c.length,p.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(e,i){const r=e.context,n=r.gl,s=e.transform,a=new lr(n.LEQUAL,lr.ReadOnly,[0,1]),c=Ho(s.zoom),p=i.properties.get("color").toArray01(),_=i.properties.get("high-color").toArray01(),v=i.properties.get("space-color").toArray01PremultipliedAlpha(),E=5e-4,C=Ai((i.properties.get("horizon-blend")-0)/1*.2495+E,5e-4,.25),B=Am(e,r,s)&&C===E?s.worldSize/(2*Math.PI*1.025)-1:s.globeRadius,O=e.frameCounter/1e3%1,G=me.length(s.globeCenterInViewSpace),q=Math.sqrt(Math.pow(G,2)-Math.pow(B,2)),X=Math.acos(q/G),$=re=>{const ne=s.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];re&&ne.push("ALPHA_PASS");const ie=e.getOrCreateProgram("globeAtmosphere",{defines:ne}),se=((ve,be,De,Ve,je,Je,Fe,nt,At,vt,rt,lt)=>({u_frustum_tl:ve,u_frustum_tr:be,u_frustum_br:De,u_frustum_bl:Ve,u_horizon:je,u_transition:Je,u_fadeout_range:Fe,u_color:nt,u_high_color:At,u_space_color:vt,u_temporal_offset:rt,u_horizon_angle:lt}))(s.frustumCorners.TL,s.frustumCorners.TR,s.frustumCorners.BR,s.frustumCorners.BL,s.frustumCorners.horizon,c,C,p,_,v,O,X);e.uploadCommonUniforms(r,ie);const he=this.atmosphereBuffer;he&&ie.draw(e,n.TRIANGLES,a,Br.disabled,re?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Fr.backCW,se,re?"atmosphere_glow_alpha":"atmosphere_glow",he.vertexBuffer,he.indexBuffer,he.segments)};$(!1),$(!0)}drawStars(e,i){const r=Ai(i.properties.get("star-intensity"),0,1);if(r===0)return;const n=e.context,s=n.gl,a=e.transform,c=e.getOrCreateProgram("stars"),p=at.identity([]);at.rotateX(p,p,-a._pitch),at.rotateZ(p,p,-a.angle),at.rotateX(p,p,wi(a._center.lat)),at.rotateY(p,p,-wi(a._center.lng));const _=ce.fromQuat(new Float32Array(16),p),v=ce.multiply([],a.starsProjMatrix,_),E=Se.fromMat4([],_),C=Se.invert([],E),B=[0,1,0];me.transformMat3(B,B,C),me.scale(B,B,.15);const O=[1,0,0];me.transformMat3(O,O,C),me.scale(O,O,.15);const G=((q,X,$,re)=>({u_matrix:Float32Array.from(q),u_up:X,u_right:$,u_intensity_multiplier:re}))(v,B,O,r);e.uploadCommonUniforms(n,c),this.starsVx&&this.starsIdx&&c.draw(e,s.TRIANGLES,lr.disabled,Br.disabled,this.colorModeAlphaBlendedWriteRGB,Fr.disabled,G,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function Vb(t,e){const i=[...t],r=e.cameraWorldSizeForFog/e.worldSize,n=ce.identity([]);return ce.scale(n,n,[r,r,1]),ce.multiply(i,n,i),ce.multiply(i,e.worldToFogMatrix,i),i}function Ty(t,e,i,r){const n=i.material,s=r.context,{baseColorTexture:a,metallicRoughnessTexture:c}=n.pbrMetallicRoughness,{normalTexture:p,occlusionTexture:_,emissionTexture:v}=n;function E(C,B,O){if(C&&(t.push(B),s.activeTexture.set(s.gl.TEXTURE0+O),C.gfxTexture)){const{minFilter:G,magFilter:q,wrapS:X,wrapT:$}=C.sampler;C.gfxTexture.bindExtraParam(G,q,X,$)}}E(a,"HAS_TEXTURE_u_baseColorTexture",IA.BaseColor),E(c,"HAS_TEXTURE_u_metallicRoughnessTexture",IA.MetallicRoughness),E(p,"HAS_TEXTURE_u_normalTexture",IA.Normal),E(_,"HAS_TEXTURE_u_occlusionTexture",IA.Occlusion),E(v,"HAS_TEXTURE_u_emissionTexture",IA.Emission),i.texcoordBuffer&&(t.push("HAS_ATTRIBUTE_a_uv_2f"),e.push(i.texcoordBuffer)),i.colorBuffer&&(t.push(i.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),e.push(i.colorBuffer)),i.normalBuffer&&(t.push("HAS_ATTRIBUTE_a_normal_3f"),e.push(i.normalBuffer)),i.pbrBuffer&&(t.push("HAS_ATTRIBUTE_a_pbr"),t.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),e.push(i.pbrBuffer)),n.alphaMode!=="OPAQUE"&&n.alphaMode!=="MASK"||t.push("UNPREMULT_TEXTURE_IN_SHADER"),n.defined||t.push("DIFFUSE_SHADED"),t.push("USE_STANDARD_DERIVATIVES")}function y_(t,e,i,r,n,s){const a=i.paint.get("model-opacity"),c=e.context,p=new lr(e.context.gl.LEQUAL,lr.ReadWrite,e.depthRangeFor3D),_=e.transform,v=t.mesh,E=v.material,C=E.pbrMetallicRoughness,B=e.style.fog;let O;O=e.transform.projection.zAxisUnit==="pixels"?[...t.nodeModelMatrix]:ce.multiply([],r.zScaleMatrix,t.nodeModelMatrix),ce.multiply(O,r.negCameraPosMatrix,O);const G=ce.invert([],O);ce.transpose(G,G);const q=i.paint.get("model-emissive-strength").constantOr(0),X=by(new Float32Array(t.worldViewProjection),new Float32Array(O),new Float32Array(G),e,a,C.baseColorFactor,E.emissiveFactor,C.metallicFactor,C.roughnessFactor,E,q,i),$={defines:[]},re=[];Ty($.defines,re,v,e);const ne=e.shadowRenderer;ne&&(ne.useNormalOffset=!1);let ie=null;if(B){const ve=Vb(t.nodeModelMatrix,e.transform);if(ie=new Float32Array(ve),_.projection.name!=="globe"){const be=v.aabb.min,De=v.aabb.max,[Ve,je]=B.getOpacityForBounds(ve,be[0],be[1],De[0],De[1]);$.overrideFog=Ve>=of||je>=of}}const se=md(e,i.paint.get("model-cutoff-fade-range"));se.shouldRenderCutoff&&$.defines.push("RENDER_CUTOFF");const he=e.getOrCreateProgram("model",$);e.uploadCommonUniforms(c,he,null,ie,se),e.renderPass!=="shadow"&&ne&&ne.setupShadowsFromMatrix(t.nodeModelMatrix,he),he.draw(e,c.gl.TRIANGLES,p,n,s,v.material.doubleSided?Fr.disabled:Fr.backCCW,X,i.id,v.vertexBuffer,v.indexBuffer,v.segments,i.paint,e.transform.zoom,void 0,re)}function jb(t,e,i,r,n,s,a){let c;c=t.projection.name==="globe"?Lx(i,t):[...i],ce.multiply(c,c,e.matrix);const p=ce.multiply([],r,c);if(e.meshes)for(const _ of e.meshes){if(_.material.alphaMode!=="BLEND"){a.push({mesh:_,depth:0,modelIndex:n,worldViewProjection:p,nodeModelMatrix:c});continue}const v=me.transformMat4([],_.centroid,p);v[2]>0&&s.push({mesh:_,depth:v[2],modelIndex:n,worldViewProjection:p,nodeModelMatrix:c})}if(e.children)for(const _ of e.children)jb(t,_,i,r,n,s,a)}function Ey(t,e,i,r){const n=i.shadowRenderer;if(!n)return;const s=n.getShadowPassDepthMode(),a=n.getShadowPassColorMode(),c=n.calculateShadowPassMatrixFromMatrix(e),p=zb(c);i.getOrCreateProgram("modelDepth",{defines:["DEPTH_TEXTURE"]}).draw(i,i.context.gl.TRIANGLES,s,Br.disabled,a,Fr.backCCW,p,r.id,t.vertexBuffer,t.indexBuffer,t.segments,r.paint,i.transform.zoom,void 0,void 0)}function l4(t,e,i){const r=e.updateZoomBasedPaintProperties(),n=function(s,a,c){let p,_,v,E=s.terrain?s.terrain.exaggeration():0;if(s.terrain&&E>0){const C=s.terrain,B=C.findDEMTileFor(c);B&&B.dem?p=sd.create(C,c,B):E=0}if(E===0&&(a.terrainElevationMin=0,a.terrainElevationMax=0),E===a.validForExaggeration&&(E===0||p&&p._demTile&&p._demTile.tileID===a.validForDEMTile.id&&p._dem._timestamp===a.validForDEMTile.timestamp))return!1;for(const C in a.instancesPerModel){const B=a.instancesPerModel[C];for(let O=0;O<B.instancedDataArray.length;++O){const G=(p?E*p.getElevationAt(0|B.instancedDataArray.float32[16*O],0|B.instancedDataArray.float32[16*O+1],!0,!0):0)+B.instancesEvaluatedElevation[O];B.instancedDataArray.float32[16*O+6]=G,_=_?Math.min(a.terrainElevationMin,G):G,v=v?Math.max(a.terrainElevationMax,G):G}}return a.terrainElevationMin=_||0,a.terrainElevationMax=v||0,a.validForExaggeration=E,a.validForDEMTile=p&&p._demTile?{id:p._demTile.tileID,timestamp:p._dem._timestamp}:{id:void 0,timestamp:0},!0}(t,e,i);(r||n)&&(e.uploaded=!1,e.upload(t.context))}const Eu={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new Hr([0,0,0],[Mt,Mt,0])};function A4(t,e){const i=1<<t.canonical.z,r=e.getFreeCameraOptions().position,n=e.elevation,s=t.canonical.x/i,a=(t.canonical.x+1)/i,c=t.canonical.y/i,p=(t.canonical.y+1)/i;let _=e._centerAltitude;if(n){const B=n.getMinMaxForTile(t);B&&B.max>_&&(_=B.max)}const v=Ai(r.x,s,a)-r.x,E=Ai(r.y,c,p)-r.y,C=jn(_,e.center.lat)-r.z;return e._zoomFromMercatorZ(Math.sqrt(v*v+E*E+C*C))}function Gb(t,e,i,r,n,s,a){const c=t.context,p=t.renderPass==="shadow",_=t.shadowRenderer,v=p&&_?_.getShadowPassDepthMode():new lr(c.gl.LEQUAL,lr.ReadWrite,t.depthRangeFor3D),E=t.isTileAffectedByFog(s);if(i.meshes)for(const C of i.meshes){const B=["MODEL_POSITION_ON_GPU"],O=[];let G,q,X;r.instancedDataArray.length>20&&B.push("INSTANCED_ARRAYS");const $=md(t,e.paint.get("model-cutoff-fade-range"));if($.shouldRenderCutoff&&B.push("RENDER_CUTOFF"),p&&_)G=t.getOrCreateProgram("modelDepth",{defines:B}),q=zb(a.shadowTileMatrix,a.shadowTileMatrix,Float32Array.from(i.matrix)),X=_.getShadowPassColorMode();else{Ty(B,O,C,t),G=t.getOrCreateProgram("model",{defines:B,overrideFog:E});const ne=C.material,ie=ne.pbrMetallicRoughness,se=e.paint.get("model-opacity"),he=e.paint.get("model-emissive-strength").constantOr(0);q=by(s.expandedProjMatrix,Float32Array.from(i.matrix),new Float32Array(16),t,se,ie.baseColorFactor,ne.emissiveFactor,ie.metallicFactor,ie.roughnessFactor,ne,he,e,n),_&&(a.shadowUniformsInitialized?G.setShadowUniformValues(c,_.getShadowUniformValues()):(_.setupShadows(s.toUnwrapped(),G,"model-tile",s.overscaledZ),a.shadowUniformsInitialized=!0)),X=$.shouldRenderCutoff||se<1||ne.alphaMode!=="OPAQUE"?An.alphaBlended:An.unblended}t.uploadCommonUniforms(c,G,s.toUnwrapped(),null,$);const re=C.material.doubleSided?Fr.disabled:Fr.backCCW;if(r.instancedDataArray.length>20)O.push(r.instancedDataBuffer),G.draw(t,c.gl.TRIANGLES,v,Br.disabled,X,re,q,e.id,C.vertexBuffer,C.indexBuffer,C.segments,e.paint,t.transform.zoom,void 0,O,r.instancedDataArray.length);else{const ne=p?"u_instance":"u_normal_matrix";for(let ie=0;ie<r.instancedDataArray.length;++ie)q[ne]=new Float32Array(r.instancedDataArray.arrayBuffer,64*ie,16),G.draw(t,c.gl.TRIANGLES,v,Br.disabled,X,re,q,e.id,C.vertexBuffer,C.indexBuffer,C.segments,e.paint,t.transform.zoom,void 0,O)}}if(i.children)for(const C of i.children)Gb(t,e,C,r,n,s,a)}const c4=[1,-1,1];function u4(t,e,i,r){if(!i.modelManager)return!0;const n=i.modelManager;if(!i.shadowRenderer)return!0;const s=i.shadowRenderer,a=e.aabb;let c=!0,p=t.maxHeight;if(p===0){let v=0;for(const E in t.instancesPerModel){const C=n.getModel(E,r);C?v=Math.max(v,Math.max(Math.max(C.aabb.max[0],C.aabb.max[1]),C.aabb.max[2])):c=!1}p=t.maxScale*v*1.41+t.maxVerticalOffset,c&&(t.maxHeight=p)}a.max[2]=p,a.min[2]+=t.terrainElevationMin,a.max[2]+=t.terrainElevationMax,me.transformMat4(a.min,a.min,e.tileMatrix),me.transformMat4(a.max,a.max,e.tileMatrix);const _=a.intersects(s.getCurrentCascadeFrustum());return i.currentShadowCascade===0&&(t.isInsideFirstShadowMapFrustum=_===2),_===0}class h4{}class f4{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(e,i,r){{const E=this._storage.get(i.id);if(E)return E.lastUsedFrameIdx=e,E.buf}const n=r.gl,s=n.getBufferParameter(n.ELEMENT_ARRAY_BUFFER,n.BUFFER_SIZE),a=new ArrayBuffer(s),c=new Int16Array(a);n.getBufferSubData(n.ELEMENT_ARRAY_BUFFER,0,new Int16Array(a));const p=new jc;for(let E=0;E<s/2;E+=3){const C=c[E],B=c[E+1],O=c[E+2];p.emplaceBack(C,B),p.emplaceBack(B,O),p.emplaceBack(O,C)}const _=r.bindVertexArrayOES.current,v=new h4;return v.buf=new wh(r,p),v.lastUsedFrameIdx=e,this._storage.set(i.id,v),r.bindVertexArrayOES.set(_),v.buf}update(e){for(const[i,r]of this._storage)e-r.lastUsedFrameIdx>30&&(r.buf.destroy(),this._storage.delete(i))}destroy(){for(const[e,i]of this._storage)i.buf.destroy(),this._storage.delete(e)}}const Zb={symbol:function(t,e,i,r,n){if(t.renderPass!=="translucent")return;const s=Br.disabled,a=t.colorModeForRenderPass();i.layout.get("text-variable-anchor")&&function(c,p,_,v,E,C,B){const O=p.transform,G=E==="map",q=C==="map";for(const X of c){const $=v.getTile(X),re=$.getBucket(_);if(!re||!re.text||!re.text.segments.get().length)continue;const ne=xu(re.textSizeData,O.zoom),ie=py(X,re.getProjection(),O),se=O.calculatePixelsToTileUnitsMatrix($),he=Ym(ie,$.tileID.canonical,q,G,O,re.getProjection(),se),ve=re.hasIconTextFit()&&re.hasIconData();if(ne){const be=Math.pow(2,O.zoom-$.tileID.overscaledZ);jM(re,G,q,B,c3,O,he,X,be,ne,ve)}}}(r,t,i,e,i.layout.get("text-rotation-alignment"),i.layout.get("text-pitch-alignment"),n),i.paint.get("icon-opacity").constantOr(1)!==0&&Rb(t,e,i,r,!1,i.paint.get("icon-translate"),i.paint.get("icon-translate-anchor"),i.layout.get("icon-rotation-alignment"),i.layout.get("icon-pitch-alignment"),i.layout.get("icon-keep-upright"),i.paint.get("icon-color-saturation"),s,a),i.paint.get("text-opacity").constantOr(1)!==0&&Rb(t,e,i,r,!0,i.paint.get("text-translate"),i.paint.get("text-translate-anchor"),i.layout.get("text-rotation-alignment"),i.layout.get("text-pitch-alignment"),i.layout.get("text-keep-upright"),i.paint.get("icon-color-saturation"),s,a),e.map.showCollisionBoxes&&(Bb(t,e,i,r,i.paint.get("text-translate"),i.paint.get("text-translate-anchor"),!0),Bb(t,e,i,r,i.paint.get("icon-translate"),i.paint.get("icon-translate-anchor"),!1))},circle:function(t,e,i,r){if(t.renderPass!=="translucent")return;const n=i.paint.get("circle-opacity"),s=i.paint.get("circle-stroke-width"),a=i.paint.get("circle-stroke-opacity"),c=i.layout.get("circle-sort-key").constantOr(1)!==void 0,p=i.paint.get("circle-emissive-strength");if(n.constantOr(1)===0&&(s.constantOr(1)===0||a.constantOr(1)===0))return;const _=t.context,v=_.gl,E=t.transform,C=t.depthModeForSublayer(0,lr.ReadOnly),B=Br.disabled,O=t.colorModeForDrapableLayerRenderPass(p),G=E.projection.name==="globe",q=[Wo(E.center.lng),oa(E.center.lat)],X=[];for(let re=0;re<r.length;re++){const ne=r[re],ie=e.getTile(ne),se=ie.getBucket(i);if(!se||se.projection.name!==E.projection.name)continue;const he=se.programConfigurations.get(i.id),ve=o1(i),be=t.isTileAffectedByFog(ne);G&&ve.push("PROJECTION_GLOBE_VIEW");const De=t.getOrCreateProgram("circle",{config:he,defines:ve,overrideFog:be}),Ve=se.layoutVertexBuffer,je=se.globeExtVertexBuffer,Je=se.indexBuffer,Fe=E.projection.createInversionMatrix(E,ne.canonical),nt={programConfiguration:he,program:De,layoutVertexBuffer:Ve,globeExtVertexBuffer:je,indexBuffer:Je,uniformValues:n2(t,ne,ie,Fe,q,i),tile:ie};if(c){const At=se.segments.get();for(const vt of At)X.push({segments:new Mn([vt]),sortKey:vt.sortKey,state:nt})}else X.push({segments:se.segments,sortKey:0,state:nt})}c&&X.sort((re,ne)=>re.sortKey-ne.sortKey);const $={useDepthForOcclusion:E.depthOcclusionForSymbolsAndCircles};for(const re of X){const{programConfiguration:ne,program:ie,layoutVertexBuffer:se,globeExtVertexBuffer:he,indexBuffer:ve,uniformValues:be,tile:De}=re.state,Ve=re.segments;t.terrain&&t.terrain.setupElevationDraw(De,ie,$),t.uploadCommonUniforms(_,ie,De.tileID.toUnwrapped()),ie.draw(t,v.TRIANGLES,C,B,O,Fr.disabled,be,i.id,se,ve,Ve,i.paint,E.zoom,ne,[he])}},heatmap:function(t,e,i,r){if(i.paint.get("heatmap-opacity")!==0)if(t.renderPass==="offscreen"){const n=t.context,s=n.gl,a=Br.disabled,c=new An([s.ONE,s.ONE,s.ONE,s.ONE],fr.transparent,[!0,!0,!0,!0]);(function(B,O,G,q){const X=B.gl,$=O.width*q,re=O.height*q;B.activeTexture.set(X.TEXTURE1),B.viewport.set([0,0,$,re]);let ne=G.heatmapFbo;if(!ne||ne&&(ne.width!==$||ne.height!==re)){ne&&ne.destroy();const ie=X.createTexture();X.bindTexture(X.TEXTURE_2D,ie),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_WRAP_S,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_WRAP_T,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_MIN_FILTER,X.LINEAR),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_MAG_FILTER,X.LINEAR),ne=G.heatmapFbo=B.createFramebuffer($,re,!0,null),function(se,he,ve,be,De,Ve){const je=se.gl;je.texImage2D(je.TEXTURE_2D,0,se.extRenderToTextureHalfFloat?je.RGBA16F:je.RGBA,De,Ve,0,je.RGBA,se.extRenderToTextureHalfFloat?je.HALF_FLOAT:je.UNSIGNED_BYTE,null),be.colorAttachment.set(ve)}(B,0,ie,ne,$,re)}else X.bindTexture(X.TEXTURE_2D,ne.colorAttachment.get()),B.bindFramebuffer.set(ne.framebuffer)})(n,t,i,t.transform.projection.name==="globe"?.5:.25),n.clear({color:fr.transparent});const p=t.transform,_=p.projection.name==="globe",v=_?["PROJECTION_GLOBE_VIEW"]:[],E=_?Fr.frontCCW:Fr.disabled,C=[Wo(p.center.lng),oa(p.center.lat)];for(let B=0;B<r.length;B++){const O=r[B];if(e.hasRenderableParent(O))continue;const G=e.getTile(O),q=G.getBucket(i);if(!q||q.projection.name!==p.projection.name)continue;const X=t.isTileAffectedByFog(O),$=q.programConfigurations.get(i.id),re=t.getOrCreateProgram("heatmap",{config:$,defines:v,overrideFog:X}),{zoom:ne}=t.transform;t.terrain&&t.terrain.setupElevationDraw(G,re),t.uploadCommonUniforms(n,re,O.toUnwrapped());const ie=p.projection.createInversionMatrix(p,O.canonical);re.draw(t,s.TRIANGLES,lr.disabled,a,c,E,zM(t,O,G,ie,C,ne,i.paint.get("heatmap-intensity")),i.id,q.layoutVertexBuffer,q.indexBuffer,q.segments,i.paint,t.transform.zoom,$,_?[q.globeExtVertexBuffer]:null)}n.viewport.set([0,0,t.width,t.height])}else t.renderPass==="translucent"&&(t.context.setColorMode(t.colorModeForRenderPass()),function(n,s){const a=n.context,c=a.gl,p=s.heatmapFbo;if(!p)return;a.activeTexture.set(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,p.colorAttachment.get()),a.activeTexture.set(c.TEXTURE1);let _=s.colorRampTexture;_||(_=s.colorRampTexture=new Bs(a,s.colorRamp,c.RGBA)),_.bind(c.LINEAR,c.CLAMP_TO_EDGE),n.getOrCreateProgram("heatmapTexture").draw(n,c.TRIANGLES,lr.disabled,Br.disabled,n.colorModeForRenderPass(),Fr.disabled,((v,E,C,B)=>({u_image:0,u_color_ramp:1,u_opacity:E.paint.get("heatmap-opacity")}))(0,s),s.id,n.viewportBuffer,n.quadTriangleIndexBuffer,n.viewportSegments,s.paint,n.transform.zoom)}(t,i))},line:function(t,e,i,r){if(t.renderPass!=="translucent")return;const n=i.paint.get("line-opacity"),s=i.paint.get("line-width");if(n.constantOr(1)===0||s.constantOr(1)===0)return;const a=i.paint.get("line-emissive-strength"),c=t.depthModeForSublayer(0,lr.ReadOnly),p=t.colorModeForDrapableLayerRenderPass(a),_=t.terrain&&t.terrain.renderingToTexture?1:Wi.devicePixelRatio,v=i.paint.get("line-dasharray"),E=v.constantOr(1),C=i.layout.get("line-cap"),B=i.paint.get("line-pattern"),O=B.constantOr(1),G=i.paint.get("line-pattern").constantOr(1),q=i.paint.get("line-opacity").constantOr(1)!==1;let X=!G&&q;const $=i.paint.get("line-gradient"),re=O?"linePattern":"line",ne=t.context,ie=ne.gl,se=fv(i);t.terrain&&t.terrain.clipOrMaskOverlapStencilType()&&(X=!1);for(const he of r){const ve=e.getTile(he);if(O&&!ve.patternsLoaded())continue;const be=ve.getBucket(i);if(!be)continue;t.prepareDrawTile();const De=be.programConfigurations.get(i.id),Ve=t.isTileAffectedByFog(he),je=t.getOrCreateProgram(re,{config:De,defines:se,overrideFog:Ve}),Je=B.constantOr(null);if(Je&&ve.imageAtlas){const It=ve.imageAtlas.patternPositions[Je.toString()];It&&De.setConstantPatternPositions(It)}const Fe=v.constantOr(null),nt=C.constantOr(null);if(!O&&Fe&&nt&&ve.lineAtlas){const It=ve.lineAtlas.getDash(Fe,nt);It&&De.setConstantPatternPositions(It)}let[At,vt]=i.paint.get("line-trim-offset");(nt==="round"||nt==="square")&&At!==vt&&(At===0&&(At-=1),vt===1&&(vt+=1));const rt=t.terrain?he.projMatrix:null,lt=O?AE(t,ve,i,rt,_):lE(t,ve,i,rt,be.lineClipsArray.length,_,[At,vt]);if($){const It=be.gradients[i.id];let St=It.texture;if(i.gradientVersion!==It.version){let Bt=256;if(i.stepInterpolant){const Ft=e.getSource().maxzoom,jt=he.canonical.z===Ft?Math.ceil(1<<t.transform.maxZoom-he.canonical.z):1;Bt=Ai(Yo(be.maxLineLength/Mt*1024*jt),256,ne.maxTextureSize)}It.gradient=mm({expression:i.gradientExpression(),evaluationKey:"lineProgress",resolution:Bt,image:It.gradient||void 0,clips:be.lineClipsArray}),It.texture?It.texture.update(It.gradient):It.texture=new Bs(ne,It.gradient,ie.RGBA),It.version=i.gradientVersion,St=It.texture}ne.activeTexture.set(ie.TEXTURE1),St.bind(i.stepInterpolant?ie.NEAREST:ie.LINEAR,ie.CLAMP_TO_EDGE)}E&&(ne.activeTexture.set(ie.TEXTURE0),ve.lineAtlasTexture&&ve.lineAtlasTexture.bind(ie.LINEAR,ie.REPEAT),De.updatePaintBuffers()),O&&(ne.activeTexture.set(ie.TEXTURE0),ve.imageAtlasTexture&&ve.imageAtlasTexture.bind(ie.LINEAR,ie.CLAMP_TO_EDGE),De.updatePaintBuffers()),t.uploadCommonUniforms(ne,je,he.toUnwrapped());const wt=It=>{je.draw(t,ie.TRIANGLES,c,It,p,Fr.disabled,lt,i.id,be.layoutVertexBuffer,be.indexBuffer,be.segments,i.paint,t.transform.zoom,De,[be.layoutVertexBuffer2])};if(X){const It=t.stencilModeForClipping(he).ref;It===0&&t.terrain&&ne.clear({stencil:0});const St={func:ie.EQUAL,mask:255};lt.u_alpha_discard_threshold=.8,wt(new Br(St,It,255,ie.KEEP,ie.KEEP,ie.INVERT)),lt.u_alpha_discard_threshold=0,wt(new Br(St,It,255,ie.KEEP,ie.KEEP,ie.KEEP))}else wt(t.stencilModeForClipping(he))}X&&(t.resetStencilClippingMasks(),t.terrain&&ne.clear({stencil:0}))},fill:function(t,e,i,r){const n=i.paint.get("fill-color"),s=i.paint.get("fill-opacity");if(s.constantOr(1)===0)return;const a=i.paint.get("fill-emissive-strength"),c=t.colorModeForDrapableLayerRenderPass(a),p=i.paint.get("fill-pattern"),_=t.opaquePassEnabledForLayer()&&!p.constantOr(1)&&n.constantOr(fr.transparent).a===1&&s.constantOr(0)===1?"opaque":"translucent";if(t.renderPass===_){const v=t.depthModeForSublayer(1,t.renderPass==="opaque"?lr.ReadWrite:lr.ReadOnly);Fb(t,e,i,r,v,c,!1)}if(t.renderPass==="translucent"&&i.paint.get("fill-antialias")){const v=t.depthModeForSublayer(i.getPaintProperty("fill-outline-color")?2:0,lr.ReadOnly);Fb(t,e,i,r,v,c,!0)}},"fill-extrusion":function(t,e,i,r){const n=i.paint.get("fill-extrusion-opacity"),s=t.context,a=s.gl,c=t.terrain,p=c&&c.renderingToTexture,_=i.paint.get("fill-extrusion-cutoff-fade-range");if(n===0)return;const v=t.conflationActive&&t.layerUsedInConflation(i,e.getSource());if(v&&function(E,C,B,O){for(const G of O){const q=C.getTile(G).getBucket(B);q&&(q.updateReplacement(G,E.replacementSource),q.uploadCentroid(E.context))}}(t,e,i,r),c||v)for(const E of r){const C=e.getTile(E).getBucket(i);C&&ZM(t.context,e,E,C,i,c,v)}if(t.renderPass==="shadow"&&t.shadowRenderer){const E=t.shadowRenderer;if(c&&n<.65&&i._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof Bn)return;const C=E.getShadowPassDepthMode(),B=E.getShadowPassColorMode();__(t,e,i,r,C,Br.disabled,B,v)}else if(t.renderPass==="translucent"){const E=!i.paint.get("fill-extrusion-pattern").constantOr(1);if(!p){const C=new lr(t.context.gl.LEQUAL,lr.ReadWrite,t.depthRangeFor3D);_===0&&n===1&&E?__(t,e,i,r,C,Br.disabled,An.unblended,v):(__(t,e,i,r,C,Br.disabled,An.disabled,v),__(t,e,i,r,C,t.stencilModeFor3D(),t.colorModeForRenderPass(),v),t.resetStencilClippingMasks())}if(t.style.enable3dLights()&&E&&(!c&&t.transform.projection.name!=="globe"||p)){const C=i.paint.get("fill-extrusion-opacity"),B=i.paint.get("fill-extrusion-ambient-occlusion-intensity"),O=i.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),G=i.paint.get("fill-extrusion-flood-light-intensity"),q=i.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),X=B>0&&O>0,$=G>0,re=(ie,se,he)=>(1-he)*ie+he*se,ne=ie=>{const se=t.depthModeForSublayer(1,lr.ReadOnly,a.LEQUAL,!0),he=i.paint.get(ie?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),ve=re(.1,3,he),be=t._showOverdrawInspector;if(!be){const De=new Br({func:a.ALWAYS,mask:255},255,255,a.KEEP,a.KEEP,a.REPLACE),Ve=new An([a.ONE,a.ONE,a.ONE,a.ONE],fr.transparent,[!1,!1,!1,!0],a.MIN);gd(t,e,i,r,se,De,Ve,Fr.disabled,ie,"sdf",C,B,O,G,q,ve,v,!1)}{const De=be?Br.disabled:new Br({func:a.EQUAL,mask:255},255,255,a.KEEP,a.DECR,a.DECR),Ve=be?t.colorModeForRenderPass():new An([a.ONE_MINUS_DST_ALPHA,a.DST_ALPHA,a.ONE,a.ONE],fr.transparent,[!0,!0,!0,!0]);gd(t,e,i,r,se,De,Ve,Fr.disabled,ie,"color",C,B,O,G,q,ve,v,!1)}};if(p){const ie=(se,he,ve)=>{const be=t.depthModeForSublayer(1,lr.ReadOnly,a.LEQUAL,!1),De=i.paint.get(se?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ve=re(.1,3,De);{const je=new An([a.ONE,a.ONE,a.ONE,a.ONE],fr.transparent,[!1,!1,!1,!0]);gd(t,e,i,r,be,Br.disabled,je,Fr.disabled,se,"clear",C,B,O,G,q,Ve,v,he)}{const je=new Br({func:a.ALWAYS,mask:255},255,255,a.KEEP,a.KEEP,a.REPLACE),Je=new An([a.ONE,a.ONE,a.ONE,a.ONE],fr.transparent,[!1,!1,!1,!0],a.MIN);gd(t,e,i,r,be,je,Je,Fr.disabled,se,"sdf",C,B,O,G,q,Ve,v,he)}{const je=se?a.ZERO:a.ONE_MINUS_DST_ALPHA,Je=new Br({func:a.EQUAL,mask:255},255,255,a.KEEP,a.DECR,a.DECR),Fe=new An([je,a.DST_ALPHA,a.ONE_MINUS_DST_ALPHA,a.ZERO],fr.transparent,[!0,!0,!0,!0]);gd(t,e,i,r,be,Je,Fe,Fr.disabled,se,"color",C,B,O,G,q,Ve,v,he)}{const je=new An([a.ONE,a.ONE,a.ONE,se?a.ZERO:a.ONE],fr.transparent,[!1,!1,!1,!0],se?a.FUNC_ADD:a.MAX);gd(t,e,i,r,be,Br.disabled,je,Fr.disabled,se,"clear",C,B,O,G,q,Ve,v,he,ve)}};if(X||$){let se;if(t.prepareDrawTile(),c){const he=c.drapeBufferSize[0],ve=c.drapeBufferSize[1];se=c.framebufferCopyTexture,se&&(!se||se.size[0]===he&&se.size[1]===ve)||(se&&se.destroy(),se=c.framebufferCopyTexture=new Bs(s,new Do({width:he,height:ve}),a.RGBA)),se.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.copyTexImage2D(a.TEXTURE_2D,0,a.RGBA,0,0,he,ve,0)}X&&ie(!0,!1,se),$&&ie(!1,!0,se)}}else X&&ne(!0),$&&ne(!1)}}},hillshade:function(t,e,i,r){if(t.renderPass!=="offscreen"&&t.renderPass!=="translucent"||t.style.disableElevatedTerrain)return;const n=t.context,s=t.terrain&&t.terrain.renderingToTexture,[a,c]=t.renderPass!=="translucent"||s?[{},r]:t.stencilConfigForOverlap(r);for(const p of c){const _=e.getTile(p);if(_.needsHillshadePrepare&&t.renderPass==="offscreen")gM(t,_,i);else if(t.renderPass==="translucent"){const v=t.depthModeForSublayer(0,lr.ReadOnly),E=i.paint.get("hillshade-emissive-strength"),C=t.colorModeForDrapableLayerRenderPass(E),B=s&&t.terrain?t.terrain.stencilModeForRTTOverlap(p):a[p.overscaledZ];_M(t,p,_,i,v,B,C)}}n.viewport.set([0,0,t.width,t.height]),t.resetStencilClippingMasks()},raster:function(t,e,i,r,n,s){if(t.renderPass!=="translucent"||i.paint.get("raster-opacity")===0)return;const a=t.context,c=a.gl,p=e.getSource(),_=function(he,ve,be){const De=he.paint.get("raster-color"),Ve=[],je=he.paint.get("raster-resampling"),Je=he.paint.get("raster-color-mix"),Fe=he.paint.get("raster-color-range"),nt=[Je[0],Je[1],Je[2],0],At=Je[3],vt=je==="nearest"?be.NEAREST:be.LINEAR;if(De&&Ve.push("RASTER_COLOR"),De){ve.activeTexture.set(be.TEXTURE2);let rt=he.colorRampTexture;rt||(rt=he.colorRampTexture=new Bs(ve,he.colorRamp,be.RGBA)),rt.bind(be.LINEAR,be.CLAMP_TO_EDGE)}return{mix:nt,range:Fe,offset:At,defines:Ve,resampling:vt}}(i,a,c),v=_.defines,E=t.transform.projection.name==="globe";let C=!1;if(p instanceof Tc&&!r.length){if(!E)return;if(p.onNorthPole)C=!0,v.push("GLOBE_POLES");else{if(!p.onSouthPole)return;C=!0,v.push("GLOBE_POLES")}}const B=i.paint.get("raster-emissive-strength"),O=t.colorModeForDrapableLayerRenderPass(B),G=t.terrain&&t.terrain.renderingToTexture,q=p instanceof Tc&&i.paint.get("raster-elevation")!==0,X=!t.options.moving,$=i.paint.get("raster-resampling")==="nearest"?c.NEAREST:c.LINEAR;if(C){const he=e.getSource();if(!(he instanceof Tc))return;const ve=he.texture;if(!ve)return;const be=t.globeSharedBuffers;if(!be)return;const De=new lr(c.LEQUAL,lr.ReadWrite,t.depthRangeFor3D),Ve=Float32Array.from(t.transform.expandedFarZProjMatrix);let je=lm(0,0,t.transform);const Je=Float32Array.from(_l(_o(new ci(0,0,0)))),Fe={opacity:1,mix:0};t.terrain&&t.terrain.prepareDrawTile(),a.activeTexture.set(c.TEXTURE0),ve.bind($,c.CLAMP_TO_EDGE),a.activeTexture.set(c.TEXTURE1),ve.bind($,c.CLAMP_TO_EDGE),ve.useMipmap&&a.extTextureFilterAnisotropic&&t.transform.pitch>20&&c.texParameterf(c.TEXTURE_2D,a.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a.extTextureFilterAnisotropicMax);const[nt,At,vt,rt]=be.getPoleBuffers(0,!0);let lt;he.onNorthPole?(lt=nt,t.renderDefaultNorthPole=!1):(je=ce.scale(ce.create(),je,[1,-1,1]),lt=At,t.renderDefaultSouthPole=!1);const wt=((St,Bt,Ft,jt,Dt,Yt,fi,di,vi,bi,Ar,Ni)=>Ib(St,Bt,Ft,new Float32Array(16),new Float32Array(9),[0,0],[0,0,0,0],0,[0,0],[0,0,0,0],1,jt,Dt,Yt||[0,0],fi,2,vi,bi,Ar,1,0,Ni))(Ve,Je,je,Fe,i,he.perspectiveTransform||[0,0],i.paint.get("raster-elevation"),0,_.mix,_.offset,_.range,B),It=t.getOrCreateProgram("raster",{defines:_.defines});return t.uploadCommonUniforms(a,It,null),void It.draw(t,c.TRIANGLES,De,Br.disabled,O,Fr.disabled,wt,i.id,lt,vt,rt)}if(!r.length)return;const[re,ne]=p instanceof Tc||G?[{},r]:t.stencilConfigForOverlap(r),ie=ne[ne.length-1].overscaledZ,se=q&&E;se&&_.defines.push("PROJECTION_GLOBE_VIEW"),q&&_.defines.push("RENDER_CUTOFF");for(const he of ne){const ve=he.toUnwrapped(),be=e.getTile(he);if(G&&(!be||!be.hasData())||!be.texture)continue;let De,Ve;G?(De=lr.disabled,Ve=he.projMatrix):q?(De=new lr(c.LEQUAL,lr.ReadWrite,t.depthRangeFor3D),Ve=E?Float32Array.from(t.transform.expandedFarZProjMatrix):t.transform.calculateProjMatrix(ve,X)):(De=t.depthModeForSublayer(he.overscaledZ-ie,i.paint.get("raster-opacity")===1?lr.ReadWrite:lr.ReadOnly,c.LESS),Ve=t.transform.calculateProjMatrix(ve,X));const je=t.terrain&&G?t.terrain.stencilModeForRTTOverlap(he):re[he.overscaledZ],Je=s?0:i.paint.get("raster-fade-duration");be.registerFadeDuration(Je);const Fe=e.findLoadedParent(he,0),nt=xb(be,Fe,e,t.transform,Je);let At,vt;t.terrain&&t.terrain.prepareDrawTile(),a.activeTexture.set(c.TEXTURE0),be.texture&&be.texture.bind($,c.CLAMP_TO_EDGE),a.activeTexture.set(c.TEXTURE1),Fe?(Fe.texture&&Fe.texture.bind($,c.CLAMP_TO_EDGE),At=Math.pow(2,Fe.tileID.overscaledZ-be.tileID.overscaledZ),vt=[be.tileID.canonical.x*At%1,be.tileID.canonical.y*At%1]):be.texture&&be.texture.bind($,c.CLAMP_TO_EDGE),be.texture&&be.texture.useMipmap&&a.extTextureFilterAnisotropic&&t.transform.pitch>20&&c.texParameterf(c.TEXTURE_2D,a.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a.extTextureFilterAnisotropicMax);const rt=t.transform,lt=p instanceof Tc?p.perspectiveTransform:[0,0],wt=q?XM(rt):[0,0,0,0];let It,St,Bt,Ft,jt,Dt;if(se&&p instanceof Tc&&p.coordinates.length>3){It=Float32Array.from(_l(_o(new ci(0,0,0)))),St=Float32Array.from(rt.globeMatrix),Bt=Float32Array.from(am(rt)),Ft=[Wo(rt.center.lng),oa(rt.center.lat)],Dt=[Wo(p.coordinates[1][0]),oa(p.coordinates[1][1]),Wo(p.coordinates[3][0]),oa(p.coordinates[3][1])];const vi=new kl(p.coordinates[1],p.coordinates[3]);jt=Float32Array.from(cm(new ci(0,0,0),vi,0,rt.worldSize/t.transform._pixelsPerMercatorPixel))}else It=new Float32Array(16),St=new Float32Array(9),Bt=new Float32Array(16),Ft=[0,0],jt=new Float32Array(16),Dt=[0,0,0,0];const Yt=Ib(Ve,It,St,Bt,jt,vt||[0,0],Dt,Ho(t.transform.zoom),Ft,wt,At||1,nt,i,lt,q?i.paint.get("raster-elevation"):0,2,_.mix,_.offset,_.range,1,0,B),fi=t.isTileAffectedByFog(he),di=t.getOrCreateProgram("raster",{defines:_.defines,overrideFog:fi});if(t.uploadCommonUniforms(a,di,ve),p instanceof Tc){if(G||!E)p.boundsBuffer&&p.boundsSegments&&di.draw(t,c.TRIANGLES,De,Br.disabled,O,Fr.disabled,Yt,i.id,p.boundsBuffer,t.quadTriangleIndexBuffer,p.boundsSegments);else if(t.globeSharedBuffers){const[vi,bi,Ar]=t.globeSharedBuffers.getGridBuffers(0,!1);di.draw(t,c.TRIANGLES,De,Br.disabled,O,Fr.frontCCW,Yt,i.id,vi,bi,Ar),di.draw(t,c.TRIANGLES,De,Br.disabled,O,Fr.backCCW,Yt,i.id,vi,bi,Ar)}}else{const{tileBoundsBuffer:vi,tileBoundsIndexBuffer:bi,tileBoundsSegments:Ar}=t.getTileBoundsBuffers(be);di.draw(t,c.TRIANGLES,De,je,O,Fr.disabled,Yt,i.id,vi,bi,Ar)}}t.resetStencilClippingMasks()},background:function(t,e,i,r){const n=i.paint.get("background-color"),s=i.paint.get("background-opacity"),a=i.paint.get("background-emissive-strength");if(s===0)return;const c=t.context,p=c.gl,_=t.transform,v=_.tileSize,E=i.paint.get("background-pattern");if(t.isPatternMissing(E,i.scope))return;const C=!E&&n.a===1&&s===1&&t.opaquePassEnabledForLayer()?"opaque":"translucent";if(t.renderPass!==C)return;const B=Br.disabled,O=t.depthModeForSublayer(0,C==="opaque"?lr.ReadWrite:lr.ReadOnly),G=t.colorModeForDrapableLayerRenderPass(a),q=E?"backgroundPattern":"background";let X,$=r;$||(X=t.getBackgroundTiles(),$=Object.values(X).map(re=>re.tileID)),E&&(c.activeTexture.set(p.TEXTURE0),t.imageManager.bind(t.context,i.scope));for(const re of $){const ne=t.isTileAffectedByFog(re),ie=t.getOrCreateProgram(q,{overrideFog:ne}),se=re.toUnwrapped(),he=r?re.projMatrix:t.transform.calculateProjMatrix(se);t.prepareDrawTile();const ve=e?e.getTile(re):X?X[re.key]:new G0(re,v,_.zoom,t),be=E?NM(he,a,s,t,E,i.scope,{tileID:re,tileSize:v}):OM(he,a,s,n);t.uploadCommonUniforms(c,ie,se);const{tileBoundsBuffer:De,tileBoundsIndexBuffer:Ve,tileBoundsSegments:je}=t.getTileBoundsBuffers(ve);ie.draw(t,p.TRIANGLES,O,B,G,Fr.disabled,be,i.id,De,Ve,je)}},sky:function(t,e,i){const r=t._atmosphere?Ho(t.transform.zoom):1,n=i.paint.get("sky-opacity")*r;if(n===0)return;const s=t.context,a=i.paint.get("sky-type"),c=new lr(s.gl.LEQUAL,lr.ReadOnly,[0,1]),p=t.frameCounter/1e3%1;a==="atmosphere"?t.renderPass==="offscreen"?i.needsSkyboxCapture(t)&&(function(_,v,E,C){const B=_.context,O=B.gl;let G=v.skyboxFbo;if(!G){G=v.skyboxFbo=B.createFramebuffer(32,32,!0,null),v.skyboxGeometry=new Ub(B),v.skyboxTexture=B.gl.createTexture(),O.bindTexture(O.TEXTURE_CUBE_MAP,v.skyboxTexture),O.texParameteri(O.TEXTURE_CUBE_MAP,O.TEXTURE_WRAP_S,O.CLAMP_TO_EDGE),O.texParameteri(O.TEXTURE_CUBE_MAP,O.TEXTURE_WRAP_T,O.CLAMP_TO_EDGE),O.texParameteri(O.TEXTURE_CUBE_MAP,O.TEXTURE_MIN_FILTER,O.LINEAR),O.texParameteri(O.TEXTURE_CUBE_MAP,O.TEXTURE_MAG_FILTER,O.LINEAR);for(let re=0;re<6;++re)O.texImage2D(O.TEXTURE_CUBE_MAP_POSITIVE_X+re,0,O.RGBA,32,32,0,O.RGBA,O.UNSIGNED_BYTE,null)}B.bindFramebuffer.set(G.framebuffer),B.viewport.set([0,0,32,32]);const q=v.getCenter(_,!0),X=_.getOrCreateProgram("skyboxCapture"),$=new Float64Array(16);ce.identity($),ce.rotateY($,$,.5*-Math.PI),yd(_,v,X,$,q,0),ce.identity($),ce.rotateY($,$,.5*Math.PI),yd(_,v,X,$,q,1),ce.identity($),ce.rotateX($,$,.5*-Math.PI),yd(_,v,X,$,q,2),ce.identity($),ce.rotateX($,$,.5*Math.PI),yd(_,v,X,$,q,3),ce.identity($),yd(_,v,X,$,q,4),ce.identity($),ce.rotateY($,$,Math.PI),yd(_,v,X,$,q,5),B.viewport.set([0,0,_.width,_.height])}(t,i),i.markSkyboxValid(t)):t.renderPass==="sky"&&function(_,v,E,C,B){const O=_.context,G=O.gl,q=_.transform,X=_.getOrCreateProgram("skybox");O.activeTexture.set(G.TEXTURE0),G.bindTexture(G.TEXTURE_CUBE_MAP,v.skyboxTexture);const $=((re,ne,ie,se,he)=>({u_matrix:re,u_sun_direction:ne,u_cubemap:0,u_opacity:se,u_temporal_offset:he}))(q.skyboxMatrix,v.getCenter(_,!1),0,C,B);_.uploadCommonUniforms(O,X),X.draw(_,G.TRIANGLES,E,Br.disabled,_.colorModeForRenderPass(),Fr.backCW,$,"skybox",v.skyboxGeometry.vertexBuffer,v.skyboxGeometry.indexBuffer,v.skyboxGeometry.segment)}(t,i,c,n,p):a==="gradient"&&t.renderPass==="sky"&&function(_,v,E,C,B){const O=_.context,G=O.gl,q=_.transform,X=_.getOrCreateProgram("skyboxGradient");v.skyboxGeometry||(v.skyboxGeometry=new Ub(O)),O.activeTexture.set(G.TEXTURE0);let $=v.colorRampTexture;$||($=v.colorRampTexture=new Bs(O,v.colorRamp,G.RGBA)),$.bind(G.LINEAR,G.CLAMP_TO_EDGE);const re=((ne,ie,se,he,ve)=>({u_matrix:ne,u_color_ramp:0,u_center_direction:ie,u_radius:wi(se),u_opacity:he,u_temporal_offset:ve}))(q.skyboxMatrix,v.getCenter(_,!1),v.paint.get("sky-gradient-radius"),C,B);_.uploadCommonUniforms(O,X),X.draw(_,G.TRIANGLES,E,Br.disabled,_.colorModeForRenderPass(),Fr.backCW,re,"skyboxGradient",v.skyboxGeometry.vertexBuffer,v.skyboxGeometry.indexBuffer,v.skyboxGeometry.segment)}(t,i,c,n,p)},debug:function(t,e,i){for(let r=0;r<i.length;r++)t4(t,e,i[r])},custom:function(t,e,i,r){const n=t.context,s=i.implementation;if(!t.transform.projection.unsupportedLayers||!t.transform.projection.unsupportedLayers.includes("custom")||t.terrain&&(t.terrain.renderingToTexture||t.renderPass==="offscreen")&&i.isLayerDraped(e)){if(t.renderPass==="offscreen"){const a=s.prerender;if(a){if(t.setCustomLayerDefaults(),n.setColorMode(t.colorModeForRenderPass()),t.transform.projection.name==="globe"){const c=t.transform.pointMerc;a.call(s,n.gl,t.transform.customLayerMatrix(),t.transform.getProjection(),t.transform.globeToMercatorMatrix(),Ho(t.transform.zoom),[c.x,c.y],t.transform.pixelsPerMeterRatio)}else a.call(s,n.gl,t.transform.customLayerMatrix());n.setDirty(),t.setBaseState()}}else if(t.renderPass==="translucent"){if(t.terrain&&t.terrain.renderingToTexture){const c=s.renderToTile;if(c){const p=r[0].canonical,_=new Wr(p.x+r[0].wrap*(1<<p.z),p.y,p.z);n.setDepthMode(lr.disabled),n.setStencilMode(Br.disabled),n.setColorMode(t.colorModeForRenderPass()),t.setCustomLayerDefaults(),c.call(s,n.gl,_),n.setDirty(),t.setBaseState()}return}t.setCustomLayerDefaults(),n.setColorMode(t.colorModeForRenderPass()),n.setStencilMode(Br.disabled);const a=s.renderingMode==="3d"?new lr(t.context.gl.LEQUAL,lr.ReadWrite,t.depthRangeFor3D):t.depthModeForSublayer(0,lr.ReadOnly);if(n.setDepthMode(a),t.transform.projection.name==="globe"){const c=t.transform.pointMerc;s.render(n.gl,t.transform.customLayerMatrix(),t.transform.getProjection(),t.transform.globeToMercatorMatrix(),Ho(t.transform.zoom),[c.x,c.y],t.transform.pixelsPerMeterRatio)}else s.render(n.gl,t.transform.customLayerMatrix());n.setDirty(),t.setBaseState(),n.bindFramebuffer.set(null)}}else Be("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(t,e,i,r){if(t.renderPass==="opaque")return;const n=i.paint.get("model-opacity");if(n===0)return;const s=i.paint.get("model-cast-shadows");if(t.renderPass==="shadow"&&(!s||t.terrain&&n<.65&&i._transitionablePaint._values["model-opacity"].value.expression instanceof Bn))return;const a=t.shadowRenderer,c=i.paint.get("model-receive-shadows");a&&(a.useNormalOffset=!0,c||(a.enabled=!1));const p=()=>{a&&(a.useNormalOffset=!0,c||(a.enabled=!0))},_=e.getSource();if(t.renderPass==="light-beam"&&_.type!=="batched-model")return;if(_.type==="vector"||_.type==="geojson")return function(X,$,re,ne){const ie=X.transform;if(ie.projection.name!=="mercator")return void Be(`Drawing 3D models for ${ie.projection.name} projection is not yet implemented`);const se=ie.getFreeCameraOptions().position;if(!X.modelManager)return;const he=X.modelManager,ve=X.shadowRenderer;if(!re._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const be=re._unevaluatedLayout._values["model-id"],De={...re.layout.get("model-id").parameters};for(const Ve of ne){const je=$.getTile(Ve).getBucket(re);if(!je||je.projection.name!==ie.projection.name)continue;const Je=A4(Ve,ie);De.zoom=Je;const Fe=be.possiblyEvaluate(De);if(l4(X,je,Ve),Eu.shadowUniformsInitialized=!1,Eu.useSingleShadowCascade=!!ve&&ve.getMaxCascadeForTile(Ve.toUnwrapped())===0,X.renderPass==="shadow"&&ve){if(X.currentShadowCascade===1&&je.isInsideFirstShadowMapFrustum)continue;const vt=ie.calculatePosMatrix(Ve.toUnwrapped(),ie.worldSize);if(Eu.tileMatrix.set(vt),Eu.shadowTileMatrix=Float32Array.from(ve.calculateShadowPassMatrixFromMatrix(vt)),Eu.aabb.min.fill(0),Eu.aabb.max[0]=Eu.aabb.max[1]=Mt,Eu.aabb.max[2]=0,u4(je,Eu,X,re.scope))continue}const nt=1<<Ve.canonical.z,At=[((se.x-Ve.wrap)*nt-Ve.canonical.x)*Mt,(se.y*nt-Ve.canonical.y)*Mt,se.z*nt*Mt];for(let vt in je.instancesPerModel){const rt=je.instancesPerModel[vt];rt.features.length>0&&(vt=Fe.evaluate(rt.features[0].feature,{}));const lt=he.getModel(vt,re.scope);if(lt&&lt.uploaded)for(const wt of lt.nodes)Gb(X,re,wt,rt,At,Ve,Eu)}}}(t,e,i,r),void p();if(!_.loaded())return;if(_.type==="batched-model")return function(X,$,re,ne){const ie=X.context,se=X.transform,he=X.style.fog,ve=X.shadowRenderer;if(se.projection.name!=="mercator")return void Be(`Drawing 3D landmark models for ${se.projection.name} projection is not yet implemented`);const be=X.transform.getFreeCameraOptions().position,De=me.scale([],[be.x,be.y,be.z],X.transform.worldSize);me.negate(De,De);const Ve=ce.identity([]),je=dh(se.center.lat,se.zoom),Je=ce.fromScaling([],[1,1,1/je]);ce.translate(Ve,Ve,De);const Fe=re.paint.get("model-opacity"),nt=new lr(ie.gl.LEQUAL,lr.ReadWrite,X.depthRangeFor3D),At=new lr(ie.gl.LEQUAL,lr.ReadOnly,X.depthRangeFor3D),vt=function(rt,lt){for(const wt of ne){const It=$.getTile(wt).getBucket(re);if(!It||!It.uploaded)continue;let St=!1;ve&&(St=ve.getMaxCascadeForTile(wt.toUnwrapped())===0);const Bt=se.calculatePosMatrix(wt.toUnwrapped(),se.worldSize),Ft=It.modelTraits;for(const jt of It.getNodesInfo()){if(jt.hiddenByReplacement||!jt.node.meshes)continue;const Dt=jt.node,Yt=X.renderPass==="light-beam",fi=[...Bt],di=jt.evaluatedScale;let vi=0;X.terrain&&Dt.elevation&&(vi=Dt.elevation*X.terrain.exaggeration()),ce.translate(fi,fi,[(Dt.anchor?Dt.anchor[0]:0)*(di[0]-1),(Dt.anchor?Dt.anchor[1]:0)*(di[1]-1),vi]),di!==jT&&ce.scale(fi,fi,di),ce.multiply(fi,fi,Dt.matrix);const bi=ce.multiply([],Je,fi);ce.multiply(bi,Ve,bi);const Ar=ce.invert([],bi);ce.transpose(Ar,Ar),ce.scale(Ar,Ar,c4);const Ni=ce.multiply([],se.expandedFarZProjMatrix,fi);for(let rn=0;rn<Dt.meshes.length;++rn){const Vr=Dt.meshes[rn],cr=rn===Dt.lightMeshIndex;if(cr){if(!Yt&&!X.terrain&&X.shadowRenderer){X.currentLayer<X.firstLightBeamLayer&&(X.firstLightBeamLayer=X.currentLayer);continue}}else if(Yt)continue;const rr={defines:[]},Hi=[];Ty(rr.defines,Hi,Vr,X),4&Ft||rr.defines.push("DIFFUSE_SHADED"),St&&rr.defines.push("SHADOWS_SINGLE_CASCADE");const Zr=X.renderPass==="shadow";if(Zr){Ey(Vr,fi,X,re);continue}let Kr=null;if(he){const go=Vb(fi,X.transform);if(Kr=new Float32Array(go),se.projection.name!=="globe"){const lo=Vr.aabb.min,vs=Vr.aabb.max,[Ln,Ua]=he.getOpacityForBounds(go,lo[0],lo[1],vs[0],vs[1]);rr.overrideFog=Ln>=of||Ua>=of}}const zr=X.getOrCreateProgram("model",rr);!Zr&&ve&&(ve.useNormalOffset=!!Vr.normalBuffer,ve.setupShadowsFromMatrix(fi,zr,ve.useNormalOffset)),X.uploadCommonUniforms(ie,zr,wt.toUnwrapped(),Kr);const Gn=Vr.material,ao=Gn.pbrMetallicRoughness;ao.metallicFactor=.9,ao.roughnessFactor=.5;const On=0,ds=by(new Float32Array(Ni),new Float32Array(bi),new Float32Array(Ar),X,Fe,ao.baseColorFactor,Gn.emissiveFactor,ao.metallicFactor,ao.roughnessFactor,Gn,On,re);zr.draw(X,ie.gl.TRIANGLES,lt&&!cr?nt:At,Br.disabled,rt?cr||Fe<1||jt.hasTranslucentParts?An.alphaBlended:An.unblended:An.disabled,Fr.backCCW,ds,re.id,Vr.vertexBuffer,Vr.indexBuffer,Vr.segments,re.paint,X.transform.zoom,void 0,Hi)}}}};(function(rt,lt,wt,It){const St=rt.terrain?rt.terrain.exaggeration():0,Bt=rt.transform.zoom;for(const Ft of It){const jt=lt.getTile(Ft).getBucket(wt);jt&&(rt.conflationActive&&jt.updateReplacement(Ft,rt.replacementSource),jt.evaluateScale(rt,wt),rt.terrain&&St>0&&jt.elevationUpdate(rt.terrain,St,Ft,wt.source),jt.needsReEvaluation(rt,Bt,wt)&&jt.evaluate(wt))}})(X,$,re,ne),Fe===1?vt(!0,!0):(vt(!1,!0),vt(!0,!1))}(t,e,i,r),void p();const v=_.getModels(),E=[],C=t.transform.getFreeCameraOptions().position,B=me.scale([],[C.x,C.y,C.z],t.transform.worldSize);me.negate(B,B);const O=[],G=[];let q=0;for(const X of v){const $=i.paint.get("model-rotation").constantOr(null),re=i.paint.get("model-scale").constantOr(null),ne=i.paint.get("model-translation").constantOr(null);X.computeModelMatrix(t,$,re,ne,!0,!0,!1);const ie=ce.identity([]),se=dh(X.position.lat,t.transform.zoom),he=ce.fromScaling([],[1,1,1/se]);ce.translate(ie,ie,B),E.push({zScaleMatrix:he,negCameraPosMatrix:ie});for(const ve of X.nodes)jb(t.transform,ve,X.matrix,t.transform.expandedFarZProjMatrix,q,O,G);q++}if(O.sort((X,$)=>$.depth-X.depth),t.renderPass!=="shadow"){if(n===1)for(const X of G)y_(X,t,i,E[X.modelIndex],Br.disabled,t.colorModeForRenderPass());else{for(const X of G)y_(X,t,i,E[X.modelIndex],Br.disabled,An.disabled);for(const X of G)y_(X,t,i,E[X.modelIndex],t.stencilModeFor3D(),t.colorModeForRenderPass());t.resetStencilClippingMasks()}for(const X of O)y_(X,t,i,E[X.modelIndex],Br.disabled,t.colorModeForRenderPass());p()}else{for(const X of G)Ey(X.mesh,X.nodeModelMatrix,t,i);for(const X of O)Ey(X.mesh,X.nodeModelMatrix,t,i);p()}}},qb={modelUpload:function(t,e,i){const r=e.getSource();if(!r.loaded())return;if(r.type==="vector"||r.type==="geojson")return void(t.modelManager&&t.modelManager.upload(t,i));if(r.type==="batched-model")return;const n=r.getModels();for(const s of n)s.upload(t.context)}};class d4{constructor(e,i,r){this.context=new DT(e,i),this.transform=r,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=iu.maxUnderzooming+iu.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new WT,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new _4(this),this._wireframeDebugCache=new f4,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0}updateTerrain(e,i){const r=!!e&&!!e.terrain&&this.transform.projection.supportsTerrain;if(!(r||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new bM(this,e));const n=this._terrain;this.transform.elevation=r?n:null,n.update(e,this.transform,i),this.transform.elevation&&!n.enabled&&(this.transform.elevation=null)}_updateFog(e){const i=e.fog;if(!i||this.transform.projection.name==="globe"||i.getOpacity(this.transform.pitch)<1||i.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[r,n]=i.getFovAdjustedRange(this.transform._fov);if(r>n)return void(this.transform.fogCullDistSq=null);const s=r+.78*(n-r);this.transform.fogCullDistSq=s*s}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(e,i){if(this.width=e*Wi.devicePixelRatio,this.height=i*Wi.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const r of this.style.order)this.style._mergedLayers[r].resize()}setup(){const e=this.context,i=new pl;i.emplaceBack(0,0),i.emplaceBack(Mt,0),i.emplaceBack(0,Mt),i.emplaceBack(Mt,Mt),this.tileExtentBuffer=e.createVertexBuffer(i,xi.members),this.tileExtentSegments=Mn.simpleSegment(0,0,4,2);const r=new pl;r.emplaceBack(0,0),r.emplaceBack(Mt,0),r.emplaceBack(0,Mt),r.emplaceBack(Mt,Mt),this.debugBuffer=e.createVertexBuffer(r,xi.members),this.debugSegments=Mn.simpleSegment(0,0,4,5);const n=new pl;n.emplaceBack(-1,-1),n.emplaceBack(1,-1),n.emplaceBack(-1,1),n.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(n,xi.members),this.viewportSegments=Mn.simpleSegment(0,0,4,2);const s=new Uc;s.emplaceBack(0,0,0,0),s.emplaceBack(Mt,0,Mt,0),s.emplaceBack(0,Mt,0,Mt),s.emplaceBack(Mt,Mt,Mt,Mt),this.mercatorBoundsBuffer=e.createVertexBuffer(s,Ng.members),this.mercatorBoundsSegments=Mn.simpleSegment(0,0,4,2);const a=new so;a.emplaceBack(0,1,2),a.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(a);const c=new Gc;for(const _ of[0,1,3,2,0])c.emplaceBack(_);this.debugIndexBuffer=e.createIndexBuffer(c),this.emptyTexture=new Bs(e,new Do({width:1,height:1},Uint8Array.of(0,0,0,0)),e.gl.RGBA),this.identityMat=ce.create();const p=this.context.gl;this.stencilClearMode=new Br({func:p.ALWAYS,mask:0},0,255,p.ZERO,p.ZERO,p.ZERO),this.loadTimeStamps.push(Ee.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(e){return e._makeTileBoundsBuffers(this.context,this.transform.projection),e._tileBoundsBuffer?{tileBoundsBuffer:e._tileBoundsBuffer,tileBoundsIndexBuffer:e._tileBoundsIndexBuffer,tileBoundsSegments:e._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const e=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,e.TRIANGLES,lr.disabled,this.stencilClearMode,An.disabled,Fr.disabled,vy(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(e,i,r){if(!i||this.currentStencilSource===i.id||!e.isTileClipped()||!r||r.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let c=!1;for(const p of r)if(this._tileClippingMaskIDs[p.key]===void 0){c=!0;break}if(!c)return}this.currentStencilSource=i.id;const n=this.context,s=n.gl;this.nextStencilID+r.length>256&&this.clearStencil(),n.setColorMode(An.disabled),n.setDepthMode(lr.disabled);const a=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const c of r){const p=i.getTile(c),_=this._tileClippingMaskIDs[c.key]=this.nextStencilID++,{tileBoundsBuffer:v,tileBoundsIndexBuffer:E,tileBoundsSegments:C}=this.getTileBoundsBuffers(p);a.draw(this,s.TRIANGLES,lr.disabled,new Br({func:s.ALWAYS,mask:0},_,255,s.KEEP,s.KEEP,s.REPLACE),An.disabled,Fr.disabled,vy(c.projMatrix),"$clipping",v,E,C)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,i=this.context.gl;return new Br({func:i.NOTEQUAL,mask:255},e,255,i.KEEP,i.KEEP,i.REPLACE)}stencilModeForClipping(e){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(e);const i=this.context.gl;return new Br({func:i.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,i.KEEP,i.KEEP,i.REPLACE)}stencilConfigForOverlap(e){const i=this.context.gl,r=e.sort((a,c)=>c.overscaledZ-a.overscaledZ),n=r[r.length-1].overscaledZ,s=r[0].overscaledZ-n+1;if(s>1){this.currentStencilSource=void 0,this.nextStencilID+s>256&&this.clearStencil();const a={};for(let c=0;c<s;c++)a[c+n]=new Br({func:i.GEQUAL,mask:255},c+this.nextStencilID,255,i.KEEP,i.KEEP,i.REPLACE);return this.nextStencilID+=s,[a,r]}return[{[n]:Br.disabled},r]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new An([e.CONSTANT_COLOR,e.ONE,e.CONSTANT_COLOR,e.ONE],new fr(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?An.unblended:An.alphaBlended}colorModeForDrapableLayerRenderPass(e){const i=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new An([i.ONE,i.ONE_MINUS_SRC_ALPHA,i.CONSTANT_ALPHA,i.ONE_MINUS_SRC_ALPHA],new fr(0,0,0,e===void 0?0:e),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(e,i,r,n=!1){if(!this.opaquePassEnabledForLayer()&&!n)return lr.disabled;const s=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new lr(r||this.context.gl.LEQUAL,i,[s,s])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,i){this._wireframeDebugCache.update(this.frameCounter),this.style=e,this.options=i;const r=this.style._mergedLayers,n=this.style.order,s=n.map(ie=>r[ie]),a=this.style._mergedSourceCaches;this.imageManager=e.imageManager,this.modelManager=e.modelManager,this.symbolFadeChange=e.placement.symbolFadeChange(Wi.now()),this.imageManager.beginFrame();let c=0,p=!1;for(const ie in a){const se=a[ie];se.used&&(se.prepare(this.context),se.getSource().usedInConflation&&++c)}const _={},v={},E={},C={},B={};for(const ie in a){const se=a[ie];_[ie]=se.getVisibleCoordinates(),v[ie]=_[ie].slice().reverse(),E[ie]=se.getVisibleCoordinates(!0).reverse(),C[ie]=se.getShadowCasterCoordinates(),B[ie]=se.sortCoordinatesByDistance(_[ie])}const O=ie=>{const se=this.style.getLayerSourceCache(ie);return se&&se.used?se.getSource():null};if(c){const ie=[];for(const se of s)this.layerUsedInConflation(se,O(se))&&ie.push(se);if(ie&&ie.length>1){const se=[];for(const he of ie){const ve=this.style.getLayerSourceCache(he);ve&&ve.used&&ve.getSource().usedInConflation&&se.push({layer:he.fqid,cache:ve})}this.replacementSource.setSources(se),p=!0}}p||this.replacementSource.clear(),this.conflationActive=p,this.minCutoffZoom=0,this.longestCutoffRange=0;for(const ie of s){const se=ie.cutoffRange();if(this.longestCutoffRange=Math.max(se,this.longestCutoffRange),se>0){const he=O(ie);he&&(this.minCutoffZoom=Math.max(he.minzoom,this.minCutoffZoom)),ie.minzoom&&(this.minCutoffZoom=Math.max(ie.minzoom,this.minCutoffZoom))}}this.opaquePassCutoff=1/0;for(let ie=0;ie<s.length;ie++)if(s[ie].is3D()){this.opaquePassCutoff=ie;break}const G=this.style&&this.style.fog;G?(this._fogVisible=G.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=G.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(E),this.opaquePassCutoff=0);const q=this._shadowRenderer;if(q){q.updateShadowParameters(this.transform,this.style.directionalLight);for(const ie in a)for(const se of _[ie]){let he={min:0,max:0};this.terrain&&(he=this.terrain.getMinMaxForTile(se)||he),q.addShadowReceiver(se.toUnwrapped(),he.min,he.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new il(this.context));for(const ie of s){if(ie.isHidden(this.transform.zoom))continue;const se=e.getLayerSourceCache(ie);this.uploadLayer(this,ie,se)}if(this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new a4),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!Ko.has(this.context.gl))return;this.renderPass="offscreen";for(const ie of s){const se=e.getLayerSourceCache(ie);if(!ie.hasOffscreenPass()||ie.isHidden(this.transform.zoom))continue;const he=se?v[se.id]:void 0;(ie.type==="custom"||ie.type==="raster"||ie.isSky()||he&&he.length)&&this.renderLayer(this,se,ie,he)}this.depthRangeFor3D=[0,1-(s.length+2)*this.numSublayers*this.depthEpsilon];const X=this.terrain;X&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&X.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,C)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const $=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),re=(()=>{if(i.showOverdrawInspector)return fr.black;if(this.style.fog&&this.transform.projection.supportsFog&&!$){const ie=this.style.fog.properties.get("color").toArray01();return new fr(...ie)}if(this.style.fog&&this.transform.projection.supportsFog&&$){const ie=this.style.fog.properties.get("space-color").toArray01();return new fr(...ie)}return fr.transparent})();if(this.context.clear({color:re,depth:1}),this.clearStencil(),this._showOverdrawInspector=i.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&$&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=n.length-1;this.currentLayer>=0;this.currentLayer--){const ie=s[this.currentLayer],se=e.getLayerSourceCache(ie);if(ie.isSky())continue;const he=se?(ie.is3D()?B:v)[se.id]:void 0;this._renderTileClippingMasks(ie,se,he),this.renderLayer(this,se,ie,he)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&$&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||Ho(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<n.length;this.currentLayer++){const ie=s[this.currentLayer],se=e.getLayerSourceCache(ie);ie.isSky()&&this.renderLayer(this,se,ie,se?v[se.id]:void 0)}this.renderPass="translucent",this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let ne=0;for(q&&(ne=q.getShadowCastingLayerCount());this.currentLayer<n.length;){const ie=s[this.currentLayer],se=e.getLayerSourceCache(ie);if(ie.isSky()){++this.currentLayer;continue}if(X&&this.style.isLayerDraped(ie)){if(ie.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=X.renderBatch(this.currentLayer);continue}let he;if(se&&(he=(ie.type==="symbol"?E:ie.is3D()?B:v)[se.id]),this._renderTileClippingMasks(ie,se,se?_[se.id]:void 0),this.renderLayer(this,se,ie,he),!X&&q&&ne>0&&ie.hasShadowPass()&&--ne==0&&(q.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const ve=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=ve;this.currentLayer++){const be=s[this.currentLayer];if(!be.hasLightBeamPass())continue;const De=e.getLayerSourceCache(be);this.renderLayer(this,De,be,De?v[De.id]:void 0)}this.currentLayer=ve,this.renderPass="translucent"}++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let ie=null;s.forEach(se=>{const he=e.getLayerSourceCache(se);he&&!se.isHidden(this.transform.zoom)&&he.getVisibleCoordinates().length&&(!ie||ie.getSource().maxzoom<he.getSource().maxzoom)&&(ie=he)}),ie&&this.options.showTileBoundaries&&Zb.debug(this,ie,ie.getVisibleCoordinates())}this.options.showPadding&&function(ie){const se=ie.transform.padding;Ob(ie,ie.transform.height-(se.top||0),3,YM),Ob(ie,se.bottom||0,3,KM),Nb(ie,se.left||0,3,JM),Nb(ie,ie.transform.width-(se.right||0),3,$M);const he=ie.transform.centerPoint;(function(ve,be,De,Ve){g_(ve,be-1,De-10,2,20,Ve),g_(ve,be-10,De-1,20,2,Ve)})(ie,he.x,ie.transform.height-he.y,e4)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(Ee.performance.now()),this.saveCanvasCopy()),p||(this.conflationActive=!1)}uploadLayer(e,i,r){this.gpuTimingStart(i),(!e.transform.projection.unsupportedLayers||!e.transform.projection.unsupportedLayers.includes(i.type)||e.terrain&&i.type==="custom")&&qb[`${i.type}Upload`]&&qb[`${i.type}Upload`](e,r,i.scope),this.gpuTimingEnd()}renderLayer(e,i,r,n){r.isHidden(this.transform.zoom)||(r.type==="background"||r.type==="sky"||r.type==="custom"||r.type==="model"||r.type==="raster"||n&&n.length)&&(this.id=r.id,this.gpuTimingStart(r),(!e.transform.projection.unsupportedLayers||!e.transform.projection.unsupportedLayers.includes(r.type)||e.terrain&&r.type==="custom")&&Zb[r.type](e,i,r,n,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(e){if(!this.options.gpuTiming)return;const i=this.context.extTimerQuery,r=this.context.gl;let n=this.gpuTimers[e.id];n||(n=this.gpuTimers[e.id]={calls:0,cpuTime:0,query:r.createQuery()}),n.calls++,r.beginQuery(i.TIME_ELAPSED_EXT,n.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const e=this.context.extTimerQuery,i=this.context.gl,r=i.createQuery();this.deferredRenderGpuTimeQueries.push(r),i.beginQuery(e.TIME_ELAPSED_EXT,r)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const e=this.gpuTimers;return this.gpuTimers={},e}collectDeferredRenderGpuQueries(){const e=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],e}queryGpuTimers(e){const i={};for(const r in e){const n=e[r],s=this.context.extTimerQuery,a=s.getQueryParameter(n.query,this.context.gl.QUERY_RESULT)/1e6;s.deleteQueryEXT(n.query),i[r]=a}return i}queryGpuTimeDeferredRender(e){if(!this.options.gpuTimingDeferredRender)return 0;const i=this.context.extTimerQuery,r=this.context.gl;let n=0;for(const s of e)n+=i.getQueryParameter(s,r.QUERY_RESULT)/1e6,i.deleteQueryEXT(s);return n}translatePosMatrix(e,i,r,n,s){if(!r[0]&&!r[1])return e;const a=s?n==="map"?this.transform.angle:0:n==="viewport"?-this.transform.angle:0;if(a){const _=Math.sin(a),v=Math.cos(a);r=[r[0]*v-r[1]*_,r[0]*_+r[1]*v]}const c=[s?r[0]:rf(i,r[0],this.transform.zoom),s?r[1]:rf(i,r[1],this.transform.zoom),0],p=new Float32Array(16);return ce.translate(p,e,c),p}saveTileTexture(e){const i=e.size[0],r=this._tileTextures[i];r?r.push(e):this._tileTextures[i]=[e]}getTileTexture(e){const i=this._tileTextures[e];return i&&i.length>0?i.pop():null}isPatternMissing(e,i){return e===null||e!==void 0&&!this.imageManager.getPattern(e.toString(),i)}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(e,i,r){const n=r===void 0?this.terrain&&this.terrain.renderingToTexture:r,s=this.terrain&&this.terrain.exaggeration()===0,a=[];return this.style&&this.style.enable3dLights()&&(e==="globeRaster"||e==="terrainRaster"?(a.push("LIGHTING_3D_MODE"),a.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):n||a.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"?this._shadowMapDebug||a.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?a.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):a.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(a.push("TERRAIN"),this.linearFloatFilteringSupported()&&a.push("TERRAIN_DEM_FLOAT_FORMAT"),s&&a.push("ZERO_EXAGGERATION")),this.transform.projection.name==="globe"&&a.push("GLOBE"),!this._fogVisible||n||i!==void 0&&!i||a.push("FOG","FOG_DITHERING"),n&&a.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&a.push("OVERDRAW_INSPECTOR"),a}getOrCreateProgram(e,i){this.cache=this.cache||{};const r=i&&i.defines||[],n=i&&i.config,s=this.currentGlobalDefines(e,i&&i.overrideFog,i&&i.overrideRtt).concat(r),a=bb.cacheKey(hb[e],e,s,n);return this.cache[a]||(this.cache[a]=new bb(this.context,e,hb[e],n,UM[e],s)),this.cache[a]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=Ee.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Bs(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(e,i){if(this.style.enable3dLights()){const r=this.style.directionalLight,n=this.style.ambientLight;if(r&&n){const s=((a,c)=>{const p=a.properties.get("direction"),_=a.properties.get("color").toArray01(),v=a.properties.get("intensity"),E=c.properties.get("color").toArray01(),C=c.properties.get("intensity"),B=[p.x,p.y,p.z],O=ni(E,C),G=ni(_,v);return{u_lighting_ambient_color:O,u_lighting_directional_dir:B,u_lighting_directional_color:G,u_ground_radiance:wM(B,G,O)}})(r,n);i.setLightsUniformValues(e,s)}}}uploadCommonUniforms(e,i,r,n,s){if(this.uploadCommonLightUniforms(e,i),this.terrain&&this.terrain.renderingToTexture)return;const a=this.style.fog;if(a){const c=a.getOpacity(this.transform.pitch),p=((_,v,E,C,B,O,G,q,X,$,re,ne)=>{const ie=_.transform,se=v.properties.get("color").toArray01();se[3]=C;const he=_.frameCounter/1e3%1,[ve,be]=v.properties.get("vertical-range");return{u_fog_matrix:E?ie.calculateFogTileMatrix(E):ne||_.identityMat,u_fog_range:v.getFovAdjustedRange(ie._fov),u_fog_color:se,u_fog_horizon_blend:v.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(ve,be),be],u_fog_temporal_offset:he,u_frustum_tl:B,u_frustum_tr:O,u_frustum_br:G,u_frustum_bl:q,u_globe_pos:X,u_globe_radius:$,u_viewport:re,u_globe_transition:Ho(ie.zoom),u_is_globe:+(ie.projection.name==="globe")}})(this,a,r,c,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*Wi.devicePixelRatio,this.transform.height*Wi.devicePixelRatio],n);i.setFogUniformValues(e,p)}s&&i.setCutoffUniformValues(e,s.uniformValues)}setTileLoadedFlag(e){this.tileLoaded=e}saveCanvasCopy(){const e=this.canvasCopy();e&&(this.frameCopies.push(e),this.tileLoaded=!1)}canvasCopy(){const e=this.context.gl,i=e.createTexture();return e.bindTexture(e.TEXTURE_2D,i),e.copyTexImage2D(e.TEXTURE_2D,0,e.RGBA,0,0,e.drawingBufferWidth,e.drawingBufferHeight,0),i}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const e=this.style&&this.style.fog;return!!e&&e.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const e=this._backgroundTiles,i=this._backgroundTiles={},r=this.transform.coveringTiles({tileSize:512});for(const n of r)i[n.key]=e[n.key]||new G0(n,512,this.transform.tileZoom,this);return i}clearBackgroundTiles(){this._backgroundTiles={}}layerUsedInConflation(e,i){return!(!e.is3D()||e.minzoom&&e.minzoom>this.transform.zoom||e.sourceLayer!=="building"&&(!i||i.type!=="batched-model"))}isTileAffectedByFog(e){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let i=this._cachedTileFogOpacities[e.key];return i||(this._cachedTileFogOpacities[e.key]=i=this.style.fog.getOpacityForTile(e)),i[0]>=of||i[1]>=of}}const Af=2048;class p4{constructor(e,i){this.aabb=e,this.lastCascade=i}}class m4{add(e,i){const r=this.receivers[e.key];r!==void 0?(r.aabb.min[0]=Math.min(r.aabb.min[0],i.min[0]),r.aabb.min[1]=Math.min(r.aabb.min[1],i.min[1]),r.aabb.min[2]=Math.min(r.aabb.min[2],i.min[2]),r.aabb.max[0]=Math.max(r.aabb.max[0],i.max[0]),r.aabb.max[1]=Math.max(r.aabb.max[1],i.max[1]),r.aabb.max[2]=Math.max(r.aabb.max[2],i.max[2])):this.receivers[e.key]=new p4(i,null)}clear(){this.receivers={}}get(e){return this.receivers[e.key]}computeRequiredCascades(e,i,r){const n=Hr.fromPoints(e.points);let s=0;for(const a in this.receivers){const c=this.receivers[a];if(!c||!n.intersectsAabb(c.aabb))continue;c.aabb.min=n.closestPoint(c.aabb.min),c.aabb.max=n.closestPoint(c.aabb.max);const p=c.aabb.getCorners();for(let _=0;_<r.length;_++){let v=!0;for(const E of p){const C=[E[0]*i,E[1]*i,E[2]];if(me.transformMat4(C,C,r[_].matrix),C[0]<-1||C[0]>1||C[1]<-1||C[1]>1){v=!1;break}}if(c.lastCascade=_,s=Math.max(s,_),v)break}}return s+1}}class _4{constructor(e){this.painter=e,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new m4,this._depthMode=new lr(e.context.gl.LEQUAL,lr.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this.useNormalOffset=!1}destroy(){for(const e of this._cascades)e.texture.destroy(),e.framebuffer.destroy();this._cascades=[]}updateShadowParameters(e,i){const r=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!i||!i.properties)return;const n=i.properties.get("shadow-intensity");if(!i.shadowsEnabled()||n<=0||(this._shadowLayerCount=r.style.order.reduce((B,O)=>{const G=r.style._mergedLayers[O];return B+(G.hasShadowPass()&&!G.isHidden(e.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this._enabled))return;const s=r.context,a=Af,c=Af;if(this._cascades.length===0)for(let B=0;B<2;++B){const O=r._shadowMapDebug,G=s.gl,q=s.createFramebuffer(a,c,O,"texture"),X=new Bs(s,{width:a,height:c,data:null},G.DEPTH_COMPONENT);if(q.depthAttachment.set(X.texture),O){const $=new Bs(s,{width:a,height:c,data:null},G.RGBA);q.colorAttachment.set($.texture)}this._cascades.push({framebuffer:q,texture:X,matrix:[],far:0,boundingSphereRadius:0,frustum:new Xs,scale:0})}this.shadowDirection=Qb(i);let p=0;if(e.elevation){const B=e.elevation,O=[1e4,-1e4];B.visibleDemTiles.filter(G=>G.dem).forEach(G=>{const q=G.dem.tree;O[0]=Math.min(O[0],q.minimums[0]),O[1]=Math.max(O[1],q.maximums[0])}),O[0]!==1e4&&(p=(O[1]-O[0])*B.exaggeration())}const _=1.5*e.cameraToCenterDistance,v=3*_,E=new Float64Array(16);for(let B=0;B<2;++B){const O=this._cascades[B];let G=e.height/50,q=1;B===0?q=_:(G=_,q=v);const[X,$]=g4(e,this.shadowDirection,G,q,Af,p);O.scale=e.scale,O.matrix=X,O.boundingSphereRadius=$,ce.invert(E,O.matrix),O.frustum=Xs.fromInvProjectionMatrix(E,1,0,!0),O.far=q}this._uniformValues.u_fade_range=[.75*this._cascades[1].far,this._cascades[1].far],this._uniformValues.u_shadow_intensity=n,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=.00048828125,this._uniformValues.u_shadow_map_resolution=Af,this._uniformValues.u_shadowmap_0=IA.ShadowMap0,this._uniformValues.u_shadowmap_1=IA.ShadowMap0+1,this._groundShadowTiles=r.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const C=r.transform.elevation;for(const B of this._groundShadowTiles){let O={min:0,max:0};if(C){const G=C.getMinMaxForTile(B);G&&(O=G)}this.addShadowReceiver(B.toUnwrapped(),O.min,O.max)}}get enabled(){return this._enabled}set enabled(e){this._enabled=e}drawShadowPass(e,i){if(!this._enabled)return;const r=this.painter,n=r.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(r.transform.getFrustum(0),r.transform.worldSize,this._cascades),n.viewport.set([0,0,Af,Af]);for(let s=0;s<this._numCascadesToRender;++s){r.currentShadowCascade=s,n.bindFramebuffer.set(this._cascades[s].framebuffer.framebuffer),n.clear({color:fr.white,depth:1});for(const a of e.order){const c=e._mergedLayers[a];if(!c.hasShadowPass()||c.isHidden(r.transform.zoom))continue;const p=e.getLayerSourceCache(c),_=p?i[p.id]:void 0;(c.type==="model"||_&&_.length)&&r.renderLayer(r,p,c,_)}}r.currentShadowCascade=0}drawGroundShadows(){if(!this._enabled)return;const e=this.painter,i=e.style,r=e.context,n=i.directionalLight,s=i.ambientLight;if(!n||!s)return;const a=[],c=md(e,e.longestCutoffRange);c.shouldRenderCutoff&&a.push("RENDER_CUTOFF");const p=My(n,s),_=new lr(r.gl.LEQUAL,lr.ReadOnly,e.depthRangeFor3D);for(const v of this._groundShadowTiles){const E=v.toUnwrapped(),C=e.isTileAffectedByFog(v),B=e.getOrCreateProgram("groundShadow",{defines:a,overrideFog:C});this.setupShadows(E,B),e.uploadCommonUniforms(r,B,E,null,c);const O={u_matrix:e.transform.calculateProjMatrix(E),u_ground_shadow_factor:p};B.draw(e,r.gl.TRIANGLES,_,Br.disabled,An.multiply,Fr.disabled,O,"ground_shadow",e.tileExtentBuffer,e.quadTriangleIndexBuffer,e.tileExtentSegments,{},e.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?An.unblended:An.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(e){const i=this.painter.transform,r=i.calculatePosMatrix(e,i.worldSize);return ce.multiply(r,this._cascades[this.painter.currentShadowCascade].matrix,r),Float32Array.from(r)}calculateShadowPassMatrixFromMatrix(e){return ce.multiply(e,this._cascades[this.painter.currentShadowCascade].matrix,e),Float32Array.from(e)}setupShadows(e,i,r,n=0){if(!this._enabled)return;const s=this.painter.transform,a=this.painter.context,c=a.gl,p=this._uniformValues,_=new Float64Array(16),v=s.calculatePosMatrix(e,s.worldSize);for(let E=0;E<2;E++)ce.multiply(_,this._cascades[E].matrix,v),p[E===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(_),a.activeTexture.set(c.TEXTURE0+IA.ShadowMap0+E),this._cascades[E].texture.bind(c.NEAREST,c.CLAMP_TO_EDGE);if(this.useNormalOffset=!!r,this.useNormalOffset){const E=C0(e.canonical),C=2/s.tileSize*Mt/Af,B=C*this._cascades[0].boundingSphereRadius,O=C*this._cascades[1].boundingSphereRadius,G=(r==="vector-tile"?1:3)/Math.pow(2,n-e.canonical.z-(1-s.zoom+Math.floor(s.zoom)));p.u_shadow_normal_offset=[E,B*G,O*G],p.u_shadow_bias=[6e-5,.0012,.012]}else p.u_shadow_bias=[36e-5,.0012,.012];i.setShadowUniformValues(a,p)}setupShadowsFromMatrix(e,i,r=!1){if(!this._enabled)return;const n=this.painter.context,s=n.gl,a=this._uniformValues,c=new Float64Array(16);for(let p=0;p<2;p++)ce.multiply(c,this._cascades[p].matrix,e),a[p===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(c),n.activeTexture.set(s.TEXTURE0+IA.ShadowMap0+p),this._cascades[p].texture.bind(s.NEAREST,s.CLAMP_TO_EDGE);this.useNormalOffset=r,r?(a.u_shadow_normal_offset=[1,5,5],a.u_shadow_bias=[6e-5,.0012,.012]):a.u_shadow_bias=[36e-5,.0012,.012],i.setShadowUniformValues(n,a)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(e,i,r,n){if(n[2]>=0)return{};const s=function(p,_,v){const E=v/(1<<p.canonical.z);return new Hr([p.canonical.x*E+p.wrap*v,p.canonical.y*E+p.wrap*v,0],[(p.canonical.x+1)*E+p.wrap*v,(p.canonical.y+1)*E+p.wrap*v,_])}(e,i,r).getCorners(),a=i/-n[2];n[0]<0?(me.add(s[0],s[0],[n[0]*a,0,0]),me.add(s[3],s[3],[n[0]*a,0,0])):n[0]>0&&(me.add(s[1],s[1],[n[0]*a,0,0]),me.add(s[2],s[2],[n[0]*a,0,0])),n[1]<0?(me.add(s[0],s[0],[0,n[1]*a,0]),me.add(s[1],s[1],[0,n[1]*a,0])):n[1]>0&&(me.add(s[2],s[2],[0,n[1]*a,0]),me.add(s[3],s[3],[0,n[1]*a,0]));const c={};return c.vertices=s,c.planes=[x_(s[1],s[0],s[4]),x_(s[2],s[1],s[5]),x_(s[3],s[2],s[6]),x_(s[0],s[3],s[7])],c}addShadowReceiver(e,i,r){this._receivers.add(e,Hr.fromTileIdAndHeight(e,i,r))}getMaxCascadeForTile(e){const i=this._receivers.get(e);return i&&i.lastCascade?i.lastCascade:0}}function x_(t,e,i){const r=me.sub([],i,e),n=me.sub([],t,e),s=me.cross([],r,n),a=me.length(s);return a===0?[0,0,1,0]:(me.scale(s,s,1/a),[s[0],s[1],s[2],-me.dot(s,e)])}function Qb(t){const e=t.properties.get("direction"),i=ti(e.x,e.y,e.z);i[2]=Ai(i[2],0,75);const r=ii([i[0],i[1],i[2]]);return me.fromValues(r.x,r.y,r.z)}function My(t,e){const i=t.properties.get("color"),r=t.properties.get("intensity"),n=t.properties.get("direction"),s=[n.x,n.y,n.z],a=e.properties.get("color"),c=e.properties.get("intensity"),p=Math.max(me.dot([0,0,1],s),0),_=[0,0,0];me.scale(_,a.toArray01Linear().slice(0,3),c);const v=[0,0,0];return me.scale(v,i.toArray01Linear().slice(0,3),p*r),yn([_[0]>0?_[0]/(_[0]+v[0]):0,_[1]>0?_[1]/(_[1]+v[1]):0,_[2]>0?_[2]/(_[2]+v[2]):0])}function g4(t,e,i,r,n,s){const a=t.zoom,c=t.scale,p=t.worldSize,_=1/p,v=t.aspect,E=Math.sqrt(1+v*v)*Math.tan(.5*t.fovX),C=E*E,B=r-i,O=r+i;let G,q;C>B/O?(G=r,q=r*E):(G=.5*O*(1+C),q=.5*Math.sqrt(B*B+2*(r*r+i*i)*C+O*O*C*C));const X=t.projection.pixelsPerMeter(t.center.lat,p),$=t._camera.getCameraToWorldMercator(),re=[0,0,-G*_];me.transformMat4(re,re,$);let ne=q*_;const ie=t._edgeInsets;if(!(ie.left===0&&ie.top===0&&ie.right===0&&ie.bottom===0||ie.left===ie.right&&ie.top===ie.bottom)){const It=t._camera.getWorldToCamera(t.worldSize,t.projection.zAxisUnit==="meters"?X:1),St=t._camera.getCameraToClipPerspective(t._fov,t.width/t.height,i,r);St[8]=2*-t.centerOffset.x/t.width,St[9]=2*t.centerOffset.y/t.height;const Bt=new Float64Array(16);ce.mul(Bt,St,It);const Ft=new Float64Array(16);ce.invert(Ft,Bt);const jt=Xs.fromInvProjectionMatrix(Ft,p,a,!0);for(const Dt of jt.points){const Yt=((se=Dt)[0]/=c,se[1]/=c,se[2]=jn(se[2],t._center.lat),se);ne=Math.max(ne,me.len(me.subtract([],re,Yt)))}}var se;ne*=n/(n-1);const he=Math.acos(e[2]),ve=Math.atan2(-e[0],-e[1]),be=new Xm;be.position=re,be.setPitchBearing(he,ve);const De=be.getWorldToCamera(p,X),Ve=ne*p,je=Math.min(t._mercatorZfromZoom(17)*p*-2,-2*Ve),Je=be.getCameraToClipOrthographic(-Ve,Ve,-Ve,Ve,je,(Ve+s*X)/e[2]),Fe=new Float64Array(16);ce.multiply(Fe,Je,De);const nt=me.fromValues(Math.floor(1e6*re[0])/1e6*p,Math.floor(1e6*re[1])/1e6*p,0),At=.5*n,vt=[0,0,0];me.transformMat4(vt,nt,Fe),me.scale(vt,vt,At);const rt=[Math.floor(vt[0]),Math.floor(vt[1]),Math.floor(vt[2])],lt=[0,0,0];me.sub(lt,vt,rt),me.scale(lt,lt,-1/At);const wt=new Float64Array(16);return ce.identity(wt),ce.translate(wt,wt,lt),ce.multiply(Fe,wt,Fe),[Fe,Ve]}class y4 extends ss{constructor(e){super(),this.requestManager=e,this.models={"":{}},this.numModelsLoading={}}loadModel(e,i){return Uv(this.requestManager.transformRequest(i,we.Model).url).then(r=>{if(!r)return;const n=uy(r),s=new Rx(e,void 0,void 0,n);return s.computeBoundsAndApplyParent(),s}).catch(r=>{this.fire(new $i(new Error(`Could not load model ${e} from ${i}: ${r.message}`)))})}load(e,i){this.models[i]||(this.models[i]={});const r=Object.keys(e);this.numModelsLoading[i]=(this.numModelsLoading[i]||0)+r.length;const n=[];for(const s of r)n.push(this.loadModel(s,e[s]));Promise.allSettled(n).then(s=>{for(let a=0;a<s.length;a++){const{status:c,value:p}=s[a];c==="fulfilled"&&p&&(this.models[i][r[a]]=p)}this.numModelsLoading[i]-=r.length,this.fire(new Jt("data",{dataType:"style"}))}).catch(s=>{this.fire(new $i(new Error(`Could not load models: ${s.message}`)))})}isLoaded(){for(const e in this.numModelsLoading)if(this.numModelsLoading[e]>0)return!1;return!0}hasModel(e,i){return!!this.getModel(e,i)}getModel(e,i){return this.models[i]||(this.models[i]={}),this.models[i][e]}addModel(e,i,r){this.models[r]||(this.models[r]={}),this.hasModel(e,r)&&this.removeModel(e,r),this.load({[e]:this.requestManager.normalizeModelURL(i)},r)}addModels(e,i){const r={};for(const n in e)r[n]=this.requestManager.normalizeModelURL(e[n]);this.load(r,i)}removeModel(e,i){this.models[i]||(this.models[i]={});const r=this.models[i][e];delete this.models[i][e],r.destroy()}listModels(e){return this.models[e]||(this.models[e]={}),Object.keys(this.models[e])}upload(e,i){this.models[i]||(this.models[i]={});for(const r in this.models[i])this.models[i][r].upload(e.context)}}const rp=(t,e)=>Fc(t,e&&e.filter(i=>i.identifier!=="source.canvas")),x4=nr(bn,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","setImportUrl","setImportData","setImportConfig"]),v4=nr(bn,["setCenter","setZoom","setBearing","setPitch"]),Hb={version:8,layers:[],sources:{}},Wb={duration:300,delay:0},b4=new Set(["fill","line","background","hillshade","raster"]);class su extends ss{constructor(e,i={}){super(),this.map=e,this.scope=i.scope||"",this.fragments=[],this.importDepth=i.importDepth||0,this.importsCache=i.importsCache||new Map,this.resolvedImports=i.resolvedImports||new Set,this.transition=Pt({},Wb),this._buildingIndex=new qE(this),this.crossTileSymbolIndex=new dM,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=i.styleChanges||new X_,this.dispatcher=i.dispatcher?i.dispatcher:new af(ep(),this),i.imageManager?this.imageManager=i.imageManager:(this.imageManager=new xE,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=i.glyphManager?i.glyphManager:new ad(e._requestManager,i.localFontFamily?2:i.localIdeographFontFamily?1:0,i.localFontFamily||i.localIdeographFontFamily),i.modelManager?this.modelManager=i.modelManager:(this.modelManager=new y4(e._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=new Map,this._configDependentLayers=new Set,this._config=i.config,this.dispatcher.broadcast("setReferrer",pe());const r=this;this._rtlTextPluginCallback=su.registerForPluginStateChange(n=>{r.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:n.pluginStatus,pluginURL:n.pluginURL},(s,a)=>{if(cu(s),a&&a.every(c=>c))for(const c in r._sourceCaches){const p=r._sourceCaches[c],_=p.getSource().type;_!=="vector"&&_!=="geojson"||p.reload()}})}),this.on("data",n=>{if(n.dataType!=="source"||n.sourceDataType!=="metadata")return;const s=this.getOwnSource(n.sourceId);if(s&&s.vectorLayerIds)for(const a in this._layers){const c=this._layers[a];c.source===s.id&&this._validateLayer(c)}})}loadURL(e,i={}){this.fire(new Jt("dataloading",{dataType:"style"}));const r=typeof i.validate=="boolean"?i.validate:!ut(e);e=this.map._requestManager.normalizeStyleURL(e,i.accessToken),this.resolvedImports.add(e);const n=this.importsCache.get(e);if(n)return this._load(n,r);const s=this.map._requestManager.transformRequest(e,we.Style);this._request=Le(s,(a,c)=>{if(this._request=null,a)this.fire(new $i(a));else if(c)return this.importsCache.set(e,c),this._load(c,r)})}loadJSON(e,i={}){this.fire(new Jt("dataloading",{dataType:"style"})),this._request=Wi.frame(()=>{this._request=null,this._load(e,i.validate!==!1)})}loadEmpty(){this.fire(new Jt("dataloading",{dataType:"style"})),this._load(Hb,!1)}_loadImports(e,i){if(this.importDepth>=4)return Be("Style doesn't support nesting deeper than 5"),Promise.resolve();const r=[];for(const n of e){const s=this._createFragmentStyle(n),a=new Promise(p=>{s.once("style.import.load",p),s.once("error",p)}).then(()=>this.mergeAll());if(r.push(a),this.resolvedImports.has(n.url)){s.loadEmpty();continue}const c=n.data||this.importsCache.get(n.url);c?s.loadJSON(c,{validate:i}):n.url?s.loadURL(n.url,{validate:i}):s.loadEmpty(),this.fragments.push({style:s,id:n.id,config:n.config})}return Promise.allSettled(r)}_createFragmentStyle(e){const i=this.scope?Zo(e.id,this.scope):e.id,r=new su(this.map,{scope:i,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:e.config});return r.setEventedParent(this.map,{style:r}),r}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options});const e=this.isRootStyle();this._shouldPrecompile=e,this.fire(new Jt(e?"style.load":"style.import.load"))}_load(e,i){const r=e.schema;if(this.isRootStyle()&&(e.fragment||r&&e.fragment!==!1)){const a=Pt({},Hb,{imports:[{id:"basemap",data:e,url:""}]});return void this._load(a,i)}if(this.setConfig(this._config,r),i&&rp(this,Au(e)))return;this._loaded=!0,this.stylesheet=Ue(e);for(const a in e.sources)this.addSource(a,e.sources[a],{validate:!1,isInitialLoad:!0});e.sprite?this._loadSprite(e.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(e.glyphs,this.scope);const n=qv(this.stylesheet.layers);if(this._order=n.map(a=>a.id),this.stylesheet.light&&Be("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const a=this.stylesheet.lights[0];this.light=new gv(a.properties,a.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new gv(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(const a of n){const c=r_(a,this.options);c.setScope(this.scope),c.isConfigDependent&&this._configDependentLayers.add(c.fqid),c.setEventedParent(this,{layer:{id:c.id}}),this._layers[c.id]=c,this._serializedLayers[c.id]=c.serialize();const p=this.getOwnLayerSourceCache(c),_=!!this.directionalLight&&this.directionalLight.shadowsEnabled();p&&c.canCastShadows()&&_&&(p.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const s=this.stylesheet.terrain;s&&(this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=Wi.hasCanvasFingerprintNoise()),this.disableElevatedTerrain?Be("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."):this.terrainSetForDrapingOnly()||this._createTerrain(s,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new Jt("data",{dataType:"style"})),e.imports?this._loadImports(e.imports,i).then(()=>this._reloadImports()):this._reloadImports()}isRootStyle(){return this.importDepth===0}mergeAll(){let e,i,r,n,s,a,c,p;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(_=>{if(_.stylesheet){if(_.light!=null&&(e=_.light),_.stylesheet.lights)for(const v of _.stylesheet.lights)v.type==="ambient"&&_.ambientLight!=null&&(i=_.ambientLight),v.type==="directional"&&_.directionalLight!=null&&(r=_.directionalLight);n=this._prioritizeTerrain(n,_.terrain,_.stylesheet.terrain),_.stylesheet.fog&&_.fog!=null&&(s=_.fog),_.stylesheet.camera!=null&&(p=_.stylesheet.camera),_.stylesheet.projection!=null&&(a=_.stylesheet.projection),_.stylesheet.transition!=null&&(c=_.stylesheet.transition)}}),this.light=e,this.ambientLight=i,this.directionalLight=r,this.fog=s,n===null?delete this.terrain:this.terrain=n,this.camera=p||{"camera-projection":"perspective"},this.projection=a||{name:"mercator"},this.transition=Pt({},Wb,c),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(e){const i=r=>{for(const n of r.fragments)i(n.style);e(r)};i(this)}_prioritizeTerrain(e,i,r){const n=e&&e.drapeRenderMode===0;return r===null?i&&i.drapeRenderMode===0?i:n?e:null:i!=null&&(!e||n||i&&i.drapeRenderMode===1)?i:e}mergeTerrain(){let e;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(i=>{e=this._prioritizeTerrain(e,i.terrain,i.stylesheet.terrain)}),e===null?delete this.terrain:this.terrain=e}mergeProjection(){let e;this.forEachFragmentStyle(i=>{i.stylesheet.projection!=null&&(e=i.stylesheet.projection)}),this.projection=e||{name:"mercator"}}mergeSources(){const e={},i={},r={};this.forEachFragmentStyle(n=>{for(const s in n._sourceCaches){const a=Zo(s,n.scope);e[a]=n._sourceCaches[s]}for(const s in n._otherSourceCaches){const a=Zo(s,n.scope);i[a]=n._otherSourceCaches[s]}for(const s in n._symbolSourceCaches){const a=Zo(s,n.scope);r[a]=n._symbolSourceCaches[s]}}),this._mergedSourceCaches=e,this._mergedOtherSourceCaches=i,this._mergedSymbolSourceCaches=r}mergeLayers(){const e={},i=[],r={};this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(s=>{for(const a of s._order){const c=s._layers[a];if(c.type==="slot"){const p=ih(a);if(e[p])continue;e[p]=[]}c.slot&&e[c.slot]?e[c.slot].push(c):i.push(c)}}),this._mergedOrder=[];const n=(s=[])=>{for(const a of s)if(a.type==="slot"){const c=ih(a.id);e[c]&&n(e[c])}else{const c=Zo(a.id,a.scope);this._mergedOrder.push(c),r[c]=a,a.is3D()&&(this._has3DLayers=!0),a.type==="circle"&&(this._hasCircleLayers=!0),a.type==="symbol"&&(this._hasSymbolLayers=!0)}};n(i),this._mergedLayers=r,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(e){return this.stylesheet.camera=Pt({},this.stylesheet.camera,e),this.camera=this.stylesheet.camera,this}setProjection(e){e?this.stylesheet.projection=e:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(e){this._spriteRequest=function(i,r,n){let s,a,c;const p=Wi.devicePixelRatio>1?"@2x":"";let _=Le(r.transformRequest(r.normalizeSpriteURL(i,p,".json"),we.SpriteJSON),(C,B)=>{_=null,c||(c=C,s=B,E())}),v=Et(r.transformRequest(r.normalizeSpriteURL(i,p,".png"),we.SpriteImage),(C,B)=>{v=null,c||(c=C,a=B,E())});function E(){if(c)n(c);else if(s&&a){const C=Wi.getImageData(a),B={};for(const O in s){const{width:G,height:q,x:X,y:$,sdf:re,pixelRatio:ne,stretchX:ie,stretchY:se,content:he}=s[O],ve=new Do({width:G,height:q});Do.copy(C,ve,{x:X,y:$},{x:0,y:0},{width:G,height:q}),B[O]={data:ve,pixelRatio:ne,sdf:re,stretchX:ie,stretchY:se,content:he}}n(null,B)}}return{cancel(){_&&(_.cancel(),_=null),v&&(v.cancel(),v=null)}}}(e,this.map._requestManager,(i,r)=>{if(this._spriteRequest=null,i)this.fire(new $i(i));else if(r)for(const n in r)this.imageManager.addImage(n,this.scope,r[n]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new Jt("data",{dataType:"style"}))})}_validateLayer(e){const i=this.getOwnSource(e.source);if(!i)return;const r=e.sourceLayer;r&&(i.type==="geojson"||i.vectorLayerIds&&i.vectorLayerIds.indexOf(r)===-1)&&this.fire(new $i(new Error(`Source layer "${r}" does not exist on source "${i.id}" as specified by style layer "${e.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const e in this._sourceCaches)if(!this._sourceCaches[e].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded())return!1;for(const{style:e}of this.fragments)if(!e.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((e,i)=>{const r=this.fragments[i];return r&&r.style&&(e.data=r.style.serialize()),e})}_serializeSources(){const e={};for(const i in this._sourceCaches){const r=this._sourceCaches[i].getSource();e[r.id]||(e[r.id]=r.serialize())}return e}_serializeLayers(e){const i=[];for(const r of e){const n=this._layers[r];n&&n.type!=="custom"&&i.push(n.serialize())}return i}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(const e in this._sourceCaches)if(this._sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(e){return!!this.terrain&&(typeof e.isLayerDraped=="function"?e.isLayerDraped(this.getLayerSourceCache(e)):b4.has(e.type))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(e){const i=this.getOwnLayer(e);if(i)return i;this.fire(new $i(new Error(`The layer '${e}' does not exist in the map's style.`)))}_checkSource(e){const i=this.getOwnSource(e);if(i)return i;this.fire(new $i(new Error(`The source '${e}' does not exist in the map's style.`)))}update(e){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(e),this.directionalLight&&this.directionalLight.recalculate(e);const i=this.calculateLightsBrightness();e.brightness=i||0,i!==this._brightness&&(this._brightness=i,this.dispatcher.broadcast("setBrightness",i));const r=this._changes.isDirty();if(this._changes.isDirty()){const s=this._changes.getLayerUpdatesByScope();for(const a in s){const{updatedIds:c,removedIds:p}=s[a];(c||p)&&this._updateWorkerLayers(a,c,p)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(e),this.light&&this.light.updateTransitions(e),this.ambientLight&&this.ambientLight.updateTransitions(e),this.directionalLight&&this.directionalLight.updateTransitions(e),this.fog&&this.fog.updateTransitions(e),this._changes.reset()}const n={};for(const s in this._mergedSourceCaches){const a=this._mergedSourceCaches[s];n[s]=a.used,a.used=!1}for(const s of this._mergedOrder){const a=this._mergedLayers[s];if(a.recalculate(e,this._availableImages),!a.isHidden(e.zoom)){const c=this.getLayerSourceCache(a);c&&(c.used=!0)}if(!this._precompileDone&&this._shouldPrecompile)for(let c=a.minzoom||0;c<(a.maxzoom||25.5);c++){const p=this.map.painter;if(p){const _=a.getProgramIds();if(!_)continue;for(const v of _){const E=a.getDefaultProgramParams(v,e.zoom);E&&(p.style=this,this.fog&&(p._fogVisible=!0,E.overrideFog=!0,p.getOrCreateProgram(v,E)),p._fogVisible=!1,E.overrideFog=!1,p.getOrCreateProgram(v,E),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(E.overrideRtt=!0,p.getOrCreateProgram(v,E)))}}}}this._shouldPrecompile&&(this._precompileDone=!0);for(const s in n){const a=this._mergedSourceCaches[s];n[s]!==a.used&&a.getSource().fire(new Jt("data",{sourceDataType:"visibility",dataType:"source",sourceId:a.getSource().id}))}this.light&&this.light.recalculate(e),this.terrain&&this.terrain.recalculate(e),this.fog&&this.fog.recalculate(e),this.z=e.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),r&&this.fire(new Jt("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=this._changes.getUpdatedImages();if(e.length){for(const i in this._sourceCaches)this._sourceCaches[i].reloadTilesForDependencies(["icons","patterns"],e);this._changes.resetUpdatedImages()}}_updateWorkerLayers(e,i,r){const n=this.getFragmentStyle(e);n&&this.dispatcher.broadcast("updateLayers",{layers:i?n._serializeLayers(i):[],scope:e,removedIds:r||[],options:n.options})}setState(e){if(this._checkLoaded(),rp(this,Au(e)))return!1;(e=Ue(e)).layers=qv(e.layers);const i=function(n,s){if(!n)return[{command:bn.setStyle,args:[s]}];let a=[];try{if(!Lt(n.version,s.version))return[{command:bn.setStyle,args:[s]}];Lt(n.center,s.center)||a.push({command:bn.setCenter,args:[s.center]}),Lt(n.zoom,s.zoom)||a.push({command:bn.setZoom,args:[s.zoom]}),Lt(n.bearing,s.bearing)||a.push({command:bn.setBearing,args:[s.bearing]}),Lt(n.pitch,s.pitch)||a.push({command:bn.setPitch,args:[s.pitch]}),Lt(n.sprite,s.sprite)||a.push({command:bn.setSprite,args:[s.sprite]}),Lt(n.glyphs,s.glyphs)||a.push({command:bn.setGlyphs,args:[s.glyphs]}),Lt(n.imports,s.imports)||function(E=[],C=[],B){C=C||[];const O=(E=E||[]).map(l_),G=C.map(l_),q=E.reduce(A_,{}),X=C.reduce(A_,{}),$=O.slice();let re,ne,ie,se;for(re=0,ne=0;re<O.length;re++)ie=O[re],X.hasOwnProperty(ie)?ne++:(B.push({command:bn.removeImport,args:[ie]}),$.splice($.indexOf(ie,ne),1));for(re=0,ne=0;re<G.length;re++)ie=G[G.length-1-re],$[$.length-1-re]!==ie&&(q.hasOwnProperty(ie)?(B.push({command:bn.removeImport,args:[ie]}),$.splice($.lastIndexOf(ie,$.length-ne),1)):ne++,se=$[$.length-re],B.push({command:bn.addImport,args:[X[ie],se]}),$.splice($.length-re,0,ie));for(const he of C){const ve=q[he.id];if(!ve||Lt(ve,he))continue;Lt(ve.config,he.config)||B.push({command:bn.setImportConfig,args:[he.id,he.config]}),Lt(ve.url,he.url)||B.push({command:bn.setImportUrl,args:[he.id,he.url]});const be=he.data;Lt(ve&&ve.data,be)||B.push({command:bn.setImportData,args:[he.id,be]})}}(n.imports,s.imports,a),Lt(n.transition,s.transition)||a.push({command:bn.setTransition,args:[s.transition]}),Lt(n.light,s.light)||a.push({command:bn.setLight,args:[s.light]}),Lt(n.fog,s.fog)||a.push({command:bn.setFog,args:[s.fog]}),Lt(n.projection,s.projection)||a.push({command:bn.setProjection,args:[s.projection]}),Lt(n.lights,s.lights)||a.push({command:bn.setLights,args:[s.lights]}),Lt(n.camera,s.camera)||a.push({command:bn.setCamera,args:[s.camera]});const c={},p=[];(function(E,C,B,O){let G;for(G in C=C||{},E=E||{})E.hasOwnProperty(G)&&(C.hasOwnProperty(G)||Hv(G,B,O));for(G in C){if(!C.hasOwnProperty(G))continue;const q=C[G];E.hasOwnProperty(G)?Lt(E[G],q)||(E[G].type==="geojson"&&q.type==="geojson"&&WE(E,C,G)?B.push({command:bn.setGeoJSONSourceData,args:[G,q.data]}):HE(G,C,B,O)):Qv(G,C,B)}})(n.sources,s.sources,p,c);const _=[];n.layers&&n.layers.forEach(E=>{E.source&&c[E.source]?a.push({command:bn.removeLayer,args:[E.id]}):_.push(E)});let v=n.terrain;v&&c[v.source]&&(a.push({command:bn.setTerrain,args:[void 0]}),v=void 0),a=a.concat(p),Lt(v,s.terrain)||a.push({command:bn.setTerrain,args:[s.terrain]}),function(E,C,B){C=C||[];const O=(E=E||[]).map(l_),G=C.map(l_),q=E.reduce(A_,{}),X=C.reduce(A_,{}),$=O.slice(),re=Object.create(null);let ne,ie,se,he,ve,be,De;for(ne=0,ie=0;ne<O.length;ne++)se=O[ne],X.hasOwnProperty(se)?ie++:(B.push({command:bn.removeLayer,args:[se]}),$.splice($.indexOf(se,ie),1));for(ne=0,ie=0;ne<G.length;ne++)se=G[G.length-1-ne],$[$.length-1-ne]!==se&&(q.hasOwnProperty(se)?(B.push({command:bn.removeLayer,args:[se]}),$.splice($.lastIndexOf(se,$.length-ie),1)):ie++,be=$[$.length-ne],B.push({command:bn.addLayer,args:[X[se],be]}),$.splice($.length-ne,0,se),re[se]=!0);for(ne=0;ne<G.length;ne++)if(se=G[ne],he=q[se],ve=X[se],!re[se]&&!Lt(he,ve))if(Lt(he.source,ve.source)&&Lt(he["source-layer"],ve["source-layer"])&&Lt(he.type,ve.type)){for(De in a_(he.layout,ve.layout,B,se,null,bn.setLayoutProperty),a_(he.paint,ve.paint,B,se,null,bn.setPaintProperty),Lt(he.slot,ve.slot)||B.push({command:bn.setSlot,args:[se,ve.slot]}),Lt(he.filter,ve.filter)||B.push({command:bn.setFilter,args:[se,ve.filter]}),Lt(he.minzoom,ve.minzoom)&&Lt(he.maxzoom,ve.maxzoom)||B.push({command:bn.setLayerZoomRange,args:[se,ve.minzoom,ve.maxzoom]}),he)he.hasOwnProperty(De)&&De!=="layout"&&De!=="paint"&&De!=="filter"&&De!=="metadata"&&De!=="minzoom"&&De!=="maxzoom"&&De!=="slot"&&(De.indexOf("paint.")===0?a_(he[De],ve[De],B,se,De.slice(6),bn.setPaintProperty):Lt(he[De],ve[De])||B.push({command:bn.setLayerProperty,args:[se,De,ve[De]]}));for(De in ve)ve.hasOwnProperty(De)&&!he.hasOwnProperty(De)&&De!=="layout"&&De!=="paint"&&De!=="filter"&&De!=="metadata"&&De!=="minzoom"&&De!=="maxzoom"&&De!=="slot"&&(De.indexOf("paint.")===0?a_(he[De],ve[De],B,se,De.slice(6),bn.setPaintProperty):Lt(he[De],ve[De])||B.push({command:bn.setLayerProperty,args:[se,De,ve[De]]}))}else B.push({command:bn.removeLayer,args:[se]}),be=$[$.lastIndexOf(se)+1],B.push({command:bn.addLayer,args:[ve,be]})}(_,s.layers,a)}catch(c){console.warn("Unable to compute style diff:",c),a=[{command:bn.setStyle,args:[s]}]}return a}(this.serialize(),e).filter(n=>!(n.command in v4));if(i.length===0)return!1;const r=i.filter(n=>!(n.command in x4));if(r.length>0)throw new Error(`Unimplemented: ${r.map(n=>n.command).join(", ")}.`);return i.forEach(n=>{this[n.command].apply(this,n.args)}),this.stylesheet=e,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(e,i){return this.getImage(e)?this.fire(new $i(new Error("An image with this name already exists."))):(this.imageManager.addImage(e,this.scope,i),this._afterImageUpdated(e),this)}updateImage(e,i){this.imageManager.updateImage(e,this.scope,i)}getImage(e){return this.imageManager.getImage(e,this.scope)}removeImage(e){return this.getImage(e)?(this.imageManager.removeImage(e,this.scope),this._afterImageUpdated(e),this):this.fire(new $i(new Error("No image with this name exists.")))}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(e),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new Jt("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(e,i,r={}){return this._checkLoaded(),this._validate(Q_,`models.${e}`,i,null,r)||(this.modelManager.addModel(e,i,this.scope),this._changes.setDirty()),this}hasModel(e){return this.modelManager.hasModel(e,this.scope)}removeModel(e){return this.hasModel(e)?(this.modelManager.removeModel(e,this.scope),this):this.fire(new $i(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(e,i,r={}){if(this._checkLoaded(),this.getOwnSource(e)!==void 0)throw new Error(`There is already a source with ID "${e}".`);if(!i.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(i).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(i.type)>=0&&this._validate(yp,`sources.${e}`,i,null,r))return;this.map&&this.map._collectResourceTiming&&(i.collectResourceTiming=!0);const n=fy(e,i,this.dispatcher,this);n.scope=this.scope,n.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(n.id),source:n.serialize(),sourceId:n.id}));const s=a=>{const c=(a?"symbol:":"other:")+n.id,p=Zo(c,this.scope),_=this._sourceCaches[c]=new iu(p,n,a);(a?this._symbolSourceCaches:this._otherSourceCaches)[n.id]=_,_.onAdd(this.map)};s(!1),i.type!=="vector"&&i.type!=="geojson"||s(!0),n.onAdd&&n.onAdd(this.map),r.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(e){this._checkLoaded();const i=this.getOwnSource(e);if(!i)throw new Error("There is no source with this ID");for(const n in this._layers)if(this._layers[n].source===e)return this.fire(new $i(new Error(`Source "${e}" cannot be removed while layer "${n}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===e)return this.fire(new $i(new Error(`Source "${e}" cannot be removed while terrain is using it.`)));const r=this.getOwnSourceCaches(e);for(const n of r){const s=ih(n.id);delete this._sourceCaches[s],this._changes.discardSourceCacheUpdate(n.id),n.fire(new Jt("data",{sourceDataType:"metadata",dataType:"source",sourceId:n.getSource().id})),n.setEventedParent(null),n.clearTiles()}return delete this._otherSourceCaches[e],delete this._symbolSourceCaches[e],this.mergeSources(),i.setEventedParent(null),i.onRemove&&i.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(e,i){this._checkLoaded(),this.getOwnSource(e).setData(i),this._changes.setDirty()}getOwnSource(e){const i=this.getOwnSourceCache(e);return i&&i.getSource()}getOwnSources(){const e=[];for(const i in this._otherSourceCaches){const r=this.getOwnSourceCache(i);r&&e.push(r.getSource())}return e}setLights(e){if(this._checkLoaded(),!e)return delete this.ambientLight,void delete this.directionalLight;const i=this._getTransitionParameters();for(const n of e){if(this._validate(Ju,"lights",n))return;switch(n.type){case"ambient":if(this.ambientLight){const s=this.ambientLight;s.set(n),s.updateTransitions(i)}else this.ambientLight=new Ev(n,IE,this.scope,this.options);break;case"directional":if(this.directionalLight){const s=this.directionalLight;s.set(n),s.updateTransitions(i)}else this.directionalLight=new Ev(n,CE,this.scope,this.options)}}const r=new _s(this.z||0,i);this.ambientLight&&this.ambientLight.recalculate(r),this.directionalLight&&this.directionalLight.recalculate(r),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const e=this.directionalLight,i=this.ambientLight;if(!e||!i)return;const r=E=>.2126*(E[0]<=.03928?E[0]/12.92:Math.pow((E[0]+.055)/1.055,2.4))+.7152*(E[1]<=.03928?E[1]/12.92:Math.pow((E[1]+.055)/1.055,2.4))+.0722*(E[2]<=.03928?E[2]/12.92:Math.pow((E[2]+.055)/1.055,2.4)),n=e.properties.get("color").toArray01(),s=e.properties.get("intensity"),a=e.properties.get("direction"),c=1-ti(a.x,a.y,a.z)[2]/90,p=r(n)*s*c,_=i.properties.get("color").toArray01(),v=i.properties.get("intensity");return(p+r(_)*v)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const e=[];return this.directionalLight&&e.push(this.directionalLight.get()),this.ambientLight&&e.push(this.ambientLight.get()),e}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(e){if(!e)return this;if(Vd(e)){const i=function(s){const a=s.indexOf(Lh);return a>=0?s.slice(a+1):""}(e),r=this.fragments.find(({id:s})=>s===i);if(!r)throw new Error(`Style import not found: ${e}`);const n=ih(e);return r.style.getFragmentStyle(n)}{const i=this.fragments.find(({id:r})=>r===e);if(!i)throw new Error(`Style import not found: ${e}`);return i.style}}getConfigProperty(e,i){const r=this.getFragmentStyle(e);if(!r)return null;const n=r.options.get(i),s=n?n.value||n.default:null;return s?s.serialize():null}setConfigProperty(e,i,r){const n=Xi(r);if(n.result!=="success")return void rp(this,n.value);const s=n.value.expression,a=this.getFragmentStyle(e);if(!a)return;const c=a.options.get(i);c&&(a.options.set(i,{...c,value:s}),a.updateConfigDependencies())}setConfig(e,i){if(this._config=e,e||i)if(i){this.options.clear();for(const r in i){let n,s;const a=Xi(i[r].default);if(a.result==="success"&&(n=a.value.expression),e&&e[r]!==void 0){const C=Xi(e[r]);C.result==="success"&&(s=C.value.expression)}const{minValue:c,maxValue:p,stepValue:_,type:v,values:E}=i[r];n?this.options.set(r,{default:n,value:s,minValue:c,maxValue:p,stepValue:_,type:v,values:E}):this.fire(new $i(new Error(`No schema defined for config option "${r}".`)))}}else this.fire(new $i(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(){for(const e of this._configDependentLayers){const i=this.getLayer(e);i&&(i.possiblyEvaluateVisibility(),this._updateLayer(i))}this.ambientLight&&this.ambientLight.scope===this.scope&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.scope===this.scope&&this.directionalLight.updateConfig(this.options),this._changes.setDirty()}addLayer(e,i,r={}){this._checkLoaded();const n=e.id;if(this._layers[n])return void this.fire(new $i(new Error(`Layer with id "${n}" already exists on this map`)));let s;if(e.type==="custom"){if(rp(this,function(v){const E=[],C=v.id;return C===void 0&&E.push({message:`layers.${C}: missing required property "id"`}),v.render===void 0&&E.push({message:`layers.${C}: missing required method "render"`}),v.renderingMode&&v.renderingMode!=="2d"&&v.renderingMode!=="3d"&&E.push({message:`layers.${C}: property "renderingMode" must be either "2d" or "3d"`}),E}(e)))return;s=r_(e,this.options)}else{if(typeof e.source=="object"&&(this.addSource(n,e.source),e=Pt(e=Ue(e),{source:n})),this._validate(gf,`layers.${n}`,e,{arrayIndex:-1},r))return;s=r_(e,this.options),this._validateLayer(s),s.setEventedParent(this,{layer:{id:n}}),this._serializedLayers[s.id]=s.serialize()}s.isConfigDependent&&this._configDependentLayers.add(s.fqid),s.setScope(this.scope);let a=this._order.length;if(i){const v=this._order.indexOf(i);if(v===-1)return void this.fire(new $i(new Error(`Layer with id "${i}" does not exist on this map.`)));s.slot===this._layers[i].slot?a=v:Be(`Layer with id "${i}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(a,0,n),this._layerOrderChanged=!0,this._layers[n]=s;const c=this.getOwnLayerSourceCache(s),p=!!this.directionalLight&&this.directionalLight.shadowsEnabled();c&&s.canCastShadows()&&p&&(c.castsShadows=!0);const _=this._changes.getRemovedLayer(s);if(_&&s.source&&c&&s.type!=="custom"){this._changes.discardLayerRemoval(s);const v=Zo(s.source,s.scope);_.type!==s.type?this._changes.updateSourceCache(v,"clear"):(this._changes.updateSourceCache(v,"reload"),c.pause())}this._updateLayer(s),s.onAdd&&s.onAdd(this.map),s.scope=this.scope,this.mergeLayers()}moveLayer(e,i){this._checkLoaded();const r=this._checkLayer(e);if(!r||e===i)return;const n=this._order.indexOf(e);this._order.splice(n,1);let s=this._order.length;if(i){const a=this._order.indexOf(i);if(a===-1)return void this.fire(new $i(new Error(`Layer with id "${i}" does not exist on this map.`)));r.slot===this._layers[i].slot?s=a:Be(`Layer with id "${i}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(s,0,e),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(e){this._checkLoaded();const i=this._checkLayer(e);if(!i)return;i.setEventedParent(null);const r=this._order.indexOf(e);this._order.splice(r,1),delete this._layers[e],delete this._serializedLayers[e],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(i.fqid),this._changes.removeLayer(i);const n=this.getOwnLayerSourceCache(i);if(n&&n.castsShadows){let s=!1;for(const a in this._layers)if(this._layers[a].source===i.source&&this._layers[a].canCastShadows()){s=!0;break}n.castsShadows=s}i.onRemove&&i.onRemove(this.map),this.mergeLayers()}getOwnLayer(e){return this._layers[e]}hasLayer(e){return e in this._mergedLayers}hasLayerType(e){for(const i in this._layers)if(this._layers[i].type===e)return!0;return!1}setLayerZoomRange(e,i,r){this._checkLoaded();const n=this._checkLayer(e);n&&(n.minzoom===i&&n.maxzoom===r||(i!=null&&(n.minzoom=i),r!=null&&(n.maxzoom=r),this._updateLayer(n)))}setSlot(e,i){this._checkLoaded();const r=this._checkLayer(e);r&&r.slot!==i&&(r.slot=i,this._updateLayer(r))}setFilter(e,i,r={}){this._checkLoaded();const n=this._checkLayer(e);if(n&&!Lt(n.filter,i))return i==null?(n.filter=void 0,void this._updateLayer(n)):void(this._validate($u,`layers.${n.id}.filter`,i,{layerType:n.type},r)||(n.filter=Ue(i),this._updateLayer(n)))}getFilter(e){const i=this._checkLayer(e);if(i)return Ue(i.filter)}setLayoutProperty(e,i,r,n={}){this._checkLoaded();const s=this._checkLayer(e);s&&(Lt(s.getLayoutProperty(i),r)||(s.setLayoutProperty(i,r,n),s.isConfigDependent&&this._configDependentLayers.add(s.fqid),this._updateLayer(s)))}getLayoutProperty(e,i){const r=this._checkLayer(e);if(r)return r.getLayoutProperty(i)}setPaintProperty(e,i,r,n={}){this._checkLoaded();const s=this._checkLayer(e);if(!s||Lt(s.getPaintProperty(i),r))return;const a=s.setPaintProperty(i,r,n);s.isConfigDependent&&this._configDependentLayers.add(s.fqid),a&&this._updateLayer(s),this._changes.updatePaintProperties(s)}getPaintProperty(e,i){const r=this._checkLayer(e);if(r)return r.getPaintProperty(i)}setFeatureState(e,i){this._checkLoaded();const r=e.source,n=e.sourceLayer,s=this._checkSource(r);if(!s)return;const a=s.type;if(a==="geojson"&&n)return void this.fire(new $i(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(a==="vector"&&!n)return void this.fire(new $i(new Error("The sourceLayer parameter must be provided for vector source types.")));e.id===void 0&&this.fire(new $i(new Error("The feature id parameter must be provided.")));const c=this.getOwnSourceCaches(r);for(const p of c)p.setFeatureState(n,e.id,i)}removeFeatureState(e,i){this._checkLoaded();const r=e.source,n=this._checkSource(r);if(!n)return;const s=n.type,a=s==="vector"?e.sourceLayer:void 0;if(s==="vector"&&!a)return void this.fire(new $i(new Error("The sourceLayer parameter must be provided for vector source types.")));if(i&&typeof e.id!="string"&&typeof e.id!="number")return void this.fire(new $i(new Error("A feature id is required to remove its specific state property.")));const c=this.getOwnSourceCaches(r);for(const p of c)p.removeFeatureState(a,e.id,i)}getFeatureState(e){this._checkLoaded();const i=e.source,r=e.sourceLayer,n=this._checkSource(i);if(n){if(n.type!=="vector"||r)return e.id===void 0&&this.fire(new $i(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(i)[0].getFeatureState(r,e.id);this.fire(new $i(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(e){return this.stylesheet.transition=Pt({},this.stylesheet.transition,e),this.transition=this.stylesheet.transition,this}getTransition(){return Pt({},this.stylesheet.transition)}serialize(){this._checkLoaded();const e=this.getTerrain(),i=e&&this.terrain&&this.terrain.scope===this.scope?e:this.stylesheet.terrain;return Zt({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:i,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},r=>r!==void 0)}_updateLayer(e){this._changes.updateLayer(e);const i=this.getLayerSourceCache(e),r=Zo(e.source,e.scope),n=this._changes.getUpdatedSourceCaches();e.source&&!n[r]&&i&&i.getSource().type!=="raster"&&(this._changes.updateSourceCache(r,"reload"),i.pause()),e.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(e){const i=c=>this._mergedLayers[c].type==="fill-extrusion",r=this.order,n={},s=[];for(let c=r.length-1;c>=0;c--){const p=r[c];if(i(p)){n[p]=c;for(const _ of e){const v=_[p];if(v)for(const E of v)s.push(E)}}}s.sort((c,p)=>p.intersectionZ-c.intersectionZ);const a=[];for(let c=r.length-1;c>=0;c--){const p=r[c];if(i(p))for(let _=s.length-1;_>=0;_--){const v=s[_].feature;if(n[v.layer.id]<c)break;a.push(v),s.pop()}else for(const _ of e){const v=_[p];if(v)for(const E of v)a.push(E.feature)}}return a}queryRenderedFeatures(e,i,r){i&&i.filter&&this._validate($u,"queryRenderedFeatures.filter",i.filter,null,i),i.scope=this.scope,i.availableImages=this._availableImages,i.serializedLayers=this._serializedLayers;const n={};if(i&&i.layers){if(!Array.isArray(i.layers))return this.fire(new $i(new Error("parameters.layers must be an Array."))),[];for(const _ of i.layers){const v=this._mergedLayers[_];if(!v)return this.fire(new $i(new Error(`The layer '${_}' does not exist in the map's style and cannot be queried for features.`))),[];n[v.source]=!0}}const s=[],a=i.serializedLayers||{},c=i&&i.layers?i.layers.some(_=>{const v=this.getLayer(_);return v&&v.is3D()}):this.has3DLayers(),p=Jg.createFromScreenPoints(e,r);for(const _ in this._mergedSourceCaches){const v=this._mergedSourceCaches[_].getSource();if(!v||v.scope!==i.scope)continue;const E=this._mergedSourceCaches[_].getSource().id;i.layers&&!n[E]||s.push(GE(this._mergedSourceCaches[_],this._mergedLayers,a,p,i,r,c,!!this.map._showQueryGeometry))}return this.placement&&s.push(function(_,v,E,C,B,O,G){const q={},X=O.queryRenderedSymbols(C),$=[];for(const re of Object.keys(X).map(Number))$.push(G[re]);$.sort(Gv);for(const re of $){const ne=re.featureIndex.lookupSymbolFeatures(X[re.bucketInstanceId],v,re.bucketIndex,re.sourceLayerIndex,B.filter,B.layers,B.availableImages,_);for(const ie in ne){const se=q[ie]=q[ie]||[],he=ne[ie];he.sort((ve,be)=>{const De=re.featureSortOrder;if(De){const Ve=De.indexOf(ve.featureIndex);return De.indexOf(be.featureIndex)-Ve}return be.featureIndex-ve.featureIndex});for(const ve of he)se.push(ve)}}for(const re in q)q[re].forEach(ne=>{const ie=ne.feature,se=E(_[re]);if(!se)return;const he=se.getFeatureState(ie.layer["source-layer"],ie.id);ie.source=ie.layer.source,ie.layer["source-layer"]&&(ie.sourceLayer=ie.layer["source-layer"]),ie.state=he});return q}(this._mergedLayers,a,this.getLayerSourceCache.bind(this),p.screenGeometry,i,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(s)}querySourceFeatures(e,i){i&&i.filter&&this._validate($u,"querySourceFeatures.filter",i.filter,null,i);const r=this.getOwnSourceCaches(e);let n=[];for(const s of r)n=n.concat(ZE(s,i));return n}addSourceType(e,i,r){return su.getSourceType(e)?r(new Error(`A source type called "${e}" already exists.`)):(su.setSourceType(e,i),i.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:e,url:i.workerSourceURL},r):r(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(e,i,r={}){this._checkLoaded();const n=this.light.getLight();let s=!1;for(const c in e)if(!Lt(e[c],n[c])){s=!0;break}if(!s)return;const a=this._getTransitionParameters();this.light.setLight(e,i,r),this.light.updateTransitions(a)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(e,i=1){if(this._checkLoaded(),!e)return delete this.terrain,e===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let r=e;const n=e.source==null;if(i===1){if(typeof r.source=="object"){const c="terrain-dem-src";this.addSource(c,r.source),r=Ue(r),r=Pt(r,{source:c})}const s=Pt({},r),a={};if(this.terrain&&n){s.source=this.terrain.get().source;const c=this.terrain?this.getFragmentStyle(this.terrain.scope):null;c&&(a.style=c.serialize())}if(this._validate(q_,"terrain",s,a))return}if(!this.terrain||this.terrain.scope!==this.scope&&!n||this.terrain&&i!==this.terrain.drapeRenderMode){if(!r)return;this._createTerrain(r,i),this.fire(new Jt("data",{dataType:"style"}))}else{const s=this.terrain,a=s.get();for(const c of Object.keys(xt.terrain))!r.hasOwnProperty(c)&&xt.terrain[c].default&&(r[c]=xt.terrain[c].default);for(const c in e)if(!Lt(e[c],a[c])){s.set(e,this.options),this.stylesheet.terrain=e;const p=this._getTransitionParameters({duration:0});s.updateTransitions(p),this.fire(new Jt("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(e){const i=this.fog=new EE(e,this.map.transform);this.stylesheet.fog=i.get();const r=this._getTransitionParameters({duration:0});i.updateTransitions(r)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const e of this.map._markers)e._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(e){if(this._checkLoaded(),!e)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const i=this.fog;if(!Lt(i.get(),e)){i.set(e),this.stylesheet.fog=i.get();const r=this._getTransitionParameters({duration:0});i.updateTransitions(r)}}else this._createFog(e);this._markersNeedUpdate=!0}_getTransitionParameters(e){return{now:Wi.now(),transition:Pt(this.transition,e)}}updateDrapeFirstLayers(){if(!this.terrain)return;const e=[],i=[];for(const r in this._mergedLayers)this.isLayerDraped(this._mergedLayers[r])?e.push(r):i.push(r);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...e),this._drapedFirstOrder.push(...i)}_createTerrain(e,i){const r=this.terrain=new wE(e,i,this.scope,this.options);i===1&&(this.stylesheet.terrain=e),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const n=this._getTransitionParameters({duration:0});r.updateTransitions(n)}_force3DLayerUpdate(){for(const e in this._layers){const i=this._layers[e];i.type==="fill-extrusion"&&this._updateLayer(i)}}_forceSymbolLayerUpdate(){for(const e in this._layers){const i=this._layers[e];i.type==="symbol"&&this._updateLayer(i)}}_validate(e,i,r,n,s={}){if(s&&s.validate===!1)return!1;const a=Pt({},this.serialize());return rp(this,e.call(Au,Pt({key:i,style:a,value:r,styleSpec:xt},n)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),Od.off("pluginStateChange",this._rtlTextPluginCallback);for(const e in this._mergedLayers)this._mergedLayers[e].setEventedParent(null);for(const e in this._mergedSourceCaches)this._mergedSourceCaches[e].clearTiles(),this._mergedSourceCaches[e].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(e){const i=this.getSourceCaches(e);for(const r of i)r.clearTiles()}clearSources(){for(const e in this._mergedSourceCaches)this._mergedSourceCaches[e].clearTiles()}reloadSource(e){const i=this.getSourceCaches(e);for(const r of i)r.resume(),r.reload()}reloadSources(){for(const e of this.getSources())e.reload&&e.reload()}updateSources(e){let i;this.directionalLight&&(i=Qb(this.directionalLight));for(const r in this._mergedSourceCaches)this._mergedSourceCaches[r].update(e,void 0,void 0,i)}_generateCollisionBoxes(){for(const e in this._sourceCaches){const i=this._sourceCaches[e];i.resume(),i.reload()}}_updatePlacement(e,i,r,n,s=!1){let a=!1,c=!1;const p={},_={};for(const v of this._mergedOrder){const E=this._mergedLayers[v];if(E.type!=="symbol")continue;const C=Zo(E.source,E.scope);let B=p[C];if(!B){const G=this.getLayerSourceCache(E);if(!G)continue;const q=G.getRenderableIds(!0).map(X=>G.getTileByID(X));_[C]=q.slice(),B=p[C]=q.sort((X,$)=>$.tileID.overscaledZ-X.tileID.overscaledZ||(X.tileID.isLessThan($.tileID)?-1:1))}const O=this.crossTileSymbolIndex.addLayer(E,B,e.center.lng,e.projection);a=a||O}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),s=s||this._layerOrderChanged||r===0,this._layerOrderChanged&&this.fire(new Jt("neworder")),(s||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(Wi.now(),e.zoom))&&(this.pauseablePlacement=new cM(e,this._mergedOrder,s,i,r,n,this.placement,this.fog&&e.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,p,_),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(Wi.now()),c=!0),a&&this.pauseablePlacement.placement.setStale()),c||a)for(const v of this._mergedOrder){const E=this._mergedLayers[v];E.type==="symbol"&&this.placement.updateLayerOpacities(E,p[Zo(E.source,E.scope)])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(Wi.now())}_releaseSymbolFadeTiles(){for(const e in this._sourceCaches)this._sourceCaches[e].releaseSymbolFadeTiles()}addImport(e){this._checkLoaded();const i=this.stylesheet.imports=this.stylesheet.imports||[];return i.findIndex(({id:n})=>n===e.id)!==-1?this.fire(new $i(new Error(`Import with id '${e.id}' already exists in the map's style.`))):(i.push(e),this._loadImports([e],!0),this)}setImportUrl(e,i){this._checkLoaded();const r=this.stylesheet.imports||[],n=this.getImportIndex(e);if(n===-1)return this;r[n].url=i;const s=this.fragments[n];return s.style=this._createFragmentStyle(r[n]),s.style.on("style.import.load",()=>this.mergeAll()),s.style.loadURL(i),this}setImportData(e,i){this._checkLoaded();const r=this.getImportIndex(e),n=this.stylesheet.imports||[];return r===-1?this:i?(this.fragments[r].style.setState(i),this._reloadImports(),this):(delete n[r].data,this.setImportUrl(e,n[r].url))}setImportConfig(e,i){this._checkLoaded();const r=this.getImportIndex(e),n=this.stylesheet.imports||[];if(r===-1)return this;i?n[r].config=i:delete n[r].config;const s=this.fragments[r],a=s.style.stylesheet&&s.style.stylesheet.schema;return s.config=i,s.style.setConfig(i,a),s.style.updateConfigDependencies(),this}removeImport(e){this._checkLoaded();const i=this.stylesheet.imports||[],r=this.getImportIndex(e);return r===-1||(i.splice(r,1),this.fragments[r].style._remove(),this.fragments.splice(r,1),this._reloadImports()),this}getImportIndex(e){const i=(this.stylesheet.imports||[]).findIndex(r=>r.id===e);return i===-1&&this.fire(new $i(new Error(`Import '${e}' does not exist in the map's style and cannot be updated.`))),i}getLayer(e){return this._mergedLayers[e]}getSources(){const e=[];for(const i in this._mergedOtherSourceCaches){const r=this._mergedOtherSourceCaches[i];r&&e.push(r.getSource())}return e}getSource(e,i){const r=this.getSourceCache(e,i);return r&&r.getSource()}getLayerSource(e){const i=this.getLayerSourceCache(e);return i&&i.getSource()}getSourceCache(e,i){const r=Zo(e,i);return this._mergedOtherSourceCaches[r]}getLayerSourceCache(e){const i=Zo(e.source,e.scope);return e.type==="symbol"?this._mergedSymbolSourceCaches[i]:this._mergedOtherSourceCaches[i]}getSourceCaches(e){const i=[];return this._mergedOtherSourceCaches[e]&&i.push(this._mergedOtherSourceCaches[e]),this._mergedSymbolSourceCaches[e]&&i.push(this._mergedSymbolSourceCaches[e]),i}updateSourceCaches(){const e=this._changes.getUpdatedSourceCaches();for(const i in e){const r=e[i];r==="reload"?this.reloadSource(i):r==="clear"&&this.clearSource(i)}}updateLayers(e){const i=this._changes.getUpdatedPaintProperties();for(const r of i){const n=this.getLayer(r);n&&n.updateTransitions(e)}}getImages(e,i,r){this.imageManager.getImages(i.icons,i.scope,r),this._updateTilesForChangedImages();const n=s=>{s&&s.setDependencies(i.tileID.key,i.type,i.icons)};n(this._otherSourceCaches[i.source]),n(this._symbolSourceCaches[i.source])}getGlyphs(e,i,r){this.glyphManager.getGlyphs(i.stacks,i.scope,r)}getResource(e,i,r){return Me(i,r)}getOwnSourceCache(e){return this._otherSourceCaches[e]}getOwnLayerSourceCache(e){return e.type==="symbol"?this._symbolSourceCaches[e.source]:this._otherSourceCaches[e.source]}getOwnSourceCaches(e){const i=[];return this._otherSourceCaches[e]&&i.push(this._otherSourceCaches[e]),this._symbolSourceCaches[e]&&i.push(this._symbolSourceCaches[e]),i}_isSourceCacheLoaded(e){const i=this.getOwnSourceCaches(e);return i.length===0?(this.fire(new $i(new Error(`There is no source with ID '${e}'`))),!1):i.every(r=>r.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}function Xb(t,e){let i=!1,r=null;const n=()=>{r=null,i&&(t(),r=setTimeout(n,e),i=!1)};return()=>(i=!0,r||n(),r)}su.getSourceType=function(t){return hy[t]},su.setSourceType=function(t,e){hy[t]=e},su.registerForPluginStateChange=function(t){return t({pluginStatus:Ya,pluginURL:Nc}),Od.on("pluginStateChange",t),t};class w4{constructor(e){this._hashName=e&&encodeURIComponent(e),Ir(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Xb(this._updateHashUnthrottled.bind(this),300)}addTo(e){return this._map=e,Ee.addEventListener("hashchange",this._onHashChange,!1),e.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),Ee.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const e=this._map;if(!e)return"";const i=Yb(e);if(this._hashName){const r=this._hashName;let n=!1;const s=Ee.location.hash.slice(1).split("&").map(a=>{const c=a.split("=")[0];return c===r?(n=!0,`${c}=${i}`):a}).filter(a=>a);return n||s.push(`${r}=${i}`),`#${s.join("&")}`}return`#${i}`}_getCurrentHash(){const e=Ee.location.hash.replace("#","");if(this._hashName){let i;return e.split("&").map(r=>r.split("=")).forEach(r=>{r[0]===this._hashName&&(i=r)}),(i&&i[1]||"").split("/")}return e.split("/")}_onHashChange(){const e=this._map;if(!e)return!1;const i=this._getCurrentHash();if(i.length>=3&&!i.some(r=>isNaN(r))){const r=e.dragRotate.isEnabled()&&e.touchZoomRotate.isEnabled()?+(i[3]||0):e.getBearing();return e.jumpTo({center:[+i[2],+i[1]],zoom:+i[0],bearing:r,pitch:+(i[4]||0)}),!0}return!1}_updateHashUnthrottled(){const e=Ee.location.href.replace(/(#.+)?$/,this.getHashString());Ee.history.replaceState(Ee.history.state,null,e)}}function Yb(t,e){const i=t.getCenter(),r=Math.round(100*t.getZoom())/100,n=Math.ceil((r*Math.LN2+Math.log(512/360/.5))/Math.LN10),s=Math.pow(10,n),a=Math.round(i.lng*s)/s,c=Math.round(i.lat*s)/s,p=t.getBearing(),_=t.getPitch();let v=e?`/${a}/${c}/${r}`:`${r}/${c}/${a}`;return(p||_)&&(v+="/"+Math.round(10*p)/10),_&&(v+=`/${Math.round(_)}`),v}const v_={linearity:.3,easing:yo(0,0,.3,1)},T4=Pt({deceleration:2500,maxSpeed:1400},v_),E4=Pt({deceleration:20,maxSpeed:1400},v_),M4=Pt({deceleration:1e3,maxSpeed:360},v_),S4=Pt({deceleration:1e3,maxSpeed:90},v_);class I4{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:Wi.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,i=Wi.now();for(;e.length>0&&i-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const i={zoom:0,bearing:0,pitch:0,pan:new ct(0,0),pinchAround:void 0,around:void 0};for(const{settings:s}of this._inertiaBuffer)i.zoom+=s.zoomDelta||0,i.bearing+=s.bearingDelta||0,i.pitch+=s.pitchDelta||0,s.panDelta&&i.pan._add(s.panDelta),s.around&&(i.around=s.around),s.pinchAround&&(i.pinchAround=s.pinchAround);const r=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,n={};if(i.pan.mag()){const s=w_(i.pan.mag(),r,Pt({},T4,e||{}));n.offset=i.pan.mult(s.amount/i.pan.mag()),n.center=this._map.transform.center,b_(n,s)}if(i.zoom){const s=w_(i.zoom,r,E4);n.zoom=this._map.transform.zoom+s.amount,b_(n,s)}if(i.bearing){const s=w_(i.bearing,r,M4);n.bearing=this._map.transform.bearing+Ai(s.amount,-179,179),b_(n,s)}if(i.pitch){const s=w_(i.pitch,r,S4);n.pitch=this._map.transform.pitch+s.amount,b_(n,s)}if(n.zoom||n.bearing){const s=i.pinchAround===void 0?i.around:i.pinchAround;n.around=s?this._map.unproject(s):this._map.getCenter()}return this.clear(),n.noMoveStart=!0,n}}function b_(t,e){(!t.duration||t.duration<e.duration)&&(t.duration=e.duration,t.easing=e.easing)}function w_(t,e,i){const{maxSpeed:r,linearity:n,deceleration:s}=i,a=Ai(t*n/(e/1e3),-r,r),c=Math.abs(a)/(s*n);return{easing:i.easing,duration:1e3*c,amount:a*(c/2)}}class XA extends Jt{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,i,r,n={}){const s=zl(i.getCanvasContainer(),r);super(e,Pt({point:s,lngLat:i.unproject(s),originalEvent:r},n)),this._defaultPrevented=!1,this.target=i}}class T_ extends Jt{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,i,r){const n=e==="touchend"?r.changedTouches:r.touches,s=fA(i.getCanvasContainer(),n),a=s.map(p=>i.unproject(p)),c=s.reduce((p,_,v,E)=>p.add(_.div(E.length)),new ct(0,0));super(e,{points:s,point:c,lngLats:a,lngLat:i.unproject(c),originalEvent:r}),this._defaultPrevented=!1}}class C4 extends Jt{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,i,r){super(e,{originalEvent:r}),this._defaultPrevented=!1}}class k4{constructor(e,i){this._map=e,this._clickTolerance=i.clickTolerance}reset(){this._mousedownPos=void 0}wheel(e){return this._firePreventable(new C4(e.type,this._map,e))}mousedown(e,i){return this._mousedownPos=i,this._firePreventable(new XA(e.type,this._map,e))}mouseup(e){this._map.fire(new XA(e.type,this._map,e))}preclick(e){const i=Pt({},e);i.type="preclick",this._map.fire(new XA(i.type,this._map,i))}click(e,i){this._mousedownPos&&this._mousedownPos.dist(i)>=this._clickTolerance||(this.preclick(e),this._map.fire(new XA(e.type,this._map,e)))}dblclick(e){return this._firePreventable(new XA(e.type,this._map,e))}mouseover(e){this._map.fire(new XA(e.type,this._map,e))}mouseout(e){this._map.fire(new XA(e.type,this._map,e))}touchstart(e){return this._firePreventable(new T_(e.type,this._map,e))}touchmove(e){this._map.fire(new T_(e.type,this._map,e))}touchend(e){this._map.fire(new T_(e.type,this._map,e))}touchcancel(e){this._map.fire(new T_(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class D4{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(e){this._map.fire(new XA(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new XA("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._map.fire(new XA(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class P4{constructor(e,i){this._map=e,this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=i.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,i){this.isEnabled()&&e.shiftKey&&e.button===0&&(Fs(),this._startPos=this._lastPos=i,this._active=!0)}mousemoveWindow(e,i){if(!this._active)return;const r=i,n=this._startPos,s=this._lastPos;if(!n||!s||s.equals(r)||!this._box&&r.dist(n)<this._clickTolerance)return;this._lastPos=r,this._box||(this._box=dn("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",e));const a=Math.min(n.x,r.x),c=Math.max(n.x,r.x),p=Math.min(n.y,r.y),_=Math.max(n.y,r.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${a}px,${p}px)`,this._box.style.width=c-a+"px",this._box.style.height=_-p+"px")})}mouseupWindow(e,i){if(!this._active)return;const r=this._startPos,n=i;if(r&&e.button===0){if(this.reset(),ec(),r.x!==n.x||r.y!==n.y)return this._map.fire(new Jt("boxzoomend",{originalEvent:e})),{cameraAnimation:s=>s.fitScreenCoordinates(r,n,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",e)}}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Pl(),delete this._startPos,delete this._lastPos}_fireEvent(e,i){return this._map.fire(new Jt(e,{originalEvent:i}))}}function Sy(t,e){const i={};for(let r=0;r<t.length;r++)i[t[r].identifier]=e[r];return i}class z4{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(e,i,r){(this.centroid||r.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=e.timeStamp),r.length===this.numTouches&&(this.centroid=function(n){const s=new ct(0,0);for(const a of n)s._add(a);return s.div(n.length)}(i),this.touches=Sy(r,i)))}touchmove(e,i,r){if(this.aborted||!this.centroid)return;const n=Sy(r,i);for(const s in this.touches){const a=n[s];(!a||a.dist(this.touches[s])>30)&&(this.aborted=!0)}}touchend(e,i,r){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),r.length===0){const n=!this.aborted&&this.centroid;if(this.reset(),n)return n}}}class Iy{constructor(e){this.singleTap=new z4(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(e,i,r){this.singleTap.touchstart(e,i,r)}touchmove(e,i,r){this.singleTap.touchmove(e,i,r)}touchend(e,i,r){const n=this.singleTap.touchend(e,i,r);if(n){const s=e.timeStamp-this.lastTime<500,a=!this.lastTap||this.lastTap.dist(n)<30;if(s&&a||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=n,this.count===this.numTaps)return this.reset(),n}}}class B4{constructor(){this._zoomIn=new Iy({numTouches:1,numTaps:2}),this._zoomOut=new Iy({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,i,r){this._zoomIn.touchstart(e,i,r),this._zoomOut.touchstart(e,i,r)}touchmove(e,i,r){this._zoomIn.touchmove(e,i,r),this._zoomOut.touchmove(e,i,r)}touchend(e,i,r){const n=this._zoomIn.touchend(e,i,r),s=this._zoomOut.touchend(e,i,r);return n?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:a=>a.easeTo({duration:300,zoom:a.getZoom()+1,around:a.unproject(n)},{originalEvent:e})}):s?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:a=>a.easeTo({duration:300,zoom:a.getZoom()-1,around:a.unproject(s)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const L4={0:1,2:2};class Cy{constructor(e){this.reset(),this._clickTolerance=e.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(e,i){return!1}_move(e,i){return{}}mousedown(e,i){if(this._lastPoint)return;const r=ns(e);this._correctButton(e,r)&&(this._lastPoint=i,this._eventButton=r)}mousemoveWindow(e,i){const r=this._lastPoint;if(r){if(e.preventDefault(),this._eventButton!=null&&function(n,s){const a=L4[s];return n.buttons===void 0||(n.buttons&a)!==a}(e,this._eventButton))this.reset();else if(this._moved||!(i.dist(r)<this._clickTolerance))return this._moved=!0,this._lastPoint=i,this._move(r,i)}}mouseupWindow(e){this._lastPoint&&ns(e)===this._eventButton&&(this._moved&&ec(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class R4 extends Cy{mousedown(e,i){super.mousedown(e,i),this._lastPoint&&(this._active=!0)}_correctButton(e,i){return i===0&&!e.ctrlKey}_move(e,i){return{around:i,panDelta:i.sub(e)}}}class Kb extends Cy{_correctButton(e,i){return i===0&&e.ctrlKey||i===2}_move(e,i){const r=.8*(i.x-e.x);if(r)return this._active=!0,{bearingDelta:r}}contextmenu(e){e.preventDefault()}}class Jb extends Cy{_correctButton(e,i){return i===0&&e.ctrlKey||i===2}_move(e,i){const r=-.5*(i.y-e.y);if(r)return this._active=!0,{pitchDelta:r}}contextmenu(e){e.preventDefault()}}class F4{constructor(e,i){this._map=e,this._el=e.getCanvasContainer(),this._minTouches=1,this._clickTolerance=i.clickTolerance||1,this.reset(),Ir(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new ct(0,0)}touchstart(e,i,r){return this._calculateTransform(e,i,r)}touchmove(e,i,r){if(this._active&&!(r.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(r.length===1&&!Yi())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return e.cancelable&&e.preventDefault(),this._calculateTransform(e,i,r)}}touchend(e,i,r){this._calculateTransform(e,i,r),this._active&&r.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,i,r){r.length>0&&(this._active=!0);const n=Sy(r,i),s=new ct(0,0),a=new ct(0,0);let c=0;for(const _ in n){const v=n[_],E=this._touches[_];E&&(s._add(v),a._add(v.sub(E)),c++,n[_]=v)}if(this._touches=n,c<this._minTouches||!a.mag())return;const p=a.div(c);return this._sum._add(p),this._sum.mag()<this._clickTolerance?void 0:{around:s.div(c),panDelta:p}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=dn("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class ky{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(e){}_move(e,i,r){return{}}touchstart(e,i,r){this._firstTwoTouches||r.length<2||(this._firstTwoTouches=[r[0].identifier,r[1].identifier],this._start([i[0],i[1]]))}touchmove(e,i,r){const n=this._firstTwoTouches;if(!n)return;e.preventDefault();const[s,a]=n,c=E_(r,i,s),p=E_(r,i,a);if(!c||!p)return;const _=this._aroundCenter?null:c.add(p).div(2);return this._move([c,p],_,e)}touchend(e,i,r){if(!this._firstTwoTouches)return;const[n,s]=this._firstTwoTouches,a=E_(r,i,n),c=E_(r,i,s);a&&c||(this._active&&ec(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function E_(t,e,i){for(let r=0;r<t.length;r++)if(t[r].identifier===i)return e[r]}function $b(t,e){return Math.log(t/e)/Math.LN2}class O4 extends ky{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,i){const r=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs($b(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:$b(this._distance,r),pinchAround:i}}}function ew(t,e){return 180*t.angleWith(e)/Math.PI}class N4 extends ky{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,i){const r=this._vector;if(this._vector=e[0].sub(e[1]),r&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:ew(this._vector,r),pinchAround:i}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const i=25/(Math.PI*this._minDiameter)*360,r=this._startVector;if(!r)return!1;const n=ew(e,r);return Math.abs(n)<i}}function Dy(t){return Math.abs(t.y)>Math.abs(t.x)}class U4 extends ky{constructor(e){super(),this._map=e}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(e){this._lastPoints=e,Dy(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,i,r){const n=this._lastPoints;if(!n)return;const s=e[0].sub(n[0]),a=e[1].sub(n[1]);return this._map._cooperativeGestures&&!Yi()&&r.touches.length<3||(this._valid=this.gestureBeginsVertically(s,a,r.timeStamp),!this._valid)?void 0:(this._lastPoints=e,this._active=!0,{pitchDelta:(s.y+a.y)/2*-.5})}gestureBeginsVertically(e,i,r){if(this._valid!==void 0)return this._valid;const n=e.mag()>=2,s=i.mag()>=2;if(!n&&!s)return;if(!n||!s)return this._firstMove==null&&(this._firstMove=r),r-this._firstMove<100&&void 0;const a=e.y>0==i.y>0;return Dy(e)&&Dy(i)&&a}}const V4={panStep:100,bearingStep:15,pitchStep:10};class j4{constructor(){const e=V4;this._panStep=e.panStep,this._bearingStep=e.bearingStep,this._pitchStep=e.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let i=0,r=0,n=0,s=0,a=0;switch(e.keyCode){case 61:case 107:case 171:case 187:i=1;break;case 189:case 109:case 173:i=-1;break;case 37:e.shiftKey?r=-1:(e.preventDefault(),s=-1);break;case 39:e.shiftKey?r=1:(e.preventDefault(),s=1);break;case 38:e.shiftKey?n=1:(e.preventDefault(),a=-1);break;case 40:e.shiftKey?n=-1:(e.preventDefault(),a=1);break;default:return}return this._rotationDisabled&&(r=0,n=0),{cameraAnimation:c=>{const p=c.getZoom();c.easeTo({duration:300,easeId:"keyboardHandler",easing:G4,zoom:i?Math.round(p)+i*(e.shiftKey?2:1):p,bearing:c.getBearing()+r*this._bearingStep,pitch:c.getPitch()+n*this._pitchStep,offset:[-s*this._panStep,-a*this._panStep],center:c.getCenter()},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function G4(t){return t*(2-t)}const tw=4.000244140625;class Z4{constructor(e,i){this._map=e,this._el=e.getCanvasContainer(),this._handler=i,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,Ir(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(e){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(e.ctrlKey||e.metaKey||this.isZooming()||Yi()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let i=e.deltaMode===Ee.WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const r=Wi.now(),n=r-(this._lastWheelEventTime||0);this._lastWheelEventTime=r,i!==0&&i%tw==0?this._type="wheel":i!==0&&Math.abs(i)<4?this._type="trackpad":n>400?(this._type=null,this._lastValue=i,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(n*i)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,i+=this._lastValue)),e.shiftKey&&i&&(i/=4),this._type&&(this._lastWheelEvent=e,this._delta-=i,this._active||this._start(e)),e.preventDefault()}_onTimeout(e){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(e)}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const i=zl(this._el,e);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:i,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._map.transform;this._type==="wheel"&&e.projection.wrap&&(e._center.lng>=180||e._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const i=()=>e._terrainEnabled()&&this._aroundCoord?e.computeZoomRelativeTo(this._aroundCoord):e.zoom;if(this._delta!==0){const _=this._type==="wheel"&&Math.abs(this._delta)>tw?this._wheelZoomRate:this._defaultZoomRate;let v=2/(1+Math.exp(-Math.abs(this._delta*_)));this._delta<0&&v!==0&&(v=1/v);const E=i(),C=Math.pow(2,E),B=typeof this._targetZoom=="number"?e.zoomScale(this._targetZoom):C;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(B*v))),this._type==="wheel"&&(this._startZoom=E,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const r=typeof this._targetZoom=="number"?this._targetZoom:i(),n=this._startZoom,s=this._easing;let a,c=!1;if(this._type==="wheel"&&n&&s){const _=Math.min((Wi.now()-this._lastWheelEventTime)/200,1);a=Ki(n,r,s(_)),_<1?this._frameId||(this._frameId=!0):c=!0}else a=r,c=!0;this._active=!0,c&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let p=a-i();return p*this._lastDelta<0&&(p=0),{noInertia:!0,needsRenderFrame:!c,zoomDelta:p,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let i=ts;if(this._prevEase){const r=this._prevEase,n=(Wi.now()-r.start)/r.duration,s=r.easing(n+.01)-r.easing(n),a=.27/Math.sqrt(s*s+1e-4)*.01;i=yo(a,Math.sqrt(.0729-a*a),.25,1)}return this._prevEase={start:Wi.now(),duration:e,easing:i},i}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=dn("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(Ee.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class q4{constructor(e,i){this._clickZoom=e,this._tapZoom=i}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Q4{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(e,i){return e.preventDefault(),{cameraAnimation:r=>{r.easeTo({duration:300,zoom:r.getZoom()+(e.shiftKey?-1:1),around:r.unproject(i)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class H4{constructor(){this._tap=new Iy({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(e,i,r){this._swipePoint||(this._tapTime&&e.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?r.length>0&&(this._swipePoint=i[0],this._swipeTouch=r[0].identifier):this._tap.touchstart(e,i,r))}touchmove(e,i,r){if(this._tapTime){if(this._swipePoint){if(r[0].identifier!==this._swipeTouch)return;const n=i[0],s=n.y-this._swipePoint.y;return this._swipePoint=n,e.preventDefault(),this._active=!0,{zoomDelta:s/128}}}else this._tap.touchmove(e,i,r)}touchend(e,i,r){this._tapTime?this._swipePoint&&r.length===0&&this.reset():this._tap.touchend(e,i,r)&&(this._tapTime=e.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class W4{constructor(e,i,r){this._el=e,this._mousePan=i,this._touchPan=r}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class X4{constructor(e,i,r){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=i,this._mousePitch=r}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Y4{constructor(e,i,r,n){this._el=e,this._touchZoom=i,this._touchRotate=r,this._tapDragZoom=n,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const M_=t=>t.zoom||t.drag||t.pitch||t.rotate;class K4 extends Jt{}class J4{constructor(){this.constants=[1,1,.01],this.radius=0}setup(e,i){const r=me.sub([],i,e);this.radius=me.length(r[2]<0?me.div([],r,this.constants):[r[0],r[1],0])}projectRay(e){me.div(e,e,this.constants),me.normalize(e,e),me.mul(e,e,this.constants);const i=me.scale([],e,this.radius);if(i[2]>0){const r=me.scale([],[0,0,1],me.dot(i,[0,0,1])),n=me.scale([],me.normalize([],[i[0],i[1],0]),this.radius),s=me.add([],i,me.scale([],me.sub([],me.add([],n,r),i),2));i[0]=s[0],i[1]=s[1]}return i}}function S_(t){return t.panDelta&&t.panDelta.mag()||t.zoomDelta||t.bearingDelta||t.pitchDelta}class $4{constructor(e,i){this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new I4(e),this._bearingSnap=i.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new J4,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(i),Ir(["handleEvent","handleWindowEvent"],this);const r=this._el;this._listeners=[[r,"touchstart",{passive:!0}],[r,"touchmove",{passive:!1}],[r,"touchend",void 0],[r,"touchcancel",void 0],[r,"mousedown",void 0],[r,"mousemove",void 0],[r,"mouseup",void 0],[Ee.document,"mousemove",{capture:!0}],[Ee.document,"mouseup",void 0],[r,"mouseover",void 0],[r,"mouseout",void 0],[r,"dblclick",void 0],[r,"click",void 0],[r,"keydown",{capture:!1}],[r,"keyup",void 0],[r,"wheel",{passive:!1}],[r,"contextmenu",void 0],[Ee,"blur",void 0]];for(const[n,s,a]of this._listeners)n.addEventListener(s,n===Ee.document?this.handleWindowEvent:this.handleEvent,a)}destroy(){for(const[e,i,r]of this._listeners)e.removeEventListener(i,e===Ee.document?this.handleWindowEvent:this.handleEvent,r)}_addDefaultHandlers(e){const i=this._map,r=i.getCanvasContainer();this._add("mapEvent",new k4(i,e));const n=i.boxZoom=new P4(i,e);this._add("boxZoom",n);const s=new B4,a=new Q4;i.doubleClickZoom=new q4(a,s),this._add("tapZoom",s),this._add("clickZoom",a);const c=new H4;this._add("tapDragZoom",c);const p=i.touchPitch=new U4(i);this._add("touchPitch",p);const _=new Kb(e),v=new Jb(e);i.dragRotate=new X4(e,_,v),this._add("mouseRotate",_,["mousePitch"]),this._add("mousePitch",v,["mouseRotate"]);const E=new R4(e),C=new F4(i,e);i.dragPan=new W4(r,E,C),this._add("mousePan",E),this._add("touchPan",C,["touchZoom","touchRotate"]);const B=new N4,O=new O4;i.touchZoomRotate=new Y4(r,O,B,c),this._add("touchRotate",B,["touchPan","touchZoom"]),this._add("touchZoom",O,["touchPan","touchRotate"]),this._add("blockableMapEvent",new D4(i));const G=i.scrollZoom=new Z4(i,this);this._add("scrollZoom",G,["mousePan"]);const q=i.keyboard=new j4;this._add("keyboard",q);for(const X of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])e.interactive&&e[X]&&i[X].enable(e[X])}_add(e,i,r){this._handlers.push({handlerName:e,handler:i,allowed:r}),this._handlersById[e]=i}stop(e){if(!this._updatingCamera){for(const{handler:i}of this._handlers)i.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!M_(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(e,i,r){for(const n in e)if(n!==r&&(!i||i.indexOf(n)<0))return!0;return!1}handleWindowEvent(e){this.handleEvent(e,`${e.type}Window`)}_getMapTouches(e){const i=[];for(const r of e)this._el.contains(r.target)&&i.push(r);return i}handleEvent(e,i){this._updatingCamera=!0;const r=e.type==="renderFrame",n=r?void 0:e,s={needsRenderFrame:!1},a={},c={},p=e.touches?this._getMapTouches(e.touches):void 0,_=p?fA(this._el,p):r?void 0:zl(this._el,e);for(const{handlerName:C,handler:B,allowed:O}of this._handlers){if(!B.isEnabled())continue;let G;this._blockedByActive(c,O,C)?B.reset():B[i||e.type]&&(G=B[i||e.type](e,_,p),this.mergeHandlerResult(s,a,G,C,n),G&&G.needsRenderFrame&&this._triggerRenderFrame()),(G||B.isActive())&&(c[C]=B)}const v={};for(const C in this._previousActiveHandlers)c[C]||(v[C]=n);this._previousActiveHandlers=c,(Object.keys(v).length||S_(s))&&(this._changes.push([s,a,v]),this._triggerRenderFrame()),(Object.keys(c).length||S_(s))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:E}=s;E&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],E(this._map))}mergeHandlerResult(e,i,r,n,s){if(!r)return;Pt(e,r);const a={handlerName:n,originalEvent:r.originalEvent||s};r.zoomDelta!==void 0&&(i.zoom=a),r.panDelta!==void 0&&(i.drag=a),r.pitchDelta!==void 0&&(i.pitch=a),r.bearingDelta!==void 0&&(i.rotate=a)}_applyChanges(){const e={},i={},r={};for(const[n,s,a]of this._changes)n.panDelta&&(e.panDelta=(e.panDelta||new ct(0,0))._add(n.panDelta)),n.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+n.zoomDelta),n.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+n.bearingDelta),n.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+n.pitchDelta),n.around!==void 0&&(e.around=n.around),n.aroundCoord!==void 0&&(e.aroundCoord=n.aroundCoord),n.pinchAround!==void 0&&(e.pinchAround=n.pinchAround),n.noInertia&&(e.noInertia=n.noInertia),Pt(i,s),Pt(r,a);this._updateMapTransform(e,i,r),this._changes=[]}_updateMapTransform(e,i,r){const n=this._map,s=n.transform,a=$=>[$.x,$.y,$.z];if(($=>{const re=this._eventsInProgress.drag;return re&&!this._handlersById[re.handlerName].isActive()})()&&!S_(e)){const $=s.zoom;s.cameraElevationReference="sea",this._originalZoom!=null&&s._orthographicProjectionAtLowPitch&&s.projection.name!=="globe"&&s.pitch===0?(s.cameraElevationReference="ground",s.zoom=this._originalZoom):(s.recenterOnTerrain(),s.cameraElevationReference="ground"),$!==s.zoom&&this._map._update(!0)}if(s._isCameraConstrained&&n._stop(!0),!S_(e))return void this._fireEvents(i,r,!0);let{panDelta:c,zoomDelta:p,bearingDelta:_,pitchDelta:v,around:E,aroundCoord:C,pinchAround:B}=e;s._isCameraConstrained&&(p>0&&(p=0),s._isCameraConstrained=!1),B!==void 0&&(E=B),(p||($=>i[$]&&!this._eventsInProgress[$])("drag"))&&E&&(this._dragOrigin=a(s.pointCoordinate3D(E)),this._originalZoom=s.zoom,this._trackingEllipsoid.setup(s._camera.position,this._dragOrigin)),s.cameraElevationReference="sea",n._stop(!0),E=E||n.transform.centerPoint,_&&(s.bearing+=_),v&&(s.pitch+=v),s._updateCameraState();const O=[0,0,0];if(c)if(s.projection.name==="mercator"){const $=this._trackingEllipsoid.projectRay(s.screenPointToMercatorRay(E).dir),re=this._trackingEllipsoid.projectRay(s.screenPointToMercatorRay(E.sub(c)).dir);O[0]=re[0]-$[0],O[1]=re[1]-$[1]}else{const $=s.pointCoordinate(E);if(s.projection.name==="globe"){c=c.rotate(-s.angle);const re=s._pixelsPerMercatorPixel/s.worldSize;O[0]=-c.x*lg(Lo($.y))*re,O[1]=-c.y*lg(s.center.lat)*re}else{const re=s.pointCoordinate(E.sub(c));$&&re&&(O[0]=re.x-$.x,O[1]=re.y-$.y)}}const G=s.zoom,q=[0,0,0];if(p){const $=a(C||s.pointCoordinate3D(E)),re={dir:me.normalize([],me.sub([],$,s._camera.position))};if(re.dir[2]<0){const ne=s.zoomDeltaToMovement($,p);me.scale(q,re.dir,ne)}}const X=me.add(O,O,q);s._translateCameraConstrained(X),p&&Math.abs(s.zoom-G)>1e-4&&s.recenterOnTerrain(),s.cameraElevationReference="ground",this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(i,r,!0)}_fireEvents(e,i,r){const n=M_(this._eventsInProgress),s=M_(e),a={};for(const v in e){const{originalEvent:E}=e[v];this._eventsInProgress[v]||(a[`${v}start`]=E),this._eventsInProgress[v]=e[v]}!n&&s&&this._fireEvent("movestart",s.originalEvent);for(const v in a)this._fireEvent(v,a[v]);s&&this._fireEvent("move",s.originalEvent);for(const v in e){const{originalEvent:E}=e[v];this._fireEvent(v,E)}const c={};let p;for(const v in this._eventsInProgress){const{handlerName:E,originalEvent:C}=this._eventsInProgress[v];this._handlersById[E].isActive()||(delete this._eventsInProgress[v],p=i[E]||C,c[`${v}end`]=p)}for(const v in c)this._fireEvent(v,c[v]);const _=M_(this._eventsInProgress);if(r&&(n||s)&&!_){this._updatingCamera=!0;const v=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),E=C=>C!==0&&-this._bearingSnap<C&&C<this._bearingSnap;v?(E(v.bearing||this._map.getBearing())&&(v.bearing=0),this._map.easeTo(v,{originalEvent:p})):(this._map.fire(new Jt("moveend",{originalEvent:p})),E(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(e,i){this._map.fire(new Jt(e,i?{originalEvent:i}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{this._frameId=void 0,this.handleEvent(new K4("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const iw="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class eS extends ss{constructor(e,i){super(),this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=i.bearingSnap,this._respectPrefersReducedMotion=i.respectPrefersReducedMotion!==!1,Ir(["_renderFrameCallback"],this)}getCenter(){return new er(this.transform.center.lng,this.transform.center.lat)}setCenter(e,i){return this.jumpTo({center:e},i)}panBy(e,i,r){return e=ct.convert(e).mult(-1),this.panTo(this.transform.center,Pt({offset:e},i),r)}panTo(e,i,r){return this.easeTo(Pt({center:e},i),r)}getZoom(){return this.transform.zoom}setZoom(e,i){return this.jumpTo({zoom:e},i),this}zoomTo(e,i,r){return this.easeTo(Pt({zoom:e},i),r)}zoomIn(e,i){return this.zoomTo(this.getZoom()+1,e,i),this}zoomOut(e,i){return this.zoomTo(this.getZoom()-1,e,i),this}getBearing(){return this.transform.bearing}setBearing(e,i){return this.jumpTo({bearing:e},i),this}getPadding(){return this.transform.padding}setPadding(e,i){return this.jumpTo({padding:e},i),this}rotateTo(e,i,r){return this.easeTo(Pt({bearing:e},i),r)}resetNorth(e,i){return this.rotateTo(0,Pt({duration:1e3},e),i),this}resetNorthPitch(e,i){return this.easeTo(Pt({bearing:0,pitch:0,duration:1e3},e),i),this}snapToNorth(e,i){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,i):this}getPitch(){return this.transform.pitch}setPitch(e,i){return this.jumpTo({pitch:e},i),this}cameraForBounds(e,i){e=kl.convert(e);const r=i&&i.bearing||0,n=i&&i.pitch||0,s=e.getNorthWest(),a=e.getSouthEast();return this._cameraForBounds(this.transform,s,a,r,n,i)}_extendCameraOptions(e){const i={top:0,bottom:0,right:0,left:0};if(typeof(e=Pt({padding:i,offset:[0,0],maxZoom:this.transform.maxZoom},e)).padding=="number"){const r=e.padding;e.padding={top:r,bottom:r,right:r,left:r}}return e.padding=Pt(i,e.padding),e}_minimumAABBFrustumDistance(e,i){const r=i.max[0]-i.min[0],n=i.max[1]-i.min[1];return r/n>e.aspect?r/(2*Math.tan(.5*e.fovX)*e.aspect):n/(2*Math.tan(.5*e.fovY)*e.aspect)}_cameraForBoundsOnGlobe(e,i,r,n,s,a){const c=e.clone(),p=this._extendCameraOptions(a);c.bearing=n,c.pitch=s;const _=er.convert(i),v=er.convert(r),E=.5*(_.lat+v.lat),C=.5*(_.lng+v.lng),B=xa(E,C),O=me.normalize([],B),G=me.normalize([],me.cross([],O,[0,1,0])),q=me.cross([],G,O),X=[G[0],G[1],G[2],0,q[0],q[1],q[2],0,O[0],O[1],O[2],0,0,0,0,1],$=[B,xa(_.lat,_.lng),xa(v.lat,_.lng),xa(v.lat,v.lng),xa(_.lat,v.lng),xa(E,_.lng),xa(E,v.lng),xa(_.lat,C),xa(v.lat,C)];let re=Hr.fromPoints($.map(lt=>[me.dot(G,lt),me.dot(q,lt),me.dot(O,lt)]));const ne=me.transformMat4([],re.center,X);me.squaredLength(ne)===0&&me.set(ne,0,0,1),me.normalize(ne,ne),me.scale(ne,ne,Vn),c.center=function([lt,wt,It]){const St=Math.hypot(lt,wt,It),Bt=Math.atan2(lt,It),Ft=.5*Math.PI-Math.acos(-wt/St);return new er(hr(Bt),hr(Ft))}(ne);const ie=c.getWorldToCameraMatrix(),se=ce.invert(new Float64Array(16),ie);re=Hr.applyTransform(re,ce.multiply([],ie,X)),me.transformMat4(ne,ne,ie);const he=.5*(re.max[2]-re.min[2]),ve=this._minimumAABBFrustumDistance(c,re),be=me.scale([],[0,0,1],he),De=me.add(be,ne,be),Ve=ve+(c.pitch===0?0:me.distance(ne,De)),je=c.globeCenterInViewSpace,Je=me.sub([],ne,[je[0],je[1],je[2]]);me.normalize(Je,Je),me.scale(Je,Je,Ve);const Fe=me.add([],ne,Je);me.transformMat4(Fe,Fe,se);const nt=Oa/Vn,At=me.length(Fe),vt=jn(Math.max(At*nt-Oa,Number.EPSILON),0),rt=Math.min(c.zoomFromMercatorZAdjusted(vt),p.maxZoom);return rt>.5*(sa+zs)?(c.setProjection({name:"mercator"}),c.zoom=rt,this._cameraForBounds(c,i,r,n,s,a)):{center:c.center,zoom:rt,bearing:n,pitch:s}}queryTerrainElevation(e,i){const r=this.transform.elevation;return r?(i=Pt({},{exaggerated:!0},i),r.getAtPoint(Wr.fromLngLat(e),null,i.exaggerated)):null}_cameraForBounds(e,i,r,n,s,a){if(e.projection.name==="globe")return this._cameraForBoundsOnGlobe(e,i,r,n,s,a);const c=e.clone(),p=this._extendCameraOptions(a),_=c.padding;c.bearing=n,c.pitch=s;const v=er.convert(i),E=er.convert(r),C=new er(v.lng,E.lat),B=new er(E.lng,v.lat),O=c.project(v),G=c.project(E),q=this.queryTerrainElevation(v),X=this.queryTerrainElevation(E),$=this.queryTerrainElevation(C),re=this.queryTerrainElevation(B),ne=[[O.x,O.y,Math.min(q||0,X||0,$||0,re||0)],[G.x,G.y,Math.max(q||0,X||0,$||0,re||0)]];let ie=Hr.fromPoints(ne);const se=c.getWorldToCameraMatrix(),he=ce.invert(new Float64Array(16),se);ie=Hr.applyTransform(ie,se);const ve=me.sub([],ie.max,ie.min),be=_.left||0,De=_.right||0,Ve=_.bottom||0,je=_.top||0,{left:Je,right:Fe,top:nt,bottom:At}=p.padding,vt=.5*(be+De),rt=.5*(je+Ve),lt=Math.min(c.scaleZoom(c.scale*Math.min((c.width-(be+De+Je+Fe))/ve[0],(c.height-(Ve+je+At+nt))/ve[1])),p.maxZoom),wt=c.scale/c.zoomScale(lt);ie=new Hr([ie.min[0]-(Je+vt)*wt,ie.min[1]-(At+rt)*wt,ie.min[2]],[ie.max[0]+(Fe+vt)*wt,ie.max[1]+(nt+rt)*wt,ie.max[2]]);const It=.5*ve[2],St=this._minimumAABBFrustumDistance(c,ie),Bt=[0,0,1,0];V.transformMat4(Bt,Bt,se),V.normalize(Bt,Bt);const Ft=me.scale([],Bt,St+It),jt=me.add([],ie.center,Ft),Dt=(typeof p.offset.x=="number"&&typeof p.offset.y=="number"?new ct(p.offset.x,p.offset.y):ct.convert(p.offset)).rotate(-wi(n));ie.center[0]-=Dt.x*wt,ie.center[1]+=Dt.y*wt,me.transformMat4(ie.center,ie.center,he),me.transformMat4(jt,jt,he);const Yt=[ie.center[0],ie.center[1],jt[2]*c.pixelsPerMeter];me.scale(Yt,Yt,1/c.worldSize);const fi=MA(Yt[0]),di=Lo(Yt[1]),vi=Math.min(c._zoomFromMercatorZ(Yt[2]),p.maxZoom),bi=new er(fi,di);return c.mercatorFromTransition&&vi<.5*(sa+zs)?(c.setProjection({name:"globe"}),c.zoom=vi,this._cameraForBounds(c,i,r,n,s,a)):{center:bi,zoom:vi,bearing:n,pitch:s}}fitBounds(e,i,r){const n=this.cameraForBounds(e,i);return this._fitInternal(n,i,r)}fitScreenCoordinates(e,i,r,n,s){const a=ct.convert(e),c=ct.convert(i),p=new ct(Math.min(a.x,c.x),Math.min(a.y,c.y)),_=new ct(Math.max(a.x,c.x),Math.max(a.y,c.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(a,c))return this;const v=this.transform.pointLocation3D(p),E=this.transform.pointLocation3D(_),C=this.transform.pointLocation3D(new ct(p.x,_.y)),B=this.transform.pointLocation3D(new ct(_.x,p.y)),O=[Math.min(v.lng,E.lng,C.lng,B.lng),Math.min(v.lat,E.lat,C.lat,B.lat)],G=[Math.max(v.lng,E.lng,C.lng,B.lng),Math.max(v.lat,E.lat,C.lat,B.lat)],q=n&&n.pitch?n.pitch:this.getPitch(),X=this._cameraForBounds(this.transform,O,G,r,q,n);return this._fitInternal(X,n,s)}_fitInternal(e,i,r){return e?(delete(i=Pt(e,i)).padding,i.linear?this.easeTo(i,r):this.flyTo(i,r)):this}jumpTo(e,i){this.stop();const r=e.preloadOnly?this.transform.clone():this.transform;let n=!1,s=!1,a=!1;return"zoom"in e&&r.zoom!==+e.zoom&&(n=!0,r.zoom=+e.zoom),e.center!==void 0&&(r.center=er.convert(e.center)),"bearing"in e&&r.bearing!==+e.bearing&&(s=!0,r.bearing=+e.bearing),"pitch"in e&&r.pitch!==+e.pitch&&(a=!0,r.pitch=+e.pitch),e.padding==null||r.isPaddingEqual(e.padding)||(r.padding=e.padding),e.preloadOnly?(this._preloadTiles(r),this):(this.fire(new Jt("movestart",i)).fire(new Jt("move",i)),n&&this.fire(new Jt("zoomstart",i)).fire(new Jt("zoom",i)).fire(new Jt("zoomend",i)),s&&this.fire(new Jt("rotatestart",i)).fire(new Jt("rotate",i)).fire(new Jt("rotateend",i)),a&&this.fire(new Jt("pitchstart",i)).fire(new Jt("pitch",i)).fire(new Jt("pitchend",i)),this.fire(new Jt("moveend",i)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||Be(iw),this.transform.getFreeCameraOptions()}setFreeCameraOptions(e,i){const r=this.transform;if(!r.projection.supportsFreeCamera)return Be(iw),this;this.stop();const n=r.zoom,s=r.pitch,a=r.bearing;r.setFreeCameraOptions(e);const c=n!==r.zoom,p=s!==r.pitch,_=a!==r.bearing;return this.fire(new Jt("movestart",i)).fire(new Jt("move",i)),c&&this.fire(new Jt("zoomstart",i)).fire(new Jt("zoom",i)).fire(new Jt("zoomend",i)),_&&this.fire(new Jt("rotatestart",i)).fire(new Jt("rotate",i)).fire(new Jt("rotateend",i)),p&&this.fire(new Jt("pitchstart",i)).fire(new Jt("pitch",i)).fire(new Jt("pitchend",i)),this.fire(new Jt("moveend",i)),this}easeTo(e,i){this._stop(!1,e.easeId),((e=Pt({offset:[0,0],duration:500,easing:ts},e)).animate===!1||this._prefersReducedMotion(e))&&(e.duration=0);const r=this.transform,n=this.getZoom(),s=this.getBearing(),a=this.getPitch(),c=this.getPadding(),p="zoom"in e?+e.zoom:n,_="bearing"in e?this._normalizeBearing(e.bearing,s):s,v="pitch"in e?+e.pitch:a,E="padding"in e?e.padding:r.padding,C=ct.convert(e.offset);let B,O,G;if(r.projection.name==="globe"){const be=Wr.fromLngLat(r.center),De=C.rotate(-r.angle);be.x+=De.x/r.worldSize,be.y+=De.y/r.worldSize;const Ve=be.toLngLat(),je=er.convert(e.center||Ve);this._normalizeCenter(je),B=r.centerPoint.add(De),O=new ct(be.x,be.y).mult(r.worldSize),G=new ct(Wo(je.lng),oa(je.lat)).mult(r.worldSize).sub(O)}else{B=r.centerPoint.add(C);const be=r.pointLocation(B),De=er.convert(e.center||be);this._normalizeCenter(De),O=r.project(be),G=r.project(De).sub(O)}const q=r.zoomScale(p-n);let X,$;e.around&&(X=er.convert(e.around),$=r.locationPoint(X));const re=this._zooming||p!==n,ne=this._rotating||s!==_,ie=this._pitching||v!==a,se=!r.isPaddingEqual(E),he=be=>De=>{if(re&&(be.zoom=Ki(n,p,De)),ne&&(be.bearing=Ki(s,_,De)),ie&&(be.pitch=Ki(a,v,De)),se&&(be.interpolatePadding(c,E,De),B=be.centerPoint.add(C)),X)be.setLocationAtPoint(X,$);else{const Ve=be.zoomScale(be.zoom-n),je=p>n?Math.min(2,q):Math.max(.5,q),Je=Math.pow(je,1-De),Fe=be.unproject(O.add(G.mult(De*Je)).mult(Ve));be.setLocationAtPoint(be.renderWorldCopies?Fe.wrap():Fe,B)}return e.preloadOnly||this._fireMoveEvents(i),be};if(e.preloadOnly){const be=this._emulate(he,e.duration,r);return this._preloadTiles(be),this}const ve={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=re,this._rotating=ne,this._pitching=ie,this._padding=se,this._easeId=e.easeId,this._prepareEase(i,e.noMoveStart,ve),this._ease(he(r),be=>{r.cameraElevationReference==="sea"&&r.recenterOnTerrain(),this._afterEase(i,be)},e),this}_prepareEase(e,i,r={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),i||r.moving||this.fire(new Jt("movestart",e)),this._zooming&&!r.zooming&&this.fire(new Jt("zoomstart",e)),this._rotating&&!r.rotating&&this.fire(new Jt("rotatestart",e)),this._pitching&&!r.pitching&&this.fire(new Jt("pitchstart",e))}_fireMoveEvents(e){this.fire(new Jt("move",e)),this._zooming&&this.fire(new Jt("zoom",e)),this._rotating&&this.fire(new Jt("rotate",e)),this._pitching&&this.fire(new Jt("pitch",e))}_afterEase(e,i){if(this._easeId&&i&&this._easeId===i)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const r=this._zooming,n=this._rotating,s=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,r&&this.fire(new Jt("zoomend",e)),n&&this.fire(new Jt("rotateend",e)),s&&this.fire(new Jt("pitchend",e)),this.fire(new Jt("moveend",e))}flyTo(e,i){if(this._prefersReducedMotion(e)){const lt=nr(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(lt,i)}this.stop(),e=Pt({offset:[0,0],speed:1.2,curve:1.42,easing:ts},e);const r=this.transform,n=this.getZoom(),s=this.getBearing(),a=this.getPitch(),c=this.getPadding(),p="zoom"in e?Ai(+e.zoom,r.minZoom,r.maxZoom):n,_="bearing"in e?this._normalizeBearing(e.bearing,s):s,v="pitch"in e?+e.pitch:a,E="padding"in e?e.padding:r.padding,C=r.zoomScale(p-n),B=ct.convert(e.offset);let O=r.centerPoint.add(B);const G=r.pointLocation(O),q=er.convert(e.center||G);this._normalizeCenter(q);const X=r.project(G),$=r.project(q).sub(X);let re=e.curve;const ne=Math.max(r.width,r.height),ie=ne/C,se=$.mag();if("minZoom"in e){const lt=Ai(Math.min(e.minZoom,n,p),r.minZoom,r.maxZoom),wt=ne/r.zoomScale(lt-n);re=Math.sqrt(wt/se*2)}const he=re*re;function ve(lt){const wt=(ie*ie-ne*ne+(lt?-1:1)*he*he*se*se)/(2*(lt?ie:ne)*he*se);return Math.log(Math.sqrt(wt*wt+1)-wt)}function be(lt){return(Math.exp(lt)-Math.exp(-lt))/2}function De(lt){return(Math.exp(lt)+Math.exp(-lt))/2}const Ve=ve(0);let je=function(lt){return De(Ve)/De(Ve+re*lt)},Je=function(lt){return ne*((De(Ve)*(be(wt=Ve+re*lt)/De(wt))-be(Ve))/he)/se;var wt},Fe=(ve(1)-Ve)/re;if(Math.abs(se)<1e-6||!isFinite(Fe)){if(Math.abs(ne-ie)<1e-6)return this.easeTo(e,i);const lt=ie<ne?-1:1;Fe=Math.abs(Math.log(ie/ne))/re,Je=function(){return 0},je=function(wt){return Math.exp(lt*re*wt)}}e.duration="duration"in e?+e.duration:1e3*Fe/("screenSpeed"in e?+e.screenSpeed/re:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0);const nt=s!==_,At=v!==a,vt=!r.isPaddingEqual(E),rt=lt=>wt=>{const It=wt*Fe,St=1/je(It);lt.zoom=wt===1?p:n+lt.scaleZoom(St),nt&&(lt.bearing=Ki(s,_,wt)),At&&(lt.pitch=Ki(a,v,wt)),vt&&(lt.interpolatePadding(c,E,wt),O=lt.centerPoint.add(B));const Bt=wt===1?q:lt.unproject(X.add($.mult(Je(It))).mult(St));return lt.setLocationAtPoint(lt.renderWorldCopies?Bt.wrap():Bt,O),lt._updateCameraOnTerrain(),e.preloadOnly||this._fireMoveEvents(i),lt};if(e.preloadOnly){const lt=this._emulate(rt,e.duration,r);return this._preloadTiles(lt),this}return this._zooming=!0,this._rotating=nt,this._pitching=At,this._padding=vt,this._prepareEase(i,!1),this._ease(rt(r),()=>this._afterEase(i),e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,i){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const r=this._onEaseEnd;this._onEaseEnd=void 0,r.call(this,i)}if(!e){const r=this.handlers;r&&r.stop(!1)}return this}_ease(e,i,r){r.animate===!1||r.duration===0?(e(1),i()):(this._easeStart=Wi.now(),this._easeOptions=r,this._onEaseFrame=e,this._onEaseEnd=i,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const e=Math.min((Wi.now()-this._easeStart)/this._easeOptions.duration,1),i=this._onEaseFrame;i&&i(this._easeOptions.easing(e)),e<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(e,i){e=Pn(e,-180,180);const r=Math.abs(e-i);return Math.abs(e-360-i)<r&&(e-=360),Math.abs(e+360-i)<r&&(e+=360),e}_normalizeCenter(e){const i=this.transform;if(i.maxBounds||i.projection.name!=="globe"&&!i.renderWorldCopies)return;const r=e.lng-i.center.lng;e.lng+=r>180?-360:r<-180?360:0}_prefersReducedMotion(e){return this._respectPrefersReducedMotion&&Wi.prefersReducedMotion&&!(e&&e.essential)}_emulate(e,i,r){const n=Math.ceil(15*i/1e3),s=[],a=e(r.clone());for(let c=0;c<=n;c++){const p=a(c/n);s.push(p.clone())}return s}}class rw{constructor(e={}){this.options=e,Ir(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(e){const i=this.options&&this.options.compact;return this._map=e,this._container=dn("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=dn("button","mapboxgl-ctrl-attrib-button",this._container),dn("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=dn("div","mapboxgl-ctrl-attrib-inner",this._container),i&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),i===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(e,i){const r=this._map._getUIString(`AttributionControl.${i}`);e.removeAttribute("title"),e.firstElementChild&&e.firstElementChild.setAttribute("title",r)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let e=this._editLink;e||(e=this._editLink=this._container.querySelector(".mapbox-improve-map"));const i=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||Gt.ACCESS_TOKEN}];if(e){const r=i.reduce((n,s,a)=>(s.value&&(n+=`${s.key}=${s.value}${a<i.length-1?"&":""}`),n),"?");e.href=`${Gt.FEEDBACK_URL}/${r}#${Yb(this._map,!0)}`,e.rel="noopener nofollow",this._setElementTitle(e,"MapFeedback")}}_updateData(e){!e||e.sourceDataType!=="metadata"&&e.sourceDataType!=="visibility"&&e.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let e=[];if(this._map.style.stylesheet){const n=this._map.style.stylesheet;this.styleOwner=n.owner,this.styleId=n.id}const i=this._map.style._mergedSourceCaches;for(const n in i){const s=i[n];if(s.used){const a=s.getSource();a.attribution&&e.indexOf(a.attribution)<0&&e.push(a.attribution)}}e.sort((n,s)=>n.length-s.length),e=e.filter((n,s)=>{for(let a=s+1;a<e.length;a++)if(e[a].indexOf(n)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=[...this.options.customAttribution,...e]:e.unshift(this.options.customAttribution));const r=e.join(" | ");r!==this._attribHTML&&(this._attribHTML=r,e.length?(this._innerContainer.innerHTML=r,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class nw{constructor(){Ir(["_updateLogo","_updateCompact"],this)}onAdd(e){this._map=e,this._container=dn("div","mapboxgl-ctrl");const i=dn("a","mapboxgl-ctrl-logo");return i.target="_blank",i.rel="noopener nofollow",i.href="https://www.mapbox.com/",i.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),i.setAttribute("rel","noopener nofollow"),this._container.appendChild(i),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(e){e&&e.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const e=this._map.style._sourceCaches;if(Object.entries(e).length===0)return!0;for(const i in e){const r=e[i].getSource();if(r.hasOwnProperty("mapbox_logo")&&!r.mapbox_logo)return!1}return!0}_updateCompact(){const e=this._container.children;if(e.length){const i=e[0];this._map.getCanvasContainer().offsetWidth<250?i.classList.add("mapboxgl-compact"):i.classList.remove("mapboxgl-compact")}}}class sw{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const i=++this._id;return this._queue.push({callback:e,id:i,cancelled:!1}),i}remove(e){const i=this._currentlyRunning,r=i?this._queue.concat(i):this._queue;for(const n of r)if(n.id===e)return void(n.cancelled=!0)}run(e=0){const i=this._currentlyRunning=this._queue;this._queue=[];for(const r of i)if(!r.cancelled&&(r.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function ow(t,e,i){if(t=new er(t.lng,t.lat),e){const r=new er(t.lng-360,t.lat),n=new er(t.lng+360,t.lat),s=360*Math.ceil(Math.abs(t.lng-i.center.lng)/360),a=i.locationPoint(t).distSqr(e),c=e.x<0||e.y<0||e.x>i.width||e.y>i.height;i.locationPoint(r).distSqr(e)<a&&(c||Math.abs(r.lng-i.center.lng)<s)?t=r:i.locationPoint(n).distSqr(e)<a&&(c||Math.abs(n.lng-i.center.lng)<s)&&(t=n)}for(;Math.abs(t.lng-i.center.lng)>180;){const r=i.locationPoint(t);if(r.x>=0&&r.y>=0&&r.x<=i.width&&r.y<=i.height)break;t.lng>i.center.lng?t.lng-=360:t.lng+=360}return t}const Py={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class zy extends ss{constructor(e,i){if(super(),(e instanceof Ee.HTMLElement||i)&&(e=Pt({element:e},i)),Ir(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=e&&e.occludedOpacity||.2,e&&e.element)this._element=e.element,this._offset=ct.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=dn("div");const s=41,a=27,c=Jo("svg",{display:"block",height:s*this._scale+"px",width:a*this._scale+"px",viewBox:`0 0 ${a} ${s}`},this._element),p=Jo("radialGradient",{id:"shadowGradient"},Jo("defs",{},c));Jo("stop",{offset:"10%","stop-opacity":.4},p),Jo("stop",{offset:"100%","stop-opacity":.05},p),Jo("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},c),Jo("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},c),Jo("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},c),Jo("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},c),this._offset=ct.convert(e&&e.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",s=>{s.preventDefault()}),this._element.addEventListener("mousedown",s=>{s.preventDefault()});const r=this._element.classList;for(const s in Py)r.remove(`mapboxgl-marker-anchor-${s}`);r.add(`mapboxgl-marker-anchor-${this._anchor}`);const n=e&&e.className?e.className.trim().split(/\s+/):[];r.add(...n),this._popup=null}addTo(e){return e===this._map||(this.remove(),this._map=e,e.getCanvasContainer().appendChild(this._element),e.on("move",this._updateMoving),e.on("moveend",this._update),e.on("remove",this._clearFadeTimer),e._addMarker(this),this.setDraggable(this._draggable),this._update(),e.on("click",this._onMapClick)),this}remove(){const e=this._map;return e&&(e.off("click",this._onMapClick),e.off("move",this._updateMoving),e.off("moveend",this._update),e.off("mousedown",this._addDragHandler),e.off("touchstart",this._addDragHandler),e.off("mouseup",this._onUp),e.off("touchend",this._onUp),e.off("mousemove",this._onMove),e.off("touchmove",this._onMove),e.off("remove",this._clearFadeTimer),e._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=er.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const n=Math.sqrt(Math.pow(13.5,2)/2);e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[n,-1*(38.1-13.5+n)],"bottom-right":[-n,-1*(38.1-13.5+n)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,e._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(e){const i=e.code,r=e.charCode||e.keyCode;i!=="Space"&&i!=="Enter"&&r!==32&&r!==13||this.togglePopup()}_onMapClick(e){const i=e.originalEvent.target,r=this._element;this._popup&&(i===r||r.contains(i))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const e=this._popup;return e?(e.isOpen()?(e.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(e.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const e=this._map,i=this._pos;if(!e||!i)return!1;const r=e.unproject(i),n=e.getFreeCameraOptions();if(!n.position)return!1;const s=n.position.toLngLat();return s.distanceTo(r)<.9*s.distanceTo(this._lngLat)}_evaluateOpacity(){const e=this._map;if(!e)return;const i=this._pos;if(!i||i.x<0||i.x>e.transform.width||i.y<0||i.y>e.transform.height)return void this._clearFadeTimer();const r=e.unproject(i);let n;e._showingGlobe()&&$h(e.transform,this._lngLat)?n=0:(n=1-e._queryFogOpacity(r),e.transform._terrainEnabled()&&e.getTerrain()&&this._behindTerrain()&&(n*=this._occludedOpacity)),this._element.style.opacity=`${n}`,this._element.style.pointerEvents=n>0?"auto":"none",this._popup&&this._popup._setOpacity(n),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const e=this._pos;if(!e||!this._map)return;const i=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${e.x}px,${e.y}px)
            ${Py[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${i.x}px,${i.y}px)
        `}_calculateXYTransform(){const e=this._pos,i=this._map,r=this.getPitchAlignment();if(!i||!e||r!=="map")return"";if(!i._showingGlobe()){const p=i.getPitch();return p?`rotateX(${p}deg)`:""}const n=hr(Jh(i.transform,this._lngLat)),s=e.sub(EA(i.transform)),a=Math.abs(s.x)+Math.abs(s.y);if(a===0)return"";const c=n/a;return`rotateX(${-s.y*c}deg) rotateY(${s.x*c}deg)`}_calculateZTransform(){const e=this._pos,i=this._map;if(!i||!e)return"";let r=0;const n=this.getRotationAlignment();if(n==="map")if(i._showingGlobe()){const s=i.project(new er(this._lngLat.lng,this._lngLat.lat+.001)),a=i.project(new er(this._lngLat.lng,this._lngLat.lat-.001)).sub(s);r=hr(Math.atan2(a.y,a.x))-90}else r=-i.getBearing();else if(n==="horizon"){const s=jr(4,6,i.getZoom()),a=EA(i.transform);a.y+=s*i.transform.height;const c=e.sub(a),p=hr(Math.atan2(c.y,c.x));r=(p>90?p-270:p+90)*(1-s)}return r+=this._rotation,r?`rotateZ(${r}deg)`:""}_update(e){Ee.cancelAnimationFrame(this._updateFrameId);const i=this._map;i&&(i.transform.renderWorldCopies&&(this._lngLat=ow(this._lngLat,this._pos,i.transform)),this._pos=i.project(this._lngLat),e===!0?this._updateFrameId=Ee.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),i._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(i._showingGlobe()||i.getTerrain()||i.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(e){return this._offset=ct.convert(e),this._update(),this}addClassName(e){return this._element.classList.add(e),this}removeClassName(e){return this._element.classList.remove(e),this}toggleClassName(e){return this._element.classList.toggle(e)}_onMove(e){const i=this._map;if(!i)return;const r=this._pointerdownPos,n=this._positionDelta;if(r&&n){if(!this._isDragging){const s=this._clickTolerance||i._clickTolerance;if(e.point.dist(r)<s)return;this._isDragging=!0}this._pos=e.point.sub(n),this._lngLat=i.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new Jt("dragstart"))),this.fire(new Jt("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const e=this._map;e&&(e.off("mousemove",this._onMove),e.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new Jt("dragend")),this._state="inactive"}_addDragHandler(e){const i=this._map,r=this._pos;i&&r&&this._element.contains(e.originalEvent.target)&&(e.preventDefault(),this._positionDelta=e.point.sub(r),this._pointerdownPos=e.point,this._state="pending",i.on("mousemove",this._onMove),i.on("touchmove",this._onMove),i.once("mouseup",this._onUp),i.once("touchend",this._onUp))}setDraggable(e){this._draggable=!!e;const i=this._map;return i&&(e?(i.on("mousedown",this._addDragHandler),i.on("touchstart",this._addDragHandler)):(i.off("mousedown",this._addDragHandler),i.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(e){return this._occludedOpacity=e||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const tS={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},iS=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function aw(t=new ct(0,0),e="bottom"){if(typeof t=="number"){const i=Math.round(Math.sqrt(.5*Math.pow(t,2)));switch(e){case"top":return new ct(0,t);case"top-left":return new ct(i,i);case"top-right":return new ct(-i,i);case"bottom":return new ct(0,-t);case"bottom-left":return new ct(i,-i);case"bottom-right":return new ct(-i,-i);case"left":return new ct(t,0);case"right":return new ct(-t,0)}return new ct(0,0)}return t instanceof ct||Array.isArray(t)?ct.convert(t):ct.convert(t[e]||[0,0])}class rS{constructor(e){this.jumpTo(e)}getValue(e){if(e<=this._startTime)return this._start;if(e>=this._endTime)return this._end;const i=Dn((e-this._startTime)/(this._endTime-this._startTime));return this._start*(1-i)+this._end*i}isEasing(e){return e>=this._startTime&&e<=this._endTime}jumpTo(e){this._startTime=-1/0,this._endTime=-1/0,this._start=e,this._end=e}easeTo(e,i,r){this._start=this.getValue(i),this._end=e,this._startTime=i,this._endTime=i+r}}const nS={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},sS={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1},oS={showCompass:!0,showZoom:!0,visualizePitch:!1};class aS{constructor(e,i,r=!1){this._clickTolerance=10,this.element=i,this.mouseRotate=new Kb({clickTolerance:e.dragRotate._mouseRotate._clickTolerance}),this.map=e,r&&(this.mousePitch=new Jb({clickTolerance:e.dragRotate._mousePitch._clickTolerance})),Ir(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),i.addEventListener("mousedown",this.mousedown),i.addEventListener("touchstart",this.touchstart,{passive:!1}),i.addEventListener("touchmove",this.touchmove),i.addEventListener("touchend",this.touchend),i.addEventListener("touchcancel",this.reset)}down(e,i){this.mouseRotate.mousedown(e,i),this.mousePitch&&this.mousePitch.mousedown(e,i),Fs()}move(e,i){const r=this.map,n=this.mouseRotate.mousemoveWindow(e,i),s=n&&n.bearingDelta;if(s&&r.setBearing(r.getBearing()+s),this.mousePitch){const a=this.mousePitch.mousemoveWindow(e,i),c=a&&a.pitchDelta;c&&r.setPitch(r.getPitch()+c)}}off(){const e=this.element;e.removeEventListener("mousedown",this.mousedown),e.removeEventListener("touchstart",this.touchstart,{passive:!1}),e.removeEventListener("touchmove",this.touchmove),e.removeEventListener("touchend",this.touchend),e.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Pl(),Ee.removeEventListener("mousemove",this.mousemove),Ee.removeEventListener("mouseup",this.mouseup)}mousedown(e){this.down(Pt({},e,{ctrlKey:!0,preventDefault:()=>e.preventDefault()}),zl(this.element,e)),Ee.addEventListener("mousemove",this.mousemove),Ee.addEventListener("mouseup",this.mouseup)}mousemove(e){this.move(e,zl(this.element,e))}mouseup(e){this.mouseRotate.mouseupWindow(e),this.mousePitch&&this.mousePitch.mouseupWindow(e),this.offTemp()}touchstart(e){e.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=fA(this.element,e.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>e.preventDefault()},this._startPos))}touchmove(e){e.targetTouches.length!==1?this.reset():(this._lastPos=fA(this.element,e.targetTouches)[0],this.move({preventDefault:()=>e.preventDefault()},this._lastPos))}touchend(e){e.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const lS={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},AS={maxWidth:100,unit:"metric"},cS={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},I_={version:li,supported:BA,setRTLTextPlugin:function(t,e,i=!1){if(Ya===Ld||Ya===Rd||Ya===Fd)throw new Error("setRTLTextPlugin cannot be called multiple times.");Nc=Wi.resolveURL(t),Ya=Ld,Bh=e,Lu(),i||Ep()},getRTLTextPluginStatus:Nd,Map:class extends eS{constructor(t){Ci.mark(gt.create);const e=t;if((t=Pt({},sS,t)).minZoom!=null&&t.maxZoom!=null&&t.minZoom>t.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(t.minPitch!=null&&t.maxPitch!=null&&t.minPitch>t.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(t.minPitch!=null&&t.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(t.maxPitch!=null&&t.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(t.antialias&&function(i){const r=i.navigator?i.navigator.userAgent:null;return!!function(n){if(Zi==null){const s=n.navigator?n.navigator.userAgent:null;Zi=!!n.safari||!(!s||!(/\b(iPad|iPhone|iPod)\b/.test(s)||s.match("Safari")&&!s.match("Chrome")))}return Zi}(i)&&r&&(r.match("Version/15.4")||r.match("Version/15.5")||r.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))}(Ee)&&(t.antialias=!1,Be("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Hg(t.minZoom,t.maxZoom,t.minPitch,t.maxPitch,t.renderWorldCopies),t),this._interactive=t.interactive,this._minTileCacheSize=t.minTileCacheSize,this._maxTileCacheSize=t.maxTileCacheSize,this._failIfMajorPerformanceCaveat=t.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=t.preserveDrawingBuffer,this._antialias=t.antialias,this._trackResize=t.trackResize,this._bearingSnap=t.bearingSnap,this._refreshExpiredTiles=t.refreshExpiredTiles,this._fadeDuration=t.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=t.crossSourceCollisions,this._collectResourceTiming=t.collectResourceTiming,this._language=this._parseLanguage(t.language),this._worldview=t.worldview,this._renderTaskQueue=new sw,this._domRenderTaskQueue=new sw,this._controls=[],this._markers=[],this._popups=[],this._mapId=cs(),this._locale=Pt({},nS,t.locale),this._clickTolerance=t.clickTolerance,this._cooperativeGestures=t.cooperativeGestures,this._performanceMetricsCollection=t.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new rS(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new Ie(t.transformRequest,t.accessToken,t.testMode),this._silenceAuthErrors=!!t.testMode,this._contextCreateOptions=t.contextCreateOptions?{...t.contextCreateOptions}:{},typeof t.container=="string"){if(this._container=Ee.document.getElementById(t.container),!this._container)throw new Error(`Container '${t.container.toString()}' not found.`)}else{if(!(t.container instanceof Ee.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=t.container}if(this._container.childNodes.length>0&&Be("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),t.maxBounds&&this.setMaxBounds(t.maxBounds),Ir(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),Ee!==void 0&&(this._fullscreenchangeEvent="onfullscreenchange"in Ee.document?"fullscreenchange":"webkitfullscreenchange",Ee.addEventListener("online",this._onWindowOnline,!1),Ee.addEventListener("resize",this._onWindowResize,!1),Ee.addEventListener("orientationchange",this._onWindowResize,!1),Ee.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),Ee.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new $4(this,t),this._localFontFamily=t.localFontFamily,this._localIdeographFontFamily=t.localIdeographFontFamily,(t.style||!t.testMode)&&this.setStyle(t.style||Gt.DEFAULT_STYLE,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),t.projection&&this.setProjection(t.projection),t.hash&&(this._hash=new w4(typeof t.hash=="string"&&t.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){e.center==null&&e.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:t.center,zoom:t.zoom,bearing:t.bearing,pitch:t.pitch});const i=t.bounds;i&&(this.resize(),this.fitBounds(i,Pt({},t.fitBoundsOptions,{duration:0})))}this.resize(),t.attributionControl&&this.addControl(new rw({customAttribution:t.customAttribution})),this._logoControl=new nw,this.addControl(this._logoControl,t.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",i=>{this._update(i.dataType==="style"),this.fire(new Jt(`${i.dataType}data`,i))}),this.on("dataloading",i=>{this.fire(new Jt(`${i.dataType}dataloading`,i))})}_getMapId(){return this._mapId}addControl(t,e){if(e===void 0&&(e=t.getDefaultPosition?t.getDefaultPosition():"top-right"),!t||!t.onAdd)return this.fire(new $i(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const i=t.onAdd(this);this._controls.push(t);const r=this._controlPositions[e];return e.indexOf("bottom")!==-1?r.insertBefore(i,r.firstChild):r.appendChild(i),this}removeControl(t){if(!t||!t.onRemove)return this.fire(new $i(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(t);return e>-1&&this._controls.splice(e,1),t.onRemove(this),this}hasControl(t){return this._controls.indexOf(t)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(t){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const e=!this._moving;return e&&this.fire(new Jt("movestart",t)).fire(new Jt("move",t)),this.fire(new Jt("resize",t)),e&&this.fire(new Jt("moveend",t)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(t){return this.transform.setMaxBounds(kl.convert(t)),this._update()}setMinZoom(t){if((t=t??-2)>=-2&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t?this.setZoom(t):this.fire(new Jt("zoomstart")).fire(new Jt("zoom")).fire(new Jt("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(t){if((t=t??22)>=this.transform.minZoom)return this.transform.maxZoom=t,this._update(),this.getZoom()>t?this.setZoom(t):this.fire(new Jt("zoomstart")).fire(new Jt("zoom")).fire(new Jt("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(t){if((t=t??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(t>=0&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this._update(),this.getPitch()<t?this.setPitch(t):this.fire(new Jt("pitchstart")).fire(new Jt("pitch")).fire(new Jt("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(t){if((t=t??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this._update(),this.getPitch()>t?this.setPitch(t):this.fire(new Jt("pitchstart")).fire(new Jt("pitch")).fire(new Jt("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(t){return this.transform.renderWorldCopies=t,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(t){return t==="auto"?Ee.navigator.language:Array.isArray(t)?t.length===0?void 0:t.map(e=>e==="auto"?Ee.navigator.language:e):t}setLanguage(t){const e=this._parseLanguage(t);if(!this.style||e===this._language)return this;this._language=e,this.style.reloadSources();for(const i of this._controls)i._setLanguage&&i._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(t){return this.style&&t!==this._worldview?(this._worldview=t,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(t){return this._lazyInitEmptyStyle(),t?typeof t=="string"&&(t={name:t}):t=null,this._useExplicitProjection=!!t,this._prioritizeAndUpdateProjection(t,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const t=this.transform,e=t.projection.name;let i;e==="globe"&&t.zoom>=zs?(t.setMercatorFromTransition(),i=!0):e==="mercator"&&t.zoom<zs&&(t.setProjection({name:"globe"}),i=!0),i&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(t,e){return this._updateProjection(t||e||{name:"mercator"})}_updateProjection(t){let e;return e=t.name==="globe"&&this.transform.zoom>=zs?this.transform.setMercatorFromTransition():this.transform.setProjection(t),this.style.applyProjectionUpdate(),e&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(t){return this.transform.locationPoint3D(er.convert(t))}unproject(t){return this.transform.pointLocation3D(ct.convert(t))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(t,e,i){if(t==="mouseenter"||t==="mouseover"){let r=!1;const n=a=>{const c=e.filter(_=>this.getLayer(_)),p=c.length?this.queryRenderedFeatures(a.point,{layers:c}):[];p.length?r||(r=!0,i.call(this,new XA(t,this,a.originalEvent,{features:p}))):r=!1},s=()=>{r=!1};return{layers:new Set(e),listener:i,delegates:{mousemove:n,mouseout:s}}}if(t==="mouseleave"||t==="mouseout"){let r=!1;const n=a=>{const c=e.filter(p=>this.getLayer(p));(c.length?this.queryRenderedFeatures(a.point,{layers:c}):[]).length?r=!0:r&&(r=!1,i.call(this,new XA(t,this,a.originalEvent)))},s=a=>{r&&(r=!1,i.call(this,new XA(t,this,a.originalEvent)))};return{layers:new Set(e),listener:i,delegates:{mousemove:n,mouseout:s}}}{const r=n=>{const s=e.filter(c=>this.getLayer(c)),a=s.length?this.queryRenderedFeatures(n.point,{layers:s}):[];a.length&&(n.features=a,i.call(this,n),delete n.features)};return{layers:new Set(e),listener:i,delegates:{[t]:r}}}}on(t,e,i){if(i===void 0)return super.on(t,e);if(Array.isArray(e)||(e=[e]),e){for(const n of e)if(!this._isValidId(n))return this}const r=this._createDelegatedListener(t,e,i);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[t]=this._delegatedListeners[t]||[],this._delegatedListeners[t].push(r);for(const n in r.delegates)this.on(n,r.delegates[n]);return this}once(t,e,i){if(i===void 0)return super.once(t,e);if(Array.isArray(e)||(e=[e]),e){for(const n of e)if(!this._isValidId(n))return this}const r=this._createDelegatedListener(t,e,i);for(const n in r.delegates)this.once(n,r.delegates[n]);return this}off(t,e,i){if(i===void 0)return super.off(t,e);e=new Set(Array.isArray(e)?e:[e]);for(const s of e)if(!this._isValidId(s))return this;const r=(s,a)=>{if(s.size!==a.size)return!1;for(const c of s)if(!a.has(c))return!1;return!0},n=this._delegatedListeners?this._delegatedListeners[t]:void 0;return n&&(s=>{for(let a=0;a<s.length;a++){const c=s[a];if(c.listener===i&&r(c.layers,e)){for(const p in c.delegates)this.off(p,c.delegates[p]);return s.splice(a,1),this}}})(n),this}queryRenderedFeatures(t,e){if(!this.style)return[];if(e!==void 0||t===void 0||t instanceof ct||Array.isArray(t)||(e=t,t=void 0),t=t||[[0,0],[this.transform.width,this.transform.height]],(e=e||{}).layers&&Array.isArray(e.layers)){for(const i of e.layers)if(!this._isValidId(i))return[]}return this.style.queryRenderedFeatures(t,e,this.transform)}querySourceFeatures(t,e){return this._isValidId(t)?this.style.querySourceFeatures(t,e):[]}isPointOnSurface(t){const{name:e}=this.transform.projection;return e!=="globe"&&e!=="mercator"&&Be(`${e} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(ct.convert(t))}setStyle(t,e){return(e=Pt({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&e.localFontFamily===this._localFontFamily&&this.style&&t?(this._diffStyle(t,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._localFontFamily=e.localFontFamily,this._updateStyle(t,e))}_getUIString(t){const e=this._locale[t];if(e==null)throw new Error(`Missing UI string '${t}'`);return e}_updateStyle(t,e){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),t&&(this.style=new su(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof t=="string"?this.style.loadURL(t):this.style.loadJSON(t)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new su(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(t,e){if(typeof t=="string"){const i=this._requestManager.normalizeStyleURL(t),r=this._requestManager.transformRequest(i,we.Style);Le(r,(n,s)=>{n?this.fire(new $i(n)):s&&this._updateDiff(s,e)})}else typeof t=="object"&&this._updateDiff(t,e)}_updateDiff(t,e){try{this.style.setState(t)&&this._update(!0)}catch(i){Be(`Unable to perform style diff: ${i.message||i.error||i}.  Rebuilding the style from scratch.`),this._updateStyle(t,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(Be("There is no style added to the map."),!1)}_isValidId(t){return t==null?(this.fire(new $i(new Error("IDs can't be empty."))),!1):!Vd(t)||(this.fire(new $i(new Error(`IDs can't contain special symbols: "${t}".`))),!1)}addSource(t,e){return this._isValidId(t)?(this._lazyInitEmptyStyle(),this.style.addSource(t,e),this._update(!0)):this}isSourceLoaded(t){return!!this._isValidId(t)&&!!this.style&&this.style._isSourceCacheLoaded(t)}areTilesLoaded(){const t=this.style&&this.style._sourceCaches;for(const e in t){const i=t[e]._tiles;for(const r in i){const n=i[r];if(n.state!=="loaded"&&n.state!=="errored")return!1}}return!0}addSourceType(t,e,i){this._lazyInitEmptyStyle(),this.style.addSourceType(t,e,i)}removeSource(t){return this._isValidId(t)?(this.style.removeSource(t),this._updateTerrain(),this._update(!0)):this}getSource(t){return this._isValidId(t)?this.style.getOwnSource(t):null}addImage(t,e,{pixelRatio:i=1,sdf:r=!1,stretchX:n,stretchY:s,content:a}={}){if(this._lazyInitEmptyStyle(),e instanceof Ee.HTMLImageElement||Ee.ImageBitmap&&e instanceof Ee.ImageBitmap){const{width:c,height:p,data:_}=Wi.getImageData(e);this.style.addImage(t,{data:new Do({width:c,height:p},_),pixelRatio:i,stretchX:n,stretchY:s,content:a,sdf:r,version:0})}else if(e.width===void 0||e.height===void 0)this.fire(new $i(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:c,height:p}=e,_=e;this.style.addImage(t,{data:new Do({width:c,height:p},new Uint8Array(_.data)),pixelRatio:i,stretchX:n,stretchY:s,content:a,sdf:r,version:0,userImage:_}),_.onAdd&&_.onAdd(this,t)}}updateImage(t,e){this._lazyInitEmptyStyle();const i=this.style.getImage(t);if(!i)return void this.fire(new $i(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const r=e instanceof Ee.HTMLImageElement||Ee.ImageBitmap&&e instanceof Ee.ImageBitmap?Wi.getImageData(e):e,{width:n,height:s}=r;n!==void 0&&s!==void 0?n===i.data.width&&s===i.data.height?(i.data.replace(r.data,!(e instanceof Ee.HTMLImageElement||Ee.ImageBitmap&&e instanceof Ee.ImageBitmap)),this.style.updateImage(t,i)):this.fire(new $i(new Error(`The width and height of the updated image (${n}, ${s})
                must be that same as the previous version of the image
                (${i.data.width}, ${i.data.height})`))):this.fire(new $i(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(t){return t?!!this.style&&!!this.style.getImage(t):(this.fire(new $i(new Error("Missing required image id"))),!1)}removeImage(t){this.style.removeImage(t)}loadImage(t,e){Et(this._requestManager.transformRequest(t,we.Image),(i,r)=>{e(i,r instanceof Ee.HTMLImageElement?Wi.getImageData(r):r)})}listImages(){return this.style.listImages()}addModel(t,e){this._lazyInitEmptyStyle(),this.style.addModel(t,e)}hasModel(t){return t?this.style.hasModel(t):(this.fire(new $i(new Error("Missing required model id"))),!1)}removeModel(t){this.style.removeModel(t)}listModels(){return this.style.listModels()}addLayer(t,e){return this._isValidId(t.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(t,e),this._update(!0)):this}moveLayer(t,e){return this._isValidId(t)?(this.style.moveLayer(t,e),this._update(!0)):this}removeLayer(t){return this._isValidId(t)?(this.style.removeLayer(t),this._update(!0)):this}getLayer(t){return this._isValidId(t)?this.style.getOwnLayer(t):null}setLayerZoomRange(t,e,i){return this._isValidId(t)?(this.style.setLayerZoomRange(t,e,i),this._update(!0)):this}setFilter(t,e,i={}){return this._isValidId(t)?(this.style.setFilter(t,e,i),this._update(!0)):this}getFilter(t){return this._isValidId(t)?this.style.getFilter(t):null}setPaintProperty(t,e,i,r={}){return this._isValidId(t)?(this.style.setPaintProperty(t,e,i,r),this._update(!0)):this}getPaintProperty(t,e){return this._isValidId(t)?this.style.getPaintProperty(t,e):null}setLayoutProperty(t,e,i,r={}){return this._isValidId(t)?(this.style.setLayoutProperty(t,e,i,r),this._update(!0)):this}getLayoutProperty(t,e){return this._isValidId(t)?this.style.getLayoutProperty(t,e):null}getConfigProperty(t,e){return this.style.getConfigProperty(t,e)}setConfigProperty(t,e,i){return this.style.setConfigProperty(t,e,i),this._update(!0)}setLights(t){if(this._lazyInitEmptyStyle(),t&&t.length===1&&t[0].type==="flat"){const e=t[0];e.properties?this.style.setFlatLight(e.properties,e.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(t),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const t=this.style.getLights()||[];return t.length===0&&t.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),t}setLight(t,e={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:t}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(t){return this._lazyInitEmptyStyle(),!t&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(t),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(t){return this._lazyInitEmptyStyle(),this.style.setFog(t),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setCamera(t){return this.style.setCamera(t),this._triggerCameraUpdate(t)}_triggerCameraUpdate(t){return this._update(this.transform.setOrthographicProjectionAtLowPitch(t["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(t){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(er.convert(t),this.transform):0}setFeatureState(t,e){return this._isValidId(t.source)?(this.style.setFeatureState(t,e),this._update()):this}removeFeatureState(t,e){return this._isValidId(t.source)?(this.style.removeFeatureState(t,e),this._update()):this}getFeatureState(t){return this._isValidId(t.source)?this.style.getFeatureState(t):null}_updateContainerDimensions(){if(!this._container)return;const t=this._container.getBoundingClientRect().width||400,e=this._container.getBoundingClientRect().height||300;let i,r,n,s=this._container;for(;s&&(!r||!n);){const a=Ee.getComputedStyle(s).transform;a&&a!=="none"&&(i=a.match(/matrix.*\((.+)\)/)[1].split(", "),i[0]&&i[0]!=="0"&&i[0]!=="1"&&(r=i[0]),i[3]&&i[3]!=="0"&&i[3]!=="1"&&(n=i[3])),s=s.parentElement}this._containerWidth=r?Math.abs(t/r):t,this._containerHeight=n?Math.abs(e/n):e}_detectMissingCSS(){Ee.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&Be("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const t=this._container;t.classList.add("mapboxgl-map"),(this._missingCSSCanary=dn("div","mapboxgl-canary",t)).style.visibility="hidden",this._detectMissingCSS();const e=this._canvasContainer=dn("div","mapboxgl-canvas-container",t);this._canvas=dn("canvas","mapboxgl-canvas",e),this._interactive&&(e.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const i=this._controlContainer=dn("div","mapboxgl-control-container",t),r=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(n=>{r[n]=dn("div",`mapboxgl-ctrl-${n}`,i)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(t,e){const i=Wi.devicePixelRatio||1;this._canvas.width=i*Math.ceil(t),this._canvas.height=i*Math.ceil(e),this._canvas.style.width=`${t}px`,this._canvas.style.height=`${e}px`}_addMarker(t){this._markers.push(t)}_removeMarker(t){const e=this._markers.indexOf(t);e!==-1&&this._markers.splice(e,1)}_addPopup(t){this._popups.push(t)}_removePopup(t){const e=this._popups.indexOf(t);e!==-1&&this._popups.splice(e,1)}_setupPainter(){const t=Pt({},BA.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),e=this._canvas.getContext("webgl2",t);e?(kr(e,!0),this.painter=new d4(e,this._contextCreateOptions,this.transform),this.on("data",i=>{i.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),Xr.testSupport(e)):this.fire(new $i(new Error("Failed to initialize WebGL")))}_contextLost(t){t.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new Jt("webglcontextlost",{originalEvent:t}))}_contextRestored(t){this._setupPainter(),this.resize(),this._update(),this.fire(new Jt("webglcontextrestored",{originalEvent:t}))}_onMapScroll(t){if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(t){return this.style?(this._styleDirty=this._styleDirty||t,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(t){return this._update(),this._renderTaskQueue.add(t)}_cancelRenderFrame(t){this._renderTaskQueue.remove(t)}_requestDomTask(t){!this.loaded()||this.loaded()&&!this.isMoving()?t():this._domRenderTaskQueue.add(t)}_render(t){let e;this.fire(new Jt("renderstart"));const i=this.painter.context.extTimerQuery,r=Wi.now(),n=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(e=n.createQuery(),n.beginQuery(i.TIME_ELAPSED_EXT,e)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],Ee.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],Ee.performance.now())),this._renderTaskQueue.run(t),this._domRenderTaskQueue.run(t),this._removed)return;this._updateProjectionTransition();const s=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const p=this.transform.zoom,_=this.transform.pitch,v=Wi.now(),E=new _s(p,{now:v,fadeDuration:s,pitch:_,transition:this.style.transition});this.style.update(E)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let a=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),a=this._updateAverageElevation(r),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):a=this._updateAverageElevation(r),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,s,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:s,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new Jt("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new Jt("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),e){const p=Wi.now()-r;n.endQuery(i.TIME_ELAPSED_EXT),setTimeout(()=>{const _=n.getQueryParameter(e,n.QUERY_RESULT)/1e6;n.deleteQuery(e),this.fire(new Jt("gpu-timing-frame",{cpuTime:p,gpuTime:_})),Ee.performance.mark("frame-gpu",{startTime:r,detail:{gpuTime:_}})},50)}if(this.listens("gpu-timing-layer")){const p=this.painter.collectGpuTimers();setTimeout(()=>{const _=this.painter.queryGpuTimers(p);this.fire(new Jt("gpu-timing-layer",{layerTimes:_}))},50)}if(this.listens("gpu-timing-deferred-render")){const p=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const _=this.painter.queryGpuTimeDeferredRender(p);this.fire(new Jt("gpu-timing-deferred-render",{gpuTime:_}))},50)}const c=this._sourcesDirty||this._styleDirty||this._placementDirty||a;if(c||this._repaint)this.triggerRepaint();else{const p=!this.isMoving()&&this.loaded();if(p&&(a=this._updateAverageElevation(r,!0)),a)this.triggerRepaint();else if(this._triggerFrame(!1),p&&(this.fire(new Jt("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const _=this._calculateSpeedIndex();this.fire(new Jt("speedindexcompleted",{speedIndex:_})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||c||(this._fullyLoaded=!0,Ci.mark(gt.fullLoad),this._performanceMetricsCollection&&js(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(t){for(const e of this._markers)t&&!this.getRenderWorldCopies()&&(e._lngLat=e._lngLat.wrap()),e._update();for(const e of this._popups)!t||this.getRenderWorldCopies()||e._trackPointer||(e._lngLat=e._lngLat.wrap()),e._update()}_updateAverageElevation(t,e=!1){const i=n=>(this.transform.averageElevation=n,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&i(0);const r=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(r||(e||t-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(t)){const n=this.transform.averageElevation;let s=this.transform.sampleAverageElevation();this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(s)?s=0:this._averageElevationLastSampledAt=t;const a=Math.abs(n-s);if(a>1){if(this._isInitialLoad||r)return this._averageElevation.jumpTo(s),i(s);this._averageElevation.easeTo(s,t,300)}else if(a>1e-4)return this._averageElevation.jumpTo(s),i(s)}return!!this._averageElevation.isEasing(t)&&i(this._averageElevation.getValue(t))}_authenticate(){en(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,t=>{if(t&&(t.message===xe||t.status===401)){const e=this.painter.context.gl;kr(e,!1),this._logoControl instanceof nw&&this._logoControl._updateLogo(),e&&e.clear(e.DEPTH_BUFFER_BIT|e.COLOR_BUFFER_BIT|e.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new $i(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),KA(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const t=this._isDragging();this.painter.updateTerrain(this.style,t)}_calculateSpeedIndex(){const t=this.painter.canvasCopy(),e=this.painter.getCanvasCopiesAndTimestamps();e.timeStamps.push(performance.now());const i=this.painter.context.gl,r=i.createFramebuffer();function n(s){i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,s,0);const a=new Uint8Array(i.drawingBufferWidth*i.drawingBufferHeight*4);return i.readPixels(0,0,i.drawingBufferWidth,i.drawingBufferHeight,i.RGBA,i.UNSIGNED_BYTE,a),a}return i.bindFramebuffer(i.FRAMEBUFFER,r),this._canvasPixelComparison(n(t),e.canvasCopies.map(n),e.timeStamps)}_canvasPixelComparison(t,e,i){let r=i[1]-i[0];const n=t.length/4;for(let s=0;s<e.length;s++){const a=e[s];let c=0;for(let p=0;p<a.length;p+=4)a[p]===t[p]&&a[p+1]===t[p+1]&&a[p+2]===t[p+2]&&a[p+3]===t[p+3]&&(c+=1);r+=(i[s+2]-i[s+1])*(1-c/n)}return r}remove(){this._hash&&this._hash.remove();for(const e of this._controls)e.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),Ee!==void 0&&(Ee.removeEventListener("resize",this._onWindowResize,!1),Ee.removeEventListener("orientationchange",this._onWindowResize,!1),Ee.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),Ee.removeEventListener("online",this._onWindowOnline,!1),Ee.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Ko.delete(this.painter.context.gl),this._removed=!0,this.fire(new Jt("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(t){this._renderNextFrame=this._renderNextFrame||t,this.style&&!this._frame&&(this._frame=Wi.frame(e=>{const i=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,i&&this._render(e)}))}_preloadTiles(t){return Js(this.style?Object.values(this.style._sourceCaches):[],(e,i)=>e._preloadTiles(t,i),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(t){this._trackResize&&this.resize({originalEvent:t})._update()}_onVisibilityChange(){Ee.document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(t){this._showTileBoundaries!==t&&(this._showTileBoundaries=t,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(t){this._showTerrainWireframe!==t&&(this._showTerrainWireframe=t,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(t){this._showLayers2DWireframe!==t&&(this._showLayers2DWireframe=t,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(t){this._showLayers3DWireframe!==t&&(this._showLayers3DWireframe=t,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(t){this._speedIndexTiming!==t&&(this._speedIndexTiming=t,this._update())}get showPadding(){return!!this._showPadding}set showPadding(t){this._showPadding!==t&&(this._showPadding=t,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(t){this._showCollisionBoxes!==t&&(this._showCollisionBoxes=t,t?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(t){this._showOverdrawInspector!==t&&(this._showOverdrawInspector=t,this._update())}get repaint(){return!!this._repaint}set repaint(t){this._repaint!==t&&(this._repaint=t,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(t){this._vertices=t,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(t){this._showTileAABBs!==t&&(this._showTileAABBs=t,t&&this._update())}_setCacheLimits(t,e){(function(i,r){bs=i,us=r})(t,e)}get version(){return li}},NavigationControl:class{constructor(t){this.options=Pt({},oS,t),this._container=dn("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(Ir(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",e=>{this._map&&this._map.zoomIn({},{originalEvent:e})}),dn("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",e=>{this._map&&this._map.zoomOut({},{originalEvent:e})}),dn("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(Ir(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",e=>{const i=this._map;i&&(this.options.visualizePitch?i.resetNorthPitch({},{originalEvent:e}):i.resetNorth({},{originalEvent:e}))}),this._compassIcon=dn("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const t=this._map;if(!t)return;const e=t.getZoom(),i=e===t.getMaxZoom(),r=e===t.getMinZoom();this._zoomInButton.disabled=i,this._zoomOutButton.disabled=r,this._zoomInButton.setAttribute("aria-disabled",i.toString()),this._zoomOutButton.setAttribute("aria-disabled",r.toString())}_rotateCompassArrow(){const t=this._map;if(!t)return;const e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(t.transform.pitch*(Math.PI/180)),.5)}) rotateX(${t.transform.pitch}deg) rotateZ(${t.transform.angle*(180/Math.PI)}deg)`:`rotate(${t.transform.angle*(180/Math.PI)}deg)`;t._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=e)})}onAdd(t){return this._map=t,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),t.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&t.on("pitch",this._rotateCompassArrow),t.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new aS(t,this._compass,this.options.visualizePitch)),this._container}onRemove(){const t=this._map;t&&(this._container.remove(),this.options.showZoom&&t.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&t.off("pitch",this._rotateCompassArrow),t.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(t,e){const i=dn("button",t,this._container);return i.type="button",i.addEventListener("click",e),i}_setButtonTitle(t,e){if(!this._map)return;const i=this._map._getUIString(`NavigationControl.${e}`);t.setAttribute("aria-label",i),t.firstElementChild&&t.firstElementChild.setAttribute("title",i)}},GeolocateControl:class extends ss{constructor(t){super(),this.options=Pt({geolocation:Ee.navigator.geolocation},lS,t),Ir(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Xb(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(t){return this._map=t,this._container=dn("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(t){const e=(i=!!this.options.geolocation)=>{this._supportsGeolocation=i,t(i)};this._supportsGeolocation!==void 0?t(this._supportsGeolocation):Ee.navigator.permissions!==void 0?Ee.navigator.permissions.query({name:"geolocation"}).then(i=>e(i.state!=="denied")).catch(()=>e()):e()}_isOutOfMapMaxBounds(t){const e=this._map.getMaxBounds(),i=t.coords;return!!e&&(i.longitude<e.getWest()||i.longitude>e.getEast()||i.latitude<e.getSouth()||i.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(t){if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new Jt("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new Jt("geolocate",t)),this._finish()}}_updateCamera(t){const e=new er(t.coords.longitude,t.coords.latitude),i=t.coords.accuracy,r=Pt({bearing:this._map.getBearing()},this.options.fitBoundsOptions);this._map.fitBounds(e.toBounds(i),r,{geolocateSource:!0})}_updateMarker(t){if(t){const e=new er(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(e).addTo(this._map),this._userLocationDotMarker.setLngLat(e).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const t=this._map.transform,e=jn(1,t._center.lat)*t.worldSize,i=Math.ceil(2*this._accuracy*e);this._circleElement.style.width=`${i}px`,this._circleElement.style.height=`${i}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(t){if(this._map){if(this.options.trackUserLocation)if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new Jt("error",t)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(t){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=dn("button","mapboxgl-ctrl-geolocate",this._container),dn("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",t===!1){Be("Geolocation support is not available so the GeolocateControl will be disabled.");const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e)}else{const e=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=dn("div","mapboxgl-user-location"),this._dotElement.appendChild(dn("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(dn("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new zy({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=dn("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new zy({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",e=>{e.geolocateSource||this._watchState!=="ACTIVE_LOCK"||e.originalEvent&&e.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new Jt("trackuserlocationend")))})}}_onDeviceOrientation(t){this._userLocationDotMarker&&(t.webkitCompassHeading?this._heading=t.webkitCompassHeading:t.absolute===!0&&(this._heading=-1*t.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return Be("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new Jt("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new Jt("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new Jt("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let t;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(t={maximumAge:6e5,timeout:0},this._noTimeout=!0):(t=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,t),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const t=()=>{Ee.addEventListener("ondeviceorientationabsolute"in Ee?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};Ee.DeviceMotionEvent!==void 0&&typeof Ee.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(e=>{e==="granted"&&t()}).catch(console.error):t()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),Ee.removeEventListener("deviceorientation",this._onDeviceOrientation),Ee.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:rw,ScaleControl:class{constructor(t){this.options=Pt({},AS,t),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),Ir(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const t=this.options.maxWidth||100,e=this._map,i=e._containerHeight/2,r=e._containerWidth/2-t/2,n=e.unproject([r,i]),s=e.unproject([r+t,i]),a=n.distanceTo(s);if(this.options.unit==="imperial"){const c=3.2808*a;c>5280?this._setScale(t,c/5280,"mile"):this._setScale(t,c,"foot")}else this.options.unit==="nautical"?this._setScale(t,a/1852,"nautical-mile"):a>=1e3?this._setScale(t,a/1e3,"kilometer"):this._setScale(t,a,"meter")}_setScale(t,e,i){this._map._requestDomTask(()=>{const r=function(s){const a=Math.pow(10,`${Math.floor(s)}`.length-1);let c=s/a;return c=c>=10?10:c>=5?5:c>=3?3:c>=2?2:c>=1?1:function(p){const _=Math.pow(10,Math.ceil(-Math.log(p)/Math.LN10));return Math.round(p*_)/_}(c),a*c}(e),n=r/e;this._container.innerHTML=this._isNumberFormatSupported&&i!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:i}).format(r):`${r}&nbsp;${cS[i]}`,this._container.style.width=t*n+"px"})}onAdd(t){return this._map=t,this._language=t.getLanguage(),this._container=dn("div","mapboxgl-ctrl mapboxgl-ctrl-scale",t.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(t){this._language=t,this._update()}setUnit(t){this.options.unit=t,this._update()}},FullscreenControl:class{constructor(t){this._fullscreen=!1,t&&t.container&&(t.container instanceof Ee.HTMLElement?this._container=t.container:Be("Full screen control 'container' must be a DOM element.")),Ir(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in Ee.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in Ee.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(t){return this._map=t,this._container||(this._container=this._map.getContainer()),this._controlContainer=dn("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",Be("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,Ee.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!Ee.document.fullscreenEnabled&&!Ee.document.webkitFullscreenEnabled)}_setupUI(){const t=this._fullscreenButton=dn("button","mapboxgl-ctrl-fullscreen",this._controlContainer);dn("span","mapboxgl-ctrl-icon",t).setAttribute("aria-hidden","true"),t.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),Ee.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const t=this._getTitle();this._fullscreenButton.setAttribute("aria-label",t),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",t)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(Ee.document.fullscreenElement||Ee.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?Ee.document.exitFullscreen?Ee.document.exitFullscreen():Ee.document.webkitCancelFullScreen&&Ee.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends ss{constructor(t){super(),this.options=Pt(Object.create(tS),t),Ir(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(t&&t.className?t.className.trim().split(/\s+/):[])}addTo(t){return this._map&&this.remove(),this._map=t,this.options.closeOnClick&&t.on("preclick",this._onClose),this.options.closeOnMove&&t.on("move",this._onClose),t.on("remove",this.remove),this._update(),t._addPopup(this),this._focusFirstElement(),this._trackPointer?(t.on("mousemove",this._onMouseEvent),t.on("mouseup",this._onMouseEvent),t._canvasContainer.classList.add("mapboxgl-track-pointer")):t.on("move",this._update),this.fire(new Jt("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const t=this._map;return t&&(t.off("move",this._update),t.off("move",this._onClose),t.off("preclick",this._onClose),t.off("click",this._onClose),t.off("remove",this.remove),t.off("mousemove",this._onMouseEvent),t.off("mouseup",this._onMouseEvent),t.off("drag",this._onMouseEvent),t._canvasContainer&&t._canvasContainer.classList.remove("mapboxgl-track-pointer"),t._removePopup(this),this._map=void 0),this.fire(new Jt("close")),this}getLngLat(){return this._lngLat}setLngLat(t){this._lngLat=er.convert(t),this._pos=null,this._trackPointer=!1,this._update();const e=this._map;return e&&(e.on("move",this._update),e.off("mousemove",this._onMouseEvent),e._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const t=this._map;return t&&(t.off("move",this._update),t.on("mousemove",this._onMouseEvent),t.on("drag",this._onMouseEvent),t._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(t){return this.setDOMContent(Ee.document.createTextNode(t))}setHTML(t){const e=Ee.document.createDocumentFragment(),i=Ee.document.createElement("body");let r;for(i.innerHTML=t;r=i.firstChild,r;)e.appendChild(r);return this.setDOMContent(e)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(t){return this.options.maxWidth=t,this._update(),this}setDOMContent(t){let e=this._content;if(e)for(;e.hasChildNodes();)e.firstChild&&e.removeChild(e.firstChild);else e=this._content=dn("div","mapboxgl-popup-content",this._container||void 0);if(e.appendChild(t),this.options.closeButton){const i=this._closeButton=dn("button","mapboxgl-popup-close-button",e);i.type="button",i.setAttribute("aria-label","Close popup"),i.setAttribute("aria-hidden","true"),i.innerHTML="&#215;",i.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(t){return this._classList.add(t),this._updateClassList(),this}removeClassName(t){return this._classList.delete(t),this._updateClassList(),this}setOffset(t){return this.options.offset=t,this._update(),this}toggleClassName(t){let e;return this._classList.delete(t)?e=!1:(this._classList.add(t),e=!0),this._updateClassList(),e}_onMouseEvent(t){this._update(t.point)}_getAnchor(t){if(this.options.anchor)return this.options.anchor;const e=this._map,i=this._container,r=this._pos;if(!e||!i||!r)return"bottom";const n=i.offsetWidth,s=i.offsetHeight,a=r.x<n/2,c=r.x>e.transform.width-n/2;if(r.y+t<s)return a?"top-left":c?"top-right":"top";if(r.y>e.transform.height-s){if(a)return"bottom-left";if(c)return"bottom-right"}return a?"left":c?"right":"bottom"}_updateClassList(){const t=this._container;if(!t)return;const e=[...this._classList];e.push("mapboxgl-popup"),this._anchor&&e.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&e.push("mapboxgl-popup-track-pointer"),t.className=e.join(" ")}_update(t){const e=this._map,i=this._content;if(!e||!this._lngLat&&!this._trackPointer||!i)return;let r=this._container;if(r||(r=this._container=dn("div","mapboxgl-popup",e.getContainer()),this._tip=dn("div","mapboxgl-popup-tip",r),r.appendChild(i)),this.options.maxWidth&&r.style.maxWidth!==this.options.maxWidth&&(r.style.maxWidth=this.options.maxWidth),e.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=ow(this._lngLat,this._pos,e.transform)),!this._trackPointer||t){const n=this._pos=this._trackPointer&&t?t:e.project(this._lngLat),s=aw(this.options.offset),a=this._anchor=this._getAnchor(s.y),c=aw(this.options.offset,a),p=n.add(c).round();e._requestDomTask(()=>{this._container&&a&&(this._container.style.transform=`${Py[a]} translate(${p.x}px,${p.y}px)`)})}if(!this._marker&&e._showingGlobe()){const n=$h(e.transform,this._lngLat)?0:1;this._setOpacity(n)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const t=this._container.querySelector(iS);t&&t.focus()}_onClose(){this.remove()}_setOpacity(t){this._container&&(this._container.style.opacity=`${t}`),this._content&&(this._content.style.pointerEvents=t?"auto":"none")}},Marker:zy,Style:su,LngLat:er,LngLatBounds:kl,Point:ct,MercatorCoordinate:Wr,FreeCameraOptions:gx,Evented:ss,config:Gt,prewarm:function(){ep().acquire(ry)},clearPrewarmedResources:function(){const t=$0;t&&(t.isPreloaded()&&t.numActive()===1?(t.release(ry),$0=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return Gt.ACCESS_TOKEN},set accessToken(t){Gt.ACCESS_TOKEN=t},get baseApiUrl(){return Gt.API_URL},set baseApiUrl(t){Gt.API_URL=t},get workerCount(){return pd.workerCount},set workerCount(t){pd.workerCount=t},get maxParallelImageRequests(){return Gt.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(t){Gt.MAX_PARALLEL_IMAGE_REQUESTS=t},clearStorage(t){(function(e){if(!wr())return;const i=Ee.caches.delete(vr);e&&i.catch(e).then(()=>e())})(t)},workerUrl:"",workerClass:null,get dracoUrl(){return zv()},set dracoUrl(t){(function(e){ny=Wi.resolveURL(e),sy||(sy=new af(ep(),new ss)),sy.broadcast("setDracoUrl",ny)})(t)},setNow:Wi.setNow,restoreNow:Wi.restoreNow};yt.A=Tv,yt.D=Cm,yt.E=Mt,yt.F=Mg,yt.K=h_,yt.O=ui,yt.P=ct,yt.T=Gx,yt.V=Tm,yt.a=wm,yt.b=v1,yt.c=r_,yt.d=class extends ss{constructor(t,e,i,r,n,s){super(),this.actor=t,this.layerIndex=e,this.availableImages=i,this.loadVectorData=n||Dv,this.loading={},this.loaded={},this.deduped=new kv(t.scheduler),this.isSpriteLoaded=r,this.scheduler=t.scheduler,this.brightness=s}loadTile(t,e){const i=t.uid,r=t&&t.request,n=r&&r.collectResourceTiming,s=this.loading[i]=new kE(t);s.abort=this.loadVectorData(t,(a,c)=>{const p=!this.loading[i];if(delete this.loading[i],p||a||!c)return s.status="done",p||(this.loaded[i]=s),e(a);const _=c.rawData,v={};c.expires&&(v.expires=c.expires),c.cacheControl&&(v.cacheControl=c.cacheControl),s.vectorTile=c.vectorTile||new Tg(new Im(_));const E=()=>{s.parse(s.vectorTile,this.layerIndex,this.availableImages,this.actor,(C,B)=>{if(C||!B)return e(C);const O={};if(n){const G=to(r);G.length>0&&(O.resourceTiming=JSON.parse(JSON.stringify(G)))}e(null,Pt({rawTileData:_.slice(0)},B,v,O))})};this.isSpriteLoaded?E():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(E,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom}):E()}),this.loaded=this.loaded||{},this.loaded[i]=s})}reloadTile(t,e){const i=this.loaded,r=t.uid,n=this;if(i&&i[r]){const s=i[r];s.showCollisionBoxes=t.showCollisionBoxes,s.projection=t.projection,s.brightness=t.brightness,s.tileTransform=tf(t.tileID.canonical,t.projection),s.extraShadowCaster=t.extraShadowCaster;const a=(c,p)=>{const _=s.reloadCallback;_&&(delete s.reloadCallback,s.parse(s.vectorTile,n.layerIndex,this.availableImages,n.actor,_)),e(c,p)};s.status==="parsing"?s.reloadCallback=a:s.status==="done"&&(s.vectorTile?s.parse(s.vectorTile,this.layerIndex,this.availableImages,this.actor,a):a())}else e(null,void 0)}abortTile(t,e){const i=t.uid,r=this.loading[i];r&&(r.abort&&r.abort(),delete this.loading[i]),e()}removeTile(t,e){const i=this.loaded,r=t.uid;i&&i[r]&&delete i[r],e()}},yt.e=Xi,yt.f=to,yt.g=_r,yt.h=Le,yt.i=Ne,yt.j=function(t,e){const i=uy(t);for(const r of i){for(const n of r.meshes)UE(n);r.lights&&(r.lightMeshIndex=r.meshes.length,r.meshes.push(VE(r.lights,e)))}return i},yt.k=_s,yt.l=function(t){let e=0;if(new Uint32Array(t,0,1)[0]!==Lv){const i=new Uint32Array(t,0,7),[,,r,n,s,a]=i;e=i.byteLength+n+s+a+s,(r!==t.byteLength||e>=t.byteLength)&&Be("Invalid b3dm header information.")}return Nv(t,e)},yt.m=Om,yt.n=wA,yt.o=Jt,yt.p=pn,yt.q=function(t){zn(),pi&&pi.then(e=>{e.keys().then(i=>{for(let r=0;r<i.length-t;r++)e.delete(i[r])})})},yt.r=Zv,yt.s=I_,yt.t=C0,yt.v=Zn,yt.w=Ee}),Tt(["./shared"],function(yt){function Ee(Zt){if(typeof Zt=="number"||typeof Zt=="boolean"||typeof Zt=="string"||Zt==null)return JSON.stringify(Zt);if(Array.isArray(Zt)){let He="[";for(const Be of Zt)He+=`${Ee(Be)},`;return`${He}]`}let Ue="{";for(const He of Object.keys(Zt).sort())Ue+=`${He}:${Ee(Zt[He])},`;return`${Ue}}`}function li(Zt){let Ue="";for(const He of yt.r)Ue+=`/${Ee(Zt[He])}`;return Ue}class Ot{constructor(Ue){this.keyCache={},this._layers={},this._layerConfigs={},Ue&&this.replace(Ue)}replace(Ue,He){this._layerConfigs={},this._layers={},this.update(Ue,[],He)}update(Ue,He,Be){this._options=Be;for(const Qt of Ue){this._layerConfigs[Qt.id]=Qt;const ii=this._layers[Qt.id]=yt.c(Qt,this._options);ii.setScope(this.scope),ii.compileFilter(),this.keyCache[Qt.id]&&delete this.keyCache[Qt.id]}for(const Qt of He)delete this.keyCache[Qt],delete this._layerConfigs[Qt],delete this._layers[Qt];this.familiesBySource={};const Rt=function(Qt,ii){const ti={};for(let Ri=0;Ri<Qt.length;Ri++){const Zi=ii&&ii[Qt[Ri].id]||li(Qt[Ri]);ii&&(ii[Qt[Ri].id]=Zi);let Yi=ti[Zi];Yi||(Yi=ti[Zi]=[]),Yi.push(Qt[Ri])}const Ht=[];for(const Ri in ti)Ht.push(ti[Ri]);return Ht}(yt.v(this._layerConfigs),this.keyCache);for(const Qt of Rt){const ii=Qt.map(Yr=>this._layers[Yr.id]),ti=ii[0];if(ti.visibility==="none")continue;const Ht=ti.source||"";let Ri=this.familiesBySource[Ht];Ri||(Ri=this.familiesBySource[Ht]={});const Zi=ti.sourceLayer||"_geojsonTileLayer";let Yi=Ri[Zi];Yi||(Yi=Ri[Zi]=[]),Yi.push(ii)}}}class Gt{loadTile(Ue,He){const{uid:Be,encoding:Rt,rawImageData:Qt,padding:ii}=Ue,ti=yt.w.ImageBitmap&&Qt instanceof yt.w.ImageBitmap?this.getImageData(Qt,ii):Qt;He(null,new yt.D(Be,ti,Rt,ii<1))}getImageData(Ue,He){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Ue.width,Ue.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=Ue.width,this.offscreenCanvas.height=Ue.height,this.offscreenCanvasContext.drawImage(Ue,0,0,Ue.width,Ue.height);const Be=this.offscreenCanvasContext.getImageData(-He,-He,Ue.width+2*He,Ue.height+2*He);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),Be}}function Xr(Zt,Ue){if(Zt.length!==0){Ti(Zt[0],Ue);for(var He=1;He<Zt.length;He++)Ti(Zt[He],!Ue)}}function Ti(Zt,Ue){for(var He=0,Be=0,Rt=0,Qt=Zt.length,ii=Qt-1;Rt<Qt;ii=Rt++){var ti=(Zt[Rt][0]-Zt[ii][0])*(Zt[ii][1]+Zt[Rt][1]),Ht=He+ti;Be+=Math.abs(He)>=Math.abs(ti)?He-Ht+ti:ti-Ht+He,He=Ht}He+Be>=0!=!!Ue&&Zt.reverse()}var cn=yt.g(function Zt(Ue,He){var Be,Rt=Ue&&Ue.type;if(Rt==="FeatureCollection")for(Be=0;Be<Ue.features.length;Be++)Zt(Ue.features[Be],He);else if(Rt==="GeometryCollection")for(Be=0;Be<Ue.geometries.length;Be++)Zt(Ue.geometries[Be],He);else if(Rt==="Feature")Zt(Ue.geometry,He);else if(Rt==="Polygon")Xr(Ue.coordinates,He);else if(Rt==="MultiPolygon")for(Be=0;Be<Ue.coordinates.length;Be++)Xr(Ue.coordinates[Be],He);return Ue});const qr=yt.V.prototype.toGeoJSON;var dr={exports:{}},Tn=yt.p,un=yt.a.VectorTileFeature,_r=ps;function ps(Zt,Ue){this.options=Ue||{},this.features=Zt,this.length=Zt.length}function En(Zt,Ue){this.id=typeof Zt.id=="number"?Zt.id:void 0,this.type=Zt.type,this.rawGeometry=Zt.type===1?[Zt.geometry]:Zt.geometry,this.properties=Zt.tags,this.extent=Ue||4096}ps.prototype.feature=function(Zt){return new En(this.features[Zt],this.options.extent)},En.prototype.loadGeometry=function(){var Zt=this.rawGeometry;this.geometry=[];for(var Ue=0;Ue<Zt.length;Ue++){for(var He=Zt[Ue],Be=[],Rt=0;Rt<He.length;Rt++)Be.push(new Tn(He[Rt][0],He[Rt][1]));this.geometry.push(Be)}return this.geometry},En.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Zt=this.geometry,Ue=1/0,He=-1/0,Be=1/0,Rt=-1/0,Qt=0;Qt<Zt.length;Qt++)for(var ii=Zt[Qt],ti=0;ti<ii.length;ti++){var Ht=ii[ti];Ue=Math.min(Ue,Ht.x),He=Math.max(He,Ht.x),Be=Math.min(Be,Ht.y),Rt=Math.max(Rt,Ht.y)}return[Ue,Be,He,Rt]},En.prototype.toGeoJSON=un.prototype.toGeoJSON;var Ls=yt.b,pn=_r;function As(Zt){var Ue=new Ls;return function(He,Be){for(var Rt in He.layers)Be.writeMessage(3,ct,He.layers[Rt])}(Zt,Ue),Ue.finish()}function ct(Zt,Ue){var He;Ue.writeVarintField(15,Zt.version||1),Ue.writeStringField(1,Zt.name||""),Ue.writeVarintField(5,Zt.extent||4096);var Be={keys:[],values:[],keycache:{},valuecache:{}};for(He=0;He<Zt.length;He++)Be.feature=Zt.feature(He),Ue.writeMessage(2,Lt,Be);var Rt=Be.keys;for(He=0;He<Rt.length;He++)Ue.writeStringField(3,Rt[He]);var Qt=Be.values;for(He=0;He<Qt.length;He++)Ue.writeMessage(4,kn,Qt[He])}function Lt(Zt,Ue){var He=Zt.feature;He.id!==void 0&&Ue.writeVarintField(1,He.id),Ue.writeMessage(2,fn,Zt),Ue.writeVarintField(3,He.type),Ue.writeMessage(4,hr,He)}function fn(Zt,Ue){var He=Zt.feature,Be=Zt.keys,Rt=Zt.values,Qt=Zt.keycache,ii=Zt.valuecache;for(var ti in He.properties){var Ht=He.properties[ti],Ri=Qt[ti];if(Ht!==null){Ri===void 0&&(Be.push(ti),Qt[ti]=Ri=Be.length-1),Ue.writeVarint(Ri);var Zi=typeof Ht;Zi!=="string"&&Zi!=="boolean"&&Zi!=="number"&&(Ht=JSON.stringify(Ht));var Yi=Zi+":"+Ht,Yr=ii[Yi];Yr===void 0&&(Rt.push(Ht),ii[Yi]=Yr=Rt.length-1),Ue.writeVarint(Yr)}}}function mn(Zt,Ue){return(Ue<<3)+(7&Zt)}function wi(Zt){return Zt<<1^Zt>>31}function hr(Zt,Ue){for(var He=Zt.loadGeometry(),Be=Zt.type,Rt=0,Qt=0,ii=He.length,ti=0;ti<ii;ti++){var Ht=He[ti],Ri=1;Be===1&&(Ri=Ht.length),Ue.writeVarint(mn(1,Ri));for(var Zi=Be===3?Ht.length-1:Ht.length,Yi=0;Yi<Zi;Yi++){Yi===1&&Be!==1&&Ue.writeVarint(mn(2,Zi-1));var Yr=Ht[Yi].x-Rt,gn=Ht[Yi].y-Qt;Ue.writeVarint(wi(Yr)),Ue.writeVarint(wi(gn)),Rt+=Yr,Qt+=gn}Be===3&&Ue.writeVarint(mn(7,1))}}function kn(Zt,Ue){var He=typeof Zt;He==="string"?Ue.writeStringField(1,Zt):He==="boolean"?Ue.writeBooleanField(7,Zt):He==="number"&&(Zt%1!=0?Ue.writeDoubleField(3,Zt):Zt<0?Ue.writeSVarintField(6,Zt):Ue.writeVarintField(5,Zt))}dr.exports=As,dr.exports.fromVectorTileJs=As,dr.exports.fromGeojsonVt=function(Zt,Ue){Ue=Ue||{};var He={};for(var Be in Zt)He[Be]=new pn(Zt[Be].features,Ue),He[Be].name=Be,He[Be].version=Ue.version,He[Be].extent=Ue.extent;return As({layers:He})},dr.exports.GeoJSONWrapper=pn;var Dn=yt.g(dr.exports);const Rs={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Zt=>Zt},Ao=Math.fround||(yo=new Float32Array(1),Zt=>(yo[0]=+Zt,yo[0]));var yo;const ts=3,Ai=5,jr=6;class Pn{constructor(Ue){this.options=Object.assign(Object.create(Rs),Ue),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Ue){const{log:He,minZoom:Be,maxZoom:Rt}=this.options;He&&console.time("total time");const Qt=`prepare ${Ue.length} points`;He&&console.time(Qt),this.points=Ue;const ii=[];for(let Ht=0;Ht<Ue.length;Ht++){const Ri=Ue[Ht];if(!Ri.geometry)continue;const[Zi,Yi]=Ri.geometry.coordinates,Yr=Ao(Pt(Zi)),gn=Ao(nr(Yi));ii.push(Yr,gn,1/0,Ht,-1,1),this.options.reduce&&ii.push(0)}let ti=this.trees[Rt+1]=this._createTree(ii);He&&console.timeEnd(Qt);for(let Ht=Rt;Ht>=Be;Ht--){const Ri=+Date.now();ti=this.trees[Ht]=this._createTree(this._cluster(ti,Ht)),He&&console.log("z%d: %d clusters in %dms",Ht,ti.numItems,+Date.now()-Ri)}return He&&console.timeEnd("total time"),this}getClusters(Ue,He){let Be=((Ue[0]+180)%360+360)%360-180;const Rt=Math.max(-90,Math.min(90,Ue[1]));let Qt=Ue[2]===180?180:((Ue[2]+180)%360+360)%360-180;const ii=Math.max(-90,Math.min(90,Ue[3]));if(Ue[2]-Ue[0]>=360)Be=-180,Qt=180;else if(Be>Qt){const Yi=this.getClusters([Be,Rt,180,ii],He),Yr=this.getClusters([-180,Rt,Qt,ii],He);return Yi.concat(Yr)}const ti=this.trees[this._limitZoom(He)],Ht=ti.range(Pt(Be),nr(ii),Pt(Qt),nr(Rt)),Ri=ti.data,Zi=[];for(const Yi of Ht){const Yr=this.stride*Yi;Zi.push(Ri[Yr+Ai]>1?Js(Ri,Yr,this.clusterProps):this.points[Ri[Yr+ts]])}return Zi}getChildren(Ue){const He=this._getOriginId(Ue),Be=this._getOriginZoom(Ue),Rt="No cluster with the specified id.",Qt=this.trees[Be];if(!Qt)throw new Error(Rt);const ii=Qt.data;if(He*this.stride>=ii.length)throw new Error(Rt);const ti=this.options.radius/(this.options.extent*Math.pow(2,Be-1)),Ht=Qt.within(ii[He*this.stride],ii[He*this.stride+1],ti),Ri=[];for(const Zi of Ht){const Yi=Zi*this.stride;ii[Yi+4]===Ue&&Ri.push(ii[Yi+Ai]>1?Js(ii,Yi,this.clusterProps):this.points[ii[Yi+ts]])}if(Ri.length===0)throw new Error(Rt);return Ri}getLeaves(Ue,He,Be){const Rt=[];return this._appendLeaves(Rt,Ue,He=He||10,Be=Be||0,0),Rt}getTile(Ue,He,Be){const Rt=this.trees[this._limitZoom(Ue)],Qt=Math.pow(2,Ue),{extent:ii,radius:ti}=this.options,Ht=ti/ii,Ri=(Be-Ht)/Qt,Zi=(Be+1+Ht)/Qt,Yi={features:[]};return this._addTileFeatures(Rt.range((He-Ht)/Qt,Ri,(He+1+Ht)/Qt,Zi),Rt.data,He,Be,Qt,Yi),He===0&&this._addTileFeatures(Rt.range(1-Ht/Qt,Ri,1,Zi),Rt.data,Qt,Be,Qt,Yi),He===Qt-1&&this._addTileFeatures(Rt.range(0,Ri,Ht/Qt,Zi),Rt.data,-1,Be,Qt,Yi),Yi.features.length?Yi:null}getClusterExpansionZoom(Ue){let He=this._getOriginZoom(Ue)-1;for(;He<=this.options.maxZoom;){const Be=this.getChildren(Ue);if(He++,Be.length!==1)break;Ue=Be[0].properties.cluster_id}return He}_appendLeaves(Ue,He,Be,Rt,Qt){const ii=this.getChildren(He);for(const ti of ii){const Ht=ti.properties;if(Ht&&Ht.cluster?Qt+Ht.point_count<=Rt?Qt+=Ht.point_count:Qt=this._appendLeaves(Ue,Ht.cluster_id,Be,Rt,Qt):Qt<Rt?Qt++:Ue.push(ti),Ue.length===Be)break}return Qt}_createTree(Ue){const He=new yt.K(Ue.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Be=0;Be<Ue.length;Be+=this.stride)He.add(Ue[Be],Ue[Be+1]);return He.finish(),He.data=Ue,He}_addTileFeatures(Ue,He,Be,Rt,Qt,ii){for(const ti of Ue){const Ht=ti*this.stride,Ri=He[Ht+Ai]>1;let Zi,Yi,Yr;if(Ri)Zi=Zn(He,Ht,this.clusterProps),Yi=He[Ht],Yr=He[Ht+1];else{const ni=this.points[He[Ht+ts]];Zi=ni.properties;const[yn,vr]=ni.geometry.coordinates;Yi=Pt(yn),Yr=nr(vr)}const gn={type:1,geometry:[[Math.round(this.options.extent*(Yi*Qt-Be)),Math.round(this.options.extent*(Yr*Qt-Rt))]],tags:Zi};let rs;rs=Ri||this.options.generateId?He[Ht+ts]:this.points[He[Ht+ts]].id,rs!==void 0&&(gn.id=rs),ii.features.push(gn)}}_limitZoom(Ue){return Math.max(this.options.minZoom,Math.min(Math.floor(+Ue),this.options.maxZoom+1))}_cluster(Ue,He){const{radius:Be,extent:Rt,reduce:Qt,minPoints:ii}=this.options,ti=Be/(Rt*Math.pow(2,He)),Ht=Ue.data,Ri=[],Zi=this.stride;for(let Yi=0;Yi<Ht.length;Yi+=Zi){if(Ht[Yi+2]<=He)continue;Ht[Yi+2]=He;const Yr=Ht[Yi],gn=Ht[Yi+1],rs=Ue.within(Ht[Yi],Ht[Yi+1],ti),ni=Ht[Yi+Ai];let yn=ni;for(const vr of rs){const bs=vr*Zi;Ht[bs+2]>He&&(yn+=Ht[bs+Ai])}if(yn>ni&&yn>=ii){let vr,bs=Yr*ni,us=gn*ni,pi=-1;const br=((Yi/Zi|0)<<5)+(He+1)+this.points.length;for(const wr of rs){const zn=wr*Zi;if(Ht[zn+2]<=He)continue;Ht[zn+2]=He;const co=Ht[zn+Ai];bs+=Ht[zn]*co,us+=Ht[zn+1]*co,Ht[zn+4]=br,Qt&&(vr||(vr=this._map(Ht,Yi,!0),pi=this.clusterProps.length,this.clusterProps.push(vr)),Qt(vr,this._map(Ht,zn)))}Ht[Yi+4]=br,Ri.push(bs/yn,us/yn,1/0,br,-1,yn),Qt&&Ri.push(pi)}else{for(let vr=0;vr<Zi;vr++)Ri.push(Ht[Yi+vr]);if(yn>1)for(const vr of rs){const bs=vr*Zi;if(!(Ht[bs+2]<=He)){Ht[bs+2]=He;for(let us=0;us<Zi;us++)Ri.push(Ht[bs+us])}}}}return Ri}_getOriginId(Ue){return Ue-this.points.length>>5}_getOriginZoom(Ue){return(Ue-this.points.length)%32}_map(Ue,He,Be){if(Ue[He+Ai]>1){const ii=this.clusterProps[Ue[He+jr]];return Be?Object.assign({},ii):ii}const Rt=this.points[Ue[He+ts]].properties,Qt=this.options.map(Rt);return Be&&Qt===Rt?Object.assign({},Qt):Qt}}function Js(Zt,Ue,He){return{type:"Feature",id:Zt[Ue+ts],properties:Zn(Zt,Ue,He),geometry:{type:"Point",coordinates:[(Be=Zt[Ue],360*(Be-.5)),_n(Zt[Ue+1])]}};var Be}function Zn(Zt,Ue,He){const Be=Zt[Ue+Ai],Rt=Be>=1e4?`${Math.round(Be/1e3)}k`:Be>=1e3?Math.round(Be/100)/10+"k":Be,Qt=Zt[Ue+jr],ii=Qt===-1?{}:Object.assign({},He[Qt]);return Object.assign(ii,{cluster:!0,cluster_id:Zt[Ue+ts],point_count:Be,point_count_abbreviated:Rt})}function Pt(Zt){return Zt/360+.5}function nr(Zt){const Ue=Math.sin(Zt*Math.PI/180),He=.5-.25*Math.log((1+Ue)/(1-Ue))/Math.PI;return He<0?0:He>1?1:He}function _n(Zt){const Ue=(180-360*Zt)*Math.PI/180;return 360*Math.atan(Math.exp(Ue))/Math.PI-90}var cs={exports:{}};cs.exports=function(){function Zt(we,Ae,pe,Me){for(var Le,Ne=Me,$e=pe-Ae>>1,Qe=pe-Ae,Ge=we[Ae],We=we[Ae+1],Et=we[pe],xe=we[pe+1],Ie=Ae+3;Ie<pe;Ie+=3){var ut=Ue(we[Ie],we[Ie+1],Ge,We,Et,xe);if(ut>Ne)Le=Ie,Ne=ut;else if(ut===Ne){var zt=Math.abs(Ie-$e);zt<Qe&&(Le=Ie,Qe=zt)}}Ne>Me&&(Le-Ae>3&&Zt(we,Ae,Le,Me),we[Le+2]=Ne,pe-Le>3&&Zt(we,Le,pe,Me))}function Ue(we,Ae,pe,Me,Le,Ne){var $e=Le-pe,Qe=Ne-Me;if($e!==0||Qe!==0){var Ge=((we-pe)*$e+(Ae-Me)*Qe)/($e*$e+Qe*Qe);Ge>1?(pe=Le,Me=Ne):Ge>0&&(pe+=$e*Ge,Me+=Qe*Ge)}return($e=we-pe)*$e+(Qe=Ae-Me)*Qe}function He(we,Ae,pe,Me){var Le={id:we===void 0?null:we,type:Ae,geometry:pe,tags:Me,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ne){var $e=Ne.geometry,Qe=Ne.type;if(Qe==="Point"||Qe==="MultiPoint"||Qe==="LineString")Be(Ne,$e);else if(Qe==="Polygon"||Qe==="MultiLineString")for(var Ge=0;Ge<$e.length;Ge++)Be(Ne,$e[Ge]);else if(Qe==="MultiPolygon")for(Ge=0;Ge<$e.length;Ge++)for(var We=0;We<$e[Ge].length;We++)Be(Ne,$e[Ge][We])}(Le),Le}function Be(we,Ae){for(var pe=0;pe<Ae.length;pe+=3)we.minX=Math.min(we.minX,Ae[pe]),we.minY=Math.min(we.minY,Ae[pe+1]),we.maxX=Math.max(we.maxX,Ae[pe]),we.maxY=Math.max(we.maxY,Ae[pe+1])}function Rt(we,Ae,pe,Me){if(Ae.geometry){var Le=Ae.geometry.coordinates,Ne=Ae.geometry.type,$e=Math.pow(pe.tolerance/((1<<pe.maxZoom)*pe.extent),2),Qe=[],Ge=Ae.id;if(pe.promoteId?Ge=Ae.properties[pe.promoteId]:pe.generateId&&(Ge=Me||0),Ne==="Point")Qt(Le,Qe);else if(Ne==="MultiPoint")for(var We=0;We<Le.length;We++)Qt(Le[We],Qe);else if(Ne==="LineString")ii(Le,Qe,$e,!1);else if(Ne==="MultiLineString"){if(pe.lineMetrics){for(We=0;We<Le.length;We++)ii(Le[We],Qe=[],$e,!1),we.push(He(Ge,"LineString",Qe,Ae.properties));return}ti(Le,Qe,$e,!1)}else if(Ne==="Polygon")ti(Le,Qe,$e,!0);else{if(Ne!=="MultiPolygon"){if(Ne==="GeometryCollection"){for(We=0;We<Ae.geometry.geometries.length;We++)Rt(we,{id:Ge,geometry:Ae.geometry.geometries[We],properties:Ae.properties},pe,Me);return}throw new Error("Input data is not a valid GeoJSON object.")}for(We=0;We<Le.length;We++){var Et=[];ti(Le[We],Et,$e,!0),Qe.push(Et)}}we.push(He(Ge,Ne,Qe,Ae.properties))}}function Qt(we,Ae){Ae.push(Ht(we[0])),Ae.push(Ri(we[1])),Ae.push(0)}function ii(we,Ae,pe,Me){for(var Le,Ne,$e=0,Qe=0;Qe<we.length;Qe++){var Ge=Ht(we[Qe][0]),We=Ri(we[Qe][1]);Ae.push(Ge),Ae.push(We),Ae.push(0),Qe>0&&($e+=Me?(Le*We-Ge*Ne)/2:Math.sqrt(Math.pow(Ge-Le,2)+Math.pow(We-Ne,2))),Le=Ge,Ne=We}var Et=Ae.length-3;Ae[2]=1,Zt(Ae,0,Et,pe),Ae[Et+2]=1,Ae.size=Math.abs($e),Ae.start=0,Ae.end=Ae.size}function ti(we,Ae,pe,Me){for(var Le=0;Le<we.length;Le++){var Ne=[];ii(we[Le],Ne,pe,Me),Ae.push(Ne)}}function Ht(we){return we/360+.5}function Ri(we){var Ae=Math.sin(we*Math.PI/180),pe=.5-.25*Math.log((1+Ae)/(1-Ae))/Math.PI;return pe<0?0:pe>1?1:pe}function Zi(we,Ae,pe,Me,Le,Ne,$e,Qe){if(Me/=Ae,Ne>=(pe/=Ae)&&$e<Me)return we;if($e<pe||Ne>=Me)return null;for(var Ge=[],We=0;We<we.length;We++){var Et=we[We],xe=Et.geometry,Ie=Et.type,ut=Le===0?Et.minX:Et.minY,zt=Le===0?Et.maxX:Et.maxY;if(ut>=pe&&zt<Me)Ge.push(Et);else if(!(zt<pe||ut>=Me)){var o=[];if(Ie==="Point"||Ie==="MultiPoint")Yi(xe,o,pe,Me,Le);else if(Ie==="LineString")Yr(xe,o,pe,Me,Le,!1,Qe.lineMetrics);else if(Ie==="MultiLineString")rs(xe,o,pe,Me,Le,!1);else if(Ie==="Polygon")rs(xe,o,pe,Me,Le,!0);else if(Ie==="MultiPolygon")for(var oe=0;oe<xe.length;oe++){var $t=[];rs(xe[oe],$t,pe,Me,Le,!0),$t.length&&o.push($t)}if(o.length){if(Qe.lineMetrics&&Ie==="LineString"){for(oe=0;oe<o.length;oe++)Ge.push(He(Et.id,Ie,o[oe],Et.tags));continue}Ie!=="LineString"&&Ie!=="MultiLineString"||(o.length===1?(Ie="LineString",o=o[0]):Ie="MultiLineString"),Ie!=="Point"&&Ie!=="MultiPoint"||(Ie=o.length===3?"Point":"MultiPoint"),Ge.push(He(Et.id,Ie,o,Et.tags))}}}return Ge.length?Ge:null}function Yi(we,Ae,pe,Me,Le){for(var Ne=0;Ne<we.length;Ne+=3){var $e=we[Ne+Le];$e>=pe&&$e<=Me&&(Ae.push(we[Ne]),Ae.push(we[Ne+1]),Ae.push(we[Ne+2]))}}function Yr(we,Ae,pe,Me,Le,Ne,$e){for(var Qe,Ge,We=gn(we),Et=Le===0?yn:vr,xe=we.start,Ie=0;Ie<we.length-3;Ie+=3){var ut=we[Ie],zt=we[Ie+1],o=we[Ie+2],oe=we[Ie+3],$t=we[Ie+4],_i=Le===0?ut:zt,mi=Le===0?oe:$t,si=!1;$e&&(Qe=Math.sqrt(Math.pow(ut-oe,2)+Math.pow(zt-$t,2))),_i<pe?mi>pe&&(Ge=Et(We,ut,zt,oe,$t,pe),$e&&(We.start=xe+Qe*Ge)):_i>Me?mi<Me&&(Ge=Et(We,ut,zt,oe,$t,Me),$e&&(We.start=xe+Qe*Ge)):ni(We,ut,zt,o),mi<pe&&_i>=pe&&(Ge=Et(We,ut,zt,oe,$t,pe),si=!0),mi>Me&&_i<=Me&&(Ge=Et(We,ut,zt,oe,$t,Me),si=!0),!Ne&&si&&($e&&(We.end=xe+Qe*Ge),Ae.push(We),We=gn(we)),$e&&(xe+=Qe)}var hi=we.length-3;ut=we[hi],zt=we[hi+1],o=we[hi+2],(_i=Le===0?ut:zt)>=pe&&_i<=Me&&ni(We,ut,zt,o),hi=We.length-3,Ne&&hi>=3&&(We[hi]!==We[0]||We[hi+1]!==We[1])&&ni(We,We[0],We[1],We[2]),We.length&&Ae.push(We)}function gn(we){var Ae=[];return Ae.size=we.size,Ae.start=we.start,Ae.end=we.end,Ae}function rs(we,Ae,pe,Me,Le,Ne){for(var $e=0;$e<we.length;$e++)Yr(we[$e],Ae,pe,Me,Le,Ne,!1)}function ni(we,Ae,pe,Me){we.push(Ae),we.push(pe),we.push(Me)}function yn(we,Ae,pe,Me,Le,Ne){var $e=(Ne-Ae)/(Me-Ae);return we.push(Ne),we.push(pe+(Le-pe)*$e),we.push(1),$e}function vr(we,Ae,pe,Me,Le,Ne){var $e=(Ne-pe)/(Le-pe);return we.push(Ae+(Me-Ae)*$e),we.push(Ne),we.push(1),$e}function bs(we,Ae){for(var pe=[],Me=0;Me<we.length;Me++){var Le,Ne=we[Me],$e=Ne.type;if($e==="Point"||$e==="MultiPoint"||$e==="LineString")Le=us(Ne.geometry,Ae);else if($e==="MultiLineString"||$e==="Polygon"){Le=[];for(var Qe=0;Qe<Ne.geometry.length;Qe++)Le.push(us(Ne.geometry[Qe],Ae))}else if($e==="MultiPolygon")for(Le=[],Qe=0;Qe<Ne.geometry.length;Qe++){for(var Ge=[],We=0;We<Ne.geometry[Qe].length;We++)Ge.push(us(Ne.geometry[Qe][We],Ae));Le.push(Ge)}pe.push(He(Ne.id,$e,Le,Ne.tags))}return pe}function us(we,Ae){var pe=[];pe.size=we.size,we.start!==void 0&&(pe.start=we.start,pe.end=we.end);for(var Me=0;Me<we.length;Me+=3)pe.push(we[Me]+Ae,we[Me+1],we[Me+2]);return pe}function pi(we,Ae){if(we.transformed)return we;var pe,Me,Le,Ne=1<<we.z,$e=we.x,Qe=we.y;for(pe=0;pe<we.features.length;pe++){var Ge=we.features[pe],We=Ge.geometry,Et=Ge.type;if(Ge.geometry=[],Et===1)for(Me=0;Me<We.length;Me+=2)Ge.geometry.push(br(We[Me],We[Me+1],Ae,Ne,$e,Qe));else for(Me=0;Me<We.length;Me++){var xe=[];for(Le=0;Le<We[Me].length;Le+=2)xe.push(br(We[Me][Le],We[Me][Le+1],Ae,Ne,$e,Qe));Ge.geometry.push(xe)}}return we.transformed=!0,we}function br(we,Ae,pe,Me,Le,Ne){return[Math.round(pe*(we*Me-Le)),Math.round(pe*(Ae*Me-Ne))]}function wr(we,Ae,pe,Me,Le){for(var Ne=Ae===Le.maxZoom?0:Le.tolerance/((1<<Ae)*Le.extent),$e={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:pe,y:Me,z:Ae,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Qe=0;Qe<we.length;Qe++){$e.numFeatures++,zn($e,we[Qe],Ne,Le);var Ge=we[Qe].minX,We=we[Qe].minY,Et=we[Qe].maxX,xe=we[Qe].maxY;Ge<$e.minX&&($e.minX=Ge),We<$e.minY&&($e.minY=We),Et>$e.maxX&&($e.maxX=Et),xe>$e.maxY&&($e.maxY=xe)}return $e}function zn(we,Ae,pe,Me){var Le=Ae.geometry,Ne=Ae.type,$e=[];if(Ne==="Point"||Ne==="MultiPoint")for(var Qe=0;Qe<Le.length;Qe+=3)$e.push(Le[Qe]),$e.push(Le[Qe+1]),we.numPoints++,we.numSimplified++;else if(Ne==="LineString")co($e,Le,we,pe,!1,!1);else if(Ne==="MultiLineString"||Ne==="Polygon")for(Qe=0;Qe<Le.length;Qe++)co($e,Le[Qe],we,pe,Ne==="Polygon",Qe===0);else if(Ne==="MultiPolygon")for(var Ge=0;Ge<Le.length;Ge++){var We=Le[Ge];for(Qe=0;Qe<We.length;Qe++)co($e,We[Qe],we,pe,!0,Qe===0)}if($e.length){var Et=Ae.tags||null;if(Ne==="LineString"&&Me.lineMetrics){for(var xe in Et={},Ae.tags)Et[xe]=Ae.tags[xe];Et.mapbox_clip_start=Le.start/Le.size,Et.mapbox_clip_end=Le.end/Le.size}var Ie={geometry:$e,type:Ne==="Polygon"||Ne==="MultiPolygon"?3:Ne==="LineString"||Ne==="MultiLineString"?2:1,tags:Et};Ae.id!==null&&(Ie.id=Ae.id),we.features.push(Ie)}}function co(we,Ae,pe,Me,Le,Ne){var $e=Me*Me;if(Me>0&&Ae.size<(Le?$e:Me))pe.numPoints+=Ae.length/3;else{for(var Qe=[],Ge=0;Ge<Ae.length;Ge+=3)(Me===0||Ae[Ge+2]>$e)&&(pe.numSimplified++,Qe.push(Ae[Ge]),Qe.push(Ae[Ge+1])),pe.numPoints++;Le&&function(We,Et){for(var xe=0,Ie=0,ut=We.length,zt=ut-2;Ie<ut;zt=Ie,Ie+=2)xe+=(We[Ie]-We[zt])*(We[Ie+1]+We[zt+1]);if(xe>0===Et)for(Ie=0,ut=We.length;Ie<ut/2;Ie+=2){var o=We[Ie],oe=We[Ie+1];We[Ie]=We[ut-2-Ie],We[Ie+1]=We[ut-1-Ie],We[ut-2-Ie]=o,We[ut-1-Ie]=oe}}(Qe,Ne),we.push(Qe)}}function Sr(we,Ae){var pe=(Ae=this.options=function(Le,Ne){for(var $e in Ne)Le[$e]=Ne[$e];return Le}(Object.create(this.options),Ae)).debug;if(pe&&console.time("preprocess data"),Ae.maxZoom<0||Ae.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Ae.promoteId&&Ae.generateId)throw new Error("promoteId and generateId cannot be used together.");var Me=function(Le,Ne){var $e=[];if(Le.type==="FeatureCollection")for(var Qe=0;Qe<Le.features.length;Qe++)Rt($e,Le.features[Qe],Ne,Qe);else Rt($e,Le.type==="Feature"?Le:{geometry:Le},Ne);return $e}(we,Ae);this.tiles={},this.tileCoords=[],pe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Ae.indexMaxZoom,Ae.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(Me=function(Le,Ne){var $e=Ne.buffer/Ne.extent,Qe=Le,Ge=Zi(Le,1,-1-$e,$e,0,-1,2,Ne),We=Zi(Le,1,1-$e,2+$e,0,-1,2,Ne);return(Ge||We)&&(Qe=Zi(Le,1,-$e,1+$e,0,-1,2,Ne)||[],Ge&&(Qe=bs(Ge,1).concat(Qe)),We&&(Qe=Qe.concat(bs(We,-1)))),Qe}(Me,Ae)).length&&this.splitTile(Me,0,0,0),pe&&(Me.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function kt(we,Ae,pe){return 32*((1<<we)*pe+Ae)+we}return Sr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Sr.prototype.splitTile=function(we,Ae,pe,Me,Le,Ne,$e){for(var Qe=[we,Ae,pe,Me],Ge=this.options,We=Ge.debug;Qe.length;){Me=Qe.pop(),pe=Qe.pop(),Ae=Qe.pop(),we=Qe.pop();var Et=1<<Ae,xe=kt(Ae,pe,Me),Ie=this.tiles[xe];if(!Ie&&(We>1&&console.time("creation"),Ie=this.tiles[xe]=wr(we,Ae,pe,Me,Ge),this.tileCoords.push({z:Ae,x:pe,y:Me}),We)){We>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Ae,pe,Me,Ie.numFeatures,Ie.numPoints,Ie.numSimplified),console.timeEnd("creation"));var ut="z"+Ae;this.stats[ut]=(this.stats[ut]||0)+1,this.total++}if(Ie.source=we,Le){if(Ae===Ge.maxZoom||Ae===Le)continue;var zt=1<<Le-Ae;if(pe!==Math.floor(Ne/zt)||Me!==Math.floor($e/zt))continue}else if(Ae===Ge.indexMaxZoom||Ie.numPoints<=Ge.indexMaxPoints)continue;if(Ie.source=null,we.length!==0){We>1&&console.time("clipping");var o,oe,$t,_i,mi,si,hi=.5*Ge.buffer/Ge.extent,gr=.5-hi,yi=.5+hi,Pi=1+hi;o=oe=$t=_i=null,mi=Zi(we,Et,pe-hi,pe+yi,0,Ie.minX,Ie.maxX,Ge),si=Zi(we,Et,pe+gr,pe+Pi,0,Ie.minX,Ie.maxX,Ge),we=null,mi&&(o=Zi(mi,Et,Me-hi,Me+yi,1,Ie.minY,Ie.maxY,Ge),oe=Zi(mi,Et,Me+gr,Me+Pi,1,Ie.minY,Ie.maxY,Ge),mi=null),si&&($t=Zi(si,Et,Me-hi,Me+yi,1,Ie.minY,Ie.maxY,Ge),_i=Zi(si,Et,Me+gr,Me+Pi,1,Ie.minY,Ie.maxY,Ge),si=null),We>1&&console.timeEnd("clipping"),Qe.push(o||[],Ae+1,2*pe,2*Me),Qe.push(oe||[],Ae+1,2*pe,2*Me+1),Qe.push($t||[],Ae+1,2*pe+1,2*Me),Qe.push(_i||[],Ae+1,2*pe+1,2*Me+1)}}},Sr.prototype.getTile=function(we,Ae,pe){var Me=this.options,Le=Me.extent,Ne=Me.debug;if(we<0||we>24)return null;var $e=1<<we,Qe=kt(we,Ae=(Ae%$e+$e)%$e,pe);if(this.tiles[Qe])return pi(this.tiles[Qe],Le);Ne>1&&console.log("drilling down to z%d-%d-%d",we,Ae,pe);for(var Ge,We=we,Et=Ae,xe=pe;!Ge&&We>0;)We--,Et=Math.floor(Et/2),xe=Math.floor(xe/2),Ge=this.tiles[kt(We,Et,xe)];return Ge&&Ge.source?(Ne>1&&console.log("found parent tile z%d-%d-%d",We,Et,xe),Ne>1&&console.time("drilling down"),this.splitTile(Ge.source,We,Et,xe,we,Ae,pe),Ne>1&&console.timeEnd("drilling down"),this.tiles[Qe]?pi(this.tiles[Qe],Le):null):null},function(we,Ae){return new Sr(we,Ae)}}();var aa=yt.g(cs.exports);function Yo(Zt,Ue){const He=Zt.tileID.canonical;if(!this._geoJSONIndex)return Ue(null,null);const Be=this._geoJSONIndex.getTile(He.z,He.x,He.y);if(!Be)return Ue(null,null);const Rt=new class{constructor(ii){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=yt.E,this.length=ii.length,this._features=ii}feature(ii){return new class{constructor(ti){this._feature=ti,this.extent=yt.E,this.type=ti.type,this.properties=ti.tags,"id"in ti&&!isNaN(ti.id)&&(this.id=parseInt(ti.id,10))}loadGeometry(){if(this._feature.type===1){const ti=[];for(const Ht of this._feature.geometry)ti.push([new yt.P(Ht[0],Ht[1])]);return ti}{const ti=[];for(const Ht of this._feature.geometry){const Ri=[];for(const Zi of Ht)Ri.push(new yt.P(Zi[0],Zi[1]));ti.push(Ri)}return ti}}toGeoJSON(ti,Ht,Ri){return qr.call(this,ti,Ht,Ri)}}(this._features[ii])}}(Be.features);let Qt=Dn(Rt);Qt.byteOffset===0&&Qt.byteLength===Qt.buffer.byteLength||(Qt=new Uint8Array(Qt)),Ue(null,{vectorTile:Rt,rawData:Qt.buffer})}class Di extends yt.d{constructor(Ue,He,Be,Rt,Qt,ii){super(Ue,He,Be,Rt,Yo,ii),Qt&&(this.loadGeoJSON=Qt)}loadData(Ue,He){const Be=Ue&&Ue.request,Rt=Be&&Be.collectResourceTiming;this.loadGeoJSON(Ue,(Qt,ii)=>{if(Qt||!ii)return He(Qt);if(typeof ii!="object")return He(new Error(`Input data given to '${Ue.source}' is not a valid GeoJSON object.`));{cn(ii,!0);try{if(Ue.filter){const Ht=yt.e(Ue.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ht.result==="error")throw new Error(Ht.value.map(Zi=>`${Zi.key}: ${Zi.message}`).join(", "));ii={type:"FeatureCollection",features:ii.features.filter(Zi=>Ht.value.evaluate({zoom:0},Zi))}}this._geoJSONIndex=Ue.cluster?new Pn(function({superclusterOptions:Ht,clusterProperties:Ri}){if(!Ri||!Ht)return Ht;const Zi={},Yi={},Yr={accumulated:null,zoom:0},gn={properties:null},rs=Object.keys(Ri);for(const ni of rs){const[yn,vr]=Ri[ni],bs=yt.e(vr),us=yt.e(typeof yn=="string"?[yn,["accumulated"],["get",ni]]:yn);Zi[ni]=bs.value,Yi[ni]=us.value}return Ht.map=ni=>{gn.properties=ni;const yn={};for(const vr of rs)yn[vr]=Zi[vr].evaluate(Yr,gn);return yn},Ht.reduce=(ni,yn)=>{gn.properties=yn;for(const vr of rs)Yr.accumulated=ni[vr],ni[vr]=Yi[vr].evaluate(Yr,gn)},Ht}(Ue)).load(ii.features):aa(ii,Ue.geojsonVtOptions)}catch(Ht){return He(Ht)}this.loaded={};const ti={};if(Rt){const Ht=yt.f(Be);Ht&&(ti.resourceTiming={},ti.resourceTiming[Ue.source]=JSON.parse(JSON.stringify(Ht)))}He(null,ti)}})}reloadTile(Ue,He){const Be=this.loaded;return Be&&Be[Ue.uid]?super.reloadTile(Ue,He):this.loadTile(Ue,He)}loadGeoJSON(Ue,He){if(Ue.request)yt.h(Ue.request,He);else{if(typeof Ue.data!="string")return He(new Error(`Input data given to '${Ue.source}' is not a valid GeoJSON object.`));try{return He(null,JSON.parse(Ue.data))}catch{return He(new Error(`Input data given to '${Ue.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(Ue,He){try{He(null,this._geoJSONIndex.getClusterExpansionZoom(Ue.clusterId))}catch(Be){He(Be)}}getClusterChildren(Ue,He){try{He(null,this._geoJSONIndex.getChildren(Ue.clusterId))}catch(Be){He(Be)}}getClusterLeaves(Ue,He){try{He(null,this._geoJSONIndex.getLeaves(Ue.clusterId,Ue.limit,Ue.offset))}catch(Be){He(Be)}}}class Ir{constructor(Ue,He){this.tileID=new yt.O(Ue.tileID.overscaledZ,Ue.tileID.wrap,Ue.tileID.canonical.z,Ue.tileID.canonical.x,Ue.tileID.canonical.y),this.tileZoom=Ue.tileZoom,this.uid=Ue.uid,this.zoom=Ue.zoom,this.canonical=Ue.tileID.canonical,this.pixelRatio=Ue.pixelRatio,this.tileSize=Ue.tileSize,this.source=Ue.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=Ue.projection,this.brightness=He}parse(Ue,He,Be,Rt){this.status="parsing";const Qt=new yt.O(Be.tileID.overscaledZ,Be.tileID.wrap,Be.tileID.canonical.z,Be.tileID.canonical.x,Be.tileID.canonical.y),ii={},ti=He.familiesBySource[Be.source],Ht=new yt.F(Qt,Be.promoteId);return Ht.bucketLayerIDs=[],yt.l(Ue).then(Ri=>{if(!Ri)return Rt(new Error("Could not parse tile"));const Zi=yt.j(Ri,1/yt.t(Be.tileID.canonical)),Yi=Ri.json.extensionsUsed&&Ri.json.extensionsUsed.includes("MAPBOX_mesh_features"),Yr=new yt.k(this.zoom,{brightness:this.brightness});for(const gn in ti)for(const rs of ti[gn]){const ni=rs[0],yn=Ri.json.extensionsUsed;ni.recalculate(Yr,[]);const vr=new yt.T(Zi,Qt,yn&&yn.includes("MAPBOX_mesh_features"),this.brightness);Yi||(vr.needsUpload=!0),ii[ni.fqid]=vr,vr.evaluate(ni)}this.status="done",Rt(null,{buckets:ii,featureIndex:Ht})}).catch(Ri=>Rt(new Error(Ri.message)))}}class $s{constructor(Ue,He,Be,Rt,Qt,ii){this.actor=Ue,this.layerIndex=He,this.brightness=ii,this.loading={},this.loaded={}}loadTile(Ue,He){const Be=Ue.uid,Rt=this.loading[Be]=new Ir(Ue,this.brightness);yt.i(Ue.request,(Qt,ii)=>{const ti=!this.loading[Be];return delete this.loading[Be],ti||Qt?(Rt.status="done",ti||(this.loaded[Be]=Rt),He(Qt)):ii&&ii.byteLength!==0?void Rt.parse(ii,this.layerIndex,Ue,(Ht,Ri)=>{Rt.status="done",this.loaded=this.loaded||{},this.loaded[Be]=Rt,Ht||!Ri?He(Ht):He(null,Ri)}):(Rt.status="done",this.loaded[Be]=Rt,He())})}reloadTile(Ue,He){const Be=this.loaded,Rt=Ue.uid;if(Be&&Be[Rt]){const Qt=Be[Rt];Qt.projection=Ue.projection,Qt.brightness=Ue.brightness;const ii=(ti,Ht)=>{Qt.reloadCallback&&(delete Qt.reloadCallback,this.loadTile(Ue,He)),He(ti,Ht)};Qt.status==="parsing"?Qt.reloadCallback=ii:Qt.status==="done"&&this.loadTile(Ue,He)}}abortTile(Ue,He){const Be=Ue.uid;this.loading[Be]&&delete this.loading[Be],He()}removeTile(Ue,He){const Be=this.loaded,Rt=Ue.uid;Be&&Be[Rt]&&delete Be[Rt],He()}}class Cs{constructor(Ue){this.self=Ue,this.actor=new yt.A(Ue,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=yt.m({name:"mercator"}),this.workerSourceTypes={vector:yt.d,geojson:Di,"batched-model":$s},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(He,Be)=>{if(this.workerSourceTypes[He])throw new Error(`Worker source with name "${He}" already registered.`);this.workerSourceTypes[He]=Be},this.self.registerRTLTextPlugin=He=>{if(yt.n.isParsed())throw new Error("RTL text plugin already registered.");yt.n.applyArabicShaping=He.applyArabicShaping,yt.n.processBidirectionalText=He.processBidirectionalText,yt.n.processStyledBidirectionalText=He.processStyledBidirectionalText}}clearCaches(Ue,He,Be){delete this.layerIndexes[Ue],delete this.availableImages[Ue],delete this.workerSources[Ue],delete this.demWorkerSources[Ue],Be()}checkIfReady(Ue,He,Be){Be()}setReferrer(Ue,He){this.referrer=He}spriteLoaded(Ue,{scope:He,isLoaded:Be}){if(this.isSpriteLoaded[Ue]||(this.isSpriteLoaded[Ue]={}),this.isSpriteLoaded[Ue][He]=Be,this.workerSources[Ue]&&this.workerSources[Ue][He])for(const Rt in this.workerSources[Ue][He]){const Qt=this.workerSources[Ue][He][Rt];for(const ii in Qt)Qt[ii]instanceof yt.d&&(Qt[ii].isSpriteLoaded=Be,Qt[ii].fire(new yt.o("isSpriteLoaded")))}}setImages(Ue,{scope:He,images:Be},Rt){if(this.availableImages[Ue]||(this.availableImages[Ue]={}),this.availableImages[Ue][He]=Be,this.workerSources[Ue]&&this.workerSources[Ue][He]){for(const Qt in this.workerSources[Ue][He]){const ii=this.workerSources[Ue][He][Qt];for(const ti in ii)ii[ti].availableImages=Be}Rt()}else Rt()}setProjection(Ue,He){this.projections[Ue]=yt.m(He)}setBrightness(Ue,He,Be){this.brightness=He,Be()}setLayers(Ue,He,Be){this.getLayerIndex(Ue,He.scope).replace(He.layers,He.options),Be()}updateLayers(Ue,He,Be){this.getLayerIndex(Ue,He.scope).update(He.layers,He.removedIds,He.options),Be()}loadTile(Ue,He,Be){He.projection=this.projections[Ue]||this.defaultProjection,this.getWorkerSource(Ue,He.type,He.source,He.scope).loadTile(He,Be)}loadDEMTile(Ue,He,Be){this.getDEMWorkerSource(Ue,He.source,He.scope).loadTile(He,Be)}reloadTile(Ue,He,Be){He.projection=this.projections[Ue]||this.defaultProjection,this.getWorkerSource(Ue,He.type,He.source,He.scope).reloadTile(He,Be)}abortTile(Ue,He,Be){this.getWorkerSource(Ue,He.type,He.source,He.scope).abortTile(He,Be)}removeTile(Ue,He,Be){this.getWorkerSource(Ue,He.type,He.source,He.scope).removeTile(He,Be)}removeSource(Ue,He,Be){if(!(this.workerSources[Ue]&&this.workerSources[Ue][He.scope]&&this.workerSources[Ue][He.scope][He.type]&&this.workerSources[Ue][He.scope][He.type][He.source]))return;const Rt=this.workerSources[Ue][He.scope][He.type][He.source];delete this.workerSources[Ue][He.scope][He.type][He.source],Rt.removeSource!==void 0?Rt.removeSource(He,Be):Be()}loadWorkerSource(Ue,He,Be){try{this.self.importScripts(He.url),Be()}catch(Rt){Be(Rt.toString())}}syncRTLPluginState(Ue,He,Be){try{yt.n.setState(He);const Rt=yt.n.getPluginURL();if(yt.n.isLoaded()&&!yt.n.isParsed()&&Rt!=null){this.self.importScripts(Rt);const Qt=yt.n.isParsed();Be(Qt?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Rt}`),Qt)}}catch(Rt){Be(Rt.toString())}}setDracoUrl(Ue,He){this.dracoUrl=He}getAvailableImages(Ue,He){this.availableImages[Ue]||(this.availableImages[Ue]={});let Be=this.availableImages[Ue][He];return Be||(Be=[]),Be}getLayerIndex(Ue,He){this.layerIndexes[Ue]||(this.layerIndexes[Ue]={});let Be=this.layerIndexes[Ue][He];return Be||(Be=this.layerIndexes[Ue][He]=new Ot,Be.scope=He),Be}getWorkerSource(Ue,He,Be,Rt){if(this.workerSources[Ue]||(this.workerSources[Ue]={}),this.workerSources[Ue][Rt]||(this.workerSources[Ue][Rt]={}),this.workerSources[Ue][Rt][He]||(this.workerSources[Ue][Rt][He]={}),this.isSpriteLoaded[Ue]||(this.isSpriteLoaded[Ue]={}),!this.workerSources[Ue][Rt][He][Be]){const Qt={send:(ii,ti,Ht,Ri,Zi,Yi)=>{this.actor.send(ii,ti,Ht,Ue,Zi,Yi)},scheduler:this.actor.scheduler};this.workerSources[Ue][Rt][He][Be]=new this.workerSourceTypes[He](Qt,this.getLayerIndex(Ue,Rt),this.getAvailableImages(Ue,Rt),this.isSpriteLoaded[Ue][Rt],void 0,this.brightness)}return this.workerSources[Ue][Rt][He][Be]}getDEMWorkerSource(Ue,He,Be){return this.demWorkerSources[Ue]||(this.demWorkerSources[Ue]={}),this.demWorkerSources[Ue][Be]||(this.demWorkerSources[Ue][Be]={}),this.demWorkerSources[Ue][Be][He]||(this.demWorkerSources[Ue][Be][He]=new Gt),this.demWorkerSources[Ue][Be][He]}enforceCacheSizeLimit(Ue,He){yt.q(He)}getWorkerPerformanceMetrics(Ue,He,Be){Be(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Cs(self)),Cs}),Tt(["./shared"],function(yt){return yt.s});var P=Ye;return P})})(KI);var F_=function(ye){ye=ye||{};var te=typeof ye<"u"?ye:{},Re={},Te;for(Te in te)te.hasOwnProperty(Te)&&(Re[Te]=te[Te]);var Ke="";function Ye(xe){return te.locateFile?te.locateFile(xe,Ke):Ke+xe}var Tt;typeof document<"u"&&document.currentScript&&(Ke=document.currentScript.src),Ke.indexOf("blob:")!==0?Ke=Ke.substr(0,Ke.lastIndexOf("/")+1):Ke="",Tt=function(Ie,ut,zt){var o=new XMLHttpRequest;o.open("GET",Ie,!0),o.responseType="arraybuffer",o.onload=function(){if(o.status==200||o.status==0&&o.response){ut(o.response);return}var $t=zn(Ie);if($t){ut($t.buffer);return}zt()},o.onerror=zt,o.send(null)};var P=te.print||console.log.bind(console),yt=te.printErr||console.warn.bind(console);for(Te in Re)Re.hasOwnProperty(Te)&&(te[Te]=Re[Te]);Re=null,te.arguments&&te.arguments;var Ee=0,li=function(xe){Ee=xe},Ot=function(){return Ee},Gt=8;function Xr(xe,Ie,ut,zt){switch(ut=ut||"i8",ut.charAt(ut.length-1)==="*"&&(ut="i32"),ut){case"i1":fn[xe>>0]=Ie;break;case"i8":fn[xe>>0]=Ie;break;case"i16":wi[xe>>1]=Ie;break;case"i32":hr[xe>>2]=Ie;break;case"i64":Ht=[Ie>>>0,(ti=Ie,+Di(ti)>=1?ti>0?(Cs(+$s(ti/4294967296),4294967295)|0)>>>0:~~+Ir((ti-+(~~ti>>>0))/4294967296)>>>0:0)],hr[xe>>2]=Ht[0],hr[xe+4>>2]=Ht[1];break;case"float":kn[xe>>2]=Ie;break;case"double":Dn[xe>>3]=Ie;break;default:Et("invalid type for setValue: "+ut)}}function Ti(xe,Ie,ut){switch(Ie=Ie||"i8",Ie.charAt(Ie.length-1)==="*"&&(Ie="i32"),Ie){case"i1":return fn[xe>>0];case"i8":return fn[xe>>0];case"i16":return wi[xe>>1];case"i32":return hr[xe>>2];case"i64":return hr[xe>>2];case"float":return kn[xe>>2];case"double":return Dn[xe>>3];default:Et("invalid type for getValue: "+Ie)}return null}var cn=!1;function qr(xe,Ie){xe||Et("Assertion failed: "+Ie)}function dr(xe){var Ie=te["_"+xe];return qr(Ie,"Cannot call unknown function "+xe+", make sure it is exported"),Ie}function Tn(xe,Ie,ut,zt,o){var oe={string:function(Pi){var hn=0;if(Pi!=null&&Pi!==0){var eo=(Pi.length<<2)+1;hn=Ae(eo),pn(Pi,hn,eo)}return hn},array:function(Pi){var hn=Ae(Pi.length);return As(Pi,hn),hn}};function $t(Pi){return Ie==="string"?En(Pi):Ie==="boolean"?!!Pi:Pi}var _i=dr(xe),mi=[],si=0;if(zt)for(var hi=0;hi<zt.length;hi++){var gr=oe[ut[hi]];gr?(si===0&&(si=Me()),mi[hi]=gr(zt[hi])):mi[hi]=zt[hi]}var yi=_i.apply(null,mi);return yi=$t(yi),si!==0&&pe(si),yi}function un(xe,Ie,ut,zt){ut=ut||[];var o=ut.every(function($t){return $t==="number"}),oe=Ie!=="string";return oe&&o&&!zt?dr(xe):function(){return Tn(xe,Ie,ut,arguments)}}var _r=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function ps(xe,Ie,ut){for(var zt=Ie+ut,o=Ie;xe[o]&&!(o>=zt);)++o;if(o-Ie>16&&xe.subarray&&_r)return _r.decode(xe.subarray(Ie,o));for(var oe="";Ie<o;){var $t=xe[Ie++];if(!($t&128)){oe+=String.fromCharCode($t);continue}var _i=xe[Ie++]&63;if(($t&224)==192){oe+=String.fromCharCode(($t&31)<<6|_i);continue}var mi=xe[Ie++]&63;if(($t&240)==224?$t=($t&15)<<12|_i<<6|mi:$t=($t&7)<<18|_i<<12|mi<<6|xe[Ie++]&63,$t<65536)oe+=String.fromCharCode($t);else{var si=$t-65536;oe+=String.fromCharCode(55296|si>>10,56320|si&1023)}}return oe}function En(xe,Ie){return xe?ps(mn,xe,Ie):""}function Ls(xe,Ie,ut,zt){if(!(zt>0))return 0;for(var o=ut,oe=ut+zt-1,$t=0;$t<xe.length;++$t){var _i=xe.charCodeAt($t);if(_i>=55296&&_i<=57343){var mi=xe.charCodeAt(++$t);_i=65536+((_i&1023)<<10)|mi&1023}if(_i<=127){if(ut>=oe)break;Ie[ut++]=_i}else if(_i<=2047){if(ut+1>=oe)break;Ie[ut++]=192|_i>>6,Ie[ut++]=128|_i&63}else if(_i<=65535){if(ut+2>=oe)break;Ie[ut++]=224|_i>>12,Ie[ut++]=128|_i>>6&63,Ie[ut++]=128|_i&63}else{if(ut+3>=oe)break;Ie[ut++]=240|_i>>18,Ie[ut++]=128|_i>>12&63,Ie[ut++]=128|_i>>6&63,Ie[ut++]=128|_i&63}}return Ie[ut]=0,ut-o}function pn(xe,Ie,ut){return Ls(xe,mn,Ie,ut)}typeof TextDecoder<"u"&&new TextDecoder("utf-16le");function As(xe,Ie){fn.set(xe,Ie)}function ct(xe,Ie){return xe%Ie>0&&(xe+=Ie-xe%Ie),xe}var Lt,fn,mn,wi,hr,kn,Dn;function Rs(xe){Lt=xe,te.HEAP8=fn=new Int8Array(xe),te.HEAP16=wi=new Int16Array(xe),te.HEAP32=hr=new Int32Array(xe),te.HEAPU8=mn=new Uint8Array(xe),te.HEAPU16=new Uint16Array(xe),te.HEAPU32=new Uint32Array(xe),te.HEAPF32=kn=new Float32Array(xe),te.HEAPF64=Dn=new Float64Array(xe)}var Ao=5267040,yo=24128,ts=te.TOTAL_MEMORY||33554432;te.buffer?Lt=te.buffer:Lt=new ArrayBuffer(ts),ts=Lt.byteLength,Rs(Lt),hr[yo>>2]=Ao;function Ai(xe){for(;xe.length>0;){var Ie=xe.shift();if(typeof Ie=="function"){Ie();continue}var ut=Ie.func;typeof ut=="number"?Ie.arg===void 0?te.dynCall_v(ut):te.dynCall_vi(ut,Ie.arg):ut(Ie.arg===void 0?null:Ie.arg)}}var jr=[],Pn=[],Js=[],Zn=[];function Pt(){if(te.preRun)for(typeof te.preRun=="function"&&(te.preRun=[te.preRun]);te.preRun.length;)aa(te.preRun.shift());Ai(jr)}function nr(){Ai(Pn)}function _n(){Ai(Js)}function cs(){if(te.postRun)for(typeof te.postRun=="function"&&(te.postRun=[te.postRun]);te.postRun.length;)Yo(te.postRun.shift());Ai(Zn)}function aa(xe){jr.unshift(xe)}function Yo(xe){Zn.unshift(xe)}var Di=Math.abs,Ir=Math.ceil,$s=Math.floor,Cs=Math.min,Zt=0,Ue=null;function He(xe){Zt++,te.monitorRunDependencies&&te.monitorRunDependencies(Zt)}function Be(xe){if(Zt--,te.monitorRunDependencies&&te.monitorRunDependencies(Zt),Zt==0&&Ue){var Ie=Ue;Ue=null,Ie()}}te.preloadedImages={},te.preloadedAudios={};var Rt=null,Qt="data:application/octet-stream;base64,";function ii(xe){return String.prototype.startsWith?xe.startsWith(Qt):xe.indexOf(Qt)===0}var ti,Ht;Rt="data:application/octet-stream;base64,AAAAAAAAAAAAAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAAAQAAAAQAAAADAAAABgAAAAUAAAACAAAAAAAAAAIAAAADAAAAAQAAAAQAAAAGAAAAAAAAAAUAAAADAAAABgAAAAQAAAAFAAAAAAAAAAEAAAACAAAABAAAAAUAAAAGAAAAAAAAAAIAAAADAAAAAQAAAAUAAAACAAAAAAAAAAEAAAADAAAABgAAAAQAAAAGAAAAAAAAAAUAAAACAAAAAQAAAAQAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAIAAAADAAAAAAAAAAAAAAACAAAAAAAAAAEAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAYAAAAAAAAABQAAAAAAAAAAAAAABAAAAAUAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAYAAAAAAAAABgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAIAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAIAAAADAAAABQAAAAYAAAAAAAAAAQAAAAIAAAADAAAABAAAAAYAAAAAAAAAAQAAAAIAAAADAAAABAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAIAAAAAAAAAAAAAAAYAAAAAAAAAAwAAAAIAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAFAAAABAAAAAAAAAABAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAYAAAAAAAAABAAAAAAAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAgAAAAQAAAADAAAACAAAAAEAAAAHAAAABgAAAAkAAAAAAAAAAwAAAAIAAAACAAAABgAAAAoAAAALAAAAAAAAAAEAAAAFAAAAAwAAAA0AAAABAAAABwAAAAQAAAAMAAAAAAAAAAQAAAB/AAAADwAAAAgAAAADAAAAAAAAAAwAAAAFAAAAAgAAABIAAAAKAAAACAAAAAAAAAAQAAAABgAAAA4AAAALAAAAEQAAAAEAAAAJAAAAAgAAAAcAAAAVAAAACQAAABMAAAADAAAADQAAAAEAAAAIAAAABQAAABYAAAAQAAAABAAAAAAAAAAPAAAACQAAABMAAAAOAAAAFAAAAAEAAAAHAAAABgAAAAoAAAALAAAAGAAAABcAAAAFAAAAAgAAABIAAAALAAAAEQAAABcAAAAZAAAAAgAAAAYAAAAKAAAADAAAABwAAAANAAAAGgAAAAQAAAAPAAAAAwAAAA0AAAAaAAAAFQAAAB0AAAADAAAADAAAAAcAAAAOAAAAfwAAABEAAAAbAAAACQAAABQAAAAGAAAADwAAABYAAAAcAAAAHwAAAAQAAAAIAAAADAAAABAAAAASAAAAIQAAAB4AAAAIAAAABQAAABYAAAARAAAACwAAAA4AAAAGAAAAIwAAABkAAAAbAAAAEgAAABgAAAAeAAAAIAAAAAUAAAAKAAAAEAAAABMAAAAiAAAAFAAAACQAAAAHAAAAFQAAAAkAAAAUAAAADgAAABMAAAAJAAAAKAAAABsAAAAkAAAAFQAAACYAAAATAAAAIgAAAA0AAAAdAAAABwAAABYAAAAQAAAAKQAAACEAAAAPAAAACAAAAB8AAAAXAAAAGAAAAAsAAAAKAAAAJwAAACUAAAAZAAAAGAAAAH8AAAAgAAAAJQAAAAoAAAAXAAAAEgAAABkAAAAXAAAAEQAAAAsAAAAtAAAAJwAAACMAAAAaAAAAKgAAAB0AAAArAAAADAAAABwAAAANAAAAGwAAACgAAAAjAAAALgAAAA4AAAAUAAAAEQAAABwAAAAfAAAAKgAAACwAAAAMAAAADwAAABoAAAAdAAAAKwAAACYAAAAvAAAADQAAABoAAAAVAAAAHgAAACAAAAAwAAAAMgAAABAAAAASAAAAIQAAAB8AAAApAAAALAAAADUAAAAPAAAAFgAAABwAAAAgAAAAHgAAABgAAAASAAAANAAAADIAAAAlAAAAIQAAAB4AAAAxAAAAMAAAABYAAAAQAAAAKQAAACIAAAATAAAAJgAAABUAAAA2AAAAJAAAADMAAAAjAAAALgAAAC0AAAA4AAAAEQAAABsAAAAZAAAAJAAAABQAAAAiAAAAEwAAADcAAAAoAAAANgAAACUAAAAnAAAANAAAADkAAAAYAAAAFwAAACAAAAAmAAAAfwAAACIAAAAzAAAAHQAAAC8AAAAVAAAAJwAAACUAAAAZAAAAFwAAADsAAAA5AAAALQAAACgAAAAbAAAAJAAAABQAAAA8AAAALgAAADcAAAApAAAAMQAAADUAAAA9AAAAFgAAACEAAAAfAAAAKgAAADoAAAArAAAAPgAAABwAAAAsAAAAGgAAACsAAAA+AAAALwAAAEAAAAAaAAAAKgAAAB0AAAAsAAAANQAAADoAAABBAAAAHAAAAB8AAAAqAAAALQAAACcAAAAjAAAAGQAAAD8AAAA7AAAAOAAAAC4AAAA8AAAAOAAAAEQAAAAbAAAAKAAAACMAAAAvAAAAJgAAACsAAAAdAAAARQAAADMAAABAAAAAMAAAADEAAAAeAAAAIQAAAEMAAABCAAAAMgAAADEAAAB/AAAAPQAAAEIAAAAhAAAAMAAAACkAAAAyAAAAMAAAACAAAAAeAAAARgAAAEMAAAA0AAAAMwAAAEUAAAA2AAAARwAAACYAAAAvAAAAIgAAADQAAAA5AAAARgAAAEoAAAAgAAAAJQAAADIAAAA1AAAAPQAAAEEAAABLAAAAHwAAACkAAAAsAAAANgAAAEcAAAA3AAAASQAAACIAAAAzAAAAJAAAADcAAAAoAAAANgAAACQAAABIAAAAPAAAAEkAAAA4AAAARAAAAD8AAABNAAAAIwAAAC4AAAAtAAAAOQAAADsAAABKAAAATgAAACUAAAAnAAAANAAAADoAAAB/AAAAPgAAAEwAAAAsAAAAQQAAACoAAAA7AAAAPwAAAE4AAABPAAAAJwAAAC0AAAA5AAAAPAAAAEgAAABEAAAAUAAAACgAAAA3AAAALgAAAD0AAAA1AAAAMQAAACkAAABRAAAASwAAAEIAAAA+AAAAKwAAADoAAAAqAAAAUgAAAEAAAABMAAAAPwAAAH8AAAA4AAAALQAAAE8AAAA7AAAATQAAAEAAAAAvAAAAPgAAACsAAABUAAAARQAAAFIAAABBAAAAOgAAADUAAAAsAAAAVgAAAEwAAABLAAAAQgAAAEMAAABRAAAAVQAAADEAAAAwAAAAPQAAAEMAAABCAAAAMgAAADAAAABXAAAAVQAAAEYAAABEAAAAOAAAADwAAAAuAAAAWgAAAE0AAABQAAAARQAAADMAAABAAAAALwAAAFkAAABHAAAAVAAAAEYAAABDAAAANAAAADIAAABTAAAAVwAAAEoAAABHAAAAWQAAAEkAAABbAAAAMwAAAEUAAAA2AAAASAAAAH8AAABJAAAANwAAAFAAAAA8AAAAWAAAAEkAAABbAAAASAAAAFgAAAA2AAAARwAAADcAAABKAAAATgAAAFMAAABcAAAANAAAADkAAABGAAAASwAAAEEAAAA9AAAANQAAAF4AAABWAAAAUQAAAEwAAABWAAAAUgAAAGAAAAA6AAAAQQAAAD4AAABNAAAAPwAAAEQAAAA4AAAAXQAAAE8AAABaAAAATgAAAEoAAAA7AAAAOQAAAF8AAABcAAAATwAAAE8AAABOAAAAPwAAADsAAABdAAAAXwAAAE0AAABQAAAARAAAAEgAAAA8AAAAYwAAAFoAAABYAAAAUQAAAFUAAABeAAAAZQAAAD0AAABCAAAASwAAAFIAAABgAAAAVAAAAGIAAAA+AAAATAAAAEAAAABTAAAAfwAAAEoAAABGAAAAZAAAAFcAAABcAAAAVAAAAEUAAABSAAAAQAAAAGEAAABZAAAAYgAAAFUAAABXAAAAZQAAAGYAAABCAAAAQwAAAFEAAABWAAAATAAAAEsAAABBAAAAaAAAAGAAAABeAAAAVwAAAFMAAABmAAAAZAAAAEMAAABGAAAAVQAAAFgAAABIAAAAWwAAAEkAAABjAAAAUAAAAGkAAABZAAAAYQAAAFsAAABnAAAARQAAAFQAAABHAAAAWgAAAE0AAABQAAAARAAAAGoAAABdAAAAYwAAAFsAAABJAAAAWQAAAEcAAABpAAAAWAAAAGcAAABcAAAAUwAAAE4AAABKAAAAbAAAAGQAAABfAAAAXQAAAE8AAABaAAAATQAAAG0AAABfAAAAagAAAF4AAABWAAAAUQAAAEsAAABrAAAAaAAAAGUAAABfAAAAXAAAAE8AAABOAAAAbQAAAGwAAABdAAAAYAAAAGgAAABiAAAAbgAAAEwAAABWAAAAUgAAAGEAAAB/AAAAYgAAAFQAAABnAAAAWQAAAG8AAABiAAAAbgAAAGEAAABvAAAAUgAAAGAAAABUAAAAYwAAAFAAAABpAAAAWAAAAGoAAABaAAAAcQAAAGQAAABmAAAAUwAAAFcAAABsAAAAcgAAAFwAAABlAAAAZgAAAGsAAABwAAAAUQAAAFUAAABeAAAAZgAAAGUAAABXAAAAVQAAAHIAAABwAAAAZAAAAGcAAABbAAAAYQAAAFkAAAB0AAAAaQAAAG8AAABoAAAAawAAAG4AAABzAAAAVgAAAF4AAABgAAAAaQAAAFgAAABnAAAAWwAAAHEAAABjAAAAdAAAAGoAAABdAAAAYwAAAFoAAAB1AAAAbQAAAHEAAABrAAAAfwAAAGUAAABeAAAAcwAAAGgAAABwAAAAbAAAAGQAAABfAAAAXAAAAHYAAAByAAAAbQAAAG0AAABsAAAAXQAAAF8AAAB1AAAAdgAAAGoAAABuAAAAYgAAAGgAAABgAAAAdwAAAG8AAABzAAAAbwAAAGEAAABuAAAAYgAAAHQAAABnAAAAdwAAAHAAAABrAAAAZgAAAGUAAAB4AAAAcwAAAHIAAABxAAAAYwAAAHQAAABpAAAAdQAAAGoAAAB5AAAAcgAAAHAAAABkAAAAZgAAAHYAAAB4AAAAbAAAAHMAAABuAAAAawAAAGgAAAB4AAAAdwAAAHAAAAB0AAAAZwAAAHcAAABvAAAAcQAAAGkAAAB5AAAAdQAAAH8AAABtAAAAdgAAAHEAAAB5AAAAagAAAHYAAAB4AAAAbAAAAHIAAAB1AAAAeQAAAG0AAAB3AAAAbwAAAHMAAABuAAAAeQAAAHQAAAB4AAAAeAAAAHMAAAByAAAAcAAAAHkAAAB3AAAAdgAAAHkAAAB0AAAAeAAAAHcAAAB1AAAAcQAAAHYAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAABAAAABQAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAACAAAABQAAAAEAAAAAAAAA/////wEAAAAAAAAAAwAAAAQAAAACAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAFAAAAAQAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAAAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAADAAAABQAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAEAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAAAAAABAAAAAwAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAUAAAABAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAABAAAAAUAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAIAAAAFAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAD/////AQAAAAAAAAADAAAABAAAAAIAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAUAAAABAAAAAAAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAEAAAD//////////wEAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAACAAAAAAAAAAAAAAABAAAAAgAAAAYAAAAEAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAcAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAKAAAAAgAAAAAAAAAAAAAAAQAAAAEAAAAFAAAABgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAACAAAAAAAAAAAAAAABAAAAAwAAAAcAAAAGAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABwAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAADgAAAAIAAAAAAAAAAAAAAAEAAAAAAAAACQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAMAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAIAAAAAAAAAAAAAAAEAAAAEAAAACAAAAAoAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAALAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAACQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAgAAAAAAAAAAAAAAAQAAAAsAAAAPAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAIAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAgAAAAAAAAAAAAAAAQAAAAwAAAAQAAAADAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAoAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAPAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAADwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAACAAAAAAAAAAAAAAABAAAACgAAABMAAAAIAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAQAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAACQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAIAAAAAAAAAAAAAAAEAAAANAAAAEQAAAA0AAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAARAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA0AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAACAAAAAAAAAAAAAAABAAAADgAAABIAAAAPAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAADwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABIAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAATAAAAAgAAAAAAAAAAAAAAAQAAAP//////////EwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAASAAAAAAAAABgAAAAAAAAAIQAAAAAAAAAeAAAAAAAAACAAAAADAAAAMQAAAAEAAAAwAAAAAwAAADIAAAADAAAACAAAAAAAAAAFAAAABQAAAAoAAAAFAAAAFgAAAAAAAAAQAAAAAAAAABIAAAAAAAAAKQAAAAEAAAAhAAAAAAAAAB4AAAAAAAAABAAAAAAAAAAAAAAABQAAAAIAAAAFAAAADwAAAAEAAAAIAAAAAAAAAAUAAAAFAAAAHwAAAAEAAAAWAAAAAAAAABAAAAAAAAAAAgAAAAAAAAAGAAAAAAAAAA4AAAAAAAAACgAAAAAAAAALAAAAAAAAABEAAAADAAAAGAAAAAEAAAAXAAAAAwAAABkAAAADAAAAAAAAAAAAAAABAAAABQAAAAkAAAAFAAAABQAAAAAAAAACAAAAAAAAAAYAAAAAAAAAEgAAAAEAAAAKAAAAAAAAAAsAAAAAAAAABAAAAAEAAAADAAAABQAAAAcAAAAFAAAACAAAAAEAAAAAAAAAAAAAAAEAAAAFAAAAEAAAAAEAAAAFAAAAAAAAAAIAAAAAAAAABwAAAAAAAAAVAAAAAAAAACYAAAAAAAAACQAAAAAAAAATAAAAAAAAACIAAAADAAAADgAAAAEAAAAUAAAAAwAAACQAAAADAAAAAwAAAAAAAAANAAAABQAAAB0AAAAFAAAAAQAAAAAAAAAHAAAAAAAAABUAAAAAAAAABgAAAAEAAAAJAAAAAAAAABMAAAAAAAAABAAAAAIAAAAMAAAABQAAABoAAAAFAAAAAAAAAAEAAAADAAAAAAAAAA0AAAAFAAAAAgAAAAEAAAABAAAAAAAAAAcAAAAAAAAAGgAAAAAAAAAqAAAAAAAAADoAAAAAAAAAHQAAAAAAAAArAAAAAAAAAD4AAAADAAAAJgAAAAEAAAAvAAAAAwAAAEAAAAADAAAADAAAAAAAAAAcAAAABQAAACwAAAAFAAAADQAAAAAAAAAaAAAAAAAAACoAAAAAAAAAFQAAAAEAAAAdAAAAAAAAACsAAAAAAAAABAAAAAMAAAAPAAAABQAAAB8AAAAFAAAAAwAAAAEAAAAMAAAAAAAAABwAAAAFAAAABwAAAAEAAAANAAAAAAAAABoAAAAAAAAAHwAAAAAAAAApAAAAAAAAADEAAAAAAAAALAAAAAAAAAA1AAAAAAAAAD0AAAADAAAAOgAAAAEAAABBAAAAAwAAAEsAAAADAAAADwAAAAAAAAAWAAAABQAAACEAAAAFAAAAHAAAAAAAAAAfAAAAAAAAACkAAAAAAAAAKgAAAAEAAAAsAAAAAAAAADUAAAAAAAAABAAAAAQAAAAIAAAABQAAABAAAAAFAAAADAAAAAEAAAAPAAAAAAAAABYAAAAFAAAAGgAAAAEAAAAcAAAAAAAAAB8AAAAAAAAAMgAAAAAAAAAwAAAAAAAAADEAAAADAAAAIAAAAAAAAAAeAAAAAwAAACEAAAADAAAAGAAAAAMAAAASAAAAAwAAABAAAAADAAAARgAAAAAAAABDAAAAAAAAAEIAAAADAAAANAAAAAMAAAAyAAAAAAAAADAAAAAAAAAAJQAAAAMAAAAgAAAAAAAAAB4AAAADAAAAUwAAAAAAAABXAAAAAwAAAFUAAAADAAAASgAAAAMAAABGAAAAAAAAAEMAAAAAAAAAOQAAAAEAAAA0AAAAAwAAADIAAAAAAAAAGQAAAAAAAAAXAAAAAAAAABgAAAADAAAAEQAAAAAAAAALAAAAAwAAAAoAAAADAAAADgAAAAMAAAAGAAAAAwAAAAIAAAADAAAALQAAAAAAAAAnAAAAAAAAACUAAAADAAAAIwAAAAMAAAAZAAAAAAAAABcAAAAAAAAAGwAAAAMAAAARAAAAAAAAAAsAAAADAAAAPwAAAAAAAAA7AAAAAwAAADkAAAADAAAAOAAAAAMAAAAtAAAAAAAAACcAAAAAAAAALgAAAAMAAAAjAAAAAwAAABkAAAAAAAAAJAAAAAAAAAAUAAAAAAAAAA4AAAADAAAAIgAAAAAAAAATAAAAAwAAAAkAAAADAAAAJgAAAAMAAAAVAAAAAwAAAAcAAAADAAAANwAAAAAAAAAoAAAAAAAAABsAAAADAAAANgAAAAMAAAAkAAAAAAAAABQAAAAAAAAAMwAAAAMAAAAiAAAAAAAAABMAAAADAAAASAAAAAAAAAA8AAAAAwAAAC4AAAADAAAASQAAAAMAAAA3AAAAAAAAACgAAAAAAAAARwAAAAMAAAA2AAAAAwAAACQAAAAAAAAAQAAAAAAAAAAvAAAAAAAAACYAAAADAAAAPgAAAAAAAAArAAAAAwAAAB0AAAADAAAAOgAAAAMAAAAqAAAAAwAAABoAAAADAAAAVAAAAAAAAABFAAAAAAAAADMAAAADAAAAUgAAAAMAAABAAAAAAAAAAC8AAAAAAAAATAAAAAMAAAA+AAAAAAAAACsAAAADAAAAYQAAAAAAAABZAAAAAwAAAEcAAAADAAAAYgAAAAMAAABUAAAAAAAAAEUAAAAAAAAAYAAAAAMAAABSAAAAAwAAAEAAAAAAAAAASwAAAAAAAABBAAAAAAAAADoAAAADAAAAPQAAAAAAAAA1AAAAAwAAACwAAAADAAAAMQAAAAMAAAApAAAAAwAAAB8AAAADAAAAXgAAAAAAAABWAAAAAAAAAEwAAAADAAAAUQAAAAMAAABLAAAAAAAAAEEAAAAAAAAAQgAAAAMAAAA9AAAAAAAAADUAAAADAAAAawAAAAAAAABoAAAAAwAAAGAAAAADAAAAZQAAAAMAAABeAAAAAAAAAFYAAAAAAAAAVQAAAAMAAABRAAAAAwAAAEsAAAAAAAAAOQAAAAAAAAA7AAAAAAAAAD8AAAADAAAASgAAAAAAAABOAAAAAwAAAE8AAAADAAAAUwAAAAMAAABcAAAAAwAAAF8AAAADAAAAJQAAAAAAAAAnAAAAAwAAAC0AAAADAAAANAAAAAAAAAA5AAAAAAAAADsAAAAAAAAARgAAAAMAAABKAAAAAAAAAE4AAAADAAAAGAAAAAAAAAAXAAAAAwAAABkAAAADAAAAIAAAAAMAAAAlAAAAAAAAACcAAAADAAAAMgAAAAMAAAA0AAAAAAAAADkAAAAAAAAALgAAAAAAAAA8AAAAAAAAAEgAAAADAAAAOAAAAAAAAABEAAAAAwAAAFAAAAADAAAAPwAAAAMAAABNAAAAAwAAAFoAAAADAAAAGwAAAAAAAAAoAAAAAwAAADcAAAADAAAAIwAAAAAAAAAuAAAAAAAAADwAAAAAAAAALQAAAAMAAAA4AAAAAAAAAEQAAAADAAAADgAAAAAAAAAUAAAAAwAAACQAAAADAAAAEQAAAAMAAAAbAAAAAAAAACgAAAADAAAAGQAAAAMAAAAjAAAAAAAAAC4AAAAAAAAARwAAAAAAAABZAAAAAAAAAGEAAAADAAAASQAAAAAAAABbAAAAAwAAAGcAAAADAAAASAAAAAMAAABYAAAAAwAAAGkAAAADAAAAMwAAAAAAAABFAAAAAwAAAFQAAAADAAAANgAAAAAAAABHAAAAAAAAAFkAAAAAAAAANwAAAAMAAABJAAAAAAAAAFsAAAADAAAAJgAAAAAAAAAvAAAAAwAAAEAAAAADAAAAIgAAAAMAAAAzAAAAAAAAAEUAAAADAAAAJAAAAAMAAAA2AAAAAAAAAEcAAAAAAAAAYAAAAAAAAABoAAAAAAAAAGsAAAADAAAAYgAAAAAAAABuAAAAAwAAAHMAAAADAAAAYQAAAAMAAABvAAAAAwAAAHcAAAADAAAATAAAAAAAAABWAAAAAwAAAF4AAAADAAAAUgAAAAAAAABgAAAAAAAAAGgAAAAAAAAAVAAAAAMAAABiAAAAAAAAAG4AAAADAAAAOgAAAAAAAABBAAAAAwAAAEsAAAADAAAAPgAAAAMAAABMAAAAAAAAAFYAAAADAAAAQAAAAAMAAABSAAAAAAAAAGAAAAAAAAAAVQAAAAAAAABXAAAAAAAAAFMAAAADAAAAZQAAAAAAAABmAAAAAwAAAGQAAAADAAAAawAAAAMAAABwAAAAAwAAAHIAAAADAAAAQgAAAAAAAABDAAAAAwAAAEYAAAADAAAAUQAAAAAAAABVAAAAAAAAAFcAAAAAAAAAXgAAAAMAAABlAAAAAAAAAGYAAAADAAAAMQAAAAAAAAAwAAAAAwAAADIAAAADAAAAPQAAAAMAAABCAAAAAAAAAEMAAAADAAAASwAAAAMAAABRAAAAAAAAAFUAAAAAAAAAXwAAAAAAAABcAAAAAAAAAFMAAAAAAAAATwAAAAAAAABOAAAAAAAAAEoAAAADAAAAPwAAAAEAAAA7AAAAAwAAADkAAAADAAAAbQAAAAAAAABsAAAAAAAAAGQAAAAFAAAAXQAAAAEAAABfAAAAAAAAAFwAAAAAAAAATQAAAAEAAABPAAAAAAAAAE4AAAAAAAAAdQAAAAQAAAB2AAAABQAAAHIAAAAFAAAAagAAAAEAAABtAAAAAAAAAGwAAAAAAAAAWgAAAAEAAABdAAAAAQAAAF8AAAAAAAAAWgAAAAAAAABNAAAAAAAAAD8AAAAAAAAAUAAAAAAAAABEAAAAAAAAADgAAAADAAAASAAAAAEAAAA8AAAAAwAAAC4AAAADAAAAagAAAAAAAABdAAAAAAAAAE8AAAAFAAAAYwAAAAEAAABaAAAAAAAAAE0AAAAAAAAAWAAAAAEAAABQAAAAAAAAAEQAAAAAAAAAdQAAAAMAAABtAAAABQAAAF8AAAAFAAAAcQAAAAEAAABqAAAAAAAAAF0AAAAAAAAAaQAAAAEAAABjAAAAAQAAAFoAAAAAAAAAaQAAAAAAAABYAAAAAAAAAEgAAAAAAAAAZwAAAAAAAABbAAAAAAAAAEkAAAADAAAAYQAAAAEAAABZAAAAAwAAAEcAAAADAAAAcQAAAAAAAABjAAAAAAAAAFAAAAAFAAAAdAAAAAEAAABpAAAAAAAAAFgAAAAAAAAAbwAAAAEAAABnAAAAAAAAAFsAAAAAAAAAdQAAAAIAAABqAAAABQAAAFoAAAAFAAAAeQAAAAEAAABxAAAAAAAAAGMAAAAAAAAAdwAAAAEAAAB0AAAAAQAAAGkAAAAAAAAAdwAAAAAAAABvAAAAAAAAAGEAAAAAAAAAcwAAAAAAAABuAAAAAAAAAGIAAAADAAAAawAAAAEAAABoAAAAAwAAAGAAAAADAAAAeQAAAAAAAAB0AAAAAAAAAGcAAAAFAAAAeAAAAAEAAAB3AAAAAAAAAG8AAAAAAAAAcAAAAAEAAABzAAAAAAAAAG4AAAAAAAAAdQAAAAEAAABxAAAABQAAAGkAAAAFAAAAdgAAAAEAAAB5AAAAAAAAAHQAAAAAAAAAcgAAAAEAAAB4AAAAAQAAAHcAAAAAAAAAcgAAAAAAAABwAAAAAAAAAGsAAAAAAAAAZAAAAAAAAABmAAAAAAAAAGUAAAADAAAAUwAAAAEAAABXAAAAAwAAAFUAAAADAAAAdgAAAAAAAAB4AAAAAAAAAHMAAAAFAAAAbAAAAAEAAAByAAAAAAAAAHAAAAAAAAAAXAAAAAEAAABkAAAAAAAAAGYAAAAAAAAAdQAAAAAAAAB5AAAABQAAAHcAAAAFAAAAbQAAAAEAAAB2AAAAAAAAAHgAAAAAAAAAXwAAAAEAAABsAAAAAQAAAHIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAGAAAAAgAAAAUAAAABAAAABAAAAAAAAAAAAAAABQAAAAMAAAABAAAABgAAAAQAAAACAAAAAAAAAH6iBfbytuk/Gq6akm/58z/Xrm0Liez0P5doSdOpSwRAWs602ULg8D/dT7Rcbo/1v1N1RQHFNOM/g9Snx7HW3L8HWsP8Q3jfP6VwOLosutk/9rjk1YQcxj+gnmKMsNn6P/HDeuPFY+M/YHwDjqKhB0Ci19/fCVrbP4UxKkDWOP6/pvljWa09tL9wi7wrQXjnv/Z6yLImkM2/3yTlOzY14D+m+WNZrT20PzwKVQnrQwNA9nrIsiaQzT/g40rFrRQFwPa45NWEHMa/kbslHEZq97/xw3rjxWPjv4cLC2SMBci/otff3wla27+rKF5oIAv0P1N1RQHFNOO/iDJPGyWHBUAHWsP8Q3jfvwQf/by16gXAfqIF9vK26b8XrO0Vh0r+v9eubQuJ7PS/BxLrA0ZZ479azrTZQuDwv1MK1EuItPw/yscgV9Z6FkAwHBR2WjQMQJNRzXsQ5vY/GlUHVJYKF0DONuFv2lMNQNCGZ28QJfk/0WUwoIL36D8ggDOMQuATQNqMOeAy/wZAWFYOYM+M2z/LWC4uH3oSQDE+LyTsMgRAkJzhRGWFGEDd4soovCQQQKqk0DJMEP8/rGmNdwOLBUAW2X/9xCbjP4hu3dcqJhNAzuYItRvdB0CgzW3zJW/sPxotm/Y2TxRAQAk9XmdDDEC1Kx9MKgT3P1M+NctcghZAFVqcLlb0C0Bgzd3sB2b2P77mZDPUWhZAFROHJpUGCEDAfma5CxXtPz1DWq/zYxRAmhYY5824F0DOuQKWSbAOQNCMqrvu3fs/L6DR22K2wT9nAAxPBU8RQGiN6mW43AFAZhu25b633D8c1YgmzowSQNM25BRKWARArGS08/lNxD+LFssHwmMRQLC5aNcxBgJABL9HT0WRF0CjCmJmOGEOQHsuaVzMP/s/TWJCaGGwBUCeu1PAPLzjP9nqN9DZOBNAKE4JcydbCkCGtbd1qjPzP8dgm9U8jhVAtPeKTkVwDkCeCLss5l37P401XMPLmBdAFd29VMVQDUBg0yA55h75Pz6odcYLCRdApBM4rBrkAkDyAVWgQxbRP4XDMnK20hFAymLlF7EmzD8GUgo9XBHlP3lbK7T9COc/k+OhPthhy7+YGEpnrOvCPzBFhLs15u4/epbqB6H4uz9IuuLF5svev6lzLKY31es/CaQ0envF5z8ZY0xlUADXv7zaz7HYEuI/CfbK1sn16T8uAQfWwxLWPzKn/YuFN94/5KdbC1AFu793fyCSnlfvPzK2y4doAMY/NRg5t1/X6b/shq4QJaHDP5yNIAKPOeI/vpn7BSE30r/X4YQrO6nrv78Ziv/Thto/DqJ1Y6+y5z9l51NaxFrlv8QlA65HOLS/86dxiEc96z+Hj0+LFjneP6LzBZ8LTc2/DaJ1Y6+y579l51NaxFrlP8QlA65HOLQ/8qdxiEc967+Jj0+LFjnev6LzBZ8LTc0/1qdbC1AFuz93fyCSnlfvvzK2y4doAMa/NRg5t1/X6T/vhq4QJaHDv5yNIAKPOeK/wJn7BSE30j/W4YQrO6nrP78Ziv/Thtq/CaQ0envF578XY0xlUADXP7zaz7HYEuK/CvbK1sn16b8rAQfWwxLWvzKn/YuFN96/zWLlF7EmzL8GUgo9XBHlv3lbK7T9COe/kOOhPthhyz+cGEpnrOvCvzBFhLs15u6/c5bqB6H4u79IuuLF5sveP6lzLKY31eu/AQAAAP////8HAAAA/////zEAAAD/////VwEAAP////9hCQAA/////6dBAAD/////kcsBAP/////3kAwA/////8H2VwAAAAAAAAAAAAAAAAACAAAA/////w4AAAD/////YgAAAP////+uAgAA/////8ISAAD/////ToMAAP////8ilwMA/////+4hGQD/////gu2vAAAAAAAAAAAAAAAAAAAAAAACAAAA//////////8BAAAAAwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////AgAAAP//////////AQAAAAAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD/////////////////////AQAAAP///////////////wIAAAD///////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP///////////////////////////////wIAAAD///////////////8BAAAA/////////////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAABAAAA//////////8CAAAA//////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAAAQAAAP//////////AgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAACAAAAAAAAAAIAAAABAAAAAQAAAAIAAAACAAAAAAAAAAUAAAAFAAAAAAAAAAIAAAACAAAAAwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAgAAAAEAAAACAAAAAgAAAAIAAAAAAAAABQAAAAYAAAAAAAAAAgAAAAIAAAADAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAAAAAACAAAAAQAAAAMAAAACAAAAAgAAAAAAAAAFAAAABwAAAAAAAAACAAAAAgAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAACAAAAAAAAAAIAAAABAAAABAAAAAIAAAACAAAAAAAAAAUAAAAIAAAAAAAAAAIAAAACAAAAAwAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAIAAAAAAAAAAgAAAAEAAAAAAAAAAgAAAAIAAAAAAAAABQAAAAkAAAAAAAAAAgAAAAIAAAADAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAgAAAAIAAAAAAAAAAwAAAA4AAAACAAAAAAAAAAIAAAADAAAAAAAAAAAAAAACAAAAAgAAAAMAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAACAAAAAgAAAAAAAAADAAAACgAAAAIAAAAAAAAAAgAAAAMAAAABAAAAAAAAAAIAAAACAAAAAwAAAAcAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAIAAAACAAAAAAAAAAMAAAALAAAAAgAAAAAAAAACAAAAAwAAAAIAAAAAAAAAAgAAAAIAAAADAAAACAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAgAAAAIAAAAAAAAAAwAAAAwAAAACAAAAAAAAAAIAAAADAAAAAwAAAAAAAAACAAAAAgAAAAMAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAACAAAAAgAAAAAAAAADAAAADQAAAAIAAAAAAAAAAgAAAAMAAAAEAAAAAAAAAAIAAAACAAAAAwAAAAoAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAIAAAACAAAAAAAAAAMAAAAGAAAAAgAAAAAAAAACAAAAAwAAAA8AAAAAAAAAAgAAAAIAAAADAAAACwAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAgAAAAIAAAAAAAAAAwAAAAcAAAACAAAAAAAAAAIAAAADAAAAEAAAAAAAAAACAAAAAgAAAAMAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAcAAAACAAAAAgAAAAAAAAADAAAACAAAAAIAAAAAAAAAAgAAAAMAAAARAAAAAAAAAAIAAAACAAAAAwAAAA0AAAAAAAAAAAAAAAAAAAAAAAAACAAAAAIAAAACAAAAAAAAAAMAAAAJAAAAAgAAAAAAAAACAAAAAwAAABIAAAAAAAAAAgAAAAIAAAADAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAgAAAAIAAAAAAAAAAwAAAAUAAAACAAAAAAAAAAIAAAADAAAAEwAAAAAAAAACAAAAAgAAAAMAAAAPAAAAAAAAAAAAAAAAAAAAAAAAABAAAAACAAAAAAAAAAIAAAABAAAAEwAAAAIAAAACAAAAAAAAAAUAAAAKAAAAAAAAAAIAAAACAAAAAwAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEQAAAAIAAAAAAAAAAgAAAAEAAAAPAAAAAgAAAAIAAAAAAAAABQAAAAsAAAAAAAAAAgAAAAIAAAADAAAAEQAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAgAAAAAAAAACAAAAAQAAABAAAAACAAAAAgAAAAAAAAAFAAAADAAAAAAAAAACAAAAAgAAAAMAAAASAAAAAAAAAAAAAAAAAAAAAAAAABMAAAACAAAAAAAAAAIAAAABAAAAEQAAAAIAAAACAAAAAAAAAAUAAAANAAAAAAAAAAIAAAACAAAAAwAAABMAAAAAAAAAAAAAAAAAAAAAAAAADwAAAAIAAAAAAAAAAgAAAAEAAAASAAAAAgAAAAIAAAAAAAAABQAAAA4AAAAAAAAAAgAAAAIAAAADAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAAAAAAAAAAAAAIAAAABAAAAAAAAAAEAAAACAAAAAQAAAAAAAAACAAAAAAAAAAUAAAAEAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAQAAAAAAAAABQAAAAAAAAACAAAAAQAAAAAAAAABAAAAAgAAAAAAAAAAAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAABAAAAAAAAAAIAAAACAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAAEAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAQAAAAAAAAABQAAAAUAAAAAAAAAAQAAAAAAAAAAAAAAOgehWlKfUEEz1zLi+JsiQa2og3wcMfVAWCbHorc0yEDi+Yn/Y6mbQJ11/mfsnG9At6bnG4UQQkBvMCQWKqUUQJVmwwswmOc/3hVgVBL3uj//qqOEOdGOPw/WDN4gnGE/H3ANkCUgND+AA8btKgAHPwTXBqJVSdo+XfRQAqsKrj4fc+zLYbSPQklEmCZHv2FCUP+uDso1NEKYtPhwphUHQptxnyFXYdpB7CddZAMmrkGAt1AxSTqBQUibBVdTsFNBSuX3MV+AJkFocv82SLf5QAqmgj7AY81A23VDSEnLoEDGEJVSeDFzQDYrqvBk70VA8U157pcRGUBWfEF+ZKbsP7KBdLHZTpFAqKYk69AqekDbeGY41MdjQD8AZzHK501A1vcrrjubNkD5LnquvBYhQCbiRRD71QlAqt72EbOH8z8Eu+jL1YbdP4uaox/xUcY/abedg1XfsD+BsUdzJ4KZP5wE9YFySIM/rW1kAKMpbT+rZFthVRhWPy4PKlXIs0A/qMZLlwDnMEHByqEF0I0ZQQYSFD8lUQNBPpY+dFs07UAH8BZImBPWQN9RY0I0sMBA2T7kLfc6qUByFYvfhBKTQMq+0Mis1XxA0XQbeQXMZUBJJ5aEGXpQQP7/SY0a6ThAaMD92b/UIkAs8s8yqXoMQNIegOvCk/U/aOi7NZJP4D8AAAAA/////wAAAAAAAAAAAAAAAAAAAAAAAAAA/////////////////////////////////////wAAAAD/////AAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAA/////wAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAP////8AAAAABQAAAAAAAAAAAAAAAAAAAAAAAAD/////BQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAA/////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP////////////////////////////////////8AAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/////////////////////////////////////AAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAABQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/////////////////////////////////////wAAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAQAAAAAAAAABAAAAAAAAAAUAAAABAAAAAQAAAAAAAAAAAAAAAQAAAAEAAAAAAAAAAQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAEAAQAAAQEAAAAAAAEAAAABAAAAAQABAAAAAAAAAAAAAAAAAAAAAAcAAAAHAAAAAQAAAAIAAAAEAAAAAwAAAAAAAAAAAAAABwAAAAMAAAABAAAAAgAAAAUAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAAAAAACAAAAAQAAAAMAAAAOAAAABgAAAAsAAAACAAAABwAAAAEAAAAYAAAABQAAAAoAAAABAAAABgAAAAAAAAAmAAAABwAAAAwAAAADAAAACAAAAAIAAAAxAAAACQAAAA4AAAAAAAAABQAAAAQAAAA6AAAACAAAAA0AAAAEAAAACQAAAAMAAAA/AAAACwAAAAYAAAAPAAAACgAAABAAAABIAAAADAAAAAcAAAAQAAAACwAAABEAAABTAAAACgAAAAUAAAATAAAADgAAAA8AAABhAAAADQAAAAgAAAARAAAADAAAABIAAABrAAAADgAAAAkAAAASAAAADQAAABMAAAB1AAAADwAAABMAAAARAAAAEgAAABAAAAAGAAAAAgAAAAMAAAAFAAAABAAAAAAAAAAAAAAAAAAAAAYAAAACAAAAAwAAAAEAAAAFAAAABAAAAAAAAAAAAAAABwAAAAUAAAADAAAABAAAAAEAAAAAAAAAAgAAAAAAAAACAAAAAwAAAAEAAAAFAAAABAAAAAYAAAAAAAAAAAAAAGFsZ29zLmMAaDNOZWlnaGJvclJvdGF0aW9ucwBjb29yZGlqay5jAF91cEFwN0NoZWNrZWQAX3VwQXA3ckNoZWNrZWQAZGlyZWN0ZWRFZGdlLmMAZGlyZWN0ZWRFZGdlVG9Cb3VuZGFyeQBhZGphY2VudEZhY2VEaXJbdG1wRmlqay5mYWNlXVtmaWprLmZhY2VdID09IEtJAGZhY2VpamsuYwBfZmFjZUlqa1BlbnRUb0NlbGxCb3VuZGFyeQBhZGphY2VudEZhY2VEaXJbY2VudGVySUpLLmZhY2VdW2ZhY2UyXSA9PSBLSQBfZmFjZUlqa1RvQ2VsbEJvdW5kYXJ5AGgzSW5kZXguYwBjb21wYWN0Q2VsbHMAbGF0TG5nVG9DZWxsAGNlbGxUb0NoaWxkUG9zAHZhbGlkYXRlQ2hpbGRQb3MAbGF0TG5nLmMAY2VsbEFyZWFSYWRzMgBwb2x5Z29uLT5uZXh0ID09IE5VTEwAbGlua2VkR2VvLmMAYWRkTmV3TGlua2VkUG9seWdvbgBuZXh0ICE9IE5VTEwAbG9vcCAhPSBOVUxMAGFkZE5ld0xpbmtlZExvb3AAcG9seWdvbi0+Zmlyc3QgPT0gTlVMTABhZGRMaW5rZWRMb29wAGNvb3JkICE9IE5VTEwAYWRkTGlua2VkQ29vcmQAbG9vcC0+Zmlyc3QgPT0gTlVMTABpbm5lckxvb3BzICE9IE5VTEwAbm9ybWFsaXplTXVsdGlQb2x5Z29uAGJib3hlcyAhPSBOVUxMAGNhbmRpZGF0ZXMgIT0gTlVMTABmaW5kUG9seWdvbkZvckhvbGUAY2FuZGlkYXRlQkJveGVzICE9IE5VTEwAcmV2RGlyICE9IElOVkFMSURfRElHSVQAbG9jYWxpai5jAGNlbGxUb0xvY2FsSWprAGJhc2VDZWxsICE9IG9yaWdpbkJhc2VDZWxsACEob3JpZ2luT25QZW50ICYmIGluZGV4T25QZW50KQBiYXNlQ2VsbCA9PSBvcmlnaW5CYXNlQ2VsbABiYXNlQ2VsbCAhPSBJTlZBTElEX0JBU0VfQ0VMTABsb2NhbElqa1RvQ2VsbAAhX2lzQmFzZUNlbGxQZW50YWdvbihiYXNlQ2VsbCkAYmFzZUNlbGxSb3RhdGlvbnMgPj0gMABncmlkUGF0aENlbGxzADAAdmVydGV4LmMAY2VsbFRvVmVydGV4AGdyYXBoLT5idWNrZXRzICE9IE5VTEwAdmVydGV4R3JhcGguYwBpbml0VmVydGV4R3JhcGgAbm9kZSAhPSBOVUxMAGFkZFZlcnRleE5vZGU=";var Ri=24144;function Zi(xe){return xe}function Yi(xe){var Ie=/\b__Z[\w\d_]+/g;return xe.replace(Ie,function(ut){var zt=ut;return ut===zt?ut:zt+" ["+ut+"]"})}function Yr(){var xe=new Error;if(!xe.stack){try{throw new Error(0)}catch(Ie){xe=Ie}if(!xe.stack)return"(no stack trace available)"}return xe.stack.toString()}function gn(){var xe=Yr();return te.extraStackTrace&&(xe+=`
`+te.extraStackTrace()),Yi(xe)}function rs(xe,Ie,ut,zt){Et("Assertion failed: "+En(xe)+", at: "+[Ie?En(Ie):"unknown filename",ut,zt?En(zt):"unknown function"])}function ni(){return fn.length}function yn(xe,Ie,ut){mn.set(mn.subarray(Ie,Ie+ut),xe)}function vr(xe){return te.___errno_location&&(hr[te.___errno_location()>>2]=xe),xe}function bs(xe){Et("OOM")}function us(xe){try{var Ie=new ArrayBuffer(xe);return Ie.byteLength!=xe?void 0:(new Int8Array(Ie).set(fn),we(Ie),Rs(Ie),1)}catch{}}function pi(xe){var Ie=ni(),ut=16777216,zt=2147483648-ut;if(xe>zt)return!1;for(var o=16777216,oe=Math.max(Ie,o);oe<xe;)oe<=536870912?oe=ct(2*oe,ut):oe=Math.min(ct((3*oe+2147483648)/4,ut),zt);var $t=us(oe);return!!$t}var br=typeof atob=="function"?atob:function(xe){var Ie="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",ut="",zt,o,oe,$t,_i,mi,si,hi=0;xe=xe.replace(/[^A-Za-z0-9\+\/\=]/g,"");do $t=Ie.indexOf(xe.charAt(hi++)),_i=Ie.indexOf(xe.charAt(hi++)),mi=Ie.indexOf(xe.charAt(hi++)),si=Ie.indexOf(xe.charAt(hi++)),zt=$t<<2|_i>>4,o=(_i&15)<<4|mi>>2,oe=(mi&3)<<6|si,ut=ut+String.fromCharCode(zt),mi!==64&&(ut=ut+String.fromCharCode(o)),si!==64&&(ut=ut+String.fromCharCode(oe));while(hi<xe.length);return ut};function wr(xe){try{for(var Ie=br(xe),ut=new Uint8Array(Ie.length),zt=0;zt<Ie.length;++zt)ut[zt]=Ie.charCodeAt(zt);return ut}catch{throw new Error("Converting base64 string to bytes failed.")}}function zn(xe){if(ii(xe))return wr(xe.slice(Qt.length))}var co={Math,Int8Array,Int32Array,Uint8Array,Float32Array,Float64Array},Sr={a:Et,b:li,c:Ot,d:rs,e:vr,f:ni,g:yn,h:pi,i:bs,j:Zi,k:Yi,l:us,m:Yr,n:gn,o:Ri,p:yo},kt=function(xe,Ie,ut){"almost asm";var zt=new xe.Int8Array(ut),o=new xe.Int32Array(ut);new xe.Uint8Array(ut),new xe.Float32Array(ut);var oe=new xe.Float64Array(ut),$t=Ie.o|0,_i=Ie.p|0,mi=xe.Math.floor,si=xe.Math.abs,hi=xe.Math.sqrt,gr=xe.Math.pow,yi=xe.Math.cos,Pi=xe.Math.sin,hn=xe.Math.tan,eo=xe.Math.acos,KA=xe.Math.asin,Vs=xe.Math.atan,js=xe.Math.atan2,Ro=xe.Math.ceil,en=xe.Math.imul,Ko=xe.Math.min,kr=xe.Math.max,gt=xe.Math.clz32,Ci=Ie.b,et=Ie.c,ar=Ie.d,to=Ie.e,BA=Ie.f,Dl=Ie.g,st=Ie.h,xn=Ie.i,Ze=24160;function hs(u){return zt=new Int8Array(u),o=new Int32Array(u),oe=new Float64Array(u),ut=u,!0}function Jl(u){u=u|0;var h=0;return h=Ze,Ze=Ze+u|0,Ze=Ze+15&-16,h|0}function uo(){return Ze|0}function JA(u){u=u|0,Ze=u}function Wi(u,h){u=u|0,Ze=u}function dn(u,h){u=u|0,h=h|0;var d=0,y=0,b=0;return(u|0)<0?(h=2,h|0):(u|0)>13780509?(h=UA(15,h)|0,h|0):(d=((u|0)<0)<<31>>31,b=ue(u|0,d|0,3,0)|0,y=et()|0,d=M(u|0,d|0,1,0)|0,d=ue(b|0,y|0,d|0,et()|0)|0,d=M(d|0,et()|0,1,0)|0,u=et()|0,o[h>>2]=d,o[h+4>>2]=u,h=0,h|0)}function Jo(u,h,d,y){return u=u|0,h=h|0,d=d|0,y=y|0,Gs(u,h,d,y,0)|0}function Gs(u,h,d,y,b){u=u|0,h=h|0,d=d|0,y=y|0,b=b|0;var I=0,R=0,N=0,W=0,K=0;if(W=Ze,Ze=Ze+16|0,R=W,!(Yn(u,h,d,y,b)|0))return y=0,Ze=W,y|0;do if((d|0)>=0){if((d|0)>13780509){if(I=UA(15,R)|0,I|0)break;N=R,R=o[N>>2]|0,N=o[N+4>>2]|0}else I=((d|0)<0)<<31>>31,K=ue(d|0,I|0,3,0)|0,N=et()|0,I=M(d|0,I|0,1,0)|0,I=ue(K|0,N|0,I|0,et()|0)|0,I=M(I|0,et()|0,1,0)|0,N=et()|0,o[R>>2]=I,o[R+4>>2]=N,R=I;if(k(y|0,0,R<<3|0)|0,b|0){k(b|0,0,R<<2|0)|0,I=xo(u,h,d,y,b,R,N,0)|0;break}I=T(R,4)|0,I?(K=xo(u,h,d,y,I,R,N,0)|0,x(I),I=K):I=13}else I=2;while(!1);return K=I,Ze=W,K|0}function Yn(u,h,d,y,b){u=u|0,h=h|0,d=d|0,y=y|0,b=b|0;var I=0,R=0,N=0,W=0,K=0,le=0,de=0,ge=0,ke=0,Pe=0,qe=0;if(qe=Ze,Ze=Ze+16|0,ke=qe,Pe=qe+8|0,ge=ke,o[ge>>2]=u,o[ge+4>>2]=h,(d|0)<0)return Pe=2,Ze=qe,Pe|0;if(I=y,o[I>>2]=u,o[I+4>>2]=h,I=(b|0)!=0,I&&(o[b>>2]=0),Nn(u,h)|0)return Pe=9,Ze=qe,Pe|0;o[Pe>>2]=0;e:do if((d|0)>=1)if(I)for(le=1,K=0,de=0,ge=1,I=u;;){if(!(K|de)){if(I=Fs(I,h,4,Pe,ke)|0,I|0)break e;if(h=ke,I=o[h>>2]|0,h=o[h+4>>2]|0,Nn(I,h)|0){I=9;break e}}if(I=Fs(I,h,o[22384+(de<<2)>>2]|0,Pe,ke)|0,I|0)break e;if(h=ke,I=o[h>>2]|0,h=o[h+4>>2]|0,u=y+(le<<3)|0,o[u>>2]=I,o[u+4>>2]=h,o[b+(le<<2)>>2]=ge,u=K+1|0,R=(u|0)==(ge|0),N=de+1|0,W=(N|0)==6,Nn(I,h)|0){I=9;break e}if(ge=ge+(W&R&1)|0,(ge|0)>(d|0)){I=0;break}else le=le+1|0,K=R?0:u,de=R?W?0:N:de}else for(le=1,K=0,de=0,ge=1,I=u;;){if(!(K|de)){if(I=Fs(I,h,4,Pe,ke)|0,I|0)break e;if(h=ke,I=o[h>>2]|0,h=o[h+4>>2]|0,Nn(I,h)|0){I=9;break e}}if(I=Fs(I,h,o[22384+(de<<2)>>2]|0,Pe,ke)|0,I|0)break e;if(h=ke,I=o[h>>2]|0,h=o[h+4>>2]|0,u=y+(le<<3)|0,o[u>>2]=I,o[u+4>>2]=h,u=K+1|0,R=(u|0)==(ge|0),N=de+1|0,W=(N|0)==6,Nn(I,h)|0){I=9;break e}if(ge=ge+(W&R&1)|0,(ge|0)>(d|0)){I=0;break}else le=le+1|0,K=R?0:u,de=R?W?0:N:de}else I=0;while(!1);return Pe=I,Ze=qe,Pe|0}function xo(u,h,d,y,b,I,R,N){u=u|0,h=h|0,d=d|0,y=y|0,b=b|0,I=I|0,R=R|0,N=N|0;var W=0,K=0,le=0,de=0,ge=0,ke=0,Pe=0,qe=0,ht=0,mt=0;if(qe=Ze,Ze=Ze+16|0,ke=qe+8|0,Pe=qe,W=ze(u|0,h|0,I|0,R|0)|0,le=et()|0,de=y+(W<<3)|0,ht=de,mt=o[ht>>2]|0,ht=o[ht+4>>2]|0,K=(mt|0)==(u|0)&(ht|0)==(h|0),!((mt|0)==0&(ht|0)==0|K))do W=M(W|0,le|0,1,0)|0,W=Ce(W|0,et()|0,I|0,R|0)|0,le=et()|0,de=y+(W<<3)|0,mt=de,ht=o[mt>>2]|0,mt=o[mt+4>>2]|0,K=(ht|0)==(u|0)&(mt|0)==(h|0);while(!((ht|0)==0&(mt|0)==0|K));if(W=b+(W<<2)|0,K&&(o[W>>2]|0)<=(N|0)||(mt=de,o[mt>>2]=u,o[mt+4>>2]=h,o[W>>2]=N,(N|0)>=(d|0)))return mt=0,Ze=qe,mt|0;switch(K=N+1|0,o[ke>>2]=0,W=Fs(u,h,2,ke,Pe)|0,W|0){case 9:{ge=9;break}case 0:{W=Pe,W=xo(o[W>>2]|0,o[W+4>>2]|0,d,y,b,I,R,K)|0,W||(ge=9);break}}e:do if((ge|0)==9){switch(o[ke>>2]=0,W=Fs(u,h,3,ke,Pe)|0,W|0){case 9:break;case 0:{if(W=Pe,W=xo(o[W>>2]|0,o[W+4>>2]|0,d,y,b,I,R,K)|0,W|0)break e;break}default:break e}switch(o[ke>>2]=0,W=Fs(u,h,1,ke,Pe)|0,W|0){case 9:break;case 0:{if(W=Pe,W=xo(o[W>>2]|0,o[W+4>>2]|0,d,y,b,I,R,K)|0,W|0)break e;break}default:break e}switch(o[ke>>2]=0,W=Fs(u,h,5,ke,Pe)|0,W|0){case 9:break;case 0:{if(W=Pe,W=xo(o[W>>2]|0,o[W+4>>2]|0,d,y,b,I,R,K)|0,W|0)break e;break}default:break e}switch(o[ke>>2]=0,W=Fs(u,h,4,ke,Pe)|0,W|0){case 9:break;case 0:{if(W=Pe,W=xo(o[W>>2]|0,o[W+4>>2]|0,d,y,b,I,R,K)|0,W|0)break e;break}default:break e}switch(o[ke>>2]=0,W=Fs(u,h,6,ke,Pe)|0,W|0){case 9:break;case 0:{if(W=Pe,W=xo(o[W>>2]|0,o[W+4>>2]|0,d,y,b,I,R,K)|0,W|0)break e;break}default:break e}return mt=0,Ze=qe,mt|0}while(!1);return mt=W,Ze=qe,mt|0}function Fs(u,h,d,y,b){u=u|0,h=h|0,d=d|0,y=y|0,b=b|0;var I=0,R=0,N=0,W=0,K=0,le=0,de=0,ge=0,ke=0,Pe=0;if(d>>>0>6)return b=1,b|0;if(de=(o[y>>2]|0)%6|0,o[y>>2]=de,(de|0)>0){I=0;do d=nl(d)|0,I=I+1|0;while((I|0)<(o[y>>2]|0))}if(de=Xe(u|0,h|0,45)|0,et()|0,le=de&127,le>>>0>121)return b=5,b|0;W=po(u,h)|0,I=Xe(u|0,h|0,52)|0,et()|0,I=I&15;e:do if(!I)K=8;else{for(;;){if(R=(15-I|0)*3|0,N=Xe(u|0,h|0,R|0)|0,et()|0,N=N&7,(N|0)==7){h=5;break}if(Pe=(bo(I)|0)==0,I=I+-1|0,ge=it(7,0,R|0)|0,h=h&~(et()|0),ke=it(o[(Pe?432:16)+(N*28|0)+(d<<2)>>2]|0,0,R|0)|0,R=et()|0,d=o[(Pe?640:224)+(N*28|0)+(d<<2)>>2]|0,u=ke|u&~ge,h=R|h,!d){d=0;break e}if(!I){K=8;break e}}return h|0}while(!1);(K|0)==8&&(Pe=o[848+(le*28|0)+(d<<2)>>2]|0,ke=it(Pe|0,0,45)|0,u=ke|u,h=et()|0|h&-1040385,d=o[4272+(le*28|0)+(d<<2)>>2]|0,(Pe&127|0)==127&&(Pe=it(o[848+(le*28|0)+20>>2]|0,0,45)|0,h=et()|0|h&-1040385,d=o[4272+(le*28|0)+20>>2]|0,u=xl(Pe|u,h)|0,h=et()|0,o[y>>2]=(o[y>>2]|0)+1)),N=Xe(u|0,h|0,45)|0,et()|0,N=N&127;e:do if(qn(N)|0){t:do if((po(u,h)|0)==1){if((le|0)!=(N|0))if(gi(N,o[7696+(le*28|0)>>2]|0)|0){u=rc(u,h)|0,R=1,h=et()|0;break}else ar(23313,22416,436,22424);switch(W|0){case 3:{u=xl(u,h)|0,h=et()|0,o[y>>2]=(o[y>>2]|0)+1,R=0;break t}case 5:{u=rc(u,h)|0,h=et()|0,o[y>>2]=(o[y>>2]|0)+5,R=0;break t}case 0:return Pe=9,Pe|0;default:return Pe=1,Pe|0}}else R=0;while(!1);if((d|0)>0){I=0;do u=ua(u,h)|0,h=et()|0,I=I+1|0;while((I|0)!=(d|0))}if((le|0)!=(N|0)){if(!(dA(N)|0)){if((R|0)!=0|(po(u,h)|0)!=5)break;o[y>>2]=(o[y>>2]|0)+1;break}switch(de&127){case 8:case 118:break e}(po(u,h)|0)!=3&&(o[y>>2]=(o[y>>2]|0)+1)}}else if((d|0)>0){I=0;do u=xl(u,h)|0,h=et()|0,I=I+1|0;while((I|0)!=(d|0))}while(!1);return o[y>>2]=((o[y>>2]|0)+d|0)%6|0,Pe=b,o[Pe>>2]=u,o[Pe+4>>2]=h,Pe=0,Pe|0}function Pl(u,h,d,y){u=u|0,h=h|0,d=d|0,y=y|0;var b=0,I=0,R=0,N=0,W=0,K=0;for(N=Ze,Ze=Ze+16|0,I=N,R=N+8|0,b=(Nn(u,h)|0)==0,b=b?1:2;;){if(o[R>>2]=0,K=(Fs(u,h,b,R,I)|0)==0,W=I,K&((o[W>>2]|0)==(d|0)?(o[W+4>>2]|0)==(y|0):0)){u=4;break}if(b=b+1|0,b>>>0>=7){b=7,u=4;break}}return(u|0)==4?(Ze=N,b|0):0}function $A(u,h,d,y){u=u|0,h=h|0,d=d|0,y=y|0;var b=0,I=0,R=0,N=0,W=0,K=0,le=0,de=0,ge=0,ke=0,Pe=0;if(Pe=Ze,Ze=Ze+16|0,ge=Pe,ke=Pe+8|0,de=ge,o[de>>2]=u,o[de+4>>2]=h,!d)return ke=y,o[ke>>2]=u,o[ke+4>>2]=h,ke=0,Ze=Pe,ke|0;o[ke>>2]=0;e:do if(Nn(u,h)|0)u=9;else{if(I=(d|0)>0,I){b=0,de=u;do{if(u=Fs(de,h,4,ke,ge)|0,u|0)break e;if(h=ge,de=o[h>>2]|0,h=o[h+4>>2]|0,b=b+1|0,Nn(de,h)|0){u=9;break e}}while((b|0)<(d|0));if(le=y,o[le>>2]=de,o[le+4>>2]=h,le=d+-1|0,I){K=0,u=1;do{if(b=22384+(K<<2)|0,(K|0)==5)for(R=o[b>>2]|0,I=0,b=u;;){if(u=ge,u=Fs(o[u>>2]|0,o[u+4>>2]|0,R,ke,ge)|0,u|0)break e;if((I|0)!=(le|0))if(W=ge,N=o[W>>2]|0,W=o[W+4>>2]|0,u=y+(b<<3)|0,o[u>>2]=N,o[u+4>>2]=W,!(Nn(N,W)|0))u=b+1|0;else{u=9;break e}else u=b;if(I=I+1|0,(I|0)>=(d|0))break;b=u}else for(R=ge,W=o[b>>2]|0,N=0,b=u,I=o[R>>2]|0,R=o[R+4>>2]|0;;){if(u=Fs(I,R,W,ke,ge)|0,u|0)break e;if(R=ge,I=o[R>>2]|0,R=o[R+4>>2]|0,u=y+(b<<3)|0,o[u>>2]=I,o[u+4>>2]=R,u=b+1|0,Nn(I,R)|0){u=9;break e}if(N=N+1|0,(N|0)>=(d|0))break;b=u}K=K+1|0}while(K>>>0<6);u=ge,R=de,b=o[u>>2]|0,I=h,u=o[u+4>>2]|0}else R=de,b=de,I=h,u=h}else R=y,o[R>>2]=u,o[R+4>>2]=h,R=u,b=u,I=h,u=h;u=(R|0)==(b|0)&(I|0)==(u|0)?0:9}while(!1);return ke=u,Ze=Pe,ke|0}function ec(u,h,d,y){u=u|0,h=h|0,d=d|0,y=y|0;var b=0,I=0,R=0,N=0,W=0,K=0;if(N=Ze,Ze=Ze+48|0,b=N+16|0,I=N+8|0,R=N,d|0)return R=15,Ze=N,R|0;if(K=u,W=o[K+4>>2]|0,d=I,o[d>>2]=o[K>>2],o[d+4>>2]=W,lc(I,b),h=eA(b,h,R)|0,!h){if(d=o[I>>2]|0,I=o[u+8>>2]|0,(I|0)>0){b=o[u+12>>2]|0,h=0;do d=(o[b+(h<<3)>>2]|0)+d|0,h=h+1|0;while((h|0)<(I|0))}h=R,b=o[h>>2]|0,h=o[h+4>>2]|0,I=((d|0)<0)<<31>>31,(h|0)<(I|0)|(h|0)==(I|0)&b>>>0<d>>>0?(h=R,o[h>>2]=d,o[h+4>>2]=I,h=I):d=b,W=M(d|0,h|0,12,0)|0,K=et()|0,h=R,o[h>>2]=W,o[h+4>>2]=K,h=y,o[h>>2]=W,o[h+4>>2]=K,h=0}return K=h,Ze=N,K|0}function zl(u,h,d,y,b,I,R){u=u|0,h=h|0,d=d|0,y=y|0,b=b|0,I=I|0,R=R|0;var N=0,W=0,K=0,le=0,de=0,ge=0,ke=0,Pe=0,qe=0,ht=0,mt=0,ot=0,ft=0,dt=0,ai=0,Ut=0,Xt=0,qt=0,or=0,qi=0,ji=0,Li=0,ir=0,Ji=0,Or=0,Xi=0,Lr=0,Bn=0,is=0;if(Or=Ze,Ze=Ze+64|0,ji=Or+48|0,Li=Or+32|0,ir=Or+24|0,ai=Or+8|0,Ut=Or,W=o[u>>2]|0,(W|0)<=0)return Ji=0,Ze=Or,Ji|0;for(Xt=u+4|0,qt=ji+8|0,or=Li+8|0,qi=ai+8|0,N=0,ft=0;;){K=o[Xt>>2]|0,ot=K+(ft<<4)|0,o[ji>>2]=o[ot>>2],o[ji+4>>2]=o[ot+4>>2],o[ji+8>>2]=o[ot+8>>2],o[ji+12>>2]=o[ot+12>>2],(ft|0)==(W+-1|0)?(o[Li>>2]=o[K>>2],o[Li+4>>2]=o[K+4>>2],o[Li+8>>2]=o[K+8>>2],o[Li+12>>2]=o[K+12>>2]):(ot=K+(ft+1<<4)|0,o[Li>>2]=o[ot>>2],o[Li+4>>2]=o[ot+4>>2],o[Li+8>>2]=o[ot+8>>2],o[Li+12>>2]=o[ot+12>>2]),W=pA(ji,Li,y,ir)|0;e:do if(W)K=0,N=W;else if(K=ir,W=o[K>>2]|0,K=o[K+4>>2]|0,(K|0)>0|(K|0)==0&W>>>0>0){mt=0,ot=0;t:for(;;){if(is=+oe[ji>>3],ht=L(W|0,K|0,mt|0,ot|0)|0,Bn=+(ht>>>0)+4294967296*+(et()|0),Xi=+(W>>>0)+4294967296*+(K|0),Lr=+(mt>>>0)+4294967296*+(ot|0),oe[ai>>3]=is*Bn/Xi+ +oe[Li>>3]*Lr/Xi,oe[qi>>3]=+oe[qt>>3]*Bn/Xi+ +oe[or>>3]*Lr/Xi,W=ta(ai,y,Ut)|0,W|0){N=W;break}ht=Ut,qe=o[ht>>2]|0,ht=o[ht+4>>2]|0,ge=ze(qe|0,ht|0,h|0,d|0)|0,le=et()|0,W=R+(ge<<3)|0,de=W,K=o[de>>2]|0,de=o[de+4>>2]|0;i:do if((K|0)==0&(de|0)==0)dt=W,Ji=16;else for(ke=0,Pe=0;;){if((ke|0)>(d|0)|(ke|0)==(d|0)&Pe>>>0>h>>>0){N=1;break t}if((K|0)==(qe|0)&(de|0)==(ht|0))break i;if(W=M(ge|0,le|0,1,0)|0,ge=Ce(W|0,et()|0,h|0,d|0)|0,le=et()|0,Pe=M(Pe|0,ke|0,1,0)|0,ke=et()|0,W=R+(ge<<3)|0,de=W,K=o[de>>2]|0,de=o[de+4>>2]|0,(K|0)==0&(de|0)==0){dt=W,Ji=16;break}}while(!1);if((Ji|0)==16&&(Ji=0,!((qe|0)==0&(ht|0)==0))&&(Pe=dt,o[Pe>>2]=qe,o[Pe+4>>2]=ht,Pe=I+(o[b>>2]<<3)|0,o[Pe>>2]=qe,o[Pe+4>>2]=ht,Pe=b,Pe=M(o[Pe>>2]|0,o[Pe+4>>2]|0,1,0)|0,qe=et()|0,ht=b,o[ht>>2]=Pe,o[ht+4>>2]=qe),mt=M(mt|0,ot|0,1,0)|0,ot=et()|0,K=ir,W=o[K>>2]|0,K=o[K+4>>2]|0,!((K|0)>(ot|0)|(K|0)==(ot|0)&W>>>0>mt>>>0)){K=1;break e}}K=0}else K=1;while(!1);if(ft=ft+1|0,!K){Ji=21;break}if(W=o[u>>2]|0,(ft|0)>=(W|0)){N=0,Ji=21;break}}return(Ji|0)==21?(Ze=Or,N|0):0}function fA(u,h,d,y){u=u|0,h=h|0,d=d|0,y=y|0;var b=0,I=0,R=0,N=0,W=0,K=0,le=0,de=0,ge=0,ke=0,Pe=0,qe=0,ht=0,mt=0,ot=0,ft=0,dt=0,ai=0,Ut=0,Xt=0,qt=0,or=0,qi=0,ji=0,Li=0,ir=0,Ji=0,Or=0,Xi=0,Lr=0,Bn=0;if(Bn=Ze,Ze=Ze+112|0,Ji=Bn+80|0,W=Bn+72|0,Or=Bn,Xi=Bn+56|0,d|0)return Lr=15,Ze=Bn,Lr|0;if(K=u+8|0,Lr=Hn((o[K>>2]<<5)+32|0)|0,!Lr)return Lr=13,Ze=Bn,Lr|0;if(jA(u,Lr),Li=u,ir=o[Li+4>>2]|0,d=W,o[d>>2]=o[Li>>2],o[d+4>>2]=ir,lc(W,Ji),d=eA(Ji,h,Or)|0,d)Li=0,ir=0;else{if(d=o[W>>2]|0,I=o[K>>2]|0,(I|0)>0){R=o[u+12>>2]|0,b=0;do d=(o[R+(b<<3)>>2]|0)+d|0,b=b+1|0;while((b|0)!=(I|0));b=d}else b=d;d=Or,I=o[d>>2]|0,d=o[d+4>>2]|0,R=((b|0)<0)<<31>>31,(d|0)<(R|0)|(d|0)==(R|0)&I>>>0<b>>>0?(d=Or,o[d>>2]=b,o[d+4>>2]=R,d=R):b=I,Li=M(b|0,d|0,12,0)|0,ir=et()|0,d=Or,o[d>>2]=Li,o[d+4>>2]=ir,d=0}if(d|0)return x(Lr),Lr=d,Ze=Bn,Lr|0;if(b=T(Li,8)|0,!b)return x(Lr),Lr=13,Ze=Bn,Lr|0;if(N=T(Li,8)|0,!N)return x(Lr),x(b),Lr=13,Ze=Bn,Lr|0;qi=Ji,o[qi>>2]=0,o[qi+4>>2]=0,qi=u,ji=o[qi+4>>2]|0,d=W,o[d>>2]=o[qi>>2],o[d+4>>2]=ji,d=zl(W,Li,ir,h,Ji,b,N)|0;e:do if(d)x(b),x(N),x(Lr);else{t:do if((o[K>>2]|0)>0){for(R=u+12|0,I=0;d=zl((o[R>>2]|0)+(I<<3)|0,Li,ir,h,Ji,b,N)|0,I=I+1|0,!(d|0);)if((I|0)>=(o[K>>2]|0))break t;x(b),x(N),x(Lr);break e}while(!1);(ir|0)>0|(ir|0)==0&Li>>>0>0&&k(N|0,0,Li<<3|0)|0,ji=Ji,qi=o[ji+4>>2]|0;t:do if((qi|0)>0|(qi|0)==0&(o[ji>>2]|0)>>>0>0){Xt=b,qt=N,or=b,qi=N,ji=b,d=b,dt=b,ai=N,Ut=N,b=N;i:for(;;){for(ht=0,mt=0,ot=0,ft=0,I=0,R=0;;){N=Or,W=N+56|0;do o[N>>2]=0,N=N+4|0;while((N|0)<(W|0));if(h=Xt+(ht<<3)|0,K=o[h>>2]|0,h=o[h+4>>2]|0,Yn(K,h,1,Or,0)|0){N=Or,W=N+56|0;do o[N>>2]=0,N=N+4|0;while((N|0)<(W|0));N=T(7,4)|0,N|0&&(xo(K,h,1,Or,N,7,0,0)|0,x(N))}for(qe=0;;){Pe=Or+(qe<<3)|0,ke=o[Pe>>2]|0,Pe=o[Pe+4>>2]|0;r:do if((ke|0)==0&(Pe|0)==0)N=I,W=R;else{if(le=ze(ke|0,Pe|0,Li|0,ir|0)|0,K=et()|0,N=y+(le<<3)|0,h=N,W=o[h>>2]|0,h=o[h+4>>2]|0,!((W|0)==0&(h|0)==0)){de=0,ge=0;do{if((de|0)>(ir|0)|(de|0)==(ir|0)&ge>>>0>Li>>>0)break i;if((W|0)==(ke|0)&(h|0)==(Pe|0)){N=I,W=R;break r}N=M(le|0,K|0,1,0)|0,le=Ce(N|0,et()|0,Li|0,ir|0)|0,K=et()|0,ge=M(ge|0,de|0,1,0)|0,de=et()|0,N=y+(le<<3)|0,h=N,W=o[h>>2]|0,h=o[h+4>>2]|0}while(!((W|0)==0&(h|0)==0))}(ke|0)==0&(Pe|0)==0?(N=I,W=R):(Sa(ke,Pe,Xi)|0,Ac(u,Lr,Xi)|0&&(ge=M(I|0,R|0,1,0)|0,R=et()|0,de=N,o[de>>2]=ke,o[de+4>>2]=Pe,I=qt+(I<<3)|0,o[I>>2]=ke,o[I+4>>2]=Pe,I=ge),N=I,W=R)}while(!1);if(qe=qe+1|0,qe>>>0>=7)break;I=N,R=W}if(ht=M(ht|0,mt|0,1,0)|0,mt=et()|0,ot=M(ot|0,ft|0,1,0)|0,ft=et()|0,R=Ji,I=o[R>>2]|0,R=o[R+4>>2]|0,(ft|0)<(R|0)|(ft|0)==(R|0)&ot>>>0<I>>>0)I=N,R=W;else break}if((R|0)>0|(R|0)==0&I>>>0>0){I=0,R=0;do ft=Xt+(I<<3)|0,o[ft>>2]=0,o[ft+4>>2]=0,I=M(I|0,R|0,1,0)|0,R=et()|0,ft=Ji,ot=o[ft+4>>2]|0;while((R|0)<(ot|0)|((R|0)==(ot|0)?I>>>0<(o[ft>>2]|0)>>>0:0))}if(ft=Ji,o[ft>>2]=N,o[ft+4>>2]=W,(W|0)>0|(W|0)==0&N>>>0>0)qe=b,ht=Ut,mt=ji,ot=ai,ft=qt,b=dt,Ut=d,ai=or,dt=qe,d=ht,ji=qi,qi=mt,or=ot,qt=Xt,Xt=ft;else break t}x(or),x(qi),x(Lr),d=1;break e}else d=N;while(!1);x(Lr),x(b),x(d),d=0}while(!1);return Lr=d,Ze=Bn,Lr|0}function ns(u,h,d){u=u|0,h=h|0,d=d|0;var y=0,b=0,I=0,R=0,N=0,W=0,K=0,le=0;if(le=Ze,Ze=Ze+176|0,W=le,(h|0)<1)return hc(d,0,0),K=0,Ze=le,K|0;for(N=u,N=Xe(o[N>>2]|0,o[N+4>>2]|0,52)|0,et()|0,hc(d,(h|0)>6?h:6,N&15),N=0;y=u+(N<<3)|0,y=Un(o[y>>2]|0,o[y+4>>2]|0,W)|0,!(y|0);){if(y=o[W>>2]|0,(y|0)>0){R=0;do I=W+8+(R<<4)|0,R=R+1|0,y=W+8+(((R|0)%(y|0)|0)<<4)|0,b=aA(d,y,I)|0,b?Nt(d,b)|0:Kt(d,I,y)|0,y=o[W>>2]|0;while((R|0)<(y|0))}if(N=N+1|0,(N|0)>=(h|0)){y=0,K=13;break}}return(K|0)==13?(Ze=le,y|0):(Mo(d),K=y,Ze=le,K|0)}function tc(u,h,d){u=u|0,h=h|0,d=d|0;var y=0,b=0,I=0,R=0;if(I=Ze,Ze=Ze+32|0,y=I,b=I+16|0,u=ns(u,h,b)|0,u|0)return d=u,Ze=I,d|0;if(o[d>>2]=0,o[d+4>>2]=0,o[d+8>>2]=0,u=Da(b)|0,u|0)do{h=au(d)|0;do rA(h,u)|0,R=u+16|0,o[y>>2]=o[R>>2],o[y+4>>2]=o[R+4>>2],o[y+8>>2]=o[R+8>>2],o[y+12>>2]=o[R+12>>2],Nt(b,u)|0,u=El(b,y)|0;while(u|0);u=Da(b)|0}while(u|0);return Mo(b),u=Ha(d)|0,u?(hl(d),R=u,Ze=I,R|0):(R=0,Ze=I,R|0)}function qn(u){return u=u|0,u>>>0>121?(u=0,u|0):(u=o[7696+(u*28|0)+16>>2]|0,u|0)}function dA(u){return u=u|0,(u|0)==4|(u|0)==117|0}function Jt(u){return u=u|0,o[11120+((o[u>>2]|0)*216|0)+((o[u+4>>2]|0)*72|0)+((o[u+8>>2]|0)*24|0)+(o[u+12>>2]<<3)>>2]|0}function $i(u){return u=u|0,o[11120+((o[u>>2]|0)*216|0)+((o[u+4>>2]|0)*72|0)+((o[u+8>>2]|0)*24|0)+(o[u+12>>2]<<3)+4>>2]|0}function ss(u,h){u=u|0,h=h|0,u=7696+(u*28|0)|0,o[h>>2]=o[u>>2],o[h+4>>2]=o[u+4>>2],o[h+8>>2]=o[u+8>>2],o[h+12>>2]=o[u+12>>2]}function xt(u,h){u=u|0,h=h|0;var d=0,y=0;if(h>>>0>20)return h=-1,h|0;do if((o[11120+(h*216|0)>>2]|0)!=(u|0))if((o[11120+(h*216|0)+8>>2]|0)!=(u|0))if((o[11120+(h*216|0)+16>>2]|0)!=(u|0))if((o[11120+(h*216|0)+24>>2]|0)!=(u|0))if((o[11120+(h*216|0)+32>>2]|0)!=(u|0))if((o[11120+(h*216|0)+40>>2]|0)!=(u|0))if((o[11120+(h*216|0)+48>>2]|0)!=(u|0))if((o[11120+(h*216|0)+56>>2]|0)!=(u|0))if((o[11120+(h*216|0)+64>>2]|0)!=(u|0))if((o[11120+(h*216|0)+72>>2]|0)!=(u|0))if((o[11120+(h*216|0)+80>>2]|0)!=(u|0))if((o[11120+(h*216|0)+88>>2]|0)!=(u|0))if((o[11120+(h*216|0)+96>>2]|0)!=(u|0))if((o[11120+(h*216|0)+104>>2]|0)!=(u|0))if((o[11120+(h*216|0)+112>>2]|0)!=(u|0))if((o[11120+(h*216|0)+120>>2]|0)!=(u|0))if((o[11120+(h*216|0)+128>>2]|0)!=(u|0))if((o[11120+(h*216|0)+136>>2]|0)==(u|0))u=2,d=1,y=2;else{if((o[11120+(h*216|0)+144>>2]|0)==(u|0)){u=0,d=2,y=0;break}if((o[11120+(h*216|0)+152>>2]|0)==(u|0)){u=0,d=2,y=1;break}if((o[11120+(h*216|0)+160>>2]|0)==(u|0)){u=0,d=2,y=2;break}if((o[11120+(h*216|0)+168>>2]|0)==(u|0)){u=1,d=2,y=0;break}if((o[11120+(h*216|0)+176>>2]|0)==(u|0)){u=1,d=2,y=1;break}if((o[11120+(h*216|0)+184>>2]|0)==(u|0)){u=1,d=2,y=2;break}if((o[11120+(h*216|0)+192>>2]|0)==(u|0)){u=2,d=2,y=0;break}if((o[11120+(h*216|0)+200>>2]|0)==(u|0)){u=2,d=2,y=1;break}if((o[11120+(h*216|0)+208>>2]|0)==(u|0)){u=2,d=2,y=2;break}else u=-1;return u|0}else u=2,d=1,y=1;else u=2,d=1,y=0;else u=1,d=1,y=2;else u=1,d=1,y=1;else u=1,d=1,y=0;else u=0,d=1,y=2;else u=0,d=1,y=1;else u=0,d=1,y=0;else u=2,d=0,y=2;else u=2,d=0,y=1;else u=2,d=0,y=0;else u=1,d=0,y=2;else u=1,d=0,y=1;else u=1,d=0,y=0;else u=0,d=0,y=2;else u=0,d=0,y=1;else u=0,d=0,y=0;while(!1);return h=o[11120+(h*216|0)+(d*72|0)+(u*24|0)+(y<<3)+4>>2]|0,h|0}function gi(u,h){return u=u|0,h=h|0,(o[7696+(u*28|0)+20>>2]|0)==(h|0)?(h=1,h|0):(h=(o[7696+(u*28|0)+24>>2]|0)==(h|0),h|0)}function Fo(u,h){return u=u|0,h=h|0,o[848+(u*28|0)+(h<<2)>>2]|0}function $o(u,h){return u=u|0,h=h|0,(o[848+(u*28|0)>>2]|0)==(h|0)?(h=0,h|0):(o[848+(u*28|0)+4>>2]|0)==(h|0)?(h=1,h|0):(o[848+(u*28|0)+8>>2]|0)==(h|0)?(h=2,h|0):(o[848+(u*28|0)+12>>2]|0)==(h|0)?(h=3,h|0):(o[848+(u*28|0)+16>>2]|0)==(h|0)?(h=4,h|0):(o[848+(u*28|0)+20>>2]|0)==(h|0)?(h=5,h|0):((o[848+(u*28|0)+24>>2]|0)==(h|0)?6:7)|0}function vn(){return 122}function la(u){u=u|0;var h=0,d=0,y=0;h=0;do it(h|0,0,45)|0,y=et()|0|134225919,d=u+(h<<3)|0,o[d>>2]=-1,o[d+4>>2]=y,h=h+1|0;while((h|0)!=122);return 0}function $l(u){return u=u|0,+oe[u+16>>3]<+oe[u+24>>3]|0}function Oo(u,h){u=u|0,h=h|0;var d=0,y=0,b=0;return d=+oe[h>>3],!(d>=+oe[u+8>>3])||!(d<=+oe[u>>3])?(h=0,h|0):(y=+oe[u+16>>3],d=+oe[u+24>>3],b=+oe[h+8>>3],h=b>=d,u=b<=y&1,y<d?h&&(u=1):h||(u=0),h=(u|0)!=0,h|0)}function eA(u,h,d){u=u|0,h=h|0,d=d|0;var y=0,b=0,I=0,R=0,N=0,W=0,K=0,le=0,de=0,ge=0,ke=0,Pe=0,qe=0,ht=0;Pe=Ze,Ze=Ze+288|0,le=Pe+264|0,de=Pe+96|0,K=Pe,N=K,W=N+96|0;do o[N>>2]=0,N=N+4|0;while((N|0)<(W|0));return h=wo(h,K)|0,h|0?(ke=h,Ze=Pe,ke|0):(W=K,K=o[W>>2]|0,W=o[W+4>>2]|0,Sa(K,W,le)|0,Un(K,W,de)|0,R=+To(le,de+8|0),oe[le>>3]=+oe[u>>3],W=le+8|0,oe[W>>3]=+oe[u+16>>3],oe[de>>3]=+oe[u+8>>3],K=de+8|0,oe[K>>3]=+oe[u+24>>3],b=+To(le,de),ht=+oe[W>>3]-+oe[K>>3],I=+si(+ht),qe=+oe[le>>3]-+oe[de>>3],y=+si(+qe),!(ht==0|qe==0)&&(ht=+z(+I,+y),ht=+Ro(+(b*b/+l(+(ht/+l(+I,+y)),3)/(R*(R*2.59807621135)*.8))),oe[$t>>3]=ht,ge=~~ht>>>0,ke=+si(ht)>=1?ht>0?~~+Ko(+mi(ht/4294967296),4294967295)>>>0:~~+Ro((ht-+(~~ht>>>0))/4294967296)>>>0:0,(o[$t+4>>2]&2146435072|0)!=2146435072)?(de=(ge|0)==0&(ke|0)==0,h=d,o[h>>2]=de?1:ge,o[h+4>>2]=de?0:ke,h=0):h=1,ke=h,Ze=Pe,ke|0)}function pA(u,h,d,y){u=u|0,h=h|0,d=d|0,y=y|0;var b=0,I=0,R=0,N=0,W=0,K=0,le=0;K=Ze,Ze=Ze+288|0,R=K+264|0,N=K+96|0,W=K,b=W,I=b+96|0;do o[b>>2]=0,b=b+4|0;while((b|0)<(I|0));return d=wo(d,W)|0,d|0?(y=d,Ze=K,y|0):(d=W,b=o[d>>2]|0,d=o[d+4>>2]|0,Sa(b,d,R)|0,Un(b,d,N)|0,le=+To(R,N+8|0),le=+Ro(+(+To(u,h)/(le*2))),oe[$t>>3]=le,d=~~le>>>0,b=+si(le)>=1?le>0?~~+Ko(+mi(le/4294967296),4294967295)>>>0:~~+Ro((le-+(~~le>>>0))/4294967296)>>>0:0,(o[$t+4>>2]&2146435072|0)==2146435072?(y=1,Ze=K,y|0):(W=(d|0)==0&(b|0)==0,o[y>>2]=W?1:d,o[y+4>>2]=W?0:b,y=0,Ze=K,y|0))}function Kn(u,h,d,y){u=u|0,h=h|0,d=d|0,y=y|0,o[u>>2]=h,o[u+4>>2]=d,o[u+8>>2]=y}function Wt(u,h){u=u|0,h=h|0;var d=0,y=0,b=0,I=0,R=0,N=0,W=0,K=0,le=0,de=0,ge=0;de=h+8|0,o[de>>2]=0,W=+oe[u>>3],R=+si(+W),K=+oe[u+8>>3],N=+si(+K)/.8660254037844386,R=R+N*.5,d=~~R,u=~~N,R=R-+(d|0),N=N-+(u|0);do if(R<.5)if(R<.3333333333333333)if(o[h>>2]=d,N<(R+1)*.5){o[h+4>>2]=u;break}else{u=u+1|0,o[h+4>>2]=u;break}else if(ge=1-R,u=(!(N<ge)&1)+u|0,o[h+4>>2]=u,ge<=N&N<R*2){d=d+1|0,o[h>>2]=d;break}else{o[h>>2]=d;break}else{if(!(R<.6666666666666666))if(d=d+1|0,o[h>>2]=d,N<R*.5){o[h+4>>2]=u;break}else{u=u+1|0,o[h+4>>2]=u;break}if(N<1-R){if(o[h+4>>2]=u,R*2+-1<N){o[h>>2]=d;break}}else u=u+1|0,o[h+4>>2]=u;d=d+1|0,o[h>>2]=d}while(!1);do if(W<0)if(u&1){le=(u+1|0)/2|0,le=L(d|0,((d|0)<0)<<31>>31|0,le|0,((le|0)<0)<<31>>31|0)|0,d=~~(+(d|0)-((+(le>>>0)+4294967296*+(et()|0))*2+1)),o[h>>2]=d;break}else{le=(u|0)/2|0,le=L(d|0,((d|0)<0)<<31>>31|0,le|0,((le|0)<0)<<31>>31|0)|0,d=~~(+(d|0)-(+(le>>>0)+4294967296*+(et()|0))*2),o[h>>2]=d;break}while(!1);le=h+4|0,K<0&&(d=d-((u<<1|1|0)/2|0)|0,o[h>>2]=d,u=0-u|0,o[le>>2]=u),y=u-d|0,(d|0)<0?(b=0-d|0,o[le>>2]=y,o[de>>2]=b,o[h>>2]=0,u=y,d=0):b=0,(u|0)<0&&(d=d-u|0,o[h>>2]=d,b=b-u|0,o[de>>2]=b,o[le>>2]=0,u=0),I=d-b|0,y=u-b|0,(b|0)<0&&(o[h>>2]=I,o[le>>2]=y,o[de>>2]=0,u=y,d=I,b=0),y=(u|0)<(d|0)?u:d,y=(b|0)<(y|0)?b:y,!((y|0)<=0)&&(o[h>>2]=d-y,o[le>>2]=u-y,o[de>>2]=b-y)}function Ui(u){u=u|0;var h=0,d=0,y=0,b=0,I=0,R=0;h=o[u>>2]|0,R=u+4|0,d=o[R>>2]|0,(h|0)<0&&(d=d-h|0,o[R>>2]=d,I=u+8|0,o[I>>2]=(o[I>>2]|0)-h,o[u>>2]=0,h=0),(d|0)<0?(h=h-d|0,o[u>>2]=h,I=u+8|0,b=(o[I>>2]|0)-d|0,o[I>>2]=b,o[R>>2]=0,d=0):(b=u+8|0,I=b,b=o[b>>2]|0),(b|0)<0&&(h=h-b|0,o[u>>2]=h,d=d-b|0,o[R>>2]=d,o[I>>2]=0,b=0),y=(d|0)<(h|0)?d:h,y=(b|0)<(y|0)?b:y,!((y|0)<=0)&&(o[u>>2]=h-y,o[R>>2]=d-y,o[I>>2]=b-y)}function sr(u,h){u=u|0,h=h|0;var d=0,y=0;y=o[u+8>>2]|0,d=+((o[u+4>>2]|0)-y|0),oe[h>>3]=+((o[u>>2]|0)-y|0)-d*.5,oe[h+8>>3]=d*.8660254037844386}function tn(u,h,d){u=u|0,h=h|0,d=d|0,o[d>>2]=(o[h>>2]|0)+(o[u>>2]|0),o[d+4>>2]=(o[h+4>>2]|0)+(o[u+4>>2]|0),o[d+8>>2]=(o[h+8>>2]|0)+(o[u+8>>2]|0)}function Aa(u,h,d){u=u|0,h=h|0,d=d|0,o[d>>2]=(o[u>>2]|0)-(o[h>>2]|0),o[d+4>>2]=(o[u+4>>2]|0)-(o[h+4>>2]|0),o[d+8>>2]=(o[u+8>>2]|0)-(o[h+8>>2]|0)}function Dr(u,h){u=u|0,h=h|0;var d=0,y=0;d=en(o[u>>2]|0,h)|0,o[u>>2]=d,d=u+4|0,y=en(o[d>>2]|0,h)|0,o[d>>2]=y,u=u+8|0,h=en(o[u>>2]|0,h)|0,o[u>>2]=h}function ba(u){u=u|0;var h=0,d=0,y=0,b=0,I=0,R=0,N=0;R=o[u>>2]|0,N=(R|0)<0,y=(o[u+4>>2]|0)-(N?R:0)|0,I=(y|0)<0,b=(I?0-y|0:0)+((o[u+8>>2]|0)-(N?R:0))|0,d=(b|0)<0,u=d?0:b,h=(I?0:y)-(d?b:0)|0,b=(N?0:R)-(I?y:0)-(d?b:0)|0,d=(h|0)<(b|0)?h:b,d=(u|0)<(d|0)?u:d,y=(d|0)>0,u=u-(y?d:0)|0,h=h-(y?d:0)|0;e:do switch(b-(y?d:0)|0){case 0:switch(h|0){case 0:return N=u|0?(u|0)==1?1:7:0,N|0;case 1:return N=u|0?(u|0)==1?3:7:2,N|0;default:break e}case 1:switch(h|0){case 0:return N=u|0?(u|0)==1?5:7:4,N|0;case 1:{if(!u)u=6;else break e;return u|0}default:break e}}while(!1);return N=7,N|0}function rl(u){u=u|0;var h=0,d=0,y=0,b=0,I=0,R=0,N=0;R=u+8|0,b=o[R>>2]|0,I=(o[u>>2]|0)-b|0,N=u+4|0,b=(o[N>>2]|0)-b|0;do if(I>>>0>715827881|b>>>0>715827881){if(d=(I|0)>0,d){if((2147483647-I|0)<(I|0)||(2147483647-(I<<1)|0)<(I|0))return N=1,N|0}else if((-2147483648-I|0)>(I|0)||(-2147483648-(I<<1)|0)>(I|0))return N=1,N|0;if(h=I*3|0,(b|0)>0){if((2147483647-b|0)<(b|0))return N=1,N|0}else if((-2147483648-b|0)>(b|0))return N=1,N|0;if(y=b<<1,(I|0)>-1){if((h|-2147483648|0)>=(b|0))return N=1,N|0}else if((h^-2147483648|0)<(b|0))return N=1,N|0;if(d){if((2147483647-I|0)<(y|0))h=1;else{d=y;break}return h|0}else{if((-2147483648-I|0)>(y|0))h=1;else{d=y;break}return h|0}}else d=b<<1,h=I*3|0;while(!1);y=pa(+(h-b|0)/7)|0,o[u>>2]=y,b=pa(+(d+I|0)/7)|0,o[N>>2]=b,o[R>>2]=0,d=(b|0)<(y|0),h=d?y:b,d=d?b:y;do if((d|0)<0){if((h|0)>0){if((h|-2147483648|0)<(d|0)&((d|0)!=-2147483648&(2147483647-h|0)>=(d|0)))break;ar(23313,22444,355,22455)}if((d|0)==-2147483648|(-2147483648-h|0)>(d|0)&&ar(23313,22444,355,22455),(h|0)>-1){if((h|-2147483648|0)<(d|0))break;ar(23313,22444,355,22455)}else{if((h^-2147483648|0)>=(d|0))break;ar(23313,22444,355,22455)}}while(!1);return h=b-y|0,(y|0)<0?(d=0-y|0,o[N>>2]=h,o[R>>2]=d,o[u>>2]=0,y=0):(h=b,d=0),(h|0)<0&&(y=y-h|0,o[u>>2]=y,d=d-h|0,o[R>>2]=d,o[N>>2]=0,h=0),I=y-d|0,b=h-d|0,(d|0)<0?(o[u>>2]=I,o[N>>2]=b,o[R>>2]=0,h=b,b=I,d=0):b=y,y=(h|0)<(b|0)?h:b,y=(d|0)<(y|0)?d:y,(y|0)<=0?(N=0,N|0):(o[u>>2]=b-y,o[N>>2]=h-y,o[R>>2]=d-y,N=0,N|0)}function ca(u){u=u|0;var h=0,d=0,y=0,b=0,I=0,R=0,N=0;R=u+8|0,b=o[R>>2]|0,I=(o[u>>2]|0)-b|0,N=u+4|0,b=(o[N>>2]|0)-b|0;do if(I>>>0>715827881|b>>>0>715827881){if(d=(I|0)>0,d){if((2147483647-I|0)<(I|0))return N=1,N|0}else if((-2147483648-I|0)>(I|0))return N=1,N|0;if(h=I<<1,(b|0)>0){if((2147483647-b|0)<(b|0)||(2147483647-(b<<1)|0)<(b|0))return N=1,N|0}else if((-2147483648-b|0)>(b|0)||(-2147483648-(b<<1)|0)>(b|0))return N=1,N|0;if(y=b*3|0,d){if((2147483647-h|0)<(b|0))return N=1,N|0}else if((-2147483648-h|0)>(b|0))return N=1,N|0;if((b|0)>-1){if((y|-2147483648|0)<(I|0)){d=y;break}else h=1;return h|0}else{if((y^-2147483648|0)<(I|0))h=1;else{d=y;break}return h|0}}else d=b*3|0,h=I<<1;while(!1);y=pa(+(h+b|0)/7)|0,o[u>>2]=y,b=pa(+(d-I|0)/7)|0,o[N>>2]=b,o[R>>2]=0,d=(b|0)<(y|0),h=d?y:b,d=d?b:y;do if((d|0)<0){if((h|0)>0){if((h|-2147483648|0)<(d|0)&((d|0)!=-2147483648&(2147483647-h|0)>=(d|0)))break;ar(23313,22444,404,22469)}if((d|0)==-2147483648|(-2147483648-h|0)>(d|0)&&ar(23313,22444,404,22469),(h|0)>-1){if((h|-2147483648|0)<(d|0))break;ar(23313,22444,404,22469)}else{if((h^-2147483648|0)>=(d|0))break;ar(23313,22444,404,22469)}}while(!1);return h=b-y|0,(y|0)<0?(d=0-y|0,o[N>>2]=h,o[R>>2]=d,o[u>>2]=0,y=0):(h=b,d=0),(h|0)<0&&(y=y-h|0,o[u>>2]=y,d=d-h|0,o[R>>2]=d,o[N>>2]=0,h=0),I=y-d|0,b=h-d|0,(d|0)<0?(o[u>>2]=I,o[N>>2]=b,o[R>>2]=0,h=b,b=I,d=0):b=y,y=(h|0)<(b|0)?h:b,y=(d|0)<(y|0)?d:y,(y|0)<=0?(N=0,N|0):(o[u>>2]=b-y,o[N>>2]=h-y,o[R>>2]=d-y,N=0,N|0)}function ho(u){u=u|0;var h=0,d=0,y=0,b=0,I=0,R=0,N=0;R=u+8|0,d=o[R>>2]|0,h=(o[u>>2]|0)-d|0,N=u+4|0,d=(o[N>>2]|0)-d|0,y=pa(+((h*3|0)-d|0)/7)|0,o[u>>2]=y,h=pa(+((d<<1)+h|0)/7)|0,o[N>>2]=h,o[R>>2]=0,d=h-y|0,(y|0)<0?(I=0-y|0,o[N>>2]=d,o[R>>2]=I,o[u>>2]=0,h=d,y=0,d=I):d=0,(h|0)<0&&(y=y-h|0,o[u>>2]=y,d=d-h|0,o[R>>2]=d,o[N>>2]=0,h=0),I=y-d|0,b=h-d|0,(d|0)<0?(o[u>>2]=I,o[N>>2]=b,o[R>>2]=0,h=b,b=I,d=0):b=y,y=(h|0)<(b|0)?h:b,y=(d|0)<(y|0)?d:y,!((y|0)<=0)&&(o[u>>2]=b-y,o[N>>2]=h-y,o[R>>2]=d-y)}function Jn(u){u=u|0;var h=0,d=0,y=0,b=0,I=0,R=0,N=0;R=u+8|0,d=o[R>>2]|0,h=(o[u>>2]|0)-d|0,N=u+4|0,d=(o[N>>2]|0)-d|0,y=pa(+((h<<1)+d|0)/7)|0,o[u>>2]=y,h=pa(+((d*3|0)-h|0)/7)|0,o[N>>2]=h,o[R>>2]=0,d=h-y|0,(y|0)<0?(I=0-y|0,o[N>>2]=d,o[R>>2]=I,o[u>>2]=0,h=d,y=0,d=I):d=0,(h|0)<0&&(y=y-h|0,o[u>>2]=y,d=d-h|0,o[R>>2]=d,o[N>>2]=0,h=0),I=y-d|0,b=h-d|0,(d|0)<0?(o[u>>2]=I,o[N>>2]=b,o[R>>2]=0,h=b,b=I,d=0):b=y,y=(h|0)<(b|0)?h:b,y=(d|0)<(y|0)?d:y,!((y|0)<=0)&&(o[u>>2]=b-y,o[N>>2]=h-y,o[R>>2]=d-y)}function gl(u){u=u|0;var h=0,d=0,y=0,b=0,I=0,R=0,N=0;h=o[u>>2]|0,R=u+4|0,d=o[R>>2]|0,N=u+8|0,y=o[N>>2]|0,b=d+(h*3|0)|0,o[u>>2]=b,d=y+(d*3|0)|0,o[R>>2]=d,h=(y*3|0)+h|0,o[N>>2]=h,y=d-b|0,(b|0)<0?(h=h-b|0,o[R>>2]=y,o[N>>2]=h,o[u>>2]=0,d=y,y=0):y=b,(d|0)<0&&(y=y-d|0,o[u>>2]=y,h=h-d|0,o[N>>2]=h,o[R>>2]=0,d=0),I=y-h|0,b=d-h|0,(h|0)<0?(o[u>>2]=I,o[R>>2]=b,o[N>>2]=0,y=I,h=0):b=d,d=(b|0)<(y|0)?b:y,d=(h|0)<(d|0)?h:d,!((d|0)<=0)&&(o[u>>2]=y-d,o[R>>2]=b-d,o[N>>2]=h-d)}function Zs(u){u=u|0;var h=0,d=0,y=0,b=0,I=0,R=0,N=0;b=o[u>>2]|0,R=u+4|0,h=o[R>>2]|0,N=u+8|0,d=o[N>>2]|0,y=(h*3|0)+b|0,b=d+(b*3|0)|0,o[u>>2]=b,o[R>>2]=y,h=(d*3|0)+h|0,o[N>>2]=h,d=y-b|0,(b|0)<0?(h=h-b|0,o[R>>2]=d,o[N>>2]=h,o[u>>2]=0,b=0):d=y,(d|0)<0&&(b=b-d|0,o[u>>2]=b,h=h-d|0,o[N>>2]=h,o[R>>2]=0,d=0),I=b-h|0,y=d-h|0,(h|0)<0?(o[u>>2]=I,o[R>>2]=y,o[N>>2]=0,b=I,h=0):y=d,d=(y|0)<(b|0)?y:b,d=(h|0)<(d|0)?h:d,!((d|0)<=0)&&(o[u>>2]=b-d,o[R>>2]=y-d,o[N>>2]=h-d)}function wa(u,h){u=u|0,h=h|0;var d=0,y=0,b=0,I=0,R=0,N=0;(h+-1|0)>>>0>=6||(b=(o[15440+(h*12|0)>>2]|0)+(o[u>>2]|0)|0,o[u>>2]=b,N=u+4|0,y=(o[15440+(h*12|0)+4>>2]|0)+(o[N>>2]|0)|0,o[N>>2]=y,R=u+8|0,h=(o[15440+(h*12|0)+8>>2]|0)+(o[R>>2]|0)|0,o[R>>2]=h,d=y-b|0,(b|0)<0?(h=h-b|0,o[N>>2]=d,o[R>>2]=h,o[u>>2]=0,y=0):(d=y,y=b),(d|0)<0&&(y=y-d|0,o[u>>2]=y,h=h-d|0,o[R>>2]=h,o[N>>2]=0,d=0),I=y-h|0,b=d-h|0,(h|0)<0?(o[u>>2]=I,o[N>>2]=b,o[R>>2]=0,y=I,h=0):b=d,d=(b|0)<(y|0)?b:y,d=(h|0)<(d|0)?h:d,!((d|0)<=0)&&(o[u>>2]=y-d,o[N>>2]=b-d,o[R>>2]=h-d))}function Bl(u){u=u|0;var h=0,d=0,y=0,b=0,I=0,R=0,N=0;b=o[u>>2]|0,R=u+4|0,h=o[R>>2]|0,N=u+8|0,d=o[N>>2]|0,y=h+b|0,b=d+b|0,o[u>>2]=b,o[R>>2]=y,h=d+h|0,o[N>>2]=h,d=y-b|0,(b|0)<0?(h=h-b|0,o[R>>2]=d,o[N>>2]=h,o[u>>2]=0,y=0):(d=y,y=b),(d|0)<0&&(y=y-d|0,o[u>>2]=y,h=h-d|0,o[N>>2]=h,o[R>>2]=0,d=0),I=y-h|0,b=d-h|0,(h|0)<0?(o[u>>2]=I,o[R>>2]=b,o[N>>2]=0,y=I,h=0):b=d,d=(b|0)<(y|0)?b:y,d=(h|0)<(d|0)?h:d,!((d|0)<=0)&&(o[u>>2]=y-d,o[R>>2]=b-d,o[N>>2]=h-d)}function Ta(u){u=u|0;var h=0,d=0,y=0,b=0,I=0,R=0,N=0;h=o[u>>2]|0,R=u+4|0,y=o[R>>2]|0,N=u+8|0,d=o[N>>2]|0,b=y+h|0,o[u>>2]=b,y=d+y|0,o[R>>2]=y,h=d+h|0,o[N>>2]=h,d=y-b|0,(b|0)<0?(h=h-b|0,o[R>>2]=d,o[N>>2]=h,o[u>>2]=0,y=0):(d=y,y=b),(d|0)<0&&(y=y-d|0,o[u>>2]=y,h=h-d|0,o[N>>2]=h,o[R>>2]=0,d=0),I=y-h|0,b=d-h|0,(h|0)<0?(o[u>>2]=I,o[R>>2]=b,o[N>>2]=0,y=I,h=0):b=d,d=(b|0)<(y|0)?b:y,d=(h|0)<(d|0)?h:d,!((d|0)<=0)&&(o[u>>2]=y-d,o[R>>2]=b-d,o[N>>2]=h-d)}function nl(u){switch(u=u|0,u|0){case 1:{u=5;break}case 5:{u=4;break}case 4:{u=6;break}case 6:{u=2;break}case 2:{u=3;break}case 3:{u=1;break}}return u|0}function Va(u){switch(u=u|0,u|0){case 1:{u=3;break}case 3:{u=2;break}case 2:{u=6;break}case 6:{u=4;break}case 4:{u=5;break}case 5:{u=1;break}}return u|0}function ic(u){u=u|0;var h=0,d=0,y=0,b=0,I=0,R=0,N=0;h=o[u>>2]|0,R=u+4|0,d=o[R>>2]|0,N=u+8|0,y=o[N>>2]|0,b=d+(h<<1)|0,o[u>>2]=b,d=y+(d<<1)|0,o[R>>2]=d,h=(y<<1)+h|0,o[N>>2]=h,y=d-b|0,(b|0)<0?(h=h-b|0,o[R>>2]=y,o[N>>2]=h,o[u>>2]=0,d=y,y=0):y=b,(d|0)<0&&(y=y-d|0,o[u>>2]=y,h=h-d|0,o[N>>2]=h,o[R>>2]=0,d=0),I=y-h|0,b=d-h|0,(h|0)<0?(o[u>>2]=I,o[R>>2]=b,o[N>>2]=0,y=I,h=0):b=d,d=(b|0)<(y|0)?b:y,d=(h|0)<(d|0)?h:d,!((d|0)<=0)&&(o[u>>2]=y-d,o[R>>2]=b-d,o[N>>2]=h-d)}function mA(u){u=u|0;var h=0,d=0,y=0,b=0,I=0,R=0,N=0;b=o[u>>2]|0,R=u+4|0,h=o[R>>2]|0,N=u+8|0,d=o[N>>2]|0,y=(h<<1)+b|0,b=d+(b<<1)|0,o[u>>2]=b,o[R>>2]=y,h=(d<<1)+h|0,o[N>>2]=h,d=y-b|0,(b|0)<0?(h=h-b|0,o[R>>2]=d,o[N>>2]=h,o[u>>2]=0,b=0):d=y,(d|0)<0&&(b=b-d|0,o[u>>2]=b,h=h-d|0,o[N>>2]=h,o[R>>2]=0,d=0),I=b-h|0,y=d-h|0,(h|0)<0?(o[u>>2]=I,o[R>>2]=y,o[N>>2]=0,b=I,h=0):y=d,d=(y|0)<(b|0)?y:b,d=(h|0)<(d|0)?h:d,!((d|0)<=0)&&(o[u>>2]=b-d,o[R>>2]=y-d,o[N>>2]=h-d)}function LA(u,h){u=u|0,h=h|0;var d=0,y=0,b=0,I=0,R=0,N=0;return R=(o[u>>2]|0)-(o[h>>2]|0)|0,N=(R|0)<0,y=(o[u+4>>2]|0)-(o[h+4>>2]|0)-(N?R:0)|0,I=(y|0)<0,b=(N?0-R|0:0)+(o[u+8>>2]|0)-(o[h+8>>2]|0)+(I?0-y|0:0)|0,u=(b|0)<0,h=u?0:b,d=(I?0:y)-(u?b:0)|0,b=(N?0:R)-(I?y:0)-(u?b:0)|0,u=(d|0)<(b|0)?d:b,u=(h|0)<(u|0)?h:u,y=(u|0)>0,h=h-(y?u:0)|0,d=d-(y?u:0)|0,u=b-(y?u:0)|0,u=(u|0)>-1?u:0-u|0,d=(d|0)>-1?d:0-d|0,h=(h|0)>-1?h:0-h|0,h=(d|0)>(h|0)?d:h,((u|0)>(h|0)?u:h)|0}function ea(u,h){u=u|0,h=h|0;var d=0;d=o[u+8>>2]|0,o[h>>2]=(o[u>>2]|0)-d,o[h+4>>2]=(o[u+4>>2]|0)-d}function fr(u,h){u=u|0,h=h|0;var d=0,y=0,b=0,I=0,R=0,N=0;y=o[u>>2]|0,o[h>>2]=y,b=o[u+4>>2]|0,R=h+4|0,o[R>>2]=b,N=h+8|0,o[N>>2]=0,d=(b|0)<(y|0),u=d?y:b,d=d?b:y;do if((d|0)<0){if((u|0)>0){if((u|-2147483648|0)<(d|0)&((d|0)!=-2147483648&(2147483647-u|0)>=(d|0)))break;return u=1,u|0}if((d|0)==-2147483648|(-2147483648-u|0)>(d|0))return h=1,h|0;if((u|0)>-1){if((u|-2147483648|0)<(d|0))break;return u=1,u|0}else{if((u^-2147483648|0)<(d|0))u=1;else break;return u|0}}while(!1);return u=b-y|0,(y|0)<0?(d=0-y|0,o[R>>2]=u,o[N>>2]=d,o[h>>2]=0,y=0):(u=b,d=0),(u|0)<0&&(y=y-u|0,o[h>>2]=y,d=d-u|0,o[N>>2]=d,o[R>>2]=0,u=0),I=y-d|0,b=u-d|0,(d|0)<0?(o[h>>2]=I,o[R>>2]=b,o[N>>2]=0,u=b,b=I,d=0):b=y,y=(u|0)<(b|0)?u:b,y=(d|0)<(y|0)?d:y,(y|0)<=0?(h=0,h|0):(o[h>>2]=b-y,o[R>>2]=u-y,o[N>>2]=d-y,h=0,h|0)}function ja(u){u=u|0;var h=0,d=0,y=0,b=0;h=u+8|0,b=o[h>>2]|0,d=b-(o[u>>2]|0)|0,o[u>>2]=d,y=u+4|0,u=(o[y>>2]|0)-b|0,o[y>>2]=u,o[h>>2]=0-(u+d)}function RA(u){u=u|0;var h=0,d=0,y=0,b=0,I=0,R=0,N=0;d=o[u>>2]|0,h=0-d|0,o[u>>2]=h,R=u+8|0,o[R>>2]=0,N=u+4|0,y=o[N>>2]|0,b=y+d|0,(d|0)>0?(o[N>>2]=b,o[R>>2]=d,o[u>>2]=0,h=0,y=b):d=0,(y|0)<0?(I=h-y|0,o[u>>2]=I,d=d-y|0,o[R>>2]=d,o[N>>2]=0,b=I-d|0,h=0-d|0,(d|0)<0?(o[u>>2]=b,o[N>>2]=h,o[R>>2]=0,y=h,d=0):(y=0,b=I)):b=h,h=(y|0)<(b|0)?y:b,h=(d|0)<(h|0)?d:h,!((h|0)<=0)&&(o[u>>2]=b-h,o[N>>2]=y-h,o[R>>2]=d-h)}function vo(u,h,d,y,b){u=u|0,h=h|0,d=d|0,y=y|0,b=b|0;var I=0,R=0,N=0,W=0,K=0,le=0,de=0;if(de=Ze,Ze=Ze+64|0,le=de,N=de+56|0,!(!0&(h&2013265920|0)==134217728&(!0&(y&2013265920|0)==134217728)))return b=5,Ze=de,b|0;if((u|0)==(d|0)&(h|0)==(y|0))return o[b>>2]=0,b=0,Ze=de,b|0;if(R=Xe(u|0,h|0,52)|0,et()|0,R=R&15,K=Xe(d|0,y|0,52)|0,et()|0,(R|0)!=(K&15|0))return b=12,Ze=de,b|0;if(I=R+-1|0,R>>>0>1){No(u,h,I,le)|0,No(d,y,I,N)|0,K=le,W=o[K>>2]|0,K=o[K+4>>2]|0;e:do if((W|0)==(o[N>>2]|0)&&(K|0)==(o[N+4>>2]|0)){R=(R^15)*3|0,I=Xe(u|0,h|0,R|0)|0,et()|0,I=I&7,R=Xe(d|0,y|0,R|0)|0,et()|0,R=R&7;do if((I|0)==0|(R|0)==0)o[b>>2]=1,I=0;else if((I|0)==7)I=5;else{if((I|0)==1|(R|0)==1&&Nn(W,K)|0){I=5;break}if((o[15536+(I<<2)>>2]|0)!=(R|0)&&(o[15568+(I<<2)>>2]|0)!=(R|0))break e;o[b>>2]=1,I=0}while(!1);return b=I,Ze=de,b|0}while(!1)}I=le,R=I+56|0;do o[I>>2]=0,I=I+4|0;while((I|0)<(R|0));return Jo(u,h,1,le)|0,h=le,!((o[h>>2]|0)==(d|0)&&(o[h+4>>2]|0)==(y|0))&&(h=le+8|0,!((o[h>>2]|0)==(d|0)&&(o[h+4>>2]|0)==(y|0)))&&(h=le+16|0,!((o[h>>2]|0)==(d|0)&&(o[h+4>>2]|0)==(y|0)))&&(h=le+24|0,!((o[h>>2]|0)==(d|0)&&(o[h+4>>2]|0)==(y|0)))&&(h=le+32|0,!((o[h>>2]|0)==(d|0)&&(o[h+4>>2]|0)==(y|0)))&&(h=le+40|0,!((o[h>>2]|0)==(d|0)&&(o[h+4>>2]|0)==(y|0)))?(I=le+48|0,I=((o[I>>2]|0)==(d|0)?(o[I+4>>2]|0)==(y|0):0)&1):I=1,o[b>>2]=I,b=0,Ze=de,b|0}function fo(u,h,d,y,b){return u=u|0,h=h|0,d=d|0,y=y|0,b=b|0,d=Pl(u,h,d,y)|0,(d|0)==7?(b=11,b|0):(y=it(d|0,0,56)|0,h=h&-2130706433|(et()|0)|268435456,o[b>>2]=u|y,o[b+4>>2]=h,b=0,b|0)}function Ll(u,h,d){return u=u|0,h=h|0,d=d|0,!0&(h&2013265920|0)==268435456?(o[d>>2]=u,o[d+4>>2]=h&-2130706433|134217728,d=0,d|0):(d=6,d|0)}function tA(u,h,d){u=u|0,h=h|0,d=d|0;var y=0,b=0,I=0;return b=Ze,Ze=Ze+16|0,y=b,o[y>>2]=0,!0&(h&2013265920|0)==268435456?(I=Xe(u|0,h|0,56)|0,et()|0,y=Fs(u,h&-2130706433|134217728,I&7,y,d)|0,Ze=b,y|0):(y=6,Ze=b,y|0)}function ms(u,h){u=u|0,h=h|0;var d=0;switch(d=Xe(u|0,h|0,56)|0,et()|0,d&7){case 0:case 7:return d=0,d|0}return d=h&-2130706433|134217728,!(!0&(h&2013265920|0)==268435456)||!0&(h&117440512|0)==16777216&(Nn(u,d)|0)!=0?(d=0,d|0):(d=_A(u,d)|0,d|0)}function Ea(u,h,d){u=u|0,h=h|0,d=d|0;var y=0,b=0,I=0,R=0;return b=Ze,Ze=Ze+16|0,y=b,!0&(h&2013265920|0)==268435456?(I=h&-2130706433|134217728,R=d,o[R>>2]=u,o[R+4>>2]=I,o[y>>2]=0,h=Xe(u|0,h|0,56)|0,et()|0,y=Fs(u,I,h&7,y,d+8|0)|0,Ze=b,y|0):(y=6,Ze=b,y|0)}function Rl(u,h,d){u=u|0,h=h|0,d=d|0;var y=0,b=0;return b=(Nn(u,h)|0)==0,h=h&-2130706433,y=d,o[y>>2]=b?u:0,o[y+4>>2]=b?h|285212672:0,y=d+8|0,o[y>>2]=u,o[y+4>>2]=h|301989888,y=d+16|0,o[y>>2]=u,o[y+4>>2]=h|318767104,y=d+24|0,o[y>>2]=u,o[y+4>>2]=h|335544320,y=d+32|0,o[y>>2]=u,o[y+4>>2]=h|352321536,d=d+40|0,o[d>>2]=u,o[d+4>>2]=h|369098752,0}function qs(u,h,d){u=u|0,h=h|0,d=d|0;var y=0,b=0,I=0,R=0;return R=Ze,Ze=Ze+16|0,b=R,I=h&-2130706433|134217728,!0&(h&2013265920|0)==268435456?(y=Xe(u|0,h|0,56)|0,et()|0,y=Qn(u,I,y&7)|0,(y|0)==-1?(o[d>>2]=0,I=6,Ze=R,I|0):(Rn(u,I,b)|0&&ar(23313,22484,282,22499),h=Xe(u|0,h|0,52)|0,et()|0,h=h&15,Nn(u,I)|0?iA(b,h,y,2,d):Sn(b,h,y,2,d),I=0,Ze=R,I|0)):(I=6,Ze=R,I|0)}function fs(u,h,d){u=u|0,h=h|0,d=d|0;var y=0,b=0;y=Ze,Ze=Ze+16|0,b=y,Fl(u,h,d,b),Wt(b,d+4|0),Ze=y}function Fl(u,h,d,y){u=u|0,h=h|0,d=d|0,y=y|0;var b=0,I=0,R=0,N=0,W=0;if(N=Ze,Ze=Ze+16|0,W=N,FA(u,d,W),I=+eo(+(1-+oe[W>>3]*.5)),I<1e-16){o[y>>2]=0,o[y+4>>2]=0,o[y+8>>2]=0,o[y+12>>2]=0,Ze=N;return}if(W=o[d>>2]|0,b=+oe[15920+(W*24|0)>>3],b=+ll(b-+ll(+Uo(15600+(W<<4)|0,u))),bo(h)|0?R=+ll(b+-.3334731722518321):R=b,b=+hn(+I)/.381966011250105,(h|0)>0){u=0;do b=b*2.6457513110645907,u=u+1|0;while((u|0)!=(h|0))}I=+yi(+R)*b,oe[y>>3]=I,R=+Pi(+R)*b,oe[y+8>>3]=R,Ze=N}function FA(u,h,d){u=u|0,h=h|0,d=d|0;var y=0,b=0,I=0;if(I=Ze,Ze=Ze+32|0,b=I,da(u,b),o[h>>2]=0,oe[d>>3]=5,y=+Ds(16400,b),y<+oe[d>>3]&&(o[h>>2]=0,oe[d>>3]=y),y=+Ds(16424,b),y<+oe[d>>3]&&(o[h>>2]=1,oe[d>>3]=y),y=+Ds(16448,b),y<+oe[d>>3]&&(o[h>>2]=2,oe[d>>3]=y),y=+Ds(16472,b),y<+oe[d>>3]&&(o[h>>2]=3,oe[d>>3]=y),y=+Ds(16496,b),y<+oe[d>>3]&&(o[h>>2]=4,oe[d>>3]=y),y=+Ds(16520,b),y<+oe[d>>3]&&(o[h>>2]=5,oe[d>>3]=y),y=+Ds(16544,b),y<+oe[d>>3]&&(o[h>>2]=6,oe[d>>3]=y),y=+Ds(16568,b),y<+oe[d>>3]&&(o[h>>2]=7,oe[d>>3]=y),y=+Ds(16592,b),y<+oe[d>>3]&&(o[h>>2]=8,oe[d>>3]=y),y=+Ds(16616,b),y<+oe[d>>3]&&(o[h>>2]=9,oe[d>>3]=y),y=+Ds(16640,b),y<+oe[d>>3]&&(o[h>>2]=10,oe[d>>3]=y),y=+Ds(16664,b),y<+oe[d>>3]&&(o[h>>2]=11,oe[d>>3]=y),y=+Ds(16688,b),y<+oe[d>>3]&&(o[h>>2]=12,oe[d>>3]=y),y=+Ds(16712,b),y<+oe[d>>3]&&(o[h>>2]=13,oe[d>>3]=y),y=+Ds(16736,b),y<+oe[d>>3]&&(o[h>>2]=14,oe[d>>3]=y),y=+Ds(16760,b),y<+oe[d>>3]&&(o[h>>2]=15,oe[d>>3]=y),y=+Ds(16784,b),y<+oe[d>>3]&&(o[h>>2]=16,oe[d>>3]=y),y=+Ds(16808,b),y<+oe[d>>3]&&(o[h>>2]=17,oe[d>>3]=y),y=+Ds(16832,b),y<+oe[d>>3]&&(o[h>>2]=18,oe[d>>3]=y),y=+Ds(16856,b),!(y<+oe[d>>3])){Ze=I;return}o[h>>2]=19,oe[d>>3]=y,Ze=I}function Ur(u,h,d,y,b){u=u|0,h=h|0,d=d|0,y=y|0,b=b|0;var I=0,R=0;if(I=+cc(u),I<1e-16){h=15600+(h<<4)|0,o[b>>2]=o[h>>2],o[b+4>>2]=o[h+4>>2],o[b+8>>2]=o[h+8>>2],o[b+12>>2]=o[h+12>>2];return}if(R=+js(+ +oe[u+8>>3],+ +oe[u>>3]),(d|0)>0){u=0;do I=I/2.6457513110645907,u=u+1|0;while((u|0)!=(d|0))}y?(I=I/3,d=(bo(d)|0)==0,I=+Vs(+((d?I:I/2.6457513110645907)*.381966011250105))):(I=+Vs(+(I*.381966011250105)),bo(d)|0&&(R=+ll(R+.3334731722518321))),Qa(15600+(h<<4)|0,+ll(+oe[15920+(h*24|0)>>3]-R),I,b)}function $n(u,h,d){u=u|0,h=h|0,d=d|0;var y=0,b=0;y=Ze,Ze=Ze+16|0,b=y,sr(u+4|0,b),Ur(b,o[u>>2]|0,h,0,d),Ze=y}function iA(u,h,d,y,b){u=u|0,h=h|0,d=d|0,y=y|0,b=b|0;var I=0,R=0,N=0,W=0,K=0,le=0,de=0,ge=0,ke=0,Pe=0,qe=0,ht=0,mt=0,ot=0,ft=0,dt=0,ai=0,Ut=0,Xt=0,qt=0,or=0,qi=0,ji=0,Li=0,ir=0,Ji=0,Or=0,Xi=0;if(Ji=Ze,Ze=Ze+272|0,I=Ji+256|0,ot=Ji+240|0,ji=Ji,Li=Ji+224|0,ir=Ji+208|0,ft=Ji+176|0,dt=Ji+160|0,ai=Ji+192|0,Ut=Ji+144|0,Xt=Ji+128|0,qt=Ji+112|0,or=Ji+96|0,qi=Ji+80|0,o[I>>2]=h,o[ot>>2]=o[u>>2],o[ot+4>>2]=o[u+4>>2],o[ot+8>>2]=o[u+8>>2],o[ot+12>>2]=o[u+12>>2],Vi(ot,I,ji),o[b>>2]=0,ot=y+d+((y|0)==5&1)|0,(ot|0)<=(d|0)){Ze=Ji;return}W=o[I>>2]|0,K=Li+4|0,le=ft+4|0,de=d+5|0,ge=16880+(W<<2)|0,ke=16960+(W<<2)|0,Pe=Xt+8|0,qe=qt+8|0,ht=or+8|0,mt=ir+4|0,N=d;e:for(;;){R=ji+(((N|0)%5|0)<<4)|0,o[ir>>2]=o[R>>2],o[ir+4>>2]=o[R+4>>2],o[ir+8>>2]=o[R+8>>2],o[ir+12>>2]=o[R+12>>2];do;while((Ma(ir,W,0,1)|0)==2);if((N|0)>(d|0)&(bo(h)|0)!=0){if(o[ft>>2]=o[ir>>2],o[ft+4>>2]=o[ir+4>>2],o[ft+8>>2]=o[ir+8>>2],o[ft+12>>2]=o[ir+12>>2],sr(K,dt),y=o[ft>>2]|0,I=o[17040+(y*80|0)+(o[Li>>2]<<2)>>2]|0,o[ft>>2]=o[18640+(y*80|0)+(I*20|0)>>2],R=o[18640+(y*80|0)+(I*20|0)+16>>2]|0,(R|0)>0){u=0;do Bl(le),u=u+1|0;while((u|0)<(R|0))}switch(R=18640+(y*80|0)+(I*20|0)+4|0,o[ai>>2]=o[R>>2],o[ai+4>>2]=o[R+4>>2],o[ai+8>>2]=o[R+8>>2],Dr(ai,(o[ge>>2]|0)*3|0),tn(le,ai,le),Ui(le),sr(le,Ut),Or=+(o[ke>>2]|0),oe[Xt>>3]=Or*3,oe[Pe>>3]=0,Xi=Or*-1.5,oe[qt>>3]=Xi,oe[qe>>3]=Or*2.598076211353316,oe[or>>3]=Xi,oe[ht>>3]=Or*-2.598076211353316,o[17040+((o[ft>>2]|0)*80|0)+(o[ir>>2]<<2)>>2]|0){case 1:{u=qt,y=Xt;break}case 3:{u=or,y=qt;break}case 2:{u=Xt,y=or;break}default:{u=12;break e}}oA(dt,Ut,y,u,qi),Ur(qi,o[ft>>2]|0,W,1,b+8+(o[b>>2]<<4)|0),o[b>>2]=(o[b>>2]|0)+1}if((N|0)<(de|0)&&(sr(mt,ft),Ur(ft,o[ir>>2]|0,W,1,b+8+(o[b>>2]<<4)|0),o[b>>2]=(o[b>>2]|0)+1),o[Li>>2]=o[ir>>2],o[Li+4>>2]=o[ir+4>>2],o[Li+8>>2]=o[ir+8>>2],o[Li+12>>2]=o[ir+12>>2],N=N+1|0,(N|0)>=(ot|0)){u=3;break}}if((u|0)==3){Ze=Ji;return}else(u|0)==12&&ar(22522,22569,571,22579)}function Vi(u,h,d){u=u|0,h=h|0,d=d|0;var y=0,b=0,I=0,R=0,N=0,W=0;W=Ze,Ze=Ze+128|0,y=W+64|0,b=W,I=y,R=20240,N=I+60|0;do o[I>>2]=o[R>>2],I=I+4|0,R=R+4|0;while((I|0)<(N|0));I=b,R=20304,N=I+60|0;do o[I>>2]=o[R>>2],I=I+4|0,R=R+4|0;while((I|0)<(N|0));N=(bo(o[h>>2]|0)|0)==0,y=N?y:b,b=u+4|0,ic(b),mA(b),bo(o[h>>2]|0)|0&&(Zs(b),o[h>>2]=(o[h>>2]|0)+1),o[d>>2]=o[u>>2],h=d+4|0,tn(b,y,h),Ui(h),o[d+16>>2]=o[u>>2],h=d+20|0,tn(b,y+12|0,h),Ui(h),o[d+32>>2]=o[u>>2],h=d+36|0,tn(b,y+24|0,h),Ui(h),o[d+48>>2]=o[u>>2],h=d+52|0,tn(b,y+36|0,h),Ui(h),o[d+64>>2]=o[u>>2],d=d+68|0,tn(b,y+48|0,d),Ui(d),Ze=W}function Ma(u,h,d,y){u=u|0,h=h|0,d=d|0,y=y|0;var b=0,I=0,R=0,N=0,W=0,K=0,le=0,de=0,ge=0,ke=0,Pe=0;if(Pe=Ze,Ze=Ze+32|0,ge=Pe+12|0,N=Pe,ke=u+4|0,de=o[16960+(h<<2)>>2]|0,le=(y|0)!=0,de=le?de*3|0:de,b=o[ke>>2]|0,K=u+8|0,R=o[K>>2]|0,le){if(I=u+12|0,y=o[I>>2]|0,b=R+b+y|0,(b|0)==(de|0))return ke=1,Ze=Pe,ke|0;W=I}else W=u+12|0,y=o[W>>2]|0,b=R+b+y|0;if((b|0)<=(de|0))return ke=0,Ze=Pe,ke|0;do if((y|0)>0){if(y=o[u>>2]|0,(R|0)>0){I=18640+(y*80|0)+60|0,y=u;break}y=18640+(y*80|0)+40|0,d?(Kn(ge,de,0,0),Aa(ke,ge,N),Ta(N),tn(N,ge,ke),I=y,y=u):(I=y,y=u)}else I=18640+((o[u>>2]|0)*80|0)+20|0,y=u;while(!1);if(o[y>>2]=o[I>>2],b=I+16|0,(o[b>>2]|0)>0){y=0;do Bl(ke),y=y+1|0;while((y|0)<(o[b>>2]|0))}return u=I+4|0,o[ge>>2]=o[u>>2],o[ge+4>>2]=o[u+4>>2],o[ge+8>>2]=o[u+8>>2],h=o[16880+(h<<2)>>2]|0,Dr(ge,le?h*3|0:h),tn(ke,ge,ke),Ui(ke),le?y=((o[K>>2]|0)+(o[ke>>2]|0)+(o[W>>2]|0)|0)==(de|0)?1:2:y=2,ke=y,Ze=Pe,ke|0}function os(u,h){u=u|0,h=h|0;var d=0;do d=Ma(u,h,0,1)|0;while((d|0)==2);return d|0}function Sn(u,h,d,y,b){u=u|0,h=h|0,d=d|0,y=y|0,b=b|0;var I=0,R=0,N=0,W=0,K=0,le=0,de=0,ge=0,ke=0,Pe=0,qe=0,ht=0,mt=0,ot=0,ft=0,dt=0,ai=0,Ut=0,Xt=0,qt=0,or=0,qi=0,ji=0;if(or=Ze,Ze=Ze+240|0,I=or+224|0,ai=or+208|0,Ut=or,Xt=or+192|0,qt=or+176|0,ht=or+160|0,mt=or+144|0,ot=or+128|0,ft=or+112|0,dt=or+96|0,o[I>>2]=h,o[ai>>2]=o[u>>2],o[ai+4>>2]=o[u+4>>2],o[ai+8>>2]=o[u+8>>2],o[ai+12>>2]=o[u+12>>2],Ga(ai,I,Ut),o[b>>2]=0,qe=y+d+((y|0)==6&1)|0,(qe|0)<=(d|0)){Ze=or;return}W=o[I>>2]|0,K=d+6|0,le=16960+(W<<2)|0,de=mt+8|0,ge=ot+8|0,ke=ft+8|0,Pe=Xt+4|0,R=0,N=d,y=-1;e:for(;;){if(I=(N|0)%6|0,u=Ut+(I<<4)|0,o[Xt>>2]=o[u>>2],o[Xt+4>>2]=o[u+4>>2],o[Xt+8>>2]=o[u+8>>2],o[Xt+12>>2]=o[u+12>>2],u=R,R=Ma(Xt,W,0,1)|0,(N|0)>(d|0)&(bo(h)|0)!=0&&(u|0)!=1&&(o[Xt>>2]|0)!=(y|0)){switch(sr(Ut+(((I+5|0)%6|0)<<4)+4|0,qt),sr(Ut+(I<<4)+4|0,ht),qi=+(o[le>>2]|0),oe[mt>>3]=qi*3,oe[de>>3]=0,ji=qi*-1.5,oe[ot>>3]=ji,oe[ge>>3]=qi*2.598076211353316,oe[ft>>3]=ji,oe[ke>>3]=qi*-2.598076211353316,I=o[ai>>2]|0,o[17040+(I*80|0)+(((y|0)==(I|0)?o[Xt>>2]|0:y)<<2)>>2]|0){case 1:{u=ot,y=mt;break}case 3:{u=ft,y=ot;break}case 2:{u=mt,y=ft;break}default:{u=8;break e}}oA(qt,ht,y,u,dt),!(Tl(qt,dt)|0)&&!(Tl(ht,dt)|0)&&(Ur(dt,o[ai>>2]|0,W,1,b+8+(o[b>>2]<<4)|0),o[b>>2]=(o[b>>2]|0)+1)}if((N|0)<(K|0)&&(sr(Pe,qt),Ur(qt,o[Xt>>2]|0,W,1,b+8+(o[b>>2]<<4)|0),o[b>>2]=(o[b>>2]|0)+1),N=N+1|0,(N|0)>=(qe|0)){u=3;break}else y=o[Xt>>2]|0}if((u|0)==3){Ze=or;return}else(u|0)==8&&ar(22606,22569,736,22651)}function Ga(u,h,d){u=u|0,h=h|0,d=d|0;var y=0,b=0,I=0,R=0,N=0,W=0;W=Ze,Ze=Ze+160|0,y=W+80|0,b=W,I=y,R=20368,N=I+72|0;do o[I>>2]=o[R>>2],I=I+4|0,R=R+4|0;while((I|0)<(N|0));I=b,R=20448,N=I+72|0;do o[I>>2]=o[R>>2],I=I+4|0,R=R+4|0;while((I|0)<(N|0));N=(bo(o[h>>2]|0)|0)==0,y=N?y:b,b=u+4|0,ic(b),mA(b),bo(o[h>>2]|0)|0&&(Zs(b),o[h>>2]=(o[h>>2]|0)+1),o[d>>2]=o[u>>2],h=d+4|0,tn(b,y,h),Ui(h),o[d+16>>2]=o[u>>2],h=d+20|0,tn(b,y+12|0,h),Ui(h),o[d+32>>2]=o[u>>2],h=d+36|0,tn(b,y+24|0,h),Ui(h),o[d+48>>2]=o[u>>2],h=d+52|0,tn(b,y+36|0,h),Ui(h),o[d+64>>2]=o[u>>2],h=d+68|0,tn(b,y+48|0,h),Ui(h),o[d+80>>2]=o[u>>2],d=d+84|0,tn(b,y+60|0,d),Ui(d),Ze=W}function zc(u,h){return u=u|0,h=h|0,h=Xe(u|0,h|0,52)|0,et()|0,h&15|0}function sl(u,h){return u=u|0,h=h|0,h=Xe(u|0,h|0,45)|0,et()|0,h&127|0}function _A(u,h){u=u|0,h=h|0;var d=0,y=0,b=0,I=0,R=0,N=0;if(!(!0&(h&-16777216|0)==134217728)||(R=Xe(u|0,h|0,45)|0,et()|0,R=R&127,R>>>0>121))return h=0,h|0;d=Xe(u|0,h|0,52)|0,et()|0,d=d&15;do if(d|0){for(b=1,y=0;;){if(I=Xe(u|0,h|0,(15-b|0)*3|0)|0,et()|0,I=I&7,(I|0)!=0&(y^1))if((I|0)==1&(qn(R)|0)!=0){N=0,y=13;break}else y=1;if((I|0)==7){N=0,y=13;break}if(b>>>0<d>>>0)b=b+1|0;else{y=9;break}}if((y|0)==9){if((d|0)==15)N=1;else break;return N|0}else if((y|0)==13)return N|0}while(!1);for(;;){if(N=Xe(u|0,h|0,(14-d|0)*3|0)|0,et()|0,!((N&7|0)==7&!0)){N=0,y=13;break}if(d>>>0<14)d=d+1|0;else{N=1,y=13;break}}return(y|0)==13?N|0:0}function No(u,h,d,y){u=u|0,h=h|0,d=d|0,y=y|0;var b=0,I=0;if(I=Xe(u|0,h|0,52)|0,et()|0,I=I&15,d>>>0>15)return y=4,y|0;if((I|0)<(d|0))return y=12,y|0;if((I|0)==(d|0))return o[y>>2]=u,o[y+4>>2]=h,y=0,y|0;if(b=it(d|0,0,52)|0,b=b|u,u=et()|0|h&-15728641,(I|0)>(d|0))do h=it(7,0,(14-d|0)*3|0)|0,d=d+1|0,b=h|b,u=et()|0|u;while((d|0)<(I|0));return o[y>>2]=b,o[y+4>>2]=u,y=0,y|0}function yl(u,h,d,y){u=u|0,h=h|0,d=d|0,y=y|0;var b=0,I=0,R=0;if(I=Xe(u|0,h|0,52)|0,et()|0,I=I&15,!((d|0)<16&(I|0)<=(d|0)))return y=4,y|0;b=d-I|0,d=Xe(u|0,h|0,45)|0,et()|0;e:do if(!(qn(d&127)|0))d=fa(7,0,b,((b|0)<0)<<31>>31)|0,b=et()|0;else{t:do if(I|0){for(d=1;R=it(7,0,(15-d|0)*3|0)|0,!!((R&u|0)==0&((et()|0)&h|0)==0);)if(d>>>0<I>>>0)d=d+1|0;else break t;d=fa(7,0,b,((b|0)<0)<<31>>31)|0,b=et()|0;break e}while(!1);d=fa(7,0,b,((b|0)<0)<<31>>31)|0,d=ue(d|0,et()|0,5,0)|0,d=M(d|0,et()|0,-5,-1)|0,d=Q(d|0,et()|0,6,0)|0,d=M(d|0,et()|0,1,0)|0,b=et()|0}while(!1);return R=y,o[R>>2]=d,o[R+4>>2]=b,R=0,R|0}function Nn(u,h){u=u|0,h=h|0;var d=0,y=0,b=0;if(b=Xe(u|0,h|0,45)|0,et()|0,!(qn(b&127)|0))return b=0,b|0;b=Xe(u|0,h|0,52)|0,et()|0,b=b&15;e:do if(!b)d=0;else for(y=1;;){if(d=Xe(u|0,h|0,(15-y|0)*3|0)|0,et()|0,d=d&7,d|0)break e;if(y>>>0<b>>>0)y=y+1|0;else{d=0;break}}while(!1);return b=(d|0)==0&1,b|0}function Bc(u,h,d,y){u=u|0,h=h|0,d=d|0,y=y|0;var b=0,I=0,R=0,N=0;if(R=Ze,Ze=Ze+16|0,I=R,Mt(I,u,h,d),h=I,u=o[h>>2]|0,h=o[h+4>>2]|0,(u|0)==0&(h|0)==0)return Ze=R,0;b=0,d=0;do N=y+(b<<3)|0,o[N>>2]=u,o[N+4>>2]=h,b=M(b|0,d|0,1,0)|0,d=et()|0,nc(I),N=I,u=o[N>>2]|0,h=o[N+4>>2]|0;while(!((u|0)==0&(h|0)==0));return Ze=R,0}function gA(u,h,d,y){return u=u|0,h=h|0,d=d|0,y=y|0,(y|0)<(d|0)?(d=h,y=u,Ci(d|0),y|0):(d=it(-1,-1,((y-d|0)*3|0)+3|0)|0,y=it(~d|0,~(et()|0)|0,(15-y|0)*3|0)|0,d=~(et()|0)&h,y=~y&u,Ci(d|0),y|0)}function ol(u,h,d,y){u=u|0,h=h|0,d=d|0,y=y|0;var b=0;return b=Xe(u|0,h|0,52)|0,et()|0,b=b&15,(d|0)<16&(b|0)<=(d|0)?((b|0)<(d|0)&&(b=it(-1,-1,((d+-1-b|0)*3|0)+3|0)|0,b=it(~b|0,~(et()|0)|0,(15-d|0)*3|0)|0,h=~(et()|0)&h,u=~b&u),b=it(d|0,0,52)|0,d=h&-15728641|(et()|0),o[y>>2]=u|b,o[y+4>>2]=d,y=0,y|0):(y=4,y|0)}function Za(u,h,d,y){u=u|0,h=h|0,d=d|0,y=y|0;var b=0,I=0,R=0,N=0,W=0,K=0,le=0,de=0,ge=0,ke=0,Pe=0,qe=0,ht=0,mt=0,ot=0,ft=0,dt=0,ai=0,Ut=0,Xt=0,qt=0;if((d|0)==0&(y|0)==0)return Xt=0,Xt|0;if(b=u,I=o[b>>2]|0,b=o[b+4>>2]|0,!0&(b&15728640|0)==0){if(!((y|0)>0|(y|0)==0&d>>>0>0)||(Xt=h,o[Xt>>2]=I,o[Xt+4>>2]=b,(d|0)==1&(y|0)==0))return Xt=0,Xt|0;b=1;do ai=u+(b<<3)|0,Ut=o[ai+4>>2]|0,Xt=h+(b<<3)|0,o[Xt>>2]=o[ai>>2],o[Xt+4>>2]=Ut,b=b+1|0;while(0<(y|0)|(y|0)==0&b>>>0<d>>>0);return b=0,b|0}if(dt=d<<3,Ut=Hn(dt)|0,!Ut)return Xt=13,Xt|0;if(S(Ut|0,u|0,dt|0)|0,ai=T(d,8)|0,!ai)return x(Ut),Xt=13,Xt|0;e:do if(d|0){t:for(;;){b=Ut,mt=o[b>>2]|0,b=o[b+4>>2]|0,ot=Xe(mt|0,b|0,52)|0,et()|0,ot=ot&15,ft=ot+-1|0,ht=(d|0)>0;i:do if((ot|0)!=0&ht){if(ke=((d|0)<0)<<31>>31,Pe=it(ft|0,0,52)|0,qe=et()|0,ft>>>0>15){if(!((mt|0)==0&(b|0)==0)){Xt=17;break t}for(I=0;;){if(I=I+1|0,(I|0)>=(d|0))break i;if(y=Ut+(I<<3)|0,qe=o[y>>2]|0,y=o[y+4>>2]|0,!((qe|0)==0&(y|0)==0)){b=y,Xt=17;break t}}}for(I=0,u=mt,y=b;;){if(!((u|0)==0&(y|0)==0)){if(!(!0&(y&117440512|0)==0)){Xt=22;break t}if(N=Xe(u|0,y|0,52)|0,et()|0,N=N&15,(N|0)<(ft|0)){b=12,Xt=28;break t}if((N|0)!=(ft|0)&&(u=u|Pe,y=y&-15728641|qe,N>>>0>=ot>>>0)){R=ft;do ge=it(7,0,(14-R|0)*3|0)|0,R=R+1|0,u=ge|u,y=et()|0|y;while(R>>>0<N>>>0)}if(R=ze(u|0,y|0,d|0,ke|0)|0,et()|0,K=ai+(R<<3)|0,N=K,W=o[N>>2]|0,N=o[N+4>>2]|0,(W|0)==0&(N|0)==0)R=K;else for(ge=0;;){if((ge|0)>(d|0)){Xt=32;break t}if((W|0)==(u|0)&(N&-117440513|0)==(y|0)){le=Xe(W|0,N|0,56)|0,et()|0,le=le&7,de=le+1|0,qt=Xe(W|0,N|0,45)|0,et()|0;r:do if(!(qn(qt&127)|0))N=7;else{if(W=Xe(W|0,N|0,52)|0,et()|0,W=W&15,!W){N=6;break}for(N=1;;){if(qt=it(7,0,(15-N|0)*3|0)|0,!((qt&u|0)==0&((et()|0)&y|0)==0)){N=7;break r}if(N>>>0<W>>>0)N=N+1|0;else{N=6;break}}}while(!1);if((le+2|0)>>>0>N>>>0){Xt=42;break t}qt=it(de|0,0,56)|0,y=et()|0|y&-117440513,de=K,o[de>>2]=0,o[de+4>>2]=0,u=qt|u}else R=(R+1|0)%(d|0)|0;if(K=ai+(R<<3)|0,N=K,W=o[N>>2]|0,N=o[N+4>>2]|0,(W|0)==0&(N|0)==0){R=K;break}else ge=ge+1|0}qt=R,o[qt>>2]=u,o[qt+4>>2]=y}if(I=I+1|0,(I|0)>=(d|0))break i;y=Ut+(I<<3)|0,u=o[y>>2]|0,y=o[y+4>>2]|0}}while(!1);if((d+5|0)>>>0<11){Xt=85;break}if(qe=T((d|0)/6|0,8)|0,!qe){Xt=49;break}i:do if(ht){ge=0,de=0;do{if(N=ai+(ge<<3)|0,y=N,I=o[y>>2]|0,y=o[y+4>>2]|0,!((I|0)==0&(y|0)==0)){W=Xe(I|0,y|0,56)|0,et()|0,W=W&7,u=W+1|0,K=y&-117440513,qt=Xe(I|0,y|0,45)|0,et()|0;r:do if(qn(qt&127)|0){if(le=Xe(I|0,y|0,52)|0,et()|0,le=le&15,le|0)for(R=1;;){if(qt=it(7,0,(15-R|0)*3|0)|0,!((I&qt|0)==0&(K&(et()|0)|0)==0))break r;if(R>>>0<le>>>0)R=R+1|0;else break}y=it(u|0,0,56)|0,I=y|I,y=et()|0|K,u=N,o[u>>2]=I,o[u+4>>2]=y,u=W+2|0}while(!1);(u|0)==7&&(qt=qe+(de<<3)|0,o[qt>>2]=I,o[qt+4>>2]=y&-117440513,de=de+1|0)}ge=ge+1|0}while((ge|0)!=(d|0));if(ht){if(ge=((d|0)<0)<<31>>31,ke=it(ft|0,0,52)|0,Pe=et()|0,ft>>>0>15){if(!((mt|0)==0&(b|0)==0)){b=4,Xt=84;break t}for(b=0;;){if(b=b+1|0,(b|0)>=(d|0)){I=0,b=de;break i}if(qt=Ut+(b<<3)|0,!((o[qt>>2]|0)==0&(o[qt+4>>2]|0)==0)){b=4,Xt=84;break t}}}for(le=0,I=0,K=mt;;){do if(!((K|0)==0&(b|0)==0)){if(N=Xe(K|0,b|0,52)|0,et()|0,N=N&15,(N|0)<(ft|0)){b=12,Xt=84;break t}do if((N|0)==(ft|0))y=K,N=b;else{if(y=K|ke,u=b&-15728641|Pe,N>>>0<ot>>>0){N=u;break}R=ft;do qt=it(7,0,(14-R|0)*3|0)|0,R=R+1|0,y=qt|y,u=et()|0|u;while(R>>>0<N>>>0);N=u}while(!1);for(R=ze(y|0,N|0,d|0,ge|0)|0,et()|0,u=0;;){if((u|0)>(d|0)){Xt=77;break t}if(qt=ai+(R<<3)|0,W=o[qt+4>>2]|0,(W&-117440513|0)==(N|0)&&(o[qt>>2]|0)==(y|0)){Xt=79;break}if(R=(R+1|0)%(d|0)|0,qt=ai+(R<<3)|0,(o[qt>>2]|0)==(y|0)&&(o[qt+4>>2]|0)==(N|0))break;u=u+1|0}if((Xt|0)==79&&(Xt=0,!0&(W&117440512|0)==100663296))break;qt=h+(I<<3)|0,o[qt>>2]=K,o[qt+4>>2]=b,I=I+1|0}while(!1);if(b=le+1|0,(b|0)>=(d|0)){b=de;break i}qt=Ut+(b<<3)|0,le=b,K=o[qt>>2]|0,b=o[qt+4>>2]|0}}else I=0,b=de}else I=0,b=0;while(!1);if(k(ai|0,0,dt|0)|0,S(Ut|0,qe|0,b<<3|0)|0,x(qe),b)h=h+(I<<3)|0,d=b;else break e}if((Xt|0)==17)!0&(b&117440512|0)==0?(b=4,Xt=28):Xt=22;else if((Xt|0)==32)ar(23313,22674,362,22684);else{if((Xt|0)==42)return x(Ut),x(ai),qt=10,qt|0;if((Xt|0)==49)return x(Ut),x(ai),qt=13,qt|0;if((Xt|0)==77)ar(23313,22674,462,22684);else{if((Xt|0)==84)return x(qe),x(Ut),x(ai),qt=b,qt|0;if((Xt|0)==85){S(h|0,Ut|0,d<<3|0)|0;break}}}if((Xt|0)==22)return x(Ut),x(ai),qt=5,qt|0;if((Xt|0)==28)return x(Ut),x(ai),qt=b,qt|0}while(!1);return x(Ut),x(ai),qt=0,qt|0}function Cu(u,h,d,y,b,I,R){u=u|0,h=h|0,d=d|0,y=y|0,b=b|0,I=I|0,R=R|0;var N=0,W=0,K=0,le=0,de=0,ge=0,ke=0,Pe=0,qe=0;if(qe=Ze,Ze=Ze+16|0,Pe=qe,!((d|0)>0|(d|0)==0&h>>>0>0))return Pe=0,Ze=qe,Pe|0;if((R|0)>=16)return Pe=12,Ze=qe,Pe|0;ge=0,ke=0,de=0,N=0;e:for(;;){if(K=u+(ge<<3)|0,W=o[K>>2]|0,K=o[K+4>>2]|0,le=Xe(W|0,K|0,52)|0,et()|0,(le&15|0)>(R|0)){N=12,W=11;break}if(Mt(Pe,W,K,R),le=Pe,K=o[le>>2]|0,le=o[le+4>>2]|0,(K|0)==0&(le|0)==0)W=de;else{W=de;do{if(!((N|0)<(I|0)|(N|0)==(I|0)&W>>>0<b>>>0)){W=10;break e}de=y+(W<<3)|0,o[de>>2]=K,o[de+4>>2]=le,W=M(W|0,N|0,1,0)|0,N=et()|0,nc(Pe),de=Pe,K=o[de>>2]|0,le=o[de+4>>2]|0}while(!((K|0)==0&(le|0)==0))}if(ge=M(ge|0,ke|0,1,0)|0,ke=et()|0,(ke|0)<(d|0)|(ke|0)==(d|0)&ge>>>0<h>>>0)de=W;else{N=0,W=11;break}}return(W|0)==10?(Pe=14,Ze=qe,Pe|0):(W|0)==11?(Ze=qe,N|0):0}function Os(u,h,d,y,b){u=u|0,h=h|0,d=d|0,y=y|0,b=b|0;var I=0,R=0,N=0,W=0,K=0,le=0,de=0,ge=0;ge=Ze,Ze=Ze+16|0,de=ge;e:do if((d|0)>0|(d|0)==0&h>>>0>0){for(K=0,R=0,I=0,le=0;;){if(W=u+(K<<3)|0,N=o[W>>2]|0,W=o[W+4>>2]|0,!((N|0)==0&(W|0)==0)&&(W=(yl(N,W,y,de)|0)==0,N=de,R=M(o[N>>2]|0,o[N+4>>2]|0,R|0,I|0)|0,I=et()|0,!W)){I=12;break}if(K=M(K|0,le|0,1,0)|0,le=et()|0,!((le|0)<(d|0)|(le|0)==(d|0)&K>>>0<h>>>0))break e}return Ze=ge,I|0}else R=0,I=0;while(!1);return o[b>>2]=R,o[b+4>>2]=I,b=0,Ze=ge,b|0}function Qs(u,h){return u=u|0,h=h|0,h=Xe(u|0,h|0,52)|0,et()|0,h&1|0}function po(u,h){u=u|0,h=h|0;var d=0,y=0,b=0;if(b=Xe(u|0,h|0,52)|0,et()|0,b=b&15,!b)return b=0,b|0;for(y=1;;){if(d=Xe(u|0,h|0,(15-y|0)*3|0)|0,et()|0,d=d&7,d|0){y=5;break}if(y>>>0<b>>>0)y=y+1|0;else{d=0,y=5;break}}return(y|0)==5?d|0:0}function ua(u,h){u=u|0,h=h|0;var d=0,y=0,b=0,I=0,R=0,N=0,W=0;if(W=Xe(u|0,h|0,52)|0,et()|0,W=W&15,!W)return N=h,W=u,Ci(N|0),W|0;for(N=1,d=0;;){I=(15-N|0)*3|0,y=it(7,0,I|0)|0,b=et()|0,R=Xe(u|0,h|0,I|0)|0,et()|0,I=it(nl(R&7)|0,0,I|0)|0,R=et()|0,u=I|u&~y,h=R|h&~b;e:do if(!d)if((I&y|0)==0&(R&b|0)==0)d=0;else if(y=Xe(u|0,h|0,52)|0,et()|0,y=y&15,!y)d=1;else{d=1;t:for(;;){switch(R=Xe(u|0,h|0,(15-d|0)*3|0)|0,et()|0,R&7){case 1:break t;case 0:break;default:{d=1;break e}}if(d>>>0<y>>>0)d=d+1|0;else{d=1;break e}}for(d=1;;)if(R=(15-d|0)*3|0,b=Xe(u|0,h|0,R|0)|0,et()|0,I=it(7,0,R|0)|0,h=h&~(et()|0),R=it(nl(b&7)|0,0,R|0)|0,u=u&~I|R,h=h|(et()|0),d>>>0<y>>>0)d=d+1|0;else{d=1;break}}while(!1);if(N>>>0<W>>>0)N=N+1|0;else break}return Ci(h|0),u|0}function xl(u,h){u=u|0,h=h|0;var d=0,y=0,b=0,I=0,R=0;if(y=Xe(u|0,h|0,52)|0,et()|0,y=y&15,!y)return d=h,y=u,Ci(d|0),y|0;for(d=1;I=(15-d|0)*3|0,R=Xe(u|0,h|0,I|0)|0,et()|0,b=it(7,0,I|0)|0,h=h&~(et()|0),I=it(nl(R&7)|0,0,I|0)|0,u=I|u&~b,h=et()|0|h,d>>>0<y>>>0;)d=d+1|0;return Ci(h|0),u|0}function ou(u,h){u=u|0,h=h|0;var d=0,y=0,b=0,I=0,R=0,N=0,W=0;if(W=Xe(u|0,h|0,52)|0,et()|0,W=W&15,!W)return N=h,W=u,Ci(N|0),W|0;for(N=1,d=0;;){I=(15-N|0)*3|0,y=it(7,0,I|0)|0,b=et()|0,R=Xe(u|0,h|0,I|0)|0,et()|0,I=it(Va(R&7)|0,0,I|0)|0,R=et()|0,u=I|u&~y,h=R|h&~b;e:do if(!d)if((I&y|0)==0&(R&b|0)==0)d=0;else if(y=Xe(u|0,h|0,52)|0,et()|0,y=y&15,!y)d=1;else{d=1;t:for(;;){switch(R=Xe(u|0,h|0,(15-d|0)*3|0)|0,et()|0,R&7){case 1:break t;case 0:break;default:{d=1;break e}}if(d>>>0<y>>>0)d=d+1|0;else{d=1;break e}}for(d=1;;)if(b=(15-d|0)*3|0,I=it(7,0,b|0)|0,R=h&~(et()|0),h=Xe(u|0,h|0,b|0)|0,et()|0,h=it(Va(h&7)|0,0,b|0)|0,u=u&~I|h,h=R|(et()|0),d>>>0<y>>>0)d=d+1|0;else{d=1;break}}while(!1);if(N>>>0<W>>>0)N=N+1|0;else break}return Ci(h|0),u|0}function rc(u,h){u=u|0,h=h|0;var d=0,y=0,b=0,I=0,R=0;if(y=Xe(u|0,h|0,52)|0,et()|0,y=y&15,!y)return d=h,y=u,Ci(d|0),y|0;for(d=1;R=(15-d|0)*3|0,I=it(7,0,R|0)|0,b=h&~(et()|0),h=Xe(u|0,h|0,R|0)|0,et()|0,h=it(Va(h&7)|0,0,R|0)|0,u=h|u&~I,h=et()|0|b,d>>>0<y>>>0;)d=d+1|0;return Ci(h|0),u|0}function io(u,h){u=u|0,h=h|0;var d=0,y=0,b=0,I=0,R=0,N=0,W=0,K=0,le=0;if(W=Ze,Ze=Ze+64|0,N=W+40|0,y=W+24|0,b=W+12|0,I=W,it(h|0,0,52)|0,d=et()|0|134225919,!h)return(o[u+4>>2]|0)>2||(o[u+8>>2]|0)>2||(o[u+12>>2]|0)>2?(R=0,N=0,Ci(R|0),Ze=W,N|0):(it(Jt(u)|0,0,45)|0,R=et()|0|d,N=-1,Ci(R|0),Ze=W,N|0);if(o[N>>2]=o[u>>2],o[N+4>>2]=o[u+4>>2],o[N+8>>2]=o[u+8>>2],o[N+12>>2]=o[u+12>>2],R=N+4|0,(h|0)>0)for(u=-1;o[y>>2]=o[R>>2],o[y+4>>2]=o[R+4>>2],o[y+8>>2]=o[R+8>>2],h&1?(ho(R),o[b>>2]=o[R>>2],o[b+4>>2]=o[R+4>>2],o[b+8>>2]=o[R+8>>2],gl(b)):(Jn(R),o[b>>2]=o[R>>2],o[b+4>>2]=o[R+4>>2],o[b+8>>2]=o[R+8>>2],Zs(b)),Aa(y,b,I),Ui(I),le=(15-h|0)*3|0,K=it(7,0,le|0)|0,d=d&~(et()|0),le=it(ba(I)|0,0,le|0)|0,u=le|u&~K,d=et()|0|d,(h|0)>1;)h=h+-1|0;else u=-1;e:do if((o[R>>2]|0)<=2&&(o[N+8>>2]|0)<=2&&(o[N+12>>2]|0)<=2){if(y=Jt(N)|0,h=it(y|0,0,45)|0,h=h|u,u=et()|0|d&-1040385,I=$i(N)|0,!(qn(y)|0)){if((I|0)<=0)break;for(b=0;;){if(y=Xe(h|0,u|0,52)|0,et()|0,y=y&15,y)for(d=1;le=(15-d|0)*3|0,N=Xe(h|0,u|0,le|0)|0,et()|0,K=it(7,0,le|0)|0,u=u&~(et()|0),le=it(nl(N&7)|0,0,le|0)|0,h=h&~K|le,u=u|(et()|0),d>>>0<y>>>0;)d=d+1|0;if(b=b+1|0,(b|0)==(I|0))break e}}b=Xe(h|0,u|0,52)|0,et()|0,b=b&15;t:do if(b){d=1;i:for(;;){switch(le=Xe(h|0,u|0,(15-d|0)*3|0)|0,et()|0,le&7){case 1:break i;case 0:break;default:break t}if(d>>>0<b>>>0)d=d+1|0;else break t}if(gi(y,o[N>>2]|0)|0)for(d=1;N=(15-d|0)*3|0,K=it(7,0,N|0)|0,le=u&~(et()|0),u=Xe(h|0,u|0,N|0)|0,et()|0,u=it(Va(u&7)|0,0,N|0)|0,h=h&~K|u,u=le|(et()|0),d>>>0<b>>>0;)d=d+1|0;else for(d=1;le=(15-d|0)*3|0,N=Xe(h|0,u|0,le|0)|0,et()|0,K=it(7,0,le|0)|0,u=u&~(et()|0),le=it(nl(N&7)|0,0,le|0)|0,h=h&~K|le,u=u|(et()|0),d>>>0<b>>>0;)d=d+1|0}while(!1);if((I|0)>0){d=0;do h=ua(h,u)|0,u=et()|0,d=d+1|0;while((d|0)!=(I|0))}}else h=0,u=0;while(!1);return K=u,le=h,Ci(K|0),Ze=W,le|0}function bo(u){return u=u|0,(u|0)%2|0|0}function ta(u,h,d){u=u|0,h=h|0,d=d|0;var y=0,b=0;return b=Ze,Ze=Ze+16|0,y=b,h>>>0>15?(y=4,Ze=b,y|0):(o[u+4>>2]&2146435072|0)==2146435072||(o[u+8+4>>2]&2146435072|0)==2146435072?(y=3,Ze=b,y|0):(fs(u,h,y),h=io(y,h)|0,y=et()|0,o[d>>2]=h,o[d+4>>2]=y,(h|0)==0&(y|0)==0&&ar(23313,22674,786,22697),y=0,Ze=b,y|0)}function OA(u,h,d){u=u|0,h=h|0,d=d|0;var y=0,b=0,I=0,R=0;if(b=d+4|0,I=Xe(u|0,h|0,52)|0,et()|0,I=I&15,R=Xe(u|0,h|0,45)|0,et()|0,y=(I|0)==0,qn(R&127)|0){if(y)return R=1,R|0;y=1}else{if(y)return R=0,R|0;!(o[b>>2]|0)&&!(o[d+8>>2]|0)?y=(o[d+12>>2]|0)!=0&1:y=1}for(d=1;d&1?gl(b):Zs(b),R=Xe(u|0,h|0,(15-d|0)*3|0)|0,et()|0,wa(b,R&7),d>>>0<I>>>0;)d=d+1|0;return y|0}function Rn(u,h,d){u=u|0,h=h|0,d=d|0;var y=0,b=0,I=0,R=0,N=0,W=0,K=0,le=0;if(le=Ze,Ze=Ze+16|0,W=le,K=Xe(u|0,h|0,45)|0,et()|0,K=K&127,K>>>0>121)return o[d>>2]=0,o[d+4>>2]=0,o[d+8>>2]=0,o[d+12>>2]=0,K=5,Ze=le,K|0;e:do if(qn(K)|0&&(I=Xe(u|0,h|0,52)|0,et()|0,I=I&15,(I|0)!=0)){y=1;t:for(;;){switch(N=Xe(u|0,h|0,(15-y|0)*3|0)|0,et()|0,N&7){case 5:break t;case 0:break;default:{y=h;break e}}if(y>>>0<I>>>0)y=y+1|0;else{y=h;break e}}for(b=1,y=h;h=(15-b|0)*3|0,R=it(7,0,h|0)|0,N=y&~(et()|0),y=Xe(u|0,y|0,h|0)|0,et()|0,y=it(Va(y&7)|0,0,h|0)|0,u=u&~R|y,y=N|(et()|0),b>>>0<I>>>0;)b=b+1|0}else y=h;while(!1);if(N=7696+(K*28|0)|0,o[d>>2]=o[N>>2],o[d+4>>2]=o[N+4>>2],o[d+8>>2]=o[N+8>>2],o[d+12>>2]=o[N+12>>2],!(OA(u,y,d)|0))return K=0,Ze=le,K|0;if(R=d+4|0,o[W>>2]=o[R>>2],o[W+4>>2]=o[R+4>>2],o[W+8>>2]=o[R+8>>2],I=Xe(u|0,y|0,52)|0,et()|0,N=I&15,I&1?(Zs(R),I=N+1|0):I=N,!(qn(K)|0))y=0;else{e:do if(!N)y=0;else for(h=1;;){if(b=Xe(u|0,y|0,(15-h|0)*3|0)|0,et()|0,b=b&7,b|0){y=b;break e}if(h>>>0<N>>>0)h=h+1|0;else{y=0;break}}while(!1);y=(y|0)==4&1}if(!(Ma(d,I,y,0)|0))(I|0)!=(N|0)&&(o[R>>2]=o[W>>2],o[R+4>>2]=o[W+4>>2],o[R+8>>2]=o[W+8>>2]);else{if(qn(K)|0)do;while(Ma(d,I,0,0)|0);(I|0)!=(N|0)&&Jn(R)}return K=0,Ze=le,K|0}function Sa(u,h,d){u=u|0,h=h|0,d=d|0;var y=0,b=0,I=0;return I=Ze,Ze=Ze+16|0,y=I,b=Rn(u,h,y)|0,b|0?(Ze=I,b|0):(b=Xe(u|0,h|0,52)|0,et()|0,$n(y,b&15,d),b=0,Ze=I,b|0)}function Un(u,h,d){u=u|0,h=h|0,d=d|0;var y=0,b=0,I=0,R=0,N=0;if(R=Ze,Ze=Ze+16|0,I=R,y=Rn(u,h,I)|0,y|0)return I=y,Ze=R,I|0;y=Xe(u|0,h|0,45)|0,et()|0,y=(qn(y&127)|0)==0,b=Xe(u|0,h|0,52)|0,et()|0,b=b&15;e:do if(!y){if(b|0)for(y=1;;){if(N=it(7,0,(15-y|0)*3|0)|0,!((N&u|0)==0&((et()|0)&h|0)==0))break e;if(y>>>0<b>>>0)y=y+1|0;else break}return iA(I,b,0,5,d),N=0,Ze=R,N|0}while(!1);return Sn(I,b,0,6,d),N=0,Ze=R,N|0}function qa(u,h,d){u=u|0,h=h|0,d=d|0;var y=0,b=0,I=0;if(b=Xe(u|0,h|0,45)|0,et()|0,!(qn(b&127)|0))return b=2,o[d>>2]=b,0;if(b=Xe(u|0,h|0,52)|0,et()|0,b=b&15,!b)return b=5,o[d>>2]=b,0;for(y=1;;){if(I=it(7,0,(15-y|0)*3|0)|0,!((I&u|0)==0&((et()|0)&h|0)==0)){y=2,u=6;break}if(y>>>0<b>>>0)y=y+1|0;else{y=5,u=6;break}}return(u|0)==6&&(o[d>>2]=y),0}function al(u,h,d){u=u|0,h=h|0,d=d|0;var y=0,b=0,I=0,R=0,N=0,W=0,K=0,le=0,de=0;de=Ze,Ze=Ze+128|0,K=de+112|0,I=de+96|0,le=de,b=Xe(u|0,h|0,52)|0,et()|0,N=b&15,o[K>>2]=N,R=Xe(u|0,h|0,45)|0,et()|0,R=R&127;e:do if(qn(R)|0){if(N|0)for(y=1;;){if(W=it(7,0,(15-y|0)*3|0)|0,!((W&u|0)==0&((et()|0)&h|0)==0)){b=0;break e}if(y>>>0<N>>>0)y=y+1|0;else break}if(b&1)b=1;else return W=it(N+1|0,0,52)|0,le=et()|0|h&-15728641,K=it(7,0,(14-N|0)*3|0)|0,le=al((W|u)&~K,le&~(et()|0),d)|0,Ze=de,le|0}else b=0;while(!1);if(y=Rn(u,h,I)|0,!y){b?(Vi(I,K,le),W=5):(Ga(I,K,le),W=6);e:do if(qn(R)|0)if(!N)u=5;else for(y=1;;){if(R=it(7,0,(15-y|0)*3|0)|0,!((R&u|0)==0&((et()|0)&h|0)==0)){u=2;break e}if(y>>>0<N>>>0)y=y+1|0;else{u=5;break}}else u=2;while(!1);k(d|0,-1,u<<2|0)|0;e:do if(b)for(I=0;;){if(R=le+(I<<4)|0,os(R,o[K>>2]|0)|0,R=o[R>>2]|0,N=o[d>>2]|0,(N|0)==-1|(N|0)==(R|0))y=d;else{b=0;do{if(b=b+1|0,b>>>0>=u>>>0){y=1;break e}y=d+(b<<2)|0,N=o[y>>2]|0}while(!((N|0)==-1|(N|0)==(R|0)))}if(o[y>>2]=R,I=I+1|0,I>>>0>=W>>>0){y=0;break}}else for(I=0;;){if(R=le+(I<<4)|0,Ma(R,o[K>>2]|0,0,1)|0,R=o[R>>2]|0,N=o[d>>2]|0,(N|0)==-1|(N|0)==(R|0))y=d;else{b=0;do{if(b=b+1|0,b>>>0>=u>>>0){y=1;break e}y=d+(b<<2)|0,N=o[y>>2]|0}while(!((N|0)==-1|(N|0)==(R|0)))}if(o[y>>2]=R,I=I+1|0,I>>>0>=W>>>0){y=0;break}}while(!1)}return le=y,Ze=de,le|0}function vl(){return 12}function wo(u,h){u=u|0,h=h|0;var d=0,y=0,b=0,I=0,R=0,N=0,W=0;if(u>>>0>15)return N=4,N|0;if(it(u|0,0,52)|0,N=et()|0|134225919,!u){d=0,y=0;do qn(y)|0&&(it(y|0,0,45)|0,R=N|(et()|0),u=h+(d<<3)|0,o[u>>2]=-1,o[u+4>>2]=R,d=d+1|0),y=y+1|0;while((y|0)!=122);return d=0,d|0}d=0,R=0;do{if(qn(R)|0){for(it(R|0,0,45)|0,y=1,b=-1,I=N|(et()|0);W=it(7,0,(15-y|0)*3|0)|0,b=b&~W,I=I&~(et()|0),(y|0)!=(u|0);)y=y+1|0;W=h+(d<<3)|0,o[W>>2]=b,o[W+4>>2]=I,d=d+1|0}R=R+1|0}while((R|0)!=122);return d=0,d|0}function Ia(u,h,d,y){u=u|0,h=h|0,d=d|0,y=y|0;var b=0,I=0,R=0,N=0,W=0,K=0,le=0,de=0,ge=0,ke=0,Pe=0,qe=0,ht=0,mt=0,ot=0;if(ot=Ze,Ze=Ze+16|0,ht=ot,mt=Xe(u|0,h|0,52)|0,et()|0,mt=mt&15,d>>>0>15)return mt=4,Ze=ot,mt|0;if((mt|0)<(d|0))return mt=12,Ze=ot,mt|0;if((mt|0)!=(d|0))if(I=it(d|0,0,52)|0,I=I|u,N=et()|0|h&-15728641,(mt|0)>(d|0)){W=d;do qe=it(7,0,(14-W|0)*3|0)|0,W=W+1|0,I=qe|I,N=et()|0|N;while((W|0)<(mt|0));qe=I}else qe=I;else qe=u,N=h;Pe=Xe(qe|0,N|0,45)|0,et()|0;e:do if(qn(Pe&127)|0){if(W=Xe(qe|0,N|0,52)|0,et()|0,W=W&15,W|0)for(I=1;;){if(Pe=it(7,0,(15-I|0)*3|0)|0,!((Pe&qe|0)==0&((et()|0)&N|0)==0)){K=33;break e}if(I>>>0<W>>>0)I=I+1|0;else break}if(Pe=y,o[Pe>>2]=0,o[Pe+4>>2]=0,(mt|0)>(d|0)){for(Pe=h&-15728641,ke=mt;;){if(ge=ke,ke=ke+-1|0,ke>>>0>15|(mt|0)<(ke|0)){K=19;break}if((mt|0)!=(ke|0))if(I=it(ke|0,0,52)|0,I=I|u,W=et()|0|Pe,(mt|0)<(ge|0))de=I;else{K=ke;do de=it(7,0,(14-K|0)*3|0)|0,K=K+1|0,I=de|I,W=et()|0|W;while((K|0)<(mt|0));de=I}else de=u,W=h;if(le=Xe(de|0,W|0,45)|0,et()|0,!(qn(le&127)|0))I=0;else{le=Xe(de|0,W|0,52)|0,et()|0,le=le&15;t:do if(!le)I=0;else for(K=1;;){if(I=Xe(de|0,W|0,(15-K|0)*3|0)|0,et()|0,I=I&7,I|0)break t;if(K>>>0<le>>>0)K=K+1|0;else{I=0;break}}while(!1);I=(I|0)==0&1}if(W=Xe(u|0,h|0,(15-ge|0)*3|0)|0,et()|0,W=W&7,(W|0)==7){b=5,K=42;break}if(I=(I|0)!=0,(W|0)==1&I){b=5,K=42;break}if(de=W+(((W|0)!=0&I)<<31>>31)|0,de|0&&(K=mt-ge|0,K=fa(7,0,K,((K|0)<0)<<31>>31)|0,le=et()|0,I?(I=ue(K|0,le|0,5,0)|0,I=M(I|0,et()|0,-5,-1)|0,I=Q(I|0,et()|0,6,0)|0,I=M(I|0,et()|0,1,0)|0,W=et()|0):(I=K,W=le),ge=de+-1|0,ge=ue(K|0,le|0,ge|0,((ge|0)<0)<<31>>31|0)|0,ge=M(I|0,W|0,ge|0,et()|0)|0,de=et()|0,le=y,le=M(ge|0,de|0,o[le>>2]|0,o[le+4>>2]|0)|0,de=et()|0,ge=y,o[ge>>2]=le,o[ge+4>>2]=de),(ke|0)<=(d|0)){K=37;break}}if((K|0)==19)ar(23313,22674,1099,22710);else if((K|0)==37){R=y,b=o[R+4>>2]|0,R=o[R>>2]|0;break}else if((K|0)==42)return Ze=ot,b|0}else b=0,R=0}else K=33;while(!1);e:do if((K|0)==33)if(Pe=y,o[Pe>>2]=0,o[Pe+4>>2]=0,(mt|0)>(d|0)){for(I=mt;;){if(b=Xe(u|0,h|0,(15-I|0)*3|0)|0,et()|0,b=b&7,(b|0)==7){b=5;break}if(R=mt-I|0,R=fa(7,0,R,((R|0)<0)<<31>>31)|0,b=ue(R|0,et()|0,b|0,0)|0,R=et()|0,Pe=y,R=M(o[Pe>>2]|0,o[Pe+4>>2]|0,b|0,R|0)|0,b=et()|0,Pe=y,o[Pe>>2]=R,o[Pe+4>>2]=b,I=I+-1|0,(I|0)<=(d|0))break e}return Ze=ot,b|0}else b=0,R=0;while(!1);return yl(qe,N,mt,ht)|0&&ar(23313,22674,1063,22725),mt=ht,ht=o[mt+4>>2]|0,((b|0)>-1|(b|0)==-1&R>>>0>4294967295)&((ht|0)>(b|0)|((ht|0)==(b|0)?(o[mt>>2]|0)>>>0>R>>>0:0))?(mt=0,Ze=ot,mt|0):(ar(23313,22674,1139,22710),0)}function Ol(u,h,d,y,b,I){u=u|0,h=h|0,d=d|0,y=y|0,b=b|0,I=I|0;var R=0,N=0,W=0,K=0,le=0,de=0,ge=0,ke=0,Pe=0,qe=0;if(de=Ze,Ze=Ze+16|0,R=de,b>>>0>15)return I=4,Ze=de,I|0;if(N=Xe(d|0,y|0,52)|0,et()|0,N=N&15,(N|0)>(b|0))return I=12,Ze=de,I|0;if(yl(d,y,b,R)|0&&ar(23313,22674,1063,22725),le=R,K=o[le+4>>2]|0,!(((h|0)>-1|(h|0)==-1&u>>>0>4294967295)&((K|0)>(h|0)|((K|0)==(h|0)?(o[le>>2]|0)>>>0>u>>>0:0))))return I=2,Ze=de,I|0;le=b-N|0,b=it(b|0,0,52)|0,W=et()|0|y&-15728641,K=I,o[K>>2]=b|d,o[K+4>>2]=W,K=Xe(d|0,y|0,45)|0,et()|0;e:do if(qn(K&127)|0){if(N|0)for(R=1;;){if(K=it(7,0,(15-R|0)*3|0)|0,!((K&d|0)==0&((et()|0)&y|0)==0))break e;if(R>>>0<N>>>0)R=R+1|0;else break}if((le|0)<1)return I=0,Ze=de,I|0;for(K=N^15,y=-1,W=1,R=1;;){N=le-W|0,N=fa(7,0,N,((N|0)<0)<<31>>31)|0,d=et()|0;do if(R)if(R=ue(N|0,d|0,5,0)|0,R=M(R|0,et()|0,-5,-1)|0,R=Q(R|0,et()|0,6,0)|0,b=et()|0,(h|0)>(b|0)|(h|0)==(b|0)&u>>>0>R>>>0){h=M(u|0,h|0,-1,-1)|0,h=L(h|0,et()|0,R|0,b|0)|0,R=et()|0,ge=I,Pe=o[ge>>2]|0,ge=o[ge+4>>2]|0,qe=(K+y|0)*3|0,ke=it(7,0,qe|0)|0,ge=ge&~(et()|0),y=Q(h|0,R|0,N|0,d|0)|0,u=et()|0,b=M(y|0,u|0,2,0)|0,qe=it(b|0,et()|0,qe|0)|0,ge=et()|0|ge,b=I,o[b>>2]=qe|Pe&~ke,o[b+4>>2]=ge,u=ue(y|0,u|0,N|0,d|0)|0,u=L(h|0,R|0,u|0,et()|0)|0,R=0,h=et()|0;break}else{qe=I,ke=o[qe>>2]|0,qe=o[qe+4>>2]|0,Pe=it(7,0,(K+y|0)*3|0)|0,qe=qe&~(et()|0),R=I,o[R>>2]=ke&~Pe,o[R+4>>2]=qe,R=1;break}else ke=I,b=o[ke>>2]|0,ke=o[ke+4>>2]|0,y=(K+y|0)*3|0,ge=it(7,0,y|0)|0,ke=ke&~(et()|0),qe=Q(u|0,h|0,N|0,d|0)|0,R=et()|0,y=it(qe|0,R|0,y|0)|0,ke=et()|0|ke,Pe=I,o[Pe>>2]=y|b&~ge,o[Pe+4>>2]=ke,R=ue(qe|0,R|0,N|0,d|0)|0,u=L(u|0,h|0,R|0,et()|0)|0,R=0,h=et()|0;while(!1);if((le|0)>(W|0))y=~W,W=W+1|0;else{h=0;break}}return Ze=de,h|0}while(!1);if((le|0)<1)return qe=0,Ze=de,qe|0;for(b=N^15,R=1;;)if(Pe=le-R|0,Pe=fa(7,0,Pe,((Pe|0)<0)<<31>>31)|0,qe=et()|0,W=I,d=o[W>>2]|0,W=o[W+4>>2]|0,N=(b-R|0)*3|0,y=it(7,0,N|0)|0,W=W&~(et()|0),ge=Q(u|0,h|0,Pe|0,qe|0)|0,ke=et()|0,N=it(ge|0,ke|0,N|0)|0,W=et()|0|W,K=I,o[K>>2]=N|d&~y,o[K+4>>2]=W,qe=ue(ge|0,ke|0,Pe|0,qe|0)|0,u=L(u|0,h|0,qe|0,et()|0)|0,h=et()|0,(le|0)<=(R|0)){h=0;break}else R=R+1|0;return Ze=de,h|0}function Mt(u,h,d,y){u=u|0,h=h|0,d=d|0,y=y|0;var b=0,I=0;b=Xe(h|0,d|0,52)|0,et()|0,b=b&15,(h|0)==0&(d|0)==0|((y|0)>15|(b|0)>(y|0))?(y=-1,b=-1,h=0,d=0):(I=gA(h,d,b+1|0,y)|0,d=(et()|0)&-15728641,h=it(y|0,0,52)|0,h=I|h,d=d|(et()|0),I=(Nn(h,d)|0)==0,y=I?-1:y),I=u,o[I>>2]=h,o[I+4>>2]=d,o[u+8>>2]=b,o[u+12>>2]=y}function nc(u){u=u|0;var h=0,d=0,y=0,b=0,I=0,R=0,N=0,W=0,K=0;if(d=u,h=o[d>>2]|0,d=o[d+4>>2]|0,!((h|0)==0&(d|0)==0)&&(y=Xe(h|0,d|0,52)|0,et()|0,y=y&15,N=it(1,0,(y^15)*3|0)|0,h=M(N|0,et()|0,h|0,d|0)|0,d=et()|0,N=u,o[N>>2]=h,o[N+4>>2]=d,N=u+8|0,R=o[N>>2]|0,!((y|0)<(R|0)))){for(W=u+12|0,I=y;;){if((I|0)==(R|0)){y=5;break}if(K=(I|0)==(o[W>>2]|0),b=(15-I|0)*3|0,y=Xe(h|0,d|0,b|0)|0,et()|0,y=y&7,K&((y|0)==1&!0)){y=7;break}if(!((y|0)==7&!0)){y=10;break}if(K=it(1,0,b|0)|0,h=M(h|0,d|0,K|0,et()|0)|0,d=et()|0,K=u,o[K>>2]=h,o[K+4>>2]=d,(I|0)>(R|0))I=I+-1|0;else{y=10;break}}if((y|0)==5){K=u,o[K>>2]=0,o[K+4>>2]=0,o[N>>2]=-1,o[W>>2]=-1;return}else if((y|0)==7){R=it(1,0,b|0)|0,R=M(h|0,d|0,R|0,et()|0)|0,N=et()|0,K=u,o[K>>2]=R,o[K+4>>2]=N,o[W>>2]=I+-1;return}else if((y|0)==10)return}}function ll(u){u=+u;var h=0;return h=u<0?u+6.283185307179586:u,+(u>=6.283185307179586?h+-6.283185307179586:h)}function Al(u,h){return u=u|0,h=h|0,+si(+(+oe[u>>3]-+oe[h>>3]))<17453292519943298e-27?(h=+si(+(+oe[u+8>>3]-+oe[h+8>>3]))<17453292519943298e-27,h|0):(h=0,h|0)}function Lc(u,h){u=u|0,h=h|0;var d=0,y=0,b=0,I=0;return b=+oe[h>>3],y=+oe[u>>3],I=+Pi(+((b-y)*.5)),d=+Pi(+((+oe[h+8>>3]-+oe[u+8>>3])*.5)),d=I*I+d*(+yi(+b)*+yi(+y)*d),+(+js(+ +hi(+d),+ +hi(+(1-d)))*2)}function To(u,h){u=u|0,h=h|0;var d=0,y=0,b=0,I=0;return b=+oe[h>>3],y=+oe[u>>3],I=+Pi(+((b-y)*.5)),d=+Pi(+((+oe[h+8>>3]-+oe[u+8>>3])*.5)),d=I*I+d*(+yi(+b)*+yi(+y)*d),+(+js(+ +hi(+d),+ +hi(+(1-d)))*2*6371.007180918475)}function ha(u,h){u=u|0,h=h|0;var d=0,y=0,b=0,I=0;return b=+oe[h>>3],y=+oe[u>>3],I=+Pi(+((b-y)*.5)),d=+Pi(+((+oe[h+8>>3]-+oe[u+8>>3])*.5)),d=I*I+d*(+yi(+b)*+yi(+y)*d),+(+js(+ +hi(+d),+ +hi(+(1-d)))*2*6371.007180918475*1e3)}function Uo(u,h){u=u|0,h=h|0;var d=0,y=0,b=0,I=0,R=0;return I=+oe[h>>3],y=+yi(+I),b=+oe[h+8>>3]-+oe[u+8>>3],R=y*+Pi(+b),d=+oe[u>>3],+ +js(+R,+(+Pi(+I)*+yi(+d)-+yi(+b)*(y*+Pi(+d))))}function Qa(u,h,d,y){u=u|0,h=+h,d=+d,y=y|0;var b=0,I=0,R=0,N=0;if(d<1e-16){o[y>>2]=o[u>>2],o[y+4>>2]=o[u+4>>2],o[y+8>>2]=o[u+8>>2],o[y+12>>2]=o[u+12>>2];return}I=h<0?h+6.283185307179586:h,I=h>=6.283185307179586?I+-6.283185307179586:I;do if(I<1e-16)h=+oe[u>>3]+d,oe[y>>3]=h,b=y;else{if(b=+si(+(I+-3.141592653589793))<1e-16,h=+oe[u>>3],b){h=h-d,oe[y>>3]=h,b=y;break}if(R=+yi(+d),d=+Pi(+d),h=R*+Pi(+h)+ +yi(+I)*(d*+yi(+h)),h=h>1?1:h,h=+KA(+(h<-1?-1:h)),oe[y>>3]=h,+si(+(h+-1.5707963267948966))<1e-16){oe[y>>3]=1.5707963267948966,oe[y+8>>3]=0;return}if(+si(+(h+1.5707963267948966))<1e-16){oe[y>>3]=-1.5707963267948966,oe[y+8>>3]=0;return}if(N=+yi(+h),I=d*+Pi(+I)/N,d=+oe[u>>3],h=(R-+Pi(+h)*+Pi(+d))/+yi(+d)/N,R=I>1?1:I,h=h>1?1:h,h=+oe[u+8>>3]+ +js(+(R<-1?-1:R),+(h<-1?-1:h)),h>3.141592653589793)do h=h+-6.283185307179586;while(h>3.141592653589793);if(h<-3.141592653589793)do h=h+6.283185307179586;while(h<-3.141592653589793);oe[y+8>>3]=h;return}while(!1);if(+si(+(h+-1.5707963267948966))<1e-16){oe[b>>3]=1.5707963267948966,oe[y+8>>3]=0;return}if(+si(+(h+1.5707963267948966))<1e-16){oe[b>>3]=-1.5707963267948966,oe[y+8>>3]=0;return}if(h=+oe[u+8>>3],h>3.141592653589793)do h=h+-6.283185307179586;while(h>3.141592653589793);if(h<-3.141592653589793)do h=h+6.283185307179586;while(h<-3.141592653589793);oe[y+8>>3]=h}function NA(u,h){return u=u|0,h=h|0,u>>>0>15?(h=4,h|0):(oe[h>>3]=+oe[20528+(u<<3)>>3],h=0,h|0)}function cl(u,h){return u=u|0,h=h|0,u>>>0>15?(h=4,h|0):(oe[h>>3]=+oe[20656+(u<<3)>>3],h=0,h|0)}function sc(u,h){return u=u|0,h=h|0,u>>>0>15?(h=4,h|0):(oe[h>>3]=+oe[20784+(u<<3)>>3],h=0,h|0)}function bl(u,h){return u=u|0,h=h|0,u>>>0>15?(h=4,h|0):(oe[h>>3]=+oe[20912+(u<<3)>>3],h=0,h|0)}function UA(u,h){u=u|0,h=h|0;var d=0;return u>>>0>15?(h=4,h|0):(d=fa(7,0,u,((u|0)<0)<<31>>31)|0,d=ue(d|0,et()|0,120,0)|0,u=et()|0,o[h>>2]=d|2,o[h+4>>2]=u,h=0,h|0)}function Vo(u,h,d){u=u|0,h=h|0,d=d|0;var y=0,b=0,I=0,R=0,N=0,W=0,K=0,le=0,de=0,ge=0;return ge=+oe[h>>3],le=+oe[u>>3],W=+Pi(+((ge-le)*.5)),I=+oe[h+8>>3],K=+oe[u+8>>3],R=+Pi(+((I-K)*.5)),N=+yi(+le),de=+yi(+ge),R=W*W+R*(de*N*R),R=+js(+ +hi(+R),+ +hi(+(1-R)))*2,W=+oe[d>>3],ge=+Pi(+((W-ge)*.5)),y=+oe[d+8>>3],I=+Pi(+((y-I)*.5)),b=+yi(+W),I=ge*ge+I*(de*b*I),I=+js(+ +hi(+I),+ +hi(+(1-I)))*2,W=+Pi(+((le-W)*.5)),y=+Pi(+((K-y)*.5)),y=W*W+y*(N*b*y),y=+js(+ +hi(+y),+ +hi(+(1-y)))*2,b=(R+I+y)*.5,+(+Vs(+ +hi(+(+hn(+(b*.5))*+hn(+((b-R)*.5))*+hn(+((b-I)*.5))*+hn(+((b-y)*.5)))))*4)}function ia(u,h,d){u=u|0,h=h|0,d=d|0;var y=0,b=0,I=0,R=0,N=0;if(N=Ze,Ze=Ze+192|0,I=N+168|0,R=N,b=Sa(u,h,I)|0,b|0)return d=b,Ze=N,d|0;if(Un(u,h,R)|0&&ar(23313,22742,386,22751),h=o[R>>2]|0,(h|0)>0){if(y=+Vo(R+8|0,R+8+(((h|0)!=1&1)<<4)|0,I)+0,(h|0)!=1){u=1;do b=u,u=u+1|0,y=y+ +Vo(R+8+(b<<4)|0,R+8+(((u|0)%(h|0)|0)<<4)|0,I);while((u|0)<(h|0))}}else y=0;return oe[d>>3]=y,d=0,Ze=N,d|0}function Ca(u,h,d){return u=u|0,h=h|0,d=d|0,u=ia(u,h,d)|0,u|0||(oe[d>>3]=+oe[d>>3]*6371.007180918475*6371.007180918475),u|0}function ul(u,h,d){return u=u|0,h=h|0,d=d|0,u=ia(u,h,d)|0,u|0||(oe[d>>3]=+oe[d>>3]*6371.007180918475*6371.007180918475*1e3*1e3),u|0}function wl(u,h,d){u=u|0,h=h|0,d=d|0;var y=0,b=0,I=0,R=0,N=0,W=0,K=0,le=0;if(N=Ze,Ze=Ze+176|0,R=N,u=qs(u,h,R)|0,u|0)return R=u,Ze=N,R|0;if(oe[d>>3]=0,u=o[R>>2]|0,(u|0)<=1)return R=0,Ze=N,R|0;h=u+-1|0,u=0,y=+oe[R+8>>3],b=+oe[R+16>>3],I=0;do u=u+1|0,K=y,y=+oe[R+8+(u<<4)>>3],le=+Pi(+((y-K)*.5)),W=b,b=+oe[R+8+(u<<4)+8>>3],W=+Pi(+((b-W)*.5)),W=le*le+W*(+yi(+y)*+yi(+K)*W),I=I+ +js(+ +hi(+W),+ +hi(+(1-W)))*2;while((u|0)<(h|0));return oe[d>>3]=I,R=0,Ze=N,R|0}function ku(u,h,d){u=u|0,h=h|0,d=d|0;var y=0,b=0,I=0,R=0,N=0,W=0,K=0,le=0;if(N=Ze,Ze=Ze+176|0,R=N,u=qs(u,h,R)|0,u|0)return R=u,I=+oe[d>>3],I=I*6371.007180918475,oe[d>>3]=I,Ze=N,R|0;if(oe[d>>3]=0,u=o[R>>2]|0,(u|0)<=1)return R=0,I=0,I=I*6371.007180918475,oe[d>>3]=I,Ze=N,R|0;h=u+-1|0,u=0,y=+oe[R+8>>3],b=+oe[R+16>>3],I=0;do u=u+1|0,K=y,y=+oe[R+8+(u<<4)>>3],le=+Pi(+((y-K)*.5)),W=b,b=+oe[R+8+(u<<4)+8>>3],W=+Pi(+((b-W)*.5)),W=le*le+W*(+yi(+K)*+yi(+y)*W),I=I+ +js(+ +hi(+W),+ +hi(+(1-W)))*2;while((u|0)!=(h|0));return oe[d>>3]=I,R=0,le=I,le=le*6371.007180918475,oe[d>>3]=le,Ze=N,R|0}function oc(u,h,d){u=u|0,h=h|0,d=d|0;var y=0,b=0,I=0,R=0,N=0,W=0,K=0,le=0;if(N=Ze,Ze=Ze+176|0,R=N,u=qs(u,h,R)|0,u|0)return R=u,I=+oe[d>>3],I=I*6371.007180918475,I=I*1e3,oe[d>>3]=I,Ze=N,R|0;if(oe[d>>3]=0,u=o[R>>2]|0,(u|0)<=1)return R=0,I=0,I=I*6371.007180918475,I=I*1e3,oe[d>>3]=I,Ze=N,R|0;h=u+-1|0,u=0,y=+oe[R+8>>3],b=+oe[R+16>>3],I=0;do u=u+1|0,K=y,y=+oe[R+8+(u<<4)>>3],le=+Pi(+((y-K)*.5)),W=b,b=+oe[R+8+(u<<4)+8>>3],W=+Pi(+((b-W)*.5)),W=le*le+W*(+yi(+K)*+yi(+y)*W),I=I+ +js(+ +hi(+W),+ +hi(+(1-W)))*2;while((u|0)!=(h|0));return oe[d>>3]=I,R=0,le=I,le=le*6371.007180918475,le=le*1e3,oe[d>>3]=le,Ze=N,R|0}function au(u){u=u|0;var h=0,d=0,y=0;return h=T(1,12)|0,h||ar(22832,22787,49,22845),d=u+4|0,y=o[d>>2]|0,y|0?(y=y+8|0,o[y>>2]=h,o[d>>2]=h,h|0):(o[u>>2]|0&&ar(22862,22787,61,22885),y=u,o[y>>2]=h,o[d>>2]=h,h|0)}function rA(u,h){u=u|0,h=h|0;var d=0,y=0;return y=Hn(24)|0,y||ar(22899,22787,78,22913),o[y>>2]=o[h>>2],o[y+4>>2]=o[h+4>>2],o[y+8>>2]=o[h+8>>2],o[y+12>>2]=o[h+12>>2],o[y+16>>2]=0,h=u+4|0,d=o[h>>2]|0,d|0?(o[d+16>>2]=y,o[h>>2]=y,y|0):(o[u>>2]|0&&ar(22928,22787,82,22913),o[u>>2]=y,o[h>>2]=y,y|0)}function hl(u){u=u|0;var h=0,d=0,y=0,b=0;if(u)for(y=1;;){if(h=o[u>>2]|0,h|0)do{if(d=o[h>>2]|0,d|0)do b=d,d=o[d+16>>2]|0,x(b);while(d|0);b=h,h=o[h+8>>2]|0,x(b)}while(h|0);if(h=u,u=o[u+8>>2]|0,y||x(h),u)y=0;else break}}function Ha(u){u=u|0;var h=0,d=0,y=0,b=0,I=0,R=0,N=0,W=0,K=0,le=0,de=0,ge=0,ke=0,Pe=0,qe=0,ht=0,mt=0,ot=0,ft=0,dt=0,ai=0,Ut=0,Xt=0,qt=0,or=0,qi=0,ji=0,Li=0,ir=0,Ji=0,Or=0,Xi=0;if(b=u+8|0,o[b>>2]|0)return Xi=1,Xi|0;if(y=o[u>>2]|0,!y)return Xi=0,Xi|0;h=y,d=0;do d=d+1|0,h=o[h+8>>2]|0;while(h|0);if(d>>>0<2)return Xi=0,Xi|0;Ji=Hn(d<<2)|0,Ji||ar(22948,22787,317,22967),ir=Hn(d<<5)|0,ir||ar(22989,22787,321,22967),o[u>>2]=0,Ut=u+4|0,o[Ut>>2]=0,o[b>>2]=0,d=0,Li=0,ai=0,de=0;e:for(;;){if(le=o[y>>2]|0,le){I=0,R=le;do{if(W=+oe[R+8>>3],h=R,R=o[R+16>>2]|0,K=(R|0)==0,b=K?le:R,N=+oe[b+8>>3],+si(+(W-N))>3.141592653589793){Xi=14;break}I=I+(N-W)*(+oe[h>>3]+ +oe[b>>3])}while(!K);if((Xi|0)==14){Xi=0,I=0,h=le;do dt=+oe[h+8>>3],ji=h+16|0,qi=o[ji>>2]|0,qi=qi|0?qi:le,ft=+oe[qi+8>>3],I=I+(+oe[h>>3]+ +oe[qi>>3])*((ft<0?ft+6.283185307179586:ft)-(dt<0?dt+6.283185307179586:dt)),h=o[(h|0?ji:y)>>2]|0;while(h|0)}I>0?(o[Ji+(Li<<2)>>2]=y,Li=Li+1|0,b=ai,h=de):Xi=19}else Xi=19;if((Xi|0)==19){Xi=0;do if(d){if(h=d+8|0,o[h>>2]|0){Xi=21;break e}if(d=T(1,12)|0,!d){Xi=23;break e}o[h>>2]=d,b=d+4|0,R=d,h=de}else if(de){b=Ut,R=de+8|0,h=y,d=u;break}else if(o[u>>2]|0){Xi=27;break e}else{b=Ut,R=u,h=y,d=u;break}while(!1);if(o[R>>2]=y,o[b>>2]=y,R=ir+(ai<<5)|0,K=o[y>>2]|0,K){for(le=ir+(ai<<5)+8|0,oe[le>>3]=17976931348623157e292,de=ir+(ai<<5)+24|0,oe[de>>3]=17976931348623157e292,oe[R>>3]=-17976931348623157e292,ge=ir+(ai<<5)+16|0,oe[ge>>3]=-17976931348623157e292,mt=17976931348623157e292,ot=-17976931348623157e292,b=0,ke=K,W=17976931348623157e292,qe=17976931348623157e292,ht=-17976931348623157e292,N=-17976931348623157e292;I=+oe[ke>>3],dt=+oe[ke+8>>3],ke=o[ke+16>>2]|0,Pe=(ke|0)==0,ft=+oe[(Pe?K:ke)+8>>3],I<W&&(oe[le>>3]=I,W=I),dt<qe&&(oe[de>>3]=dt,qe=dt),I>ht?oe[R>>3]=I:I=ht,dt>N&&(oe[ge>>3]=dt,N=dt),mt=dt>0&dt<mt?dt:mt,ot=dt<0&dt>ot?dt:ot,b=b|+si(+(dt-ft))>3.141592653589793,!Pe;)ht=I;b&&(oe[ge>>3]=ot,oe[de>>3]=mt)}else o[R>>2]=0,o[R+4>>2]=0,o[R+8>>2]=0,o[R+12>>2]=0,o[R+16>>2]=0,o[R+20>>2]=0,o[R+24>>2]=0,o[R+28>>2]=0;b=ai+1|0}if(ji=y+8|0,y=o[ji>>2]|0,o[ji>>2]=0,y)ai=b,de=h;else{Xi=45;break}}if((Xi|0)==21)ar(22765,22787,35,22799);else if((Xi|0)==23)ar(22819,22787,37,22799);else if((Xi|0)==27)ar(22862,22787,61,22885);else if((Xi|0)==45){e:do if((Li|0)>0){for(ji=(b|0)==0,or=b<<2,qi=(u|0)==0,qt=0,h=0;;){if(Xt=o[Ji+(qt<<2)>>2]|0,ji)Xi=73;else{if(ai=Hn(or)|0,!ai){Xi=50;break}if(Ut=Hn(or)|0,!Ut){Xi=52;break}t:do if(qi)d=0;else{for(b=0,d=0,R=u;y=ir+(b<<5)|0,Fi(o[R>>2]|0,y,o[Xt>>2]|0)|0?(o[ai+(d<<2)>>2]=R,o[Ut+(d<<2)>>2]=y,Pe=d+1|0):Pe=d,R=o[R+8>>2]|0,R;)b=b+1|0,d=Pe;if((Pe|0)>0)if(y=o[ai>>2]|0,(Pe|0)==1)d=y;else for(ge=0,ke=-1,d=y,de=y;;){for(K=o[de>>2]|0,y=0,R=0;b=o[o[ai+(R<<2)>>2]>>2]|0,(b|0)==(K|0)?le=y:le=y+((Fi(b,o[Ut+(R<<2)>>2]|0,o[K>>2]|0)|0)&1)|0,R=R+1|0,(R|0)!=(Pe|0);)y=le;if(b=(le|0)>(ke|0),d=b?de:d,y=ge+1|0,(y|0)==(Pe|0))break t;ge=y,ke=b?le:ke,de=o[ai+(y<<2)>>2]|0}else d=0}while(!1);if(x(ai),x(Ut),d){if(b=d+4|0,y=o[b>>2]|0,y)d=y+8|0;else if(o[d>>2]|0){Xi=70;break}o[d>>2]=Xt,o[b>>2]=Xt}else Xi=73}if((Xi|0)==73){if(Xi=0,h=o[Xt>>2]|0,h|0)do Ut=h,h=o[h+16>>2]|0,x(Ut);while(h|0);x(Xt),h=1}if(qt=qt+1|0,(qt|0)>=(Li|0)){Or=h;break e}}(Xi|0)==50?ar(23004,22787,249,23023):(Xi|0)==52?ar(23042,22787,252,23023):(Xi|0)==70&&ar(22862,22787,61,22885)}else Or=0;while(!1);return x(Ji),x(ir),Xi=Or,Xi|0}return 0}function Fi(u,h,d){u=u|0,h=h|0,d=d|0;var y=0,b=0,I=0,R=0,N=0,W=0,K=0,le=0;if(!(Oo(h,d)|0)||(h=$l(h)|0,y=+oe[d>>3],b=+oe[d+8>>3],b=h&b<0?b+6.283185307179586:b,u=o[u>>2]|0,!u))return u=0,u|0;if(h){h=0,K=b,d=u;e:for(;;){for(;R=+oe[d>>3],b=+oe[d+8>>3],d=d+16|0,le=o[d>>2]|0,le=le|0?le:u,I=+oe[le>>3],N=+oe[le+8>>3],R>I?(W=R,R=N):(W=I,I=R,R=b,b=N),y=y==I|y==W?y+2220446049250313e-31:y,!!(y<I|y>W);)if(d=o[d>>2]|0,!d){d=22;break e}if(N=R<0?R+6.283185307179586:R,R=b<0?b+6.283185307179586:b,K=N==K|R==K?K+-2220446049250313e-31:K,W=N+(R-N)*((y-I)/(W-I)),(W<0?W+6.283185307179586:W)>K&&(h=h^1),d=o[d>>2]|0,!d){d=22;break}}if((d|0)==22)return h|0}else{h=0,K=b,d=u;e:for(;;){for(;R=+oe[d>>3],b=+oe[d+8>>3],d=d+16|0,le=o[d>>2]|0,le=le|0?le:u,I=+oe[le>>3],N=+oe[le+8>>3],R>I?(W=R,R=N):(W=I,I=R,R=b,b=N),y=y==I|y==W?y+2220446049250313e-31:y,!!(y<I|y>W);)if(d=o[d>>2]|0,!d){d=22;break e}if(K=R==K|b==K?K+-2220446049250313e-31:K,R+(b-R)*((y-I)/(W-I))>K&&(h=h^1),d=o[d>>2]|0,!d){d=22;break}}if((d|0)==22)return h|0}return 0}function jo(u,h,d,y,b){u=u|0,h=h|0,d=d|0,y=y|0,b=b|0;var I=0,R=0,N=0,W=0,K=0,le=0,de=0,ge=0,ke=0,Pe=0,qe=0,ht=0,mt=0,ot=0;if(ot=Ze,Ze=Ze+32|0,mt=ot+16|0,ht=ot,I=Xe(u|0,h|0,52)|0,et()|0,I=I&15,ke=Xe(d|0,y|0,52)|0,et()|0,(I|0)!=(ke&15|0))return mt=12,Ze=ot,mt|0;if(K=Xe(u|0,h|0,45)|0,et()|0,K=K&127,le=Xe(d|0,y|0,45)|0,et()|0,le=le&127,K>>>0>121|le>>>0>121)return mt=5,Ze=ot,mt|0;if(ke=(K|0)!=(le|0),ke){if(N=$o(K,le)|0,(N|0)==7)return mt=1,Ze=ot,mt|0;W=$o(le,K)|0,(W|0)==7?ar(23066,23090,161,23100):(Pe=N,R=W)}else Pe=0,R=0;de=qn(K)|0,ge=qn(le)|0,o[mt>>2]=0,o[mt+4>>2]=0,o[mt+8>>2]=0,o[mt+12>>2]=0;do if(Pe){if(le=o[4272+(K*28|0)+(Pe<<2)>>2]|0,N=(le|0)>0,ge)if(N){K=0,W=d,N=y;do W=ou(W,N)|0,N=et()|0,R=Va(R)|0,(R|0)==1&&(R=Va(1)|0),K=K+1|0;while((K|0)!=(le|0));le=R,K=W,W=N}else le=R,K=d,W=y;else if(N){K=0,W=d,N=y;do W=rc(W,N)|0,N=et()|0,R=Va(R)|0,K=K+1|0;while((K|0)!=(le|0));le=R,K=W,W=N}else le=R,K=d,W=y;if(OA(K,W,mt)|0,ke||ar(23115,23090,191,23100),N=(de|0)!=0,R=(ge|0)!=0,N&R&&ar(23142,23090,192,23100),N){if(R=po(u,h)|0,(R|0)==7){I=5;break}if(zt[21872+(R*7|0)+Pe>>0]|0){I=1;break}W=o[21040+(R*28|0)+(Pe<<2)>>2]|0,K=W}else if(R){if(R=po(K,W)|0,(R|0)==7){I=5;break}if(zt[21872+(R*7|0)+le>>0]|0){I=1;break}K=0,W=o[21040+(le*28|0)+(R<<2)>>2]|0}else K=0,W=0;if((K|W|0)<0)I=5;else{if((W|0)>0){N=mt+4|0,R=0;do Ta(N),R=R+1|0;while((R|0)!=(W|0))}if(o[ht>>2]=0,o[ht+4>>2]=0,o[ht+8>>2]=0,wa(ht,Pe),I|0)for(;bo(I)|0?gl(ht):Zs(ht),(I|0)>1;)I=I+-1|0;if((K|0)>0){I=0;do Ta(ht),I=I+1|0;while((I|0)!=(K|0))}qe=mt+4|0,tn(qe,ht,qe),Ui(qe),qe=51}}else if(OA(d,y,mt)|0,(de|0)!=0&(ge|0)!=0)if((le|0)!=(K|0)&&ar(23173,23090,261,23100),R=po(u,h)|0,I=po(d,y)|0,(R|0)==7|(I|0)==7)I=5;else if(zt[21872+(R*7|0)+I>>0]|0)I=1;else if(R=o[21040+(R*28|0)+(I<<2)>>2]|0,(R|0)>0){N=mt+4|0,I=0;do Ta(N),I=I+1|0;while((I|0)!=(R|0));qe=51}else qe=51;else qe=51;while(!1);return(qe|0)==51&&(I=mt+4|0,o[b>>2]=o[I>>2],o[b+4>>2]=o[I+4>>2],o[b+8>>2]=o[I+8>>2],I=0),mt=I,Ze=ot,mt|0}function Wa(u,h,d,y){u=u|0,h=h|0,d=d|0,y=y|0;var b=0,I=0,R=0,N=0,W=0,K=0,le=0,de=0,ge=0,ke=0,Pe=0,qe=0,ht=0,mt=0,ot=0,ft=0;if(qe=Ze,Ze=Ze+48|0,K=qe+36|0,R=qe+24|0,N=qe+12|0,W=qe,b=Xe(u|0,h|0,52)|0,et()|0,b=b&15,ge=Xe(u|0,h|0,45)|0,et()|0,ge=ge&127,ge>>>0>121)return y=5,Ze=qe,y|0;if(le=qn(ge)|0,it(b|0,0,52)|0,ht=et()|0|134225919,I=y,o[I>>2]=-1,o[I+4>>2]=ht,!b)return b=ba(d)|0,(b|0)==7||(b=Fo(ge,b)|0,(b|0)==127)?(ht=1,Ze=qe,ht|0):(ke=it(b|0,0,45)|0,Pe=et()|0,ge=y,Pe=o[ge+4>>2]&-1040385|Pe,ht=y,o[ht>>2]=o[ge>>2]|ke,o[ht+4>>2]=Pe,ht=0,Ze=qe,ht|0);for(o[K>>2]=o[d>>2],o[K+4>>2]=o[d+4>>2],o[K+8>>2]=o[d+8>>2],d=b;;){if(I=d,d=d+-1|0,o[R>>2]=o[K>>2],o[R+4>>2]=o[K+4>>2],o[R+8>>2]=o[K+8>>2],bo(I)|0){if(b=rl(K)|0,b|0){d=13;break}o[N>>2]=o[K>>2],o[N+4>>2]=o[K+4>>2],o[N+8>>2]=o[K+8>>2],gl(N)}else{if(b=ca(K)|0,b|0){d=13;break}o[N>>2]=o[K>>2],o[N+4>>2]=o[K+4>>2],o[N+8>>2]=o[K+8>>2],Zs(N)}if(Aa(R,N,W),Ui(W),b=y,ot=o[b>>2]|0,b=o[b+4>>2]|0,ft=(15-I|0)*3|0,mt=it(7,0,ft|0)|0,b=b&~(et()|0),ft=it(ba(W)|0,0,ft|0)|0,b=et()|0|b,ht=y,o[ht>>2]=ft|ot&~mt,o[ht+4>>2]=b,(I|0)<=1){d=14;break}}e:do if((d|0)!=13&&(d|0)==14)if((o[K>>2]|0)<=1&&(o[K+4>>2]|0)<=1&&(o[K+8>>2]|0)<=1){d=ba(K)|0,b=Fo(ge,d)|0,(b|0)==127?W=0:W=qn(b)|0;t:do if(d){if(le){if(b=po(u,h)|0,(b|0)==7){b=5;break e}if(I=o[21248+(b*28|0)+(d<<2)>>2]|0,(I|0)>0){b=d,d=0;do b=nl(b)|0,d=d+1|0;while((d|0)!=(I|0))}else b=d;if((b|0)==1){b=9;break e}d=Fo(ge,b)|0,(d|0)==127&&ar(23200,23090,411,23230),qn(d)|0?ar(23245,23090,412,23230):(Pe=d,ke=I,de=b)}else Pe=b,ke=0,de=d;if(N=o[4272+(ge*28|0)+(de<<2)>>2]|0,(N|0)<=-1&&ar(23276,23090,419,23230),!W){if((ke|0)<0){b=5;break e}if(ke|0){I=y,b=0,d=o[I>>2]|0,I=o[I+4>>2]|0;do d=xl(d,I)|0,I=et()|0,ft=y,o[ft>>2]=d,o[ft+4>>2]=I,b=b+1|0;while((b|0)<(ke|0))}if((N|0)<=0){b=Pe,d=58;break}for(I=y,b=0,d=o[I>>2]|0,I=o[I+4>>2]|0;;)if(d=xl(d,I)|0,I=et()|0,ft=y,o[ft>>2]=d,o[ft+4>>2]=I,b=b+1|0,(b|0)==(N|0)){b=Pe,d=58;break t}}if(R=$o(Pe,ge)|0,(R|0)==7&&ar(23066,23090,428,23230),b=y,d=o[b>>2]|0,b=o[b+4>>2]|0,(N|0)>0){I=0;do d=xl(d,b)|0,b=et()|0,ft=y,o[ft>>2]=d,o[ft+4>>2]=b,I=I+1|0;while((I|0)!=(N|0))}if(b=po(d,b)|0,(b|0)==7&&ar(23313,23090,440,23230),d=dA(Pe)|0,d=o[(d?21664:21456)+(R*28|0)+(b<<2)>>2]|0,(d|0)<0&&ar(23313,23090,454,23230),!d)b=Pe,d=58;else{R=y,b=0,I=o[R>>2]|0,R=o[R+4>>2]|0;do I=ua(I,R)|0,R=et()|0,ft=y,o[ft>>2]=I,o[ft+4>>2]=R,b=b+1|0;while((b|0)<(d|0));b=Pe,d=58}}else if((le|0)!=0&(W|0)!=0){if(d=po(u,h)|0,I=y,I=po(o[I>>2]|0,o[I+4>>2]|0)|0,(d|0)==7|(I|0)==7){b=5;break e}if(I=o[21248+(d*28|0)+(I<<2)>>2]|0,(I|0)<0){b=5;break e}if(!I)d=59;else{N=y,d=0,R=o[N>>2]|0,N=o[N+4>>2]|0;do R=xl(R,N)|0,N=et()|0,ft=y,o[ft>>2]=R,o[ft+4>>2]=N,d=d+1|0;while((d|0)<(I|0));d=58}}else d=58;while(!1);if((d|0)==58&&W&&(d=59),(d|0)==59&&(ft=y,(po(o[ft>>2]|0,o[ft+4>>2]|0)|0)==1)){b=9;break}ft=y,mt=o[ft>>2]|0,ft=o[ft+4>>2]&-1040385,ot=it(b|0,0,45)|0,ft=ft|(et()|0),b=y,o[b>>2]=mt|ot,o[b+4>>2]=ft,b=0}else b=1;while(!1);return ft=b,Ze=qe,ft|0}function fl(u,h,d,y,b,I){u=u|0,h=h|0,d=d|0,y=y|0,b=b|0,I=I|0;var R=0,N=0;return N=Ze,Ze=Ze+16|0,R=N,b?u=15:(u=jo(u,h,d,y,R)|0,u||(ea(R,I),u=0)),Ze=N,u|0}function ac(u,h,d,y,b){u=u|0,h=h|0,d=d|0,y=y|0,b=b|0;var I=0,R=0;return R=Ze,Ze=Ze+16|0,I=R,y?d=15:(d=fr(d,I)|0,d||(d=Wa(u,h,I,b)|0)),Ze=R,d|0}function Ei(u,h,d,y,b){u=u|0,h=h|0,d=d|0,y=y|0,b=b|0;var I=0,R=0,N=0,W=0;return W=Ze,Ze=Ze+32|0,R=W+12|0,N=W,I=jo(u,h,u,h,R)|0,I|0?(N=I,Ze=W,N|0):(u=jo(u,h,d,y,N)|0,u|0?(N=u,Ze=W,N|0):(R=LA(R,N)|0,N=b,o[N>>2]=R,o[N+4>>2]=((R|0)<0)<<31>>31,N=0,Ze=W,N|0))}function nA(u,h,d,y,b){u=u|0,h=h|0,d=d|0,y=y|0,b=b|0;var I=0,R=0,N=0,W=0;return W=Ze,Ze=Ze+32|0,R=W+12|0,N=W,I=jo(u,h,u,h,R)|0,!I&&(I=jo(u,h,d,y,N)|0,!I)?(y=LA(R,N)|0,y=M(y|0,((y|0)<0)<<31>>31|0,1,0)|0,R=et()|0,N=b,o[N>>2]=y,o[N+4>>2]=R,N=0,Ze=W,N|0):(N=I,Ze=W,N|0)}function VA(u,h,d,y,b){u=u|0,h=h|0,d=d|0,y=y|0,b=b|0;var I=0,R=0,N=0,W=0,K=0,le=0,de=0,ge=0,ke=0,Pe=0,qe=0,ht=0,mt=0,ot=0,ft=0,dt=0,ai=0,Ut=0,Xt=0,qt=0;if(Xt=Ze,Ze=Ze+48|0,R=Xt+24|0,N=Xt+12|0,Ut=Xt,I=jo(u,h,u,h,R)|0,!I&&(I=jo(u,h,d,y,N)|0,!I)){dt=LA(R,N)|0,ai=((dt|0)<0)<<31>>31,o[R>>2]=0,o[R+4>>2]=0,o[R+8>>2]=0,o[N>>2]=0,o[N+4>>2]=0,o[N+8>>2]=0,jo(u,h,u,h,R)|0&&ar(23313,23090,691,23299),jo(u,h,d,y,N)|0&&ar(23313,23090,696,23299),ja(R),ja(N),dt?(de=o[R>>2]|0,Pe=+(dt|0),mt=R+4|0,ge=o[mt>>2]|0,ot=R+8|0,ke=o[ot>>2]|0,ft=R,y=de,I=ge,d=ke,qe=+((o[N>>2]|0)-de|0)/Pe,ht=+((o[N+4>>2]|0)-ge|0)/Pe,Pe=+((o[N+8>>2]|0)-ke|0)/Pe):(I=R+4|0,d=R+8|0,mt=I,ot=d,ft=R,y=o[R>>2]|0,I=o[I>>2]|0,d=o[d>>2]|0,qe=0,ht=0,Pe=0),o[Ut>>2]=y,ke=Ut+4|0,o[ke>>2]=I,ge=Ut+8|0,o[ge>>2]=d;e:do if((dt|0)<0)I=0;else for(le=0,de=0,I=y;;){K=+(de>>>0)+4294967296*+(le|0),qt=qe*K+ +(I|0),W=ht*K+ +(o[mt>>2]|0),K=Pe*K+ +(o[ot>>2]|0),d=~~+g(+qt),R=~~+g(+W),I=~~+g(+K),qt=+si(+(+(d|0)-qt)),W=+si(+(+(R|0)-W)),K=+si(+(+(I|0)-K));do if(qt>W&qt>K)d=0-(R+I)|0,y=R;else if(N=0-d|0,W>K){y=N-I|0;break}else{y=R,I=N-R|0;break}while(!1);if(o[Ut>>2]=d,o[ke>>2]=y,o[ge>>2]=I,RA(Ut),I=Wa(u,h,Ut,b+(de<<3)|0)|0,I|0)break e;if(!((le|0)<(ai|0)|(le|0)==(ai|0)&de>>>0<dt>>>0)){I=0;break e}I=M(de|0,le|0,1,0)|0,N=et()|0,le=N,de=I,I=o[ft>>2]|0}while(!1);return Ut=I,Ze=Xt,Ut|0}return Ut=I,Ze=Xt,Ut|0}function fa(u,h,d,y){u=u|0,h=h|0,d=d|0,y=y|0;var b=0,I=0,R=0;if((d|0)==0&(y|0)==0)return b=0,I=1,Ci(b|0),I|0;I=u,b=h,u=1,h=0;do R=(d&1|0)==0&!0,u=ue((R?1:I)|0,(R?0:b)|0,u|0,h|0)|0,h=et()|0,d=_t(d|0,y|0,1)|0,y=et()|0,I=ue(I|0,b|0,I|0,b|0)|0,b=et()|0;while(!((d|0)==0&(y|0)==0));return Ci(h|0),u|0}function yA(u,h,d){u=u|0,h=h|0,d=d|0;var y=0,b=0,I=0,R=0,N=0,W=0,K=0,le=0,de=0,ge=0;if(!(Oo(h,d)|0)||(h=$l(h)|0,y=+oe[d>>3],b=+oe[d+8>>3],b=h&b<0?b+6.283185307179586:b,ge=o[u>>2]|0,(ge|0)<=0))return ge=0,ge|0;if(de=o[u+4>>2]|0,h){h=0,le=b,d=-1,u=0;e:for(;;){for(K=u;R=+oe[de+(K<<4)>>3],b=+oe[de+(K<<4)+8>>3],u=(d+2|0)%(ge|0)|0,I=+oe[de+(u<<4)>>3],N=+oe[de+(u<<4)+8>>3],R>I?(W=R,R=N):(W=I,I=R,R=b,b=N),y=y==I|y==W?y+2220446049250313e-31:y,!!(y<I|y>W);)if(d=K+1|0,(d|0)>=(ge|0)){d=22;break e}else u=K,K=d,d=u;if(N=R<0?R+6.283185307179586:R,R=b<0?b+6.283185307179586:b,le=N==le|R==le?le+-2220446049250313e-31:le,W=N+(R-N)*((y-I)/(W-I)),(W<0?W+6.283185307179586:W)>le&&(h=h^1),u=K+1|0,(u|0)>=(ge|0)){d=22;break}else d=K}if((d|0)==22)return h|0}else{h=0,le=b,d=-1,u=0;e:for(;;){for(K=u;R=+oe[de+(K<<4)>>3],b=+oe[de+(K<<4)+8>>3],u=(d+2|0)%(ge|0)|0,I=+oe[de+(u<<4)>>3],N=+oe[de+(u<<4)+8>>3],R>I?(W=R,R=N):(W=I,I=R,R=b,b=N),y=y==I|y==W?y+2220446049250313e-31:y,!!(y<I|y>W);)if(d=K+1|0,(d|0)>=(ge|0)){d=22;break e}else u=K,K=d,d=u;if(le=R==le|b==le?le+-2220446049250313e-31:le,R+(b-R)*((y-I)/(W-I))>le&&(h=h^1),u=K+1|0,(u|0)>=(ge|0)){d=22;break}else d=K}if((d|0)==22)return h|0}return 0}function lc(u,h){u=u|0,h=h|0;var d=0,y=0,b=0,I=0,R=0,N=0,W=0,K=0,le=0,de=0,ge=0,ke=0,Pe=0,qe=0,ht=0,mt=0,ot=0;if(Pe=o[u>>2]|0,!Pe){o[h>>2]=0,o[h+4>>2]=0,o[h+8>>2]=0,o[h+12>>2]=0,o[h+16>>2]=0,o[h+20>>2]=0,o[h+24>>2]=0,o[h+28>>2]=0;return}if(qe=h+8|0,oe[qe>>3]=17976931348623157e292,ht=h+24|0,oe[ht>>3]=17976931348623157e292,oe[h>>3]=-17976931348623157e292,mt=h+16|0,oe[mt>>3]=-17976931348623157e292,!((Pe|0)<=0)){for(ge=o[u+4>>2]|0,K=17976931348623157e292,le=-17976931348623157e292,de=0,u=-1,I=17976931348623157e292,R=17976931348623157e292,W=-17976931348623157e292,y=-17976931348623157e292,ke=0;d=+oe[ge+(ke<<4)>>3],N=+oe[ge+(ke<<4)+8>>3],u=u+2|0,b=+oe[ge+(((u|0)==(Pe|0)?0:u)<<4)+8>>3],d<I&&(oe[qe>>3]=d,I=d),N<R&&(oe[ht>>3]=N,R=N),d>W?oe[h>>3]=d:d=W,N>y&&(oe[mt>>3]=N,y=N),K=N>0&N<K?N:K,le=N<0&N>le?N:le,de=de|+si(+(N-b))>3.141592653589793,u=ke+1|0,(u|0)!=(Pe|0);)ot=ke,W=d,ke=u,u=ot;de&&(oe[mt>>3]=le,oe[ht>>3]=K)}}function jA(u,h){u=u|0,h=h|0;var d=0,y=0,b=0,I=0,R=0,N=0,W=0,K=0,le=0,de=0,ge=0,ke=0,Pe=0,qe=0,ht=0,mt=0,ot=0,ft=0,dt=0,ai=0,Ut=0,Xt=0;if(Pe=o[u>>2]|0,Pe){if(qe=h+8|0,oe[qe>>3]=17976931348623157e292,ht=h+24|0,oe[ht>>3]=17976931348623157e292,oe[h>>3]=-17976931348623157e292,mt=h+16|0,oe[mt>>3]=-17976931348623157e292,(Pe|0)>0){for(b=o[u+4>>2]|0,ge=17976931348623157e292,ke=-17976931348623157e292,y=0,d=-1,W=17976931348623157e292,K=17976931348623157e292,de=-17976931348623157e292,R=-17976931348623157e292,ot=0;I=+oe[b+(ot<<4)>>3],le=+oe[b+(ot<<4)+8>>3],Ut=d+2|0,N=+oe[b+(((Ut|0)==(Pe|0)?0:Ut)<<4)+8>>3],I<W&&(oe[qe>>3]=I,W=I),le<K&&(oe[ht>>3]=le,K=le),I>de?oe[h>>3]=I:I=de,le>R&&(oe[mt>>3]=le,R=le),ge=le>0&le<ge?le:ge,ke=le<0&le>ke?le:ke,y=y|+si(+(le-N))>3.141592653589793,d=ot+1|0,(d|0)!=(Pe|0);)Ut=ot,de=I,ot=d,d=Ut;y&&(oe[mt>>3]=ke,oe[ht>>3]=ge)}}else o[h>>2]=0,o[h+4>>2]=0,o[h+8>>2]=0,o[h+12>>2]=0,o[h+16>>2]=0,o[h+20>>2]=0,o[h+24>>2]=0,o[h+28>>2]=0;if(Ut=u+8|0,d=o[Ut>>2]|0,!((d|0)<=0)){ai=u+12|0,dt=0;do if(b=o[ai>>2]|0,y=dt,dt=dt+1|0,ht=h+(dt<<5)|0,mt=o[b+(y<<3)>>2]|0,mt){if(ot=h+(dt<<5)+8|0,oe[ot>>3]=17976931348623157e292,u=h+(dt<<5)+24|0,oe[u>>3]=17976931348623157e292,oe[ht>>3]=-17976931348623157e292,ft=h+(dt<<5)+16|0,oe[ft>>3]=-17976931348623157e292,(mt|0)>0){for(Pe=o[b+(y<<3)+4>>2]|0,ge=17976931348623157e292,ke=-17976931348623157e292,b=0,y=-1,qe=0,W=17976931348623157e292,K=17976931348623157e292,le=-17976931348623157e292,R=-17976931348623157e292;I=+oe[Pe+(qe<<4)>>3],de=+oe[Pe+(qe<<4)+8>>3],y=y+2|0,N=+oe[Pe+(((y|0)==(mt|0)?0:y)<<4)+8>>3],I<W&&(oe[ot>>3]=I,W=I),de<K&&(oe[u>>3]=de,K=de),I>le?oe[ht>>3]=I:I=le,de>R&&(oe[ft>>3]=de,R=de),ge=de>0&de<ge?de:ge,ke=de<0&de>ke?de:ke,b=b|+si(+(de-N))>3.141592653589793,y=qe+1|0,(y|0)!=(mt|0);)Xt=qe,qe=y,le=I,y=Xt;b&&(oe[ft>>3]=ke,oe[u>>3]=ge)}}else o[ht>>2]=0,o[ht+4>>2]=0,o[ht+8>>2]=0,o[ht+12>>2]=0,o[ht+16>>2]=0,o[ht+20>>2]=0,o[ht+24>>2]=0,o[ht+28>>2]=0,d=o[Ut>>2]|0;while((dt|0)<(d|0))}}function Ac(u,h,d){u=u|0,h=h|0,d=d|0;var y=0,b=0,I=0;if(!(yA(u,h,d)|0))return b=0,b|0;if(b=u+8|0,(o[b>>2]|0)<=0)return b=1,b|0;for(y=u+12|0,u=0;;){if(I=u,u=u+1|0,yA((o[y>>2]|0)+(I<<3)|0,h+(u<<5)|0,d)|0){u=0,y=6;break}if((u|0)>=(o[b>>2]|0)){u=1,y=6;break}}return(y|0)==6?u|0:0}function ks(){return 8}function xA(){return 16}function GA(){return 168}function ZA(){return 8}function Ki(){return 16}function Po(){return 12}function ka(){return 8}function sA(u){return u=u|0,+(+((o[u>>2]|0)>>>0)+4294967296*+(o[u+4>>2]|0))}function cc(u){u=u|0;var h=0,d=0;return d=+oe[u>>3],h=+oe[u+8>>3],+ +hi(+(d*d+h*h))}function oA(u,h,d,y,b){u=u|0,h=h|0,d=d|0,y=y|0,b=b|0;var I=0,R=0,N=0,W=0,K=0,le=0,de=0,ge=0;K=+oe[u>>3],W=+oe[h>>3]-K,N=+oe[u+8>>3],R=+oe[h+8>>3]-N,de=+oe[d>>3],I=+oe[y>>3]-de,ge=+oe[d+8>>3],le=+oe[y+8>>3]-ge,I=(I*(N-ge)-(K-de)*le)/(W*le-R*I),oe[b>>3]=K+W*I,oe[b+8>>3]=N+R*I}function Tl(u,h){return u=u|0,h=h|0,+si(+(+oe[u>>3]-+oe[h>>3]))<11920928955078125e-23?(h=+si(+(+oe[u+8>>3]-+oe[h+8>>3]))<11920928955078125e-23,h|0):(h=0,h|0)}function Ds(u,h){u=u|0,h=h|0;var d=0,y=0,b=0;return b=+oe[u>>3]-+oe[h>>3],y=+oe[u+8>>3]-+oe[h+8>>3],d=+oe[u+16>>3]-+oe[h+16>>3],+(b*b+y*y+d*d)}function da(u,h){u=u|0,h=h|0;var d=0,y=0,b=0;d=+oe[u>>3],y=+yi(+d),d=+Pi(+d),oe[h+16>>3]=d,d=+oe[u+8>>3],b=y*+yi(+d),oe[h>>3]=b,d=y*+Pi(+d),oe[h+8>>3]=d}function Qn(u,h,d){u=u|0,h=h|0,d=d|0;var y=0,b=0,I=0;if(I=Ze,Ze=Ze+16|0,b=I,y=Nn(u,h)|0,(d+-1|0)>>>0>5||(y=(y|0)!=0,(d|0)==1&y))return b=-1,Ze=I,b|0;do if(Eo(u,h,b)|0)y=-1;else if(y){y=((o[21936+(d<<2)>>2]|0)+5-(o[b>>2]|0)|0)%5|0;break}else{y=((o[21968+(d<<2)>>2]|0)+6-(o[b>>2]|0)|0)%6|0;break}while(!1);return b=y,Ze=I,b|0}function Eo(u,h,d){u=u|0,h=h|0,d=d|0;var y=0,b=0,I=0,R=0,N=0,W=0,K=0;if(K=Ze,Ze=Ze+32|0,R=K+16|0,N=K,y=Rn(u,h,R)|0,y|0)return d=y,Ze=K,d|0;I=sl(u,h)|0,W=po(u,h)|0,ss(I,N),y=xt(I,o[R>>2]|0)|0;e:do if(qn(I)|0){do switch(I|0){case 4:{u=0;break}case 14:{u=1;break}case 24:{u=2;break}case 38:{u=3;break}case 49:{u=4;break}case 58:{u=5;break}case 63:{u=6;break}case 72:{u=7;break}case 83:{u=8;break}case 97:{u=9;break}case 107:{u=10;break}case 117:{u=11;break}default:{y=1;break e}}while(!1);if(b=o[22e3+(u*24|0)+8>>2]|0,h=o[22e3+(u*24|0)+16>>2]|0,u=o[R>>2]|0,(u|0)!=(o[N>>2]|0)&&(N=dA(I)|0,u=o[R>>2]|0,N|(u|0)==(h|0)&&(y=(y+1|0)%6|0)),(W|0)==3&(u|0)==(h|0)){y=(y+5|0)%6|0,b=22;break}(W|0)==5&(u|0)==(b|0)&&(y=(y+1|0)%6|0),b=22}else b=22;while(!1);return(b|0)==22&&(o[d>>2]=y,y=0),d=y,Ze=K,d|0}function pr(u,h,d,y){u=u|0,h=h|0,d=d|0,y=y|0;var b=0,I=0,R=0,N=0,W=0,K=0,le=0,de=0,ge=0,ke=0,Pe=0,qe=0,ht=0,mt=0,ot=0,ft=0;if(ft=Ze,Ze=Ze+32|0,ot=ft+24|0,ht=ft+20|0,Pe=ft+8|0,ke=ft+16|0,ge=ft,W=(Nn(u,h)|0)==0,W=W?6:5,le=Xe(u|0,h|0,52)|0,et()|0,le=le&15,W>>>0<=d>>>0)return y=2,Ze=ft,y|0;de=(le|0)==0,!de&&(qe=it(7,0,(le^15)*3|0)|0,(qe&u|0)==0&((et()|0)&h|0)==0)?b=d:I=4;e:do if((I|0)==4){if(b=(Nn(u,h)|0)!=0,((b?4:5)|0)<(d|0)||Eo(u,h,ot)|0||(I=(o[ot>>2]|0)+d|0,b?b=22288+(((I|0)%5|0)<<2)|0:b=22320+(((I|0)%6|0)<<2)|0,qe=o[b>>2]|0,(qe|0)==7))return y=1,Ze=ft,y|0;o[ht>>2]=0,b=Fs(u,h,qe,ht,Pe)|0;do if(!b){if(N=Pe,K=o[N>>2]|0,N=o[N+4>>2]|0,R=N>>>0<h>>>0|(N|0)==(h|0)&K>>>0<u>>>0,I=R?K:u,R=R?N:h,!de&&(de=it(7,0,(le^15)*3|0)|0,(K&de|0)==0&(N&(et()|0)|0)==0))b=d;else{if(N=(d+-1+W|0)%(W|0)|0,b=Nn(u,h)|0,(N|0)<0&&ar(23313,23315,245,23324),W=(b|0)!=0,((W?4:5)|0)<(N|0)&&ar(23313,23315,245,23324),Eo(u,h,ot)|0&&ar(23313,23315,245,23324),b=(o[ot>>2]|0)+N|0,W?b=22288+(((b|0)%5|0)<<2)|0:b=22320+(((b|0)%6|0)<<2)|0,N=o[b>>2]|0,(N|0)==7&&ar(23313,23315,245,23324),o[ke>>2]=0,b=Fs(u,h,N,ke,ge)|0,b|0)break;K=ge,W=o[K>>2]|0,K=o[K+4>>2]|0;do if(K>>>0<R>>>0|(K|0)==(R|0)&W>>>0<I>>>0){if(Nn(W,K)|0?I=Pl(W,K,u,h)|0:I=o[22384+((((o[ke>>2]|0)+(o[22352+(N<<2)>>2]|0)|0)%6|0)<<2)>>2]|0,b=Nn(W,K)|0,(I+-1|0)>>>0>5){b=-1,I=W,R=K;break}if(b=(b|0)!=0,(I|0)==1&b){b=-1,I=W,R=K;break}do if(Eo(W,K,ot)|0)b=-1;else if(b){b=((o[21936+(I<<2)>>2]|0)+5-(o[ot>>2]|0)|0)%5|0;break}else{b=((o[21968+(I<<2)>>2]|0)+6-(o[ot>>2]|0)|0)%6|0;break}while(!1);I=W,R=K}else b=d;while(!1);N=Pe,K=o[N>>2]|0,N=o[N+4>>2]|0}if((I|0)==(K|0)&(R|0)==(N|0)){if(W=(Nn(K,N)|0)!=0,W?u=Pl(K,N,u,h)|0:u=o[22384+((((o[ht>>2]|0)+(o[22352+(qe<<2)>>2]|0)|0)%6|0)<<2)>>2]|0,b=Nn(K,N)|0,(u+-1|0)>>>0<=5&&(mt=(b|0)!=0,!((u|0)==1&mt)))do if(Eo(K,N,ot)|0)b=-1;else if(mt){b=((o[21936+(u<<2)>>2]|0)+5-(o[ot>>2]|0)|0)%5|0;break}else{b=((o[21968+(u<<2)>>2]|0)+6-(o[ot>>2]|0)|0)%6|0;break}while(!1);else b=-1;b=b+1|0,b=(b|0)==6|W&(b|0)==5?0:b}h=R,u=I;break e}while(!1);return y=b,Ze=ft,y|0}while(!1);return mt=it(b|0,0,56)|0,ot=et()|0|h&-2130706433|536870912,o[y>>2]=mt|u,o[y+4>>2]=ot,y=0,Ze=ft,y|0}function ra(u,h,d){u=u|0,h=h|0,d=d|0;var y=0,b=0,I=0;return I=(Nn(u,h)|0)==0,y=pr(u,h,0,d)|0,b=(y|0)==0,I?!b||(y=pr(u,h,1,d+8|0)|0,y|0)||(y=pr(u,h,2,d+16|0)|0,y|0)||(y=pr(u,h,3,d+24|0)|0,y|0)||(y=pr(u,h,4,d+32|0)|0,y)?(I=y,I|0):pr(u,h,5,d+40|0)|0:!b||(y=pr(u,h,1,d+8|0)|0,y|0)||(y=pr(u,h,2,d+16|0)|0,y|0)||(y=pr(u,h,3,d+24|0)|0,y|0)||(y=pr(u,h,4,d+32|0)|0,y|0)?(I=y,I|0):(I=d+40|0,o[I>>2]=0,o[I+4>>2]=0,I=0,I|0)}function uc(u,h,d){u=u|0,h=h|0,d=d|0;var y=0,b=0,I=0,R=0,N=0,W=0;return W=Ze,Ze=Ze+192|0,b=W,I=W+168|0,R=Xe(u|0,h|0,56)|0,et()|0,R=R&7,N=h&-2130706433|134217728,y=Rn(u,N,I)|0,y|0?(N=y,Ze=W,N|0):(h=Xe(u|0,h|0,52)|0,et()|0,h=h&15,Nn(u,N)|0?iA(I,h,R,1,b):Sn(I,h,R,1,b),N=b+8|0,o[d>>2]=o[N>>2],o[d+4>>2]=o[N+4>>2],o[d+8>>2]=o[N+8>>2],o[d+12>>2]=o[N+12>>2],N=0,Ze=W,N|0)}function Nl(u,h){u=u|0,h=h|0;var d=0,y=0,b=0,I=0;return b=Ze,Ze=Ze+16|0,d=b,!(!0&(h&2013265920|0)==536870912)||(y=h&-2130706433|134217728,!(_A(u,y)|0))?(y=0,Ze=b,y|0):(I=Xe(u|0,h|0,56)|0,et()|0,I=(pr(u,y,I&7,d)|0)==0,y=d,y=I&((o[y>>2]|0)==(u|0)?(o[y+4>>2]|0)==(h|0):0)&1,Ze=b,y|0)}function hc(u,h,d){u=u|0,h=h|0,d=d|0;var y=0;(h|0)>0?(y=T(h,4)|0,o[u>>2]=y,y||ar(23337,23360,40,23374)):o[u>>2]=0,o[u+4>>2]=h,o[u+8>>2]=0,o[u+12>>2]=d}function Mo(u){u=u|0;var h=0,d=0,y=0,b=0,I=0,R=0,N=0;b=u+4|0,I=u+12|0,R=u+8|0;e:for(;;){for(d=o[b>>2]|0,h=0;;){if((h|0)>=(d|0))break e;if(y=o[u>>2]|0,N=o[y+(h<<2)>>2]|0,!N)h=h+1|0;else break}h=y+(~~(+si(+(+gr(10,+ +(15-(o[I>>2]|0)|0))*(+oe[N>>3]+ +oe[N+8>>3])))%+(d|0))>>>0<<2)|0,d=o[h>>2]|0;t:do if(d|0){if(y=N+32|0,(d|0)==(N|0))o[h>>2]=o[y>>2];else{if(d=d+32|0,h=o[d>>2]|0,!h)break;for(;(h|0)!=(N|0);)if(d=h+32|0,h=o[d>>2]|0,!h)break t;o[d>>2]=o[y>>2]}x(N),o[R>>2]=(o[R>>2]|0)+-1}while(!1)}x(o[u>>2]|0)}function Da(u){u=u|0;var h=0,d=0,y=0;for(y=o[u+4>>2]|0,d=0;;){if((d|0)>=(y|0)){h=0,d=4;break}if(h=o[(o[u>>2]|0)+(d<<2)>>2]|0,!h)d=d+1|0;else{d=4;break}}return(d|0)==4?h|0:0}function Nt(u,h){u=u|0,h=h|0;var d=0,y=0,b=0,I=0;if(d=~~(+si(+(+gr(10,+ +(15-(o[u+12>>2]|0)|0))*(+oe[h>>3]+ +oe[h+8>>3])))%+(o[u+4>>2]|0))>>>0,d=(o[u>>2]|0)+(d<<2)|0,y=o[d>>2]|0,!y)return I=1,I|0;I=h+32|0;do if((y|0)!=(h|0)){if(d=o[y+32>>2]|0,!d)return I=1,I|0;for(b=d;;){if((b|0)==(h|0)){b=8;break}if(d=o[b+32>>2]|0,d)y=b,b=d;else{d=1,b=10;break}}if((b|0)==8){o[y+32>>2]=o[I>>2];break}else if((b|0)==10)return d|0}else o[d>>2]=o[I>>2];while(!1);return x(h),I=u+8|0,o[I>>2]=(o[I>>2]|0)+-1,I=0,I|0}function Kt(u,h,d){u=u|0,h=h|0,d=d|0;var y=0,b=0,I=0,R=0;I=Hn(40)|0,I||ar(23390,23360,98,23403),o[I>>2]=o[h>>2],o[I+4>>2]=o[h+4>>2],o[I+8>>2]=o[h+8>>2],o[I+12>>2]=o[h+12>>2],b=I+16|0,o[b>>2]=o[d>>2],o[b+4>>2]=o[d+4>>2],o[b+8>>2]=o[d+8>>2],o[b+12>>2]=o[d+12>>2],o[I+32>>2]=0,b=~~(+si(+(+gr(10,+ +(15-(o[u+12>>2]|0)|0))*(+oe[h>>3]+ +oe[h+8>>3])))%+(o[u+4>>2]|0))>>>0,b=(o[u>>2]|0)+(b<<2)|0,y=o[b>>2]|0;do if(!y)o[b>>2]=I;else{for(;!(Al(y,h)|0&&Al(y+16|0,d)|0);)if(b=o[y+32>>2]|0,y=b|0?b:y,!(o[y+32>>2]|0)){R=10;break}if((R|0)==10){o[y+32>>2]=I;break}return x(I),R=y,R|0}while(!1);return R=u+8|0,o[R>>2]=(o[R>>2]|0)+1,R=I,R|0}function aA(u,h,d){u=u|0,h=h|0,d=d|0;var y=0,b=0;if(b=~~(+si(+(+gr(10,+ +(15-(o[u+12>>2]|0)|0))*(+oe[h>>3]+ +oe[h+8>>3])))%+(o[u+4>>2]|0))>>>0,b=o[(o[u>>2]|0)+(b<<2)>>2]|0,!b)return d=0,d|0;if(!d){for(u=b;;){if(Al(u,h)|0){y=10;break}if(u=o[u+32>>2]|0,!u){u=0,y=10;break}}if((y|0)==10)return u|0}for(u=b;;){if(Al(u,h)|0&&Al(u+16|0,d)|0){y=10;break}if(u=o[u+32>>2]|0,!u){u=0,y=10;break}}return(y|0)==10?u|0:0}function El(u,h){u=u|0,h=h|0;var d=0;if(d=~~(+si(+(+gr(10,+ +(15-(o[u+12>>2]|0)|0))*(+oe[h>>3]+ +oe[h+8>>3])))%+(o[u+4>>2]|0))>>>0,u=o[(o[u>>2]|0)+(d<<2)>>2]|0,!u)return d=0,d|0;for(;;){if(Al(u,h)|0){h=5;break}if(u=o[u+32>>2]|0,!u){u=0,h=5;break}}return(h|0)==5?u|0:0}function Ul(){return 23424}function $r(u){return u=+u,+ +F(+u)}function pa(u){return u=+u,~~+$r(u)|0}function Hn(u){u=u|0;var h=0,d=0,y=0,b=0,I=0,R=0,N=0,W=0,K=0,le=0,de=0,ge=0,ke=0,Pe=0,qe=0,ht=0,mt=0,ot=0,ft=0,dt=0,ai=0;ai=Ze,Ze=Ze+16|0,ge=ai;do if(u>>>0<245){if(K=u>>>0<11?16:u+11&-8,u=K>>>3,de=o[5857]|0,d=de>>>u,d&3|0)return h=(d&1^1)+u|0,u=23468+(h<<1<<2)|0,d=u+8|0,y=o[d>>2]|0,b=y+8|0,I=o[b>>2]|0,(I|0)==(u|0)?o[5857]=de&~(1<<h):(o[I+12>>2]=u,o[d>>2]=I),dt=h<<3,o[y+4>>2]=dt|3,dt=y+dt+4|0,o[dt>>2]=o[dt>>2]|1,dt=b,Ze=ai,dt|0;if(le=o[5859]|0,K>>>0>le>>>0){if(d|0)return h=2<<u,h=d<<u&(h|0-h),h=(h&0-h)+-1|0,N=h>>>12&16,h=h>>>N,d=h>>>5&8,h=h>>>d,I=h>>>2&4,h=h>>>I,u=h>>>1&2,h=h>>>u,y=h>>>1&1,y=(d|N|I|u|y)+(h>>>y)|0,h=23468+(y<<1<<2)|0,u=h+8|0,I=o[u>>2]|0,N=I+8|0,d=o[N>>2]|0,(d|0)==(h|0)?(u=de&~(1<<y),o[5857]=u):(o[d+12>>2]=h,o[u>>2]=d,u=de),dt=y<<3,R=dt-K|0,o[I+4>>2]=K|3,b=I+K|0,o[b+4>>2]=R|1,o[I+dt>>2]=R,le|0&&(y=o[5862]|0,h=le>>>3,d=23468+(h<<1<<2)|0,h=1<<h,u&h?(u=d+8|0,h=o[u>>2]|0):(o[5857]=u|h,h=d,u=d+8|0),o[u>>2]=y,o[h+12>>2]=y,o[y+8>>2]=h,o[y+12>>2]=d),o[5859]=R,o[5862]=b,dt=N,Ze=ai,dt|0;if(I=o[5858]|0,I){for(d=(I&0-I)+-1|0,b=d>>>12&16,d=d>>>b,y=d>>>5&8,d=d>>>y,R=d>>>2&4,d=d>>>R,N=d>>>1&2,d=d>>>N,W=d>>>1&1,W=o[23732+((y|b|R|N|W)+(d>>>W)<<2)>>2]|0,d=W,N=W,W=(o[W+4>>2]&-8)-K|0;u=o[d+16>>2]|0,!(!u&&(u=o[d+20>>2]|0,!u));)R=(o[u+4>>2]&-8)-K|0,b=R>>>0<W>>>0,d=u,N=b?u:N,W=b?R:W;if(R=N+K|0,R>>>0>N>>>0){b=o[N+24>>2]|0,h=o[N+12>>2]|0;do if((h|0)==(N|0)){if(u=N+20|0,h=o[u>>2]|0,!h&&(u=N+16|0,h=o[u>>2]|0,!h)){d=0;break}for(;;)if(y=h+20|0,d=o[y>>2]|0,d)h=d,u=y;else if(y=h+16|0,d=o[y>>2]|0,d)h=d,u=y;else break;o[u>>2]=0,d=h}else d=o[N+8>>2]|0,o[d+12>>2]=h,o[h+8>>2]=d,d=h;while(!1);do if(b|0){if(h=o[N+28>>2]|0,u=23732+(h<<2)|0,(N|0)==(o[u>>2]|0)){if(o[u>>2]=d,!d){o[5858]=I&~(1<<h);break}}else if(dt=b+16|0,o[((o[dt>>2]|0)==(N|0)?dt:b+20|0)>>2]=d,!d)break;o[d+24>>2]=b,h=o[N+16>>2]|0,h|0&&(o[d+16>>2]=h,o[h+24>>2]=d),h=o[N+20>>2]|0,h|0&&(o[d+20>>2]=h,o[h+24>>2]=d)}while(!1);return W>>>0<16?(dt=W+K|0,o[N+4>>2]=dt|3,dt=N+dt+4|0,o[dt>>2]=o[dt>>2]|1):(o[N+4>>2]=K|3,o[R+4>>2]=W|1,o[R+W>>2]=W,le|0&&(y=o[5862]|0,h=le>>>3,d=23468+(h<<1<<2)|0,h=1<<h,h&de?(u=d+8|0,h=o[u>>2]|0):(o[5857]=h|de,h=d,u=d+8|0),o[u>>2]=y,o[h+12>>2]=y,o[y+8>>2]=h,o[y+12>>2]=d),o[5859]=W,o[5862]=R),dt=N+8|0,Ze=ai,dt|0}else de=K}else de=K}else de=K}else if(u>>>0<=4294967231)if(u=u+11|0,K=u&-8,y=o[5858]|0,y){b=0-K|0,u=u>>>8,u?K>>>0>16777215?W=31:(de=(u+1048320|0)>>>16&8,qe=u<<de,N=(qe+520192|0)>>>16&4,qe=qe<<N,W=(qe+245760|0)>>>16&2,W=14-(N|de|W)+(qe<<W>>>15)|0,W=K>>>(W+7|0)&1|W<<1):W=0,d=o[23732+(W<<2)>>2]|0;e:do if(!d)d=0,u=0,qe=61;else for(u=0,N=K<<((W|0)==31?0:25-(W>>>1)|0),I=0;;){if(R=(o[d+4>>2]&-8)-K|0,R>>>0<b>>>0)if(R)u=d,b=R;else{u=d,b=0,qe=65;break e}if(qe=o[d+20>>2]|0,d=o[d+16+(N>>>31<<2)>>2]|0,I=(qe|0)==0|(qe|0)==(d|0)?I:qe,d)N=N<<1;else{d=I,qe=61;break}}while(!1);if((qe|0)==61){if((d|0)==0&(u|0)==0){if(u=2<<W,u=(u|0-u)&y,!u){de=K;break}de=(u&0-u)+-1|0,R=de>>>12&16,de=de>>>R,I=de>>>5&8,de=de>>>I,N=de>>>2&4,de=de>>>N,W=de>>>1&2,de=de>>>W,d=de>>>1&1,u=0,d=o[23732+((I|R|N|W|d)+(de>>>d)<<2)>>2]|0}d?qe=65:(N=u,R=b)}if((qe|0)==65)for(I=d;;)if(de=(o[I+4>>2]&-8)-K|0,d=de>>>0<b>>>0,b=d?de:b,u=d?I:u,d=o[I+16>>2]|0,d||(d=o[I+20>>2]|0),d)I=d;else{N=u,R=b;break}if(N|0&&R>>>0<((o[5859]|0)-K|0)>>>0&&(le=N+K|0,le>>>0>N>>>0)){I=o[N+24>>2]|0,h=o[N+12>>2]|0;do if((h|0)==(N|0)){if(u=N+20|0,h=o[u>>2]|0,!h&&(u=N+16|0,h=o[u>>2]|0,!h)){h=0;break}for(;;)if(b=h+20|0,d=o[b>>2]|0,d)h=d,u=b;else if(b=h+16|0,d=o[b>>2]|0,d)h=d,u=b;else break;o[u>>2]=0}else dt=o[N+8>>2]|0,o[dt+12>>2]=h,o[h+8>>2]=dt;while(!1);do if(I){if(u=o[N+28>>2]|0,d=23732+(u<<2)|0,(N|0)==(o[d>>2]|0)){if(o[d>>2]=h,!h){y=y&~(1<<u),o[5858]=y;break}}else if(dt=I+16|0,o[((o[dt>>2]|0)==(N|0)?dt:I+20|0)>>2]=h,!h)break;o[h+24>>2]=I,u=o[N+16>>2]|0,u|0&&(o[h+16>>2]=u,o[u+24>>2]=h),u=o[N+20>>2]|0,u&&(o[h+20>>2]=u,o[u+24>>2]=h)}while(!1);e:do if(R>>>0<16)dt=R+K|0,o[N+4>>2]=dt|3,dt=N+dt+4|0,o[dt>>2]=o[dt>>2]|1;else{if(o[N+4>>2]=K|3,o[le+4>>2]=R|1,o[le+R>>2]=R,h=R>>>3,R>>>0<256){d=23468+(h<<1<<2)|0,u=o[5857]|0,h=1<<h,u&h?(u=d+8|0,h=o[u>>2]|0):(o[5857]=u|h,h=d,u=d+8|0),o[u>>2]=le,o[h+12>>2]=le,o[le+8>>2]=h,o[le+12>>2]=d;break}if(h=R>>>8,h?R>>>0>16777215?d=31:(ft=(h+1048320|0)>>>16&8,dt=h<<ft,ot=(dt+520192|0)>>>16&4,dt=dt<<ot,d=(dt+245760|0)>>>16&2,d=14-(ot|ft|d)+(dt<<d>>>15)|0,d=R>>>(d+7|0)&1|d<<1):d=0,h=23732+(d<<2)|0,o[le+28>>2]=d,u=le+16|0,o[u+4>>2]=0,o[u>>2]=0,u=1<<d,!(y&u)){o[5858]=y|u,o[h>>2]=le,o[le+24>>2]=h,o[le+12>>2]=le,o[le+8>>2]=le;break}h=o[h>>2]|0;t:do if((o[h+4>>2]&-8|0)!=(R|0)){for(y=R<<((d|0)==31?0:25-(d>>>1)|0);d=h+16+(y>>>31<<2)|0,u=o[d>>2]|0,!!u;)if((o[u+4>>2]&-8|0)==(R|0)){h=u;break t}else y=y<<1,h=u;o[d>>2]=le,o[le+24>>2]=h,o[le+12>>2]=le,o[le+8>>2]=le;break e}while(!1);ft=h+8|0,dt=o[ft>>2]|0,o[dt+12>>2]=le,o[ft>>2]=le,o[le+8>>2]=dt,o[le+12>>2]=h,o[le+24>>2]=0}while(!1);return dt=N+8|0,Ze=ai,dt|0}else de=K}else de=K;else de=-1;while(!1);if(d=o[5859]|0,d>>>0>=de>>>0)return h=d-de|0,u=o[5862]|0,h>>>0>15?(dt=u+de|0,o[5862]=dt,o[5859]=h,o[dt+4>>2]=h|1,o[u+d>>2]=h,o[u+4>>2]=de|3):(o[5859]=0,o[5862]=0,o[u+4>>2]=d|3,dt=u+d+4|0,o[dt>>2]=o[dt>>2]|1),dt=u+8|0,Ze=ai,dt|0;if(R=o[5860]|0,R>>>0>de>>>0)return ot=R-de|0,o[5860]=ot,dt=o[5863]|0,ft=dt+de|0,o[5863]=ft,o[ft+4>>2]=ot|1,o[dt+4>>2]=de|3,dt=dt+8|0,Ze=ai,dt|0;if(o[5975]|0?u=o[5977]|0:(o[5977]=4096,o[5976]=4096,o[5978]=-1,o[5979]=-1,o[5980]=0,o[5968]=0,o[5975]=ge&-16^1431655768,u=4096),N=de+48|0,W=de+47|0,I=u+W|0,b=0-u|0,K=I&b,K>>>0<=de>>>0||(u=o[5967]|0,u|0&&(le=o[5965]|0,ge=le+K|0,ge>>>0<=le>>>0|ge>>>0>u>>>0)))return dt=0,Ze=ai,dt|0;e:do if(o[5968]&4)h=0,qe=143;else{d=o[5863]|0;t:do if(d){for(y=23876;ge=o[y>>2]|0,!(ge>>>0<=d>>>0&&(ge+(o[y+4>>2]|0)|0)>>>0>d>>>0);)if(u=o[y+8>>2]|0,u)y=u;else{qe=128;break t}if(h=I-R&b,h>>>0<2147483647)if(u=Z(h|0)|0,(u|0)==((o[y>>2]|0)+(o[y+4>>2]|0)|0)){if((u|0)!=-1){R=h,I=u,qe=145;break e}}else y=u,qe=136;else h=0}else qe=128;while(!1);do if((qe|0)==128)if(d=Z(0)|0,(d|0)!=-1&&(h=d,ke=o[5976]|0,Pe=ke+-1|0,h=(Pe&h|0?(Pe+h&0-ke)-h|0:0)+K|0,ke=o[5965]|0,Pe=h+ke|0,h>>>0>de>>>0&h>>>0<2147483647)){if(ge=o[5967]|0,ge|0&&Pe>>>0<=ke>>>0|Pe>>>0>ge>>>0){h=0;break}if(u=Z(h|0)|0,(u|0)==(d|0)){R=h,I=d,qe=145;break e}else y=u,qe=136}else h=0;while(!1);do if((qe|0)==136){if(d=0-h|0,!(N>>>0>h>>>0&(h>>>0<2147483647&(y|0)!=-1)))if((y|0)==-1){h=0;break}else{R=h,I=y,qe=145;break e}if(u=o[5977]|0,u=W-h+u&0-u,u>>>0>=2147483647){R=h,I=y,qe=145;break e}if((Z(u|0)|0)==-1){Z(d|0)|0,h=0;break}else{R=u+h|0,I=y,qe=145;break e}}while(!1);o[5968]=o[5968]|4,qe=143}while(!1);if((qe|0)==143&&K>>>0<2147483647&&(ot=Z(K|0)|0,Pe=Z(0)|0,ht=Pe-ot|0,mt=ht>>>0>(de+40|0)>>>0,!((ot|0)==-1|mt^1|ot>>>0<Pe>>>0&((ot|0)!=-1&(Pe|0)!=-1)^1))&&(R=mt?ht:h,I=ot,qe=145),(qe|0)==145){h=(o[5965]|0)+R|0,o[5965]=h,h>>>0>(o[5966]|0)>>>0&&(o[5966]=h),W=o[5863]|0;e:do if(W){for(h=23876;;){if(u=o[h>>2]|0,d=o[h+4>>2]|0,(I|0)==(u+d|0)){qe=154;break}if(y=o[h+8>>2]|0,y)h=y;else break}if((qe|0)==154&&(ft=h+4|0,(o[h+12>>2]&8|0)==0)&&I>>>0>W>>>0&u>>>0<=W>>>0){o[ft>>2]=d+R,dt=(o[5860]|0)+R|0,ot=W+8|0,ot=ot&7|0?0-ot&7:0,ft=W+ot|0,ot=dt-ot|0,o[5863]=ft,o[5860]=ot,o[ft+4>>2]=ot|1,o[W+dt+4>>2]=40,o[5864]=o[5979];break}for(I>>>0<(o[5861]|0)>>>0&&(o[5861]=I),d=I+R|0,h=23876;;){if((o[h>>2]|0)==(d|0)){qe=162;break}if(u=o[h+8>>2]|0,u)h=u;else break}if((qe|0)==162&&!(o[h+12>>2]&8|0)){o[h>>2]=I,le=h+4|0,o[le>>2]=(o[le>>2]|0)+R,le=I+8|0,le=I+(le&7|0?0-le&7:0)|0,h=d+8|0,h=d+(h&7|0?0-h&7:0)|0,K=le+de|0,N=h-le-de|0,o[le+4>>2]=de|3;t:do if((W|0)==(h|0))dt=(o[5860]|0)+N|0,o[5860]=dt,o[5863]=K,o[K+4>>2]=dt|1;else{if((o[5862]|0)==(h|0)){dt=(o[5859]|0)+N|0,o[5859]=dt,o[5862]=K,o[K+4>>2]=dt|1,o[K+dt>>2]=dt;break}if(u=o[h+4>>2]|0,(u&3|0)==1){R=u&-8,y=u>>>3;i:do if(u>>>0<256)if(u=o[h+8>>2]|0,d=o[h+12>>2]|0,(d|0)==(u|0)){o[5857]=o[5857]&~(1<<y);break}else{o[u+12>>2]=d,o[d+8>>2]=u;break}else{I=o[h+24>>2]|0,u=o[h+12>>2]|0;do if((u|0)==(h|0)){if(d=h+16|0,y=d+4|0,u=o[y>>2]|0,u)d=y;else if(u=o[d>>2]|0,!u){u=0;break}for(;;)if(b=u+20|0,y=o[b>>2]|0,y)u=y,d=b;else if(b=u+16|0,y=o[b>>2]|0,y)u=y,d=b;else break;o[d>>2]=0}else dt=o[h+8>>2]|0,o[dt+12>>2]=u,o[u+8>>2]=dt;while(!1);if(!I)break;d=o[h+28>>2]|0,y=23732+(d<<2)|0;do if((o[y>>2]|0)!=(h|0)){if(dt=I+16|0,o[((o[dt>>2]|0)==(h|0)?dt:I+20|0)>>2]=u,!u)break i}else{if(o[y>>2]=u,u|0)break;o[5858]=o[5858]&~(1<<d);break i}while(!1);if(o[u+24>>2]=I,d=h+16|0,y=o[d>>2]|0,y|0&&(o[u+16>>2]=y,o[y+24>>2]=u),d=o[d+4>>2]|0,!d)break;o[u+20>>2]=d,o[d+24>>2]=u}while(!1);h=h+R|0,b=R+N|0}else b=N;if(h=h+4|0,o[h>>2]=o[h>>2]&-2,o[K+4>>2]=b|1,o[K+b>>2]=b,h=b>>>3,b>>>0<256){d=23468+(h<<1<<2)|0,u=o[5857]|0,h=1<<h,u&h?(u=d+8|0,h=o[u>>2]|0):(o[5857]=u|h,h=d,u=d+8|0),o[u>>2]=K,o[h+12>>2]=K,o[K+8>>2]=h,o[K+12>>2]=d;break}h=b>>>8;do if(!h)y=0;else{if(b>>>0>16777215){y=31;break}ft=(h+1048320|0)>>>16&8,dt=h<<ft,ot=(dt+520192|0)>>>16&4,dt=dt<<ot,y=(dt+245760|0)>>>16&2,y=14-(ot|ft|y)+(dt<<y>>>15)|0,y=b>>>(y+7|0)&1|y<<1}while(!1);if(h=23732+(y<<2)|0,o[K+28>>2]=y,u=K+16|0,o[u+4>>2]=0,o[u>>2]=0,u=o[5858]|0,d=1<<y,!(u&d)){o[5858]=u|d,o[h>>2]=K,o[K+24>>2]=h,o[K+12>>2]=K,o[K+8>>2]=K;break}h=o[h>>2]|0;i:do if((o[h+4>>2]&-8|0)!=(b|0)){for(y=b<<((y|0)==31?0:25-(y>>>1)|0);d=h+16+(y>>>31<<2)|0,u=o[d>>2]|0,!!u;)if((o[u+4>>2]&-8|0)==(b|0)){h=u;break i}else y=y<<1,h=u;o[d>>2]=K,o[K+24>>2]=h,o[K+12>>2]=K,o[K+8>>2]=K;break t}while(!1);ft=h+8|0,dt=o[ft>>2]|0,o[dt+12>>2]=K,o[ft>>2]=K,o[K+8>>2]=dt,o[K+12>>2]=h,o[K+24>>2]=0}while(!1);return dt=le+8|0,Ze=ai,dt|0}for(h=23876;u=o[h>>2]|0,!(u>>>0<=W>>>0&&(dt=u+(o[h+4>>2]|0)|0,dt>>>0>W>>>0));)h=o[h+8>>2]|0;b=dt+-47|0,u=b+8|0,u=b+(u&7|0?0-u&7:0)|0,b=W+16|0,u=u>>>0<b>>>0?W:u,h=u+8|0,d=R+-40|0,ot=I+8|0,ot=ot&7|0?0-ot&7:0,ft=I+ot|0,ot=d-ot|0,o[5863]=ft,o[5860]=ot,o[ft+4>>2]=ot|1,o[I+d+4>>2]=40,o[5864]=o[5979],d=u+4|0,o[d>>2]=27,o[h>>2]=o[5969],o[h+4>>2]=o[5970],o[h+8>>2]=o[5971],o[h+12>>2]=o[5972],o[5969]=I,o[5970]=R,o[5972]=0,o[5971]=h,h=u+24|0;do ft=h,h=h+4|0,o[h>>2]=7;while((ft+8|0)>>>0<dt>>>0);if((u|0)!=(W|0)){if(I=u-W|0,o[d>>2]=o[d>>2]&-2,o[W+4>>2]=I|1,o[u>>2]=I,h=I>>>3,I>>>0<256){d=23468+(h<<1<<2)|0,u=o[5857]|0,h=1<<h,u&h?(u=d+8|0,h=o[u>>2]|0):(o[5857]=u|h,h=d,u=d+8|0),o[u>>2]=W,o[h+12>>2]=W,o[W+8>>2]=h,o[W+12>>2]=d;break}if(h=I>>>8,h?I>>>0>16777215?y=31:(ft=(h+1048320|0)>>>16&8,dt=h<<ft,ot=(dt+520192|0)>>>16&4,dt=dt<<ot,y=(dt+245760|0)>>>16&2,y=14-(ot|ft|y)+(dt<<y>>>15)|0,y=I>>>(y+7|0)&1|y<<1):y=0,d=23732+(y<<2)|0,o[W+28>>2]=y,o[W+20>>2]=0,o[b>>2]=0,h=o[5858]|0,u=1<<y,!(h&u)){o[5858]=h|u,o[d>>2]=W,o[W+24>>2]=d,o[W+12>>2]=W,o[W+8>>2]=W;break}h=o[d>>2]|0;t:do if((o[h+4>>2]&-8|0)!=(I|0)){for(y=I<<((y|0)==31?0:25-(y>>>1)|0);d=h+16+(y>>>31<<2)|0,u=o[d>>2]|0,!!u;)if((o[u+4>>2]&-8|0)==(I|0)){h=u;break t}else y=y<<1,h=u;o[d>>2]=W,o[W+24>>2]=h,o[W+12>>2]=W,o[W+8>>2]=W;break e}while(!1);ft=h+8|0,dt=o[ft>>2]|0,o[dt+12>>2]=W,o[ft>>2]=W,o[W+8>>2]=dt,o[W+12>>2]=h,o[W+24>>2]=0}}else dt=o[5861]|0,(dt|0)==0|I>>>0<dt>>>0&&(o[5861]=I),o[5969]=I,o[5970]=R,o[5972]=0,o[5866]=o[5975],o[5865]=-1,o[5870]=23468,o[5869]=23468,o[5872]=23476,o[5871]=23476,o[5874]=23484,o[5873]=23484,o[5876]=23492,o[5875]=23492,o[5878]=23500,o[5877]=23500,o[5880]=23508,o[5879]=23508,o[5882]=23516,o[5881]=23516,o[5884]=23524,o[5883]=23524,o[5886]=23532,o[5885]=23532,o[5888]=23540,o[5887]=23540,o[5890]=23548,o[5889]=23548,o[5892]=23556,o[5891]=23556,o[5894]=23564,o[5893]=23564,o[5896]=23572,o[5895]=23572,o[5898]=23580,o[5897]=23580,o[5900]=23588,o[5899]=23588,o[5902]=23596,o[5901]=23596,o[5904]=23604,o[5903]=23604,o[5906]=23612,o[5905]=23612,o[5908]=23620,o[5907]=23620,o[5910]=23628,o[5909]=23628,o[5912]=23636,o[5911]=23636,o[5914]=23644,o[5913]=23644,o[5916]=23652,o[5915]=23652,o[5918]=23660,o[5917]=23660,o[5920]=23668,o[5919]=23668,o[5922]=23676,o[5921]=23676,o[5924]=23684,o[5923]=23684,o[5926]=23692,o[5925]=23692,o[5928]=23700,o[5927]=23700,o[5930]=23708,o[5929]=23708,o[5932]=23716,o[5931]=23716,dt=R+-40|0,ot=I+8|0,ot=ot&7|0?0-ot&7:0,ft=I+ot|0,ot=dt-ot|0,o[5863]=ft,o[5860]=ot,o[ft+4>>2]=ot|1,o[I+dt+4>>2]=40,o[5864]=o[5979];while(!1);if(h=o[5860]|0,h>>>0>de>>>0)return ot=h-de|0,o[5860]=ot,dt=o[5863]|0,ft=dt+de|0,o[5863]=ft,o[ft+4>>2]=ot|1,o[dt+4>>2]=de|3,dt=dt+8|0,Ze=ai,dt|0}return dt=Ul()|0,o[dt>>2]=12,dt=0,Ze=ai,dt|0}function x(u){u=u|0;var h=0,d=0,y=0,b=0,I=0,R=0,N=0,W=0;if(u){d=u+-8|0,b=o[5861]|0,u=o[u+-4>>2]|0,h=u&-8,W=d+h|0;do if(u&1)N=d,R=d;else{if(y=o[d>>2]|0,!(u&3)||(R=d+(0-y)|0,I=y+h|0,R>>>0<b>>>0))return;if((o[5862]|0)==(R|0)){if(u=W+4|0,h=o[u>>2]|0,(h&3|0)!=3){N=R,h=I;break}o[5859]=I,o[u>>2]=h&-2,o[R+4>>2]=I|1,o[R+I>>2]=I;return}if(d=y>>>3,y>>>0<256)if(u=o[R+8>>2]|0,h=o[R+12>>2]|0,(h|0)==(u|0)){o[5857]=o[5857]&~(1<<d),N=R,h=I;break}else{o[u+12>>2]=h,o[h+8>>2]=u,N=R,h=I;break}b=o[R+24>>2]|0,u=o[R+12>>2]|0;do if((u|0)==(R|0)){if(h=R+16|0,d=h+4|0,u=o[d>>2]|0,u)h=d;else if(u=o[h>>2]|0,!u){u=0;break}for(;;)if(y=u+20|0,d=o[y>>2]|0,d)u=d,h=y;else if(y=u+16|0,d=o[y>>2]|0,d)u=d,h=y;else break;o[h>>2]=0}else N=o[R+8>>2]|0,o[N+12>>2]=u,o[u+8>>2]=N;while(!1);if(b){if(h=o[R+28>>2]|0,d=23732+(h<<2)|0,(o[d>>2]|0)==(R|0)){if(o[d>>2]=u,!u){o[5858]=o[5858]&~(1<<h),N=R,h=I;break}}else if(N=b+16|0,o[((o[N>>2]|0)==(R|0)?N:b+20|0)>>2]=u,!u){N=R,h=I;break}o[u+24>>2]=b,h=R+16|0,d=o[h>>2]|0,d|0&&(o[u+16>>2]=d,o[d+24>>2]=u),h=o[h+4>>2]|0,h?(o[u+20>>2]=h,o[h+24>>2]=u,N=R,h=I):(N=R,h=I)}else N=R,h=I}while(!1);if(!(R>>>0>=W>>>0)&&(u=W+4|0,y=o[u>>2]|0,!!(y&1))){if(y&2)o[u>>2]=y&-2,o[N+4>>2]=h|1,o[R+h>>2]=h,b=h;else{if((o[5863]|0)==(W|0)){if(W=(o[5860]|0)+h|0,o[5860]=W,o[5863]=N,o[N+4>>2]=W|1,(N|0)!=(o[5862]|0))return;o[5862]=0,o[5859]=0;return}if((o[5862]|0)==(W|0)){W=(o[5859]|0)+h|0,o[5859]=W,o[5862]=R,o[N+4>>2]=W|1,o[R+W>>2]=W;return}b=(y&-8)+h|0,d=y>>>3;do if(y>>>0<256)if(h=o[W+8>>2]|0,u=o[W+12>>2]|0,(u|0)==(h|0)){o[5857]=o[5857]&~(1<<d);break}else{o[h+12>>2]=u,o[u+8>>2]=h;break}else{I=o[W+24>>2]|0,u=o[W+12>>2]|0;do if((u|0)==(W|0)){if(h=W+16|0,d=h+4|0,u=o[d>>2]|0,u)h=d;else if(u=o[h>>2]|0,!u){d=0;break}for(;;)if(y=u+20|0,d=o[y>>2]|0,d)u=d,h=y;else if(y=u+16|0,d=o[y>>2]|0,d)u=d,h=y;else break;o[h>>2]=0,d=u}else d=o[W+8>>2]|0,o[d+12>>2]=u,o[u+8>>2]=d,d=u;while(!1);if(I|0){if(u=o[W+28>>2]|0,h=23732+(u<<2)|0,(o[h>>2]|0)==(W|0)){if(o[h>>2]=d,!d){o[5858]=o[5858]&~(1<<u);break}}else if(y=I+16|0,o[((o[y>>2]|0)==(W|0)?y:I+20|0)>>2]=d,!d)break;o[d+24>>2]=I,u=W+16|0,h=o[u>>2]|0,h|0&&(o[d+16>>2]=h,o[h+24>>2]=d),u=o[u+4>>2]|0,u|0&&(o[d+20>>2]=u,o[u+24>>2]=d)}}while(!1);if(o[N+4>>2]=b|1,o[R+b>>2]=b,(N|0)==(o[5862]|0)){o[5859]=b;return}}if(u=b>>>3,b>>>0<256){d=23468+(u<<1<<2)|0,h=o[5857]|0,u=1<<u,h&u?(h=d+8|0,u=o[h>>2]|0):(o[5857]=h|u,u=d,h=d+8|0),o[h>>2]=N,o[u+12>>2]=N,o[N+8>>2]=u,o[N+12>>2]=d;return}u=b>>>8,u?b>>>0>16777215?y=31:(R=(u+1048320|0)>>>16&8,W=u<<R,I=(W+520192|0)>>>16&4,W=W<<I,y=(W+245760|0)>>>16&2,y=14-(I|R|y)+(W<<y>>>15)|0,y=b>>>(y+7|0)&1|y<<1):y=0,u=23732+(y<<2)|0,o[N+28>>2]=y,o[N+20>>2]=0,o[N+16>>2]=0,h=o[5858]|0,d=1<<y;e:do if(!(h&d))o[5858]=h|d,o[u>>2]=N,o[N+24>>2]=u,o[N+12>>2]=N,o[N+8>>2]=N;else{u=o[u>>2]|0;t:do if((o[u+4>>2]&-8|0)!=(b|0)){for(y=b<<((y|0)==31?0:25-(y>>>1)|0);d=u+16+(y>>>31<<2)|0,h=o[d>>2]|0,!!h;)if((o[h+4>>2]&-8|0)==(b|0)){u=h;break t}else y=y<<1,u=h;o[d>>2]=N,o[N+24>>2]=u,o[N+12>>2]=N,o[N+8>>2]=N;break e}while(!1);R=u+8|0,W=o[R>>2]|0,o[W+12>>2]=N,o[R>>2]=N,o[N+8>>2]=W,o[N+12>>2]=u,o[N+24>>2]=0}while(!1);if(W=(o[5865]|0)+-1|0,o[5865]=W,!(W|0)){for(u=23884;u=o[u>>2]|0,u;)u=u+8|0;o[5865]=-1}}}}function T(u,h){u=u|0,h=h|0;var d=0;return u?(d=en(h,u)|0,(h|u)>>>0>65535&&(d=((d>>>0)/(u>>>0)|0|0)==(h|0)?d:-1)):d=0,u=Hn(d)|0,!u||!(o[u+-4>>2]&3)||k(u|0,0,d|0)|0,u|0}function M(u,h,d,y){return u=u|0,h=h|0,d=d|0,y=y|0,d=u+d>>>0,Ci(h+y+(d>>>0<u>>>0|0)>>>0|0),d|0|0}function L(u,h,d,y){return u=u|0,h=h|0,d=d|0,y=y|0,y=h-y-(d>>>0>u>>>0|0)>>>0,Ci(y|0),u-d>>>0|0|0}function j(u){return u=u|0,(u?31-(gt(u^u-1)|0)|0:32)|0}function H(u,h,d,y,b){u=u|0,h=h|0,d=d|0,y=y|0,b=b|0;var I=0,R=0,N=0,W=0,K=0,le=0,de=0,ge=0,ke=0,Pe=0;if(le=u,W=h,K=W,R=d,ge=y,N=ge,!K)return I=(b|0)!=0,N?I?(o[b>>2]=u|0,o[b+4>>2]=h&0,ge=0,b=0,Ci(ge|0),b|0):(ge=0,b=0,Ci(ge|0),b|0):(I&&(o[b>>2]=(le>>>0)%(R>>>0),o[b+4>>2]=0),ge=0,b=(le>>>0)/(R>>>0)>>>0,Ci(ge|0),b|0);I=(N|0)==0;do if(R){if(!I){if(I=(gt(N|0)|0)-(gt(K|0)|0)|0,I>>>0<=31){de=I+1|0,N=31-I|0,h=I-31>>31,R=de,u=le>>>(de>>>0)&h|K<<N,h=K>>>(de>>>0)&h,I=0,N=le<<N;break}return b?(o[b>>2]=u|0,o[b+4>>2]=W|h&0,ge=0,b=0,Ci(ge|0),b|0):(ge=0,b=0,Ci(ge|0),b|0)}if(I=R-1|0,I&R|0){N=(gt(R|0)|0)+33-(gt(K|0)|0)|0,Pe=64-N|0,de=32-N|0,W=de>>31,ke=N-32|0,h=ke>>31,R=N,u=de-1>>31&K>>>(ke>>>0)|(K<<de|le>>>(N>>>0))&h,h=h&K>>>(N>>>0),I=le<<Pe&W,N=(K<<Pe|le>>>(ke>>>0))&W|le<<de&N-33>>31;break}return b|0&&(o[b>>2]=I&le,o[b+4>>2]=0),(R|0)==1?(ke=W|h&0,Pe=u|0|0,Ci(ke|0),Pe|0):(Pe=j(R|0)|0,ke=K>>>(Pe>>>0)|0,Pe=K<<32-Pe|le>>>(Pe>>>0)|0,Ci(ke|0),Pe|0)}else{if(I)return b|0&&(o[b>>2]=(K>>>0)%(R>>>0),o[b+4>>2]=0),ke=0,Pe=(K>>>0)/(R>>>0)>>>0,Ci(ke|0),Pe|0;if(!le)return b|0&&(o[b>>2]=0,o[b+4>>2]=(K>>>0)%(N>>>0)),ke=0,Pe=(K>>>0)/(N>>>0)>>>0,Ci(ke|0),Pe|0;if(I=N-1|0,!(I&N))return b|0&&(o[b>>2]=u|0,o[b+4>>2]=I&K|h&0),ke=0,Pe=K>>>((j(N|0)|0)>>>0),Ci(ke|0),Pe|0;if(I=(gt(N|0)|0)-(gt(K|0)|0)|0,I>>>0<=30){h=I+1|0,N=31-I|0,R=h,u=K<<N|le>>>(h>>>0),h=K>>>(h>>>0),I=0,N=le<<N;break}return b?(o[b>>2]=u|0,o[b+4>>2]=W|h&0,ke=0,Pe=0,Ci(ke|0),Pe|0):(ke=0,Pe=0,Ci(ke|0),Pe|0)}while(!1);if(!R)K=N,W=0,N=0;else{de=d|0|0,le=ge|y&0,K=M(de|0,le|0,-1,-1)|0,d=et()|0,W=N,N=0;do y=W,W=I>>>31|W<<1,I=N|I<<1,y=u<<1|y>>>31|0,ge=u>>>31|h<<1|0,L(K|0,d|0,y|0,ge|0)|0,Pe=et()|0,ke=Pe>>31|((Pe|0)<0?-1:0)<<1,N=ke&1,u=L(y|0,ge|0,ke&de|0,(((Pe|0)<0?-1:0)>>31|((Pe|0)<0?-1:0)<<1)&le|0)|0,h=et()|0,R=R-1|0;while(R|0);K=W,W=0}return R=0,b|0&&(o[b>>2]=u,o[b+4>>2]=h),ke=(I|0)>>>31|(K|R)<<1|(R<<1|I>>>31)&0|W,Pe=(I<<1|0)&-2|N,Ci(ke|0),Pe|0}function Q(u,h,d,y){u=u|0,h=h|0,d=d|0,y=y|0;var b=0,I=0,R=0,N=0,W=0,K=0;return K=h>>31|((h|0)<0?-1:0)<<1,W=((h|0)<0?-1:0)>>31|((h|0)<0?-1:0)<<1,I=y>>31|((y|0)<0?-1:0)<<1,b=((y|0)<0?-1:0)>>31|((y|0)<0?-1:0)<<1,N=L(K^u|0,W^h|0,K|0,W|0)|0,R=et()|0,u=I^K,h=b^W,L((H(N,R,L(I^d|0,b^y|0,I|0,b|0)|0,et()|0,0)|0)^u|0,(et()|0)^h|0,u|0,h|0)|0}function J(u,h){u=u|0,h=h|0;var d=0,y=0,b=0,I=0;return I=u&65535,b=h&65535,d=en(b,I)|0,y=u>>>16,u=(d>>>16)+(en(b,y)|0)|0,b=h>>>16,h=en(b,I)|0,Ci((u>>>16)+(en(b,y)|0)+(((u&65535)+h|0)>>>16)|0),u+h<<16|d&65535|0|0}function ue(u,h,d,y){u=u|0,h=h|0,d=d|0,y=y|0;var b=0,I=0;return b=u,I=d,d=J(b,I)|0,u=et()|0,Ci((en(h,I)|0)+(en(y,b)|0)+u|u&0|0),d|0|0|0}function Ce(u,h,d,y){u=u|0,h=h|0,d=d|0,y=y|0;var b=0,I=0,R=0,N=0,W=0,K=0;return b=Ze,Ze=Ze+16|0,N=b|0,R=h>>31|((h|0)<0?-1:0)<<1,I=((h|0)<0?-1:0)>>31|((h|0)<0?-1:0)<<1,K=y>>31|((y|0)<0?-1:0)<<1,W=((y|0)<0?-1:0)>>31|((y|0)<0?-1:0)<<1,u=L(R^u|0,I^h|0,R|0,I|0)|0,h=et()|0,H(u,h,L(K^d|0,W^y|0,K|0,W|0)|0,et()|0,N)|0,y=L(o[N>>2]^R|0,o[N+4>>2]^I|0,R|0,I|0)|0,d=et()|0,Ze=b,Ci(d|0),y|0}function ze(u,h,d,y){u=u|0,h=h|0,d=d|0,y=y|0;var b=0,I=0;return I=Ze,Ze=Ze+16|0,b=I|0,H(u,h,d,y,b)|0,Ze=I,Ci(o[b+4>>2]|0),o[b>>2]|0|0}function _t(u,h,d){return u=u|0,h=h|0,d=d|0,(d|0)<32?(Ci(h>>d|0),u>>>d|(h&(1<<d)-1)<<32-d):(Ci(((h|0)<0?-1:0)|0),h>>d-32|0)}function Xe(u,h,d){return u=u|0,h=h|0,d=d|0,(d|0)<32?(Ci(h>>>d|0),u>>>d|(h&(1<<d)-1)<<32-d):(Ci(0),h>>>d-32|0)}function it(u,h,d){return u=u|0,h=h|0,d=d|0,(d|0)<32?(Ci(h<<d|(u&(1<<d)-1<<32-d)>>>32-d|0),u<<d):(Ci(u<<d-32|0),0)}function z(u,h){return u=+u,h=+h,u!=u?+h:h!=h?+u:+kr(+u,+h)}function l(u,h){return u=+u,h=+h,u!=u?+h:h!=h?+u:+Ko(+u,+h)}function g(u){return u=+u,u>=0?+mi(u+.5):+Ro(u-.5)}function S(u,h,d){u=u|0,h=h|0,d=d|0;var y=0,b=0,I=0;if((d|0)>=8192)return Dl(u|0,h|0,d|0)|0,u|0;if(I=u|0,b=u+d|0,(u&3)==(h&3)){for(;u&3;){if(!d)return I|0;zt[u>>0]=zt[h>>0]|0,u=u+1|0,h=h+1|0,d=d-1|0}for(d=b&-4|0,y=d-64|0;(u|0)<=(y|0);)o[u>>2]=o[h>>2],o[u+4>>2]=o[h+4>>2],o[u+8>>2]=o[h+8>>2],o[u+12>>2]=o[h+12>>2],o[u+16>>2]=o[h+16>>2],o[u+20>>2]=o[h+20>>2],o[u+24>>2]=o[h+24>>2],o[u+28>>2]=o[h+28>>2],o[u+32>>2]=o[h+32>>2],o[u+36>>2]=o[h+36>>2],o[u+40>>2]=o[h+40>>2],o[u+44>>2]=o[h+44>>2],o[u+48>>2]=o[h+48>>2],o[u+52>>2]=o[h+52>>2],o[u+56>>2]=o[h+56>>2],o[u+60>>2]=o[h+60>>2],u=u+64|0,h=h+64|0;for(;(u|0)<(d|0);)o[u>>2]=o[h>>2],u=u+4|0,h=h+4|0}else for(d=b-4|0;(u|0)<(d|0);)zt[u>>0]=zt[h>>0]|0,zt[u+1>>0]=zt[h+1>>0]|0,zt[u+2>>0]=zt[h+2>>0]|0,zt[u+3>>0]=zt[h+3>>0]|0,u=u+4|0,h=h+4|0;for(;(u|0)<(b|0);)zt[u>>0]=zt[h>>0]|0,u=u+1|0,h=h+1|0;return I|0}function k(u,h,d){u=u|0,h=h|0,d=d|0;var y=0,b=0,I=0,R=0;if(I=u+d|0,h=h&255,(d|0)>=67){for(;u&3;)zt[u>>0]=h,u=u+1|0;for(y=I&-4|0,R=h|h<<8|h<<16|h<<24,b=y-64|0;(u|0)<=(b|0);)o[u>>2]=R,o[u+4>>2]=R,o[u+8>>2]=R,o[u+12>>2]=R,o[u+16>>2]=R,o[u+20>>2]=R,o[u+24>>2]=R,o[u+28>>2]=R,o[u+32>>2]=R,o[u+36>>2]=R,o[u+40>>2]=R,o[u+44>>2]=R,o[u+48>>2]=R,o[u+52>>2]=R,o[u+56>>2]=R,o[u+60>>2]=R,u=u+64|0;for(;(u|0)<(y|0);)o[u>>2]=R,u=u+4|0}for(;(u|0)<(I|0);)zt[u>>0]=h,u=u+1|0;return I-d|0}function F(u){return u=+u,u>=0?+mi(u+.5):+Ro(u-.5)}function Z(u){u=u|0;var h=0,d=0,y=0;return y=BA()|0,d=o[_i>>2]|0,h=d+u|0,(u|0)>0&(h|0)<(d|0)|(h|0)<0?(xn(h|0)|0,to(12),-1):(h|0)>(y|0)&&!(st(h|0)|0)?(to(12),-1):(o[_i>>2]=h,d|0)}return{___divdi3:Q,___muldi3:ue,___remdi3:Ce,___uremdi3:ze,_areNeighborCells:vo,_bitshift64Ashr:_t,_bitshift64Lshr:Xe,_bitshift64Shl:it,_calloc:T,_cellAreaKm2:Ca,_cellAreaM2:ul,_cellAreaRads2:ia,_cellToBoundary:Un,_cellToCenterChild:ol,_cellToChildPos:Ia,_cellToChildren:Bc,_cellToChildrenSize:yl,_cellToLatLng:Sa,_cellToLocalIj:fl,_cellToParent:No,_cellToVertex:pr,_cellToVertexes:ra,_cellsToDirectedEdge:fo,_cellsToLinkedMultiPolygon:tc,_childPosToCell:Ol,_compactCells:Za,_destroyLinkedMultiPolygon:hl,_directedEdgeToBoundary:qs,_directedEdgeToCells:Ea,_edgeLengthKm:ku,_edgeLengthM:oc,_edgeLengthRads:wl,_emscripten_replace_memory:hs,_free:x,_getBaseCellNumber:sl,_getDirectedEdgeDestination:tA,_getDirectedEdgeOrigin:Ll,_getHexagonAreaAvgKm2:NA,_getHexagonAreaAvgM2:cl,_getHexagonEdgeLengthAvgKm:sc,_getHexagonEdgeLengthAvgM:bl,_getIcosahedronFaces:al,_getNumCells:UA,_getPentagons:wo,_getRes0Cells:la,_getResolution:zc,_greatCircleDistanceKm:To,_greatCircleDistanceM:ha,_greatCircleDistanceRads:Lc,_gridDisk:Jo,_gridDiskDistances:Gs,_gridDistance:Ei,_gridPathCells:VA,_gridPathCellsSize:nA,_gridRingUnsafe:$A,_i64Add:M,_i64Subtract:L,_isPentagon:Nn,_isResClassIII:Qs,_isValidCell:_A,_isValidDirectedEdge:ms,_isValidVertex:Nl,_latLngToCell:ta,_llvm_maxnum_f64:z,_llvm_minnum_f64:l,_llvm_round_f64:g,_localIjToCell:ac,_malloc:Hn,_maxFaceCount:qa,_maxGridDiskSize:dn,_maxPolygonToCellsSize:ec,_memcpy:S,_memset:k,_originToDirectedEdges:Rl,_pentagonCount:vl,_polygonToCells:fA,_readInt64AsDoubleFromPointer:sA,_res0CellCount:vn,_round:F,_sbrk:Z,_sizeOfCellBoundary:GA,_sizeOfCoordIJ:ka,_sizeOfGeoLoop:ZA,_sizeOfGeoPolygon:Ki,_sizeOfH3Index:ks,_sizeOfLatLng:xA,_sizeOfLinkedGeoPolygon:Po,_uncompactCells:Cu,_uncompactCellsSize:Os,_vertexToLatLng:uc,establishStackSpace:Wi,stackAlloc:Jl,stackRestore:JA,stackSave:uo}}(co,Sr,Lt);te.___divdi3=kt.___divdi3,te.___muldi3=kt.___muldi3,te.___remdi3=kt.___remdi3,te.___uremdi3=kt.___uremdi3,te._areNeighborCells=kt._areNeighborCells,te._bitshift64Ashr=kt._bitshift64Ashr,te._bitshift64Lshr=kt._bitshift64Lshr,te._bitshift64Shl=kt._bitshift64Shl,te._calloc=kt._calloc,te._cellAreaKm2=kt._cellAreaKm2,te._cellAreaM2=kt._cellAreaM2,te._cellAreaRads2=kt._cellAreaRads2,te._cellToBoundary=kt._cellToBoundary,te._cellToCenterChild=kt._cellToCenterChild,te._cellToChildPos=kt._cellToChildPos,te._cellToChildren=kt._cellToChildren,te._cellToChildrenSize=kt._cellToChildrenSize,te._cellToLatLng=kt._cellToLatLng,te._cellToLocalIj=kt._cellToLocalIj,te._cellToParent=kt._cellToParent,te._cellToVertex=kt._cellToVertex,te._cellToVertexes=kt._cellToVertexes,te._cellsToDirectedEdge=kt._cellsToDirectedEdge,te._cellsToLinkedMultiPolygon=kt._cellsToLinkedMultiPolygon,te._childPosToCell=kt._childPosToCell,te._compactCells=kt._compactCells,te._destroyLinkedMultiPolygon=kt._destroyLinkedMultiPolygon,te._directedEdgeToBoundary=kt._directedEdgeToBoundary,te._directedEdgeToCells=kt._directedEdgeToCells,te._edgeLengthKm=kt._edgeLengthKm,te._edgeLengthM=kt._edgeLengthM,te._edgeLengthRads=kt._edgeLengthRads;var we=te._emscripten_replace_memory=kt._emscripten_replace_memory;te._free=kt._free,te._getBaseCellNumber=kt._getBaseCellNumber,te._getDirectedEdgeDestination=kt._getDirectedEdgeDestination,te._getDirectedEdgeOrigin=kt._getDirectedEdgeOrigin,te._getHexagonAreaAvgKm2=kt._getHexagonAreaAvgKm2,te._getHexagonAreaAvgM2=kt._getHexagonAreaAvgM2,te._getHexagonEdgeLengthAvgKm=kt._getHexagonEdgeLengthAvgKm,te._getHexagonEdgeLengthAvgM=kt._getHexagonEdgeLengthAvgM,te._getIcosahedronFaces=kt._getIcosahedronFaces,te._getNumCells=kt._getNumCells,te._getPentagons=kt._getPentagons,te._getRes0Cells=kt._getRes0Cells,te._getResolution=kt._getResolution,te._greatCircleDistanceKm=kt._greatCircleDistanceKm,te._greatCircleDistanceM=kt._greatCircleDistanceM,te._greatCircleDistanceRads=kt._greatCircleDistanceRads,te._gridDisk=kt._gridDisk,te._gridDiskDistances=kt._gridDiskDistances,te._gridDistance=kt._gridDistance,te._gridPathCells=kt._gridPathCells,te._gridPathCellsSize=kt._gridPathCellsSize,te._gridRingUnsafe=kt._gridRingUnsafe,te._i64Add=kt._i64Add,te._i64Subtract=kt._i64Subtract,te._isPentagon=kt._isPentagon,te._isResClassIII=kt._isResClassIII,te._isValidCell=kt._isValidCell,te._isValidDirectedEdge=kt._isValidDirectedEdge,te._isValidVertex=kt._isValidVertex,te._latLngToCell=kt._latLngToCell,te._llvm_maxnum_f64=kt._llvm_maxnum_f64,te._llvm_minnum_f64=kt._llvm_minnum_f64,te._llvm_round_f64=kt._llvm_round_f64,te._localIjToCell=kt._localIjToCell,te._malloc=kt._malloc,te._maxFaceCount=kt._maxFaceCount,te._maxGridDiskSize=kt._maxGridDiskSize,te._maxPolygonToCellsSize=kt._maxPolygonToCellsSize,te._memcpy=kt._memcpy,te._memset=kt._memset,te._originToDirectedEdges=kt._originToDirectedEdges,te._pentagonCount=kt._pentagonCount,te._polygonToCells=kt._polygonToCells,te._readInt64AsDoubleFromPointer=kt._readInt64AsDoubleFromPointer,te._res0CellCount=kt._res0CellCount,te._round=kt._round,te._sbrk=kt._sbrk,te._sizeOfCellBoundary=kt._sizeOfCellBoundary,te._sizeOfCoordIJ=kt._sizeOfCoordIJ,te._sizeOfGeoLoop=kt._sizeOfGeoLoop,te._sizeOfGeoPolygon=kt._sizeOfGeoPolygon,te._sizeOfH3Index=kt._sizeOfH3Index,te._sizeOfLatLng=kt._sizeOfLatLng,te._sizeOfLinkedGeoPolygon=kt._sizeOfLinkedGeoPolygon,te._uncompactCells=kt._uncompactCells,te._uncompactCellsSize=kt._uncompactCellsSize,te._vertexToLatLng=kt._vertexToLatLng,te.establishStackSpace=kt.establishStackSpace;var Ae=te.stackAlloc=kt.stackAlloc,pe=te.stackRestore=kt.stackRestore,Me=te.stackSave=kt.stackSave;if(te.asm=kt,te.cwrap=un,te.setValue=Xr,te.getValue=Ti,Rt){ii(Rt)||(Rt=Ye(Rt));{He();var Le=function(xe){xe.byteLength&&(xe=new Uint8Array(xe)),mn.set(xe,Gt),te.memoryInitializerRequest&&delete te.memoryInitializerRequest.response,Be()},Ne=function(){Tt(Rt,Le,function(){throw"could not load memory initializer "+Rt})},$e=zn(Rt);if($e)Le($e.buffer);else if(te.memoryInitializerRequest){var Qe=function(){var xe=te.memoryInitializerRequest,Ie=xe.response;if(xe.status!==200&&xe.status!==0){var ut=zn(te.memoryInitializerRequestURL);if(ut)Ie=ut.buffer;else{console.warn("a problem seems to have happened with Module.memoryInitializerRequest, status: "+xe.status+", retrying "+Rt),Ne();return}}Le(Ie)};te.memoryInitializerRequest.response?setTimeout(Qe,0):te.memoryInitializerRequest.addEventListener("load",Qe)}else Ne()}}var Ge;Ue=function xe(){Ge||We(),Ge||(Ue=xe)};function We(xe){if(Zt>0||(Pt(),Zt>0))return;function Ie(){Ge||(Ge=!0,!cn&&(nr(),_n(),te.onRuntimeInitialized&&te.onRuntimeInitialized(),cs()))}te.setStatus?(te.setStatus("Running..."),setTimeout(function(){setTimeout(function(){te.setStatus("")},1),Ie()},1)):Ie()}te.run=We;function Et(xe){throw te.onAbort&&te.onAbort(xe),xe+="",P(xe),yt(xe),cn=!0,"abort("+xe+"). Build with -s ASSERTIONS=1 for more info."}if(te.abort=Et,te.preInit)for(typeof te.preInit=="function"&&(te.preInit=[te.preInit]);te.preInit.length>0;)te.preInit.pop()();return We(),ye}(typeof F_=="object"?F_:{}),wn="number",Jr=wn,op=wn,nn=wn,sn=wn,Yl=wn,yr=wn,JI=[["sizeOfH3Index",wn],["sizeOfLatLng",wn],["sizeOfCellBoundary",wn],["sizeOfGeoLoop",wn],["sizeOfGeoPolygon",wn],["sizeOfLinkedGeoPolygon",wn],["sizeOfCoordIJ",wn],["readInt64AsDoubleFromPointer",wn],["isValidCell",op,[nn,sn]],["latLngToCell",Jr,[wn,wn,Yl,yr]],["cellToLatLng",Jr,[nn,sn,yr]],["cellToBoundary",Jr,[nn,sn,yr]],["maxGridDiskSize",Jr,[wn,yr]],["gridDisk",Jr,[nn,sn,wn,yr]],["gridDiskDistances",Jr,[nn,sn,wn,yr,yr]],["gridRingUnsafe",Jr,[nn,sn,wn,yr]],["maxPolygonToCellsSize",Jr,[yr,Yl,wn,yr]],["polygonToCells",Jr,[yr,Yl,wn,yr]],["cellsToLinkedMultiPolygon",Jr,[yr,wn,yr]],["destroyLinkedMultiPolygon",null,[yr]],["compactCells",Jr,[yr,yr,wn,wn]],["uncompactCells",Jr,[yr,wn,wn,yr,wn,Yl]],["uncompactCellsSize",Jr,[yr,wn,wn,Yl,yr]],["isPentagon",op,[nn,sn]],["isResClassIII",op,[nn,sn]],["getBaseCellNumber",wn,[nn,sn]],["getResolution",wn,[nn,sn]],["maxFaceCount",Jr,[nn,sn,yr]],["getIcosahedronFaces",Jr,[nn,sn,yr]],["cellToParent",Jr,[nn,sn,Yl,yr]],["cellToChildren",Jr,[nn,sn,Yl,yr]],["cellToCenterChild",Jr,[nn,sn,Yl,yr]],["cellToChildrenSize",Jr,[nn,sn,Yl,yr]],["cellToChildPos",Jr,[nn,sn,Yl,yr]],["childPosToCell",Jr,[wn,wn,nn,sn,Yl,yr]],["areNeighborCells",Jr,[nn,sn,nn,sn,yr]],["cellsToDirectedEdge",Jr,[nn,sn,nn,sn,yr]],["getDirectedEdgeOrigin",Jr,[nn,sn,yr]],["getDirectedEdgeDestination",Jr,[nn,sn,yr]],["isValidDirectedEdge",op,[nn,sn]],["directedEdgeToCells",Jr,[nn,sn,yr]],["originToDirectedEdges",Jr,[nn,sn,yr]],["directedEdgeToBoundary",Jr,[nn,sn,yr]],["gridDistance",Jr,[nn,sn,nn,sn,yr]],["gridPathCells",Jr,[nn,sn,nn,sn,yr]],["gridPathCellsSize",Jr,[nn,sn,nn,sn,yr]],["cellToLocalIj",Jr,[nn,sn,nn,sn,wn,yr]],["localIjToCell",Jr,[nn,sn,yr,wn,yr]],["getHexagonAreaAvgM2",Jr,[Yl,yr]],["getHexagonAreaAvgKm2",Jr,[Yl,yr]],["getHexagonEdgeLengthAvgM",Jr,[Yl,yr]],["getHexagonEdgeLengthAvgKm",Jr,[Yl,yr]],["greatCircleDistanceM",wn,[yr,yr]],["greatCircleDistanceKm",wn,[yr,yr]],["greatCircleDistanceRads",wn,[yr,yr]],["cellAreaM2",Jr,[nn,sn,yr]],["cellAreaKm2",Jr,[nn,sn,yr]],["cellAreaRads2",Jr,[nn,sn,yr]],["edgeLengthM",Jr,[nn,sn,yr]],["edgeLengthKm",Jr,[nn,sn,yr]],["edgeLengthRads",Jr,[nn,sn,yr]],["getNumCells",Jr,[Yl,yr]],["getRes0Cells",Jr,[yr]],["res0CellCount",wn],["getPentagons",Jr,[wn,yr]],["pentagonCount",wn],["cellToVertex",Jr,[nn,sn,wn,yr]],["cellToVertexes",Jr,[nn,sn,yr]],["vertexToLatLng",Jr,[nn,sn,yr]],["isValidVertex",op,[nn,sn]]],Ih={};JI.forEach(function(te){Ih[te[0]]=F_.cwrap.apply(F_,te)});Ih.sizeOfH3Index();Ih.sizeOfLatLng();Ih.sizeOfCellBoundary();Ih.sizeOfGeoPolygon();Ih.sizeOfGeoLoop();Ih.sizeOfLinkedGeoPolygon();Ih.sizeOfCoordIJ();var O_=function(ye){ye=ye||{};var te=typeof ye<"u"?ye:{},Re={},Te;for(Te in te)te.hasOwnProperty(Te)&&(Re[Te]=te[Te]);var Ke="";function Ye(xe){return te.locateFile?te.locateFile(xe,Ke):Ke+xe}var Tt;document.currentScript&&(Ke=document.currentScript.src),Ke.indexOf("blob:")!==0?Ke=Ke.substr(0,Ke.lastIndexOf("/")+1):Ke="",Tt=function(Ie,ut,zt){var o=new XMLHttpRequest;o.open("GET",Ie,!0),o.responseType="arraybuffer",o.onload=function(){if(o.status==200||o.status==0&&o.response){ut(o.response);return}var $t=zn(Ie);if($t){ut($t.buffer);return}zt()},o.onerror=zt,o.send(null)};var P=te.print||console.log.bind(console),yt=te.printErr||console.warn.bind(console);for(Te in Re)Re.hasOwnProperty(Te)&&(te[Te]=Re[Te]);Re=null,te.arguments&&te.arguments;var Ee=0,li=function(xe){Ee=xe},Ot=function(){return Ee},Gt=8;function Xr(xe,Ie,ut,zt){switch(ut=ut||"i8",ut.charAt(ut.length-1)==="*"&&(ut="i32"),ut){case"i1":fn[xe>>0]=Ie;break;case"i8":fn[xe>>0]=Ie;break;case"i16":wi[xe>>1]=Ie;break;case"i32":hr[xe>>2]=Ie;break;case"i64":Ht=[Ie>>>0,(ti=Ie,+Di(ti)>=1?ti>0?(Cs(+$s(ti/4294967296),4294967295)|0)>>>0:~~+Ir((ti-+(~~ti>>>0))/4294967296)>>>0:0)],hr[xe>>2]=Ht[0],hr[xe+4>>2]=Ht[1];break;case"float":kn[xe>>2]=Ie;break;case"double":Dn[xe>>3]=Ie;break;default:Et("invalid type for setValue: "+ut)}}function Ti(xe,Ie,ut){switch(Ie=Ie||"i8",Ie.charAt(Ie.length-1)==="*"&&(Ie="i32"),Ie){case"i1":return fn[xe>>0];case"i8":return fn[xe>>0];case"i16":return wi[xe>>1];case"i32":return hr[xe>>2];case"i64":return hr[xe>>2];case"float":return kn[xe>>2];case"double":return Dn[xe>>3];default:Et("invalid type for getValue: "+Ie)}return null}var cn=!1;function qr(xe,Ie){xe||Et("Assertion failed: "+Ie)}function dr(xe){var Ie=te["_"+xe];return qr(Ie,"Cannot call unknown function "+xe+", make sure it is exported"),Ie}function Tn(xe,Ie,ut,zt,o){var oe={string:function(Pi){var hn=0;if(Pi!=null&&Pi!==0){var eo=(Pi.length<<2)+1;hn=Ae(eo),pn(Pi,hn,eo)}return hn},array:function(Pi){var hn=Ae(Pi.length);return As(Pi,hn),hn}};function $t(Pi){return Ie==="string"?En(Pi):Ie==="boolean"?!!Pi:Pi}var _i=dr(xe),mi=[],si=0;if(zt)for(var hi=0;hi<zt.length;hi++){var gr=oe[ut[hi]];gr?(si===0&&(si=Me()),mi[hi]=gr(zt[hi])):mi[hi]=zt[hi]}var yi=_i.apply(null,mi);return yi=$t(yi),si!==0&&pe(si),yi}function un(xe,Ie,ut,zt){ut=ut||[];var o=ut.every(function($t){return $t==="number"}),oe=Ie!=="string";return oe&&o&&!zt?dr(xe):function(){return Tn(xe,Ie,ut,arguments)}}var _r=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function ps(xe,Ie,ut){for(var zt=Ie+ut,o=Ie;xe[o]&&!(o>=zt);)++o;if(o-Ie>16&&xe.subarray&&_r)return _r.decode(xe.subarray(Ie,o));for(var oe="";Ie<o;){var $t=xe[Ie++];if(!($t&128)){oe+=String.fromCharCode($t);continue}var _i=xe[Ie++]&63;if(($t&224)==192){oe+=String.fromCharCode(($t&31)<<6|_i);continue}var mi=xe[Ie++]&63;if(($t&240)==224?$t=($t&15)<<12|_i<<6|mi:$t=($t&7)<<18|_i<<12|mi<<6|xe[Ie++]&63,$t<65536)oe+=String.fromCharCode($t);else{var si=$t-65536;oe+=String.fromCharCode(55296|si>>10,56320|si&1023)}}return oe}function En(xe,Ie){return xe?ps(mn,xe,Ie):""}function Ls(xe,Ie,ut,zt){if(!(zt>0))return 0;for(var o=ut,oe=ut+zt-1,$t=0;$t<xe.length;++$t){var _i=xe.charCodeAt($t);if(_i>=55296&&_i<=57343){var mi=xe.charCodeAt(++$t);_i=65536+((_i&1023)<<10)|mi&1023}if(_i<=127){if(ut>=oe)break;Ie[ut++]=_i}else if(_i<=2047){if(ut+1>=oe)break;Ie[ut++]=192|_i>>6,Ie[ut++]=128|_i&63}else if(_i<=65535){if(ut+2>=oe)break;Ie[ut++]=224|_i>>12,Ie[ut++]=128|_i>>6&63,Ie[ut++]=128|_i&63}else{if(ut+3>=oe)break;Ie[ut++]=240|_i>>18,Ie[ut++]=128|_i>>12&63,Ie[ut++]=128|_i>>6&63,Ie[ut++]=128|_i&63}}return Ie[ut]=0,ut-o}function pn(xe,Ie,ut){return Ls(xe,mn,Ie,ut)}typeof TextDecoder<"u"&&new TextDecoder("utf-16le");function As(xe,Ie){fn.set(xe,Ie)}function ct(xe,Ie){return xe%Ie>0&&(xe+=Ie-xe%Ie),xe}var Lt,fn,mn,wi,hr,kn,Dn;function Rs(xe){Lt=xe,te.HEAP8=fn=new Int8Array(xe),te.HEAP16=wi=new Int16Array(xe),te.HEAP32=hr=new Int32Array(xe),te.HEAPU8=mn=new Uint8Array(xe),te.HEAPU16=new Uint16Array(xe),te.HEAPU32=new Uint32Array(xe),te.HEAPF32=kn=new Float32Array(xe),te.HEAPF64=Dn=new Float64Array(xe)}var Ao=5266928,yo=24016,ts=te.TOTAL_MEMORY||33554432;te.buffer?Lt=te.buffer:Lt=new ArrayBuffer(ts),ts=Lt.byteLength,Rs(Lt),hr[yo>>2]=Ao;function Ai(xe){for(;xe.length>0;){var Ie=xe.shift();if(typeof Ie=="function"){Ie();continue}var ut=Ie.func;typeof ut=="number"?Ie.arg===void 0?te.dynCall_v(ut):te.dynCall_vi(ut,Ie.arg):ut(Ie.arg===void 0?null:Ie.arg)}}var jr=[],Pn=[],Js=[],Zn=[];function Pt(){if(te.preRun)for(typeof te.preRun=="function"&&(te.preRun=[te.preRun]);te.preRun.length;)aa(te.preRun.shift());Ai(jr)}function nr(){Ai(Pn)}function _n(){Ai(Js)}function cs(){if(te.postRun)for(typeof te.postRun=="function"&&(te.postRun=[te.postRun]);te.postRun.length;)Yo(te.postRun.shift());Ai(Zn)}function aa(xe){jr.unshift(xe)}function Yo(xe){Zn.unshift(xe)}var Di=Math.abs,Ir=Math.ceil,$s=Math.floor,Cs=Math.min,Zt=0,Ue=null;function He(xe){Zt++,te.monitorRunDependencies&&te.monitorRunDependencies(Zt)}function Be(xe){if(Zt--,te.monitorRunDependencies&&te.monitorRunDependencies(Zt),Zt==0&&Ue){var Ie=Ue;Ue=null,Ie()}}te.preloadedImages={},te.preloadedAudios={};var Rt=null,Qt="data:application/octet-stream;base64,";function ii(xe){return String.prototype.startsWith?xe.startsWith(Qt):xe.indexOf(Qt)===0}var ti,Ht;Rt="data:application/octet-stream;base64,AAAAAAAAAAACAAAAAwAAAAEAAAAFAAAABAAAAAYAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAABAAAABAAAAAMAAAAGAAAABQAAAAIAAAAAAAAAAgAAAAMAAAABAAAABAAAAAYAAAAAAAAABQAAAAMAAAAGAAAABAAAAAUAAAAAAAAAAQAAAAIAAAAEAAAABQAAAAYAAAAAAAAAAgAAAAMAAAABAAAABQAAAAIAAAAAAAAAAQAAAAMAAAAGAAAABAAAAAYAAAAAAAAABQAAAAIAAAABAAAABAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAgAAAAMAAAAAAAAAAAAAAAIAAAAAAAAAAQAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAEAAAABgAAAAAAAAAFAAAAAAAAAAAAAAAEAAAABQAAAAAAAAAAAAAAAAAAAAIAAAAAAAAABgAAAAAAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAACAAAAAwAAAAQAAAAFAAAABgAAAAEAAAACAAAAAwAAAAQAAAAFAAAABgAAAAAAAAACAAAAAwAAAAQAAAAFAAAABgAAAAAAAAABAAAAAwAAAAQAAAAFAAAABgAAAAAAAAABAAAAAgAAAAQAAAAFAAAABgAAAAAAAAABAAAAAgAAAAMAAAAFAAAABgAAAAAAAAABAAAAAgAAAAMAAAAEAAAABgAAAAAAAAABAAAAAgAAAAMAAAAEAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAADAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAACAAAAAgAAAAAAAAAAAAAABgAAAAAAAAADAAAAAgAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAUAAAAEAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAAAAAAABgAAAAAAAAAEAAAAAAAAAAYAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAUAAAACAAAABAAAAAMAAAAIAAAAAQAAAAcAAAAGAAAACQAAAAAAAAADAAAAAgAAAAIAAAAGAAAACgAAAAsAAAAAAAAAAQAAAAUAAAADAAAADQAAAAEAAAAHAAAABAAAAAwAAAAAAAAABAAAAH8AAAAPAAAACAAAAAMAAAAAAAAADAAAAAUAAAACAAAAEgAAAAoAAAAIAAAAAAAAABAAAAAGAAAADgAAAAsAAAARAAAAAQAAAAkAAAACAAAABwAAABUAAAAJAAAAEwAAAAMAAAANAAAAAQAAAAgAAAAFAAAAFgAAABAAAAAEAAAAAAAAAA8AAAAJAAAAEwAAAA4AAAAUAAAAAQAAAAcAAAAGAAAACgAAAAsAAAAYAAAAFwAAAAUAAAACAAAAEgAAAAsAAAARAAAAFwAAABkAAAACAAAABgAAAAoAAAAMAAAAHAAAAA0AAAAaAAAABAAAAA8AAAADAAAADQAAABoAAAAVAAAAHQAAAAMAAAAMAAAABwAAAA4AAAB/AAAAEQAAABsAAAAJAAAAFAAAAAYAAAAPAAAAFgAAABwAAAAfAAAABAAAAAgAAAAMAAAAEAAAABIAAAAhAAAAHgAAAAgAAAAFAAAAFgAAABEAAAALAAAADgAAAAYAAAAjAAAAGQAAABsAAAASAAAAGAAAAB4AAAAgAAAABQAAAAoAAAAQAAAAEwAAACIAAAAUAAAAJAAAAAcAAAAVAAAACQAAABQAAAAOAAAAEwAAAAkAAAAoAAAAGwAAACQAAAAVAAAAJgAAABMAAAAiAAAADQAAAB0AAAAHAAAAFgAAABAAAAApAAAAIQAAAA8AAAAIAAAAHwAAABcAAAAYAAAACwAAAAoAAAAnAAAAJQAAABkAAAAYAAAAfwAAACAAAAAlAAAACgAAABcAAAASAAAAGQAAABcAAAARAAAACwAAAC0AAAAnAAAAIwAAABoAAAAqAAAAHQAAACsAAAAMAAAAHAAAAA0AAAAbAAAAKAAAACMAAAAuAAAADgAAABQAAAARAAAAHAAAAB8AAAAqAAAALAAAAAwAAAAPAAAAGgAAAB0AAAArAAAAJgAAAC8AAAANAAAAGgAAABUAAAAeAAAAIAAAADAAAAAyAAAAEAAAABIAAAAhAAAAHwAAACkAAAAsAAAANQAAAA8AAAAWAAAAHAAAACAAAAAeAAAAGAAAABIAAAA0AAAAMgAAACUAAAAhAAAAHgAAADEAAAAwAAAAFgAAABAAAAApAAAAIgAAABMAAAAmAAAAFQAAADYAAAAkAAAAMwAAACMAAAAuAAAALQAAADgAAAARAAAAGwAAABkAAAAkAAAAFAAAACIAAAATAAAANwAAACgAAAA2AAAAJQAAACcAAAA0AAAAOQAAABgAAAAXAAAAIAAAACYAAAB/AAAAIgAAADMAAAAdAAAALwAAABUAAAAnAAAAJQAAABkAAAAXAAAAOwAAADkAAAAtAAAAKAAAABsAAAAkAAAAFAAAADwAAAAuAAAANwAAACkAAAAxAAAANQAAAD0AAAAWAAAAIQAAAB8AAAAqAAAAOgAAACsAAAA+AAAAHAAAACwAAAAaAAAAKwAAAD4AAAAvAAAAQAAAABoAAAAqAAAAHQAAACwAAAA1AAAAOgAAAEEAAAAcAAAAHwAAACoAAAAtAAAAJwAAACMAAAAZAAAAPwAAADsAAAA4AAAALgAAADwAAAA4AAAARAAAABsAAAAoAAAAIwAAAC8AAAAmAAAAKwAAAB0AAABFAAAAMwAAAEAAAAAwAAAAMQAAAB4AAAAhAAAAQwAAAEIAAAAyAAAAMQAAAH8AAAA9AAAAQgAAACEAAAAwAAAAKQAAADIAAAAwAAAAIAAAAB4AAABGAAAAQwAAADQAAAAzAAAARQAAADYAAABHAAAAJgAAAC8AAAAiAAAANAAAADkAAABGAAAASgAAACAAAAAlAAAAMgAAADUAAAA9AAAAQQAAAEsAAAAfAAAAKQAAACwAAAA2AAAARwAAADcAAABJAAAAIgAAADMAAAAkAAAANwAAACgAAAA2AAAAJAAAAEgAAAA8AAAASQAAADgAAABEAAAAPwAAAE0AAAAjAAAALgAAAC0AAAA5AAAAOwAAAEoAAABOAAAAJQAAACcAAAA0AAAAOgAAAH8AAAA+AAAATAAAACwAAABBAAAAKgAAADsAAAA/AAAATgAAAE8AAAAnAAAALQAAADkAAAA8AAAASAAAAEQAAABQAAAAKAAAADcAAAAuAAAAPQAAADUAAAAxAAAAKQAAAFEAAABLAAAAQgAAAD4AAAArAAAAOgAAACoAAABSAAAAQAAAAEwAAAA/AAAAfwAAADgAAAAtAAAATwAAADsAAABNAAAAQAAAAC8AAAA+AAAAKwAAAFQAAABFAAAAUgAAAEEAAAA6AAAANQAAACwAAABWAAAATAAAAEsAAABCAAAAQwAAAFEAAABVAAAAMQAAADAAAAA9AAAAQwAAAEIAAAAyAAAAMAAAAFcAAABVAAAARgAAAEQAAAA4AAAAPAAAAC4AAABaAAAATQAAAFAAAABFAAAAMwAAAEAAAAAvAAAAWQAAAEcAAABUAAAARgAAAEMAAAA0AAAAMgAAAFMAAABXAAAASgAAAEcAAABZAAAASQAAAFsAAAAzAAAARQAAADYAAABIAAAAfwAAAEkAAAA3AAAAUAAAADwAAABYAAAASQAAAFsAAABIAAAAWAAAADYAAABHAAAANwAAAEoAAABOAAAAUwAAAFwAAAA0AAAAOQAAAEYAAABLAAAAQQAAAD0AAAA1AAAAXgAAAFYAAABRAAAATAAAAFYAAABSAAAAYAAAADoAAABBAAAAPgAAAE0AAAA/AAAARAAAADgAAABdAAAATwAAAFoAAABOAAAASgAAADsAAAA5AAAAXwAAAFwAAABPAAAATwAAAE4AAAA/AAAAOwAAAF0AAABfAAAATQAAAFAAAABEAAAASAAAADwAAABjAAAAWgAAAFgAAABRAAAAVQAAAF4AAABlAAAAPQAAAEIAAABLAAAAUgAAAGAAAABUAAAAYgAAAD4AAABMAAAAQAAAAFMAAAB/AAAASgAAAEYAAABkAAAAVwAAAFwAAABUAAAARQAAAFIAAABAAAAAYQAAAFkAAABiAAAAVQAAAFcAAABlAAAAZgAAAEIAAABDAAAAUQAAAFYAAABMAAAASwAAAEEAAABoAAAAYAAAAF4AAABXAAAAUwAAAGYAAABkAAAAQwAAAEYAAABVAAAAWAAAAEgAAABbAAAASQAAAGMAAABQAAAAaQAAAFkAAABhAAAAWwAAAGcAAABFAAAAVAAAAEcAAABaAAAATQAAAFAAAABEAAAAagAAAF0AAABjAAAAWwAAAEkAAABZAAAARwAAAGkAAABYAAAAZwAAAFwAAABTAAAATgAAAEoAAABsAAAAZAAAAF8AAABdAAAATwAAAFoAAABNAAAAbQAAAF8AAABqAAAAXgAAAFYAAABRAAAASwAAAGsAAABoAAAAZQAAAF8AAABcAAAATwAAAE4AAABtAAAAbAAAAF0AAABgAAAAaAAAAGIAAABuAAAATAAAAFYAAABSAAAAYQAAAH8AAABiAAAAVAAAAGcAAABZAAAAbwAAAGIAAABuAAAAYQAAAG8AAABSAAAAYAAAAFQAAABjAAAAUAAAAGkAAABYAAAAagAAAFoAAABxAAAAZAAAAGYAAABTAAAAVwAAAGwAAAByAAAAXAAAAGUAAABmAAAAawAAAHAAAABRAAAAVQAAAF4AAABmAAAAZQAAAFcAAABVAAAAcgAAAHAAAABkAAAAZwAAAFsAAABhAAAAWQAAAHQAAABpAAAAbwAAAGgAAABrAAAAbgAAAHMAAABWAAAAXgAAAGAAAABpAAAAWAAAAGcAAABbAAAAcQAAAGMAAAB0AAAAagAAAF0AAABjAAAAWgAAAHUAAABtAAAAcQAAAGsAAAB/AAAAZQAAAF4AAABzAAAAaAAAAHAAAABsAAAAZAAAAF8AAABcAAAAdgAAAHIAAABtAAAAbQAAAGwAAABdAAAAXwAAAHUAAAB2AAAAagAAAG4AAABiAAAAaAAAAGAAAAB3AAAAbwAAAHMAAABvAAAAYQAAAG4AAABiAAAAdAAAAGcAAAB3AAAAcAAAAGsAAABmAAAAZQAAAHgAAABzAAAAcgAAAHEAAABjAAAAdAAAAGkAAAB1AAAAagAAAHkAAAByAAAAcAAAAGQAAABmAAAAdgAAAHgAAABsAAAAcwAAAG4AAABrAAAAaAAAAHgAAAB3AAAAcAAAAHQAAABnAAAAdwAAAG8AAABxAAAAaQAAAHkAAAB1AAAAfwAAAG0AAAB2AAAAcQAAAHkAAABqAAAAdgAAAHgAAABsAAAAcgAAAHUAAAB5AAAAbQAAAHcAAABvAAAAcwAAAG4AAAB5AAAAdAAAAHgAAAB4AAAAcwAAAHIAAABwAAAAeQAAAHcAAAB2AAAAeQAAAHQAAAB4AAAAdwAAAHUAAABxAAAAdgAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAEAAAAFAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAIAAAAFAAAAAQAAAAAAAAD/////AQAAAAAAAAADAAAABAAAAAIAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAUAAAABAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAAFAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAEAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAQAAAAFAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAMAAAAAAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAAAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAADAAAAAwAAAAMAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAABQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAAAAAAAAAAABAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAMAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAQAAAAMAAAABAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAMAAAABAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAADAAAABQAAAAEAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAEAAAABQAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAgAAAAUAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAAMAAAABAAAAAAAAAAEAAAAAAAAABQAAAAAAAAAAAAAABQAAAAUAAAAAAAAAAAAAAP////8BAAAAAAAAAAMAAAAEAAAAAgAAAAAAAAAAAAAAAQAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAABQAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAQAAAP//////////AQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAIAAAAAAAAAAAAAAAEAAAACAAAABgAAAAQAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAABwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABgAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAoAAAACAAAAAAAAAAAAAAABAAAAAQAAAAUAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAIAAAAAAAAAAAAAAAEAAAADAAAABwAAAAYAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAHAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAABAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAgAAAAAAAAAAAAAAAQAAAAAAAAAJAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAwAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAgAAAAAAAAAAAAAAAQAAAAQAAAAIAAAACgAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAsAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAJAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAACAAAAAAAAAAAAAAABAAAACwAAAA8AAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAA4AAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAgAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAFAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcAAAACAAAAAAAAAAAAAAABAAAADAAAABAAAAAMAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAPAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAEAAAAKAAAAEwAAAAgAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAADwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAJAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA0AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAgAAAAAAAAAAAAAAAQAAAA0AAAARAAAADQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABEAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABMAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQAAAAIAAAAAAAAAAAAAAAEAAAAOAAAAEgAAAA8AAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAPAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABMAAAACAAAAAAAAAAAAAAABAAAA//////////8TAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABMAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAASAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABIAAAAAAAAAGAAAAAAAAAAhAAAAAAAAAB4AAAAAAAAAIAAAAAMAAAAxAAAAAQAAADAAAAADAAAAMgAAAAMAAAAIAAAAAAAAAAUAAAAFAAAACgAAAAUAAAAWAAAAAAAAABAAAAAAAAAAEgAAAAAAAAApAAAAAQAAACEAAAAAAAAAHgAAAAAAAAAEAAAAAAAAAAAAAAAFAAAAAgAAAAUAAAAPAAAAAQAAAAgAAAAAAAAABQAAAAUAAAAfAAAAAQAAABYAAAAAAAAAEAAAAAAAAAACAAAAAAAAAAYAAAAAAAAADgAAAAAAAAAKAAAAAAAAAAsAAAAAAAAAEQAAAAMAAAAYAAAAAQAAABcAAAADAAAAGQAAAAMAAAAAAAAAAAAAAAEAAAAFAAAACQAAAAUAAAAFAAAAAAAAAAIAAAAAAAAABgAAAAAAAAASAAAAAQAAAAoAAAAAAAAACwAAAAAAAAAEAAAAAQAAAAMAAAAFAAAABwAAAAUAAAAIAAAAAQAAAAAAAAAAAAAAAQAAAAUAAAAQAAAAAQAAAAUAAAAAAAAAAgAAAAAAAAAHAAAAAAAAABUAAAAAAAAAJgAAAAAAAAAJAAAAAAAAABMAAAAAAAAAIgAAAAMAAAAOAAAAAQAAABQAAAADAAAAJAAAAAMAAAADAAAAAAAAAA0AAAAFAAAAHQAAAAUAAAABAAAAAAAAAAcAAAAAAAAAFQAAAAAAAAAGAAAAAQAAAAkAAAAAAAAAEwAAAAAAAAAEAAAAAgAAAAwAAAAFAAAAGgAAAAUAAAAAAAAAAQAAAAMAAAAAAAAADQAAAAUAAAACAAAAAQAAAAEAAAAAAAAABwAAAAAAAAAaAAAAAAAAACoAAAAAAAAAOgAAAAAAAAAdAAAAAAAAACsAAAAAAAAAPgAAAAMAAAAmAAAAAQAAAC8AAAADAAAAQAAAAAMAAAAMAAAAAAAAABwAAAAFAAAALAAAAAUAAAANAAAAAAAAABoAAAAAAAAAKgAAAAAAAAAVAAAAAQAAAB0AAAAAAAAAKwAAAAAAAAAEAAAAAwAAAA8AAAAFAAAAHwAAAAUAAAADAAAAAQAAAAwAAAAAAAAAHAAAAAUAAAAHAAAAAQAAAA0AAAAAAAAAGgAAAAAAAAAfAAAAAAAAACkAAAAAAAAAMQAAAAAAAAAsAAAAAAAAADUAAAAAAAAAPQAAAAMAAAA6AAAAAQAAAEEAAAADAAAASwAAAAMAAAAPAAAAAAAAABYAAAAFAAAAIQAAAAUAAAAcAAAAAAAAAB8AAAAAAAAAKQAAAAAAAAAqAAAAAQAAACwAAAAAAAAANQAAAAAAAAAEAAAABAAAAAgAAAAFAAAAEAAAAAUAAAAMAAAAAQAAAA8AAAAAAAAAFgAAAAUAAAAaAAAAAQAAABwAAAAAAAAAHwAAAAAAAAAyAAAAAAAAADAAAAAAAAAAMQAAAAMAAAAgAAAAAAAAAB4AAAADAAAAIQAAAAMAAAAYAAAAAwAAABIAAAADAAAAEAAAAAMAAABGAAAAAAAAAEMAAAAAAAAAQgAAAAMAAAA0AAAAAwAAADIAAAAAAAAAMAAAAAAAAAAlAAAAAwAAACAAAAAAAAAAHgAAAAMAAABTAAAAAAAAAFcAAAADAAAAVQAAAAMAAABKAAAAAwAAAEYAAAAAAAAAQwAAAAAAAAA5AAAAAQAAADQAAAADAAAAMgAAAAAAAAAZAAAAAAAAABcAAAAAAAAAGAAAAAMAAAARAAAAAAAAAAsAAAADAAAACgAAAAMAAAAOAAAAAwAAAAYAAAADAAAAAgAAAAMAAAAtAAAAAAAAACcAAAAAAAAAJQAAAAMAAAAjAAAAAwAAABkAAAAAAAAAFwAAAAAAAAAbAAAAAwAAABEAAAAAAAAACwAAAAMAAAA/AAAAAAAAADsAAAADAAAAOQAAAAMAAAA4AAAAAwAAAC0AAAAAAAAAJwAAAAAAAAAuAAAAAwAAACMAAAADAAAAGQAAAAAAAAAkAAAAAAAAABQAAAAAAAAADgAAAAMAAAAiAAAAAAAAABMAAAADAAAACQAAAAMAAAAmAAAAAwAAABUAAAADAAAABwAAAAMAAAA3AAAAAAAAACgAAAAAAAAAGwAAAAMAAAA2AAAAAwAAACQAAAAAAAAAFAAAAAAAAAAzAAAAAwAAACIAAAAAAAAAEwAAAAMAAABIAAAAAAAAADwAAAADAAAALgAAAAMAAABJAAAAAwAAADcAAAAAAAAAKAAAAAAAAABHAAAAAwAAADYAAAADAAAAJAAAAAAAAABAAAAAAAAAAC8AAAAAAAAAJgAAAAMAAAA+AAAAAAAAACsAAAADAAAAHQAAAAMAAAA6AAAAAwAAACoAAAADAAAAGgAAAAMAAABUAAAAAAAAAEUAAAAAAAAAMwAAAAMAAABSAAAAAwAAAEAAAAAAAAAALwAAAAAAAABMAAAAAwAAAD4AAAAAAAAAKwAAAAMAAABhAAAAAAAAAFkAAAADAAAARwAAAAMAAABiAAAAAwAAAFQAAAAAAAAARQAAAAAAAABgAAAAAwAAAFIAAAADAAAAQAAAAAAAAABLAAAAAAAAAEEAAAAAAAAAOgAAAAMAAAA9AAAAAAAAADUAAAADAAAALAAAAAMAAAAxAAAAAwAAACkAAAADAAAAHwAAAAMAAABeAAAAAAAAAFYAAAAAAAAATAAAAAMAAABRAAAAAwAAAEsAAAAAAAAAQQAAAAAAAABCAAAAAwAAAD0AAAAAAAAANQAAAAMAAABrAAAAAAAAAGgAAAADAAAAYAAAAAMAAABlAAAAAwAAAF4AAAAAAAAAVgAAAAAAAABVAAAAAwAAAFEAAAADAAAASwAAAAAAAAA5AAAAAAAAADsAAAAAAAAAPwAAAAMAAABKAAAAAAAAAE4AAAADAAAATwAAAAMAAABTAAAAAwAAAFwAAAADAAAAXwAAAAMAAAAlAAAAAAAAACcAAAADAAAALQAAAAMAAAA0AAAAAAAAADkAAAAAAAAAOwAAAAAAAABGAAAAAwAAAEoAAAAAAAAATgAAAAMAAAAYAAAAAAAAABcAAAADAAAAGQAAAAMAAAAgAAAAAwAAACUAAAAAAAAAJwAAAAMAAAAyAAAAAwAAADQAAAAAAAAAOQAAAAAAAAAuAAAAAAAAADwAAAAAAAAASAAAAAMAAAA4AAAAAAAAAEQAAAADAAAAUAAAAAMAAAA/AAAAAwAAAE0AAAADAAAAWgAAAAMAAAAbAAAAAAAAACgAAAADAAAANwAAAAMAAAAjAAAAAAAAAC4AAAAAAAAAPAAAAAAAAAAtAAAAAwAAADgAAAAAAAAARAAAAAMAAAAOAAAAAAAAABQAAAADAAAAJAAAAAMAAAARAAAAAwAAABsAAAAAAAAAKAAAAAMAAAAZAAAAAwAAACMAAAAAAAAALgAAAAAAAABHAAAAAAAAAFkAAAAAAAAAYQAAAAMAAABJAAAAAAAAAFsAAAADAAAAZwAAAAMAAABIAAAAAwAAAFgAAAADAAAAaQAAAAMAAAAzAAAAAAAAAEUAAAADAAAAVAAAAAMAAAA2AAAAAAAAAEcAAAAAAAAAWQAAAAAAAAA3AAAAAwAAAEkAAAAAAAAAWwAAAAMAAAAmAAAAAAAAAC8AAAADAAAAQAAAAAMAAAAiAAAAAwAAADMAAAAAAAAARQAAAAMAAAAkAAAAAwAAADYAAAAAAAAARwAAAAAAAABgAAAAAAAAAGgAAAAAAAAAawAAAAMAAABiAAAAAAAAAG4AAAADAAAAcwAAAAMAAABhAAAAAwAAAG8AAAADAAAAdwAAAAMAAABMAAAAAAAAAFYAAAADAAAAXgAAAAMAAABSAAAAAAAAAGAAAAAAAAAAaAAAAAAAAABUAAAAAwAAAGIAAAAAAAAAbgAAAAMAAAA6AAAAAAAAAEEAAAADAAAASwAAAAMAAAA+AAAAAwAAAEwAAAAAAAAAVgAAAAMAAABAAAAAAwAAAFIAAAAAAAAAYAAAAAAAAABVAAAAAAAAAFcAAAAAAAAAUwAAAAMAAABlAAAAAAAAAGYAAAADAAAAZAAAAAMAAABrAAAAAwAAAHAAAAADAAAAcgAAAAMAAABCAAAAAAAAAEMAAAADAAAARgAAAAMAAABRAAAAAAAAAFUAAAAAAAAAVwAAAAAAAABeAAAAAwAAAGUAAAAAAAAAZgAAAAMAAAAxAAAAAAAAADAAAAADAAAAMgAAAAMAAAA9AAAAAwAAAEIAAAAAAAAAQwAAAAMAAABLAAAAAwAAAFEAAAAAAAAAVQAAAAAAAABfAAAAAAAAAFwAAAAAAAAAUwAAAAAAAABPAAAAAAAAAE4AAAAAAAAASgAAAAMAAAA/AAAAAQAAADsAAAADAAAAOQAAAAMAAABtAAAAAAAAAGwAAAAAAAAAZAAAAAUAAABdAAAAAQAAAF8AAAAAAAAAXAAAAAAAAABNAAAAAQAAAE8AAAAAAAAATgAAAAAAAAB1AAAABAAAAHYAAAAFAAAAcgAAAAUAAABqAAAAAQAAAG0AAAAAAAAAbAAAAAAAAABaAAAAAQAAAF0AAAABAAAAXwAAAAAAAABaAAAAAAAAAE0AAAAAAAAAPwAAAAAAAABQAAAAAAAAAEQAAAAAAAAAOAAAAAMAAABIAAAAAQAAADwAAAADAAAALgAAAAMAAABqAAAAAAAAAF0AAAAAAAAATwAAAAUAAABjAAAAAQAAAFoAAAAAAAAATQAAAAAAAABYAAAAAQAAAFAAAAAAAAAARAAAAAAAAAB1AAAAAwAAAG0AAAAFAAAAXwAAAAUAAABxAAAAAQAAAGoAAAAAAAAAXQAAAAAAAABpAAAAAQAAAGMAAAABAAAAWgAAAAAAAABpAAAAAAAAAFgAAAAAAAAASAAAAAAAAABnAAAAAAAAAFsAAAAAAAAASQAAAAMAAABhAAAAAQAAAFkAAAADAAAARwAAAAMAAABxAAAAAAAAAGMAAAAAAAAAUAAAAAUAAAB0AAAAAQAAAGkAAAAAAAAAWAAAAAAAAABvAAAAAQAAAGcAAAAAAAAAWwAAAAAAAAB1AAAAAgAAAGoAAAAFAAAAWgAAAAUAAAB5AAAAAQAAAHEAAAAAAAAAYwAAAAAAAAB3AAAAAQAAAHQAAAABAAAAaQAAAAAAAAB3AAAAAAAAAG8AAAAAAAAAYQAAAAAAAABzAAAAAAAAAG4AAAAAAAAAYgAAAAMAAABrAAAAAQAAAGgAAAADAAAAYAAAAAMAAAB5AAAAAAAAAHQAAAAAAAAAZwAAAAUAAAB4AAAAAQAAAHcAAAAAAAAAbwAAAAAAAABwAAAAAQAAAHMAAAAAAAAAbgAAAAAAAAB1AAAAAQAAAHEAAAAFAAAAaQAAAAUAAAB2AAAAAQAAAHkAAAAAAAAAdAAAAAAAAAByAAAAAQAAAHgAAAABAAAAdwAAAAAAAAByAAAAAAAAAHAAAAAAAAAAawAAAAAAAABkAAAAAAAAAGYAAAAAAAAAZQAAAAMAAABTAAAAAQAAAFcAAAADAAAAVQAAAAMAAAB2AAAAAAAAAHgAAAAAAAAAcwAAAAUAAABsAAAAAQAAAHIAAAAAAAAAcAAAAAAAAABcAAAAAQAAAGQAAAAAAAAAZgAAAAAAAAB1AAAAAAAAAHkAAAAFAAAAdwAAAAUAAABtAAAAAQAAAHYAAAAAAAAAeAAAAAAAAABfAAAAAQAAAGwAAAABAAAAcgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAAEAAAABAAAAAAAAAAAAAAABAAAAAAAAAAEAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAB+ogX28rbpPxqumpJv+fM/165tC4ns9D+XaEnTqUsEQFrOtNlC4PA/3U+0XG6P9b9TdUUBxTTjP4PUp8ex1ty/B1rD/EN43z+lcDi6LLrZP/a45NWEHMY/oJ5ijLDZ+j/xw3rjxWPjP2B8A46ioQdAotff3wla2z+FMSpA1jj+v6b5Y1mtPbS/cIu8K0F457/2esiyJpDNv98k5Ts2NeA/pvljWa09tD88ClUJ60MDQPZ6yLImkM0/4ONKxa0UBcD2uOTVhBzGv5G7JRxGave/8cN648Vj47+HCwtkjAXIv6LX398JWtu/qyheaCAL9D9TdUUBxTTjv4gyTxslhwVAB1rD/EN4378EH/28teoFwH6iBfbytum/F6ztFYdK/r/Xrm0Liez0vwcS6wNGWeO/Ws602ULg8L9TCtRLiLT8P8pi5RexJsw/BlIKPVwR5T95Wyu0/QjnP5PjoT7YYcu/mBhKZ6zrwj8wRYS7NebuP3qW6geh+Ls/SLrixebL3r+pcyymN9XrPwmkNHp7xec/GWNMZVAA17+82s+x2BLiPwn2ytbJ9ek/LgEH1sMS1j8yp/2LhTfeP+SnWwtQBbu/d38gkp5X7z8ytsuHaADGPzUYObdf1+m/7IauECWhwz+cjSACjzniP76Z+wUhN9K/1+GEKzup67+/GYr/04baPw6idWOvsuc/ZedTWsRa5b/EJQOuRzi0v/OncYhHPes/h49PixY53j+i8wWfC03Nvw2idWOvsue/ZedTWsRa5T/EJQOuRzi0P/KncYhHPeu/iY9PixY53r+i8wWfC03NP9anWwtQBbs/d38gkp5X778ytsuHaADGvzUYObdf1+k/74auECWhw7+cjSACjzniv8CZ+wUhN9I/1uGEKzup6z+/GYr/04bavwmkNHp7xee/F2NMZVAA1z+82s+x2BLivwr2ytbJ9em/KwEH1sMS1r8yp/2LhTfev81i5RexJsy/BlIKPVwR5b95Wyu0/Qjnv5DjoT7YYcs/nBhKZ6zrwr8wRYS7Nebuv3OW6geh+Lu/SLrixebL3j+pcyymN9Xrv8rHIFfWehZAMBwUdlo0DECTUc17EOb2PxpVB1SWChdAzjbhb9pTDUDQhmdvECX5P9FlMKCC9+g/IIAzjELgE0DajDngMv8GQFhWDmDPjNs/y1guLh96EkAxPi8k7DIEQJCc4URlhRhA3eLKKLwkEECqpNAyTBD/P6xpjXcDiwVAFtl//cQm4z+Ibt3XKiYTQM7mCLUb3QdAoM1t8yVv7D8aLZv2Nk8UQEAJPV5nQwxAtSsfTCoE9z9TPjXLXIIWQBVanC5W9AtAYM3d7Adm9j++5mQz1FoWQBUThyaVBghAwH5muQsV7T89Q1qv82MUQJoWGOfNuBdAzrkClkmwDkDQjKq77t37Py+g0dtitsE/ZwAMTwVPEUBojepluNwBQGYbtuW+t9w/HNWIJs6MEkDTNuQUSlgEQKxktPP5TcQ/ixbLB8JjEUCwuWjXMQYCQAS/R09FkRdAowpiZjhhDkB7LmlczD/7P01iQmhhsAVAnrtTwDy84z/Z6jfQ2TgTQChOCXMnWwpAhrW3daoz8z/HYJvVPI4VQLT3ik5FcA5Angi7LOZd+z+NNVzDy5gXQBXdvVTFUA1AYNMgOeYe+T8+qHXGCwkXQKQTOKwa5AJA8gFVoEMW0T+FwzJyttIRQAEAAAD/////BwAAAP////8xAAAA/////1cBAAD/////YQkAAP////+nQQAA/////5HLAQD/////95AMAP/////B9lcAAAAAAAAAAAAAAAAAAgAAAP////8OAAAA/////2IAAAD/////rgIAAP/////CEgAA/////06DAAD/////IpcDAP/////uIRkA/////4LtrwAAAAAAAAAAAAAAAAAAAAAAAgAAAP//////////AQAAAAMAAAD//////////////////////////////////////////////////////////////////////////wEAAAAAAAAAAgAAAP///////////////wMAAAD//////////////////////////////////////////////////////////////////////////wEAAAAAAAAAAgAAAP///////////////wMAAAD//////////////////////////////////////////////////////////////////////////wEAAAAAAAAAAgAAAP///////////////wMAAAD//////////////////////////////////////////////////////////wIAAAD//////////wEAAAAAAAAA/////////////////////wMAAAD/////////////////////////////////////////////////////AwAAAP////////////////////8AAAAA/////////////////////wEAAAD///////////////8CAAAA////////////////////////////////AwAAAP////////////////////8AAAAA////////////////AgAAAAEAAAD/////////////////////////////////////////////////////AwAAAP////////////////////8AAAAA////////////////AgAAAAEAAAD/////////////////////////////////////////////////////AwAAAP////////////////////8AAAAA////////////////AgAAAAEAAAD/////////////////////////////////////////////////////AwAAAP////////////////////8AAAAA////////////////AgAAAAEAAAD/////////////////////////////////////////////////////AQAAAAIAAAD///////////////8AAAAA/////////////////////wMAAAD/////////////////////////////////////////////////////AQAAAAIAAAD///////////////8AAAAA/////////////////////wMAAAD/////////////////////////////////////////////////////AQAAAAIAAAD///////////////8AAAAA/////////////////////wMAAAD/////////////////////////////////////////////////////AQAAAAIAAAD///////////////8AAAAA/////////////////////wMAAAD///////////////////////////////8CAAAA////////////////AQAAAP////////////////////8AAAAA/////////////////////wMAAAD/////////////////////////////////////////////////////AwAAAP////////////////////8AAAAAAQAAAP//////////AgAAAP//////////////////////////////////////////////////////////AwAAAP///////////////wIAAAAAAAAAAQAAAP//////////////////////////////////////////////////////////////////////////AwAAAP///////////////wIAAAAAAAAAAQAAAP//////////////////////////////////////////////////////////////////////////AwAAAP///////////////wIAAAAAAAAAAQAAAP//////////////////////////////////////////////////////////////////////////AwAAAAEAAAD//////////wIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAgAAAAAAAAACAAAAAQAAAAEAAAACAAAAAgAAAAAAAAAFAAAABQAAAAAAAAACAAAAAgAAAAMAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAIAAAABAAAAAgAAAAIAAAACAAAAAAAAAAUAAAAGAAAAAAAAAAIAAAACAAAAAwAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAIAAAAAAAAAAgAAAAEAAAADAAAAAgAAAAIAAAAAAAAABQAAAAcAAAAAAAAAAgAAAAIAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAgAAAAAAAAACAAAAAQAAAAQAAAACAAAAAgAAAAAAAAAFAAAACAAAAAAAAAACAAAAAgAAAAMAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAACAAAAAAAAAAIAAAABAAAAAAAAAAIAAAACAAAAAAAAAAUAAAAJAAAAAAAAAAIAAAACAAAAAwAAAAUAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAIAAAACAAAAAAAAAAMAAAAOAAAAAgAAAAAAAAACAAAAAwAAAAAAAAAAAAAAAgAAAAIAAAADAAAABgAAAAAAAAAAAAAAAAAAAAAAAAALAAAAAgAAAAIAAAAAAAAAAwAAAAoAAAACAAAAAAAAAAIAAAADAAAAAQAAAAAAAAACAAAAAgAAAAMAAAAHAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAACAAAAAgAAAAAAAAADAAAACwAAAAIAAAAAAAAAAgAAAAMAAAACAAAAAAAAAAIAAAACAAAAAwAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAIAAAACAAAAAAAAAAMAAAAMAAAAAgAAAAAAAAACAAAAAwAAAAMAAAAAAAAAAgAAAAIAAAADAAAACQAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAgAAAAIAAAAAAAAAAwAAAA0AAAACAAAAAAAAAAIAAAADAAAABAAAAAAAAAACAAAAAgAAAAMAAAAKAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAACAAAAAgAAAAAAAAADAAAABgAAAAIAAAAAAAAAAgAAAAMAAAAPAAAAAAAAAAIAAAACAAAAAwAAAAsAAAAAAAAAAAAAAAAAAAAAAAAABgAAAAIAAAACAAAAAAAAAAMAAAAHAAAAAgAAAAAAAAACAAAAAwAAABAAAAAAAAAAAgAAAAIAAAADAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAgAAAAIAAAAAAAAAAwAAAAgAAAACAAAAAAAAAAIAAAADAAAAEQAAAAAAAAACAAAAAgAAAAMAAAANAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAACAAAAAgAAAAAAAAADAAAACQAAAAIAAAAAAAAAAgAAAAMAAAASAAAAAAAAAAIAAAACAAAAAwAAAA4AAAAAAAAAAAAAAAAAAAAAAAAACQAAAAIAAAACAAAAAAAAAAMAAAAFAAAAAgAAAAAAAAACAAAAAwAAABMAAAAAAAAAAgAAAAIAAAADAAAADwAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAgAAAAAAAAACAAAAAQAAABMAAAACAAAAAgAAAAAAAAAFAAAACgAAAAAAAAACAAAAAgAAAAMAAAAQAAAAAAAAAAAAAAAAAAAAAAAAABEAAAACAAAAAAAAAAIAAAABAAAADwAAAAIAAAACAAAAAAAAAAUAAAALAAAAAAAAAAIAAAACAAAAAwAAABEAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAIAAAAAAAAAAgAAAAEAAAAQAAAAAgAAAAIAAAAAAAAABQAAAAwAAAAAAAAAAgAAAAIAAAADAAAAEgAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAgAAAAAAAAACAAAAAQAAABEAAAACAAAAAgAAAAAAAAAFAAAADQAAAAAAAAACAAAAAgAAAAMAAAATAAAAAAAAAAAAAAAAAAAAAAAAAA8AAAACAAAAAAAAAAIAAAABAAAAEgAAAAIAAAACAAAAAAAAAAUAAAAOAAAAAAAAAAIAAAACAAAAAwAAAAIAAAABAAAAAAAAAAEAAAACAAAAAAAAAAAAAAACAAAAAQAAAAAAAAABAAAAAgAAAAEAAAAAAAAAAgAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAAAAAAAAAAABQAAAAQAAAAAAAAAAQAAAAUAAAAEAAAAAAAAAAUAAAAAAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAAAAAAAAAAAAAIAAAABAAAAAAAAAAEAAAACAAAAAQAAAAAAAAACAAAAAgAAAAAAAAABAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAAAAAAAAAAABQAAAAQAAAAAAAAAAQAAAAUAAAAEAAAAAAAAAAUAAAAFAAAAAAAAAAEAAAAAAAAAAAAAAMuhRbbsNlBBYqHW9OmHIkF9XBuqnS31QAK37uYhNMhAOSo3UUupm0DC+6pc6JxvQHV9eseEEEJAzURsCyqlFEB8BQ4NMJjnPyy3tBoS97o/xawXQznRjj89J2K2CZxhP6vX43RIIDQ/S8isgygEBz+LvFHQkmzaPjFFFO7wMq4+AADMLkTtjkIAAOgkJqxhQgAAU7B0MjRCAADwpBcVB0IAAACYP2HaQQAAAIn/Ja5BzczM4Eg6gUHNzMxMU7BTQTMzMzNfgCZBAAAAAEi3+UAAAAAAwGPNQDMzMzMzy6BAmpmZmZkxc0AzMzMzM/NFQDMzMzMzMxlAzczMzMzM7D+ygXSx2U6RQKimJOvQKnpA23hmONTHY0A/AGcxyudNQNb3K647mzZA+S56rrwWIUAm4kUQ+9UJQKre9hGzh/M/BLvoy9WG3T+LmqMf8VHGP2m3nYNV37A/gbFHcyeCmT+cBPWBckiDP61tZACjKW0/q2RbYVUYVj8uDypVyLNAP6jGS5cA5zBBwcqhBdCNGUEGEhQ/JVEDQT6WPnRbNO1AB/AWSJgT1kDfUWNCNLDAQNk+5C33OqlAchWL34QSk0DKvtDIrNV8QNF0G3kFzGVASSeWhBl6UED+/0mNGuk4QGjA/dm/1CJALPLPMql6DEDSHoDrwpP1P2jouzWST+A/egAAAAAAAABKAwAAAAAAAPoWAAAAAAAAyqAAAAAAAAB6ZQQAAAAAAErGHgAAAAAA+mvXAAAAAADK8+MFAAAAAHqqOykAAAAASqmhIAEAAAD6oGvkBwAAAMpm8T43AAAAes+ZuIIBAABKrDQMkwoAAPq1cFUFSgAAyvkUViUGAgAAAAAAAwAAAAYAAAACAAAABQAAAAEAAAAEAAAAAAAAAAAAAAAFAAAAAwAAAAEAAAAGAAAABAAAAAIAAAAAAAAAAAAAAP////8AAAAAAAAAAAAAAAAAAAAAAAAAAP////////////////////////////////////8AAAAA/////wAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAP////8AAAAAAAAAAAEAAAABAAAAAAAAAAAAAAD/////AAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAA/////wUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAP////8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/////////////////////////////////////AAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/////////////////////////////////////wAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAUAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP////////////////////////////////////8AAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAABAAAAAAAAAAAAAAABAAAAAQAAAAEAAAAAAAAAAQAAAAAAAAAFAAAAAQAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAEAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEBAAAAAAABAAEAAAEBAAAAAAABAAAAAQAAAAEAAQAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAACAAAAAQAAAAMAAAAOAAAABgAAAAsAAAACAAAABwAAAAEAAAAYAAAABQAAAAoAAAABAAAABgAAAAAAAAAmAAAABwAAAAwAAAADAAAACAAAAAIAAAAxAAAACQAAAA4AAAAAAAAABQAAAAQAAAA6AAAACAAAAA0AAAAEAAAACQAAAAMAAAA/AAAACwAAAAYAAAAPAAAACgAAABAAAABIAAAADAAAAAcAAAAQAAAACwAAABEAAABTAAAACgAAAAUAAAATAAAADgAAAA8AAABhAAAADQAAAAgAAAARAAAADAAAABIAAABrAAAADgAAAAkAAAASAAAADQAAABMAAAB1AAAADwAAABMAAAARAAAAEgAAABAAAAAHAAAABwAAAAEAAAACAAAABAAAAAMAAAAAAAAAAAAAAAcAAAADAAAAAQAAAAIAAAAFAAAABAAAAAAAAAAAAAAAYWxnb3MuYwBfcG9seWZpbGxJbnRlcm5hbABhZGphY2VudEZhY2VEaXJbdG1wRmlqay5mYWNlXVtmaWprLmZhY2VdID09IEtJAGZhY2VpamsuYwBfZmFjZUlqa1BlbnRUb0dlb0JvdW5kYXJ5AGFkamFjZW50RmFjZURpcltjZW50ZXJJSksuZmFjZV1bZmFjZTJdID09IEtJAF9mYWNlSWprVG9HZW9Cb3VuZGFyeQBwb2x5Z29uLT5uZXh0ID09IE5VTEwAbGlua2VkR2VvLmMAYWRkTmV3TGlua2VkUG9seWdvbgBuZXh0ICE9IE5VTEwAbG9vcCAhPSBOVUxMAGFkZE5ld0xpbmtlZExvb3AAcG9seWdvbi0+Zmlyc3QgPT0gTlVMTABhZGRMaW5rZWRMb29wAGNvb3JkICE9IE5VTEwAYWRkTGlua2VkQ29vcmQAbG9vcC0+Zmlyc3QgPT0gTlVMTABpbm5lckxvb3BzICE9IE5VTEwAbm9ybWFsaXplTXVsdGlQb2x5Z29uAGJib3hlcyAhPSBOVUxMAGNhbmRpZGF0ZXMgIT0gTlVMTABmaW5kUG9seWdvbkZvckhvbGUAY2FuZGlkYXRlQkJveGVzICE9IE5VTEwAcmV2RGlyICE9IElOVkFMSURfRElHSVQAbG9jYWxpai5jAGgzVG9Mb2NhbElqawBiYXNlQ2VsbCAhPSBvcmlnaW5CYXNlQ2VsbAAhKG9yaWdpbk9uUGVudCAmJiBpbmRleE9uUGVudCkAcGVudGFnb25Sb3RhdGlvbnMgPj0gMABkaXJlY3Rpb25Sb3RhdGlvbnMgPj0gMABiYXNlQ2VsbCA9PSBvcmlnaW5CYXNlQ2VsbABiYXNlQ2VsbCAhPSBJTlZBTElEX0JBU0VfQ0VMTABsb2NhbElqa1RvSDMAIV9pc0Jhc2VDZWxsUGVudGFnb24oYmFzZUNlbGwpAGJhc2VDZWxsUm90YXRpb25zID49IDAAd2l0aGluUGVudGFnb25Sb3RhdGlvbnMgPj0gMABncmFwaC0+YnVja2V0cyAhPSBOVUxMAHZlcnRleEdyYXBoLmMAaW5pdFZlcnRleEdyYXBoAG5vZGUgIT0gTlVMTABhZGRWZXJ0ZXhOb2Rl";var Ri=24032;function Zi(xe){return xe}function Yi(xe){var Ie=/\b__Z[\w\d_]+/g;return xe.replace(Ie,function(ut){var zt=ut;return ut===zt?ut:zt+" ["+ut+"]"})}function Yr(){var xe=new Error;if(!xe.stack){try{throw new Error(0)}catch(Ie){xe=Ie}if(!xe.stack)return"(no stack trace available)"}return xe.stack.toString()}function gn(){var xe=Yr();return te.extraStackTrace&&(xe+=`
`+te.extraStackTrace()),Yi(xe)}function rs(xe,Ie,ut,zt){Et("Assertion failed: "+En(xe)+", at: "+[Ie?En(Ie):"unknown filename",ut,zt?En(zt):"unknown function"])}function ni(){return fn.length}function yn(xe,Ie,ut){mn.set(mn.subarray(Ie,Ie+ut),xe)}function vr(xe){return te.___errno_location&&(hr[te.___errno_location()>>2]=xe),xe}function bs(xe){Et("OOM")}function us(xe){try{var Ie=new ArrayBuffer(xe);return Ie.byteLength!=xe?void 0:(new Int8Array(Ie).set(fn),we(Ie),Rs(Ie),1)}catch{}}function pi(xe){var Ie=ni(),ut=16777216,zt=2147483648-ut;if(xe>zt)return!1;for(var o=16777216,oe=Math.max(Ie,o);oe<xe;)oe<=536870912?oe=ct(2*oe,ut):oe=Math.min(ct((3*oe+2147483648)/4,ut),zt);var $t=us(oe);return!!$t}var br=typeof atob=="function"?atob:function(xe){var Ie="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",ut="",zt,o,oe,$t,_i,mi,si,hi=0;xe=xe.replace(/[^A-Za-z0-9\+\/\=]/g,"");do $t=Ie.indexOf(xe.charAt(hi++)),_i=Ie.indexOf(xe.charAt(hi++)),mi=Ie.indexOf(xe.charAt(hi++)),si=Ie.indexOf(xe.charAt(hi++)),zt=$t<<2|_i>>4,o=(_i&15)<<4|mi>>2,oe=(mi&3)<<6|si,ut=ut+String.fromCharCode(zt),mi!==64&&(ut=ut+String.fromCharCode(o)),si!==64&&(ut=ut+String.fromCharCode(oe));while(hi<xe.length);return ut};function wr(xe){try{for(var Ie=br(xe),ut=new Uint8Array(Ie.length),zt=0;zt<Ie.length;++zt)ut[zt]=Ie.charCodeAt(zt);return ut}catch{throw new Error("Converting base64 string to bytes failed.")}}function zn(xe){if(ii(xe))return wr(xe.slice(Qt.length))}var co={Math,Int8Array,Int32Array,Uint8Array,Float32Array,Float64Array},Sr={a:Et,b:li,c:Ot,d:rs,e:vr,f:ni,g:yn,h:pi,i:bs,j:Zi,k:Yi,l:us,m:Yr,n:gn,o:Ri,p:yo},kt=function(xe,Ie,ut){"almost asm";var zt=new xe.Int8Array(ut),o=new xe.Int32Array(ut);new xe.Uint8Array(ut),new xe.Float32Array(ut);var oe=new xe.Float64Array(ut),$t=Ie.p|0,_i=xe.Math.floor,mi=xe.Math.abs,si=xe.Math.sqrt,hi=xe.Math.pow,gr=xe.Math.cos,yi=xe.Math.sin,Pi=xe.Math.tan,hn=xe.Math.acos,eo=xe.Math.asin,KA=xe.Math.atan,Vs=xe.Math.atan2,js=xe.Math.ceil,Ro=xe.Math.imul,en=xe.Math.min,Ko=xe.Math.clz32,kr=Ie.b,gt=Ie.c,Ci=Ie.d,et=Ie.e,ar=Ie.f,to=Ie.g,BA=Ie.h,Dl=Ie.i,st=24048;function xn(x){return zt=new Int8Array(x),o=new Int32Array(x),oe=new Float64Array(x),ut=x,!0}function Ze(x){x=x|0;var T=0;return T=st,st=st+x|0,st=st+15&-16,T|0}function hs(){return st|0}function Jl(x){x=x|0,st=x}function uo(x,T){x=x|0,st=x}function JA(x){return x=x|0,(Ro(x*3|0,x+1|0)|0)+1|0}function Wi(x,T,M,L){x=x|0,T=T|0,M=M|0,L=L|0;var j=0,H=0;Jo(x,T,M,L,0)|0&&(H=(Ro(M*3|0,M+1|0)|0)+1|0,$r(L|0,0,H<<3|0)|0,j=ra(H,4)|0,j&&(Gs(x,T,M,L,j,H,0),pr(j)))}function dn(x,T,M,L,j){x=x|0,T=T|0,M=M|0,L=L|0,j=j|0;var H=0;if(Jo(x,T,M,L,j)|0){if(H=(Ro(M*3|0,M+1|0)|0)+1|0,$r(L|0,0,H<<3|0)|0,j|0){$r(j|0,0,H<<2|0)|0,Gs(x,T,M,L,j,H,0);return}j=ra(H,4)|0,j&&(Gs(x,T,M,L,j,H,0),pr(j))}}function Jo(x,T,M,L,j){x=x|0,T=T|0,M=M|0,L=L|0,j=j|0;var H=0,Q=0,J=0,ue=0,Ce=0,ze=0,_t=0,Xe=0,it=0;if(it=st,st=st+16|0,Xe=it,H=L,o[H>>2]=x,o[H+4>>2]=T,H=(j|0)!=0,H&&(o[j>>2]=0),Qs(x,T)|0)return Xe=1,st=it,Xe|0;o[Xe>>2]=0;e:do if((M|0)>=1)if(H)for(Ce=0,ze=1,_t=1,Q=0,H=x;;){if(!(Q|Ce)){if(H=Yn(H,T,4,Xe)|0,T=gt()|0,(H|0)==0&(T|0)==0){H=2;break e}if(Qs(H,T)|0){H=1;break e}}if(H=Yn(H,T,o[16+(Ce<<2)>>2]|0,Xe)|0,T=gt()|0,(H|0)==0&(T|0)==0){H=2;break e}if(x=L+(_t<<3)|0,o[x>>2]=H,o[x+4>>2]=T,o[j+(_t<<2)>>2]=ze,Q=Q+1|0,x=(Q|0)==(ze|0),J=Ce+1|0,ue=(J|0)==6,Qs(H,T)|0){H=1;break e}if(ze=ze+(ue&x&1)|0,(ze|0)>(M|0)){H=0;break}else Ce=x?ue?0:J:Ce,_t=_t+1|0,Q=x?0:Q}else for(Ce=0,ze=1,_t=1,Q=0,H=x;;){if(!(Q|Ce)){if(H=Yn(H,T,4,Xe)|0,T=gt()|0,(H|0)==0&(T|0)==0){H=2;break e}if(Qs(H,T)|0){H=1;break e}}if(H=Yn(H,T,o[16+(Ce<<2)>>2]|0,Xe)|0,T=gt()|0,(H|0)==0&(T|0)==0){H=2;break e}if(x=L+(_t<<3)|0,o[x>>2]=H,o[x+4>>2]=T,Q=Q+1|0,x=(Q|0)==(ze|0),J=Ce+1|0,ue=(J|0)==6,Qs(H,T)|0){H=1;break e}if(ze=ze+(ue&x&1)|0,(ze|0)>(M|0)){H=0;break}else Ce=x?ue?0:J:Ce,_t=_t+1|0,Q=x?0:Q}else H=0;while(!1);return Xe=H,st=it,Xe|0}function Gs(x,T,M,L,j,H,Q){x=x|0,T=T|0,M=M|0,L=L|0,j=j|0,H=H|0,Q=Q|0;var J=0,ue=0,Ce=0,ze=0,_t=0,Xe=0,it=0;if(_t=st,st=st+16|0,ze=_t,(x|0)==0&(T|0)==0){st=_t;return}if(J=Da(x|0,T|0,H|0,((H|0)<0)<<31>>31|0)|0,gt()|0,ue=L+(J<<3)|0,Xe=ue,it=o[Xe>>2]|0,Xe=o[Xe+4>>2]|0,Ce=(it|0)==(x|0)&(Xe|0)==(T|0),!((it|0)==0&(Xe|0)==0|Ce))do J=(J+1|0)%(H|0)|0,ue=L+(J<<3)|0,it=ue,Xe=o[it>>2]|0,it=o[it+4>>2]|0,Ce=(Xe|0)==(x|0)&(it|0)==(T|0);while(!((Xe|0)==0&(it|0)==0|Ce));if(J=j+(J<<2)|0,Ce&&(o[J>>2]|0)<=(Q|0)){st=_t;return}if(it=ue,o[it>>2]=x,o[it+4>>2]=T,o[J>>2]=Q,(Q|0)>=(M|0)){st=_t;return}it=Q+1|0,o[ze>>2]=0,Xe=Yn(x,T,2,ze)|0,Gs(Xe,gt()|0,M,L,j,H,it),o[ze>>2]=0,Xe=Yn(x,T,3,ze)|0,Gs(Xe,gt()|0,M,L,j,H,it),o[ze>>2]=0,Xe=Yn(x,T,1,ze)|0,Gs(Xe,gt()|0,M,L,j,H,it),o[ze>>2]=0,Xe=Yn(x,T,5,ze)|0,Gs(Xe,gt()|0,M,L,j,H,it),o[ze>>2]=0,Xe=Yn(x,T,4,ze)|0,Gs(Xe,gt()|0,M,L,j,H,it),o[ze>>2]=0,Xe=Yn(x,T,6,ze)|0,Gs(Xe,gt()|0,M,L,j,H,it),st=_t}function Yn(x,T,M,L){x=x|0,T=T|0,M=M|0,L=L|0;var j=0,H=0,Q=0,J=0,ue=0,Ce=0,ze=0,_t=0,Xe=0,it=0;if((o[L>>2]|0)>0){j=0;do M=Zs(M)|0,j=j+1|0;while((j|0)<(o[L>>2]|0))}J=Nt(x|0,T|0,45)|0,gt()|0,ue=J&127,H=io(x,T)|0,j=Nt(x|0,T|0,52)|0,gt()|0,j=j&15;e:do if(!j)Q=6;else for(;;){if(_t=(15-j|0)*3|0,Xe=Nt(x|0,T|0,_t|0)|0,gt()|0,Xe=Xe&7,it=(Un(j)|0)==0,j=j+-1|0,ze=Kt(7,0,_t|0)|0,T=T&~(gt()|0),_t=Kt(o[(it?464:48)+(Xe*28|0)+(M<<2)>>2]|0,0,_t|0)|0,Ce=gt()|0,M=o[(it?672:256)+(Xe*28|0)+(M<<2)>>2]|0,x=_t|x&~ze,T=Ce|T,!M){M=0;break e}if(!j){Q=6;break}}while(!1);(Q|0)==6&&(it=o[880+(ue*28|0)+(M<<2)>>2]|0,Xe=Kt(it|0,0,45)|0,x=Xe|x,T=gt()|0|T&-1040385,M=o[4304+(ue*28|0)+(M<<2)>>2]|0,(it&127|0)==127&&(it=Kt(o[880+(ue*28|0)+20>>2]|0,0,45)|0,T=gt()|0|T&-1040385,M=o[4304+(ue*28|0)+20>>2]|0,x=ta(it|x,T)|0,T=gt()|0,o[L>>2]=(o[L>>2]|0)+1)),Q=Nt(x|0,T|0,45)|0,gt()|0,Q=Q&127;e:do if(ns(Q)|0){t:do if((io(x,T)|0)==1){if((ue|0)!=(Q|0))if(ss(Q,o[7728+(ue*28|0)>>2]|0)|0){x=Rn(x,T)|0,H=1,T=gt()|0;break}else{x=ta(x,T)|0,H=1,T=gt()|0;break}switch(H|0){case 5:{x=Rn(x,T)|0,T=gt()|0,o[L>>2]=(o[L>>2]|0)+5,H=0;break t}case 3:{x=ta(x,T)|0,T=gt()|0,o[L>>2]=(o[L>>2]|0)+1,H=0;break t}default:return Xe=0,it=0,kr(Xe|0),it|0}}else H=0;while(!1);if((M|0)>0){j=0;do x=bo(x,T)|0,T=gt()|0,j=j+1|0;while((j|0)!=(M|0))}if((ue|0)!=(Q|0)){if(!(tc(Q)|0)){if((H|0)!=0|(io(x,T)|0)!=5)break;o[L>>2]=(o[L>>2]|0)+1;break}switch(J&127){case 8:case 118:break e}(io(x,T)|0)!=3&&(o[L>>2]=(o[L>>2]|0)+1)}}else if((M|0)>0){j=0;do x=ta(x,T)|0,T=gt()|0,j=j+1|0;while((j|0)!=(M|0))}while(!1);return o[L>>2]=((o[L>>2]|0)+M|0)%6|0,Xe=T,it=x,kr(Xe|0),it|0}function xo(x,T,M,L){x=x|0,T=T|0,M=M|0,L=L|0;var j=0,H=0,Q=0,J=0,ue=0,Ce=0,ze=0,_t=0;if(_t=st,st=st+16|0,ze=_t,!M)return ze=L,o[ze>>2]=x,o[ze+4>>2]=T,ze=0,st=_t,ze|0;o[ze>>2]=0;e:do if(Qs(x,T)|0)x=1;else{if(H=(M|0)>0,H){j=0,Ce=x;do{if(Ce=Yn(Ce,T,4,ze)|0,T=gt()|0,(Ce|0)==0&(T|0)==0){x=2;break e}if(j=j+1|0,Qs(Ce,T)|0){x=1;break e}}while((j|0)<(M|0));if(ue=L,o[ue>>2]=Ce,o[ue+4>>2]=T,ue=M+-1|0,H){H=0,Q=1,j=Ce,x=T;do{if(j=Yn(j,x,2,ze)|0,x=gt()|0,(j|0)==0&(x|0)==0){x=2;break e}if(J=L+(Q<<3)|0,o[J>>2]=j,o[J+4>>2]=x,Q=Q+1|0,Qs(j,x)|0){x=1;break e}H=H+1|0}while((H|0)<(M|0));J=0,H=Q;do{if(j=Yn(j,x,3,ze)|0,x=gt()|0,(j|0)==0&(x|0)==0){x=2;break e}if(Q=L+(H<<3)|0,o[Q>>2]=j,o[Q+4>>2]=x,H=H+1|0,Qs(j,x)|0){x=1;break e}J=J+1|0}while((J|0)<(M|0));Q=0;do{if(j=Yn(j,x,1,ze)|0,x=gt()|0,(j|0)==0&(x|0)==0){x=2;break e}if(J=L+(H<<3)|0,o[J>>2]=j,o[J+4>>2]=x,H=H+1|0,Qs(j,x)|0){x=1;break e}Q=Q+1|0}while((Q|0)<(M|0));Q=0;do{if(j=Yn(j,x,5,ze)|0,x=gt()|0,(j|0)==0&(x|0)==0){x=2;break e}if(J=L+(H<<3)|0,o[J>>2]=j,o[J+4>>2]=x,H=H+1|0,Qs(j,x)|0){x=1;break e}Q=Q+1|0}while((Q|0)<(M|0));Q=0;do{if(j=Yn(j,x,4,ze)|0,x=gt()|0,(j|0)==0&(x|0)==0){x=2;break e}if(J=L+(H<<3)|0,o[J>>2]=j,o[J+4>>2]=x,H=H+1|0,Qs(j,x)|0){x=1;break e}Q=Q+1|0}while((Q|0)<(M|0));for(Q=0;;){if(j=Yn(j,x,6,ze)|0,x=gt()|0,(j|0)==0&(x|0)==0){x=2;break e}if((Q|0)!=(ue|0))if(J=L+(H<<3)|0,o[J>>2]=j,o[J+4>>2]=x,!(Qs(j,x)|0))H=H+1|0;else{x=1;break e}if(Q=Q+1|0,(Q|0)>=(M|0)){Q=Ce,H=T;break}}}else Q=Ce,j=Ce,H=T,x=T}else Q=L,o[Q>>2]=x,o[Q+4>>2]=T,Q=x,j=x,H=T,x=T;x=((Q|0)!=(j|0)|(H|0)!=(x|0))&1}while(!1);return ze=x,st=_t,ze|0}function Fs(x,T){x=x|0,T=T|0;var M=0,L=0,j=0,H=0,Q=0,J=0;if(H=st,st=st+48|0,j=H+8|0,L=H,J=x,Q=o[J+4>>2]|0,M=L,o[M>>2]=o[J>>2],o[M+4>>2]=Q,Fi(L,j),j=$l(j,T)|0,T=o[L>>2]|0,L=o[x+8>>2]|0,(L|0)<=0)return J=T,Q=(j|0)<(J|0),J=Q?J:j,J=J+12|0,st=H,J|0;M=o[x+12>>2]|0,x=0;do T=(o[M+(x<<3)>>2]|0)+T|0,x=x+1|0;while((x|0)<(L|0));return J=(j|0)<(T|0),J=J?T:j,J=J+12|0,st=H,J|0}function Pl(x,T,M){x=x|0,T=T|0,M=M|0;var L=0,j=0,H=0,Q=0,J=0,ue=0;if(J=st,st=st+48|0,L=J+8|0,j=J,!($A(x,T,M)|0)){st=J;return}if(ue=x,H=o[ue+4>>2]|0,Q=j,o[Q>>2]=o[ue>>2],o[Q+4>>2]=H,Fi(j,L),Q=$l(L,T)|0,T=o[j>>2]|0,H=o[x+8>>2]|0,(H|0)>0){j=o[x+12>>2]|0,L=0;do T=(o[j+(L<<3)>>2]|0)+T|0,L=L+1|0;while((L|0)!=(H|0))}if(T=(Q|0)<(T|0)?T:Q,(T|0)<=-12){st=J;return}ue=T+11|0,$r(M|0,0,(((ue|0)>0?ue:0)<<3)+8|0)|0,st=J}function $A(x,T,M){x=x|0,T=T|0,M=M|0;var L=0,j=0,H=0,Q=0,J=0,ue=0,Ce=0,ze=0,_t=0,Xe=0,it=0,z=0,l=0,g=0,S=0,k=0,F=0,Z=0,u=0,h=0,d=0,y=0,b=0,I=0,R=0,N=0,W=0,K=0,le=0,de=0;if(de=st,st=st+112|0,N=de+80|0,ue=de+72|0,W=de,K=de+56|0,Ce=x+8|0,le=Eo((o[Ce>>2]<<5)+32|0)|0,le||Ci(22848,22448,800,22456),jo(x,le),H=x,L=o[H+4>>2]|0,J=ue,o[J>>2]=o[H>>2],o[J+4>>2]=L,Fi(ue,N),J=$l(N,T)|0,L=o[ue>>2]|0,H=o[Ce>>2]|0,(H|0)>0){Q=o[x+12>>2]|0,j=0;do L=(o[Q+(j<<3)>>2]|0)+L|0,j=j+1|0;while((j|0)!=(H|0))}if(J=(J|0)<(L|0)?L:J,R=J+12|0,j=ra(R,8)|0,ze=ra(R,8)|0,o[N>>2]=0,b=x,I=o[b+4>>2]|0,L=ue,o[L>>2]=o[b>>2],o[L+4>>2]=I,L=ec(ue,R,T,N,j,ze)|0,L|0)return pr(j),pr(ze),pr(le),le=L,st=de,le|0;e:do if((o[Ce>>2]|0)>0){for(H=x+12|0,L=0;Q=ec((o[H>>2]|0)+(L<<3)|0,R,T,N,j,ze)|0,L=L+1|0,!(Q|0);)if((L|0)>=(o[Ce>>2]|0))break e;return pr(j),pr(ze),pr(le),le=Q,st=de,le|0}while(!1);(J|0)>-12&&$r(ze|0,0,((R|0)>1?R:1)<<3|0)|0;e:do if((o[N>>2]|0)>0){I=((R|0)<0)<<31>>31,Z=j,u=ze,h=j,d=j,y=ze,b=j,L=j,g=j,S=ze,k=ze,F=ze,j=ze;t:for(;;){for(l=o[N>>2]|0,it=0,z=0,H=0;;){Q=W,J=Q+56|0;do o[Q>>2]=0,Q=Q+4|0;while((Q|0)<(J|0));if(T=Z+(it<<3)|0,ue=o[T>>2]|0,T=o[T+4>>2]|0,Jo(ue,T,1,W,0)|0){Q=W,J=Q+56|0;do o[Q>>2]=0,Q=Q+4|0;while((Q|0)<(J|0));Q=ra(7,4)|0,Q|0&&(Gs(ue,T,1,W,Q,7,0),pr(Q))}Xe=0;do{_t=W+(Xe<<3)|0,ze=o[_t>>2]|0,_t=o[_t+4>>2]|0;i:do if(!((ze|0)==0&(_t|0)==0)){if(ue=Da(ze|0,_t|0,R|0,I|0)|0,gt()|0,Q=M+(ue<<3)|0,J=Q,T=o[J>>2]|0,J=o[J+4>>2]|0,!((T|0)==0&(J|0)==0))for(Ce=0;;){if((Ce|0)>(R|0))break t;if((T|0)==(ze|0)&(J|0)==(_t|0))break i;if(ue=(ue+1|0)%(R|0)|0,Q=M+(ue<<3)|0,J=Q,T=o[J>>2]|0,J=o[J+4>>2]|0,(T|0)==0&(J|0)==0)break;Ce=Ce+1|0}(ze|0)==0&(_t|0)==0||(wo(ze,_t,K),Wa(x,le,K)|0&&(Ce=Q,o[Ce>>2]=ze,o[Ce+4>>2]=_t,Ce=u+(H<<3)|0,o[Ce>>2]=ze,o[Ce+4>>2]=_t,H=H+1|0))}while(!1);Xe=Xe+1|0}while(Xe>>>0<7);if(z=z+1|0,(z|0)>=(l|0))break;it=it+1|0}if((l|0)>0&&$r(h|0,0,l<<3|0)|0,o[N>>2]=H,(H|0)>0)ze=j,_t=F,Xe=b,it=k,z=S,l=u,j=g,F=L,k=d,S=h,g=ze,L=_t,b=y,y=Xe,d=it,h=z,u=Z,Z=l;else break e}return pr(d),pr(y),pr(le),le=-1,st=de,le|0}else L=ze;while(!1);return pr(le),pr(j),pr(L),le=0,st=de,le|0}function ec(x,T,M,L,j,H){x=x|0,T=T|0,M=M|0,L=L|0,j=j|0,H=H|0;var Q=0,J=0,ue=0,Ce=0,ze=0,_t=0,Xe=0,it=0,z=0,l=0,g=0,S=0,k=0,F=0,Z=0,u=0,h=0,d=0,y=0,b=0,I=0,R=0,N=0;if(I=st,st=st+48|0,h=I+32|0,d=I+16|0,y=I,Q=o[x>>2]|0,(Q|0)<=0)return b=0,st=I,b|0;S=x+4|0,k=h+8|0,F=d+8|0,Z=y+8|0,u=((T|0)<0)<<31>>31,g=0;e:for(;;){J=o[S>>2]|0,z=J+(g<<4)|0,o[h>>2]=o[z>>2],o[h+4>>2]=o[z+4>>2],o[h+8>>2]=o[z+8>>2],o[h+12>>2]=o[z+12>>2],(g|0)==(Q+-1|0)?(o[d>>2]=o[J>>2],o[d+4>>2]=o[J+4>>2],o[d+8>>2]=o[J+8>>2],o[d+12>>2]=o[J+12>>2]):(z=J+(g+1<<4)|0,o[d>>2]=o[z>>2],o[d+4>>2]=o[z+4>>2],o[d+8>>2]=o[z+8>>2],o[d+12>>2]=o[z+12>>2]),z=Oo(h,d,M)|0;t:do if((z|0)>0){l=+(z|0),it=0;i:for(;;){N=+(z-it|0),R=+(it|0),oe[y>>3]=+oe[h>>3]*N/l+ +oe[d>>3]*R/l,oe[Z>>3]=+oe[k>>3]*N/l+ +oe[F>>3]*R/l,_t=qa(y,M)|0,Xe=gt()|0,J=Da(_t|0,Xe|0,T|0,u|0)|0,gt()|0,Q=H+(J<<3)|0,ue=Q,Ce=o[ue>>2]|0,ue=o[ue+4>>2]|0;r:do if((Ce|0)==0&(ue|0)==0)b=14;else for(ze=0;;){if((ze|0)>(T|0)){Q=1;break r}if((Ce|0)==(_t|0)&(ue|0)==(Xe|0)){Q=7;break r}if(J=(J+1|0)%(T|0)|0,Q=H+(J<<3)|0,ue=Q,Ce=o[ue>>2]|0,ue=o[ue+4>>2]|0,(Ce|0)==0&(ue|0)==0){b=14;break}else ze=ze+1|0}while(!1);switch((b|0)==14&&(b=0,(_t|0)==0&(Xe|0)==0?Q=7:(o[Q>>2]=_t,o[Q+4>>2]=Xe,Q=o[L>>2]|0,ze=j+(Q<<3)|0,o[ze>>2]=_t,o[ze+4>>2]=Xe,o[L>>2]=Q+1,Q=0)),Q&7){case 7:case 0:break;default:break i}if(it=it+1|0,(z|0)<=(it|0)){b=8;break t}}if(Q|0){Q=-1,b=20;break e}}else b=8;while(!1);if((b|0)==8&&(b=0),g=g+1|0,Q=o[x>>2]|0,(g|0)>=(Q|0)){Q=0,b=20;break}}return(b|0)==20?(st=I,Q|0):0}function zl(x,T,M){x=x|0,T=T|0,M=M|0;var L=0,j=0,H=0,Q=0,J=0,ue=0,Ce=0;if(Ce=st,st=st+176|0,ue=Ce,(T|0)<1){Ki(M,0,0),st=Ce;return}Q=x,Q=Nt(o[Q>>2]|0,o[Q+4>>2]|0,52)|0,gt()|0,Ki(M,(T|0)>6?T:6,Q&15),Q=0;do{if(L=x+(Q<<3)|0,Ia(o[L>>2]|0,o[L+4>>2]|0,ue),L=o[ue>>2]|0,(L|0)>0){J=0;do H=ue+8+(J<<4)|0,J=J+1|0,L=ue+8+(((J|0)%(L|0)|0)<<4)|0,j=oA(M,L,H)|0,j?sA(M,j)|0:cc(M,H,L)|0,L=o[ue>>2]|0;while((J|0)<(L|0))}Q=Q+1|0}while((Q|0)!=(T|0));st=Ce}function fA(x,T,M){x=x|0,T=T|0,M=M|0;var L=0,j=0,H=0,Q=0;if(H=st,st=st+32|0,L=H,j=H+16|0,zl(x,T,j),o[M>>2]=0,o[M+4>>2]=0,o[M+8>>2]=0,x=ka(j)|0,!x){Vo(M)|0,Po(j),st=H;return}do{T=sc(M)|0;do bl(T,x)|0,Q=x+16|0,o[L>>2]=o[Q>>2],o[L+4>>2]=o[Q+4>>2],o[L+8>>2]=o[Q+8>>2],o[L+12>>2]=o[Q+12>>2],sA(j,x)|0,x=Tl(j,L)|0;while(x|0);x=ka(j)|0}while(x|0);Vo(M)|0,Po(j),st=H}function ns(x){return x=x|0,o[7728+(x*28|0)+16>>2]|0}function tc(x){return x=x|0,(x|0)==4|(x|0)==117|0}function qn(x){return x=x|0,o[11152+((o[x>>2]|0)*216|0)+((o[x+4>>2]|0)*72|0)+((o[x+8>>2]|0)*24|0)+(o[x+12>>2]<<3)>>2]|0}function dA(x){return x=x|0,o[11152+((o[x>>2]|0)*216|0)+((o[x+4>>2]|0)*72|0)+((o[x+8>>2]|0)*24|0)+(o[x+12>>2]<<3)+4>>2]|0}function Jt(x,T){x=x|0,T=T|0,x=7728+(x*28|0)|0,o[T>>2]=o[x>>2],o[T+4>>2]=o[x+4>>2],o[T+8>>2]=o[x+8>>2],o[T+12>>2]=o[x+12>>2]}function $i(x,T){x=x|0,T=T|0;var M=0,L=0;if(T>>>0>20)return T=-1,T|0;do if((o[11152+(T*216|0)>>2]|0)!=(x|0))if((o[11152+(T*216|0)+8>>2]|0)!=(x|0))if((o[11152+(T*216|0)+16>>2]|0)!=(x|0))if((o[11152+(T*216|0)+24>>2]|0)!=(x|0))if((o[11152+(T*216|0)+32>>2]|0)!=(x|0))if((o[11152+(T*216|0)+40>>2]|0)!=(x|0))if((o[11152+(T*216|0)+48>>2]|0)!=(x|0))if((o[11152+(T*216|0)+56>>2]|0)!=(x|0))if((o[11152+(T*216|0)+64>>2]|0)!=(x|0))if((o[11152+(T*216|0)+72>>2]|0)!=(x|0))if((o[11152+(T*216|0)+80>>2]|0)!=(x|0))if((o[11152+(T*216|0)+88>>2]|0)!=(x|0))if((o[11152+(T*216|0)+96>>2]|0)!=(x|0))if((o[11152+(T*216|0)+104>>2]|0)!=(x|0))if((o[11152+(T*216|0)+112>>2]|0)!=(x|0))if((o[11152+(T*216|0)+120>>2]|0)!=(x|0))if((o[11152+(T*216|0)+128>>2]|0)!=(x|0))if((o[11152+(T*216|0)+136>>2]|0)==(x|0))x=2,M=1,L=2;else{if((o[11152+(T*216|0)+144>>2]|0)==(x|0)){x=0,M=2,L=0;break}if((o[11152+(T*216|0)+152>>2]|0)==(x|0)){x=0,M=2,L=1;break}if((o[11152+(T*216|0)+160>>2]|0)==(x|0)){x=0,M=2,L=2;break}if((o[11152+(T*216|0)+168>>2]|0)==(x|0)){x=1,M=2,L=0;break}if((o[11152+(T*216|0)+176>>2]|0)==(x|0)){x=1,M=2,L=1;break}if((o[11152+(T*216|0)+184>>2]|0)==(x|0)){x=1,M=2,L=2;break}if((o[11152+(T*216|0)+192>>2]|0)==(x|0)){x=2,M=2,L=0;break}if((o[11152+(T*216|0)+200>>2]|0)==(x|0)){x=2,M=2,L=1;break}if((o[11152+(T*216|0)+208>>2]|0)==(x|0)){x=2,M=2,L=2;break}else x=-1;return x|0}else x=2,M=1,L=1;else x=2,M=1,L=0;else x=1,M=1,L=2;else x=1,M=1,L=1;else x=1,M=1,L=0;else x=0,M=1,L=2;else x=0,M=1,L=1;else x=0,M=1,L=0;else x=2,M=0,L=2;else x=2,M=0,L=1;else x=2,M=0,L=0;else x=1,M=0,L=2;else x=1,M=0,L=1;else x=1,M=0,L=0;else x=0,M=0,L=2;else x=0,M=0,L=1;else x=0,M=0,L=0;while(!1);return T=o[11152+(T*216|0)+(M*72|0)+(x*24|0)+(L<<3)+4>>2]|0,T|0}function ss(x,T){return x=x|0,T=T|0,(o[7728+(x*28|0)+20>>2]|0)==(T|0)?(T=1,T|0):(T=(o[7728+(x*28|0)+24>>2]|0)==(T|0),T|0)}function xt(x,T){return x=x|0,T=T|0,o[880+(x*28|0)+(T<<2)>>2]|0}function gi(x,T){return x=x|0,T=T|0,(o[880+(x*28|0)>>2]|0)==(T|0)?(T=0,T|0):(o[880+(x*28|0)+4>>2]|0)==(T|0)?(T=1,T|0):(o[880+(x*28|0)+8>>2]|0)==(T|0)?(T=2,T|0):(o[880+(x*28|0)+12>>2]|0)==(T|0)?(T=3,T|0):(o[880+(x*28|0)+16>>2]|0)==(T|0)?(T=4,T|0):(o[880+(x*28|0)+20>>2]|0)==(T|0)?(T=5,T|0):((o[880+(x*28|0)+24>>2]|0)==(T|0)?6:7)|0}function Fo(){return 122}function $o(x){x=x|0;var T=0,M=0,L=0;T=0;do Kt(T|0,0,45)|0,L=gt()|0|134225919,M=x+(T<<3)|0,o[M>>2]=-1,o[M+4>>2]=L,T=T+1|0;while((T|0)!=122)}function vn(x){return x=x|0,+oe[x+16>>3]<+oe[x+24>>3]|0}function la(x,T){x=x|0,T=T|0;var M=0,L=0,j=0;return M=+oe[T>>3],!(M>=+oe[x+8>>3])||!(M<=+oe[x>>3])?(T=0,T|0):(L=+oe[x+16>>3],M=+oe[x+24>>3],j=+oe[T+8>>3],T=j>=M,x=j<=L&1,L<M?T&&(x=1):T||(x=0),T=(x|0)!=0,T|0)}function $l(x,T){x=x|0,T=T|0;var M=0,L=0,j=0,H=0,Q=0,J=0,ue=0,Ce=0;Q=st,st=st+288|0,M=Q+264|0,L=Q+96|0,j=Q,H=j,J=H+96|0;do o[H>>2]=0,H=H+4|0;while((H|0)<(J|0));return ll(T,j),H=j,J=o[H>>2]|0,H=o[H+4>>2]|0,wo(J,H,M),Ia(J,H,L),ue=+Fl(M,L+8|0),oe[M>>3]=+oe[x>>3],H=M+8|0,oe[H>>3]=+oe[x+16>>3],oe[L>>3]=+oe[x+8>>3],J=L+8|0,oe[J>>3]=+oe[x+24>>3],Ce=+Fl(M,L),J=~~+js(+(Ce*Ce/+aA(+ +mi(+((+oe[H>>3]-+oe[J>>3])/(+oe[M>>3]-+oe[L>>3]))),3)/(ue*(ue*2.59807621135)*.8))),st=Q,(J|0?J:1)|0}function Oo(x,T,M){x=x|0,T=T|0,M=M|0;var L=0,j=0,H=0,Q=0,J=0,ue=0,Ce=0;J=st,st=st+288|0,L=J+264|0,j=J+96|0,H=J,Q=H,ue=Q+96|0;do o[Q>>2]=0,Q=Q+4|0;while((Q|0)<(ue|0));return ll(M,H),ue=H,Q=o[ue>>2]|0,ue=o[ue+4>>2]|0,wo(Q,ue,L),Ia(Q,ue,j),Ce=+Fl(L,j+8|0),ue=~~+js(+(+Fl(x,T)/(Ce*2))),st=J,(ue|0?ue:1)|0}function eA(x,T,M,L){x=x|0,T=T|0,M=M|0,L=L|0,o[x>>2]=T,o[x+4>>2]=M,o[x+8>>2]=L}function pA(x,T){x=x|0,T=T|0;var M=0,L=0,j=0,H=0,Q=0,J=0,ue=0,Ce=0,ze=0,_t=0,Xe=0;_t=T+8|0,o[_t>>2]=0,ue=+oe[x>>3],Q=+mi(+ue),Ce=+oe[x+8>>3],J=+mi(+Ce)/.8660254037844386,Q=Q+J*.5,M=~~Q,x=~~J,Q=Q-+(M|0),J=J-+(x|0);do if(Q<.5)if(Q<.3333333333333333)if(o[T>>2]=M,J<(Q+1)*.5){o[T+4>>2]=x;break}else{x=x+1|0,o[T+4>>2]=x;break}else if(Xe=1-Q,x=(!(J<Xe)&1)+x|0,o[T+4>>2]=x,Xe<=J&J<Q*2){M=M+1|0,o[T>>2]=M;break}else{o[T>>2]=M;break}else{if(!(Q<.6666666666666666))if(M=M+1|0,o[T>>2]=M,J<Q*.5){o[T+4>>2]=x;break}else{x=x+1|0,o[T+4>>2]=x;break}if(J<1-Q){if(o[T+4>>2]=x,Q*2+-1<J){o[T>>2]=M;break}}else x=x+1|0,o[T+4>>2]=x;M=M+1|0,o[T>>2]=M}while(!1);do if(ue<0)if(x&1){ze=(x+1|0)/2|0,ze=Nl(M|0,((M|0)<0)<<31>>31|0,ze|0,((ze|0)<0)<<31>>31|0)|0,M=~~(+(M|0)-((+(ze>>>0)+4294967296*+(gt()|0))*2+1)),o[T>>2]=M;break}else{ze=(x|0)/2|0,ze=Nl(M|0,((M|0)<0)<<31>>31|0,ze|0,((ze|0)<0)<<31>>31|0)|0,M=~~(+(M|0)-(+(ze>>>0)+4294967296*+(gt()|0))*2),o[T>>2]=M;break}while(!1);ze=T+4|0,Ce<0&&(M=M-((x<<1|1|0)/2|0)|0,o[T>>2]=M,x=0-x|0,o[ze>>2]=x),L=x-M|0,(M|0)<0?(j=0-M|0,o[ze>>2]=L,o[_t>>2]=j,o[T>>2]=0,x=L,M=0):j=0,(x|0)<0&&(M=M-x|0,o[T>>2]=M,j=j-x|0,o[_t>>2]=j,o[ze>>2]=0,x=0),H=M-j|0,L=x-j|0,(j|0)<0&&(o[T>>2]=H,o[ze>>2]=L,o[_t>>2]=0,x=L,M=H,j=0),L=(x|0)<(M|0)?x:M,L=(j|0)<(L|0)?j:L,!((L|0)<=0)&&(o[T>>2]=M-L,o[ze>>2]=x-L,o[_t>>2]=j-L)}function Kn(x){x=x|0;var T=0,M=0,L=0,j=0,H=0,Q=0;T=o[x>>2]|0,Q=x+4|0,M=o[Q>>2]|0,(T|0)<0&&(M=M-T|0,o[Q>>2]=M,H=x+8|0,o[H>>2]=(o[H>>2]|0)-T,o[x>>2]=0,T=0),(M|0)<0?(T=T-M|0,o[x>>2]=T,H=x+8|0,j=(o[H>>2]|0)-M|0,o[H>>2]=j,o[Q>>2]=0,M=0):(j=x+8|0,H=j,j=o[j>>2]|0),(j|0)<0&&(T=T-j|0,o[x>>2]=T,M=M-j|0,o[Q>>2]=M,o[H>>2]=0,j=0),L=(M|0)<(T|0)?M:T,L=(j|0)<(L|0)?j:L,!((L|0)<=0)&&(o[x>>2]=T-L,o[Q>>2]=M-L,o[H>>2]=j-L)}function Wt(x,T){x=x|0,T=T|0;var M=0,L=0;L=o[x+8>>2]|0,M=+((o[x+4>>2]|0)-L|0),oe[T>>3]=+((o[x>>2]|0)-L|0)-M*.5,oe[T+8>>3]=M*.8660254037844386}function Ui(x,T,M){x=x|0,T=T|0,M=M|0,o[M>>2]=(o[T>>2]|0)+(o[x>>2]|0),o[M+4>>2]=(o[T+4>>2]|0)+(o[x+4>>2]|0),o[M+8>>2]=(o[T+8>>2]|0)+(o[x+8>>2]|0)}function sr(x,T,M){x=x|0,T=T|0,M=M|0,o[M>>2]=(o[x>>2]|0)-(o[T>>2]|0),o[M+4>>2]=(o[x+4>>2]|0)-(o[T+4>>2]|0),o[M+8>>2]=(o[x+8>>2]|0)-(o[T+8>>2]|0)}function tn(x,T){x=x|0,T=T|0;var M=0,L=0;M=Ro(o[x>>2]|0,T)|0,o[x>>2]=M,M=x+4|0,L=Ro(o[M>>2]|0,T)|0,o[M>>2]=L,x=x+8|0,T=Ro(o[x>>2]|0,T)|0,o[x>>2]=T}function Aa(x){x=x|0;var T=0,M=0,L=0,j=0,H=0,Q=0,J=0;Q=o[x>>2]|0,J=(Q|0)<0,L=(o[x+4>>2]|0)-(J?Q:0)|0,H=(L|0)<0,j=(H?0-L|0:0)+((o[x+8>>2]|0)-(J?Q:0))|0,M=(j|0)<0,x=M?0:j,T=(H?0:L)-(M?j:0)|0,j=(J?0:Q)-(H?L:0)-(M?j:0)|0,M=(T|0)<(j|0)?T:j,M=(x|0)<(M|0)?x:M,L=(M|0)>0,x=x-(L?M:0)|0,T=T-(L?M:0)|0;e:do switch(j-(L?M:0)|0){case 0:switch(T|0){case 0:return J=x|0?(x|0)==1?1:7:0,J|0;case 1:return J=x|0?(x|0)==1?3:7:2,J|0;default:break e}case 1:switch(T|0){case 0:return J=x|0?(x|0)==1?5:7:4,J|0;case 1:{if(!x)x=6;else break e;return x|0}default:break e}}while(!1);return J=7,J|0}function Dr(x){x=x|0;var T=0,M=0,L=0,j=0,H=0,Q=0,J=0;Q=x+8|0,M=o[Q>>2]|0,T=(o[x>>2]|0)-M|0,J=x+4|0,M=(o[J>>2]|0)-M|0,L=Qn(+((T*3|0)-M|0)/7)|0,o[x>>2]=L,T=Qn(+((M<<1)+T|0)/7)|0,o[J>>2]=T,o[Q>>2]=0,M=T-L|0,(L|0)<0?(H=0-L|0,o[J>>2]=M,o[Q>>2]=H,o[x>>2]=0,T=M,L=0,M=H):M=0,(T|0)<0&&(L=L-T|0,o[x>>2]=L,M=M-T|0,o[Q>>2]=M,o[J>>2]=0,T=0),H=L-M|0,j=T-M|0,(M|0)<0?(o[x>>2]=H,o[J>>2]=j,o[Q>>2]=0,T=j,j=H,M=0):j=L,L=(T|0)<(j|0)?T:j,L=(M|0)<(L|0)?M:L,!((L|0)<=0)&&(o[x>>2]=j-L,o[J>>2]=T-L,o[Q>>2]=M-L)}function ba(x){x=x|0;var T=0,M=0,L=0,j=0,H=0,Q=0,J=0;Q=x+8|0,M=o[Q>>2]|0,T=(o[x>>2]|0)-M|0,J=x+4|0,M=(o[J>>2]|0)-M|0,L=Qn(+((T<<1)+M|0)/7)|0,o[x>>2]=L,T=Qn(+((M*3|0)-T|0)/7)|0,o[J>>2]=T,o[Q>>2]=0,M=T-L|0,(L|0)<0?(H=0-L|0,o[J>>2]=M,o[Q>>2]=H,o[x>>2]=0,T=M,L=0,M=H):M=0,(T|0)<0&&(L=L-T|0,o[x>>2]=L,M=M-T|0,o[Q>>2]=M,o[J>>2]=0,T=0),H=L-M|0,j=T-M|0,(M|0)<0?(o[x>>2]=H,o[J>>2]=j,o[Q>>2]=0,T=j,j=H,M=0):j=L,L=(T|0)<(j|0)?T:j,L=(M|0)<(L|0)?M:L,!((L|0)<=0)&&(o[x>>2]=j-L,o[J>>2]=T-L,o[Q>>2]=M-L)}function rl(x){x=x|0;var T=0,M=0,L=0,j=0,H=0,Q=0,J=0;T=o[x>>2]|0,Q=x+4|0,M=o[Q>>2]|0,J=x+8|0,L=o[J>>2]|0,j=M+(T*3|0)|0,o[x>>2]=j,M=L+(M*3|0)|0,o[Q>>2]=M,T=(L*3|0)+T|0,o[J>>2]=T,L=M-j|0,(j|0)<0?(T=T-j|0,o[Q>>2]=L,o[J>>2]=T,o[x>>2]=0,M=L,L=0):L=j,(M|0)<0&&(L=L-M|0,o[x>>2]=L,T=T-M|0,o[J>>2]=T,o[Q>>2]=0,M=0),H=L-T|0,j=M-T|0,(T|0)<0?(o[x>>2]=H,o[Q>>2]=j,o[J>>2]=0,L=H,T=0):j=M,M=(j|0)<(L|0)?j:L,M=(T|0)<(M|0)?T:M,!((M|0)<=0)&&(o[x>>2]=L-M,o[Q>>2]=j-M,o[J>>2]=T-M)}function ca(x){x=x|0;var T=0,M=0,L=0,j=0,H=0,Q=0,J=0;j=o[x>>2]|0,Q=x+4|0,T=o[Q>>2]|0,J=x+8|0,M=o[J>>2]|0,L=(T*3|0)+j|0,j=M+(j*3|0)|0,o[x>>2]=j,o[Q>>2]=L,T=(M*3|0)+T|0,o[J>>2]=T,M=L-j|0,(j|0)<0?(T=T-j|0,o[Q>>2]=M,o[J>>2]=T,o[x>>2]=0,j=0):M=L,(M|0)<0&&(j=j-M|0,o[x>>2]=j,T=T-M|0,o[J>>2]=T,o[Q>>2]=0,M=0),H=j-T|0,L=M-T|0,(T|0)<0?(o[x>>2]=H,o[Q>>2]=L,o[J>>2]=0,j=H,T=0):L=M,M=(L|0)<(j|0)?L:j,M=(T|0)<(M|0)?T:M,!((M|0)<=0)&&(o[x>>2]=j-M,o[Q>>2]=L-M,o[J>>2]=T-M)}function ho(x,T){x=x|0,T=T|0;var M=0,L=0,j=0,H=0,Q=0,J=0;(T+-1|0)>>>0>=6||(j=(o[15472+(T*12|0)>>2]|0)+(o[x>>2]|0)|0,o[x>>2]=j,J=x+4|0,L=(o[15472+(T*12|0)+4>>2]|0)+(o[J>>2]|0)|0,o[J>>2]=L,Q=x+8|0,T=(o[15472+(T*12|0)+8>>2]|0)+(o[Q>>2]|0)|0,o[Q>>2]=T,M=L-j|0,(j|0)<0?(T=T-j|0,o[J>>2]=M,o[Q>>2]=T,o[x>>2]=0,L=0):(M=L,L=j),(M|0)<0&&(L=L-M|0,o[x>>2]=L,T=T-M|0,o[Q>>2]=T,o[J>>2]=0,M=0),H=L-T|0,j=M-T|0,(T|0)<0?(o[x>>2]=H,o[J>>2]=j,o[Q>>2]=0,L=H,T=0):j=M,M=(j|0)<(L|0)?j:L,M=(T|0)<(M|0)?T:M,!((M|0)<=0)&&(o[x>>2]=L-M,o[J>>2]=j-M,o[Q>>2]=T-M))}function Jn(x){x=x|0;var T=0,M=0,L=0,j=0,H=0,Q=0,J=0;j=o[x>>2]|0,Q=x+4|0,T=o[Q>>2]|0,J=x+8|0,M=o[J>>2]|0,L=T+j|0,j=M+j|0,o[x>>2]=j,o[Q>>2]=L,T=M+T|0,o[J>>2]=T,M=L-j|0,(j|0)<0?(T=T-j|0,o[Q>>2]=M,o[J>>2]=T,o[x>>2]=0,L=0):(M=L,L=j),(M|0)<0&&(L=L-M|0,o[x>>2]=L,T=T-M|0,o[J>>2]=T,o[Q>>2]=0,M=0),H=L-T|0,j=M-T|0,(T|0)<0?(o[x>>2]=H,o[Q>>2]=j,o[J>>2]=0,L=H,T=0):j=M,M=(j|0)<(L|0)?j:L,M=(T|0)<(M|0)?T:M,!((M|0)<=0)&&(o[x>>2]=L-M,o[Q>>2]=j-M,o[J>>2]=T-M)}function gl(x){x=x|0;var T=0,M=0,L=0,j=0,H=0,Q=0,J=0;T=o[x>>2]|0,Q=x+4|0,L=o[Q>>2]|0,J=x+8|0,M=o[J>>2]|0,j=L+T|0,o[x>>2]=j,L=M+L|0,o[Q>>2]=L,T=M+T|0,o[J>>2]=T,M=L-j|0,(j|0)<0?(T=T-j|0,o[Q>>2]=M,o[J>>2]=T,o[x>>2]=0,L=0):(M=L,L=j),(M|0)<0&&(L=L-M|0,o[x>>2]=L,T=T-M|0,o[J>>2]=T,o[Q>>2]=0,M=0),H=L-T|0,j=M-T|0,(T|0)<0?(o[x>>2]=H,o[Q>>2]=j,o[J>>2]=0,L=H,T=0):j=M,M=(j|0)<(L|0)?j:L,M=(T|0)<(M|0)?T:M,!((M|0)<=0)&&(o[x>>2]=L-M,o[Q>>2]=j-M,o[J>>2]=T-M)}function Zs(x){switch(x=x|0,x|0){case 1:{x=5;break}case 5:{x=4;break}case 4:{x=6;break}case 6:{x=2;break}case 2:{x=3;break}case 3:{x=1;break}}return x|0}function wa(x){switch(x=x|0,x|0){case 1:{x=3;break}case 3:{x=2;break}case 2:{x=6;break}case 6:{x=4;break}case 4:{x=5;break}case 5:{x=1;break}}return x|0}function Bl(x){x=x|0;var T=0,M=0,L=0,j=0,H=0,Q=0,J=0;T=o[x>>2]|0,Q=x+4|0,M=o[Q>>2]|0,J=x+8|0,L=o[J>>2]|0,j=M+(T<<1)|0,o[x>>2]=j,M=L+(M<<1)|0,o[Q>>2]=M,T=(L<<1)+T|0,o[J>>2]=T,L=M-j|0,(j|0)<0?(T=T-j|0,o[Q>>2]=L,o[J>>2]=T,o[x>>2]=0,M=L,L=0):L=j,(M|0)<0&&(L=L-M|0,o[x>>2]=L,T=T-M|0,o[J>>2]=T,o[Q>>2]=0,M=0),H=L-T|0,j=M-T|0,(T|0)<0?(o[x>>2]=H,o[Q>>2]=j,o[J>>2]=0,L=H,T=0):j=M,M=(j|0)<(L|0)?j:L,M=(T|0)<(M|0)?T:M,!((M|0)<=0)&&(o[x>>2]=L-M,o[Q>>2]=j-M,o[J>>2]=T-M)}function Ta(x){x=x|0;var T=0,M=0,L=0,j=0,H=0,Q=0,J=0;j=o[x>>2]|0,Q=x+4|0,T=o[Q>>2]|0,J=x+8|0,M=o[J>>2]|0,L=(T<<1)+j|0,j=M+(j<<1)|0,o[x>>2]=j,o[Q>>2]=L,T=(M<<1)+T|0,o[J>>2]=T,M=L-j|0,(j|0)<0?(T=T-j|0,o[Q>>2]=M,o[J>>2]=T,o[x>>2]=0,j=0):M=L,(M|0)<0&&(j=j-M|0,o[x>>2]=j,T=T-M|0,o[J>>2]=T,o[Q>>2]=0,M=0),H=j-T|0,L=M-T|0,(T|0)<0?(o[x>>2]=H,o[Q>>2]=L,o[J>>2]=0,j=H,T=0):L=M,M=(L|0)<(j|0)?L:j,M=(T|0)<(M|0)?T:M,!((M|0)<=0)&&(o[x>>2]=j-M,o[Q>>2]=L-M,o[J>>2]=T-M)}function nl(x,T){x=x|0,T=T|0;var M=0,L=0,j=0,H=0,Q=0,J=0;return Q=(o[x>>2]|0)-(o[T>>2]|0)|0,J=(Q|0)<0,L=(o[x+4>>2]|0)-(o[T+4>>2]|0)-(J?Q:0)|0,H=(L|0)<0,j=(J?0-Q|0:0)+(o[x+8>>2]|0)-(o[T+8>>2]|0)+(H?0-L|0:0)|0,x=(j|0)<0,T=x?0:j,M=(H?0:L)-(x?j:0)|0,j=(J?0:Q)-(H?L:0)-(x?j:0)|0,x=(M|0)<(j|0)?M:j,x=(T|0)<(x|0)?T:x,L=(x|0)>0,T=T-(L?x:0)|0,M=M-(L?x:0)|0,x=j-(L?x:0)|0,x=(x|0)>-1?x:0-x|0,M=(M|0)>-1?M:0-M|0,T=(T|0)>-1?T:0-T|0,T=(M|0)>(T|0)?M:T,((x|0)>(T|0)?x:T)|0}function Va(x,T){x=x|0,T=T|0;var M=0;M=o[x+8>>2]|0,o[T>>2]=(o[x>>2]|0)-M,o[T+4>>2]=(o[x+4>>2]|0)-M}function ic(x,T){x=x|0,T=T|0;var M=0,L=0,j=0,H=0,Q=0,J=0;L=o[x>>2]|0,o[T>>2]=L,x=o[x+4>>2]|0,Q=T+4|0,o[Q>>2]=x,J=T+8|0,o[J>>2]=0,M=x-L|0,(L|0)<0?(x=0-L|0,o[Q>>2]=M,o[J>>2]=x,o[T>>2]=0,L=0):(M=x,x=0),(M|0)<0&&(L=L-M|0,o[T>>2]=L,x=x-M|0,o[J>>2]=x,o[Q>>2]=0,M=0),H=L-x|0,j=M-x|0,(x|0)<0?(o[T>>2]=H,o[Q>>2]=j,o[J>>2]=0,M=j,j=H,x=0):j=L,L=(M|0)<(j|0)?M:j,L=(x|0)<(L|0)?x:L,!((L|0)<=0)&&(o[T>>2]=j-L,o[Q>>2]=M-L,o[J>>2]=x-L)}function mA(x){x=x|0;var T=0,M=0,L=0,j=0;T=x+8|0,j=o[T>>2]|0,M=j-(o[x>>2]|0)|0,o[x>>2]=M,L=x+4|0,x=(o[L>>2]|0)-j|0,o[L>>2]=x,o[T>>2]=0-(x+M)}function LA(x){x=x|0;var T=0,M=0,L=0,j=0,H=0,Q=0,J=0;M=o[x>>2]|0,T=0-M|0,o[x>>2]=T,Q=x+8|0,o[Q>>2]=0,J=x+4|0,L=o[J>>2]|0,j=L+M|0,(M|0)>0?(o[J>>2]=j,o[Q>>2]=M,o[x>>2]=0,T=0,L=j):M=0,(L|0)<0?(H=T-L|0,o[x>>2]=H,M=M-L|0,o[Q>>2]=M,o[J>>2]=0,j=H-M|0,T=0-M|0,(M|0)<0?(o[x>>2]=j,o[J>>2]=T,o[Q>>2]=0,L=T,M=0):(L=0,j=H)):j=T,T=(L|0)<(j|0)?L:j,T=(M|0)<(T|0)?M:T,!((T|0)<=0)&&(o[x>>2]=j-T,o[J>>2]=L-T,o[Q>>2]=M-T)}function ea(x,T,M){x=x|0,T=T|0,M=M|0;var L=0,j=0;L=st,st=st+16|0,j=L,fr(x,T,M,j),pA(j,M+4|0),st=L}function fr(x,T,M,L){x=x|0,T=T|0,M=M|0,L=L|0;var j=0,H=0,Q=0,J=0,ue=0;if(ue=st,st=st+32|0,H=ue,xA(x,H),o[M>>2]=0,j=+ks(15888,H),Q=+ks(15912,H),Q<j&&(o[M>>2]=1,j=Q),Q=+ks(15936,H),Q<j&&(o[M>>2]=2,j=Q),Q=+ks(15960,H),Q<j&&(o[M>>2]=3,j=Q),Q=+ks(15984,H),Q<j&&(o[M>>2]=4,j=Q),Q=+ks(16008,H),Q<j&&(o[M>>2]=5,j=Q),Q=+ks(16032,H),Q<j&&(o[M>>2]=6,j=Q),Q=+ks(16056,H),Q<j&&(o[M>>2]=7,j=Q),Q=+ks(16080,H),Q<j&&(o[M>>2]=8,j=Q),Q=+ks(16104,H),Q<j&&(o[M>>2]=9,j=Q),Q=+ks(16128,H),Q<j&&(o[M>>2]=10,j=Q),Q=+ks(16152,H),Q<j&&(o[M>>2]=11,j=Q),Q=+ks(16176,H),Q<j&&(o[M>>2]=12,j=Q),Q=+ks(16200,H),Q<j&&(o[M>>2]=13,j=Q),Q=+ks(16224,H),Q<j&&(o[M>>2]=14,j=Q),Q=+ks(16248,H),Q<j&&(o[M>>2]=15,j=Q),Q=+ks(16272,H),Q<j&&(o[M>>2]=16,j=Q),Q=+ks(16296,H),Q<j&&(o[M>>2]=17,j=Q),Q=+ks(16320,H),Q<j&&(o[M>>2]=18,j=Q),Q=+ks(16344,H),Q<j&&(o[M>>2]=19,j=Q),Q=+hn(+(1-j*.5)),Q<1e-16){o[L>>2]=0,o[L+4>>2]=0,o[L+8>>2]=0,o[L+12>>2]=0,st=ue;return}if(M=o[M>>2]|0,j=+oe[16368+(M*24|0)>>3],j=+Rl(j-+Rl(+Ur(15568+(M<<4)|0,x))),Un(T)|0?J=+Rl(j+-.3334731722518321):J=j,j=+Pi(+Q)/.381966011250105,(T|0)>0){H=0;do j=j*2.6457513110645907,H=H+1|0;while((H|0)!=(T|0))}Q=+gr(+J)*j,oe[L>>3]=Q,J=+yi(+J)*j,oe[L+8>>3]=J,st=ue}function ja(x,T,M,L,j){x=x|0,T=T|0,M=M|0,L=L|0,j=j|0;var H=0,Q=0;if(H=+lc(x),H<1e-16){T=15568+(T<<4)|0,o[j>>2]=o[T>>2],o[j+4>>2]=o[T+4>>2],o[j+8>>2]=o[T+8>>2],o[j+12>>2]=o[T+12>>2];return}if(Q=+Vs(+ +oe[x+8>>3],+ +oe[x>>3]),(M|0)>0){x=0;do H=H/2.6457513110645907,x=x+1|0;while((x|0)!=(M|0))}L?(H=H/3,M=(Un(M)|0)==0,H=+KA(+((M?H:H/2.6457513110645907)*.381966011250105))):(H=+KA(+(H*.381966011250105)),Un(M)|0&&(Q=+Rl(Q+.3334731722518321))),$n(15568+(T<<4)|0,+Rl(+oe[16368+(T*24|0)>>3]-Q),H,j)}function RA(x,T,M){x=x|0,T=T|0,M=M|0;var L=0,j=0;L=st,st=st+16|0,j=L,Wt(x+4|0,j),ja(j,o[x>>2]|0,T,0,M),st=L}function vo(x,T,M,L,j){x=x|0,T=T|0,M=M|0,L=L|0,j=j|0;var H=0,Q=0,J=0,ue=0,Ce=0,ze=0,_t=0,Xe=0,it=0,z=0,l=0,g=0,S=0,k=0,F=0,Z=0,u=0,h=0,d=0,y=0,b=0,I=0,R=0,N=0,W=0,K=0,le=0,de=0;if(K=st,st=st+272|0,H=K+256|0,k=K+240|0,R=K,N=K+224|0,W=K+208|0,F=K+176|0,Z=K+160|0,u=K+192|0,h=K+144|0,d=K+128|0,y=K+112|0,b=K+96|0,I=K+80|0,o[H>>2]=T,o[k>>2]=o[x>>2],o[k+4>>2]=o[x+4>>2],o[k+8>>2]=o[x+8>>2],o[k+12>>2]=o[x+12>>2],fo(k,H,R),o[j>>2]=0,k=L+M+((L|0)==5&1)|0,(k|0)<=(M|0)){st=K;return}ue=o[H>>2]|0,Ce=N+4|0,ze=F+4|0,_t=M+5|0,Xe=16848+(ue<<2)|0,it=16928+(ue<<2)|0,z=d+8|0,l=y+8|0,g=b+8|0,S=W+4|0,J=M;e:for(;;){Q=R+(((J|0)%5|0)<<4)|0,o[W>>2]=o[Q>>2],o[W+4>>2]=o[Q+4>>2],o[W+8>>2]=o[Q+8>>2],o[W+12>>2]=o[Q+12>>2];do;while((Ll(W,ue,0,1)|0)==2);if((J|0)>(M|0)&(Un(T)|0)!=0){if(o[F>>2]=o[W>>2],o[F+4>>2]=o[W+4>>2],o[F+8>>2]=o[W+8>>2],o[F+12>>2]=o[W+12>>2],Wt(Ce,Z),L=o[F>>2]|0,H=o[17008+(L*80|0)+(o[N>>2]<<2)>>2]|0,o[F>>2]=o[18608+(L*80|0)+(H*20|0)>>2],Q=o[18608+(L*80|0)+(H*20|0)+16>>2]|0,(Q|0)>0){x=0;do Jn(ze),x=x+1|0;while((x|0)<(Q|0))}switch(Q=18608+(L*80|0)+(H*20|0)+4|0,o[u>>2]=o[Q>>2],o[u+4>>2]=o[Q+4>>2],o[u+8>>2]=o[Q+8>>2],tn(u,(o[Xe>>2]|0)*3|0),Ui(ze,u,ze),Kn(ze),Wt(ze,h),le=+(o[it>>2]|0),oe[d>>3]=le*3,oe[z>>3]=0,de=le*-1.5,oe[y>>3]=de,oe[l>>3]=le*2.598076211353316,oe[b>>3]=de,oe[g>>3]=le*-2.598076211353316,o[17008+((o[F>>2]|0)*80|0)+(o[W>>2]<<2)>>2]|0){case 1:{x=y,L=d;break}case 3:{x=b,L=y;break}case 2:{x=d,L=b;break}default:{x=12;break e}}jA(Z,h,L,x,I),ja(I,o[F>>2]|0,ue,1,j+8+(o[j>>2]<<4)|0),o[j>>2]=(o[j>>2]|0)+1}if((J|0)<(_t|0)&&(Wt(S,F),ja(F,o[W>>2]|0,ue,1,j+8+(o[j>>2]<<4)|0),o[j>>2]=(o[j>>2]|0)+1),o[N>>2]=o[W>>2],o[N+4>>2]=o[W+4>>2],o[N+8>>2]=o[W+8>>2],o[N+12>>2]=o[W+12>>2],J=J+1|0,(J|0)>=(k|0)){x=3;break}}if((x|0)==3){st=K;return}else(x|0)==12&&Ci(22474,22521,581,22531)}function fo(x,T,M){x=x|0,T=T|0,M=M|0;var L=0,j=0,H=0,Q=0,J=0,ue=0;ue=st,st=st+128|0,L=ue+64|0,j=ue,H=L,Q=20208,J=H+60|0;do o[H>>2]=o[Q>>2],H=H+4|0,Q=Q+4|0;while((H|0)<(J|0));H=j,Q=20272,J=H+60|0;do o[H>>2]=o[Q>>2],H=H+4|0,Q=Q+4|0;while((H|0)<(J|0));J=(Un(o[T>>2]|0)|0)==0,L=J?L:j,j=x+4|0,Bl(j),Ta(j),Un(o[T>>2]|0)|0&&(ca(j),o[T>>2]=(o[T>>2]|0)+1),o[M>>2]=o[x>>2],T=M+4|0,Ui(j,L,T),Kn(T),o[M+16>>2]=o[x>>2],T=M+20|0,Ui(j,L+12|0,T),Kn(T),o[M+32>>2]=o[x>>2],T=M+36|0,Ui(j,L+24|0,T),Kn(T),o[M+48>>2]=o[x>>2],T=M+52|0,Ui(j,L+36|0,T),Kn(T),o[M+64>>2]=o[x>>2],M=M+68|0,Ui(j,L+48|0,M),Kn(M),st=ue}function Ll(x,T,M,L){x=x|0,T=T|0,M=M|0,L=L|0;var j=0,H=0,Q=0,J=0,ue=0,Ce=0,ze=0,_t=0,Xe=0,it=0,z=0;if(z=st,st=st+32|0,Xe=z+12|0,J=z,it=x+4|0,_t=o[16928+(T<<2)>>2]|0,ze=(L|0)!=0,_t=ze?_t*3|0:_t,j=o[it>>2]|0,Ce=x+8|0,Q=o[Ce>>2]|0,ze){if(H=x+12|0,L=o[H>>2]|0,j=Q+j+L|0,(j|0)==(_t|0))return it=1,st=z,it|0;ue=H}else ue=x+12|0,L=o[ue>>2]|0,j=Q+j+L|0;if((j|0)<=(_t|0))return it=0,st=z,it|0;do if((L|0)>0){if(L=o[x>>2]|0,(Q|0)>0){H=18608+(L*80|0)+60|0,L=x;break}L=18608+(L*80|0)+40|0,M?(eA(Xe,_t,0,0),sr(it,Xe,J),gl(J),Ui(J,Xe,it),H=L,L=x):(H=L,L=x)}else H=18608+((o[x>>2]|0)*80|0)+20|0,L=x;while(!1);if(o[L>>2]=o[H>>2],j=H+16|0,(o[j>>2]|0)>0){L=0;do Jn(it),L=L+1|0;while((L|0)<(o[j>>2]|0))}return x=H+4|0,o[Xe>>2]=o[x>>2],o[Xe+4>>2]=o[x+4>>2],o[Xe+8>>2]=o[x+8>>2],T=o[16848+(T<<2)>>2]|0,tn(Xe,ze?T*3|0:T),Ui(it,Xe,it),Kn(it),ze?L=((o[Ce>>2]|0)+(o[it>>2]|0)+(o[ue>>2]|0)|0)==(_t|0)?1:2:L=2,it=L,st=z,it|0}function tA(x,T){x=x|0,T=T|0;var M=0;do M=Ll(x,T,0,1)|0;while((M|0)==2);return M|0}function ms(x,T,M,L,j){x=x|0,T=T|0,M=M|0,L=L|0,j=j|0;var H=0,Q=0,J=0,ue=0,Ce=0,ze=0,_t=0,Xe=0,it=0,z=0,l=0,g=0,S=0,k=0,F=0,Z=0,u=0,h=0,d=0,y=0,b=0,I=0,R=0;if(b=st,st=st+240|0,H=b+224|0,u=b+208|0,h=b,d=b+192|0,y=b+176|0,g=b+160|0,S=b+144|0,k=b+128|0,F=b+112|0,Z=b+96|0,o[H>>2]=T,o[u>>2]=o[x>>2],o[u+4>>2]=o[x+4>>2],o[u+8>>2]=o[x+8>>2],o[u+12>>2]=o[x+12>>2],Ea(u,H,h),o[j>>2]=0,l=L+M+((L|0)==6&1)|0,(l|0)<=(M|0)){st=b;return}ue=o[H>>2]|0,Ce=M+6|0,ze=16928+(ue<<2)|0,_t=S+8|0,Xe=k+8|0,it=F+8|0,z=d+4|0,Q=0,J=M,L=-1;e:for(;;){if(H=(J|0)%6|0,x=h+(H<<4)|0,o[d>>2]=o[x>>2],o[d+4>>2]=o[x+4>>2],o[d+8>>2]=o[x+8>>2],o[d+12>>2]=o[x+12>>2],x=Q,Q=Ll(d,ue,0,1)|0,(J|0)>(M|0)&(Un(T)|0)!=0&&(x|0)!=1&&(o[d>>2]|0)!=(L|0)){switch(Wt(h+(((H+5|0)%6|0)<<4)+4|0,y),Wt(h+(H<<4)+4|0,g),I=+(o[ze>>2]|0),oe[S>>3]=I*3,oe[_t>>3]=0,R=I*-1.5,oe[k>>3]=R,oe[Xe>>3]=I*2.598076211353316,oe[F>>3]=R,oe[it>>3]=I*-2.598076211353316,H=o[u>>2]|0,o[17008+(H*80|0)+(((L|0)==(H|0)?o[d>>2]|0:L)<<2)>>2]|0){case 1:{x=k,L=S;break}case 3:{x=F,L=k;break}case 2:{x=S,L=F;break}default:{x=8;break e}}jA(y,g,L,x,Z),!(Ac(y,Z)|0)&&!(Ac(g,Z)|0)&&(ja(Z,o[u>>2]|0,ue,1,j+8+(o[j>>2]<<4)|0),o[j>>2]=(o[j>>2]|0)+1)}if((J|0)<(Ce|0)&&(Wt(z,y),ja(y,o[d>>2]|0,ue,1,j+8+(o[j>>2]<<4)|0),o[j>>2]=(o[j>>2]|0)+1),J=J+1|0,(J|0)>=(l|0)){x=3;break}else L=o[d>>2]|0}if((x|0)==3){st=b;return}else(x|0)==8&&Ci(22557,22521,746,22602)}function Ea(x,T,M){x=x|0,T=T|0,M=M|0;var L=0,j=0,H=0,Q=0,J=0,ue=0;ue=st,st=st+160|0,L=ue+80|0,j=ue,H=L,Q=20336,J=H+72|0;do o[H>>2]=o[Q>>2],H=H+4|0,Q=Q+4|0;while((H|0)<(J|0));H=j,Q=20416,J=H+72|0;do o[H>>2]=o[Q>>2],H=H+4|0,Q=Q+4|0;while((H|0)<(J|0));J=(Un(o[T>>2]|0)|0)==0,L=J?L:j,j=x+4|0,Bl(j),Ta(j),Un(o[T>>2]|0)|0&&(ca(j),o[T>>2]=(o[T>>2]|0)+1),o[M>>2]=o[x>>2],T=M+4|0,Ui(j,L,T),Kn(T),o[M+16>>2]=o[x>>2],T=M+20|0,Ui(j,L+12|0,T),Kn(T),o[M+32>>2]=o[x>>2],T=M+36|0,Ui(j,L+24|0,T),Kn(T),o[M+48>>2]=o[x>>2],T=M+52|0,Ui(j,L+36|0,T),Kn(T),o[M+64>>2]=o[x>>2],T=M+68|0,Ui(j,L+48|0,T),Kn(T),o[M+80>>2]=o[x>>2],M=M+84|0,Ui(j,L+60|0,M),Kn(M),st=ue}function Rl(x){x=+x;var T=0;return T=x<0?x+6.283185307179586:x,+(x>=6.283185307179586?T+-6.283185307179586:T)}function qs(x,T){return x=x|0,T=T|0,+mi(+(+oe[x>>3]-+oe[T>>3]))<17453292519943298e-27?(T=+mi(+(+oe[x+8>>3]-+oe[T+8>>3]))<17453292519943298e-27,T|0):(T=0,T|0)}function fs(x,T){x=x|0,T=T|0;var M=0,L=0,j=0,H=0;return j=+oe[T>>3],L=+oe[x>>3],H=+yi(+((j-L)*.5)),M=+yi(+((+oe[T+8>>3]-+oe[x+8>>3])*.5)),M=H*H+M*(+gr(+j)*+gr(+L)*M),+(+Vs(+ +si(+M),+ +si(+(1-M)))*2)}function Fl(x,T){x=x|0,T=T|0;var M=0,L=0,j=0,H=0;return j=+oe[T>>3],L=+oe[x>>3],H=+yi(+((j-L)*.5)),M=+yi(+((+oe[T+8>>3]-+oe[x+8>>3])*.5)),M=H*H+M*(+gr(+j)*+gr(+L)*M),+(+Vs(+ +si(+M),+ +si(+(1-M)))*2*6371.007180918475)}function FA(x,T){x=x|0,T=T|0;var M=0,L=0,j=0,H=0;return j=+oe[T>>3],L=+oe[x>>3],H=+yi(+((j-L)*.5)),M=+yi(+((+oe[T+8>>3]-+oe[x+8>>3])*.5)),M=H*H+M*(+gr(+j)*+gr(+L)*M),+(+Vs(+ +si(+M),+ +si(+(1-M)))*2*6371.007180918475*1e3)}function Ur(x,T){x=x|0,T=T|0;var M=0,L=0,j=0,H=0,Q=0;return H=+oe[T>>3],L=+gr(+H),j=+oe[T+8>>3]-+oe[x+8>>3],Q=L*+yi(+j),M=+oe[x>>3],+ +Vs(+Q,+(+yi(+H)*+gr(+M)-+gr(+j)*(L*+yi(+M))))}function $n(x,T,M,L){x=x|0,T=+T,M=+M,L=L|0;var j=0,H=0,Q=0,J=0;if(M<1e-16){o[L>>2]=o[x>>2],o[L+4>>2]=o[x+4>>2],o[L+8>>2]=o[x+8>>2],o[L+12>>2]=o[x+12>>2];return}H=T<0?T+6.283185307179586:T,H=T>=6.283185307179586?H+-6.283185307179586:H;do if(H<1e-16)T=+oe[x>>3]+M,oe[L>>3]=T,j=L;else{if(j=+mi(+(H+-3.141592653589793))<1e-16,T=+oe[x>>3],j){T=T-M,oe[L>>3]=T,j=L;break}if(Q=+gr(+M),M=+yi(+M),T=Q*+yi(+T)+ +gr(+H)*(M*+gr(+T)),T=T>1?1:T,T=+eo(+(T<-1?-1:T)),oe[L>>3]=T,+mi(+(T+-1.5707963267948966))<1e-16){oe[L>>3]=1.5707963267948966,oe[L+8>>3]=0;return}if(+mi(+(T+1.5707963267948966))<1e-16){oe[L>>3]=-1.5707963267948966,oe[L+8>>3]=0;return}if(J=+gr(+T),H=M*+yi(+H)/J,M=+oe[x>>3],T=(Q-+yi(+T)*+yi(+M))/+gr(+M)/J,Q=H>1?1:H,T=T>1?1:T,T=+oe[x+8>>3]+ +Vs(+(Q<-1?-1:Q),+(T<-1?-1:T)),T>3.141592653589793)do T=T+-6.283185307179586;while(T>3.141592653589793);if(T<-3.141592653589793)do T=T+6.283185307179586;while(T<-3.141592653589793);oe[L+8>>3]=T;return}while(!1);if(+mi(+(T+-1.5707963267948966))<1e-16){oe[j>>3]=1.5707963267948966,oe[L+8>>3]=0;return}if(+mi(+(T+1.5707963267948966))<1e-16){oe[j>>3]=-1.5707963267948966,oe[L+8>>3]=0;return}if(T=+oe[x+8>>3],T>3.141592653589793)do T=T+-6.283185307179586;while(T>3.141592653589793);if(T<-3.141592653589793)do T=T+6.283185307179586;while(T<-3.141592653589793);oe[L+8>>3]=T}function iA(x){return x=x|0,+ +oe[20496+(x<<3)>>3]}function Vi(x){return x=x|0,+ +oe[20624+(x<<3)>>3]}function Ma(x){return x=x|0,+ +oe[20752+(x<<3)>>3]}function os(x){return x=x|0,+ +oe[20880+(x<<3)>>3]}function Sn(x){x=x|0;var T=0;return T=21008+(x<<3)|0,x=o[T>>2]|0,kr(o[T+4>>2]|0),x|0}function Ga(x,T,M){x=x|0,T=T|0,M=M|0;var L=0,j=0,H=0,Q=0,J=0,ue=0,Ce=0,ze=0,_t=0,Xe=0;return Xe=+oe[T>>3],ze=+oe[x>>3],ue=+yi(+((Xe-ze)*.5)),H=+oe[T+8>>3],Ce=+oe[x+8>>3],Q=+yi(+((H-Ce)*.5)),J=+gr(+ze),_t=+gr(+Xe),Q=ue*ue+Q*(_t*J*Q),Q=+Vs(+ +si(+Q),+ +si(+(1-Q)))*2,ue=+oe[M>>3],Xe=+yi(+((ue-Xe)*.5)),L=+oe[M+8>>3],H=+yi(+((L-H)*.5)),j=+gr(+ue),H=Xe*Xe+H*(_t*j*H),H=+Vs(+ +si(+H),+ +si(+(1-H)))*2,ue=+yi(+((ze-ue)*.5)),L=+yi(+((Ce-L)*.5)),L=ue*ue+L*(J*j*L),L=+Vs(+ +si(+L),+ +si(+(1-L)))*2,j=(Q+H+L)*.5,+(+KA(+ +si(+(+Pi(+(j*.5))*+Pi(+((j-Q)*.5))*+Pi(+((j-H)*.5))*+Pi(+((j-L)*.5)))))*4)}function zc(x,T){x=x|0,T=T|0;var M=0,L=0,j=0,H=0,Q=0;if(H=st,st=st+192|0,L=H+168|0,j=H,wo(x,T,L),Ia(x,T,j),T=o[j>>2]|0,(T|0)<=0)return M=0,st=H,+M;if(M=+Ga(j+8|0,j+8+(((T|0)!=1&1)<<4)|0,L)+0,(T|0)==1)return st=H,+M;x=1;do Q=x,x=x+1|0,M=M+ +Ga(j+8+(Q<<4)|0,j+8+(((x|0)%(T|0)|0)<<4)|0,L);while((x|0)<(T|0));return st=H,+M}function sl(x,T){x=x|0,T=T|0;var M=0,L=0,j=0,H=0,Q=0;if(H=st,st=st+192|0,L=H+168|0,j=H,wo(x,T,L),Ia(x,T,j),T=o[j>>2]|0,(T|0)>0){if(M=+Ga(j+8|0,j+8+(((T|0)!=1&1)<<4)|0,L)+0,(T|0)!=1){x=1;do Q=x,x=x+1|0,M=M+ +Ga(j+8+(Q<<4)|0,j+8+(((x|0)%(T|0)|0)<<4)|0,L);while((x|0)<(T|0))}}else M=0;return st=H,+(M*6371.007180918475*6371.007180918475)}function _A(x,T){x=x|0,T=T|0;var M=0,L=0,j=0,H=0,Q=0;if(H=st,st=st+192|0,L=H+168|0,j=H,wo(x,T,L),Ia(x,T,j),T=o[j>>2]|0,(T|0)>0){if(M=+Ga(j+8|0,j+8+(((T|0)!=1&1)<<4)|0,L)+0,(T|0)!=1){x=1;do Q=x,x=x+1|0,M=M+ +Ga(j+8+(Q<<4)|0,j+8+(((x|0)%(T|0)|0)<<4)|0,L);while((x|0)<(T|0))}}else M=0;return st=H,+(M*6371.007180918475*6371.007180918475*1e3*1e3)}function No(x,T){x=x|0,T=T|0;var M=0,L=0,j=0,H=0,Q=0,J=0,ue=0,Ce=0;if(Q=st,st=st+176|0,H=Q,cl(x,T,H),x=o[H>>2]|0,(x|0)<=1)return j=0,st=Q,+j;T=x+-1|0,x=0,M=0,L=+oe[H+8>>3],j=+oe[H+16>>3];do x=x+1|0,ue=L,L=+oe[H+8+(x<<4)>>3],Ce=+yi(+((L-ue)*.5)),J=j,j=+oe[H+8+(x<<4)+8>>3],J=+yi(+((j-J)*.5)),J=Ce*Ce+J*(+gr(+L)*+gr(+ue)*J),M=M+ +Vs(+ +si(+J),+ +si(+(1-J)))*2;while((x|0)<(T|0));return st=Q,+M}function yl(x,T){x=x|0,T=T|0;var M=0,L=0,j=0,H=0,Q=0,J=0,ue=0,Ce=0;if(Q=st,st=st+176|0,H=Q,cl(x,T,H),x=o[H>>2]|0,(x|0)<=1)return j=0,st=Q,+j;T=x+-1|0,x=0,M=0,L=+oe[H+8>>3],j=+oe[H+16>>3];do x=x+1|0,ue=L,L=+oe[H+8+(x<<4)>>3],Ce=+yi(+((L-ue)*.5)),J=j,j=+oe[H+8+(x<<4)+8>>3],J=+yi(+((j-J)*.5)),J=Ce*Ce+J*(+gr(+ue)*+gr(+L)*J),M=M+ +Vs(+ +si(+J),+ +si(+(1-J)))*2;while((x|0)!=(T|0));return Ce=M*6371.007180918475,st=Q,+Ce}function Nn(x,T){x=x|0,T=T|0;var M=0,L=0,j=0,H=0,Q=0,J=0,ue=0,Ce=0;if(Q=st,st=st+176|0,H=Q,cl(x,T,H),x=o[H>>2]|0,(x|0)<=1)return j=0,st=Q,+j;T=x+-1|0,x=0,M=0,L=+oe[H+8>>3],j=+oe[H+16>>3];do x=x+1|0,ue=L,L=+oe[H+8+(x<<4)>>3],Ce=+yi(+((L-ue)*.5)),J=j,j=+oe[H+8+(x<<4)+8>>3],J=+yi(+((j-J)*.5)),J=Ce*Ce+J*(+gr(+ue)*+gr(+L)*J),M=M+ +Vs(+ +si(+J),+ +si(+(1-J)))*2;while((x|0)!=(T|0));return Ce=M*6371.007180918475*1e3,st=Q,+Ce}function Bc(x,T){return x=x|0,T=T|0,T=Nt(x|0,T|0,52)|0,gt()|0,T&15|0}function gA(x,T){return x=x|0,T=T|0,T=Nt(x|0,T|0,45)|0,gt()|0,T&127|0}function ol(x,T){x=x|0,T=T|0;var M=0,L=0,j=0,H=0,Q=0,J=0;if(!(!0&(T&-16777216|0)==134217728)||(Q=Nt(x|0,T|0,45)|0,gt()|0,Q=Q&127,Q>>>0>121))return T=0,T|0;M=Nt(x|0,T|0,52)|0,gt()|0,M=M&15;do if(M|0){for(j=1,L=0;;){if(H=Nt(x|0,T|0,(15-j|0)*3|0)|0,gt()|0,H=H&7,(H|0)!=0&(L^1))if((H|0)==1&(ns(Q)|0)!=0){J=0,L=13;break}else L=1;if((H|0)==7){J=0,L=13;break}if(j>>>0<M>>>0)j=j+1|0;else{L=9;break}}if((L|0)==9){if((M|0)==15)J=1;else break;return J|0}else if((L|0)==13)return J|0}while(!1);for(;;){if(J=Nt(x|0,T|0,(14-M|0)*3|0)|0,gt()|0,!((J&7|0)==7&!0)){J=0,L=13;break}if(M>>>0<14)M=M+1|0;else{J=1,L=13;break}}return(L|0)==13?J|0:0}function Za(x,T,M){x=x|0,T=T|0,M=M|0;var L=0,j=0;if(L=Nt(x|0,T|0,52)|0,gt()|0,L=L&15,(L|0)>=(M|0)){if((L|0)!=(M|0))if(M>>>0<=15){if(j=Kt(M|0,0,52)|0,x=j|x,T=gt()|0|T&-15728641,(L|0)>(M|0))do j=Kt(7,0,(14-M|0)*3|0)|0,M=M+1|0,x=j|x,T=gt()|0|T;while((M|0)<(L|0))}else T=0,x=0}else T=0,x=0;return kr(T|0),x|0}function Cu(x,T,M){return x=x|0,T=T|0,M=M|0,x=Nt(x|0,T|0,52)|0,gt()|0,x=x&15,(M|0)<16&(x|0)<=(M|0)?(M=hl(7,M-x|0)|0,M|0):(M=0,M|0)}function Os(x,T,M,L){x=x|0,T=T|0,M=M|0,L=L|0;var j=0,H=0,Q=0,J=0,ue=0,Ce=0,ze=0;if(Q=Nt(x|0,T|0,52)|0,gt()|0,Q=Q&15,!!((M|0)<16&(Q|0)<=(M|0))){if((Q|0)==(M|0)){M=L,o[M>>2]=x,o[M+4>>2]=T;return}if(ue=hl(7,M-Q|0)|0,Ce=(ue|0)/7|0,J=Nt(x|0,T|0,45)|0,gt()|0,!(ns(J&127)|0))H=0;else{e:do if(!Q)j=0;else for(H=1;;){if(j=Nt(x|0,T|0,(15-H|0)*3|0)|0,gt()|0,j=j&7,j|0)break e;if(H>>>0<Q>>>0)H=H+1|0;else{j=0;break}}while(!1);H=(j|0)==0}if(ze=Kt(Q+1|0,0,52)|0,j=gt()|0|T&-15728641,J=(14-Q|0)*3|0,T=Kt(7,0,J|0)|0,T=(ze|x)&~T,Q=j&~(gt()|0),Os(T,Q,M,L),j=L+(Ce<<3)|0,!H){ze=Kt(1,0,J|0)|0,Os(ze|T,gt()|0|Q,M,j),ze=j+(Ce<<3)|0,ue=Kt(2,0,J|0)|0,Os(ue|T,gt()|0|Q,M,ze),ze=ze+(Ce<<3)|0,ue=Kt(3,0,J|0)|0,Os(ue|T,gt()|0|Q,M,ze),ze=ze+(Ce<<3)|0,ue=Kt(4,0,J|0)|0,Os(ue|T,gt()|0|Q,M,ze),ze=ze+(Ce<<3)|0,ue=Kt(5,0,J|0)|0,Os(ue|T,gt()|0|Q,M,ze),ue=Kt(6,0,J|0)|0,Os(ue|T,gt()|0|Q,M,ze+(Ce<<3)|0);return}H=j+(Ce<<3)|0,(ue|0)>6&&(ue=j+8|0,ze=(H>>>0>ue>>>0?H:ue)+-1+(0-j)|0,$r(j|0,0,ze+8&-8|0)|0,j=ue+(ze>>>3<<3)|0),ze=Kt(2,0,J|0)|0,Os(ze|T,gt()|0|Q,M,j),ze=j+(Ce<<3)|0,ue=Kt(3,0,J|0)|0,Os(ue|T,gt()|0|Q,M,ze),ze=ze+(Ce<<3)|0,ue=Kt(4,0,J|0)|0,Os(ue|T,gt()|0|Q,M,ze),ze=ze+(Ce<<3)|0,ue=Kt(5,0,J|0)|0,Os(ue|T,gt()|0|Q,M,ze),ue=Kt(6,0,J|0)|0,Os(ue|T,gt()|0|Q,M,ze+(Ce<<3)|0)}}function Qs(x,T){x=x|0,T=T|0;var M=0,L=0,j=0;if(j=Nt(x|0,T|0,45)|0,gt()|0,!(ns(j&127)|0))return j=0,j|0;j=Nt(x|0,T|0,52)|0,gt()|0,j=j&15;e:do if(!j)M=0;else for(L=1;;){if(M=Nt(x|0,T|0,(15-L|0)*3|0)|0,gt()|0,M=M&7,M|0)break e;if(L>>>0<j>>>0)L=L+1|0;else{M=0;break}}while(!1);return j=(M|0)==0&1,j|0}function po(x,T,M){x=x|0,T=T|0,M=M|0;var L=0,j=0;if(L=Nt(x|0,T|0,52)|0,gt()|0,L=L&15,(M|0)<16&(L|0)<=(M|0)){if((L|0)!=(M|0)&&(j=Kt(M|0,0,52)|0,x=j|x,T=gt()|0|T&-15728641,(L|0)<(M|0)))do j=Kt(7,0,(14-L|0)*3|0)|0,L=L+1|0,x=x&~j,T=T&~(gt()|0);while((L|0)<(M|0))}else T=0,x=0;return kr(T|0),x|0}function ua(x,T,M){x=x|0,T=T|0,M=M|0;var L=0,j=0,H=0,Q=0,J=0,ue=0,Ce=0,ze=0,_t=0,Xe=0,it=0,z=0,l=0,g=0,S=0,k=0,F=0,Z=0,u=0,h=0,d=0,y=0;if(!M)return d=0,d|0;if(j=x,L=o[j>>2]|0,j=o[j+4>>2]|0,!0&(j&15728640|0)==0){if((M|0)<=0||(d=T,o[d>>2]=L,o[d+4>>2]=j,(M|0)==1))return d=0,d|0;L=1;do u=x+(L<<3)|0,h=o[u+4>>2]|0,d=T+(L<<3)|0,o[d>>2]=o[u>>2],o[d+4>>2]=h,L=L+1|0;while((L|0)!=(M|0));return L=0,L|0}if(u=M<<3,h=Eo(u)|0,!h)return d=-3,d|0;if(Ul(h|0,x|0,u|0)|0,Z=ra(M,8)|0,!Z)return pr(h),d=-3,d|0;L=M;e:for(;;){Q=h,ze=o[Q>>2]|0,Q=o[Q+4>>2]|0,k=Nt(ze|0,Q|0,52)|0,gt()|0,k=k&15,F=k+-1|0,S=(L|0)>0;t:do if(S){if(g=((L|0)<0)<<31>>31,z=Kt(F|0,0,52)|0,l=gt()|0,F>>>0>15)for(j=0,x=ze,M=Q;;){if(!((x|0)==0&(M|0)==0)){if(H=Nt(x|0,M|0,52)|0,gt()|0,H=H&15,J=(H|0)<(F|0),H=(H|0)==(F|0),Ce=J?0:H?x:0,x=J?0:H?M:0,M=Da(Ce|0,x|0,L|0,g|0)|0,gt()|0,H=Z+(M<<3)|0,J=H,ue=o[J>>2]|0,J=o[J+4>>2]|0,(ue|0)==0&(J|0)==0)M=Ce;else for(z=0,it=M,Xe=J,M=Ce;;){if((z|0)>(L|0)){d=41;break e}if((ue|0)==(M|0)&(Xe&-117440513|0)==(x|0)){Ce=Nt(ue|0,Xe|0,56)|0,gt()|0,Ce=Ce&7,_t=Ce+1|0,l=Nt(ue|0,Xe|0,45)|0,gt()|0;i:do if(!(ns(l&127)|0))J=7;else{if(ue=Nt(ue|0,Xe|0,52)|0,gt()|0,ue=ue&15,!ue){J=6;break}for(J=1;;){if(l=Kt(7,0,(15-J|0)*3|0)|0,!((l&M|0)==0&((gt()|0)&x|0)==0)){J=7;break i}if(J>>>0<ue>>>0)J=J+1|0;else{J=6;break}}}while(!1);if((Ce+2|0)>>>0>J>>>0){d=51;break e}l=Kt(_t|0,0,56)|0,x=gt()|0|x&-117440513,J=H,o[J>>2]=0,o[J+4>>2]=0,J=it,M=l|M}else J=(it+1|0)%(L|0)|0;if(H=Z+(J<<3)|0,Xe=H,ue=o[Xe>>2]|0,Xe=o[Xe+4>>2]|0,(ue|0)==0&(Xe|0)==0)break;z=z+1|0,it=J}l=H,o[l>>2]=M,o[l+4>>2]=x}if(j=j+1|0,(j|0)>=(L|0))break t;M=h+(j<<3)|0,x=o[M>>2]|0,M=o[M+4>>2]|0}for(j=0,x=ze,M=Q;;){if(!((x|0)==0&(M|0)==0)){if(J=Nt(x|0,M|0,52)|0,gt()|0,J=J&15,(J|0)>=(F|0)){if((J|0)!=(F|0)&&(x=x|z,M=M&-15728641|l,J>>>0>=k>>>0)){H=F;do it=Kt(7,0,(14-H|0)*3|0)|0,H=H+1|0,x=it|x,M=gt()|0|M;while(H>>>0<J>>>0)}}else x=0,M=0;if(J=Da(x|0,M|0,L|0,g|0)|0,gt()|0,H=Z+(J<<3)|0,ue=H,Ce=o[ue>>2]|0,ue=o[ue+4>>2]|0,!((Ce|0)==0&(ue|0)==0))for(it=0;;){if((it|0)>(L|0)){d=41;break e}if((Ce|0)==(x|0)&(ue&-117440513|0)==(M|0)){_t=Nt(Ce|0,ue|0,56)|0,gt()|0,_t=_t&7,Xe=_t+1|0,y=Nt(Ce|0,ue|0,45)|0,gt()|0;i:do if(!(ns(y&127)|0))ue=7;else{if(Ce=Nt(Ce|0,ue|0,52)|0,gt()|0,Ce=Ce&15,!Ce){ue=6;break}for(ue=1;;){if(y=Kt(7,0,(15-ue|0)*3|0)|0,!((y&x|0)==0&((gt()|0)&M|0)==0)){ue=7;break i}if(ue>>>0<Ce>>>0)ue=ue+1|0;else{ue=6;break}}}while(!1);if((_t+2|0)>>>0>ue>>>0){d=51;break e}y=Kt(Xe|0,0,56)|0,M=gt()|0|M&-117440513,Xe=H,o[Xe>>2]=0,o[Xe+4>>2]=0,x=y|x}else J=(J+1|0)%(L|0)|0;if(H=Z+(J<<3)|0,ue=H,Ce=o[ue>>2]|0,ue=o[ue+4>>2]|0,(Ce|0)==0&(ue|0)==0)break;it=it+1|0}y=H,o[y>>2]=x,o[y+4>>2]=M}if(j=j+1|0,(j|0)>=(L|0))break t;M=h+(j<<3)|0,x=o[M>>2]|0,M=o[M+4>>2]|0}}while(!1);if((L+5|0)>>>0<11){d=99;break}if(l=ra((L|0)/6|0,8)|0,!l){d=58;break}t:do if(S){it=0,Xe=0;do{if(J=Z+(it<<3)|0,x=J,j=o[x>>2]|0,x=o[x+4>>2]|0,!((j|0)==0&(x|0)==0)){ue=Nt(j|0,x|0,56)|0,gt()|0,ue=ue&7,M=ue+1|0,Ce=x&-117440513,y=Nt(j|0,x|0,45)|0,gt()|0;i:do if(ns(y&127)|0){if(_t=Nt(j|0,x|0,52)|0,gt()|0,_t=_t&15,_t|0)for(H=1;;){if(y=Kt(7,0,(15-H|0)*3|0)|0,!((j&y|0)==0&(Ce&(gt()|0)|0)==0))break i;if(H>>>0<_t>>>0)H=H+1|0;else break}x=Kt(M|0,0,56)|0,j=x|j,x=gt()|0|Ce,M=J,o[M>>2]=j,o[M+4>>2]=x,M=ue+2|0}while(!1);(M|0)==7&&(y=l+(Xe<<3)|0,o[y>>2]=j,o[y+4>>2]=x&-117440513,Xe=Xe+1|0)}it=it+1|0}while((it|0)!=(L|0));if(S){if(z=((L|0)<0)<<31>>31,_t=Kt(F|0,0,52)|0,it=gt()|0,F>>>0>15)for(x=0,j=0;;){do if(!((ze|0)==0&(Q|0)==0)){for(ue=Nt(ze|0,Q|0,52)|0,gt()|0,ue=ue&15,H=(ue|0)<(F|0),ue=(ue|0)==(F|0),J=H?0:ue?ze:0,ue=H?0:ue?Q:0,H=Da(J|0,ue|0,L|0,z|0)|0,gt()|0,M=0;;){if((M|0)>(L|0)){d=98;break e}if(y=Z+(H<<3)|0,Ce=o[y+4>>2]|0,(Ce&-117440513|0)==(ue|0)&&(o[y>>2]|0)==(J|0)){d=70;break}if(H=(H+1|0)%(L|0)|0,y=Z+(H<<3)|0,(o[y>>2]|0)==(J|0)&&(o[y+4>>2]|0)==(ue|0))break;M=M+1|0}if((d|0)==70&&(d=0,!0&(Ce&117440512|0)==100663296))break;y=T+(j<<3)|0,o[y>>2]=ze,o[y+4>>2]=Q,j=j+1|0}while(!1);if(x=x+1|0,(x|0)>=(L|0)){L=Xe;break t}Q=h+(x<<3)|0,ze=o[Q>>2]|0,Q=o[Q+4>>2]|0}for(x=0,j=0;;){do if(!((ze|0)==0&(Q|0)==0)){if(ue=Nt(ze|0,Q|0,52)|0,gt()|0,ue=ue&15,(ue|0)>=(F|0))if((ue|0)!=(F|0))if(M=ze|_t,H=Q&-15728641|it,ue>>>0<k>>>0)ue=H;else{J=F;do y=Kt(7,0,(14-J|0)*3|0)|0,J=J+1|0,M=y|M,H=gt()|0|H;while(J>>>0<ue>>>0);ue=H}else M=ze,ue=Q;else M=0,ue=0;for(J=Da(M|0,ue|0,L|0,z|0)|0,gt()|0,H=0;;){if((H|0)>(L|0)){d=98;break e}if(y=Z+(J<<3)|0,Ce=o[y+4>>2]|0,(Ce&-117440513|0)==(ue|0)&&(o[y>>2]|0)==(M|0)){d=93;break}if(J=(J+1|0)%(L|0)|0,y=Z+(J<<3)|0,(o[y>>2]|0)==(M|0)&&(o[y+4>>2]|0)==(ue|0))break;H=H+1|0}if((d|0)==93&&(d=0,!0&(Ce&117440512|0)==100663296))break;y=T+(j<<3)|0,o[y>>2]=ze,o[y+4>>2]=Q,j=j+1|0}while(!1);if(x=x+1|0,(x|0)>=(L|0)){L=Xe;break t}Q=h+(x<<3)|0,ze=o[Q>>2]|0,Q=o[Q+4>>2]|0}}else j=0,L=Xe}else j=0,L=0;while(!1);if($r(Z|0,0,u|0)|0,Ul(h|0,l|0,L<<3|0)|0,pr(l),L)T=T+(j<<3)|0;else break}return(d|0)==41?(pr(h),pr(Z),y=-1,y|0):(d|0)==51?(pr(h),pr(Z),y=-2,y|0):(d|0)==58?(pr(h),pr(Z),y=-3,y|0):(d|0)==98?(pr(l),pr(h),pr(Z),y=-1,y|0):((d|0)==99&&Ul(T|0,h|0,L<<3|0)|0,pr(h),pr(Z),y=0,y|0)}function xl(x,T,M,L,j){x=x|0,T=T|0,M=M|0,L=L|0,j=j|0;var H=0,Q=0,J=0,ue=0,Ce=0,ze=0;if((T|0)<=0)return j=0,j|0;if((j|0)>=16){for(H=0;;){if(ze=x+(H<<3)|0,!((o[ze>>2]|0)==0&(o[ze+4>>2]|0)==0)){H=14;break}if(H=H+1|0,(H|0)>=(T|0)){Q=0,H=16;break}}if((H|0)==14)return((L|0)>0?-2:-1)|0;if((H|0)==16)return Q|0}H=0,ze=0;e:for(;;){Ce=x+(ze<<3)|0,J=Ce,Q=o[J>>2]|0,J=o[J+4>>2]|0;do if(!((Q|0)==0&(J|0)==0)){if((H|0)>=(L|0)){Q=-1,H=16;break e}if(ue=Nt(Q|0,J|0,52)|0,gt()|0,ue=ue&15,(ue|0)>(j|0)){Q=-2,H=16;break e}if((ue|0)==(j|0)){Ce=M+(H<<3)|0,o[Ce>>2]=Q,o[Ce+4>>2]=J,H=H+1|0;break}if(Q=(hl(7,j-ue|0)|0)+H|0,(Q|0)>(L|0)){Q=-1,H=16;break e}Os(o[Ce>>2]|0,o[Ce+4>>2]|0,j,M+(H<<3)|0),H=Q}while(!1);if(ze=ze+1|0,(ze|0)>=(T|0)){Q=0,H=16;break}}return(H|0)==16?Q|0:0}function ou(x,T,M){x=x|0,T=T|0,M=M|0;var L=0,j=0,H=0,Q=0;if((T|0)<=0)return M=0,M|0;if((M|0)>=16){for(L=0;;){if(Q=x+(L<<3)|0,!((o[Q>>2]|0)==0&(o[Q+4>>2]|0)==0)){L=-1,j=13;break}if(L=L+1|0,(L|0)>=(T|0)){L=0,j=13;break}}if((j|0)==13)return L|0}L=0,Q=0;e:for(;;){j=x+(Q<<3)|0,H=o[j>>2]|0,j=o[j+4>>2]|0;do if(!((H|0)==0&(j|0)==0)){if(j=Nt(H|0,j|0,52)|0,gt()|0,j=j&15,(j|0)>(M|0)){L=-1,j=13;break e}if((j|0)==(M|0)){L=L+1|0;break}else{L=(hl(7,M-j|0)|0)+L|0;break}}while(!1);if(Q=Q+1|0,(Q|0)>=(T|0)){j=13;break}}return(j|0)==13?L|0:0}function rc(x,T){return x=x|0,T=T|0,T=Nt(x|0,T|0,52)|0,gt()|0,T&1|0}function io(x,T){x=x|0,T=T|0;var M=0,L=0,j=0;if(j=Nt(x|0,T|0,52)|0,gt()|0,j=j&15,!j)return j=0,j|0;for(L=1;;){if(M=Nt(x|0,T|0,(15-L|0)*3|0)|0,gt()|0,M=M&7,M|0){L=5;break}if(L>>>0<j>>>0)L=L+1|0;else{M=0,L=5;break}}return(L|0)==5?M|0:0}function bo(x,T){x=x|0,T=T|0;var M=0,L=0,j=0,H=0,Q=0,J=0,ue=0;if(ue=Nt(x|0,T|0,52)|0,gt()|0,ue=ue&15,!ue)return J=T,ue=x,kr(J|0),ue|0;for(J=1,M=0;;){H=(15-J|0)*3|0,L=Kt(7,0,H|0)|0,j=gt()|0,Q=Nt(x|0,T|0,H|0)|0,gt()|0,H=Kt(Zs(Q&7)|0,0,H|0)|0,Q=gt()|0,x=H|x&~L,T=Q|T&~j;e:do if(!M)if((H&L|0)==0&(Q&j|0)==0)M=0;else if(L=Nt(x|0,T|0,52)|0,gt()|0,L=L&15,!L)M=1;else{M=1;t:for(;;){switch(Q=Nt(x|0,T|0,(15-M|0)*3|0)|0,gt()|0,Q&7){case 1:break t;case 0:break;default:{M=1;break e}}if(M>>>0<L>>>0)M=M+1|0;else{M=1;break e}}for(M=1;;)if(Q=(15-M|0)*3|0,j=Nt(x|0,T|0,Q|0)|0,gt()|0,H=Kt(7,0,Q|0)|0,T=T&~(gt()|0),Q=Kt(Zs(j&7)|0,0,Q|0)|0,x=x&~H|Q,T=T|(gt()|0),M>>>0<L>>>0)M=M+1|0;else{M=1;break}}while(!1);if(J>>>0<ue>>>0)J=J+1|0;else break}return kr(T|0),x|0}function ta(x,T){x=x|0,T=T|0;var M=0,L=0,j=0,H=0,Q=0;if(L=Nt(x|0,T|0,52)|0,gt()|0,L=L&15,!L)return M=T,L=x,kr(M|0),L|0;for(M=1;H=(15-M|0)*3|0,Q=Nt(x|0,T|0,H|0)|0,gt()|0,j=Kt(7,0,H|0)|0,T=T&~(gt()|0),H=Kt(Zs(Q&7)|0,0,H|0)|0,x=H|x&~j,T=gt()|0|T,M>>>0<L>>>0;)M=M+1|0;return kr(T|0),x|0}function OA(x,T){x=x|0,T=T|0;var M=0,L=0,j=0,H=0,Q=0,J=0,ue=0;if(ue=Nt(x|0,T|0,52)|0,gt()|0,ue=ue&15,!ue)return J=T,ue=x,kr(J|0),ue|0;for(J=1,M=0;;){H=(15-J|0)*3|0,L=Kt(7,0,H|0)|0,j=gt()|0,Q=Nt(x|0,T|0,H|0)|0,gt()|0,H=Kt(wa(Q&7)|0,0,H|0)|0,Q=gt()|0,x=H|x&~L,T=Q|T&~j;e:do if(!M)if((H&L|0)==0&(Q&j|0)==0)M=0;else if(L=Nt(x|0,T|0,52)|0,gt()|0,L=L&15,!L)M=1;else{M=1;t:for(;;){switch(Q=Nt(x|0,T|0,(15-M|0)*3|0)|0,gt()|0,Q&7){case 1:break t;case 0:break;default:{M=1;break e}}if(M>>>0<L>>>0)M=M+1|0;else{M=1;break e}}for(M=1;;)if(j=(15-M|0)*3|0,H=Kt(7,0,j|0)|0,Q=T&~(gt()|0),T=Nt(x|0,T|0,j|0)|0,gt()|0,T=Kt(wa(T&7)|0,0,j|0)|0,x=x&~H|T,T=Q|(gt()|0),M>>>0<L>>>0)M=M+1|0;else{M=1;break}}while(!1);if(J>>>0<ue>>>0)J=J+1|0;else break}return kr(T|0),x|0}function Rn(x,T){x=x|0,T=T|0;var M=0,L=0,j=0,H=0,Q=0;if(L=Nt(x|0,T|0,52)|0,gt()|0,L=L&15,!L)return M=T,L=x,kr(M|0),L|0;for(M=1;Q=(15-M|0)*3|0,H=Kt(7,0,Q|0)|0,j=T&~(gt()|0),T=Nt(x|0,T|0,Q|0)|0,gt()|0,T=Kt(wa(T&7)|0,0,Q|0)|0,x=T|x&~H,T=gt()|0|j,M>>>0<L>>>0;)M=M+1|0;return kr(T|0),x|0}function Sa(x,T){x=x|0,T=T|0;var M=0,L=0,j=0,H=0,Q=0,J=0,ue=0,Ce=0,ze=0;if(ue=st,st=st+64|0,J=ue+40|0,L=ue+24|0,j=ue+12|0,H=ue,Kt(T|0,0,52)|0,M=gt()|0|134225919,!T)return(o[x+4>>2]|0)>2||(o[x+8>>2]|0)>2||(o[x+12>>2]|0)>2?(Q=0,J=0,kr(Q|0),st=ue,J|0):(Kt(qn(x)|0,0,45)|0,Q=gt()|0|M,J=-1,kr(Q|0),st=ue,J|0);if(o[J>>2]=o[x>>2],o[J+4>>2]=o[x+4>>2],o[J+8>>2]=o[x+8>>2],o[J+12>>2]=o[x+12>>2],Q=J+4|0,(T|0)>0)for(x=-1;o[L>>2]=o[Q>>2],o[L+4>>2]=o[Q+4>>2],o[L+8>>2]=o[Q+8>>2],T&1?(Dr(Q),o[j>>2]=o[Q>>2],o[j+4>>2]=o[Q+4>>2],o[j+8>>2]=o[Q+8>>2],rl(j)):(ba(Q),o[j>>2]=o[Q>>2],o[j+4>>2]=o[Q+4>>2],o[j+8>>2]=o[Q+8>>2],ca(j)),sr(L,j,H),Kn(H),ze=(15-T|0)*3|0,Ce=Kt(7,0,ze|0)|0,M=M&~(gt()|0),ze=Kt(Aa(H)|0,0,ze|0)|0,x=ze|x&~Ce,M=gt()|0|M,(T|0)>1;)T=T+-1|0;else x=-1;e:do if((o[Q>>2]|0)<=2&&(o[J+8>>2]|0)<=2&&(o[J+12>>2]|0)<=2){if(L=qn(J)|0,T=Kt(L|0,0,45)|0,T=T|x,x=gt()|0|M&-1040385,H=dA(J)|0,!(ns(L)|0)){if((H|0)<=0)break;for(j=0;;){if(L=Nt(T|0,x|0,52)|0,gt()|0,L=L&15,L)for(M=1;ze=(15-M|0)*3|0,J=Nt(T|0,x|0,ze|0)|0,gt()|0,Ce=Kt(7,0,ze|0)|0,x=x&~(gt()|0),ze=Kt(Zs(J&7)|0,0,ze|0)|0,T=T&~Ce|ze,x=x|(gt()|0),M>>>0<L>>>0;)M=M+1|0;if(j=j+1|0,(j|0)==(H|0))break e}}j=Nt(T|0,x|0,52)|0,gt()|0,j=j&15;t:do if(j){M=1;i:for(;;){switch(ze=Nt(T|0,x|0,(15-M|0)*3|0)|0,gt()|0,ze&7){case 1:break i;case 0:break;default:break t}if(M>>>0<j>>>0)M=M+1|0;else break t}if(ss(L,o[J>>2]|0)|0)for(M=1;J=(15-M|0)*3|0,Ce=Kt(7,0,J|0)|0,ze=x&~(gt()|0),x=Nt(T|0,x|0,J|0)|0,gt()|0,x=Kt(wa(x&7)|0,0,J|0)|0,T=T&~Ce|x,x=ze|(gt()|0),M>>>0<j>>>0;)M=M+1|0;else for(M=1;ze=(15-M|0)*3|0,J=Nt(T|0,x|0,ze|0)|0,gt()|0,Ce=Kt(7,0,ze|0)|0,x=x&~(gt()|0),ze=Kt(Zs(J&7)|0,0,ze|0)|0,T=T&~Ce|ze,x=x|(gt()|0),M>>>0<j>>>0;)M=M+1|0}while(!1);if((H|0)>0){M=0;do T=bo(T,x)|0,x=gt()|0,M=M+1|0;while((M|0)!=(H|0))}}else T=0,x=0;while(!1);return Ce=x,ze=T,kr(Ce|0),st=ue,ze|0}function Un(x){return x=x|0,(x|0)%2|0|0}function qa(x,T){x=x|0,T=T|0;var M=0,L=0;return L=st,st=st+16|0,M=L,T>>>0<=15&&(o[x+4>>2]&2146435072|0)!=2146435072&&(o[x+8+4>>2]&2146435072|0)!=2146435072?(ea(x,T,M),T=Sa(M,T)|0,x=gt()|0):(x=0,T=0),kr(x|0),st=L,T|0}function al(x,T,M){x=x|0,T=T|0,M=M|0;var L=0,j=0,H=0,Q=0;if(j=M+4|0,H=Nt(x|0,T|0,52)|0,gt()|0,H=H&15,Q=Nt(x|0,T|0,45)|0,gt()|0,L=(H|0)==0,ns(Q&127)|0){if(L)return Q=1,Q|0;L=1}else{if(L)return Q=0,Q|0;!(o[j>>2]|0)&&!(o[M+8>>2]|0)?L=(o[M+12>>2]|0)!=0&1:L=1}for(M=1;M&1?rl(j):ca(j),Q=Nt(x|0,T|0,(15-M|0)*3|0)|0,gt()|0,ho(j,Q&7),M>>>0<H>>>0;)M=M+1|0;return L|0}function vl(x,T,M){x=x|0,T=T|0,M=M|0;var L=0,j=0,H=0,Q=0,J=0,ue=0,Ce=0,ze=0;ze=st,st=st+16|0,ue=ze,Ce=Nt(x|0,T|0,45)|0,gt()|0,Ce=Ce&127;e:do if(ns(Ce)|0&&(H=Nt(x|0,T|0,52)|0,gt()|0,H=H&15,(H|0)!=0)){L=1;t:for(;;){switch(J=Nt(x|0,T|0,(15-L|0)*3|0)|0,gt()|0,J&7){case 5:break t;case 0:break;default:{L=T;break e}}if(L>>>0<H>>>0)L=L+1|0;else{L=T;break e}}for(j=1,L=T;T=(15-j|0)*3|0,Q=Kt(7,0,T|0)|0,J=L&~(gt()|0),L=Nt(x|0,L|0,T|0)|0,gt()|0,L=Kt(wa(L&7)|0,0,T|0)|0,x=x&~Q|L,L=J|(gt()|0),j>>>0<H>>>0;)j=j+1|0}else L=T;while(!1);if(J=7728+(Ce*28|0)|0,o[M>>2]=o[J>>2],o[M+4>>2]=o[J+4>>2],o[M+8>>2]=o[J+8>>2],o[M+12>>2]=o[J+12>>2],!(al(x,L,M)|0)){st=ze;return}if(Q=M+4|0,o[ue>>2]=o[Q>>2],o[ue+4>>2]=o[Q+4>>2],o[ue+8>>2]=o[Q+8>>2],H=Nt(x|0,L|0,52)|0,gt()|0,J=H&15,H&1?(ca(Q),H=J+1|0):H=J,!(ns(Ce)|0))L=0;else{e:do if(!J)L=0;else for(T=1;;){if(j=Nt(x|0,L|0,(15-T|0)*3|0)|0,gt()|0,j=j&7,j|0){L=j;break e}if(T>>>0<J>>>0)T=T+1|0;else{L=0;break}}while(!1);L=(L|0)==4&1}if(!(Ll(M,H,L,0)|0))(H|0)!=(J|0)&&(o[Q>>2]=o[ue>>2],o[Q+4>>2]=o[ue+4>>2],o[Q+8>>2]=o[ue+8>>2]);else{if(ns(Ce)|0)do;while(Ll(M,H,0,0)|0);(H|0)!=(J|0)&&ba(Q)}st=ze}function wo(x,T,M){x=x|0,T=T|0,M=M|0;var L=0,j=0;L=st,st=st+16|0,j=L,vl(x,T,j),T=Nt(x|0,T|0,52)|0,gt()|0,RA(j,T&15,M),st=L}function Ia(x,T,M){x=x|0,T=T|0,M=M|0;var L=0,j=0,H=0,Q=0,J=0;Q=st,st=st+16|0,H=Q,vl(x,T,H),L=Nt(x|0,T|0,45)|0,gt()|0,L=(ns(L&127)|0)==0,j=Nt(x|0,T|0,52)|0,gt()|0,j=j&15;e:do if(!L){if(j|0)for(L=1;;){if(J=Kt(7,0,(15-L|0)*3|0)|0,!((J&x|0)==0&((gt()|0)&T|0)==0))break e;if(L>>>0<j>>>0)L=L+1|0;else break}vo(H,j,0,5,M),st=Q;return}while(!1);ms(H,j,0,6,M),st=Q}function Ol(x,T){x=x|0,T=T|0;var M=0,L=0,j=0;if(L=Nt(x|0,T|0,45)|0,gt()|0,!(ns(L&127)|0))return L=2,L|0;if(L=Nt(x|0,T|0,52)|0,gt()|0,L=L&15,!L)return L=5,L|0;for(M=1;;){if(j=Kt(7,0,(15-M|0)*3|0)|0,!((j&x|0)==0&((gt()|0)&T|0)==0)){M=2,x=6;break}if(M>>>0<L>>>0)M=M+1|0;else{M=5,x=6;break}}return(x|0)==6?M|0:0}function Mt(x,T,M){x=x|0,T=T|0,M=M|0;var L=0,j=0,H=0,Q=0,J=0,ue=0,Ce=0,ze=0,_t=0;_t=st,st=st+128|0,Ce=_t+112|0,H=_t+96|0,ze=_t,j=Nt(x|0,T|0,52)|0,gt()|0,J=j&15,o[Ce>>2]=J,Q=Nt(x|0,T|0,45)|0,gt()|0,Q=Q&127;e:do if(ns(Q)|0){if(J|0)for(L=1;;){if(ue=Kt(7,0,(15-L|0)*3|0)|0,!((ue&x|0)==0&((gt()|0)&T|0)==0)){j=0;break e}if(L>>>0<J>>>0)L=L+1|0;else break}if(j&1)j=1;else{ue=Kt(J+1|0,0,52)|0,ze=gt()|0|T&-15728641,Ce=Kt(7,0,(14-J|0)*3|0)|0,Mt((ue|x)&~Ce,ze&~(gt()|0),M),st=_t;return}}else j=0;while(!1);vl(x,T,H),j?(fo(H,Ce,ze),ue=5):(Ea(H,Ce,ze),ue=6);e:do if(ns(Q)|0)if(!J)L=20;else for(L=1;;){if(Q=Kt(7,0,(15-L|0)*3|0)|0,!((Q&x|0)==0&((gt()|0)&T|0)==0)){L=8;break e}if(L>>>0<J>>>0)L=L+1|0;else{L=20;break}}else L=8;while(!1);if($r(M|0,-1,L|0)|0,j){j=0;do{for(H=ze+(j<<4)|0,tA(H,o[Ce>>2]|0)|0,H=o[H>>2]|0,L=0;Q=M+(L<<2)|0,J=o[Q>>2]|0,!((J|0)==-1|(J|0)==(H|0));)L=L+1|0;o[Q>>2]=H,j=j+1|0}while((j|0)!=(ue|0))}else{j=0;do{for(H=ze+(j<<4)|0,Ll(H,o[Ce>>2]|0,0,1)|0,H=o[H>>2]|0,L=0;Q=M+(L<<2)|0,J=o[Q>>2]|0,!((J|0)==-1|(J|0)==(H|0));)L=L+1|0;o[Q>>2]=H,j=j+1|0}while((j|0)!=(ue|0))}st=_t}function nc(){return 12}function ll(x,T){x=x|0,T=T|0;var M=0,L=0,j=0,H=0,Q=0,J=0,ue=0;if(Kt(x|0,0,52)|0,J=gt()|0|134225919,(x|0)<1){L=0,M=0;do ns(L)|0&&(Kt(L|0,0,45)|0,Q=J|(gt()|0),x=T+(M<<3)|0,o[x>>2]=-1,o[x+4>>2]=Q,M=M+1|0),L=L+1|0;while((L|0)!=122);return}Q=0,M=0;do{if(ns(Q)|0){for(Kt(Q|0,0,45)|0,L=1,j=-1,H=J|(gt()|0);ue=Kt(7,0,(15-L|0)*3|0)|0,j=j&~ue,H=H&~(gt()|0),(L|0)!=(x|0);)L=L+1|0;ue=T+(M<<3)|0,o[ue>>2]=j,o[ue+4>>2]=H,M=M+1|0}Q=Q+1|0}while((Q|0)!=122)}function Al(x,T,M,L){x=x|0,T=T|0,M=M|0,L=L|0;var j=0,H=0,Q=0,J=0,ue=0,Ce=0;if(J=st,st=st+64|0,Q=J,(x|0)==(M|0)&(T|0)==(L|0)|(!1|(T&2013265920|0)!=134217728|(!1|(L&2013265920|0)!=134217728))||(j=Nt(x|0,T|0,52)|0,gt()|0,j=j&15,H=Nt(M|0,L|0,52)|0,gt()|0,(j|0)!=(H&15|0)))return Q=0,st=J,Q|0;if(H=j+-1|0,j>>>0>1&&(Ce=Za(x,T,H)|0,ue=gt()|0,H=Za(M,L,H)|0,(Ce|0)==(H|0)&(ue|0)==(gt()|0))&&(H=(j^15)*3|0,j=Nt(x|0,T|0,H|0)|0,gt()|0,j=j&7,H=Nt(M|0,L|0,H|0)|0,gt()|0,H=H&7,(j|0)==0|(H|0)==0||(o[21136+(j<<2)>>2]|0)==(H|0)||(o[21168+(j<<2)>>2]|0)==(H|0)))return Ce=1,st=J,Ce|0;j=Q,H=j+56|0;do o[j>>2]=0,j=j+4|0;while((j|0)<(H|0));return Wi(x,T,1,Q),Ce=Q,!((o[Ce>>2]|0)==(M|0)&&(o[Ce+4>>2]|0)==(L|0))&&(Ce=Q+8|0,!((o[Ce>>2]|0)==(M|0)&&(o[Ce+4>>2]|0)==(L|0)))&&(Ce=Q+16|0,!((o[Ce>>2]|0)==(M|0)&&(o[Ce+4>>2]|0)==(L|0)))&&(Ce=Q+24|0,!((o[Ce>>2]|0)==(M|0)&&(o[Ce+4>>2]|0)==(L|0)))&&(Ce=Q+32|0,!((o[Ce>>2]|0)==(M|0)&&(o[Ce+4>>2]|0)==(L|0)))&&(Ce=Q+40|0,!((o[Ce>>2]|0)==(M|0)&&(o[Ce+4>>2]|0)==(L|0)))?(j=Q+48|0,j=((o[j>>2]|0)==(M|0)?(o[j+4>>2]|0)==(L|0):0)&1):j=1,Ce=j,st=J,Ce|0}function Lc(x,T,M,L){x=x|0,T=T|0,M=M|0,L=L|0;var j=0,H=0,Q=0,J=0,ue=0,Ce=0,ze=0;if(Ce=st,st=st+16|0,Q=Ce,!(Al(x,T,M,L)|0))return J=0,ue=0,kr(J|0),st=Ce,ue|0;for(J=T&-2130706433,j=(Qs(x,T)|0)==0,j=j?1:2;o[Q>>2]=0,ze=Yn(x,T,j,Q)|0,H=j+1|0,!((ze|0)==(M|0)&(gt()|0)==(L|0));)if(H>>>0<7)j=H;else{j=0,x=0,ue=6;break}return(ue|0)==6?(kr(j|0),st=Ce,x|0):(ze=Kt(j|0,0,56)|0,ue=J|(gt()|0)|268435456,ze=x|ze,kr(ue|0),st=Ce,ze|0)}function To(x,T){x=x|0,T=T|0;var M=0;return M=!0&(T&2013265920|0)==268435456,kr((M?T&-2130706433|134217728:0)|0),(M?x:0)|0}function ha(x,T){x=x|0,T=T|0;var M=0,L=0,j=0;return L=st,st=st+16|0,M=L,!0&(T&2013265920|0)==268435456?(j=Nt(x|0,T|0,56)|0,gt()|0,o[M>>2]=0,M=Yn(x,T&-2130706433|134217728,j&7,M)|0,T=gt()|0,kr(T|0),st=L,M|0):(T=0,M=0,kr(T|0),st=L,M|0)}function Uo(x,T){x=x|0,T=T|0;var M=0;if(!(!0&(T&2013265920|0)==268435456))return M=0,M|0;switch(M=Nt(x|0,T|0,56)|0,gt()|0,M&7){case 0:case 7:return M=0,M|0}return M=T&-2130706433|134217728,!0&(T&117440512|0)==16777216&(Qs(x,M)|0)!=0?(M=0,M|0):(M=ol(x,M)|0,M|0)}function Qa(x,T,M){x=x|0,T=T|0,M=M|0;var L=0,j=0,H=0,Q=0,J=0;H=st,st=st+16|0,L=H,Q=!0&(T&2013265920|0)==268435456,j=T&-2130706433|134217728,J=M,o[J>>2]=Q?x:0,o[J+4>>2]=Q?j:0,Q?(T=Nt(x|0,T|0,56)|0,gt()|0,o[L>>2]=0,x=Yn(x,j,T&7,L)|0,T=gt()|0):(x=0,T=0),J=M+8|0,o[J>>2]=x,o[J+4>>2]=T,st=H}function NA(x,T,M){x=x|0,T=T|0,M=M|0;var L=0,j=0;j=(Qs(x,T)|0)==0,T=T&-2130706433,L=M,o[L>>2]=j?x:0,o[L+4>>2]=j?T|285212672:0,L=M+8|0,o[L>>2]=x,o[L+4>>2]=T|301989888,L=M+16|0,o[L>>2]=x,o[L+4>>2]=T|318767104,L=M+24|0,o[L>>2]=x,o[L+4>>2]=T|335544320,L=M+32|0,o[L>>2]=x,o[L+4>>2]=T|352321536,M=M+40|0,o[M>>2]=x,o[M+4>>2]=T|369098752}function cl(x,T,M){x=x|0,T=T|0,M=M|0;var L=0,j=0,H=0,Q=0,J=0;if(Q=st,st=st+16|0,H=Q,L=Nt(x|0,T|0,56)|0,gt()|0,J=!0&(T&2013265920|0)==268435456,j=J?x:0,x=J?T&-2130706433|134217728:0,T=ZA(j,x,L&7)|0,(T|0)==-1){o[M>>2]=0,st=Q;return}vl(j,x,H),L=Nt(j|0,x|0,52)|0,gt()|0,L=L&15,Qs(j,x)|0?vo(H,L,T,2,M):ms(H,L,T,2,M),st=Q}function sc(x){x=x|0;var T=0,M=0,L=0;return T=ra(1,12)|0,T||Ci(22691,22646,49,22704),M=x+4|0,L=o[M>>2]|0,L|0?(L=L+8|0,o[L>>2]=T,o[M>>2]=T,T|0):(o[x>>2]|0&&Ci(22721,22646,61,22744),L=x,o[L>>2]=T,o[M>>2]=T,T|0)}function bl(x,T){x=x|0,T=T|0;var M=0,L=0;return L=Eo(24)|0,L||Ci(22758,22646,78,22772),o[L>>2]=o[T>>2],o[L+4>>2]=o[T+4>>2],o[L+8>>2]=o[T+8>>2],o[L+12>>2]=o[T+12>>2],o[L+16>>2]=0,T=x+4|0,M=o[T>>2]|0,M|0?(o[M+16>>2]=L,o[T>>2]=L,L|0):(o[x>>2]|0&&Ci(22787,22646,82,22772),o[x>>2]=L,o[T>>2]=L,L|0)}function UA(x){x=x|0;var T=0,M=0,L=0,j=0;if(x)for(L=1;;){if(T=o[x>>2]|0,T|0)do{if(M=o[T>>2]|0,M|0)do j=M,M=o[M+16>>2]|0,pr(j);while(M|0);j=T,T=o[T+8>>2]|0,pr(j)}while(T|0);if(T=x,x=o[x+8>>2]|0,L||pr(T),x)L=0;else break}}function Vo(x){x=x|0;var T=0,M=0,L=0,j=0,H=0,Q=0,J=0,ue=0,Ce=0,ze=0,_t=0,Xe=0,it=0,z=0,l=0,g=0,S=0,k=0,F=0,Z=0,u=0,h=0,d=0,y=0,b=0,I=0,R=0,N=0,W=0,K=0,le=0,de=0;if(j=x+8|0,o[j>>2]|0)return de=1,de|0;if(L=o[x>>2]|0,!L)return de=0,de|0;T=L,M=0;do M=M+1|0,T=o[T+8>>2]|0;while(T|0);if(M>>>0<2)return de=0,de|0;K=Eo(M<<2)|0,K||Ci(22807,22646,317,22826),W=Eo(M<<5)|0,W||Ci(22848,22646,321,22826),o[x>>2]=0,h=x+4|0,o[h>>2]=0,o[j>>2]=0,M=0,N=0,u=0,_t=0;e:for(;;){if(ze=o[L>>2]|0,ze){H=0,Q=ze;do{if(ue=+oe[Q+8>>3],T=Q,Q=o[Q+16>>2]|0,Ce=(Q|0)==0,j=Ce?ze:Q,J=+oe[j+8>>3],+mi(+(ue-J))>3.141592653589793){de=14;break}H=H+(J-ue)*(+oe[T>>3]+ +oe[j>>3])}while(!Ce);if((de|0)==14){de=0,H=0,T=ze;do Z=+oe[T+8>>3],R=T+16|0,I=o[R>>2]|0,I=I|0?I:ze,F=+oe[I+8>>3],H=H+(+oe[T>>3]+ +oe[I>>3])*((F<0?F+6.283185307179586:F)-(Z<0?Z+6.283185307179586:Z)),T=o[(T|0?R:L)>>2]|0;while(T|0)}H>0?(o[K+(N<<2)>>2]=L,N=N+1|0,j=u,T=_t):de=19}else de=19;if((de|0)==19){de=0;do if(M){if(T=M+8|0,o[T>>2]|0){de=21;break e}if(M=ra(1,12)|0,!M){de=23;break e}o[T>>2]=M,j=M+4|0,Q=M,T=_t}else if(_t){j=h,Q=_t+8|0,T=L,M=x;break}else if(o[x>>2]|0){de=27;break e}else{j=h,Q=x,T=L,M=x;break}while(!1);if(o[Q>>2]=L,o[j>>2]=L,Q=W+(u<<5)|0,Ce=o[L>>2]|0,Ce){for(ze=W+(u<<5)+8|0,oe[ze>>3]=17976931348623157e292,_t=W+(u<<5)+24|0,oe[_t>>3]=17976931348623157e292,oe[Q>>3]=-17976931348623157e292,Xe=W+(u<<5)+16|0,oe[Xe>>3]=-17976931348623157e292,S=17976931348623157e292,k=-17976931348623157e292,j=0,it=Ce,ue=17976931348623157e292,l=17976931348623157e292,g=-17976931348623157e292,J=-17976931348623157e292;H=+oe[it>>3],Z=+oe[it+8>>3],it=o[it+16>>2]|0,z=(it|0)==0,F=+oe[(z?Ce:it)+8>>3],H<ue&&(oe[ze>>3]=H,ue=H),Z<l&&(oe[_t>>3]=Z,l=Z),H>g?oe[Q>>3]=H:H=g,Z>J&&(oe[Xe>>3]=Z,J=Z),S=Z>0&Z<S?Z:S,k=Z<0&Z>k?Z:k,j=j|+mi(+(Z-F))>3.141592653589793,!z;)g=H;j&&(oe[Xe>>3]=k,oe[_t>>3]=S)}else o[Q>>2]=0,o[Q+4>>2]=0,o[Q+8>>2]=0,o[Q+12>>2]=0,o[Q+16>>2]=0,o[Q+20>>2]=0,o[Q+24>>2]=0,o[Q+28>>2]=0;j=u+1|0}if(R=L+8|0,L=o[R>>2]|0,o[R>>2]=0,L)u=j,_t=T;else{de=45;break}}if((de|0)==21)Ci(22624,22646,35,22658);else if((de|0)==23)Ci(22678,22646,37,22658);else if((de|0)==27)Ci(22721,22646,61,22744);else if((de|0)==45){e:do if((N|0)>0){for(R=(j|0)==0,b=j<<2,I=(x|0)==0,y=0,T=0;;){if(d=o[K+(y<<2)>>2]|0,R)de=73;else{if(u=Eo(b)|0,!u){de=50;break}if(h=Eo(b)|0,!h){de=52;break}t:do if(I)M=0;else{for(j=0,M=0,Q=x;L=W+(j<<5)|0,ia(o[Q>>2]|0,L,o[d>>2]|0)|0?(o[u+(M<<2)>>2]=Q,o[h+(M<<2)>>2]=L,z=M+1|0):z=M,Q=o[Q+8>>2]|0,Q;)j=j+1|0,M=z;if((z|0)>0)if(L=o[u>>2]|0,(z|0)==1)M=L;else for(Xe=0,it=-1,M=L,_t=L;;){for(Ce=o[_t>>2]|0,L=0,Q=0;j=o[o[u+(Q<<2)>>2]>>2]|0,(j|0)==(Ce|0)?ze=L:ze=L+((ia(j,o[h+(Q<<2)>>2]|0,o[Ce>>2]|0)|0)&1)|0,Q=Q+1|0,(Q|0)!=(z|0);)L=ze;if(j=(ze|0)>(it|0),M=j?_t:M,L=Xe+1|0,(L|0)==(z|0))break t;Xe=L,it=j?ze:it,_t=o[u+(L<<2)>>2]|0}else M=0}while(!1);if(pr(u),pr(h),M){if(j=M+4|0,L=o[j>>2]|0,L)M=L+8|0;else if(o[M>>2]|0){de=70;break}o[M>>2]=d,o[j>>2]=d}else de=73}if((de|0)==73){if(de=0,T=o[d>>2]|0,T|0)do h=T,T=o[T+16>>2]|0,pr(h);while(T|0);pr(d),T=2}if(y=y+1|0,(y|0)>=(N|0)){le=T;break e}}(de|0)==50?Ci(22863,22646,249,22882):(de|0)==52?Ci(22901,22646,252,22882):(de|0)==70&&Ci(22721,22646,61,22744)}else le=0;while(!1);return pr(K),pr(W),de=le,de|0}return 0}function ia(x,T,M){x=x|0,T=T|0,M=M|0;var L=0,j=0,H=0,Q=0,J=0,ue=0,Ce=0,ze=0;if(!(la(T,M)|0)||(T=vn(T)|0,Ce=+oe[M>>3],L=+oe[M+8>>3],L=T&L<0?L+6.283185307179586:L,x=o[x>>2]|0,!x))return x=0,x|0;if(T){T=0,M=x;e:for(;;){for(;Q=+oe[M>>3],ue=+oe[M+8>>3],M=M+16|0,ze=o[M>>2]|0,ze=ze|0?ze:x,H=+oe[ze>>3],j=+oe[ze+8>>3],Q>H?(J=Q,Q=ue):(J=H,H=Q,Q=j,j=ue),!!(Ce<H|Ce>J);)if(M=o[M>>2]|0,!M){M=22;break e}if(ue=j<0?j+6.283185307179586:j,Q=Q<0?Q+6.283185307179586:Q,L=Q==L|ue==L?L+-2220446049250313e-31:L,ue=ue+(Ce-H)/(J-H)*(Q-ue),(ue<0?ue+6.283185307179586:ue)>L&&(T=T^1),M=o[M>>2]|0,!M){M=22;break}}if((M|0)==22)return T|0}else{T=0,M=x;e:for(;;){for(;Q=+oe[M>>3],ue=+oe[M+8>>3],M=M+16|0,ze=o[M>>2]|0,ze=ze|0?ze:x,H=+oe[ze>>3],j=+oe[ze+8>>3],Q>H?(J=Q,Q=ue):(J=H,H=Q,Q=j,j=ue),!!(Ce<H|Ce>J);)if(M=o[M>>2]|0,!M){M=22;break e}if(L=Q==L|j==L?L+-2220446049250313e-31:L,j+(Ce-H)/(J-H)*(Q-j)>L&&(T=T^1),M=o[M>>2]|0,!M){M=22;break}}if((M|0)==22)return T|0}return 0}function Ca(x,T,M,L,j){x=x|0,T=T|0,M=M|0,L=L|0,j=j|0;var H=0,Q=0,J=0,ue=0,Ce=0,ze=0,_t=0,Xe=0,it=0,z=0,l=0,g=0,S=0,k=0;if(k=st,st=st+32|0,S=k+16|0,g=k,H=Nt(x|0,T|0,52)|0,gt()|0,H=H&15,it=Nt(M|0,L|0,52)|0,gt()|0,(H|0)!=(it&15|0))return S=1,st=k,S|0;if(Ce=Nt(x|0,T|0,45)|0,gt()|0,Ce=Ce&127,ze=Nt(M|0,L|0,45)|0,gt()|0,ze=ze&127,it=(Ce|0)!=(ze|0),it){if(J=gi(Ce,ze)|0,(J|0)==7)return S=2,st=k,S|0;ue=gi(ze,Ce)|0,(ue|0)==7?Ci(22925,22949,151,22959):(z=J,Q=ue)}else z=0,Q=0;_t=ns(Ce)|0,Xe=ns(ze)|0,o[S>>2]=0,o[S+4>>2]=0,o[S+8>>2]=0,o[S+12>>2]=0;do if(z){if(ze=o[4304+(Ce*28|0)+(z<<2)>>2]|0,J=(ze|0)>0,Xe)if(J){Ce=0,ue=M,J=L;do ue=OA(ue,J)|0,J=gt()|0,Q=wa(Q)|0,(Q|0)==1&&(Q=wa(1)|0),Ce=Ce+1|0;while((Ce|0)!=(ze|0));ze=Q,Ce=ue,ue=J}else ze=Q,Ce=M,ue=L;else if(J){Ce=0,ue=M,J=L;do ue=Rn(ue,J)|0,J=gt()|0,Q=wa(Q)|0,Ce=Ce+1|0;while((Ce|0)!=(ze|0));ze=Q,Ce=ue,ue=J}else ze=Q,Ce=M,ue=L;if(al(Ce,ue,S)|0,it||Ci(22972,22949,181,22959),J=(_t|0)!=0,Q=(Xe|0)!=0,J&Q&&Ci(22999,22949,182,22959),J){if(Q=io(x,T)|0,zt[22032+(Q*7|0)+z>>0]|0){H=3;break}ue=o[21200+(Q*28|0)+(z<<2)>>2]|0,Ce=ue,l=26}else if(Q){if(Q=io(Ce,ue)|0,zt[22032+(Q*7|0)+ze>>0]|0){H=4;break}Ce=0,ue=o[21200+(ze*28|0)+(Q<<2)>>2]|0,l=26}else Q=0;if((l|0)==26)if((ue|0)<=-1&&Ci(23030,22949,212,22959),(Ce|0)<=-1&&Ci(23053,22949,213,22959),(ue|0)>0){J=S+4|0,Q=0;do gl(J),Q=Q+1|0;while((Q|0)!=(ue|0));Q=Ce}else Q=Ce;if(o[g>>2]=0,o[g+4>>2]=0,o[g+8>>2]=0,ho(g,z),H|0)for(;Un(H)|0?rl(g):ca(g),(H|0)>1;)H=H+-1|0;if((Q|0)>0){H=0;do gl(g),H=H+1|0;while((H|0)!=(Q|0))}l=S+4|0,Ui(l,g,l),Kn(l),l=50}else if(al(M,L,S)|0,(_t|0)!=0&(Xe|0)!=0)if((ze|0)!=(Ce|0)&&Ci(23077,22949,243,22959),Q=io(x,T)|0,H=io(M,L)|0,zt[22032+(Q*7|0)+H>>0]|0)H=5;else if(Q=o[21200+(Q*28|0)+(H<<2)>>2]|0,(Q|0)>0){J=S+4|0,H=0;do gl(J),H=H+1|0;while((H|0)!=(Q|0));l=50}else l=50;else l=50;while(!1);return(l|0)==50&&(H=S+4|0,o[j>>2]=o[H>>2],o[j+4>>2]=o[H+4>>2],o[j+8>>2]=o[H+8>>2],H=0),S=H,st=k,S|0}function ul(x,T,M,L){x=x|0,T=T|0,M=M|0,L=L|0;var j=0,H=0,Q=0,J=0,ue=0,Ce=0,ze=0,_t=0,Xe=0,it=0,z=0,l=0,g=0,S=0,k=0;if(z=st,st=st+48|0,Q=z+36|0,J=z+24|0,ue=z+12|0,Ce=z,H=Nt(x|0,T|0,52)|0,gt()|0,H=H&15,Xe=Nt(x|0,T|0,45)|0,gt()|0,Xe=Xe&127,ze=ns(Xe)|0,Kt(H|0,0,52)|0,g=gt()|0|134225919,l=L,o[l>>2]=-1,o[l+4>>2]=g,!H)return(o[M>>2]|0)>1||(o[M+4>>2]|0)>1||(o[M+8>>2]|0)>1||(j=xt(Xe,Aa(M)|0)|0,(j|0)==127)?(g=1,st=z,g|0):(it=Kt(j|0,0,45)|0,l=gt()|0,Xe=L,l=o[Xe+4>>2]&-1040385|l,g=L,o[g>>2]=o[Xe>>2]|it,o[g+4>>2]=l,g=0,st=z,g|0);for(o[Q>>2]=o[M>>2],o[Q+4>>2]=o[M+4>>2],o[Q+8>>2]=o[M+8>>2];o[J>>2]=o[Q>>2],o[J+4>>2]=o[Q+4>>2],o[J+8>>2]=o[Q+8>>2],Un(H)|0?(Dr(Q),o[ue>>2]=o[Q>>2],o[ue+4>>2]=o[Q+4>>2],o[ue+8>>2]=o[Q+8>>2],rl(ue)):(ba(Q),o[ue>>2]=o[Q>>2],o[ue+4>>2]=o[Q+4>>2],o[ue+8>>2]=o[Q+8>>2],ca(ue)),sr(J,ue,Ce),Kn(Ce),l=L,S=o[l>>2]|0,l=o[l+4>>2]|0,k=(15-H|0)*3|0,M=Kt(7,0,k|0)|0,l=l&~(gt()|0),k=Kt(Aa(Ce)|0,0,k|0)|0,l=gt()|0|l,g=L,o[g>>2]=k|S&~M,o[g+4>>2]=l,(H|0)>1;)H=H+-1|0;e:do if((o[Q>>2]|0)<=1&&(o[Q+4>>2]|0)<=1&&(o[Q+8>>2]|0)<=1){H=Aa(Q)|0,J=xt(Xe,H)|0,(J|0)==127?Ce=0:Ce=ns(J)|0;t:do if(H){if(ze){if(Q=21408+((io(x,T)|0)*28|0)+(H<<2)|0,Q=o[Q>>2]|0,(Q|0)>0){M=0;do H=Zs(H)|0,M=M+1|0;while((M|0)!=(Q|0))}if((H|0)==1){j=3;break e}M=xt(Xe,H)|0,(M|0)==127&&Ci(23104,22949,376,23134),ns(M)|0?Ci(23147,22949,377,23134):(it=Q,_t=H,j=M)}else it=0,_t=H,j=J;if(ue=o[4304+(Xe*28|0)+(_t<<2)>>2]|0,(ue|0)<=-1&&Ci(23178,22949,384,23134),!Ce){if((it|0)<=-1&&Ci(23030,22949,417,23134),it|0){Q=L,H=0,M=o[Q>>2]|0,Q=o[Q+4>>2]|0;do M=ta(M,Q)|0,Q=gt()|0,k=L,o[k>>2]=M,o[k+4>>2]=Q,H=H+1|0;while((H|0)<(it|0))}if((ue|0)<=0){H=54;break}for(Q=L,H=0,M=o[Q>>2]|0,Q=o[Q+4>>2]|0;;)if(M=ta(M,Q)|0,Q=gt()|0,k=L,o[k>>2]=M,o[k+4>>2]=Q,H=H+1|0,(H|0)==(ue|0)){H=54;break t}}if(J=gi(j,Xe)|0,(J|0)==7&&Ci(22925,22949,393,23134),H=L,M=o[H>>2]|0,H=o[H+4>>2]|0,(ue|0)>0){Q=0;do M=ta(M,H)|0,H=gt()|0,k=L,o[k>>2]=M,o[k+4>>2]=H,Q=Q+1|0;while((Q|0)!=(ue|0))}if(M=io(M,H)|0,k=tc(j)|0,M=o[(k?21824:21616)+(J*28|0)+(M<<2)>>2]|0,(M|0)<=-1&&Ci(23030,22949,412,23134),!M)H=54;else{J=L,H=0,Q=o[J>>2]|0,J=o[J+4>>2]|0;do Q=bo(Q,J)|0,J=gt()|0,k=L,o[k>>2]=Q,o[k+4>>2]=J,H=H+1|0;while((H|0)<(M|0));H=54}}else if((ze|0)!=0&(Ce|0)!=0)if(k=io(x,T)|0,H=L,H=21408+(k*28|0)+((io(o[H>>2]|0,o[H+4>>2]|0)|0)<<2)|0,H=o[H>>2]|0,(H|0)<=-1&&Ci(23201,22949,433,23134),!H)j=J,H=55;else{Q=L,j=0,M=o[Q>>2]|0,Q=o[Q+4>>2]|0;do M=ta(M,Q)|0,Q=gt()|0,k=L,o[k>>2]=M,o[k+4>>2]=Q,j=j+1|0;while((j|0)<(H|0));j=J,H=54}else j=J,H=54;while(!1);if((H|0)==54&&Ce&&(H=55),(H|0)==55&&(k=L,(io(o[k>>2]|0,o[k+4>>2]|0)|0)==1)){j=4;break}k=L,g=o[k>>2]|0,k=o[k+4>>2]&-1040385,S=Kt(j|0,0,45)|0,k=k|(gt()|0),j=L,o[j>>2]=g|S,o[j+4>>2]=k,j=0}else j=2;while(!1);return k=j,st=z,k|0}function wl(x,T,M,L,j){x=x|0,T=T|0,M=M|0,L=L|0,j=j|0;var H=0,Q=0;return Q=st,st=st+16|0,H=Q,x=Ca(x,T,M,L,H)|0,x||(Va(H,j),x=0),st=Q,x|0}function ku(x,T,M,L){x=x|0,T=T|0,M=M|0,L=L|0;var j=0,H=0;return j=st,st=st+16|0,H=j,ic(M,H),L=ul(x,T,H,L)|0,st=j,L|0}function oc(x,T,M,L){x=x|0,T=T|0,M=M|0,L=L|0;var j=0,H=0,Q=0;return Q=st,st=st+32|0,j=Q+12|0,H=Q,!(Ca(x,T,x,T,j)|0)&&!(Ca(x,T,M,L,H)|0)?x=nl(j,H)|0:x=-1,st=Q,x|0}function au(x,T,M,L){x=x|0,T=T|0,M=M|0,L=L|0;var j=0,H=0,Q=0;return Q=st,st=st+32|0,j=Q+12|0,H=Q,!(Ca(x,T,x,T,j)|0)&&!(Ca(x,T,M,L,H)|0)?x=nl(j,H)|0:x=-1,st=Q,(x>>>31^1)+x|0}function rA(x,T,M,L,j){x=x|0,T=T|0,M=M|0,L=L|0,j=j|0;var H=0,Q=0,J=0,ue=0,Ce=0,ze=0,_t=0,Xe=0,it=0,z=0,l=0,g=0,S=0,k=0,F=0,Z=0,u=0,h=0;if(u=st,st=st+48|0,H=u+24|0,Q=u+12|0,Z=u,!(Ca(x,T,x,T,H)|0)&&!(Ca(x,T,M,L,Q)|0)){if(F=nl(H,Q)|0,(F|0)<0)return Z=F,st=u,Z|0;for(o[H>>2]=0,o[H+4>>2]=0,o[H+8>>2]=0,o[Q>>2]=0,o[Q+4>>2]=0,o[Q+8>>2]=0,Ca(x,T,x,T,H)|0,Ca(x,T,M,L,Q)|0,mA(H),mA(Q),F?(ze=o[H>>2]|0,it=+(F|0),g=H+4|0,_t=o[g>>2]|0,S=H+8|0,Xe=o[S>>2]|0,k=H,M=ze,L=_t,H=Xe,z=+((o[Q>>2]|0)-ze|0)/it,l=+((o[Q+4>>2]|0)-_t|0)/it,it=+((o[Q+8>>2]|0)-Xe|0)/it):(L=H+4|0,Xe=H+8|0,g=L,S=Xe,k=H,M=o[H>>2]|0,L=o[L>>2]|0,H=o[Xe>>2]|0,z=0,l=0,it=0),o[Z>>2]=M,Xe=Z+4|0,o[Xe>>2]=L,_t=Z+8|0,o[_t>>2]=H,ze=0;;){ue=+(ze|0),h=z*ue+ +(M|0),J=l*ue+ +(o[g>>2]|0),ue=it*ue+ +(o[S>>2]|0),L=~~+El(+h),Q=~~+El(+J),M=~~+El(+ue),h=+mi(+(+(L|0)-h)),J=+mi(+(+(Q|0)-J)),ue=+mi(+(+(M|0)-ue));do if(h>J&h>ue)L=0-(Q+M)|0,H=Q;else if(Ce=0-L|0,J>ue){H=Ce-M|0;break}else{H=Q,M=Ce-Q|0;break}while(!1);if(o[Z>>2]=L,o[Xe>>2]=H,o[_t>>2]=M,LA(Z),ul(x,T,Z,j+(ze<<3)|0)|0,(ze|0)==(F|0))break;ze=ze+1|0,M=o[k>>2]|0}return Z=0,st=u,Z|0}return Z=-1,st=u,Z|0}function hl(x,T){x=x|0,T=T|0;var M=0;if(!T)return M=1,M|0;M=x,x=1;do x=Ro(T&1|0?M:1,x)|0,T=T>>1,M=Ro(M,M)|0;while(T|0);return x|0}function Ha(x,T,M){x=x|0,T=T|0,M=M|0;var L=0,j=0,H=0,Q=0,J=0,ue=0,Ce=0,ze=0,_t=0,Xe=0;if(!(la(T,M)|0)||(T=vn(T)|0,Xe=+oe[M>>3],L=+oe[M+8>>3],L=T&L<0?L+6.283185307179586:L,_t=o[x>>2]|0,(_t|0)<=0))return _t=0,_t|0;if(ze=o[x+4>>2]|0,T){T=0,M=-1,x=0;e:for(;;){for(Ce=x;Q=+oe[ze+(Ce<<4)>>3],ue=+oe[ze+(Ce<<4)+8>>3],x=(M+2|0)%(_t|0)|0,H=+oe[ze+(x<<4)>>3],j=+oe[ze+(x<<4)+8>>3],Q>H?(J=Q,Q=ue):(J=H,H=Q,Q=j,j=ue),!!(Xe<H|Xe>J);)if(M=Ce+1|0,(M|0)<(_t|0))x=Ce,Ce=M,M=x;else{M=22;break e}if(ue=j<0?j+6.283185307179586:j,Q=Q<0?Q+6.283185307179586:Q,L=Q==L|ue==L?L+-2220446049250313e-31:L,ue=ue+(Xe-H)/(J-H)*(Q-ue),(ue<0?ue+6.283185307179586:ue)>L&&(T=T^1),x=Ce+1|0,(x|0)>=(_t|0)){M=22;break}else M=Ce}if((M|0)==22)return T|0}else{T=0,M=-1,x=0;e:for(;;){for(Ce=x;Q=+oe[ze+(Ce<<4)>>3],ue=+oe[ze+(Ce<<4)+8>>3],x=(M+2|0)%(_t|0)|0,H=+oe[ze+(x<<4)>>3],j=+oe[ze+(x<<4)+8>>3],Q>H?(J=Q,Q=ue):(J=H,H=Q,Q=j,j=ue),!!(Xe<H|Xe>J);)if(M=Ce+1|0,(M|0)<(_t|0))x=Ce,Ce=M,M=x;else{M=22;break e}if(L=Q==L|j==L?L+-2220446049250313e-31:L,j+(Xe-H)/(J-H)*(Q-j)>L&&(T=T^1),x=Ce+1|0,(x|0)>=(_t|0)){M=22;break}else M=Ce}if((M|0)==22)return T|0}return 0}function Fi(x,T){x=x|0,T=T|0;var M=0,L=0,j=0,H=0,Q=0,J=0,ue=0,Ce=0,ze=0,_t=0,Xe=0,it=0,z=0,l=0,g=0,S=0,k=0;if(z=o[x>>2]|0,!z){o[T>>2]=0,o[T+4>>2]=0,o[T+8>>2]=0,o[T+12>>2]=0,o[T+16>>2]=0,o[T+20>>2]=0,o[T+24>>2]=0,o[T+28>>2]=0;return}if(l=T+8|0,oe[l>>3]=17976931348623157e292,g=T+24|0,oe[g>>3]=17976931348623157e292,oe[T>>3]=-17976931348623157e292,S=T+16|0,oe[S>>3]=-17976931348623157e292,!((z|0)<=0)){for(Xe=o[x+4>>2]|0,Ce=17976931348623157e292,ze=-17976931348623157e292,_t=0,x=-1,H=17976931348623157e292,Q=17976931348623157e292,ue=-17976931348623157e292,L=-17976931348623157e292,it=0;M=+oe[Xe+(it<<4)>>3],J=+oe[Xe+(it<<4)+8>>3],x=x+2|0,j=+oe[Xe+(((x|0)==(z|0)?0:x)<<4)+8>>3],M<H&&(oe[l>>3]=M,H=M),J<Q&&(oe[g>>3]=J,Q=J),M>ue?oe[T>>3]=M:M=ue,J>L&&(oe[S>>3]=J,L=J),Ce=J>0&J<Ce?J:Ce,ze=J<0&J>ze?J:ze,_t=_t|+mi(+(J-j))>3.141592653589793,x=it+1|0,(x|0)!=(z|0);)k=it,ue=M,it=x,x=k;_t&&(oe[S>>3]=ze,oe[g>>3]=Ce)}}function jo(x,T){x=x|0,T=T|0;var M=0,L=0,j=0,H=0,Q=0,J=0,ue=0,Ce=0,ze=0,_t=0,Xe=0,it=0,z=0,l=0,g=0,S=0,k=0,F=0,Z=0,u=0,h=0,d=0;if(z=o[x>>2]|0,z){if(l=T+8|0,oe[l>>3]=17976931348623157e292,g=T+24|0,oe[g>>3]=17976931348623157e292,oe[T>>3]=-17976931348623157e292,S=T+16|0,oe[S>>3]=-17976931348623157e292,(z|0)>0){for(j=o[x+4>>2]|0,Xe=17976931348623157e292,it=-17976931348623157e292,L=0,M=-1,ue=17976931348623157e292,Ce=17976931348623157e292,_t=-17976931348623157e292,Q=-17976931348623157e292,k=0;H=+oe[j+(k<<4)>>3],ze=+oe[j+(k<<4)+8>>3],h=M+2|0,J=+oe[j+(((h|0)==(z|0)?0:h)<<4)+8>>3],H<ue&&(oe[l>>3]=H,ue=H),ze<Ce&&(oe[g>>3]=ze,Ce=ze),H>_t?oe[T>>3]=H:H=_t,ze>Q&&(oe[S>>3]=ze,Q=ze),Xe=ze>0&ze<Xe?ze:Xe,it=ze<0&ze>it?ze:it,L=L|+mi(+(ze-J))>3.141592653589793,M=k+1|0,(M|0)!=(z|0);)h=k,_t=H,k=M,M=h;L&&(oe[S>>3]=it,oe[g>>3]=Xe)}}else o[T>>2]=0,o[T+4>>2]=0,o[T+8>>2]=0,o[T+12>>2]=0,o[T+16>>2]=0,o[T+20>>2]=0,o[T+24>>2]=0,o[T+28>>2]=0;if(h=x+8|0,M=o[h>>2]|0,!((M|0)<=0)){u=x+12|0,Z=0;do if(j=o[u>>2]|0,L=Z,Z=Z+1|0,g=T+(Z<<5)|0,S=o[j+(L<<3)>>2]|0,S){if(k=T+(Z<<5)+8|0,oe[k>>3]=17976931348623157e292,x=T+(Z<<5)+24|0,oe[x>>3]=17976931348623157e292,oe[g>>3]=-17976931348623157e292,F=T+(Z<<5)+16|0,oe[F>>3]=-17976931348623157e292,(S|0)>0){for(z=o[j+(L<<3)+4>>2]|0,Xe=17976931348623157e292,it=-17976931348623157e292,j=0,L=-1,l=0,ue=17976931348623157e292,Ce=17976931348623157e292,ze=-17976931348623157e292,Q=-17976931348623157e292;H=+oe[z+(l<<4)>>3],_t=+oe[z+(l<<4)+8>>3],L=L+2|0,J=+oe[z+(((L|0)==(S|0)?0:L)<<4)+8>>3],H<ue&&(oe[k>>3]=H,ue=H),_t<Ce&&(oe[x>>3]=_t,Ce=_t),H>ze?oe[g>>3]=H:H=ze,_t>Q&&(oe[F>>3]=_t,Q=_t),Xe=_t>0&_t<Xe?_t:Xe,it=_t<0&_t>it?_t:it,j=j|+mi(+(_t-J))>3.141592653589793,L=l+1|0,(L|0)!=(S|0);)d=l,l=L,ze=H,L=d;j&&(oe[F>>3]=it,oe[x>>3]=Xe)}}else o[g>>2]=0,o[g+4>>2]=0,o[g+8>>2]=0,o[g+12>>2]=0,o[g+16>>2]=0,o[g+20>>2]=0,o[g+24>>2]=0,o[g+28>>2]=0,M=o[h>>2]|0;while((Z|0)<(M|0))}}function Wa(x,T,M){x=x|0,T=T|0,M=M|0;var L=0,j=0,H=0;if(!(Ha(x,T,M)|0))return j=0,j|0;if(j=x+8|0,(o[j>>2]|0)<=0)return j=1,j|0;for(L=x+12|0,x=0;;){if(H=x,x=x+1|0,Ha((o[L>>2]|0)+(H<<3)|0,T+(x<<5)|0,M)|0){x=0,L=6;break}if((x|0)>=(o[j>>2]|0)){x=1,L=6;break}}return(L|0)==6?x|0:0}function fl(){return 8}function ac(){return 16}function Ei(){return 168}function nA(){return 8}function VA(){return 16}function fa(){return 12}function yA(){return 8}function lc(x){x=x|0;var T=0,M=0;return M=+oe[x>>3],T=+oe[x+8>>3],+ +si(+(M*M+T*T))}function jA(x,T,M,L,j){x=x|0,T=T|0,M=M|0,L=L|0,j=j|0;var H=0,Q=0,J=0,ue=0,Ce=0,ze=0,_t=0,Xe=0;Ce=+oe[x>>3],ue=+oe[T>>3]-Ce,J=+oe[x+8>>3],Q=+oe[T+8>>3]-J,_t=+oe[M>>3],H=+oe[L>>3]-_t,Xe=+oe[M+8>>3],ze=+oe[L+8>>3]-Xe,H=(H*(J-Xe)-(Ce-_t)*ze)/(ue*ze-Q*H),oe[j>>3]=Ce+ue*H,oe[j+8>>3]=J+Q*H}function Ac(x,T){return x=x|0,T=T|0,+oe[x>>3]!=+oe[T>>3]?(T=0,T|0):(T=+oe[x+8>>3]==+oe[T+8>>3],T|0)}function ks(x,T){x=x|0,T=T|0;var M=0,L=0,j=0;return j=+oe[x>>3]-+oe[T>>3],L=+oe[x+8>>3]-+oe[T+8>>3],M=+oe[x+16>>3]-+oe[T+16>>3],+(j*j+L*L+M*M)}function xA(x,T){x=x|0,T=T|0;var M=0,L=0,j=0;M=+oe[x>>3],L=+gr(+M),M=+yi(+M),oe[T+16>>3]=M,M=+oe[x+8>>3],j=L*+gr(+M),oe[T>>3]=j,M=L*+yi(+M),oe[T+8>>3]=M}function GA(x,T){x=x|0,T=T|0;var M=0,L=0,j=0,H=0,Q=0,J=0,ue=0,Ce=0;if(Ce=st,st=st+32|0,j=Ce+16|0,H=Ce,vl(x,T,j),Q=gA(x,T)|0,ue=io(x,T)|0,Jt(Q,H),T=$i(Q,o[j>>2]|0)|0,!(ns(Q)|0))return ue=T,st=Ce,ue|0;do switch(Q|0){case 4:{x=0,M=14;break}case 14:{x=1,M=14;break}case 24:{x=2,M=14;break}case 38:{x=3,M=14;break}case 49:{x=4,M=14;break}case 58:{x=5,M=14;break}case 63:{x=6,M=14;break}case 72:{x=7,M=14;break}case 83:{x=8,M=14;break}case 97:{x=9,M=14;break}case 107:{x=10,M=14;break}case 117:{x=11,M=14;break}default:J=0,L=0}while(!1);return(M|0)==14&&(J=o[22096+(x*24|0)+8>>2]|0,L=o[22096+(x*24|0)+16>>2]|0),x=o[j>>2]|0,(x|0)!=(o[H>>2]|0)&&(Q=tc(Q)|0,x=o[j>>2]|0,Q|(x|0)==(L|0)&&(T=(T+1|0)%6|0)),(ue|0)==3&(x|0)==(L|0)?(ue=(T+5|0)%6|0,st=Ce,ue|0):(ue|0)==5&(x|0)==(J|0)?(ue=(T+1|0)%6|0,st=Ce,ue|0):(ue=T,st=Ce,ue|0)}function ZA(x,T,M){x=x|0,T=T|0,M=M|0;var L=0,j=0;return L=Qs(x,T)|0,(M+-1|0)>>>0>5||(j=(L|0)!=0,(M|0)==1&j)?(M=-1,M|0):(L=GA(x,T)|0,j?(M=(5-L+(o[22384+(M<<2)>>2]|0)|0)%5|0,M|0):(M=(6-L+(o[22416+(M<<2)>>2]|0)|0)%6|0,M|0))}function Ki(x,T,M){x=x|0,T=T|0,M=M|0;var L=0;(T|0)>0?(L=ra(T,4)|0,o[x>>2]=L,L||Ci(23230,23253,40,23267)):o[x>>2]=0,o[x+4>>2]=T,o[x+8>>2]=0,o[x+12>>2]=M}function Po(x){x=x|0;var T=0,M=0,L=0,j=0,H=0,Q=0,J=0;j=x+4|0,H=x+12|0,Q=x+8|0;e:for(;;){for(M=o[j>>2]|0,T=0;;){if((T|0)>=(M|0))break e;if(L=o[x>>2]|0,J=o[L+(T<<2)>>2]|0,!J)T=T+1|0;else break}T=L+(~~(+mi(+(+hi(10,+ +(15-(o[H>>2]|0)|0))*(+oe[J>>3]+ +oe[J+8>>3])))%+(M|0))>>>0<<2)|0,M=o[T>>2]|0;t:do if(M|0){if(L=J+32|0,(M|0)==(J|0))o[T>>2]=o[L>>2];else{if(M=M+32|0,T=o[M>>2]|0,!T)break;for(;(T|0)!=(J|0);)if(M=T+32|0,T=o[M>>2]|0,!T)break t;o[M>>2]=o[L>>2]}pr(J),o[Q>>2]=(o[Q>>2]|0)+-1}while(!1)}pr(o[x>>2]|0)}function ka(x){x=x|0;var T=0,M=0,L=0;for(L=o[x+4>>2]|0,M=0;;){if((M|0)>=(L|0)){T=0,M=4;break}if(T=o[(o[x>>2]|0)+(M<<2)>>2]|0,!T)M=M+1|0;else{M=4;break}}return(M|0)==4?T|0:0}function sA(x,T){x=x|0,T=T|0;var M=0,L=0,j=0,H=0;if(M=~~(+mi(+(+hi(10,+ +(15-(o[x+12>>2]|0)|0))*(+oe[T>>3]+ +oe[T+8>>3])))%+(o[x+4>>2]|0))>>>0,M=(o[x>>2]|0)+(M<<2)|0,L=o[M>>2]|0,!L)return H=1,H|0;H=T+32|0;do if((L|0)!=(T|0)){if(M=o[L+32>>2]|0,!M)return H=1,H|0;for(j=M;;){if((j|0)==(T|0)){j=8;break}if(M=o[j+32>>2]|0,M)L=j,j=M;else{M=1,j=10;break}}if((j|0)==8){o[L+32>>2]=o[H>>2];break}else if((j|0)==10)return M|0}else o[M>>2]=o[H>>2];while(!1);return pr(T),H=x+8|0,o[H>>2]=(o[H>>2]|0)+-1,H=0,H|0}function cc(x,T,M){x=x|0,T=T|0,M=M|0;var L=0,j=0,H=0,Q=0;H=Eo(40)|0,H||Ci(23283,23253,98,23296),o[H>>2]=o[T>>2],o[H+4>>2]=o[T+4>>2],o[H+8>>2]=o[T+8>>2],o[H+12>>2]=o[T+12>>2],j=H+16|0,o[j>>2]=o[M>>2],o[j+4>>2]=o[M+4>>2],o[j+8>>2]=o[M+8>>2],o[j+12>>2]=o[M+12>>2],o[H+32>>2]=0,j=~~(+mi(+(+hi(10,+ +(15-(o[x+12>>2]|0)|0))*(+oe[T>>3]+ +oe[T+8>>3])))%+(o[x+4>>2]|0))>>>0,j=(o[x>>2]|0)+(j<<2)|0,L=o[j>>2]|0;do if(!L)o[j>>2]=H;else{for(;!(qs(L,T)|0&&qs(L+16|0,M)|0);)if(j=o[L+32>>2]|0,L=j|0?j:L,!(o[L+32>>2]|0)){Q=10;break}if((Q|0)==10){o[L+32>>2]=H;break}return pr(H),Q=L,Q|0}while(!1);return Q=x+8|0,o[Q>>2]=(o[Q>>2]|0)+1,Q=H,Q|0}function oA(x,T,M){x=x|0,T=T|0,M=M|0;var L=0,j=0;if(j=~~(+mi(+(+hi(10,+ +(15-(o[x+12>>2]|0)|0))*(+oe[T>>3]+ +oe[T+8>>3])))%+(o[x+4>>2]|0))>>>0,j=o[(o[x>>2]|0)+(j<<2)>>2]|0,!j)return M=0,M|0;if(!M){for(x=j;;){if(qs(x,T)|0){L=10;break}if(x=o[x+32>>2]|0,!x){x=0,L=10;break}}if((L|0)==10)return x|0}for(x=j;;){if(qs(x,T)|0&&qs(x+16|0,M)|0){L=10;break}if(x=o[x+32>>2]|0,!x){x=0,L=10;break}}return(L|0)==10?x|0:0}function Tl(x,T){x=x|0,T=T|0;var M=0;if(M=~~(+mi(+(+hi(10,+ +(15-(o[x+12>>2]|0)|0))*(+oe[T>>3]+ +oe[T+8>>3])))%+(o[x+4>>2]|0))>>>0,x=o[(o[x>>2]|0)+(M<<2)>>2]|0,!x)return M=0,M|0;for(;;){if(qs(x,T)|0){T=5;break}if(x=o[x+32>>2]|0,!x){x=0,T=5;break}}return(T|0)==5?x|0:0}function Ds(){return 23312}function da(x){return x=+x,+ +pa(+x)}function Qn(x){return x=+x,~~+da(x)|0}function Eo(x){x=x|0;var T=0,M=0,L=0,j=0,H=0,Q=0,J=0,ue=0,Ce=0,ze=0,_t=0,Xe=0,it=0,z=0,l=0,g=0,S=0,k=0,F=0,Z=0,u=0;u=st,st=st+16|0,Xe=u;do if(x>>>0<245){if(Ce=x>>>0<11?16:x+11&-8,x=Ce>>>3,_t=o[5829]|0,M=_t>>>x,M&3|0)return T=(M&1^1)+x|0,x=23356+(T<<1<<2)|0,M=x+8|0,L=o[M>>2]|0,j=L+8|0,H=o[j>>2]|0,(H|0)==(x|0)?o[5829]=_t&~(1<<T):(o[H+12>>2]=x,o[M>>2]=H),Z=T<<3,o[L+4>>2]=Z|3,Z=L+Z+4|0,o[Z>>2]=o[Z>>2]|1,Z=j,st=u,Z|0;if(ze=o[5831]|0,Ce>>>0>ze>>>0){if(M|0)return T=2<<x,T=M<<x&(T|0-T),T=(T&0-T)+-1|0,J=T>>>12&16,T=T>>>J,M=T>>>5&8,T=T>>>M,H=T>>>2&4,T=T>>>H,x=T>>>1&2,T=T>>>x,L=T>>>1&1,L=(M|J|H|x|L)+(T>>>L)|0,T=23356+(L<<1<<2)|0,x=T+8|0,H=o[x>>2]|0,J=H+8|0,M=o[J>>2]|0,(M|0)==(T|0)?(x=_t&~(1<<L),o[5829]=x):(o[M+12>>2]=T,o[x>>2]=M,x=_t),Z=L<<3,Q=Z-Ce|0,o[H+4>>2]=Ce|3,j=H+Ce|0,o[j+4>>2]=Q|1,o[H+Z>>2]=Q,ze|0&&(L=o[5834]|0,T=ze>>>3,M=23356+(T<<1<<2)|0,T=1<<T,x&T?(x=M+8|0,T=o[x>>2]|0):(o[5829]=x|T,T=M,x=M+8|0),o[x>>2]=L,o[T+12>>2]=L,o[L+8>>2]=T,o[L+12>>2]=M),o[5831]=Q,o[5834]=j,Z=J,st=u,Z|0;if(H=o[5830]|0,H){for(M=(H&0-H)+-1|0,j=M>>>12&16,M=M>>>j,L=M>>>5&8,M=M>>>L,Q=M>>>2&4,M=M>>>Q,J=M>>>1&2,M=M>>>J,ue=M>>>1&1,ue=o[23620+((L|j|Q|J|ue)+(M>>>ue)<<2)>>2]|0,M=ue,J=ue,ue=(o[ue+4>>2]&-8)-Ce|0;x=o[M+16>>2]|0,!(!x&&(x=o[M+20>>2]|0,!x));)Q=(o[x+4>>2]&-8)-Ce|0,j=Q>>>0<ue>>>0,M=x,J=j?x:J,ue=j?Q:ue;if(Q=J+Ce|0,Q>>>0>J>>>0){j=o[J+24>>2]|0,T=o[J+12>>2]|0;do if((T|0)==(J|0)){if(x=J+20|0,T=o[x>>2]|0,!T&&(x=J+16|0,T=o[x>>2]|0,!T)){M=0;break}for(;;)if(L=T+20|0,M=o[L>>2]|0,M)T=M,x=L;else if(L=T+16|0,M=o[L>>2]|0,M)T=M,x=L;else break;o[x>>2]=0,M=T}else M=o[J+8>>2]|0,o[M+12>>2]=T,o[T+8>>2]=M,M=T;while(!1);do if(j|0){if(T=o[J+28>>2]|0,x=23620+(T<<2)|0,(J|0)==(o[x>>2]|0)){if(o[x>>2]=M,!M){o[5830]=H&~(1<<T);break}}else if(Z=j+16|0,o[((o[Z>>2]|0)==(J|0)?Z:j+20|0)>>2]=M,!M)break;o[M+24>>2]=j,T=o[J+16>>2]|0,T|0&&(o[M+16>>2]=T,o[T+24>>2]=M),T=o[J+20>>2]|0,T|0&&(o[M+20>>2]=T,o[T+24>>2]=M)}while(!1);return ue>>>0<16?(Z=ue+Ce|0,o[J+4>>2]=Z|3,Z=J+Z+4|0,o[Z>>2]=o[Z>>2]|1):(o[J+4>>2]=Ce|3,o[Q+4>>2]=ue|1,o[Q+ue>>2]=ue,ze|0&&(L=o[5834]|0,T=ze>>>3,M=23356+(T<<1<<2)|0,T=1<<T,T&_t?(x=M+8|0,T=o[x>>2]|0):(o[5829]=T|_t,T=M,x=M+8|0),o[x>>2]=L,o[T+12>>2]=L,o[L+8>>2]=T,o[L+12>>2]=M),o[5831]=ue,o[5834]=Q),Z=J+8|0,st=u,Z|0}else _t=Ce}else _t=Ce}else _t=Ce}else if(x>>>0<=4294967231)if(x=x+11|0,Ce=x&-8,L=o[5830]|0,L){j=0-Ce|0,x=x>>>8,x?Ce>>>0>16777215?ue=31:(_t=(x+1048320|0)>>>16&8,l=x<<_t,J=(l+520192|0)>>>16&4,l=l<<J,ue=(l+245760|0)>>>16&2,ue=14-(J|_t|ue)+(l<<ue>>>15)|0,ue=Ce>>>(ue+7|0)&1|ue<<1):ue=0,M=o[23620+(ue<<2)>>2]|0;e:do if(!M)M=0,x=0,l=61;else for(x=0,J=Ce<<((ue|0)==31?0:25-(ue>>>1)|0),H=0;;){if(Q=(o[M+4>>2]&-8)-Ce|0,Q>>>0<j>>>0)if(Q)x=M,j=Q;else{x=M,j=0,l=65;break e}if(l=o[M+20>>2]|0,M=o[M+16+(J>>>31<<2)>>2]|0,H=(l|0)==0|(l|0)==(M|0)?H:l,M)J=J<<1;else{M=H,l=61;break}}while(!1);if((l|0)==61){if((M|0)==0&(x|0)==0){if(x=2<<ue,x=(x|0-x)&L,!x){_t=Ce;break}_t=(x&0-x)+-1|0,Q=_t>>>12&16,_t=_t>>>Q,H=_t>>>5&8,_t=_t>>>H,J=_t>>>2&4,_t=_t>>>J,ue=_t>>>1&2,_t=_t>>>ue,M=_t>>>1&1,x=0,M=o[23620+((H|Q|J|ue|M)+(_t>>>M)<<2)>>2]|0}M?l=65:(J=x,Q=j)}if((l|0)==65)for(H=M;;)if(_t=(o[H+4>>2]&-8)-Ce|0,M=_t>>>0<j>>>0,j=M?_t:j,x=M?H:x,M=o[H+16>>2]|0,M||(M=o[H+20>>2]|0),M)H=M;else{J=x,Q=j;break}if(J|0&&Q>>>0<((o[5831]|0)-Ce|0)>>>0&&(ze=J+Ce|0,ze>>>0>J>>>0)){H=o[J+24>>2]|0,T=o[J+12>>2]|0;do if((T|0)==(J|0)){if(x=J+20|0,T=o[x>>2]|0,!T&&(x=J+16|0,T=o[x>>2]|0,!T)){T=0;break}for(;;)if(j=T+20|0,M=o[j>>2]|0,M)T=M,x=j;else if(j=T+16|0,M=o[j>>2]|0,M)T=M,x=j;else break;o[x>>2]=0}else Z=o[J+8>>2]|0,o[Z+12>>2]=T,o[T+8>>2]=Z;while(!1);do if(H){if(x=o[J+28>>2]|0,M=23620+(x<<2)|0,(J|0)==(o[M>>2]|0)){if(o[M>>2]=T,!T){L=L&~(1<<x),o[5830]=L;break}}else if(Z=H+16|0,o[((o[Z>>2]|0)==(J|0)?Z:H+20|0)>>2]=T,!T)break;o[T+24>>2]=H,x=o[J+16>>2]|0,x|0&&(o[T+16>>2]=x,o[x+24>>2]=T),x=o[J+20>>2]|0,x&&(o[T+20>>2]=x,o[x+24>>2]=T)}while(!1);e:do if(Q>>>0<16)Z=Q+Ce|0,o[J+4>>2]=Z|3,Z=J+Z+4|0,o[Z>>2]=o[Z>>2]|1;else{if(o[J+4>>2]=Ce|3,o[ze+4>>2]=Q|1,o[ze+Q>>2]=Q,T=Q>>>3,Q>>>0<256){M=23356+(T<<1<<2)|0,x=o[5829]|0,T=1<<T,x&T?(x=M+8|0,T=o[x>>2]|0):(o[5829]=x|T,T=M,x=M+8|0),o[x>>2]=ze,o[T+12>>2]=ze,o[ze+8>>2]=T,o[ze+12>>2]=M;break}if(T=Q>>>8,T?Q>>>0>16777215?M=31:(F=(T+1048320|0)>>>16&8,Z=T<<F,k=(Z+520192|0)>>>16&4,Z=Z<<k,M=(Z+245760|0)>>>16&2,M=14-(k|F|M)+(Z<<M>>>15)|0,M=Q>>>(M+7|0)&1|M<<1):M=0,T=23620+(M<<2)|0,o[ze+28>>2]=M,x=ze+16|0,o[x+4>>2]=0,o[x>>2]=0,x=1<<M,!(L&x)){o[5830]=L|x,o[T>>2]=ze,o[ze+24>>2]=T,o[ze+12>>2]=ze,o[ze+8>>2]=ze;break}T=o[T>>2]|0;t:do if((o[T+4>>2]&-8|0)!=(Q|0)){for(L=Q<<((M|0)==31?0:25-(M>>>1)|0);M=T+16+(L>>>31<<2)|0,x=o[M>>2]|0,!!x;)if((o[x+4>>2]&-8|0)==(Q|0)){T=x;break t}else L=L<<1,T=x;o[M>>2]=ze,o[ze+24>>2]=T,o[ze+12>>2]=ze,o[ze+8>>2]=ze;break e}while(!1);F=T+8|0,Z=o[F>>2]|0,o[Z+12>>2]=ze,o[F>>2]=ze,o[ze+8>>2]=Z,o[ze+12>>2]=T,o[ze+24>>2]=0}while(!1);return Z=J+8|0,st=u,Z|0}else _t=Ce}else _t=Ce;else _t=-1;while(!1);if(M=o[5831]|0,M>>>0>=_t>>>0)return T=M-_t|0,x=o[5834]|0,T>>>0>15?(Z=x+_t|0,o[5834]=Z,o[5831]=T,o[Z+4>>2]=T|1,o[x+M>>2]=T,o[x+4>>2]=_t|3):(o[5831]=0,o[5834]=0,o[x+4>>2]=M|3,Z=x+M+4|0,o[Z>>2]=o[Z>>2]|1),Z=x+8|0,st=u,Z|0;if(Q=o[5832]|0,Q>>>0>_t>>>0)return k=Q-_t|0,o[5832]=k,Z=o[5835]|0,F=Z+_t|0,o[5835]=F,o[F+4>>2]=k|1,o[Z+4>>2]=_t|3,Z=Z+8|0,st=u,Z|0;if(o[5947]|0?x=o[5949]|0:(o[5949]=4096,o[5948]=4096,o[5950]=-1,o[5951]=-1,o[5952]=0,o[5940]=0,o[5947]=Xe&-16^1431655768,x=4096),J=_t+48|0,ue=_t+47|0,H=x+ue|0,j=0-x|0,Ce=H&j,Ce>>>0<=_t>>>0||(x=o[5939]|0,x|0&&(ze=o[5937]|0,Xe=ze+Ce|0,Xe>>>0<=ze>>>0|Xe>>>0>x>>>0)))return Z=0,st=u,Z|0;e:do if(o[5940]&4)T=0,l=143;else{M=o[5835]|0;t:do if(M){for(L=23764;Xe=o[L>>2]|0,!(Xe>>>0<=M>>>0&&(Xe+(o[L+4>>2]|0)|0)>>>0>M>>>0);)if(x=o[L+8>>2]|0,x)L=x;else{l=128;break t}if(T=H-Q&j,T>>>0<2147483647)if(x=Hn(T|0)|0,(x|0)==((o[L>>2]|0)+(o[L+4>>2]|0)|0)){if((x|0)!=-1){Q=T,H=x,l=145;break e}}else L=x,l=136;else T=0}else l=128;while(!1);do if((l|0)==128)if(M=Hn(0)|0,(M|0)!=-1&&(T=M,it=o[5948]|0,z=it+-1|0,T=(z&T|0?(z+T&0-it)-T|0:0)+Ce|0,it=o[5937]|0,z=T+it|0,T>>>0>_t>>>0&T>>>0<2147483647)){if(Xe=o[5939]|0,Xe|0&&z>>>0<=it>>>0|z>>>0>Xe>>>0){T=0;break}if(x=Hn(T|0)|0,(x|0)==(M|0)){Q=T,H=M,l=145;break e}else L=x,l=136}else T=0;while(!1);do if((l|0)==136){if(M=0-T|0,!(J>>>0>T>>>0&(T>>>0<2147483647&(L|0)!=-1)))if((L|0)==-1){T=0;break}else{Q=T,H=L,l=145;break e}if(x=o[5949]|0,x=ue-T+x&0-x,x>>>0>=2147483647){Q=T,H=L,l=145;break e}if((Hn(x|0)|0)==-1){Hn(M|0)|0,T=0;break}else{Q=x+T|0,H=L,l=145;break e}}while(!1);o[5940]=o[5940]|4,l=143}while(!1);if((l|0)==143&&Ce>>>0<2147483647&&(k=Hn(Ce|0)|0,z=Hn(0)|0,g=z-k|0,S=g>>>0>(_t+40|0)>>>0,!((k|0)==-1|S^1|k>>>0<z>>>0&((k|0)!=-1&(z|0)!=-1)^1))&&(Q=S?g:T,H=k,l=145),(l|0)==145){T=(o[5937]|0)+Q|0,o[5937]=T,T>>>0>(o[5938]|0)>>>0&&(o[5938]=T),ue=o[5835]|0;e:do if(ue){for(T=23764;;){if(x=o[T>>2]|0,M=o[T+4>>2]|0,(H|0)==(x+M|0)){l=154;break}if(L=o[T+8>>2]|0,L)T=L;else break}if((l|0)==154&&(F=T+4|0,(o[T+12>>2]&8|0)==0)&&H>>>0>ue>>>0&x>>>0<=ue>>>0){o[F>>2]=M+Q,Z=(o[5832]|0)+Q|0,k=ue+8|0,k=k&7|0?0-k&7:0,F=ue+k|0,k=Z-k|0,o[5835]=F,o[5832]=k,o[F+4>>2]=k|1,o[ue+Z+4>>2]=40,o[5836]=o[5951];break}for(H>>>0<(o[5833]|0)>>>0&&(o[5833]=H),M=H+Q|0,T=23764;;){if((o[T>>2]|0)==(M|0)){l=162;break}if(x=o[T+8>>2]|0,x)T=x;else break}if((l|0)==162&&!(o[T+12>>2]&8|0)){o[T>>2]=H,ze=T+4|0,o[ze>>2]=(o[ze>>2]|0)+Q,ze=H+8|0,ze=H+(ze&7|0?0-ze&7:0)|0,T=M+8|0,T=M+(T&7|0?0-T&7:0)|0,Ce=ze+_t|0,J=T-ze-_t|0,o[ze+4>>2]=_t|3;t:do if((ue|0)==(T|0))Z=(o[5832]|0)+J|0,o[5832]=Z,o[5835]=Ce,o[Ce+4>>2]=Z|1;else{if((o[5834]|0)==(T|0)){Z=(o[5831]|0)+J|0,o[5831]=Z,o[5834]=Ce,o[Ce+4>>2]=Z|1,o[Ce+Z>>2]=Z;break}if(x=o[T+4>>2]|0,(x&3|0)==1){Q=x&-8,L=x>>>3;i:do if(x>>>0<256)if(x=o[T+8>>2]|0,M=o[T+12>>2]|0,(M|0)==(x|0)){o[5829]=o[5829]&~(1<<L);break}else{o[x+12>>2]=M,o[M+8>>2]=x;break}else{H=o[T+24>>2]|0,x=o[T+12>>2]|0;do if((x|0)==(T|0)){if(M=T+16|0,L=M+4|0,x=o[L>>2]|0,x)M=L;else if(x=o[M>>2]|0,!x){x=0;break}for(;;)if(j=x+20|0,L=o[j>>2]|0,L)x=L,M=j;else if(j=x+16|0,L=o[j>>2]|0,L)x=L,M=j;else break;o[M>>2]=0}else Z=o[T+8>>2]|0,o[Z+12>>2]=x,o[x+8>>2]=Z;while(!1);if(!H)break;M=o[T+28>>2]|0,L=23620+(M<<2)|0;do if((o[L>>2]|0)!=(T|0)){if(Z=H+16|0,o[((o[Z>>2]|0)==(T|0)?Z:H+20|0)>>2]=x,!x)break i}else{if(o[L>>2]=x,x|0)break;o[5830]=o[5830]&~(1<<M);break i}while(!1);if(o[x+24>>2]=H,M=T+16|0,L=o[M>>2]|0,L|0&&(o[x+16>>2]=L,o[L+24>>2]=x),M=o[M+4>>2]|0,!M)break;o[x+20>>2]=M,o[M+24>>2]=x}while(!1);T=T+Q|0,j=Q+J|0}else j=J;if(T=T+4|0,o[T>>2]=o[T>>2]&-2,o[Ce+4>>2]=j|1,o[Ce+j>>2]=j,T=j>>>3,j>>>0<256){M=23356+(T<<1<<2)|0,x=o[5829]|0,T=1<<T,x&T?(x=M+8|0,T=o[x>>2]|0):(o[5829]=x|T,T=M,x=M+8|0),o[x>>2]=Ce,o[T+12>>2]=Ce,o[Ce+8>>2]=T,o[Ce+12>>2]=M;break}T=j>>>8;do if(!T)L=0;else{if(j>>>0>16777215){L=31;break}F=(T+1048320|0)>>>16&8,Z=T<<F,k=(Z+520192|0)>>>16&4,Z=Z<<k,L=(Z+245760|0)>>>16&2,L=14-(k|F|L)+(Z<<L>>>15)|0,L=j>>>(L+7|0)&1|L<<1}while(!1);if(T=23620+(L<<2)|0,o[Ce+28>>2]=L,x=Ce+16|0,o[x+4>>2]=0,o[x>>2]=0,x=o[5830]|0,M=1<<L,!(x&M)){o[5830]=x|M,o[T>>2]=Ce,o[Ce+24>>2]=T,o[Ce+12>>2]=Ce,o[Ce+8>>2]=Ce;break}T=o[T>>2]|0;i:do if((o[T+4>>2]&-8|0)!=(j|0)){for(L=j<<((L|0)==31?0:25-(L>>>1)|0);M=T+16+(L>>>31<<2)|0,x=o[M>>2]|0,!!x;)if((o[x+4>>2]&-8|0)==(j|0)){T=x;break i}else L=L<<1,T=x;o[M>>2]=Ce,o[Ce+24>>2]=T,o[Ce+12>>2]=Ce,o[Ce+8>>2]=Ce;break t}while(!1);F=T+8|0,Z=o[F>>2]|0,o[Z+12>>2]=Ce,o[F>>2]=Ce,o[Ce+8>>2]=Z,o[Ce+12>>2]=T,o[Ce+24>>2]=0}while(!1);return Z=ze+8|0,st=u,Z|0}for(T=23764;x=o[T>>2]|0,!(x>>>0<=ue>>>0&&(Z=x+(o[T+4>>2]|0)|0,Z>>>0>ue>>>0));)T=o[T+8>>2]|0;j=Z+-47|0,x=j+8|0,x=j+(x&7|0?0-x&7:0)|0,j=ue+16|0,x=x>>>0<j>>>0?ue:x,T=x+8|0,M=Q+-40|0,k=H+8|0,k=k&7|0?0-k&7:0,F=H+k|0,k=M-k|0,o[5835]=F,o[5832]=k,o[F+4>>2]=k|1,o[H+M+4>>2]=40,o[5836]=o[5951],M=x+4|0,o[M>>2]=27,o[T>>2]=o[5941],o[T+4>>2]=o[5942],o[T+8>>2]=o[5943],o[T+12>>2]=o[5944],o[5941]=H,o[5942]=Q,o[5944]=0,o[5943]=T,T=x+24|0;do F=T,T=T+4|0,o[T>>2]=7;while((F+8|0)>>>0<Z>>>0);if((x|0)!=(ue|0)){if(H=x-ue|0,o[M>>2]=o[M>>2]&-2,o[ue+4>>2]=H|1,o[x>>2]=H,T=H>>>3,H>>>0<256){M=23356+(T<<1<<2)|0,x=o[5829]|0,T=1<<T,x&T?(x=M+8|0,T=o[x>>2]|0):(o[5829]=x|T,T=M,x=M+8|0),o[x>>2]=ue,o[T+12>>2]=ue,o[ue+8>>2]=T,o[ue+12>>2]=M;break}if(T=H>>>8,T?H>>>0>16777215?L=31:(F=(T+1048320|0)>>>16&8,Z=T<<F,k=(Z+520192|0)>>>16&4,Z=Z<<k,L=(Z+245760|0)>>>16&2,L=14-(k|F|L)+(Z<<L>>>15)|0,L=H>>>(L+7|0)&1|L<<1):L=0,M=23620+(L<<2)|0,o[ue+28>>2]=L,o[ue+20>>2]=0,o[j>>2]=0,T=o[5830]|0,x=1<<L,!(T&x)){o[5830]=T|x,o[M>>2]=ue,o[ue+24>>2]=M,o[ue+12>>2]=ue,o[ue+8>>2]=ue;break}T=o[M>>2]|0;t:do if((o[T+4>>2]&-8|0)!=(H|0)){for(L=H<<((L|0)==31?0:25-(L>>>1)|0);M=T+16+(L>>>31<<2)|0,x=o[M>>2]|0,!!x;)if((o[x+4>>2]&-8|0)==(H|0)){T=x;break t}else L=L<<1,T=x;o[M>>2]=ue,o[ue+24>>2]=T,o[ue+12>>2]=ue,o[ue+8>>2]=ue;break e}while(!1);F=T+8|0,Z=o[F>>2]|0,o[Z+12>>2]=ue,o[F>>2]=ue,o[ue+8>>2]=Z,o[ue+12>>2]=T,o[ue+24>>2]=0}}else Z=o[5833]|0,(Z|0)==0|H>>>0<Z>>>0&&(o[5833]=H),o[5941]=H,o[5942]=Q,o[5944]=0,o[5838]=o[5947],o[5837]=-1,o[5842]=23356,o[5841]=23356,o[5844]=23364,o[5843]=23364,o[5846]=23372,o[5845]=23372,o[5848]=23380,o[5847]=23380,o[5850]=23388,o[5849]=23388,o[5852]=23396,o[5851]=23396,o[5854]=23404,o[5853]=23404,o[5856]=23412,o[5855]=23412,o[5858]=23420,o[5857]=23420,o[5860]=23428,o[5859]=23428,o[5862]=23436,o[5861]=23436,o[5864]=23444,o[5863]=23444,o[5866]=23452,o[5865]=23452,o[5868]=23460,o[5867]=23460,o[5870]=23468,o[5869]=23468,o[5872]=23476,o[5871]=23476,o[5874]=23484,o[5873]=23484,o[5876]=23492,o[5875]=23492,o[5878]=23500,o[5877]=23500,o[5880]=23508,o[5879]=23508,o[5882]=23516,o[5881]=23516,o[5884]=23524,o[5883]=23524,o[5886]=23532,o[5885]=23532,o[5888]=23540,o[5887]=23540,o[5890]=23548,o[5889]=23548,o[5892]=23556,o[5891]=23556,o[5894]=23564,o[5893]=23564,o[5896]=23572,o[5895]=23572,o[5898]=23580,o[5897]=23580,o[5900]=23588,o[5899]=23588,o[5902]=23596,o[5901]=23596,o[5904]=23604,o[5903]=23604,Z=Q+-40|0,k=H+8|0,k=k&7|0?0-k&7:0,F=H+k|0,k=Z-k|0,o[5835]=F,o[5832]=k,o[F+4>>2]=k|1,o[H+Z+4>>2]=40,o[5836]=o[5951];while(!1);if(T=o[5832]|0,T>>>0>_t>>>0)return k=T-_t|0,o[5832]=k,Z=o[5835]|0,F=Z+_t|0,o[5835]=F,o[F+4>>2]=k|1,o[Z+4>>2]=_t|3,Z=Z+8|0,st=u,Z|0}return Z=Ds()|0,o[Z>>2]=12,Z=0,st=u,Z|0}function pr(x){x=x|0;var T=0,M=0,L=0,j=0,H=0,Q=0,J=0,ue=0;if(x){M=x+-8|0,j=o[5833]|0,x=o[x+-4>>2]|0,T=x&-8,ue=M+T|0;do if(x&1)J=M,Q=M;else{if(L=o[M>>2]|0,!(x&3)||(Q=M+(0-L)|0,H=L+T|0,Q>>>0<j>>>0))return;if((o[5834]|0)==(Q|0)){if(x=ue+4|0,T=o[x>>2]|0,(T&3|0)!=3){J=Q,T=H;break}o[5831]=H,o[x>>2]=T&-2,o[Q+4>>2]=H|1,o[Q+H>>2]=H;return}if(M=L>>>3,L>>>0<256)if(x=o[Q+8>>2]|0,T=o[Q+12>>2]|0,(T|0)==(x|0)){o[5829]=o[5829]&~(1<<M),J=Q,T=H;break}else{o[x+12>>2]=T,o[T+8>>2]=x,J=Q,T=H;break}j=o[Q+24>>2]|0,x=o[Q+12>>2]|0;do if((x|0)==(Q|0)){if(T=Q+16|0,M=T+4|0,x=o[M>>2]|0,x)T=M;else if(x=o[T>>2]|0,!x){x=0;break}for(;;)if(L=x+20|0,M=o[L>>2]|0,M)x=M,T=L;else if(L=x+16|0,M=o[L>>2]|0,M)x=M,T=L;else break;o[T>>2]=0}else J=o[Q+8>>2]|0,o[J+12>>2]=x,o[x+8>>2]=J;while(!1);if(j){if(T=o[Q+28>>2]|0,M=23620+(T<<2)|0,(o[M>>2]|0)==(Q|0)){if(o[M>>2]=x,!x){o[5830]=o[5830]&~(1<<T),J=Q,T=H;break}}else if(J=j+16|0,o[((o[J>>2]|0)==(Q|0)?J:j+20|0)>>2]=x,!x){J=Q,T=H;break}o[x+24>>2]=j,T=Q+16|0,M=o[T>>2]|0,M|0&&(o[x+16>>2]=M,o[M+24>>2]=x),T=o[T+4>>2]|0,T?(o[x+20>>2]=T,o[T+24>>2]=x,J=Q,T=H):(J=Q,T=H)}else J=Q,T=H}while(!1);if(!(Q>>>0>=ue>>>0)&&(x=ue+4|0,L=o[x>>2]|0,!!(L&1))){if(L&2)o[x>>2]=L&-2,o[J+4>>2]=T|1,o[Q+T>>2]=T,j=T;else{if((o[5835]|0)==(ue|0)){if(ue=(o[5832]|0)+T|0,o[5832]=ue,o[5835]=J,o[J+4>>2]=ue|1,(J|0)!=(o[5834]|0))return;o[5834]=0,o[5831]=0;return}if((o[5834]|0)==(ue|0)){ue=(o[5831]|0)+T|0,o[5831]=ue,o[5834]=Q,o[J+4>>2]=ue|1,o[Q+ue>>2]=ue;return}j=(L&-8)+T|0,M=L>>>3;do if(L>>>0<256)if(T=o[ue+8>>2]|0,x=o[ue+12>>2]|0,(x|0)==(T|0)){o[5829]=o[5829]&~(1<<M);break}else{o[T+12>>2]=x,o[x+8>>2]=T;break}else{H=o[ue+24>>2]|0,x=o[ue+12>>2]|0;do if((x|0)==(ue|0)){if(T=ue+16|0,M=T+4|0,x=o[M>>2]|0,x)T=M;else if(x=o[T>>2]|0,!x){M=0;break}for(;;)if(L=x+20|0,M=o[L>>2]|0,M)x=M,T=L;else if(L=x+16|0,M=o[L>>2]|0,M)x=M,T=L;else break;o[T>>2]=0,M=x}else M=o[ue+8>>2]|0,o[M+12>>2]=x,o[x+8>>2]=M,M=x;while(!1);if(H|0){if(x=o[ue+28>>2]|0,T=23620+(x<<2)|0,(o[T>>2]|0)==(ue|0)){if(o[T>>2]=M,!M){o[5830]=o[5830]&~(1<<x);break}}else if(L=H+16|0,o[((o[L>>2]|0)==(ue|0)?L:H+20|0)>>2]=M,!M)break;o[M+24>>2]=H,x=ue+16|0,T=o[x>>2]|0,T|0&&(o[M+16>>2]=T,o[T+24>>2]=M),x=o[x+4>>2]|0,x|0&&(o[M+20>>2]=x,o[x+24>>2]=M)}}while(!1);if(o[J+4>>2]=j|1,o[Q+j>>2]=j,(J|0)==(o[5834]|0)){o[5831]=j;return}}if(x=j>>>3,j>>>0<256){M=23356+(x<<1<<2)|0,T=o[5829]|0,x=1<<x,T&x?(T=M+8|0,x=o[T>>2]|0):(o[5829]=T|x,x=M,T=M+8|0),o[T>>2]=J,o[x+12>>2]=J,o[J+8>>2]=x,o[J+12>>2]=M;return}x=j>>>8,x?j>>>0>16777215?L=31:(Q=(x+1048320|0)>>>16&8,ue=x<<Q,H=(ue+520192|0)>>>16&4,ue=ue<<H,L=(ue+245760|0)>>>16&2,L=14-(H|Q|L)+(ue<<L>>>15)|0,L=j>>>(L+7|0)&1|L<<1):L=0,x=23620+(L<<2)|0,o[J+28>>2]=L,o[J+20>>2]=0,o[J+16>>2]=0,T=o[5830]|0,M=1<<L;e:do if(!(T&M))o[5830]=T|M,o[x>>2]=J,o[J+24>>2]=x,o[J+12>>2]=J,o[J+8>>2]=J;else{x=o[x>>2]|0;t:do if((o[x+4>>2]&-8|0)!=(j|0)){for(L=j<<((L|0)==31?0:25-(L>>>1)|0);M=x+16+(L>>>31<<2)|0,T=o[M>>2]|0,!!T;)if((o[T+4>>2]&-8|0)==(j|0)){x=T;break t}else L=L<<1,x=T;o[M>>2]=J,o[J+24>>2]=x,o[J+12>>2]=J,o[J+8>>2]=J;break e}while(!1);Q=x+8|0,ue=o[Q>>2]|0,o[ue+12>>2]=J,o[Q>>2]=J,o[J+8>>2]=ue,o[J+12>>2]=x,o[J+24>>2]=0}while(!1);if(ue=(o[5837]|0)+-1|0,o[5837]=ue,!(ue|0)){for(x=23772;x=o[x>>2]|0,x;)x=x+8|0;o[5837]=-1}}}}function ra(x,T){x=x|0,T=T|0;var M=0;return x?(M=Ro(T,x)|0,(T|x)>>>0>65535&&(M=((M>>>0)/(x>>>0)|0|0)==(T|0)?M:-1)):M=0,x=Eo(M)|0,!x||!(o[x+-4>>2]&3)||$r(x|0,0,M|0)|0,x|0}function uc(x,T,M,L){return x=x|0,T=T|0,M=M|0,L=L|0,M=x+M>>>0,kr(T+L+(M>>>0<x>>>0|0)>>>0|0),M|0|0}function Nl(x,T,M,L){return x=x|0,T=T|0,M=M|0,L=L|0,L=T-L-(M>>>0>x>>>0|0)>>>0,kr(L|0),x-M>>>0|0|0}function hc(x){return x=x|0,(x?31-(Ko(x^x-1)|0)|0:32)|0}function Mo(x,T,M,L,j){x=x|0,T=T|0,M=M|0,L=L|0,j=j|0;var H=0,Q=0,J=0,ue=0,Ce=0,ze=0,_t=0,Xe=0,it=0,z=0;if(ze=x,ue=T,Ce=ue,Q=M,Xe=L,J=Xe,!Ce)return H=(j|0)!=0,J?H?(o[j>>2]=x|0,o[j+4>>2]=T&0,Xe=0,j=0,kr(Xe|0),j|0):(Xe=0,j=0,kr(Xe|0),j|0):(H&&(o[j>>2]=(ze>>>0)%(Q>>>0),o[j+4>>2]=0),Xe=0,j=(ze>>>0)/(Q>>>0)>>>0,kr(Xe|0),j|0);H=(J|0)==0;do if(Q){if(!H){if(H=(Ko(J|0)|0)-(Ko(Ce|0)|0)|0,H>>>0<=31){_t=H+1|0,J=31-H|0,T=H-31>>31,Q=_t,x=ze>>>(_t>>>0)&T|Ce<<J,T=Ce>>>(_t>>>0)&T,H=0,J=ze<<J;break}return j?(o[j>>2]=x|0,o[j+4>>2]=ue|T&0,Xe=0,j=0,kr(Xe|0),j|0):(Xe=0,j=0,kr(Xe|0),j|0)}if(H=Q-1|0,H&Q|0){J=(Ko(Q|0)|0)+33-(Ko(Ce|0)|0)|0,z=64-J|0,_t=32-J|0,ue=_t>>31,it=J-32|0,T=it>>31,Q=J,x=_t-1>>31&Ce>>>(it>>>0)|(Ce<<_t|ze>>>(J>>>0))&T,T=T&Ce>>>(J>>>0),H=ze<<z&ue,J=(Ce<<z|ze>>>(it>>>0))&ue|ze<<_t&J-33>>31;break}return j|0&&(o[j>>2]=H&ze,o[j+4>>2]=0),(Q|0)==1?(it=ue|T&0,z=x|0|0,kr(it|0),z|0):(z=hc(Q|0)|0,it=Ce>>>(z>>>0)|0,z=Ce<<32-z|ze>>>(z>>>0)|0,kr(it|0),z|0)}else{if(H)return j|0&&(o[j>>2]=(Ce>>>0)%(Q>>>0),o[j+4>>2]=0),it=0,z=(Ce>>>0)/(Q>>>0)>>>0,kr(it|0),z|0;if(!ze)return j|0&&(o[j>>2]=0,o[j+4>>2]=(Ce>>>0)%(J>>>0)),it=0,z=(Ce>>>0)/(J>>>0)>>>0,kr(it|0),z|0;if(H=J-1|0,!(H&J))return j|0&&(o[j>>2]=x|0,o[j+4>>2]=H&Ce|T&0),it=0,z=Ce>>>((hc(J|0)|0)>>>0),kr(it|0),z|0;if(H=(Ko(J|0)|0)-(Ko(Ce|0)|0)|0,H>>>0<=30){T=H+1|0,J=31-H|0,Q=T,x=Ce<<J|ze>>>(T>>>0),T=Ce>>>(T>>>0),H=0,J=ze<<J;break}return j?(o[j>>2]=x|0,o[j+4>>2]=ue|T&0,it=0,z=0,kr(it|0),z|0):(it=0,z=0,kr(it|0),z|0)}while(!1);if(!Q)Ce=J,ue=0,J=0;else{_t=M|0|0,ze=Xe|L&0,Ce=uc(_t|0,ze|0,-1,-1)|0,M=gt()|0,ue=J,J=0;do L=ue,ue=H>>>31|ue<<1,H=J|H<<1,L=x<<1|L>>>31|0,Xe=x>>>31|T<<1|0,Nl(Ce|0,M|0,L|0,Xe|0)|0,z=gt()|0,it=z>>31|((z|0)<0?-1:0)<<1,J=it&1,x=Nl(L|0,Xe|0,it&_t|0,(((z|0)<0?-1:0)>>31|((z|0)<0?-1:0)<<1)&ze|0)|0,T=gt()|0,Q=Q-1|0;while(Q|0);Ce=ue,ue=0}return Q=0,j|0&&(o[j>>2]=x,o[j+4>>2]=T),it=(H|0)>>>31|(Ce|Q)<<1|(Q<<1|H>>>31)&0|ue,z=(H<<1|0)&-2|J,kr(it|0),z|0}function Da(x,T,M,L){x=x|0,T=T|0,M=M|0,L=L|0;var j=0,H=0;return H=st,st=st+16|0,j=H|0,Mo(x,T,M,L,j)|0,st=H,kr(o[j+4>>2]|0),o[j>>2]|0|0}function Nt(x,T,M){return x=x|0,T=T|0,M=M|0,(M|0)<32?(kr(T>>>M|0),x>>>M|(T&(1<<M)-1)<<32-M):(kr(0),T>>>M-32|0)}function Kt(x,T,M){return x=x|0,T=T|0,M=M|0,(M|0)<32?(kr(T<<M|(x&(1<<M)-1<<32-M)>>>32-M|0),x<<M):(kr(x<<M-32|0),0)}function aA(x,T){return x=+x,T=+T,x!=x?+T:T!=T?+x:+en(+x,+T)}function El(x){return x=+x,x>=0?+_i(x+.5):+js(x-.5)}function Ul(x,T,M){x=x|0,T=T|0,M=M|0;var L=0,j=0,H=0;if((M|0)>=8192)return to(x|0,T|0,M|0)|0,x|0;if(H=x|0,j=x+M|0,(x&3)==(T&3)){for(;x&3;){if(!M)return H|0;zt[x>>0]=zt[T>>0]|0,x=x+1|0,T=T+1|0,M=M-1|0}for(M=j&-4|0,L=M-64|0;(x|0)<=(L|0);)o[x>>2]=o[T>>2],o[x+4>>2]=o[T+4>>2],o[x+8>>2]=o[T+8>>2],o[x+12>>2]=o[T+12>>2],o[x+16>>2]=o[T+16>>2],o[x+20>>2]=o[T+20>>2],o[x+24>>2]=o[T+24>>2],o[x+28>>2]=o[T+28>>2],o[x+32>>2]=o[T+32>>2],o[x+36>>2]=o[T+36>>2],o[x+40>>2]=o[T+40>>2],o[x+44>>2]=o[T+44>>2],o[x+48>>2]=o[T+48>>2],o[x+52>>2]=o[T+52>>2],o[x+56>>2]=o[T+56>>2],o[x+60>>2]=o[T+60>>2],x=x+64|0,T=T+64|0;for(;(x|0)<(M|0);)o[x>>2]=o[T>>2],x=x+4|0,T=T+4|0}else for(M=j-4|0;(x|0)<(M|0);)zt[x>>0]=zt[T>>0]|0,zt[x+1>>0]=zt[T+1>>0]|0,zt[x+2>>0]=zt[T+2>>0]|0,zt[x+3>>0]=zt[T+3>>0]|0,x=x+4|0,T=T+4|0;for(;(x|0)<(j|0);)zt[x>>0]=zt[T>>0]|0,x=x+1|0,T=T+1|0;return H|0}function $r(x,T,M){x=x|0,T=T|0,M=M|0;var L=0,j=0,H=0,Q=0;if(H=x+M|0,T=T&255,(M|0)>=67){for(;x&3;)zt[x>>0]=T,x=x+1|0;for(L=H&-4|0,Q=T|T<<8|T<<16|T<<24,j=L-64|0;(x|0)<=(j|0);)o[x>>2]=Q,o[x+4>>2]=Q,o[x+8>>2]=Q,o[x+12>>2]=Q,o[x+16>>2]=Q,o[x+20>>2]=Q,o[x+24>>2]=Q,o[x+28>>2]=Q,o[x+32>>2]=Q,o[x+36>>2]=Q,o[x+40>>2]=Q,o[x+44>>2]=Q,o[x+48>>2]=Q,o[x+52>>2]=Q,o[x+56>>2]=Q,o[x+60>>2]=Q,x=x+64|0;for(;(x|0)<(L|0);)o[x>>2]=Q,x=x+4|0}for(;(x|0)<(H|0);)zt[x>>0]=T,x=x+1|0;return H-M|0}function pa(x){return x=+x,x>=0?+_i(x+.5):+js(x-.5)}function Hn(x){x=x|0;var T=0,M=0,L=0;return L=ar()|0,M=o[$t>>2]|0,T=M+x|0,(x|0)>0&(T|0)<(M|0)|(T|0)<0?(Dl(T|0)|0,et(12),-1):(T|0)>(L|0)&&!(BA(T|0)|0)?(et(12),-1):(o[$t>>2]=T,M|0)}return{___uremdi3:Da,_bitshift64Lshr:Nt,_bitshift64Shl:Kt,_calloc:ra,_cellAreaKm2:sl,_cellAreaM2:_A,_cellAreaRads2:zc,_compact:ua,_destroyLinkedPolygon:UA,_edgeLengthKm:Ma,_edgeLengthM:os,_emscripten_replace_memory:xn,_exactEdgeLengthKm:yl,_exactEdgeLengthM:Nn,_exactEdgeLengthRads:No,_experimentalH3ToLocalIj:wl,_experimentalLocalIjToH3:ku,_free:pr,_geoToH3:qa,_getDestinationH3IndexFromUnidirectionalEdge:ha,_getH3IndexesFromUnidirectionalEdge:Qa,_getH3UnidirectionalEdge:Lc,_getH3UnidirectionalEdgeBoundary:cl,_getH3UnidirectionalEdgesFromHexagon:NA,_getOriginH3IndexFromUnidirectionalEdge:To,_getPentagonIndexes:ll,_getRes0Indexes:$o,_h3Distance:oc,_h3GetBaseCell:gA,_h3GetFaces:Mt,_h3GetResolution:Bc,_h3IndexesAreNeighbors:Al,_h3IsPentagon:Qs,_h3IsResClassIII:rc,_h3IsValid:ol,_h3Line:rA,_h3LineSize:au,_h3SetToLinkedGeo:fA,_h3ToCenterChild:po,_h3ToChildren:Os,_h3ToGeo:wo,_h3ToGeoBoundary:Ia,_h3ToParent:Za,_h3UnidirectionalEdgeIsValid:Uo,_hexAreaKm2:iA,_hexAreaM2:Vi,_hexRing:xo,_i64Subtract:Nl,_kRing:Wi,_kRingDistances:dn,_llvm_minnum_f64:aA,_llvm_round_f64:El,_malloc:Eo,_maxFaceCount:Ol,_maxH3ToChildrenSize:Cu,_maxKringSize:JA,_maxPolyfillSize:Fs,_maxUncompactSize:ou,_memcpy:Ul,_memset:$r,_numHexagons:Sn,_pentagonIndexCount:nc,_pointDistKm:Fl,_pointDistM:FA,_pointDistRads:fs,_polyfill:Pl,_res0IndexCount:Fo,_round:pa,_sbrk:Hn,_sizeOfCoordIJ:yA,_sizeOfGeoBoundary:Ei,_sizeOfGeoCoord:ac,_sizeOfGeoPolygon:VA,_sizeOfGeofence:nA,_sizeOfH3Index:fl,_sizeOfLinkedGeoPolygon:fa,_uncompact:xl,establishStackSpace:uo,stackAlloc:Ze,stackRestore:Jl,stackSave:hs}}(co,Sr,Lt);te.___uremdi3=kt.___uremdi3,te._bitshift64Lshr=kt._bitshift64Lshr,te._bitshift64Shl=kt._bitshift64Shl,te._calloc=kt._calloc,te._cellAreaKm2=kt._cellAreaKm2,te._cellAreaM2=kt._cellAreaM2,te._cellAreaRads2=kt._cellAreaRads2,te._compact=kt._compact,te._destroyLinkedPolygon=kt._destroyLinkedPolygon,te._edgeLengthKm=kt._edgeLengthKm,te._edgeLengthM=kt._edgeLengthM;var we=te._emscripten_replace_memory=kt._emscripten_replace_memory;te._exactEdgeLengthKm=kt._exactEdgeLengthKm,te._exactEdgeLengthM=kt._exactEdgeLengthM,te._exactEdgeLengthRads=kt._exactEdgeLengthRads,te._experimentalH3ToLocalIj=kt._experimentalH3ToLocalIj,te._experimentalLocalIjToH3=kt._experimentalLocalIjToH3,te._free=kt._free,te._geoToH3=kt._geoToH3,te._getDestinationH3IndexFromUnidirectionalEdge=kt._getDestinationH3IndexFromUnidirectionalEdge,te._getH3IndexesFromUnidirectionalEdge=kt._getH3IndexesFromUnidirectionalEdge,te._getH3UnidirectionalEdge=kt._getH3UnidirectionalEdge,te._getH3UnidirectionalEdgeBoundary=kt._getH3UnidirectionalEdgeBoundary,te._getH3UnidirectionalEdgesFromHexagon=kt._getH3UnidirectionalEdgesFromHexagon,te._getOriginH3IndexFromUnidirectionalEdge=kt._getOriginH3IndexFromUnidirectionalEdge,te._getPentagonIndexes=kt._getPentagonIndexes,te._getRes0Indexes=kt._getRes0Indexes,te._h3Distance=kt._h3Distance,te._h3GetBaseCell=kt._h3GetBaseCell,te._h3GetFaces=kt._h3GetFaces,te._h3GetResolution=kt._h3GetResolution,te._h3IndexesAreNeighbors=kt._h3IndexesAreNeighbors,te._h3IsPentagon=kt._h3IsPentagon,te._h3IsResClassIII=kt._h3IsResClassIII,te._h3IsValid=kt._h3IsValid,te._h3Line=kt._h3Line,te._h3LineSize=kt._h3LineSize,te._h3SetToLinkedGeo=kt._h3SetToLinkedGeo,te._h3ToCenterChild=kt._h3ToCenterChild,te._h3ToChildren=kt._h3ToChildren,te._h3ToGeo=kt._h3ToGeo,te._h3ToGeoBoundary=kt._h3ToGeoBoundary,te._h3ToParent=kt._h3ToParent,te._h3UnidirectionalEdgeIsValid=kt._h3UnidirectionalEdgeIsValid,te._hexAreaKm2=kt._hexAreaKm2,te._hexAreaM2=kt._hexAreaM2,te._hexRing=kt._hexRing,te._i64Subtract=kt._i64Subtract,te._kRing=kt._kRing,te._kRingDistances=kt._kRingDistances,te._llvm_minnum_f64=kt._llvm_minnum_f64,te._llvm_round_f64=kt._llvm_round_f64,te._malloc=kt._malloc,te._maxFaceCount=kt._maxFaceCount,te._maxH3ToChildrenSize=kt._maxH3ToChildrenSize,te._maxKringSize=kt._maxKringSize,te._maxPolyfillSize=kt._maxPolyfillSize,te._maxUncompactSize=kt._maxUncompactSize,te._memcpy=kt._memcpy,te._memset=kt._memset,te._numHexagons=kt._numHexagons,te._pentagonIndexCount=kt._pentagonIndexCount,te._pointDistKm=kt._pointDistKm,te._pointDistM=kt._pointDistM,te._pointDistRads=kt._pointDistRads,te._polyfill=kt._polyfill,te._res0IndexCount=kt._res0IndexCount,te._round=kt._round,te._sbrk=kt._sbrk,te._sizeOfCoordIJ=kt._sizeOfCoordIJ,te._sizeOfGeoBoundary=kt._sizeOfGeoBoundary,te._sizeOfGeoCoord=kt._sizeOfGeoCoord,te._sizeOfGeoPolygon=kt._sizeOfGeoPolygon,te._sizeOfGeofence=kt._sizeOfGeofence,te._sizeOfH3Index=kt._sizeOfH3Index,te._sizeOfLinkedGeoPolygon=kt._sizeOfLinkedGeoPolygon,te._uncompact=kt._uncompact,te.establishStackSpace=kt.establishStackSpace;var Ae=te.stackAlloc=kt.stackAlloc,pe=te.stackRestore=kt.stackRestore,Me=te.stackSave=kt.stackSave;if(te.asm=kt,te.cwrap=un,te.setValue=Xr,te.getValue=Ti,te.getTempRet0=Ot,Rt){ii(Rt)||(Rt=Ye(Rt));{He();var Le=function(xe){xe.byteLength&&(xe=new Uint8Array(xe)),mn.set(xe,Gt),te.memoryInitializerRequest&&delete te.memoryInitializerRequest.response,Be()},Ne=function(){Tt(Rt,Le,function(){throw"could not load memory initializer "+Rt})},$e=zn(Rt);if($e)Le($e.buffer);else if(te.memoryInitializerRequest){var Qe=function(){var xe=te.memoryInitializerRequest,Ie=xe.response;if(xe.status!==200&&xe.status!==0){var ut=zn(te.memoryInitializerRequestURL);if(ut)Ie=ut.buffer;else{console.warn("a problem seems to have happened with Module.memoryInitializerRequest, status: "+xe.status+", retrying "+Rt),Ne();return}}Le(Ie)};te.memoryInitializerRequest.response?setTimeout(Qe,0):te.memoryInitializerRequest.addEventListener("load",Qe)}else Ne()}}var Ge;Ue=function xe(){Ge||We(),Ge||(Ue=xe)};function We(xe){if(Zt>0||(Pt(),Zt>0))return;function Ie(){Ge||(Ge=!0,!cn&&(nr(),_n(),te.onRuntimeInitialized&&te.onRuntimeInitialized(),cs()))}te.setStatus?(te.setStatus("Running..."),setTimeout(function(){setTimeout(function(){te.setStatus("")},1),Ie()},1)):Ie()}te.run=We;function Et(xe){throw te.onAbort&&te.onAbort(xe),xe+="",P(xe),yt(xe),cn=!0,"abort("+xe+"). Build with -s ASSERTIONS=1 for more info."}if(te.abort=Et,te.preInit)for(typeof te.preInit=="function"&&(te.preInit=[te.preInit]);te.preInit.length>0;)te.preInit.pop()();return We(),ye}(typeof O_=="object"?O_:{}),Nr="number",ap=Nr,on=Nr,Cn=Nr,DA=Nr,ls=Nr,$I=[["sizeOfH3Index",Nr],["sizeOfGeoCoord",Nr],["sizeOfGeoBoundary",Nr],["sizeOfGeoPolygon",Nr],["sizeOfGeofence",Nr],["sizeOfLinkedGeoPolygon",Nr],["sizeOfCoordIJ",Nr],["h3IsValid",ap,[on,Cn]],["geoToH3",on,[Nr,Nr,DA]],["h3ToGeo",null,[on,Cn,ls]],["h3ToGeoBoundary",null,[on,Cn,ls]],["maxKringSize",Nr,[Nr]],["kRing",null,[on,Cn,Nr,ls]],["kRingDistances",null,[on,Cn,Nr,ls,ls]],["hexRing",null,[on,Cn,Nr,ls]],["maxPolyfillSize",Nr,[ls,DA]],["polyfill",null,[ls,DA,ls]],["h3SetToLinkedGeo",null,[ls,Nr,ls]],["destroyLinkedPolygon",null,[ls]],["compact",Nr,[ls,ls,Nr]],["uncompact",Nr,[ls,Nr,ls,Nr,DA]],["maxUncompactSize",Nr,[ls,Nr,DA]],["h3IsPentagon",ap,[on,Cn]],["h3IsResClassIII",ap,[on,Cn]],["h3GetBaseCell",Nr,[on,Cn]],["h3GetResolution",Nr,[on,Cn]],["maxFaceCount",Nr,[on,Cn]],["h3GetFaces",null,[on,Cn,ls]],["h3ToParent",on,[on,Cn,DA]],["h3ToChildren",null,[on,Cn,DA,ls]],["h3ToCenterChild",on,[on,Cn,DA]],["maxH3ToChildrenSize",Nr,[on,Cn,DA]],["h3IndexesAreNeighbors",ap,[on,Cn,on,Cn]],["getH3UnidirectionalEdge",on,[on,Cn,on,Cn]],["getOriginH3IndexFromUnidirectionalEdge",on,[on,Cn]],["getDestinationH3IndexFromUnidirectionalEdge",on,[on,Cn]],["h3UnidirectionalEdgeIsValid",ap,[on,Cn]],["getH3IndexesFromUnidirectionalEdge",null,[on,Cn,ls]],["getH3UnidirectionalEdgesFromHexagon",null,[on,Cn,ls]],["getH3UnidirectionalEdgeBoundary",null,[on,Cn,ls]],["h3Distance",Nr,[on,Cn,on,Cn]],["h3Line",Nr,[on,Cn,on,Cn,ls]],["h3LineSize",Nr,[on,Cn,on,Cn]],["experimentalH3ToLocalIj",Nr,[on,Cn,on,Cn,ls]],["experimentalLocalIjToH3",Nr,[on,Cn,ls,ls]],["hexAreaM2",Nr,[DA]],["hexAreaKm2",Nr,[DA]],["edgeLengthM",Nr,[DA]],["edgeLengthKm",Nr,[DA]],["pointDistM",Nr,[ls,ls]],["pointDistKm",Nr,[ls,ls]],["pointDistRads",Nr,[ls,ls]],["cellAreaM2",Nr,[on,Cn]],["cellAreaKm2",Nr,[on,Cn]],["cellAreaRads2",Nr,[on,Cn]],["exactEdgeLengthM",Nr,[on,Cn]],["exactEdgeLengthKm",Nr,[on,Cn]],["exactEdgeLengthRads",Nr,[on,Cn]],["numHexagons",Nr,[DA]],["getRes0Indexes",null,[ls]],["res0IndexCount",Nr],["getPentagonIndexes",null,[Nr,ls]],["pentagonIndexCount",Nr]],Ch={};$I.forEach(function(te){Ch[te[0]]=O_.cwrap.apply(O_,te)});Ch.sizeOfH3Index();Ch.sizeOfGeoCoord();Ch.sizeOfGeoBoundary();Ch.sizeOfGeoPolygon();Ch.sizeOfGeofence();Ch.sizeOfLinkedGeoPolygon();Ch.sizeOfCoordIJ();function eC(ye){let te,Re,Te,Ke;return te=new YI({}),Te=new bS({props:{selectedCoordinates:ye[0]}}),{c(){Mc(te.$$.fragment),Re=bd(),Mc(Te.$$.fragment)},l(Ye){Sc(te.$$.fragment,Ye),Re=wd(Ye),Sc(Te.$$.fragment,Ye)},m(Ye,Tt){Ic(te,Ye,Tt),YA(Ye,Re,Tt),Ic(Te,Ye,Tt),Ke=!0},p(Ye,[Tt]){const P={};Tt&1&&(P.selectedCoordinates=Ye[0]),Te.$set(P)},i(Ye){Ke||(es(te.$$.fragment,Ye),es(Te.$$.fragment,Ye),Ke=!0)},o(Ye){Is(te.$$.fragment,Ye),Is(Te.$$.fragment,Ye),Ke=!1},d(Ye){Ye&&Kl(Re),Cc(te,Ye),Cc(Te,Ye)}}}function tC(ye,te,Re){return[{lat:0,lng:0}]}class oC extends Dc{constructor(te){super(),Pc(this,te,tC,eC,zA,{})}}export{oC as component};
