import{s as xh,e as sp,t as zy,b as Ad,d as op,f as ap,h as By,i as vc,j as cd,v as r1,O as n1,k as ud,l as yh,m as Ly,n as Pw,P as $S,Q as XS,o as xf,R as C_,S as zw,T as YS,U as KS,c as JS,u as eI,g as tI,a as iI,V as Bw,x as Lw,W as Rw,r as rI}from"../chunks/scheduler.z9gWm6G6.js";import{S as vh,i as bh,t as kA,g as u2,a as bc,c as h2,b as sd,d as od,m as ad,e as ld,f as Fw}from"../chunks/index.3inwPz0m.js";import{w as yf,r as Ry}from"../chunks/index.SzcEzBBJ.js";function nI(Le){let ne,Fe,ze=`${Le[0].hex}`,wt,dt,Bt,P=`${Le[0].latlng.lat}, ${Le[0].latlng.lng}`,We,me,Xt,Rt=JSON.stringify(Le[0].properties)+"",yt;return{c(){ne=sp("div"),Fe=sp("h1"),wt=zy(ze),dt=Ad(),Bt=sp("h3"),We=zy(P),me=Ad(),Xt=sp("span"),yt=zy(Rt),this.h()},l(qt){ne=op(qt,"DIV",{class:!0});var $t=ap(ne);Fe=op($t,"H1",{});var ui=ap(Fe);wt=By(ui,ze),ui.forEach(vc),dt=cd($t),Bt=op($t,"H3",{});var di=ap(Bt);We=By(di,P),di.forEach(vc),me=cd($t),Xt=op($t,"SPAN",{});var Ei=ap(Xt);yt=By(Ei,Rt),Ei.forEach(vc),$t.forEach(vc),this.h()},h(){r1(ne,"class",n1("modal")+" svelte-1lrhnes")},m(qt,$t){ud(qt,ne,$t),yh(ne,Fe),yh(Fe,wt),yh(ne,dt),yh(ne,Bt),yh(Bt,We),yh(ne,me),yh(ne,Xt),yh(Xt,yt)},p(qt,[$t]){$t&1&&ze!==(ze=`${qt[0].hex}`)&&Ly(wt,ze),$t&1&&P!==(P=`${qt[0].latlng.lat}, ${qt[0].latlng.lng}`)&&Ly(We,P),$t&1&&Rt!==(Rt=JSON.stringify(qt[0].properties)+"")&&Ly(yt,Rt)},i:Pw,o:Pw,d(qt){qt&&vc(ne)}}}function sI(Le,ne,Fe){let{selectionData:ze}=ne;return Le.$$set=wt=>{"selectionData"in wt&&Fe(0,ze=wt.selectionData)},[ze]}class oI extends vh{constructor(ne){super(),bh(this,ne,sI,nI,xh,{selectionData:0})}}const d2=Symbol.for("svelte-maplibre");function k_(){return XS(d2)}function aI(Le){let ne=new WeakMap;return Fe=>{var Bt;let ze=ne.get(Fe.originalEvent);if(ze!==void 0)return ze;let dt=(Bt=Fe.target.queryRenderedFeatures(Fe.point).find(P=>{var We;return(We=Le.get(P.layer.id))==null?void 0:We.interactive}))==null?void 0:Bt.layer.id;return ne.set(Fe.originalEvent,dt),dt}}function lI(){let Le=new Map;return $S(d2,{map:yf(null),source:Ry(null),layer:Ry(null),popupTarget:Ry(null),cluster:yf(),loadedImages:yf(new Set),minzoom:yf(0),maxzoom:yf(24),layerEvent:yf(null),layerInfo:Le,eventTopMost:aI(Le)})}var f2=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function p2(Le){return Le&&Le.__esModule&&Object.prototype.hasOwnProperty.call(Le,"default")?Le.default:Le}function AI(Le){if(Le.__esModule)return Le;var ne=Le.default;if(typeof ne=="function"){var Fe=function ze(){return this instanceof ze?Reflect.construct(ne,arguments,this.constructor):ne.apply(this,arguments)};Fe.prototype=ne.prototype}else Fe={};return Object.defineProperty(Fe,"__esModule",{value:!0}),Object.keys(Le).forEach(function(ze){var wt=Object.getOwnPropertyDescriptor(Le,ze);Object.defineProperty(Fe,ze,wt.get?wt:{enumerable:!0,get:function(){return Le[ze]}})}),Fe}var m2={exports:{}};(function(Le,ne){(function(Fe,ze){Le.exports=ze()})(f2,function(){var Fe,ze,wt;function dt(P,We){if(!Fe)Fe=We;else if(!ze)ze=We;else{var me="var sharedChunk = {}; ("+Fe+")(sharedChunk); ("+ze+")(sharedChunk);",Xt={};Fe(Xt),wt=We(Xt),typeof window<"u"&&(wt.workerUrl=window.URL.createObjectURL(new Blob([me],{type:"text/javascript"})))}}dt(["exports"],function(P){function We(d,A,m,w){return new(m||(m=Promise))(function(D,N){function U(ae){try{ee(w.next(ae))}catch(de){N(de)}}function X(ae){try{ee(w.throw(ae))}catch(de){N(de)}}function ee(ae){var de;ae.done?D(ae.value):(de=ae.value,de instanceof m?de:new m(function(ge){ge(de)})).then(U,X)}ee((w=w.apply(d,A||[])).next())})}function me(d){return d&&d.__esModule&&Object.prototype.hasOwnProperty.call(d,"default")?d.default:d}typeof SuppressedError=="function"&&SuppressedError;var Xt=Rt;function Rt(d,A){this.x=d,this.y=A}Rt.prototype={clone:function(){return new Rt(this.x,this.y)},add:function(d){return this.clone()._add(d)},sub:function(d){return this.clone()._sub(d)},multByPoint:function(d){return this.clone()._multByPoint(d)},divByPoint:function(d){return this.clone()._divByPoint(d)},mult:function(d){return this.clone()._mult(d)},div:function(d){return this.clone()._div(d)},rotate:function(d){return this.clone()._rotate(d)},rotateAround:function(d,A){return this.clone()._rotateAround(d,A)},matMult:function(d){return this.clone()._matMult(d)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(d){return this.x===d.x&&this.y===d.y},dist:function(d){return Math.sqrt(this.distSqr(d))},distSqr:function(d){var A=d.x-this.x,m=d.y-this.y;return A*A+m*m},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(d){return Math.atan2(this.y-d.y,this.x-d.x)},angleWith:function(d){return this.angleWithSep(d.x,d.y)},angleWithSep:function(d,A){return Math.atan2(this.x*A-this.y*d,this.x*d+this.y*A)},_matMult:function(d){var A=d[2]*this.x+d[3]*this.y;return this.x=d[0]*this.x+d[1]*this.y,this.y=A,this},_add:function(d){return this.x+=d.x,this.y+=d.y,this},_sub:function(d){return this.x-=d.x,this.y-=d.y,this},_mult:function(d){return this.x*=d,this.y*=d,this},_div:function(d){return this.x/=d,this.y/=d,this},_multByPoint:function(d){return this.x*=d.x,this.y*=d.y,this},_divByPoint:function(d){return this.x/=d.x,this.y/=d.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var d=this.y;return this.y=this.x,this.x=-d,this},_rotate:function(d){var A=Math.cos(d),m=Math.sin(d),w=m*this.x+A*this.y;return this.x=A*this.x-m*this.y,this.y=w,this},_rotateAround:function(d,A){var m=Math.cos(d),w=Math.sin(d),D=A.y+w*(this.x-A.x)+m*(this.y-A.y);return this.x=A.x+m*(this.x-A.x)-w*(this.y-A.y),this.y=D,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Rt.convert=function(d){return d instanceof Rt?d:Array.isArray(d)?new Rt(d[0],d[1]):d};var yt=me(Xt),qt=$t;function $t(d,A,m,w){this.cx=3*d,this.bx=3*(m-d)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*A,this.by=3*(w-A)-this.cy,this.ay=1-this.cy-this.by,this.p1x=d,this.p1y=A,this.p2x=m,this.p2y=w}$t.prototype={sampleCurveX:function(d){return((this.ax*d+this.bx)*d+this.cx)*d},sampleCurveY:function(d){return((this.ay*d+this.by)*d+this.cy)*d},sampleCurveDerivativeX:function(d){return(3*this.ax*d+2*this.bx)*d+this.cx},solveCurveX:function(d,A){if(A===void 0&&(A=1e-6),d<0)return 0;if(d>1)return 1;for(var m=d,w=0;w<8;w++){var D=this.sampleCurveX(m)-d;if(Math.abs(D)<A)return m;var N=this.sampleCurveDerivativeX(m);if(Math.abs(N)<1e-6)break;m-=D/N}var U=0,X=1;for(m=d,w=0;w<20&&(D=this.sampleCurveX(m),!(Math.abs(D-d)<A));w++)d>D?U=m:X=m,m=.5*(X-U)+U;return m},solve:function(d,A){return this.sampleCurveY(this.solveCurveX(d,A))}};var ui=me(qt);let di,Ei;function Vr(){return di==null&&(di=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),di}function kr(){if(Ei==null&&(Ei=!1,Vr())){const A=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(A){for(let w=0;w<5*5;w++){const D=4*w;A.fillStyle=`rgb(${D},${D+1},${D+2})`,A.fillRect(w%5,Math.floor(w/5),1,1)}const m=A.getImageData(0,0,5,5).data;for(let w=0;w<5*5*4;w++)if(w%4!=3&&m[w]!==w){Ei=!0;break}}}return Ei||!1}function qr(d,A,m,w){const D=new ui(d,A,m,w);return function(N){return D.solve(N)}}const cn=qr(.25,.1,.25,1);function jr(d,A,m){return Math.min(m,Math.max(A,d))}function Jn(d,A,m){const w=m-A,D=((d-A)%w+w)%w+A;return D===A?m:D}function rn(d,...A){for(const m of A)for(const w in m)d[w]=m[w];return d}let pn=1;function At(d,A,m){const w={};for(const D in d)w[D]=A.call(m||this,d[D],D,d);return w}function tr(d,A,m){const w={};for(const D in d)A.call(m||this,d[D],D,d)&&(w[D]=d[D]);return w}function Sn(d){return Array.isArray(d)?d.map(Sn):typeof d=="object"&&d?At(d,Sn):d}const Nn={};function Li(d){Nn[d]||(typeof console<"u"&&console.warn(d),Nn[d]=!0)}function Ir(d,A,m){return(m.y-d.y)*(A.x-d.x)>(A.y-d.y)*(m.x-d.x)}function as(d){let A=0;for(let m,w,D=0,N=d.length,U=N-1;D<N;U=D++)m=d[D],w=d[U],A+=(w.x-m.x)*(m.y+w.y);return A}function es(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}let wo=null;function Io(d){return typeof ImageBitmap<"u"&&d instanceof ImageBitmap}const Zo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function gs(d,A,m,w,D){return We(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const N=new VideoFrame(d,{timestamp:0});try{const U=N==null?void 0:N.format;if(!U||!U.startsWith("BGR")&&!U.startsWith("RGB"))throw new Error(`Unrecognized format ${U}`);const X=U.startsWith("BGR"),ee=new Uint8ClampedArray(w*D*4);if(yield N.copyTo(ee,function(ae,de,ge,Ee,Oe){const ce=4*Math.max(-de,0),et=(Math.max(0,ge)-ge)*Ee*4+ce,ot=4*Ee,pt=Math.max(0,de),Ct=Math.max(0,ge);return{rect:{x:pt,y:Ct,width:Math.min(ae.width,de+Ee)-pt,height:Math.min(ae.height,ge+Oe)-Ct},layout:[{offset:et,stride:ot}]}}(d,A,m,w,D)),X)for(let ae=0;ae<ee.length;ae+=4){const de=ee[ae];ee[ae]=ee[ae+2],ee[ae+2]=de}return ee}finally{N.close()}})}let hi,Yr,Hn,Co;const to={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(d){const A=requestAnimationFrame(d);return{cancel:()=>cancelAnimationFrame(A)}},getImageData(d,A=0){return this.getImageCanvasContext(d).getImageData(-A,-A,d.width+2*A,d.height+2*A)},getImageCanvasContext(d){const A=window.document.createElement("canvas"),m=A.getContext("2d",{willReadFrequently:!0});if(!m)throw new Error("failed to create canvas 2d context");return A.width=d.width,A.height=d.height,m.drawImage(d,0,0,d.width,d.height),m},resolveURL:d=>(Hn||(Hn=document.createElement("a")),Hn.href=d,Hn.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(Co==null&&(Co=matchMedia("(prefers-reduced-motion: reduce)")),Co.matches)}},zt={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};class dr extends Error{constructor(A,m,w,D){super(`AJAXError: ${m} (${A}): ${w}`),this.status=A,this.statusText=m,this.url=w,this.body=D}}const In=es()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href,Es=d=>zt.REGISTERED_PROTOCOLS[d.substring(0,d.indexOf("://"))];function Il(d,A){const m=new AbortController,w=new Request(d.url,{method:d.method||"GET",body:d.body,credentials:d.credentials,headers:d.headers,cache:d.cache,referrer:In(),signal:m.signal});let D=!1,N=!1;return d.type==="json"&&w.headers.set("Accept","application/json"),N||fetch(w).then(U=>U.ok?(X=>{(d.type==="arrayBuffer"||d.type==="image"?X.arrayBuffer():d.type==="json"?X.json():X.text()).then(ee=>{N||(D=!0,A(null,ee,X.headers.get("Cache-Control"),X.headers.get("Expires")))}).catch(ee=>{N||A(new Error(ee.message))})})(U):U.blob().then(X=>A(new dr(U.status,U.statusText,d.url,X)))).catch(U=>{U.code!==20&&A(new Error(U.message))}),{cancel:()=>{N=!0,D||m.abort()}}}const La=function(d,A){if(/:\/\//.test(d.url)&&!/^https?:|^file:/.test(d.url)){if(es()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",d,A);if(!es())return(Es(d.url)||Il)(d,A)}if(!(/^file:/.test(m=d.url)||/^file:/.test(In())&&!/^\w+:/.test(m))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return Il(d,A);if(es()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",d,A,void 0,!0)}var m;return function(w,D){const N=new XMLHttpRequest;N.open(w.method||"GET",w.url,!0),w.type!=="arrayBuffer"&&w.type!=="image"||(N.responseType="arraybuffer");for(const U in w.headers)N.setRequestHeader(U,w.headers[U]);return w.type==="json"&&(N.responseType="text",N.setRequestHeader("Accept","application/json")),N.withCredentials=w.credentials==="include",N.onerror=()=>{D(new Error(N.statusText))},N.onload=()=>{if((N.status>=200&&N.status<300||N.status===0)&&N.response!==null){let U=N.response;if(w.type==="json")try{U=JSON.parse(N.response)}catch(X){return D(X)}D(null,U,N.getResponseHeader("Cache-Control"),N.getResponseHeader("Expires"))}else{const U=new Blob([N.response],{type:N.getResponseHeader("Content-Type")});D(new dr(N.status,N.statusText,w.url,U))}},N.send(w.body),{cancel:()=>N.abort()}}(d,A)},Cl=function(d,A){return La(rn(d,{type:"arrayBuffer"}),A)};function Un(d){if(!d||d.indexOf("://")<=0||d.indexOf("data:image/")===0||d.indexOf("blob:")===0)return!0;const A=new URL(d),m=window.location;return A.protocol===m.protocol&&A.host===m.host}function Ra(d,A,m){m[d]&&m[d].indexOf(A)!==-1||(m[d]=m[d]||[],m[d].push(A))}function pa(d,A,m){if(m&&m[d]){const w=m[d].indexOf(A);w!==-1&&m[d].splice(w,1)}}class Yt{constructor(A,m={}){rn(this,m),this.type=A}}class Ue extends Yt{constructor(A,m={}){super("error",rn({error:A},m))}}class $e{on(A,m){return this._listeners=this._listeners||{},Ra(A,m,this._listeners),this}off(A,m){return pa(A,m,this._listeners),pa(A,m,this._oneTimeListeners),this}once(A,m){return m?(this._oneTimeListeners=this._oneTimeListeners||{},Ra(A,m,this._oneTimeListeners),this):new Promise(w=>this.once(A,w))}fire(A,m){typeof A=="string"&&(A=new Yt(A,m||{}));const w=A.type;if(this.listens(w)){A.target=this;const D=this._listeners&&this._listeners[w]?this._listeners[w].slice():[];for(const X of D)X.call(this,A);const N=this._oneTimeListeners&&this._oneTimeListeners[w]?this._oneTimeListeners[w].slice():[];for(const X of N)pa(w,X,this._oneTimeListeners),X.call(this,A);const U=this._eventedParent;U&&(rn(A,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),U.fire(A))}else A instanceof Ue&&console.error(A.error);return this}listens(A){return this._listeners&&this._listeners[A]&&this._listeners[A].length>0||this._oneTimeListeners&&this._oneTimeListeners[A]&&this._oneTimeListeners[A].length>0||this._eventedParent&&this._eventedParent.listens(A)}setEventedParent(A,m){return this._eventedParent=A,this._eventedParentData=m,this}}var Pe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Ft=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Zt(d,A){const m={};for(const w in d)w!=="ref"&&(m[w]=d[w]);return Ft.forEach(w=>{w in A&&(m[w]=A[w])}),m}function ni(d,A){if(Array.isArray(d)){if(!Array.isArray(A)||d.length!==A.length)return!1;for(let m=0;m<d.length;m++)if(!ni(d[m],A[m]))return!1;return!0}if(typeof d=="object"&&d!==null&&A!==null){if(typeof A!="object"||Object.keys(d).length!==Object.keys(A).length)return!1;for(const m in d)if(!ni(d[m],A[m]))return!1;return!0}return d===A}const ri={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Qt(d,A,m){m.push({command:ri.addSource,args:[d,A[d]]})}function Oi(d,A,m){A.push({command:ri.removeSource,args:[d]}),m[d]=!0}function Qi(d,A,m,w){Oi(d,m,w),Qt(d,A,m)}function Ki(d,A,m){let w;for(w in d[m])if(Object.prototype.hasOwnProperty.call(d[m],w)&&w!=="data"&&!ni(d[m][w],A[m][w]))return!1;for(w in A[m])if(Object.prototype.hasOwnProperty.call(A[m],w)&&w!=="data"&&!ni(d[m][w],A[m][w]))return!1;return!0}function Kr(d,A,m,w,D,N){let U;for(U in A=A||{},d=d||{})Object.prototype.hasOwnProperty.call(d,U)&&(ni(d[U],A[U])||m.push({command:N,args:[w,U,A[U],D]}));for(U in A)Object.prototype.hasOwnProperty.call(A,U)&&!Object.prototype.hasOwnProperty.call(d,U)&&(ni(d[U],A[U])||m.push({command:N,args:[w,U,A[U],D]}))}function _n(d){return d.id}function ts(d,A){return d[A.id]=A,d}class oi{constructor(A,m,w,D){this.message=(A?`${A}: `:"")+w,D&&(this.identifier=D),m!=null&&m.__line__&&(this.line=m.__line__)}}function gn(d,...A){for(const m of A)for(const w in m)d[w]=m[w];return d}class vr extends Error{constructor(A,m){super(m),this.message=m,this.key=A}}class ys{constructor(A,m=[]){this.parent=A,this.bindings={};for(const[w,D]of m)this.bindings[w]=D}concat(A){return new ys(this,A)}get(A){if(this.bindings[A])return this.bindings[A];if(this.parent)return this.parent.get(A);throw new Error(`${A} not found in scope.`)}has(A){return!!this.bindings[A]||!!this.parent&&this.parent.has(A)}}const ls={kind:"null"},gi={kind:"number"},br={kind:"string"},wr={kind:"boolean"},Cn={kind:"color"},io={kind:"object"},Sr={kind:"value"},kt={kind:"collator"},we={kind:"formatted"},Ae={kind:"padding"},pe={kind:"resolvedImage"},Te={kind:"variableAnchorOffsetCollection"};function Be(d,A){return{kind:"array",itemType:d,N:A}}function Ve(d){if(d.kind==="array"){const A=Ve(d.itemType);return typeof d.N=="number"?`array<${A}, ${d.N}>`:d.itemType.kind==="value"?"array":`array<${A}>`}return d.kind}const Ke=[ls,gi,br,wr,Cn,we,io,Be(Sr),Ae,pe,Te];function Qe(d,A){if(A.kind==="error")return null;if(d.kind==="array"){if(A.kind==="array"&&(A.N===0&&A.itemType.kind==="value"||!Qe(d.itemType,A.itemType))&&(typeof d.N!="number"||d.N===A.N))return null}else{if(d.kind===A.kind)return null;if(d.kind==="value"){for(const m of Ke)if(!Qe(m,A))return null}}return`Expected ${Ve(d)} but found ${Ve(A)} instead.`}function Ge(d,A){return A.some(m=>m.kind===d.kind)}function He(d,A){return A.some(m=>m==="null"?d===null:m==="array"?Array.isArray(d):m==="object"?d&&!Array.isArray(d)&&typeof d=="object":m===typeof d)}function Et(d,A){return d.kind==="array"&&A.kind==="array"?d.itemType.kind===A.itemType.kind&&typeof d.N=="number":d.kind===A.kind}const xe=.96422,Me=.82521,ct=4/29,Pt=6/29,o=3*Pt*Pt,oe=Pt*Pt*Pt,ti=Math.PI/180,xi=180/Math.PI;function yi(d){return(d%=360)<0&&(d+=360),d}function ai([d,A,m,w]){let D,N;const U=gr((.2225045*(d=pi(d))+.7168786*(A=pi(A))+.0606169*(m=pi(m)))/1);d===A&&A===m?D=N=U:(D=gr((.4360747*d+.3850649*A+.1430804*m)/xe),N=gr((.0139322*d+.0971045*A+.7141733*m)/Me));const X=116*U-16;return[X<0?0:X,500*(D-U),200*(U-N),w]}function pi(d){return d<=.04045?d/12.92:Math.pow((d+.055)/1.055,2.4)}function gr(d){return d>oe?Math.pow(d,1/3):d/o+ct}function bi([d,A,m,w]){let D=(d+16)/116,N=isNaN(A)?D:D+A/500,U=isNaN(m)?D:D-m/200;return D=1*fn(D),N=xe*fn(N),U=Me*fn(U),[zi(3.1338561*N-1.6168667*D-.4906146*U),zi(-.9787684*N+1.9161415*D+.033454*U),zi(.0719453*N-.2289914*D+1.4052427*U),w]}function zi(d){return(d=d<=.00304?12.92*d:1.055*Math.pow(d,1/2.4)-.055)<0?0:d>1?1:d}function fn(d){return d>Pt?d*d*d:o*(d-ct)}function Qs(d){return parseInt(d.padEnd(2,d),16)/255}function HA(d,A){return Ls(A?d/100:d,0,1)}function Ls(d,A,m){return Math.min(Math.max(A,d),m)}function Rs(d){return!d.some(Number.isNaN)}const ko={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class nn{constructor(A,m,w,D=1,N=!0){this.r=A,this.g=m,this.b=w,this.a=D,N||(this.r*=D,this.g*=D,this.b*=D,D||this.overwriteGetter("rgb",[A,m,w,D]))}static parse(A){if(A instanceof nn)return A;if(typeof A!="string")return;const m=function(w){if((w=w.toLowerCase().trim())==="transparent")return[0,0,0,0];const D=ko[w];if(D){const[U,X,ee]=D;return[U/255,X/255,ee/255,1]}if(w.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(w)){const U=w.length<6?1:2;let X=1;return[Qs(w.slice(X,X+=U)),Qs(w.slice(X,X+=U)),Qs(w.slice(X,X+=U)),Qs(w.slice(X,X+U)||"ff")]}if(w.startsWith("rgb")){const U=w.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(U){const[X,ee,ae,de,ge,Ee,Oe,ce,et,ot,pt,Ct]=U,bt=[de||" ",Oe||" ",ot].join("");if(bt==="  "||bt==="  /"||bt===",,"||bt===",,,"){const _e=[ae,Ee,et].join(""),Ut=_e==="%%%"?100:_e===""?255:0;if(Ut){const li=[Ls(+ee/Ut,0,1),Ls(+ge/Ut,0,1),Ls(+ce/Ut,0,1),pt?HA(+pt,Ct):1];if(Rs(li))return li}}return}}const N=w.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(N){const[U,X,ee,ae,de,ge,Ee,Oe,ce]=N,et=[ee||" ",de||" ",Ee].join("");if(et==="  "||et==="  /"||et===",,"||et===",,,"){const ot=[+X,Ls(+ae,0,100),Ls(+ge,0,100),Oe?HA(+Oe,ce):1];if(Rs(ot))return function([pt,Ct,bt,_e]){function Ut(li){const Ci=(li+pt/30)%12,nr=Ct*Math.min(bt,1-bt);return bt-nr*Math.max(-1,Math.min(Ci-3,9-Ci,1))}return pt=yi(pt),Ct/=100,bt/=100,[Ut(0),Ut(8),Ut(4),_e]}(ot)}}}(A);return m?new nn(...m,!1):void 0}get rgb(){const{r:A,g:m,b:w,a:D}=this,N=D||1/0;return this.overwriteGetter("rgb",[A/N,m/N,w/N,D])}get hcl(){return this.overwriteGetter("hcl",function(A){const[m,w,D,N]=ai(A),U=Math.sqrt(w*w+D*D);return[Math.round(1e4*U)?yi(Math.atan2(D,w)*xi):NaN,U,m,N]}(this.rgb))}get lab(){return this.overwriteGetter("lab",ai(this.rgb))}overwriteGetter(A,m){return Object.defineProperty(this,A,{value:m}),m}toString(){const[A,m,w,D]=this.rgb;return`rgba(${[A,m,w].map(N=>Math.round(255*N)).join(",")},${D})`}}nn.black=new nn(0,0,0,1),nn.white=new nn(1,1,1,1),nn.transparent=new nn(0,0,0,0),nn.red=new nn(1,0,0,1);class qo{constructor(A,m,w){this.sensitivity=A?m?"variant":"case":m?"accent":"base",this.locale=w,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(A,m){return this.collator.compare(A,m)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Dr{constructor(A,m,w,D,N){this.text=A,this.image=m,this.scale=w,this.fontStack=D,this.textColor=N}}class gt{constructor(A){this.sections=A}static fromString(A){return new gt([new Dr(A,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(A=>A.text.length!==0||A.image&&A.image.name.length!==0)}static factory(A){return A instanceof gt?A:gt.fromString(A)}toString(){return this.sections.length===0?"":this.sections.map(A=>A.text).join("")}}class Di{constructor(A){this.values=A.slice()}static parse(A){if(A instanceof Di)return A;if(typeof A=="number")return new Di([A,A,A,A]);if(Array.isArray(A)&&!(A.length<1||A.length>4)){for(const m of A)if(typeof m!="number")return;switch(A.length){case 1:A=[A[0],A[0],A[0],A[0]];break;case 2:A=[A[0],A[1],A[0],A[1]];break;case 3:A=[A[0],A[1],A[2],A[1]]}return new Di(A)}}toString(){return JSON.stringify(this.values)}}const Je=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Ar{constructor(A){this.values=A.slice()}static parse(A){if(A instanceof Ar)return A;if(Array.isArray(A)&&!(A.length<1)&&A.length%2==0){for(let m=0;m<A.length;m+=2){const w=A[m],D=A[m+1];if(typeof w!="string"||!Je.has(w)||!Array.isArray(D)||D.length!==2||typeof D[0]!="number"||typeof D[1]!="number")return}return new Ar(A)}}toString(){return JSON.stringify(this.values)}}class Hs{constructor(A){this.name=A.name,this.available=A.available}toString(){return this.name}static fromString(A){return A?new Hs({name:A,available:!1}):null}}function DA(d,A,m,w){return typeof d=="number"&&d>=0&&d<=255&&typeof A=="number"&&A>=0&&A<=255&&typeof m=="number"&&m>=0&&m<=255?w===void 0||typeof w=="number"&&w>=0&&w<=1?null:`Invalid rgba value [${[d,A,m,w].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof w=="number"?[d,A,m,w]:[d,A,m]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function kl(d){if(d===null||typeof d=="string"||typeof d=="boolean"||typeof d=="number"||d instanceof nn||d instanceof qo||d instanceof gt||d instanceof Di||d instanceof Ar||d instanceof Hs)return!0;if(Array.isArray(d)){for(const A of d)if(!kl(A))return!1;return!0}if(typeof d=="object"){for(const A in d)if(!kl(d[A]))return!1;return!0}return!1}function nt(d){if(d===null)return ls;if(typeof d=="string")return br;if(typeof d=="boolean")return wr;if(typeof d=="number")return gi;if(d instanceof nn)return Cn;if(d instanceof qo)return kt;if(d instanceof gt)return we;if(d instanceof Di)return Ae;if(d instanceof Ar)return Te;if(d instanceof Hs)return pe;if(Array.isArray(d)){const A=d.length;let m;for(const w of d){const D=nt(w);if(m){if(m===D)continue;m=Sr;break}m=D}return Be(m||Sr,A)}return io}function yn(d){const A=typeof d;return d===null?"":A==="string"||A==="number"||A==="boolean"?String(d):d instanceof nn||d instanceof gt||d instanceof Di||d instanceof Ar||d instanceof Hs?d.toString():JSON.stringify(d)}class Ze{constructor(A,m){this.type=A,this.value=m}static parse(A,m){if(A.length!==2)return m.error(`'literal' expression requires exactly one argument, but found ${A.length-1} instead.`);if(!kl(A[1]))return m.error("invalid value");const w=A[1];let D=nt(w);const N=m.expectedType;return D.kind!=="array"||D.N!==0||!N||N.kind!=="array"||typeof N.N=="number"&&N.N!==0||(D=N),new Ze(D,w)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class As{constructor(A){this.name="ExpressionEvaluationError",this.message=A}toJSON(){return this.message}}const Xl={string:br,number:gi,boolean:wr,object:io};class ro{constructor(A,m){this.type=A,this.args=m}static parse(A,m){if(A.length<2)return m.error("Expected at least one argument.");let w,D=1;const N=A[0];if(N==="array"){let X,ee;if(A.length>2){const ae=A[1];if(typeof ae!="string"||!(ae in Xl)||ae==="object")return m.error('The item type argument of "array" must be one of string, number, boolean',1);X=Xl[ae],D++}else X=Sr;if(A.length>3){if(A[2]!==null&&(typeof A[2]!="number"||A[2]<0||A[2]!==Math.floor(A[2])))return m.error('The length argument to "array" must be a positive integer literal',2);ee=A[2],D++}w=Be(X,ee)}else{if(!Xl[N])throw new Error(`Types doesn't contain name = ${N}`);w=Xl[N]}const U=[];for(;D<A.length;D++){const X=m.parse(A[D],D,Sr);if(!X)return null;U.push(X)}return new ro(w,U)}evaluate(A){for(let m=0;m<this.args.length;m++){const w=this.args[m].evaluate(A);if(!Qe(this.type,nt(w)))return w;if(m===this.args.length-1)throw new As(`Expected value to be of type ${Ve(this.type)}, but found ${Ve(nt(w))} instead.`)}throw new Error}eachChild(A){this.args.forEach(A)}outputDefined(){return this.args.every(A=>A.outputDefined())}}const WA={"to-boolean":wr,"to-color":Cn,"to-number":gi,"to-string":br};class Xi{constructor(A,m){this.type=A,this.args=m}static parse(A,m){if(A.length<2)return m.error("Expected at least one argument.");const w=A[0];if(!WA[w])throw new Error(`Can't parse ${w} as it is not part of the known types`);if((w==="to-boolean"||w==="to-string")&&A.length!==2)return m.error("Expected one argument.");const D=WA[w],N=[];for(let U=1;U<A.length;U++){const X=m.parse(A[U],U,Sr);if(!X)return null;N.push(X)}return new Xi(D,N)}evaluate(A){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(A);case"color":{let m,w;for(const D of this.args){if(m=D.evaluate(A),w=null,m instanceof nn)return m;if(typeof m=="string"){const N=A.parseColor(m);if(N)return N}else if(Array.isArray(m)&&(w=m.length<3||m.length>4?`Invalid rbga value ${JSON.stringify(m)}: expected an array containing either three or four numeric values.`:DA(m[0],m[1],m[2],m[3]),!w))return new nn(m[0]/255,m[1]/255,m[2]/255,m[3])}throw new As(w||`Could not parse color from value '${typeof m=="string"?m:JSON.stringify(m)}'`)}case"padding":{let m;for(const w of this.args){m=w.evaluate(A);const D=Di.parse(m);if(D)return D}throw new As(`Could not parse padding from value '${typeof m=="string"?m:JSON.stringify(m)}'`)}case"variableAnchorOffsetCollection":{let m;for(const w of this.args){m=w.evaluate(A);const D=Ar.parse(m);if(D)return D}throw new As(`Could not parse variableAnchorOffsetCollection from value '${typeof m=="string"?m:JSON.stringify(m)}'`)}case"number":{let m=null;for(const w of this.args){if(m=w.evaluate(A),m===null)return 0;const D=Number(m);if(!isNaN(D))return D}throw new As(`Could not convert ${JSON.stringify(m)} to number.`)}case"formatted":return gt.fromString(yn(this.args[0].evaluate(A)));case"resolvedImage":return Hs.fromString(yn(this.args[0].evaluate(A)));default:return yn(this.args[0].evaluate(A))}}eachChild(A){this.args.forEach(A)}outputDefined(){return this.args.every(A=>A.outputDefined())}}const mn=["Unknown","Point","LineString","Polygon"];class Qo{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?mn[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(A){let m=this._parseColorCache[A];return m||(m=this._parseColorCache[A]=nn.parse(A)),m}}class Fs{constructor(A,m,w=[],D,N=new ys,U=[]){this.registry=A,this.path=w,this.key=w.map(X=>`[${X}]`).join(""),this.scope=N,this.errors=U,this.expectedType=D,this._isConstant=m}parse(A,m,w,D,N={}){return m?this.concat(m,w,D)._parse(A,N):this._parse(A,N)}_parse(A,m){function w(D,N,U){return U==="assert"?new ro(N,[D]):U==="coerce"?new Xi(N,[D]):D}if(A!==null&&typeof A!="string"&&typeof A!="boolean"&&typeof A!="number"||(A=["literal",A]),Array.isArray(A)){if(A.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const D=A[0];if(typeof D!="string")return this.error(`Expression name must be a string, but found ${typeof D} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const N=this.registry[D];if(N){let U=N.parse(A,this);if(!U)return null;if(this.expectedType){const X=this.expectedType,ee=U.type;if(X.kind!=="string"&&X.kind!=="number"&&X.kind!=="boolean"&&X.kind!=="object"&&X.kind!=="array"||ee.kind!=="value")if(X.kind!=="color"&&X.kind!=="formatted"&&X.kind!=="resolvedImage"||ee.kind!=="value"&&ee.kind!=="string")if(X.kind!=="padding"||ee.kind!=="value"&&ee.kind!=="number"&&ee.kind!=="array")if(X.kind!=="variableAnchorOffsetCollection"||ee.kind!=="value"&&ee.kind!=="array"){if(this.checkSubtype(X,ee))return null}else U=w(U,X,m.typeAnnotation||"coerce");else U=w(U,X,m.typeAnnotation||"coerce");else U=w(U,X,m.typeAnnotation||"coerce");else U=w(U,X,m.typeAnnotation||"assert")}if(!(U instanceof Ze)&&U.type.kind!=="resolvedImage"&&this._isConstant(U)){const X=new Qo;try{U=new Ze(U.type,U.evaluate(X))}catch(ee){return this.error(ee.message),null}}return U}return this.error(`Unknown expression "${D}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(A===void 0?"'undefined' value invalid. Use null instead.":typeof A=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof A} instead.`)}concat(A,m,w){const D=typeof A=="number"?this.path.concat(A):this.path,N=w?this.scope.concat(w):this.scope;return new Fs(this.registry,this._isConstant,D,m||null,N,this.errors)}error(A,...m){const w=`${this.key}${m.map(D=>`[${D}]`).join("")}`;this.errors.push(new vr(w,A))}checkSubtype(A,m){const w=Qe(A,m);return w&&this.error(w),w}}class Wn{constructor(A,m,w){this.type=kt,this.locale=w,this.caseSensitive=A,this.diacriticSensitive=m}static parse(A,m){if(A.length!==2)return m.error("Expected one argument.");const w=A[1];if(typeof w!="object"||Array.isArray(w))return m.error("Collator options argument must be an object.");const D=m.parse(w["case-sensitive"]!==void 0&&w["case-sensitive"],1,wr);if(!D)return null;const N=m.parse(w["diacritic-sensitive"]!==void 0&&w["diacritic-sensitive"],1,wr);if(!N)return null;let U=null;return w.locale&&(U=m.parse(w.locale,1,br),!U)?null:new Wn(D,N,U)}evaluate(A){return new qo(this.caseSensitive.evaluate(A),this.diacriticSensitive.evaluate(A),this.locale?this.locale.evaluate(A):null)}eachChild(A){A(this.caseSensitive),A(this.diacriticSensitive),this.locale&&A(this.locale)}outputDefined(){return!1}}const co=8192;function Ds(d,A){d[0]=Math.min(d[0],A[0]),d[1]=Math.min(d[1],A[1]),d[2]=Math.max(d[2],A[0]),d[3]=Math.max(d[3],A[1])}function Dl(d,A){return!(d[0]<=A[0]||d[2]>=A[2]||d[1]<=A[1]||d[3]>=A[3])}function $A(d,A){const m=(180+d[0])/360,w=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+d[1]*Math.PI/360)))/360,D=Math.pow(2,A.z);return[Math.round(m*D*co),Math.round(w*D*co)]}function XA(d,A,m){const w=d[0]-A[0],D=d[1]-A[1],N=d[0]-m[0],U=d[1]-m[1];return w*U-N*D==0&&w*N<=0&&D*U<=0}function Pl(d,A){let m=!1;for(let U=0,X=A.length;U<X;U++){const ee=A[U];for(let ae=0,de=ee.length;ae<de-1;ae++){if(XA(d,ee[ae],ee[ae+1]))return!1;(D=ee[ae])[1]>(w=d)[1]!=(N=ee[ae+1])[1]>w[1]&&w[0]<(N[0]-D[0])*(w[1]-D[1])/(N[1]-D[1])+D[0]&&(m=!m)}}var w,D,N;return m}function uA(d,A){for(let m=0;m<A.length;m++)if(Pl(d,A[m]))return!0;return!1}function is(d,A,m,w){const D=w[0]-m[0],N=w[1]-m[1],U=(d[0]-m[0])*N-D*(d[1]-m[1]),X=(A[0]-m[0])*N-D*(A[1]-m[1]);return U>0&&X<0||U<0&&X>0}function YA(d,A,m){for(const ae of m)for(let de=0;de<ae.length-1;++de)if((X=[(U=ae[de+1])[0]-(N=ae[de])[0],U[1]-N[1]])[0]*(ee=[(D=A)[0]-(w=d)[0],D[1]-w[1]])[1]-X[1]*ee[0]!=0&&is(w,D,N,U)&&is(N,U,w,D))return!0;var w,D,N,U,X,ee;return!1}function jn(d,A){for(let m=0;m<d.length;++m)if(!Pl(d[m],A))return!1;for(let m=0;m<d.length-1;++m)if(YA(d[m],d[m+1],A))return!1;return!0}function hA(d,A){for(let m=0;m<A.length;m++)if(jn(d,A[m]))return!0;return!1}function ei(d,A,m){const w=[];for(let D=0;D<d.length;D++){const N=[];for(let U=0;U<d[D].length;U++){const X=$A(d[D][U],m);Ds(A,X),N.push(X)}w.push(N)}return w}function ir(d,A,m){const w=[];for(let D=0;D<d.length;D++){const N=ei(d[D],A,m);w.push(N)}return w}function rs(d,A,m,w){if(d[0]<m[0]||d[0]>m[2]){const D=.5*w;let N=d[0]-m[0]>D?-w:m[0]-d[0]>D?w:0;N===0&&(N=d[0]-m[2]>D?-w:m[2]-d[0]>D?w:0),d[0]+=N}Ds(A,d)}function xt(d,A,m,w){const D=Math.pow(2,w.z)*co,N=[w.x*co,w.y*co],U=[];for(const X of d)for(const ee of X){const ae=[ee.x+N[0],ee.y+N[1]];rs(ae,A,m,D),U.push(ae)}return U}function vi(d,A,m,w){const D=Math.pow(2,w.z)*co,N=[w.x*co,w.y*co],U=[];for(const ee of d){const ae=[];for(const de of ee){const ge=[de.x+N[0],de.y+N[1]];Ds(A,ge),ae.push(ge)}U.push(ae)}if(A[2]-A[0]<=D/2){(X=A)[0]=X[1]=1/0,X[2]=X[3]=-1/0;for(const ee of U)for(const ae of ee)rs(ae,A,m,D)}var X;return U}class Do{constructor(A,m){this.type=wr,this.geojson=A,this.geometries=m}static parse(A,m){if(A.length!==2)return m.error(`'within' expression requires exactly one argument, but found ${A.length-1} instead.`);if(kl(A[1])){const w=A[1];if(w.type==="FeatureCollection")for(let D=0;D<w.features.length;++D){const N=w.features[D].geometry.type;if(N==="Polygon"||N==="MultiPolygon")return new Do(w,w.features[D].geometry)}else if(w.type==="Feature"){const D=w.geometry.type;if(D==="Polygon"||D==="MultiPolygon")return new Do(w,w.geometry)}else if(w.type==="Polygon"||w.type==="MultiPolygon")return new Do(w,w)}return m.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(A){if(A.geometry()!=null&&A.canonicalID()!=null){if(A.geometryType()==="Point")return function(m,w){const D=[1/0,1/0,-1/0,-1/0],N=[1/0,1/0,-1/0,-1/0],U=m.canonicalID();if(w.type==="Polygon"){const X=ei(w.coordinates,N,U),ee=xt(m.geometry(),D,N,U);if(!Dl(D,N))return!1;for(const ae of ee)if(!Pl(ae,X))return!1}if(w.type==="MultiPolygon"){const X=ir(w.coordinates,N,U),ee=xt(m.geometry(),D,N,U);if(!Dl(D,N))return!1;for(const ae of ee)if(!uA(ae,X))return!1}return!0}(A,this.geometries);if(A.geometryType()==="LineString")return function(m,w){const D=[1/0,1/0,-1/0,-1/0],N=[1/0,1/0,-1/0,-1/0],U=m.canonicalID();if(w.type==="Polygon"){const X=ei(w.coordinates,N,U),ee=vi(m.geometry(),D,N,U);if(!Dl(D,N))return!1;for(const ae of ee)if(!jn(ae,X))return!1}if(w.type==="MultiPolygon"){const X=ir(w.coordinates,N,U),ee=vi(m.geometry(),D,N,U);if(!Dl(D,N))return!1;for(const ae of ee)if(!hA(ae,X))return!1}return!0}(A,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Ho{constructor(A,m){this.type=m.type,this.name=A,this.boundExpression=m}static parse(A,m){if(A.length!==2||typeof A[1]!="string")return m.error("'var' expression requires exactly one string literal argument.");const w=A[1];return m.scope.has(w)?new Ho(w,m.scope.get(w)):m.error(`Unknown variable "${w}". Make sure "${w}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(A){return this.boundExpression.evaluate(A)}eachChild(){}outputDefined(){return!1}}class xn{constructor(A,m,w,D){this.name=A,this.type=m,this._evaluate=w,this.args=D}evaluate(A){return this._evaluate(A,this.args)}eachChild(A){this.args.forEach(A)}outputDefined(){return!1}static parse(A,m){const w=A[0],D=xn.definitions[w];if(!D)return m.error(`Unknown expression "${w}". If you wanted a literal array, use ["literal", [...]].`,0);const N=Array.isArray(D)?D[0]:D.type,U=Array.isArray(D)?[[D[1],D[2]]]:D.overloads,X=U.filter(([ae])=>!Array.isArray(ae)||ae.length===A.length-1);let ee=null;for(const[ae,de]of X){ee=new Fs(m.registry,ta,m.path,null,m.scope);const ge=[];let Ee=!1;for(let Oe=1;Oe<A.length;Oe++){const ce=A[Oe],et=Array.isArray(ae)?ae[Oe-1]:ae.type,ot=ee.parse(ce,1+ge.length,et);if(!ot){Ee=!0;break}ge.push(ot)}if(!Ee)if(Array.isArray(ae)&&ae.length!==ge.length)ee.error(`Expected ${ae.length} arguments, but found ${ge.length} instead.`);else{for(let Oe=0;Oe<ge.length;Oe++){const ce=Array.isArray(ae)?ae[Oe]:ae.type,et=ge[Oe];ee.concat(Oe+1).checkSubtype(ce,et.type)}if(ee.errors.length===0)return new xn(w,N,de,ge)}}if(X.length===1)m.errors.push(...ee.errors);else{const ae=(X.length?X:U).map(([ge])=>{return Ee=ge,Array.isArray(Ee)?`(${Ee.map(Ve).join(", ")})`:`(${Ve(Ee.type)}...)`;var Ee}).join(" | "),de=[];for(let ge=1;ge<A.length;ge++){const Ee=m.parse(A[ge],1+de.length);if(!Ee)return null;de.push(Ve(Ee.type))}m.error(`Expected arguments of type ${ae}, but found (${de.join(", ")}) instead.`)}return null}static register(A,m){xn.definitions=m;for(const w in m)A[w]=xn}}function ta(d){if(d instanceof Ho)return ta(d.boundExpression);if(d instanceof xn&&d.name==="error"||d instanceof Wn||d instanceof Do)return!1;const A=d instanceof Xi||d instanceof ro;let m=!0;return d.eachChild(w=>{m=A?m&&ta(w):m&&w instanceof Ze}),!!m&&Yl(d)&&Kl(d,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Yl(d){if(d instanceof xn&&(d.name==="get"&&d.args.length===1||d.name==="feature-state"||d.name==="has"&&d.args.length===1||d.name==="properties"||d.name==="geometry-type"||d.name==="id"||/^filter-/.test(d.name))||d instanceof Do)return!1;let A=!0;return d.eachChild(m=>{A&&!Yl(m)&&(A=!1)}),A}function Po(d){if(d instanceof xn&&d.name==="feature-state")return!1;let A=!0;return d.eachChild(m=>{A&&!Po(m)&&(A=!1)}),A}function Kl(d,A){if(d instanceof xn&&A.indexOf(d.name)>=0)return!1;let m=!0;return d.eachChild(w=>{m&&!Kl(w,A)&&(m=!1)}),m}function dA(d,A){const m=d.length-1;let w,D,N=0,U=m,X=0;for(;N<=U;)if(X=Math.floor((N+U)/2),w=d[X],D=d[X+1],w<=A){if(X===m||A<D)return X;N=X+1}else{if(!(w>A))throw new As("Input is not a number.");U=X-1}return 0}class $n{constructor(A,m,w){this.type=A,this.input=m,this.labels=[],this.outputs=[];for(const[D,N]of w)this.labels.push(D),this.outputs.push(N)}static parse(A,m){if(A.length-1<4)return m.error(`Expected at least 4 arguments, but found only ${A.length-1}.`);if((A.length-1)%2!=0)return m.error("Expected an even number of arguments.");const w=m.parse(A[1],1,gi);if(!w)return null;const D=[];let N=null;m.expectedType&&m.expectedType.kind!=="value"&&(N=m.expectedType);for(let U=1;U<A.length;U+=2){const X=U===1?-1/0:A[U],ee=A[U+1],ae=U,de=U+1;if(typeof X!="number")return m.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',ae);if(D.length&&D[D.length-1][0]>=X)return m.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',ae);const ge=m.parse(ee,de,N);if(!ge)return null;N=N||ge.type,D.push([X,ge])}return new $n(N,w,D)}evaluate(A){const m=this.labels,w=this.outputs;if(m.length===1)return w[0].evaluate(A);const D=this.input.evaluate(A);if(D<=m[0])return w[0].evaluate(A);const N=m.length;return D>=m[N-1]?w[N-1].evaluate(A):w[dA(m,D)].evaluate(A)}eachChild(A){A(this.input);for(const m of this.outputs)A(m)}outputDefined(){return this.outputs.every(A=>A.outputDefined())}}function Ht(d,A,m){return d+m*(A-d)}function ji(d,A,m){return d.map((w,D)=>Ht(w,A[D],m))}const ar={number:Ht,color:function(d,A,m,w="rgb"){switch(w){case"rgb":{const[D,N,U,X]=ji(d.rgb,A.rgb,m);return new nn(D,N,U,X,!1)}case"hcl":{const[D,N,U,X]=d.hcl,[ee,ae,de,ge]=A.hcl;let Ee,Oe;if(isNaN(D)||isNaN(ee))isNaN(D)?isNaN(ee)?Ee=NaN:(Ee=ee,U!==1&&U!==0||(Oe=ae)):(Ee=D,de!==1&&de!==0||(Oe=N));else{let Ct=ee-D;ee>D&&Ct>180?Ct-=360:ee<D&&D-ee>180&&(Ct+=360),Ee=D+m*Ct}const[ce,et,ot,pt]=function([Ct,bt,_e,Ut]){return Ct=isNaN(Ct)?0:Ct*ti,bi([_e,Math.cos(Ct)*bt,Math.sin(Ct)*bt,Ut])}([Ee,Oe??Ht(N,ae,m),Ht(U,de,m),Ht(X,ge,m)]);return new nn(ce,et,ot,pt,!1)}case"lab":{const[D,N,U,X]=bi(ji(d.lab,A.lab,m));return new nn(D,N,U,X,!1)}}},array:ji,padding:function(d,A,m){return new Di(ji(d.values,A.values,m))},variableAnchorOffsetCollection:function(d,A,m){const w=d.values,D=A.values;if(w.length!==D.length)throw new As(`Cannot interpolate values of different length. from: ${d.toString()}, to: ${A.toString()}`);const N=[];for(let U=0;U<w.length;U+=2){if(w[U]!==D[U])throw new As(`Cannot interpolate values containing mismatched anchors. from[${U}]: ${w[U]}, to[${U}]: ${D[U]}`);N.push(w[U]);const[X,ee]=w[U+1],[ae,de]=D[U+1];N.push([Ht(X,ae,m),Ht(ee,de,m)])}return new Ar(N)}};class sn{constructor(A,m,w,D,N){this.type=A,this.operator=m,this.interpolation=w,this.input=D,this.labels=[],this.outputs=[];for(const[U,X]of N)this.labels.push(U),this.outputs.push(X)}static interpolationFactor(A,m,w,D){let N=0;if(A.name==="exponential")N=ia(m,A.base,w,D);else if(A.name==="linear")N=ia(m,1,w,D);else if(A.name==="cubic-bezier"){const U=A.controlPoints;N=new ui(U[0],U[1],U[2],U[3]).solve(ia(m,1,w,D))}return N}static parse(A,m){let[w,D,N,...U]=A;if(!Array.isArray(D)||D.length===0)return m.error("Expected an interpolation type expression.",1);if(D[0]==="linear")D={name:"linear"};else if(D[0]==="exponential"){const ae=D[1];if(typeof ae!="number")return m.error("Exponential interpolation requires a numeric base.",1,1);D={name:"exponential",base:ae}}else{if(D[0]!=="cubic-bezier")return m.error(`Unknown interpolation type ${String(D[0])}`,1,0);{const ae=D.slice(1);if(ae.length!==4||ae.some(de=>typeof de!="number"||de<0||de>1))return m.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);D={name:"cubic-bezier",controlPoints:ae}}}if(A.length-1<4)return m.error(`Expected at least 4 arguments, but found only ${A.length-1}.`);if((A.length-1)%2!=0)return m.error("Expected an even number of arguments.");if(N=m.parse(N,2,gi),!N)return null;const X=[];let ee=null;w==="interpolate-hcl"||w==="interpolate-lab"?ee=Cn:m.expectedType&&m.expectedType.kind!=="value"&&(ee=m.expectedType);for(let ae=0;ae<U.length;ae+=2){const de=U[ae],ge=U[ae+1],Ee=ae+3,Oe=ae+4;if(typeof de!="number")return m.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',Ee);if(X.length&&X[X.length-1][0]>=de)return m.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',Ee);const ce=m.parse(ge,Oe,ee);if(!ce)return null;ee=ee||ce.type,X.push([de,ce])}return Et(ee,gi)||Et(ee,Cn)||Et(ee,Ae)||Et(ee,Te)||Et(ee,Be(gi))?new sn(ee,w,D,N,X):m.error(`Type ${Ve(ee)} is not interpolatable.`)}evaluate(A){const m=this.labels,w=this.outputs;if(m.length===1)return w[0].evaluate(A);const D=this.input.evaluate(A);if(D<=m[0])return w[0].evaluate(A);const N=m.length;if(D>=m[N-1])return w[N-1].evaluate(A);const U=dA(m,D),X=sn.interpolationFactor(this.interpolation,D,m[U],m[U+1]),ee=w[U].evaluate(A),ae=w[U+1].evaluate(A);switch(this.operator){case"interpolate":return ar[this.type.kind](ee,ae,X);case"interpolate-hcl":return ar.color(ee,ae,X,"hcl");case"interpolate-lab":return ar.color(ee,ae,X,"lab")}}eachChild(A){A(this.input);for(const m of this.outputs)A(m)}outputDefined(){return this.outputs.every(A=>A.outputDefined())}}function ia(d,A,m,w){const D=w-m,N=d-m;return D===0?0:A===1?N/D:(Math.pow(A,N)-1)/(Math.pow(A,D)-1)}class Pr{constructor(A,m){this.type=A,this.args=m}static parse(A,m){if(A.length<2)return m.error("Expectected at least one argument.");let w=null;const D=m.expectedType;D&&D.kind!=="value"&&(w=D);const N=[];for(const X of A.slice(1)){const ee=m.parse(X,1+N.length,w,void 0,{typeAnnotation:"omit"});if(!ee)return null;w=w||ee.type,N.push(ee)}if(!w)throw new Error("No output type");const U=D&&N.some(X=>Qe(D,X.type));return new Pr(U?Sr:w,N)}evaluate(A){let m,w=null,D=0;for(const N of this.args)if(D++,w=N.evaluate(A),w&&w instanceof Hs&&!w.available&&(m||(m=w.name),w=null,D===this.args.length&&(w=m)),w!==null)break;return w}eachChild(A){this.args.forEach(A)}outputDefined(){return this.args.every(A=>A.outputDefined())}}class ma{constructor(A,m){this.type=m.type,this.bindings=[].concat(A),this.result=m}evaluate(A){return this.result.evaluate(A)}eachChild(A){for(const m of this.bindings)A(m[1]);A(this.result)}static parse(A,m){if(A.length<4)return m.error(`Expected at least 3 arguments, but found ${A.length-1} instead.`);const w=[];for(let N=1;N<A.length-1;N+=2){const U=A[N];if(typeof U!="string")return m.error(`Expected string, but found ${typeof U} instead.`,N);if(/[^a-zA-Z0-9_]/.test(U))return m.error("Variable names must contain only alphanumeric characters or '_'.",N);const X=m.parse(A[N+1],N+1);if(!X)return null;w.push([U,X])}const D=m.parse(A[A.length-1],A.length-1,m.expectedType,w);return D?new ma(w,D):null}outputDefined(){return this.result.outputDefined()}}class Ja{constructor(A,m,w){this.type=A,this.index=m,this.input=w}static parse(A,m){if(A.length!==3)return m.error(`Expected 2 arguments, but found ${A.length-1} instead.`);const w=m.parse(A[1],1,gi),D=m.parse(A[2],2,Be(m.expectedType||Sr));return w&&D?new Ja(D.type.itemType,w,D):null}evaluate(A){const m=this.index.evaluate(A),w=this.input.evaluate(A);if(m<0)throw new As(`Array index out of bounds: ${m} < 0.`);if(m>=w.length)throw new As(`Array index out of bounds: ${m} > ${w.length-1}.`);if(m!==Math.floor(m))throw new As(`Array index must be an integer, but found ${m} instead.`);return w[m]}eachChild(A){A(this.index),A(this.input)}outputDefined(){return!1}}class ra{constructor(A,m){this.type=wr,this.needle=A,this.haystack=m}static parse(A,m){if(A.length!==3)return m.error(`Expected 2 arguments, but found ${A.length-1} instead.`);const w=m.parse(A[1],1,Sr),D=m.parse(A[2],2,Sr);return w&&D?Ge(w.type,[wr,br,gi,ls,Sr])?new ra(w,D):m.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ve(w.type)} instead`):null}evaluate(A){const m=this.needle.evaluate(A),w=this.haystack.evaluate(A);if(!w)return!1;if(!He(m,["boolean","string","number","null"]))throw new As(`Expected first argument to be of type boolean, string, number or null, but found ${Ve(nt(m))} instead.`);if(!He(w,["string","array"]))throw new As(`Expected second argument to be of type array or string, but found ${Ve(nt(w))} instead.`);return w.indexOf(m)>=0}eachChild(A){A(this.needle),A(this.haystack)}outputDefined(){return!0}}class no{constructor(A,m,w){this.type=gi,this.needle=A,this.haystack=m,this.fromIndex=w}static parse(A,m){if(A.length<=2||A.length>=5)return m.error(`Expected 3 or 4 arguments, but found ${A.length-1} instead.`);const w=m.parse(A[1],1,Sr),D=m.parse(A[2],2,Sr);if(!w||!D)return null;if(!Ge(w.type,[wr,br,gi,ls,Sr]))return m.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ve(w.type)} instead`);if(A.length===4){const N=m.parse(A[3],3,gi);return N?new no(w,D,N):null}return new no(w,D)}evaluate(A){const m=this.needle.evaluate(A),w=this.haystack.evaluate(A);if(!He(m,["boolean","string","number","null"]))throw new As(`Expected first argument to be of type boolean, string, number or null, but found ${Ve(nt(m))} instead.`);if(!He(w,["string","array"]))throw new As(`Expected second argument to be of type array or string, but found ${Ve(nt(w))} instead.`);if(this.fromIndex){const D=this.fromIndex.evaluate(A);return w.indexOf(m,D)}return w.indexOf(m)}eachChild(A){A(this.needle),A(this.haystack),this.fromIndex&&A(this.fromIndex)}outputDefined(){return!1}}class Xn{constructor(A,m,w,D,N,U){this.inputType=A,this.type=m,this.input=w,this.cases=D,this.outputs=N,this.otherwise=U}static parse(A,m){if(A.length<5)return m.error(`Expected at least 4 arguments, but found only ${A.length-1}.`);if(A.length%2!=1)return m.error("Expected an even number of arguments.");let w,D;m.expectedType&&m.expectedType.kind!=="value"&&(D=m.expectedType);const N={},U=[];for(let ae=2;ae<A.length-1;ae+=2){let de=A[ae];const ge=A[ae+1];Array.isArray(de)||(de=[de]);const Ee=m.concat(ae);if(de.length===0)return Ee.error("Expected at least one branch label.");for(const ce of de){if(typeof ce!="number"&&typeof ce!="string")return Ee.error("Branch labels must be numbers or strings.");if(typeof ce=="number"&&Math.abs(ce)>Number.MAX_SAFE_INTEGER)return Ee.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof ce=="number"&&Math.floor(ce)!==ce)return Ee.error("Numeric branch labels must be integer values.");if(w){if(Ee.checkSubtype(w,nt(ce)))return null}else w=nt(ce);if(N[String(ce)]!==void 0)return Ee.error("Branch labels must be unique.");N[String(ce)]=U.length}const Oe=m.parse(ge,ae,D);if(!Oe)return null;D=D||Oe.type,U.push(Oe)}const X=m.parse(A[1],1,Sr);if(!X)return null;const ee=m.parse(A[A.length-1],A.length-1,D);return ee?X.type.kind!=="value"&&m.concat(1).checkSubtype(w,X.type)?null:new Xn(w,D,X,N,U,ee):null}evaluate(A){const m=this.input.evaluate(A);return(nt(m)===this.inputType&&this.outputs[this.cases[m]]||this.otherwise).evaluate(A)}eachChild(A){A(this.input),this.outputs.forEach(A),A(this.otherwise)}outputDefined(){return this.outputs.every(A=>A.outputDefined())&&this.otherwise.outputDefined()}}class fl{constructor(A,m,w){this.type=A,this.branches=m,this.otherwise=w}static parse(A,m){if(A.length<4)return m.error(`Expected at least 3 arguments, but found only ${A.length-1}.`);if(A.length%2!=0)return m.error("Expected an odd number of arguments.");let w;m.expectedType&&m.expectedType.kind!=="value"&&(w=m.expectedType);const D=[];for(let U=1;U<A.length-1;U+=2){const X=m.parse(A[U],U,wr);if(!X)return null;const ee=m.parse(A[U+1],U+1,w);if(!ee)return null;D.push([X,ee]),w=w||ee.type}const N=m.parse(A[A.length-1],A.length-1,w);if(!N)return null;if(!w)throw new Error("Can't infer output type");return new fl(w,D,N)}evaluate(A){for(const[m,w]of this.branches)if(m.evaluate(A))return w.evaluate(A);return this.otherwise.evaluate(A)}eachChild(A){for(const[m,w]of this.branches)A(m),A(w);A(this.otherwise)}outputDefined(){return this.branches.every(([A,m])=>m.outputDefined())&&this.otherwise.outputDefined()}}class Os{constructor(A,m,w,D){this.type=A,this.input=m,this.beginIndex=w,this.endIndex=D}static parse(A,m){if(A.length<=2||A.length>=5)return m.error(`Expected 3 or 4 arguments, but found ${A.length-1} instead.`);const w=m.parse(A[1],1,Sr),D=m.parse(A[2],2,gi);if(!w||!D)return null;if(!Ge(w.type,[Be(Sr),br,Sr]))return m.error(`Expected first argument to be of type array or string, but found ${Ve(w.type)} instead`);if(A.length===4){const N=m.parse(A[3],3,gi);return N?new Os(w.type,w,D,N):null}return new Os(w.type,w,D)}evaluate(A){const m=this.input.evaluate(A),w=this.beginIndex.evaluate(A);if(!He(m,["string","array"]))throw new As(`Expected first argument to be of type array or string, but found ${Ve(nt(m))} instead.`);if(this.endIndex){const D=this.endIndex.evaluate(A);return m.slice(w,D)}return m.slice(w)}eachChild(A){A(this.input),A(this.beginIndex),this.endIndex&&A(this.endIndex)}outputDefined(){return!1}}function _a(d,A){return d==="=="||d==="!="?A.kind==="boolean"||A.kind==="string"||A.kind==="number"||A.kind==="null"||A.kind==="value":A.kind==="string"||A.kind==="number"||A.kind==="value"}function zl(d,A,m,w){return w.compare(A,m)===0}function ga(d,A,m){const w=d!=="=="&&d!=="!=";return class _2{constructor(N,U,X){this.type=wr,this.lhs=N,this.rhs=U,this.collator=X,this.hasUntypedArgument=N.type.kind==="value"||U.type.kind==="value"}static parse(N,U){if(N.length!==3&&N.length!==4)return U.error("Expected two or three arguments.");const X=N[0];let ee=U.parse(N[1],1,Sr);if(!ee)return null;if(!_a(X,ee.type))return U.concat(1).error(`"${X}" comparisons are not supported for type '${Ve(ee.type)}'.`);let ae=U.parse(N[2],2,Sr);if(!ae)return null;if(!_a(X,ae.type))return U.concat(2).error(`"${X}" comparisons are not supported for type '${Ve(ae.type)}'.`);if(ee.type.kind!==ae.type.kind&&ee.type.kind!=="value"&&ae.type.kind!=="value")return U.error(`Cannot compare types '${Ve(ee.type)}' and '${Ve(ae.type)}'.`);w&&(ee.type.kind==="value"&&ae.type.kind!=="value"?ee=new ro(ae.type,[ee]):ee.type.kind!=="value"&&ae.type.kind==="value"&&(ae=new ro(ee.type,[ae])));let de=null;if(N.length===4){if(ee.type.kind!=="string"&&ae.type.kind!=="string"&&ee.type.kind!=="value"&&ae.type.kind!=="value")return U.error("Cannot use collator to compare non-string types.");if(de=U.parse(N[3],3,kt),!de)return null}return new _2(ee,ae,de)}evaluate(N){const U=this.lhs.evaluate(N),X=this.rhs.evaluate(N);if(w&&this.hasUntypedArgument){const ee=nt(U),ae=nt(X);if(ee.kind!==ae.kind||ee.kind!=="string"&&ee.kind!=="number")throw new As(`Expected arguments for "${d}" to be (string, string) or (number, number), but found (${ee.kind}, ${ae.kind}) instead.`)}if(this.collator&&!w&&this.hasUntypedArgument){const ee=nt(U),ae=nt(X);if(ee.kind!=="string"||ae.kind!=="string")return A(N,U,X)}return this.collator?m(N,U,X,this.collator.evaluate(N)):A(N,U,X)}eachChild(N){N(this.lhs),N(this.rhs),this.collator&&N(this.collator)}outputDefined(){return!0}}}const el=ga("==",function(d,A,m){return A===m},zl),Fa=ga("!=",function(d,A,m){return A!==m},function(d,A,m,w){return!zl(0,A,m,w)}),KA=ga("<",function(d,A,m){return A<m},function(d,A,m,w){return w.compare(A,m)<0}),fA=ga(">",function(d,A,m){return A>m},function(d,A,m,w){return w.compare(A,m)>0}),PA=ga("<=",function(d,A,m){return A<=m},function(d,A,m,w){return w.compare(A,m)<=0}),Wo=ga(">=",function(d,A,m){return A>=m},function(d,A,m,w){return w.compare(A,m)>=0});class pr{constructor(A,m,w,D,N){this.type=br,this.number=A,this.locale=m,this.currency=w,this.minFractionDigits=D,this.maxFractionDigits=N}static parse(A,m){if(A.length!==3)return m.error("Expected two arguments.");const w=m.parse(A[1],1,gi);if(!w)return null;const D=A[2];if(typeof D!="object"||Array.isArray(D))return m.error("NumberFormat options argument must be an object.");let N=null;if(D.locale&&(N=m.parse(D.locale,1,br),!N))return null;let U=null;if(D.currency&&(U=m.parse(D.currency,1,br),!U))return null;let X=null;if(D["min-fraction-digits"]&&(X=m.parse(D["min-fraction-digits"],1,gi),!X))return null;let ee=null;return D["max-fraction-digits"]&&(ee=m.parse(D["max-fraction-digits"],1,gi),!ee)?null:new pr(w,N,U,X,ee)}evaluate(A){return new Intl.NumberFormat(this.locale?this.locale.evaluate(A):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(A):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(A):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(A):void 0}).format(this.number.evaluate(A))}eachChild(A){A(this.number),this.locale&&A(this.locale),this.currency&&A(this.currency),this.minFractionDigits&&A(this.minFractionDigits),this.maxFractionDigits&&A(this.maxFractionDigits)}outputDefined(){return!1}}class Oa{constructor(A){this.type=we,this.sections=A}static parse(A,m){if(A.length<2)return m.error("Expected at least one argument.");const w=A[1];if(!Array.isArray(w)&&typeof w=="object")return m.error("First argument must be an image or text section.");const D=[];let N=!1;for(let U=1;U<=A.length-1;++U){const X=A[U];if(N&&typeof X=="object"&&!Array.isArray(X)){N=!1;let ee=null;if(X["font-scale"]&&(ee=m.parse(X["font-scale"],1,gi),!ee))return null;let ae=null;if(X["text-font"]&&(ae=m.parse(X["text-font"],1,Be(br)),!ae))return null;let de=null;if(X["text-color"]&&(de=m.parse(X["text-color"],1,Cn),!de))return null;const ge=D[D.length-1];ge.scale=ee,ge.font=ae,ge.textColor=de}else{const ee=m.parse(A[U],1,Sr);if(!ee)return null;const ae=ee.type.kind;if(ae!=="string"&&ae!=="value"&&ae!=="null"&&ae!=="resolvedImage")return m.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");N=!0,D.push({content:ee,scale:null,font:null,textColor:null})}}return new Oa(D)}evaluate(A){return new gt(this.sections.map(m=>{const w=m.content.evaluate(A);return nt(w)===pe?new Dr("",w,null,null,null):new Dr(yn(w),null,m.scale?m.scale.evaluate(A):null,m.font?m.font.evaluate(A).join(","):null,m.textColor?m.textColor.evaluate(A):null)}))}eachChild(A){for(const m of this.sections)A(m.content),m.scale&&A(m.scale),m.font&&A(m.font),m.textColor&&A(m.textColor)}outputDefined(){return!1}}class zA{constructor(A){this.type=pe,this.input=A}static parse(A,m){if(A.length!==2)return m.error("Expected two arguments.");const w=m.parse(A[1],1,br);return w?new zA(w):m.error("No image name provided.")}evaluate(A){const m=this.input.evaluate(A),w=Hs.fromString(m);return w&&A.availableImages&&(w.available=A.availableImages.indexOf(m)>-1),w}eachChild(A){A(this.input)}outputDefined(){return!1}}class uo{constructor(A){this.type=gi,this.input=A}static parse(A,m){if(A.length!==2)return m.error(`Expected 1 argument, but found ${A.length-1} instead.`);const w=m.parse(A[1],1);return w?w.type.kind!=="array"&&w.type.kind!=="string"&&w.type.kind!=="value"?m.error(`Expected argument of type string or array, but found ${Ve(w.type)} instead.`):new uo(w):null}evaluate(A){const m=this.input.evaluate(A);if(typeof m=="string"||Array.isArray(m))return m.length;throw new As(`Expected value to be of type string or array, but found ${Ve(nt(m))} instead.`)}eachChild(A){A(this.input)}outputDefined(){return!1}}const so={"==":el,"!=":Fa,">":fA,"<":KA,">=":Wo,"<=":PA,array:ro,at:Ja,boolean:ro,case:fl,coalesce:Pr,collator:Wn,format:Oa,image:zA,in:ra,"index-of":no,interpolate:sn,"interpolate-hcl":sn,"interpolate-lab":sn,length:uo,let:ma,literal:Ze,match:Xn,number:ro,"number-format":pr,object:ro,slice:Os,step:$n,string:ro,"to-boolean":Xi,"to-color":Xi,"to-number":Xi,"to-string":Xi,var:Ho,within:Do};function Bl(d,[A,m,w,D]){A=A.evaluate(d),m=m.evaluate(d),w=w.evaluate(d);const N=D?D.evaluate(d):1,U=DA(A,m,w,N);if(U)throw new As(U);return new nn(A/255,m/255,w/255,N,!1)}function Jl(d,A){return d in A}function hs(d,A){const m=A[d];return m===void 0?null:m}function ya(d){return{type:d}}function Ll(d){return{result:"success",value:d}}function Vs(d){return{result:"error",value:d}}function cs(d){return d["property-type"]==="data-driven"||d["property-type"]==="cross-faded-data-driven"}function Rl(d){return!!d.expression&&d.expression.parameters.indexOf("zoom")>-1}function BA(d){return!!d.expression&&d.expression.interpolated}function Gr(d){return d instanceof Number?"number":d instanceof String?"string":d instanceof Boolean?"boolean":Array.isArray(d)?"array":d===null?"null":typeof d}function Yn(d){return typeof d=="object"&&d!==null&&!Array.isArray(d)}function eA(d){return d}function Gi(d,A){const m=A.type==="color",w=d.stops&&typeof d.stops[0][0]=="object",D=w||!(w||d.property!==void 0),N=d.type||(BA(A)?"exponential":"interval");if(m||A.type==="padding"){const de=m?nn.parse:Di.parse;(d=gn({},d)).stops&&(d.stops=d.stops.map(ge=>[ge[0],de(ge[1])])),d.default=de(d.default?d.default:A.default)}if(d.colorSpace&&(U=d.colorSpace)!=="rgb"&&U!=="hcl"&&U!=="lab")throw new Error(`Unknown color space: "${d.colorSpace}"`);var U;let X,ee,ae;if(N==="exponential")X=Va;else if(N==="interval")X=Tn;else if(N==="categorical"){X=ns,ee=Object.create(null);for(const de of d.stops)ee[de[0]]=de[1];ae=typeof d.stops[0][0]}else{if(N!=="identity")throw new Error(`Unknown function type "${N}"`);X=Tc}if(w){const de={},ge=[];for(let ce=0;ce<d.stops.length;ce++){const et=d.stops[ce],ot=et[0].zoom;de[ot]===void 0&&(de[ot]={zoom:ot,type:d.type,property:d.property,default:d.default,stops:[]},ge.push(ot)),de[ot].stops.push([et[0].value,et[1]])}const Ee=[];for(const ce of ge)Ee.push([de[ce].zoom,Gi(de[ce],A)]);const Oe={name:"linear"};return{kind:"composite",interpolationType:Oe,interpolationFactor:sn.interpolationFactor.bind(void 0,Oe),zoomStops:Ee.map(ce=>ce[0]),evaluate:({zoom:ce},et)=>Va({stops:Ee,base:d.base},A,ce).evaluate(ce,et)}}if(D){const de=N==="exponential"?{name:"exponential",base:d.base!==void 0?d.base:1}:null;return{kind:"camera",interpolationType:de,interpolationFactor:sn.interpolationFactor.bind(void 0,de),zoomStops:d.stops.map(ge=>ge[0]),evaluate:({zoom:ge})=>X(d,A,ge,ee,ae)}}return{kind:"source",evaluate(de,ge){const Ee=ge&&ge.properties?ge.properties[d.property]:void 0;return Ee===void 0?xa(d.default,A.default):X(d,A,Ee,ee,ae)}}}function xa(d,A,m){return d!==void 0?d:A!==void 0?A:m!==void 0?m:void 0}function ns(d,A,m,w,D){return xa(typeof m===D?w[m]:void 0,d.default,A.default)}function Tn(d,A,m){if(Gr(m)!=="number")return xa(d.default,A.default);const w=d.stops.length;if(w===1||m<=d.stops[0][0])return d.stops[0][1];if(m>=d.stops[w-1][0])return d.stops[w-1][1];const D=dA(d.stops.map(N=>N[0]),m);return d.stops[D][1]}function Va(d,A,m){const w=d.base!==void 0?d.base:1;if(Gr(m)!=="number")return xa(d.default,A.default);const D=d.stops.length;if(D===1||m<=d.stops[0][0])return d.stops[0][1];if(m>=d.stops[D-1][0])return d.stops[D-1][1];const N=dA(d.stops.map(de=>de[0]),m),U=function(de,ge,Ee,Oe){const ce=Oe-Ee,et=de-Ee;return ce===0?0:ge===1?et/ce:(Math.pow(ge,et)-1)/(Math.pow(ge,ce)-1)}(m,w,d.stops[N][0],d.stops[N+1][0]),X=d.stops[N][1],ee=d.stops[N+1][1],ae=ar[A.type]||eA;return typeof X.evaluate=="function"?{evaluate(...de){const ge=X.evaluate.apply(void 0,de),Ee=ee.evaluate.apply(void 0,de);if(ge!==void 0&&Ee!==void 0)return ae(ge,Ee,U,d.colorSpace)}}:ae(X,ee,U,d.colorSpace)}function Tc(d,A,m){switch(A.type){case"color":m=nn.parse(m);break;case"formatted":m=gt.fromString(m.toString());break;case"resolvedImage":m=Hs.fromString(m.toString());break;case"padding":m=Di.parse(m);break;default:Gr(m)===A.type||A.type==="enum"&&A.values[m]||(m=void 0)}return xa(m,d.default,A.default)}xn.register(so,{error:[{kind:"error"},[br],(d,[A])=>{throw new As(A.evaluate(d))}],typeof:[br,[Sr],(d,[A])=>Ve(nt(A.evaluate(d)))],"to-rgba":[Be(gi,4),[Cn],(d,[A])=>{const[m,w,D,N]=A.evaluate(d).rgb;return[255*m,255*w,255*D,N]}],rgb:[Cn,[gi,gi,gi],Bl],rgba:[Cn,[gi,gi,gi,gi],Bl],has:{type:wr,overloads:[[[br],(d,[A])=>Jl(A.evaluate(d),d.properties())],[[br,io],(d,[A,m])=>Jl(A.evaluate(d),m.evaluate(d))]]},get:{type:Sr,overloads:[[[br],(d,[A])=>hs(A.evaluate(d),d.properties())],[[br,io],(d,[A,m])=>hs(A.evaluate(d),m.evaluate(d))]]},"feature-state":[Sr,[br],(d,[A])=>hs(A.evaluate(d),d.featureState||{})],properties:[io,[],d=>d.properties()],"geometry-type":[br,[],d=>d.geometryType()],id:[Sr,[],d=>d.id()],zoom:[gi,[],d=>d.globals.zoom],"heatmap-density":[gi,[],d=>d.globals.heatmapDensity||0],"line-progress":[gi,[],d=>d.globals.lineProgress||0],accumulated:[Sr,[],d=>d.globals.accumulated===void 0?null:d.globals.accumulated],"+":[gi,ya(gi),(d,A)=>{let m=0;for(const w of A)m+=w.evaluate(d);return m}],"*":[gi,ya(gi),(d,A)=>{let m=1;for(const w of A)m*=w.evaluate(d);return m}],"-":{type:gi,overloads:[[[gi,gi],(d,[A,m])=>A.evaluate(d)-m.evaluate(d)],[[gi],(d,[A])=>-A.evaluate(d)]]},"/":[gi,[gi,gi],(d,[A,m])=>A.evaluate(d)/m.evaluate(d)],"%":[gi,[gi,gi],(d,[A,m])=>A.evaluate(d)%m.evaluate(d)],ln2:[gi,[],()=>Math.LN2],pi:[gi,[],()=>Math.PI],e:[gi,[],()=>Math.E],"^":[gi,[gi,gi],(d,[A,m])=>Math.pow(A.evaluate(d),m.evaluate(d))],sqrt:[gi,[gi],(d,[A])=>Math.sqrt(A.evaluate(d))],log10:[gi,[gi],(d,[A])=>Math.log(A.evaluate(d))/Math.LN10],ln:[gi,[gi],(d,[A])=>Math.log(A.evaluate(d))],log2:[gi,[gi],(d,[A])=>Math.log(A.evaluate(d))/Math.LN2],sin:[gi,[gi],(d,[A])=>Math.sin(A.evaluate(d))],cos:[gi,[gi],(d,[A])=>Math.cos(A.evaluate(d))],tan:[gi,[gi],(d,[A])=>Math.tan(A.evaluate(d))],asin:[gi,[gi],(d,[A])=>Math.asin(A.evaluate(d))],acos:[gi,[gi],(d,[A])=>Math.acos(A.evaluate(d))],atan:[gi,[gi],(d,[A])=>Math.atan(A.evaluate(d))],min:[gi,ya(gi),(d,A)=>Math.min(...A.map(m=>m.evaluate(d)))],max:[gi,ya(gi),(d,A)=>Math.max(...A.map(m=>m.evaluate(d)))],abs:[gi,[gi],(d,[A])=>Math.abs(A.evaluate(d))],round:[gi,[gi],(d,[A])=>{const m=A.evaluate(d);return m<0?-Math.round(-m):Math.round(m)}],floor:[gi,[gi],(d,[A])=>Math.floor(A.evaluate(d))],ceil:[gi,[gi],(d,[A])=>Math.ceil(A.evaluate(d))],"filter-==":[wr,[br,Sr],(d,[A,m])=>d.properties()[A.value]===m.value],"filter-id-==":[wr,[Sr],(d,[A])=>d.id()===A.value],"filter-type-==":[wr,[br],(d,[A])=>d.geometryType()===A.value],"filter-<":[wr,[br,Sr],(d,[A,m])=>{const w=d.properties()[A.value],D=m.value;return typeof w==typeof D&&w<D}],"filter-id-<":[wr,[Sr],(d,[A])=>{const m=d.id(),w=A.value;return typeof m==typeof w&&m<w}],"filter->":[wr,[br,Sr],(d,[A,m])=>{const w=d.properties()[A.value],D=m.value;return typeof w==typeof D&&w>D}],"filter-id->":[wr,[Sr],(d,[A])=>{const m=d.id(),w=A.value;return typeof m==typeof w&&m>w}],"filter-<=":[wr,[br,Sr],(d,[A,m])=>{const w=d.properties()[A.value],D=m.value;return typeof w==typeof D&&w<=D}],"filter-id-<=":[wr,[Sr],(d,[A])=>{const m=d.id(),w=A.value;return typeof m==typeof w&&m<=w}],"filter->=":[wr,[br,Sr],(d,[A,m])=>{const w=d.properties()[A.value],D=m.value;return typeof w==typeof D&&w>=D}],"filter-id->=":[wr,[Sr],(d,[A])=>{const m=d.id(),w=A.value;return typeof m==typeof w&&m>=w}],"filter-has":[wr,[Sr],(d,[A])=>A.value in d.properties()],"filter-has-id":[wr,[],d=>d.id()!==null&&d.id()!==void 0],"filter-type-in":[wr,[Be(br)],(d,[A])=>A.value.indexOf(d.geometryType())>=0],"filter-id-in":[wr,[Be(Sr)],(d,[A])=>A.value.indexOf(d.id())>=0],"filter-in-small":[wr,[br,Be(Sr)],(d,[A,m])=>m.value.indexOf(d.properties()[A.value])>=0],"filter-in-large":[wr,[br,Be(Sr)],(d,[A,m])=>function(w,D,N,U){for(;N<=U;){const X=N+U>>1;if(D[X]===w)return!0;D[X]>w?U=X-1:N=X+1}return!1}(d.properties()[A.value],m.value,0,m.value.length-1)],all:{type:wr,overloads:[[[wr,wr],(d,[A,m])=>A.evaluate(d)&&m.evaluate(d)],[ya(wr),(d,A)=>{for(const m of A)if(!m.evaluate(d))return!1;return!0}]]},any:{type:wr,overloads:[[[wr,wr],(d,[A,m])=>A.evaluate(d)||m.evaluate(d)],[ya(wr),(d,A)=>{for(const m of A)if(m.evaluate(d))return!0;return!1}]]},"!":[wr,[wr],(d,[A])=>!A.evaluate(d)],"is-supported-script":[wr,[br],(d,[A])=>{const m=d.globals&&d.globals.isSupportedScript;return!m||m(A.evaluate(d))}],upcase:[br,[br],(d,[A])=>A.evaluate(d).toUpperCase()],downcase:[br,[br],(d,[A])=>A.evaluate(d).toLowerCase()],concat:[br,ya(Sr),(d,A)=>A.map(m=>yn(m.evaluate(d))).join("")],"resolved-locale":[br,[kt],(d,[A])=>A.evaluate(d).resolvedLocale()]});class tl{constructor(A,m){var w;this.expression=A,this._warningHistory={},this._evaluator=new Qo,this._defaultValue=m?(w=m).type==="color"&&Yn(w.default)?new nn(0,0,0,0):w.type==="color"?nn.parse(w.default)||null:w.type==="padding"?Di.parse(w.default)||null:w.type==="variableAnchorOffsetCollection"?Ar.parse(w.default)||null:w.default===void 0?null:w.default:null,this._enumValues=m&&m.type==="enum"?m.values:null}evaluateWithoutErrorHandling(A,m,w,D,N,U){return this._evaluator.globals=A,this._evaluator.feature=m,this._evaluator.featureState=w,this._evaluator.canonical=D,this._evaluator.availableImages=N||null,this._evaluator.formattedSection=U,this.expression.evaluate(this._evaluator)}evaluate(A,m,w,D,N,U){this._evaluator.globals=A,this._evaluator.feature=m||null,this._evaluator.featureState=w||null,this._evaluator.canonical=D,this._evaluator.availableImages=N||null,this._evaluator.formattedSection=U||null;try{const X=this.expression.evaluate(this._evaluator);if(X==null||typeof X=="number"&&X!=X)return this._defaultValue;if(this._enumValues&&!(X in this._enumValues))throw new As(`Expected value to be one of ${Object.keys(this._enumValues).map(ee=>JSON.stringify(ee)).join(", ")}, but found ${JSON.stringify(X)} instead.`);return X}catch(X){return this._warningHistory[X.message]||(this._warningHistory[X.message]=!0,typeof console<"u"&&console.warn(X.message)),this._defaultValue}}}function pA(d){return Array.isArray(d)&&d.length>0&&typeof d[0]=="string"&&d[0]in so}function zo(d,A){const m=new Fs(so,ta,[],A?function(D){const N={color:Cn,string:br,number:gi,enum:br,boolean:wr,formatted:we,padding:Ae,resolvedImage:pe,variableAnchorOffsetCollection:Te};return D.type==="array"?Be(N[D.value]||Sr,D.length):N[D.type]}(A):void 0),w=m.parse(d,void 0,void 0,void 0,A&&A.type==="string"?{typeAnnotation:"coerce"}:void 0);return w?Ll(new tl(w,A)):Vs(m.errors)}class pl{constructor(A,m){this.kind=A,this._styleExpression=m,this.isStateDependent=A!=="constant"&&!Po(m.expression)}evaluateWithoutErrorHandling(A,m,w,D,N,U){return this._styleExpression.evaluateWithoutErrorHandling(A,m,w,D,N,U)}evaluate(A,m,w,D,N,U){return this._styleExpression.evaluate(A,m,w,D,N,U)}}class Ln{constructor(A,m,w,D){this.kind=A,this.zoomStops=w,this._styleExpression=m,this.isStateDependent=A!=="camera"&&!Po(m.expression),this.interpolationType=D}evaluateWithoutErrorHandling(A,m,w,D,N,U){return this._styleExpression.evaluateWithoutErrorHandling(A,m,w,D,N,U)}evaluate(A,m,w,D,N,U){return this._styleExpression.evaluate(A,m,w,D,N,U)}interpolationFactor(A,m,w){return this.interpolationType?sn.interpolationFactor(this.interpolationType,A,m,w):0}}function Ec(d,A){const m=zo(d,A);if(m.result==="error")return m;const w=m.value.expression,D=Yl(w);if(!D&&!cs(A))return Vs([new vr("","data expressions not supported")]);const N=Kl(w,["zoom"]);if(!N&&!Rl(A))return Vs([new vr("","zoom expressions not supported")]);const U=il(w);return U||N?U instanceof vr?Vs([U]):U instanceof sn&&!BA(A)?Vs([new vr("",'"interpolate" expressions cannot be used with this property')]):Ll(U?new Ln(D?"camera":"composite",m.value,U.labels,U instanceof sn?U.interpolation:void 0):new pl(D?"constant":"source",m.value)):Vs([new vr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class mA{constructor(A,m){this._parameters=A,this._specification=m,gn(this,Gi(this._parameters,this._specification))}static deserialize(A){return new mA(A._parameters,A._specification)}static serialize(A){return{_parameters:A._parameters,_specification:A._specification}}}function il(d){let A=null;if(d instanceof ma)A=il(d.result);else if(d instanceof Pr){for(const m of d.args)if(A=il(m),A)break}else(d instanceof $n||d instanceof sn)&&d.input instanceof xn&&d.input.name==="zoom"&&(A=d);return A instanceof vr||d.eachChild(m=>{const w=il(m);w instanceof vr?A=w:!A&&w?A=new vr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):A&&w&&A!==w&&(A=new vr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),A}function Na(d){if(d===!0||d===!1)return!0;if(!Array.isArray(d)||d.length===0)return!1;switch(d[0]){case"has":return d.length>=2&&d[1]!=="$id"&&d[1]!=="$type";case"in":return d.length>=3&&(typeof d[1]!="string"||Array.isArray(d[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return d.length!==3||Array.isArray(d[1])||Array.isArray(d[2]);case"any":case"all":for(const A of d.slice(1))if(!Na(A)&&typeof A!="boolean")return!1;return!0;default:return!0}}const xu={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Ps(d){if(d==null)return{filter:()=>!0,needGeometry:!1};Na(d)||(d=na(d));const A=zo(d,xu);if(A.result==="error")throw new Error(A.value.map(m=>`${m.key}: ${m.message}`).join(", "));return{filter:(m,w,D)=>A.value.evaluate(m,w,{},D),needGeometry:oo(d)}}function Ns(d,A){return d<A?-1:d>A?1:0}function oo(d){if(!Array.isArray(d))return!1;if(d[0]==="within")return!0;for(let A=1;A<d.length;A++)if(oo(d[A]))return!0;return!1}function na(d){if(!d)return!0;const A=d[0];return d.length<=1?A!=="any":A==="=="?ml(d[1],d[2],"=="):A==="!="?Ws(ml(d[1],d[2],"==")):A==="<"||A===">"||A==="<="||A===">="?ml(d[1],d[2],A):A==="any"?(m=d.slice(1),["any"].concat(m.map(na))):A==="all"?["all"].concat(d.slice(1).map(na)):A==="none"?["all"].concat(d.slice(1).map(na).map(Ws)):A==="in"?Kc(d[1],d.slice(2)):A==="!in"?Ws(Kc(d[1],d.slice(2))):A==="has"?JA(d[1]):A==="!has"?Ws(JA(d[1])):A!=="within"||d;var m}function ml(d,A,m){switch(d){case"$type":return[`filter-type-${m}`,A];case"$id":return[`filter-id-${m}`,A];default:return[`filter-${m}`,d,A]}}function Kc(d,A){if(A.length===0)return!1;switch(d){case"$type":return["filter-type-in",["literal",A]];case"$id":return["filter-id-in",["literal",A]];default:return A.length>200&&!A.some(m=>typeof m!=typeof A[0])?["filter-in-large",d,["literal",A.sort(Ns)]]:["filter-in-small",d,["literal",A]]}}function JA(d){switch(d){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",d]}}function Ws(d){return["!",d]}function ho(d){const A=typeof d;if(A==="number"||A==="boolean"||A==="string"||d==null)return JSON.stringify(d);if(Array.isArray(d)){let D="[";for(const N of d)D+=`${ho(N)},`;return`${D}]`}const m=Object.keys(d).sort();let w="{";for(let D=0;D<m.length;D++)w+=`${JSON.stringify(m[D])}:${ho(d[m[D]])},`;return`${w}}`}function $o(d){let A="";for(const m of Ft)A+=`/${ho(d[m])}`;return A}function LA(d){const A=d.value;return A?[new oi(d.key,A,"constants have been deprecated as of v8")]:[]}function Pn(d){return d instanceof Number||d instanceof String||d instanceof Boolean?d.valueOf():d}function va(d){if(Array.isArray(d))return d.map(va);if(d instanceof Object&&!(d instanceof Number||d instanceof String||d instanceof Boolean)){const A={};for(const m in d)A[m]=va(d[m]);return A}return Pn(d)}function Rn(d){const A=d.key,m=d.value,w=d.valueSpec||{},D=d.objectElementValidators||{},N=d.style,U=d.styleSpec,X=d.validateSpec;let ee=[];const ae=Gr(m);if(ae!=="object")return[new oi(A,m,`object expected, ${ae} found`)];for(const de in m){const ge=de.split(".")[0],Ee=w[ge]||w["*"];let Oe;if(D[ge])Oe=D[ge];else if(w[ge])Oe=X;else if(D["*"])Oe=D["*"];else{if(!w["*"]){ee.push(new oi(A,m[de],`unknown property "${de}"`));continue}Oe=X}ee=ee.concat(Oe({key:(A&&`${A}.`)+de,value:m[de],valueSpec:Ee,style:N,styleSpec:U,object:m,objectKey:de,validateSpec:X},m))}for(const de in w)D[de]||w[de].required&&w[de].default===void 0&&m[de]===void 0&&ee.push(new oi(A,m,`missing required property "${de}"`));return ee}function Ua(d){const A=d.value,m=d.valueSpec,w=d.style,D=d.styleSpec,N=d.key,U=d.arrayElementValidator||d.validateSpec;if(Gr(A)!=="array")return[new oi(N,A,`array expected, ${Gr(A)} found`)];if(m.length&&A.length!==m.length)return[new oi(N,A,`array length ${m.length} expected, length ${A.length} found`)];if(m["min-length"]&&A.length<m["min-length"])return[new oi(N,A,`array length at least ${m["min-length"]} expected, length ${A.length} found`)];let X={type:m.value,values:m.values};D.$version<7&&(X.function=m.function),Gr(m.value)==="object"&&(X=m.value);let ee=[];for(let ae=0;ae<A.length;ae++)ee=ee.concat(U({array:A,arrayIndex:ae,value:A[ae],valueSpec:X,validateSpec:d.validateSpec,style:w,styleSpec:D,key:`${N}[${ae}]`}));return ee}function rl(d){const A=d.key,m=d.value,w=d.valueSpec;let D=Gr(m);return D==="number"&&m!=m&&(D="NaN"),D!=="number"?[new oi(A,m,`number expected, ${D} found`)]:"minimum"in w&&m<w.minimum?[new oi(A,m,`${m} is less than the minimum value ${w.minimum}`)]:"maximum"in w&&m>w.maximum?[new oi(A,m,`${m} is greater than the maximum value ${w.maximum}`)]:[]}function _l(d){const A=d.valueSpec,m=Pn(d.value.type);let w,D,N,U={};const X=m!=="categorical"&&d.value.property===void 0,ee=!X,ae=Gr(d.value.stops)==="array"&&Gr(d.value.stops[0])==="array"&&Gr(d.value.stops[0][0])==="object",de=Rn({key:d.key,value:d.value,valueSpec:d.styleSpec.function,validateSpec:d.validateSpec,style:d.style,styleSpec:d.styleSpec,objectElementValidators:{stops:function(Oe){if(m==="identity")return[new oi(Oe.key,Oe.value,'identity function may not have a "stops" property')];let ce=[];const et=Oe.value;return ce=ce.concat(Ua({key:Oe.key,value:et,valueSpec:Oe.valueSpec,validateSpec:Oe.validateSpec,style:Oe.style,styleSpec:Oe.styleSpec,arrayElementValidator:ge})),Gr(et)==="array"&&et.length===0&&ce.push(new oi(Oe.key,et,"array must have at least one stop")),ce},default:function(Oe){return Oe.validateSpec({key:Oe.key,value:Oe.value,valueSpec:A,validateSpec:Oe.validateSpec,style:Oe.style,styleSpec:Oe.styleSpec})}}});return m==="identity"&&X&&de.push(new oi(d.key,d.value,'missing required property "property"')),m==="identity"||d.value.stops||de.push(new oi(d.key,d.value,'missing required property "stops"')),m==="exponential"&&d.valueSpec.expression&&!BA(d.valueSpec)&&de.push(new oi(d.key,d.value,"exponential functions not supported")),d.styleSpec.$version>=8&&(ee&&!cs(d.valueSpec)?de.push(new oi(d.key,d.value,"property functions not supported")):X&&!Rl(d.valueSpec)&&de.push(new oi(d.key,d.value,"zoom functions not supported"))),m!=="categorical"&&!ae||d.value.property!==void 0||de.push(new oi(d.key,d.value,'"property" property is required')),de;function ge(Oe){let ce=[];const et=Oe.value,ot=Oe.key;if(Gr(et)!=="array")return[new oi(ot,et,`array expected, ${Gr(et)} found`)];if(et.length!==2)return[new oi(ot,et,`array length 2 expected, length ${et.length} found`)];if(ae){if(Gr(et[0])!=="object")return[new oi(ot,et,`object expected, ${Gr(et[0])} found`)];if(et[0].zoom===void 0)return[new oi(ot,et,"object stop key must have zoom")];if(et[0].value===void 0)return[new oi(ot,et,"object stop key must have value")];if(N&&N>Pn(et[0].zoom))return[new oi(ot,et[0].zoom,"stop zoom values must appear in ascending order")];Pn(et[0].zoom)!==N&&(N=Pn(et[0].zoom),D=void 0,U={}),ce=ce.concat(Rn({key:`${ot}[0]`,value:et[0],valueSpec:{zoom:{}},validateSpec:Oe.validateSpec,style:Oe.style,styleSpec:Oe.styleSpec,objectElementValidators:{zoom:rl,value:Ee}}))}else ce=ce.concat(Ee({key:`${ot}[0]`,value:et[0],valueSpec:{},validateSpec:Oe.validateSpec,style:Oe.style,styleSpec:Oe.styleSpec},et));return pA(va(et[1]))?ce.concat([new oi(`${ot}[1]`,et[1],"expressions are not allowed in function stops.")]):ce.concat(Oe.validateSpec({key:`${ot}[1]`,value:et[1],valueSpec:A,validateSpec:Oe.validateSpec,style:Oe.style,styleSpec:Oe.styleSpec}))}function Ee(Oe,ce){const et=Gr(Oe.value),ot=Pn(Oe.value),pt=Oe.value!==null?Oe.value:ce;if(w){if(et!==w)return[new oi(Oe.key,pt,`${et} stop domain type must match previous stop domain type ${w}`)]}else w=et;if(et!=="number"&&et!=="string"&&et!=="boolean")return[new oi(Oe.key,pt,"stop domain value must be a number, string, or boolean")];if(et!=="number"&&m!=="categorical"){let Ct=`number expected, ${et} found`;return cs(A)&&m===void 0&&(Ct+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new oi(Oe.key,pt,Ct)]}return m!=="categorical"||et!=="number"||isFinite(ot)&&Math.floor(ot)===ot?m!=="categorical"&&et==="number"&&D!==void 0&&ot<D?[new oi(Oe.key,pt,"stop domain values must appear in ascending order")]:(D=ot,m==="categorical"&&ot in U?[new oi(Oe.key,pt,"stop domain values must be unique")]:(U[ot]=!0,[])):[new oi(Oe.key,pt,`integer expected, found ${ot}`)]}}function fo(d){const A=(d.expressionContext==="property"?Ec:zo)(va(d.value),d.valueSpec);if(A.result==="error")return A.value.map(w=>new oi(`${d.key}${w.key}`,d.value,w.message));const m=A.value.expression||A.value._styleExpression.expression;if(d.expressionContext==="property"&&d.propertyKey==="text-font"&&!m.outputDefined())return[new oi(d.key,d.value,`Invalid data expression for "${d.propertyKey}". Output values must be contained as literals within the expression.`)];if(d.expressionContext==="property"&&d.propertyType==="layout"&&!Po(m))return[new oi(d.key,d.value,'"feature-state" data expressions are not supported with layout properties.')];if(d.expressionContext==="filter"&&!Po(m))return[new oi(d.key,d.value,'"feature-state" data expressions are not supported with filters.')];if(d.expressionContext&&d.expressionContext.indexOf("cluster")===0){if(!Kl(m,["zoom","feature-state"]))return[new oi(d.key,d.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(d.expressionContext==="cluster-initial"&&!Yl(m))return[new oi(d.key,d.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ba(d){const A=d.key,m=d.value,w=d.valueSpec,D=[];return Array.isArray(w.values)?w.values.indexOf(Pn(m))===-1&&D.push(new oi(A,m,`expected one of [${w.values.join(", ")}], ${JSON.stringify(m)} found`)):Object.keys(w.values).indexOf(Pn(m))===-1&&D.push(new oi(A,m,`expected one of [${Object.keys(w.values).join(", ")}], ${JSON.stringify(m)} found`)),D}function Fl(d){return Na(va(d.value))?fo(gn({},d,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Mt(d)}function Mt(d){const A=d.value,m=d.key;if(Gr(A)!=="array")return[new oi(m,A,`array expected, ${Gr(A)} found`)];const w=d.styleSpec;let D,N=[];if(A.length<1)return[new oi(m,A,"filter array must have at least 1 element")];switch(N=N.concat(ba({key:`${m}[0]`,value:A[0],valueSpec:w.filter_operator,style:d.style,styleSpec:d.styleSpec})),Pn(A[0])){case"<":case"<=":case">":case">=":A.length>=2&&Pn(A[1])==="$type"&&N.push(new oi(m,A,`"$type" cannot be use with operator "${A[0]}"`));case"==":case"!=":A.length!==3&&N.push(new oi(m,A,`filter array for operator "${A[0]}" must have 3 elements`));case"in":case"!in":A.length>=2&&(D=Gr(A[1]),D!=="string"&&N.push(new oi(`${m}[1]`,A[1],`string expected, ${D} found`)));for(let U=2;U<A.length;U++)D=Gr(A[U]),Pn(A[1])==="$type"?N=N.concat(ba({key:`${m}[${U}]`,value:A[U],valueSpec:w.geometry_type,style:d.style,styleSpec:d.styleSpec})):D!=="string"&&D!=="number"&&D!=="boolean"&&N.push(new oi(`${m}[${U}]`,A[U],`string, number, or boolean expected, ${D} found`));break;case"any":case"all":case"none":for(let U=1;U<A.length;U++)N=N.concat(Mt({key:`${m}[${U}]`,value:A[U],style:d.style,styleSpec:d.styleSpec}));break;case"has":case"!has":D=Gr(A[1]),A.length!==2?N.push(new oi(m,A,`filter array for "${A[0]}" operator must have 2 elements`)):D!=="string"&&N.push(new oi(`${m}[1]`,A[1],`string expected, ${D} found`));break;case"within":D=Gr(A[1]),A.length!==2?N.push(new oi(m,A,`filter array for "${A[0]}" operator must have 2 elements`)):D!=="object"&&N.push(new oi(`${m}[1]`,A[1],`object expected, ${D} found`))}return N}function ec(d,A){const m=d.key,w=d.validateSpec,D=d.style,N=d.styleSpec,U=d.value,X=d.objectKey,ee=N[`${A}_${d.layerType}`];if(!ee)return[];const ae=X.match(/^(.*)-transition$/);if(A==="paint"&&ae&&ee[ae[1]]&&ee[ae[1]].transition)return w({key:m,value:U,valueSpec:N.transition,style:D,styleSpec:N});const de=d.valueSpec||ee[X];if(!de)return[new oi(m,U,`unknown property "${X}"`)];let ge;if(Gr(U)==="string"&&cs(de)&&!de.tokens&&(ge=/^{([^}]+)}$/.exec(U)))return[new oi(m,U,`"${X}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(ge[1])} }\`.`)];const Ee=[];return d.layerType==="symbol"&&(X==="text-field"&&D&&!D.glyphs&&Ee.push(new oi(m,U,'use of "text-field" requires a style "glyphs" property')),X==="text-font"&&Yn(va(U))&&Pn(U.type)==="identity"&&Ee.push(new oi(m,U,'"text-font" does not support identity functions'))),Ee.concat(w({key:d.key,value:U,valueSpec:de,style:D,styleSpec:N,expressionContext:"property",propertyType:A,propertyKey:X}))}function nl(d){return ec(d,"paint")}function sl(d){return ec(d,"layout")}function Mc(d){let A=[];const m=d.value,w=d.key,D=d.style,N=d.styleSpec;m.type||m.ref||A.push(new oi(w,m,'either "type" or "ref" is required'));let U=Pn(m.type);const X=Pn(m.ref);if(m.id){const ee=Pn(m.id);for(let ae=0;ae<d.arrayIndex;ae++){const de=D.layers[ae];Pn(de.id)===ee&&A.push(new oi(w,m.id,`duplicate layer id "${m.id}", previously used at line ${de.id.__line__}`))}}if("ref"in m){let ee;["type","source","source-layer","filter","layout"].forEach(ae=>{ae in m&&A.push(new oi(w,m[ae],`"${ae}" is prohibited for ref layers`))}),D.layers.forEach(ae=>{Pn(ae.id)===X&&(ee=ae)}),ee?ee.ref?A.push(new oi(w,m.ref,"ref cannot reference another ref layer")):U=Pn(ee.type):A.push(new oi(w,m.ref,`ref layer "${X}" not found`))}else if(U!=="background")if(m.source){const ee=D.sources&&D.sources[m.source],ae=ee&&Pn(ee.type);ee?ae==="vector"&&U==="raster"?A.push(new oi(w,m.source,`layer "${m.id}" requires a raster source`)):ae!=="raster-dem"&&U==="hillshade"?A.push(new oi(w,m.source,`layer "${m.id}" requires a raster-dem source`)):ae==="raster"&&U!=="raster"?A.push(new oi(w,m.source,`layer "${m.id}" requires a vector source`)):ae!=="vector"||m["source-layer"]?ae==="raster-dem"&&U!=="hillshade"?A.push(new oi(w,m.source,"raster-dem source can only be used with layer type 'hillshade'.")):U!=="line"||!m.paint||!m.paint["line-gradient"]||ae==="geojson"&&ee.lineMetrics||A.push(new oi(w,m,`layer "${m.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):A.push(new oi(w,m,`layer "${m.id}" must specify a "source-layer"`)):A.push(new oi(w,m.source,`source "${m.source}" not found`))}else A.push(new oi(w,m,'missing required property "source"'));return A=A.concat(Rn({key:w,value:m,valueSpec:N.layer,style:d.style,styleSpec:d.styleSpec,validateSpec:d.validateSpec,objectElementValidators:{"*":()=>[],type:()=>d.validateSpec({key:`${w}.type`,value:m.type,valueSpec:N.layer.type,style:d.style,styleSpec:d.styleSpec,validateSpec:d.validateSpec,object:m,objectKey:"type"}),filter:Fl,layout:ee=>Rn({layer:m,key:ee.key,value:ee.value,style:ee.style,styleSpec:ee.styleSpec,validateSpec:ee.validateSpec,objectElementValidators:{"*":ae=>sl(gn({layerType:U},ae))}}),paint:ee=>Rn({layer:m,key:ee.key,value:ee.value,style:ee.style,styleSpec:ee.styleSpec,validateSpec:ee.validateSpec,objectElementValidators:{"*":ae=>nl(gn({layerType:U},ae))}})}})),A}function po(d){const A=d.value,m=d.key,w=Gr(A);return w!=="string"?[new oi(m,A,`string expected, ${w} found`)]:[]}const sa={promoteId:function({key:d,value:A}){if(Gr(A)==="string")return po({key:d,value:A});{const m=[];for(const w in A)m.push(...po({key:`${d}.${w}`,value:A[w]}));return m}}};function Bo(d){const A=d.value,m=d.key,w=d.styleSpec,D=d.style,N=d.validateSpec;if(!A.type)return[new oi(m,A,'"type" is required')];const U=Pn(A.type);let X;switch(U){case"vector":case"raster":return X=Rn({key:m,value:A,valueSpec:w[`source_${U.replace("-","_")}`],style:d.style,styleSpec:w,objectElementValidators:sa,validateSpec:N}),X;case"raster-dem":return X=function(ee){var ae;const de=(ae=ee.sourceName)!==null&&ae!==void 0?ae:"",ge=ee.value,Ee=ee.styleSpec,Oe=Ee.source_raster_dem,ce=ee.style;let et=[];const ot=Gr(ge);if(ge===void 0)return et;if(ot!=="object")return et.push(new oi("source_raster_dem",ge,`object expected, ${ot} found`)),et;const pt=Pn(ge.encoding)==="custom",Ct=["redFactor","greenFactor","blueFactor","baseShift"],bt=ee.value.encoding?`"${ee.value.encoding}"`:"Default";for(const _e in ge)!pt&&Ct.includes(_e)?et.push(new oi(_e,ge[_e],`In "${de}": "${_e}" is only valid when "encoding" is set to "custom". ${bt} encoding found`)):Oe[_e]?et=et.concat(ee.validateSpec({key:_e,value:ge[_e],valueSpec:Oe[_e],validateSpec:ee.validateSpec,style:ce,styleSpec:Ee})):et.push(new oi(_e,ge[_e],`unknown property "${_e}"`));return et}({sourceName:m,value:A,style:d.style,styleSpec:w,validateSpec:N}),X;case"geojson":if(X=Rn({key:m,value:A,valueSpec:w.source_geojson,style:D,styleSpec:w,validateSpec:N,objectElementValidators:sa}),A.cluster)for(const ee in A.clusterProperties){const[ae,de]=A.clusterProperties[ee],ge=typeof ae=="string"?[ae,["accumulated"],["get",ee]]:ae;X.push(...fo({key:`${m}.${ee}.map`,value:de,validateSpec:N,expressionContext:"cluster-map"})),X.push(...fo({key:`${m}.${ee}.reduce`,value:ge,validateSpec:N,expressionContext:"cluster-reduce"}))}return X;case"video":return Rn({key:m,value:A,valueSpec:w.source_video,style:D,validateSpec:N,styleSpec:w});case"image":return Rn({key:m,value:A,valueSpec:w.source_image,style:D,validateSpec:N,styleSpec:w});case"canvas":return[new oi(m,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ba({key:`${m}.type`,value:A.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:D,validateSpec:N,styleSpec:w})}}function ja(d){const A=d.value,m=d.styleSpec,w=m.light,D=d.style;let N=[];const U=Gr(A);if(A===void 0)return N;if(U!=="object")return N=N.concat([new oi("light",A,`object expected, ${U} found`)]),N;for(const X in A){const ee=X.match(/^(.*)-transition$/);N=N.concat(ee&&w[ee[1]]&&w[ee[1]].transition?d.validateSpec({key:X,value:A[X],valueSpec:m.transition,validateSpec:d.validateSpec,style:D,styleSpec:m}):w[X]?d.validateSpec({key:X,value:A[X],valueSpec:w[X],validateSpec:d.validateSpec,style:D,styleSpec:m}):[new oi(X,A[X],`unknown property "${X}"`)])}return N}function RA(d){const A=d.value,m=d.styleSpec,w=m.terrain,D=d.style;let N=[];const U=Gr(A);if(A===void 0)return N;if(U!=="object")return N=N.concat([new oi("terrain",A,`object expected, ${U} found`)]),N;for(const X in A)N=N.concat(w[X]?d.validateSpec({key:X,value:A[X],valueSpec:w[X],validateSpec:d.validateSpec,style:D,styleSpec:m}):[new oi(X,A[X],`unknown property "${X}"`)]);return N}function ol(d){let A=[];const m=d.value,w=d.key;if(Array.isArray(m)){const D=[],N=[];for(const U in m)m[U].id&&D.includes(m[U].id)&&A.push(new oi(w,m,`all the sprites' ids must be unique, but ${m[U].id} is duplicated`)),D.push(m[U].id),m[U].url&&N.includes(m[U].url)&&A.push(new oi(w,m,`all the sprites' URLs must be unique, but ${m[U].url} is duplicated`)),N.push(m[U].url),A=A.concat(Rn({key:`${w}[${U}]`,value:m[U],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:d.validateSpec}));return A}return po({key:w,value:m})}const tc={"*":()=>[],array:Ua,boolean:function(d){const A=d.value,m=d.key,w=Gr(A);return w!=="boolean"?[new oi(m,A,`boolean expected, ${w} found`)]:[]},number:rl,color:function(d){const A=d.key,m=d.value,w=Gr(m);return w!=="string"?[new oi(A,m,`color expected, ${w} found`)]:nn.parse(String(m))?[]:[new oi(A,m,`color expected, "${m}" found`)]},constants:LA,enum:ba,filter:Fl,function:_l,layer:Mc,object:Rn,source:Bo,light:ja,terrain:RA,string:po,formatted:function(d){return po(d).length===0?[]:fo(d)},resolvedImage:function(d){return po(d).length===0?[]:fo(d)},padding:function(d){const A=d.key,m=d.value;if(Gr(m)==="array"){if(m.length<1||m.length>4)return[new oi(A,m,`padding requires 1 to 4 values; ${m.length} values found`)];const w={type:"number"};let D=[];for(let N=0;N<m.length;N++)D=D.concat(d.validateSpec({key:`${A}[${N}]`,value:m[N],validateSpec:d.validateSpec,valueSpec:w}));return D}return rl({key:A,value:m,valueSpec:{}})},variableAnchorOffsetCollection:function(d){const A=d.key,m=d.value,w=Gr(m),D=d.styleSpec;if(w!=="array"||m.length<1||m.length%2!=0)return[new oi(A,m,"variableAnchorOffsetCollection requires a non-empty array of even length")];let N=[];for(let U=0;U<m.length;U+=2)N=N.concat(ba({key:`${A}[${U}]`,value:m[U],valueSpec:D.layout_symbol["text-anchor"]})),N=N.concat(Ua({key:`${A}[${U+1}]`,value:m[U+1],valueSpec:{length:2,value:"number"},validateSpec:d.validateSpec,style:d.style,styleSpec:D}));return N},sprite:ol};function gl(d){const A=d.value,m=d.valueSpec,w=d.styleSpec;return d.validateSpec=gl,m.expression&&Yn(Pn(A))?_l(d):m.expression&&pA(va(A))?fo(d):m.type&&tc[m.type]?tc[m.type](d):Rn(gn({},d,{valueSpec:m.type?w[m.type]:m}))}function FA(d){const A=d.value,m=d.key,w=po(d);return w.length||(A.indexOf("{fontstack}")===-1&&w.push(new oi(m,A,'"glyphs" url must include a "{fontstack}" token')),A.indexOf("{range}")===-1&&w.push(new oi(m,A,'"glyphs" url must include a "{range}" token'))),w}function Lo(d,A=Pe){let m=[];return m=m.concat(gl({key:"",value:d,valueSpec:A.$root,styleSpec:A,style:d,validateSpec:gl,objectElementValidators:{glyphs:FA,"*":()=>[]}})),d.constants&&(m=m.concat(LA({key:"constants",value:d.constants,style:d,styleSpec:A,validateSpec:gl}))),wa(m)}function Xo(d){return function(A){return d({...A,validateSpec:gl})}}function wa(d){return[].concat(d).sort((A,m)=>A.line-m.line)}function al(d){return function(...A){return wa(d.apply(this,A))}}Lo.source=al(Xo(Bo)),Lo.sprite=al(Xo(ol)),Lo.glyphs=al(Xo(FA)),Lo.light=al(Xo(ja)),Lo.terrain=al(Xo(RA)),Lo.layer=al(Xo(Mc)),Lo.filter=al(Xo(Fl)),Lo.paintProperty=al(Xo(nl)),Lo.layoutProperty=al(Xo(sl));const yl=Lo,vu=yl.light,ic=yl.paintProperty,Jc=yl.layoutProperty;function tA(d,A){let m=!1;if(A&&A.length)for(const w of A)d.fire(new Ue(new Error(w.message))),m=!0;return m}class ll{constructor(A,m,w){const D=this.cells=[];if(A instanceof ArrayBuffer){this.arrayBuffer=A;const U=new Int32Array(this.arrayBuffer);A=U[0],this.d=(m=U[1])+2*(w=U[2]);for(let ee=0;ee<this.d*this.d;ee++){const ae=U[3+ee],de=U[3+ee+1];D.push(ae===de?null:U.subarray(ae,de))}const X=U[3+D.length+1];this.keys=U.subarray(U[3+D.length],X),this.bboxes=U.subarray(X),this.insert=this._insertReadonly}else{this.d=m+2*w;for(let U=0;U<this.d*this.d;U++)D.push([]);this.keys=[],this.bboxes=[]}this.n=m,this.extent=A,this.padding=w,this.scale=m/A,this.uid=0;const N=w/m*A;this.min=-N,this.max=A+N}insert(A,m,w,D,N){this._forEachCell(m,w,D,N,this._insertCell,this.uid++,void 0,void 0),this.keys.push(A),this.bboxes.push(m),this.bboxes.push(w),this.bboxes.push(D),this.bboxes.push(N)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(A,m,w,D,N,U){this.cells[N].push(U)}query(A,m,w,D,N){const U=this.min,X=this.max;if(A<=U&&m<=U&&X<=w&&X<=D&&!N)return Array.prototype.slice.call(this.keys);{const ee=[];return this._forEachCell(A,m,w,D,this._queryCell,ee,{},N),ee}}_queryCell(A,m,w,D,N,U,X,ee){const ae=this.cells[N];if(ae!==null){const de=this.keys,ge=this.bboxes;for(let Ee=0;Ee<ae.length;Ee++){const Oe=ae[Ee];if(X[Oe]===void 0){const ce=4*Oe;(ee?ee(ge[ce+0],ge[ce+1],ge[ce+2],ge[ce+3]):A<=ge[ce+2]&&m<=ge[ce+3]&&w>=ge[ce+0]&&D>=ge[ce+1])?(X[Oe]=!0,U.push(de[Oe])):X[Oe]=!1}}}}_forEachCell(A,m,w,D,N,U,X,ee){const ae=this._convertToCellCoord(A),de=this._convertToCellCoord(m),ge=this._convertToCellCoord(w),Ee=this._convertToCellCoord(D);for(let Oe=ae;Oe<=ge;Oe++)for(let ce=de;ce<=Ee;ce++){const et=this.d*ce+Oe;if((!ee||ee(this._convertFromCellCoord(Oe),this._convertFromCellCoord(ce),this._convertFromCellCoord(Oe+1),this._convertFromCellCoord(ce+1)))&&N.call(this,A,m,w,D,et,U,X,ee))return}}_convertFromCellCoord(A){return(A-this.padding)/this.scale}_convertToCellCoord(A){return Math.max(0,Math.min(this.d-1,Math.floor(A*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const A=this.cells,m=3+this.cells.length+1+1;let w=0;for(let U=0;U<this.cells.length;U++)w+=this.cells[U].length;const D=new Int32Array(m+w+this.keys.length+this.bboxes.length);D[0]=this.extent,D[1]=this.n,D[2]=this.padding;let N=m;for(let U=0;U<A.length;U++){const X=A[U];D[3+U]=N,D.set(X,N),N+=X.length}return D[3+A.length]=N,D.set(this.keys,N),N+=this.keys.length,D[3+A.length+1]=N,D.set(this.bboxes,N),N+=this.bboxes.length,D.buffer}static serialize(A,m){const w=A.toArrayBuffer();return m&&m.push(w),{buffer:w}}static deserialize(A){return new ll(A.buffer)}}const Ga={};function Vi(d,A,m={}){if(Ga[d])throw new Error(`${d} is already registered.`);Object.defineProperty(A,"_classRegistryKey",{value:d,writeable:!1}),Ga[d]={klass:A,omit:m.omit||[],shallow:m.shallow||[]}}Vi("Object",Object),Vi("TransferableGridIndex",ll),Vi("Color",nn),Vi("Error",Error),Vi("AJAXError",dr),Vi("ResolvedImage",Hs),Vi("StylePropertyFunction",mA),Vi("StyleExpression",tl,{omit:["_evaluator"]}),Vi("ZoomDependentExpression",Ln),Vi("ZoomConstantExpression",pl),Vi("CompoundExpression",xn,{omit:["_evaluate"]});for(const d in so)so[d]._classRegistryKey||Vi(`Expression_${d}`,so[d]);function Ro(d){return d&&typeof ArrayBuffer<"u"&&(d instanceof ArrayBuffer||d.constructor&&d.constructor.name==="ArrayBuffer")}function Za(d,A){if(d==null||typeof d=="boolean"||typeof d=="number"||typeof d=="string"||d instanceof Boolean||d instanceof Number||d instanceof String||d instanceof Date||d instanceof RegExp||d instanceof Blob)return d;if(Ro(d)||Io(d))return A&&A.push(d),d;if(ArrayBuffer.isView(d)){const m=d;return A&&A.push(m.buffer),m}if(d instanceof ImageData)return A&&A.push(d.data.buffer),d;if(Array.isArray(d)){const m=[];for(const w of d)m.push(Za(w,A));return m}if(typeof d=="object"){const m=d.constructor,w=m._classRegistryKey;if(!w)throw new Error("can't serialize object of unregistered class");if(!Ga[w])throw new Error(`${w} is not registered.`);const D=m.serialize?m.serialize(d,A):{};if(m.serialize){if(A&&D===A[A.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const N in d){if(!d.hasOwnProperty(N)||Ga[w].omit.indexOf(N)>=0)continue;const U=d[N];D[N]=Ga[w].shallow.indexOf(N)>=0?U:Za(U,A)}d instanceof Error&&(D.message=d.message)}if(D.$name)throw new Error("$name property is reserved for worker serialization logic.");return w!=="Object"&&(D.$name=w),D}throw new Error("can't serialize object of type "+typeof d)}function Al(d){if(d==null||typeof d=="boolean"||typeof d=="number"||typeof d=="string"||d instanceof Boolean||d instanceof Number||d instanceof String||d instanceof Date||d instanceof RegExp||d instanceof Blob||Ro(d)||Io(d)||ArrayBuffer.isView(d)||d instanceof ImageData)return d;if(Array.isArray(d))return d.map(Al);if(typeof d=="object"){const A=d.$name||"Object";if(!Ga[A])throw new Error(`can't deserialize unregistered class ${A}`);const{klass:m}=Ga[A];if(!m)throw new Error(`can't deserialize unregistered class ${A}`);if(m.deserialize)return m.deserialize(d);const w=Object.create(m.prototype);for(const D of Object.keys(d)){if(D==="$name")continue;const N=d[D];w[D]=Ga[A].shallow.indexOf(D)>=0?N:Al(N)}return w}throw new Error("can't deserialize object of type "+typeof d)}class rc{constructor(){this.first=!0}update(A,m){const w=Math.floor(A);return this.first?(this.first=!1,this.lastIntegerZoom=w,this.lastIntegerZoomTime=0,this.lastZoom=A,this.lastFloorZoom=w,!0):(this.lastFloorZoom>w?(this.lastIntegerZoom=w+1,this.lastIntegerZoomTime=m):this.lastFloorZoom<w&&(this.lastIntegerZoom=w,this.lastIntegerZoomTime=m),A!==this.lastZoom&&(this.lastZoom=A,this.lastFloorZoom=w,!0))}}const Si={"Latin-1 Supplement":d=>d>=128&&d<=255,Arabic:d=>d>=1536&&d<=1791,"Arabic Supplement":d=>d>=1872&&d<=1919,"Arabic Extended-A":d=>d>=2208&&d<=2303,"Hangul Jamo":d=>d>=4352&&d<=4607,"Unified Canadian Aboriginal Syllabics":d=>d>=5120&&d<=5759,Khmer:d=>d>=6016&&d<=6143,"Unified Canadian Aboriginal Syllabics Extended":d=>d>=6320&&d<=6399,"General Punctuation":d=>d>=8192&&d<=8303,"Letterlike Symbols":d=>d>=8448&&d<=8527,"Number Forms":d=>d>=8528&&d<=8591,"Miscellaneous Technical":d=>d>=8960&&d<=9215,"Control Pictures":d=>d>=9216&&d<=9279,"Optical Character Recognition":d=>d>=9280&&d<=9311,"Enclosed Alphanumerics":d=>d>=9312&&d<=9471,"Geometric Shapes":d=>d>=9632&&d<=9727,"Miscellaneous Symbols":d=>d>=9728&&d<=9983,"Miscellaneous Symbols and Arrows":d=>d>=11008&&d<=11263,"CJK Radicals Supplement":d=>d>=11904&&d<=12031,"Kangxi Radicals":d=>d>=12032&&d<=12255,"Ideographic Description Characters":d=>d>=12272&&d<=12287,"CJK Symbols and Punctuation":d=>d>=12288&&d<=12351,Hiragana:d=>d>=12352&&d<=12447,Katakana:d=>d>=12448&&d<=12543,Bopomofo:d=>d>=12544&&d<=12591,"Hangul Compatibility Jamo":d=>d>=12592&&d<=12687,Kanbun:d=>d>=12688&&d<=12703,"Bopomofo Extended":d=>d>=12704&&d<=12735,"CJK Strokes":d=>d>=12736&&d<=12783,"Katakana Phonetic Extensions":d=>d>=12784&&d<=12799,"Enclosed CJK Letters and Months":d=>d>=12800&&d<=13055,"CJK Compatibility":d=>d>=13056&&d<=13311,"CJK Unified Ideographs Extension A":d=>d>=13312&&d<=19903,"Yijing Hexagram Symbols":d=>d>=19904&&d<=19967,"CJK Unified Ideographs":d=>d>=19968&&d<=40959,"Yi Syllables":d=>d>=40960&&d<=42127,"Yi Radicals":d=>d>=42128&&d<=42191,"Hangul Jamo Extended-A":d=>d>=43360&&d<=43391,"Hangul Syllables":d=>d>=44032&&d<=55215,"Hangul Jamo Extended-B":d=>d>=55216&&d<=55295,"Private Use Area":d=>d>=57344&&d<=63743,"CJK Compatibility Ideographs":d=>d>=63744&&d<=64255,"Arabic Presentation Forms-A":d=>d>=64336&&d<=65023,"Vertical Forms":d=>d>=65040&&d<=65055,"CJK Compatibility Forms":d=>d>=65072&&d<=65103,"Small Form Variants":d=>d>=65104&&d<=65135,"Arabic Presentation Forms-B":d=>d>=65136&&d<=65279,"Halfwidth and Fullwidth Forms":d=>d>=65280&&d<=65519};function iA(d){for(const A of d)if(_A(A.charCodeAt(0)))return!0;return!1}function OA(d){for(const A of d)if(!oa(A.charCodeAt(0)))return!1;return!0}function oa(d){return!(Si.Arabic(d)||Si["Arabic Supplement"](d)||Si["Arabic Extended-A"](d)||Si["Arabic Presentation Forms-A"](d)||Si["Arabic Presentation Forms-B"](d))}function _A(d){return!(d!==746&&d!==747&&(d<4352||!(Si["Bopomofo Extended"](d)||Si.Bopomofo(d)||Si["CJK Compatibility Forms"](d)&&!(d>=65097&&d<=65103)||Si["CJK Compatibility Ideographs"](d)||Si["CJK Compatibility"](d)||Si["CJK Radicals Supplement"](d)||Si["CJK Strokes"](d)||!(!Si["CJK Symbols and Punctuation"](d)||d>=12296&&d<=12305||d>=12308&&d<=12319||d===12336)||Si["CJK Unified Ideographs Extension A"](d)||Si["CJK Unified Ideographs"](d)||Si["Enclosed CJK Letters and Months"](d)||Si["Hangul Compatibility Jamo"](d)||Si["Hangul Jamo Extended-A"](d)||Si["Hangul Jamo Extended-B"](d)||Si["Hangul Jamo"](d)||Si["Hangul Syllables"](d)||Si.Hiragana(d)||Si["Ideographic Description Characters"](d)||Si.Kanbun(d)||Si["Kangxi Radicals"](d)||Si["Katakana Phonetic Extensions"](d)||Si.Katakana(d)&&d!==12540||!(!Si["Halfwidth and Fullwidth Forms"](d)||d===65288||d===65289||d===65293||d>=65306&&d<=65310||d===65339||d===65341||d===65343||d>=65371&&d<=65503||d===65507||d>=65512&&d<=65519)||!(!Si["Small Form Variants"](d)||d>=65112&&d<=65118||d>=65123&&d<=65126)||Si["Unified Canadian Aboriginal Syllabics"](d)||Si["Unified Canadian Aboriginal Syllabics Extended"](d)||Si["Vertical Forms"](d)||Si["Yijing Hexagram Symbols"](d)||Si["Yi Syllables"](d)||Si["Yi Radicals"](d))))}function nc(d){return!(_A(d)||function(A){return!!(Si["Latin-1 Supplement"](A)&&(A===167||A===169||A===174||A===177||A===188||A===189||A===190||A===215||A===247)||Si["General Punctuation"](A)&&(A===8214||A===8224||A===8225||A===8240||A===8241||A===8251||A===8252||A===8258||A===8263||A===8264||A===8265||A===8273)||Si["Letterlike Symbols"](A)||Si["Number Forms"](A)||Si["Miscellaneous Technical"](A)&&(A>=8960&&A<=8967||A>=8972&&A<=8991||A>=8996&&A<=9e3||A===9003||A>=9085&&A<=9114||A>=9150&&A<=9165||A===9167||A>=9169&&A<=9179||A>=9186&&A<=9215)||Si["Control Pictures"](A)&&A!==9251||Si["Optical Character Recognition"](A)||Si["Enclosed Alphanumerics"](A)||Si["Geometric Shapes"](A)||Si["Miscellaneous Symbols"](A)&&!(A>=9754&&A<=9759)||Si["Miscellaneous Symbols and Arrows"](A)&&(A>=11026&&A<=11055||A>=11088&&A<=11097||A>=11192&&A<=11243)||Si["CJK Symbols and Punctuation"](A)||Si.Katakana(A)||Si["Private Use Area"](A)||Si["CJK Compatibility Forms"](A)||Si["Small Form Variants"](A)||Si["Halfwidth and Fullwidth Forms"](A)||A===8734||A===8756||A===8757||A>=9984&&A<=10087||A>=10102&&A<=10131||A===65532||A===65533)}(d))}function VA(d){return d>=1424&&d<=2303||Si["Arabic Presentation Forms-A"](d)||Si["Arabic Presentation Forms-B"](d)}function sc(d,A){return!(!A&&VA(d)||d>=2304&&d<=3583||d>=3840&&d<=4255||Si.Khmer(d))}function Ms(d){for(const A of d)if(VA(A.charCodeAt(0)))return!0;return!1}const gA="deferred",NA="loading",UA="loaded";let Ji=null,To="unavailable",Ta=null;const rA=function(d){d&&typeof d=="string"&&d.indexOf("NetworkError")>-1&&(To="error"),Ji&&Ji(d)};function oc(){nA.fire(new Yt("pluginStateChange",{pluginStatus:To,pluginURL:Ta}))}const nA=new $e,xl=function(){return To},Ss=function(){if(To!==gA||!Ta)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");To=NA,oc(),Ta&&Cl({url:Ta},d=>{d?rA(d):(To=UA,oc())})},aa={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>To===UA||aa.applyArabicShaping!=null,isLoading:()=>To===NA,setState(d){if(!es())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");To=d.pluginStatus,Ta=d.pluginURL},isParsed(){if(!es())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return aa.applyArabicShaping!=null&&aa.processBidirectionalText!=null&&aa.processStyledBidirectionalText!=null},getPluginURL(){if(!es())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return Ta}};class Gn{constructor(A,m){this.zoom=A,m?(this.now=m.now,this.fadeDuration=m.fadeDuration,this.zoomHistory=m.zoomHistory,this.transition=m.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new rc,this.transition={})}isSupportedScript(A){return function(m,w){for(const D of m)if(!sc(D.charCodeAt(0),w))return!1;return!0}(A,aa.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const A=this.zoom,m=A-Math.floor(A),w=this.crossFadingFactor();return A>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:m+(1-m)*w}:{fromScale:.5,toScale:1,t:1-(1-w)*m}}}class mo{constructor(A,m){this.property=A,this.value=m,this.expression=function(w,D){if(Yn(w))return new mA(w,D);if(pA(w)){const N=Ec(w,D);if(N.result==="error")throw new Error(N.value.map(U=>`${U.key}: ${U.message}`).join(", "));return N.value}{let N=w;return D.type==="color"&&typeof w=="string"?N=nn.parse(w):D.type!=="padding"||typeof w!="number"&&!Array.isArray(w)?D.type==="variableAnchorOffsetCollection"&&Array.isArray(w)&&(N=Ar.parse(w)):N=Di.parse(w),{kind:"constant",evaluate:()=>N}}}(m===void 0?A.specification.default:m,A.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(A,m,w){return this.property.possiblyEvaluate(this,A,m,w)}}class mr{constructor(A){this.property=A,this.value=new mo(A,void 0)}transitioned(A,m){return new ac(this.property,this.value,m,rn({},A.transition,this.transition),A.now)}untransitioned(){return new ac(this.property,this.value,null,{},0)}}class Yo{constructor(A){this._properties=A,this._values=Object.create(A.defaultTransitionablePropertyValues)}getValue(A){return Sn(this._values[A].value.value)}setValue(A,m){Object.prototype.hasOwnProperty.call(this._values,A)||(this._values[A]=new mr(this._values[A].property)),this._values[A].value=new mo(this._values[A].property,m===null?void 0:Sn(m))}getTransition(A){return Sn(this._values[A].transition)}setTransition(A,m){Object.prototype.hasOwnProperty.call(this._values,A)||(this._values[A]=new mr(this._values[A].property)),this._values[A].transition=Sn(m)||void 0}serialize(){const A={};for(const m of Object.keys(this._values)){const w=this.getValue(m);w!==void 0&&(A[m]=w);const D=this.getTransition(m);D!==void 0&&(A[`${m}-transition`]=D)}return A}transitioned(A,m){const w=new Ol(this._properties);for(const D of Object.keys(this._values))w._values[D]=this._values[D].transitioned(A,m._values[D]);return w}untransitioned(){const A=new Ol(this._properties);for(const m of Object.keys(this._values))A._values[m]=this._values[m].untransitioned();return A}}class ac{constructor(A,m,w,D,N){this.property=A,this.value=m,this.begin=N+D.delay||0,this.end=this.begin+D.duration||0,A.specification.transition&&(D.delay||D.duration)&&(this.prior=w)}possiblyEvaluate(A,m,w){const D=A.now||0,N=this.value.possiblyEvaluate(A,m,w),U=this.prior;if(U){if(D>this.end)return this.prior=null,N;if(this.value.isDataDriven())return this.prior=null,N;if(D<this.begin)return U.possiblyEvaluate(A,m,w);{const X=(D-this.begin)/(this.end-this.begin);return this.property.interpolate(U.possiblyEvaluate(A,m,w),N,function(ee){if(ee<=0)return 0;if(ee>=1)return 1;const ae=ee*ee,de=ae*ee;return 4*(ee<.5?de:3*(ee-ae)+de-.75)}(X))}}return N}}class Ol{constructor(A){this._properties=A,this._values=Object.create(A.defaultTransitioningPropertyValues)}possiblyEvaluate(A,m,w){const D=new Ea(this._properties);for(const N of Object.keys(this._values))D._values[N]=this._values[N].possiblyEvaluate(A,m,w);return D}hasTransition(){for(const A of Object.keys(this._values))if(this._values[A].prior)return!0;return!1}}class lc{constructor(A){this._properties=A,this._values=Object.create(A.defaultPropertyValues)}hasValue(A){return this._values[A].value!==void 0}getValue(A){return Sn(this._values[A].value)}setValue(A,m){this._values[A]=new mo(this._values[A].property,m===null?void 0:Sn(m))}serialize(){const A={};for(const m of Object.keys(this._values)){const w=this.getValue(m);w!==void 0&&(A[m]=w)}return A}possiblyEvaluate(A,m,w){const D=new Ea(this._properties);for(const N of Object.keys(this._values))D._values[N]=this._values[N].possiblyEvaluate(A,m,w);return D}}class _o{constructor(A,m,w){this.property=A,this.value=m,this.parameters=w}isConstant(){return this.value.kind==="constant"}constantOr(A){return this.value.kind==="constant"?this.value.value:A}evaluate(A,m,w,D){return this.property.evaluate(this.value,this.parameters,A,m,w,D)}}class Ea{constructor(A){this._properties=A,this._values=Object.create(A.defaultPossiblyEvaluatedValues)}get(A){return this._values[A]}}class Vt{constructor(A){this.specification=A}possiblyEvaluate(A,m){if(A.isDataDriven())throw new Error("Value should not be data driven");return A.expression.evaluate(m)}interpolate(A,m,w){const D=ar[this.specification.type];return D?D(A,m,w):A}}class Jt{constructor(A,m){this.specification=A,this.overrides=m}possiblyEvaluate(A,m,w,D){return new _o(this,A.expression.kind==="constant"||A.expression.kind==="camera"?{kind:"constant",value:A.expression.evaluate(m,null,{},w,D)}:A.expression,m)}interpolate(A,m,w){if(A.value.kind!=="constant"||m.value.kind!=="constant")return A;if(A.value.value===void 0||m.value.value===void 0)return new _o(this,{kind:"constant",value:void 0},A.parameters);const D=ar[this.specification.type];if(D){const N=D(A.value.value,m.value.value,w);return new _o(this,{kind:"constant",value:N},A.parameters)}return A}evaluate(A,m,w,D,N,U){return A.kind==="constant"?A.value:A.evaluate(m,w,D,N,U)}}class sA extends Jt{possiblyEvaluate(A,m,w,D){if(A.value===void 0)return new _o(this,{kind:"constant",value:void 0},m);if(A.expression.kind==="constant"){const N=A.expression.evaluate(m,null,{},w,D),U=A.property.specification.type==="resolvedImage"&&typeof N!="string"?N.name:N,X=this._calculate(U,U,U,m);return new _o(this,{kind:"constant",value:X},m)}if(A.expression.kind==="camera"){const N=this._calculate(A.expression.evaluate({zoom:m.zoom-1}),A.expression.evaluate({zoom:m.zoom}),A.expression.evaluate({zoom:m.zoom+1}),m);return new _o(this,{kind:"constant",value:N},m)}return new _o(this,A.expression,m)}evaluate(A,m,w,D,N,U){if(A.kind==="source"){const X=A.evaluate(m,w,D,N,U);return this._calculate(X,X,X,m)}return A.kind==="composite"?this._calculate(A.evaluate({zoom:Math.floor(m.zoom)-1},w,D),A.evaluate({zoom:Math.floor(m.zoom)},w,D),A.evaluate({zoom:Math.floor(m.zoom)+1},w,D),m):A.value}_calculate(A,m,w,D){return D.zoom>D.zoomHistory.lastIntegerZoom?{from:A,to:m}:{from:w,to:m}}interpolate(A){return A}}class vl{constructor(A){this.specification=A}possiblyEvaluate(A,m,w,D){if(A.value!==void 0){if(A.expression.kind==="constant"){const N=A.expression.evaluate(m,null,{},w,D);return this._calculate(N,N,N,m)}return this._calculate(A.expression.evaluate(new Gn(Math.floor(m.zoom-1),m)),A.expression.evaluate(new Gn(Math.floor(m.zoom),m)),A.expression.evaluate(new Gn(Math.floor(m.zoom+1),m)),m)}}_calculate(A,m,w,D){return D.zoom>D.zoomHistory.lastIntegerZoom?{from:A,to:m}:{from:w,to:m}}interpolate(A){return A}}class Vl{constructor(A){this.specification=A}possiblyEvaluate(A,m,w,D){return!!A.expression.evaluate(m,null,{},w,D)}interpolate(){return!1}}class tn{constructor(A){this.properties=A,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const m in A){const w=A[m];w.specification.overridable&&this.overridableProperties.push(m);const D=this.defaultPropertyValues[m]=new mo(w,void 0),N=this.defaultTransitionablePropertyValues[m]=new mr(w);this.defaultTransitioningPropertyValues[m]=N.untransitioned(),this.defaultPossiblyEvaluatedValues[m]=D.possiblyEvaluate({})}}}Vi("DataDrivenProperty",Jt),Vi("DataConstantProperty",Vt),Vi("CrossFadedDataDrivenProperty",sA),Vi("CrossFadedProperty",vl),Vi("ColorRampProperty",Vl);const la="-transition";class Zn extends $e{constructor(A,m){if(super(),this.id=A.id,this.type=A.type,this._featureFilter={filter:()=>!0,needGeometry:!1},A.type!=="custom"&&(this.metadata=A.metadata,this.minzoom=A.minzoom,this.maxzoom=A.maxzoom,A.type!=="background"&&(this.source=A.source,this.sourceLayer=A["source-layer"],this.filter=A.filter),m.layout&&(this._unevaluatedLayout=new lc(m.layout)),m.paint)){this._transitionablePaint=new Yo(m.paint);for(const w in A.paint)this.setPaintProperty(w,A.paint[w],{validate:!1});for(const w in A.layout)this.setLayoutProperty(w,A.layout[w],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ea(m.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(A){return A==="visibility"?this.visibility:this._unevaluatedLayout.getValue(A)}setLayoutProperty(A,m,w={}){m!=null&&this._validate(Jc,`layers.${this.id}.layout.${A}`,A,m,w)||(A!=="visibility"?this._unevaluatedLayout.setValue(A,m):this.visibility=m)}getPaintProperty(A){return A.endsWith(la)?this._transitionablePaint.getTransition(A.slice(0,-11)):this._transitionablePaint.getValue(A)}setPaintProperty(A,m,w={}){if(m!=null&&this._validate(ic,`layers.${this.id}.paint.${A}`,A,m,w))return!1;if(A.endsWith(la))return this._transitionablePaint.setTransition(A.slice(0,-11),m||void 0),!1;{const D=this._transitionablePaint._values[A],N=D.property.specification["property-type"]==="cross-faded-data-driven",U=D.value.isDataDriven(),X=D.value;this._transitionablePaint.setValue(A,m),this._handleSpecialPaintPropertyUpdate(A);const ee=this._transitionablePaint._values[A].value;return ee.isDataDriven()||U||N||this._handleOverridablePaintPropertyUpdate(A,X,ee)}}_handleSpecialPaintPropertyUpdate(A){}_handleOverridablePaintPropertyUpdate(A,m,w){return!1}isHidden(A){return!!(this.minzoom&&A<this.minzoom)||!!(this.maxzoom&&A>=this.maxzoom)||this.visibility==="none"}updateTransitions(A){this._transitioningPaint=this._transitionablePaint.transitioned(A,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(A,m){A.getCrossfadeParameters&&(this._crossfadeParameters=A.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(A,void 0,m)),this.paint=this._transitioningPaint.possiblyEvaluate(A,void 0,m)}serialize(){const A={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(A.layout=A.layout||{},A.layout.visibility=this.visibility),tr(A,(m,w)=>!(m===void 0||w==="layout"&&!Object.keys(m).length||w==="paint"&&!Object.keys(m).length))}_validate(A,m,w,D,N={}){return(!N||N.validate!==!1)&&tA(this,A.call(yl,{key:m,layerType:this.type,objectKey:w,value:D,styleSpec:Pe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const A in this.paint._values){const m=this.paint.get(A);if(m instanceof _o&&cs(m.property.specification)&&(m.value.kind==="source"||m.value.kind==="composite")&&m.value.isStateDependent)return!0}return!1}}const x={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class T{constructor(A,m){this._structArray=A,this._pos1=m*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class M{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(A,m){return A._trim(),m&&(A.isTransferred=!0,m.push(A.arrayBuffer)),{length:A.length,arrayBuffer:A.arrayBuffer}}static deserialize(A){const m=Object.create(this.prototype);return m.arrayBuffer=A.arrayBuffer,m.length=A.length,m.capacity=A.arrayBuffer.byteLength/m.bytesPerElement,m._refreshViews(),m}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(A){this.reserve(A),this.length=A}reserve(A){if(A>this.capacity){this.capacity=Math.max(A,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const m=this.uint8;this._refreshViews(),m&&this.uint8.set(m)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function L(d,A=1){let m=0,w=0;return{members:d.map(D=>{const N=x[D.type].BYTES_PER_ELEMENT,U=m=j(m,Math.max(A,N)),X=D.components||1;return w=Math.max(w,N),m+=N*X,{name:D.name,type:D.type,components:X,offset:U}}),size:j(m,Math.max(w,A)),alignment:A}}function j(d,A){return Math.ceil(d/A)*A}class H extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(A,m){const w=this.length;return this.resize(w+1),this.emplace(w,A,m)}emplace(A,m,w){const D=2*A;return this.int16[D+0]=m,this.int16[D+1]=w,A}}H.prototype.bytesPerElement=4,Vi("StructArrayLayout2i4",H);class Q extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(A,m,w){const D=this.length;return this.resize(D+1),this.emplace(D,A,m,w)}emplace(A,m,w,D){const N=3*A;return this.int16[N+0]=m,this.int16[N+1]=w,this.int16[N+2]=D,A}}Q.prototype.bytesPerElement=6,Vi("StructArrayLayout3i6",Q);class K extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(A,m,w,D){const N=this.length;return this.resize(N+1),this.emplace(N,A,m,w,D)}emplace(A,m,w,D,N){const U=4*A;return this.int16[U+0]=m,this.int16[U+1]=w,this.int16[U+2]=D,this.int16[U+3]=N,A}}K.prototype.bytesPerElement=8,Vi("StructArrayLayout4i8",K);class ue extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(A,m,w,D,N,U){const X=this.length;return this.resize(X+1),this.emplace(X,A,m,w,D,N,U)}emplace(A,m,w,D,N,U,X){const ee=6*A;return this.int16[ee+0]=m,this.int16[ee+1]=w,this.int16[ee+2]=D,this.int16[ee+3]=N,this.int16[ee+4]=U,this.int16[ee+5]=X,A}}ue.prototype.bytesPerElement=12,Vi("StructArrayLayout2i4i12",ue);class Se extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(A,m,w,D,N,U){const X=this.length;return this.resize(X+1),this.emplace(X,A,m,w,D,N,U)}emplace(A,m,w,D,N,U,X){const ee=4*A,ae=8*A;return this.int16[ee+0]=m,this.int16[ee+1]=w,this.uint8[ae+4]=D,this.uint8[ae+5]=N,this.uint8[ae+6]=U,this.uint8[ae+7]=X,A}}Se.prototype.bytesPerElement=8,Vi("StructArrayLayout2i4ub8",Se);class De extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(A,m){const w=this.length;return this.resize(w+1),this.emplace(w,A,m)}emplace(A,m,w){const D=2*A;return this.float32[D+0]=m,this.float32[D+1]=w,A}}De.prototype.bytesPerElement=8,Vi("StructArrayLayout2f8",De);class _t extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(A,m,w,D,N,U,X,ee,ae,de){const ge=this.length;return this.resize(ge+1),this.emplace(ge,A,m,w,D,N,U,X,ee,ae,de)}emplace(A,m,w,D,N,U,X,ee,ae,de,ge){const Ee=10*A;return this.uint16[Ee+0]=m,this.uint16[Ee+1]=w,this.uint16[Ee+2]=D,this.uint16[Ee+3]=N,this.uint16[Ee+4]=U,this.uint16[Ee+5]=X,this.uint16[Ee+6]=ee,this.uint16[Ee+7]=ae,this.uint16[Ee+8]=de,this.uint16[Ee+9]=ge,A}}_t.prototype.bytesPerElement=20,Vi("StructArrayLayout10ui20",_t);class Xe extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(A,m,w,D,N,U,X,ee,ae,de,ge,Ee){const Oe=this.length;return this.resize(Oe+1),this.emplace(Oe,A,m,w,D,N,U,X,ee,ae,de,ge,Ee)}emplace(A,m,w,D,N,U,X,ee,ae,de,ge,Ee,Oe){const ce=12*A;return this.int16[ce+0]=m,this.int16[ce+1]=w,this.int16[ce+2]=D,this.int16[ce+3]=N,this.uint16[ce+4]=U,this.uint16[ce+5]=X,this.uint16[ce+6]=ee,this.uint16[ce+7]=ae,this.int16[ce+8]=de,this.int16[ce+9]=ge,this.int16[ce+10]=Ee,this.int16[ce+11]=Oe,A}}Xe.prototype.bytesPerElement=24,Vi("StructArrayLayout4i4ui4i24",Xe);class tt extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(A,m,w){const D=this.length;return this.resize(D+1),this.emplace(D,A,m,w)}emplace(A,m,w,D){const N=3*A;return this.float32[N+0]=m,this.float32[N+1]=w,this.float32[N+2]=D,A}}tt.prototype.bytesPerElement=12,Vi("StructArrayLayout3f12",tt);class z extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(A){const m=this.length;return this.resize(m+1),this.emplace(m,A)}emplace(A,m){return this.uint32[1*A+0]=m,A}}z.prototype.bytesPerElement=4,Vi("StructArrayLayout1ul4",z);class l extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(A,m,w,D,N,U,X,ee,ae){const de=this.length;return this.resize(de+1),this.emplace(de,A,m,w,D,N,U,X,ee,ae)}emplace(A,m,w,D,N,U,X,ee,ae,de){const ge=10*A,Ee=5*A;return this.int16[ge+0]=m,this.int16[ge+1]=w,this.int16[ge+2]=D,this.int16[ge+3]=N,this.int16[ge+4]=U,this.int16[ge+5]=X,this.uint32[Ee+3]=ee,this.uint16[ge+8]=ae,this.uint16[ge+9]=de,A}}l.prototype.bytesPerElement=20,Vi("StructArrayLayout6i1ul2ui20",l);class g extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(A,m,w,D,N,U){const X=this.length;return this.resize(X+1),this.emplace(X,A,m,w,D,N,U)}emplace(A,m,w,D,N,U,X){const ee=6*A;return this.int16[ee+0]=m,this.int16[ee+1]=w,this.int16[ee+2]=D,this.int16[ee+3]=N,this.int16[ee+4]=U,this.int16[ee+5]=X,A}}g.prototype.bytesPerElement=12,Vi("StructArrayLayout2i2i2i12",g);class S extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(A,m,w,D,N){const U=this.length;return this.resize(U+1),this.emplace(U,A,m,w,D,N)}emplace(A,m,w,D,N,U){const X=4*A,ee=8*A;return this.float32[X+0]=m,this.float32[X+1]=w,this.float32[X+2]=D,this.int16[ee+6]=N,this.int16[ee+7]=U,A}}S.prototype.bytesPerElement=16,Vi("StructArrayLayout2f1f2i16",S);class k extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(A,m,w,D){const N=this.length;return this.resize(N+1),this.emplace(N,A,m,w,D)}emplace(A,m,w,D,N){const U=12*A,X=3*A;return this.uint8[U+0]=m,this.uint8[U+1]=w,this.float32[X+1]=D,this.float32[X+2]=N,A}}k.prototype.bytesPerElement=12,Vi("StructArrayLayout2ub2f12",k);class F extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(A,m,w){const D=this.length;return this.resize(D+1),this.emplace(D,A,m,w)}emplace(A,m,w,D){const N=3*A;return this.uint16[N+0]=m,this.uint16[N+1]=w,this.uint16[N+2]=D,A}}F.prototype.bytesPerElement=6,Vi("StructArrayLayout3ui6",F);class Z extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(A,m,w,D,N,U,X,ee,ae,de,ge,Ee,Oe,ce,et,ot,pt){const Ct=this.length;return this.resize(Ct+1),this.emplace(Ct,A,m,w,D,N,U,X,ee,ae,de,ge,Ee,Oe,ce,et,ot,pt)}emplace(A,m,w,D,N,U,X,ee,ae,de,ge,Ee,Oe,ce,et,ot,pt,Ct){const bt=24*A,_e=12*A,Ut=48*A;return this.int16[bt+0]=m,this.int16[bt+1]=w,this.uint16[bt+2]=D,this.uint16[bt+3]=N,this.uint32[_e+2]=U,this.uint32[_e+3]=X,this.uint32[_e+4]=ee,this.uint16[bt+10]=ae,this.uint16[bt+11]=de,this.uint16[bt+12]=ge,this.float32[_e+7]=Ee,this.float32[_e+8]=Oe,this.uint8[Ut+36]=ce,this.uint8[Ut+37]=et,this.uint8[Ut+38]=ot,this.uint32[_e+10]=pt,this.int16[bt+22]=Ct,A}}Z.prototype.bytesPerElement=48,Vi("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Z);class u extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(A,m,w,D,N,U,X,ee,ae,de,ge,Ee,Oe,ce,et,ot,pt,Ct,bt,_e,Ut,li,Ci,nr,Ri,Pi,wi,Wi){const ki=this.length;return this.resize(ki+1),this.emplace(ki,A,m,w,D,N,U,X,ee,ae,de,ge,Ee,Oe,ce,et,ot,pt,Ct,bt,_e,Ut,li,Ci,nr,Ri,Pi,wi,Wi)}emplace(A,m,w,D,N,U,X,ee,ae,de,ge,Ee,Oe,ce,et,ot,pt,Ct,bt,_e,Ut,li,Ci,nr,Ri,Pi,wi,Wi,ki){const ci=32*A,fr=16*A;return this.int16[ci+0]=m,this.int16[ci+1]=w,this.int16[ci+2]=D,this.int16[ci+3]=N,this.int16[ci+4]=U,this.int16[ci+5]=X,this.int16[ci+6]=ee,this.int16[ci+7]=ae,this.uint16[ci+8]=de,this.uint16[ci+9]=ge,this.uint16[ci+10]=Ee,this.uint16[ci+11]=Oe,this.uint16[ci+12]=ce,this.uint16[ci+13]=et,this.uint16[ci+14]=ot,this.uint16[ci+15]=pt,this.uint16[ci+16]=Ct,this.uint16[ci+17]=bt,this.uint16[ci+18]=_e,this.uint16[ci+19]=Ut,this.uint16[ci+20]=li,this.uint16[ci+21]=Ci,this.uint16[ci+22]=nr,this.uint32[fr+12]=Ri,this.float32[fr+13]=Pi,this.float32[fr+14]=wi,this.uint16[ci+30]=Wi,this.uint16[ci+31]=ki,A}}u.prototype.bytesPerElement=64,Vi("StructArrayLayout8i15ui1ul2f2ui64",u);class h extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(A){const m=this.length;return this.resize(m+1),this.emplace(m,A)}emplace(A,m){return this.float32[1*A+0]=m,A}}h.prototype.bytesPerElement=4,Vi("StructArrayLayout1f4",h);class f extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(A,m,w){const D=this.length;return this.resize(D+1),this.emplace(D,A,m,w)}emplace(A,m,w,D){const N=3*A;return this.uint16[6*A+0]=m,this.float32[N+1]=w,this.float32[N+2]=D,A}}f.prototype.bytesPerElement=12,Vi("StructArrayLayout1ui2f12",f);class y extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(A,m,w){const D=this.length;return this.resize(D+1),this.emplace(D,A,m,w)}emplace(A,m,w,D){const N=4*A;return this.uint32[2*A+0]=m,this.uint16[N+2]=w,this.uint16[N+3]=D,A}}y.prototype.bytesPerElement=8,Vi("StructArrayLayout1ul2ui8",y);class b extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(A,m){const w=this.length;return this.resize(w+1),this.emplace(w,A,m)}emplace(A,m,w){const D=2*A;return this.uint16[D+0]=m,this.uint16[D+1]=w,A}}b.prototype.bytesPerElement=4,Vi("StructArrayLayout2ui4",b);class I extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(A){const m=this.length;return this.resize(m+1),this.emplace(m,A)}emplace(A,m){return this.uint16[1*A+0]=m,A}}I.prototype.bytesPerElement=2,Vi("StructArrayLayout1ui2",I);class R extends M{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(A,m,w,D){const N=this.length;return this.resize(N+1),this.emplace(N,A,m,w,D)}emplace(A,m,w,D,N){const U=4*A;return this.float32[U+0]=m,this.float32[U+1]=w,this.float32[U+2]=D,this.float32[U+3]=N,A}}R.prototype.bytesPerElement=16,Vi("StructArrayLayout4f16",R);class V extends T{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new yt(this.anchorPointX,this.anchorPointY)}}V.prototype.size=20;class W extends l{get(A){return new V(this,A)}}Vi("CollisionBoxArray",W);class Y extends T{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(A){this._structArray.uint8[this._pos1+37]=A}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(A){this._structArray.uint8[this._pos1+38]=A}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(A){this._structArray.uint32[this._pos4+10]=A}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}Y.prototype.size=48;class le extends Z{get(A){return new Y(this,A)}}Vi("PlacedSymbolArray",le);class fe extends T{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(A){this._structArray.uint32[this._pos4+12]=A}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}fe.prototype.size=64;class ye extends u{get(A){return new fe(this,A)}}Vi("SymbolInstanceArray",ye);class Ie extends h{getoffsetX(A){return this.float32[1*A+0]}}Vi("GlyphOffsetArray",Ie);class ke extends Q{getx(A){return this.int16[3*A+0]}gety(A){return this.int16[3*A+1]}gettileUnitDistanceFromAnchor(A){return this.int16[3*A+2]}}Vi("SymbolLineVertexArray",ke);class qe extends T{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}qe.prototype.size=12;class ut extends f{get(A){return new qe(this,A)}}Vi("TextAnchorOffsetArray",ut);class mt extends T{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}mt.prototype.size=8;class st extends y{get(A){return new mt(this,A)}}Vi("FeatureIndexArray",st);class ht extends H{}class ft extends H{}class Ai extends H{}class Nt extends ue{}class Wt extends Se{}class Gt extends De{}class lr extends _t{}class Hi extends Xe{}class Zi extends tt{}class Fi extends z{}class sr extends g{}class er extends k{}class Nr extends F{}class Yi extends b{}const Rr=L([{name:"a_pos",components:2,type:"Int16"}],4),{members:kn}=Rr;class Kn{constructor(A=[]){this.segments=A}prepareSegment(A,m,w,D){let N=this.segments[this.segments.length-1];return A>Kn.MAX_VERTEX_ARRAY_LENGTH&&Li(`Max vertices per segment is ${Kn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${A}`),(!N||N.vertexLength+A>Kn.MAX_VERTEX_ARRAY_LENGTH||N.sortKey!==D)&&(N={vertexOffset:m.length,primitiveOffset:w.length,vertexLength:0,primitiveLength:0},D!==void 0&&(N.sortKey=D),this.segments.push(N)),N}get(){return this.segments}destroy(){for(const A of this.segments)for(const m in A.vaos)A.vaos[m].destroy()}static simpleSegment(A,m,w,D){return new Kn([{vertexOffset:A,primitiveOffset:m,vertexLength:w,primitiveLength:D,vaos:{},sortKey:0}])}}function bl(d,A){return 256*(d=jr(Math.floor(d),0,255))+jr(Math.floor(A),0,255)}Kn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Vi("SegmentVector",Kn);const wl=L([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Fo={exports:{}},Ac={exports:{}};Ac.exports=function(d,A){var m,w,D,N,U,X,ee,ae;for(w=d.length-(m=3&d.length),D=A,U=3432918353,X=461845907,ae=0;ae<w;)ee=255&d.charCodeAt(ae)|(255&d.charCodeAt(++ae))<<8|(255&d.charCodeAt(++ae))<<16|(255&d.charCodeAt(++ae))<<24,++ae,D=27492+(65535&(N=5*(65535&(D=(D^=ee=(65535&(ee=(ee=(65535&ee)*U+(((ee>>>16)*U&65535)<<16)&4294967295)<<15|ee>>>17))*X+(((ee>>>16)*X&65535)<<16)&4294967295)<<13|D>>>19))+((5*(D>>>16)&65535)<<16)&4294967295))+((58964+(N>>>16)&65535)<<16);switch(ee=0,m){case 3:ee^=(255&d.charCodeAt(ae+2))<<16;case 2:ee^=(255&d.charCodeAt(ae+1))<<8;case 1:D^=ee=(65535&(ee=(ee=(65535&(ee^=255&d.charCodeAt(ae)))*U+(((ee>>>16)*U&65535)<<16)&4294967295)<<15|ee>>>17))*X+(((ee>>>16)*X&65535)<<16)&4294967295}return D^=d.length,D=2246822507*(65535&(D^=D>>>16))+((2246822507*(D>>>16)&65535)<<16)&4294967295,D=3266489909*(65535&(D^=D>>>13))+((3266489909*(D>>>16)&65535)<<16)&4294967295,(D^=D>>>16)>>>0};var Sc=Ac.exports,Aa={exports:{}};Aa.exports=function(d,A){for(var m,w=d.length,D=A^w,N=0;w>=4;)m=1540483477*(65535&(m=255&d.charCodeAt(N)|(255&d.charCodeAt(++N))<<8|(255&d.charCodeAt(++N))<<16|(255&d.charCodeAt(++N))<<24))+((1540483477*(m>>>16)&65535)<<16),D=1540483477*(65535&D)+((1540483477*(D>>>16)&65535)<<16)^(m=1540483477*(65535&(m^=m>>>24))+((1540483477*(m>>>16)&65535)<<16)),w-=4,++N;switch(w){case 3:D^=(255&d.charCodeAt(N+2))<<16;case 2:D^=(255&d.charCodeAt(N+1))<<8;case 1:D=1540483477*(65535&(D^=255&d.charCodeAt(N)))+((1540483477*(D>>>16)&65535)<<16)}return D=1540483477*(65535&(D^=D>>>13))+((1540483477*(D>>>16)&65535)<<16),(D^=D>>>15)>>>0};var $s=Sc,Ma=Aa.exports;Fo.exports=$s,Fo.exports.murmur3=$s,Fo.exports.murmur2=Ma;var yA=me(Fo.exports);class Us{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(A,m,w,D){this.ids.push(ao(A)),this.positions.push(m,w,D)}getPositions(A){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const m=ao(A);let w=0,D=this.ids.length-1;for(;w<D;){const U=w+D>>1;this.ids[U]>=m?D=U:w=U+1}const N=[];for(;this.ids[w]===m;)N.push({index:this.positions[3*w],start:this.positions[3*w+1],end:this.positions[3*w+2]}),w++;return N}static serialize(A,m){const w=new Float64Array(A.ids),D=new Uint32Array(A.positions);return qa(w,D,0,w.length-1),m&&m.push(w.buffer,D.buffer),{ids:w,positions:D}}static deserialize(A){const m=new Us;return m.ids=A.ids,m.positions=A.positions,m.indexed=!0,m}}function ao(d){const A=+d;return!isNaN(A)&&A<=Number.MAX_SAFE_INTEGER?A:yA(String(d))}function qa(d,A,m,w){for(;m<w;){const D=d[m+w>>1];let N=m-1,U=w+1;for(;;){do N++;while(d[N]<D);do U--;while(d[U]>D);if(N>=U)break;Xs(d,N,U),Xs(A,3*N,3*U),Xs(A,3*N+1,3*U+1),Xs(A,3*N+2,3*U+2)}U-m<w-U?(qa(d,A,m,U),m=U+1):(qa(d,A,U+1,w),w=U)}}function Xs(d,A,m){const w=d[A];d[A]=d[m],d[m]=w}Vi("FeaturePositionMap",Us);class Nl{constructor(A,m){this.gl=A.gl,this.location=m}}class Nu extends Nl{constructor(A,m){super(A,m),this.current=0}set(A){this.current!==A&&(this.current=A,this.gl.uniform1f(this.location,A))}}class hd extends Nl{constructor(A,m){super(A,m),this.current=[0,0,0,0]}set(A){A[0]===this.current[0]&&A[1]===this.current[1]&&A[2]===this.current[2]&&A[3]===this.current[3]||(this.current=A,this.gl.uniform4f(this.location,A[0],A[1],A[2],A[3]))}}class Th extends Nl{constructor(A,m){super(A,m),this.current=nn.transparent}set(A){A.r===this.current.r&&A.g===this.current.g&&A.b===this.current.b&&A.a===this.current.a||(this.current=A,this.gl.uniform4f(this.location,A.r,A.g,A.b,A.a))}}const Uu=new Float32Array(16);function bu(d){return[bl(255*d.r,255*d.g),bl(255*d.b,255*d.a)]}class oA{constructor(A,m,w){this.value=A,this.uniformNames=m.map(D=>`u_${D}`),this.type=w}setUniform(A,m,w){A.set(w.constantOr(this.value))}getBinding(A,m,w){return this.type==="color"?new Th(A,m):new Nu(A,m)}}class cc{constructor(A,m){this.uniformNames=m.map(w=>`u_${w}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(A,m){this.pixelRatioFrom=m.pixelRatio,this.pixelRatioTo=A.pixelRatio,this.patternFrom=m.tlbr,this.patternTo=A.tlbr}setUniform(A,m,w,D){const N=D==="u_pattern_to"?this.patternTo:D==="u_pattern_from"?this.patternFrom:D==="u_pixel_ratio_to"?this.pixelRatioTo:D==="u_pixel_ratio_from"?this.pixelRatioFrom:null;N&&A.set(N)}getBinding(A,m,w){return w.substr(0,9)==="u_pattern"?new hd(A,m):new Nu(A,m)}}class Tl{constructor(A,m,w,D){this.expression=A,this.type=w,this.maxValue=0,this.paintVertexAttributes=m.map(N=>({name:`a_${N}`,type:"Float32",components:w==="color"?2:1,offset:0})),this.paintVertexArray=new D}populatePaintArray(A,m,w,D,N){const U=this.paintVertexArray.length,X=this.expression.evaluate(new Gn(0),m,{},D,[],N);this.paintVertexArray.resize(A),this._setPaintValue(U,A,X)}updatePaintArray(A,m,w,D){const N=this.expression.evaluate({zoom:0},w,D);this._setPaintValue(A,m,N)}_setPaintValue(A,m,w){if(this.type==="color"){const D=bu(w);for(let N=A;N<m;N++)this.paintVertexArray.emplace(N,D[0],D[1])}else{for(let D=A;D<m;D++)this.paintVertexArray.emplace(D,w);this.maxValue=Math.max(this.maxValue,Math.abs(w))}}upload(A){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=A.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class cl{constructor(A,m,w,D,N,U){this.expression=A,this.uniformNames=m.map(X=>`u_${X}_t`),this.type=w,this.useIntegerZoom=D,this.zoom=N,this.maxValue=0,this.paintVertexAttributes=m.map(X=>({name:`a_${X}`,type:"Float32",components:w==="color"?4:2,offset:0})),this.paintVertexArray=new U}populatePaintArray(A,m,w,D,N){const U=this.expression.evaluate(new Gn(this.zoom),m,{},D,[],N),X=this.expression.evaluate(new Gn(this.zoom+1),m,{},D,[],N),ee=this.paintVertexArray.length;this.paintVertexArray.resize(A),this._setPaintValue(ee,A,U,X)}updatePaintArray(A,m,w,D){const N=this.expression.evaluate({zoom:this.zoom},w,D),U=this.expression.evaluate({zoom:this.zoom+1},w,D);this._setPaintValue(A,m,N,U)}_setPaintValue(A,m,w,D){if(this.type==="color"){const N=bu(w),U=bu(D);for(let X=A;X<m;X++)this.paintVertexArray.emplace(X,N[0],N[1],U[0],U[1])}else{for(let N=A;N<m;N++)this.paintVertexArray.emplace(N,w,D);this.maxValue=Math.max(this.maxValue,Math.abs(w),Math.abs(D))}}upload(A){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=A.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(A,m){const w=this.useIntegerZoom?Math.floor(m.zoom):m.zoom,D=jr(this.expression.interpolationFactor(w,this.zoom,this.zoom+1),0,1);A.set(D)}getBinding(A,m,w){return new Nu(A,m)}}class aA{constructor(A,m,w,D,N,U){this.expression=A,this.type=m,this.useIntegerZoom=w,this.zoom=D,this.layerId=U,this.zoomInPaintVertexArray=new N,this.zoomOutPaintVertexArray=new N}populatePaintArray(A,m,w){const D=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(A),this.zoomOutPaintVertexArray.resize(A),this._setPaintValues(D,A,m.patterns&&m.patterns[this.layerId],w)}updatePaintArray(A,m,w,D,N){this._setPaintValues(A,m,w.patterns&&w.patterns[this.layerId],N)}_setPaintValues(A,m,w,D){if(!D||!w)return;const{min:N,mid:U,max:X}=w,ee=D[N],ae=D[U],de=D[X];if(ee&&ae&&de)for(let ge=A;ge<m;ge++)this.zoomInPaintVertexArray.emplace(ge,ae.tl[0],ae.tl[1],ae.br[0],ae.br[1],ee.tl[0],ee.tl[1],ee.br[0],ee.br[1],ae.pixelRatio,ee.pixelRatio),this.zoomOutPaintVertexArray.emplace(ge,ae.tl[0],ae.tl[1],ae.br[0],ae.br[1],de.tl[0],de.tl[1],de.br[0],de.br[1],ae.pixelRatio,de.pixelRatio)}upload(A){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=A.createVertexBuffer(this.zoomInPaintVertexArray,wl.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=A.createVertexBuffer(this.zoomOutPaintVertexArray,wl.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class ju{constructor(A,m,w){this.binders={},this._buffers=[];const D=[];for(const N in A.paint._values){if(!w(N))continue;const U=A.paint.get(N);if(!(U instanceof _o&&cs(U.property.specification)))continue;const X=cp(N,A.type),ee=U.value,ae=U.property.specification.type,de=U.property.useIntegerZoom,ge=U.property.specification["property-type"],Ee=ge==="cross-faded"||ge==="cross-faded-data-driven";if(ee.kind==="constant")this.binders[N]=Ee?new cc(ee.value,X):new oA(ee.value,X,ae),D.push(`/u_${N}`);else if(ee.kind==="source"||Ee){const Oe=bf(N,ae,"source");this.binders[N]=Ee?new aA(ee,ae,de,m,Oe,A.id):new Tl(ee,X,ae,Oe),D.push(`/a_${N}`)}else{const Oe=bf(N,ae,"composite");this.binders[N]=new cl(ee,X,ae,de,m,Oe),D.push(`/z_${N}`)}}this.cacheKey=D.sort().join("")}getMaxValue(A){const m=this.binders[A];return m instanceof Tl||m instanceof cl?m.maxValue:0}populatePaintArrays(A,m,w,D,N){for(const U in this.binders){const X=this.binders[U];(X instanceof Tl||X instanceof cl||X instanceof aA)&&X.populatePaintArray(A,m,w,D,N)}}setConstantPatternPositions(A,m){for(const w in this.binders){const D=this.binders[w];D instanceof cc&&D.setConstantPatternPositions(A,m)}}updatePaintArrays(A,m,w,D,N){let U=!1;for(const X in A){const ee=m.getPositions(X);for(const ae of ee){const de=w.feature(ae.index);for(const ge in this.binders){const Ee=this.binders[ge];if((Ee instanceof Tl||Ee instanceof cl||Ee instanceof aA)&&Ee.expression.isStateDependent===!0){const Oe=D.paint.get(ge);Ee.expression=Oe.value,Ee.updatePaintArray(ae.start,ae.end,de,A[X],N),U=!0}}}}return U}defines(){const A=[];for(const m in this.binders){const w=this.binders[m];(w instanceof oA||w instanceof cc)&&A.push(...w.uniformNames.map(D=>`#define HAS_UNIFORM_${D}`))}return A}getBinderAttributes(){const A=[];for(const m in this.binders){const w=this.binders[m];if(w instanceof Tl||w instanceof cl)for(let D=0;D<w.paintVertexAttributes.length;D++)A.push(w.paintVertexAttributes[D].name);else if(w instanceof aA)for(let D=0;D<wl.members.length;D++)A.push(wl.members[D].name)}return A}getBinderUniforms(){const A=[];for(const m in this.binders){const w=this.binders[m];if(w instanceof oA||w instanceof cc||w instanceof cl)for(const D of w.uniformNames)A.push(D)}return A}getPaintVertexBuffers(){return this._buffers}getUniforms(A,m){const w=[];for(const D in this.binders){const N=this.binders[D];if(N instanceof oA||N instanceof cc||N instanceof cl){for(const U of N.uniformNames)if(m[U]){const X=N.getBinding(A,m[U],U);w.push({name:U,property:D,binding:X})}}}return w}setUniforms(A,m,w,D){for(const{name:N,property:U,binding:X}of m)this.binders[U].setUniform(X,D,w.get(U),N)}updatePaintBuffers(A){this._buffers=[];for(const m in this.binders){const w=this.binders[m];if(A&&w instanceof aA){const D=A.fromScale===2?w.zoomInPaintVertexBuffer:w.zoomOutPaintVertexBuffer;D&&this._buffers.push(D)}else(w instanceof Tl||w instanceof cl)&&w.paintVertexBuffer&&this._buffers.push(w.paintVertexBuffer)}}upload(A){for(const m in this.binders){const w=this.binders[m];(w instanceof Tl||w instanceof cl||w instanceof aA)&&w.upload(A)}this.updatePaintBuffers()}destroy(){for(const A in this.binders){const m=this.binders[A];(m instanceof Tl||m instanceof cl||m instanceof aA)&&m.destroy()}}}class xA{constructor(A,m,w=()=>!0){this.programConfigurations={};for(const D of A)this.programConfigurations[D.id]=new ju(D,m,w);this.needsUpload=!1,this._featureMap=new Us,this._bufferOffset=0}populatePaintArrays(A,m,w,D,N,U){for(const X in this.programConfigurations)this.programConfigurations[X].populatePaintArrays(A,m,D,N,U);m.id!==void 0&&this._featureMap.add(m.id,w,this._bufferOffset,A),this._bufferOffset=A,this.needsUpload=!0}updatePaintArrays(A,m,w,D){for(const N of w)this.needsUpload=this.programConfigurations[N.id].updatePaintArrays(A,this._featureMap,m,N,D)||this.needsUpload}get(A){return this.programConfigurations[A]}upload(A){if(this.needsUpload){for(const m in this.programConfigurations)this.programConfigurations[m].upload(A);this.needsUpload=!1}}destroy(){for(const A in this.programConfigurations)this.programConfigurations[A].destroy()}}function cp(d,A){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[d]||[d.replace(`${A}-`,"").replace(/-/g,"_")]}function bf(d,A,m){const w={color:{source:De,composite:R},number:{source:h,composite:De}},D=function(N){return{"line-pattern":{source:lr,composite:lr},"fill-pattern":{source:lr,composite:lr},"fill-extrusion-pattern":{source:lr,composite:lr}}[N]}(d);return D&&D[m]||w[A][m]}Vi("ConstantBinder",oA),Vi("CrossFadedConstantBinder",cc),Vi("SourceExpressionBinder",Tl),Vi("CrossFadedCompositeBinder",aA),Vi("CompositeExpressionBinder",cl),Vi("ProgramConfiguration",ju,{omit:["_buffers"]}),Vi("ProgramConfigurationSet",xA);const zs=8192,dd=Math.pow(2,14)-1,wf=-dd-1;function wu(d){const A=zs/d.extent,m=d.loadGeometry();for(let w=0;w<m.length;w++){const D=m[w];for(let N=0;N<D.length;N++){const U=D[N],X=Math.round(U.x*A),ee=Math.round(U.y*A);U.x=jr(X,wf,dd),U.y=jr(ee,wf,dd),(X<U.x||X>U.x+1||ee<U.y||ee>U.y+1)&&Li("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return m}function eu(d,A){return{type:d.type,id:d.id,properties:d.properties,geometry:A?wu(d):[]}}function Eh(d,A,m,w,D){d.emplaceBack(2*A+(w+1)/2,2*m+(D+1)/2)}class fd{constructor(A){this.zoom=A.zoom,this.overscaling=A.overscaling,this.layers=A.layers,this.layerIds=this.layers.map(m=>m.id),this.index=A.index,this.hasPattern=!1,this.layoutVertexArray=new ft,this.indexArray=new Nr,this.segments=new Kn,this.programConfigurations=new xA(A.layers,A.zoom),this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id)}populate(A,m,w){const D=this.layers[0],N=[];let U=null,X=!1;D.type==="circle"&&(U=D.layout.get("circle-sort-key"),X=!U.isConstant());for(const{feature:ee,id:ae,index:de,sourceLayerIndex:ge}of A){const Ee=this.layers[0]._featureFilter.needGeometry,Oe=eu(ee,Ee);if(!this.layers[0]._featureFilter.filter(new Gn(this.zoom),Oe,w))continue;const ce=X?U.evaluate(Oe,{},w):void 0,et={id:ae,properties:ee.properties,type:ee.type,sourceLayerIndex:ge,index:de,geometry:Ee?Oe.geometry:wu(ee),patterns:{},sortKey:ce};N.push(et)}X&&N.sort((ee,ae)=>ee.sortKey-ae.sortKey);for(const ee of N){const{geometry:ae,index:de,sourceLayerIndex:ge}=ee,Ee=A[de].feature;this.addFeature(ee,ae,de,w),m.featureIndex.insert(Ee,ae,de,ge,this.index)}}update(A,m,w){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(A,m,this.stateDependentLayers,w)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(A){this.uploaded||(this.layoutVertexBuffer=A.createVertexBuffer(this.layoutVertexArray,kn),this.indexBuffer=A.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(A),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(A,m,w,D){for(const N of m)for(const U of N){const X=U.x,ee=U.y;if(X<0||X>=zs||ee<0||ee>=zs)continue;const ae=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,A.sortKey),de=ae.vertexLength;Eh(this.layoutVertexArray,X,ee,-1,-1),Eh(this.layoutVertexArray,X,ee,1,-1),Eh(this.layoutVertexArray,X,ee,1,1),Eh(this.layoutVertexArray,X,ee,-1,1),this.indexArray.emplaceBack(de,de+1,de+2),this.indexArray.emplaceBack(de,de+3,de+2),ae.vertexLength+=4,ae.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,A,w,{},D)}}function Tf(d,A){for(let m=0;m<d.length;m++)if(Gu(A,d[m]))return!0;for(let m=0;m<A.length;m++)if(Gu(d,A[m]))return!0;return!!Mf(d,A)}function up(d,A,m){return!!Gu(d,A)||!!tu(A,d,m)}function Ef(d,A){if(d.length===1)return fp(A,d[0]);for(let m=0;m<A.length;m++){const w=A[m];for(let D=0;D<w.length;D++)if(Gu(d,w[D]))return!0}for(let m=0;m<d.length;m++)if(fp(A,d[m]))return!0;for(let m=0;m<A.length;m++)if(Mf(d,A[m]))return!0;return!1}function ca(d,A,m){if(d.length>1){if(Mf(d,A))return!0;for(let w=0;w<A.length;w++)if(tu(A[w],d,m))return!0}for(let w=0;w<d.length;w++)if(tu(d[w],A,m))return!0;return!1}function Mf(d,A){if(d.length===0||A.length===0)return!1;for(let m=0;m<d.length-1;m++){const w=d[m],D=d[m+1];for(let N=0;N<A.length-1;N++)if(hp(w,D,A[N],A[N+1]))return!0}return!1}function hp(d,A,m,w){return Ir(d,m,w)!==Ir(A,m,w)&&Ir(d,A,m)!==Ir(d,A,w)}function tu(d,A,m){const w=m*m;if(A.length===1)return d.distSqr(A[0])<w;for(let D=1;D<A.length;D++)if(dp(d,A[D-1],A[D])<w)return!0;return!1}function dp(d,A,m){const w=A.distSqr(m);if(w===0)return d.distSqr(A);const D=((d.x-A.x)*(m.x-A.x)+(d.y-A.y)*(m.y-A.y))/w;return d.distSqr(D<0?A:D>1?m:m.sub(A)._mult(D)._add(A))}function fp(d,A){let m,w,D,N=!1;for(let U=0;U<d.length;U++){m=d[U];for(let X=0,ee=m.length-1;X<m.length;ee=X++)w=m[X],D=m[ee],w.y>A.y!=D.y>A.y&&A.x<(D.x-w.x)*(A.y-w.y)/(D.y-w.y)+w.x&&(N=!N)}return N}function Gu(d,A){let m=!1;for(let w=0,D=d.length-1;w<d.length;D=w++){const N=d[w],U=d[D];N.y>A.y!=U.y>A.y&&A.x<(U.x-N.x)*(A.y-N.y)/(U.y-N.y)+N.x&&(m=!m)}return m}function O_(d,A,m){const w=m[0],D=m[2];if(d.x<w.x&&A.x<w.x||d.x>D.x&&A.x>D.x||d.y<w.y&&A.y<w.y||d.y>D.y&&A.y>D.y)return!1;const N=Ir(d,A,m[0]);return N!==Ir(d,A,m[1])||N!==Ir(d,A,m[2])||N!==Ir(d,A,m[3])}function Mh(d,A,m){const w=A.paint.get(d).value;return w.kind==="constant"?w.value:m.programConfigurations.get(A.id).getMaxValue(d)}function pd(d){return Math.sqrt(d[0]*d[0]+d[1]*d[1])}function Zu(d,A,m,w,D){if(!A[0]&&!A[1])return d;const N=yt.convert(A)._mult(D);m==="viewport"&&N._rotate(-w);const U=[];for(let X=0;X<d.length;X++)U.push(d[X].sub(N));return U}let pp,mp;Vi("CircleBucket",fd,{omit:["layers"]});var V_={get paint(){return mp=mp||new tn({"circle-radius":new Jt(Pe.paint_circle["circle-radius"]),"circle-color":new Jt(Pe.paint_circle["circle-color"]),"circle-blur":new Jt(Pe.paint_circle["circle-blur"]),"circle-opacity":new Jt(Pe.paint_circle["circle-opacity"]),"circle-translate":new Vt(Pe.paint_circle["circle-translate"]),"circle-translate-anchor":new Vt(Pe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Vt(Pe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Vt(Pe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Jt(Pe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Jt(Pe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Jt(Pe.paint_circle["circle-stroke-opacity"])})},get layout(){return pp=pp||new tn({"circle-sort-key":new Jt(Pe.layout_circle["circle-sort-key"])})}},js=1e-6,Ic=typeof Float32Array<"u"?Float32Array:Array;function Sf(d){return d[0]=1,d[1]=0,d[2]=0,d[3]=0,d[4]=0,d[5]=1,d[6]=0,d[7]=0,d[8]=0,d[9]=0,d[10]=1,d[11]=0,d[12]=0,d[13]=0,d[14]=0,d[15]=1,d}function Cc(d,A,m){var w=A[0],D=A[1],N=A[2],U=A[3],X=A[4],ee=A[5],ae=A[6],de=A[7],ge=A[8],Ee=A[9],Oe=A[10],ce=A[11],et=A[12],ot=A[13],pt=A[14],Ct=A[15],bt=m[0],_e=m[1],Ut=m[2],li=m[3];return d[0]=bt*w+_e*X+Ut*ge+li*et,d[1]=bt*D+_e*ee+Ut*Ee+li*ot,d[2]=bt*N+_e*ae+Ut*Oe+li*pt,d[3]=bt*U+_e*de+Ut*ce+li*Ct,d[4]=(bt=m[4])*w+(_e=m[5])*X+(Ut=m[6])*ge+(li=m[7])*et,d[5]=bt*D+_e*ee+Ut*Ee+li*ot,d[6]=bt*N+_e*ae+Ut*Oe+li*pt,d[7]=bt*U+_e*de+Ut*ce+li*Ct,d[8]=(bt=m[8])*w+(_e=m[9])*X+(Ut=m[10])*ge+(li=m[11])*et,d[9]=bt*D+_e*ee+Ut*Ee+li*ot,d[10]=bt*N+_e*ae+Ut*Oe+li*pt,d[11]=bt*U+_e*de+Ut*ce+li*Ct,d[12]=(bt=m[12])*w+(_e=m[13])*X+(Ut=m[14])*ge+(li=m[15])*et,d[13]=bt*D+_e*ee+Ut*Ee+li*ot,d[14]=bt*N+_e*ae+Ut*Oe+li*pt,d[15]=bt*U+_e*de+Ut*ce+li*Ct,d}Math.hypot||(Math.hypot=function(){for(var d=0,A=arguments.length;A--;)d+=arguments[A]*arguments[A];return Math.sqrt(d)});var Ul,qu=Cc;function Tu(d,A,m){var w=A[0],D=A[1],N=A[2],U=A[3];return d[0]=m[0]*w+m[4]*D+m[8]*N+m[12]*U,d[1]=m[1]*w+m[5]*D+m[9]*N+m[13]*U,d[2]=m[2]*w+m[6]*D+m[10]*N+m[14]*U,d[3]=m[3]*w+m[7]*D+m[11]*N+m[15]*U,d}Ul=new Ic(4),Ic!=Float32Array&&(Ul[0]=0,Ul[1]=0,Ul[2]=0,Ul[3]=0);class Ii extends Zn{constructor(A){super(A,V_)}createBucket(A){return new fd(A)}queryRadius(A){const m=A;return Mh("circle-radius",this,m)+Mh("circle-stroke-width",this,m)+pd(this.paint.get("circle-translate"))}queryIntersectsFeature(A,m,w,D,N,U,X,ee){const ae=Zu(A,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),U.angle,X),de=this.paint.get("circle-radius").evaluate(m,w)+this.paint.get("circle-stroke-width").evaluate(m,w),ge=this.paint.get("circle-pitch-alignment")==="map",Ee=ge?ae:function(ce,et){return ce.map(ot=>If(ot,et))}(ae,ee),Oe=ge?de*X:de;for(const ce of D)for(const et of ce){const ot=ge?et:If(et,ee);let pt=Oe;const Ct=Tu([],[et.x,et.y,0,1],ee);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?pt*=Ct[3]/U.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(pt*=U.cameraToCenterDistance/Ct[3]),up(Ee,ot,pt))return!0}return!1}}function If(d,A){const m=Tu([],[d.x,d.y,0,1],A);return new yt(m[0]/m[3],m[1]/m[3])}class Cf extends fd{}let Eu;Vi("HeatmapBucket",Cf,{omit:["layers"]});var Qu={get paint(){return Eu=Eu||new tn({"heatmap-radius":new Jt(Pe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Jt(Pe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Vt(Pe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Vl(Pe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Vt(Pe.paint_heatmap["heatmap-opacity"])})}};function Bi(d,{width:A,height:m},w,D){if(D){if(D instanceof Uint8ClampedArray)D=new Uint8Array(D.buffer);else if(D.length!==A*m*w)throw new RangeError(`mismatched image size. expected: ${D.length} but got: ${A*m*w}`)}else D=new Uint8Array(A*m*w);return d.width=A,d.height=m,d.data=D,d}function md(d,{width:A,height:m},w){if(A===d.width&&m===d.height)return;const D=Bi({},{width:A,height:m},w);kf(d,D,{x:0,y:0},{x:0,y:0},{width:Math.min(d.width,A),height:Math.min(d.height,m)},w),d.width=A,d.height=m,d.data=D.data}function kf(d,A,m,w,D,N){if(D.width===0||D.height===0)return A;if(D.width>d.width||D.height>d.height||m.x>d.width-D.width||m.y>d.height-D.height)throw new RangeError("out of range source coordinates for image copy");if(D.width>A.width||D.height>A.height||w.x>A.width-D.width||w.y>A.height-D.height)throw new RangeError("out of range destination coordinates for image copy");const U=d.data,X=A.data;if(U===X)throw new Error("srcData equals dstData, so image is already copied");for(let ee=0;ee<D.height;ee++){const ae=((m.y+ee)*d.width+m.x)*N,de=((w.y+ee)*A.width+w.x)*N;for(let ge=0;ge<D.width*N;ge++)X[de+ge]=U[ae+ge]}return A}class Sh{constructor(A,m){Bi(this,A,1,m)}resize(A){md(this,A,1)}clone(){return new Sh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(A,m,w,D,N){kf(A,m,w,D,N,1)}}class El{constructor(A,m){Bi(this,A,4,m)}resize(A){md(this,A,4)}replace(A,m){m?this.data.set(A):this.data=A instanceof Uint8ClampedArray?new Uint8Array(A.buffer):A}clone(){return new El({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(A,m,w,D,N){kf(A,m,w,D,N,4)}}function Df(d){const A={},m=d.resolution||256,w=d.clips?d.clips.length:1,D=d.image||new El({width:m,height:w});if(Math.log(m)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${m}`);const N=(U,X,ee)=>{A[d.evaluationKey]=ee;const ae=d.expression.evaluate(A);D.data[U+X+0]=Math.floor(255*ae.r/ae.a),D.data[U+X+1]=Math.floor(255*ae.g/ae.a),D.data[U+X+2]=Math.floor(255*ae.b/ae.a),D.data[U+X+3]=Math.floor(255*ae.a)};if(d.clips)for(let U=0,X=0;U<w;++U,X+=4*m)for(let ee=0,ae=0;ee<m;ee++,ae+=4){const de=ee/(m-1),{start:ge,end:Ee}=d.clips[U];N(X,ae,ge*(1-de)+Ee*de)}else for(let U=0,X=0;U<m;U++,X+=4)N(0,X,U/(m-1));return D}Vi("AlphaImage",Sh),Vi("RGBAImage",El);class _p extends Zn{createBucket(A){return new Cf(A)}constructor(A){super(A,Qu),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(A){A==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Df({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let gp;var N_={get paint(){return gp=gp||new tn({"hillshade-illumination-direction":new Vt(Pe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Vt(Pe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Vt(Pe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Vt(Pe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Vt(Pe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Vt(Pe.paint_hillshade["hillshade-accent-color"])})}};class Pf extends Zn{constructor(A){super(A,N_)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const zf=L([{name:"a_pos",components:2,type:"Int16"}],4),{members:Bf}=zf;var Ih={exports:{}};function Qa(d,A,m){m=m||2;var w,D,N,U,X,ee,ae,de=A&&A.length,ge=de?A[0]*m:d.length,Ee=kc(d,0,ge,m,!0),Oe=[];if(!Ee||Ee.next===Ee.prev)return Oe;if(de&&(Ee=function(et,ot,pt,Ct){var bt,_e,Ut,li=[];for(bt=0,_e=ot.length;bt<_e;bt++)(Ut=kc(et,ot[bt]*Ct,bt<_e-1?ot[bt+1]*Ct:et.length,Ct,!1))===Ut.next&&(Ut.steiner=!0),li.push(xp(Ut));for(li.sort(ds),bt=0;bt<li.length;bt++)pt=_d(li[bt],pt);return pt}(d,A,Ee,m)),d.length>80*m){w=N=d[0],D=U=d[1];for(var ce=m;ce<ge;ce+=m)(X=d[ce])<w&&(w=X),(ee=d[ce+1])<D&&(D=ee),X>N&&(N=X),ee>U&&(U=ee);ae=(ae=Math.max(N-w,U-D))!==0?32767/ae:0}return Mu(Ee,Oe,m,w,D,ae,0),Oe}function kc(d,A,m,w,D){var N,U;if(D===gd(d,A,m,w)>0)for(N=A;N<m;N+=w)U=Of(N,d[N],d[N+1],U);else for(N=m-w;N>=A;N-=w)U=Of(N,d[N],d[N+1],U);return U&&ru(U,U.next)&&(Oo(U),U=U.next),U}function iu(d,A){if(!d)return d;A||(A=d);var m,w=d;do if(m=!1,w.steiner||!ru(w,w.next)&&Is(w.prev,w,w.next)!==0)w=w.next;else{if(Oo(w),(w=A=w.prev)===w.next)break;m=!0}while(m||w!==A);return A}function Mu(d,A,m,w,D,N,U){if(d){!U&&N&&function(de,ge,Ee,Oe){var ce=de;do ce.z===0&&(ce.z=Su(ce.x,ce.y,ge,Ee,Oe)),ce.prevZ=ce.prev,ce.nextZ=ce.next,ce=ce.next;while(ce!==de);ce.prevZ.nextZ=null,ce.prevZ=null,function(et){var ot,pt,Ct,bt,_e,Ut,li,Ci,nr=1;do{for(pt=et,et=null,_e=null,Ut=0;pt;){for(Ut++,Ct=pt,li=0,ot=0;ot<nr&&(li++,Ct=Ct.nextZ);ot++);for(Ci=nr;li>0||Ci>0&&Ct;)li!==0&&(Ci===0||!Ct||pt.z<=Ct.z)?(bt=pt,pt=pt.nextZ,li--):(bt=Ct,Ct=Ct.nextZ,Ci--),_e?_e.nextZ=bt:et=bt,bt.prevZ=_e,_e=bt;pt=Ct}_e.nextZ=null,nr*=2}while(Ut>1)}(ce)}(d,w,D,N);for(var X,ee,ae=d;d.prev!==d.next;)if(X=d.prev,ee=d.next,N?Rf(d,w,D,N):Lf(d))A.push(X.i/m|0),A.push(d.i/m|0),A.push(ee.i/m|0),Oo(d),d=ee.next,ae=ee.next;else if((d=ee)===ae){U?U===1?Mu(d=yp(iu(d),A,m),A,m,w,D,N,2):U===2&&vA(d,A,m,w,D,N):Mu(iu(d),A,m,w,D,N,1);break}}}function Lf(d){var A=d.prev,m=d,w=d.next;if(Is(A,m,w)>=0)return!1;for(var D=A.x,N=m.x,U=w.x,X=A.y,ee=m.y,ae=w.y,de=D<N?D<U?D:U:N<U?N:U,ge=X<ee?X<ae?X:ae:ee<ae?ee:ae,Ee=D>N?D>U?D:U:N>U?N:U,Oe=X>ee?X>ae?X:ae:ee>ae?ee:ae,ce=w.next;ce!==A;){if(ce.x>=de&&ce.x<=Ee&&ce.y>=ge&&ce.y<=Oe&&Iu(D,X,N,ee,U,ae,ce.x,ce.y)&&Is(ce.prev,ce,ce.next)>=0)return!1;ce=ce.next}return!0}function Rf(d,A,m,w){var D=d.prev,N=d,U=d.next;if(Is(D,N,U)>=0)return!1;for(var X=D.x,ee=N.x,ae=U.x,de=D.y,ge=N.y,Ee=U.y,Oe=X<ee?X<ae?X:ae:ee<ae?ee:ae,ce=de<ge?de<Ee?de:Ee:ge<Ee?ge:Ee,et=X>ee?X>ae?X:ae:ee>ae?ee:ae,ot=de>ge?de>Ee?de:Ee:ge>Ee?ge:Ee,pt=Su(Oe,ce,A,m,w),Ct=Su(et,ot,A,m,w),bt=d.prevZ,_e=d.nextZ;bt&&bt.z>=pt&&_e&&_e.z<=Ct;){if(bt.x>=Oe&&bt.x<=et&&bt.y>=ce&&bt.y<=ot&&bt!==D&&bt!==U&&Iu(X,de,ee,ge,ae,Ee,bt.x,bt.y)&&Is(bt.prev,bt,bt.next)>=0||(bt=bt.prevZ,_e.x>=Oe&&_e.x<=et&&_e.y>=ce&&_e.y<=ot&&_e!==D&&_e!==U&&Iu(X,de,ee,ge,ae,Ee,_e.x,_e.y)&&Is(_e.prev,_e,_e.next)>=0))return!1;_e=_e.nextZ}for(;bt&&bt.z>=pt;){if(bt.x>=Oe&&bt.x<=et&&bt.y>=ce&&bt.y<=ot&&bt!==D&&bt!==U&&Iu(X,de,ee,ge,ae,Ee,bt.x,bt.y)&&Is(bt.prev,bt,bt.next)>=0)return!1;bt=bt.prevZ}for(;_e&&_e.z<=Ct;){if(_e.x>=Oe&&_e.x<=et&&_e.y>=ce&&_e.y<=ot&&_e!==D&&_e!==U&&Iu(X,de,ee,ge,ae,Ee,_e.x,_e.y)&&Is(_e.prev,_e,_e.next)>=0)return!1;_e=_e.nextZ}return!0}function yp(d,A,m){var w=d;do{var D=w.prev,N=w.next.next;!ru(D,N)&&si(D,w,w.next,N)&&ss(D,N)&&ss(N,D)&&(A.push(D.i/m|0),A.push(w.i/m|0),A.push(N.i/m|0),Oo(w),Oo(w.next),w=d=N),w=w.next}while(w!==d);return iu(w)}function vA(d,A,m,w,D,N){var U=d;do{for(var X=U.next.next;X!==U.prev;){if(U.i!==X.i&&U_(U,X)){var ee=Ch(U,X);return U=iu(U,U.next),ee=iu(ee,ee.next),Mu(U,A,m,w,D,N,0),void Mu(ee,A,m,w,D,N,0)}X=X.next}U=U.next}while(U!==d)}function ds(d,A){return d.x-A.x}function _d(d,A){var m=function(D,N){var U,X=N,ee=D.x,ae=D.y,de=-1/0;do{if(ae<=X.y&&ae>=X.next.y&&X.next.y!==X.y){var ge=X.x+(ae-X.y)*(X.next.x-X.x)/(X.next.y-X.y);if(ge<=ee&&ge>de&&(de=ge,U=X.x<X.next.x?X:X.next,ge===ee))return U}X=X.next}while(X!==N);if(!U)return null;var Ee,Oe=U,ce=U.x,et=U.y,ot=1/0;X=U;do ee>=X.x&&X.x>=ce&&ee!==X.x&&Iu(ae<et?ee:de,ae,ce,et,ae<et?de:ee,ae,X.x,X.y)&&(Ee=Math.abs(ae-X.y)/(ee-X.x),ss(X,D)&&(Ee<ot||Ee===ot&&(X.x>U.x||X.x===U.x&&Ff(U,X)))&&(U=X,ot=Ee)),X=X.next;while(X!==Oe);return U}(d,A);if(!m)return A;var w=Ch(m,d);return iu(w,w.next),iu(m,m.next)}function Ff(d,A){return Is(d.prev,d,A.prev)<0&&Is(A.next,d,d.next)<0}function Su(d,A,m,w,D){return(d=1431655765&((d=858993459&((d=252645135&((d=16711935&((d=(d-m)*D|0)|d<<8))|d<<4))|d<<2))|d<<1))|(A=1431655765&((A=858993459&((A=252645135&((A=16711935&((A=(A-w)*D|0)|A<<8))|A<<4))|A<<2))|A<<1))<<1}function xp(d){var A=d,m=d;do(A.x<m.x||A.x===m.x&&A.y<m.y)&&(m=A),A=A.next;while(A!==d);return m}function Iu(d,A,m,w,D,N,U,X){return(D-U)*(A-X)>=(d-U)*(N-X)&&(d-U)*(w-X)>=(m-U)*(A-X)&&(m-U)*(N-X)>=(D-U)*(w-X)}function U_(d,A){return d.next.i!==A.i&&d.prev.i!==A.i&&!function(m,w){var D=m;do{if(D.i!==m.i&&D.next.i!==m.i&&D.i!==w.i&&D.next.i!==w.i&&si(D,D.next,m,w))return!0;D=D.next}while(D!==m);return!1}(d,A)&&(ss(d,A)&&ss(A,d)&&function(m,w){var D=m,N=!1,U=(m.x+w.x)/2,X=(m.y+w.y)/2;do D.y>X!=D.next.y>X&&D.next.y!==D.y&&U<(D.next.x-D.x)*(X-D.y)/(D.next.y-D.y)+D.x&&(N=!N),D=D.next;while(D!==m);return N}(d,A)&&(Is(d.prev,d,A.prev)||Is(d,A.prev,A))||ru(d,A)&&Is(d.prev,d,d.next)>0&&Is(A.prev,A,A.next)>0)}function Is(d,A,m){return(A.y-d.y)*(m.x-A.x)-(A.x-d.x)*(m.y-A.y)}function ru(d,A){return d.x===A.x&&d.y===A.y}function si(d,A,m,w){var D=nu(Is(d,A,m)),N=nu(Is(d,A,w)),U=nu(Is(m,w,d)),X=nu(Is(m,w,A));return D!==N&&U!==X||!(D!==0||!qi(d,m,A))||!(N!==0||!qi(d,w,A))||!(U!==0||!qi(m,d,w))||!(X!==0||!qi(m,A,w))}function qi(d,A,m){return A.x<=Math.max(d.x,m.x)&&A.x>=Math.min(d.x,m.x)&&A.y<=Math.max(d.y,m.y)&&A.y>=Math.min(d.y,m.y)}function nu(d){return d>0?1:d<0?-1:0}function ss(d,A){return Is(d.prev,d,d.next)<0?Is(d,A,d.next)>=0&&Is(d,d.prev,A)>=0:Is(d,A,d.prev)<0||Is(d,d.next,A)<0}function Ch(d,A){var m=new Hu(d.i,d.x,d.y),w=new Hu(A.i,A.x,A.y),D=d.next,N=A.prev;return d.next=A,A.prev=d,m.next=D,D.prev=m,w.next=m,m.prev=w,N.next=w,w.prev=N,w}function Of(d,A,m,w){var D=new Hu(d,A,m);return w?(D.next=w.next,D.prev=w,w.next.prev=D,w.next=D):(D.prev=D,D.next=D),D}function Oo(d){d.next.prev=d.prev,d.prev.next=d.next,d.prevZ&&(d.prevZ.nextZ=d.nextZ),d.nextZ&&(d.nextZ.prevZ=d.prevZ)}function Hu(d,A,m){this.i=d,this.x=A,this.y=m,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function gd(d,A,m,w){for(var D=0,N=A,U=m-w;N<m;N+=w)D+=(d[U]-d[N])*(d[N+1]+d[U+1]),U=N;return D}Ih.exports=Qa,Ih.exports.default=Qa,Qa.deviation=function(d,A,m,w){var D=A&&A.length,N=Math.abs(gd(d,0,D?A[0]*m:d.length,m));if(D)for(var U=0,X=A.length;U<X;U++)N-=Math.abs(gd(d,A[U]*m,U<X-1?A[U+1]*m:d.length,m));var ee=0;for(U=0;U<w.length;U+=3){var ae=w[U]*m,de=w[U+1]*m,ge=w[U+2]*m;ee+=Math.abs((d[ae]-d[ge])*(d[de+1]-d[ae+1])-(d[ae]-d[de])*(d[ge+1]-d[ae+1]))}return N===0&&ee===0?0:Math.abs((ee-N)/N)},Qa.flatten=function(d){for(var A=d[0][0].length,m={vertices:[],holes:[],dimensions:A},w=0,D=0;D<d.length;D++){for(var N=0;N<d[D].length;N++)for(var U=0;U<A;U++)m.vertices.push(d[D][N][U]);D>0&&m.holes.push(w+=d[D-1].length)}return m};var jl=me(Ih.exports);function j_(d,A,m,w,D){vp(d,A,m||0,w||d.length-1,D||fs)}function vp(d,A,m,w,D){for(;w>m;){if(w-m>600){var N=w-m+1,U=A-m+1,X=Math.log(N),ee=.5*Math.exp(2*X/3),ae=.5*Math.sqrt(X*ee*(N-ee)/N)*(U-N/2<0?-1:1);vp(d,A,Math.max(m,Math.floor(A-U*ee/N+ae)),Math.min(w,Math.floor(A+(N-U)*ee/N+ae)),D)}var de=d[A],ge=m,Ee=w;for(su(d,m,A),D(d[w],de)>0&&su(d,m,w);ge<Ee;){for(su(d,ge,Ee),ge++,Ee--;D(d[ge],de)<0;)ge++;for(;D(d[Ee],de)>0;)Ee--}D(d[m],de)===0?su(d,m,Ee):su(d,++Ee,w),Ee<=A&&(m=Ee+1),A<=Ee&&(w=Ee-1)}}function su(d,A,m){var w=d[A];d[A]=d[m],d[m]=w}function fs(d,A){return d<A?-1:d>A?1:0}function un(d,A){const m=d.length;if(m<=1)return[d];const w=[];let D,N;for(let U=0;U<m;U++){const X=as(d[U]);X!==0&&(d[U].area=Math.abs(X),N===void 0&&(N=X<0),N===X<0?(D&&w.push(D),D=[d[U]]):D.push(d[U]))}if(D&&w.push(D),A>1)for(let U=0;U<w.length;U++)w[U].length<=A||(j_(w[U],A,1,w[U].length-1,bp),w[U]=w[U].slice(0,A));return w}function bp(d,A){return A.area-d.area}function ul(d,A,m){const w=m.patternDependencies;let D=!1;for(const N of A){const U=N.paint.get(`${d}-pattern`);U.isConstant()||(D=!0);const X=U.constantOr(null);X&&(D=!0,w[X.to]=!0,w[X.from]=!0)}return D}function Wu(d,A,m,w,D){const N=D.patternDependencies;for(const U of A){const X=U.paint.get(`${d}-pattern`).value;if(X.kind!=="constant"){let ee=X.evaluate({zoom:w-1},m,{},D.availableImages),ae=X.evaluate({zoom:w},m,{},D.availableImages),de=X.evaluate({zoom:w+1},m,{},D.availableImages);ee=ee&&ee.name?ee.name:ee,ae=ae&&ae.name?ae.name:ae,de=de&&de.name?de.name:de,N[ee]=!0,N[ae]=!0,N[de]=!0,m.patterns[U.id]={min:ee,mid:ae,max:de}}}return m}class Dc{constructor(A){this.zoom=A.zoom,this.overscaling=A.overscaling,this.layers=A.layers,this.layerIds=this.layers.map(m=>m.id),this.index=A.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ai,this.indexArray=new Nr,this.indexArray2=new Yi,this.programConfigurations=new xA(A.layers,A.zoom),this.segments=new Kn,this.segments2=new Kn,this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id)}populate(A,m,w){this.hasPattern=ul("fill",this.layers,m);const D=this.layers[0].layout.get("fill-sort-key"),N=!D.isConstant(),U=[];for(const{feature:X,id:ee,index:ae,sourceLayerIndex:de}of A){const ge=this.layers[0]._featureFilter.needGeometry,Ee=eu(X,ge);if(!this.layers[0]._featureFilter.filter(new Gn(this.zoom),Ee,w))continue;const Oe=N?D.evaluate(Ee,{},w,m.availableImages):void 0,ce={id:ee,properties:X.properties,type:X.type,sourceLayerIndex:de,index:ae,geometry:ge?Ee.geometry:wu(X),patterns:{},sortKey:Oe};U.push(ce)}N&&U.sort((X,ee)=>X.sortKey-ee.sortKey);for(const X of U){const{geometry:ee,index:ae,sourceLayerIndex:de}=X;if(this.hasPattern){const ge=Wu("fill",this.layers,X,this.zoom,m);this.patternFeatures.push(ge)}else this.addFeature(X,ee,ae,w,{});m.featureIndex.insert(A[ae].feature,ee,ae,de,this.index)}}update(A,m,w){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(A,m,this.stateDependentLayers,w)}addFeatures(A,m,w){for(const D of this.patternFeatures)this.addFeature(D,D.geometry,D.index,m,w)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(A){this.uploaded||(this.layoutVertexBuffer=A.createVertexBuffer(this.layoutVertexArray,Bf),this.indexBuffer=A.createIndexBuffer(this.indexArray),this.indexBuffer2=A.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(A),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(A,m,w,D,N){for(const U of un(m,500)){let X=0;for(const Oe of U)X+=Oe.length;const ee=this.segments.prepareSegment(X,this.layoutVertexArray,this.indexArray),ae=ee.vertexLength,de=[],ge=[];for(const Oe of U){if(Oe.length===0)continue;Oe!==U[0]&&ge.push(de.length/2);const ce=this.segments2.prepareSegment(Oe.length,this.layoutVertexArray,this.indexArray2),et=ce.vertexLength;this.layoutVertexArray.emplaceBack(Oe[0].x,Oe[0].y),this.indexArray2.emplaceBack(et+Oe.length-1,et),de.push(Oe[0].x),de.push(Oe[0].y);for(let ot=1;ot<Oe.length;ot++)this.layoutVertexArray.emplaceBack(Oe[ot].x,Oe[ot].y),this.indexArray2.emplaceBack(et+ot-1,et+ot),de.push(Oe[ot].x),de.push(Oe[ot].y);ce.vertexLength+=Oe.length,ce.primitiveLength+=Oe.length}const Ee=jl(de,ge);for(let Oe=0;Oe<Ee.length;Oe+=3)this.indexArray.emplaceBack(ae+Ee[Oe],ae+Ee[Oe+1],ae+Ee[Oe+2]);ee.vertexLength+=X,ee.primitiveLength+=Ee.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,A,w,N,D)}}let yd,xd;Vi("FillBucket",Dc,{omit:["layers","patternFeatures"]});var Pc={get paint(){return xd=xd||new tn({"fill-antialias":new Vt(Pe.paint_fill["fill-antialias"]),"fill-opacity":new Jt(Pe.paint_fill["fill-opacity"]),"fill-color":new Jt(Pe.paint_fill["fill-color"]),"fill-outline-color":new Jt(Pe.paint_fill["fill-outline-color"]),"fill-translate":new Vt(Pe.paint_fill["fill-translate"]),"fill-translate-anchor":new Vt(Pe.paint_fill["fill-translate-anchor"]),"fill-pattern":new sA(Pe.paint_fill["fill-pattern"])})},get layout(){return yd=yd||new tn({"fill-sort-key":new Jt(Pe.layout_fill["fill-sort-key"])})}};class ou extends Zn{constructor(A){super(A,Pc)}recalculate(A,m){super.recalculate(A,m);const w=this.paint._values["fill-outline-color"];w.value.kind==="constant"&&w.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(A){return new Dc(A)}queryRadius(){return pd(this.paint.get("fill-translate"))}queryIntersectsFeature(A,m,w,D,N,U,X){return Ef(Zu(A,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),U.angle,X),D)}isTileClipped(){return!0}}const vd=L([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),bd=L([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Vf}=vd;var uc={},Nf=Xt,zc=au;function au(d,A,m,w,D){this.properties={},this.extent=m,this.type=0,this._pbf=d,this._geometry=-1,this._keys=w,this._values=D,d.readFields(wd,this,A)}function wd(d,A,m){d==1?A.id=m.readVarint():d==2?function(w,D){for(var N=w.readVarint()+w.pos;w.pos<N;){var U=D._keys[w.readVarint()],X=D._values[w.readVarint()];D.properties[U]=X}}(m,A):d==3?A.type=m.readVarint():d==4&&(A._geometry=m.pos)}function Uf(d){for(var A,m,w=0,D=0,N=d.length,U=N-1;D<N;U=D++)w+=((m=d[U]).x-(A=d[D]).x)*(A.y+m.y);return w}au.types=["Unknown","Point","LineString","Polygon"],au.prototype.loadGeometry=function(){var d=this._pbf;d.pos=this._geometry;for(var A,m=d.readVarint()+d.pos,w=1,D=0,N=0,U=0,X=[];d.pos<m;){if(D<=0){var ee=d.readVarint();w=7&ee,D=ee>>3}if(D--,w===1||w===2)N+=d.readSVarint(),U+=d.readSVarint(),w===1&&(A&&X.push(A),A=[]),A.push(new Nf(N,U));else{if(w!==7)throw new Error("unknown command "+w);A&&A.push(A[0].clone())}}return A&&X.push(A),X},au.prototype.bbox=function(){var d=this._pbf;d.pos=this._geometry;for(var A=d.readVarint()+d.pos,m=1,w=0,D=0,N=0,U=1/0,X=-1/0,ee=1/0,ae=-1/0;d.pos<A;){if(w<=0){var de=d.readVarint();m=7&de,w=de>>3}if(w--,m===1||m===2)(D+=d.readSVarint())<U&&(U=D),D>X&&(X=D),(N+=d.readSVarint())<ee&&(ee=N),N>ae&&(ae=N);else if(m!==7)throw new Error("unknown command "+m)}return[U,ee,X,ae]},au.prototype.toGeoJSON=function(d,A,m){var w,D,N=this.extent*Math.pow(2,m),U=this.extent*d,X=this.extent*A,ee=this.loadGeometry(),ae=au.types[this.type];function de(Oe){for(var ce=0;ce<Oe.length;ce++){var et=Oe[ce];Oe[ce]=[360*(et.x+U)/N-180,360/Math.PI*Math.atan(Math.exp((180-360*(et.y+X)/N)*Math.PI/180))-90]}}switch(this.type){case 1:var ge=[];for(w=0;w<ee.length;w++)ge[w]=ee[w][0];de(ee=ge);break;case 2:for(w=0;w<ee.length;w++)de(ee[w]);break;case 3:for(ee=function(Oe){var ce=Oe.length;if(ce<=1)return[Oe];for(var et,ot,pt=[],Ct=0;Ct<ce;Ct++){var bt=Uf(Oe[Ct]);bt!==0&&(ot===void 0&&(ot=bt<0),ot===bt<0?(et&&pt.push(et),et=[Oe[Ct]]):et.push(Oe[Ct]))}return et&&pt.push(et),pt}(ee),w=0;w<ee.length;w++)for(D=0;D<ee[w].length;D++)de(ee[w][D])}ee.length===1?ee=ee[0]:ae="Multi"+ae;var Ee={type:"Feature",geometry:{type:ae,coordinates:ee},properties:this.properties};return"id"in this&&(Ee.id=this.id),Ee};var jf=zc,Ys=Td;function Td(d,A){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=d,this._keys=[],this._values=[],this._features=[],d.readFields(Gf,this,A),this.length=this._features.length}function Gf(d,A,m){d===15?A.version=m.readVarint():d===1?A.name=m.readString():d===5?A.extent=m.readVarint():d===2?A._features.push(m.pos):d===3?A._keys.push(m.readString()):d===4&&A._values.push(function(w){for(var D=null,N=w.readVarint()+w.pos;w.pos<N;){var U=w.readVarint()>>3;D=U===1?w.readString():U===2?w.readFloat():U===3?w.readDouble():U===4?w.readVarint64():U===5?w.readVarint():U===6?w.readSVarint():U===7?w.readBoolean():null}return D}(m))}Td.prototype.feature=function(d){if(d<0||d>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[d];var A=this._pbf.readVarint()+this._pbf.pos;return new jf(this._pbf,A,this.extent,this._keys,this._values)};var kh=Ys;function Cu(d,A,m){if(d===3){var w=new kh(m,m.readVarint()+m.pos);w.length&&(A[w.name]=w)}}uc.VectorTile=function(d,A){this.layers=d.readFields(Cu,{},A)},uc.VectorTileFeature=zc,uc.VectorTileLayer=Ys;const Zf=uc.VectorTileFeature.types,Dh=Math.pow(2,13);function Bc(d,A,m,w,D,N,U,X){d.emplaceBack(A,m,2*Math.floor(w*Dh)+U,D*Dh*2,N*Dh*2,Math.round(X))}class Lc{constructor(A){this.zoom=A.zoom,this.overscaling=A.overscaling,this.layers=A.layers,this.layerIds=this.layers.map(m=>m.id),this.index=A.index,this.hasPattern=!1,this.layoutVertexArray=new Nt,this.centroidVertexArray=new ht,this.indexArray=new Nr,this.programConfigurations=new xA(A.layers,A.zoom),this.segments=new Kn,this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id)}populate(A,m,w){this.features=[],this.hasPattern=ul("fill-extrusion",this.layers,m);for(const{feature:D,id:N,index:U,sourceLayerIndex:X}of A){const ee=this.layers[0]._featureFilter.needGeometry,ae=eu(D,ee);if(!this.layers[0]._featureFilter.filter(new Gn(this.zoom),ae,w))continue;const de={id:N,sourceLayerIndex:X,index:U,geometry:ee?ae.geometry:wu(D),properties:D.properties,type:D.type,patterns:{}};this.hasPattern?this.features.push(Wu("fill-extrusion",this.layers,de,this.zoom,m)):this.addFeature(de,de.geometry,U,w,{}),m.featureIndex.insert(D,de.geometry,U,X,this.index,!0)}}addFeatures(A,m,w){for(const D of this.features){const{geometry:N}=D;this.addFeature(D,N,D.index,m,w)}}update(A,m,w){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(A,m,this.stateDependentLayers,w)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(A){this.uploaded||(this.layoutVertexBuffer=A.createVertexBuffer(this.layoutVertexArray,Vf),this.centroidVertexBuffer=A.createVertexBuffer(this.centroidVertexArray,bd.members,!0),this.indexBuffer=A.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(A),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(A,m,w,D,N){const U={x:0,y:0,vertexCount:0};for(const X of un(m,500)){let ee=0;for(const ce of X)ee+=ce.length;let ae=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const ce of X){if(ce.length===0||qf(ce))continue;let et=0;for(let ot=0;ot<ce.length;ot++){const pt=ce[ot];if(ot>=1){const Ct=ce[ot-1];if(!Ph(pt,Ct)){ae.vertexLength+4>Kn.MAX_VERTEX_ARRAY_LENGTH&&(ae=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const bt=pt.sub(Ct)._perp()._unit(),_e=Ct.dist(pt);et+_e>32768&&(et=0),Bc(this.layoutVertexArray,pt.x,pt.y,bt.x,bt.y,0,0,et),Bc(this.layoutVertexArray,pt.x,pt.y,bt.x,bt.y,0,1,et),U.x+=2*pt.x,U.y+=2*pt.y,U.vertexCount+=2,et+=_e,Bc(this.layoutVertexArray,Ct.x,Ct.y,bt.x,bt.y,0,0,et),Bc(this.layoutVertexArray,Ct.x,Ct.y,bt.x,bt.y,0,1,et),U.x+=2*Ct.x,U.y+=2*Ct.y,U.vertexCount+=2;const Ut=ae.vertexLength;this.indexArray.emplaceBack(Ut,Ut+2,Ut+1),this.indexArray.emplaceBack(Ut+1,Ut+2,Ut+3),ae.vertexLength+=4,ae.primitiveLength+=2}}}}if(ae.vertexLength+ee>Kn.MAX_VERTEX_ARRAY_LENGTH&&(ae=this.segments.prepareSegment(ee,this.layoutVertexArray,this.indexArray)),Zf[A.type]!=="Polygon")continue;const de=[],ge=[],Ee=ae.vertexLength;for(const ce of X)if(ce.length!==0){ce!==X[0]&&ge.push(de.length/2);for(let et=0;et<ce.length;et++){const ot=ce[et];Bc(this.layoutVertexArray,ot.x,ot.y,0,0,1,1,0),U.x+=ot.x,U.y+=ot.y,U.vertexCount+=1,de.push(ot.x),de.push(ot.y)}}const Oe=jl(de,ge);for(let ce=0;ce<Oe.length;ce+=3)this.indexArray.emplaceBack(Ee+Oe[ce],Ee+Oe[ce+2],Ee+Oe[ce+1]);ae.primitiveLength+=Oe.length/3,ae.vertexLength+=ee}for(let X=0;X<U.vertexCount;X++)this.centroidVertexArray.emplaceBack(Math.floor(U.x/U.vertexCount),Math.floor(U.y/U.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,A,w,N,D)}}function Ph(d,A){return d.x===A.x&&(d.x<0||d.x>zs)||d.y===A.y&&(d.y<0||d.y>zs)}function qf(d){return d.every(A=>A.x<0)||d.every(A=>A.x>zs)||d.every(A=>A.y<0)||d.every(A=>A.y>zs)}let zh;Vi("FillExtrusionBucket",Lc,{omit:["layers","features"]});var Qf={get paint(){return zh=zh||new tn({"fill-extrusion-opacity":new Vt(Pe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Jt(Pe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Vt(Pe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Vt(Pe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new sA(Pe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Jt(Pe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Jt(Pe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Vt(Pe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class wp extends Zn{constructor(A){super(A,Qf)}createBucket(A){return new Lc(A)}queryRadius(){return pd(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(A,m,w,D,N,U,X,ee){const ae=Zu(A,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),U.angle,X),de=this.paint.get("fill-extrusion-height").evaluate(m,w),ge=this.paint.get("fill-extrusion-base").evaluate(m,w),Ee=function(ce,et,ot,pt){const Ct=[];for(const bt of ce){const _e=[bt.x,bt.y,0,1];Tu(_e,_e,et),Ct.push(new yt(_e[0]/_e[3],_e[1]/_e[3]))}return Ct}(ae,ee),Oe=function(ce,et,ot,pt){const Ct=[],bt=[],_e=pt[8]*et,Ut=pt[9]*et,li=pt[10]*et,Ci=pt[11]*et,nr=pt[8]*ot,Ri=pt[9]*ot,Pi=pt[10]*ot,wi=pt[11]*ot;for(const Wi of ce){const ki=[],ci=[];for(const fr of Wi){const fi=fr.x,Wr=fr.y,vs=pt[0]*fi+pt[4]*Wr+pt[12],ps=pt[1]*fi+pt[5]*Wr+pt[13],yo=pt[2]*fi+pt[6]*Wr+pt[14],Ca=pt[3]*fi+pt[7]*Wr+pt[15],$a=yo+li,xo=Ca+Ci,Ko=vs+nr,Gs=ps+Ri,$r=yo+Pi,Jo=Ca+wi,Cs=new yt((vs+_e)/xo,(ps+Ut)/xo);Cs.z=$a/xo,ki.push(Cs);const Fn=new yt(Ko/Jo,Gs/Jo);Fn.z=$r/Jo,ci.push(Fn)}Ct.push(ki),bt.push(ci)}return[Ct,bt]}(D,ge,de,ee);return function(ce,et,ot){let pt=1/0;Ef(ot,et)&&(pt=Hf(ot,et[0]));for(let Ct=0;Ct<et.length;Ct++){const bt=et[Ct],_e=ce[Ct];for(let Ut=0;Ut<bt.length-1;Ut++){const li=bt[Ut],Ci=[li,bt[Ut+1],_e[Ut+1],_e[Ut],li];Tf(ot,Ci)&&(pt=Math.min(pt,Hf(ot,Ci)))}}return pt!==1/0&&pt}(Oe[0],Oe[1],Ee)}}function ku(d,A){return d.x*A.x+d.y*A.y}function Hf(d,A){if(d.length===1){let m=0;const w=A[m++];let D;for(;!D||w.equals(D);)if(D=A[m++],!D)return 1/0;for(;m<A.length;m++){const N=A[m],U=d[0],X=D.sub(w),ee=N.sub(w),ae=U.sub(w),de=ku(X,X),ge=ku(X,ee),Ee=ku(ee,ee),Oe=ku(ae,X),ce=ku(ae,ee),et=de*Ee-ge*ge,ot=(Ee*Oe-ge*ce)/et,pt=(de*ce-ge*Oe)/et,Ct=w.z*(1-ot-pt)+D.z*ot+N.z*pt;if(isFinite(Ct))return Ct}return 1/0}{let m=1/0;for(const w of A)m=Math.min(m,w.z);return m}}const Tp=L([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Ep}=Tp,Mp=L([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Sp}=Mp,Ip=uc.VectorTileFeature.types,Cp=Math.cos(Math.PI/180*37.5),Wf=Math.pow(2,14)/.5;class Ed{constructor(A){this.zoom=A.zoom,this.overscaling=A.overscaling,this.layers=A.layers,this.layerIds=this.layers.map(m=>m.id),this.index=A.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(m=>{this.gradients[m.id]={}}),this.layoutVertexArray=new Wt,this.layoutVertexArray2=new Gt,this.indexArray=new Nr,this.programConfigurations=new xA(A.layers,A.zoom),this.segments=new Kn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id)}populate(A,m,w){this.hasPattern=ul("line",this.layers,m);const D=this.layers[0].layout.get("line-sort-key"),N=!D.isConstant(),U=[];for(const{feature:X,id:ee,index:ae,sourceLayerIndex:de}of A){const ge=this.layers[0]._featureFilter.needGeometry,Ee=eu(X,ge);if(!this.layers[0]._featureFilter.filter(new Gn(this.zoom),Ee,w))continue;const Oe=N?D.evaluate(Ee,{},w):void 0,ce={id:ee,properties:X.properties,type:X.type,sourceLayerIndex:de,index:ae,geometry:ge?Ee.geometry:wu(X),patterns:{},sortKey:Oe};U.push(ce)}N&&U.sort((X,ee)=>X.sortKey-ee.sortKey);for(const X of U){const{geometry:ee,index:ae,sourceLayerIndex:de}=X;if(this.hasPattern){const ge=Wu("line",this.layers,X,this.zoom,m);this.patternFeatures.push(ge)}else this.addFeature(X,ee,ae,w,{});m.featureIndex.insert(A[ae].feature,ee,ae,de,this.index)}}update(A,m,w){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(A,m,this.stateDependentLayers,w)}addFeatures(A,m,w){for(const D of this.patternFeatures)this.addFeature(D,D.geometry,D.index,m,w)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(A){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=A.createVertexBuffer(this.layoutVertexArray2,Sp)),this.layoutVertexBuffer=A.createVertexBuffer(this.layoutVertexArray,Ep),this.indexBuffer=A.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(A),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(A){if(A.properties&&Object.prototype.hasOwnProperty.call(A.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(A.properties,"mapbox_clip_end"))return{start:+A.properties.mapbox_clip_start,end:+A.properties.mapbox_clip_end}}addFeature(A,m,w,D,N){const U=this.layers[0].layout,X=U.get("line-join").evaluate(A,{}),ee=U.get("line-cap"),ae=U.get("line-miter-limit"),de=U.get("line-round-limit");this.lineClips=this.lineFeatureClips(A);for(const ge of m)this.addLine(ge,A,X,ee,ae,de);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,A,w,N,D)}addLine(A,m,w,D,N,U){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let pt=0;pt<A.length-1;pt++)this.totalDistance+=A[pt].dist(A[pt+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const X=Ip[m.type]==="Polygon";let ee=A.length;for(;ee>=2&&A[ee-1].equals(A[ee-2]);)ee--;let ae=0;for(;ae<ee-1&&A[ae].equals(A[ae+1]);)ae++;if(ee<(X?3:2))return;w==="bevel"&&(N=1.05);const de=this.overscaling<=16?15*zs/(512*this.overscaling):0,ge=this.segments.prepareSegment(10*ee,this.layoutVertexArray,this.indexArray);let Ee,Oe,ce,et,ot;this.e1=this.e2=-1,X&&(Ee=A[ee-2],ot=A[ae].sub(Ee)._unit()._perp());for(let pt=ae;pt<ee;pt++){if(ce=pt===ee-1?X?A[ae+1]:void 0:A[pt+1],ce&&A[pt].equals(ce))continue;ot&&(et=ot),Ee&&(Oe=Ee),Ee=A[pt],ot=ce?ce.sub(Ee)._unit()._perp():et,et=et||ot;let Ct=et.add(ot);Ct.x===0&&Ct.y===0||Ct._unit();const bt=et.x*ot.x+et.y*ot.y,_e=Ct.x*ot.x+Ct.y*ot.y,Ut=_e!==0?1/_e:1/0,li=2*Math.sqrt(2-2*_e),Ci=_e<Cp&&Oe&&ce,nr=et.x*ot.y-et.y*ot.x>0;if(Ci&&pt>ae){const wi=Ee.dist(Oe);if(wi>2*de){const Wi=Ee.sub(Ee.sub(Oe)._mult(de/wi)._round());this.updateDistance(Oe,Wi),this.addCurrentVertex(Wi,et,0,0,ge),Oe=Wi}}const Ri=Oe&&ce;let Pi=Ri?w:X?"butt":D;if(Ri&&Pi==="round"&&(Ut<U?Pi="miter":Ut<=2&&(Pi="fakeround")),Pi==="miter"&&Ut>N&&(Pi="bevel"),Pi==="bevel"&&(Ut>2&&(Pi="flipbevel"),Ut<N&&(Pi="miter")),Oe&&this.updateDistance(Oe,Ee),Pi==="miter")Ct._mult(Ut),this.addCurrentVertex(Ee,Ct,0,0,ge);else if(Pi==="flipbevel"){if(Ut>100)Ct=ot.mult(-1);else{const wi=Ut*et.add(ot).mag()/et.sub(ot).mag();Ct._perp()._mult(wi*(nr?-1:1))}this.addCurrentVertex(Ee,Ct,0,0,ge),this.addCurrentVertex(Ee,Ct.mult(-1),0,0,ge)}else if(Pi==="bevel"||Pi==="fakeround"){const wi=-Math.sqrt(Ut*Ut-1),Wi=nr?wi:0,ki=nr?0:wi;if(Oe&&this.addCurrentVertex(Ee,et,Wi,ki,ge),Pi==="fakeround"){const ci=Math.round(180*li/Math.PI/20);for(let fr=1;fr<ci;fr++){let fi=fr/ci;if(fi!==.5){const vs=fi-.5;fi+=fi*vs*(fi-1)*((1.0904+bt*(bt*(3.55645-1.43519*bt)-3.2452))*vs*vs+(.848013+bt*(.215638*bt-1.06021)))}const Wr=ot.sub(et)._mult(fi)._add(et)._unit()._mult(nr?-1:1);this.addHalfVertex(Ee,Wr.x,Wr.y,!1,nr,0,ge)}}ce&&this.addCurrentVertex(Ee,ot,-Wi,-ki,ge)}else if(Pi==="butt")this.addCurrentVertex(Ee,Ct,0,0,ge);else if(Pi==="square"){const wi=Oe?1:-1;this.addCurrentVertex(Ee,Ct,wi,wi,ge)}else Pi==="round"&&(Oe&&(this.addCurrentVertex(Ee,et,0,0,ge),this.addCurrentVertex(Ee,et,1,1,ge,!0)),ce&&(this.addCurrentVertex(Ee,ot,-1,-1,ge,!0),this.addCurrentVertex(Ee,ot,0,0,ge)));if(Ci&&pt<ee-1){const wi=Ee.dist(ce);if(wi>2*de){const Wi=Ee.add(ce.sub(Ee)._mult(de/wi)._round());this.updateDistance(Ee,Wi),this.addCurrentVertex(Wi,ot,0,0,ge),Ee=Wi}}}}addCurrentVertex(A,m,w,D,N,U=!1){const X=m.y*D-m.x,ee=-m.y-m.x*D;this.addHalfVertex(A,m.x+m.y*w,m.y-m.x*w,U,!1,w,N),this.addHalfVertex(A,X,ee,U,!0,-D,N),this.distance>Wf/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(A,m,w,D,N,U))}addHalfVertex({x:A,y:m},w,D,N,U,X,ee){const ae=.5*(this.lineClips?this.scaledDistance*(Wf-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((A<<1)+(N?1:0),(m<<1)+(U?1:0),Math.round(63*w)+128,Math.round(63*D)+128,1+(X===0?0:X<0?-1:1)|(63&ae)<<2,ae>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const de=ee.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,de),ee.primitiveLength++),U?this.e2=de:this.e1=de}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(A,m){this.distance+=A.dist(m),this.updateScaledDistance()}}let kp,Dp;Vi("LineBucket",Ed,{omit:["layers","patternFeatures"]});var wn={get paint(){return Dp=Dp||new tn({"line-opacity":new Jt(Pe.paint_line["line-opacity"]),"line-color":new Jt(Pe.paint_line["line-color"]),"line-translate":new Vt(Pe.paint_line["line-translate"]),"line-translate-anchor":new Vt(Pe.paint_line["line-translate-anchor"]),"line-width":new Jt(Pe.paint_line["line-width"]),"line-gap-width":new Jt(Pe.paint_line["line-gap-width"]),"line-offset":new Jt(Pe.paint_line["line-offset"]),"line-blur":new Jt(Pe.paint_line["line-blur"]),"line-dasharray":new vl(Pe.paint_line["line-dasharray"]),"line-pattern":new sA(Pe.paint_line["line-pattern"]),"line-gradient":new Vl(Pe.paint_line["line-gradient"])})},get layout(){return kp=kp||new tn({"line-cap":new Vt(Pe.layout_line["line-cap"]),"line-join":new Jt(Pe.layout_line["line-join"]),"line-miter-limit":new Vt(Pe.layout_line["line-miter-limit"]),"line-round-limit":new Vt(Pe.layout_line["line-round-limit"]),"line-sort-key":new Jt(Pe.layout_line["line-sort-key"])})}};class Pp extends Jt{possiblyEvaluate(A,m){return m=new Gn(Math.floor(m.zoom),{now:m.now,fadeDuration:m.fadeDuration,zoomHistory:m.zoomHistory,transition:m.transition}),super.possiblyEvaluate(A,m)}evaluate(A,m,w,D){return m=rn({},m,{zoom:Math.floor(m.zoom)}),super.evaluate(A,m,w,D)}}let Md;class G_ extends Zn{constructor(A){super(A,wn),this.gradientVersion=0,Md||(Md=new Pp(wn.paint.properties["line-width"].specification),Md.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(A){if(A==="line-gradient"){const m=this.gradientExpression();this.stepInterpolant=!!function(w){return w._styleExpression!==void 0}(m)&&m._styleExpression.expression instanceof $n,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(A,m){super.recalculate(A,m),this.paint._values["line-floorwidth"]=Md.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,A)}createBucket(A){return new Ed(A)}queryRadius(A){const m=A,w=Bh(Mh("line-width",this,m),Mh("line-gap-width",this,m)),D=Mh("line-offset",this,m);return w/2+Math.abs(D)+pd(this.paint.get("line-translate"))}queryIntersectsFeature(A,m,w,D,N,U,X){const ee=Zu(A,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),U.angle,X),ae=X/2*Bh(this.paint.get("line-width").evaluate(m,w),this.paint.get("line-gap-width").evaluate(m,w)),de=this.paint.get("line-offset").evaluate(m,w);return de&&(D=function(ge,Ee){const Oe=[];for(let ce=0;ce<ge.length;ce++){const et=ge[ce],ot=[];for(let pt=0;pt<et.length;pt++){const Ct=et[pt-1],bt=et[pt],_e=et[pt+1],Ut=pt===0?new yt(0,0):bt.sub(Ct)._unit()._perp(),li=pt===et.length-1?new yt(0,0):_e.sub(bt)._unit()._perp(),Ci=Ut._add(li)._unit(),nr=Ci.x*li.x+Ci.y*li.y;nr!==0&&Ci._mult(1/nr),ot.push(Ci._mult(Ee)._add(bt))}Oe.push(ot)}return Oe}(D,de*X)),function(ge,Ee,Oe){for(let ce=0;ce<Ee.length;ce++){const et=Ee[ce];if(ge.length>=3){for(let ot=0;ot<et.length;ot++)if(Gu(ge,et[ot]))return!0}if(ca(ge,et,Oe))return!0}return!1}(ee,D,ae)}isTileClipped(){return!0}}function Bh(d,A){return A>0?A+2*d:d}const zp=L([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Z_=L([{name:"a_projected_pos",components:3,type:"Float32"}],4);L([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Bp=L([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);L([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const $f=L([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),q_=L([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Xf(d,A,m){return d.sections.forEach(w=>{w.text=function(D,N,U){const X=N.layout.get("text-transform").evaluate(U,{});return X==="uppercase"?D=D.toLocaleUpperCase():X==="lowercase"&&(D=D.toLocaleLowerCase()),aa.applyArabicShaping&&(D=aa.applyArabicShaping(D)),D}(w.text,A,m)}),d}L([{name:"triangle",components:3,type:"Uint16"}]),L([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),L([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),L([{type:"Float32",name:"offsetX"}]),L([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),L([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Rc={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var Eo=24,Sd=Ni,Lh=function(d,A,m,w,D){var N,U,X=8*D-w-1,ee=(1<<X)-1,ae=ee>>1,de=-7,ge=m?D-1:0,Ee=m?-1:1,Oe=d[A+ge];for(ge+=Ee,N=Oe&(1<<-de)-1,Oe>>=-de,de+=X;de>0;N=256*N+d[A+ge],ge+=Ee,de-=8);for(U=N&(1<<-de)-1,N>>=-de,de+=w;de>0;U=256*U+d[A+ge],ge+=Ee,de-=8);if(N===0)N=1-ae;else{if(N===ee)return U?NaN:1/0*(Oe?-1:1);U+=Math.pow(2,w),N-=ae}return(Oe?-1:1)*U*Math.pow(2,N-w)},hc=function(d,A,m,w,D,N){var U,X,ee,ae=8*N-D-1,de=(1<<ae)-1,ge=de>>1,Ee=D===23?Math.pow(2,-24)-Math.pow(2,-77):0,Oe=w?0:N-1,ce=w?1:-1,et=A<0||A===0&&1/A<0?1:0;for(A=Math.abs(A),isNaN(A)||A===1/0?(X=isNaN(A)?1:0,U=de):(U=Math.floor(Math.log(A)/Math.LN2),A*(ee=Math.pow(2,-U))<1&&(U--,ee*=2),(A+=U+ge>=1?Ee/ee:Ee*Math.pow(2,1-ge))*ee>=2&&(U++,ee/=2),U+ge>=de?(X=0,U=de):U+ge>=1?(X=(A*ee-1)*Math.pow(2,D),U+=ge):(X=A*Math.pow(2,ge-1)*Math.pow(2,D),U=0));D>=8;d[m+Oe]=255&X,Oe+=ce,X/=256,D-=8);for(U=U<<D|X,ae+=D;ae>0;d[m+Oe]=255&U,Oe+=ce,U/=256,ae-=8);d[m+Oe-ce]|=128*et};function Ni(d){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(d)?d:new Uint8Array(d||0),this.pos=0,this.type=0,this.length=this.buf.length}Ni.Varint=0,Ni.Fixed64=1,Ni.Bytes=2,Ni.Fixed32=5;var ii=4294967296,zr=1/ii,Tr=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Mo(d){return d.type===Ni.Bytes?d.readVarint()+d.pos:d.pos+1}function jA(d,A,m){return m?4294967296*A+(d>>>0):4294967296*(A>>>0)+(d>>>0)}function Lp(d,A,m){var w=A<=16383?1:A<=2097151?2:A<=268435455?3:Math.floor(Math.log(A)/(7*Math.LN2));m.realloc(w);for(var D=m.pos-1;D>=d;D--)m.buf[D+w]=m.buf[D]}function xr(d,A){for(var m=0;m<d.length;m++)A.writeVarint(d[m])}function Q_(d,A){for(var m=0;m<d.length;m++)A.writeSVarint(d[m])}function Yf(d,A){for(var m=0;m<d.length;m++)A.writeFloat(d[m])}function H_(d,A){for(var m=0;m<d.length;m++)A.writeDouble(d[m])}function Kf(d,A){for(var m=0;m<d.length;m++)A.writeBoolean(d[m])}function Jf(d,A){for(var m=0;m<d.length;m++)A.writeFixed32(d[m])}function Rh(d,A){for(var m=0;m<d.length;m++)A.writeSFixed32(d[m])}function $u(d,A){for(var m=0;m<d.length;m++)A.writeFixed64(d[m])}function Fc(d,A){for(var m=0;m<d.length;m++)A.writeSFixed64(d[m])}function Gl(d,A){return(d[A]|d[A+1]<<8|d[A+2]<<16)+16777216*d[A+3]}function lA(d,A,m){d[m]=A,d[m+1]=A>>>8,d[m+2]=A>>>16,d[m+3]=A>>>24}function lu(d,A){return(d[A]|d[A+1]<<8|d[A+2]<<16)+(d[A+3]<<24)}Ni.prototype={destroy:function(){this.buf=null},readFields:function(d,A,m){for(m=m||this.length;this.pos<m;){var w=this.readVarint(),D=w>>3,N=this.pos;this.type=7&w,d(D,A,this),this.pos===N&&this.skip(w)}return A},readMessage:function(d,A){return this.readFields(d,A,this.readVarint()+this.pos)},readFixed32:function(){var d=Gl(this.buf,this.pos);return this.pos+=4,d},readSFixed32:function(){var d=lu(this.buf,this.pos);return this.pos+=4,d},readFixed64:function(){var d=Gl(this.buf,this.pos)+Gl(this.buf,this.pos+4)*ii;return this.pos+=8,d},readSFixed64:function(){var d=Gl(this.buf,this.pos)+lu(this.buf,this.pos+4)*ii;return this.pos+=8,d},readFloat:function(){var d=Lh(this.buf,this.pos,!0,23,4);return this.pos+=4,d},readDouble:function(){var d=Lh(this.buf,this.pos,!0,52,8);return this.pos+=8,d},readVarint:function(d){var A,m,w=this.buf;return A=127&(m=w[this.pos++]),m<128?A:(A|=(127&(m=w[this.pos++]))<<7,m<128?A:(A|=(127&(m=w[this.pos++]))<<14,m<128?A:(A|=(127&(m=w[this.pos++]))<<21,m<128?A:function(D,N,U){var X,ee,ae=U.buf;if(X=(112&(ee=ae[U.pos++]))>>4,ee<128||(X|=(127&(ee=ae[U.pos++]))<<3,ee<128)||(X|=(127&(ee=ae[U.pos++]))<<10,ee<128)||(X|=(127&(ee=ae[U.pos++]))<<17,ee<128)||(X|=(127&(ee=ae[U.pos++]))<<24,ee<128)||(X|=(1&(ee=ae[U.pos++]))<<31,ee<128))return jA(D,X,N);throw new Error("Expected varint not more than 10 bytes")}(A|=(15&(m=w[this.pos]))<<28,d,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var d=this.readVarint();return d%2==1?(d+1)/-2:d/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var d=this.readVarint()+this.pos,A=this.pos;return this.pos=d,d-A>=12&&Tr?function(m,w,D){return Tr.decode(m.subarray(w,D))}(this.buf,A,d):function(m,w,D){for(var N="",U=w;U<D;){var X,ee,ae,de=m[U],ge=null,Ee=de>239?4:de>223?3:de>191?2:1;if(U+Ee>D)break;Ee===1?de<128&&(ge=de):Ee===2?(192&(X=m[U+1]))==128&&(ge=(31&de)<<6|63&X)<=127&&(ge=null):Ee===3?(ee=m[U+2],(192&(X=m[U+1]))==128&&(192&ee)==128&&((ge=(15&de)<<12|(63&X)<<6|63&ee)<=2047||ge>=55296&&ge<=57343)&&(ge=null)):Ee===4&&(ee=m[U+2],ae=m[U+3],(192&(X=m[U+1]))==128&&(192&ee)==128&&(192&ae)==128&&((ge=(15&de)<<18|(63&X)<<12|(63&ee)<<6|63&ae)<=65535||ge>=1114112)&&(ge=null)),ge===null?(ge=65533,Ee=1):ge>65535&&(ge-=65536,N+=String.fromCharCode(ge>>>10&1023|55296),ge=56320|1023&ge),N+=String.fromCharCode(ge),U+=Ee}return N}(this.buf,A,d)},readBytes:function(){var d=this.readVarint()+this.pos,A=this.buf.subarray(this.pos,d);return this.pos=d,A},readPackedVarint:function(d,A){if(this.type!==Ni.Bytes)return d.push(this.readVarint(A));var m=Mo(this);for(d=d||[];this.pos<m;)d.push(this.readVarint(A));return d},readPackedSVarint:function(d){if(this.type!==Ni.Bytes)return d.push(this.readSVarint());var A=Mo(this);for(d=d||[];this.pos<A;)d.push(this.readSVarint());return d},readPackedBoolean:function(d){if(this.type!==Ni.Bytes)return d.push(this.readBoolean());var A=Mo(this);for(d=d||[];this.pos<A;)d.push(this.readBoolean());return d},readPackedFloat:function(d){if(this.type!==Ni.Bytes)return d.push(this.readFloat());var A=Mo(this);for(d=d||[];this.pos<A;)d.push(this.readFloat());return d},readPackedDouble:function(d){if(this.type!==Ni.Bytes)return d.push(this.readDouble());var A=Mo(this);for(d=d||[];this.pos<A;)d.push(this.readDouble());return d},readPackedFixed32:function(d){if(this.type!==Ni.Bytes)return d.push(this.readFixed32());var A=Mo(this);for(d=d||[];this.pos<A;)d.push(this.readFixed32());return d},readPackedSFixed32:function(d){if(this.type!==Ni.Bytes)return d.push(this.readSFixed32());var A=Mo(this);for(d=d||[];this.pos<A;)d.push(this.readSFixed32());return d},readPackedFixed64:function(d){if(this.type!==Ni.Bytes)return d.push(this.readFixed64());var A=Mo(this);for(d=d||[];this.pos<A;)d.push(this.readFixed64());return d},readPackedSFixed64:function(d){if(this.type!==Ni.Bytes)return d.push(this.readSFixed64());var A=Mo(this);for(d=d||[];this.pos<A;)d.push(this.readSFixed64());return d},skip:function(d){var A=7&d;if(A===Ni.Varint)for(;this.buf[this.pos++]>127;);else if(A===Ni.Bytes)this.pos=this.readVarint()+this.pos;else if(A===Ni.Fixed32)this.pos+=4;else{if(A!==Ni.Fixed64)throw new Error("Unimplemented type: "+A);this.pos+=8}},writeTag:function(d,A){this.writeVarint(d<<3|A)},realloc:function(d){for(var A=this.length||16;A<this.pos+d;)A*=2;if(A!==this.length){var m=new Uint8Array(A);m.set(this.buf),this.buf=m,this.length=A}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(d){this.realloc(4),lA(this.buf,d,this.pos),this.pos+=4},writeSFixed32:function(d){this.realloc(4),lA(this.buf,d,this.pos),this.pos+=4},writeFixed64:function(d){this.realloc(8),lA(this.buf,-1&d,this.pos),lA(this.buf,Math.floor(d*zr),this.pos+4),this.pos+=8},writeSFixed64:function(d){this.realloc(8),lA(this.buf,-1&d,this.pos),lA(this.buf,Math.floor(d*zr),this.pos+4),this.pos+=8},writeVarint:function(d){(d=+d||0)>268435455||d<0?function(A,m){var w,D;if(A>=0?(w=A%4294967296|0,D=A/4294967296|0):(D=~(-A/4294967296),4294967295^(w=~(-A%4294967296))?w=w+1|0:(w=0,D=D+1|0)),A>=18446744073709552e3||A<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");m.realloc(10),function(N,U,X){X.buf[X.pos++]=127&N|128,N>>>=7,X.buf[X.pos++]=127&N|128,N>>>=7,X.buf[X.pos++]=127&N|128,N>>>=7,X.buf[X.pos++]=127&N|128,X.buf[X.pos]=127&(N>>>=7)}(w,0,m),function(N,U){var X=(7&N)<<4;U.buf[U.pos++]|=X|((N>>>=3)?128:0),N&&(U.buf[U.pos++]=127&N|((N>>>=7)?128:0),N&&(U.buf[U.pos++]=127&N|((N>>>=7)?128:0),N&&(U.buf[U.pos++]=127&N|((N>>>=7)?128:0),N&&(U.buf[U.pos++]=127&N|((N>>>=7)?128:0),N&&(U.buf[U.pos++]=127&N)))))}(D,m)}(d,this):(this.realloc(4),this.buf[this.pos++]=127&d|(d>127?128:0),d<=127||(this.buf[this.pos++]=127&(d>>>=7)|(d>127?128:0),d<=127||(this.buf[this.pos++]=127&(d>>>=7)|(d>127?128:0),d<=127||(this.buf[this.pos++]=d>>>7&127))))},writeSVarint:function(d){this.writeVarint(d<0?2*-d-1:2*d)},writeBoolean:function(d){this.writeVarint(!!d)},writeString:function(d){d=String(d),this.realloc(4*d.length),this.pos++;var A=this.pos;this.pos=function(w,D,N){for(var U,X,ee=0;ee<D.length;ee++){if((U=D.charCodeAt(ee))>55295&&U<57344){if(!X){U>56319||ee+1===D.length?(w[N++]=239,w[N++]=191,w[N++]=189):X=U;continue}if(U<56320){w[N++]=239,w[N++]=191,w[N++]=189,X=U;continue}U=X-55296<<10|U-56320|65536,X=null}else X&&(w[N++]=239,w[N++]=191,w[N++]=189,X=null);U<128?w[N++]=U:(U<2048?w[N++]=U>>6|192:(U<65536?w[N++]=U>>12|224:(w[N++]=U>>18|240,w[N++]=U>>12&63|128),w[N++]=U>>6&63|128),w[N++]=63&U|128)}return N}(this.buf,d,this.pos);var m=this.pos-A;m>=128&&Lp(A,m,this),this.pos=A-1,this.writeVarint(m),this.pos+=m},writeFloat:function(d){this.realloc(4),hc(this.buf,d,this.pos,!0,23,4),this.pos+=4},writeDouble:function(d){this.realloc(8),hc(this.buf,d,this.pos,!0,52,8),this.pos+=8},writeBytes:function(d){var A=d.length;this.writeVarint(A),this.realloc(A);for(var m=0;m<A;m++)this.buf[this.pos++]=d[m]},writeRawMessage:function(d,A){this.pos++;var m=this.pos;d(A,this);var w=this.pos-m;w>=128&&Lp(m,w,this),this.pos=m-1,this.writeVarint(w),this.pos+=w},writeMessage:function(d,A,m){this.writeTag(d,Ni.Bytes),this.writeRawMessage(A,m)},writePackedVarint:function(d,A){A.length&&this.writeMessage(d,xr,A)},writePackedSVarint:function(d,A){A.length&&this.writeMessage(d,Q_,A)},writePackedBoolean:function(d,A){A.length&&this.writeMessage(d,Kf,A)},writePackedFloat:function(d,A){A.length&&this.writeMessage(d,Yf,A)},writePackedDouble:function(d,A){A.length&&this.writeMessage(d,H_,A)},writePackedFixed32:function(d,A){A.length&&this.writeMessage(d,Jf,A)},writePackedSFixed32:function(d,A){A.length&&this.writeMessage(d,Rh,A)},writePackedFixed64:function(d,A){A.length&&this.writeMessage(d,$u,A)},writePackedSFixed64:function(d,A){A.length&&this.writeMessage(d,Fc,A)},writeBytesField:function(d,A){this.writeTag(d,Ni.Bytes),this.writeBytes(A)},writeFixed32Field:function(d,A){this.writeTag(d,Ni.Fixed32),this.writeFixed32(A)},writeSFixed32Field:function(d,A){this.writeTag(d,Ni.Fixed32),this.writeSFixed32(A)},writeFixed64Field:function(d,A){this.writeTag(d,Ni.Fixed64),this.writeFixed64(A)},writeSFixed64Field:function(d,A){this.writeTag(d,Ni.Fixed64),this.writeSFixed64(A)},writeVarintField:function(d,A){this.writeTag(d,Ni.Varint),this.writeVarint(A)},writeSVarintField:function(d,A){this.writeTag(d,Ni.Varint),this.writeSVarint(A)},writeStringField:function(d,A){this.writeTag(d,Ni.Bytes),this.writeString(A)},writeFloatField:function(d,A){this.writeTag(d,Ni.Fixed32),this.writeFloat(A)},writeDoubleField:function(d,A){this.writeTag(d,Ni.Fixed64),this.writeDouble(A)},writeBooleanField:function(d,A){this.writeVarintField(d,!!A)}};var dc=me(Sd);const e0=3;function W_(d,A,m){d===1&&m.readMessage($_,A)}function $_(d,A,m){if(d===3){const{id:w,bitmap:D,width:N,height:U,left:X,top:ee,advance:ae}=m.readMessage(X_,{});A.push({id:w,bitmap:new Sh({width:N+2*e0,height:U+2*e0},D),metrics:{width:N,height:U,left:X,top:ee,advance:ae}})}}function X_(d,A,m){d===1?A.id=m.readVarint():d===2?A.bitmap=m.readBytes():d===3?A.width=m.readVarint():d===4?A.height=m.readVarint():d===5?A.left=m.readSVarint():d===6?A.top=m.readSVarint():d===7&&(A.advance=m.readVarint())}const t0=e0;function Ml(d){let A=0,m=0;for(const U of d)A+=U.w*U.h,m=Math.max(m,U.w);d.sort((U,X)=>X.h-U.h);const w=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(A/.95)),m),h:1/0}];let D=0,N=0;for(const U of d)for(let X=w.length-1;X>=0;X--){const ee=w[X];if(!(U.w>ee.w||U.h>ee.h)){if(U.x=ee.x,U.y=ee.y,N=Math.max(N,U.y+U.h),D=Math.max(D,U.x+U.w),U.w===ee.w&&U.h===ee.h){const ae=w.pop();X<w.length&&(w[X]=ae)}else U.h===ee.h?(ee.x+=U.w,ee.w-=U.w):U.w===ee.w?(ee.y+=U.h,ee.h-=U.h):(w.push({x:ee.x+U.w,y:ee.y,w:ee.w-U.w,h:U.h}),ee.y+=U.h,ee.h-=U.h);break}}return{w:D,h:N,fill:A/(D*N)||0}}const qn=1;class go{constructor(A,{pixelRatio:m,version:w,stretchX:D,stretchY:N,content:U}){this.paddedRect=A,this.pixelRatio=m,this.stretchX=D,this.stretchY=N,this.content=U,this.version=w}get tl(){return[this.paddedRect.x+qn,this.paddedRect.y+qn]}get br(){return[this.paddedRect.x+this.paddedRect.w-qn,this.paddedRect.y+this.paddedRect.h-qn]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*qn)/this.pixelRatio,(this.paddedRect.h-2*qn)/this.pixelRatio]}}class i0{constructor(A,m){const w={},D={};this.haveRenderCallbacks=[];const N=[];this.addImages(A,w,N),this.addImages(m,D,N);const{w:U,h:X}=Ml(N),ee=new El({width:U||1,height:X||1});for(const ae in A){const de=A[ae],ge=w[ae].paddedRect;El.copy(de.data,ee,{x:0,y:0},{x:ge.x+qn,y:ge.y+qn},de.data)}for(const ae in m){const de=m[ae],ge=D[ae].paddedRect,Ee=ge.x+qn,Oe=ge.y+qn,ce=de.data.width,et=de.data.height;El.copy(de.data,ee,{x:0,y:0},{x:Ee,y:Oe},de.data),El.copy(de.data,ee,{x:0,y:et-1},{x:Ee,y:Oe-1},{width:ce,height:1}),El.copy(de.data,ee,{x:0,y:0},{x:Ee,y:Oe+et},{width:ce,height:1}),El.copy(de.data,ee,{x:ce-1,y:0},{x:Ee-1,y:Oe},{width:1,height:et}),El.copy(de.data,ee,{x:0,y:0},{x:Ee+ce,y:Oe},{width:1,height:et})}this.image=ee,this.iconPositions=w,this.patternPositions=D}addImages(A,m,w){for(const D in A){const N=A[D],U={x:0,y:0,w:N.data.width+2*qn,h:N.data.height+2*qn};w.push(U),m[D]=new go(U,N),N.hasRenderCallback&&this.haveRenderCallbacks.push(D)}}patchUpdatedImages(A,m){A.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const w in A.updatedImages)this.patchUpdatedImage(this.iconPositions[w],A.getImage(w),m),this.patchUpdatedImage(this.patternPositions[w],A.getImage(w),m)}patchUpdatedImage(A,m,w){if(!A||!m||A.version===m.version)return;A.version=m.version;const[D,N]=A.tl;w.update(m.data,void 0,{x:D,y:N})}}var Oc;Vi("ImagePosition",go),Vi("ImageAtlas",i0),P.ai=void 0,(Oc=P.ai||(P.ai={}))[Oc.none=0]="none",Oc[Oc.horizontal=1]="horizontal",Oc[Oc.vertical=2]="vertical",Oc[Oc.horizontalOnly=3]="horizontalOnly";const Fh=-17;class Oh{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(A,m){const w=new Oh;return w.scale=A||1,w.fontStack=m,w}static forImage(A){const m=new Oh;return m.imageName=A,m}}class Qn{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(A,m){const w=new Qn;for(let D=0;D<A.sections.length;D++){const N=A.sections[D];N.image?w.addImageSection(N):w.addTextSection(N,m)}return w}length(){return this.text.length}getSection(A){return this.sections[this.sectionIndex[A]]}getSectionIndex(A){return this.sectionIndex[A]}getCharCode(A){return this.text.charCodeAt(A)}verticalizePunctuation(){this.text=function(A){let m="";for(let w=0;w<A.length;w++){const D=A.charCodeAt(w+1)||null,N=A.charCodeAt(w-1)||null;m+=D&&nc(D)&&!Rc[A[w+1]]||N&&nc(N)&&!Rc[A[w-1]]||!Rc[A[w]]?A[w]:Rc[A[w]]}return m}(this.text)}trim(){let A=0;for(let w=0;w<this.text.length&&GA[this.text.charCodeAt(w)];w++)A++;let m=this.text.length;for(let w=this.text.length-1;w>=0&&w>=A&&GA[this.text.charCodeAt(w)];w--)m--;this.text=this.text.substring(A,m),this.sectionIndex=this.sectionIndex.slice(A,m)}substring(A,m){const w=new Qn;return w.text=this.text.substring(A,m),w.sectionIndex=this.sectionIndex.slice(A,m),w.sections=this.sections,w}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((A,m)=>Math.max(A,this.sections[m].scale),0)}addTextSection(A,m){this.text+=A.text,this.sections.push(Oh.forText(A.scale,A.fontStack||m));const w=this.sections.length-1;for(let D=0;D<A.text.length;++D)this.sectionIndex.push(w)}addImageSection(A){const m=A.image?A.image.name:"";if(m.length===0)return void Li("Can't add FormattedSection with an empty image.");const w=this.getNextImageSectionCharCode();w?(this.text+=String.fromCharCode(w),this.sections.push(Oh.forImage(m)),this.sectionIndex.push(this.sections.length-1)):Li("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Xu(d,A,m,w,D,N,U,X,ee,ae,de,ge,Ee,Oe,ce,et){const ot=Qn.fromFeature(d,D);let pt;ge===P.ai.vertical&&ot.verticalizePunctuation();const{processBidirectionalText:Ct,processStyledBidirectionalText:bt}=aa;if(Ct&&ot.sections.length===1){pt=[];const li=Ct(ot.toString(),Cd(ot,ae,N,A,w,Oe,ce));for(const Ci of li){const nr=new Qn;nr.text=Ci,nr.sections=ot.sections;for(let Ri=0;Ri<Ci.length;Ri++)nr.sectionIndex.push(0);pt.push(nr)}}else if(bt){pt=[];const li=bt(ot.text,ot.sectionIndex,Cd(ot,ae,N,A,w,Oe,ce));for(const Ci of li){const nr=new Qn;nr.text=Ci[0],nr.sectionIndex=Ci[1],nr.sections=ot.sections,pt.push(nr)}}else pt=function(li,Ci){const nr=[],Ri=li.text;let Pi=0;for(const wi of Ci)nr.push(li.substring(Pi,wi)),Pi=wi;return Pi<Ri.length&&nr.push(li.substring(Pi,Ri.length)),nr}(ot,Cd(ot,ae,N,A,w,Oe,ce));const _e=[],Ut={positionedLines:_e,text:ot.toString(),top:de[1],bottom:de[1],left:de[0],right:de[0],writingMode:ge,iconsInText:!1,verticalizable:!1};return function(li,Ci,nr,Ri,Pi,wi,Wi,ki,ci,fr,fi,Wr){let vs=0,ps=Fh,yo=0,Ca=0;const $a=ki==="right"?1:ki==="left"?0:.5;let xo=0;for(const Cs of Pi){Cs.trim();const Fn=Cs.getMaxScale(),Xa=(Fn-1)*Eo,Vo={positionedGlyphs:[],lineOffset:0};li.positionedLines[xo]=Vo;const ua=Vo.positionedGlyphs;let Zs=0;if(!Cs.length()){ps+=wi,++xo;continue}for(let No=0;No<Cs.length();No++){const hn=Cs.getSection(No),ka=Cs.getSectionIndex(No),Da=Cs.getCharCode(No);let vo=0,lo=null,ha=null,bA=null,_c=Eo;const Hl=!(ci===P.ai.horizontal||!fi&&!_A(Da)||fi&&(GA[Da]||(Ko=Da,Si.Arabic(Ko)||Si["Arabic Supplement"](Ko)||Si["Arabic Extended-A"](Ko)||Si["Arabic Presentation Forms-A"](Ko)||Si["Arabic Presentation Forms-B"](Ko))));if(hn.imageName){const hl=Ri[hn.imageName];if(!hl)continue;bA=hn.imageName,li.iconsInText=li.iconsInText||!0,ha=hl.paddedRect;const Ya=hl.displaySize;hn.scale=hn.scale*Eo/Wr,lo={width:Ya[0],height:Ya[1],left:qn,top:-t0,advance:Hl?Ya[1]:Ya[0]},vo=Xa+(Eo-Ya[1]*hn.scale),_c=lo.advance;const Wl=Hl?Ya[0]*hn.scale-Eo*Fn:Ya[1]*hn.scale-Eo*Fn;Wl>0&&Wl>Zs&&(Zs=Wl)}else{const hl=nr[hn.fontStack],Ya=hl&&hl[Da];if(Ya&&Ya.rect)ha=Ya.rect,lo=Ya.metrics;else{const Wl=Ci[hn.fontStack],da=Wl&&Wl[Da];if(!da)continue;lo=da.metrics}vo=(Fn-hn.scale)*Eo}Hl?(li.verticalizable=!0,ua.push({glyph:Da,imageName:bA,x:vs,y:ps+vo,vertical:Hl,scale:hn.scale,fontStack:hn.fontStack,sectionIndex:ka,metrics:lo,rect:ha}),vs+=_c*hn.scale+fr):(ua.push({glyph:Da,imageName:bA,x:vs,y:ps+vo,vertical:Hl,scale:hn.scale,fontStack:hn.fontStack,sectionIndex:ka,metrics:lo,rect:ha}),vs+=lo.advance*hn.scale+fr)}ua.length!==0&&(yo=Math.max(vs-fr,yo),Fp(ua,0,ua.length-1,$a,Zs)),vs=0;const qs=wi*Fn+Zs;Vo.lineOffset=Math.max(Zs,Xa),ps+=qs,Ca=Math.max(qs,Ca),++xo}var Ko;const Gs=ps-Fh,{horizontalAlign:$r,verticalAlign:Jo}=kd(Wi);(function(Cs,Fn,Xa,Vo,ua,Zs,qs,No,hn){const ka=(Fn-Xa)*ua;let Da=0;Da=Zs!==qs?-No*Vo-Fh:(-Vo*hn+.5)*qs;for(const vo of Cs)for(const lo of vo.positionedGlyphs)lo.x+=ka,lo.y+=Da})(li.positionedLines,$a,$r,Jo,yo,Ca,wi,Gs,Pi.length),li.top+=-Jo*Gs,li.bottom=li.top+Gs,li.left+=-$r*yo,li.right=li.left+yo}(Ut,A,m,w,pt,U,X,ee,ge,ae,Ee,et),!function(li){for(const Ci of li)if(Ci.positionedGlyphs.length!==0)return!1;return!0}(_e)&&Ut}const GA={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Rp={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function r0(d,A,m,w,D,N){if(A.imageName){const U=w[A.imageName];return U?U.displaySize[0]*A.scale*Eo/N+D:0}{const U=m[A.fontStack],X=U&&U[d];return X?X.metrics.advance*A.scale+D:0}}function n0(d,A,m,w){const D=Math.pow(d-A,2);return w?d<A?D/2:2*D:D+Math.abs(m)*m}function xs(d,A,m){let w=0;return d===10&&(w-=1e4),m&&(w+=150),d!==40&&d!==65288||(w+=50),A!==41&&A!==65289||(w+=50),w}function Id(d,A,m,w,D,N){let U=null,X=n0(A,m,D,N);for(const ee of w){const ae=n0(A-ee.x,m,D,N)+ee.badness;ae<=X&&(U=ee,X=ae)}return{index:d,x:A,priorBreak:U,badness:X}}function ZA(d){return d?ZA(d.priorBreak).concat(d.index):[]}function Cd(d,A,m,w,D,N,U){if(N!=="point")return[];if(!d)return[];const X=[],ee=function(Ee,Oe,ce,et,ot,pt){let Ct=0;for(let bt=0;bt<Ee.length();bt++){const _e=Ee.getSection(bt);Ct+=r0(Ee.getCharCode(bt),_e,et,ot,Oe,pt)}return Ct/Math.max(1,Math.ceil(Ct/ce))}(d,A,m,w,D,U),ae=d.text.indexOf("​")>=0;let de=0;for(let Ee=0;Ee<d.length();Ee++){const Oe=d.getSection(Ee),ce=d.getCharCode(Ee);if(GA[ce]||(de+=r0(ce,Oe,w,D,A,U)),Ee<d.length()-1){const et=!((ge=ce)<11904||!(Si["Bopomofo Extended"](ge)||Si.Bopomofo(ge)||Si["CJK Compatibility Forms"](ge)||Si["CJK Compatibility Ideographs"](ge)||Si["CJK Compatibility"](ge)||Si["CJK Radicals Supplement"](ge)||Si["CJK Strokes"](ge)||Si["CJK Symbols and Punctuation"](ge)||Si["CJK Unified Ideographs Extension A"](ge)||Si["CJK Unified Ideographs"](ge)||Si["Enclosed CJK Letters and Months"](ge)||Si["Halfwidth and Fullwidth Forms"](ge)||Si.Hiragana(ge)||Si["Ideographic Description Characters"](ge)||Si["Kangxi Radicals"](ge)||Si["Katakana Phonetic Extensions"](ge)||Si.Katakana(ge)||Si["Vertical Forms"](ge)||Si["Yi Radicals"](ge)||Si["Yi Syllables"](ge)));(Rp[ce]||et||Oe.imageName)&&X.push(Id(Ee+1,de,ee,X,xs(ce,d.getCharCode(Ee+1),et&&ae),!1))}}var ge;return ZA(Id(d.length(),de,ee,X,0,!0))}function kd(d){let A=.5,m=.5;switch(d){case"right":case"top-right":case"bottom-right":A=1;break;case"left":case"top-left":case"bottom-left":A=0}switch(d){case"bottom":case"bottom-right":case"bottom-left":m=1;break;case"top":case"top-right":case"top-left":m=0}return{horizontalAlign:A,verticalAlign:m}}function Fp(d,A,m,w,D){if(!w&&!D)return;const N=d[m],U=(d[m].x+N.metrics.advance*N.scale)*w;for(let X=A;X<=m;X++)d[X].x-=U,d[X].y+=D}function zn(d,A,m){const{horizontalAlign:w,verticalAlign:D}=kd(m),N=A[0]-d.displaySize[0]*w,U=A[1]-d.displaySize[1]*D;return{image:d,top:U,bottom:U+d.displaySize[1],left:N,right:N+d.displaySize[0]}}function Dd(d,A,m,w,D,N){const U=d.image;let X;if(U.content){const ot=U.content,pt=U.pixelRatio||1;X=[ot[0]/pt,ot[1]/pt,U.displaySize[0]-ot[2]/pt,U.displaySize[1]-ot[3]/pt]}const ee=A.left*N,ae=A.right*N;let de,ge,Ee,Oe;m==="width"||m==="both"?(Oe=D[0]+ee-w[3],ge=D[0]+ae+w[1]):(Oe=D[0]+(ee+ae-U.displaySize[0])/2,ge=Oe+U.displaySize[0]);const ce=A.top*N,et=A.bottom*N;return m==="height"||m==="both"?(de=D[1]+ce-w[0],Ee=D[1]+et+w[2]):(de=D[1]+(ce+et-U.displaySize[1])/2,Ee=de+U.displaySize[1]),{image:U,top:de,right:ge,bottom:Ee,left:Oe,collisionPadding:X}}const Ha=255,qA=128,Vc=Ha*qA;function s0(d,A){const{expression:m}=A;if(m.kind==="constant")return{kind:"constant",layoutSize:m.evaluate(new Gn(d+1))};if(m.kind==="source")return{kind:"source"};{const{zoomStops:w,interpolationType:D}=m;let N=0;for(;N<w.length&&w[N]<=d;)N++;N=Math.max(0,N-1);let U=N;for(;U<w.length&&w[U]<d+1;)U++;U=Math.min(w.length-1,U);const X=w[N],ee=w[U];return m.kind==="composite"?{kind:"composite",minZoom:X,maxZoom:ee,interpolationType:D}:{kind:"camera",minZoom:X,maxZoom:ee,minSize:m.evaluate(new Gn(X)),maxSize:m.evaluate(new Gn(ee)),interpolationType:D}}}function Er(d,A,m){let w="never";const D=d.get(A);return D?w=D:d.get(m)&&(w="always"),w}const o0=uc.VectorTileFeature.types,Bs=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Vh(d,A,m,w,D,N,U,X,ee,ae,de,ge,Ee){const Oe=X?Math.min(Vc,Math.round(X[0])):0,ce=X?Math.min(Vc,Math.round(X[1])):0;d.emplaceBack(A,m,Math.round(32*w),Math.round(32*D),N,U,(Oe<<1)+(ee?1:0),ce,16*ae,16*de,256*ge,256*Ee)}function Pd(d,A,m){d.emplaceBack(A.x,A.y,m),d.emplaceBack(A.x,A.y,m),d.emplaceBack(A.x,A.y,m),d.emplaceBack(A.x,A.y,m)}function Op(d){for(const A of d.sections)if(Ms(A.text))return!0;return!1}class zd{constructor(A){this.layoutVertexArray=new Hi,this.indexArray=new Nr,this.programConfigurations=A,this.segments=new Kn,this.dynamicLayoutVertexArray=new Zi,this.opacityVertexArray=new Fi,this.hasVisibleVertices=!1,this.placedSymbolArray=new le}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(A,m,w,D){this.isEmpty()||(w&&(this.layoutVertexBuffer=A.createVertexBuffer(this.layoutVertexArray,zp.members),this.indexBuffer=A.createIndexBuffer(this.indexArray,m),this.dynamicLayoutVertexBuffer=A.createVertexBuffer(this.dynamicLayoutVertexArray,Z_.members,!0),this.opacityVertexBuffer=A.createVertexBuffer(this.opacityVertexArray,Bs,!0),this.opacityVertexBuffer.itemSize=1),(w||D)&&this.programConfigurations.upload(A))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Vi("SymbolBuffers",zd);class Bd{constructor(A,m,w){this.layoutVertexArray=new A,this.layoutAttributes=m,this.indexArray=new w,this.segments=new Kn,this.collisionVertexArray=new er}upload(A){this.layoutVertexBuffer=A.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=A.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=A.createVertexBuffer(this.collisionVertexArray,Bp.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Vi("CollisionBuffers",Bd);class Du{constructor(A){this.collisionBoxArray=A.collisionBoxArray,this.zoom=A.zoom,this.overscaling=A.overscaling,this.layers=A.layers,this.layerIds=this.layers.map(U=>U.id),this.index=A.index,this.pixelRatio=A.pixelRatio,this.sourceLayerIndex=A.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Sf([]),this.placementViewportMatrix=Sf([]);const m=this.layers[0]._unevaluatedLayout._values;this.textSizeData=s0(this.zoom,m["text-size"]),this.iconSizeData=s0(this.zoom,m["icon-size"]);const w=this.layers[0].layout,D=w.get("symbol-sort-key"),N=w.get("symbol-z-order");this.canOverlap=Er(w,"text-overlap","text-allow-overlap")!=="never"||Er(w,"icon-overlap","icon-allow-overlap")!=="never"||w.get("text-ignore-placement")||w.get("icon-ignore-placement"),this.sortFeaturesByKey=N!=="viewport-y"&&!D.isConstant(),this.sortFeaturesByY=(N==="viewport-y"||N==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,w.get("symbol-placement")==="point"&&(this.writingModes=w.get("text-writing-mode").map(U=>P.ai[U])),this.stateDependentLayerIds=this.layers.filter(U=>U.isStateDependent()).map(U=>U.id),this.sourceID=A.sourceID}createArrays(){this.text=new zd(new xA(this.layers,this.zoom,A=>/^text/.test(A))),this.icon=new zd(new xA(this.layers,this.zoom,A=>/^icon/.test(A))),this.glyphOffsetArray=new Ie,this.lineVertexArray=new ke,this.symbolInstances=new ye,this.textAnchorOffsets=new ut}calculateGlyphDependencies(A,m,w,D,N){for(let U=0;U<A.length;U++)if(m[A.charCodeAt(U)]=!0,(w||D)&&N){const X=Rc[A.charAt(U)];X&&(m[X.charCodeAt(0)]=!0)}}populate(A,m,w){const D=this.layers[0],N=D.layout,U=N.get("text-font"),X=N.get("text-field"),ee=N.get("icon-image"),ae=(X.value.kind!=="constant"||X.value.value instanceof gt&&!X.value.value.isEmpty()||X.value.value.toString().length>0)&&(U.value.kind!=="constant"||U.value.value.length>0),de=ee.value.kind!=="constant"||!!ee.value.value||Object.keys(ee.parameters).length>0,ge=N.get("symbol-sort-key");if(this.features=[],!ae&&!de)return;const Ee=m.iconDependencies,Oe=m.glyphDependencies,ce=m.availableImages,et=new Gn(this.zoom);for(const{feature:ot,id:pt,index:Ct,sourceLayerIndex:bt}of A){const _e=D._featureFilter.needGeometry,Ut=eu(ot,_e);if(!D._featureFilter.filter(et,Ut,w))continue;let li,Ci;if(_e||(Ut.geometry=wu(ot)),ae){const Ri=D.getValueAndResolveTokens("text-field",Ut,w,ce),Pi=gt.factory(Ri);Op(Pi)&&(this.hasRTLText=!0),(!this.hasRTLText||xl()==="unavailable"||this.hasRTLText&&aa.isParsed())&&(li=Xf(Pi,D,Ut))}if(de){const Ri=D.getValueAndResolveTokens("icon-image",Ut,w,ce);Ci=Ri instanceof Hs?Ri:Hs.fromString(Ri)}if(!li&&!Ci)continue;const nr=this.sortFeaturesByKey?ge.evaluate(Ut,{},w):void 0;if(this.features.push({id:pt,text:li,icon:Ci,index:Ct,sourceLayerIndex:bt,geometry:Ut.geometry,properties:ot.properties,type:o0[ot.type],sortKey:nr}),Ci&&(Ee[Ci.name]=!0),li){const Ri=U.evaluate(Ut,{},w).join(","),Pi=N.get("text-rotation-alignment")!=="viewport"&&N.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(P.ai.vertical)>=0;for(const wi of li.sections)if(wi.image)Ee[wi.image.name]=!0;else{const Wi=iA(li.toString()),ki=wi.fontStack||Ri,ci=Oe[ki]=Oe[ki]||{};this.calculateGlyphDependencies(wi.text,ci,Pi,this.allowVerticalPlacement,Wi)}}}N.get("symbol-placement")==="line"&&(this.features=function(ot){const pt={},Ct={},bt=[];let _e=0;function Ut(Ri){bt.push(ot[Ri]),_e++}function li(Ri,Pi,wi){const Wi=Ct[Ri];return delete Ct[Ri],Ct[Pi]=Wi,bt[Wi].geometry[0].pop(),bt[Wi].geometry[0]=bt[Wi].geometry[0].concat(wi[0]),Wi}function Ci(Ri,Pi,wi){const Wi=pt[Pi];return delete pt[Pi],pt[Ri]=Wi,bt[Wi].geometry[0].shift(),bt[Wi].geometry[0]=wi[0].concat(bt[Wi].geometry[0]),Wi}function nr(Ri,Pi,wi){const Wi=wi?Pi[0][Pi[0].length-1]:Pi[0][0];return`${Ri}:${Wi.x}:${Wi.y}`}for(let Ri=0;Ri<ot.length;Ri++){const Pi=ot[Ri],wi=Pi.geometry,Wi=Pi.text?Pi.text.toString():null;if(!Wi){Ut(Ri);continue}const ki=nr(Wi,wi),ci=nr(Wi,wi,!0);if(ki in Ct&&ci in pt&&Ct[ki]!==pt[ci]){const fr=Ci(ki,ci,wi),fi=li(ki,ci,bt[fr].geometry);delete pt[ki],delete Ct[ci],Ct[nr(Wi,bt[fi].geometry,!0)]=fi,bt[fr].geometry=null}else ki in Ct?li(ki,ci,wi):ci in pt?Ci(ki,ci,wi):(Ut(Ri),pt[ki]=_e-1,Ct[ci]=_e-1)}return bt.filter(Ri=>Ri.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ot,pt)=>ot.sortKey-pt.sortKey)}update(A,m,w){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(A,m,this.layers,w),this.icon.programConfigurations.updatePaintArrays(A,m,this.layers,w))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(A){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(A),this.iconCollisionBox.upload(A)),this.text.upload(A,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(A,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(A,m){const w=this.lineVertexArray.length;if(A.segment!==void 0){let D=A.dist(m[A.segment+1]),N=A.dist(m[A.segment]);const U={};for(let X=A.segment+1;X<m.length;X++)U[X]={x:m[X].x,y:m[X].y,tileUnitDistanceFromAnchor:D},X<m.length-1&&(D+=m[X+1].dist(m[X]));for(let X=A.segment||0;X>=0;X--)U[X]={x:m[X].x,y:m[X].y,tileUnitDistanceFromAnchor:N},X>0&&(N+=m[X-1].dist(m[X]));for(let X=0;X<m.length;X++){const ee=U[X];this.lineVertexArray.emplaceBack(ee.x,ee.y,ee.tileUnitDistanceFromAnchor)}}return{lineStartIndex:w,lineLength:this.lineVertexArray.length-w}}addSymbols(A,m,w,D,N,U,X,ee,ae,de,ge,Ee){const Oe=A.indexArray,ce=A.layoutVertexArray,et=A.segments.prepareSegment(4*m.length,ce,Oe,this.canOverlap?U.sortKey:void 0),ot=this.glyphOffsetArray.length,pt=et.vertexLength,Ct=this.allowVerticalPlacement&&X===P.ai.vertical?Math.PI/2:0,bt=U.text&&U.text.sections;for(let _e=0;_e<m.length;_e++){const{tl:Ut,tr:li,bl:Ci,br:nr,tex:Ri,pixelOffsetTL:Pi,pixelOffsetBR:wi,minFontScaleX:Wi,minFontScaleY:ki,glyphOffset:ci,isSDF:fr,sectionIndex:fi}=m[_e],Wr=et.vertexLength,vs=ci[1];Vh(ce,ee.x,ee.y,Ut.x,vs+Ut.y,Ri.x,Ri.y,w,fr,Pi.x,Pi.y,Wi,ki),Vh(ce,ee.x,ee.y,li.x,vs+li.y,Ri.x+Ri.w,Ri.y,w,fr,wi.x,Pi.y,Wi,ki),Vh(ce,ee.x,ee.y,Ci.x,vs+Ci.y,Ri.x,Ri.y+Ri.h,w,fr,Pi.x,wi.y,Wi,ki),Vh(ce,ee.x,ee.y,nr.x,vs+nr.y,Ri.x+Ri.w,Ri.y+Ri.h,w,fr,wi.x,wi.y,Wi,ki),Pd(A.dynamicLayoutVertexArray,ee,Ct),Oe.emplaceBack(Wr,Wr+1,Wr+2),Oe.emplaceBack(Wr+1,Wr+2,Wr+3),et.vertexLength+=4,et.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ci[0]),_e!==m.length-1&&fi===m[_e+1].sectionIndex||A.programConfigurations.populatePaintArrays(ce.length,U,U.index,{},Ee,bt&&bt[fi])}A.placedSymbolArray.emplaceBack(ee.x,ee.y,ot,this.glyphOffsetArray.length-ot,pt,ae,de,ee.segment,w?w[0]:0,w?w[1]:0,D[0],D[1],X,0,!1,0,ge)}_addCollisionDebugVertex(A,m,w,D,N,U){return m.emplaceBack(0,0),A.emplaceBack(w.x,w.y,D,N,Math.round(U.x),Math.round(U.y))}addCollisionDebugVertices(A,m,w,D,N,U,X){const ee=N.segments.prepareSegment(4,N.layoutVertexArray,N.indexArray),ae=ee.vertexLength,de=N.layoutVertexArray,ge=N.collisionVertexArray,Ee=X.anchorX,Oe=X.anchorY;this._addCollisionDebugVertex(de,ge,U,Ee,Oe,new yt(A,m)),this._addCollisionDebugVertex(de,ge,U,Ee,Oe,new yt(w,m)),this._addCollisionDebugVertex(de,ge,U,Ee,Oe,new yt(w,D)),this._addCollisionDebugVertex(de,ge,U,Ee,Oe,new yt(A,D)),ee.vertexLength+=4;const ce=N.indexArray;ce.emplaceBack(ae,ae+1),ce.emplaceBack(ae+1,ae+2),ce.emplaceBack(ae+2,ae+3),ce.emplaceBack(ae+3,ae),ee.primitiveLength+=4}addDebugCollisionBoxes(A,m,w,D){for(let N=A;N<m;N++){const U=this.collisionBoxArray.get(N);this.addCollisionDebugVertices(U.x1,U.y1,U.x2,U.y2,D?this.textCollisionBox:this.iconCollisionBox,U.anchorPoint,w)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Bd(sr,$f.members,Yi),this.iconCollisionBox=new Bd(sr,$f.members,Yi);for(let A=0;A<this.symbolInstances.length;A++){const m=this.symbolInstances.get(A);this.addDebugCollisionBoxes(m.textBoxStartIndex,m.textBoxEndIndex,m,!0),this.addDebugCollisionBoxes(m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m,!0),this.addDebugCollisionBoxes(m.iconBoxStartIndex,m.iconBoxEndIndex,m,!1),this.addDebugCollisionBoxes(m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex,m,!1)}}_deserializeCollisionBoxesForSymbol(A,m,w,D,N,U,X,ee,ae){const de={};for(let ge=m;ge<w;ge++){const Ee=A.get(ge);de.textBox={x1:Ee.x1,y1:Ee.y1,x2:Ee.x2,y2:Ee.y2,anchorPointX:Ee.anchorPointX,anchorPointY:Ee.anchorPointY},de.textFeatureIndex=Ee.featureIndex;break}for(let ge=D;ge<N;ge++){const Ee=A.get(ge);de.verticalTextBox={x1:Ee.x1,y1:Ee.y1,x2:Ee.x2,y2:Ee.y2,anchorPointX:Ee.anchorPointX,anchorPointY:Ee.anchorPointY},de.verticalTextFeatureIndex=Ee.featureIndex;break}for(let ge=U;ge<X;ge++){const Ee=A.get(ge);de.iconBox={x1:Ee.x1,y1:Ee.y1,x2:Ee.x2,y2:Ee.y2,anchorPointX:Ee.anchorPointX,anchorPointY:Ee.anchorPointY},de.iconFeatureIndex=Ee.featureIndex;break}for(let ge=ee;ge<ae;ge++){const Ee=A.get(ge);de.verticalIconBox={x1:Ee.x1,y1:Ee.y1,x2:Ee.x2,y2:Ee.y2,anchorPointX:Ee.anchorPointX,anchorPointY:Ee.anchorPointY},de.verticalIconFeatureIndex=Ee.featureIndex;break}return de}deserializeCollisionBoxes(A){this.collisionArrays=[];for(let m=0;m<this.symbolInstances.length;m++){const w=this.symbolInstances.get(m);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(A,w.textBoxStartIndex,w.textBoxEndIndex,w.verticalTextBoxStartIndex,w.verticalTextBoxEndIndex,w.iconBoxStartIndex,w.iconBoxEndIndex,w.verticalIconBoxStartIndex,w.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(A,m){const w=A.placedSymbolArray.get(m),D=w.vertexStartIndex+4*w.numGlyphs;for(let N=w.vertexStartIndex;N<D;N+=4)A.indexArray.emplaceBack(N,N+1,N+2),A.indexArray.emplaceBack(N+1,N+2,N+3)}getSortedSymbolIndexes(A){if(this.sortedAngle===A&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const m=Math.sin(A),w=Math.cos(A),D=[],N=[],U=[];for(let X=0;X<this.symbolInstances.length;++X){U.push(X);const ee=this.symbolInstances.get(X);D.push(0|Math.round(m*ee.anchorX+w*ee.anchorY)),N.push(ee.featureIndex)}return U.sort((X,ee)=>D[X]-D[ee]||N[ee]-N[X]),U}addToSortKeyRanges(A,m){const w=this.sortKeyRanges[this.sortKeyRanges.length-1];w&&w.sortKey===m?w.symbolInstanceEnd=A+1:this.sortKeyRanges.push({sortKey:m,symbolInstanceStart:A,symbolInstanceEnd:A+1})}sortFeatures(A){if(this.sortFeaturesByY&&this.sortedAngle!==A&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(A),this.sortedAngle=A,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const m of this.symbolInstanceIndexes){const w=this.symbolInstances.get(m);this.featureSortOrder.push(w.featureIndex),[w.rightJustifiedTextSymbolIndex,w.centerJustifiedTextSymbolIndex,w.leftJustifiedTextSymbolIndex].forEach((D,N,U)=>{D>=0&&U.indexOf(D)===N&&this.addIndicesForPlacedSymbol(this.text,D)}),w.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,w.verticalPlacedTextSymbolIndex),w.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,w.placedIconSymbolIndex),w.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,w.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let a0,l0;Vi("SymbolBucket",Du,{omit:["layers","collisionBoxArray","features","compareText"]}),Du.MAX_GLYPHS=65535,Du.addDynamicAttributes=Pd;var _r={get paint(){return l0=l0||new tn({"icon-opacity":new Jt(Pe.paint_symbol["icon-opacity"]),"icon-color":new Jt(Pe.paint_symbol["icon-color"]),"icon-halo-color":new Jt(Pe.paint_symbol["icon-halo-color"]),"icon-halo-width":new Jt(Pe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Jt(Pe.paint_symbol["icon-halo-blur"]),"icon-translate":new Vt(Pe.paint_symbol["icon-translate"]),"icon-translate-anchor":new Vt(Pe.paint_symbol["icon-translate-anchor"]),"text-opacity":new Jt(Pe.paint_symbol["text-opacity"]),"text-color":new Jt(Pe.paint_symbol["text-color"],{runtimeType:Cn,getOverride:d=>d.textColor,hasOverride:d=>!!d.textColor}),"text-halo-color":new Jt(Pe.paint_symbol["text-halo-color"]),"text-halo-width":new Jt(Pe.paint_symbol["text-halo-width"]),"text-halo-blur":new Jt(Pe.paint_symbol["text-halo-blur"]),"text-translate":new Vt(Pe.paint_symbol["text-translate"]),"text-translate-anchor":new Vt(Pe.paint_symbol["text-translate-anchor"])})},get layout(){return a0=a0||new tn({"symbol-placement":new Vt(Pe.layout_symbol["symbol-placement"]),"symbol-spacing":new Vt(Pe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Vt(Pe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Jt(Pe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Vt(Pe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Vt(Pe.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Vt(Pe.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Vt(Pe.layout_symbol["icon-ignore-placement"]),"icon-optional":new Vt(Pe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Vt(Pe.layout_symbol["icon-rotation-alignment"]),"icon-size":new Jt(Pe.layout_symbol["icon-size"]),"icon-text-fit":new Vt(Pe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Vt(Pe.layout_symbol["icon-text-fit-padding"]),"icon-image":new Jt(Pe.layout_symbol["icon-image"]),"icon-rotate":new Jt(Pe.layout_symbol["icon-rotate"]),"icon-padding":new Jt(Pe.layout_symbol["icon-padding"]),"icon-keep-upright":new Vt(Pe.layout_symbol["icon-keep-upright"]),"icon-offset":new Jt(Pe.layout_symbol["icon-offset"]),"icon-anchor":new Jt(Pe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Vt(Pe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Vt(Pe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Vt(Pe.layout_symbol["text-rotation-alignment"]),"text-field":new Jt(Pe.layout_symbol["text-field"]),"text-font":new Jt(Pe.layout_symbol["text-font"]),"text-size":new Jt(Pe.layout_symbol["text-size"]),"text-max-width":new Jt(Pe.layout_symbol["text-max-width"]),"text-line-height":new Vt(Pe.layout_symbol["text-line-height"]),"text-letter-spacing":new Jt(Pe.layout_symbol["text-letter-spacing"]),"text-justify":new Jt(Pe.layout_symbol["text-justify"]),"text-radial-offset":new Jt(Pe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Vt(Pe.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Jt(Pe.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Jt(Pe.layout_symbol["text-anchor"]),"text-max-angle":new Vt(Pe.layout_symbol["text-max-angle"]),"text-writing-mode":new Vt(Pe.layout_symbol["text-writing-mode"]),"text-rotate":new Jt(Pe.layout_symbol["text-rotate"]),"text-padding":new Vt(Pe.layout_symbol["text-padding"]),"text-keep-upright":new Vt(Pe.layout_symbol["text-keep-upright"]),"text-transform":new Jt(Pe.layout_symbol["text-transform"]),"text-offset":new Jt(Pe.layout_symbol["text-offset"]),"text-allow-overlap":new Vt(Pe.layout_symbol["text-allow-overlap"]),"text-overlap":new Vt(Pe.layout_symbol["text-overlap"]),"text-ignore-placement":new Vt(Pe.layout_symbol["text-ignore-placement"]),"text-optional":new Vt(Pe.layout_symbol["text-optional"])})}};class Mr{constructor(A){if(A.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=A.property.overrides?A.property.overrides.runtimeType:ls,this.defaultValue=A}evaluate(A){if(A.formattedSection){const m=this.defaultValue.property.overrides;if(m&&m.hasOverride(A.formattedSection))return m.getOverride(A.formattedSection)}return A.feature&&A.featureState?this.defaultValue.evaluate(A.feature,A.featureState):this.defaultValue.property.specification.default}eachChild(A){this.defaultValue.isConstant()||A(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Vi("FormatSectionOverride",Mr,{omit:["defaultValue"]});class Yu extends Zn{constructor(A){super(A,_r)}recalculate(A,m){if(super.recalculate(A,m),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const w=this.layout.get("text-writing-mode");if(w){const D=[];for(const N of w)D.indexOf(N)<0&&D.push(N);this.layout._values["text-writing-mode"]=D}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(A,m,w,D){const N=this.layout.get(A).evaluate(m,{},w,D),U=this._unevaluatedLayout._values[A];return U.isDataDriven()||pA(U.value)||!N?N:function(X,ee){return ee.replace(/{([^{}]+)}/g,(ae,de)=>X&&de in X?String(X[de]):"")}(m.properties,N)}createBucket(A){return new Du(A)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const A of _r.paint.overridableProperties){if(!Yu.hasPaintOverride(this.layout,A))continue;const m=this.paint.get(A),w=new Mr(m),D=new tl(w,m.property.specification);let N=null;N=m.value.kind==="constant"||m.value.kind==="source"?new pl("source",D):new Ln("composite",D,m.value.zoomStops),this.paint._values[A]=new _o(m.property,N,m.parameters)}}_handleOverridablePaintPropertyUpdate(A,m,w){return!(!this.layout||m.isDataDriven()||w.isDataDriven())&&Yu.hasPaintOverride(this.layout,A)}static hasPaintOverride(A,m){const w=A.get("text-field"),D=_r.paint.properties[m];let N=!1;const U=X=>{for(const ee of X)if(D.overrides&&D.overrides.hasOverride(ee))return void(N=!0)};if(w.value.kind==="constant"&&w.value.value instanceof gt)U(w.value.value.sections);else if(w.value.kind==="source"){const X=ae=>{N||(ae instanceof Ze&&nt(ae.value)===we?U(ae.value.sections):ae instanceof Oa?U(ae.sections):ae.eachChild(X))},ee=w.value;ee._styleExpression&&X(ee._styleExpression.expression)}return N}}let fc;var Vp={get paint(){return fc=fc||new tn({"background-color":new Vt(Pe.paint_background["background-color"]),"background-pattern":new vl(Pe.paint_background["background-pattern"]),"background-opacity":new Vt(Pe.paint_background["background-opacity"])})}};class Np extends Zn{constructor(A){super(A,Vp)}}let A0;var Up={get paint(){return A0=A0||new tn({"raster-opacity":new Vt(Pe.paint_raster["raster-opacity"]),"raster-hue-rotate":new Vt(Pe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Vt(Pe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Vt(Pe.paint_raster["raster-brightness-max"]),"raster-saturation":new Vt(Pe.paint_raster["raster-saturation"]),"raster-contrast":new Vt(Pe.paint_raster["raster-contrast"]),"raster-resampling":new Vt(Pe.paint_raster["raster-resampling"]),"raster-fade-duration":new Vt(Pe.paint_raster["raster-fade-duration"])})}};class jp extends Zn{constructor(A){super(A,Up)}}class Gp extends Zn{constructor(A){super(A,{}),this.onAdd=m=>{this.implementation.onAdd&&this.implementation.onAdd(m,m.painter.context.gl)},this.onRemove=m=>{this.implementation.onRemove&&this.implementation.onRemove(m,m.painter.context.gl)},this.implementation=A}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Zp{constructor(A){this._callback=A,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const Ld=63710088e-1;class Nc{constructor(A,m){if(isNaN(A)||isNaN(m))throw new Error(`Invalid LngLat object: (${A}, ${m})`);if(this.lng=+A,this.lat=+m,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Nc(Jn(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(A){const m=Math.PI/180,w=this.lat*m,D=A.lat*m,N=Math.sin(w)*Math.sin(D)+Math.cos(w)*Math.cos(D)*Math.cos((A.lng-this.lng)*m);return Ld*Math.acos(Math.min(N,1))}static convert(A){if(A instanceof Nc)return A;if(Array.isArray(A)&&(A.length===2||A.length===3))return new Nc(Number(A[0]),Number(A[1]));if(!Array.isArray(A)&&typeof A=="object"&&A!==null)return new Nc(Number("lng"in A?A.lng:A.lon),Number(A.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const c0=2*Math.PI*Ld;function pc(d){return c0*Math.cos(d*Math.PI/180)}function qp(d){return(180+d)/360}function Fr(d){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+d*Math.PI/360)))/360}function Rd(d,A){return d/pc(A)}function AA(d){return 360*d-180}function Fd(d){return 360/Math.PI*Math.atan(Math.exp((180-360*d)*Math.PI/180))-90}class Nh{constructor(A,m,w=0){this.x=+A,this.y=+m,this.z=+w}static fromLngLat(A,m=0){const w=Nc.convert(A);return new Nh(qp(w.lng),Fr(w.lat),Rd(m,w.lat))}toLngLat(){return new Nc(AA(this.x),Fd(this.y))}toAltitude(){return this.z*pc(Fd(this.y))}meterInMercatorCoordinateUnits(){return 1/c0*(A=Fd(this.y),1/Math.cos(A*Math.PI/180));var A}}function u0(d,A,m){var w=2*Math.PI*6378137/256/Math.pow(2,m);return[d*w-2*Math.PI*6378137/2,A*w-2*Math.PI*6378137/2]}class Od{constructor(A,m,w){if(A<0||A>25||w<0||w>=Math.pow(2,A)||m<0||m>=Math.pow(2,A))throw new Error(`x=${m}, y=${w}, z=${A} outside of bounds. 0<=x<${Math.pow(2,A)}, 0<=y<${Math.pow(2,A)} 0<=z<=25 `);this.z=A,this.x=m,this.y=w,this.key=Ku(0,A,A,m,w)}equals(A){return this.z===A.z&&this.x===A.x&&this.y===A.y}url(A,m,w){const D=(U=this.y,X=this.z,ee=u0(256*(N=this.x),256*(U=Math.pow(2,X)-U-1),X),ae=u0(256*(N+1),256*(U+1),X),ee[0]+","+ee[1]+","+ae[0]+","+ae[1]);var N,U,X,ee,ae;const de=function(ge,Ee,Oe){let ce,et="";for(let ot=ge;ot>0;ot--)ce=1<<ot-1,et+=(Ee&ce?1:0)+(Oe&ce?2:0);return et}(this.z,this.x,this.y);return A[(this.x+this.y)%A.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(w==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,m>1?"@2x":"").replace(/{quadkey}/g,de).replace(/{bbox-epsg-3857}/g,D)}isChildOf(A){const m=this.z-A.z;return m>0&&A.x===this.x>>m&&A.y===this.y>>m}getTilePoint(A){const m=Math.pow(2,this.z);return new yt((A.x*m-this.x)*zs,(A.y*m-this.y)*zs)}toString(){return`${this.z}/${this.x}/${this.y}`}}class h0{constructor(A,m){this.wrap=A,this.canonical=m,this.key=Ku(A,m.z,m.z,m.x,m.y)}}class Zl{constructor(A,m,w,D,N){if(A<w)throw new Error(`overscaledZ should be >= z; overscaledZ = ${A}; z = ${w}`);this.overscaledZ=A,this.wrap=m,this.canonical=new Od(w,+D,+N),this.key=Ku(m,A,w,D,N)}clone(){return new Zl(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(A){return this.overscaledZ===A.overscaledZ&&this.wrap===A.wrap&&this.canonical.equals(A.canonical)}scaledTo(A){if(A>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${A}; overscaledZ = ${this.overscaledZ}`);const m=this.canonical.z-A;return A>this.canonical.z?new Zl(A,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Zl(A,this.wrap,A,this.canonical.x>>m,this.canonical.y>>m)}calculateScaledKey(A,m){if(A>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${A}; overscaledZ = ${this.overscaledZ}`);const w=this.canonical.z-A;return A>this.canonical.z?Ku(this.wrap*+m,A,this.canonical.z,this.canonical.x,this.canonical.y):Ku(this.wrap*+m,A,A,this.canonical.x>>w,this.canonical.y>>w)}isChildOf(A){if(A.wrap!==this.wrap)return!1;const m=this.canonical.z-A.canonical.z;return A.overscaledZ===0||A.overscaledZ<this.overscaledZ&&A.canonical.x===this.canonical.x>>m&&A.canonical.y===this.canonical.y>>m}children(A){if(this.overscaledZ>=A)return[new Zl(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const m=this.canonical.z+1,w=2*this.canonical.x,D=2*this.canonical.y;return[new Zl(m,this.wrap,m,w,D),new Zl(m,this.wrap,m,w+1,D),new Zl(m,this.wrap,m,w,D+1),new Zl(m,this.wrap,m,w+1,D+1)]}isLessThan(A){return this.wrap<A.wrap||!(this.wrap>A.wrap)&&(this.overscaledZ<A.overscaledZ||!(this.overscaledZ>A.overscaledZ)&&(this.canonical.x<A.canonical.x||!(this.canonical.x>A.canonical.x)&&this.canonical.y<A.canonical.y))}wrapped(){return new Zl(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(A){return new Zl(this.overscaledZ,A,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new h0(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(A){return this.canonical.getTilePoint(new Nh(A.x-this.wrap,A.y))}}function Ku(d,A,m,w,D){(d*=2)<0&&(d=-1*d-1);const N=1<<m;return(N*N*d+N*D+w).toString(36)+m.toString(36)+A.toString(36)}Vi("CanonicalTileID",Od),Vi("OverscaledTileID",Zl,{omit:["posMatrix"]});class d0{constructor(A,m,w,D=1,N=1,U=1,X=0){if(this.uid=A,m.height!==m.width)throw new RangeError("DEM tiles must be square");if(w&&!["mapbox","terrarium","custom"].includes(w))return void Li(`"${w}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=m.height;const ee=this.dim=m.height-2;switch(this.data=new Uint32Array(m.data.buffer),w){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=D,this.greenFactor=N,this.blueFactor=U,this.baseShift=X;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let ae=0;ae<ee;ae++)this.data[this._idx(-1,ae)]=this.data[this._idx(0,ae)],this.data[this._idx(ee,ae)]=this.data[this._idx(ee-1,ae)],this.data[this._idx(ae,-1)]=this.data[this._idx(ae,0)],this.data[this._idx(ae,ee)]=this.data[this._idx(ae,ee-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(ee,-1)]=this.data[this._idx(ee-1,0)],this.data[this._idx(-1,ee)]=this.data[this._idx(0,ee-1)],this.data[this._idx(ee,ee)]=this.data[this._idx(ee-1,ee-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let ae=0;ae<ee;ae++)for(let de=0;de<ee;de++){const ge=this.get(ae,de);ge>this.max&&(this.max=ge),ge<this.min&&(this.min=ge)}}get(A,m){const w=new Uint8Array(this.data.buffer),D=4*this._idx(A,m);return this.unpack(w[D],w[D+1],w[D+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(A,m){if(A<-1||A>=this.dim+1||m<-1||m>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(m+1)*this.stride+(A+1)}unpack(A,m,w){return A*this.redFactor+m*this.greenFactor+w*this.blueFactor-this.baseShift}getPixels(){return new El({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(A,m,w){if(this.dim!==A.dim)throw new Error("dem dimension mismatch");let D=m*this.dim,N=m*this.dim+this.dim,U=w*this.dim,X=w*this.dim+this.dim;switch(m){case-1:D=N-1;break;case 1:N=D+1}switch(w){case-1:U=X-1;break;case 1:X=U+1}const ee=-m*this.dim,ae=-w*this.dim;for(let de=U;de<X;de++)for(let ge=D;ge<N;ge++)this.data[this._idx(ge,de)]=A.data[this._idx(ge+ee,de+ae)]}}Vi("DEMData",d0);class f0{constructor(A){this._stringToNumber={},this._numberToString=[];for(let m=0;m<A.length;m++){const w=A[m];this._stringToNumber[w]=m,this._numberToString[m]=w}}encode(A){return this._stringToNumber[A]}decode(A){if(A>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${A} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[A]}}class Qp{constructor(A,m,w,D,N){this.type="Feature",this._vectorTileFeature=A,A._z=m,A._x=w,A._y=D,this.properties=A.properties,this.id=N}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(A){this._geometry=A}toJSON(){const A={geometry:this.geometry};for(const m in this)m!=="_geometry"&&m!=="_vectorTileFeature"&&(A[m]=this[m]);return A}}class Vd{constructor(A,m){this.tileID=A,this.x=A.canonical.x,this.y=A.canonical.y,this.z=A.canonical.z,this.grid=new ll(zs,16,0),this.grid3D=new ll(zs,16,0),this.featureIndexArray=new st,this.promoteId=m}insert(A,m,w,D,N,U){const X=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(w,D,N);const ee=U?this.grid3D:this.grid;for(let ae=0;ae<m.length;ae++){const de=m[ae],ge=[1/0,1/0,-1/0,-1/0];for(let Ee=0;Ee<de.length;Ee++){const Oe=de[Ee];ge[0]=Math.min(ge[0],Oe.x),ge[1]=Math.min(ge[1],Oe.y),ge[2]=Math.max(ge[2],Oe.x),ge[3]=Math.max(ge[3],Oe.y)}ge[0]<zs&&ge[1]<zs&&ge[2]>=0&&ge[3]>=0&&ee.insert(X,ge[0],ge[1],ge[2],ge[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new uc.VectorTile(new dc(this.rawTileData)).layers,this.sourceLayerCoder=new f0(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(A,m,w,D){this.loadVTLayers();const N=A.params||{},U=zs/A.tileSize/A.scale,X=Ps(N.filter),ee=A.queryGeometry,ae=A.queryPadding*U,de=Hp(ee),ge=this.grid.query(de.minX-ae,de.minY-ae,de.maxX+ae,de.maxY+ae),Ee=Hp(A.cameraQueryGeometry),Oe=this.grid3D.query(Ee.minX-ae,Ee.minY-ae,Ee.maxX+ae,Ee.maxY+ae,(ot,pt,Ct,bt)=>function(_e,Ut,li,Ci,nr){for(const Pi of _e)if(Ut<=Pi.x&&li<=Pi.y&&Ci>=Pi.x&&nr>=Pi.y)return!0;const Ri=[new yt(Ut,li),new yt(Ut,nr),new yt(Ci,nr),new yt(Ci,li)];if(_e.length>2){for(const Pi of Ri)if(Gu(_e,Pi))return!0}for(let Pi=0;Pi<_e.length-1;Pi++)if(O_(_e[Pi],_e[Pi+1],Ri))return!0;return!1}(A.cameraQueryGeometry,ot-ae,pt-ae,Ct+ae,bt+ae));for(const ot of Oe)ge.push(ot);ge.sort(Uc);const ce={};let et;for(let ot=0;ot<ge.length;ot++){const pt=ge[ot];if(pt===et)continue;et=pt;const Ct=this.featureIndexArray.get(pt);let bt=null;this.loadMatchingFeature(ce,Ct.bucketIndex,Ct.sourceLayerIndex,Ct.featureIndex,X,N.layers,N.availableImages,m,w,D,(_e,Ut,li)=>(bt||(bt=wu(_e)),Ut.queryIntersectsFeature(ee,_e,li,bt,this.z,A.transform,U,A.pixelPosMatrix)))}return ce}loadMatchingFeature(A,m,w,D,N,U,X,ee,ae,de,ge){const Ee=this.bucketLayerIDs[m];if(U&&!function(ot,pt){for(let Ct=0;Ct<ot.length;Ct++)if(pt.indexOf(ot[Ct])>=0)return!0;return!1}(U,Ee))return;const Oe=this.sourceLayerCoder.decode(w),ce=this.vtLayers[Oe].feature(D);if(N.needGeometry){const ot=eu(ce,!0);if(!N.filter(new Gn(this.tileID.overscaledZ),ot,this.tileID.canonical))return}else if(!N.filter(new Gn(this.tileID.overscaledZ),ce))return;const et=this.getId(ce,Oe);for(let ot=0;ot<Ee.length;ot++){const pt=Ee[ot];if(U&&U.indexOf(pt)<0)continue;const Ct=ee[pt];if(!Ct)continue;let bt={};et&&de&&(bt=de.getState(Ct.sourceLayer||"_geojsonTileLayer",et));const _e=rn({},ae[pt]);_e.paint=Au(_e.paint,Ct.paint,ce,bt,X),_e.layout=Au(_e.layout,Ct.layout,ce,bt,X);const Ut=!ge||ge(ce,Ct,bt);if(!Ut)continue;const li=new Qp(ce,this.z,this.x,this.y,et);li.layer=_e;let Ci=A[pt];Ci===void 0&&(Ci=A[pt]=[]),Ci.push({featureIndex:D,feature:li,intersectionZ:Ut})}}lookupSymbolFeatures(A,m,w,D,N,U,X,ee){const ae={};this.loadVTLayers();const de=Ps(N);for(const ge of A)this.loadMatchingFeature(ae,w,D,ge,de,U,X,ee,m);return ae}hasLayer(A){for(const m of this.bucketLayerIDs)for(const w of m)if(A===w)return!0;return!1}getId(A,m){let w=A.id;return this.promoteId&&(w=A.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[m]],typeof w=="boolean"&&(w=Number(w))),w}}function Au(d,A,m,w,D){return At(d,(N,U)=>{const X=A instanceof Ea?A.get(U):null;return X&&X.evaluate?X.evaluate(m,w,D):X})}function Hp(d){let A=1/0,m=1/0,w=-1/0,D=-1/0;for(const N of d)A=Math.min(A,N.x),m=Math.min(m,N.y),w=Math.max(w,N.x),D=Math.max(D,N.y);return{minX:A,minY:m,maxX:w,maxY:D}}function Uc(d,A){return A-d}function ql(d,A,m,w,D){const N=[];for(let U=0;U<d.length;U++){const X=d[U];let ee;for(let ae=0;ae<X.length-1;ae++){let de=X[ae],ge=X[ae+1];de.x<A&&ge.x<A||(de.x<A?de=new yt(A,de.y+(A-de.x)/(ge.x-de.x)*(ge.y-de.y))._round():ge.x<A&&(ge=new yt(A,de.y+(A-de.x)/(ge.x-de.x)*(ge.y-de.y))._round()),de.y<m&&ge.y<m||(de.y<m?de=new yt(de.x+(m-de.y)/(ge.y-de.y)*(ge.x-de.x),m)._round():ge.y<m&&(ge=new yt(de.x+(m-de.y)/(ge.y-de.y)*(ge.x-de.x),m)._round()),de.x>=w&&ge.x>=w||(de.x>=w?de=new yt(w,de.y+(w-de.x)/(ge.x-de.x)*(ge.y-de.y))._round():ge.x>=w&&(ge=new yt(w,de.y+(w-de.x)/(ge.x-de.x)*(ge.y-de.y))._round()),de.y>=D&&ge.y>=D||(de.y>=D?de=new yt(de.x+(D-de.y)/(ge.y-de.y)*(ge.x-de.x),D)._round():ge.y>=D&&(ge=new yt(de.x+(D-de.y)/(ge.y-de.y)*(ge.x-de.x),D)._round()),ee&&de.equals(ee[ee.length-1])||(ee=[de],N.push(ee)),ee.push(ge)))))}}return N}Vi("FeatureIndex",Vd,{omit:["rawTileData","sourceLayerCoder"]});class jc extends yt{constructor(A,m,w,D){super(A,m),this.angle=w,D!==void 0&&(this.segment=D)}clone(){return new jc(this.x,this.y,this.angle,this.segment)}}function Uh(d,A,m,w,D){if(A.segment===void 0||m===0)return!0;let N=A,U=A.segment+1,X=0;for(;X>-m/2;){if(U--,U<0)return!1;X-=d[U].dist(N),N=d[U]}X+=d[U].dist(d[U+1]),U++;const ee=[];let ae=0;for(;X<m/2;){const de=d[U],ge=d[U+1];if(!ge)return!1;let Ee=d[U-1].angleTo(de)-de.angleTo(ge);for(Ee=Math.abs((Ee+3*Math.PI)%(2*Math.PI)-Math.PI),ee.push({distance:X,angleDelta:Ee}),ae+=Ee;X-ee[0].distance>w;)ae-=ee.shift().angleDelta;if(ae>D)return!1;U++,X+=de.dist(ge)}return!0}function Nd(d){let A=0;for(let m=0;m<d.length-1;m++)A+=d[m].dist(d[m+1]);return A}function p0(d,A,m){return d?.6*A*m:0}function m0(d,A){return Math.max(d?d.right-d.left:0,A?A.right-A.left:0)}function Wp(d,A,m,w,D,N){const U=p0(m,D,N),X=m0(m,w)*N;let ee=0;const ae=Nd(d)/2;for(let de=0;de<d.length-1;de++){const ge=d[de],Ee=d[de+1],Oe=ge.dist(Ee);if(ee+Oe>ae){const ce=(ae-ee)/Oe,et=ar.number(ge.x,Ee.x,ce),ot=ar.number(ge.y,Ee.y,ce),pt=new jc(et,ot,Ee.angleTo(ge),de);return pt._round(),!U||Uh(d,pt,X,U,A)?pt:void 0}ee+=Oe}}function $p(d,A,m,w,D,N,U,X,ee){const ae=p0(w,N,U),de=m0(w,D),ge=de*U,Ee=d[0].x===0||d[0].x===ee||d[0].y===0||d[0].y===ee;return A-ge<A/4&&(A=ge+A/4),jh(d,Ee?A/2*X%A:(de/2+2*N)*U*X%A,A,ae,m,ge,Ee,!1,ee)}function jh(d,A,m,w,D,N,U,X,ee){const ae=N/2,de=Nd(d);let ge=0,Ee=A-m,Oe=[];for(let ce=0;ce<d.length-1;ce++){const et=d[ce],ot=d[ce+1],pt=et.dist(ot),Ct=ot.angleTo(et);for(;Ee+m<ge+pt;){Ee+=m;const bt=(Ee-ge)/pt,_e=ar.number(et.x,ot.x,bt),Ut=ar.number(et.y,ot.y,bt);if(_e>=0&&_e<ee&&Ut>=0&&Ut<ee&&Ee-ae>=0&&Ee+ae<=de){const li=new jc(_e,Ut,Ct,ce);li._round(),w&&!Uh(d,li,N,w,D)||Oe.push(li)}}ge+=pt}return X||Oe.length||U||(Oe=jh(d,ge/2,m,w,D,N,U,!0,ee)),Oe}Vi("Anchor",jc);const Pu=qn;function _0(d,A,m,w){const D=[],N=d.image,U=N.pixelRatio,X=N.paddedRect.w-2*Pu,ee=N.paddedRect.h-2*Pu,ae=d.right-d.left,de=d.bottom-d.top,ge=N.stretchX||[[0,X]],Ee=N.stretchY||[[0,ee]],Oe=(wi,Wi)=>wi+Wi[1]-Wi[0],ce=ge.reduce(Oe,0),et=Ee.reduce(Oe,0),ot=X-ce,pt=ee-et;let Ct=0,bt=ce,_e=0,Ut=et,li=0,Ci=ot,nr=0,Ri=pt;if(N.content&&w){const wi=N.content;Ct=Gh(ge,0,wi[0]),_e=Gh(Ee,0,wi[1]),bt=Gh(ge,wi[0],wi[2]),Ut=Gh(Ee,wi[1],wi[3]),li=wi[0]-Ct,nr=wi[1]-_e,Ci=wi[2]-wi[0]-bt,Ri=wi[3]-wi[1]-Ut}const Pi=(wi,Wi,ki,ci)=>{const fr=Zh(wi.stretch-Ct,bt,ae,d.left),fi=Ju(wi.fixed-li,Ci,wi.stretch,ce),Wr=Zh(Wi.stretch-_e,Ut,de,d.top),vs=Ju(Wi.fixed-nr,Ri,Wi.stretch,et),ps=Zh(ki.stretch-Ct,bt,ae,d.left),yo=Ju(ki.fixed-li,Ci,ki.stretch,ce),Ca=Zh(ci.stretch-_e,Ut,de,d.top),$a=Ju(ci.fixed-nr,Ri,ci.stretch,et),xo=new yt(fr,Wr),Ko=new yt(ps,Wr),Gs=new yt(ps,Ca),$r=new yt(fr,Ca),Jo=new yt(fi/U,vs/U),Cs=new yt(yo/U,$a/U),Fn=A*Math.PI/180;if(Fn){const ua=Math.sin(Fn),Zs=Math.cos(Fn),qs=[Zs,-ua,ua,Zs];xo._matMult(qs),Ko._matMult(qs),$r._matMult(qs),Gs._matMult(qs)}const Xa=wi.stretch+wi.fixed,Vo=Wi.stretch+Wi.fixed;return{tl:xo,tr:Ko,bl:$r,br:Gs,tex:{x:N.paddedRect.x+Pu+Xa,y:N.paddedRect.y+Pu+Vo,w:ki.stretch+ki.fixed-Xa,h:ci.stretch+ci.fixed-Vo},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Jo,pixelOffsetBR:Cs,minFontScaleX:Ci/U/ae,minFontScaleY:Ri/U/de,isSDF:m}};if(w&&(N.stretchX||N.stretchY)){const wi=g0(ge,ot,ce),Wi=g0(Ee,pt,et);for(let ki=0;ki<wi.length-1;ki++){const ci=wi[ki],fr=wi[ki+1];for(let fi=0;fi<Wi.length-1;fi++)D.push(Pi(ci,Wi[fi],fr,Wi[fi+1]))}}else D.push(Pi({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:X+1},{fixed:0,stretch:ee+1}));return D}function Gh(d,A,m){let w=0;for(const D of d)w+=Math.max(A,Math.min(m,D[1]))-Math.max(A,Math.min(m,D[0]));return w}function g0(d,A,m){const w=[{fixed:-Pu,stretch:0}];for(const[D,N]of d){const U=w[w.length-1];w.push({fixed:D-U.stretch,stretch:U.stretch}),w.push({fixed:D-U.stretch,stretch:U.stretch+(N-D)})}return w.push({fixed:A+Pu,stretch:m}),w}function Zh(d,A,m,w){return d/A*m+w}function Ju(d,A,m,w){return d-A*m/w}class Ql{constructor(A,m,w,D,N,U,X,ee,ae,de){if(this.boxStartIndex=A.length,ae){let ge=U.top,Ee=U.bottom;const Oe=U.collisionPadding;Oe&&(ge-=Oe[1],Ee+=Oe[3]);let ce=Ee-ge;ce>0&&(ce=Math.max(10,ce),this.circleDiameter=ce)}else{let ge=U.top*X-ee[0],Ee=U.bottom*X+ee[2],Oe=U.left*X-ee[3],ce=U.right*X+ee[1];const et=U.collisionPadding;if(et&&(Oe-=et[0]*X,ge-=et[1]*X,ce+=et[2]*X,Ee+=et[3]*X),de){const ot=new yt(Oe,ge),pt=new yt(ce,ge),Ct=new yt(Oe,Ee),bt=new yt(ce,Ee),_e=de*Math.PI/180;ot._rotate(_e),pt._rotate(_e),Ct._rotate(_e),bt._rotate(_e),Oe=Math.min(ot.x,pt.x,Ct.x,bt.x),ce=Math.max(ot.x,pt.x,Ct.x,bt.x),ge=Math.min(ot.y,pt.y,Ct.y,bt.y),Ee=Math.max(ot.y,pt.y,Ct.y,bt.y)}A.emplaceBack(m.x,m.y,Oe,ge,ce,Ee,w,D,N)}this.boxEndIndex=A.length}}class Xp{constructor(A=[],m=Yp){if(this.data=A,this.length=this.data.length,this.compare=m,this.length>0)for(let w=(this.length>>1)-1;w>=0;w--)this._down(w)}push(A){this.data.push(A),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const A=this.data[0],m=this.data.pop();return this.length--,this.length>0&&(this.data[0]=m,this._down(0)),A}peek(){return this.data[0]}_up(A){const{data:m,compare:w}=this,D=m[A];for(;A>0;){const N=A-1>>1,U=m[N];if(w(D,U)>=0)break;m[A]=U,A=N}m[A]=D}_down(A){const{data:m,compare:w}=this,D=this.length>>1,N=m[A];for(;A<D;){let U=1+(A<<1),X=m[U];const ee=U+1;if(ee<this.length&&w(m[ee],X)<0&&(U=ee,X=m[ee]),w(X,N)>=0)break;m[A]=X,A=U}m[A]=N}}function Yp(d,A){return d<A?-1:d>A?1:0}function Y_(d,A=1,m=!1){let w=1/0,D=1/0,N=-1/0,U=-1/0;const X=d[0];for(let Oe=0;Oe<X.length;Oe++){const ce=X[Oe];(!Oe||ce.x<w)&&(w=ce.x),(!Oe||ce.y<D)&&(D=ce.y),(!Oe||ce.x>N)&&(N=ce.x),(!Oe||ce.y>U)&&(U=ce.y)}const ee=Math.min(N-w,U-D);let ae=ee/2;const de=new Xp([],y0);if(ee===0)return new yt(w,D);for(let Oe=w;Oe<N;Oe+=ee)for(let ce=D;ce<U;ce+=ee)de.push(new cu(Oe+ae,ce+ae,ae,d));let ge=function(Oe){let ce=0,et=0,ot=0;const pt=Oe[0];for(let Ct=0,bt=pt.length,_e=bt-1;Ct<bt;_e=Ct++){const Ut=pt[Ct],li=pt[_e],Ci=Ut.x*li.y-li.x*Ut.y;et+=(Ut.x+li.x)*Ci,ot+=(Ut.y+li.y)*Ci,ce+=3*Ci}return new cu(et/ce,ot/ce,0,Oe)}(d),Ee=de.length;for(;de.length;){const Oe=de.pop();(Oe.d>ge.d||!ge.d)&&(ge=Oe,m&&console.log("found best %d after %d probes",Math.round(1e4*Oe.d)/1e4,Ee)),Oe.max-ge.d<=A||(ae=Oe.h/2,de.push(new cu(Oe.p.x-ae,Oe.p.y-ae,ae,d)),de.push(new cu(Oe.p.x+ae,Oe.p.y-ae,ae,d)),de.push(new cu(Oe.p.x-ae,Oe.p.y+ae,ae,d)),de.push(new cu(Oe.p.x+ae,Oe.p.y+ae,ae,d)),Ee+=4)}return m&&(console.log(`num probes: ${Ee}`),console.log(`best distance: ${ge.d}`)),ge.p}function y0(d,A){return A.max-d.max}function cu(d,A,m,w){this.p=new yt(d,A),this.h=m,this.d=function(D,N){let U=!1,X=1/0;for(let ee=0;ee<N.length;ee++){const ae=N[ee];for(let de=0,ge=ae.length,Ee=ge-1;de<ge;Ee=de++){const Oe=ae[de],ce=ae[Ee];Oe.y>D.y!=ce.y>D.y&&D.x<(ce.x-Oe.x)*(D.y-Oe.y)/(ce.y-Oe.y)+Oe.x&&(U=!U),X=Math.min(X,dp(D,Oe,ce))}}return(U?1:-1)*Math.sqrt(X)}(this.p,w),this.max=this.d+this.h*Math.SQRT2}var Sa;P.aq=void 0,(Sa=P.aq||(P.aq={}))[Sa.center=1]="center",Sa[Sa.left=2]="left",Sa[Sa.right=3]="right",Sa[Sa.top=4]="top",Sa[Sa.bottom=5]="bottom",Sa[Sa["top-left"]=6]="top-left",Sa[Sa["top-right"]=7]="top-right",Sa[Sa["bottom-left"]=8]="bottom-left",Sa[Sa["bottom-right"]=9]="bottom-right";const Ia=7,x0=Number.POSITIVE_INFINITY;function Qr(d,A){return A[1]!==x0?function(m,w,D){let N=0,U=0;switch(w=Math.abs(w),D=Math.abs(D),m){case"top-right":case"top-left":case"top":U=D-Ia;break;case"bottom-right":case"bottom-left":case"bottom":U=-D+Ia}switch(m){case"top-right":case"bottom-right":case"right":N=-w;break;case"top-left":case"bottom-left":case"left":N=w}return[N,U]}(d,A[0],A[1]):function(m,w){let D=0,N=0;w<0&&(w=0);const U=w/Math.SQRT2;switch(m){case"top-right":case"top-left":N=U-Ia;break;case"bottom-right":case"bottom-left":N=-U+Ia;break;case"bottom":N=-w+Ia;break;case"top":N=w-Ia}switch(m){case"top-right":case"bottom-right":D=-U;break;case"top-left":case"bottom-left":D=U;break;case"left":D=w;break;case"right":D=-w}return[D,N]}(d,A[0])}function Ud(d,A,m){var w;const D=d.layout,N=(w=D.get("text-variable-anchor-offset"))===null||w===void 0?void 0:w.evaluate(A,{},m);if(N){const X=N.values,ee=[];for(let ae=0;ae<X.length;ae+=2){const de=ee[ae]=X[ae],ge=X[ae+1].map(Ee=>Ee*Eo);de.startsWith("top")?ge[1]-=Ia:de.startsWith("bottom")&&(ge[1]+=Ia),ee[ae+1]=ge}return new Ar(ee)}const U=D.get("text-variable-anchor");if(U){let X;X=d._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[D.get("text-radial-offset").evaluate(A,{},m)*Eo,x0]:D.get("text-offset").evaluate(A,{},m).map(ae=>ae*Eo);const ee=[];for(const ae of U)ee.push(ae,Qr(ae,X));return new Ar(ee)}return null}function Wa(d){switch(d){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Gc(d,A,m,w,D,N,U,X,ee,ae,de){let ge=N.textMaxSize.evaluate(A,{});ge===void 0&&(ge=U);const Ee=d.layers[0].layout,Oe=Ee.get("icon-offset").evaluate(A,{},de),ce=b0(m.horizontal),et=U/24,ot=d.tilePixelRatio*et,pt=d.tilePixelRatio*ge/24,Ct=d.tilePixelRatio*X,bt=d.tilePixelRatio*Ee.get("symbol-spacing"),_e=Ee.get("text-padding")*d.tilePixelRatio,Ut=function(ci,fr,fi,Wr=1){const vs=ci.get("icon-padding").evaluate(fr,{},fi),ps=vs&&vs.values;return[ps[0]*Wr,ps[1]*Wr,ps[2]*Wr,ps[3]*Wr]}(Ee,A,de,d.tilePixelRatio),li=Ee.get("text-max-angle")/180*Math.PI,Ci=Ee.get("text-rotation-alignment")!=="viewport"&&Ee.get("symbol-placement")!=="point",nr=Ee.get("icon-rotation-alignment")==="map"&&Ee.get("symbol-placement")!=="point",Ri=Ee.get("symbol-placement"),Pi=bt/2,wi=Ee.get("icon-text-fit");let Wi;w&&wi!=="none"&&(d.allowVerticalPlacement&&m.vertical&&(Wi=Dd(w,m.vertical,wi,Ee.get("icon-text-fit-padding"),Oe,et)),ce&&(w=Dd(w,ce,wi,Ee.get("icon-text-fit-padding"),Oe,et)));const ki=(ci,fr)=>{fr.x<0||fr.x>=zs||fr.y<0||fr.y>=zs||function(fi,Wr,vs,ps,yo,Ca,$a,xo,Ko,Gs,$r,Jo,Cs,Fn,Xa,Vo,ua,Zs,qs,No,hn,ka,Da,vo,lo){const ha=fi.addToLineVertexArray(Wr,vs);let bA,_c,Hl,hl,Ya=0,Wl=0,da=0,rh=0,nh=-1,Hd=-1;const dl={};let Wd=yA("");if(fi.allowVerticalPlacement&&ps.vertical){const Ka=xo.layout.get("text-rotate").evaluate(hn,{},vo)+90;Hl=new Ql(Ko,Wr,Gs,$r,Jo,ps.vertical,Cs,Fn,Xa,Ka),$a&&(hl=new Ql(Ko,Wr,Gs,$r,Jo,$a,ua,Zs,Xa,Ka))}if(yo){const Ka=xo.layout.get("icon-rotate").evaluate(hn,{}),Pa=xo.layout.get("icon-text-fit")!=="none",Zc=_0(yo,Ka,Da,Pa),za=$a?_0($a,Ka,Da,Pa):void 0;_c=new Ql(Ko,Wr,Gs,$r,Jo,yo,ua,Zs,!1,Ka),Ya=4*Zc.length;const rr=fi.iconSizeData;let gc=null;rr.kind==="source"?(gc=[qA*xo.layout.get("icon-size").evaluate(hn,{})],gc[0]>Vc&&Li(`${fi.layerIds[0]}: Value for "icon-size" is >= ${Ha}. Reduce your "icon-size".`)):rr.kind==="composite"&&(gc=[qA*ka.compositeIconSizes[0].evaluate(hn,{},vo),qA*ka.compositeIconSizes[1].evaluate(hn,{},vo)],(gc[0]>Vc||gc[1]>Vc)&&Li(`${fi.layerIds[0]}: Value for "icon-size" is >= ${Ha}. Reduce your "icon-size".`)),fi.addSymbols(fi.icon,Zc,gc,No,qs,hn,P.ai.none,Wr,ha.lineStartIndex,ha.lineLength,-1,vo),nh=fi.icon.placedSymbolArray.length-1,za&&(Wl=4*za.length,fi.addSymbols(fi.icon,za,gc,No,qs,hn,P.ai.vertical,Wr,ha.lineStartIndex,ha.lineLength,-1,vo),Hd=fi.icon.placedSymbolArray.length-1)}const $d=Object.keys(ps.horizontal);for(const Ka of $d){const Pa=ps.horizontal[Ka];if(!bA){Wd=yA(Pa.text);const za=xo.layout.get("text-rotate").evaluate(hn,{},vo);bA=new Ql(Ko,Wr,Gs,$r,Jo,Pa,Cs,Fn,Xa,za)}const Zc=Pa.positionedLines.length===1;if(da+=v0(fi,Wr,Pa,Ca,xo,Xa,hn,Vo,ha,ps.vertical?P.ai.horizontal:P.ai.horizontalOnly,Zc?$d:[Ka],dl,nh,ka,vo),Zc)break}ps.vertical&&(rh+=v0(fi,Wr,ps.vertical,Ca,xo,Xa,hn,Vo,ha,P.ai.vertical,["vertical"],dl,Hd,ka,vo));const Jp=bA?bA.boxStartIndex:fi.collisionBoxArray.length,em=bA?bA.boxEndIndex:fi.collisionBoxArray.length,tm=Hl?Hl.boxStartIndex:fi.collisionBoxArray.length,Uo=Hl?Hl.boxEndIndex:fi.collisionBoxArray.length,im=_c?_c.boxStartIndex:fi.collisionBoxArray.length,rm=_c?_c.boxEndIndex:fi.collisionBoxArray.length,nm=hl?hl.boxStartIndex:fi.collisionBoxArray.length,K_=hl?hl.boxEndIndex:fi.collisionBoxArray.length;let wA=-1;const Qh=(Ka,Pa)=>Ka&&Ka.circleDiameter?Math.max(Ka.circleDiameter,Pa):Pa;wA=Qh(bA,wA),wA=Qh(Hl,wA),wA=Qh(_c,wA),wA=Qh(hl,wA);const Hh=wA>-1?1:0;Hh&&(wA*=lo/Eo),fi.glyphOffsetArray.length>=Du.MAX_GLYPHS&&Li("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),hn.sortKey!==void 0&&fi.addToSortKeyRanges(fi.symbolInstances.length,hn.sortKey);const sm=Ud(xo,hn,vo),[J_,eg]=function(Ka,Pa){const Zc=Ka.length,za=Pa==null?void 0:Pa.values;if((za==null?void 0:za.length)>0)for(let rr=0;rr<za.length;rr+=2){const gc=za[rr+1];Ka.emplaceBack(P.aq[za[rr]],gc[0],gc[1])}return[Zc,Ka.length]}(fi.textAnchorOffsets,sm);fi.symbolInstances.emplaceBack(Wr.x,Wr.y,dl.right>=0?dl.right:-1,dl.center>=0?dl.center:-1,dl.left>=0?dl.left:-1,dl.vertical||-1,nh,Hd,Wd,Jp,em,tm,Uo,im,rm,nm,K_,Gs,da,rh,Ya,Wl,Hh,0,Cs,wA,J_,eg)}(d,fr,ci,m,w,D,Wi,d.layers[0],d.collisionBoxArray,A.index,A.sourceLayerIndex,d.index,ot,[_e,_e,_e,_e],Ci,ee,Ct,Ut,nr,Oe,A,N,ae,de,U)};if(Ri==="line")for(const ci of ql(A.geometry,0,0,zs,zs)){const fr=$p(ci,bt,li,m.vertical||ce,w,24,pt,d.overscaling,zs);for(const fi of fr)ce&&w0(d,ce.text,Pi,fi)||ki(ci,fi)}else if(Ri==="line-center"){for(const ci of A.geometry)if(ci.length>1){const fr=Wp(ci,li,m.vertical||ce,w,24,pt);fr&&ki(ci,fr)}}else if(A.type==="Polygon")for(const ci of un(A.geometry,0)){const fr=Y_(ci,16);ki(ci[0],new jc(fr.x,fr.y,0))}else if(A.type==="LineString")for(const ci of A.geometry)ki(ci,new jc(ci[0].x,ci[0].y,0));else if(A.type==="Point")for(const ci of A.geometry)for(const fr of ci)ki([fr],new jc(fr.x,fr.y,0))}function v0(d,A,m,w,D,N,U,X,ee,ae,de,ge,Ee,Oe,ce){const et=function(Ct,bt,_e,Ut,li,Ci,nr,Ri){const Pi=Ut.layout.get("text-rotate").evaluate(Ci,{})*Math.PI/180,wi=[];for(const Wi of bt.positionedLines)for(const ki of Wi.positionedGlyphs){if(!ki.rect)continue;const ci=ki.rect||{};let fr=t0+1,fi=!0,Wr=1,vs=0;const ps=(li||Ri)&&ki.vertical,yo=ki.metrics.advance*ki.scale/2;if(Ri&&bt.verticalizable&&(vs=Wi.lineOffset/2-(ki.imageName?-(Eo-ki.metrics.width*ki.scale)/2:(ki.scale-1)*Eo)),ki.imageName){const No=nr[ki.imageName];fi=No.sdf,Wr=No.pixelRatio,fr=qn/Wr}const Ca=li?[ki.x+yo,ki.y]:[0,0];let $a=li?[0,0]:[ki.x+yo+_e[0],ki.y+_e[1]-vs],xo=[0,0];ps&&(xo=$a,$a=[0,0]);const Ko=ki.metrics.isDoubleResolution?2:1,Gs=(ki.metrics.left-fr)*ki.scale-yo+$a[0],$r=(-ki.metrics.top-fr)*ki.scale+$a[1],Jo=Gs+ci.w/Ko*ki.scale/Wr,Cs=$r+ci.h/Ko*ki.scale/Wr,Fn=new yt(Gs,$r),Xa=new yt(Jo,$r),Vo=new yt(Gs,Cs),ua=new yt(Jo,Cs);if(ps){const No=new yt(-yo,yo-Fh),hn=-Math.PI/2,ka=Eo/2-yo,Da=new yt(5-Fh-ka,-(ki.imageName?ka:0)),vo=new yt(...xo);Fn._rotateAround(hn,No)._add(Da)._add(vo),Xa._rotateAround(hn,No)._add(Da)._add(vo),Vo._rotateAround(hn,No)._add(Da)._add(vo),ua._rotateAround(hn,No)._add(Da)._add(vo)}if(Pi){const No=Math.sin(Pi),hn=Math.cos(Pi),ka=[hn,-No,No,hn];Fn._matMult(ka),Xa._matMult(ka),Vo._matMult(ka),ua._matMult(ka)}const Zs=new yt(0,0),qs=new yt(0,0);wi.push({tl:Fn,tr:Xa,bl:Vo,br:ua,tex:ci,writingMode:bt.writingMode,glyphOffset:Ca,sectionIndex:ki.sectionIndex,isSDF:fi,pixelOffsetTL:Zs,pixelOffsetBR:qs,minFontScaleX:0,minFontScaleY:0})}return wi}(0,m,X,D,N,U,w,d.allowVerticalPlacement),ot=d.textSizeData;let pt=null;ot.kind==="source"?(pt=[qA*D.layout.get("text-size").evaluate(U,{})],pt[0]>Vc&&Li(`${d.layerIds[0]}: Value for "text-size" is >= ${Ha}. Reduce your "text-size".`)):ot.kind==="composite"&&(pt=[qA*Oe.compositeTextSizes[0].evaluate(U,{},ce),qA*Oe.compositeTextSizes[1].evaluate(U,{},ce)],(pt[0]>Vc||pt[1]>Vc)&&Li(`${d.layerIds[0]}: Value for "text-size" is >= ${Ha}. Reduce your "text-size".`)),d.addSymbols(d.text,et,pt,X,N,U,ae,A,ee.lineStartIndex,ee.lineLength,Ee,ce);for(const Ct of de)ge[Ct]=d.text.placedSymbolArray.length-1;return 4*et.length}function b0(d){for(const A in d)return d[A];return null}function w0(d,A,m,w){const D=d.compareText;if(A in D){const N=D[A];for(let U=N.length-1;U>=0;U--)if(w.dist(N[U])<m)return!0}else D[A]=[];return D[A].push(w),!1}const T0=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class jd{static from(A){if(!(A instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[m,w]=new Uint8Array(A,0,2);if(m!==219)throw new Error("Data does not appear to be in a KDBush format.");const D=w>>4;if(D!==1)throw new Error(`Got v${D} data when expected v1.`);const N=T0[15&w];if(!N)throw new Error("Unrecognized array type.");const[U]=new Uint16Array(A,2,1),[X]=new Uint32Array(A,4,1);return new jd(X,U,N,A)}constructor(A,m=64,w=Float64Array,D){if(isNaN(A)||A<0)throw new Error(`Unpexpected numItems value: ${A}.`);this.numItems=+A,this.nodeSize=Math.min(Math.max(+m,2),65535),this.ArrayType=w,this.IndexArrayType=A<65536?Uint16Array:Uint32Array;const N=T0.indexOf(this.ArrayType),U=2*A*this.ArrayType.BYTES_PER_ELEMENT,X=A*this.IndexArrayType.BYTES_PER_ELEMENT,ee=(8-X%8)%8;if(N<0)throw new Error(`Unexpected typed array class: ${w}.`);D&&D instanceof ArrayBuffer?(this.data=D,this.ids=new this.IndexArrayType(this.data,8,A),this.coords=new this.ArrayType(this.data,8+X+ee,2*A),this._pos=2*A,this._finished=!0):(this.data=new ArrayBuffer(8+U+X+ee),this.ids=new this.IndexArrayType(this.data,8,A),this.coords=new this.ArrayType(this.data,8+X+ee,2*A),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+N]),new Uint16Array(this.data,2,1)[0]=m,new Uint32Array(this.data,4,1)[0]=A)}add(A,m){const w=this._pos>>1;return this.ids[w]=w,this.coords[this._pos++]=A,this.coords[this._pos++]=m,w}finish(){const A=this._pos>>1;if(A!==this.numItems)throw new Error(`Added ${A} items when expected ${this.numItems}.`);return Gd(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(A,m,w,D){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:N,coords:U,nodeSize:X}=this,ee=[0,N.length-1,0],ae=[];for(;ee.length;){const de=ee.pop()||0,ge=ee.pop()||0,Ee=ee.pop()||0;if(ge-Ee<=X){for(let ot=Ee;ot<=ge;ot++){const pt=U[2*ot],Ct=U[2*ot+1];pt>=A&&pt<=w&&Ct>=m&&Ct<=D&&ae.push(N[ot])}continue}const Oe=Ee+ge>>1,ce=U[2*Oe],et=U[2*Oe+1];ce>=A&&ce<=w&&et>=m&&et<=D&&ae.push(N[Oe]),(de===0?A<=ce:m<=et)&&(ee.push(Ee),ee.push(Oe-1),ee.push(1-de)),(de===0?w>=ce:D>=et)&&(ee.push(Oe+1),ee.push(ge),ee.push(1-de))}return ae}within(A,m,w){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:D,coords:N,nodeSize:U}=this,X=[0,D.length-1,0],ee=[],ae=w*w;for(;X.length;){const de=X.pop()||0,ge=X.pop()||0,Ee=X.pop()||0;if(ge-Ee<=U){for(let ot=Ee;ot<=ge;ot++)Cr(N[2*ot],N[2*ot+1],A,m)<=ae&&ee.push(D[ot]);continue}const Oe=Ee+ge>>1,ce=N[2*Oe],et=N[2*Oe+1];Cr(ce,et,A,m)<=ae&&ee.push(D[Oe]),(de===0?A-w<=ce:m-w<=et)&&(X.push(Ee),X.push(Oe-1),X.push(1-de)),(de===0?A+w>=ce:m+w>=et)&&(X.push(Oe+1),X.push(ge),X.push(1-de))}return ee}}function Gd(d,A,m,w,D,N){if(D-w<=m)return;const U=w+D>>1;E0(d,A,U,w,D,N),Gd(d,A,m,w,U-1,1-N),Gd(d,A,m,U+1,D,1-N)}function E0(d,A,m,w,D,N){for(;D>w;){if(D-w>600){const ae=D-w+1,de=m-w+1,ge=Math.log(ae),Ee=.5*Math.exp(2*ge/3),Oe=.5*Math.sqrt(ge*Ee*(ae-Ee)/ae)*(de-ae/2<0?-1:1);E0(d,A,m,Math.max(w,Math.floor(m-de*Ee/ae+Oe)),Math.min(D,Math.floor(m+(ae-de)*Ee/ae+Oe)),N)}const U=A[2*m+N];let X=w,ee=D;for(eh(d,A,w,m),A[2*D+N]>U&&eh(d,A,w,D);X<ee;){for(eh(d,A,X,ee),X++,ee--;A[2*X+N]<U;)X++;for(;A[2*ee+N]>U;)ee--}A[2*w+N]===U?eh(d,A,w,ee):(ee++,eh(d,A,ee,D)),ee<=m&&(w=ee+1),m<=ee&&(D=ee-1)}}function eh(d,A,m,w){th(d,m,w),th(A,2*m,2*w),th(A,2*m+1,2*w+1)}function th(d,A,m){const w=d[A];d[A]=d[m],d[m]=w}function Cr(d,A,m,w){const D=d-m,N=A-w;return D*D+N*N}var qh;P.bh=void 0,(qh=P.bh||(P.bh={})).create="create",qh.load="load",qh.fullLoad="fullLoad";let mc=null,ih=[];const Zd=1e3/60,qd="loadTime",Qd="fullLoadTime",Kp={mark(d){performance.mark(d)},frame(d){const A=d;mc!=null&&ih.push(A-mc),mc=A},clearMetrics(){mc=null,ih=[],performance.clearMeasures(qd),performance.clearMeasures(Qd);for(const d in P.bh)performance.clearMarks(P.bh[d])},getPerformanceMetrics(){performance.measure(qd,P.bh.create,P.bh.load),performance.measure(Qd,P.bh.create,P.bh.fullLoad);const d=performance.getEntriesByName(qd)[0].duration,A=performance.getEntriesByName(Qd)[0].duration,m=ih.length,w=1/(ih.reduce((N,U)=>N+U,0)/m/1e3),D=ih.filter(N=>N>Zd).reduce((N,U)=>N+(U-Zd)/Zd,0);return{loadTime:d,fullLoadTime:A,fps:w,percentDroppedFrames:D/(m+D)*100,totalFrames:m}}};P.$=function(d,A,m){var w,D,N,U,X,ee,ae,de,ge,Ee,Oe,ce,et=m[0],ot=m[1],pt=m[2];return A===d?(d[12]=A[0]*et+A[4]*ot+A[8]*pt+A[12],d[13]=A[1]*et+A[5]*ot+A[9]*pt+A[13],d[14]=A[2]*et+A[6]*ot+A[10]*pt+A[14],d[15]=A[3]*et+A[7]*ot+A[11]*pt+A[15]):(D=A[1],N=A[2],U=A[3],X=A[4],ee=A[5],ae=A[6],de=A[7],ge=A[8],Ee=A[9],Oe=A[10],ce=A[11],d[0]=w=A[0],d[1]=D,d[2]=N,d[3]=U,d[4]=X,d[5]=ee,d[6]=ae,d[7]=de,d[8]=ge,d[9]=Ee,d[10]=Oe,d[11]=ce,d[12]=w*et+X*ot+ge*pt+A[12],d[13]=D*et+ee*ot+Ee*pt+A[13],d[14]=N*et+ae*ot+Oe*pt+A[14],d[15]=U*et+de*ot+ce*pt+A[15]),d},P.A=Ic,P.B=ar,P.C=class{constructor(d,A,m){this.receive=w=>{const D=w.data,N=D.id;if(N&&(!D.targetMapId||this.mapId===D.targetMapId))if(D.type==="<cancel>"){delete this.tasks[N];const U=this.cancelCallbacks[N];delete this.cancelCallbacks[N],U&&U()}else es()||D.mustQueue?(this.tasks[N]=D,this.taskQueue.push(N),this.invoker.trigger()):this.processTask(N,D)},this.process=()=>{if(!this.taskQueue.length)return;const w=this.taskQueue.shift(),D=this.tasks[w];delete this.tasks[w],this.taskQueue.length&&this.invoker.trigger(),D&&this.processTask(w,D)},this.target=d,this.parent=A,this.mapId=m,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},this.invoker=new Zp(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=es()?d:window}send(d,A,m,w,D=!1){const N=Math.round(1e18*Math.random()).toString(36).substring(0,10);m&&(this.callbacks[N]=m);const U=[],X={id:N,type:d,hasCallback:!!m,targetMapId:w,mustQueue:D,sourceMapId:this.mapId,data:Za(A,U)};return this.target.postMessage(X,{transfer:U}),{cancel:()=>{m&&delete this.callbacks[N],this.target.postMessage({id:N,type:"<cancel>",targetMapId:w,sourceMapId:this.mapId})}}}processTask(d,A){if(A.type==="<response>"){const m=this.callbacks[d];delete this.callbacks[d],m&&(A.error?m(Al(A.error)):m(null,Al(A.data)))}else{let m=!1;const w=[],D=A.hasCallback?(X,ee)=>{m=!0,delete this.cancelCallbacks[d];const ae={id:d,type:"<response>",sourceMapId:this.mapId,error:X?Za(X):null,data:Za(ee,w)};this.target.postMessage(ae,{transfer:w})}:X=>{m=!0};let N=null;const U=Al(A.data);if(this.parent[A.type])N=this.parent[A.type](A.sourceMapId,U,D);else if("getWorkerSource"in this.parent){const X=A.type.split(".");N=this.parent.getWorkerSource(A.sourceMapId,X[0],U.source)[X[1]](U,D)}else D(new Error(`Could not find function ${A.type}`));!m&&N&&N.cancel&&(this.cancelCallbacks[d]=N.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},P.D=Vt,P.E=$e,P.F=function(d,A){const m={};for(let w=0;w<A.length;w++){const D=A[w];D in d&&(m[D]=d[D])}return m},P.G=qp,P.H=Fr,P.I=go,P.J=Vr,P.K=kr,P.L=Nc,P.M=gs,P.N=zs,P.O=Zl,P.P=yt,P.Q=L,P.R=El,P.S=Kn,P.T=Yo,P.U=Nh,P.V=class extends K{},P.W=Od,P.X=function(d,A){const m=window.document.createElement("video");m.muted=!0,m.onloadstart=function(){A(null,m)};for(let w=0;w<d.length;w++){const D=window.document.createElement("source");Un(d[w])||(m.crossOrigin="Anonymous"),D.src=d[w],m.appendChild(D)}return{cancel:()=>{}}},P.Y=oi,P.Z=function(){var d=new Ic(16);return Ic!=Float32Array&&(d[1]=0,d[2]=0,d[3]=0,d[4]=0,d[6]=0,d[7]=0,d[8]=0,d[9]=0,d[11]=0,d[12]=0,d[13]=0,d[14]=0),d[0]=1,d[5]=1,d[10]=1,d[15]=1,d},P._=We,P.a=Io,P.a$=class extends I{},P.a0=function(d,A,m){var w=m[0],D=m[1],N=m[2];return d[0]=A[0]*w,d[1]=A[1]*w,d[2]=A[2]*w,d[3]=A[3]*w,d[4]=A[4]*D,d[5]=A[5]*D,d[6]=A[6]*D,d[7]=A[7]*D,d[8]=A[8]*N,d[9]=A[9]*N,d[10]=A[10]*N,d[11]=A[11]*N,d[12]=A[12],d[13]=A[13],d[14]=A[14],d[15]=A[15],d},P.a1=Cc,P.a2=function(){return pn++},P.a3=W,P.a4=Du,P.a5=function(){aa.isLoading()||aa.isLoaded()||xl()!=="deferred"||Ss()},P.a6=Ps,P.a7=eu,P.a8=Gn,P.a9=Qp,P.aA=rA,P.aB=function(d){d=d.slice();const A=Object.create(null);for(let m=0;m<d.length;m++)A[d[m].id]=d[m];for(let m=0;m<d.length;m++)"ref"in d[m]&&(d[m]=Zt(d[m],A[d[m].ref]));return d},P.aC=function(d){if(d.type==="custom")return new Gp(d);switch(d.type){case"background":return new Np(d);case"circle":return new Ii(d);case"fill":return new ou(d);case"fill-extrusion":return new wp(d);case"heatmap":return new _p(d);case"hillshade":return new Pf(d);case"line":return new G_(d);case"raster":return new jp(d);case"symbol":return new Yu(d)}},P.aD=Sn,P.aE=function(d,A){if(!d)return[{command:ri.setStyle,args:[A]}];let m=[];try{if(!ni(d.version,A.version))return[{command:ri.setStyle,args:[A]}];ni(d.center,A.center)||m.push({command:ri.setCenter,args:[A.center]}),ni(d.zoom,A.zoom)||m.push({command:ri.setZoom,args:[A.zoom]}),ni(d.bearing,A.bearing)||m.push({command:ri.setBearing,args:[A.bearing]}),ni(d.pitch,A.pitch)||m.push({command:ri.setPitch,args:[A.pitch]}),ni(d.sprite,A.sprite)||m.push({command:ri.setSprite,args:[A.sprite]}),ni(d.glyphs,A.glyphs)||m.push({command:ri.setGlyphs,args:[A.glyphs]}),ni(d.transition,A.transition)||m.push({command:ri.setTransition,args:[A.transition]}),ni(d.light,A.light)||m.push({command:ri.setLight,args:[A.light]});const w={},D=[];(function(U,X,ee,ae){let de;for(de in X=X||{},U=U||{})Object.prototype.hasOwnProperty.call(U,de)&&(Object.prototype.hasOwnProperty.call(X,de)||Oi(de,ee,ae));for(de in X)Object.prototype.hasOwnProperty.call(X,de)&&(Object.prototype.hasOwnProperty.call(U,de)?ni(U[de],X[de])||(U[de].type==="geojson"&&X[de].type==="geojson"&&Ki(U,X,de)?ee.push({command:ri.setGeoJSONSourceData,args:[de,X[de].data]}):Qi(de,X,ee,ae)):Qt(de,X,ee))})(d.sources,A.sources,D,w);const N=[];d.layers&&d.layers.forEach(U=>{w[U.source]?m.push({command:ri.removeLayer,args:[U.id]}):N.push(U)}),m=m.concat(D),function(U,X,ee){X=X||[];const ae=(U=U||[]).map(_n),de=X.map(_n),ge=U.reduce(ts,{}),Ee=X.reduce(ts,{}),Oe=ae.slice(),ce=Object.create(null);let et,ot,pt,Ct,bt,_e,Ut;for(et=0,ot=0;et<ae.length;et++)pt=ae[et],Object.prototype.hasOwnProperty.call(Ee,pt)?ot++:(ee.push({command:ri.removeLayer,args:[pt]}),Oe.splice(Oe.indexOf(pt,ot),1));for(et=0,ot=0;et<de.length;et++)pt=de[de.length-1-et],Oe[Oe.length-1-et]!==pt&&(Object.prototype.hasOwnProperty.call(ge,pt)?(ee.push({command:ri.removeLayer,args:[pt]}),Oe.splice(Oe.lastIndexOf(pt,Oe.length-ot),1)):ot++,_e=Oe[Oe.length-et],ee.push({command:ri.addLayer,args:[Ee[pt],_e]}),Oe.splice(Oe.length-et,0,pt),ce[pt]=!0);for(et=0;et<de.length;et++)if(pt=de[et],Ct=ge[pt],bt=Ee[pt],!ce[pt]&&!ni(Ct,bt))if(ni(Ct.source,bt.source)&&ni(Ct["source-layer"],bt["source-layer"])&&ni(Ct.type,bt.type)){for(Ut in Kr(Ct.layout,bt.layout,ee,pt,null,ri.setLayoutProperty),Kr(Ct.paint,bt.paint,ee,pt,null,ri.setPaintProperty),ni(Ct.filter,bt.filter)||ee.push({command:ri.setFilter,args:[pt,bt.filter]}),ni(Ct.minzoom,bt.minzoom)&&ni(Ct.maxzoom,bt.maxzoom)||ee.push({command:ri.setLayerZoomRange,args:[pt,bt.minzoom,bt.maxzoom]}),Ct)Object.prototype.hasOwnProperty.call(Ct,Ut)&&Ut!=="layout"&&Ut!=="paint"&&Ut!=="filter"&&Ut!=="metadata"&&Ut!=="minzoom"&&Ut!=="maxzoom"&&(Ut.indexOf("paint.")===0?Kr(Ct[Ut],bt[Ut],ee,pt,Ut.slice(6),ri.setPaintProperty):ni(Ct[Ut],bt[Ut])||ee.push({command:ri.setLayerProperty,args:[pt,Ut,bt[Ut]]}));for(Ut in bt)Object.prototype.hasOwnProperty.call(bt,Ut)&&!Object.prototype.hasOwnProperty.call(Ct,Ut)&&Ut!=="layout"&&Ut!=="paint"&&Ut!=="filter"&&Ut!=="metadata"&&Ut!=="minzoom"&&Ut!=="maxzoom"&&(Ut.indexOf("paint.")===0?Kr(Ct[Ut],bt[Ut],ee,pt,Ut.slice(6),ri.setPaintProperty):ni(Ct[Ut],bt[Ut])||ee.push({command:ri.setLayerProperty,args:[pt,Ut,bt[Ut]]}))}else ee.push({command:ri.removeLayer,args:[pt]}),_e=Oe[Oe.lastIndexOf(pt)+1],ee.push({command:ri.addLayer,args:[bt,_e]})}(N,A.layers,m)}catch(w){console.warn("Unable to compute style diff:",w),m=[{command:ri.setStyle,args:[A]}]}return m},P.aF=function(d){const A=[],m=d.id;return m===void 0&&A.push({message:`layers.${m}: missing required property "id"`}),d.render===void 0&&A.push({message:`layers.${m}: missing required method "render"`}),d.renderingMode&&d.renderingMode!=="2d"&&d.renderingMode!=="3d"&&A.push({message:`layers.${m}: property "renderingMode" must be either "2d" or "3d"`}),A},P.aG=function d(A,m){if(Array.isArray(A)){if(!Array.isArray(m)||A.length!==m.length)return!1;for(let w=0;w<A.length;w++)if(!d(A[w],m[w]))return!1;return!0}if(typeof A=="object"&&A!==null&&m!==null){if(typeof m!="object"||Object.keys(A).length!==Object.keys(m).length)return!1;for(const w in A)if(!d(A[w],m[w]))return!1;return!0}return A===m},P.aH=At,P.aI=tr,P.aJ=nA,P.aK=function(d){return d({pluginStatus:To,pluginURL:Ta}),nA.on("pluginStateChange",d),d},P.aL=class extends Nl{constructor(d,A){super(d,A),this.current=0}set(d){this.current!==d&&(this.current=d,this.gl.uniform1i(this.location,d))}},P.aM=Nu,P.aN=class extends Nl{constructor(d,A){super(d,A),this.current=Uu}set(d){if(d[12]!==this.current[12]||d[0]!==this.current[0])return this.current=d,void this.gl.uniformMatrix4fv(this.location,!1,d);for(let A=1;A<16;A++)if(d[A]!==this.current[A]){this.current=d,this.gl.uniformMatrix4fv(this.location,!1,d);break}}},P.aO=hd,P.aP=class extends Nl{constructor(d,A){super(d,A),this.current=[0,0,0]}set(d){d[0]===this.current[0]&&d[1]===this.current[1]&&d[2]===this.current[2]||(this.current=d,this.gl.uniform3f(this.location,d[0],d[1],d[2]))}},P.aQ=class extends Nl{constructor(d,A){super(d,A),this.current=[0,0]}set(d){d[0]===this.current[0]&&d[1]===this.current[1]||(this.current=d,this.gl.uniform2f(this.location,d[0],d[1]))}},P.aR=Th,P.aS=function(d,A,m,w,D,N,U){var X=1/(A-m),ee=1/(w-D),ae=1/(N-U);return d[0]=-2*X,d[1]=0,d[2]=0,d[3]=0,d[4]=0,d[5]=-2*ee,d[6]=0,d[7]=0,d[8]=0,d[9]=0,d[10]=2*ae,d[11]=0,d[12]=(A+m)*X,d[13]=(D+w)*ee,d[14]=(U+N)*ae,d[15]=1,d},P.aT=nn,P.aU=qu,P.aV=class extends S{},P.aW=q_,P.aX=class extends F{},P.aY=function(d){return d<=1?1:Math.pow(2,Math.ceil(Math.log(d)/Math.LN2))},P.aZ=Df,P.a_=ht,P.aa=function(d){const A={};if(d.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(m,w,D,N)=>{const U=D||N;return A[w]=!U||U.toLowerCase(),""}),A["max-age"]){const m=parseInt(A["max-age"],10);isNaN(m)?delete A["max-age"]:A["max-age"]=m}return A},P.ab=function(d,A){const m=[];for(const w in d)w in A||m.push(w);return m},P.ac=function(d){if(wo==null){const A=d.navigator?d.navigator.userAgent:null;wo=!!d.safari||!(!A||!(/\b(iPad|iPhone|iPod)\b/.test(A)||A.match("Safari")&&!A.match("Chrome")))}return wo},P.ad=jr,P.ae=function(d,A,m){var w=Math.sin(m),D=Math.cos(m),N=A[0],U=A[1],X=A[2],ee=A[3],ae=A[4],de=A[5],ge=A[6],Ee=A[7];return A!==d&&(d[8]=A[8],d[9]=A[9],d[10]=A[10],d[11]=A[11],d[12]=A[12],d[13]=A[13],d[14]=A[14],d[15]=A[15]),d[0]=N*D+ae*w,d[1]=U*D+de*w,d[2]=X*D+ge*w,d[3]=ee*D+Ee*w,d[4]=ae*D-N*w,d[5]=de*D-U*w,d[6]=ge*D-X*w,d[7]=Ee*D-ee*w,d},P.af=function(d){var A=new Ic(16);return A[0]=d[0],A[1]=d[1],A[2]=d[2],A[3]=d[3],A[4]=d[4],A[5]=d[5],A[6]=d[6],A[7]=d[7],A[8]=d[8],A[9]=d[9],A[10]=d[10],A[11]=d[11],A[12]=d[12],A[13]=d[13],A[14]=d[14],A[15]=d[15],A},P.ag=Tu,P.ah=function(d,A){let m=0,w=0;if(d.kind==="constant")w=d.layoutSize;else if(d.kind!=="source"){const{interpolationType:D,minZoom:N,maxZoom:U}=d,X=D?jr(sn.interpolationFactor(D,A,N,U),0,1):0;d.kind==="camera"?w=ar.number(d.minSize,d.maxSize,X):m=X}return{uSizeT:m,uSize:w}},P.aj=function(d,{uSize:A,uSizeT:m},{lowerSize:w,upperSize:D}){return d.kind==="source"?w/qA:d.kind==="composite"?ar.number(w/qA,D/qA,m):A},P.ak=Pd,P.al=function(d,A,m,w){const D=A.y-d.y,N=A.x-d.x,U=w.y-m.y,X=w.x-m.x,ee=U*N-X*D;if(ee===0)return null;const ae=(X*(d.y-m.y)-U*(d.x-m.x))/ee;return new yt(d.x+ae*N,d.y+ae*D)},P.am=ql,P.an=Tf,P.ao=Sf,P.ap=Eo,P.ar=Er,P.as=function(d,A){var m=A[0],w=A[1],D=A[2],N=A[3],U=A[4],X=A[5],ee=A[6],ae=A[7],de=A[8],ge=A[9],Ee=A[10],Oe=A[11],ce=A[12],et=A[13],ot=A[14],pt=A[15],Ct=m*X-w*U,bt=m*ee-D*U,_e=m*ae-N*U,Ut=w*ee-D*X,li=w*ae-N*X,Ci=D*ae-N*ee,nr=de*et-ge*ce,Ri=de*ot-Ee*ce,Pi=de*pt-Oe*ce,wi=ge*ot-Ee*et,Wi=ge*pt-Oe*et,ki=Ee*pt-Oe*ot,ci=Ct*ki-bt*Wi+_e*wi+Ut*Pi-li*Ri+Ci*nr;return ci?(d[0]=(X*ki-ee*Wi+ae*wi)*(ci=1/ci),d[1]=(D*Wi-w*ki-N*wi)*ci,d[2]=(et*Ci-ot*li+pt*Ut)*ci,d[3]=(Ee*li-ge*Ci-Oe*Ut)*ci,d[4]=(ee*Pi-U*ki-ae*Ri)*ci,d[5]=(m*ki-D*Pi+N*Ri)*ci,d[6]=(ot*_e-ce*Ci-pt*bt)*ci,d[7]=(de*Ci-Ee*_e+Oe*bt)*ci,d[8]=(U*Wi-X*Pi+ae*nr)*ci,d[9]=(w*Pi-m*Wi-N*nr)*ci,d[10]=(ce*li-et*_e+pt*Ct)*ci,d[11]=(ge*_e-de*li-Oe*Ct)*ci,d[12]=(X*Ri-U*wi-ee*nr)*ci,d[13]=(m*wi-w*Ri+D*nr)*ci,d[14]=(et*bt-ce*Ut-ot*Ct)*ci,d[15]=(de*Ut-ge*bt+Ee*Ct)*ci,d):null},P.at=Wa,P.au=kd,P.av=jd,P.aw=function(){const d={},A=Pe.$version;for(const m in Pe.$root){const w=Pe.$root[m];if(w.required){let D=null;D=m==="version"?A:w.type==="array"?[]:{},D!=null&&(d[m]=D)}}return d},P.ax=ri,P.ay=rc,P.az=In,P.b=function(d,A){const m=new Blob([new Uint8Array(d)],{type:"image/png"});createImageBitmap(m).then(w=>{A(null,w)}).catch(w=>{A(new Error(`Could not load image because of ${w.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})},P.b0=Nr,P.b1=function(d,A){var m=d[0],w=d[1],D=d[2],N=d[3],U=d[4],X=d[5],ee=d[6],ae=d[7],de=d[8],ge=d[9],Ee=d[10],Oe=d[11],ce=d[12],et=d[13],ot=d[14],pt=d[15],Ct=A[0],bt=A[1],_e=A[2],Ut=A[3],li=A[4],Ci=A[5],nr=A[6],Ri=A[7],Pi=A[8],wi=A[9],Wi=A[10],ki=A[11],ci=A[12],fr=A[13],fi=A[14],Wr=A[15];return Math.abs(m-Ct)<=js*Math.max(1,Math.abs(m),Math.abs(Ct))&&Math.abs(w-bt)<=js*Math.max(1,Math.abs(w),Math.abs(bt))&&Math.abs(D-_e)<=js*Math.max(1,Math.abs(D),Math.abs(_e))&&Math.abs(N-Ut)<=js*Math.max(1,Math.abs(N),Math.abs(Ut))&&Math.abs(U-li)<=js*Math.max(1,Math.abs(U),Math.abs(li))&&Math.abs(X-Ci)<=js*Math.max(1,Math.abs(X),Math.abs(Ci))&&Math.abs(ee-nr)<=js*Math.max(1,Math.abs(ee),Math.abs(nr))&&Math.abs(ae-Ri)<=js*Math.max(1,Math.abs(ae),Math.abs(Ri))&&Math.abs(de-Pi)<=js*Math.max(1,Math.abs(de),Math.abs(Pi))&&Math.abs(ge-wi)<=js*Math.max(1,Math.abs(ge),Math.abs(wi))&&Math.abs(Ee-Wi)<=js*Math.max(1,Math.abs(Ee),Math.abs(Wi))&&Math.abs(Oe-ki)<=js*Math.max(1,Math.abs(Oe),Math.abs(ki))&&Math.abs(ce-ci)<=js*Math.max(1,Math.abs(ce),Math.abs(ci))&&Math.abs(et-fr)<=js*Math.max(1,Math.abs(et),Math.abs(fr))&&Math.abs(ot-fi)<=js*Math.max(1,Math.abs(ot),Math.abs(fi))&&Math.abs(pt-Wr)<=js*Math.max(1,Math.abs(pt),Math.abs(Wr))},P.b2=function(d,A){return d[0]=A[0],d[1]=A[1],d[2]=A[2],d[3]=A[3],d[4]=A[4],d[5]=A[5],d[6]=A[6],d[7]=A[7],d[8]=A[8],d[9]=A[9],d[10]=A[10],d[11]=A[11],d[12]=A[12],d[13]=A[13],d[14]=A[14],d[15]=A[15],d},P.b3=function(d,A,m){return d[0]=A[0]*m[0],d[1]=A[1]*m[1],d[2]=A[2]*m[2],d[3]=A[3]*m[3],d},P.b4=function(d,A){return d[0]*A[0]+d[1]*A[1]+d[2]*A[2]+d[3]*A[3]},P.b5=Jn,P.b6=h0,P.b7=Rd,P.b8=function(d,A,m,w,D){var N,U=1/Math.tan(A/2);return d[0]=U/m,d[1]=0,d[2]=0,d[3]=0,d[4]=0,d[5]=U,d[6]=0,d[7]=0,d[8]=0,d[9]=0,d[11]=-1,d[12]=0,d[13]=0,d[15]=0,D!=null&&D!==1/0?(d[10]=(D+w)*(N=1/(w-D)),d[14]=2*D*w*N):(d[10]=-1,d[14]=-2*w),d},P.b9=function(d,A,m){var w=Math.sin(m),D=Math.cos(m),N=A[4],U=A[5],X=A[6],ee=A[7],ae=A[8],de=A[9],ge=A[10],Ee=A[11];return A!==d&&(d[0]=A[0],d[1]=A[1],d[2]=A[2],d[3]=A[3],d[12]=A[12],d[13]=A[13],d[14]=A[14],d[15]=A[15]),d[4]=N*D+ae*w,d[5]=U*D+de*w,d[6]=X*D+ge*w,d[7]=ee*D+Ee*w,d[8]=ae*D-N*w,d[9]=de*D-U*w,d[10]=ge*D-X*w,d[11]=Ee*D-ee*w,d},P.bA=Xt,P.bB=Sd,P.bC=zo,P.bD=aa,P.ba=qr,P.bb=cn,P.bc=function(d,A){return d[0]=A[0],d[1]=0,d[2]=0,d[3]=0,d[4]=0,d[5]=A[1],d[6]=0,d[7]=0,d[8]=0,d[9]=0,d[10]=A[2],d[11]=0,d[12]=0,d[13]=0,d[14]=0,d[15]=1,d},P.bd=class extends Q{},P.be=Ld,P.bf=AA,P.bg=Kp,P.bi=dr,P.bj=function(d,A,m=!1){if(To===gA||To===NA||To===UA)throw new Error("setRTLTextPlugin cannot be called multiple times.");Ta=to.resolveURL(d),To=gA,Ji=A,oc(),m||Ss()},P.bk=xl,P.bl=function(d,A){const m={};for(let D=0;D<d.length;D++){const N=A&&A[d[D].id]||$o(d[D]);A&&(A[d[D].id]=N);let U=m[N];U||(U=m[N]=[]),U.push(d[D])}const w=[];for(const D in m)w.push(m[D]);return w},P.bm=Vi,P.bn=f0,P.bo=Vd,P.bp=i0,P.bq=function(d){d.bucket.createArrays(),d.bucket.tilePixelRatio=zs/(512*d.bucket.overscaling),d.bucket.compareText={},d.bucket.iconsNeedLinear=!1;const A=d.bucket.layers[0],m=A.layout,w=A._unevaluatedLayout._values,D={layoutIconSize:w["icon-size"].possiblyEvaluate(new Gn(d.bucket.zoom+1),d.canonical),layoutTextSize:w["text-size"].possiblyEvaluate(new Gn(d.bucket.zoom+1),d.canonical),textMaxSize:w["text-size"].possiblyEvaluate(new Gn(18))};if(d.bucket.textSizeData.kind==="composite"){const{minZoom:ae,maxZoom:de}=d.bucket.textSizeData;D.compositeTextSizes=[w["text-size"].possiblyEvaluate(new Gn(ae),d.canonical),w["text-size"].possiblyEvaluate(new Gn(de),d.canonical)]}if(d.bucket.iconSizeData.kind==="composite"){const{minZoom:ae,maxZoom:de}=d.bucket.iconSizeData;D.compositeIconSizes=[w["icon-size"].possiblyEvaluate(new Gn(ae),d.canonical),w["icon-size"].possiblyEvaluate(new Gn(de),d.canonical)]}const N=m.get("text-line-height")*Eo,U=m.get("text-rotation-alignment")!=="viewport"&&m.get("symbol-placement")!=="point",X=m.get("text-keep-upright"),ee=m.get("text-size");for(const ae of d.bucket.features){const de=m.get("text-font").evaluate(ae,{},d.canonical).join(","),ge=ee.evaluate(ae,{},d.canonical),Ee=D.layoutTextSize.evaluate(ae,{},d.canonical),Oe=D.layoutIconSize.evaluate(ae,{},d.canonical),ce={horizontal:{},vertical:void 0},et=ae.text;let ot,pt=[0,0];if(et){const _e=et.toString(),Ut=m.get("text-letter-spacing").evaluate(ae,{},d.canonical)*Eo,li=OA(_e)?Ut:0,Ci=m.get("text-anchor").evaluate(ae,{},d.canonical),nr=Ud(A,ae,d.canonical);if(!nr){const ki=m.get("text-radial-offset").evaluate(ae,{},d.canonical);pt=ki?Qr(Ci,[ki*Eo,x0]):m.get("text-offset").evaluate(ae,{},d.canonical).map(ci=>ci*Eo)}let Ri=U?"center":m.get("text-justify").evaluate(ae,{},d.canonical);const Pi=m.get("symbol-placement"),wi=Pi==="point"?m.get("text-max-width").evaluate(ae,{},d.canonical)*Eo:0,Wi=()=>{d.bucket.allowVerticalPlacement&&iA(_e)&&(ce.vertical=Xu(et,d.glyphMap,d.glyphPositions,d.imagePositions,de,wi,N,Ci,"left",li,pt,P.ai.vertical,!0,Pi,Ee,ge))};if(!U&&nr){const ki=new Set;if(Ri==="auto")for(let fr=0;fr<nr.values.length;fr+=2)ki.add(Wa(nr.values[fr]));else ki.add(Ri);let ci=!1;for(const fr of ki)if(!ce.horizontal[fr])if(ci)ce.horizontal[fr]=ce.horizontal[0];else{const fi=Xu(et,d.glyphMap,d.glyphPositions,d.imagePositions,de,wi,N,"center",fr,li,pt,P.ai.horizontal,!1,Pi,Ee,ge);fi&&(ce.horizontal[fr]=fi,ci=fi.positionedLines.length===1)}Wi()}else{Ri==="auto"&&(Ri=Wa(Ci));const ki=Xu(et,d.glyphMap,d.glyphPositions,d.imagePositions,de,wi,N,Ci,Ri,li,pt,P.ai.horizontal,!1,Pi,Ee,ge);ki&&(ce.horizontal[Ri]=ki),Wi(),iA(_e)&&U&&X&&(ce.vertical=Xu(et,d.glyphMap,d.glyphPositions,d.imagePositions,de,wi,N,Ci,Ri,li,pt,P.ai.vertical,!1,Pi,Ee,ge))}}let Ct=!1;if(ae.icon&&ae.icon.name){const _e=d.imageMap[ae.icon.name];_e&&(ot=zn(d.imagePositions[ae.icon.name],m.get("icon-offset").evaluate(ae,{},d.canonical),m.get("icon-anchor").evaluate(ae,{},d.canonical)),Ct=!!_e.sdf,d.bucket.sdfIcons===void 0?d.bucket.sdfIcons=Ct:d.bucket.sdfIcons!==Ct&&Li("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(_e.pixelRatio!==d.bucket.pixelRatio||m.get("icon-rotate").constantOr(1)!==0)&&(d.bucket.iconsNeedLinear=!0))}const bt=b0(ce.horizontal)||ce.vertical;d.bucket.iconsInText=!!bt&&bt.iconsInText,(bt||ot)&&Gc(d.bucket,ae,ce,ot,d.imageMap,D,Ee,Oe,pt,Ct,d.canonical)}d.showCollisionBoxes&&d.bucket.generateCollisionDebugBuffers()},P.br=Ed,P.bs=Dc,P.bt=Lc,P.bu=class{constructor(d){this._marks={start:[d.url,"start"].join("#"),end:[d.url,"end"].join("#"),measure:d.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let d=performance.getEntriesByName(this._marks.measure);return d.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),d=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),d}},P.bv=dc,P.bw=uc,P.bx=function(d,A,m,w,D){return We(this,void 0,void 0,function*(){if(kr())try{return yield gs(d,A,m,w,D)}catch{}return function(N,U,X,ee,ae){const de=N.width,ge=N.height;hi&&Yr||(hi=new OffscreenCanvas(de,ge),Yr=hi.getContext("2d",{willReadFrequently:!0})),hi.width=de,hi.height=ge,Yr.drawImage(N,0,0,de,ge);const Ee=Yr.getImageData(U,X,ee,ae);return Yr.clearRect(0,0,de,ge),Ee.data}(d,A,m,w,D)})},P.by=d0,P.bz=me,P.c=zt,P.d=function(d,A){const m=new Image;m.onload=()=>{A(null,m),URL.revokeObjectURL(m.src),m.onload=null,window.requestAnimationFrame(()=>{m.src=Zo})},m.onerror=()=>A(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const w=new Blob([new Uint8Array(d)],{type:"image/png"});m.src=d.byteLength?URL.createObjectURL(w):Zo},P.e=rn,P.f=function(d,A){return La(rn(d,{type:"json"}),A)},P.g=Es,P.h=to,P.i=es,P.j=Ue,P.k=Yt,P.l=Cl,P.m=La,P.n=function(d){return new dc(d).readFields(W_,[])},P.o=function(d,A,m){if(!d.length)return m(null,[]);let w=d.length;const D=new Array(d.length);let N=null;d.forEach((U,X)=>{A(U,(ee,ae)=>{ee&&(N=ee),D[X]=ae,--w==0&&m(N,D)})})},P.p=Ml,P.q=Sh,P.r=tn,P.s=Un,P.t=vu,P.u=Si,P.v=Pe,P.w=Li,P.x=tA,P.y=yl,P.z=function([d,A,m]){return A+=90,A*=Math.PI/180,m*=Math.PI/180,{x:d*Math.cos(A)*Math.sin(m),y:d*Math.sin(A)*Math.sin(m),z:d*Math.cos(m)}}}),dt(["./shared"],function(P){class We{constructor(Ae){this.keyCache={},Ae&&this.replace(Ae)}replace(Ae){this._layerConfigs={},this._layers={},this.update(Ae,[])}update(Ae,pe){for(const Be of Ae){this._layerConfigs[Be.id]=Be;const Ve=this._layers[Be.id]=P.aC(Be);Ve._featureFilter=P.a6(Ve.filter),this.keyCache[Be.id]&&delete this.keyCache[Be.id]}for(const Be of pe)delete this.keyCache[Be],delete this._layerConfigs[Be],delete this._layers[Be];this.familiesBySource={};const Te=P.bl(Object.values(this._layerConfigs),this.keyCache);for(const Be of Te){const Ve=Be.map(xe=>this._layers[xe.id]),Ke=Ve[0];if(Ke.visibility==="none")continue;const Qe=Ke.source||"";let Ge=this.familiesBySource[Qe];Ge||(Ge=this.familiesBySource[Qe]={});const He=Ke.sourceLayer||"_geojsonTileLayer";let Et=Ge[He];Et||(Et=Ge[He]=[]),Et.push(Ve)}}}class me{constructor(Ae){const pe={},Te=[];for(const Qe in Ae){const Ge=Ae[Qe],He=pe[Qe]={};for(const Et in Ge){const xe=Ge[+Et];if(!xe||xe.bitmap.width===0||xe.bitmap.height===0)continue;const Me={x:0,y:0,w:xe.bitmap.width+2,h:xe.bitmap.height+2};Te.push(Me),He[Et]={rect:Me,metrics:xe.metrics}}}const{w:Be,h:Ve}=P.p(Te),Ke=new P.q({width:Be||1,height:Ve||1});for(const Qe in Ae){const Ge=Ae[Qe];for(const He in Ge){const Et=Ge[+He];if(!Et||Et.bitmap.width===0||Et.bitmap.height===0)continue;const xe=pe[Qe][He].rect;P.q.copy(Et.bitmap,Ke,{x:0,y:0},{x:xe.x+1,y:xe.y+1},Et.bitmap)}}this.image=Ke,this.positions=pe}}P.bm("GlyphAtlas",me);class Xt{constructor(Ae){this.tileID=new P.O(Ae.tileID.overscaledZ,Ae.tileID.wrap,Ae.tileID.canonical.z,Ae.tileID.canonical.x,Ae.tileID.canonical.y),this.uid=Ae.uid,this.zoom=Ae.zoom,this.pixelRatio=Ae.pixelRatio,this.tileSize=Ae.tileSize,this.source=Ae.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Ae.showCollisionBoxes,this.collectResourceTiming=!!Ae.collectResourceTiming,this.returnDependencies=!!Ae.returnDependencies,this.promoteId=Ae.promoteId,this.inFlightDependencies=[],this.dependencySentinel=-1}parse(Ae,pe,Te,Be,Ve){this.status="parsing",this.data=Ae,this.collisionBoxArray=new P.a3;const Ke=new P.bn(Object.keys(Ae.layers).sort()),Qe=new P.bo(this.tileID,this.promoteId);Qe.bucketLayerIDs=[];const Ge={},He={featureIndex:Qe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:Te},Et=pe.familiesBySource[this.source];for(const ai in Et){const pi=Ae.layers[ai];if(!pi)continue;pi.version===1&&P.w(`Vector tile source "${this.source}" layer "${ai}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const gr=Ke.encode(ai),bi=[];for(let zi=0;zi<pi.length;zi++){const fn=pi.feature(zi),Qs=Qe.getId(fn,ai);bi.push({feature:fn,id:Qs,index:zi,sourceLayerIndex:gr})}for(const zi of Et[ai]){const fn=zi[0];fn.source!==this.source&&P.w(`layer.source = ${fn.source} does not equal this.source = ${this.source}`),fn.minzoom&&this.zoom<Math.floor(fn.minzoom)||fn.maxzoom&&this.zoom>=fn.maxzoom||fn.visibility!=="none"&&(Rt(zi,this.zoom,Te),(Ge[fn.id]=fn.createBucket({index:Qe.bucketLayerIDs.length,layers:zi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:gr,sourceID:this.source})).populate(bi,He,this.tileID.canonical),Qe.bucketLayerIDs.push(zi.map(Qs=>Qs.id)))}}let xe,Me,ct,Pt;const o=P.aH(He.glyphDependencies,ai=>Object.keys(ai).map(Number));this.inFlightDependencies.forEach(ai=>ai==null?void 0:ai.cancel()),this.inFlightDependencies=[];const oe=++this.dependencySentinel;Object.keys(o).length?this.inFlightDependencies.push(Be.send("getGlyphs",{uid:this.uid,stacks:o,source:this.source,tileID:this.tileID,type:"glyphs"},(ai,pi)=>{oe===this.dependencySentinel&&(xe||(xe=ai,Me=pi,yi.call(this)))})):Me={};const ti=Object.keys(He.iconDependencies);ti.length?this.inFlightDependencies.push(Be.send("getImages",{icons:ti,source:this.source,tileID:this.tileID,type:"icons"},(ai,pi)=>{oe===this.dependencySentinel&&(xe||(xe=ai,ct=pi,yi.call(this)))})):ct={};const xi=Object.keys(He.patternDependencies);function yi(){if(xe)return Ve(xe);if(Me&&ct&&Pt){const ai=new me(Me),pi=new P.bp(ct,Pt);for(const gr in Ge){const bi=Ge[gr];bi instanceof P.a4?(Rt(bi.layers,this.zoom,Te),P.bq({bucket:bi,glyphMap:Me,glyphPositions:ai.positions,imageMap:ct,imagePositions:pi.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):bi.hasPattern&&(bi instanceof P.br||bi instanceof P.bs||bi instanceof P.bt)&&(Rt(bi.layers,this.zoom,Te),bi.addFeatures(He,this.tileID.canonical,pi.patternPositions))}this.status="done",Ve(null,{buckets:Object.values(Ge).filter(gr=>!gr.isEmpty()),featureIndex:Qe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ai.image,imageAtlas:pi,glyphMap:this.returnDependencies?Me:null,iconMap:this.returnDependencies?ct:null,glyphPositions:this.returnDependencies?ai.positions:null})}}xi.length?this.inFlightDependencies.push(Be.send("getImages",{icons:xi,source:this.source,tileID:this.tileID,type:"patterns"},(ai,pi)=>{oe===this.dependencySentinel&&(xe||(xe=ai,Pt=pi,yi.call(this)))})):Pt={},yi.call(this)}}function Rt(we,Ae,pe){const Te=new P.a8(Ae);for(const Be of we)Be.recalculate(Te,pe)}function yt(we,Ae){const pe=P.l(we.request,(Te,Be,Ve,Ke)=>{if(Te)Ae(Te);else if(Be)try{const Qe=new P.bw.VectorTile(new P.bv(Be));Ae(null,{vectorTile:Qe,rawData:Be,cacheControl:Ve,expires:Ke})}catch(Qe){const Ge=new Uint8Array(Be);let He=`Unable to parse the tile at ${we.request.url}, `;He+=Ge[0]===31&&Ge[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${Qe.messge}`,Ae(new Error(He))}});return()=>{pe.cancel(),Ae()}}class qt{constructor(Ae,pe,Te,Be){this.actor=Ae,this.layerIndex=pe,this.availableImages=Te,this.loadVectorData=Be||yt,this.fetching={},this.loading={},this.loaded={}}loadTile(Ae,pe){const Te=Ae.uid;this.loading||(this.loading={});const Be=!!(Ae&&Ae.request&&Ae.request.collectResourceTiming)&&new P.bu(Ae.request),Ve=this.loading[Te]=new Xt(Ae);Ve.abort=this.loadVectorData(Ae,(Ke,Qe)=>{if(delete this.loading[Te],Ke||!Qe)return Ve.status="done",this.loaded[Te]=Ve,pe(Ke);const Ge=Qe.rawData,He={};Qe.expires&&(He.expires=Qe.expires),Qe.cacheControl&&(He.cacheControl=Qe.cacheControl);const Et={};if(Be){const xe=Be.finish();xe&&(Et.resourceTiming=JSON.parse(JSON.stringify(xe)))}Ve.vectorTile=Qe.vectorTile,Ve.parse(Qe.vectorTile,this.layerIndex,this.availableImages,this.actor,(xe,Me)=>{if(delete this.fetching[Te],xe||!Me)return pe(xe);pe(null,P.e({rawTileData:Ge.slice(0)},Me,He,Et))}),this.loaded=this.loaded||{},this.loaded[Te]=Ve,this.fetching[Te]={rawTileData:Ge,cacheControl:He,resourceTiming:Et}})}reloadTile(Ae,pe){const Te=this.loaded,Be=Ae.uid;if(Te&&Te[Be]){const Ve=Te[Be];Ve.showCollisionBoxes=Ae.showCollisionBoxes,Ve.status==="parsing"?Ve.parse(Ve.vectorTile,this.layerIndex,this.availableImages,this.actor,(Ke,Qe)=>{if(Ke||!Qe)return pe(Ke,Qe);let Ge;if(this.fetching[Be]){const{rawTileData:He,cacheControl:Et,resourceTiming:xe}=this.fetching[Be];delete this.fetching[Be],Ge=P.e({rawTileData:He.slice(0)},Qe,Et,xe)}else Ge=Qe;pe(null,Ge)}):Ve.status==="done"&&(Ve.vectorTile?Ve.parse(Ve.vectorTile,this.layerIndex,this.availableImages,this.actor,pe):pe())}}abortTile(Ae,pe){const Te=this.loading,Be=Ae.uid;Te&&Te[Be]&&Te[Be].abort&&(Te[Be].abort(),delete Te[Be]),pe()}removeTile(Ae,pe){const Te=this.loaded,Be=Ae.uid;Te&&Te[Be]&&delete Te[Be],pe()}}class $t{constructor(){this.loaded={}}loadTile(Ae,pe){return P._(this,void 0,void 0,function*(){const{uid:Te,encoding:Be,rawImageData:Ve,redFactor:Ke,greenFactor:Qe,blueFactor:Ge,baseShift:He}=Ae,Et=Ve.width+2,xe=Ve.height+2,Me=P.a(Ve)?new P.R({width:Et,height:xe},yield P.bx(Ve,-1,-1,Et,xe)):Ve,ct=new P.by(Te,Me,Be,Ke,Qe,Ge,He);this.loaded=this.loaded||{},this.loaded[Te]=ct,pe(null,ct)})}removeTile(Ae){const pe=this.loaded,Te=Ae.uid;pe&&pe[Te]&&delete pe[Te]}}function ui(we,Ae){if(we.length!==0){di(we[0],Ae);for(var pe=1;pe<we.length;pe++)di(we[pe],!Ae)}}function di(we,Ae){for(var pe=0,Te=0,Be=0,Ve=we.length,Ke=Ve-1;Be<Ve;Ke=Be++){var Qe=(we[Be][0]-we[Ke][0])*(we[Ke][1]+we[Be][1]),Ge=pe+Qe;Te+=Math.abs(pe)>=Math.abs(Qe)?pe-Ge+Qe:Qe-Ge+pe,pe=Ge}pe+Te>=0!=!!Ae&&we.reverse()}var Ei=P.bz(function we(Ae,pe){var Te,Be=Ae&&Ae.type;if(Be==="FeatureCollection")for(Te=0;Te<Ae.features.length;Te++)we(Ae.features[Te],pe);else if(Be==="GeometryCollection")for(Te=0;Te<Ae.geometries.length;Te++)we(Ae.geometries[Te],pe);else if(Be==="Feature")we(Ae.geometry,pe);else if(Be==="Polygon")ui(Ae.coordinates,pe);else if(Be==="MultiPolygon")for(Te=0;Te<Ae.coordinates.length;Te++)ui(Ae.coordinates[Te],pe);return Ae});const Vr=P.bw.VectorTileFeature.prototype.toGeoJSON;var kr={exports:{}},qr=P.bA,cn=P.bw.VectorTileFeature,jr=Jn;function Jn(we,Ae){this.options=Ae||{},this.features=we,this.length=we.length}function rn(we,Ae){this.id=typeof we.id=="number"?we.id:void 0,this.type=we.type,this.rawGeometry=we.type===1?[we.geometry]:we.geometry,this.properties=we.tags,this.extent=Ae||4096}Jn.prototype.feature=function(we){return new rn(this.features[we],this.options.extent)},rn.prototype.loadGeometry=function(){var we=this.rawGeometry;this.geometry=[];for(var Ae=0;Ae<we.length;Ae++){for(var pe=we[Ae],Te=[],Be=0;Be<pe.length;Be++)Te.push(new qr(pe[Be][0],pe[Be][1]));this.geometry.push(Te)}return this.geometry},rn.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var we=this.geometry,Ae=1/0,pe=-1/0,Te=1/0,Be=-1/0,Ve=0;Ve<we.length;Ve++)for(var Ke=we[Ve],Qe=0;Qe<Ke.length;Qe++){var Ge=Ke[Qe];Ae=Math.min(Ae,Ge.x),pe=Math.max(pe,Ge.x),Te=Math.min(Te,Ge.y),Be=Math.max(Be,Ge.y)}return[Ae,Te,pe,Be]},rn.prototype.toGeoJSON=cn.prototype.toGeoJSON;var pn=P.bB,At=jr;function tr(we){var Ae=new pn;return function(pe,Te){for(var Be in pe.layers)Te.writeMessage(3,Sn,pe.layers[Be])}(we,Ae),Ae.finish()}function Sn(we,Ae){var pe;Ae.writeVarintField(15,we.version||1),Ae.writeStringField(1,we.name||""),Ae.writeVarintField(5,we.extent||4096);var Te={keys:[],values:[],keycache:{},valuecache:{}};for(pe=0;pe<we.length;pe++)Te.feature=we.feature(pe),Ae.writeMessage(2,Nn,Te);var Be=Te.keys;for(pe=0;pe<Be.length;pe++)Ae.writeStringField(3,Be[pe]);var Ve=Te.values;for(pe=0;pe<Ve.length;pe++)Ae.writeMessage(4,wo,Ve[pe])}function Nn(we,Ae){var pe=we.feature;pe.id!==void 0&&Ae.writeVarintField(1,pe.id),Ae.writeMessage(2,Li,we),Ae.writeVarintField(3,pe.type),Ae.writeMessage(4,es,pe)}function Li(we,Ae){var pe=we.feature,Te=we.keys,Be=we.values,Ve=we.keycache,Ke=we.valuecache;for(var Qe in pe.properties){var Ge=pe.properties[Qe],He=Ve[Qe];if(Ge!==null){He===void 0&&(Te.push(Qe),Ve[Qe]=He=Te.length-1),Ae.writeVarint(He);var Et=typeof Ge;Et!=="string"&&Et!=="boolean"&&Et!=="number"&&(Ge=JSON.stringify(Ge));var xe=Et+":"+Ge,Me=Ke[xe];Me===void 0&&(Be.push(Ge),Ke[xe]=Me=Be.length-1),Ae.writeVarint(Me)}}}function Ir(we,Ae){return(Ae<<3)+(7&we)}function as(we){return we<<1^we>>31}function es(we,Ae){for(var pe=we.loadGeometry(),Te=we.type,Be=0,Ve=0,Ke=pe.length,Qe=0;Qe<Ke;Qe++){var Ge=pe[Qe],He=1;Te===1&&(He=Ge.length),Ae.writeVarint(Ir(1,He));for(var Et=Te===3?Ge.length-1:Ge.length,xe=0;xe<Et;xe++){xe===1&&Te!==1&&Ae.writeVarint(Ir(2,Et-1));var Me=Ge[xe].x-Be,ct=Ge[xe].y-Ve;Ae.writeVarint(as(Me)),Ae.writeVarint(as(ct)),Be+=Me,Ve+=ct}Te===3&&Ae.writeVarint(Ir(7,1))}}function wo(we,Ae){var pe=typeof we;pe==="string"?Ae.writeStringField(1,we):pe==="boolean"?Ae.writeBooleanField(7,we):pe==="number"&&(we%1!=0?Ae.writeDoubleField(3,we):we<0?Ae.writeSVarintField(6,we):Ae.writeVarintField(5,we))}kr.exports=tr,kr.exports.fromVectorTileJs=tr,kr.exports.fromGeojsonVt=function(we,Ae){Ae=Ae||{};var pe={};for(var Te in we)pe[Te]=new At(we[Te].features,Ae),pe[Te].name=Te,pe[Te].version=Ae.version,pe[Te].extent=Ae.extent;return tr({layers:pe})},kr.exports.GeoJSONWrapper=At;var Io=P.bz(kr.exports);const Zo={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:we=>we},gs=Math.fround||(hi=new Float32Array(1),we=>(hi[0]=+we,hi[0]));var hi;const Yr=3,Hn=5,Co=6;class to{constructor(Ae){this.options=Object.assign(Object.create(Zo),Ae),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Ae){const{log:pe,minZoom:Te,maxZoom:Be}=this.options;pe&&console.time("total time");const Ve=`prepare ${Ae.length} points`;pe&&console.time(Ve),this.points=Ae;const Ke=[];for(let Ge=0;Ge<Ae.length;Ge++){const He=Ae[Ge];if(!He.geometry)continue;const[Et,xe]=He.geometry.coordinates,Me=gs(In(Et)),ct=gs(Es(xe));Ke.push(Me,ct,1/0,Ge,-1,1),this.options.reduce&&Ke.push(0)}let Qe=this.trees[Be+1]=this._createTree(Ke);pe&&console.timeEnd(Ve);for(let Ge=Be;Ge>=Te;Ge--){const He=+Date.now();Qe=this.trees[Ge]=this._createTree(this._cluster(Qe,Ge)),pe&&console.log("z%d: %d clusters in %dms",Ge,Qe.numItems,+Date.now()-He)}return pe&&console.timeEnd("total time"),this}getClusters(Ae,pe){let Te=((Ae[0]+180)%360+360)%360-180;const Be=Math.max(-90,Math.min(90,Ae[1]));let Ve=Ae[2]===180?180:((Ae[2]+180)%360+360)%360-180;const Ke=Math.max(-90,Math.min(90,Ae[3]));if(Ae[2]-Ae[0]>=360)Te=-180,Ve=180;else if(Te>Ve){const xe=this.getClusters([Te,Be,180,Ke],pe),Me=this.getClusters([-180,Be,Ve,Ke],pe);return xe.concat(Me)}const Qe=this.trees[this._limitZoom(pe)],Ge=Qe.range(In(Te),Es(Ke),In(Ve),Es(Be)),He=Qe.data,Et=[];for(const xe of Ge){const Me=this.stride*xe;Et.push(He[Me+Hn]>1?zt(He,Me,this.clusterProps):this.points[He[Me+Yr]])}return Et}getChildren(Ae){const pe=this._getOriginId(Ae),Te=this._getOriginZoom(Ae),Be="No cluster with the specified id.",Ve=this.trees[Te];if(!Ve)throw new Error(Be);const Ke=Ve.data;if(pe*this.stride>=Ke.length)throw new Error(Be);const Qe=this.options.radius/(this.options.extent*Math.pow(2,Te-1)),Ge=Ve.within(Ke[pe*this.stride],Ke[pe*this.stride+1],Qe),He=[];for(const Et of Ge){const xe=Et*this.stride;Ke[xe+4]===Ae&&He.push(Ke[xe+Hn]>1?zt(Ke,xe,this.clusterProps):this.points[Ke[xe+Yr]])}if(He.length===0)throw new Error(Be);return He}getLeaves(Ae,pe,Te){const Be=[];return this._appendLeaves(Be,Ae,pe=pe||10,Te=Te||0,0),Be}getTile(Ae,pe,Te){const Be=this.trees[this._limitZoom(Ae)],Ve=Math.pow(2,Ae),{extent:Ke,radius:Qe}=this.options,Ge=Qe/Ke,He=(Te-Ge)/Ve,Et=(Te+1+Ge)/Ve,xe={features:[]};return this._addTileFeatures(Be.range((pe-Ge)/Ve,He,(pe+1+Ge)/Ve,Et),Be.data,pe,Te,Ve,xe),pe===0&&this._addTileFeatures(Be.range(1-Ge/Ve,He,1,Et),Be.data,Ve,Te,Ve,xe),pe===Ve-1&&this._addTileFeatures(Be.range(0,He,Ge/Ve,Et),Be.data,-1,Te,Ve,xe),xe.features.length?xe:null}getClusterExpansionZoom(Ae){let pe=this._getOriginZoom(Ae)-1;for(;pe<=this.options.maxZoom;){const Te=this.getChildren(Ae);if(pe++,Te.length!==1)break;Ae=Te[0].properties.cluster_id}return pe}_appendLeaves(Ae,pe,Te,Be,Ve){const Ke=this.getChildren(pe);for(const Qe of Ke){const Ge=Qe.properties;if(Ge&&Ge.cluster?Ve+Ge.point_count<=Be?Ve+=Ge.point_count:Ve=this._appendLeaves(Ae,Ge.cluster_id,Te,Be,Ve):Ve<Be?Ve++:Ae.push(Qe),Ae.length===Te)break}return Ve}_createTree(Ae){const pe=new P.av(Ae.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Te=0;Te<Ae.length;Te+=this.stride)pe.add(Ae[Te],Ae[Te+1]);return pe.finish(),pe.data=Ae,pe}_addTileFeatures(Ae,pe,Te,Be,Ve,Ke){for(const Qe of Ae){const Ge=Qe*this.stride,He=pe[Ge+Hn]>1;let Et,xe,Me;if(He)Et=dr(pe,Ge,this.clusterProps),xe=pe[Ge],Me=pe[Ge+1];else{const o=this.points[pe[Ge+Yr]];Et=o.properties;const[oe,ti]=o.geometry.coordinates;xe=In(oe),Me=Es(ti)}const ct={type:1,geometry:[[Math.round(this.options.extent*(xe*Ve-Te)),Math.round(this.options.extent*(Me*Ve-Be))]],tags:Et};let Pt;Pt=He||this.options.generateId?pe[Ge+Yr]:this.points[pe[Ge+Yr]].id,Pt!==void 0&&(ct.id=Pt),Ke.features.push(ct)}}_limitZoom(Ae){return Math.max(this.options.minZoom,Math.min(Math.floor(+Ae),this.options.maxZoom+1))}_cluster(Ae,pe){const{radius:Te,extent:Be,reduce:Ve,minPoints:Ke}=this.options,Qe=Te/(Be*Math.pow(2,pe)),Ge=Ae.data,He=[],Et=this.stride;for(let xe=0;xe<Ge.length;xe+=Et){if(Ge[xe+2]<=pe)continue;Ge[xe+2]=pe;const Me=Ge[xe],ct=Ge[xe+1],Pt=Ae.within(Ge[xe],Ge[xe+1],Qe),o=Ge[xe+Hn];let oe=o;for(const ti of Pt){const xi=ti*Et;Ge[xi+2]>pe&&(oe+=Ge[xi+Hn])}if(oe>o&&oe>=Ke){let ti,xi=Me*o,yi=ct*o,ai=-1;const pi=((xe/Et|0)<<5)+(pe+1)+this.points.length;for(const gr of Pt){const bi=gr*Et;if(Ge[bi+2]<=pe)continue;Ge[bi+2]=pe;const zi=Ge[bi+Hn];xi+=Ge[bi]*zi,yi+=Ge[bi+1]*zi,Ge[bi+4]=pi,Ve&&(ti||(ti=this._map(Ge,xe,!0),ai=this.clusterProps.length,this.clusterProps.push(ti)),Ve(ti,this._map(Ge,bi)))}Ge[xe+4]=pi,He.push(xi/oe,yi/oe,1/0,pi,-1,oe),Ve&&He.push(ai)}else{for(let ti=0;ti<Et;ti++)He.push(Ge[xe+ti]);if(oe>1)for(const ti of Pt){const xi=ti*Et;if(!(Ge[xi+2]<=pe)){Ge[xi+2]=pe;for(let yi=0;yi<Et;yi++)He.push(Ge[xi+yi])}}}}return He}_getOriginId(Ae){return Ae-this.points.length>>5}_getOriginZoom(Ae){return(Ae-this.points.length)%32}_map(Ae,pe,Te){if(Ae[pe+Hn]>1){const Ke=this.clusterProps[Ae[pe+Co]];return Te?Object.assign({},Ke):Ke}const Be=this.points[Ae[pe+Yr]].properties,Ve=this.options.map(Be);return Te&&Ve===Be?Object.assign({},Ve):Ve}}function zt(we,Ae,pe){return{type:"Feature",id:we[Ae+Yr],properties:dr(we,Ae,pe),geometry:{type:"Point",coordinates:[(Te=we[Ae],360*(Te-.5)),Il(we[Ae+1])]}};var Te}function dr(we,Ae,pe){const Te=we[Ae+Hn],Be=Te>=1e4?`${Math.round(Te/1e3)}k`:Te>=1e3?Math.round(Te/100)/10+"k":Te,Ve=we[Ae+Co],Ke=Ve===-1?{}:Object.assign({},pe[Ve]);return Object.assign(Ke,{cluster:!0,cluster_id:we[Ae+Yr],point_count:Te,point_count_abbreviated:Be})}function In(we){return we/360+.5}function Es(we){const Ae=Math.sin(we*Math.PI/180),pe=.5-.25*Math.log((1+Ae)/(1-Ae))/Math.PI;return pe<0?0:pe>1?1:pe}function Il(we){const Ae=(180-360*we)*Math.PI/180;return 360*Math.atan(Math.exp(Ae))/Math.PI-90}function La(we,Ae,pe,Te){for(var Be,Ve=Te,Ke=pe-Ae>>1,Qe=pe-Ae,Ge=we[Ae],He=we[Ae+1],Et=we[pe],xe=we[pe+1],Me=Ae+3;Me<pe;Me+=3){var ct=Cl(we[Me],we[Me+1],Ge,He,Et,xe);if(ct>Ve)Be=Me,Ve=ct;else if(ct===Ve){var Pt=Math.abs(Me-Ke);Pt<Qe&&(Be=Me,Qe=Pt)}}Ve>Te&&(Be-Ae>3&&La(we,Ae,Be,Te),we[Be+2]=Ve,pe-Be>3&&La(we,Be,pe,Te))}function Cl(we,Ae,pe,Te,Be,Ve){var Ke=Be-pe,Qe=Ve-Te;if(Ke!==0||Qe!==0){var Ge=((we-pe)*Ke+(Ae-Te)*Qe)/(Ke*Ke+Qe*Qe);Ge>1?(pe=Be,Te=Ve):Ge>0&&(pe+=Ke*Ge,Te+=Qe*Ge)}return(Ke=we-pe)*Ke+(Qe=Ae-Te)*Qe}function Un(we,Ae,pe,Te){var Be={id:we===void 0?null:we,type:Ae,geometry:pe,tags:Te,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ve){var Ke=Ve.geometry,Qe=Ve.type;if(Qe==="Point"||Qe==="MultiPoint"||Qe==="LineString")Ra(Ve,Ke);else if(Qe==="Polygon"||Qe==="MultiLineString")for(var Ge=0;Ge<Ke.length;Ge++)Ra(Ve,Ke[Ge]);else if(Qe==="MultiPolygon")for(Ge=0;Ge<Ke.length;Ge++)for(var He=0;He<Ke[Ge].length;He++)Ra(Ve,Ke[Ge][He])}(Be),Be}function Ra(we,Ae){for(var pe=0;pe<Ae.length;pe+=3)we.minX=Math.min(we.minX,Ae[pe]),we.minY=Math.min(we.minY,Ae[pe+1]),we.maxX=Math.max(we.maxX,Ae[pe]),we.maxY=Math.max(we.maxY,Ae[pe+1])}function pa(we,Ae,pe,Te){if(Ae.geometry){var Be=Ae.geometry.coordinates,Ve=Ae.geometry.type,Ke=Math.pow(pe.tolerance/((1<<pe.maxZoom)*pe.extent),2),Qe=[],Ge=Ae.id;if(pe.promoteId?Ge=Ae.properties[pe.promoteId]:pe.generateId&&(Ge=Te||0),Ve==="Point")Yt(Be,Qe);else if(Ve==="MultiPoint")for(var He=0;He<Be.length;He++)Yt(Be[He],Qe);else if(Ve==="LineString")Ue(Be,Qe,Ke,!1);else if(Ve==="MultiLineString"){if(pe.lineMetrics){for(He=0;He<Be.length;He++)Ue(Be[He],Qe=[],Ke,!1),we.push(Un(Ge,"LineString",Qe,Ae.properties));return}$e(Be,Qe,Ke,!1)}else if(Ve==="Polygon")$e(Be,Qe,Ke,!0);else{if(Ve!=="MultiPolygon"){if(Ve==="GeometryCollection"){for(He=0;He<Ae.geometry.geometries.length;He++)pa(we,{id:Ge,geometry:Ae.geometry.geometries[He],properties:Ae.properties},pe,Te);return}throw new Error("Input data is not a valid GeoJSON object.")}for(He=0;He<Be.length;He++){var Et=[];$e(Be[He],Et,Ke,!0),Qe.push(Et)}}we.push(Un(Ge,Ve,Qe,Ae.properties))}}function Yt(we,Ae){Ae.push(Pe(we[0])),Ae.push(Ft(we[1])),Ae.push(0)}function Ue(we,Ae,pe,Te){for(var Be,Ve,Ke=0,Qe=0;Qe<we.length;Qe++){var Ge=Pe(we[Qe][0]),He=Ft(we[Qe][1]);Ae.push(Ge),Ae.push(He),Ae.push(0),Qe>0&&(Ke+=Te?(Be*He-Ge*Ve)/2:Math.sqrt(Math.pow(Ge-Be,2)+Math.pow(He-Ve,2))),Be=Ge,Ve=He}var Et=Ae.length-3;Ae[2]=1,La(Ae,0,Et,pe),Ae[Et+2]=1,Ae.size=Math.abs(Ke),Ae.start=0,Ae.end=Ae.size}function $e(we,Ae,pe,Te){for(var Be=0;Be<we.length;Be++){var Ve=[];Ue(we[Be],Ve,pe,Te),Ae.push(Ve)}}function Pe(we){return we/360+.5}function Ft(we){var Ae=Math.sin(we*Math.PI/180),pe=.5-.25*Math.log((1+Ae)/(1-Ae))/Math.PI;return pe<0?0:pe>1?1:pe}function Zt(we,Ae,pe,Te,Be,Ve,Ke,Qe){if(Te/=Ae,Ve>=(pe/=Ae)&&Ke<Te)return we;if(Ke<pe||Ve>=Te)return null;for(var Ge=[],He=0;He<we.length;He++){var Et=we[He],xe=Et.geometry,Me=Et.type,ct=Be===0?Et.minX:Et.minY,Pt=Be===0?Et.maxX:Et.maxY;if(ct>=pe&&Pt<Te)Ge.push(Et);else if(!(Pt<pe||ct>=Te)){var o=[];if(Me==="Point"||Me==="MultiPoint")ni(xe,o,pe,Te,Be);else if(Me==="LineString")ri(xe,o,pe,Te,Be,!1,Qe.lineMetrics);else if(Me==="MultiLineString")Oi(xe,o,pe,Te,Be,!1);else if(Me==="Polygon")Oi(xe,o,pe,Te,Be,!0);else if(Me==="MultiPolygon")for(var oe=0;oe<xe.length;oe++){var ti=[];Oi(xe[oe],ti,pe,Te,Be,!0),ti.length&&o.push(ti)}if(o.length){if(Qe.lineMetrics&&Me==="LineString"){for(oe=0;oe<o.length;oe++)Ge.push(Un(Et.id,Me,o[oe],Et.tags));continue}Me!=="LineString"&&Me!=="MultiLineString"||(o.length===1?(Me="LineString",o=o[0]):Me="MultiLineString"),Me!=="Point"&&Me!=="MultiPoint"||(Me=o.length===3?"Point":"MultiPoint"),Ge.push(Un(Et.id,Me,o,Et.tags))}}}return Ge.length?Ge:null}function ni(we,Ae,pe,Te,Be){for(var Ve=0;Ve<we.length;Ve+=3){var Ke=we[Ve+Be];Ke>=pe&&Ke<=Te&&(Ae.push(we[Ve]),Ae.push(we[Ve+1]),Ae.push(we[Ve+2]))}}function ri(we,Ae,pe,Te,Be,Ve,Ke){for(var Qe,Ge,He=Qt(we),Et=Be===0?Ki:Kr,xe=we.start,Me=0;Me<we.length-3;Me+=3){var ct=we[Me],Pt=we[Me+1],o=we[Me+2],oe=we[Me+3],ti=we[Me+4],xi=Be===0?ct:Pt,yi=Be===0?oe:ti,ai=!1;Ke&&(Qe=Math.sqrt(Math.pow(ct-oe,2)+Math.pow(Pt-ti,2))),xi<pe?yi>pe&&(Ge=Et(He,ct,Pt,oe,ti,pe),Ke&&(He.start=xe+Qe*Ge)):xi>Te?yi<Te&&(Ge=Et(He,ct,Pt,oe,ti,Te),Ke&&(He.start=xe+Qe*Ge)):Qi(He,ct,Pt,o),yi<pe&&xi>=pe&&(Ge=Et(He,ct,Pt,oe,ti,pe),ai=!0),yi>Te&&xi<=Te&&(Ge=Et(He,ct,Pt,oe,ti,Te),ai=!0),!Ve&&ai&&(Ke&&(He.end=xe+Qe*Ge),Ae.push(He),He=Qt(we)),Ke&&(xe+=Qe)}var pi=we.length-3;ct=we[pi],Pt=we[pi+1],o=we[pi+2],(xi=Be===0?ct:Pt)>=pe&&xi<=Te&&Qi(He,ct,Pt,o),pi=He.length-3,Ve&&pi>=3&&(He[pi]!==He[0]||He[pi+1]!==He[1])&&Qi(He,He[0],He[1],He[2]),He.length&&Ae.push(He)}function Qt(we){var Ae=[];return Ae.size=we.size,Ae.start=we.start,Ae.end=we.end,Ae}function Oi(we,Ae,pe,Te,Be,Ve){for(var Ke=0;Ke<we.length;Ke++)ri(we[Ke],Ae,pe,Te,Be,Ve,!1)}function Qi(we,Ae,pe,Te){we.push(Ae),we.push(pe),we.push(Te)}function Ki(we,Ae,pe,Te,Be,Ve){var Ke=(Ve-Ae)/(Te-Ae);return we.push(Ve),we.push(pe+(Be-pe)*Ke),we.push(1),Ke}function Kr(we,Ae,pe,Te,Be,Ve){var Ke=(Ve-pe)/(Be-pe);return we.push(Ae+(Te-Ae)*Ke),we.push(Ve),we.push(1),Ke}function _n(we,Ae){for(var pe=[],Te=0;Te<we.length;Te++){var Be,Ve=we[Te],Ke=Ve.type;if(Ke==="Point"||Ke==="MultiPoint"||Ke==="LineString")Be=ts(Ve.geometry,Ae);else if(Ke==="MultiLineString"||Ke==="Polygon"){Be=[];for(var Qe=0;Qe<Ve.geometry.length;Qe++)Be.push(ts(Ve.geometry[Qe],Ae))}else if(Ke==="MultiPolygon")for(Be=[],Qe=0;Qe<Ve.geometry.length;Qe++){for(var Ge=[],He=0;He<Ve.geometry[Qe].length;He++)Ge.push(ts(Ve.geometry[Qe][He],Ae));Be.push(Ge)}pe.push(Un(Ve.id,Ke,Be,Ve.tags))}return pe}function ts(we,Ae){var pe=[];pe.size=we.size,we.start!==void 0&&(pe.start=we.start,pe.end=we.end);for(var Te=0;Te<we.length;Te+=3)pe.push(we[Te]+Ae,we[Te+1],we[Te+2]);return pe}function oi(we,Ae){if(we.transformed)return we;var pe,Te,Be,Ve=1<<we.z,Ke=we.x,Qe=we.y;for(pe=0;pe<we.features.length;pe++){var Ge=we.features[pe],He=Ge.geometry,Et=Ge.type;if(Ge.geometry=[],Et===1)for(Te=0;Te<He.length;Te+=2)Ge.geometry.push(gn(He[Te],He[Te+1],Ae,Ve,Ke,Qe));else for(Te=0;Te<He.length;Te++){var xe=[];for(Be=0;Be<He[Te].length;Be+=2)xe.push(gn(He[Te][Be],He[Te][Be+1],Ae,Ve,Ke,Qe));Ge.geometry.push(xe)}}return we.transformed=!0,we}function gn(we,Ae,pe,Te,Be,Ve){return[Math.round(pe*(we*Te-Be)),Math.round(pe*(Ae*Te-Ve))]}function vr(we,Ae,pe,Te,Be){for(var Ve=Ae===Be.maxZoom?0:Be.tolerance/((1<<Ae)*Be.extent),Ke={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:pe,y:Te,z:Ae,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Qe=0;Qe<we.length;Qe++){Ke.numFeatures++,ys(Ke,we[Qe],Ve,Be);var Ge=we[Qe].minX,He=we[Qe].minY,Et=we[Qe].maxX,xe=we[Qe].maxY;Ge<Ke.minX&&(Ke.minX=Ge),He<Ke.minY&&(Ke.minY=He),Et>Ke.maxX&&(Ke.maxX=Et),xe>Ke.maxY&&(Ke.maxY=xe)}return Ke}function ys(we,Ae,pe,Te){var Be=Ae.geometry,Ve=Ae.type,Ke=[];if(Ve==="Point"||Ve==="MultiPoint")for(var Qe=0;Qe<Be.length;Qe+=3)Ke.push(Be[Qe]),Ke.push(Be[Qe+1]),we.numPoints++,we.numSimplified++;else if(Ve==="LineString")ls(Ke,Be,we,pe,!1,!1);else if(Ve==="MultiLineString"||Ve==="Polygon")for(Qe=0;Qe<Be.length;Qe++)ls(Ke,Be[Qe],we,pe,Ve==="Polygon",Qe===0);else if(Ve==="MultiPolygon")for(var Ge=0;Ge<Be.length;Ge++){var He=Be[Ge];for(Qe=0;Qe<He.length;Qe++)ls(Ke,He[Qe],we,pe,!0,Qe===0)}if(Ke.length){var Et=Ae.tags||null;if(Ve==="LineString"&&Te.lineMetrics){for(var xe in Et={},Ae.tags)Et[xe]=Ae.tags[xe];Et.mapbox_clip_start=Be.start/Be.size,Et.mapbox_clip_end=Be.end/Be.size}var Me={geometry:Ke,type:Ve==="Polygon"||Ve==="MultiPolygon"?3:Ve==="LineString"||Ve==="MultiLineString"?2:1,tags:Et};Ae.id!==null&&(Me.id=Ae.id),we.features.push(Me)}}function ls(we,Ae,pe,Te,Be,Ve){var Ke=Te*Te;if(Te>0&&Ae.size<(Be?Ke:Te))pe.numPoints+=Ae.length/3;else{for(var Qe=[],Ge=0;Ge<Ae.length;Ge+=3)(Te===0||Ae[Ge+2]>Ke)&&(pe.numSimplified++,Qe.push(Ae[Ge]),Qe.push(Ae[Ge+1])),pe.numPoints++;Be&&function(He,Et){for(var xe=0,Me=0,ct=He.length,Pt=ct-2;Me<ct;Pt=Me,Me+=2)xe+=(He[Me]-He[Pt])*(He[Me+1]+He[Pt+1]);if(xe>0===Et)for(Me=0,ct=He.length;Me<ct/2;Me+=2){var o=He[Me],oe=He[Me+1];He[Me]=He[ct-2-Me],He[Me+1]=He[ct-1-Me],He[ct-2-Me]=o,He[ct-1-Me]=oe}}(Qe,Ve),we.push(Qe)}}function gi(we,Ae){var pe=(Ae=this.options=function(Be,Ve){for(var Ke in Ve)Be[Ke]=Ve[Ke];return Be}(Object.create(this.options),Ae)).debug;if(pe&&console.time("preprocess data"),Ae.maxZoom<0||Ae.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Ae.promoteId&&Ae.generateId)throw new Error("promoteId and generateId cannot be used together.");var Te=function(Be,Ve){var Ke=[];if(Be.type==="FeatureCollection")for(var Qe=0;Qe<Be.features.length;Qe++)pa(Ke,Be.features[Qe],Ve,Qe);else pa(Ke,Be.type==="Feature"?Be:{geometry:Be},Ve);return Ke}(we,Ae);this.tiles={},this.tileCoords=[],pe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Ae.indexMaxZoom,Ae.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Te=function(Be,Ve){var Ke=Ve.buffer/Ve.extent,Qe=Be,Ge=Zt(Be,1,-1-Ke,Ke,0,-1,2,Ve),He=Zt(Be,1,1-Ke,2+Ke,0,-1,2,Ve);return(Ge||He)&&(Qe=Zt(Be,1,-Ke,1+Ke,0,-1,2,Ve)||[],Ge&&(Qe=_n(Ge,1).concat(Qe)),He&&(Qe=Qe.concat(_n(He,-1)))),Qe}(Te,Ae),Te.length&&this.splitTile(Te,0,0,0),pe&&(Te.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function br(we,Ae,pe){return 32*((1<<we)*pe+Ae)+we}function wr(we,Ae){return Ae?we.properties[Ae]:we.id}function Cn(we,Ae){if(we==null)return!0;if(we.type==="Feature")return wr(we,Ae)!=null;if(we.type==="FeatureCollection"){const pe=new Set;for(const Te of we.features){const Be=wr(Te,Ae);if(Be==null||pe.has(Be))return!1;pe.add(Be)}return!0}return!1}function io(we,Ae){const pe=new Map;if(we!=null)if(we.type==="Feature")pe.set(wr(we,Ae),we);else for(const Te of we.features)pe.set(wr(Te,Ae),Te);return pe}gi.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},gi.prototype.splitTile=function(we,Ae,pe,Te,Be,Ve,Ke){for(var Qe=[we,Ae,pe,Te],Ge=this.options,He=Ge.debug;Qe.length;){Te=Qe.pop(),pe=Qe.pop(),Ae=Qe.pop(),we=Qe.pop();var Et=1<<Ae,xe=br(Ae,pe,Te),Me=this.tiles[xe];if(!Me&&(He>1&&console.time("creation"),Me=this.tiles[xe]=vr(we,Ae,pe,Te,Ge),this.tileCoords.push({z:Ae,x:pe,y:Te}),He)){He>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Ae,pe,Te,Me.numFeatures,Me.numPoints,Me.numSimplified),console.timeEnd("creation"));var ct="z"+Ae;this.stats[ct]=(this.stats[ct]||0)+1,this.total++}if(Me.source=we,Be){if(Ae===Ge.maxZoom||Ae===Be)continue;var Pt=1<<Be-Ae;if(pe!==Math.floor(Ve/Pt)||Te!==Math.floor(Ke/Pt))continue}else if(Ae===Ge.indexMaxZoom||Me.numPoints<=Ge.indexMaxPoints)continue;if(Me.source=null,we.length!==0){He>1&&console.time("clipping");var o,oe,ti,xi,yi,ai,pi=.5*Ge.buffer/Ge.extent,gr=.5-pi,bi=.5+pi,zi=1+pi;o=oe=ti=xi=null,yi=Zt(we,Et,pe-pi,pe+bi,0,Me.minX,Me.maxX,Ge),ai=Zt(we,Et,pe+gr,pe+zi,0,Me.minX,Me.maxX,Ge),we=null,yi&&(o=Zt(yi,Et,Te-pi,Te+bi,1,Me.minY,Me.maxY,Ge),oe=Zt(yi,Et,Te+gr,Te+zi,1,Me.minY,Me.maxY,Ge),yi=null),ai&&(ti=Zt(ai,Et,Te-pi,Te+bi,1,Me.minY,Me.maxY,Ge),xi=Zt(ai,Et,Te+gr,Te+zi,1,Me.minY,Me.maxY,Ge),ai=null),He>1&&console.timeEnd("clipping"),Qe.push(o||[],Ae+1,2*pe,2*Te),Qe.push(oe||[],Ae+1,2*pe,2*Te+1),Qe.push(ti||[],Ae+1,2*pe+1,2*Te),Qe.push(xi||[],Ae+1,2*pe+1,2*Te+1)}}},gi.prototype.getTile=function(we,Ae,pe){var Te=this.options,Be=Te.extent,Ve=Te.debug;if(we<0||we>24)return null;var Ke=1<<we,Qe=br(we,Ae=(Ae%Ke+Ke)%Ke,pe);if(this.tiles[Qe])return oi(this.tiles[Qe],Be);Ve>1&&console.log("drilling down to z%d-%d-%d",we,Ae,pe);for(var Ge,He=we,Et=Ae,xe=pe;!Ge&&He>0;)He--,Et=Math.floor(Et/2),xe=Math.floor(xe/2),Ge=this.tiles[br(He,Et,xe)];return Ge&&Ge.source?(Ve>1&&console.log("found parent tile z%d-%d-%d",He,Et,xe),Ve>1&&console.time("drilling down"),this.splitTile(Ge.source,He,Et,xe,we,Ae,pe),Ve>1&&console.timeEnd("drilling down"),this.tiles[Qe]?oi(this.tiles[Qe],Be):null):null};class Sr extends qt{constructor(Ae,pe,Te,Be){super(Ae,pe,Te),this._dataUpdateable=new Map,this.loadGeoJSON=(Ve,Ke)=>{const{promoteId:Qe}=Ve;if(Ve.request)return P.f(Ve.request,(Ge,He,Et,xe)=>{this._dataUpdateable=Cn(He,Qe)?io(He,Qe):void 0,Ke(Ge,He,Et,xe)});if(typeof Ve.data=="string")try{const Ge=JSON.parse(Ve.data);this._dataUpdateable=Cn(Ge,Qe)?io(Ge,Qe):void 0,Ke(null,Ge)}catch{Ke(new Error(`Input data given to '${Ve.source}' is not a valid GeoJSON object.`))}else Ve.dataDiff?this._dataUpdateable?(function(Ge,He,Et){var xe,Me,ct,Pt;if(He.removeAll&&Ge.clear(),He.remove)for(const o of He.remove)Ge.delete(o);if(He.add)for(const o of He.add){const oe=wr(o,Et);oe!=null&&Ge.set(oe,o)}if(He.update)for(const o of He.update){let oe=Ge.get(o.id);if(oe==null)continue;const ti=!o.removeAllProperties&&(((xe=o.removeProperties)===null||xe===void 0?void 0:xe.length)>0||((Me=o.addOrUpdateProperties)===null||Me===void 0?void 0:Me.length)>0);if((o.newGeometry||o.removeAllProperties||ti)&&(oe=Object.assign({},oe),Ge.set(o.id,oe),ti&&(oe.properties=Object.assign({},oe.properties))),o.newGeometry&&(oe.geometry=o.newGeometry),o.removeAllProperties)oe.properties={};else if(((ct=o.removeProperties)===null||ct===void 0?void 0:ct.length)>0)for(const xi of o.removeProperties)Object.prototype.hasOwnProperty.call(oe.properties,xi)&&delete oe.properties[xi];if(((Pt=o.addOrUpdateProperties)===null||Pt===void 0?void 0:Pt.length)>0)for(const{key:xi,value:yi}of o.addOrUpdateProperties)oe.properties[xi]=yi}}(this._dataUpdateable,Ve.dataDiff,Qe),Ke(null,{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())})):Ke(new Error(`Cannot update existing geojson data in ${Ve.source}`)):Ke(new Error(`Input data given to '${Ve.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},this.loadVectorData=this.loadGeoJSONTile,Be&&(this.loadGeoJSON=Be)}loadGeoJSONTile(Ae,pe){const Te=Ae.tileID.canonical;if(!this._geoJSONIndex)return pe(null,null);const Be=this._geoJSONIndex.getTile(Te.z,Te.x,Te.y);if(!Be)return pe(null,null);const Ve=new class{constructor(Qe){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=P.N,this.length=Qe.length,this._features=Qe}feature(Qe){return new class{constructor(Ge){this._feature=Ge,this.extent=P.N,this.type=Ge.type,this.properties=Ge.tags,"id"in Ge&&!isNaN(Ge.id)&&(this.id=parseInt(Ge.id,10))}loadGeometry(){if(this._feature.type===1){const Ge=[];for(const He of this._feature.geometry)Ge.push([new P.P(He[0],He[1])]);return Ge}{const Ge=[];for(const He of this._feature.geometry){const Et=[];for(const xe of He)Et.push(new P.P(xe[0],xe[1]));Ge.push(Et)}return Ge}}toGeoJSON(Ge,He,Et){return Vr.call(this,Ge,He,Et)}}(this._features[Qe])}}(Be.features);let Ke=Io(Ve);Ke.byteOffset===0&&Ke.byteLength===Ke.buffer.byteLength||(Ke=new Uint8Array(Ke)),pe(null,{vectorTile:Ve,rawData:Ke.buffer})}loadData(Ae,pe){var Te;(Te=this._pendingRequest)===null||Te===void 0||Te.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const Be=!!(Ae&&Ae.request&&Ae.request.collectResourceTiming)&&new P.bu(Ae.request);this._pendingCallback=pe,this._pendingRequest=this.loadGeoJSON(Ae,(Ve,Ke)=>{if(delete this._pendingCallback,delete this._pendingRequest,Ve||!Ke)return pe(Ve);if(typeof Ke!="object")return pe(new Error(`Input data given to '${Ae.source}' is not a valid GeoJSON object.`));{Ei(Ke,!0);try{if(Ae.filter){const Ge=P.bC(Ae.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ge.result==="error")throw new Error(Ge.value.map(Et=>`${Et.key}: ${Et.message}`).join(", "));Ke={type:"FeatureCollection",features:Ke.features.filter(Et=>Ge.value.evaluate({zoom:0},Et))}}this._geoJSONIndex=Ae.cluster?new to(function({superclusterOptions:Ge,clusterProperties:He}){if(!He||!Ge)return Ge;const Et={},xe={},Me={accumulated:null,zoom:0},ct={properties:null},Pt=Object.keys(He);for(const o of Pt){const[oe,ti]=He[o],xi=P.bC(ti),yi=P.bC(typeof oe=="string"?[oe,["accumulated"],["get",o]]:oe);Et[o]=xi.value,xe[o]=yi.value}return Ge.map=o=>{ct.properties=o;const oe={};for(const ti of Pt)oe[ti]=Et[ti].evaluate(Me,ct);return oe},Ge.reduce=(o,oe)=>{ct.properties=oe;for(const ti of Pt)Me.accumulated=o[ti],o[ti]=xe[ti].evaluate(Me,ct)},Ge}(Ae)).load(Ke.features):function(Ge,He){return new gi(Ge,He)}(Ke,Ae.geojsonVtOptions)}catch(Ge){return pe(Ge)}this.loaded={};const Qe={};if(Be){const Ge=Be.finish();Ge&&(Qe.resourceTiming={},Qe.resourceTiming[Ae.source]=JSON.parse(JSON.stringify(Ge)))}pe(null,Qe)}})}reloadTile(Ae,pe){const Te=this.loaded;return Te&&Te[Ae.uid]?super.reloadTile(Ae,pe):this.loadTile(Ae,pe)}removeSource(Ae,pe){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),pe()}getClusterExpansionZoom(Ae,pe){try{pe(null,this._geoJSONIndex.getClusterExpansionZoom(Ae.clusterId))}catch(Te){pe(Te)}}getClusterChildren(Ae,pe){try{pe(null,this._geoJSONIndex.getChildren(Ae.clusterId))}catch(Te){pe(Te)}}getClusterLeaves(Ae,pe){try{pe(null,this._geoJSONIndex.getLeaves(Ae.clusterId,Ae.limit,Ae.offset))}catch(Te){pe(Te)}}}class kt{constructor(Ae){this.self=Ae,this.actor=new P.C(Ae,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:qt,geojson:Sr},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(pe,Te)=>{if(this.workerSourceTypes[pe])throw new Error(`Worker source with name "${pe}" already registered.`);this.workerSourceTypes[pe]=Te},this.self.registerRTLTextPlugin=pe=>{if(P.bD.isParsed())throw new Error("RTL text plugin already registered.");P.bD.applyArabicShaping=pe.applyArabicShaping,P.bD.processBidirectionalText=pe.processBidirectionalText,P.bD.processStyledBidirectionalText=pe.processStyledBidirectionalText}}setReferrer(Ae,pe){this.referrer=pe}setImages(Ae,pe,Te){this.availableImages[Ae]=pe;for(const Be in this.workerSources[Ae]){const Ve=this.workerSources[Ae][Be];for(const Ke in Ve)Ve[Ke].availableImages=pe}Te()}setLayers(Ae,pe,Te){this.getLayerIndex(Ae).replace(pe),Te()}updateLayers(Ae,pe,Te){this.getLayerIndex(Ae).update(pe.layers,pe.removedIds),Te()}loadTile(Ae,pe,Te){this.getWorkerSource(Ae,pe.type,pe.source).loadTile(pe,Te)}loadDEMTile(Ae,pe,Te){this.getDEMWorkerSource(Ae,pe.source).loadTile(pe,Te)}reloadTile(Ae,pe,Te){this.getWorkerSource(Ae,pe.type,pe.source).reloadTile(pe,Te)}abortTile(Ae,pe,Te){this.getWorkerSource(Ae,pe.type,pe.source).abortTile(pe,Te)}removeTile(Ae,pe,Te){this.getWorkerSource(Ae,pe.type,pe.source).removeTile(pe,Te)}removeDEMTile(Ae,pe){this.getDEMWorkerSource(Ae,pe.source).removeTile(pe)}removeSource(Ae,pe,Te){if(!this.workerSources[Ae]||!this.workerSources[Ae][pe.type]||!this.workerSources[Ae][pe.type][pe.source])return;const Be=this.workerSources[Ae][pe.type][pe.source];delete this.workerSources[Ae][pe.type][pe.source],Be.removeSource!==void 0?Be.removeSource(pe,Te):Te()}loadWorkerSource(Ae,pe,Te){try{this.self.importScripts(pe.url),Te()}catch(Be){Te(Be.toString())}}syncRTLPluginState(Ae,pe,Te){try{P.bD.setState(pe);const Be=P.bD.getPluginURL();if(P.bD.isLoaded()&&!P.bD.isParsed()&&Be!=null){this.self.importScripts(Be);const Ve=P.bD.isParsed();Te(Ve?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Be}`),Ve)}}catch(Be){Te(Be.toString())}}getAvailableImages(Ae){let pe=this.availableImages[Ae];return pe||(pe=[]),pe}getLayerIndex(Ae){let pe=this.layerIndexes[Ae];return pe||(pe=this.layerIndexes[Ae]=new We),pe}getWorkerSource(Ae,pe,Te){return this.workerSources[Ae]||(this.workerSources[Ae]={}),this.workerSources[Ae][pe]||(this.workerSources[Ae][pe]={}),this.workerSources[Ae][pe][Te]||(this.workerSources[Ae][pe][Te]=new this.workerSourceTypes[pe]({send:(Be,Ve,Ke)=>{this.actor.send(Be,Ve,Ke,Ae)}},this.getLayerIndex(Ae),this.getAvailableImages(Ae))),this.workerSources[Ae][pe][Te]}getDEMWorkerSource(Ae,pe){return this.demWorkerSources[Ae]||(this.demWorkerSources[Ae]={}),this.demWorkerSources[Ae][pe]||(this.demWorkerSources[Ae][pe]=new $t),this.demWorkerSources[Ae][pe]}}return P.i()&&(self.worker=new kt(self)),kt}),dt(["./shared"],function(P){var We="3.6.2";class me{static testProp(l){if(!me.docStyle)return l[0];for(let g=0;g<l.length;g++)if(l[g]in me.docStyle)return l[g];return l[0]}static create(l,g,S){const k=window.document.createElement(l);return g!==void 0&&(k.className=g),S&&S.appendChild(k),k}static createNS(l,g){return window.document.createElementNS(l,g)}static disableDrag(){me.docStyle&&me.selectProp&&(me.userSelect=me.docStyle[me.selectProp],me.docStyle[me.selectProp]="none")}static enableDrag(){me.docStyle&&me.selectProp&&(me.docStyle[me.selectProp]=me.userSelect)}static setTransform(l,g){l.style[me.transformProp]=g}static addEventListener(l,g,S,k={}){l.addEventListener(g,S,"passive"in k?k:k.capture)}static removeEventListener(l,g,S,k={}){l.removeEventListener(g,S,"passive"in k?k:k.capture)}static suppressClickInternal(l){l.preventDefault(),l.stopPropagation(),window.removeEventListener("click",me.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",me.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",me.suppressClickInternal,!0)},0)}static mousePos(l,g){const S=l.getBoundingClientRect();return new P.P(g.clientX-S.left-l.clientLeft,g.clientY-S.top-l.clientTop)}static touchPos(l,g){const S=l.getBoundingClientRect(),k=[];for(let F=0;F<g.length;F++)k.push(new P.P(g[F].clientX-S.left-l.clientLeft,g[F].clientY-S.top-l.clientTop));return k}static mouseButton(l){return l.button}static remove(l){l.parentNode&&l.parentNode.removeChild(l)}}me.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,me.selectProp=me.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),me.transformProp=me.testProp(["transform","WebkitTransform"]);const Xt={supported:!1,testSupport:function(z){!qt&&yt&&($t?ui(z):Rt=z)}};let Rt,yt,qt=!1,$t=!1;function ui(z){const l=z.createTexture();z.bindTexture(z.TEXTURE_2D,l);try{if(z.texImage2D(z.TEXTURE_2D,0,z.RGBA,z.RGBA,z.UNSIGNED_BYTE,yt),z.isContextLost())return;Xt.supported=!0}catch{}z.deleteTexture(l),qt=!0}var di,Ei;typeof document<"u"&&(yt=document.createElement("img"),yt.onload=function(){Rt&&ui(Rt),Rt=null,$t=!0},yt.onerror=function(){qt=!0,Rt=null},yt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(z){let l,g,S,k;z.resetRequestQueue=()=>{l=[],g=0,S=0,k={}},z.addThrottleControl=f=>{const y=S++;return k[y]=f,y},z.removeThrottleControl=f=>{delete k[f],u()},z.getImage=(f,y,b=!0)=>{Xt.supported&&(f.headers||(f.headers={}),f.headers.accept="image/webp,*/*");const I={requestParameters:f,supportImageRefresh:b,callback:y,cancelled:!1,completed:!1,cancel:()=>{I.completed||I.cancelled||(I.cancelled=!0,I.innerRequest&&(I.innerRequest.cancel(),g--),u())}};return l.push(I),u(),I};const F=f=>{const{requestParameters:y,supportImageRefresh:b,callback:I}=f;return P.e(y,{type:"image"}),(b!==!1||P.i()||P.g(y.url)||y.headers&&!Object.keys(y.headers).reduce((R,V)=>R&&V==="accept",!0)?P.m:h)(y,(R,V,W,Y)=>{Z(f,I,R,V,W,Y)})},Z=(f,y,b,I,R,V)=>{b?y(b):I instanceof HTMLImageElement||P.a(I)?y(null,I):I&&((W,Y)=>{typeof createImageBitmap=="function"?P.b(W,Y):P.d(W,Y)})(I,(W,Y)=>{W!=null?y(W):Y!=null&&y(null,Y,{cacheControl:R,expires:V})}),f.cancelled||(f.completed=!0,g--,u())},u=()=>{const f=(()=>{const y=Object.keys(k);let b=!1;if(y.length>0){for(const I of y)if(b=k[I](),b)break}return b})()?P.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:P.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let y=g;y<f&&l.length>0;y++){const b=l.shift();if(b.cancelled){y--;continue}const I=F(b);g++,b.innerRequest=I}},h=(f,y)=>{const b=new Image,I=f.url;let R=!1;const V=f.credentials;return V&&V==="include"?b.crossOrigin="use-credentials":(V&&V==="same-origin"||!P.s(I))&&(b.crossOrigin="anonymous"),b.fetchPriority="high",b.onload=()=>{y(null,b),b.onerror=b.onload=null},b.onerror=()=>{R||y(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")),b.onerror=b.onload=null},b.src=I,{cancel:()=>{R=!0,b.src=""}}}}(di||(di={})),di.resetRequestQueue(),function(z){z.Glyphs="Glyphs",z.Image="Image",z.Source="Source",z.SpriteImage="SpriteImage",z.SpriteJSON="SpriteJSON",z.Style="Style",z.Tile="Tile",z.Unknown="Unknown"}(Ei||(Ei={}));class Vr{constructor(l){this._transformRequestFn=l}transformRequest(l,g){return this._transformRequestFn&&this._transformRequestFn(l,g)||{url:l}}normalizeSpriteURL(l,g,S){const k=function(F){const Z=F.match(kr);if(!Z)throw new Error(`Unable to parse URL "${F}"`);return{protocol:Z[1],authority:Z[2],path:Z[3]||"/",params:Z[4]?Z[4].split("&"):[]}}(l);return k.path+=`${g}${S}`,function(F){const Z=F.params.length?`?${F.params.join("&")}`:"";return`${F.protocol}://${F.authority}${F.path}${Z}`}(k)}setTransformRequest(l){this._transformRequestFn=l}}const kr=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function qr(z){var l=new P.A(3);return l[0]=z[0],l[1]=z[1],l[2]=z[2],l}var cn,jr=function(z,l,g){return z[0]=l[0]-g[0],z[1]=l[1]-g[1],z[2]=l[2]-g[2],z};cn=new P.A(3),P.A!=Float32Array&&(cn[0]=0,cn[1]=0,cn[2]=0);var Jn=function(z){var l=z[0],g=z[1];return l*l+g*g};function rn(z){const l=[];if(typeof z=="string")l.push({id:"default",url:z});else if(z&&z.length>0){const g=[];for(const{id:S,url:k}of z){const F=`${S}${k}`;g.indexOf(F)===-1&&(g.push(F),l.push({id:S,url:k}))}}return l}function pn(z,l,g,S,k){if(S)return void z(S);if(k!==Object.values(l).length||k!==Object.values(g).length)return;const F={};for(const Z in l){F[Z]={};const u=P.h.getImageCanvasContext(g[Z]),h=l[Z];for(const f in h){const{width:y,height:b,x:I,y:R,sdf:V,pixelRatio:W,stretchX:Y,stretchY:le,content:fe}=h[f];F[Z][f]={data:null,pixelRatio:W,sdf:V,stretchX:Y,stretchY:le,content:fe,spriteData:{width:y,height:b,x:I,y:R,context:u}}}}z(null,F)}(function(){var z=new P.A(2);P.A!=Float32Array&&(z[0]=0,z[1]=0)})();class At{constructor(l,g,S,k){this.context=l,this.format=S,this.texture=l.gl.createTexture(),this.update(g,k)}update(l,g,S){const{width:k,height:F}=l,Z=!(this.size&&this.size[0]===k&&this.size[1]===F||S),{context:u}=this,{gl:h}=u;if(this.useMipmap=!!(g&&g.useMipmap),h.bindTexture(h.TEXTURE_2D,this.texture),u.pixelStoreUnpackFlipY.set(!1),u.pixelStoreUnpack.set(1),u.pixelStoreUnpackPremultiplyAlpha.set(this.format===h.RGBA&&(!g||g.premultiply!==!1)),Z)this.size=[k,F],l instanceof HTMLImageElement||l instanceof HTMLCanvasElement||l instanceof HTMLVideoElement||l instanceof ImageData||P.a(l)?h.texImage2D(h.TEXTURE_2D,0,this.format,this.format,h.UNSIGNED_BYTE,l):h.texImage2D(h.TEXTURE_2D,0,this.format,k,F,0,this.format,h.UNSIGNED_BYTE,l.data);else{const{x:f,y}=S||{x:0,y:0};l instanceof HTMLImageElement||l instanceof HTMLCanvasElement||l instanceof HTMLVideoElement||l instanceof ImageData||P.a(l)?h.texSubImage2D(h.TEXTURE_2D,0,f,y,h.RGBA,h.UNSIGNED_BYTE,l):h.texSubImage2D(h.TEXTURE_2D,0,f,y,k,F,h.RGBA,h.UNSIGNED_BYTE,l.data)}this.useMipmap&&this.isSizePowerOfTwo()&&h.generateMipmap(h.TEXTURE_2D)}bind(l,g,S){const{context:k}=this,{gl:F}=k;F.bindTexture(F.TEXTURE_2D,this.texture),S!==F.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(S=F.LINEAR),l!==this.filter&&(F.texParameteri(F.TEXTURE_2D,F.TEXTURE_MAG_FILTER,l),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_MIN_FILTER,S||l),this.filter=l),g!==this.wrap&&(F.texParameteri(F.TEXTURE_2D,F.TEXTURE_WRAP_S,g),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_WRAP_T,g),this.wrap=g)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:l}=this.context;l.deleteTexture(this.texture),this.texture=null}}function tr(z){const{userImage:l}=z;return!!(l&&l.render&&l.render())&&(z.data.replace(new Uint8Array(l.data.buffer)),!0)}class Sn extends P.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new P.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(l){if(this.loaded!==l&&(this.loaded=l,l)){for(const{ids:g,callback:S}of this.requestors)this._notify(g,S);this.requestors=[]}}getImage(l){const g=this.images[l];if(g&&!g.data&&g.spriteData){const S=g.spriteData;g.data=new P.R({width:S.width,height:S.height},S.context.getImageData(S.x,S.y,S.width,S.height).data),g.spriteData=null}return g}addImage(l,g){if(this.images[l])throw new Error(`Image id ${l} already exist, use updateImage instead`);this._validate(l,g)&&(this.images[l]=g)}_validate(l,g){let S=!0;const k=g.data||g.spriteData;return this._validateStretch(g.stretchX,k&&k.width)||(this.fire(new P.j(new Error(`Image "${l}" has invalid "stretchX" value`))),S=!1),this._validateStretch(g.stretchY,k&&k.height)||(this.fire(new P.j(new Error(`Image "${l}" has invalid "stretchY" value`))),S=!1),this._validateContent(g.content,g)||(this.fire(new P.j(new Error(`Image "${l}" has invalid "content" value`))),S=!1),S}_validateStretch(l,g){if(!l)return!0;let S=0;for(const k of l){if(k[0]<S||k[1]<k[0]||g<k[1])return!1;S=k[1]}return!0}_validateContent(l,g){if(!l)return!0;if(l.length!==4)return!1;const S=g.spriteData,k=S&&S.width||g.data.width,F=S&&S.height||g.data.height;return!(l[0]<0||k<l[0]||l[1]<0||F<l[1]||l[2]<0||k<l[2]||l[3]<0||F<l[3]||l[2]<l[0]||l[3]<l[1])}updateImage(l,g,S=!0){const k=this.getImage(l);if(S&&(k.data.width!==g.data.width||k.data.height!==g.data.height))throw new Error(`size mismatch between old image (${k.data.width}x${k.data.height}) and new image (${g.data.width}x${g.data.height}).`);g.version=k.version+1,this.images[l]=g,this.updatedImages[l]=!0}removeImage(l){const g=this.images[l];delete this.images[l],delete this.patterns[l],g.userImage&&g.userImage.onRemove&&g.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(l,g){let S=!0;if(!this.isLoaded())for(const k of l)this.images[k]||(S=!1);this.isLoaded()||S?this._notify(l,g):this.requestors.push({ids:l,callback:g})}_notify(l,g){const S={};for(const k of l){let F=this.getImage(k);F||(this.fire(new P.k("styleimagemissing",{id:k})),F=this.getImage(k)),F?S[k]={data:F.data.clone(),pixelRatio:F.pixelRatio,sdf:F.sdf,version:F.version,stretchX:F.stretchX,stretchY:F.stretchY,content:F.content,hasRenderCallback:!!(F.userImage&&F.userImage.render)}:P.w(`Image "${k}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}g(null,S)}getPixelSize(){const{width:l,height:g}=this.atlasImage;return{width:l,height:g}}getPattern(l){const g=this.patterns[l],S=this.getImage(l);if(!S)return null;if(g&&g.position.version===S.version)return g.position;if(g)g.position.version=S.version;else{const k={w:S.data.width+2,h:S.data.height+2,x:0,y:0},F=new P.I(k,S);this.patterns[l]={bin:k,position:F}}return this._updatePatternAtlas(),this.patterns[l].position}bind(l){const g=l.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new At(l,this.atlasImage,g.RGBA),this.atlasTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE)}_updatePatternAtlas(){const l=[];for(const F in this.patterns)l.push(this.patterns[F].bin);const{w:g,h:S}=P.p(l),k=this.atlasImage;k.resize({width:g||1,height:S||1});for(const F in this.patterns){const{bin:Z}=this.patterns[F],u=Z.x+1,h=Z.y+1,f=this.getImage(F).data,y=f.width,b=f.height;P.R.copy(f,k,{x:0,y:0},{x:u,y:h},{width:y,height:b}),P.R.copy(f,k,{x:0,y:b-1},{x:u,y:h-1},{width:y,height:1}),P.R.copy(f,k,{x:0,y:0},{x:u,y:h+b},{width:y,height:1}),P.R.copy(f,k,{x:y-1,y:0},{x:u-1,y:h},{width:1,height:b}),P.R.copy(f,k,{x:0,y:0},{x:u+y,y:h},{width:1,height:b})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(l){for(const g of l){if(this.callbackDispatchedThisFrame[g])continue;this.callbackDispatchedThisFrame[g]=!0;const S=this.getImage(g);S||P.w(`Image with ID: "${g}" was not found`),tr(S)&&this.updateImage(g,S)}}}const Nn=1e20;function Li(z,l,g,S,k,F,Z,u,h){for(let f=l;f<l+S;f++)Ir(z,g*F+f,F,k,Z,u,h);for(let f=g;f<g+k;f++)Ir(z,f*F+l,1,S,Z,u,h)}function Ir(z,l,g,S,k,F,Z){F[0]=0,Z[0]=-Nn,Z[1]=Nn,k[0]=z[l];for(let u=1,h=0,f=0;u<S;u++){k[u]=z[l+u*g];const y=u*u;do{const b=F[h];f=(k[u]-k[b]+y-b*b)/(u-b)/2}while(f<=Z[h]&&--h>-1);h++,F[h]=u,Z[h]=f,Z[h+1]=Nn}for(let u=0,h=0;u<S;u++){for(;Z[h+1]<u;)h++;const f=F[h],y=u-f;z[l+u*g]=k[f]+y*y}}class as{constructor(l,g){this.requestManager=l,this.localIdeographFontFamily=g,this.entries={}}setURL(l){this.url=l}getGlyphs(l,g){const S=[];for(const k in l)for(const F of l[k])S.push({stack:k,id:F});P.o(S,({stack:k,id:F},Z)=>{let u=this.entries[k];u||(u=this.entries[k]={glyphs:{},requests:{},ranges:{}});let h=u.glyphs[F];if(h!==void 0)return void Z(null,{stack:k,id:F,glyph:h});if(h=this._tinySDF(u,k,F),h)return u.glyphs[F]=h,void Z(null,{stack:k,id:F,glyph:h});const f=Math.floor(F/256);if(256*f>65535)return void Z(new Error("glyphs > 65535 not supported"));if(u.ranges[f])return void Z(null,{stack:k,id:F,glyph:h});if(!this.url)return void Z(new Error("glyphsUrl is not set"));let y=u.requests[f];y||(y=u.requests[f]=[],as.loadGlyphRange(k,f,this.url,this.requestManager,(b,I)=>{if(I){for(const R in I)this._doesCharSupportLocalGlyph(+R)||(u.glyphs[+R]=I[+R]);u.ranges[f]=!0}for(const R of y)R(b,I);delete u.requests[f]})),y.push((b,I)=>{b?Z(b):I&&Z(null,{stack:k,id:F,glyph:I[F]||null})})},(k,F)=>{if(k)g(k);else if(F){const Z={};for(const{stack:u,id:h,glyph:f}of F)(Z[u]||(Z[u]={}))[h]=f&&{id:f.id,bitmap:f.bitmap.clone(),metrics:f.metrics};g(null,Z)}})}_doesCharSupportLocalGlyph(l){return!!this.localIdeographFontFamily&&(P.u["CJK Unified Ideographs"](l)||P.u["Hangul Syllables"](l)||P.u.Hiragana(l)||P.u.Katakana(l))}_tinySDF(l,g,S){const k=this.localIdeographFontFamily;if(!k||!this._doesCharSupportLocalGlyph(S))return;let F=l.tinySDF;if(!F){let u="400";/bold/i.test(g)?u="900":/medium/i.test(g)?u="500":/light/i.test(g)&&(u="200"),F=l.tinySDF=new as.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:k,fontWeight:u})}const Z=F.draw(String.fromCharCode(S));return{id:S,bitmap:new P.q({width:Z.width||60,height:Z.height||60},Z.data),metrics:{width:Z.glyphWidth/2||24,height:Z.glyphHeight/2||24,left:Z.glyphLeft/2+.5||0,top:Z.glyphTop/2-27.5||-8,advance:Z.glyphAdvance/2||24,isDoubleResolution:!0}}}}as.loadGlyphRange=function(z,l,g,S,k){const F=256*l,Z=F+255,u=S.transformRequest(g.replace("{fontstack}",z).replace("{range}",`${F}-${Z}`),Ei.Glyphs);P.l(u,(h,f)=>{if(h)k(h);else if(f){const y={};for(const b of P.n(f))y[b.id]=b;k(null,y)}})},as.TinySDF=class{constructor({fontSize:z=24,buffer:l=3,radius:g=8,cutoff:S=.25,fontFamily:k="sans-serif",fontWeight:F="normal",fontStyle:Z="normal"}={}){this.buffer=l,this.cutoff=S,this.radius=g;const u=this.size=z+4*l,h=this._createCanvas(u),f=this.ctx=h.getContext("2d",{willReadFrequently:!0});f.font=`${Z} ${F} ${z}px ${k}`,f.textBaseline="alphabetic",f.textAlign="left",f.fillStyle="black",this.gridOuter=new Float64Array(u*u),this.gridInner=new Float64Array(u*u),this.f=new Float64Array(u),this.z=new Float64Array(u+1),this.v=new Uint16Array(u)}_createCanvas(z){const l=document.createElement("canvas");return l.width=l.height=z,l}draw(z){const{width:l,actualBoundingBoxAscent:g,actualBoundingBoxDescent:S,actualBoundingBoxLeft:k,actualBoundingBoxRight:F}=this.ctx.measureText(z),Z=Math.ceil(g),u=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(F-k))),h=Math.min(this.size-this.buffer,Z+Math.ceil(S)),f=u+2*this.buffer,y=h+2*this.buffer,b=Math.max(f*y,0),I=new Uint8ClampedArray(b),R={data:I,width:f,height:y,glyphWidth:u,glyphHeight:h,glyphTop:Z,glyphLeft:0,glyphAdvance:l};if(u===0||h===0)return R;const{ctx:V,buffer:W,gridInner:Y,gridOuter:le}=this;V.clearRect(W,W,u,h),V.fillText(z,W,W+Z);const fe=V.getImageData(W,W,u,h);le.fill(Nn,0,b),Y.fill(0,0,b);for(let ye=0;ye<h;ye++)for(let Ie=0;Ie<u;Ie++){const ke=fe.data[4*(ye*u+Ie)+3]/255;if(ke===0)continue;const qe=(ye+W)*f+Ie+W;if(ke===1)le[qe]=0,Y[qe]=Nn;else{const ut=.5-ke;le[qe]=ut>0?ut*ut:0,Y[qe]=ut<0?ut*ut:0}}Li(le,0,0,f,y,f,this.f,this.v,this.z),Li(Y,W,W,u,h,f,this.f,this.v,this.z);for(let ye=0;ye<b;ye++){const Ie=Math.sqrt(le[ye])-Math.sqrt(Y[ye]);I[ye]=Math.round(255-255*(Ie/this.radius+this.cutoff))}return R}};class es{constructor(){this.specification=P.v.light.position}possiblyEvaluate(l,g){return P.z(l.expression.evaluate(g))}interpolate(l,g,S){return{x:P.B.number(l.x,g.x,S),y:P.B.number(l.y,g.y,S),z:P.B.number(l.z,g.z,S)}}}let wo;class Io extends P.E{constructor(l){super(),wo=wo||new P.r({anchor:new P.D(P.v.light.anchor),position:new es,color:new P.D(P.v.light.color),intensity:new P.D(P.v.light.intensity)}),this._transitionable=new P.T(wo),this.setLight(l),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(l,g={}){if(!this._validate(P.t,l,g))for(const S in l){const k=l[S];S.endsWith("-transition")?this._transitionable.setTransition(S.slice(0,-11),k):this._transitionable.setValue(S,k)}}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,g,S){return(!S||S.validate!==!1)&&P.x(this,l.call(P.y,P.e({value:g,style:{glyphs:!0,sprite:!0},styleSpec:P.v})))}}class Zo{constructor(l,g){this.width=l,this.height=g,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(l,g){const S=l.join(",")+String(g);return this.dashEntry[S]||(this.dashEntry[S]=this.addDash(l,g)),this.dashEntry[S]}getDashRanges(l,g,S){const k=[];let F=l.length%2==1?-l[l.length-1]*S:0,Z=l[0]*S,u=!0;k.push({left:F,right:Z,isDash:u,zeroLength:l[0]===0});let h=l[0];for(let f=1;f<l.length;f++){u=!u;const y=l[f];F=h*S,h+=y,Z=h*S,k.push({left:F,right:Z,isDash:u,zeroLength:y===0})}return k}addRoundDash(l,g,S){const k=g/2;for(let F=-S;F<=S;F++){const Z=this.width*(this.nextRow+S+F);let u=0,h=l[u];for(let f=0;f<this.width;f++){f/h.right>1&&(h=l[++u]);const y=Math.abs(f-h.left),b=Math.abs(f-h.right),I=Math.min(y,b);let R;const V=F/S*(k+1);if(h.isDash){const W=k-Math.abs(V);R=Math.sqrt(I*I+W*W)}else R=k-Math.sqrt(I*I+V*V);this.data[Z+f]=Math.max(0,Math.min(255,R+128))}}}addRegularDash(l){for(let u=l.length-1;u>=0;--u){const h=l[u],f=l[u+1];h.zeroLength?l.splice(u,1):f&&f.isDash===h.isDash&&(f.left=h.left,l.splice(u,1))}const g=l[0],S=l[l.length-1];g.isDash===S.isDash&&(g.left=S.left-this.width,S.right=g.right+this.width);const k=this.width*this.nextRow;let F=0,Z=l[F];for(let u=0;u<this.width;u++){u/Z.right>1&&(Z=l[++F]);const h=Math.abs(u-Z.left),f=Math.abs(u-Z.right),y=Math.min(h,f);this.data[k+u]=Math.max(0,Math.min(255,(Z.isDash?y:-y)+128))}}addDash(l,g){const S=g?7:0,k=2*S+1;if(this.nextRow+k>this.height)return P.w("LineAtlas out of space"),null;let F=0;for(let u=0;u<l.length;u++)F+=l[u];if(F!==0){const u=this.width/F,h=this.getDashRanges(l,this.width,u);g?this.addRoundDash(h,u,S):this.addRegularDash(h)}const Z={y:(this.nextRow+S+.5)/this.height,height:2*S/this.height,width:F};return this.nextRow+=k,this.dirty=!0,Z}bind(l){const g=l.gl;this.texture?(g.bindTexture(g.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,g.texSubImage2D(g.TEXTURE_2D,0,0,0,this.width,this.height,g.ALPHA,g.UNSIGNED_BYTE,this.data))):(this.texture=g.createTexture(),g.bindTexture(g.TEXTURE_2D,this.texture),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.REPEAT),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,g.REPEAT),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,g.LINEAR),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,g.LINEAR),g.texImage2D(g.TEXTURE_2D,0,g.ALPHA,this.width,this.height,0,g.ALPHA,g.UNSIGNED_BYTE,this.data))}}class gs{constructor(l,g,S){this.workerPool=l,this.actors=[],this.currentActor=0,this.id=S;const k=this.workerPool.acquire(S);for(let F=0;F<k.length;F++){const Z=new P.C(k[F],g,S);Z.name=`Worker ${F}`,this.actors.push(Z)}if(!this.actors.length)throw new Error("No actors found")}broadcast(l,g,S){P.o(this.actors,(k,F)=>{k.send(l,g,F)},S=S||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(l=!0){this.actors.forEach(g=>{g.remove()}),this.actors=[],l&&this.workerPool.release(this.id)}}function hi(z,l,g){const S=function(k,F){if(k)return g(k);if(F){const Z=P.F(P.e(F,z),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);F.vector_layers&&(Z.vectorLayers=F.vector_layers,Z.vectorLayerIds=Z.vectorLayers.map(u=>u.id)),g(null,Z)}};return z.url?P.f(l.transformRequest(z.url,Ei.Source),S):P.h.frame(()=>S(null,z))}class Yr{constructor(l,g){l&&(g?this.setSouthWest(l).setNorthEast(g):Array.isArray(l)&&(l.length===4?this.setSouthWest([l[0],l[1]]).setNorthEast([l[2],l[3]]):this.setSouthWest(l[0]).setNorthEast(l[1])))}setNorthEast(l){return this._ne=l instanceof P.L?new P.L(l.lng,l.lat):P.L.convert(l),this}setSouthWest(l){return this._sw=l instanceof P.L?new P.L(l.lng,l.lat):P.L.convert(l),this}extend(l){const g=this._sw,S=this._ne;let k,F;if(l instanceof P.L)k=l,F=l;else{if(!(l instanceof Yr))return Array.isArray(l)?l.length===4||l.every(Array.isArray)?this.extend(Yr.convert(l)):this.extend(P.L.convert(l)):l&&("lng"in l||"lon"in l)&&"lat"in l?this.extend(P.L.convert(l)):this;if(k=l._sw,F=l._ne,!k||!F)return this}return g||S?(g.lng=Math.min(k.lng,g.lng),g.lat=Math.min(k.lat,g.lat),S.lng=Math.max(F.lng,S.lng),S.lat=Math.max(F.lat,S.lat)):(this._sw=new P.L(k.lng,k.lat),this._ne=new P.L(F.lng,F.lat)),this}getCenter(){return new P.L((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new P.L(this.getWest(),this.getNorth())}getSouthEast(){return new P.L(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(l){const{lng:g,lat:S}=P.L.convert(l);let k=this._sw.lng<=g&&g<=this._ne.lng;return this._sw.lng>this._ne.lng&&(k=this._sw.lng>=g&&g>=this._ne.lng),this._sw.lat<=S&&S<=this._ne.lat&&k}static convert(l){return l instanceof Yr?l:l&&new Yr(l)}static fromLngLat(l,g=0){const S=360*g/40075017,k=S/Math.cos(Math.PI/180*l.lat);return new Yr(new P.L(l.lng-k,l.lat-S),new P.L(l.lng+k,l.lat+S))}}class Hn{constructor(l,g,S){this.bounds=Yr.convert(this.validateBounds(l)),this.minzoom=g||0,this.maxzoom=S||24}validateBounds(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]}contains(l){const g=Math.pow(2,l.z),S=Math.floor(P.G(this.bounds.getWest())*g),k=Math.floor(P.H(this.bounds.getNorth())*g),F=Math.ceil(P.G(this.bounds.getEast())*g),Z=Math.ceil(P.H(this.bounds.getSouth())*g);return l.x>=S&&l.x<F&&l.y>=k&&l.y<Z}}class Co extends P.E{constructor(l,g,S,k){if(super(),this.load=()=>{this._loaded=!1,this.fire(new P.k("dataloading",{dataType:"source"})),this._tileJSONRequest=hi(this._options,this.map._requestManager,(F,Z)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),F?this.fire(new P.j(F)):Z&&(P.e(this,Z),Z.bounds&&(this.tileBounds=new Hn(Z.bounds,this.minzoom,this.maxzoom)),this.fire(new P.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new P.k("data",{dataType:"source",sourceDataType:"content"})))})},this.serialize=()=>P.e({},this._options),this.id=l,this.dispatcher=S,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,P.e(this,P.F(g,["url","scheme","tileSize","promoteId"])),this._options=P.e({type:"vector"},g),this._collectResourceTiming=g.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(k)}loaded(){return this._loaded}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}onAdd(l){this.map=l,this.load()}setSourceProperty(l){this._tileJSONRequest&&this._tileJSONRequest.cancel(),l(),this.load()}setTiles(l){return this.setSourceProperty(()=>{this._options.tiles=l}),this}setUrl(l){return this.setSourceProperty(()=>{this.url=l,this._options.url=l}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}loadTile(l,g){const S=l.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),k={request:this.map._requestManager.transformRequest(S,Ei.Tile),uid:l.uid,tileID:l.tileID,zoom:l.tileID.overscaledZ,tileSize:this.tileSize*l.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function F(Z,u){return delete l.request,l.aborted?g(null):Z&&Z.status!==404?g(Z):(u&&u.resourceTiming&&(l.resourceTiming=u.resourceTiming),this.map._refreshExpiredTiles&&u&&l.setExpiryData(u),l.loadVectorData(u,this.map.painter),g(null),void(l.reloadCallback&&(this.loadTile(l,l.reloadCallback),l.reloadCallback=null)))}k.request.collectResourceTiming=this._collectResourceTiming,l.actor&&l.state!=="expired"?l.state==="loading"?l.reloadCallback=g:l.request=l.actor.send("reloadTile",k,F.bind(this)):(l.actor=this.dispatcher.getActor(),l.request=l.actor.send("loadTile",k,F.bind(this)))}abortTile(l){l.request&&(l.request.cancel(),delete l.request),l.actor&&l.actor.send("abortTile",{uid:l.uid,type:this.type,source:this.id},void 0)}unloadTile(l){l.unloadVectorData(),l.actor&&l.actor.send("removeTile",{uid:l.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class to extends P.E{constructor(l,g,S,k){super(),this.id=l,this.dispatcher=S,this.setEventedParent(k),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=P.e({type:"raster"},g),P.e(this,P.F(g,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new P.k("dataloading",{dataType:"source"})),this._tileJSONRequest=hi(this._options,this.map._requestManager,(l,g)=>{this._tileJSONRequest=null,this._loaded=!0,l?this.fire(new P.j(l)):g&&(P.e(this,g),g.bounds&&(this.tileBounds=new Hn(g.bounds,this.minzoom,this.maxzoom)),this.fire(new P.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new P.k("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(l){this.map=l,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}setSourceProperty(l){this._tileJSONRequest&&this._tileJSONRequest.cancel(),l(),this.load()}setTiles(l){return this.setSourceProperty(()=>{this._options.tiles=l}),this}serialize(){return P.e({},this._options)}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}loadTile(l,g){const S=l.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);l.request=di.getImage(this.map._requestManager.transformRequest(S,Ei.Tile),(k,F,Z)=>{if(delete l.request,l.aborted)l.state="unloaded",g(null);else if(k)l.state="errored",g(k);else if(F){this.map._refreshExpiredTiles&&Z&&l.setExpiryData(Z);const u=this.map.painter.context,h=u.gl;l.texture=this.map.painter.getTileTexture(F.width),l.texture?l.texture.update(F,{useMipmap:!0}):(l.texture=new At(u,F,h.RGBA,{useMipmap:!0}),l.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE,h.LINEAR_MIPMAP_NEAREST),u.extTextureFilterAnisotropic&&h.texParameterf(h.TEXTURE_2D,u.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,u.extTextureFilterAnisotropicMax)),l.state="loaded",g(null)}},this.map._refreshExpiredTiles)}abortTile(l,g){l.request&&(l.request.cancel(),delete l.request),g()}unloadTile(l,g){l.texture&&this.map.painter.saveTileTexture(l.texture),g()}hasTransition(){return!1}}class zt extends to{constructor(l,g,S,k){super(l,g,S,k),this.type="raster-dem",this.maxzoom=22,this._options=P.e({type:"raster-dem"},g),this.encoding=g.encoding||"mapbox",this.redFactor=g.redFactor,this.greenFactor=g.greenFactor,this.blueFactor=g.blueFactor,this.baseShift=g.baseShift}loadTile(l,g){const S=l.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),k=this.map._requestManager.transformRequest(S,Ei.Tile);function F(Z,u){Z&&(l.state="errored",g(Z)),u&&(l.dem=u,l.needsHillshadePrepare=!0,l.needsTerrainPrepare=!0,l.state="loaded",g(null))}l.neighboringTiles=this._getNeighboringTiles(l.tileID),l.request=di.getImage(k,(Z,u,h)=>P._(this,void 0,void 0,function*(){if(delete l.request,l.aborted)l.state="unloaded",g(null);else if(Z)l.state="errored",g(Z);else if(u){this.map._refreshExpiredTiles&&l.setExpiryData(h);const f=P.a(u)&&P.J()?u:yield function(b){return P._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&P.K()){const I=b.width+2,R=b.height+2;try{return new P.R({width:I,height:R},yield P.M(b,-1,-1,I,R))}catch{}}return P.h.getImageData(b,1)})}(u),y={uid:l.uid,coord:l.tileID,source:this.id,rawImageData:f,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};l.actor&&l.state!=="expired"||(l.actor=this.dispatcher.getActor(),l.actor.send("loadDEMTile",y,F))}}),this.map._refreshExpiredTiles)}_getNeighboringTiles(l){const g=l.canonical,S=Math.pow(2,g.z),k=(g.x-1+S)%S,F=g.x===0?l.wrap-1:l.wrap,Z=(g.x+1+S)%S,u=g.x+1===S?l.wrap+1:l.wrap,h={};return h[new P.O(l.overscaledZ,F,g.z,k,g.y).key]={backfilled:!1},h[new P.O(l.overscaledZ,u,g.z,Z,g.y).key]={backfilled:!1},g.y>0&&(h[new P.O(l.overscaledZ,F,g.z,k,g.y-1).key]={backfilled:!1},h[new P.O(l.overscaledZ,l.wrap,g.z,g.x,g.y-1).key]={backfilled:!1},h[new P.O(l.overscaledZ,u,g.z,Z,g.y-1).key]={backfilled:!1}),g.y+1<S&&(h[new P.O(l.overscaledZ,F,g.z,k,g.y+1).key]={backfilled:!1},h[new P.O(l.overscaledZ,l.wrap,g.z,g.x,g.y+1).key]={backfilled:!1},h[new P.O(l.overscaledZ,u,g.z,Z,g.y+1).key]={backfilled:!1}),h}unloadTile(l){l.demTexture&&this.map.painter.saveTileTexture(l.demTexture),l.fbo&&(l.fbo.destroy(),delete l.fbo),l.dem&&delete l.dem,delete l.neighboringTiles,l.state="unloaded",l.actor&&l.actor.send("removeDEMTile",{uid:l.uid,source:this.id})}}class dr extends P.E{constructor(l,g,S,k){super(),this.load=()=>{this._updateWorkerData()},this.serialize=()=>P.e({},this._options,{type:this.type,data:this._data}),this.id=l,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=S.getActor(),this.setEventedParent(k),this._data=g.data,this._options=P.e({},g),this._collectResourceTiming=g.collectResourceTiming,g.maxzoom!==void 0&&(this.maxzoom=g.maxzoom),g.type&&(this.type=g.type),g.attribution&&(this.attribution=g.attribution),this.promoteId=g.promoteId;const F=P.N/this.tileSize;this.workerOptions=P.e({source:this.id,cluster:g.cluster||!1,geojsonVtOptions:{buffer:(g.buffer!==void 0?g.buffer:128)*F,tolerance:(g.tolerance!==void 0?g.tolerance:.375)*F,extent:P.N,maxZoom:this.maxzoom,lineMetrics:g.lineMetrics||!1,generateId:g.generateId||!1},superclusterOptions:{maxZoom:g.clusterMaxZoom!==void 0?g.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,g.clusterMinPoints||2),extent:P.N,radius:(g.clusterRadius||50)*F,log:!1,generateId:g.generateId||!1},clusterProperties:g.clusterProperties,filter:g.filter},g.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}onAdd(l){this.map=l,this.load()}setData(l){return this._data=l,this._updateWorkerData(),this}updateData(l){return this._updateWorkerData(l),this}setClusterOptions(l){return this.workerOptions.cluster=l.cluster,l&&(l.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=l.clusterRadius),l.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=l.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(l,g){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:l,source:this.id},g),this}getClusterChildren(l,g){return this.actor.send("geojson.getClusterChildren",{clusterId:l,source:this.id},g),this}getClusterLeaves(l,g,S,k){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:l,limit:g,offset:S},k),this}_updateWorkerData(l){const g=P.e({},this.workerOptions);l?g.dataDiff=l:typeof this._data=="string"?(g.request=this.map._requestManager.transformRequest(P.h.resolveURL(this._data),Ei.Source),g.request.collectResourceTiming=this._collectResourceTiming):g.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new P.k("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,g,(S,k)=>{if(this._pendingLoads--,this._removed||k&&k.abandoned)return void this.fire(new P.k("dataabort",{dataType:"source"}));let F=null;if(k&&k.resourceTiming&&k.resourceTiming[this.id]&&(F=k.resourceTiming[this.id].slice(0)),S)return void this.fire(new P.j(S));const Z={dataType:"source"};this._collectResourceTiming&&F&&F.length>0&&P.e(Z,{resourceTiming:F}),this.fire(new P.k("data",Object.assign(Object.assign({},Z),{sourceDataType:"metadata"}))),this.fire(new P.k("data",Object.assign(Object.assign({},Z),{sourceDataType:"content"})))})}loaded(){return this._pendingLoads===0}loadTile(l,g){const S=l.actor?"reloadTile":"loadTile";l.actor=this.actor;const k={type:this.type,uid:l.uid,tileID:l.tileID,zoom:l.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};l.request=this.actor.send(S,k,(F,Z)=>(delete l.request,l.unloadVectorData(),l.aborted?g(null):F?g(F):(l.loadVectorData(Z,this.map.painter,S==="reloadTile"),g(null))))}abortTile(l){l.request&&(l.request.cancel(),delete l.request),l.aborted=!0}unloadTile(l){l.unloadVectorData(),this.actor.send("removeTile",{uid:l.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}hasTransition(){return!1}}var In=P.Q([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Es extends P.E{constructor(l,g,S,k){super(),this.load=(F,Z)=>{this._loaded=!1,this.fire(new P.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=di.getImage(this.map._requestManager.transformRequest(this.url,Ei.Image),(u,h)=>{this._request=null,this._loaded=!0,u?this.fire(new P.j(u)):h&&(this.image=h,F&&(this.coordinates=F),Z&&Z(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||!this.image)return;const F=this.map.painter.context,Z=F.gl;this.boundsBuffer||(this.boundsBuffer=F.createVertexBuffer(this._boundsArray,In.members)),this.boundsSegments||(this.boundsSegments=P.S.simpleSegment(0,0,4,2)),this.texture||(this.texture=new At(F,this.image,Z.RGBA),this.texture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE));let u=!1;for(const h in this.tiles){const f=this.tiles[h];f.state!=="loaded"&&(f.state="loaded",f.texture=this.texture,u=!0)}u&&this.fire(new P.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"image",url:this.options.url,coordinates:this.coordinates}),this.id=l,this.dispatcher=S,this.coordinates=g.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(k),this.options=g}loaded(){return this._loaded}updateImage(l){return l.url?(this._request&&(this._request.cancel(),this._request=null),this.options.url=l.url,this.load(l.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new P.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(l){this.map=l,this.load()}onRemove(){this._request&&(this._request.cancel(),this._request=null)}setCoordinates(l){this.coordinates=l;const g=l.map(P.U.fromLngLat);this.tileID=function(k){let F=1/0,Z=1/0,u=-1/0,h=-1/0;for(const I of k)F=Math.min(F,I.x),Z=Math.min(Z,I.y),u=Math.max(u,I.x),h=Math.max(h,I.y);const f=Math.max(u-F,h-Z),y=Math.max(0,Math.floor(-Math.log(f)/Math.LN2)),b=Math.pow(2,y);return new P.W(y,Math.floor((F+u)/2*b),Math.floor((Z+h)/2*b))}(g),this.minzoom=this.maxzoom=this.tileID.z;const S=g.map(k=>this.tileID.getTilePoint(k)._round());return this._boundsArray=new P.V,this._boundsArray.emplaceBack(S[0].x,S[0].y,0,0),this._boundsArray.emplaceBack(S[1].x,S[1].y,P.N,0),this._boundsArray.emplaceBack(S[3].x,S[3].y,0,P.N),this._boundsArray.emplaceBack(S[2].x,S[2].y,P.N,P.N),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new P.k("data",{dataType:"source",sourceDataType:"content"})),this}loadTile(l,g){this.tileID&&this.tileID.equals(l.tileID.canonical)?(this.tiles[String(l.tileID.wrap)]=l,l.buckets={},g(null)):(l.state="errored",g(null))}hasTransition(){return!1}}class Il extends Es{constructor(l,g,S,k){super(l,g,S,k),this.load=()=>{this._loaded=!1;const F=this.options;this.urls=[];for(const Z of F.urls)this.urls.push(this.map._requestManager.transformRequest(Z,Ei.Source).url);P.X(this.urls,(Z,u)=>{this._loaded=!0,Z?this.fire(new P.j(Z)):u&&(this.video=u,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const F=this.map.painter.context,Z=F.gl;this.boundsBuffer||(this.boundsBuffer=F.createVertexBuffer(this._boundsArray,In.members)),this.boundsSegments||(this.boundsSegments=P.S.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE),Z.texSubImage2D(Z.TEXTURE_2D,0,0,0,Z.RGBA,Z.UNSIGNED_BYTE,this.video)):(this.texture=new At(F,this.video,Z.RGBA),this.texture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE));let u=!1;for(const h in this.tiles){const f=this.tiles[h];f.state!=="loaded"&&(f.state="loaded",f.texture=this.texture,u=!0)}u&&this.fire(new P.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"video",urls:this.urls,coordinates:this.coordinates}),this.roundZoom=!0,this.type="video",this.options=g}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(l){if(this.video){const g=this.video.seekable;l<g.start(0)||l>g.end(0)?this.fire(new P.j(new P.Y(`sources.${this.id}`,null,`Playback for this video can be set only between the ${g.start(0)} and ${g.end(0)}-second mark.`))):this.video.currentTime=l}}getVideo(){return this.video}onAdd(l){this.map||(this.map=l,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}hasTransition(){return this.video&&!this.video.paused}}class La extends Es{constructor(l,g,S,k){super(l,g,S,k),this.load=()=>{this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new P.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},this.prepare=()=>{let F=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,F=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,F=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const Z=this.map.painter.context,u=Z.gl;this.boundsBuffer||(this.boundsBuffer=Z.createVertexBuffer(this._boundsArray,In.members)),this.boundsSegments||(this.boundsSegments=P.S.simpleSegment(0,0,4,2)),this.texture?(F||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new At(Z,this.canvas,u.RGBA,{premultiply:!0});let h=!1;for(const f in this.tiles){const y=this.tiles[f];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture,h=!0)}h&&this.fire(new P.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"canvas",coordinates:this.coordinates}),g.coordinates?Array.isArray(g.coordinates)&&g.coordinates.length===4&&!g.coordinates.some(F=>!Array.isArray(F)||F.length!==2||F.some(Z=>typeof Z!="number"))||this.fire(new P.j(new P.Y(`sources.${l}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new P.j(new P.Y(`sources.${l}`,null,'missing required property "coordinates"'))),g.animate&&typeof g.animate!="boolean"&&this.fire(new P.j(new P.Y(`sources.${l}`,null,'optional "animate" property must be a boolean value'))),g.canvas?typeof g.canvas=="string"||g.canvas instanceof HTMLCanvasElement||this.fire(new P.j(new P.Y(`sources.${l}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new P.j(new P.Y(`sources.${l}`,null,'missing required property "canvas"'))),this.options=g,this.animate=g.animate===void 0||g.animate}getCanvas(){return this.canvas}onAdd(l){this.map=l,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const l of[this.canvas.width,this.canvas.height])if(isNaN(l)||l<=0)return!0;return!1}}const Cl={},Un=z=>{switch(z){case"geojson":return dr;case"image":return Es;case"raster":return to;case"raster-dem":return zt;case"vector":return Co;case"video":return Il;case"canvas":return La}return Cl[z]};function Ra(z,l){const g=P.Z();return P.$(g,g,[1,1,0]),P.a0(g,g,[.5*z.width,.5*z.height,1]),P.a1(g,g,z.calculatePosMatrix(l.toUnwrapped()))}function pa(z,l,g,S,k,F){const Z=function(b,I,R){if(b)for(const V of b){const W=I[V];if(W&&W.source===R&&W.type==="fill-extrusion")return!0}else for(const V in I){const W=I[V];if(W.source===R&&W.type==="fill-extrusion")return!0}return!1}(k&&k.layers,l,z.id),u=F.maxPitchScaleFactor(),h=z.tilesIn(S,u,Z);h.sort(Yt);const f=[];for(const b of h)f.push({wrappedTileID:b.tileID.wrapped().key,queryResults:b.tile.queryRenderedFeatures(l,g,z._state,b.queryGeometry,b.cameraQueryGeometry,b.scale,k,F,u,Ra(z.transform,b.tileID))});const y=function(b){const I={},R={};for(const V of b){const W=V.queryResults,Y=V.wrappedTileID,le=R[Y]=R[Y]||{};for(const fe in W){const ye=W[fe],Ie=le[fe]=le[fe]||{},ke=I[fe]=I[fe]||[];for(const qe of ye)Ie[qe.featureIndex]||(Ie[qe.featureIndex]=!0,ke.push(qe))}}return I}(f);for(const b in y)y[b].forEach(I=>{const R=I.feature,V=z.getFeatureState(R.layer["source-layer"],R.id);R.source=R.layer.source,R.layer["source-layer"]&&(R.sourceLayer=R.layer["source-layer"]),R.state=V});return y}function Yt(z,l){const g=z.tileID,S=l.tileID;return g.overscaledZ-S.overscaledZ||g.canonical.y-S.canonical.y||g.wrap-S.wrap||g.canonical.x-S.canonical.x}class Ue{constructor(l,g){this.timeAdded=0,this.fadeEndTime=0,this.tileID=l,this.uid=P.a2(),this.uses=0,this.tileSize=g,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(l){const g=l+this.timeAdded;g<this.fadeEndTime||(this.fadeEndTime=g)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(l){this.demTexture&&l.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(l,g,S){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",l){l.featureIndex&&(this.latestFeatureIndex=l.featureIndex,l.rawTileData?(this.latestRawTileData=l.rawTileData,this.latestFeatureIndex.rawTileData=l.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=l.collisionBoxArray,this.buckets=function(k,F){const Z={};if(!F)return Z;for(const u of k){const h=u.layerIds.map(f=>F.getLayer(f)).filter(Boolean);if(h.length!==0){u.layers=h,u.stateDependentLayerIds&&(u.stateDependentLayers=u.stateDependentLayerIds.map(f=>h.filter(y=>y.id===f)[0]));for(const f of h)Z[f.id]=u}}return Z}(l.buckets,g.style),this.hasSymbolBuckets=!1;for(const k in this.buckets){const F=this.buckets[k];if(F instanceof P.a4){if(this.hasSymbolBuckets=!0,!S)break;F.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const k in this.buckets){const F=this.buckets[k];if(F instanceof P.a4&&F.hasRTLText){this.hasRTLText=!0,P.a5();break}}this.queryPadding=0;for(const k in this.buckets){const F=this.buckets[k];this.queryPadding=Math.max(this.queryPadding,g.style.getLayer(k).queryRadius(F))}l.imageAtlas&&(this.imageAtlas=l.imageAtlas),l.glyphAtlasImage&&(this.glyphAtlasImage=l.glyphAtlasImage)}else this.collisionBoxArray=new P.a3}unloadVectorData(){for(const l in this.buckets)this.buckets[l].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(l){return this.buckets[l.id]}upload(l){for(const S in this.buckets){const k=this.buckets[S];k.uploadPending()&&k.upload(l)}const g=l.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new At(l,this.imageAtlas.image,g.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new At(l,this.glyphAtlasImage,g.ALPHA),this.glyphAtlasImage=null)}prepare(l){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(l,this.imageAtlasTexture)}queryRenderedFeatures(l,g,S,k,F,Z,u,h,f,y){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:k,cameraQueryGeometry:F,scale:Z,tileSize:this.tileSize,pixelPosMatrix:y,transform:h,params:u,queryPadding:this.queryPadding*f},l,g,S):{}}querySourceFeatures(l,g){const S=this.latestFeatureIndex;if(!S||!S.rawTileData)return;const k=S.loadVTLayers(),F=g&&g.sourceLayer?g.sourceLayer:"",Z=k._geojsonTileLayer||k[F];if(!Z)return;const u=P.a6(g&&g.filter),{z:h,x:f,y}=this.tileID.canonical,b={z:h,x:f,y};for(let I=0;I<Z.length;I++){const R=Z.feature(I);if(u.needGeometry){const Y=P.a7(R,!0);if(!u.filter(new P.a8(this.tileID.overscaledZ),Y,this.tileID.canonical))continue}else if(!u.filter(new P.a8(this.tileID.overscaledZ),R))continue;const V=S.getId(R,F),W=new P.a9(R,h,f,y,V);W.tile=b,l.push(W)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(l){const g=this.expirationTime;if(l.cacheControl){const S=P.aa(l.cacheControl);S["max-age"]&&(this.expirationTime=Date.now()+1e3*S["max-age"])}else l.expires&&(this.expirationTime=new Date(l.expires).getTime());if(this.expirationTime){const S=Date.now();let k=!1;if(this.expirationTime>S)k=!1;else if(g)if(this.expirationTime<g)k=!0;else{const F=this.expirationTime-g;F?this.expirationTime=S+Math.max(F,3e4):k=!0}else k=!0;k?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(l,g){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(l).length===0)return;const S=this.latestFeatureIndex.loadVTLayers();for(const k in this.buckets){if(!g.style.hasLayer(k))continue;const F=this.buckets[k],Z=F.layers[0].sourceLayer||"_geojsonTileLayer",u=S[Z],h=l[Z];if(!u||!h||Object.keys(h).length===0)continue;F.update(h,u,this.imageAtlas&&this.imageAtlas.patternPositions||{});const f=g&&g.style&&g.style.getLayer(k);f&&(this.queryPadding=Math.max(this.queryPadding,f.queryRadius(F)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<P.h.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(l){this.symbolFadeHoldUntil=P.h.now()+l}setDependencies(l,g){const S={};for(const k of g)S[k]=!0;this.dependencies[l]=S}hasDependency(l,g){for(const S of l){const k=this.dependencies[S];if(k){for(const F of g)if(k[F])return!0}}return!1}}class $e{constructor(l,g){this.max=l,this.onRemove=g,this.reset()}reset(){for(const l in this.data)for(const g of this.data[l])g.timeout&&clearTimeout(g.timeout),this.onRemove(g.value);return this.data={},this.order=[],this}add(l,g,S){const k=l.wrapped().key;this.data[k]===void 0&&(this.data[k]=[]);const F={value:g,timeout:void 0};if(S!==void 0&&(F.timeout=setTimeout(()=>{this.remove(l,F)},S)),this.data[k].push(F),this.order.push(k),this.order.length>this.max){const Z=this._getAndRemoveByKey(this.order[0]);Z&&this.onRemove(Z)}return this}has(l){return l.wrapped().key in this.data}getAndRemove(l){return this.has(l)?this._getAndRemoveByKey(l.wrapped().key):null}_getAndRemoveByKey(l){const g=this.data[l].shift();return g.timeout&&clearTimeout(g.timeout),this.data[l].length===0&&delete this.data[l],this.order.splice(this.order.indexOf(l),1),g.value}getByKey(l){const g=this.data[l];return g?g[0].value:null}get(l){return this.has(l)?this.data[l.wrapped().key][0].value:null}remove(l,g){if(!this.has(l))return this;const S=l.wrapped().key,k=g===void 0?0:this.data[S].indexOf(g),F=this.data[S][k];return this.data[S].splice(k,1),F.timeout&&clearTimeout(F.timeout),this.data[S].length===0&&delete this.data[S],this.onRemove(F.value),this.order.splice(this.order.indexOf(S),1),this}setMaxSize(l){for(this.max=l;this.order.length>this.max;){const g=this._getAndRemoveByKey(this.order[0]);g&&this.onRemove(g)}return this}filter(l){const g=[];for(const S in this.data)for(const k of this.data[S])l(k.value)||g.push(k);for(const S of g)this.remove(S.value.tileID,S)}}class Pe{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(l,g,S){const k=String(g);if(this.stateChanges[l]=this.stateChanges[l]||{},this.stateChanges[l][k]=this.stateChanges[l][k]||{},P.e(this.stateChanges[l][k],S),this.deletedStates[l]===null){this.deletedStates[l]={};for(const F in this.state[l])F!==k&&(this.deletedStates[l][F]=null)}else if(this.deletedStates[l]&&this.deletedStates[l][k]===null){this.deletedStates[l][k]={};for(const F in this.state[l][k])S[F]||(this.deletedStates[l][k][F]=null)}else for(const F in S)this.deletedStates[l]&&this.deletedStates[l][k]&&this.deletedStates[l][k][F]===null&&delete this.deletedStates[l][k][F]}removeFeatureState(l,g,S){if(this.deletedStates[l]===null)return;const k=String(g);if(this.deletedStates[l]=this.deletedStates[l]||{},S&&g!==void 0)this.deletedStates[l][k]!==null&&(this.deletedStates[l][k]=this.deletedStates[l][k]||{},this.deletedStates[l][k][S]=null);else if(g!==void 0)if(this.stateChanges[l]&&this.stateChanges[l][k])for(S in this.deletedStates[l][k]={},this.stateChanges[l][k])this.deletedStates[l][k][S]=null;else this.deletedStates[l][k]=null;else this.deletedStates[l]=null}getState(l,g){const S=String(g),k=P.e({},(this.state[l]||{})[S],(this.stateChanges[l]||{})[S]);if(this.deletedStates[l]===null)return{};if(this.deletedStates[l]){const F=this.deletedStates[l][g];if(F===null)return{};for(const Z in F)delete k[Z]}return k}initializeTileState(l,g){l.setFeatureState(this.state,g)}coalesceChanges(l,g){const S={};for(const k in this.stateChanges){this.state[k]=this.state[k]||{};const F={};for(const Z in this.stateChanges[k])this.state[k][Z]||(this.state[k][Z]={}),P.e(this.state[k][Z],this.stateChanges[k][Z]),F[Z]=this.state[k][Z];S[k]=F}for(const k in this.deletedStates){this.state[k]=this.state[k]||{};const F={};if(this.deletedStates[k]===null)for(const Z in this.state[k])F[Z]={},this.state[k][Z]={};else for(const Z in this.deletedStates[k]){if(this.deletedStates[k][Z]===null)this.state[k][Z]={};else for(const u of Object.keys(this.deletedStates[k][Z]))delete this.state[k][Z][u];F[Z]=this.state[k][Z]}S[k]=S[k]||{},P.e(S[k],F)}if(this.stateChanges={},this.deletedStates={},Object.keys(S).length!==0)for(const k in l)l[k].setFeatureState(S,g)}}class Ft extends P.E{constructor(l,g,S){super(),this.id=l,this.dispatcher=S,this.on("data",k=>{k.dataType==="source"&&k.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&k.dataType==="source"&&k.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((k,F,Z,u)=>{const h=new(Un(F.type))(k,F,Z,u);if(h.id!==k)throw new Error(`Expected Source id to be ${k} instead of ${h.id}`);return h})(l,g,S,this),this._tiles={},this._cache=new $e(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Pe,this._didEmitContent=!1,this._updated=!1}onAdd(l){this.map=l,this._maxTileCacheSize=l?l._maxTileCacheSize:null,this._maxTileCacheZoomLevels=l?l._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(l)}onRemove(l){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(l)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const l in this._tiles){const g=this._tiles[l];if(g.state!=="loaded"&&g.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const l=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,l&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(l,g){return this._source.loadTile(l,g)}_unloadTile(l){if(this._source.unloadTile)return this._source.unloadTile(l,()=>{})}_abortTile(l){this._source.abortTile&&this._source.abortTile(l,()=>{}),this._source.fire(new P.k("dataabort",{tile:l,coord:l.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(l){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const g in this._tiles){const S=this._tiles[g];S.upload(l),S.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(l=>l.tileID).sort(Zt).map(l=>l.key)}getRenderableIds(l){const g=[];for(const S in this._tiles)this._isIdRenderable(S,l)&&g.push(this._tiles[S]);return l?g.sort((S,k)=>{const F=S.tileID,Z=k.tileID,u=new P.P(F.canonical.x,F.canonical.y)._rotate(this.transform.angle),h=new P.P(Z.canonical.x,Z.canonical.y)._rotate(this.transform.angle);return F.overscaledZ-Z.overscaledZ||h.y-u.y||h.x-u.x}).map(S=>S.tileID.key):g.map(S=>S.tileID).sort(Zt).map(S=>S.key)}hasRenderableParent(l){const g=this.findLoadedParent(l,0);return!!g&&this._isIdRenderable(g.tileID.key)}_isIdRenderable(l,g){return this._tiles[l]&&this._tiles[l].hasData()&&!this._coveredTiles[l]&&(g||!this._tiles[l].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const l in this._tiles)this._tiles[l].state!=="errored"&&this._reloadTile(l,"reloading")}}_reloadTile(l,g){const S=this._tiles[l];S&&(S.state!=="loading"&&(S.state=g),this._loadTile(S,this._tileLoaded.bind(this,S,l,g)))}_tileLoaded(l,g,S,k){if(k)return l.state="errored",void(k.status!==404?this._source.fire(new P.j(k,{tile:l})):this.update(this.transform,this.terrain));l.timeAdded=P.h.now(),S==="expired"&&(l.refreshedUponExpiration=!0),this._setTileReloadTimer(g,l),this.getSource().type==="raster-dem"&&l.dem&&this._backfillDEM(l),this._state.initializeTileState(l,this.map?this.map.painter:null),l.aborted||this._source.fire(new P.k("data",{dataType:"source",tile:l,coord:l.tileID}))}_backfillDEM(l){const g=this.getRenderableIds();for(let k=0;k<g.length;k++){const F=g[k];if(l.neighboringTiles&&l.neighboringTiles[F]){const Z=this.getTileByID(F);S(l,Z),S(Z,l)}}function S(k,F){k.needsHillshadePrepare=!0,k.needsTerrainPrepare=!0;let Z=F.tileID.canonical.x-k.tileID.canonical.x;const u=F.tileID.canonical.y-k.tileID.canonical.y,h=Math.pow(2,k.tileID.canonical.z),f=F.tileID.key;Z===0&&u===0||Math.abs(u)>1||(Math.abs(Z)>1&&(Math.abs(Z+h)===1?Z+=h:Math.abs(Z-h)===1&&(Z-=h)),F.dem&&k.dem&&(k.dem.backfillBorder(F.dem,Z,u),k.neighboringTiles&&k.neighboringTiles[f]&&(k.neighboringTiles[f].backfilled=!0)))}}getTile(l){return this.getTileByID(l.key)}getTileByID(l){return this._tiles[l]}_retainLoadedChildren(l,g,S,k){for(const F in this._tiles){let Z=this._tiles[F];if(k[F]||!Z.hasData()||Z.tileID.overscaledZ<=g||Z.tileID.overscaledZ>S)continue;let u=Z.tileID;for(;Z&&Z.tileID.overscaledZ>g+1;){const f=Z.tileID.scaledTo(Z.tileID.overscaledZ-1);Z=this._tiles[f.key],Z&&Z.hasData()&&(u=f)}let h=u;for(;h.overscaledZ>g;)if(h=h.scaledTo(h.overscaledZ-1),l[h.key]){k[u.key]=u;break}}}findLoadedParent(l,g){if(l.key in this._loadedParentTiles){const S=this._loadedParentTiles[l.key];return S&&S.tileID.overscaledZ>=g?S:null}for(let S=l.overscaledZ-1;S>=g;S--){const k=l.scaledTo(S),F=this._getLoadedTile(k);if(F)return F}}_getLoadedTile(l){const g=this._tiles[l.key];return g&&g.hasData()?g:this._cache.getByKey(l.wrapped().key)}updateCacheSize(l){const g=Math.ceil(l.width/this._source.tileSize)+1,S=Math.ceil(l.height/this._source.tileSize)+1,k=Math.floor(g*S*(this._maxTileCacheZoomLevels===null?P.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),F=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,k):k;this._cache.setMaxSize(F)}handleWrapJump(l){const g=Math.round((l-(this._prevLng===void 0?l:this._prevLng))/360);if(this._prevLng=l,g){const S={};for(const k in this._tiles){const F=this._tiles[k];F.tileID=F.tileID.unwrapTo(F.tileID.wrap+g),S[F.tileID.key]=F}this._tiles=S;for(const k in this._timers)clearTimeout(this._timers[k]),delete this._timers[k];for(const k in this._tiles)this._setTileReloadTimer(k,this._tiles[k])}}update(l,g){if(this.transform=l,this.terrain=g,!this._sourceLoaded||this._paused)return;let S;this.updateCacheSize(l),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?S=l.getVisibleUnwrappedCoordinates(this._source.tileID).map(y=>new P.O(y.canonical.z,y.wrap,y.canonical.z,y.canonical.x,y.canonical.y)):(S=l.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:g}),this._source.hasTile&&(S=S.filter(y=>this._source.hasTile(y)))):S=[];const k=l.coveringZoomLevel(this._source),F=Math.max(k-Ft.maxOverzooming,this._source.minzoom),Z=Math.max(k+Ft.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const y={};for(const b of S)if(b.canonical.z>this._source.minzoom){const I=b.scaledTo(b.canonical.z-1);y[I.key]=I;const R=b.scaledTo(Math.max(this._source.minzoom,Math.min(b.canonical.z,5)));y[R.key]=R}S=S.concat(Object.values(y))}const u=S.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,u&&this.fire(new P.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const h=this._updateRetainedTiles(S,k);if(ni(this._source.type)){const y={},b={},I=Object.keys(h),R=P.h.now();for(const V of I){const W=h[V],Y=this._tiles[V];if(!Y||Y.fadeEndTime!==0&&Y.fadeEndTime<=R)continue;const le=this.findLoadedParent(W,F);le&&(this._addTile(le.tileID),y[le.tileID.key]=le.tileID),b[V]=W}this._retainLoadedChildren(b,k,Z,h);for(const V in y)h[V]||(this._coveredTiles[V]=!0,h[V]=y[V]);if(g){const V={},W={};for(const Y of S)this._tiles[Y.key].hasData()?V[Y.key]=Y:W[Y.key]=Y;for(const Y in W){const le=W[Y].children(this._source.maxzoom);this._tiles[le[0].key]&&this._tiles[le[1].key]&&this._tiles[le[2].key]&&this._tiles[le[3].key]&&(V[le[0].key]=h[le[0].key]=le[0],V[le[1].key]=h[le[1].key]=le[1],V[le[2].key]=h[le[2].key]=le[2],V[le[3].key]=h[le[3].key]=le[3],delete W[Y])}for(const Y in W){const le=this.findLoadedParent(W[Y],this._source.minzoom);if(le){V[le.tileID.key]=h[le.tileID.key]=le.tileID;for(const fe in V)V[fe].isChildOf(le.tileID)&&delete V[fe]}}for(const Y in this._tiles)V[Y]||(this._coveredTiles[Y]=!0)}}for(const y in h)this._tiles[y].clearFadeHold();const f=P.ab(this._tiles,h);for(const y of f){const b=this._tiles[y];b.hasSymbolBuckets&&!b.holdingForFade()?b.setHoldDuration(this.map._fadeDuration):b.hasSymbolBuckets&&!b.symbolFadeFinished()||this._removeTile(y)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const l in this._tiles)this._tiles[l].holdingForFade()&&this._removeTile(l)}_updateRetainedTiles(l,g){const S={},k={},F=Math.max(g-Ft.maxOverzooming,this._source.minzoom),Z=Math.max(g+Ft.maxUnderzooming,this._source.minzoom),u={};for(const h of l){const f=this._addTile(h);S[h.key]=h,f.hasData()||g<this._source.maxzoom&&(u[h.key]=h)}this._retainLoadedChildren(u,g,Z,S);for(const h of l){let f=this._tiles[h.key];if(f.hasData())continue;if(g+1>this._source.maxzoom){const b=h.children(this._source.maxzoom)[0],I=this.getTile(b);if(I&&I.hasData()){S[b.key]=b;continue}}else{const b=h.children(this._source.maxzoom);if(S[b[0].key]&&S[b[1].key]&&S[b[2].key]&&S[b[3].key])continue}let y=f.wasRequested();for(let b=h.overscaledZ-1;b>=F;--b){const I=h.scaledTo(b);if(k[I.key])break;if(k[I.key]=!0,f=this.getTile(I),!f&&y&&(f=this._addTile(I)),f){const R=f.hasData();if((y||R)&&(S[I.key]=I),y=f.wasRequested(),R)break}}}return S}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const l in this._tiles){const g=[];let S,k=this._tiles[l].tileID;for(;k.overscaledZ>0;){if(k.key in this._loadedParentTiles){S=this._loadedParentTiles[k.key];break}g.push(k.key);const F=k.scaledTo(k.overscaledZ-1);if(S=this._getLoadedTile(F),S)break;k=F}for(const F of g)this._loadedParentTiles[F]=S}}_addTile(l){let g=this._tiles[l.key];if(g)return g;g=this._cache.getAndRemove(l),g&&(this._setTileReloadTimer(l.key,g),g.tileID=l,this._state.initializeTileState(g,this.map?this.map.painter:null),this._cacheTimers[l.key]&&(clearTimeout(this._cacheTimers[l.key]),delete this._cacheTimers[l.key],this._setTileReloadTimer(l.key,g)));const S=g;return g||(g=new Ue(l,this._source.tileSize*l.overscaleFactor()),this._loadTile(g,this._tileLoaded.bind(this,g,l.key,g.state))),g.uses++,this._tiles[l.key]=g,S||this._source.fire(new P.k("dataloading",{tile:g,coord:g.tileID,dataType:"source"})),g}_setTileReloadTimer(l,g){l in this._timers&&(clearTimeout(this._timers[l]),delete this._timers[l]);const S=g.getExpiryTimeout();S&&(this._timers[l]=setTimeout(()=>{this._reloadTile(l,"expired"),delete this._timers[l]},S))}_removeTile(l){const g=this._tiles[l];g&&(g.uses--,delete this._tiles[l],this._timers[l]&&(clearTimeout(this._timers[l]),delete this._timers[l]),g.uses>0||(g.hasData()&&g.state!=="reloading"?this._cache.add(g.tileID,g,g.getExpiryTimeout()):(g.aborted=!0,this._abortTile(g),this._unloadTile(g))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const l in this._tiles)this._removeTile(l);this._cache.reset()}tilesIn(l,g,S){const k=[],F=this.transform;if(!F)return k;const Z=S?F.getCameraQueryGeometry(l):l,u=l.map(V=>F.pointCoordinate(V,this.terrain)),h=Z.map(V=>F.pointCoordinate(V,this.terrain)),f=this.getIds();let y=1/0,b=1/0,I=-1/0,R=-1/0;for(const V of h)y=Math.min(y,V.x),b=Math.min(b,V.y),I=Math.max(I,V.x),R=Math.max(R,V.y);for(let V=0;V<f.length;V++){const W=this._tiles[f[V]];if(W.holdingForFade())continue;const Y=W.tileID,le=Math.pow(2,F.zoom-W.tileID.overscaledZ),fe=g*W.queryPadding*P.N/W.tileSize/le,ye=[Y.getTilePoint(new P.U(y,b)),Y.getTilePoint(new P.U(I,R))];if(ye[0].x-fe<P.N&&ye[0].y-fe<P.N&&ye[1].x+fe>=0&&ye[1].y+fe>=0){const Ie=u.map(qe=>Y.getTilePoint(qe)),ke=h.map(qe=>Y.getTilePoint(qe));k.push({tile:W,tileID:Y,queryGeometry:Ie,cameraQueryGeometry:ke,scale:le})}}return k}getVisibleCoordinates(l){const g=this.getRenderableIds(l).map(S=>this._tiles[S].tileID);for(const S of g)S.posMatrix=this.transform.calculatePosMatrix(S.toUnwrapped());return g}hasTransition(){if(this._source.hasTransition())return!0;if(ni(this._source.type)){const l=P.h.now();for(const g in this._tiles)if(this._tiles[g].fadeEndTime>=l)return!0}return!1}setFeatureState(l,g,S){this._state.updateState(l=l||"_geojsonTileLayer",g,S)}removeFeatureState(l,g,S){this._state.removeFeatureState(l=l||"_geojsonTileLayer",g,S)}getFeatureState(l,g){return this._state.getState(l=l||"_geojsonTileLayer",g)}setDependencies(l,g,S){const k=this._tiles[l];k&&k.setDependencies(g,S)}reloadTilesForDependencies(l,g){for(const S in this._tiles)this._tiles[S].hasDependency(l,g)&&this._reloadTile(S,"reloading");this._cache.filter(S=>!S.hasDependency(l,g))}}function Zt(z,l){const g=Math.abs(2*z.wrap)-+(z.wrap<0),S=Math.abs(2*l.wrap)-+(l.wrap<0);return z.overscaledZ-l.overscaledZ||S-g||l.canonical.y-z.canonical.y||l.canonical.x-z.canonical.x}function ni(z){return z==="raster"||z==="image"||z==="video"}Ft.maxOverzooming=10,Ft.maxUnderzooming=3;const ri="mapboxgl_preloaded_worker_pool";class Qt{constructor(){this.active={}}acquire(l){if(!this.workers)for(this.workers=[];this.workers.length<Qt.workerCount;)this.workers.push(new Worker(P.c.WORKER_URL));return this.active[l]=!0,this.workers.slice()}release(l){delete this.active[l],this.numActive()===0&&(this.workers.forEach(g=>{g.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[ri]}numActive(){return Object.keys(this.active).length}}const Oi=Math.floor(P.h.hardwareConcurrency/2);let Qi;function Ki(){return Qi||(Qi=new Qt),Qi}Qt.workerCount=P.ac(globalThis)?Math.max(Math.min(Oi,3),1):1;class Kr{constructor(l,g){this.reset(l,g)}reset(l,g){this.points=l||[],this._distances=[0];for(let S=1;S<this.points.length;S++)this._distances[S]=this._distances[S-1]+this.points[S].dist(this.points[S-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(g||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(l){if(this.points.length===1)return this.points[0];l=P.ad(l,0,1);let g=1,S=this._distances[g];const k=l*this.paddedLength+this.padding;for(;S<k&&g<this._distances.length;)S=this._distances[++g];const F=g-1,Z=this._distances[F],u=S-Z,h=u>0?(k-Z)/u:0;return this.points[F].mult(1-h).add(this.points[g].mult(h))}}function _n(z,l){let g=!0;return z==="always"||z!=="never"&&l!=="never"||(g=!1),g}class ts{constructor(l,g,S){const k=this.boxCells=[],F=this.circleCells=[];this.xCellCount=Math.ceil(l/S),this.yCellCount=Math.ceil(g/S);for(let Z=0;Z<this.xCellCount*this.yCellCount;Z++)k.push([]),F.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=g,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/g,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(l,g,S,k,F){this._forEachCell(g,S,k,F,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(g),this.bboxes.push(S),this.bboxes.push(k),this.bboxes.push(F)}insertCircle(l,g,S,k){this._forEachCell(g-k,S-k,g+k,S+k,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(g),this.circles.push(S),this.circles.push(k)}_insertBoxCell(l,g,S,k,F,Z){this.boxCells[F].push(Z)}_insertCircleCell(l,g,S,k,F,Z){this.circleCells[F].push(Z)}_query(l,g,S,k,F,Z,u){if(S<0||l>this.width||k<0||g>this.height)return[];const h=[];if(l<=0&&g<=0&&this.width<=S&&this.height<=k){if(F)return[{key:null,x1:l,y1:g,x2:S,y2:k}];for(let f=0;f<this.boxKeys.length;f++)h.push({key:this.boxKeys[f],x1:this.bboxes[4*f],y1:this.bboxes[4*f+1],x2:this.bboxes[4*f+2],y2:this.bboxes[4*f+3]});for(let f=0;f<this.circleKeys.length;f++){const y=this.circles[3*f],b=this.circles[3*f+1],I=this.circles[3*f+2];h.push({key:this.circleKeys[f],x1:y-I,y1:b-I,x2:y+I,y2:b+I})}}else this._forEachCell(l,g,S,k,this._queryCell,h,{hitTest:F,overlapMode:Z,seenUids:{box:{},circle:{}}},u);return h}query(l,g,S,k){return this._query(l,g,S,k,!1,null)}hitTest(l,g,S,k,F,Z){return this._query(l,g,S,k,!0,F,Z).length>0}hitTestCircle(l,g,S,k,F){const Z=l-S,u=l+S,h=g-S,f=g+S;if(u<0||Z>this.width||f<0||h>this.height)return!1;const y=[];return this._forEachCell(Z,h,u,f,this._queryCellCircle,y,{hitTest:!0,overlapMode:k,circle:{x:l,y:g,radius:S},seenUids:{box:{},circle:{}}},F),y.length>0}_queryCell(l,g,S,k,F,Z,u,h){const{seenUids:f,hitTest:y,overlapMode:b}=u,I=this.boxCells[F];if(I!==null){const V=this.bboxes;for(const W of I)if(!f.box[W]){f.box[W]=!0;const Y=4*W,le=this.boxKeys[W];if(l<=V[Y+2]&&g<=V[Y+3]&&S>=V[Y+0]&&k>=V[Y+1]&&(!h||h(le))&&(!y||!_n(b,le.overlapMode))&&(Z.push({key:le,x1:V[Y],y1:V[Y+1],x2:V[Y+2],y2:V[Y+3]}),y))return!0}}const R=this.circleCells[F];if(R!==null){const V=this.circles;for(const W of R)if(!f.circle[W]){f.circle[W]=!0;const Y=3*W,le=this.circleKeys[W];if(this._circleAndRectCollide(V[Y],V[Y+1],V[Y+2],l,g,S,k)&&(!h||h(le))&&(!y||!_n(b,le.overlapMode))){const fe=V[Y],ye=V[Y+1],Ie=V[Y+2];if(Z.push({key:le,x1:fe-Ie,y1:ye-Ie,x2:fe+Ie,y2:ye+Ie}),y)return!0}}}return!1}_queryCellCircle(l,g,S,k,F,Z,u,h){const{circle:f,seenUids:y,overlapMode:b}=u,I=this.boxCells[F];if(I!==null){const V=this.bboxes;for(const W of I)if(!y.box[W]){y.box[W]=!0;const Y=4*W,le=this.boxKeys[W];if(this._circleAndRectCollide(f.x,f.y,f.radius,V[Y+0],V[Y+1],V[Y+2],V[Y+3])&&(!h||h(le))&&!_n(b,le.overlapMode))return Z.push(!0),!0}}const R=this.circleCells[F];if(R!==null){const V=this.circles;for(const W of R)if(!y.circle[W]){y.circle[W]=!0;const Y=3*W,le=this.circleKeys[W];if(this._circlesCollide(V[Y],V[Y+1],V[Y+2],f.x,f.y,f.radius)&&(!h||h(le))&&!_n(b,le.overlapMode))return Z.push(!0),!0}}}_forEachCell(l,g,S,k,F,Z,u,h){const f=this._convertToXCellCoord(l),y=this._convertToYCellCoord(g),b=this._convertToXCellCoord(S),I=this._convertToYCellCoord(k);for(let R=f;R<=b;R++)for(let V=y;V<=I;V++)if(F.call(this,l,g,S,k,this.xCellCount*V+R,Z,u,h))return}_convertToXCellCoord(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))}_convertToYCellCoord(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))}_circlesCollide(l,g,S,k,F,Z){const u=k-l,h=F-g,f=S+Z;return f*f>u*u+h*h}_circleAndRectCollide(l,g,S,k,F,Z,u){const h=(Z-k)/2,f=Math.abs(l-(k+h));if(f>h+S)return!1;const y=(u-F)/2,b=Math.abs(g-(F+y));if(b>y+S)return!1;if(f<=h||b<=y)return!0;const I=f-h,R=b-y;return I*I+R*R<=S*S}}function oi(z,l,g,S,k){const F=P.Z();return l?(P.a0(F,F,[1/k,1/k,1]),g||P.ae(F,F,S.angle)):P.a1(F,S.labelPlaneMatrix,z),F}function gn(z,l,g,S,k){if(l){const F=P.af(z);return P.a0(F,F,[k,k,1]),g||P.ae(F,F,-S.angle),F}return S.glCoordMatrix}function vr(z,l,g){let S;g?(S=[z.x,z.y,g(z.x,z.y),1],P.ag(S,S,l)):(S=[z.x,z.y,0,1],Be(S,S,l));const k=S[3];return{point:new P.P(S[0]/k,S[1]/k),signedDistanceFromCamera:k}}function ys(z,l){return .5+z/l*.5}function ls(z,l){const g=z[0]/z[3],S=z[1]/z[3];return g>=-l[0]&&g<=l[0]&&S>=-l[1]&&S<=l[1]}function gi(z,l,g,S,k,F,Z,u,h,f){const y=S?z.textSizeData:z.iconSizeData,b=P.ah(y,g.transform.zoom),I=[256/g.width*2+1,256/g.height*2+1],R=S?z.text.dynamicLayoutVertexArray:z.icon.dynamicLayoutVertexArray;R.clear();const V=z.lineVertexArray,W=S?z.text.placedSymbolArray:z.icon.placedSymbolArray,Y=g.transform.width/g.transform.height;let le=!1;for(let fe=0;fe<W.length;fe++){const ye=W.get(fe);if(ye.hidden||ye.writingMode===P.ai.vertical&&!le){Te(ye.numGlyphs,R);continue}let Ie;if(le=!1,f?(Ie=[ye.anchorX,ye.anchorY,f(ye.anchorX,ye.anchorY),1],P.ag(Ie,Ie,l)):(Ie=[ye.anchorX,ye.anchorY,0,1],Be(Ie,Ie,l)),!ls(Ie,I)){Te(ye.numGlyphs,R);continue}const ke=ys(g.transform.cameraToCenterDistance,Ie[3]),qe=P.aj(y,b,ye),ut=Z?qe/ke:qe*ke,mt=new P.P(ye.anchorX,ye.anchorY),st=vr(mt,k,f).point,ht={projections:{},offsets:{}},ft=Cn(ye,ut,!1,u,l,k,F,z.glyphOffsetArray,V,R,st,mt,ht,Y,h,f);le=ft.useVertical,(ft.notEnoughRoom||le||ft.needsFlipping&&Cn(ye,ut,!0,u,l,k,F,z.glyphOffsetArray,V,R,st,mt,ht,Y,h,f).notEnoughRoom)&&Te(ye.numGlyphs,R)}S?z.text.dynamicLayoutVertexBuffer.updateData(R):z.icon.dynamicLayoutVertexBuffer.updateData(R)}function br(z,l,g,S,k,F,Z,u,h,f,y,b,I){const R=u.glyphStartIndex+u.numGlyphs,V=u.lineStartIndex,W=u.lineStartIndex+u.lineLength,Y=l.getoffsetX(u.glyphStartIndex),le=l.getoffsetX(R-1),fe=Ae(z*Y,g,S,k,F,Z,u.segment,V,W,h,f,y,b,I);if(!fe)return null;const ye=Ae(z*le,g,S,k,F,Z,u.segment,V,W,h,f,y,b,I);return ye?{first:fe,last:ye}:null}function wr(z,l,g,S){return z===P.ai.horizontal&&Math.abs(g.y-l.y)>Math.abs(g.x-l.x)*S?{useVertical:!0}:(z===P.ai.vertical?l.y<g.y:l.x>g.x)?{needsFlipping:!0}:null}function Cn(z,l,g,S,k,F,Z,u,h,f,y,b,I,R,V,W){const Y=l/24,le=z.lineOffsetX*Y,fe=z.lineOffsetY*Y;let ye;if(z.numGlyphs>1){const Ie=z.glyphStartIndex+z.numGlyphs,ke=z.lineStartIndex,qe=z.lineStartIndex+z.lineLength,ut=br(Y,u,le,fe,g,y,b,z,h,F,I,V,W);if(!ut)return{notEnoughRoom:!0};const mt=vr(ut.first.point,Z,W).point,st=vr(ut.last.point,Z,W).point;if(S&&!g){const ht=wr(z.writingMode,mt,st,R);if(ht)return ht}ye=[ut.first];for(let ht=z.glyphStartIndex+1;ht<Ie-1;ht++)ye.push(Ae(Y*u.getoffsetX(ht),le,fe,g,y,b,z.segment,ke,qe,h,F,I,V,W));ye.push(ut.last)}else{if(S&&!g){const ke=vr(b,k,W).point,qe=z.lineStartIndex+z.segment+1,ut=new P.P(h.getx(qe),h.gety(qe)),mt=vr(ut,k,W),st=mt.signedDistanceFromCamera>0?mt.point:io(b,ut,ke,1,k,W),ht=wr(z.writingMode,ke,st,R);if(ht)return ht}const Ie=Ae(Y*u.getoffsetX(z.glyphStartIndex),le,fe,g,y,b,z.segment,z.lineStartIndex,z.lineStartIndex+z.lineLength,h,F,I,V,W);if(!Ie)return{notEnoughRoom:!0};ye=[Ie]}for(const Ie of ye)P.ak(f,Ie.point,Ie.angle);return{}}function io(z,l,g,S,k,F){const Z=vr(z.add(z.sub(l)._unit()),k,F).point,u=g.sub(Z);return g.add(u._mult(S/u.mag()))}function Sr(z,l){const{projectionCache:g,lineVertexArray:S,labelPlaneMatrix:k,tileAnchorPoint:F,distanceFromAnchor:Z,getElevation:u,previousVertex:h,direction:f,absOffsetX:y}=l;if(g.projections[z])return g.projections[z];const b=new P.P(S.getx(z),S.gety(z)),I=vr(b,k,u);if(I.signedDistanceFromCamera>0)return g.projections[z]=I.point,I.point;const R=z-f;return io(Z===0?F:new P.P(S.getx(R),S.gety(R)),b,h,y-Z+1,k,u)}function kt(z,l,g){return z._unit()._perp()._mult(l*g)}function we(z,l,g,S,k,F,Z,u){const{projectionCache:h,direction:f}=u;if(h.offsets[z])return h.offsets[z];const y=g.add(l);if(z+f<S||z+f>=k)return h.offsets[z]=y,y;const b=Sr(z+f,u),I=kt(b.sub(g),Z,f),R=g.add(I),V=b.add(I);return h.offsets[z]=P.al(F,y,R,V)||y,h.offsets[z]}function Ae(z,l,g,S,k,F,Z,u,h,f,y,b,I,R){const V=S?z-l:z+l;let W=V>0?1:-1,Y=0;S&&(W*=-1,Y=Math.PI),W<0&&(Y+=Math.PI);let le,fe,ye=W>0?u+Z:u+Z+1,Ie=k,ke=k,qe=0,ut=0;const mt=Math.abs(V),st=[];let ht;for(;qe+ut<=mt;){if(ye+=W,ye<u||ye>=h)return null;qe+=ut,ke=Ie,fe=le;const Nt={projectionCache:b,lineVertexArray:f,labelPlaneMatrix:y,tileAnchorPoint:F,distanceFromAnchor:qe,getElevation:R,previousVertex:ke,direction:W,absOffsetX:mt};if(Ie=Sr(ye,Nt),g===0)st.push(ke),ht=Ie.sub(ke);else{let Wt;const Gt=Ie.sub(ke);Wt=Gt.mag()===0?kt(Sr(ye+W,Nt).sub(Ie),g,W):kt(Gt,g,W),fe||(fe=ke.add(Wt)),le=we(ye,Wt,Ie,u,h,fe,g,Nt),st.push(fe),ht=le.sub(fe)}ut=ht.mag()}const ft=ht._mult((mt-qe)/ut)._add(fe||ke),Ai=Y+Math.atan2(Ie.y-ke.y,Ie.x-ke.x);return st.push(ft),{point:ft,angle:I?Ai:0,path:st}}const pe=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Te(z,l){for(let g=0;g<z;g++){const S=l.length;l.resize(S+4),l.float32.set(pe,3*S)}}function Be(z,l,g){const S=l[0],k=l[1];return z[0]=g[0]*S+g[4]*k+g[12],z[1]=g[1]*S+g[5]*k+g[13],z[3]=g[3]*S+g[7]*k+g[15],z}const Ve=100;class Ke{constructor(l,g=new ts(l.width+200,l.height+200,25),S=new ts(l.width+200,l.height+200,25)){this.transform=l,this.grid=g,this.ignoredGrid=S,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+Ve,this.screenBottomBoundary=l.height+Ve,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(l,g,S,k,F,Z){const u=this.projectAndGetPerspectiveRatio(k,l.anchorPointX,l.anchorPointY,Z),h=S*u.perspectiveRatio,f=l.x1*h+u.point.x,y=l.y1*h+u.point.y,b=l.x2*h+u.point.x,I=l.y2*h+u.point.y;return!this.isInsideGrid(f,y,b,I)||g!=="always"&&this.grid.hitTest(f,y,b,I,g,F)||u.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[f,y,b,I],offscreen:this.isOffscreen(f,y,b,I)}}placeCollisionCircles(l,g,S,k,F,Z,u,h,f,y,b,I,R,V){const W=[],Y=new P.P(g.anchorX,g.anchorY),le=vr(Y,Z,V),fe=ys(this.transform.cameraToCenterDistance,le.signedDistanceFromCamera),ye=(y?F/fe:F*fe)/P.ap,Ie=vr(Y,u,V).point,ke=br(ye,k,g.lineOffsetX*ye,g.lineOffsetY*ye,!1,Ie,Y,g,S,u,{projections:{},offsets:{}},!1,V);let qe=!1,ut=!1,mt=!0;if(ke){const st=.5*I*fe+R,ht=new P.P(-100,-100),ft=new P.P(this.screenRightBoundary,this.screenBottomBoundary),Ai=new Kr,Nt=ke.first,Wt=ke.last;let Gt=[];for(let Zi=Nt.path.length-1;Zi>=1;Zi--)Gt.push(Nt.path[Zi]);for(let Zi=1;Zi<Wt.path.length;Zi++)Gt.push(Wt.path[Zi]);const lr=2.5*st;if(h){const Zi=Gt.map(Fi=>vr(Fi,h,V));Gt=Zi.some(Fi=>Fi.signedDistanceFromCamera<=0)?[]:Zi.map(Fi=>Fi.point)}let Hi=[];if(Gt.length>0){const Zi=Gt[0].clone(),Fi=Gt[0].clone();for(let sr=1;sr<Gt.length;sr++)Zi.x=Math.min(Zi.x,Gt[sr].x),Zi.y=Math.min(Zi.y,Gt[sr].y),Fi.x=Math.max(Fi.x,Gt[sr].x),Fi.y=Math.max(Fi.y,Gt[sr].y);Hi=Zi.x>=ht.x&&Fi.x<=ft.x&&Zi.y>=ht.y&&Fi.y<=ft.y?[Gt]:Fi.x<ht.x||Zi.x>ft.x||Fi.y<ht.y||Zi.y>ft.y?[]:P.am([Gt],ht.x,ht.y,ft.x,ft.y)}for(const Zi of Hi){Ai.reset(Zi,.25*st);let Fi=0;Fi=Ai.length<=.5*st?1:Math.ceil(Ai.paddedLength/lr)+1;for(let sr=0;sr<Fi;sr++){const er=sr/Math.max(Fi-1,1),Nr=Ai.lerp(er),Yi=Nr.x+Ve,Rr=Nr.y+Ve;W.push(Yi,Rr,st,0);const kn=Yi-st,Kn=Rr-st,bl=Yi+st,wl=Rr+st;if(mt=mt&&this.isOffscreen(kn,Kn,bl,wl),ut=ut||this.isInsideGrid(kn,Kn,bl,wl),l!=="always"&&this.grid.hitTestCircle(Yi,Rr,st,l,b)&&(qe=!0,!f))return{circles:[],offscreen:!1,collisionDetected:qe}}}}return{circles:!f&&qe||!ut||fe<this.perspectiveRatioCutoff?[]:W,offscreen:mt,collisionDetected:qe}}queryRenderedSymbols(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const g=[];let S=1/0,k=1/0,F=-1/0,Z=-1/0;for(const y of l){const b=new P.P(y.x+Ve,y.y+Ve);S=Math.min(S,b.x),k=Math.min(k,b.y),F=Math.max(F,b.x),Z=Math.max(Z,b.y),g.push(b)}const u=this.grid.query(S,k,F,Z).concat(this.ignoredGrid.query(S,k,F,Z)),h={},f={};for(const y of u){const b=y.key;if(h[b.bucketInstanceId]===void 0&&(h[b.bucketInstanceId]={}),h[b.bucketInstanceId][b.featureIndex])continue;const I=[new P.P(y.x1,y.y1),new P.P(y.x2,y.y1),new P.P(y.x2,y.y2),new P.P(y.x1,y.y2)];P.an(g,I)&&(h[b.bucketInstanceId][b.featureIndex]=!0,f[b.bucketInstanceId]===void 0&&(f[b.bucketInstanceId]=[]),f[b.bucketInstanceId].push(b.featureIndex))}return f}insertCollisionBox(l,g,S,k,F,Z){(S?this.ignoredGrid:this.grid).insert({bucketInstanceId:k,featureIndex:F,collisionGroupID:Z,overlapMode:g},l[0],l[1],l[2],l[3])}insertCollisionCircles(l,g,S,k,F,Z){const u=S?this.ignoredGrid:this.grid,h={bucketInstanceId:k,featureIndex:F,collisionGroupID:Z,overlapMode:g};for(let f=0;f<l.length;f+=4)u.insertCircle(h,l[f],l[f+1],l[f+2])}projectAndGetPerspectiveRatio(l,g,S,k){let F;return k?(F=[g,S,k(g,S),1],P.ag(F,F,l)):(F=[g,S,0,1],Be(F,F,l)),{point:new P.P((F[0]/F[3]+1)/2*this.transform.width+Ve,(-F[1]/F[3]+1)/2*this.transform.height+Ve),perspectiveRatio:.5+this.transform.cameraToCenterDistance/F[3]*.5}}isOffscreen(l,g,S,k){return S<Ve||l>=this.screenRightBoundary||k<Ve||g>this.screenBottomBoundary}isInsideGrid(l,g,S,k){return S>=0&&l<this.gridRightBoundary&&k>=0&&g<this.gridBottomBoundary}getViewportMatrix(){const l=P.ao([]);return P.$(l,l,[-100,-100,0]),l}}function Qe(z,l,g){return l*(P.N/(z.tileSize*Math.pow(2,g-z.tileID.overscaledZ)))}class Ge{constructor(l,g,S,k){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?g:-g))):k&&S?1:0,this.placed=S}isHidden(){return this.opacity===0&&!this.placed}}class He{constructor(l,g,S,k,F){this.text=new Ge(l?l.text:null,g,S,F),this.icon=new Ge(l?l.icon:null,g,k,F)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Et{constructor(l,g,S){this.text=l,this.icon=g,this.skipFade=S}}class xe{constructor(){this.invProjMatrix=P.Z(),this.viewportMatrix=P.Z(),this.circles=[]}}class Me{constructor(l,g,S,k,F){this.bucketInstanceId=l,this.featureIndex=g,this.sourceLayerIndex=S,this.bucketIndex=k,this.tileID=F}}class ct{constructor(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}}get(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){const g=++this.maxGroupID;this.collisionGroups[l]={ID:g,predicate:S=>S.collisionGroupID===g}}return this.collisionGroups[l]}}function Pt(z,l,g,S,k){const{horizontalAlign:F,verticalAlign:Z}=P.au(z);return new P.P(-(F-.5)*l+S[0]*k,-(Z-.5)*g+S[1]*k)}function o(z,l,g,S,k,F){const{x1:Z,x2:u,y1:h,y2:f,anchorPointX:y,anchorPointY:b}=z,I=new P.P(l,g);return S&&I._rotate(k?F:-F),{x1:Z+I.x,y1:h+I.y,x2:u+I.x,y2:f+I.y,anchorPointX:y,anchorPointY:b}}class oe{constructor(l,g,S,k,F){this.transform=l.clone(),this.terrain=g,this.collisionIndex=new Ke(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=S,this.retainedQueryData={},this.collisionGroups=new ct(k),this.collisionCircleArrays={},this.prevPlacement=F,F&&(F.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(l,g,S,k){const F=S.getBucket(g),Z=S.latestFeatureIndex;if(!F||!Z||g.id!==F.layerIds[0])return;const u=S.collisionBoxArray,h=F.layers[0].layout,f=Math.pow(2,this.transform.zoom-S.tileID.overscaledZ),y=S.tileSize/P.N,b=this.transform.calculatePosMatrix(S.tileID.toUnwrapped()),I=h.get("text-pitch-alignment")==="map",R=h.get("text-rotation-alignment")==="map",V=Qe(S,1,this.transform.zoom),W=oi(b,I,R,this.transform,V);let Y=null;if(I){const fe=gn(b,I,R,this.transform,V);Y=P.a1([],this.transform.labelPlaneMatrix,fe)}this.retainedQueryData[F.bucketInstanceId]=new Me(F.bucketInstanceId,Z,F.sourceLayerIndex,F.index,S.tileID);const le={bucket:F,layout:h,posMatrix:b,textLabelPlaneMatrix:W,labelToScreenMatrix:Y,scale:f,textPixelRatio:y,holdingForFade:S.holdingForFade(),collisionBoxArray:u,partiallyEvaluatedTextSize:P.ah(F.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(F.sourceID)};if(k)for(const fe of F.sortKeyRanges){const{sortKey:ye,symbolInstanceStart:Ie,symbolInstanceEnd:ke}=fe;l.push({sortKey:ye,symbolInstanceStart:Ie,symbolInstanceEnd:ke,parameters:le})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:F.symbolInstances.length,parameters:le})}attemptAnchorPlacement(l,g,S,k,F,Z,u,h,f,y,b,I,R,V,W,Y){const le=P.aq[l.textAnchor],fe=[l.textOffset0,l.textOffset1],ye=Pt(le,S,k,fe,F),Ie=this.collisionIndex.placeCollisionBox(o(g,ye.x,ye.y,Z,u,this.transform.angle),b,h,f,y.predicate,Y);if((!W||this.collisionIndex.placeCollisionBox(o(W,ye.x,ye.y,Z,u,this.transform.angle),b,h,f,y.predicate,Y).box.length!==0)&&Ie.box.length>0){let ke;if(this.prevPlacement&&this.prevPlacement.variableOffsets[I.crossTileID]&&this.prevPlacement.placements[I.crossTileID]&&this.prevPlacement.placements[I.crossTileID].text&&(ke=this.prevPlacement.variableOffsets[I.crossTileID].anchor),I.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[I.crossTileID]={textOffset:fe,width:S,height:k,anchor:le,textBoxScale:F,prevAnchor:ke},this.markUsedJustification(R,le,I,V),R.allowVerticalPlacement&&(this.markUsedOrientation(R,V,I),this.placedOrientations[I.crossTileID]=V),{shift:ye,placedGlyphBoxes:Ie}}}placeLayerBucketPart(l,g,S){const{bucket:k,layout:F,posMatrix:Z,textLabelPlaneMatrix:u,labelToScreenMatrix:h,textPixelRatio:f,holdingForFade:y,collisionBoxArray:b,partiallyEvaluatedTextSize:I,collisionGroup:R}=l.parameters,V=F.get("text-optional"),W=F.get("icon-optional"),Y=P.ar(F,"text-overlap","text-allow-overlap"),le=Y==="always",fe=P.ar(F,"icon-overlap","icon-allow-overlap"),ye=fe==="always",Ie=F.get("text-rotation-alignment")==="map",ke=F.get("text-pitch-alignment")==="map",qe=F.get("icon-text-fit")!=="none",ut=F.get("symbol-z-order")==="viewport-y",mt=le&&(ye||!k.hasIconData()||W),st=ye&&(le||!k.hasTextData()||V);!k.collisionArrays&&b&&k.deserializeCollisionBoxes(b);const ht=this.retainedQueryData[k.bucketInstanceId].tileID,ft=this.terrain?(Nt,Wt)=>this.terrain.getElevation(ht,Nt,Wt):null,Ai=(Nt,Wt)=>{var Gt,lr;if(g[Nt.crossTileID])return;if(y)return void(this.placements[Nt.crossTileID]=new Et(!1,!1,!1));let Hi=!1,Zi=!1,Fi=!0,sr=null,er={box:null,offscreen:null},Nr={box:null,offscreen:null},Yi=null,Rr=null,kn=null,Kn=0,bl=0,wl=0;Wt.textFeatureIndex?Kn=Wt.textFeatureIndex:Nt.useRuntimeCollisionCircles&&(Kn=Nt.featureIndex),Wt.verticalTextFeatureIndex&&(bl=Wt.verticalTextFeatureIndex);const Fo=Wt.textBox;if(Fo){const Aa=Us=>{let ao=P.ai.horizontal;if(k.allowVerticalPlacement&&!Us&&this.prevPlacement){const qa=this.prevPlacement.placedOrientations[Nt.crossTileID];qa&&(this.placedOrientations[Nt.crossTileID]=qa,ao=qa,this.markUsedOrientation(k,ao,Nt))}return ao},$s=(Us,ao)=>{if(k.allowVerticalPlacement&&Nt.numVerticalGlyphVertices>0&&Wt.verticalTextBox){for(const qa of k.writingModes)if(qa===P.ai.vertical?(er=ao(),Nr=er):er=Us(),er&&er.box&&er.box.length)break}else er=Us()},Ma=Nt.textAnchorOffsetStartIndex,yA=Nt.textAnchorOffsetEndIndex;if(yA===Ma){const Us=(ao,qa)=>{const Xs=this.collisionIndex.placeCollisionBox(ao,Y,f,Z,R.predicate,ft);return Xs&&Xs.box&&Xs.box.length&&(this.markUsedOrientation(k,qa,Nt),this.placedOrientations[Nt.crossTileID]=qa),Xs};$s(()=>Us(Fo,P.ai.horizontal),()=>{const ao=Wt.verticalTextBox;return k.allowVerticalPlacement&&Nt.numVerticalGlyphVertices>0&&ao?Us(ao,P.ai.vertical):{box:null,offscreen:null}}),Aa(er&&er.box&&er.box.length)}else{let Us=P.aq[(lr=(Gt=this.prevPlacement)===null||Gt===void 0?void 0:Gt.variableOffsets[Nt.crossTileID])===null||lr===void 0?void 0:lr.anchor];const ao=(Xs,Nl,Nu)=>{const hd=Xs.x2-Xs.x1,Th=Xs.y2-Xs.y1,Uu=Nt.textBoxScale,bu=qe&&fe==="never"?Nl:null;let oA={box:[],offscreen:!1},cc=Y==="never"?1:2,Tl="never";Us&&cc++;for(let cl=0;cl<cc;cl++){for(let aA=Ma;aA<yA;aA++){const ju=k.textAnchorOffsets.get(aA);if(Us&&ju.textAnchor!==Us)continue;const xA=this.attemptAnchorPlacement(ju,Xs,hd,Th,Uu,Ie,ke,f,Z,R,Tl,Nt,k,Nu,bu,ft);if(xA&&(oA=xA.placedGlyphBoxes,oA&&oA.box&&oA.box.length))return Hi=!0,sr=xA.shift,oA}Us?Us=null:Tl=Y}return oA};$s(()=>ao(Fo,Wt.iconBox,P.ai.horizontal),()=>{const Xs=Wt.verticalTextBox;return k.allowVerticalPlacement&&!(er&&er.box&&er.box.length)&&Nt.numVerticalGlyphVertices>0&&Xs?ao(Xs,Wt.verticalIconBox,P.ai.vertical):{box:null,offscreen:null}}),er&&(Hi=er.box,Fi=er.offscreen);const qa=Aa(er&&er.box);if(!Hi&&this.prevPlacement){const Xs=this.prevPlacement.variableOffsets[Nt.crossTileID];Xs&&(this.variableOffsets[Nt.crossTileID]=Xs,this.markUsedJustification(k,Xs.anchor,Nt,qa))}}}if(Yi=er,Hi=Yi&&Yi.box&&Yi.box.length>0,Fi=Yi&&Yi.offscreen,Nt.useRuntimeCollisionCircles){const Aa=k.text.placedSymbolArray.get(Nt.centerJustifiedTextSymbolIndex),$s=P.aj(k.textSizeData,I,Aa),Ma=F.get("text-padding");Rr=this.collisionIndex.placeCollisionCircles(Y,Aa,k.lineVertexArray,k.glyphOffsetArray,$s,Z,u,h,S,ke,R.predicate,Nt.collisionCircleDiameter,Ma,ft),Rr.circles.length&&Rr.collisionDetected&&!S&&P.w("Collisions detected, but collision boxes are not shown"),Hi=le||Rr.circles.length>0&&!Rr.collisionDetected,Fi=Fi&&Rr.offscreen}if(Wt.iconFeatureIndex&&(wl=Wt.iconFeatureIndex),Wt.iconBox){const Aa=$s=>{const Ma=qe&&sr?o($s,sr.x,sr.y,Ie,ke,this.transform.angle):$s;return this.collisionIndex.placeCollisionBox(Ma,fe,f,Z,R.predicate,ft)};Nr&&Nr.box&&Nr.box.length&&Wt.verticalIconBox?(kn=Aa(Wt.verticalIconBox),Zi=kn.box.length>0):(kn=Aa(Wt.iconBox),Zi=kn.box.length>0),Fi=Fi&&kn.offscreen}const Ac=V||Nt.numHorizontalGlyphVertices===0&&Nt.numVerticalGlyphVertices===0,Sc=W||Nt.numIconVertices===0;if(Ac||Sc?Sc?Ac||(Zi=Zi&&Hi):Hi=Zi&&Hi:Zi=Hi=Zi&&Hi,Hi&&Yi&&Yi.box&&this.collisionIndex.insertCollisionBox(Yi.box,Y,F.get("text-ignore-placement"),k.bucketInstanceId,Nr&&Nr.box&&bl?bl:Kn,R.ID),Zi&&kn&&this.collisionIndex.insertCollisionBox(kn.box,fe,F.get("icon-ignore-placement"),k.bucketInstanceId,wl,R.ID),Rr&&(Hi&&this.collisionIndex.insertCollisionCircles(Rr.circles,Y,F.get("text-ignore-placement"),k.bucketInstanceId,Kn,R.ID),S)){const Aa=k.bucketInstanceId;let $s=this.collisionCircleArrays[Aa];$s===void 0&&($s=this.collisionCircleArrays[Aa]=new xe);for(let Ma=0;Ma<Rr.circles.length;Ma+=4)$s.circles.push(Rr.circles[Ma+0]),$s.circles.push(Rr.circles[Ma+1]),$s.circles.push(Rr.circles[Ma+2]),$s.circles.push(Rr.collisionDetected?1:0)}if(Nt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(k.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Nt.crossTileID]=new Et(Hi||mt,Zi||st,Fi||k.justReloaded),g[Nt.crossTileID]=!0};if(ut){if(l.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Nt=k.getSortedSymbolIndexes(this.transform.angle);for(let Wt=Nt.length-1;Wt>=0;--Wt){const Gt=Nt[Wt];Ai(k.symbolInstances.get(Gt),k.collisionArrays[Gt])}}else for(let Nt=l.symbolInstanceStart;Nt<l.symbolInstanceEnd;Nt++)Ai(k.symbolInstances.get(Nt),k.collisionArrays[Nt]);if(S&&k.bucketInstanceId in this.collisionCircleArrays){const Nt=this.collisionCircleArrays[k.bucketInstanceId];P.as(Nt.invProjMatrix,Z),Nt.viewportMatrix=this.collisionIndex.getViewportMatrix()}k.justReloaded=!1}markUsedJustification(l,g,S,k){let F;F=k===P.ai.vertical?S.verticalPlacedTextSymbolIndex:{left:S.leftJustifiedTextSymbolIndex,center:S.centerJustifiedTextSymbolIndex,right:S.rightJustifiedTextSymbolIndex}[P.at(g)];const Z=[S.leftJustifiedTextSymbolIndex,S.centerJustifiedTextSymbolIndex,S.rightJustifiedTextSymbolIndex,S.verticalPlacedTextSymbolIndex];for(const u of Z)u>=0&&(l.text.placedSymbolArray.get(u).crossTileID=F>=0&&u!==F?0:S.crossTileID)}markUsedOrientation(l,g,S){const k=g===P.ai.horizontal||g===P.ai.horizontalOnly?g:0,F=g===P.ai.vertical?g:0,Z=[S.leftJustifiedTextSymbolIndex,S.centerJustifiedTextSymbolIndex,S.rightJustifiedTextSymbolIndex];for(const u of Z)l.text.placedSymbolArray.get(u).placedOrientation=k;S.verticalPlacedTextSymbolIndex&&(l.text.placedSymbolArray.get(S.verticalPlacedTextSymbolIndex).placedOrientation=F)}commit(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;const g=this.prevPlacement;let S=!1;this.prevZoomAdjustment=g?g.zoomAdjustment(this.transform.zoom):0;const k=g?g.symbolFadeChange(l):1,F=g?g.opacities:{},Z=g?g.variableOffsets:{},u=g?g.placedOrientations:{};for(const h in this.placements){const f=this.placements[h],y=F[h];y?(this.opacities[h]=new He(y,k,f.text,f.icon),S=S||f.text!==y.text.placed||f.icon!==y.icon.placed):(this.opacities[h]=new He(null,k,f.text,f.icon,f.skipFade),S=S||f.text||f.icon)}for(const h in F){const f=F[h];if(!this.opacities[h]){const y=new He(f,k,!1,!1);y.isHidden()||(this.opacities[h]=y,S=S||f.text.placed||f.icon.placed)}}for(const h in Z)this.variableOffsets[h]||!this.opacities[h]||this.opacities[h].isHidden()||(this.variableOffsets[h]=Z[h]);for(const h in u)this.placedOrientations[h]||!this.opacities[h]||this.opacities[h].isHidden()||(this.placedOrientations[h]=u[h]);if(g&&g.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");S?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=g?g.lastPlacementChangeTime:l)}updateLayerOpacities(l,g){const S={};for(const k of g){const F=k.getBucket(l);F&&k.latestFeatureIndex&&l.id===F.layerIds[0]&&this.updateBucketOpacities(F,S,k.collisionBoxArray)}}updateBucketOpacities(l,g,S){l.hasTextData()&&(l.text.opacityVertexArray.clear(),l.text.hasVisibleVertices=!1),l.hasIconData()&&(l.icon.opacityVertexArray.clear(),l.icon.hasVisibleVertices=!1),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();const k=l.layers[0],F=k.layout,Z=new He(null,0,!1,!1,!0),u=F.get("text-allow-overlap"),h=F.get("icon-allow-overlap"),f=k._unevaluatedLayout.hasValue("text-variable-anchor")||k._unevaluatedLayout.hasValue("text-variable-anchor-offset"),y=F.get("text-rotation-alignment")==="map",b=F.get("text-pitch-alignment")==="map",I=F.get("icon-text-fit")!=="none",R=new He(null,0,u&&(h||!l.hasIconData()||F.get("icon-optional")),h&&(u||!l.hasTextData()||F.get("text-optional")),!0);!l.collisionArrays&&S&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(S);const V=(W,Y,le)=>{for(let fe=0;fe<Y/4;fe++)W.opacityVertexArray.emplaceBack(le);W.hasVisibleVertices=W.hasVisibleVertices||le!==Qs};for(let W=0;W<l.symbolInstances.length;W++){const Y=l.symbolInstances.get(W),{numHorizontalGlyphVertices:le,numVerticalGlyphVertices:fe,crossTileID:ye}=Y;let Ie=this.opacities[ye];g[ye]?Ie=Z:Ie||(Ie=R,this.opacities[ye]=Ie),g[ye]=!0;const ke=Y.numIconVertices>0,qe=this.placedOrientations[Y.crossTileID],ut=qe===P.ai.vertical,mt=qe===P.ai.horizontal||qe===P.ai.horizontalOnly;if(le>0||fe>0){const st=fn(Ie.text);V(l.text,le,ut?Qs:st),V(l.text,fe,mt?Qs:st);const ht=Ie.text.isHidden();[Y.rightJustifiedTextSymbolIndex,Y.centerJustifiedTextSymbolIndex,Y.leftJustifiedTextSymbolIndex].forEach(Nt=>{Nt>=0&&(l.text.placedSymbolArray.get(Nt).hidden=ht||ut?1:0)}),Y.verticalPlacedTextSymbolIndex>=0&&(l.text.placedSymbolArray.get(Y.verticalPlacedTextSymbolIndex).hidden=ht||mt?1:0);const ft=this.variableOffsets[Y.crossTileID];ft&&this.markUsedJustification(l,ft.anchor,Y,qe);const Ai=this.placedOrientations[Y.crossTileID];Ai&&(this.markUsedJustification(l,"left",Y,Ai),this.markUsedOrientation(l,Ai,Y))}if(ke){const st=fn(Ie.icon),ht=!(I&&Y.verticalPlacedIconSymbolIndex&&ut);Y.placedIconSymbolIndex>=0&&(V(l.icon,Y.numIconVertices,ht?st:Qs),l.icon.placedSymbolArray.get(Y.placedIconSymbolIndex).hidden=Ie.icon.isHidden()),Y.verticalPlacedIconSymbolIndex>=0&&(V(l.icon,Y.numVerticalIconVertices,ht?Qs:st),l.icon.placedSymbolArray.get(Y.verticalPlacedIconSymbolIndex).hidden=Ie.icon.isHidden())}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){const st=l.collisionArrays[W];if(st){let ht=new P.P(0,0);if(st.textBox||st.verticalTextBox){let Ai=!0;if(f){const Nt=this.variableOffsets[ye];Nt?(ht=Pt(Nt.anchor,Nt.width,Nt.height,Nt.textOffset,Nt.textBoxScale),y&&ht._rotate(b?this.transform.angle:-this.transform.angle)):Ai=!1}st.textBox&&ti(l.textCollisionBox.collisionVertexArray,Ie.text.placed,!Ai||ut,ht.x,ht.y),st.verticalTextBox&&ti(l.textCollisionBox.collisionVertexArray,Ie.text.placed,!Ai||mt,ht.x,ht.y)}const ft=!!(!mt&&st.verticalIconBox);st.iconBox&&ti(l.iconCollisionBox.collisionVertexArray,Ie.icon.placed,ft,I?ht.x:0,I?ht.y:0),st.verticalIconBox&&ti(l.iconCollisionBox.collisionVertexArray,Ie.icon.placed,!ft,I?ht.x:0,I?ht.y:0)}}}if(l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.text.opacityVertexArray.length!==l.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${l.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${l.text.layoutVertexArray.length}) / 4`);if(l.icon.opacityVertexArray.length!==l.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${l.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${l.icon.layoutVertexArray.length}) / 4`);if(l.bucketInstanceId in this.collisionCircleArrays){const W=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=W.invProjMatrix,l.placementViewportMatrix=W.viewportMatrix,l.collisionCircleArray=W.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}}symbolFadeChange(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(l){return Math.max(0,(this.transform.zoom-l)/1.5)}hasTransitions(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(l,g){const S=this.zoomAtLastRecencyCheck===g?1-this.zoomAdjustment(g):1;return this.zoomAtLastRecencyCheck=g,this.commitTime+this.fadeDuration*S>l}setStale(){this.stale=!0}}function ti(z,l,g,S,k){z.emplaceBack(l?1:0,g?1:0,S||0,k||0),z.emplaceBack(l?1:0,g?1:0,S||0,k||0),z.emplaceBack(l?1:0,g?1:0,S||0,k||0),z.emplaceBack(l?1:0,g?1:0,S||0,k||0)}const xi=Math.pow(2,25),yi=Math.pow(2,24),ai=Math.pow(2,17),pi=Math.pow(2,16),gr=Math.pow(2,9),bi=Math.pow(2,8),zi=Math.pow(2,1);function fn(z){if(z.opacity===0&&!z.placed)return 0;if(z.opacity===1&&z.placed)return 4294967295;const l=z.placed?1:0,g=Math.floor(127*z.opacity);return g*xi+l*yi+g*ai+l*pi+g*gr+l*bi+g*zi+l}const Qs=0;class HA{constructor(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&!l.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(l,g,S,k,F){const Z=this._bucketParts;for(;this._currentTileIndex<l.length;)if(g.getBucketParts(Z,k,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,F())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,Z.sort((u,h)=>u.sortKey-h.sortKey));this._currentPartIndex<Z.length;)if(g.placeLayerBucketPart(Z[this._currentPartIndex],this._seenCrossTileIDs,S),this._currentPartIndex++,F())return!0;return!1}}class Ls{constructor(l,g,S,k,F,Z,u,h){this.placement=new oe(l,g,Z,u,h),this._currentPlacementIndex=S.length-1,this._forceFullPlacement=k,this._showCollisionBoxes=F,this._done=!1}isDone(){return this._done}continuePlacement(l,g,S){const k=P.h.now(),F=()=>!this._forceFullPlacement&&P.h.now()-k>2;for(;this._currentPlacementIndex>=0;){const Z=g[l[this._currentPlacementIndex]],u=this.placement.collisionIndex.transform.zoom;if(Z.type==="symbol"&&(!Z.minzoom||Z.minzoom<=u)&&(!Z.maxzoom||Z.maxzoom>u)){if(this._inProgressLayer||(this._inProgressLayer=new HA(Z)),this._inProgressLayer.continuePlacement(S[Z.source],this.placement,this._showCollisionBoxes,Z,F))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(l){return this.placement.commit(l),this.placement}}const Rs=512/P.N/2;class ko{constructor(l,g,S){this.tileID=l,this.bucketInstanceId=S,this._symbolsByKey={};const k=new Map;for(let F=0;F<g.length;F++){const Z=g.get(F),u=Z.key,h=k.get(u);h?h.push(Z):k.set(u,[Z])}for(const[F,Z]of k){const u={positions:Z.map(h=>({x:Math.floor(h.anchorX*Rs),y:Math.floor(h.anchorY*Rs)})),crossTileIDs:Z.map(h=>h.crossTileID)};if(u.positions.length>128){const h=new P.av(u.positions.length,16,Uint16Array);for(const{x:f,y}of u.positions)h.add(f,y);h.finish(),delete u.positions,u.index=h}this._symbolsByKey[F]=u}}getScaledCoordinates(l,g){const{x:S,y:k,z:F}=this.tileID.canonical,{x:Z,y:u,z:h}=g.canonical,f=Rs/Math.pow(2,h-F),y=(u*P.N+l.anchorY)*f,b=k*P.N*Rs;return{x:Math.floor((Z*P.N+l.anchorX)*f-S*P.N*Rs),y:Math.floor(y-b)}}findMatches(l,g,S){const k=this.tileID.canonical.z<g.canonical.z?1:Math.pow(2,this.tileID.canonical.z-g.canonical.z);for(let F=0;F<l.length;F++){const Z=l.get(F);if(Z.crossTileID)continue;const u=this._symbolsByKey[Z.key];if(!u)continue;const h=this.getScaledCoordinates(Z,g);if(u.index){const f=u.index.range(h.x-k,h.y-k,h.x+k,h.y+k).sort();for(const y of f){const b=u.crossTileIDs[y];if(!S[b]){S[b]=!0,Z.crossTileID=b;break}}}else if(u.positions)for(let f=0;f<u.positions.length;f++){const y=u.positions[f],b=u.crossTileIDs[f];if(Math.abs(y.x-h.x)<=k&&Math.abs(y.y-h.y)<=k&&!S[b]){S[b]=!0,Z.crossTileID=b;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:l})=>l)}}class nn{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class qo{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(l){const g=Math.round((l-this.lng)/360);if(g!==0)for(const S in this.indexes){const k=this.indexes[S],F={};for(const Z in k){const u=k[Z];u.tileID=u.tileID.unwrapTo(u.tileID.wrap+g),F[u.tileID.key]=u}this.indexes[S]=F}this.lng=l}addBucket(l,g,S){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===g.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(let F=0;F<g.symbolInstances.length;F++)g.symbolInstances.get(F).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]={});const k=this.usedCrossTileIDs[l.overscaledZ];for(const F in this.indexes){const Z=this.indexes[F];if(Number(F)>l.overscaledZ)for(const u in Z){const h=Z[u];h.tileID.isChildOf(l)&&h.findMatches(g.symbolInstances,l,k)}else{const u=Z[l.scaledTo(Number(F)).key];u&&u.findMatches(g.symbolInstances,l,k)}}for(let F=0;F<g.symbolInstances.length;F++){const Z=g.symbolInstances.get(F);Z.crossTileID||(Z.crossTileID=S.generate(),k[Z.crossTileID]=!0)}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new ko(l,g.symbolInstances,g.bucketInstanceId),!0}removeBucketCrossTileIDs(l,g){for(const S of g.getCrossTileIDsLists())for(const k of S)delete this.usedCrossTileIDs[l][k]}removeStaleBuckets(l){let g=!1;for(const S in this.indexes){const k=this.indexes[S];for(const F in k)l[k[F].bucketInstanceId]||(this.removeBucketCrossTileIDs(S,k[F]),delete k[F],g=!0)}return g}}class Dr{constructor(){this.layerIndexes={},this.crossTileIDs=new nn,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(l,g,S){let k=this.layerIndexes[l.id];k===void 0&&(k=this.layerIndexes[l.id]=new qo);let F=!1;const Z={};k.handleWrapJump(S);for(const u of g){const h=u.getBucket(l);h&&l.id===h.layerIds[0]&&(h.bucketInstanceId||(h.bucketInstanceId=++this.maxBucketInstanceId),k.addBucket(u.tileID,h,this.crossTileIDs)&&(F=!0),Z[h.bucketInstanceId]=!0)}return k.removeStaleBuckets(Z)&&(F=!0),F}pruneUnusedLayers(l){const g={};l.forEach(S=>{g[S]=!0});for(const S in this.layerIndexes)g[S]||delete this.layerIndexes[S]}}const gt=(z,l)=>P.x(z,l&&l.filter(g=>g.identifier!=="source.canvas")),Di=P.F(P.ax,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setGlyphs","setSprite"]),Je=P.F(P.ax,["setCenter","setZoom","setBearing","setPitch"]),Ar=P.aw();class Hs extends P.E{constructor(l,g={}){super(),this.map=l,this.dispatcher=new gs(Ki(),this,l._getMapId()),this.imageManager=new Sn,this.imageManager.setEventedParent(this),this.glyphManager=new as(l._requestManager,g.localIdeographFontFamily),this.lineAtlas=new Zo(256,512),this.crossTileSymbolIndex=new Dr,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new P.ay,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",P.az());const S=this;this._rtlTextPluginCallback=Hs.registerForPluginStateChange(k=>{S.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:k.pluginStatus,pluginURL:k.pluginURL},(F,Z)=>{if(P.aA(F),Z&&Z.every(u=>u))for(const u in S.sourceCaches){const h=S.sourceCaches[u].getSource().type;h!=="vector"&&h!=="geojson"||S.sourceCaches[u].reload()}})}),this.on("data",k=>{if(k.dataType!=="source"||k.sourceDataType!=="metadata")return;const F=this.sourceCaches[k.sourceId];if(!F)return;const Z=F.getSource();if(Z&&Z.vectorLayerIds)for(const u in this._layers){const h=this._layers[u];h.source===Z.id&&this._validateLayer(h)}})}loadURL(l,g={},S){this.fire(new P.k("dataloading",{dataType:"style"})),g.validate=typeof g.validate!="boolean"||g.validate;const k=this.map._requestManager.transformRequest(l,Ei.Style);this._request=P.f(k,(F,Z)=>{this._request=null,F?this.fire(new P.j(F)):Z&&this._load(Z,g,S)})}loadJSON(l,g={},S){this.fire(new P.k("dataloading",{dataType:"style"})),this._request=P.h.frame(()=>{this._request=null,g.validate=g.validate!==!1,this._load(l,g,S)})}loadEmpty(){this.fire(new P.k("dataloading",{dataType:"style"})),this._load(Ar,{validate:!1})}_load(l,g,S){var k;const F=g.transformStyle?g.transformStyle(S,l):l;if(!g.validate||!gt(this,P.y(F))){this._loaded=!0,this.stylesheet=F;for(const Z in F.sources)this.addSource(Z,F.sources[Z],{validate:!1});F.sprite?this._loadSprite(F.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(F.glyphs),this._createLayers(),this.light=new Io(this.stylesheet.light),this.map.setTerrain((k=this.stylesheet.terrain)!==null&&k!==void 0?k:null),this.fire(new P.k("data",{dataType:"style"})),this.fire(new P.k("style.load"))}}_createLayers(){const l=P.aB(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",l),this._order=l.map(g=>g.id),this._layers={},this._serializedLayers=null;for(const g of l){const S=P.aC(g);S.setEventedParent(this,{layer:{id:g.id}}),this._layers[g.id]=S}}_loadSprite(l,g=!1,S=void 0){this.imageManager.setLoaded(!1),this._spriteRequest=function(k,F,Z,u){const h=rn(k),f=h.length,y=Z>1?"@2x":"",b={},I={},R={};for(const{id:V,url:W}of h){const Y=F.transformRequest(F.normalizeSpriteURL(W,y,".json"),Ei.SpriteJSON),le=`${V}_${Y.url}`;b[le]=P.f(Y,(Ie,ke)=>{delete b[le],I[V]=ke,pn(u,I,R,Ie,f)});const fe=F.transformRequest(F.normalizeSpriteURL(W,y,".png"),Ei.SpriteImage),ye=`${V}_${fe.url}`;b[ye]=di.getImage(fe,(Ie,ke)=>{delete b[ye],R[V]=ke,pn(u,I,R,Ie,f)})}return{cancel(){for(const V of Object.values(b))V.cancel()}}}(l,this.map._requestManager,this.map.getPixelRatio(),(k,F)=>{if(this._spriteRequest=null,k)this.fire(new P.j(k));else if(F)for(const Z in F){this._spritesImagesIds[Z]=[];const u=this._spritesImagesIds[Z]?this._spritesImagesIds[Z].filter(h=>!(h in F)):[];for(const h of u)this.imageManager.removeImage(h),this._changedImages[h]=!0;for(const h in F[Z]){const f=Z==="default"?h:`${Z}:${h}`;this._spritesImagesIds[Z].push(f),f in this.imageManager.images?this.imageManager.updateImage(f,F[Z][h],!1):this.imageManager.addImage(f,F[Z][h]),g&&(this._changedImages[f]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),g&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new P.k("data",{dataType:"style"})),S&&S(k)})}_unloadSprite(){for(const l of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(l),this._changedImages[l]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new P.k("data",{dataType:"style"}))}_validateLayer(l){const g=this.sourceCaches[l.source];if(!g)return;const S=l.sourceLayer;if(!S)return;const k=g.getSource();(k.type==="geojson"||k.vectorLayerIds&&k.vectorLayerIds.indexOf(S)===-1)&&this.fire(new P.j(new Error(`Source layer "${S}" does not exist on source "${k.id}" as specified by style layer "${l.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const l in this.sourceCaches)if(!this.sourceCaches[l].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(l){const g=this._serializedAllLayers();if(!l||l.length===0)return Object.values(g);const S=[];for(const k of l)g[k]&&S.push(g[k]);return S}_serializedAllLayers(){let l=this._serializedLayers;if(l)return l;l=this._serializedLayers={};const g=Object.keys(this._layers);for(const S of g){const k=this._layers[S];k.type!=="custom"&&(l[S]=k.serialize())}return l}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const l in this.sourceCaches)if(this.sourceCaches[l].hasTransition())return!0;for(const l in this._layers)if(this._layers[l].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(l){if(!this._loaded)return;const g=this._changed;if(this._changed){const k=Object.keys(this._updatedLayers),F=Object.keys(this._removedLayers);(k.length||F.length)&&this._updateWorkerLayers(k,F);for(const Z in this._updatedSources){const u=this._updatedSources[Z];if(u==="reload")this._reloadSource(Z);else{if(u!=="clear")throw new Error(`Invalid action ${u}`);this._clearSource(Z)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const Z in this._updatedPaintProps)this._layers[Z].updateTransitions(l);this.light.updateTransitions(l),this._resetUpdates()}const S={};for(const k in this.sourceCaches){const F=this.sourceCaches[k];S[k]=F.used,F.used=!1}for(const k of this._order){const F=this._layers[k];F.recalculate(l,this._availableImages),!F.isHidden(l.zoom)&&F.source&&(this.sourceCaches[F.source].used=!0)}for(const k in S){const F=this.sourceCaches[k];S[k]!==F.used&&F.fire(new P.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:k}))}this.light.recalculate(l),this.z=l.zoom,g&&this.fire(new P.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const l=Object.keys(this._changedImages);if(l.length){for(const g in this.sourceCaches)this.sourceCaches[g].reloadTilesForDependencies(["icons","patterns"],l);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const l in this.sourceCaches)this.sourceCaches[l].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(l,g){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(l),removedIds:g})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(l,g={}){this._checkLoaded();const S=this.serialize();if(l=g.transformStyle?g.transformStyle(S,l):l,gt(this,P.y(l)))return!1;(l=P.aD(l)).layers=P.aB(l.layers);const k=P.aE(S,l).filter(Z=>!(Z.command in Je));if(k.length===0)return!1;const F=k.filter(Z=>!(Z.command in Di));if(F.length>0)throw new Error(`Unimplemented: ${F.map(Z=>Z.command).join(", ")}.`);for(const Z of k)Z.command!=="setTransition"&&this[Z.command].apply(this,Z.args);return this.stylesheet=l,this._serializedLayers=null,!0}addImage(l,g){if(this.getImage(l))return this.fire(new P.j(new Error(`An image named "${l}" already exists.`)));this.imageManager.addImage(l,g),this._afterImageUpdated(l)}updateImage(l,g){this.imageManager.updateImage(l,g)}getImage(l){return this.imageManager.getImage(l)}removeImage(l){if(!this.getImage(l))return this.fire(new P.j(new Error(`An image named "${l}" does not exist.`)));this.imageManager.removeImage(l),this._afterImageUpdated(l)}_afterImageUpdated(l){this._availableImages=this.imageManager.listImages(),this._changedImages[l]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new P.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(l,g,S={}){if(this._checkLoaded(),this.sourceCaches[l]!==void 0)throw new Error(`Source "${l}" already exists.`);if(!g.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(g).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(g.type)>=0&&this._validate(P.y.source,`sources.${l}`,g,null,S))return;this.map&&this.map._collectResourceTiming&&(g.collectResourceTiming=!0);const k=this.sourceCaches[l]=new Ft(l,g,this.dispatcher);k.style=this,k.setEventedParent(this,()=>({isSourceLoaded:k.loaded(),source:k.serialize(),sourceId:l})),k.onAdd(this.map),this._changed=!0}removeSource(l){if(this._checkLoaded(),this.sourceCaches[l]===void 0)throw new Error("There is no source with this ID");for(const S in this._layers)if(this._layers[S].source===l)return this.fire(new P.j(new Error(`Source "${l}" cannot be removed while layer "${S}" is using it.`)));const g=this.sourceCaches[l];delete this.sourceCaches[l],delete this._updatedSources[l],g.fire(new P.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:l})),g.setEventedParent(null),g.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(l,g){if(this._checkLoaded(),this.sourceCaches[l]===void 0)throw new Error(`There is no source with this ID=${l}`);const S=this.sourceCaches[l].getSource();if(S.type!=="geojson")throw new Error(`geojsonSource.type is ${S.type}, which is !== 'geojson`);S.setData(g),this._changed=!0}getSource(l){return this.sourceCaches[l]&&this.sourceCaches[l].getSource()}addLayer(l,g,S={}){this._checkLoaded();const k=l.id;if(this.getLayer(k))return void this.fire(new P.j(new Error(`Layer "${k}" already exists on this map.`)));let F;if(l.type==="custom"){if(gt(this,P.aF(l)))return;F=P.aC(l)}else{if("source"in l&&typeof l.source=="object"&&(this.addSource(k,l.source),l=P.aD(l),l=P.e(l,{source:k})),this._validate(P.y.layer,`layers.${k}`,l,{arrayIndex:-1},S))return;F=P.aC(l),this._validateLayer(F),F.setEventedParent(this,{layer:{id:k}})}const Z=g?this._order.indexOf(g):this._order.length;if(g&&Z===-1)this.fire(new P.j(new Error(`Cannot add layer "${k}" before non-existing layer "${g}".`)));else{if(this._order.splice(Z,0,k),this._layerOrderChanged=!0,this._layers[k]=F,this._removedLayers[k]&&F.source&&F.type!=="custom"){const u=this._removedLayers[k];delete this._removedLayers[k],u.type!==F.type?this._updatedSources[F.source]="clear":(this._updatedSources[F.source]="reload",this.sourceCaches[F.source].pause())}this._updateLayer(F),F.onAdd&&F.onAdd(this.map)}}moveLayer(l,g){if(this._checkLoaded(),this._changed=!0,!this._layers[l])return void this.fire(new P.j(new Error(`The layer '${l}' does not exist in the map's style and cannot be moved.`)));if(l===g)return;const S=this._order.indexOf(l);this._order.splice(S,1);const k=g?this._order.indexOf(g):this._order.length;g&&k===-1?this.fire(new P.j(new Error(`Cannot move layer "${l}" before non-existing layer "${g}".`))):(this._order.splice(k,0,l),this._layerOrderChanged=!0)}removeLayer(l){this._checkLoaded();const g=this._layers[l];if(!g)return void this.fire(new P.j(new Error(`Cannot remove non-existing layer "${l}".`)));g.setEventedParent(null);const S=this._order.indexOf(l);this._order.splice(S,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[l]=g,delete this._layers[l],this._serializedLayers&&delete this._serializedLayers[l],delete this._updatedLayers[l],delete this._updatedPaintProps[l],g.onRemove&&g.onRemove(this.map)}getLayer(l){return this._layers[l]}getLayersOrder(){return[...this._order]}hasLayer(l){return l in this._layers}setLayerZoomRange(l,g,S){this._checkLoaded();const k=this.getLayer(l);k?k.minzoom===g&&k.maxzoom===S||(g!=null&&(k.minzoom=g),S!=null&&(k.maxzoom=S),this._updateLayer(k)):this.fire(new P.j(new Error(`Cannot set the zoom range of non-existing layer "${l}".`)))}setFilter(l,g,S={}){this._checkLoaded();const k=this.getLayer(l);if(k){if(!P.aG(k.filter,g))return g==null?(k.filter=void 0,void this._updateLayer(k)):void(this._validate(P.y.filter,`layers.${k.id}.filter`,g,null,S)||(k.filter=P.aD(g),this._updateLayer(k)))}else this.fire(new P.j(new Error(`Cannot filter non-existing layer "${l}".`)))}getFilter(l){return P.aD(this.getLayer(l).filter)}setLayoutProperty(l,g,S,k={}){this._checkLoaded();const F=this.getLayer(l);F?P.aG(F.getLayoutProperty(g),S)||(F.setLayoutProperty(g,S,k),this._updateLayer(F)):this.fire(new P.j(new Error(`Cannot style non-existing layer "${l}".`)))}getLayoutProperty(l,g){const S=this.getLayer(l);if(S)return S.getLayoutProperty(g);this.fire(new P.j(new Error(`Cannot get style of non-existing layer "${l}".`)))}setPaintProperty(l,g,S,k={}){this._checkLoaded();const F=this.getLayer(l);F?P.aG(F.getPaintProperty(g),S)||(F.setPaintProperty(g,S,k)&&this._updateLayer(F),this._changed=!0,this._updatedPaintProps[l]=!0):this.fire(new P.j(new Error(`Cannot style non-existing layer "${l}".`)))}getPaintProperty(l,g){return this.getLayer(l).getPaintProperty(g)}setFeatureState(l,g){this._checkLoaded();const S=l.source,k=l.sourceLayer,F=this.sourceCaches[S];if(F===void 0)return void this.fire(new P.j(new Error(`The source '${S}' does not exist in the map's style.`)));const Z=F.getSource().type;Z==="geojson"&&k?this.fire(new P.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):Z!=="vector"||k?(l.id===void 0&&this.fire(new P.j(new Error("The feature id parameter must be provided."))),F.setFeatureState(k,l.id,g)):this.fire(new P.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(l,g){this._checkLoaded();const S=l.source,k=this.sourceCaches[S];if(k===void 0)return void this.fire(new P.j(new Error(`The source '${S}' does not exist in the map's style.`)));const F=k.getSource().type,Z=F==="vector"?l.sourceLayer:void 0;F!=="vector"||Z?g&&typeof l.id!="string"&&typeof l.id!="number"?this.fire(new P.j(new Error("A feature id is required to remove its specific state property."))):k.removeFeatureState(Z,l.id,g):this.fire(new P.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(l){this._checkLoaded();const g=l.source,S=l.sourceLayer,k=this.sourceCaches[g];if(k!==void 0)return k.getSource().type!=="vector"||S?(l.id===void 0&&this.fire(new P.j(new Error("The feature id parameter must be provided."))),k.getFeatureState(S,l.id)):void this.fire(new P.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new P.j(new Error(`The source '${g}' does not exist in the map's style.`)))}getTransition(){return P.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const l=P.aH(this.sourceCaches,F=>F.serialize()),g=this._serializeByIds(this._order),S=this.map.getTerrain()||void 0,k=this.stylesheet;return P.aI({version:k.version,name:k.name,metadata:k.metadata,light:k.light,center:k.center,zoom:k.zoom,bearing:k.bearing,pitch:k.pitch,sprite:k.sprite,glyphs:k.glyphs,transition:k.transition,sources:l,layers:g,terrain:S},F=>F!==void 0)}_updateLayer(l){this._updatedLayers[l.id]=!0,l.source&&!this._updatedSources[l.source]&&this.sourceCaches[l.source].getSource().type!=="raster"&&(this._updatedSources[l.source]="reload",this.sourceCaches[l.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(l){const g=Z=>this._layers[Z].type==="fill-extrusion",S={},k=[];for(let Z=this._order.length-1;Z>=0;Z--){const u=this._order[Z];if(g(u)){S[u]=Z;for(const h of l){const f=h[u];if(f)for(const y of f)k.push(y)}}}k.sort((Z,u)=>u.intersectionZ-Z.intersectionZ);const F=[];for(let Z=this._order.length-1;Z>=0;Z--){const u=this._order[Z];if(g(u))for(let h=k.length-1;h>=0;h--){const f=k[h].feature;if(S[f.layer.id]<Z)break;F.push(f),k.pop()}else for(const h of l){const f=h[u];if(f)for(const y of f)F.push(y.feature)}}return F}queryRenderedFeatures(l,g,S){g&&g.filter&&this._validate(P.y.filter,"queryRenderedFeatures.filter",g.filter,null,g);const k={};if(g&&g.layers){if(!Array.isArray(g.layers))return this.fire(new P.j(new Error("parameters.layers must be an Array."))),[];for(const u of g.layers){const h=this._layers[u];if(!h)return this.fire(new P.j(new Error(`The layer '${u}' does not exist in the map's style and cannot be queried for features.`))),[];k[h.source]=!0}}const F=[];g.availableImages=this._availableImages;const Z=this._serializedAllLayers();for(const u in this.sourceCaches)g.layers&&!k[u]||F.push(pa(this.sourceCaches[u],this._layers,Z,l,g,S));return this.placement&&F.push(function(u,h,f,y,b,I,R){const V={},W=I.queryRenderedSymbols(y),Y=[];for(const le of Object.keys(W).map(Number))Y.push(R[le]);Y.sort(Yt);for(const le of Y){const fe=le.featureIndex.lookupSymbolFeatures(W[le.bucketInstanceId],h,le.bucketIndex,le.sourceLayerIndex,b.filter,b.layers,b.availableImages,u);for(const ye in fe){const Ie=V[ye]=V[ye]||[],ke=fe[ye];ke.sort((qe,ut)=>{const mt=le.featureSortOrder;if(mt){const st=mt.indexOf(qe.featureIndex);return mt.indexOf(ut.featureIndex)-st}return ut.featureIndex-qe.featureIndex});for(const qe of ke)Ie.push(qe)}}for(const le in V)V[le].forEach(fe=>{const ye=fe.feature,Ie=f[u[le].source].getFeatureState(ye.layer["source-layer"],ye.id);ye.source=ye.layer.source,ye.layer["source-layer"]&&(ye.sourceLayer=ye.layer["source-layer"]),ye.state=Ie});return V}(this._layers,Z,this.sourceCaches,l,g,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(F)}querySourceFeatures(l,g){g&&g.filter&&this._validate(P.y.filter,"querySourceFeatures.filter",g.filter,null,g);const S=this.sourceCaches[l];return S?function(k,F){const Z=k.getRenderableIds().map(f=>k.getTileByID(f)),u=[],h={};for(let f=0;f<Z.length;f++){const y=Z[f],b=y.tileID.canonical.key;h[b]||(h[b]=!0,y.querySourceFeatures(u,F))}return u}(S,g):[]}addSourceType(l,g,S){return Un(l)?S(new Error(`A source type called "${l}" already exists.`)):(((k,F)=>{Cl[k]=F})(l,g),g.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:l,url:g.workerSourceURL},S):S(null,null))}getLight(){return this.light.getLight()}setLight(l,g={}){this._checkLoaded();const S=this.light.getLight();let k=!1;for(const Z in l)if(!P.aG(l[Z],S[Z])){k=!0;break}if(!k)return;const F={now:P.h.now(),transition:P.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(l,g),this.light.updateTransitions(F)}_validate(l,g,S,k,F={}){return(!F||F.validate!==!1)&&gt(this,l.call(P.y,P.e({key:g,style:this.serialize(),value:S,styleSpec:P.v},k)))}_remove(l=!0){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),P.aJ.off("pluginStateChange",this._rtlTextPluginCallback);for(const g in this._layers)this._layers[g].setEventedParent(null);for(const g in this.sourceCaches){const S=this.sourceCaches[g];S.setEventedParent(null),S.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(l)}_clearSource(l){this.sourceCaches[l].clearTiles()}_reloadSource(l){this.sourceCaches[l].resume(),this.sourceCaches[l].reload()}_updateSources(l){for(const g in this.sourceCaches)this.sourceCaches[g].update(l,this.map.terrain)}_generateCollisionBoxes(){for(const l in this.sourceCaches)this._reloadSource(l)}_updatePlacement(l,g,S,k,F=!1){let Z=!1,u=!1;const h={};for(const f of this._order){const y=this._layers[f];if(y.type!=="symbol")continue;if(!h[y.source]){const I=this.sourceCaches[y.source];h[y.source]=I.getRenderableIds(!0).map(R=>I.getTileByID(R)).sort((R,V)=>V.tileID.overscaledZ-R.tileID.overscaledZ||(R.tileID.isLessThan(V.tileID)?-1:1))}const b=this.crossTileSymbolIndex.addLayer(y,h[y.source],l.center.lng);Z=Z||b}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((F=F||this._layerOrderChanged||S===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(P.h.now(),l.zoom))&&(this.pauseablePlacement=new Ls(l,this.map.terrain,this._order,F,g,S,k,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,h),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(P.h.now()),u=!0),Z&&this.pauseablePlacement.placement.setStale()),u||Z)for(const f of this._order){const y=this._layers[f];y.type==="symbol"&&this.placement.updateLayerOpacities(y,h[y.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(P.h.now())}_releaseSymbolFadeTiles(){for(const l in this.sourceCaches)this.sourceCaches[l].releaseSymbolFadeTiles()}getImages(l,g,S){this.imageManager.getImages(g.icons,S),this._updateTilesForChangedImages();const k=this.sourceCaches[g.source];k&&k.setDependencies(g.tileID.key,g.type,g.icons)}getGlyphs(l,g,S){this.glyphManager.getGlyphs(g.stacks,S);const k=this.sourceCaches[g.source];k&&k.setDependencies(g.tileID.key,g.type,[""])}getResource(l,g,S){return P.m(g,S)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(l,g={}){this._checkLoaded(),l&&this._validate(P.y.glyphs,"glyphs",l,null,g)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=l,this.glyphManager.entries={},this.glyphManager.setURL(l))}addSprite(l,g,S={},k){this._checkLoaded();const F=[{id:l,url:g}],Z=[...rn(this.stylesheet.sprite),...F];this._validate(P.y.sprite,"sprite",Z,null,S)||(this.stylesheet.sprite=Z,this._loadSprite(F,!0,k))}removeSprite(l){this._checkLoaded();const g=rn(this.stylesheet.sprite);if(g.find(S=>S.id===l)){if(this._spritesImagesIds[l])for(const S of this._spritesImagesIds[l])this.imageManager.removeImage(S),this._changedImages[S]=!0;g.splice(g.findIndex(S=>S.id===l),1),this.stylesheet.sprite=g.length>0?g:void 0,delete this._spritesImagesIds[l],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new P.k("data",{dataType:"style"}))}else this.fire(new P.j(new Error(`Sprite "${l}" doesn't exists on this map.`)))}getSprite(){return rn(this.stylesheet.sprite)}setSprite(l,g={},S){this._checkLoaded(),l&&this._validate(P.y.sprite,"sprite",l,null,g)||(this.stylesheet.sprite=l,l?this._loadSprite(l,!0,S):(this._unloadSprite(),S&&S(null)))}}Hs.registerForPluginStateChange=P.aK;var DA=P.Q([{name:"a_pos",type:"Int16",components:2}]),kl="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const nt={prelude:yn(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:yn(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:yn(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:yn(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:yn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:yn(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:yn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:yn("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:yn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:yn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:yn(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:yn(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:yn(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:yn(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:yn(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:yn(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:yn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:yn(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:yn(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:yn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:yn(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:yn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:yn(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:yn(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:yn(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:yn(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:yn("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",kl),terrainDepth:yn("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",kl),terrainCoords:yn("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",kl)};function yn(z,l){const g=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,S=l.match(/attribute ([\w]+) ([\w]+)/g),k=z.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),F=l.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),Z=F?F.concat(k):k,u={};return{fragmentSource:z=z.replace(g,(h,f,y,b,I)=>(u[I]=!0,f==="define"?`
#ifndef HAS_UNIFORM_u_${I}
varying ${y} ${b} ${I};
#else
uniform ${y} ${b} u_${I};
#endif
`:`
#ifdef HAS_UNIFORM_u_${I}
    ${y} ${b} ${I} = u_${I};
#endif
`)),vertexSource:l=l.replace(g,(h,f,y,b,I)=>{const R=b==="float"?"vec2":"vec4",V=I.match(/color/)?"color":R;return u[I]?f==="define"?`
#ifndef HAS_UNIFORM_u_${I}
uniform lowp float u_${I}_t;
attribute ${y} ${R} a_${I};
varying ${y} ${b} ${I};
#else
uniform ${y} ${b} u_${I};
#endif
`:V==="vec4"?`
#ifndef HAS_UNIFORM_u_${I}
    ${I} = a_${I};
#else
    ${y} ${b} ${I} = u_${I};
#endif
`:`
#ifndef HAS_UNIFORM_u_${I}
    ${I} = unpack_mix_${V}(a_${I}, u_${I}_t);
#else
    ${y} ${b} ${I} = u_${I};
#endif
`:f==="define"?`
#ifndef HAS_UNIFORM_u_${I}
uniform lowp float u_${I}_t;
attribute ${y} ${R} a_${I};
#else
uniform ${y} ${b} u_${I};
#endif
`:V==="vec4"?`
#ifndef HAS_UNIFORM_u_${I}
    ${y} ${b} ${I} = a_${I};
#else
    ${y} ${b} ${I} = u_${I};
#endif
`:`
#ifndef HAS_UNIFORM_u_${I}
    ${y} ${b} ${I} = unpack_mix_${V}(a_${I}, u_${I}_t);
#else
    ${y} ${b} ${I} = u_${I};
#endif
`}),staticAttributes:S,staticUniforms:Z}}class Ze{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(l,g,S,k,F,Z,u,h,f){this.context=l;let y=this.boundPaintVertexBuffers.length!==k.length;for(let b=0;!y&&b<k.length;b++)this.boundPaintVertexBuffers[b]!==k[b]&&(y=!0);!this.vao||this.boundProgram!==g||this.boundLayoutVertexBuffer!==S||y||this.boundIndexBuffer!==F||this.boundVertexOffset!==Z||this.boundDynamicVertexBuffer!==u||this.boundDynamicVertexBuffer2!==h||this.boundDynamicVertexBuffer3!==f?this.freshBind(g,S,k,F,Z,u,h,f):(l.bindVertexArray.set(this.vao),u&&u.bind(),F&&F.dynamicDraw&&F.bind(),h&&h.bind(),f&&f.bind())}freshBind(l,g,S,k,F,Z,u,h){const f=l.numAttributes,y=this.context,b=y.gl;this.vao&&this.destroy(),this.vao=y.createVertexArray(),y.bindVertexArray.set(this.vao),this.boundProgram=l,this.boundLayoutVertexBuffer=g,this.boundPaintVertexBuffers=S,this.boundIndexBuffer=k,this.boundVertexOffset=F,this.boundDynamicVertexBuffer=Z,this.boundDynamicVertexBuffer2=u,this.boundDynamicVertexBuffer3=h,g.enableAttributes(b,l);for(const I of S)I.enableAttributes(b,l);Z&&Z.enableAttributes(b,l),u&&u.enableAttributes(b,l),h&&h.enableAttributes(b,l),g.bind(),g.setVertexAttribPointers(b,l,F);for(const I of S)I.bind(),I.setVertexAttribPointers(b,l,F);Z&&(Z.bind(),Z.setVertexAttribPointers(b,l,F)),k&&k.bind(),u&&(u.bind(),u.setVertexAttribPointers(b,l,F)),h&&(h.bind(),h.setVertexAttribPointers(b,l,F)),y.currentNumAttributes=f}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function As(z){const l=[];for(let g=0;g<z.length;g++){if(z[g]===null)continue;const S=z[g].split(" ");l.push(S.pop())}return l}class Xl{constructor(l,g,S,k,F,Z){const u=l.gl;this.program=u.createProgram();const h=As(g.staticAttributes),f=S?S.getBinderAttributes():[],y=h.concat(f),b=nt.prelude.staticUniforms?As(nt.prelude.staticUniforms):[],I=g.staticUniforms?As(g.staticUniforms):[],R=S?S.getBinderUniforms():[],V=b.concat(I).concat(R),W=[];for(const qe of V)W.indexOf(qe)<0&&W.push(qe);const Y=S?S.defines():[];F&&Y.push("#define OVERDRAW_INSPECTOR;"),Z&&Y.push("#define TERRAIN3D;");const le=Y.concat(nt.prelude.fragmentSource,g.fragmentSource).join(`
`),fe=Y.concat(nt.prelude.vertexSource,g.vertexSource).join(`
`),ye=u.createShader(u.FRAGMENT_SHADER);if(u.isContextLost())return void(this.failedToCreate=!0);if(u.shaderSource(ye,le),u.compileShader(ye),!u.getShaderParameter(ye,u.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${u.getShaderInfoLog(ye)}`);u.attachShader(this.program,ye);const Ie=u.createShader(u.VERTEX_SHADER);if(u.isContextLost())return void(this.failedToCreate=!0);if(u.shaderSource(Ie,fe),u.compileShader(Ie),!u.getShaderParameter(Ie,u.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${u.getShaderInfoLog(Ie)}`);u.attachShader(this.program,Ie),this.attributes={};const ke={};this.numAttributes=y.length;for(let qe=0;qe<this.numAttributes;qe++)y[qe]&&(u.bindAttribLocation(this.program,qe,y[qe]),this.attributes[y[qe]]=qe);if(u.linkProgram(this.program),!u.getProgramParameter(this.program,u.LINK_STATUS))throw new Error(`Program failed to link: ${u.getProgramInfoLog(this.program)}`);u.deleteShader(Ie),u.deleteShader(ye);for(let qe=0;qe<W.length;qe++){const ut=W[qe];if(ut&&!ke[ut]){const mt=u.getUniformLocation(this.program,ut);mt&&(ke[ut]=mt)}}this.fixedUniforms=k(l,ke),this.terrainUniforms=((qe,ut)=>({u_depth:new P.aL(qe,ut.u_depth),u_terrain:new P.aL(qe,ut.u_terrain),u_terrain_dim:new P.aM(qe,ut.u_terrain_dim),u_terrain_matrix:new P.aN(qe,ut.u_terrain_matrix),u_terrain_unpack:new P.aO(qe,ut.u_terrain_unpack),u_terrain_exaggeration:new P.aM(qe,ut.u_terrain_exaggeration)}))(l,ke),this.binderUniforms=S?S.getUniforms(l,ke):[]}draw(l,g,S,k,F,Z,u,h,f,y,b,I,R,V,W,Y,le,fe){const ye=l.gl;if(this.failedToCreate)return;if(l.program.set(this.program),l.setDepthMode(S),l.setStencilMode(k),l.setColorMode(F),l.setCullFace(Z),h){l.activeTexture.set(ye.TEXTURE2),ye.bindTexture(ye.TEXTURE_2D,h.depthTexture),l.activeTexture.set(ye.TEXTURE3),ye.bindTexture(ye.TEXTURE_2D,h.texture);for(const ke in this.terrainUniforms)this.terrainUniforms[ke].set(h[ke])}for(const ke in this.fixedUniforms)this.fixedUniforms[ke].set(u[ke]);W&&W.setUniforms(l,this.binderUniforms,R,{zoom:V});let Ie=0;switch(g){case ye.LINES:Ie=2;break;case ye.TRIANGLES:Ie=3;break;case ye.LINE_STRIP:Ie=1}for(const ke of I.get()){const qe=ke.vaos||(ke.vaos={});(qe[f]||(qe[f]=new Ze)).bind(l,this,y,W?W.getPaintVertexBuffers():[],b,ke.vertexOffset,Y,le,fe),ye.drawElements(g,ke.primitiveLength*Ie,ye.UNSIGNED_SHORT,ke.primitiveOffset*Ie*2)}}}function ro(z,l,g){const S=1/Qe(g,1,l.transform.tileZoom),k=Math.pow(2,g.tileID.overscaledZ),F=g.tileSize*Math.pow(2,l.transform.tileZoom)/k,Z=F*(g.tileID.canonical.x+g.tileID.wrap*k),u=F*g.tileID.canonical.y;return{u_image:0,u_texsize:g.imageAtlasTexture.size,u_scale:[S,z.fromScale,z.toScale],u_fade:z.t,u_pixel_coord_upper:[Z>>16,u>>16],u_pixel_coord_lower:[65535&Z,65535&u]}}const WA=(z,l,g,S)=>{const k=l.style.light,F=k.properties.get("position"),Z=[F.x,F.y,F.z],u=function(){var f=new P.A(9);return P.A!=Float32Array&&(f[1]=0,f[2]=0,f[3]=0,f[5]=0,f[6]=0,f[7]=0),f[0]=1,f[4]=1,f[8]=1,f}();k.properties.get("anchor")==="viewport"&&function(f,y){var b=Math.sin(y),I=Math.cos(y);f[0]=I,f[1]=b,f[2]=0,f[3]=-b,f[4]=I,f[5]=0,f[6]=0,f[7]=0,f[8]=1}(u,-l.transform.angle),function(f,y,b){var I=y[0],R=y[1],V=y[2];f[0]=I*b[0]+R*b[3]+V*b[6],f[1]=I*b[1]+R*b[4]+V*b[7],f[2]=I*b[2]+R*b[5]+V*b[8]}(Z,Z,u);const h=k.properties.get("color");return{u_matrix:z,u_lightpos:Z,u_lightintensity:k.properties.get("intensity"),u_lightcolor:[h.r,h.g,h.b],u_vertical_gradient:+g,u_opacity:S}},Xi=(z,l,g,S,k,F,Z)=>P.e(WA(z,l,g,S),ro(F,l,Z),{u_height_factor:-Math.pow(2,k.overscaledZ)/Z.tileSize/8}),mn=z=>({u_matrix:z}),Qo=(z,l,g,S)=>P.e(mn(z),ro(g,l,S)),Fs=(z,l)=>({u_matrix:z,u_world:l}),Wn=(z,l,g,S,k)=>P.e(Qo(z,l,g,S),{u_world:k}),co=(z,l,g,S)=>{const k=z.transform;let F,Z;if(S.paint.get("circle-pitch-alignment")==="map"){const u=Qe(g,1,k.zoom);F=!0,Z=[u,u]}else F=!1,Z=k.pixelsToGLUnits;return{u_camera_to_center_distance:k.cameraToCenterDistance,u_scale_with_map:+(S.paint.get("circle-pitch-scale")==="map"),u_matrix:z.translatePosMatrix(l.posMatrix,g,S.paint.get("circle-translate"),S.paint.get("circle-translate-anchor")),u_pitch_with_map:+F,u_device_pixel_ratio:z.pixelRatio,u_extrude_scale:Z}},Ds=(z,l,g)=>{const S=Qe(g,1,l.zoom),k=Math.pow(2,l.zoom-g.tileID.overscaledZ),F=g.tileID.overscaleFactor();return{u_matrix:z,u_camera_to_center_distance:l.cameraToCenterDistance,u_pixels_to_tile_units:S,u_extrude_scale:[l.pixelsToGLUnits[0]/(S*k),l.pixelsToGLUnits[1]/(S*k)],u_overscale_factor:F}},Dl=(z,l,g=1)=>({u_matrix:z,u_color:l,u_overlay:0,u_overlay_scale:g}),$A=z=>({u_matrix:z}),XA=(z,l,g,S)=>({u_matrix:z,u_extrude_scale:Qe(l,1,g),u_intensity:S});function Pl(z,l){const g=Math.pow(2,l.canonical.z),S=l.canonical.y;return[new P.U(0,S/g).toLngLat().lat,new P.U(0,(S+1)/g).toLngLat().lat]}const uA=(z,l,g,S)=>{const k=z.transform;return{u_matrix:ei(z,l,g,S),u_ratio:1/Qe(l,1,k.zoom),u_device_pixel_ratio:z.pixelRatio,u_units_to_pixels:[1/k.pixelsToGLUnits[0],1/k.pixelsToGLUnits[1]]}},is=(z,l,g,S,k)=>P.e(uA(z,l,g,k),{u_image:0,u_image_height:S}),YA=(z,l,g,S,k)=>{const F=z.transform,Z=hA(l,F);return{u_matrix:ei(z,l,g,k),u_texsize:l.imageAtlasTexture.size,u_ratio:1/Qe(l,1,F.zoom),u_device_pixel_ratio:z.pixelRatio,u_image:0,u_scale:[Z,S.fromScale,S.toScale],u_fade:S.t,u_units_to_pixels:[1/F.pixelsToGLUnits[0],1/F.pixelsToGLUnits[1]]}},jn=(z,l,g,S,k,F)=>{const Z=z.lineAtlas,u=hA(l,z.transform),h=g.layout.get("line-cap")==="round",f=Z.getDash(S.from,h),y=Z.getDash(S.to,h),b=f.width*k.fromScale,I=y.width*k.toScale;return P.e(uA(z,l,g,F),{u_patternscale_a:[u/b,-f.height/2],u_patternscale_b:[u/I,-y.height/2],u_sdfgamma:Z.width/(256*Math.min(b,I)*z.pixelRatio)/2,u_image:0,u_tex_y_a:f.y,u_tex_y_b:y.y,u_mix:k.t})};function hA(z,l){return 1/Qe(z,1,l.tileZoom)}function ei(z,l,g,S){return z.translatePosMatrix(S?S.posMatrix:l.tileID.posMatrix,l,g.paint.get("line-translate"),g.paint.get("line-translate-anchor"))}const ir=(z,l,g,S,k)=>{return{u_matrix:z,u_tl_parent:l,u_scale_parent:g,u_buffer_scale:1,u_fade_t:S.mix,u_opacity:S.opacity*k.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:k.paint.get("raster-brightness-min"),u_brightness_high:k.paint.get("raster-brightness-max"),u_saturation_factor:(Z=k.paint.get("raster-saturation"),Z>0?1-1/(1.001-Z):-Z),u_contrast_factor:(F=k.paint.get("raster-contrast"),F>0?1/(1-F):1+F),u_spin_weights:rs(k.paint.get("raster-hue-rotate"))};var F,Z};function rs(z){z*=Math.PI/180;const l=Math.sin(z),g=Math.cos(z);return[(2*g+1)/3,(-Math.sqrt(3)*l-g+1)/3,(Math.sqrt(3)*l-g+1)/3]}const xt=(z,l,g,S,k,F,Z,u,h,f)=>{const y=k.transform;return{u_is_size_zoom_constant:+(z==="constant"||z==="source"),u_is_size_feature_constant:+(z==="constant"||z==="camera"),u_size_t:l?l.uSizeT:0,u_size:l?l.uSize:0,u_camera_to_center_distance:y.cameraToCenterDistance,u_pitch:y.pitch/360*2*Math.PI,u_rotate_symbol:+g,u_aspect_ratio:y.width/y.height,u_fade_change:k.options.fadeDuration?k.symbolFadeChange:1,u_matrix:F,u_label_plane_matrix:Z,u_coord_matrix:u,u_is_text:+h,u_pitch_with_map:+S,u_texsize:f,u_texture:0}},vi=(z,l,g,S,k,F,Z,u,h,f,y)=>{const b=k.transform;return P.e(xt(z,l,g,S,k,F,Z,u,h,f),{u_gamma_scale:S?Math.cos(b._pitch)*b.cameraToCenterDistance:1,u_device_pixel_ratio:k.pixelRatio,u_is_halo:+y})},Do=(z,l,g,S,k,F,Z,u,h,f)=>P.e(vi(z,l,g,S,k,F,Z,u,!0,h,!0),{u_texsize_icon:f,u_texture_icon:1}),Ho=(z,l,g)=>({u_matrix:z,u_opacity:l,u_color:g}),xn=(z,l,g,S,k,F)=>P.e(function(Z,u,h,f){const y=h.imageManager.getPattern(Z.from.toString()),b=h.imageManager.getPattern(Z.to.toString()),{width:I,height:R}=h.imageManager.getPixelSize(),V=Math.pow(2,f.tileID.overscaledZ),W=f.tileSize*Math.pow(2,h.transform.tileZoom)/V,Y=W*(f.tileID.canonical.x+f.tileID.wrap*V),le=W*f.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:y.tl,u_pattern_br_a:y.br,u_pattern_tl_b:b.tl,u_pattern_br_b:b.br,u_texsize:[I,R],u_mix:u.t,u_pattern_size_a:y.displaySize,u_pattern_size_b:b.displaySize,u_scale_a:u.fromScale,u_scale_b:u.toScale,u_tile_units_to_pixels:1/Qe(f,1,h.transform.tileZoom),u_pixel_coord_upper:[Y>>16,le>>16],u_pixel_coord_lower:[65535&Y,65535&le]}}(S,F,g,k),{u_matrix:z,u_opacity:l}),ta={fillExtrusion:(z,l)=>({u_matrix:new P.aN(z,l.u_matrix),u_lightpos:new P.aP(z,l.u_lightpos),u_lightintensity:new P.aM(z,l.u_lightintensity),u_lightcolor:new P.aP(z,l.u_lightcolor),u_vertical_gradient:new P.aM(z,l.u_vertical_gradient),u_opacity:new P.aM(z,l.u_opacity)}),fillExtrusionPattern:(z,l)=>({u_matrix:new P.aN(z,l.u_matrix),u_lightpos:new P.aP(z,l.u_lightpos),u_lightintensity:new P.aM(z,l.u_lightintensity),u_lightcolor:new P.aP(z,l.u_lightcolor),u_vertical_gradient:new P.aM(z,l.u_vertical_gradient),u_height_factor:new P.aM(z,l.u_height_factor),u_image:new P.aL(z,l.u_image),u_texsize:new P.aQ(z,l.u_texsize),u_pixel_coord_upper:new P.aQ(z,l.u_pixel_coord_upper),u_pixel_coord_lower:new P.aQ(z,l.u_pixel_coord_lower),u_scale:new P.aP(z,l.u_scale),u_fade:new P.aM(z,l.u_fade),u_opacity:new P.aM(z,l.u_opacity)}),fill:(z,l)=>({u_matrix:new P.aN(z,l.u_matrix)}),fillPattern:(z,l)=>({u_matrix:new P.aN(z,l.u_matrix),u_image:new P.aL(z,l.u_image),u_texsize:new P.aQ(z,l.u_texsize),u_pixel_coord_upper:new P.aQ(z,l.u_pixel_coord_upper),u_pixel_coord_lower:new P.aQ(z,l.u_pixel_coord_lower),u_scale:new P.aP(z,l.u_scale),u_fade:new P.aM(z,l.u_fade)}),fillOutline:(z,l)=>({u_matrix:new P.aN(z,l.u_matrix),u_world:new P.aQ(z,l.u_world)}),fillOutlinePattern:(z,l)=>({u_matrix:new P.aN(z,l.u_matrix),u_world:new P.aQ(z,l.u_world),u_image:new P.aL(z,l.u_image),u_texsize:new P.aQ(z,l.u_texsize),u_pixel_coord_upper:new P.aQ(z,l.u_pixel_coord_upper),u_pixel_coord_lower:new P.aQ(z,l.u_pixel_coord_lower),u_scale:new P.aP(z,l.u_scale),u_fade:new P.aM(z,l.u_fade)}),circle:(z,l)=>({u_camera_to_center_distance:new P.aM(z,l.u_camera_to_center_distance),u_scale_with_map:new P.aL(z,l.u_scale_with_map),u_pitch_with_map:new P.aL(z,l.u_pitch_with_map),u_extrude_scale:new P.aQ(z,l.u_extrude_scale),u_device_pixel_ratio:new P.aM(z,l.u_device_pixel_ratio),u_matrix:new P.aN(z,l.u_matrix)}),collisionBox:(z,l)=>({u_matrix:new P.aN(z,l.u_matrix),u_camera_to_center_distance:new P.aM(z,l.u_camera_to_center_distance),u_pixels_to_tile_units:new P.aM(z,l.u_pixels_to_tile_units),u_extrude_scale:new P.aQ(z,l.u_extrude_scale),u_overscale_factor:new P.aM(z,l.u_overscale_factor)}),collisionCircle:(z,l)=>({u_matrix:new P.aN(z,l.u_matrix),u_inv_matrix:new P.aN(z,l.u_inv_matrix),u_camera_to_center_distance:new P.aM(z,l.u_camera_to_center_distance),u_viewport_size:new P.aQ(z,l.u_viewport_size)}),debug:(z,l)=>({u_color:new P.aR(z,l.u_color),u_matrix:new P.aN(z,l.u_matrix),u_overlay:new P.aL(z,l.u_overlay),u_overlay_scale:new P.aM(z,l.u_overlay_scale)}),clippingMask:(z,l)=>({u_matrix:new P.aN(z,l.u_matrix)}),heatmap:(z,l)=>({u_extrude_scale:new P.aM(z,l.u_extrude_scale),u_intensity:new P.aM(z,l.u_intensity),u_matrix:new P.aN(z,l.u_matrix)}),heatmapTexture:(z,l)=>({u_matrix:new P.aN(z,l.u_matrix),u_world:new P.aQ(z,l.u_world),u_image:new P.aL(z,l.u_image),u_color_ramp:new P.aL(z,l.u_color_ramp),u_opacity:new P.aM(z,l.u_opacity)}),hillshade:(z,l)=>({u_matrix:new P.aN(z,l.u_matrix),u_image:new P.aL(z,l.u_image),u_latrange:new P.aQ(z,l.u_latrange),u_light:new P.aQ(z,l.u_light),u_shadow:new P.aR(z,l.u_shadow),u_highlight:new P.aR(z,l.u_highlight),u_accent:new P.aR(z,l.u_accent)}),hillshadePrepare:(z,l)=>({u_matrix:new P.aN(z,l.u_matrix),u_image:new P.aL(z,l.u_image),u_dimension:new P.aQ(z,l.u_dimension),u_zoom:new P.aM(z,l.u_zoom),u_unpack:new P.aO(z,l.u_unpack)}),line:(z,l)=>({u_matrix:new P.aN(z,l.u_matrix),u_ratio:new P.aM(z,l.u_ratio),u_device_pixel_ratio:new P.aM(z,l.u_device_pixel_ratio),u_units_to_pixels:new P.aQ(z,l.u_units_to_pixels)}),lineGradient:(z,l)=>({u_matrix:new P.aN(z,l.u_matrix),u_ratio:new P.aM(z,l.u_ratio),u_device_pixel_ratio:new P.aM(z,l.u_device_pixel_ratio),u_units_to_pixels:new P.aQ(z,l.u_units_to_pixels),u_image:new P.aL(z,l.u_image),u_image_height:new P.aM(z,l.u_image_height)}),linePattern:(z,l)=>({u_matrix:new P.aN(z,l.u_matrix),u_texsize:new P.aQ(z,l.u_texsize),u_ratio:new P.aM(z,l.u_ratio),u_device_pixel_ratio:new P.aM(z,l.u_device_pixel_ratio),u_image:new P.aL(z,l.u_image),u_units_to_pixels:new P.aQ(z,l.u_units_to_pixels),u_scale:new P.aP(z,l.u_scale),u_fade:new P.aM(z,l.u_fade)}),lineSDF:(z,l)=>({u_matrix:new P.aN(z,l.u_matrix),u_ratio:new P.aM(z,l.u_ratio),u_device_pixel_ratio:new P.aM(z,l.u_device_pixel_ratio),u_units_to_pixels:new P.aQ(z,l.u_units_to_pixels),u_patternscale_a:new P.aQ(z,l.u_patternscale_a),u_patternscale_b:new P.aQ(z,l.u_patternscale_b),u_sdfgamma:new P.aM(z,l.u_sdfgamma),u_image:new P.aL(z,l.u_image),u_tex_y_a:new P.aM(z,l.u_tex_y_a),u_tex_y_b:new P.aM(z,l.u_tex_y_b),u_mix:new P.aM(z,l.u_mix)}),raster:(z,l)=>({u_matrix:new P.aN(z,l.u_matrix),u_tl_parent:new P.aQ(z,l.u_tl_parent),u_scale_parent:new P.aM(z,l.u_scale_parent),u_buffer_scale:new P.aM(z,l.u_buffer_scale),u_fade_t:new P.aM(z,l.u_fade_t),u_opacity:new P.aM(z,l.u_opacity),u_image0:new P.aL(z,l.u_image0),u_image1:new P.aL(z,l.u_image1),u_brightness_low:new P.aM(z,l.u_brightness_low),u_brightness_high:new P.aM(z,l.u_brightness_high),u_saturation_factor:new P.aM(z,l.u_saturation_factor),u_contrast_factor:new P.aM(z,l.u_contrast_factor),u_spin_weights:new P.aP(z,l.u_spin_weights)}),symbolIcon:(z,l)=>({u_is_size_zoom_constant:new P.aL(z,l.u_is_size_zoom_constant),u_is_size_feature_constant:new P.aL(z,l.u_is_size_feature_constant),u_size_t:new P.aM(z,l.u_size_t),u_size:new P.aM(z,l.u_size),u_camera_to_center_distance:new P.aM(z,l.u_camera_to_center_distance),u_pitch:new P.aM(z,l.u_pitch),u_rotate_symbol:new P.aL(z,l.u_rotate_symbol),u_aspect_ratio:new P.aM(z,l.u_aspect_ratio),u_fade_change:new P.aM(z,l.u_fade_change),u_matrix:new P.aN(z,l.u_matrix),u_label_plane_matrix:new P.aN(z,l.u_label_plane_matrix),u_coord_matrix:new P.aN(z,l.u_coord_matrix),u_is_text:new P.aL(z,l.u_is_text),u_pitch_with_map:new P.aL(z,l.u_pitch_with_map),u_texsize:new P.aQ(z,l.u_texsize),u_texture:new P.aL(z,l.u_texture)}),symbolSDF:(z,l)=>({u_is_size_zoom_constant:new P.aL(z,l.u_is_size_zoom_constant),u_is_size_feature_constant:new P.aL(z,l.u_is_size_feature_constant),u_size_t:new P.aM(z,l.u_size_t),u_size:new P.aM(z,l.u_size),u_camera_to_center_distance:new P.aM(z,l.u_camera_to_center_distance),u_pitch:new P.aM(z,l.u_pitch),u_rotate_symbol:new P.aL(z,l.u_rotate_symbol),u_aspect_ratio:new P.aM(z,l.u_aspect_ratio),u_fade_change:new P.aM(z,l.u_fade_change),u_matrix:new P.aN(z,l.u_matrix),u_label_plane_matrix:new P.aN(z,l.u_label_plane_matrix),u_coord_matrix:new P.aN(z,l.u_coord_matrix),u_is_text:new P.aL(z,l.u_is_text),u_pitch_with_map:new P.aL(z,l.u_pitch_with_map),u_texsize:new P.aQ(z,l.u_texsize),u_texture:new P.aL(z,l.u_texture),u_gamma_scale:new P.aM(z,l.u_gamma_scale),u_device_pixel_ratio:new P.aM(z,l.u_device_pixel_ratio),u_is_halo:new P.aL(z,l.u_is_halo)}),symbolTextAndIcon:(z,l)=>({u_is_size_zoom_constant:new P.aL(z,l.u_is_size_zoom_constant),u_is_size_feature_constant:new P.aL(z,l.u_is_size_feature_constant),u_size_t:new P.aM(z,l.u_size_t),u_size:new P.aM(z,l.u_size),u_camera_to_center_distance:new P.aM(z,l.u_camera_to_center_distance),u_pitch:new P.aM(z,l.u_pitch),u_rotate_symbol:new P.aL(z,l.u_rotate_symbol),u_aspect_ratio:new P.aM(z,l.u_aspect_ratio),u_fade_change:new P.aM(z,l.u_fade_change),u_matrix:new P.aN(z,l.u_matrix),u_label_plane_matrix:new P.aN(z,l.u_label_plane_matrix),u_coord_matrix:new P.aN(z,l.u_coord_matrix),u_is_text:new P.aL(z,l.u_is_text),u_pitch_with_map:new P.aL(z,l.u_pitch_with_map),u_texsize:new P.aQ(z,l.u_texsize),u_texsize_icon:new P.aQ(z,l.u_texsize_icon),u_texture:new P.aL(z,l.u_texture),u_texture_icon:new P.aL(z,l.u_texture_icon),u_gamma_scale:new P.aM(z,l.u_gamma_scale),u_device_pixel_ratio:new P.aM(z,l.u_device_pixel_ratio),u_is_halo:new P.aL(z,l.u_is_halo)}),background:(z,l)=>({u_matrix:new P.aN(z,l.u_matrix),u_opacity:new P.aM(z,l.u_opacity),u_color:new P.aR(z,l.u_color)}),backgroundPattern:(z,l)=>({u_matrix:new P.aN(z,l.u_matrix),u_opacity:new P.aM(z,l.u_opacity),u_image:new P.aL(z,l.u_image),u_pattern_tl_a:new P.aQ(z,l.u_pattern_tl_a),u_pattern_br_a:new P.aQ(z,l.u_pattern_br_a),u_pattern_tl_b:new P.aQ(z,l.u_pattern_tl_b),u_pattern_br_b:new P.aQ(z,l.u_pattern_br_b),u_texsize:new P.aQ(z,l.u_texsize),u_mix:new P.aM(z,l.u_mix),u_pattern_size_a:new P.aQ(z,l.u_pattern_size_a),u_pattern_size_b:new P.aQ(z,l.u_pattern_size_b),u_scale_a:new P.aM(z,l.u_scale_a),u_scale_b:new P.aM(z,l.u_scale_b),u_pixel_coord_upper:new P.aQ(z,l.u_pixel_coord_upper),u_pixel_coord_lower:new P.aQ(z,l.u_pixel_coord_lower),u_tile_units_to_pixels:new P.aM(z,l.u_tile_units_to_pixels)}),terrain:(z,l)=>({u_matrix:new P.aN(z,l.u_matrix),u_texture:new P.aL(z,l.u_texture),u_ele_delta:new P.aM(z,l.u_ele_delta)}),terrainDepth:(z,l)=>({u_matrix:new P.aN(z,l.u_matrix),u_ele_delta:new P.aM(z,l.u_ele_delta)}),terrainCoords:(z,l)=>({u_matrix:new P.aN(z,l.u_matrix),u_texture:new P.aL(z,l.u_texture),u_terrain_coords_id:new P.aM(z,l.u_terrain_coords_id),u_ele_delta:new P.aM(z,l.u_ele_delta)})};class Yl{constructor(l,g,S){this.context=l;const k=l.gl;this.buffer=k.createBuffer(),this.dynamicDraw=!!S,this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),k.bufferData(k.ELEMENT_ARRAY_BUFFER,g.arrayBuffer,this.dynamicDraw?k.DYNAMIC_DRAW:k.STATIC_DRAW),this.dynamicDraw||delete g.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(l){const g=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),g.bufferSubData(g.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Po={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Kl{constructor(l,g,S,k){this.length=g.length,this.attributes=S,this.itemSize=g.bytesPerElement,this.dynamicDraw=k,this.context=l;const F=l.gl;this.buffer=F.createBuffer(),l.bindVertexBuffer.set(this.buffer),F.bufferData(F.ARRAY_BUFFER,g.arrayBuffer,this.dynamicDraw?F.DYNAMIC_DRAW:F.STATIC_DRAW),this.dynamicDraw||delete g.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(l){if(l.length!==this.length)throw new Error(`Length of new data is ${l.length}, which doesn't match current length of ${this.length}`);const g=this.context.gl;this.bind(),g.bufferSubData(g.ARRAY_BUFFER,0,l.arrayBuffer)}enableAttributes(l,g){for(let S=0;S<this.attributes.length;S++){const k=g.attributes[this.attributes[S].name];k!==void 0&&l.enableVertexAttribArray(k)}}setVertexAttribPointers(l,g,S){for(let k=0;k<this.attributes.length;k++){const F=this.attributes[k],Z=g.attributes[F.name];Z!==void 0&&l.vertexAttribPointer(Z,F.components,l[Po[F.type]],!1,this.itemSize,F.offset+this.itemSize*(S||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const dA=new WeakMap;function $n(z){var l;if(dA.has(z))return dA.get(z);{const g=(l=z.getParameter(z.VERSION))===null||l===void 0?void 0:l.startsWith("WebGL 2.0");return dA.set(z,g),g}}class Ht{constructor(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(l){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ji extends Ht{getDefault(){return P.aT.transparent}set(l){const g=this.current;(l.r!==g.r||l.g!==g.g||l.b!==g.b||l.a!==g.a||this.dirty)&&(this.gl.clearColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class ar extends Ht{getDefault(){return 1}set(l){(l!==this.current||this.dirty)&&(this.gl.clearDepth(l),this.current=l,this.dirty=!1)}}class sn extends Ht{getDefault(){return 0}set(l){(l!==this.current||this.dirty)&&(this.gl.clearStencil(l),this.current=l,this.dirty=!1)}}class ia extends Ht{getDefault(){return[!0,!0,!0,!0]}set(l){const g=this.current;(l[0]!==g[0]||l[1]!==g[1]||l[2]!==g[2]||l[3]!==g[3]||this.dirty)&&(this.gl.colorMask(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class Pr extends Ht{getDefault(){return!0}set(l){(l!==this.current||this.dirty)&&(this.gl.depthMask(l),this.current=l,this.dirty=!1)}}class ma extends Ht{getDefault(){return 255}set(l){(l!==this.current||this.dirty)&&(this.gl.stencilMask(l),this.current=l,this.dirty=!1)}}class Ja extends Ht{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(l){const g=this.current;(l.func!==g.func||l.ref!==g.ref||l.mask!==g.mask||this.dirty)&&(this.gl.stencilFunc(l.func,l.ref,l.mask),this.current=l,this.dirty=!1)}}class ra extends Ht{getDefault(){const l=this.gl;return[l.KEEP,l.KEEP,l.KEEP]}set(l){const g=this.current;(l[0]!==g[0]||l[1]!==g[1]||l[2]!==g[2]||this.dirty)&&(this.gl.stencilOp(l[0],l[1],l[2]),this.current=l,this.dirty=!1)}}class no extends Ht{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const g=this.gl;l?g.enable(g.STENCIL_TEST):g.disable(g.STENCIL_TEST),this.current=l,this.dirty=!1}}class Xn extends Ht{getDefault(){return[0,1]}set(l){const g=this.current;(l[0]!==g[0]||l[1]!==g[1]||this.dirty)&&(this.gl.depthRange(l[0],l[1]),this.current=l,this.dirty=!1)}}class fl extends Ht{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const g=this.gl;l?g.enable(g.DEPTH_TEST):g.disable(g.DEPTH_TEST),this.current=l,this.dirty=!1}}class Os extends Ht{getDefault(){return this.gl.LESS}set(l){(l!==this.current||this.dirty)&&(this.gl.depthFunc(l),this.current=l,this.dirty=!1)}}class _a extends Ht{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const g=this.gl;l?g.enable(g.BLEND):g.disable(g.BLEND),this.current=l,this.dirty=!1}}class zl extends Ht{getDefault(){const l=this.gl;return[l.ONE,l.ZERO]}set(l){const g=this.current;(l[0]!==g[0]||l[1]!==g[1]||this.dirty)&&(this.gl.blendFunc(l[0],l[1]),this.current=l,this.dirty=!1)}}class ga extends Ht{getDefault(){return P.aT.transparent}set(l){const g=this.current;(l.r!==g.r||l.g!==g.g||l.b!==g.b||l.a!==g.a||this.dirty)&&(this.gl.blendColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class el extends Ht{getDefault(){return this.gl.FUNC_ADD}set(l){(l!==this.current||this.dirty)&&(this.gl.blendEquation(l),this.current=l,this.dirty=!1)}}class Fa extends Ht{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const g=this.gl;l?g.enable(g.CULL_FACE):g.disable(g.CULL_FACE),this.current=l,this.dirty=!1}}class KA extends Ht{getDefault(){return this.gl.BACK}set(l){(l!==this.current||this.dirty)&&(this.gl.cullFace(l),this.current=l,this.dirty=!1)}}class fA extends Ht{getDefault(){return this.gl.CCW}set(l){(l!==this.current||this.dirty)&&(this.gl.frontFace(l),this.current=l,this.dirty=!1)}}class PA extends Ht{getDefault(){return null}set(l){(l!==this.current||this.dirty)&&(this.gl.useProgram(l),this.current=l,this.dirty=!1)}}class Wo extends Ht{getDefault(){return this.gl.TEXTURE0}set(l){(l!==this.current||this.dirty)&&(this.gl.activeTexture(l),this.current=l,this.dirty=!1)}}class pr extends Ht{getDefault(){const l=this.gl;return[0,0,l.drawingBufferWidth,l.drawingBufferHeight]}set(l){const g=this.current;(l[0]!==g[0]||l[1]!==g[1]||l[2]!==g[2]||l[3]!==g[3]||this.dirty)&&(this.gl.viewport(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class Oa extends Ht{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const g=this.gl;g.bindFramebuffer(g.FRAMEBUFFER,l),this.current=l,this.dirty=!1}}class zA extends Ht{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const g=this.gl;g.bindRenderbuffer(g.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class uo extends Ht{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const g=this.gl;g.bindTexture(g.TEXTURE_2D,l),this.current=l,this.dirty=!1}}class so extends Ht{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const g=this.gl;g.bindBuffer(g.ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class Bl extends Ht{getDefault(){return null}set(l){const g=this.gl;g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class Jl extends Ht{getDefault(){return null}set(l){var g;if(l===this.current&&!this.dirty)return;const S=this.gl;$n(S)?S.bindVertexArray(l):(g=S.getExtension("OES_vertex_array_object"))===null||g===void 0||g.bindVertexArrayOES(l),this.current=l,this.dirty=!1}}class hs extends Ht{getDefault(){return 4}set(l){if(l===this.current&&!this.dirty)return;const g=this.gl;g.pixelStorei(g.UNPACK_ALIGNMENT,l),this.current=l,this.dirty=!1}}class ya extends Ht{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const g=this.gl;g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,l),this.current=l,this.dirty=!1}}class Ll extends Ht{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const g=this.gl;g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,l),this.current=l,this.dirty=!1}}class Vs extends Ht{constructor(l,g){super(l),this.context=l,this.parent=g}getDefault(){return null}}class cs extends Vs{setDirty(){this.dirty=!0}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const g=this.gl;g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,l,0),this.current=l,this.dirty=!1}}class Rl extends Vs{set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const g=this.gl;g.framebufferRenderbuffer(g.FRAMEBUFFER,g.DEPTH_ATTACHMENT,g.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class BA extends Vs{set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const g=this.gl;g.framebufferRenderbuffer(g.FRAMEBUFFER,g.DEPTH_STENCIL_ATTACHMENT,g.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class Gr{constructor(l,g,S,k,F){this.context=l,this.width=g,this.height=S;const Z=l.gl,u=this.framebuffer=Z.createFramebuffer();if(this.colorAttachment=new cs(l,u),k)this.depthAttachment=F?new BA(l,u):new Rl(l,u);else if(F)throw new Error("Stencil cannot be setted without depth");if(Z.checkFramebufferStatus(Z.FRAMEBUFFER)!==Z.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const l=this.context.gl,g=this.colorAttachment.get();if(g&&l.deleteTexture(g),this.depthAttachment){const S=this.depthAttachment.get();S&&l.deleteRenderbuffer(S)}l.deleteFramebuffer(this.framebuffer)}}class Yn{constructor(l,g,S){this.blendFunction=l,this.blendColor=g,this.mask=S}}Yn.Replace=[1,0],Yn.disabled=new Yn(Yn.Replace,P.aT.transparent,[!1,!1,!1,!1]),Yn.unblended=new Yn(Yn.Replace,P.aT.transparent,[!0,!0,!0,!0]),Yn.alphaBlended=new Yn([1,771],P.aT.transparent,[!0,!0,!0,!0]);class eA{constructor(l){var g,S;if(this.gl=l,this.clearColor=new ji(this),this.clearDepth=new ar(this),this.clearStencil=new sn(this),this.colorMask=new ia(this),this.depthMask=new Pr(this),this.stencilMask=new ma(this),this.stencilFunc=new Ja(this),this.stencilOp=new ra(this),this.stencilTest=new no(this),this.depthRange=new Xn(this),this.depthTest=new fl(this),this.depthFunc=new Os(this),this.blend=new _a(this),this.blendFunc=new zl(this),this.blendColor=new ga(this),this.blendEquation=new el(this),this.cullFace=new Fa(this),this.cullFaceSide=new KA(this),this.frontFace=new fA(this),this.program=new PA(this),this.activeTexture=new Wo(this),this.viewport=new pr(this),this.bindFramebuffer=new Oa(this),this.bindRenderbuffer=new zA(this),this.bindTexture=new uo(this),this.bindVertexBuffer=new so(this),this.bindElementBuffer=new Bl(this),this.bindVertexArray=new Jl(this),this.pixelStoreUnpack=new hs(this),this.pixelStoreUnpackPremultiplyAlpha=new ya(this),this.pixelStoreUnpackFlipY=new Ll(this),this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE),$n(l)){this.HALF_FLOAT=l.HALF_FLOAT;const k=l.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(g=l.RGBA16F)!==null&&g!==void 0?g:k==null?void 0:k.RGBA16F_EXT,this.RGB16F=(S=l.RGB16F)!==null&&S!==void 0?S:k==null?void 0:k.RGB16F_EXT,l.getExtension("EXT_color_buffer_float")}else{l.getExtension("EXT_color_buffer_half_float"),l.getExtension("OES_texture_half_float_linear");const k=l.getExtension("OES_texture_half_float");this.HALF_FLOAT=k==null?void 0:k.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(l,g){return new Yl(this,l,g)}createVertexBuffer(l,g,S){return new Kl(this,l,g,S)}createRenderbuffer(l,g,S){const k=this.gl,F=k.createRenderbuffer();return this.bindRenderbuffer.set(F),k.renderbufferStorage(k.RENDERBUFFER,l,g,S),this.bindRenderbuffer.set(null),F}createFramebuffer(l,g,S,k){return new Gr(this,l,g,S,k)}clear({color:l,depth:g,stencil:S}){const k=this.gl;let F=0;l&&(F|=k.COLOR_BUFFER_BIT,this.clearColor.set(l),this.colorMask.set([!0,!0,!0,!0])),g!==void 0&&(F|=k.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(g),this.depthMask.set(!0)),S!==void 0&&(F|=k.STENCIL_BUFFER_BIT,this.clearStencil.set(S),this.stencilMask.set(255)),k.clear(F)}setCullFace(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))}setDepthMode(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)}setStencilMode(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)}setColorMode(l){P.aG(l.blendFunction,Yn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor)),this.colorMask.set(l.mask)}createVertexArray(){var l;return $n(this.gl)?this.gl.createVertexArray():(l=this.gl.getExtension("OES_vertex_array_object"))===null||l===void 0?void 0:l.createVertexArrayOES()}deleteVertexArray(l){var g;return $n(this.gl)?this.gl.deleteVertexArray(l):(g=this.gl.getExtension("OES_vertex_array_object"))===null||g===void 0?void 0:g.deleteVertexArrayOES(l)}unbindVAO(){this.bindVertexArray.set(null)}}class Gi{constructor(l,g,S){this.func=l,this.mask=g,this.range=S}}Gi.ReadOnly=!1,Gi.ReadWrite=!0,Gi.disabled=new Gi(519,Gi.ReadOnly,[0,1]);const xa=7680;class ns{constructor(l,g,S,k,F,Z){this.test=l,this.ref=g,this.mask=S,this.fail=k,this.depthFail=F,this.pass=Z}}ns.disabled=new ns({func:519,mask:0},0,0,xa,xa,xa);class Tn{constructor(l,g,S){this.enable=l,this.mode=g,this.frontFace=S}}let Va;function Tc(z,l,g,S,k,F,Z){const u=z.context,h=u.gl,f=z.useProgram("collisionBox"),y=[];let b=0,I=0;for(let ye=0;ye<S.length;ye++){const Ie=S[ye],ke=l.getTile(Ie),qe=ke.getBucket(g);if(!qe)continue;let ut=Ie.posMatrix;k[0]===0&&k[1]===0||(ut=z.translatePosMatrix(Ie.posMatrix,ke,k,F));const mt=Z?qe.textCollisionBox:qe.iconCollisionBox,st=qe.collisionCircleArray;if(st.length>0){const ht=P.Z(),ft=ut;P.aU(ht,qe.placementInvProjMatrix,z.transform.glCoordMatrix),P.aU(ht,ht,qe.placementViewportMatrix),y.push({circleArray:st,circleOffset:I,transform:ft,invTransform:ht,coord:Ie}),b+=st.length/4,I=b}mt&&f.draw(u,h.LINES,Gi.disabled,ns.disabled,z.colorModeForRenderPass(),Tn.disabled,Ds(ut,z.transform,ke),z.style.map.terrain&&z.style.map.terrain.getTerrainData(Ie),g.id,mt.layoutVertexBuffer,mt.indexBuffer,mt.segments,null,z.transform.zoom,null,null,mt.collisionVertexBuffer)}if(!Z||!y.length)return;const R=z.useProgram("collisionCircle"),V=new P.aV;V.resize(4*b),V._trim();let W=0;for(const ye of y)for(let Ie=0;Ie<ye.circleArray.length/4;Ie++){const ke=4*Ie,qe=ye.circleArray[ke+0],ut=ye.circleArray[ke+1],mt=ye.circleArray[ke+2],st=ye.circleArray[ke+3];V.emplace(W++,qe,ut,mt,st,0),V.emplace(W++,qe,ut,mt,st,1),V.emplace(W++,qe,ut,mt,st,2),V.emplace(W++,qe,ut,mt,st,3)}(!Va||Va.length<2*b)&&(Va=function(ye){const Ie=2*ye,ke=new P.aX;ke.resize(Ie),ke._trim();for(let qe=0;qe<Ie;qe++){const ut=6*qe;ke.uint16[ut+0]=4*qe+0,ke.uint16[ut+1]=4*qe+1,ke.uint16[ut+2]=4*qe+2,ke.uint16[ut+3]=4*qe+2,ke.uint16[ut+4]=4*qe+3,ke.uint16[ut+5]=4*qe+0}return ke}(b));const Y=u.createIndexBuffer(Va,!0),le=u.createVertexBuffer(V,P.aW.members,!0);for(const ye of y){const Ie={u_matrix:ye.transform,u_inv_matrix:ye.invTransform,u_camera_to_center_distance:(fe=z.transform).cameraToCenterDistance,u_viewport_size:[fe.width,fe.height]};R.draw(u,h.TRIANGLES,Gi.disabled,ns.disabled,z.colorModeForRenderPass(),Tn.disabled,Ie,z.style.map.terrain&&z.style.map.terrain.getTerrainData(ye.coord),g.id,le,Y,P.S.simpleSegment(0,2*ye.circleOffset,ye.circleArray.length,ye.circleArray.length/2),null,z.transform.zoom,null,null,null)}var fe;le.destroy(),Y.destroy()}Tn.disabled=new Tn(!1,1029,2305),Tn.backCCW=new Tn(!0,1029,2305);const tl=P.ao(new Float32Array(16));function pA(z,l,g,S,k,F){const{horizontalAlign:Z,verticalAlign:u}=P.au(z);return new P.P((-(Z-.5)*l/k+S[0])*F,(-(u-.5)*g/k+S[1])*F)}function zo(z,l,g,S,k,F,Z,u,h,f,y){const b=z.text.placedSymbolArray,I=z.text.dynamicLayoutVertexArray,R=z.icon.dynamicLayoutVertexArray,V={};I.clear();for(let W=0;W<b.length;W++){const Y=b.get(W),le=Y.hidden||!Y.crossTileID||z.allowVerticalPlacement&&!Y.placedOrientation?null:S[Y.crossTileID];if(le){const fe=new P.P(Y.anchorX,Y.anchorY),ye=vr(fe,g?Z:F,y),Ie=ys(k.cameraToCenterDistance,ye.signedDistanceFromCamera);let ke=P.aj(z.textSizeData,h,Y)*Ie/P.ap;g&&(ke*=z.tilePixelRatio/u);const{width:qe,height:ut,anchor:mt,textOffset:st,textBoxScale:ht}=le,ft=pA(mt,qe,ut,st,ht,ke),Ai=g?vr(fe.add(ft),F,y).point:ye.point.add(l?ft.rotate(-k.angle):ft),Nt=z.allowVerticalPlacement&&Y.placedOrientation===P.ai.vertical?Math.PI/2:0;for(let Wt=0;Wt<Y.numGlyphs;Wt++)P.ak(I,Ai,Nt);f&&Y.associatedIconIndex>=0&&(V[Y.associatedIconIndex]={shiftedAnchor:Ai,angle:Nt})}else Te(Y.numGlyphs,I)}if(f){R.clear();const W=z.icon.placedSymbolArray;for(let Y=0;Y<W.length;Y++){const le=W.get(Y);if(le.hidden)Te(le.numGlyphs,R);else{const fe=V[Y];if(fe)for(let ye=0;ye<le.numGlyphs;ye++)P.ak(R,fe.shiftedAnchor,fe.angle);else Te(le.numGlyphs,R)}}z.icon.dynamicLayoutVertexBuffer.updateData(R)}z.text.dynamicLayoutVertexBuffer.updateData(I)}function pl(z,l,g){return g.iconsInText&&l?"symbolTextAndIcon":z?"symbolSDF":"symbolIcon"}function Ln(z,l,g,S,k,F,Z,u,h,f,y,b){const I=z.context,R=I.gl,V=z.transform,W=u==="map",Y=h==="map",le=u!=="viewport"&&g.layout.get("symbol-placement")!=="point",fe=W&&!Y&&!le,ye=!g.layout.get("symbol-sort-key").isConstant();let Ie=!1;const ke=z.depthModeForSublayer(0,Gi.ReadOnly),qe=g._unevaluatedLayout.hasValue("text-variable-anchor")||g._unevaluatedLayout.hasValue("text-variable-anchor-offset"),ut=[];for(const mt of S){const st=l.getTile(mt),ht=st.getBucket(g);if(!ht)continue;const ft=k?ht.text:ht.icon;if(!ft||!ft.segments.get().length||!ft.hasVisibleVertices)continue;const Ai=ft.programConfigurations.get(g.id),Nt=k||ht.sdfIcons,Wt=k?ht.textSizeData:ht.iconSizeData,Gt=Y||V.pitch!==0,lr=z.useProgram(pl(Nt,k,ht),Ai),Hi=P.ah(Wt,V.zoom),Zi=z.style.map.terrain&&z.style.map.terrain.getTerrainData(mt);let Fi,sr,er,Nr,Yi=[0,0],Rr=null;if(k)sr=st.glyphAtlasTexture,er=R.LINEAR,Fi=st.glyphAtlasTexture.size,ht.iconsInText&&(Yi=st.imageAtlasTexture.size,Rr=st.imageAtlasTexture,Nr=Gt||z.options.rotating||z.options.zooming||Wt.kind==="composite"||Wt.kind==="camera"?R.LINEAR:R.NEAREST);else{const Us=g.layout.get("icon-size").constantOr(0)!==1||ht.iconsNeedLinear;sr=st.imageAtlasTexture,er=Nt||z.options.rotating||z.options.zooming||Us||Gt?R.LINEAR:R.NEAREST,Fi=st.imageAtlasTexture.size}const kn=Qe(st,1,z.transform.zoom),Kn=oi(mt.posMatrix,Y,W,z.transform,kn),bl=gn(mt.posMatrix,Y,W,z.transform,kn),wl=qe&&ht.hasTextData(),Fo=g.layout.get("icon-text-fit")!=="none"&&wl&&ht.hasIconData();if(le){const Us=z.style.map.terrain?(qa,Xs)=>z.style.map.terrain.getElevation(mt,qa,Xs):null,ao=g.layout.get("text-rotation-alignment")==="map";gi(ht,mt.posMatrix,z,k,Kn,bl,Y,f,ao,Us)}const Ac=z.translatePosMatrix(mt.posMatrix,st,F,Z),Sc=le||k&&qe||Fo?tl:Kn,Aa=z.translatePosMatrix(bl,st,F,Z,!0),$s=Nt&&g.paint.get(k?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Ma;Ma=Nt?ht.iconsInText?Do(Wt.kind,Hi,fe,Y,z,Ac,Sc,Aa,Fi,Yi):vi(Wt.kind,Hi,fe,Y,z,Ac,Sc,Aa,k,Fi,!0):xt(Wt.kind,Hi,fe,Y,z,Ac,Sc,Aa,k,Fi);const yA={program:lr,buffers:ft,uniformValues:Ma,atlasTexture:sr,atlasTextureIcon:Rr,atlasInterpolation:er,atlasInterpolationIcon:Nr,isSDF:Nt,hasHalo:$s};if(ye&&ht.canOverlap){Ie=!0;const Us=ft.segments.get();for(const ao of Us)ut.push({segments:new P.S([ao]),sortKey:ao.sortKey,state:yA,terrainData:Zi})}else ut.push({segments:ft.segments,sortKey:0,state:yA,terrainData:Zi})}Ie&&ut.sort((mt,st)=>mt.sortKey-st.sortKey);for(const mt of ut){const st=mt.state;if(I.activeTexture.set(R.TEXTURE0),st.atlasTexture.bind(st.atlasInterpolation,R.CLAMP_TO_EDGE),st.atlasTextureIcon&&(I.activeTexture.set(R.TEXTURE1),st.atlasTextureIcon&&st.atlasTextureIcon.bind(st.atlasInterpolationIcon,R.CLAMP_TO_EDGE)),st.isSDF){const ht=st.uniformValues;st.hasHalo&&(ht.u_is_halo=1,Ec(st.buffers,mt.segments,g,z,st.program,ke,y,b,ht,mt.terrainData)),ht.u_is_halo=0}Ec(st.buffers,mt.segments,g,z,st.program,ke,y,b,st.uniformValues,mt.terrainData)}}function Ec(z,l,g,S,k,F,Z,u,h,f){const y=S.context;k.draw(y,y.gl.TRIANGLES,F,Z,u,Tn.disabled,h,f,g.id,z.layoutVertexBuffer,z.indexBuffer,l,g.paint,S.transform.zoom,z.programConfigurations.get(g.id),z.dynamicLayoutVertexBuffer,z.opacityVertexBuffer)}function mA(z,l,g,S,k){if(!g||!S||!S.imageAtlas)return;const F=S.imageAtlas.patternPositions;let Z=F[g.to.toString()],u=F[g.from.toString()];if(!Z&&u&&(Z=u),!u&&Z&&(u=Z),!Z||!u){const h=k.getPaintProperty(l);Z=F[h],u=F[h]}Z&&u&&z.setConstantPatternPositions(Z,u)}function il(z,l,g,S,k,F,Z){const u=z.context.gl,h="fill-pattern",f=g.paint.get(h),y=f&&f.constantOr(1),b=g.getCrossfadeParameters();let I,R,V,W,Y;Z?(R=y&&!g.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",I=u.LINES):(R=y?"fillPattern":"fill",I=u.TRIANGLES);const le=f.constantOr(null);for(const fe of S){const ye=l.getTile(fe);if(y&&!ye.patternsLoaded())continue;const Ie=ye.getBucket(g);if(!Ie)continue;const ke=Ie.programConfigurations.get(g.id),qe=z.useProgram(R,ke),ut=z.style.map.terrain&&z.style.map.terrain.getTerrainData(fe);y&&(z.context.activeTexture.set(u.TEXTURE0),ye.imageAtlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),ke.updatePaintBuffers(b)),mA(ke,h,le,ye,g);const mt=ut?fe:null,st=z.translatePosMatrix(mt?mt.posMatrix:fe.posMatrix,ye,g.paint.get("fill-translate"),g.paint.get("fill-translate-anchor"));if(Z){W=Ie.indexBuffer2,Y=Ie.segments2;const ht=[u.drawingBufferWidth,u.drawingBufferHeight];V=R==="fillOutlinePattern"&&y?Wn(st,z,b,ye,ht):Fs(st,ht)}else W=Ie.indexBuffer,Y=Ie.segments,V=y?Qo(st,z,b,ye):mn(st);qe.draw(z.context,I,k,z.stencilModeForClipping(fe),F,Tn.disabled,V,ut,g.id,Ie.layoutVertexBuffer,W,Y,g.paint,z.transform.zoom,ke)}}function Na(z,l,g,S,k,F,Z){const u=z.context,h=u.gl,f="fill-extrusion-pattern",y=g.paint.get(f),b=y.constantOr(1),I=g.getCrossfadeParameters(),R=g.paint.get("fill-extrusion-opacity"),V=y.constantOr(null);for(const W of S){const Y=l.getTile(W),le=Y.getBucket(g);if(!le)continue;const fe=z.style.map.terrain&&z.style.map.terrain.getTerrainData(W),ye=le.programConfigurations.get(g.id),Ie=z.useProgram(b?"fillExtrusionPattern":"fillExtrusion",ye);b&&(z.context.activeTexture.set(h.TEXTURE0),Y.imageAtlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE),ye.updatePaintBuffers(I)),mA(ye,f,V,Y,g);const ke=z.translatePosMatrix(W.posMatrix,Y,g.paint.get("fill-extrusion-translate"),g.paint.get("fill-extrusion-translate-anchor")),qe=g.paint.get("fill-extrusion-vertical-gradient"),ut=b?Xi(ke,z,qe,R,W,I,Y):WA(ke,z,qe,R);Ie.draw(u,u.gl.TRIANGLES,k,F,Z,Tn.backCCW,ut,fe,g.id,le.layoutVertexBuffer,le.indexBuffer,le.segments,g.paint,z.transform.zoom,ye,z.style.map.terrain&&le.centroidVertexBuffer)}}function xu(z,l,g,S,k,F,Z){const u=z.context,h=u.gl,f=g.fbo;if(!f)return;const y=z.useProgram("hillshade"),b=z.style.map.terrain&&z.style.map.terrain.getTerrainData(l);u.activeTexture.set(h.TEXTURE0),h.bindTexture(h.TEXTURE_2D,f.colorAttachment.get()),y.draw(u,h.TRIANGLES,k,F,Z,Tn.disabled,((I,R,V,W)=>{const Y=V.paint.get("hillshade-shadow-color"),le=V.paint.get("hillshade-highlight-color"),fe=V.paint.get("hillshade-accent-color");let ye=V.paint.get("hillshade-illumination-direction")*(Math.PI/180);V.paint.get("hillshade-illumination-anchor")==="viewport"&&(ye-=I.transform.angle);const Ie=!I.options.moving;return{u_matrix:W?W.posMatrix:I.transform.calculatePosMatrix(R.tileID.toUnwrapped(),Ie),u_image:0,u_latrange:Pl(0,R.tileID),u_light:[V.paint.get("hillshade-exaggeration"),ye],u_shadow:Y,u_highlight:le,u_accent:fe}})(z,g,S,b?l:null),b,S.id,z.rasterBoundsBuffer,z.quadTriangleIndexBuffer,z.rasterBoundsSegments)}function Ps(z,l,g,S,k,F){const Z=z.context,u=Z.gl,h=l.dem;if(h&&h.data){const f=h.dim,y=h.stride,b=h.getPixels();if(Z.activeTexture.set(u.TEXTURE1),Z.pixelStoreUnpackPremultiplyAlpha.set(!1),l.demTexture=l.demTexture||z.getTileTexture(y),l.demTexture){const R=l.demTexture;R.update(b,{premultiply:!1}),R.bind(u.NEAREST,u.CLAMP_TO_EDGE)}else l.demTexture=new At(Z,b,u.RGBA,{premultiply:!1}),l.demTexture.bind(u.NEAREST,u.CLAMP_TO_EDGE);Z.activeTexture.set(u.TEXTURE0);let I=l.fbo;if(!I){const R=new At(Z,{width:f,height:f,data:null},u.RGBA);R.bind(u.LINEAR,u.CLAMP_TO_EDGE),I=l.fbo=Z.createFramebuffer(f,f,!0,!1),I.colorAttachment.set(R.texture)}Z.bindFramebuffer.set(I.framebuffer),Z.viewport.set([0,0,f,f]),z.useProgram("hillshadePrepare").draw(Z,u.TRIANGLES,S,k,F,Tn.disabled,((R,V)=>{const W=V.stride,Y=P.Z();return P.aS(Y,0,P.N,-P.N,0,0,1),P.$(Y,Y,[0,-P.N,0]),{u_matrix:Y,u_image:1,u_dimension:[W,W],u_zoom:R.overscaledZ,u_unpack:V.getUnpackVector()}})(l.tileID,h),null,g.id,z.rasterBoundsBuffer,z.quadTriangleIndexBuffer,z.rasterBoundsSegments),l.needsHillshadePrepare=!1}}function Ns(z,l,g,S,k,F){const Z=S.paint.get("raster-fade-duration");if(!F&&Z>0){const u=P.h.now(),h=(u-z.timeAdded)/Z,f=l?(u-l.timeAdded)/Z:-1,y=g.getSource(),b=k.coveringZoomLevel({tileSize:y.tileSize,roundZoom:y.roundZoom}),I=!l||Math.abs(l.tileID.overscaledZ-b)>Math.abs(z.tileID.overscaledZ-b),R=I&&z.refreshedUponExpiration?1:P.ad(I?h:1-f,0,1);return z.refreshedUponExpiration&&h>=1&&(z.refreshedUponExpiration=!1),l?{opacity:1,mix:1-R}:{opacity:R,mix:0}}return{opacity:1,mix:0}}const oo=new P.aT(1,0,0,1),na=new P.aT(0,1,0,1),ml=new P.aT(0,0,1,1),Kc=new P.aT(1,0,1,1),JA=new P.aT(0,1,1,1);function Ws(z,l,g,S){$o(z,0,l+g/2,z.transform.width,g,S)}function ho(z,l,g,S){$o(z,l-g/2,0,g,z.transform.height,S)}function $o(z,l,g,S,k,F){const Z=z.context,u=Z.gl;u.enable(u.SCISSOR_TEST),u.scissor(l*z.pixelRatio,g*z.pixelRatio,S*z.pixelRatio,k*z.pixelRatio),Z.clear({color:F}),u.disable(u.SCISSOR_TEST)}function LA(z,l,g){const S=z.context,k=S.gl,F=g.posMatrix,Z=z.useProgram("debug"),u=Gi.disabled,h=ns.disabled,f=z.colorModeForRenderPass(),y="$debug",b=z.style.map.terrain&&z.style.map.terrain.getTerrainData(g);S.activeTexture.set(k.TEXTURE0);const I=l.getTileByID(g.key).latestRawTileData,R=Math.floor((I&&I.byteLength||0)/1024),V=l.getTile(g).tileSize,W=512/Math.min(V,512)*(g.overscaledZ/z.transform.zoom)*.5;let Y=g.canonical.toString();g.overscaledZ!==g.canonical.z&&(Y+=` => ${g.overscaledZ}`),function(le,fe){le.initDebugOverlayCanvas();const ye=le.debugOverlayCanvas,Ie=le.context.gl,ke=le.debugOverlayCanvas.getContext("2d");ke.clearRect(0,0,ye.width,ye.height),ke.shadowColor="white",ke.shadowBlur=2,ke.lineWidth=1.5,ke.strokeStyle="white",ke.textBaseline="top",ke.font="bold 36px Open Sans, sans-serif",ke.fillText(fe,5,5),ke.strokeText(fe,5,5),le.debugOverlayTexture.update(ye),le.debugOverlayTexture.bind(Ie.LINEAR,Ie.CLAMP_TO_EDGE)}(z,`${Y} ${R}kB`),Z.draw(S,k.TRIANGLES,u,h,Yn.alphaBlended,Tn.disabled,Dl(F,P.aT.transparent,W),null,y,z.debugBuffer,z.quadTriangleIndexBuffer,z.debugSegments),Z.draw(S,k.LINE_STRIP,u,h,f,Tn.disabled,Dl(F,P.aT.red),b,y,z.debugBuffer,z.tileBorderIndexBuffer,z.debugSegments)}function Pn(z,l,g){const S=z.context,k=S.gl,F=z.colorModeForRenderPass(),Z=new Gi(k.LEQUAL,Gi.ReadWrite,z.depthRangeFor3D),u=z.useProgram("terrain"),h=l.getTerrainMesh();S.bindFramebuffer.set(null),S.viewport.set([0,0,z.width,z.height]);for(const f of g){const y=z.renderToTexture.getTexture(f),b=l.getTerrainData(f.tileID);S.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,y.texture);const I={u_matrix:z.transform.calculatePosMatrix(f.tileID.toUnwrapped()),u_texture:0,u_ele_delta:l.getMeshFrameDelta(z.transform.zoom)};u.draw(S,k.TRIANGLES,Z,ns.disabled,F,Tn.backCCW,I,b,"terrain",h.vertexBuffer,h.indexBuffer,h.segments)}}class va{constructor(l,g){this.context=new eA(l),this.transform=g,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:P.Z(),renderTime:0},this.setup(),this.numSublayers=Ft.maxUnderzooming+Ft.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Dr}resize(l,g,S){if(this.width=Math.floor(l*S),this.height=Math.floor(g*S),this.pixelRatio=S,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const k of this.style._order)this.style._layers[k].resize()}setup(){const l=this.context,g=new P.a_;g.emplaceBack(0,0),g.emplaceBack(P.N,0),g.emplaceBack(0,P.N),g.emplaceBack(P.N,P.N),this.tileExtentBuffer=l.createVertexBuffer(g,DA.members),this.tileExtentSegments=P.S.simpleSegment(0,0,4,2);const S=new P.a_;S.emplaceBack(0,0),S.emplaceBack(P.N,0),S.emplaceBack(0,P.N),S.emplaceBack(P.N,P.N),this.debugBuffer=l.createVertexBuffer(S,DA.members),this.debugSegments=P.S.simpleSegment(0,0,4,5);const k=new P.V;k.emplaceBack(0,0,0,0),k.emplaceBack(P.N,0,P.N,0),k.emplaceBack(0,P.N,0,P.N),k.emplaceBack(P.N,P.N,P.N,P.N),this.rasterBoundsBuffer=l.createVertexBuffer(k,In.members),this.rasterBoundsSegments=P.S.simpleSegment(0,0,4,2);const F=new P.a_;F.emplaceBack(0,0),F.emplaceBack(1,0),F.emplaceBack(0,1),F.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(F,DA.members),this.viewportSegments=P.S.simpleSegment(0,0,4,2);const Z=new P.a$;Z.emplaceBack(0),Z.emplaceBack(1),Z.emplaceBack(3),Z.emplaceBack(2),Z.emplaceBack(0),this.tileBorderIndexBuffer=l.createIndexBuffer(Z);const u=new P.b0;u.emplaceBack(0,1,2),u.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(u);const h=this.context.gl;this.stencilClearMode=new ns({func:h.ALWAYS,mask:0},0,255,h.ZERO,h.ZERO,h.ZERO)}clearStencil(){const l=this.context,g=l.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const S=P.Z();P.aS(S,0,this.width,this.height,0,0,1),P.a0(S,S,[g.drawingBufferWidth,g.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(l,g.TRIANGLES,Gi.disabled,this.stencilClearMode,Yn.disabled,Tn.disabled,$A(S),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(l,g){if(this.currentStencilSource===l.source||!l.isTileClipped()||!g||!g.length)return;this.currentStencilSource=l.source;const S=this.context,k=S.gl;this.nextStencilID+g.length>256&&this.clearStencil(),S.setColorMode(Yn.disabled),S.setDepthMode(Gi.disabled);const F=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const Z of g){const u=this._tileClippingMaskIDs[Z.key]=this.nextStencilID++,h=this.style.map.terrain&&this.style.map.terrain.getTerrainData(Z);F.draw(S,k.TRIANGLES,Gi.disabled,new ns({func:k.ALWAYS,mask:0},u,255,k.KEEP,k.KEEP,k.REPLACE),Yn.disabled,Tn.disabled,$A(Z.posMatrix),h,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const l=this.nextStencilID++,g=this.context.gl;return new ns({func:g.NOTEQUAL,mask:255},l,255,g.KEEP,g.KEEP,g.REPLACE)}stencilModeForClipping(l){const g=this.context.gl;return new ns({func:g.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,g.KEEP,g.KEEP,g.REPLACE)}stencilConfigForOverlap(l){const g=this.context.gl,S=l.sort((Z,u)=>u.overscaledZ-Z.overscaledZ),k=S[S.length-1].overscaledZ,F=S[0].overscaledZ-k+1;if(F>1){this.currentStencilSource=void 0,this.nextStencilID+F>256&&this.clearStencil();const Z={};for(let u=0;u<F;u++)Z[u+k]=new ns({func:g.GEQUAL,mask:255},u+this.nextStencilID,255,g.KEEP,g.KEEP,g.REPLACE);return this.nextStencilID+=F,[Z,S]}return[{[k]:ns.disabled},S]}colorModeForRenderPass(){const l=this.context.gl;return this._showOverdrawInspector?new Yn([l.CONSTANT_COLOR,l.ONE],new P.aT(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Yn.unblended:Yn.alphaBlended}depthModeForSublayer(l,g,S){if(!this.opaquePassEnabledForLayer())return Gi.disabled;const k=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new Gi(S||this.context.gl.LEQUAL,g,[k,k])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(l,g){this.style=l,this.options=g,this.lineAtlas=l.lineAtlas,this.imageManager=l.imageManager,this.glyphManager=l.glyphManager,this.symbolFadeChange=l.placement.symbolFadeChange(P.h.now()),this.imageManager.beginFrame();const S=this.style._order,k=this.style.sourceCaches,F={},Z={},u={};for(const h in k){const f=k[h];f.used&&f.prepare(this.context),F[h]=f.getVisibleCoordinates(),Z[h]=F[h].slice().reverse(),u[h]=f.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let h=0;h<S.length;h++)if(this.style._layers[S[h]].is3D()){this.opaquePassCutoff=h;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;const h=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!P.b1(this.terrainFacilitator.matrix,this.transform.projMatrix)||h.length)&&(P.b2(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(f,y){const b=f.context,I=b.gl,R=Yn.unblended,V=new Gi(I.LEQUAL,Gi.ReadWrite,[0,1]),W=y.getTerrainMesh(),Y=y.sourceCache.getRenderableTiles(),le=f.useProgram("terrainDepth");b.bindFramebuffer.set(y.getFramebuffer("depth").framebuffer),b.viewport.set([0,0,f.width/devicePixelRatio,f.height/devicePixelRatio]),b.clear({color:P.aT.transparent,depth:1});for(const fe of Y){const ye=y.getTerrainData(fe.tileID),Ie={u_matrix:f.transform.calculatePosMatrix(fe.tileID.toUnwrapped()),u_ele_delta:y.getMeshFrameDelta(f.transform.zoom)};le.draw(b,I.TRIANGLES,V,ns.disabled,R,Tn.backCCW,Ie,ye,"terrain",W.vertexBuffer,W.indexBuffer,W.segments)}b.bindFramebuffer.set(null),b.viewport.set([0,0,f.width,f.height])}(this,this.style.map.terrain),function(f,y){const b=f.context,I=b.gl,R=Yn.unblended,V=new Gi(I.LEQUAL,Gi.ReadWrite,[0,1]),W=y.getTerrainMesh(),Y=y.getCoordsTexture(),le=y.sourceCache.getRenderableTiles(),fe=f.useProgram("terrainCoords");b.bindFramebuffer.set(y.getFramebuffer("coords").framebuffer),b.viewport.set([0,0,f.width/devicePixelRatio,f.height/devicePixelRatio]),b.clear({color:P.aT.transparent,depth:1}),y.coordsIndex=[];for(const ye of le){const Ie=y.getTerrainData(ye.tileID);b.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,Y.texture);const ke={u_matrix:f.transform.calculatePosMatrix(ye.tileID.toUnwrapped()),u_terrain_coords_id:(255-y.coordsIndex.length)/255,u_texture:0,u_ele_delta:y.getMeshFrameDelta(f.transform.zoom)};fe.draw(b,I.TRIANGLES,V,ns.disabled,R,Tn.backCCW,ke,Ie,"terrain",W.vertexBuffer,W.indexBuffer,W.segments),y.coordsIndex.push(ye.tileID.key)}b.bindFramebuffer.set(null),b.viewport.set([0,0,f.width,f.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(const h of S){const f=this.style._layers[h];if(!f.hasOffscreenPass()||f.isHidden(this.transform.zoom))continue;const y=Z[f.source];(f.type==="custom"||y.length)&&this.renderLayer(this,k[f.source],f,y)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:g.showOverdrawInspector?P.aT.black:P.aT.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=g.showOverdrawInspector,this.depthRangeFor3D=[0,1-(l._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=S.length-1;this.currentLayer>=0;this.currentLayer--){const h=this.style._layers[S[this.currentLayer]],f=k[h.source],y=F[h.source];this._renderTileClippingMasks(h,y),this.renderLayer(this,f,h,y)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<S.length;this.currentLayer++){const h=this.style._layers[S[this.currentLayer]],f=k[h.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(h))continue;const y=(h.type==="symbol"?u:Z)[h.source];this._renderTileClippingMasks(h,F[h.source]),this.renderLayer(this,f,h,y)}if(this.options.showTileBoundaries){const h=function(f,y){let b=null;const I=Object.values(f._layers).flatMap(Y=>Y.source&&!Y.isHidden(y)?[f.sourceCaches[Y.source]]:[]),R=I.filter(Y=>Y.getSource().type==="vector"),V=I.filter(Y=>Y.getSource().type!=="vector"),W=Y=>{(!b||b.getSource().maxzoom<Y.getSource().maxzoom)&&(b=Y)};return R.forEach(Y=>W(Y)),b||V.forEach(Y=>W(Y)),b}(this.style,this.transform.zoom);h&&function(f,y,b){for(let I=0;I<b.length;I++)LA(f,y,b[I])}(this,h,h.getVisibleCoordinates())}this.options.showPadding&&function(h){const f=h.transform.padding;Ws(h,h.transform.height-(f.top||0),3,oo),Ws(h,f.bottom||0,3,na),ho(h,f.left||0,3,ml),ho(h,h.transform.width-(f.right||0),3,Kc);const y=h.transform.centerPoint;(function(b,I,R,V){$o(b,I-1,R-10,2,20,V),$o(b,I-10,R-1,20,2,V)})(h,y.x,h.transform.height-y.y,JA)}(this),this.context.setDefault()}renderLayer(l,g,S,k){if(!S.isHidden(this.transform.zoom)&&(S.type==="background"||S.type==="custom"||(k||[]).length))switch(this.id=S.id,S.type){case"symbol":(function(F,Z,u,h,f){if(F.renderPass!=="translucent")return;const y=ns.disabled,b=F.colorModeForRenderPass();(u._unevaluatedLayout.hasValue("text-variable-anchor")||u._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(I,R,V,W,Y,le,fe){const ye=R.transform,Ie=Y==="map",ke=le==="map";for(const qe of I){const ut=W.getTile(qe),mt=ut.getBucket(V);if(!mt||!mt.text||!mt.text.segments.get().length)continue;const st=P.ah(mt.textSizeData,ye.zoom),ht=Qe(ut,1,R.transform.zoom),ft=oi(qe.posMatrix,ke,Ie,R.transform,ht),Ai=V.layout.get("icon-text-fit")!=="none"&&mt.hasIconData();if(st){const Nt=Math.pow(2,ye.zoom-ut.tileID.overscaledZ);zo(mt,Ie,ke,fe,ye,ft,qe.posMatrix,Nt,st,Ai,R.style.map.terrain?(Wt,Gt)=>R.style.map.terrain.getElevation(qe,Wt,Gt):null)}}}(h,F,u,Z,u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),f),u.paint.get("icon-opacity").constantOr(1)!==0&&Ln(F,Z,u,h,!1,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),u.layout.get("icon-rotation-alignment"),u.layout.get("icon-pitch-alignment"),u.layout.get("icon-keep-upright"),y,b),u.paint.get("text-opacity").constantOr(1)!==0&&Ln(F,Z,u,h,!0,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),u.layout.get("text-keep-upright"),y,b),Z.map.showCollisionBoxes&&(Tc(F,Z,u,h,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),!0),Tc(F,Z,u,h,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),!1))})(l,g,S,k,this.style.placement.variableOffsets);break;case"circle":(function(F,Z,u,h){if(F.renderPass!=="translucent")return;const f=u.paint.get("circle-opacity"),y=u.paint.get("circle-stroke-width"),b=u.paint.get("circle-stroke-opacity"),I=!u.layout.get("circle-sort-key").isConstant();if(f.constantOr(1)===0&&(y.constantOr(1)===0||b.constantOr(1)===0))return;const R=F.context,V=R.gl,W=F.depthModeForSublayer(0,Gi.ReadOnly),Y=ns.disabled,le=F.colorModeForRenderPass(),fe=[];for(let ye=0;ye<h.length;ye++){const Ie=h[ye],ke=Z.getTile(Ie),qe=ke.getBucket(u);if(!qe)continue;const ut=qe.programConfigurations.get(u.id),mt=F.useProgram("circle",ut),st=qe.layoutVertexBuffer,ht=qe.indexBuffer,ft=F.style.map.terrain&&F.style.map.terrain.getTerrainData(Ie),Ai={programConfiguration:ut,program:mt,layoutVertexBuffer:st,indexBuffer:ht,uniformValues:co(F,Ie,ke,u),terrainData:ft};if(I){const Nt=qe.segments.get();for(const Wt of Nt)fe.push({segments:new P.S([Wt]),sortKey:Wt.sortKey,state:Ai})}else fe.push({segments:qe.segments,sortKey:0,state:Ai})}I&&fe.sort((ye,Ie)=>ye.sortKey-Ie.sortKey);for(const ye of fe){const{programConfiguration:Ie,program:ke,layoutVertexBuffer:qe,indexBuffer:ut,uniformValues:mt,terrainData:st}=ye.state;ke.draw(R,V.TRIANGLES,W,Y,le,Tn.disabled,mt,st,u.id,qe,ut,ye.segments,u.paint,F.transform.zoom,Ie)}})(l,g,S,k);break;case"heatmap":(function(F,Z,u,h){if(u.paint.get("heatmap-opacity")!==0)if(F.renderPass==="offscreen"){const f=F.context,y=f.gl,b=ns.disabled,I=new Yn([y.ONE,y.ONE],P.aT.transparent,[!0,!0,!0,!0]);(function(R,V,W){const Y=R.gl;R.activeTexture.set(Y.TEXTURE1),R.viewport.set([0,0,V.width/4,V.height/4]);let le=W.heatmapFbo;if(le)Y.bindTexture(Y.TEXTURE_2D,le.colorAttachment.get()),R.bindFramebuffer.set(le.framebuffer);else{const fe=Y.createTexture();Y.bindTexture(Y.TEXTURE_2D,fe),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_WRAP_S,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_WRAP_T,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_MIN_FILTER,Y.LINEAR),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_MAG_FILTER,Y.LINEAR),le=W.heatmapFbo=R.createFramebuffer(V.width/4,V.height/4,!1,!1),function(ye,Ie,ke,qe){var ut,mt;const st=ye.gl,ht=(ut=ye.HALF_FLOAT)!==null&&ut!==void 0?ut:st.UNSIGNED_BYTE,ft=(mt=ye.RGBA16F)!==null&&mt!==void 0?mt:st.RGBA;st.texImage2D(st.TEXTURE_2D,0,ft,Ie.width/4,Ie.height/4,0,st.RGBA,ht,null),qe.colorAttachment.set(ke)}(R,V,fe,le)}})(f,F,u),f.clear({color:P.aT.transparent});for(let R=0;R<h.length;R++){const V=h[R];if(Z.hasRenderableParent(V))continue;const W=Z.getTile(V),Y=W.getBucket(u);if(!Y)continue;const le=Y.programConfigurations.get(u.id),fe=F.useProgram("heatmap",le),{zoom:ye}=F.transform;fe.draw(f,y.TRIANGLES,Gi.disabled,b,I,Tn.disabled,XA(V.posMatrix,W,ye,u.paint.get("heatmap-intensity")),null,u.id,Y.layoutVertexBuffer,Y.indexBuffer,Y.segments,u.paint,F.transform.zoom,le)}f.viewport.set([0,0,F.width,F.height])}else F.renderPass==="translucent"&&(F.context.setColorMode(F.colorModeForRenderPass()),function(f,y){const b=f.context,I=b.gl,R=y.heatmapFbo;if(!R)return;b.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,R.colorAttachment.get()),b.activeTexture.set(I.TEXTURE1);let V=y.colorRampTexture;V||(V=y.colorRampTexture=new At(b,y.colorRamp,I.RGBA)),V.bind(I.LINEAR,I.CLAMP_TO_EDGE),f.useProgram("heatmapTexture").draw(b,I.TRIANGLES,Gi.disabled,ns.disabled,f.colorModeForRenderPass(),Tn.disabled,((W,Y,le,fe)=>{const ye=P.Z();P.aS(ye,0,W.width,W.height,0,0,1);const Ie=W.context.gl;return{u_matrix:ye,u_world:[Ie.drawingBufferWidth,Ie.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:Y.paint.get("heatmap-opacity")}})(f,y),null,y.id,f.viewportBuffer,f.quadTriangleIndexBuffer,f.viewportSegments,y.paint,f.transform.zoom)}(F,u))})(l,g,S,k);break;case"line":(function(F,Z,u,h){if(F.renderPass!=="translucent")return;const f=u.paint.get("line-opacity"),y=u.paint.get("line-width");if(f.constantOr(1)===0||y.constantOr(1)===0)return;const b=F.depthModeForSublayer(0,Gi.ReadOnly),I=F.colorModeForRenderPass(),R=u.paint.get("line-dasharray"),V=u.paint.get("line-pattern"),W=V.constantOr(1),Y=u.paint.get("line-gradient"),le=u.getCrossfadeParameters(),fe=W?"linePattern":R?"lineSDF":Y?"lineGradient":"line",ye=F.context,Ie=ye.gl;let ke=!0;for(const qe of h){const ut=Z.getTile(qe);if(W&&!ut.patternsLoaded())continue;const mt=ut.getBucket(u);if(!mt)continue;const st=mt.programConfigurations.get(u.id),ht=F.context.program.get(),ft=F.useProgram(fe,st),Ai=ke||ft.program!==ht,Nt=F.style.map.terrain&&F.style.map.terrain.getTerrainData(qe),Wt=V.constantOr(null);if(Wt&&ut.imageAtlas){const Hi=ut.imageAtlas,Zi=Hi.patternPositions[Wt.to.toString()],Fi=Hi.patternPositions[Wt.from.toString()];Zi&&Fi&&st.setConstantPatternPositions(Zi,Fi)}const Gt=Nt?qe:null,lr=W?YA(F,ut,u,le,Gt):R?jn(F,ut,u,R,le,Gt):Y?is(F,ut,u,mt.lineClipsArray.length,Gt):uA(F,ut,u,Gt);if(W)ye.activeTexture.set(Ie.TEXTURE0),ut.imageAtlasTexture.bind(Ie.LINEAR,Ie.CLAMP_TO_EDGE),st.updatePaintBuffers(le);else if(R&&(Ai||F.lineAtlas.dirty))ye.activeTexture.set(Ie.TEXTURE0),F.lineAtlas.bind(ye);else if(Y){const Hi=mt.gradients[u.id];let Zi=Hi.texture;if(u.gradientVersion!==Hi.version){let Fi=256;if(u.stepInterpolant){const sr=Z.getSource().maxzoom,er=qe.canonical.z===sr?Math.ceil(1<<F.transform.maxZoom-qe.canonical.z):1;Fi=P.ad(P.aY(mt.maxLineLength/P.N*1024*er),256,ye.maxTextureSize)}Hi.gradient=P.aZ({expression:u.gradientExpression(),evaluationKey:"lineProgress",resolution:Fi,image:Hi.gradient||void 0,clips:mt.lineClipsArray}),Hi.texture?Hi.texture.update(Hi.gradient):Hi.texture=new At(ye,Hi.gradient,Ie.RGBA),Hi.version=u.gradientVersion,Zi=Hi.texture}ye.activeTexture.set(Ie.TEXTURE0),Zi.bind(u.stepInterpolant?Ie.NEAREST:Ie.LINEAR,Ie.CLAMP_TO_EDGE)}ft.draw(ye,Ie.TRIANGLES,b,F.stencilModeForClipping(qe),I,Tn.disabled,lr,Nt,u.id,mt.layoutVertexBuffer,mt.indexBuffer,mt.segments,u.paint,F.transform.zoom,st,mt.layoutVertexBuffer2),ke=!1}})(l,g,S,k);break;case"fill":(function(F,Z,u,h){const f=u.paint.get("fill-color"),y=u.paint.get("fill-opacity");if(y.constantOr(1)===0)return;const b=F.colorModeForRenderPass(),I=u.paint.get("fill-pattern"),R=F.opaquePassEnabledForLayer()&&!I.constantOr(1)&&f.constantOr(P.aT.transparent).a===1&&y.constantOr(0)===1?"opaque":"translucent";if(F.renderPass===R){const V=F.depthModeForSublayer(1,F.renderPass==="opaque"?Gi.ReadWrite:Gi.ReadOnly);il(F,Z,u,h,V,b,!1)}if(F.renderPass==="translucent"&&u.paint.get("fill-antialias")){const V=F.depthModeForSublayer(u.getPaintProperty("fill-outline-color")?2:0,Gi.ReadOnly);il(F,Z,u,h,V,b,!0)}})(l,g,S,k);break;case"fill-extrusion":(function(F,Z,u,h){const f=u.paint.get("fill-extrusion-opacity");if(f!==0&&F.renderPass==="translucent"){const y=new Gi(F.context.gl.LEQUAL,Gi.ReadWrite,F.depthRangeFor3D);if(f!==1||u.paint.get("fill-extrusion-pattern").constantOr(1))Na(F,Z,u,h,y,ns.disabled,Yn.disabled),Na(F,Z,u,h,y,F.stencilModeFor3D(),F.colorModeForRenderPass());else{const b=F.colorModeForRenderPass();Na(F,Z,u,h,y,ns.disabled,b)}}})(l,g,S,k);break;case"hillshade":(function(F,Z,u,h){if(F.renderPass!=="offscreen"&&F.renderPass!=="translucent")return;const f=F.context,y=F.depthModeForSublayer(0,Gi.ReadOnly),b=F.colorModeForRenderPass(),[I,R]=F.renderPass==="translucent"?F.stencilConfigForOverlap(h):[{},h];for(const V of R){const W=Z.getTile(V);W.needsHillshadePrepare!==void 0&&W.needsHillshadePrepare&&F.renderPass==="offscreen"?Ps(F,W,u,y,ns.disabled,b):F.renderPass==="translucent"&&xu(F,V,W,u,y,I[V.overscaledZ],b)}f.viewport.set([0,0,F.width,F.height])})(l,g,S,k);break;case"raster":(function(F,Z,u,h){if(F.renderPass!=="translucent"||u.paint.get("raster-opacity")===0||!h.length)return;const f=F.context,y=f.gl,b=Z.getSource(),I=F.useProgram("raster"),R=F.colorModeForRenderPass(),[V,W]=b instanceof Es?[{},h]:F.stencilConfigForOverlap(h),Y=W[W.length-1].overscaledZ,le=!F.options.moving;for(const fe of W){const ye=F.depthModeForSublayer(fe.overscaledZ-Y,u.paint.get("raster-opacity")===1?Gi.ReadWrite:Gi.ReadOnly,y.LESS),Ie=Z.getTile(fe);Ie.registerFadeDuration(u.paint.get("raster-fade-duration"));const ke=Z.findLoadedParent(fe,0),qe=Ns(Ie,ke,Z,u,F.transform,F.style.map.terrain);let ut,mt;const st=u.paint.get("raster-resampling")==="nearest"?y.NEAREST:y.LINEAR;f.activeTexture.set(y.TEXTURE0),Ie.texture.bind(st,y.CLAMP_TO_EDGE,y.LINEAR_MIPMAP_NEAREST),f.activeTexture.set(y.TEXTURE1),ke?(ke.texture.bind(st,y.CLAMP_TO_EDGE,y.LINEAR_MIPMAP_NEAREST),ut=Math.pow(2,ke.tileID.overscaledZ-Ie.tileID.overscaledZ),mt=[Ie.tileID.canonical.x*ut%1,Ie.tileID.canonical.y*ut%1]):Ie.texture.bind(st,y.CLAMP_TO_EDGE,y.LINEAR_MIPMAP_NEAREST);const ht=F.style.map.terrain&&F.style.map.terrain.getTerrainData(fe),ft=ht?fe:null,Ai=ft?ft.posMatrix:F.transform.calculatePosMatrix(fe.toUnwrapped(),le),Nt=ir(Ai,mt||[0,0],ut||1,qe,u);b instanceof Es?I.draw(f,y.TRIANGLES,ye,ns.disabled,R,Tn.disabled,Nt,ht,u.id,b.boundsBuffer,F.quadTriangleIndexBuffer,b.boundsSegments):I.draw(f,y.TRIANGLES,ye,V[fe.overscaledZ],R,Tn.disabled,Nt,ht,u.id,F.rasterBoundsBuffer,F.quadTriangleIndexBuffer,F.rasterBoundsSegments)}})(l,g,S,k);break;case"background":(function(F,Z,u,h){const f=u.paint.get("background-color"),y=u.paint.get("background-opacity");if(y===0)return;const b=F.context,I=b.gl,R=F.transform,V=R.tileSize,W=u.paint.get("background-pattern");if(F.isPatternMissing(W))return;const Y=!W&&f.a===1&&y===1&&F.opaquePassEnabledForLayer()?"opaque":"translucent";if(F.renderPass!==Y)return;const le=ns.disabled,fe=F.depthModeForSublayer(0,Y==="opaque"?Gi.ReadWrite:Gi.ReadOnly),ye=F.colorModeForRenderPass(),Ie=F.useProgram(W?"backgroundPattern":"background"),ke=h||R.coveringTiles({tileSize:V,terrain:F.style.map.terrain});W&&(b.activeTexture.set(I.TEXTURE0),F.imageManager.bind(F.context));const qe=u.getCrossfadeParameters();for(const ut of ke){const mt=h?ut.posMatrix:F.transform.calculatePosMatrix(ut.toUnwrapped()),st=W?xn(mt,y,F,W,{tileID:ut,tileSize:V},qe):Ho(mt,y,f),ht=F.style.map.terrain&&F.style.map.terrain.getTerrainData(ut);Ie.draw(b,I.TRIANGLES,fe,le,ye,Tn.disabled,st,ht,u.id,F.tileExtentBuffer,F.quadTriangleIndexBuffer,F.tileExtentSegments)}})(l,0,S,k);break;case"custom":(function(F,Z,u){const h=F.context,f=u.implementation;if(F.renderPass==="offscreen"){const y=f.prerender;y&&(F.setCustomLayerDefaults(),h.setColorMode(F.colorModeForRenderPass()),y.call(f,h.gl,F.transform.customLayerMatrix()),h.setDirty(),F.setBaseState())}else if(F.renderPass==="translucent"){F.setCustomLayerDefaults(),h.setColorMode(F.colorModeForRenderPass()),h.setStencilMode(ns.disabled);const y=f.renderingMode==="3d"?new Gi(F.context.gl.LEQUAL,Gi.ReadWrite,F.depthRangeFor3D):F.depthModeForSublayer(0,Gi.ReadOnly);h.setDepthMode(y),f.render(h.gl,F.transform.customLayerMatrix()),h.setDirty(),F.setBaseState(),h.bindFramebuffer.set(null)}})(l,0,S)}}translatePosMatrix(l,g,S,k,F){if(!S[0]&&!S[1])return l;const Z=F?k==="map"?this.transform.angle:0:k==="viewport"?-this.transform.angle:0;if(Z){const f=Math.sin(Z),y=Math.cos(Z);S=[S[0]*y-S[1]*f,S[0]*f+S[1]*y]}const u=[F?S[0]:Qe(g,S[0],this.transform.zoom),F?S[1]:Qe(g,S[1],this.transform.zoom),0],h=new Float32Array(16);return P.$(h,l,u),h}saveTileTexture(l){const g=this._tileTextures[l.size[0]];g?g.push(l):this._tileTextures[l.size[0]]=[l]}getTileTexture(l){const g=this._tileTextures[l];return g&&g.length>0?g.pop():null}isPatternMissing(l){if(!l)return!1;if(!l.from||!l.to)return!0;const g=this.imageManager.getPattern(l.from.toString()),S=this.imageManager.getPattern(l.to.toString());return!g||!S}useProgram(l,g){this.cache=this.cache||{};const S=l+(g?g.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[S]||(this.cache[S]=new Xl(this.context,nt[l],g,ta[l],this._showOverdrawInspector,this.style.map.terrain)),this.cache[S]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new At(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:l,drawingBufferHeight:g}=this.context.gl;return this.width!==l||this.height!==g}}class Rn{constructor(l,g){this.points=l,this.planes=g}static fromInvProjectionMatrix(l,g,S){const k=Math.pow(2,S),F=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(u=>{const h=1/(u=P.ag([],u,l))[3]/g*k;return P.b3(u,u,[h,h,1/u[3],h])}),Z=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(u=>{const h=function(I,R){var V=R[0],W=R[1],Y=R[2],le=V*V+W*W+Y*Y;return le>0&&(le=1/Math.sqrt(le)),I[0]=R[0]*le,I[1]=R[1]*le,I[2]=R[2]*le,I}([],function(I,R,V){var W=R[0],Y=R[1],le=R[2],fe=V[0],ye=V[1],Ie=V[2];return I[0]=Y*Ie-le*ye,I[1]=le*fe-W*Ie,I[2]=W*ye-Y*fe,I}([],jr([],F[u[0]],F[u[1]]),jr([],F[u[2]],F[u[1]]))),f=-((y=h)[0]*(b=F[u[1]])[0]+y[1]*b[1]+y[2]*b[2]);var y,b;return h.concat(f)});return new Rn(F,Z)}}class Ua{constructor(l,g){this.min=l,this.max=g,this.center=function(S,k,F){return S[0]=.5*k[0],S[1]=.5*k[1],S[2]=.5*k[2],S}([],function(S,k,F){return S[0]=k[0]+F[0],S[1]=k[1]+F[1],S[2]=k[2]+F[2],S}([],this.min,this.max))}quadrant(l){const g=[l%2==0,l<2],S=qr(this.min),k=qr(this.max);for(let F=0;F<g.length;F++)S[F]=g[F]?this.min[F]:this.center[F],k[F]=g[F]?this.center[F]:this.max[F];return k[2]=this.max[2],new Ua(S,k)}distanceX(l){return Math.max(Math.min(this.max[0],l[0]),this.min[0])-l[0]}distanceY(l){return Math.max(Math.min(this.max[1],l[1]),this.min[1])-l[1]}intersects(l){const g=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let S=!0;for(let k=0;k<l.planes.length;k++){const F=l.planes[k];let Z=0;for(let u=0;u<g.length;u++)P.b4(F,g[u])>=0&&Z++;if(Z===0)return 0;Z!==g.length&&(S=!1)}if(S)return 2;for(let k=0;k<3;k++){let F=Number.MAX_VALUE,Z=-Number.MAX_VALUE;for(let u=0;u<l.points.length;u++){const h=l.points[u][k]-this.min[k];F=Math.min(F,h),Z=Math.max(Z,h)}if(Z<0||F>this.max[k]-this.min[k])return 0}return 1}}class rl{constructor(l=0,g=0,S=0,k=0){if(isNaN(l)||l<0||isNaN(g)||g<0||isNaN(S)||S<0||isNaN(k)||k<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=g,this.left=S,this.right=k}interpolate(l,g,S){return g.top!=null&&l.top!=null&&(this.top=P.B.number(l.top,g.top,S)),g.bottom!=null&&l.bottom!=null&&(this.bottom=P.B.number(l.bottom,g.bottom,S)),g.left!=null&&l.left!=null&&(this.left=P.B.number(l.left,g.left,S)),g.right!=null&&l.right!=null&&(this.right=P.B.number(l.right,g.right,S)),this}getCenter(l,g){const S=P.ad((this.left+l-this.right)/2,0,l),k=P.ad((this.top+g-this.bottom)/2,0,g);return new P.P(S,k)}equals(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right}clone(){return new rl(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class _l{constructor(l,g,S,k,F){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=F===void 0||!!F,this._minZoom=l||0,this._maxZoom=g||22,this._minPitch=S??0,this._maxPitch=k??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new P.L(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new rl,this._posMatrixCache={},this._alignedPosMatrixCache={},this._minEleveationForCurrentTile=0}clone(){const l=new _l(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return l.apply(this),l}apply(l){this.tileSize=l.tileSize,this.latRange=l.latRange,this.width=l.width,this.height=l.height,this._center=l._center,this._elevation=l._elevation,this._minEleveationForCurrentTile=l._minEleveationForCurrentTile,this.zoom=l.zoom,this.angle=l.angle,this._fov=l._fov,this._pitch=l._pitch,this._unmodified=l._unmodified,this._edgeInsets=l._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))}get maxZoom(){return this._maxZoom}set maxZoom(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))}get minPitch(){return this._minPitch}set minPitch(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))}get maxPitch(){return this._maxPitch}set maxPitch(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new P.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(l){const g=-P.b5(l,-180,180)*Math.PI/180;this.angle!==g&&(this._unmodified=!1,this.angle=g,this._calcMatrices(),this.rotationMatrix=function(){var S=new P.A(4);return P.A!=Float32Array&&(S[1]=0,S[2]=0),S[0]=1,S[3]=1,S}(),function(S,k,F){var Z=k[0],u=k[1],h=k[2],f=k[3],y=Math.sin(F),b=Math.cos(F);S[0]=Z*b+h*y,S[1]=u*b+f*y,S[2]=Z*-y+h*b,S[3]=u*-y+f*b}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(l){const g=P.ad(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==g&&(this._unmodified=!1,this._pitch=g,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=l/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(l){const g=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==g&&(this._unmodified=!1,this._zoom=g,this.tileZoom=Math.max(0,Math.floor(g)),this.scale=this.zoomScale(g),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(l){l!==this._elevation&&(this._elevation=l,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(l){return this._edgeInsets.equals(l)}interpolatePadding(l,g,S){this._unmodified=!1,this._edgeInsets.interpolate(l,g,S),this._constrain(),this._calcMatrices()}coveringZoomLevel(l){const g=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,g)}getVisibleUnwrappedCoordinates(l){const g=[new P.b6(0,l)];if(this._renderWorldCopies){const S=this.pointCoordinate(new P.P(0,0)),k=this.pointCoordinate(new P.P(this.width,0)),F=this.pointCoordinate(new P.P(this.width,this.height)),Z=this.pointCoordinate(new P.P(0,this.height)),u=Math.floor(Math.min(S.x,k.x,F.x,Z.x)),h=Math.floor(Math.max(S.x,k.x,F.x,Z.x)),f=1;for(let y=u-f;y<=h+f;y++)y!==0&&g.push(new P.b6(y,l))}return g}coveringTiles(l){var g,S;let k=this.coveringZoomLevel(l);const F=k;if(l.minzoom!==void 0&&k<l.minzoom)return[];l.maxzoom!==void 0&&k>l.maxzoom&&(k=l.maxzoom);const Z=this.pointCoordinate(this.getCameraPoint()),u=P.U.fromLngLat(this.center),h=Math.pow(2,k),f=[h*Z.x,h*Z.y,0],y=[h*u.x,h*u.y,0],b=Rn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,k);let I=l.minzoom||0;!l.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(I=k);const R=l.terrain?2/Math.min(this.tileSize,l.tileSize)*this.tileSize:3,V=ye=>({aabb:new Ua([ye*h,0,0],[(ye+1)*h,h,0]),zoom:0,x:0,y:0,wrap:ye,fullyVisible:!1}),W=[],Y=[],le=k,fe=l.reparseOverscaled?F:k;if(this._renderWorldCopies)for(let ye=1;ye<=3;ye++)W.push(V(-ye)),W.push(V(ye));for(W.push(V(0));W.length>0;){const ye=W.pop(),Ie=ye.x,ke=ye.y;let qe=ye.fullyVisible;if(!qe){const ft=ye.aabb.intersects(b);if(ft===0)continue;qe=ft===2}const ut=l.terrain?f:y,mt=ye.aabb.distanceX(ut),st=ye.aabb.distanceY(ut),ht=Math.max(Math.abs(mt),Math.abs(st));if(ye.zoom===le||ht>R+(1<<le-ye.zoom)-2&&ye.zoom>=I){const ft=le-ye.zoom,Ai=f[0]-.5-(Ie<<ft),Nt=f[1]-.5-(ke<<ft);Y.push({tileID:new P.O(ye.zoom===le?fe:ye.zoom,ye.wrap,ye.zoom,Ie,ke),distanceSq:Jn([y[0]-.5-Ie,y[1]-.5-ke]),tileDistanceToCamera:Math.sqrt(Ai*Ai+Nt*Nt)})}else for(let ft=0;ft<4;ft++){const Ai=(Ie<<1)+ft%2,Nt=(ke<<1)+(ft>>1),Wt=ye.zoom+1;let Gt=ye.aabb.quadrant(ft);if(l.terrain){const lr=new P.O(Wt,ye.wrap,Wt,Ai,Nt),Hi=l.terrain.getMinMaxElevation(lr),Zi=(g=Hi.minElevation)!==null&&g!==void 0?g:this.elevation,Fi=(S=Hi.maxElevation)!==null&&S!==void 0?S:this.elevation;Gt=new Ua([Gt.min[0],Gt.min[1],Zi],[Gt.max[0],Gt.max[1],Fi])}W.push({aabb:Gt,zoom:Wt,x:Ai,y:Nt,wrap:ye.wrap,fullyVisible:qe})}}return Y.sort((ye,Ie)=>ye.distanceSq-Ie.distanceSq).map(ye=>ye.tileID)}resize(l,g){this.width=l,this.height=g,this.pixelsToGLUnits=[2/l,-2/g],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(l){return Math.pow(2,l)}scaleZoom(l){return Math.log(l)/Math.LN2}project(l){const g=P.ad(l.lat,-this.maxValidLatitude,this.maxValidLatitude);return new P.P(P.G(l.lng)*this.worldSize,P.H(g)*this.worldSize)}unproject(l){return new P.U(l.x/this.worldSize,l.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(l){const g=this.pointLocation(this.centerPoint,l),S=l.getElevationForLngLatZoom(g,this.tileZoom);if(!(this.elevation-S))return;const k=this.getCameraPosition(),F=P.U.fromLngLat(k.lngLat,k.altitude),Z=P.U.fromLngLat(g,S),u=F.x-Z.x,h=F.y-Z.y,f=F.z-Z.z,y=Math.sqrt(u*u+h*h+f*f),b=this.scaleZoom(this.cameraToCenterDistance/y/this.tileSize);this._elevation=S,this._center=g,this.zoom=b}setLocationAtPoint(l,g){const S=this.pointCoordinate(g),k=this.pointCoordinate(this.centerPoint),F=this.locationCoordinate(l),Z=new P.U(F.x-(S.x-k.x),F.y-(S.y-k.y));this.center=this.coordinateLocation(Z),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(l,g){return g?this.coordinatePoint(this.locationCoordinate(l),g.getElevationForLngLatZoom(l,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(l))}pointLocation(l,g){return this.coordinateLocation(this.pointCoordinate(l,g))}locationCoordinate(l){return P.U.fromLngLat(l)}coordinateLocation(l){return l&&l.toLngLat()}pointCoordinate(l,g){if(g){const I=g.pointCoordinate(l);if(I!=null)return I}const S=[l.x,l.y,0,1],k=[l.x,l.y,1,1];P.ag(S,S,this.pixelMatrixInverse),P.ag(k,k,this.pixelMatrixInverse);const F=S[3],Z=k[3],u=S[1]/F,h=k[1]/Z,f=S[2]/F,y=k[2]/Z,b=f===y?0:(0-f)/(y-f);return new P.U(P.B.number(S[0]/F,k[0]/Z,b)/this.worldSize,P.B.number(u,h,b)/this.worldSize)}coordinatePoint(l,g=0,S=this.pixelMatrix){const k=[l.x*this.worldSize,l.y*this.worldSize,g,1];return P.ag(k,k,S),new P.P(k[0]/k[3],k[1]/k[3])}getBounds(){const l=Math.max(0,this.height/2-this.getHorizon());return new Yr().extend(this.pointLocation(new P.P(0,l))).extend(this.pointLocation(new P.P(this.width,l))).extend(this.pointLocation(new P.P(this.width,this.height))).extend(this.pointLocation(new P.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Yr([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(l){l?(this.lngRange=[l.getWest(),l.getEast()],this.latRange=[l.getSouth(),l.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(l,g=!1){const S=l.key,k=g?this._alignedPosMatrixCache:this._posMatrixCache;if(k[S])return k[S];const F=l.canonical,Z=this.worldSize/this.zoomScale(F.z),u=F.x+Math.pow(2,F.z)*l.wrap,h=P.ao(new Float64Array(16));return P.$(h,h,[u*Z,F.y*Z,0]),P.a0(h,h,[Z/P.N,Z/P.N,1]),P.a1(h,g?this.alignedProjMatrix:this.projMatrix,h),k[S]=new Float32Array(h),k[S]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let l,g,S,k,F=-90,Z=90,u=-180,h=180;const f=this.size,y=this._unmodified;if(this.latRange){const R=this.latRange;F=P.H(R[1])*this.worldSize,Z=P.H(R[0])*this.worldSize,l=Z-F<f.y?f.y/(Z-F):0}if(this.lngRange){const R=this.lngRange;u=P.b5(P.G(R[0])*this.worldSize,0,this.worldSize),h=P.b5(P.G(R[1])*this.worldSize,0,this.worldSize),h<u&&(h+=this.worldSize),g=h-u<f.x?f.x/(h-u):0}const b=this.point,I=Math.max(g||0,l||0);if(I)return this.center=this.unproject(new P.P(g?(h+u)/2:b.x,l?(Z+F)/2:b.y)),this.zoom+=this.scaleZoom(I),this._unmodified=y,void(this._constraining=!1);if(this.latRange){const R=b.y,V=f.y/2;R-V<F&&(k=F+V),R+V>Z&&(k=Z-V)}if(this.lngRange){const R=(u+h)/2,V=P.b5(b.x,R-this.worldSize/2,R+this.worldSize/2),W=f.x/2;V-W<u&&(S=u+W),V+W>h&&(S=h-W)}S===void 0&&k===void 0||(this.center=this.unproject(new P.P(S!==void 0?S:b.x,k!==void 0?k:b.y)).wrap()),this._unmodified=y,this._constraining=!1}_calcMatrices(){if(!this.height)return;const l=this.centerOffset,g=this.point.x,S=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=P.b7(1,this.center.lat)*this.worldSize;let k=P.ao(new Float64Array(16));P.a0(k,k,[this.width/2,-this.height/2,1]),P.$(k,k,[1,-1,0]),this.labelPlaneMatrix=k,k=P.ao(new Float64Array(16)),P.a0(k,k,[1,-1,1]),P.$(k,k,[-1,-1,0]),P.a0(k,k,[2/this.width,2/this.height,1]),this.glCoordMatrix=k;const F=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),Z=Math.min(this.elevation,this._minEleveationForCurrentTile),u=F-Z*this._pixelPerMeter/Math.cos(this._pitch),h=Z<0?u:F,f=Math.PI/2+this._pitch,y=this._fov*(.5+l.y/this.height),b=Math.sin(y)*h/Math.sin(P.ad(Math.PI-f-y,.01,Math.PI-.01)),I=this.getHorizon(),R=2*Math.atan(I/this.cameraToCenterDistance)*(.5+l.y/(2*I)),V=Math.sin(R)*h/Math.sin(P.ad(Math.PI-f-R,.01,Math.PI-.01)),W=Math.min(b,V),Y=1.01*(Math.cos(Math.PI/2-this._pitch)*W+h),le=this.height/50;k=new Float64Array(16),P.b8(k,this._fov,this.width/this.height,le,Y),k[8]=2*-l.x/this.width,k[9]=2*l.y/this.height,P.a0(k,k,[1,-1,1]),P.$(k,k,[0,0,-this.cameraToCenterDistance]),P.b9(k,k,this._pitch),P.ae(k,k,this.angle),P.$(k,k,[-g,-S,0]),this.mercatorMatrix=P.a0([],k,[this.worldSize,this.worldSize,this.worldSize]),P.a0(k,k,[1,1,this._pixelPerMeter]),this.pixelMatrix=P.a1(new Float64Array(16),this.labelPlaneMatrix,k),P.$(k,k,[0,0,-this.elevation]),this.projMatrix=k,this.invProjMatrix=P.as([],k),this.pixelMatrix3D=P.a1(new Float64Array(16),this.labelPlaneMatrix,k);const fe=this.width%2/2,ye=this.height%2/2,Ie=Math.cos(this.angle),ke=Math.sin(this.angle),qe=g-Math.round(g)+Ie*fe+ke*ye,ut=S-Math.round(S)+Ie*ye+ke*fe,mt=new Float64Array(k);if(P.$(mt,mt,[qe>.5?qe-1:qe,ut>.5?ut-1:ut,0]),this.alignedProjMatrix=mt,k=P.as(new Float64Array(16),this.pixelMatrix),!k)throw new Error("failed to invert matrix");this.pixelMatrixInverse=k,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const l=this.pointCoordinate(new P.P(0,0)),g=[l.x*this.worldSize,l.y*this.worldSize,0,1];return P.ag(g,g,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new P.P(0,l))}getCameraQueryGeometry(l){const g=this.getCameraPoint();if(l.length===1)return[l[0],g];{let S=g.x,k=g.y,F=g.x,Z=g.y;for(const u of l)S=Math.min(S,u.x),k=Math.min(k,u.y),F=Math.max(F,u.x),Z=Math.max(Z,u.y);return[new P.P(S,k),new P.P(F,k),new P.P(F,Z),new P.P(S,Z),new P.P(S,k)]}}}function fo(z,l){let g,S=!1,k=null,F=null;const Z=()=>{k=null,S&&(z.apply(F,g),k=setTimeout(Z,l),S=!1)};return(...u)=>(S=!0,F=this,g=u,k||Z(),k)}class ba{constructor(l){this._getCurrentHash=()=>{const g=window.location.hash.replace("#","");if(this._hashName){let S;return g.split("&").map(k=>k.split("=")).forEach(k=>{k[0]===this._hashName&&(S=k)}),(S&&S[1]||"").split("/")}return g.split("/")},this._onHashChange=()=>{const g=this._getCurrentHash();if(g.length>=3&&!g.some(S=>isNaN(S))){const S=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(g[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+g[2],+g[1]],zoom:+g[0],bearing:S,pitch:+(g[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const g=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,g)}catch{}},this._updateHash=fo(this._updateHashUnthrottled,300),this._hashName=l&&encodeURIComponent(l)}addTo(l){return this._map=l,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(l){const g=this._map.getCenter(),S=Math.round(100*this._map.getZoom())/100,k=Math.ceil((S*Math.LN2+Math.log(512/360/.5))/Math.LN10),F=Math.pow(10,k),Z=Math.round(g.lng*F)/F,u=Math.round(g.lat*F)/F,h=this._map.getBearing(),f=this._map.getPitch();let y="";if(y+=l?`/${Z}/${u}/${S}`:`${S}/${u}/${Z}`,(h||f)&&(y+="/"+Math.round(10*h)/10),f&&(y+=`/${Math.round(f)}`),this._hashName){const b=this._hashName;let I=!1;const R=window.location.hash.slice(1).split("&").map(V=>{const W=V.split("=")[0];return W===b?(I=!0,`${W}=${y}`):V}).filter(V=>V);return I||R.push(`${b}=${y}`),`#${R.join("&")}`}return`#${y}`}}const Fl={linearity:.3,easing:P.ba(0,0,.3,1)},Mt=P.e({deceleration:2500,maxSpeed:1400},Fl),ec=P.e({deceleration:20,maxSpeed:1400},Fl),nl=P.e({deceleration:1e3,maxSpeed:360},Fl),sl=P.e({deceleration:1e3,maxSpeed:90},Fl);class Mc{constructor(l){this._map=l,this.clear()}clear(){this._inertiaBuffer=[]}record(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:P.h.now(),settings:l})}_drainInertiaBuffer(){const l=this._inertiaBuffer,g=P.h.now();for(;l.length>0&&g-l[0].time>160;)l.shift()}_onMoveEnd(l){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const g={zoom:0,bearing:0,pitch:0,pan:new P.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:F}of this._inertiaBuffer)g.zoom+=F.zoomDelta||0,g.bearing+=F.bearingDelta||0,g.pitch+=F.pitchDelta||0,F.panDelta&&g.pan._add(F.panDelta),F.around&&(g.around=F.around),F.pinchAround&&(g.pinchAround=F.pinchAround);const S=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,k={};if(g.pan.mag()){const F=sa(g.pan.mag(),S,P.e({},Mt,l||{}));k.offset=g.pan.mult(F.amount/g.pan.mag()),k.center=this._map.transform.center,po(k,F)}if(g.zoom){const F=sa(g.zoom,S,ec);k.zoom=this._map.transform.zoom+F.amount,po(k,F)}if(g.bearing){const F=sa(g.bearing,S,nl);k.bearing=this._map.transform.bearing+P.ad(F.amount,-179,179),po(k,F)}if(g.pitch){const F=sa(g.pitch,S,sl);k.pitch=this._map.transform.pitch+F.amount,po(k,F)}if(k.zoom||k.bearing){const F=g.pinchAround===void 0?g.around:g.pinchAround;k.around=F?this._map.unproject(F):this._map.getCenter()}return this.clear(),P.e(k,{noMoveStart:!0})}}function po(z,l){(!z.duration||z.duration<l.duration)&&(z.duration=l.duration,z.easing=l.easing)}function sa(z,l,g){const{maxSpeed:S,linearity:k,deceleration:F}=g,Z=P.ad(z*k/(l/1e3),-S,S),u=Math.abs(Z)/(F*k);return{easing:g.easing,duration:1e3*u,amount:Z*(u/2)}}class Bo extends P.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,g,S,k={}){const F=me.mousePos(g.getCanvasContainer(),S),Z=g.unproject(F);super(l,P.e({point:F,lngLat:Z,originalEvent:S},k)),this._defaultPrevented=!1,this.target=g}}class ja extends P.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,g,S){const k=l==="touchend"?S.changedTouches:S.touches,F=me.touchPos(g.getCanvasContainer(),k),Z=F.map(h=>g.unproject(h)),u=F.reduce((h,f,y,b)=>h.add(f.div(b.length)),new P.P(0,0));super(l,{points:F,point:u,lngLats:Z,lngLat:g.unproject(u),originalEvent:S}),this._defaultPrevented=!1}}class RA extends P.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,g,S){super(l,{originalEvent:S}),this._defaultPrevented=!1}}class ol{constructor(l,g){this._map=l,this._clickTolerance=g.clickTolerance}reset(){delete this._mousedownPos}wheel(l){return this._firePreventable(new RA(l.type,this._map,l))}mousedown(l,g){return this._mousedownPos=g,this._firePreventable(new Bo(l.type,this._map,l))}mouseup(l){this._map.fire(new Bo(l.type,this._map,l))}click(l,g){this._mousedownPos&&this._mousedownPos.dist(g)>=this._clickTolerance||this._map.fire(new Bo(l.type,this._map,l))}dblclick(l){return this._firePreventable(new Bo(l.type,this._map,l))}mouseover(l){this._map.fire(new Bo(l.type,this._map,l))}mouseout(l){this._map.fire(new Bo(l.type,this._map,l))}touchstart(l){return this._firePreventable(new ja(l.type,this._map,l))}touchmove(l){this._map.fire(new ja(l.type,this._map,l))}touchend(l){this._map.fire(new ja(l.type,this._map,l))}touchcancel(l){this._map.fire(new ja(l.type,this._map,l))}_firePreventable(l){if(this._map.fire(l),l.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class tc{constructor(l){this._map=l}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(l){this._map.fire(new Bo(l.type,this._map,l))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Bo("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(l){this._delayContextMenu?this._contextMenuEvent=l:this._ignoreContextMenu||this._map.fire(new Bo(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class gl{constructor(l){this._map=l}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(l){return this.transform.pointLocation(P.P.convert(l),this._map.terrain)}}class FA{constructor(l,g){this._map=l,this._tr=new gl(l),this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=g.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(l,g){this.isEnabled()&&l.shiftKey&&l.button===0&&(me.disableDrag(),this._startPos=this._lastPos=g,this._active=!0)}mousemoveWindow(l,g){if(!this._active)return;const S=g;if(this._lastPos.equals(S)||!this._box&&S.dist(this._startPos)<this._clickTolerance)return;const k=this._startPos;this._lastPos=S,this._box||(this._box=me.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",l));const F=Math.min(k.x,S.x),Z=Math.max(k.x,S.x),u=Math.min(k.y,S.y),h=Math.max(k.y,S.y);me.setTransform(this._box,`translate(${F}px,${u}px)`),this._box.style.width=Z-F+"px",this._box.style.height=h-u+"px"}mouseupWindow(l,g){if(!this._active||l.button!==0)return;const S=this._startPos,k=g;if(this.reset(),me.suppressClick(),S.x!==k.x||S.y!==k.y)return this._map.fire(new P.k("boxzoomend",{originalEvent:l})),{cameraAnimation:F=>F.fitScreenCoordinates(S,k,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",l)}keydown(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(me.remove(this._box),this._box=null),me.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(l,g){return this._map.fire(new P.k(l,{originalEvent:g}))}}function Lo(z,l){if(z.length!==l.length)throw new Error(`The number of touches and points are not equal - touches ${z.length}, points ${l.length}`);const g={};for(let S=0;S<z.length;S++)g[z[S].identifier]=l[S];return g}class Xo{constructor(l){this.reset(),this.numTouches=l.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(l,g,S){(this.centroid||S.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=l.timeStamp),S.length===this.numTouches&&(this.centroid=function(k){const F=new P.P(0,0);for(const Z of k)F._add(Z);return F.div(k.length)}(g),this.touches=Lo(S,g)))}touchmove(l,g,S){if(this.aborted||!this.centroid)return;const k=Lo(S,g);for(const F in this.touches){const Z=k[F];(!Z||Z.dist(this.touches[F])>30)&&(this.aborted=!0)}}touchend(l,g,S){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),S.length===0){const k=!this.aborted&&this.centroid;if(this.reset(),k)return k}}}class wa{constructor(l){this.singleTap=new Xo(l),this.numTaps=l.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(l,g,S){this.singleTap.touchstart(l,g,S)}touchmove(l,g,S){this.singleTap.touchmove(l,g,S)}touchend(l,g,S){const k=this.singleTap.touchend(l,g,S);if(k){const F=l.timeStamp-this.lastTime<500,Z=!this.lastTap||this.lastTap.dist(k)<30;if(F&&Z||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=k,this.count===this.numTaps)return this.reset(),k}}}class al{constructor(l){this._tr=new gl(l),this._zoomIn=new wa({numTouches:1,numTaps:2}),this._zoomOut=new wa({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(l,g,S){this._zoomIn.touchstart(l,g,S),this._zoomOut.touchstart(l,g,S)}touchmove(l,g,S){this._zoomIn.touchmove(l,g,S),this._zoomOut.touchmove(l,g,S)}touchend(l,g,S){const k=this._zoomIn.touchend(l,g,S),F=this._zoomOut.touchend(l,g,S),Z=this._tr;return k?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:u=>u.easeTo({duration:300,zoom:Z.zoom+1,around:Z.unproject(k)},{originalEvent:l})}):F?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:u=>u.easeTo({duration:300,zoom:Z.zoom-1,around:Z.unproject(F)},{originalEvent:l})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class yl{constructor(l){this._enabled=!!l.enable,this._moveStateManager=l.moveStateManager,this._clickTolerance=l.clickTolerance||1,this._moveFunction=l.move,this._activateOnStart=!!l.activateOnStart,l.assignEvents(this),this.reset()}reset(l){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(l)}_move(...l){const g=this._moveFunction(...l);if(g.bearingDelta||g.pitchDelta||g.around||g.panDelta)return this._active=!0,g}dragStart(l,g){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(l)&&(this._moveStateManager.startMove(l),this._lastPoint=g.length?g[0]:g,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(l,g){if(!this.isEnabled())return;const S=this._lastPoint;if(!S)return;if(l.preventDefault(),!this._moveStateManager.isValidMoveEvent(l))return void this.reset(l);const k=g.length?g[0]:g;return!this._moved&&k.dist(S)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=k,this._move(S,k))}dragEnd(l){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(l)&&(this._moved&&me.suppressClick(),this.reset(l))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const vu={0:1,2:2};class ic{constructor(l){this._correctEvent=l.checkCorrectEvent}startMove(l){const g=me.mouseButton(l);this._eventButton=g}endMove(l){delete this._eventButton}isValidStartEvent(l){return this._correctEvent(l)}isValidMoveEvent(l){return!function(g,S){const k=vu[S];return g.buttons===void 0||(g.buttons&k)!==k}(l,this._eventButton)}isValidEndEvent(l){return me.mouseButton(l)===this._eventButton}}class Jc{constructor(){this._firstTouch=void 0}_isOneFingerTouch(l){return l.targetTouches.length===1}_isSameTouchEvent(l){return l.targetTouches[0].identifier===this._firstTouch}startMove(l){this._firstTouch=l.targetTouches[0].identifier}endMove(l){delete this._firstTouch}isValidStartEvent(l){return this._isOneFingerTouch(l)}isValidMoveEvent(l){return this._isOneFingerTouch(l)&&this._isSameTouchEvent(l)}isValidEndEvent(l){return this._isOneFingerTouch(l)&&this._isSameTouchEvent(l)}}const tA=z=>{z.mousedown=z.dragStart,z.mousemoveWindow=z.dragMove,z.mouseup=z.dragEnd,z.contextmenu=function(l){l.preventDefault()}},ll=({enable:z,clickTolerance:l,bearingDegreesPerPixelMoved:g=.8})=>{const S=new ic({checkCorrectEvent:k=>me.mouseButton(k)===0&&k.ctrlKey||me.mouseButton(k)===2});return new yl({clickTolerance:l,move:(k,F)=>({bearingDelta:(F.x-k.x)*g}),moveStateManager:S,enable:z,assignEvents:tA})},Ga=({enable:z,clickTolerance:l,pitchDegreesPerPixelMoved:g=-.5})=>{const S=new ic({checkCorrectEvent:k=>me.mouseButton(k)===0&&k.ctrlKey||me.mouseButton(k)===2});return new yl({clickTolerance:l,move:(k,F)=>({pitchDelta:(F.y-k.y)*g}),moveStateManager:S,enable:z,assignEvents:tA})};class Vi{constructor(l,g){this._minTouches=l.cooperativeGestures?2:1,this._clickTolerance=l.clickTolerance||1,this._map=g,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new P.P(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(l,g,S){return this._calculateTransform(l,g,S)}touchmove(l,g,S){if(this._map._cooperativeGestures&&(this._minTouches===2&&S.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(l,!1,S.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(S.length<this._minTouches))return l.preventDefault(),this._calculateTransform(l,g,S)}touchend(l,g,S){this._calculateTransform(l,g,S),this._active&&S.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(l,g,S){S.length>0&&(this._active=!0);const k=Lo(S,g),F=new P.P(0,0),Z=new P.P(0,0);let u=0;for(const f in k){const y=k[f],b=this._touches[f];b&&(F._add(y),Z._add(y.sub(b)),u++,k[f]=y)}if(this._touches=k,u<this._minTouches||!Z.mag())return;const h=Z.div(u);return this._sum._add(h),this._sum.mag()<this._clickTolerance?void 0:{around:F.div(u),panDelta:h}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ro{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(l,g,S){this._firstTwoTouches||S.length<2||(this._firstTwoTouches=[S[0].identifier,S[1].identifier],this._start([g[0],g[1]]))}touchmove(l,g,S){if(!this._firstTwoTouches)return;l.preventDefault();const[k,F]=this._firstTwoTouches,Z=Za(S,g,k),u=Za(S,g,F);if(!Z||!u)return;const h=this._aroundCenter?null:Z.add(u).div(2);return this._move([Z,u],h,l)}touchend(l,g,S){if(!this._firstTwoTouches)return;const[k,F]=this._firstTwoTouches,Z=Za(S,g,k),u=Za(S,g,F);Z&&u||(this._active&&me.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Za(z,l,g){for(let S=0;S<z.length;S++)if(z[S].identifier===g)return l[S]}function Al(z,l){return Math.log(z/l)/Math.LN2}class rc extends Ro{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(l){this._startDistance=this._distance=l[0].dist(l[1])}_move(l,g){const S=this._distance;if(this._distance=l[0].dist(l[1]),this._active||!(Math.abs(Al(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Al(this._distance,S),pinchAround:g}}}function Si(z,l){return 180*z.angleWith(l)/Math.PI}class iA extends Ro{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(l){this._startVector=this._vector=l[0].sub(l[1]),this._minDiameter=l[0].dist(l[1])}_move(l,g){const S=this._vector;if(this._vector=l[0].sub(l[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Si(this._vector,S),pinchAround:g}}_isBelowThreshold(l){this._minDiameter=Math.min(this._minDiameter,l.mag());const g=25/(Math.PI*this._minDiameter)*360,S=Si(l,this._startVector);return Math.abs(S)<g}}function OA(z){return Math.abs(z.y)>Math.abs(z.x)}class oa extends Ro{constructor(l){super(),this._map=l}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(l,g,S){super.touchstart(l,g,S),this._currentTouchCount=S.length}_start(l){this._lastPoints=l,OA(l[0].sub(l[1]))&&(this._valid=!1)}_move(l,g,S){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const k=l[0].sub(this._lastPoints[0]),F=l[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(k,F,S.timeStamp),this._valid?(this._lastPoints=l,this._active=!0,{pitchDelta:(k.y+F.y)/2*-.5}):void 0}gestureBeginsVertically(l,g,S){if(this._valid!==void 0)return this._valid;const k=l.mag()>=2,F=g.mag()>=2;if(!k&&!F)return;if(!k||!F)return this._firstMove===void 0&&(this._firstMove=S),S-this._firstMove<100&&void 0;const Z=l.y>0==g.y>0;return OA(l)&&OA(g)&&Z}}const _A={panStep:100,bearingStep:15,pitchStep:10};class nc{constructor(l){this._tr=new gl(l);const g=_A;this._panStep=g.panStep,this._bearingStep=g.bearingStep,this._pitchStep=g.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(l){if(l.altKey||l.ctrlKey||l.metaKey)return;let g=0,S=0,k=0,F=0,Z=0;switch(l.keyCode){case 61:case 107:case 171:case 187:g=1;break;case 189:case 109:case 173:g=-1;break;case 37:l.shiftKey?S=-1:(l.preventDefault(),F=-1);break;case 39:l.shiftKey?S=1:(l.preventDefault(),F=1);break;case 38:l.shiftKey?k=1:(l.preventDefault(),Z=-1);break;case 40:l.shiftKey?k=-1:(l.preventDefault(),Z=1);break;default:return}return this._rotationDisabled&&(S=0,k=0),{cameraAnimation:u=>{const h=this._tr;u.easeTo({duration:300,easeId:"keyboardHandler",easing:VA,zoom:g?Math.round(h.zoom)+g*(l.shiftKey?2:1):h.zoom,bearing:h.bearing+S*this._bearingStep,pitch:h.pitch+k*this._pitchStep,offset:[-F*this._panStep,-Z*this._panStep],center:h.center},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function VA(z){return z*(2-z)}const sc=4.000244140625;class Ms{constructor(l,g){this._onTimeout=S=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(S)},this._map=l,this._tr=new gl(l),this._el=l.getCanvasContainer(),this._triggerRenderFrame=g,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(l){this._defaultZoomRate=l}setWheelZoomRate(l){this._wheelZoomRate=l}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!l&&l.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(l){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!l[this._map._metaKey])return;l.preventDefault()}let g=l.deltaMode===WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY;const S=P.h.now(),k=S-(this._lastWheelEventTime||0);this._lastWheelEventTime=S,g!==0&&g%sc==0?this._type="wheel":g!==0&&Math.abs(g)<4?this._type="trackpad":k>400?(this._type=null,this._lastValue=g,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(k*g)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,g+=this._lastValue)),l.shiftKey&&g&&(g/=4),this._type&&(this._lastWheelEvent=l,this._delta-=g,this._active||this._start(l)),l.preventDefault()}_start(l){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const g=me.mousePos(this._el,l),S=this._tr;this._around=P.L.convert(this._aroundCenter?S.center:S.unproject(g)),this._aroundPoint=S.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const l=this._tr.transform;if(this._delta!==0){const u=this._type==="wheel"&&Math.abs(this._delta)>sc?this._wheelZoomRate:this._defaultZoomRate;let h=2/(1+Math.exp(-Math.abs(this._delta*u)));this._delta<0&&h!==0&&(h=1/h);const f=typeof this._targetZoom=="number"?l.zoomScale(this._targetZoom):l.scale;this._targetZoom=Math.min(l.maxZoom,Math.max(l.minZoom,l.scaleZoom(f*h))),this._type==="wheel"&&(this._startZoom=l.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const g=typeof this._targetZoom=="number"?this._targetZoom:l.zoom,S=this._startZoom,k=this._easing;let F,Z=!1;if(this._type==="wheel"&&S&&k){const u=Math.min((P.h.now()-this._lastWheelEventTime)/200,1),h=k(u);F=P.B.number(S,g,h),u<1?this._frameId||(this._frameId=!0):Z=!0}else F=g,Z=!0;return this._active=!0,Z&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!Z,zoomDelta:F-l.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(l){let g=P.bb;if(this._prevEase){const S=this._prevEase,k=(P.h.now()-S.start)/S.duration,F=S.easing(k+.01)-S.easing(k),Z=.27/Math.sqrt(F*F+1e-4)*.01,u=Math.sqrt(.0729-Z*Z);g=P.ba(Z,u,.25,1)}return this._prevEase={start:P.h.now(),duration:l,easing:g},g}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class gA{constructor(l,g){this._clickZoom=l,this._tapZoom=g}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class NA{constructor(l){this._tr=new gl(l),this.reset()}reset(){this._active=!1}dblclick(l,g){return l.preventDefault(),{cameraAnimation:S=>{S.easeTo({duration:300,zoom:this._tr.zoom+(l.shiftKey?-1:1),around:this._tr.unproject(g)},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class UA{constructor(){this._tap=new wa({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(l,g,S){if(!this._swipePoint)if(this._tapTime){const k=g[0],F=l.timeStamp-this._tapTime<500,Z=this._tapPoint.dist(k)<30;F&&Z?S.length>0&&(this._swipePoint=k,this._swipeTouch=S[0].identifier):this.reset()}else this._tap.touchstart(l,g,S)}touchmove(l,g,S){if(this._tapTime){if(this._swipePoint){if(S[0].identifier!==this._swipeTouch)return;const k=g[0],F=k.y-this._swipePoint.y;return this._swipePoint=k,l.preventDefault(),this._active=!0,{zoomDelta:F/128}}}else this._tap.touchmove(l,g,S)}touchend(l,g,S){if(this._tapTime)this._swipePoint&&S.length===0&&this.reset();else{const k=this._tap.touchend(l,g,S);k&&(this._tapTime=l.timeStamp,this._tapPoint=k)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ji{constructor(l,g,S){this._el=l,this._mousePan=g,this._touchPan=S}enable(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class To{constructor(l,g,S){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=g,this._mousePitch=S}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Ta{constructor(l,g,S,k){this._el=l,this._touchZoom=g,this._touchRotate=S,this._tapDragZoom=k,this._rotationDisabled=!1,this._enabled=!0}enable(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const rA=z=>z.zoom||z.drag||z.pitch||z.rotate;class oc extends P.k{}function nA(z){return z.panDelta&&z.panDelta.mag()||z.zoomDelta||z.bearingDelta||z.pitchDelta}class xl{constructor(l,g){this.handleWindowEvent=k=>{this.handleEvent(k,`${k.type}Window`)},this.handleEvent=(k,F)=>{if(k.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const Z=k.type==="renderFrame"?void 0:k,u={needsRenderFrame:!1},h={},f={},y=k.touches,b=y?this._getMapTouches(y):void 0,I=b?me.touchPos(this._el,b):me.mousePos(this._el,k);for(const{handlerName:W,handler:Y,allowed:le}of this._handlers){if(!Y.isEnabled())continue;let fe;this._blockedByActive(f,le,W)?Y.reset():Y[F||k.type]&&(fe=Y[F||k.type](k,I,b),this.mergeHandlerResult(u,h,fe,W,Z),fe&&fe.needsRenderFrame&&this._triggerRenderFrame()),(fe||Y.isActive())&&(f[W]=Y)}const R={};for(const W in this._previousActiveHandlers)f[W]||(R[W]=Z);this._previousActiveHandlers=f,(Object.keys(R).length||nA(u))&&(this._changes.push([u,h,R]),this._triggerRenderFrame()),(Object.keys(f).length||nA(u))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:V}=u;V&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],V(this._map))},this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Mc(l),this._bearingSnap=g.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(g);const S=this._el;this._listeners=[[S,"touchstart",{passive:!0}],[S,"touchmove",{passive:!1}],[S,"touchend",void 0],[S,"touchcancel",void 0],[S,"mousedown",void 0],[S,"mousemove",void 0],[S,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[S,"mouseover",void 0],[S,"mouseout",void 0],[S,"dblclick",void 0],[S,"click",void 0],[S,"keydown",{capture:!1}],[S,"keyup",void 0],[S,"wheel",{passive:!1}],[S,"contextmenu",void 0],[window,"blur",void 0]];for(const[k,F,Z]of this._listeners)me.addEventListener(k,F,k===document?this.handleWindowEvent:this.handleEvent,Z)}destroy(){for(const[l,g,S]of this._listeners)me.removeEventListener(l,g,l===document?this.handleWindowEvent:this.handleEvent,S)}_addDefaultHandlers(l){const g=this._map,S=g.getCanvasContainer();this._add("mapEvent",new ol(g,l));const k=g.boxZoom=new FA(g,l);this._add("boxZoom",k),l.interactive&&l.boxZoom&&k.enable();const F=new al(g),Z=new NA(g);g.doubleClickZoom=new gA(Z,F),this._add("tapZoom",F),this._add("clickZoom",Z),l.interactive&&l.doubleClickZoom&&g.doubleClickZoom.enable();const u=new UA;this._add("tapDragZoom",u);const h=g.touchPitch=new oa(g);this._add("touchPitch",h),l.interactive&&l.touchPitch&&g.touchPitch.enable(l.touchPitch);const f=ll(l),y=Ga(l);g.dragRotate=new To(l,f,y),this._add("mouseRotate",f,["mousePitch"]),this._add("mousePitch",y,["mouseRotate"]),l.interactive&&l.dragRotate&&g.dragRotate.enable();const b=(({enable:le,clickTolerance:fe})=>{const ye=new ic({checkCorrectEvent:Ie=>me.mouseButton(Ie)===0&&!Ie.ctrlKey});return new yl({clickTolerance:fe,move:(Ie,ke)=>({around:ke,panDelta:ke.sub(Ie)}),activateOnStart:!0,moveStateManager:ye,enable:le,assignEvents:tA})})(l),I=new Vi(l,g);g.dragPan=new Ji(S,b,I),this._add("mousePan",b),this._add("touchPan",I,["touchZoom","touchRotate"]),l.interactive&&l.dragPan&&g.dragPan.enable(l.dragPan);const R=new iA,V=new rc;g.touchZoomRotate=new Ta(S,V,R,u),this._add("touchRotate",R,["touchPan","touchZoom"]),this._add("touchZoom",V,["touchPan","touchRotate"]),l.interactive&&l.touchZoomRotate&&g.touchZoomRotate.enable(l.touchZoomRotate);const W=g.scrollZoom=new Ms(g,()=>this._triggerRenderFrame());this._add("scrollZoom",W,["mousePan"]),l.interactive&&l.scrollZoom&&g.scrollZoom.enable(l.scrollZoom);const Y=g.keyboard=new nc(g);this._add("keyboard",Y),l.interactive&&l.keyboard&&g.keyboard.enable(),this._add("blockableMapEvent",new tc(g))}_add(l,g,S){this._handlers.push({handlerName:l,handler:g,allowed:S}),this._handlersById[l]=g}stop(l){if(!this._updatingCamera){for(const{handler:g}of this._handlers)g.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[]}}isActive(){for(const{handler:l}of this._handlers)if(l.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!rA(this._eventsInProgress)||this.isZooming()}_blockedByActive(l,g,S){for(const k in l)if(k!==S&&(!g||g.indexOf(k)<0))return!0;return!1}_getMapTouches(l){const g=[];for(const S of l)this._el.contains(S.target)&&g.push(S);return g}mergeHandlerResult(l,g,S,k,F){if(!S)return;P.e(l,S);const Z={handlerName:k,originalEvent:S.originalEvent||F};S.zoomDelta!==void 0&&(g.zoom=Z),S.panDelta!==void 0&&(g.drag=Z),S.pitchDelta!==void 0&&(g.pitch=Z),S.bearingDelta!==void 0&&(g.rotate=Z)}_applyChanges(){const l={},g={},S={};for(const[k,F,Z]of this._changes)k.panDelta&&(l.panDelta=(l.panDelta||new P.P(0,0))._add(k.panDelta)),k.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+k.zoomDelta),k.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+k.bearingDelta),k.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+k.pitchDelta),k.around!==void 0&&(l.around=k.around),k.pinchAround!==void 0&&(l.pinchAround=k.pinchAround),k.noInertia&&(l.noInertia=k.noInertia),P.e(g,F),P.e(S,Z);this._updateMapTransform(l,g,S),this._changes=[]}_updateMapTransform(l,g,S){const k=this._map,F=k._getTransformForUpdate(),Z=k.terrain;if(!(nA(l)||Z&&this._terrainMovement))return this._fireEvents(g,S,!0);let{panDelta:u,zoomDelta:h,bearingDelta:f,pitchDelta:y,around:b,pinchAround:I}=l;I!==void 0&&(b=I),k._stop(!0),b=b||k.transform.centerPoint;const R=F.pointLocation(u?b.sub(u):b);f&&(F.bearing+=f),y&&(F.pitch+=y),h&&(F.zoom+=h),Z?this._terrainMovement||!g.drag&&!g.zoom?g.drag&&this._terrainMovement?F.center=F.pointLocation(F.centerPoint.sub(u)):F.setLocationAtPoint(R,b):(this._terrainMovement=!0,this._map._elevationFreeze=!0,F.setLocationAtPoint(R,b),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,F.recalculateZoom(k.terrain)})):F.setLocationAtPoint(R,b),k._applyUpdatedTransform(F),this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(g,S,!0)}_fireEvents(l,g,S){const k=rA(this._eventsInProgress),F=rA(l),Z={};for(const y in l){const{originalEvent:b}=l[y];this._eventsInProgress[y]||(Z[`${y}start`]=b),this._eventsInProgress[y]=l[y]}!k&&F&&this._fireEvent("movestart",F.originalEvent);for(const y in Z)this._fireEvent(y,Z[y]);F&&this._fireEvent("move",F.originalEvent);for(const y in l){const{originalEvent:b}=l[y];this._fireEvent(y,b)}const u={};let h;for(const y in this._eventsInProgress){const{handlerName:b,originalEvent:I}=this._eventsInProgress[y];this._handlersById[b].isActive()||(delete this._eventsInProgress[y],h=g[b]||I,u[`${y}end`]=h)}for(const y in u)this._fireEvent(y,u[y]);const f=rA(this._eventsInProgress);if(S&&(k||F)&&!f){this._updatingCamera=!0;const y=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),b=I=>I!==0&&-this._bearingSnap<I&&I<this._bearingSnap;!y||!y.essential&&P.h.prefersReducedMotion?(this._map.fire(new P.k("moveend",{originalEvent:h})),b(this._map.getBearing())&&this._map.resetNorth()):(b(y.bearing||this._map.getBearing())&&(y.bearing=0),y.freezeElevation=!0,this._map.easeTo(y,{originalEvent:h})),this._updatingCamera=!1}}_fireEvent(l,g){this._map.fire(new P.k(l,g?{originalEvent:g}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(l=>{delete this._frameId,this.handleEvent(new oc("renderFrame",{timeStamp:l})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Ss extends P.E{constructor(l,g){super(),this._renderFrameCallback=()=>{const S=Math.min((P.h.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(S)),S<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=l,this._bearingSnap=g.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new P.L(this.transform.center.lng,this.transform.center.lat)}setCenter(l,g){return this.jumpTo({center:l},g)}panBy(l,g,S){return l=P.P.convert(l).mult(-1),this.panTo(this.transform.center,P.e({offset:l},g),S)}panTo(l,g,S){return this.easeTo(P.e({center:l},g),S)}getZoom(){return this.transform.zoom}setZoom(l,g){return this.jumpTo({zoom:l},g),this}zoomTo(l,g,S){return this.easeTo(P.e({zoom:l},g),S)}zoomIn(l,g){return this.zoomTo(this.getZoom()+1,l,g),this}zoomOut(l,g){return this.zoomTo(this.getZoom()-1,l,g),this}getBearing(){return this.transform.bearing}setBearing(l,g){return this.jumpTo({bearing:l},g),this}getPadding(){return this.transform.padding}setPadding(l,g){return this.jumpTo({padding:l},g),this}rotateTo(l,g,S){return this.easeTo(P.e({bearing:l},g),S)}resetNorth(l,g){return this.rotateTo(0,P.e({duration:1e3},l),g),this}resetNorthPitch(l,g){return this.easeTo(P.e({bearing:0,pitch:0,duration:1e3},l),g),this}snapToNorth(l,g){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(l,g):this}getPitch(){return this.transform.pitch}setPitch(l,g){return this.jumpTo({pitch:l},g),this}cameraForBounds(l,g){l=Yr.convert(l);const S=g&&g.bearing||0;return this._cameraForBoxAndBearing(l.getNorthWest(),l.getSouthEast(),S,g)}_cameraForBoxAndBearing(l,g,S,k){const F={top:0,bottom:0,right:0,left:0};if(typeof(k=P.e({padding:F,offset:[0,0],maxZoom:this.transform.maxZoom},k)).padding=="number"){const ke=k.padding;k.padding={top:ke,bottom:ke,right:ke,left:ke}}k.padding=P.e(F,k.padding);const Z=this.transform,u=Z.padding,h=Z.project(P.L.convert(l)),f=Z.project(P.L.convert(g)),y=h.rotate(-S*Math.PI/180),b=f.rotate(-S*Math.PI/180),I=new P.P(Math.max(y.x,b.x),Math.max(y.y,b.y)),R=new P.P(Math.min(y.x,b.x),Math.min(y.y,b.y)),V=I.sub(R),W=(Z.width-(u.left+u.right+k.padding.left+k.padding.right))/V.x,Y=(Z.height-(u.top+u.bottom+k.padding.top+k.padding.bottom))/V.y;if(Y<0||W<0)return void P.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const le=Math.min(Z.scaleZoom(Z.scale*Math.min(W,Y)),k.maxZoom),fe=P.P.convert(k.offset),ye=new P.P((k.padding.left-k.padding.right)/2,(k.padding.top-k.padding.bottom)/2).rotate(S*Math.PI/180),Ie=fe.add(ye).mult(Z.scale/Z.zoomScale(le));return{center:Z.unproject(h.add(f).div(2).sub(Ie)),zoom:le,bearing:S}}fitBounds(l,g,S){return this._fitInternal(this.cameraForBounds(l,g),g,S)}fitScreenCoordinates(l,g,S,k,F){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(P.P.convert(l)),this.transform.pointLocation(P.P.convert(g)),S,k),k,F)}_fitInternal(l,g,S){return l?(delete(g=P.e(l,g)).padding,g.linear?this.easeTo(g,S):this.flyTo(g,S)):this}jumpTo(l,g){this.stop();const S=this._getTransformForUpdate();let k=!1,F=!1,Z=!1;return"zoom"in l&&S.zoom!==+l.zoom&&(k=!0,S.zoom=+l.zoom),l.center!==void 0&&(S.center=P.L.convert(l.center)),"bearing"in l&&S.bearing!==+l.bearing&&(F=!0,S.bearing=+l.bearing),"pitch"in l&&S.pitch!==+l.pitch&&(Z=!0,S.pitch=+l.pitch),l.padding==null||S.isPaddingEqual(l.padding)||(S.padding=l.padding),this._applyUpdatedTransform(S),this.fire(new P.k("movestart",g)).fire(new P.k("move",g)),k&&this.fire(new P.k("zoomstart",g)).fire(new P.k("zoom",g)).fire(new P.k("zoomend",g)),F&&this.fire(new P.k("rotatestart",g)).fire(new P.k("rotate",g)).fire(new P.k("rotateend",g)),Z&&this.fire(new P.k("pitchstart",g)).fire(new P.k("pitch",g)).fire(new P.k("pitchend",g)),this.fire(new P.k("moveend",g))}calculateCameraOptionsFromTo(l,g,S,k=0){const F=P.U.fromLngLat(l,g),Z=P.U.fromLngLat(S,k),u=Z.x-F.x,h=Z.y-F.y,f=Z.z-F.z,y=Math.hypot(u,h,f);if(y===0)throw new Error("Can't calculate camera options with same From and To");const b=Math.hypot(u,h),I=this.transform.scaleZoom(this.transform.cameraToCenterDistance/y/this.transform.tileSize),R=180*Math.atan2(u,-h)/Math.PI;let V=180*Math.acos(b/y)/Math.PI;return V=f<0?90-V:90+V,{center:Z.toLngLat(),zoom:I,pitch:V,bearing:R}}easeTo(l,g){this._stop(!1,l.easeId),((l=P.e({offset:[0,0],duration:500,easing:P.bb},l)).animate===!1||!l.essential&&P.h.prefersReducedMotion)&&(l.duration=0);const S=this._getTransformForUpdate(),k=this.getZoom(),F=this.getBearing(),Z=this.getPitch(),u=this.getPadding(),h="zoom"in l?+l.zoom:k,f="bearing"in l?this._normalizeBearing(l.bearing,F):F,y="pitch"in l?+l.pitch:Z,b="padding"in l?l.padding:S.padding,I=P.P.convert(l.offset);let R=S.centerPoint.add(I);const V=S.pointLocation(R),W=P.L.convert(l.center||V);this._normalizeCenter(W);const Y=S.project(V),le=S.project(W).sub(Y),fe=S.zoomScale(h-k);let ye,Ie;l.around&&(ye=P.L.convert(l.around),Ie=S.locationPoint(ye));const ke={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||h!==k,this._rotating=this._rotating||F!==f,this._pitching=this._pitching||y!==Z,this._padding=!S.isPaddingEqual(b),this._easeId=l.easeId,this._prepareEase(g,l.noMoveStart,ke),this.terrain&&this._prepareElevation(W),this._ease(qe=>{if(this._zooming&&(S.zoom=P.B.number(k,h,qe)),this._rotating&&(S.bearing=P.B.number(F,f,qe)),this._pitching&&(S.pitch=P.B.number(Z,y,qe)),this._padding&&(S.interpolatePadding(u,b,qe),R=S.centerPoint.add(I)),this.terrain&&!l.freezeElevation&&this._updateElevation(qe),ye)S.setLocationAtPoint(ye,Ie);else{const ut=S.zoomScale(S.zoom-k),mt=h>k?Math.min(2,fe):Math.max(.5,fe),st=Math.pow(mt,1-qe),ht=S.unproject(Y.add(le.mult(qe*st)).mult(ut));S.setLocationAtPoint(S.renderWorldCopies?ht.wrap():ht,R)}this._applyUpdatedTransform(S),this._fireMoveEvents(g)},qe=>{this.terrain&&this._finalizeElevation(),this._afterEase(g,qe)},l),this}_prepareEase(l,g,S={}){this._moving=!0,g||S.moving||this.fire(new P.k("movestart",l)),this._zooming&&!S.zooming&&this.fire(new P.k("zoomstart",l)),this._rotating&&!S.rotating&&this.fire(new P.k("rotatestart",l)),this._pitching&&!S.pitching&&this.fire(new P.k("pitchstart",l))}_prepareElevation(l){this._elevationCenter=l,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(l,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(l){this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const g=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(l<1&&g!==this._elevationTarget){const S=this._elevationTarget-this._elevationStart;this._elevationStart+=l*(S-(g-(S*l+this._elevationStart))/(1-l)),this._elevationTarget=g}this.transform.elevation=P.B.number(this._elevationStart,this._elevationTarget,l)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(l){if(!this.transformCameraUpdate)return;const g=l.clone(),{center:S,zoom:k,pitch:F,bearing:Z,elevation:u}=this.transformCameraUpdate(g);S&&(g.center=S),k!==void 0&&(g.zoom=k),F!==void 0&&(g.pitch=F),Z!==void 0&&(g.bearing=Z),u!==void 0&&(g.elevation=u),this.transform.apply(g)}_fireMoveEvents(l){this.fire(new P.k("move",l)),this._zooming&&this.fire(new P.k("zoom",l)),this._rotating&&this.fire(new P.k("rotate",l)),this._pitching&&this.fire(new P.k("pitch",l))}_afterEase(l,g){if(this._easeId&&g&&this._easeId===g)return;delete this._easeId;const S=this._zooming,k=this._rotating,F=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,S&&this.fire(new P.k("zoomend",l)),k&&this.fire(new P.k("rotateend",l)),F&&this.fire(new P.k("pitchend",l)),this.fire(new P.k("moveend",l))}flyTo(l,g){if(!l.essential&&P.h.prefersReducedMotion){const Gt=P.F(l,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Gt,g)}this.stop(),l=P.e({offset:[0,0],speed:1.2,curve:1.42,easing:P.bb},l);const S=this._getTransformForUpdate(),k=this.getZoom(),F=this.getBearing(),Z=this.getPitch(),u=this.getPadding(),h="zoom"in l?P.ad(+l.zoom,S.minZoom,S.maxZoom):k,f="bearing"in l?this._normalizeBearing(l.bearing,F):F,y="pitch"in l?+l.pitch:Z,b="padding"in l?l.padding:S.padding,I=S.zoomScale(h-k),R=P.P.convert(l.offset);let V=S.centerPoint.add(R);const W=S.pointLocation(V),Y=P.L.convert(l.center||W);this._normalizeCenter(Y);const le=S.project(W),fe=S.project(Y).sub(le);let ye=l.curve;const Ie=Math.max(S.width,S.height),ke=Ie/I,qe=fe.mag();if("minZoom"in l){const Gt=P.ad(Math.min(l.minZoom,k,h),S.minZoom,S.maxZoom),lr=Ie/S.zoomScale(Gt-k);ye=Math.sqrt(lr/qe*2)}const ut=ye*ye;function mt(Gt){const lr=(ke*ke-Ie*Ie+(Gt?-1:1)*ut*ut*qe*qe)/(2*(Gt?ke:Ie)*ut*qe);return Math.log(Math.sqrt(lr*lr+1)-lr)}function st(Gt){return(Math.exp(Gt)-Math.exp(-Gt))/2}function ht(Gt){return(Math.exp(Gt)+Math.exp(-Gt))/2}const ft=mt(!1);let Ai=function(Gt){return ht(ft)/ht(ft+ye*Gt)},Nt=function(Gt){return Ie*((ht(ft)*(st(lr=ft+ye*Gt)/ht(lr))-st(ft))/ut)/qe;var lr},Wt=(mt(!0)-ft)/ye;if(Math.abs(qe)<1e-6||!isFinite(Wt)){if(Math.abs(Ie-ke)<1e-6)return this.easeTo(l,g);const Gt=ke<Ie?-1:1;Wt=Math.abs(Math.log(ke/Ie))/ye,Nt=function(){return 0},Ai=function(lr){return Math.exp(Gt*ye*lr)}}return l.duration="duration"in l?+l.duration:1e3*Wt/("screenSpeed"in l?+l.screenSpeed/ye:+l.speed),l.maxDuration&&l.duration>l.maxDuration&&(l.duration=0),this._zooming=!0,this._rotating=F!==f,this._pitching=y!==Z,this._padding=!S.isPaddingEqual(b),this._prepareEase(g,!1),this.terrain&&this._prepareElevation(Y),this._ease(Gt=>{const lr=Gt*Wt,Hi=1/Ai(lr);S.zoom=Gt===1?h:k+S.scaleZoom(Hi),this._rotating&&(S.bearing=P.B.number(F,f,Gt)),this._pitching&&(S.pitch=P.B.number(Z,y,Gt)),this._padding&&(S.interpolatePadding(u,b,Gt),V=S.centerPoint.add(R)),this.terrain&&!l.freezeElevation&&this._updateElevation(Gt);const Zi=Gt===1?Y:S.unproject(le.add(fe.mult(Nt(lr))).mult(Hi));S.setLocationAtPoint(S.renderWorldCopies?Zi.wrap():Zi,V),this._applyUpdatedTransform(S),this._fireMoveEvents(g)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(g)},l),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(l,g){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const S=this._onEaseEnd;delete this._onEaseEnd,S.call(this,g)}if(!l){const S=this.handlers;S&&S.stop(!1)}return this}_ease(l,g,S){S.animate===!1||S.duration===0?(l(1),g()):(this._easeStart=P.h.now(),this._easeOptions=S,this._onEaseFrame=l,this._onEaseEnd=g,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(l,g){l=P.b5(l,-180,180);const S=Math.abs(l-g);return Math.abs(l-360-g)<S&&(l-=360),Math.abs(l+360-g)<S&&(l+=360),l}_normalizeCenter(l){const g=this.transform;if(!g.renderWorldCopies||g.lngRange)return;const S=l.lng-g.center.lng;l.lng+=S>180?-360:S<-180?360:0}queryTerrainElevation(l){return this.terrain?this.terrain.getElevationForLngLatZoom(P.L.convert(l),this.transform.tileZoom)-this.transform.elevation:null}}class aa{constructor(l={}){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=g=>{!g||g.sourceDataType!=="metadata"&&g.sourceDataType!=="visibility"&&g.dataType!=="style"&&g.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=l}getDefaultPosition(){return"bottom-right"}onAdd(l){return this._map=l,this._compact=this.options&&this.options.compact,this._container=me.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=me.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=me.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){me.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(l,g){const S=this._map._getUIString(`AttributionControl.${g}`);l.title=S,l.setAttribute("aria-label",S)}_updateAttributions(){if(!this._map.style)return;let l=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=l.concat(this.options.customAttribution.map(k=>typeof k!="string"?"":k)):typeof this.options.customAttribution=="string"&&l.push(this.options.customAttribution)),this._map.style.stylesheet){const k=this._map.style.stylesheet;this.styleOwner=k.owner,this.styleId=k.id}const g=this._map.style.sourceCaches;for(const k in g){const F=g[k];if(F.used||F.usedForTerrain){const Z=F.getSource();Z.attribution&&l.indexOf(Z.attribution)<0&&l.push(Z.attribution)}}l=l.filter(k=>String(k).trim()),l.sort((k,F)=>k.length-F.length),l=l.filter((k,F)=>{for(let Z=F+1;Z<l.length;Z++)if(l[Z].indexOf(k)>=0)return!1;return!0});const S=l.join(" | ");S!==this._attribHTML&&(this._attribHTML=S,l.length?(this._innerContainer.innerHTML=S,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Gn{constructor(l={}){this._updateCompact=()=>{const g=this._container.children;if(g.length){const S=g[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&S.classList.add("maplibregl-compact"):S.classList.remove("maplibregl-compact")}},this.options=l}getDefaultPosition(){return"bottom-left"}onAdd(l){this._map=l,this._compact=this.options&&this.options.compact,this._container=me.create("div","maplibregl-ctrl");const g=me.create("a","maplibregl-ctrl-logo");return g.target="_blank",g.rel="noopener nofollow",g.href="https://maplibre.org/",g.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),g.setAttribute("rel","noopener nofollow"),this._container.appendChild(g),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){me.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class mo{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(l){const g=++this._id;return this._queue.push({callback:l,id:g,cancelled:!1}),g}remove(l){const g=this._currentlyRunning,S=g?this._queue.concat(g):this._queue;for(const k of S)if(k.id===l)return void(k.cancelled=!0)}run(l=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const g=this._currentlyRunning=this._queue;this._queue=[];for(const S of g)if(!S.cancelled&&(S.callback(l),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const mr={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"};var Yo=P.Q([{name:"a_pos3d",type:"Int16",components:3}]);class ac extends P.E{constructor(l){super(),this.sourceCache=l,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,l.usedForTerrain=!0,l.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(l,g){this.sourceCache.update(l,g),this._renderableTilesKeys=[];const S={};for(const k of l.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:g}))S[k.key]=!0,this._renderableTilesKeys.push(k.key),this._tiles[k.key]||(k.posMatrix=new Float64Array(16),P.aS(k.posMatrix,0,P.N,0,P.N,0,1),this._tiles[k.key]=new Ue(k,this.tileSize));for(const k in this._tiles)S[k]||delete this._tiles[k]}freeRtt(l){for(const g in this._tiles){const S=this._tiles[g];(!l||S.tileID.equals(l)||S.tileID.isChildOf(l)||l.isChildOf(S.tileID))&&(S.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(l=>this.getTileByID(l))}getTileByID(l){return this._tiles[l]}getTerrainCoords(l){const g={};for(const S of this._renderableTilesKeys){const k=this._tiles[S].tileID;if(k.canonical.equals(l.canonical)){const F=l.clone();F.posMatrix=new Float64Array(16),P.aS(F.posMatrix,0,P.N,0,P.N,0,1),g[S]=F}else if(k.canonical.isChildOf(l.canonical)){const F=l.clone();F.posMatrix=new Float64Array(16);const Z=k.canonical.z-l.canonical.z,u=k.canonical.x-(k.canonical.x>>Z<<Z),h=k.canonical.y-(k.canonical.y>>Z<<Z),f=P.N>>Z;P.aS(F.posMatrix,0,f,0,f,0,1),P.$(F.posMatrix,F.posMatrix,[-u*f,-h*f,0]),g[S]=F}else if(l.canonical.isChildOf(k.canonical)){const F=l.clone();F.posMatrix=new Float64Array(16);const Z=l.canonical.z-k.canonical.z,u=l.canonical.x-(l.canonical.x>>Z<<Z),h=l.canonical.y-(l.canonical.y>>Z<<Z),f=P.N>>Z;P.aS(F.posMatrix,0,P.N,0,P.N,0,1),P.$(F.posMatrix,F.posMatrix,[u*f,h*f,0]),P.a0(F.posMatrix,F.posMatrix,[1/2**Z,1/2**Z,0]),g[S]=F}}return g}getSourceTile(l,g){const S=this.sourceCache._source;let k=l.overscaledZ-this.deltaZoom;if(k>S.maxzoom&&(k=S.maxzoom),k<S.minzoom)return null;this._sourceTileCache[l.key]||(this._sourceTileCache[l.key]=l.scaledTo(k).key);let F=this.sourceCache.getTileByID(this._sourceTileCache[l.key]);if((!F||!F.dem)&&g)for(;k>=S.minzoom&&(!F||!F.dem);)F=this.sourceCache.getTileByID(l.scaledTo(k--).key);return F}tilesAfterTime(l=Date.now()){return Object.values(this._tiles).filter(g=>g.timeAdded>=l)}}class Ol{constructor(l,g,S){this.painter=l,this.sourceCache=new ac(g),this.options=S,this.exaggeration=typeof S.exaggeration=="number"?S.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(l,g,S,k=P.N){var F;if(!(g>=0&&g<k&&S>=0&&S<k))return 0;const Z=this.getTerrainData(l),u=(F=Z.tile)===null||F===void 0?void 0:F.dem;if(!u)return 0;const h=function(V,W,Y){var le=W[0],fe=W[1];return V[0]=Y[0]*le+Y[4]*fe+Y[12],V[1]=Y[1]*le+Y[5]*fe+Y[13],V}([],[g/k*P.N,S/k*P.N],Z.u_terrain_matrix),f=[h[0]*u.dim,h[1]*u.dim],y=Math.floor(f[0]),b=Math.floor(f[1]),I=f[0]-y,R=f[1]-b;return u.get(y,b)*(1-I)*(1-R)+u.get(y+1,b)*I*(1-R)+u.get(y,b+1)*(1-I)*R+u.get(y+1,b+1)*I*R}getElevationForLngLatZoom(l,g){const{tileID:S,mercatorX:k,mercatorY:F}=this._getOverscaledTileIDFromLngLatZoom(l,g);return this.getElevation(S,k%P.N,F%P.N,P.N)}getElevation(l,g,S,k=P.N){return this.getDEMElevation(l,g,S,k)*this.exaggeration}getTerrainData(l){if(!this._emptyDemTexture){const k=this.painter.context,F=new P.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new At(k,F,k.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new At(k,new P.R({width:1,height:1}),k.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(k.gl.NEAREST,k.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=P.ao([])}const g=this.sourceCache.getSourceTile(l,!0);if(g&&g.dem&&(!g.demTexture||g.needsTerrainPrepare)){const k=this.painter.context;g.demTexture=this.painter.getTileTexture(g.dem.stride),g.demTexture?g.demTexture.update(g.dem.getPixels(),{premultiply:!1}):g.demTexture=new At(k,g.dem.getPixels(),k.gl.RGBA,{premultiply:!1}),g.demTexture.bind(k.gl.NEAREST,k.gl.CLAMP_TO_EDGE),g.needsTerrainPrepare=!1}const S=g&&g+g.tileID.key+l.key;if(S&&!this._demMatrixCache[S]){const k=this.sourceCache.sourceCache._source.maxzoom;let F=l.canonical.z-g.tileID.canonical.z;l.overscaledZ>l.canonical.z&&(l.canonical.z>=k?F=l.canonical.z-k:P.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const Z=l.canonical.x-(l.canonical.x>>F<<F),u=l.canonical.y-(l.canonical.y>>F<<F),h=P.bc(new Float64Array(16),[1/(P.N<<F),1/(P.N<<F),0]);P.$(h,h,[Z*P.N,u*P.N,0]),this._demMatrixCache[l.key]={matrix:h,coord:l}}return{u_depth:2,u_terrain:3,u_terrain_dim:g&&g.dem&&g.dem.dim||1,u_terrain_matrix:S?this._demMatrixCache[l.key].matrix:this._emptyDemMatrix,u_terrain_unpack:g&&g.dem&&g.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(g&&g.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:g}}getFramebuffer(l){const g=this.painter,S=g.width/devicePixelRatio,k=g.height/devicePixelRatio;return!this._fbo||this._fbo.width===S&&this._fbo.height===k||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new At(g.context,{width:S,height:k,data:null},g.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(g.context.gl.NEAREST,g.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new At(g.context,{width:S,height:k,data:null},g.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(g.context.gl.NEAREST,g.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=g.context.createFramebuffer(S,k,!0,!1),this._fbo.depthAttachment.set(g.context.createRenderbuffer(g.context.gl.DEPTH_COMPONENT16,S,k))),this._fbo.colorAttachment.set(l==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const l=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const g=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let F=0,Z=0;F<this._coordsTextureSize;F++)for(let u=0;u<this._coordsTextureSize;u++,Z+=4)g[Z+0]=255&u,g[Z+1]=255&F,g[Z+2]=u>>8<<4|F>>8,g[Z+3]=0;const S=new P.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(g.buffer)),k=new At(l,S,l.gl.RGBA,{premultiply:!1});return k.bind(l.gl.NEAREST,l.gl.CLAMP_TO_EDGE),this._coordsTexture=k,k}pointCoordinate(l){const g=new Uint8Array(4),S=this.painter.context,k=S.gl;S.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),k.readPixels(l.x,this.painter.height/devicePixelRatio-l.y-1,1,1,k.RGBA,k.UNSIGNED_BYTE,g),S.bindFramebuffer.set(null);const F=g[0]+(g[2]>>4<<8),Z=g[1]+((15&g[2])<<8),u=this.coordsIndex[255-g[3]],h=u&&this.sourceCache.getTileByID(u);if(!h)return null;const f=this._coordsTextureSize,y=(1<<h.tileID.canonical.z)*f;return new P.U(this._allowMercatorOverflow(l,(h.tileID.canonical.x*f+F)/y),(h.tileID.canonical.y*f+Z)/y,this.getElevation(h.tileID,F,Z,f))}getTerrainMesh(){if(this._mesh)return this._mesh;const l=this.painter.context,g=new P.bd,S=new P.b0,k=this.meshSize,F=P.N/k,Z=k*k;for(let b=0;b<=k;b++)for(let I=0;I<=k;I++)g.emplaceBack(I*F,b*F,0);for(let b=0;b<Z;b+=k+1)for(let I=0;I<k;I++)S.emplaceBack(I+b,k+I+b+1,k+I+b+2),S.emplaceBack(I+b,k+I+b+2,I+b+1);const u=g.length,h=u+2*(k+1);for(const b of[0,1])for(let I=0;I<=k;I++)for(const R of[0,1])g.emplaceBack(I*F,b*P.N,R);for(let b=0;b<2*k;b+=2)S.emplaceBack(h+b,h+b+1,h+b+3),S.emplaceBack(h+b,h+b+3,h+b+2),S.emplaceBack(u+b,u+b+3,u+b+1),S.emplaceBack(u+b,u+b+2,u+b+3);const f=g.length,y=f+2*(k+1);for(const b of[0,1])for(let I=0;I<=k;I++)for(const R of[0,1])g.emplaceBack(b*P.N,I*F,R);for(let b=0;b<2*k;b+=2)S.emplaceBack(f+b,f+b+1,f+b+3),S.emplaceBack(f+b,f+b+3,f+b+2),S.emplaceBack(y+b,y+b+3,y+b+1),S.emplaceBack(y+b,y+b+2,y+b+3);return this._mesh={indexBuffer:l.createIndexBuffer(S),vertexBuffer:l.createVertexBuffer(g,Yo.members),segments:P.S.simpleSegment(0,0,g.length,S.length)},this._mesh}getMeshFrameDelta(l){return 2*Math.PI*P.be/Math.pow(2,l)/5}getMinTileElevationForLngLatZoom(l,g){var S;const{tileID:k}=this._getOverscaledTileIDFromLngLatZoom(l,g);return(S=this.getMinMaxElevation(k).minElevation)!==null&&S!==void 0?S:0}getMinMaxElevation(l){const g=this.getTerrainData(l).tile,S={minElevation:null,maxElevation:null};return g&&g.dem&&(S.minElevation=g.dem.min*this.exaggeration,S.maxElevation=g.dem.max*this.exaggeration),S}_getOverscaledTileIDFromLngLatZoom(l,g){const S=P.U.fromLngLat(l.wrap()),k=(1<<g)*P.N,F=S.x*k,Z=S.y*k,u=Math.floor(F/P.N),h=Math.floor(Z/P.N);return{tileID:new P.O(g,0,g,u,h),mercatorX:F,mercatorY:Z}}_allowMercatorOverflow(l,g){const S=l.x<this.painter.width/2;let k=P.bf(g);const F=this.painter.transform.center.lng;return S&&Math.sign(k)>0&&Math.sign(F)<0||!S&&Math.sign(k)<0&&Math.sign(F)>0?(k=360*Math.sign(F)+k,P.G(k)):g}}class lc{constructor(l,g,S){this._context=l,this._size=g,this._tileSize=S,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const l of this._objects)l.texture.destroy(),l.fbo.destroy()}_createObject(l){const g=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),S=new At(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return S.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),g.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),g.colorAttachment.set(S.texture),{id:l,fbo:g,texture:S,stamp:-1,inUse:!1}}getObjectForId(l){return this._objects[l]}useObject(l){l.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(g=>l.id!==g),this._recentlyUsed.push(l.id)}stampObject(l){l.stamp=++this._stamp}getOrCreateFreeObject(){for(const g of this._recentlyUsed)if(!this._objects[g].inUse)return this._objects[g];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const l=this._createObject(this._objects.length);return this._objects.push(l),l}freeObject(l){l.inUse=!1}freeAllObjects(){for(const l of this._objects)this.freeObject(l)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(l=>!l.inUse)===!1}}const _o={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Ea{constructor(l,g){this.painter=l,this.terrain=g,this.pool=new lc(l.context,30,g.sourceCache.tileSize*g.qualityFactor)}destruct(){this.pool.destruct()}getTexture(l){return this.pool.getObjectForId(l.rtt[this._stacks.length-1].id).texture}prepareForRender(l,g){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=l._order.filter(S=>!l._layers[S].isHidden(g)),this._coordsDescendingInv={};for(const S in l.sourceCaches){this._coordsDescendingInv[S]={};const k=l.sourceCaches[S].getVisibleCoordinates();for(const F of k){const Z=this.terrain.sourceCache.getTerrainCoords(F);for(const u in Z)this._coordsDescendingInv[S][u]||(this._coordsDescendingInv[S][u]=[]),this._coordsDescendingInv[S][u].push(Z[u])}}this._coordsDescendingInvStr={};for(const S of l._order){const k=l._layers[S],F=k.source;if(_o[k.type]&&!this._coordsDescendingInvStr[F]){this._coordsDescendingInvStr[F]={};for(const Z in this._coordsDescendingInv[F])this._coordsDescendingInvStr[F][Z]=this._coordsDescendingInv[F][Z].map(u=>u.key).sort().join()}}for(const S of this._renderableTiles)for(const k in this._coordsDescendingInvStr){const F=this._coordsDescendingInvStr[k][S.tileID.key];F&&F!==S.rttCoords[k]&&(S.rtt=[])}}renderLayer(l){if(l.isHidden(this.painter.transform.zoom))return!1;const g=l.type,S=this.painter,k=this._renderableLayerIds[this._renderableLayerIds.length-1]===l.id;if(_o[g]&&(this._prevType&&_o[this._prevType]||this._stacks.push([]),this._prevType=g,this._stacks[this._stacks.length-1].push(l.id),!k))return!0;if(_o[this._prevType]||_o[g]&&k){this._prevType=g;const F=this._stacks.length-1,Z=this._stacks[F]||[];for(const u of this._renderableTiles){if(this.pool.isFull()&&(Pn(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(u),u.rtt[F]){const f=this.pool.getObjectForId(u.rtt[F].id);if(f.stamp===u.rtt[F].stamp){this.pool.useObject(f);continue}}const h=this.pool.getOrCreateFreeObject();this.pool.useObject(h),this.pool.stampObject(h),u.rtt[F]={id:h.id,stamp:h.stamp},S.context.bindFramebuffer.set(h.fbo.framebuffer),S.context.clear({color:P.aT.transparent,stencil:0}),S.currentStencilSource=void 0;for(let f=0;f<Z.length;f++){const y=S.style._layers[Z[f]],b=y.source?this._coordsDescendingInv[y.source][u.tileID.key]:[u.tileID];S.context.viewport.set([0,0,h.fbo.width,h.fbo.height]),S._renderTileClippingMasks(y,b),S.renderLayer(S,S.style.sourceCaches[y.source],y,b),y.source&&(u.rttCoords[y.source]=this._coordsDescendingInvStr[y.source][u.tileID.key])}}return Pn(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),_o[g]}return!1}}const Vt=We,Jt={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:P.c.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},sA=z=>{z.touchstart=z.dragStart,z.touchmoveWindow=z.dragMove,z.touchend=z.dragEnd},vl={showCompass:!0,showZoom:!0,visualizePitch:!1};class Vl{constructor(l,g,S=!1){this.mousedown=Z=>{this.startMouse(P.e({},Z,{ctrlKey:!0,preventDefault:()=>Z.preventDefault()}),me.mousePos(this.element,Z)),me.addEventListener(window,"mousemove",this.mousemove),me.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=Z=>{this.moveMouse(Z,me.mousePos(this.element,Z))},this.mouseup=Z=>{this.mouseRotate.dragEnd(Z),this.mousePitch&&this.mousePitch.dragEnd(Z),this.offTemp()},this.touchstart=Z=>{Z.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=me.touchPos(this.element,Z.targetTouches)[0],this.startTouch(Z,this._startPos),me.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),me.addEventListener(window,"touchend",this.touchend))},this.touchmove=Z=>{Z.targetTouches.length!==1?this.reset():(this._lastPos=me.touchPos(this.element,Z.targetTouches)[0],this.moveTouch(Z,this._lastPos))},this.touchend=Z=>{Z.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const k=l.dragRotate._mouseRotate.getClickTolerance(),F=l.dragRotate._mousePitch.getClickTolerance();this.element=g,this.mouseRotate=ll({clickTolerance:k,enable:!0}),this.touchRotate=(({enable:Z,clickTolerance:u,bearingDegreesPerPixelMoved:h=.8})=>{const f=new Jc;return new yl({clickTolerance:u,move:(y,b)=>({bearingDelta:(b.x-y.x)*h}),moveStateManager:f,enable:Z,assignEvents:sA})})({clickTolerance:k,enable:!0}),this.map=l,S&&(this.mousePitch=Ga({clickTolerance:F,enable:!0}),this.touchPitch=(({enable:Z,clickTolerance:u,pitchDegreesPerPixelMoved:h=-.5})=>{const f=new Jc;return new yl({clickTolerance:u,move:(y,b)=>({pitchDelta:(b.y-y.y)*h}),moveStateManager:f,enable:Z,assignEvents:sA})})({clickTolerance:F,enable:!0})),me.addEventListener(g,"mousedown",this.mousedown),me.addEventListener(g,"touchstart",this.touchstart,{passive:!1}),me.addEventListener(g,"touchcancel",this.reset)}startMouse(l,g){this.mouseRotate.dragStart(l,g),this.mousePitch&&this.mousePitch.dragStart(l,g),me.disableDrag()}startTouch(l,g){this.touchRotate.dragStart(l,g),this.touchPitch&&this.touchPitch.dragStart(l,g),me.disableDrag()}moveMouse(l,g){const S=this.map,{bearingDelta:k}=this.mouseRotate.dragMove(l,g)||{};if(k&&S.setBearing(S.getBearing()+k),this.mousePitch){const{pitchDelta:F}=this.mousePitch.dragMove(l,g)||{};F&&S.setPitch(S.getPitch()+F)}}moveTouch(l,g){const S=this.map,{bearingDelta:k}=this.touchRotate.dragMove(l,g)||{};if(k&&S.setBearing(S.getBearing()+k),this.touchPitch){const{pitchDelta:F}=this.touchPitch.dragMove(l,g)||{};F&&S.setPitch(S.getPitch()+F)}}off(){const l=this.element;me.removeEventListener(l,"mousedown",this.mousedown),me.removeEventListener(l,"touchstart",this.touchstart,{passive:!1}),me.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),me.removeEventListener(window,"touchend",this.touchend),me.removeEventListener(l,"touchcancel",this.reset),this.offTemp()}offTemp(){me.enableDrag(),me.removeEventListener(window,"mousemove",this.mousemove),me.removeEventListener(window,"mouseup",this.mouseup),me.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),me.removeEventListener(window,"touchend",this.touchend)}}let tn;function la(z,l,g){if(z=new P.L(z.lng,z.lat),l){const S=new P.L(z.lng-360,z.lat),k=new P.L(z.lng+360,z.lat),F=g.locationPoint(z).distSqr(l);g.locationPoint(S).distSqr(l)<F?z=S:g.locationPoint(k).distSqr(l)<F&&(z=k)}for(;Math.abs(z.lng-g.center.lng)>180;){const S=g.locationPoint(z);if(S.x>=0&&S.y>=0&&S.x<=g.width&&S.y<=g.height)break;z.lng>g.center.lng?z.lng-=360:z.lng+=360}return z}const Zn={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function x(z,l,g){const S=z.classList;for(const k in Zn)S.remove(`maplibregl-${g}-anchor-${k}`);S.add(`maplibregl-${g}-anchor-${l}`)}class T extends P.E{constructor(l){if(super(),this._onKeyPress=g=>{const S=g.code,k=g.charCode||g.keyCode;S!=="Space"&&S!=="Enter"&&k!==32&&k!==13||this.togglePopup()},this._onMapClick=g=>{const S=g.originalEvent.target,k=this._element;this._popup&&(S===k||k.contains(S))&&this.togglePopup()},this._update=g=>{if(!this._map)return;const S=this._map.loaded()&&!this._map.isMoving();((g==null?void 0:g.type)==="terrain"||(g==null?void 0:g.type)==="render"&&!S)&&this._map.once("render",this._update),this._map.transform.renderWorldCopies&&(this._lngLat=la(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let k="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?k=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(k=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let F="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?F="rotateX(0deg)":this._pitchAlignment==="map"&&(F=`rotateX(${this._map.getPitch()}deg)`),g&&g.type!=="moveend"||(this._pos=this._pos.round()),me.setTransform(this._element,`${Zn[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${F} ${k}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const Z=this._map.unproject(this._pos),u=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=Z.distanceTo(this._lngLat)>20*u?"0.2":"1.0",this._opacityTimeout=null},100))},this._onMove=g=>{if(!this._isDragging){const S=this._clickTolerance||this._map._clickTolerance;this._isDragging=g.point.dist(this._pointerdownPos)>=S}this._isDragging&&(this._pos=g.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new P.k("dragstart"))),this.fire(new P.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new P.k("dragend")),this._state="inactive"},this._addDragHandler=g=>{this._element.contains(g.originalEvent.target)&&(g.preventDefault(),this._positionDelta=g.point.sub(this._pos).add(this._offset),this._pointerdownPos=g.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=l&&l.anchor||"center",this._color=l&&l.color||"#3FB1CE",this._scale=l&&l.scale||1,this._draggable=l&&l.draggable||!1,this._clickTolerance=l&&l.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=l&&l.rotation||0,this._rotationAlignment=l&&l.rotationAlignment||"auto",this._pitchAlignment=l&&l.pitchAlignment&&l.pitchAlignment!=="auto"?l.pitchAlignment:this._rotationAlignment,l&&l.element)this._element=l.element,this._offset=P.P.convert(l&&l.offset||[0,0]);else{this._defaultMarker=!0,this._element=me.create("div"),this._element.setAttribute("aria-label","Map marker");const g=me.createNS("http://www.w3.org/2000/svg","svg"),S=41,k=27;g.setAttributeNS(null,"display","block"),g.setAttributeNS(null,"height",`${S}px`),g.setAttributeNS(null,"width",`${k}px`),g.setAttributeNS(null,"viewBox",`0 0 ${k} ${S}`);const F=me.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"stroke","none"),F.setAttributeNS(null,"stroke-width","1"),F.setAttributeNS(null,"fill","none"),F.setAttributeNS(null,"fill-rule","evenodd");const Z=me.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"fill-rule","nonzero");const u=me.createNS("http://www.w3.org/2000/svg","g");u.setAttributeNS(null,"transform","translate(3.0, 29.0)"),u.setAttributeNS(null,"fill","#000000");const h=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const le of h){const fe=me.createNS("http://www.w3.org/2000/svg","ellipse");fe.setAttributeNS(null,"opacity","0.04"),fe.setAttributeNS(null,"cx","10.5"),fe.setAttributeNS(null,"cy","5.80029008"),fe.setAttributeNS(null,"rx",le.rx),fe.setAttributeNS(null,"ry",le.ry),u.appendChild(fe)}const f=me.createNS("http://www.w3.org/2000/svg","g");f.setAttributeNS(null,"fill",this._color);const y=me.createNS("http://www.w3.org/2000/svg","path");y.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),f.appendChild(y);const b=me.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"opacity","0.25"),b.setAttributeNS(null,"fill","#000000");const I=me.createNS("http://www.w3.org/2000/svg","path");I.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),b.appendChild(I);const R=me.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"transform","translate(6.0, 7.0)"),R.setAttributeNS(null,"fill","#FFFFFF");const V=me.createNS("http://www.w3.org/2000/svg","g");V.setAttributeNS(null,"transform","translate(8.0, 8.0)");const W=me.createNS("http://www.w3.org/2000/svg","circle");W.setAttributeNS(null,"fill","#000000"),W.setAttributeNS(null,"opacity","0.25"),W.setAttributeNS(null,"cx","5.5"),W.setAttributeNS(null,"cy","5.5"),W.setAttributeNS(null,"r","5.4999962");const Y=me.createNS("http://www.w3.org/2000/svg","circle");Y.setAttributeNS(null,"fill","#FFFFFF"),Y.setAttributeNS(null,"cx","5.5"),Y.setAttributeNS(null,"cy","5.5"),Y.setAttributeNS(null,"r","5.4999962"),V.appendChild(W),V.appendChild(Y),Z.appendChild(u),Z.appendChild(f),Z.appendChild(b),Z.appendChild(R),Z.appendChild(V),g.appendChild(Z),g.setAttributeNS(null,"height",S*this._scale+"px"),g.setAttributeNS(null,"width",k*this._scale+"px"),this._element.appendChild(g),this._offset=P.P.convert(l&&l.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",g=>{g.preventDefault()}),this._element.addEventListener("mousedown",g=>{g.preventDefault()}),x(this._element,this._anchor,"marker"),l&&l.className)for(const g of l.className.split(" "))this._element.classList.add(g);this._popup=null}addTo(l){return this.remove(),this._map=l,l.getCanvasContainer().appendChild(this._element),l.on("move",this._update),l.on("moveend",this._update),l.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),me.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(l){return this._lngLat=P.L.convert(l),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(l){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),l){if(!("offset"in l.options)){const k=Math.abs(13.5)/Math.SQRT2;l.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[k,-1*(38.1-13.5+k)],"bottom-right":[-k,-1*(38.1-13.5+k)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=l,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const l=this._popup;return l?(l.isOpen()?l.remove():l.addTo(this._map),this):this}getOffset(){return this._offset}setOffset(l){return this._offset=P.P.convert(l),this._update(),this}addClassName(l){this._element.classList.add(l)}removeClassName(l){this._element.classList.remove(l)}toggleClassName(l){return this._element.classList.toggle(l)}setDraggable(l){return this._draggable=!!l,this._map&&(l?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(l){return this._rotation=l||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(l){return this._rotationAlignment=l||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(l){return this._pitchAlignment=l&&l!=="auto"?l:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const M={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let L=0,j=!1;const H={maxWidth:100,unit:"metric"};function Q(z,l,g){const S=g&&g.maxWidth||100,k=z._container.clientHeight/2,F=z.unproject([0,k]),Z=z.unproject([S,k]),u=F.distanceTo(Z);if(g&&g.unit==="imperial"){const h=3.2808*u;h>5280?K(l,S,h/5280,z._getUIString("ScaleControl.Miles")):K(l,S,h,z._getUIString("ScaleControl.Feet"))}else g&&g.unit==="nautical"?K(l,S,u/1852,z._getUIString("ScaleControl.NauticalMiles")):u>=1e3?K(l,S,u/1e3,z._getUIString("ScaleControl.Kilometers")):K(l,S,u,z._getUIString("ScaleControl.Meters"))}function K(z,l,g,S){const k=function(F){const Z=Math.pow(10,`${Math.floor(F)}`.length-1);let u=F/Z;return u=u>=10?10:u>=5?5:u>=3?3:u>=2?2:u>=1?1:function(h){const f=Math.pow(10,Math.ceil(-Math.log(h)/Math.LN10));return Math.round(h*f)/f}(u),Z*u}(g);z.style.width=l*(k/g)+"px",z.innerHTML=`${k}&nbsp;${S}`}const ue={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Se=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function De(z){if(z){if(typeof z=="number"){const l=Math.round(Math.abs(z)/Math.SQRT2);return{center:new P.P(0,0),top:new P.P(0,z),"top-left":new P.P(l,l),"top-right":new P.P(-l,l),bottom:new P.P(0,-z),"bottom-left":new P.P(l,-l),"bottom-right":new P.P(-l,-l),left:new P.P(z,0),right:new P.P(-z,0)}}if(z instanceof P.P||Array.isArray(z)){const l=P.P.convert(z);return{center:l,top:l,"top-left":l,"top-right":l,bottom:l,"bottom-left":l,"bottom-right":l,left:l,right:l}}return{center:P.P.convert(z.center||[0,0]),top:P.P.convert(z.top||[0,0]),"top-left":P.P.convert(z["top-left"]||[0,0]),"top-right":P.P.convert(z["top-right"]||[0,0]),bottom:P.P.convert(z.bottom||[0,0]),"bottom-left":P.P.convert(z["bottom-left"]||[0,0]),"bottom-right":P.P.convert(z["bottom-right"]||[0,0]),left:P.P.convert(z.left||[0,0]),right:P.P.convert(z.right||[0,0])}}return De(new P.P(0,0))}const _t={extend:(z,...l)=>P.e(z,...l),run(z){z()},logToElement(z,l=!1,g="log"){const S=window.document.getElementById(g);S&&(l&&(S.innerHTML=""),S.innerHTML+=`<br>${z}`)}},Xe=We;class tt{static get version(){return Xe}static get workerCount(){return Qt.workerCount}static set workerCount(l){Qt.workerCount=l}static get maxParallelImageRequests(){return P.c.MAX_PARALLEL_IMAGE_REQUESTS}static set maxParallelImageRequests(l){P.c.MAX_PARALLEL_IMAGE_REQUESTS=l}static get workerUrl(){return P.c.WORKER_URL}static set workerUrl(l){P.c.WORKER_URL=l}static addProtocol(l,g){P.c.REGISTERED_PROTOCOLS[l]=g}static removeProtocol(l){delete P.c.REGISTERED_PROTOCOLS[l]}}return tt.Map=class extends Ss{constructor(z){if(P.bg.mark(P.bh.create),(z=P.e({},Jt,z)).minZoom!=null&&z.maxZoom!=null&&z.minZoom>z.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(z.minPitch!=null&&z.maxPitch!=null&&z.minPitch>z.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(z.minPitch!=null&&z.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(z.maxPitch!=null&&z.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new _l(z.minZoom,z.maxZoom,z.minPitch,z.maxPitch,z.renderWorldCopies),{bearingSnap:z.bearingSnap}),this._cooperativeGesturesOnWheel=l=>{this._onCooperativeGesture(l,l[this._metaKey],1)},this._contextLost=l=>{l.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new P.k("webglcontextlost",{originalEvent:l}))},this._contextRestored=l=>{this._setupPainter(),this.resize(),this._update(),this.fire(new P.k("webglcontextrestored",{originalEvent:l}))},this._onMapScroll=l=>{if(l.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=z.interactive,this._cooperativeGestures=z.cooperativeGestures,this._metaKey=navigator.platform.indexOf("Mac")===0?"metaKey":"ctrlKey",this._maxTileCacheSize=z.maxTileCacheSize,this._maxTileCacheZoomLevels=z.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=z.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=z.preserveDrawingBuffer,this._antialias=z.antialias,this._trackResize=z.trackResize,this._bearingSnap=z.bearingSnap,this._refreshExpiredTiles=z.refreshExpiredTiles,this._fadeDuration=z.fadeDuration,this._crossSourceCollisions=z.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=z.collectResourceTiming,this._renderTaskQueue=new mo,this._controls=[],this._mapId=P.a2(),this._locale=P.e({},mr,z.locale),this._clickTolerance=z.clickTolerance,this._overridePixelRatio=z.pixelRatio,this._maxCanvasSize=z.maxCanvasSize,this.transformCameraUpdate=z.transformCameraUpdate,this._imageQueueHandle=di.addThrottleControl(()=>this.isMoving()),this._requestManager=new Vr(z.transformRequest),typeof z.container=="string"){if(this._container=document.getElementById(z.container),!this._container)throw new Error(`Container '${z.container}' not found.`)}else{if(!(z.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=z.container}if(z.maxBounds&&this.setMaxBounds(z.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let l=!1;const g=fo(S=>{this._trackResize&&!this._removed&&this.resize(S)._update()},50);this._resizeObserver=new ResizeObserver(S=>{l?g(S):l=!0}),this._resizeObserver.observe(this._container)}this.handlers=new xl(this,z),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=z.hash&&new ba(typeof z.hash=="string"&&z.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:z.center,zoom:z.zoom,bearing:z.bearing,pitch:z.pitch}),z.bounds&&(this.resize(),this.fitBounds(z.bounds,P.e({},z.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=z.localIdeographFontFamily,this._validateStyle=z.validateStyle,z.style&&this.setStyle(z.style,{localIdeographFontFamily:z.localIdeographFontFamily}),z.attributionControl&&this.addControl(new aa({customAttribution:z.customAttribution})),z.maplibreLogo&&this.addControl(new Gn,z.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",l=>{this._update(l.dataType==="style"),this.fire(new P.k(`${l.dataType}data`,l))}),this.on("dataloading",l=>{this.fire(new P.k(`${l.dataType}dataloading`,l))}),this.on("dataabort",l=>{this.fire(new P.k("sourcedataabort",l))})}_getMapId(){return this._mapId}addControl(z,l){if(l===void 0&&(l=z.getDefaultPosition?z.getDefaultPosition():"top-right"),!z||!z.onAdd)return this.fire(new P.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const g=z.onAdd(this);this._controls.push(z);const S=this._controlPositions[l];return l.indexOf("bottom")!==-1?S.insertBefore(g,S.firstChild):S.appendChild(g),this}removeControl(z){if(!z||!z.onRemove)return this.fire(new P.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const l=this._controls.indexOf(z);return l>-1&&this._controls.splice(l,1),z.onRemove(this),this}hasControl(z){return this._controls.indexOf(z)>-1}calculateCameraOptionsFromTo(z,l,g,S){return S==null&&this.terrain&&(S=this.terrain.getElevationForLngLatZoom(g,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(z,l,g,S)}resize(z){var l;const g=this._containerDimensions(),S=g[0],k=g[1],F=this._getClampedPixelRatio(S,k);if(this._resizeCanvas(S,k,F),this.painter.resize(S,k,F),this.painter.overLimit()){const u=this.painter.context.gl;this._maxCanvasSize=[u.drawingBufferWidth,u.drawingBufferHeight];const h=this._getClampedPixelRatio(S,k);this._resizeCanvas(S,k,h),this.painter.resize(S,k,h)}this.transform.resize(S,k),(l=this._requestedCameraState)===null||l===void 0||l.resize(S,k);const Z=!this._moving;return Z&&(this.stop(),this.fire(new P.k("movestart",z)).fire(new P.k("move",z))),this.fire(new P.k("resize",z)),Z&&this.fire(new P.k("moveend",z)),this}_getClampedPixelRatio(z,l){const{0:g,1:S}=this._maxCanvasSize,k=this.getPixelRatio(),F=z*k,Z=l*k;return Math.min(F>g?g/F:1,Z>S?S/Z:1)*k}getPixelRatio(){var z;return(z=this._overridePixelRatio)!==null&&z!==void 0?z:devicePixelRatio}setPixelRatio(z){this._overridePixelRatio=z,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(z){return this.transform.setMaxBounds(Yr.convert(z)),this._update()}setMinZoom(z){if((z=z??-2)>=-2&&z<=this.transform.maxZoom)return this.transform.minZoom=z,this._update(),this.getZoom()<z&&this.setZoom(z),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(z){if((z=z??22)>=this.transform.minZoom)return this.transform.maxZoom=z,this._update(),this.getZoom()>z&&this.setZoom(z),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(z){if((z=z??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(z>=0&&z<=this.transform.maxPitch)return this.transform.minPitch=z,this._update(),this.getPitch()<z&&this.setPitch(z),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(z){if((z=z??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(z>=this.transform.minPitch)return this.transform.maxPitch=z,this._update(),this.getPitch()>z&&this.setPitch(z),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(z){return this.transform.renderWorldCopies=z,this._update()}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(z){return this._cooperativeGestures=z,this._cooperativeGestures?this._setupCooperativeGestures():this._destroyCooperativeGestures(),this}project(z){return this.transform.locationPoint(P.L.convert(z),this.style&&this.terrain)}unproject(z){return this.transform.pointLocation(P.P.convert(z),this.terrain)}isMoving(){var z;return this._moving||((z=this.handlers)===null||z===void 0?void 0:z.isMoving())}isZooming(){var z;return this._zooming||((z=this.handlers)===null||z===void 0?void 0:z.isZooming())}isRotating(){var z;return this._rotating||((z=this.handlers)===null||z===void 0?void 0:z.isRotating())}_createDelegatedListener(z,l,g){if(z==="mouseenter"||z==="mouseover"){let S=!1;return{layer:l,listener:g,delegates:{mousemove:F=>{const Z=this.getLayer(l)?this.queryRenderedFeatures(F.point,{layers:[l]}):[];Z.length?S||(S=!0,g.call(this,new Bo(z,this,F.originalEvent,{features:Z}))):S=!1},mouseout:()=>{S=!1}}}}if(z==="mouseleave"||z==="mouseout"){let S=!1;return{layer:l,listener:g,delegates:{mousemove:Z=>{(this.getLayer(l)?this.queryRenderedFeatures(Z.point,{layers:[l]}):[]).length?S=!0:S&&(S=!1,g.call(this,new Bo(z,this,Z.originalEvent)))},mouseout:Z=>{S&&(S=!1,g.call(this,new Bo(z,this,Z.originalEvent)))}}}}{const S=k=>{const F=this.getLayer(l)?this.queryRenderedFeatures(k.point,{layers:[l]}):[];F.length&&(k.features=F,g.call(this,k),delete k.features)};return{layer:l,listener:g,delegates:{[z]:S}}}}on(z,l,g){if(g===void 0)return super.on(z,l);const S=this._createDelegatedListener(z,l,g);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[z]=this._delegatedListeners[z]||[],this._delegatedListeners[z].push(S);for(const k in S.delegates)this.on(k,S.delegates[k]);return this}once(z,l,g){if(g===void 0)return super.once(z,l);const S=this._createDelegatedListener(z,l,g);for(const k in S.delegates)this.once(k,S.delegates[k]);return this}off(z,l,g){return g===void 0?super.off(z,l):(this._delegatedListeners&&this._delegatedListeners[z]&&(S=>{const k=this._delegatedListeners[z];for(let F=0;F<k.length;F++){const Z=k[F];if(Z.layer===l&&Z.listener===g){for(const u in Z.delegates)this.off(u,Z.delegates[u]);return k.splice(F,1),this}}})(),this)}queryRenderedFeatures(z,l){if(!this.style)return[];let g;const S=z instanceof P.P||Array.isArray(z),k=S?z:[[0,0],[this.transform.width,this.transform.height]];if(l=l||(S?{}:z)||{},k instanceof P.P||typeof k[0]=="number")g=[P.P.convert(k)];else{const F=P.P.convert(k[0]),Z=P.P.convert(k[1]);g=[F,new P.P(Z.x,F.y),Z,new P.P(F.x,Z.y),F]}return this.style.queryRenderedFeatures(g,l,this.transform)}querySourceFeatures(z,l){return this.style.querySourceFeatures(z,l)}setStyle(z,l){return(l=P.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},l)).diff!==!1&&l.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&z?(this._diffStyle(z,l),this):(this._localIdeographFontFamily=l.localIdeographFontFamily,this._updateStyle(z,l))}setTransformRequest(z){return this._requestManager.setTransformRequest(z),this}_getUIString(z){const l=this._locale[z];if(l==null)throw new Error(`Missing UI string '${z}'`);return l}_updateStyle(z,l){if(l.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(z,l));const g=this.style&&l.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!z)),z?(this.style=new Hs(this,l||{}),this.style.setEventedParent(this,{style:this.style}),typeof z=="string"?this.style.loadURL(z,l,g):this.style.loadJSON(z,l,g),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Hs(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(z,l){if(typeof z=="string"){const g=this._requestManager.transformRequest(z,Ei.Style);P.f(g,(S,k)=>{S?this.fire(new P.j(S)):k&&this._updateDiff(k,l)})}else typeof z=="object"&&this._updateDiff(z,l)}_updateDiff(z,l){try{this.style.setState(z,l)&&this._update(!0)}catch(g){P.w(`Unable to perform style diff: ${g.message||g.error||g}.  Rebuilding the style from scratch.`),this._updateStyle(z,l)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():P.w("There is no style added to the map.")}addSource(z,l){return this._lazyInitEmptyStyle(),this.style.addSource(z,l),this._update(!0)}isSourceLoaded(z){const l=this.style&&this.style.sourceCaches[z];if(l!==void 0)return l.loaded();this.fire(new P.j(new Error(`There is no source with ID '${z}'`)))}setTerrain(z){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),z){const l=this.style.sourceCaches[z.source];if(!l)throw new Error(`cannot load terrain, because there exists no source with ID: ${z.source}`);for(const g in this.style._layers){const S=this.style._layers[g];S.type==="hillshade"&&S.source===z.source&&P.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Ol(this.painter,l,z),this.painter.renderToTexture=new Ea(this.painter,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=g=>{g.dataType==="style"?this.terrain.sourceCache.freeRtt():g.dataType==="source"&&g.tile&&(g.sourceId!==z.source||this._elevationFreeze||(this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(g.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0;return this.fire(new P.k("terrain",{terrain:z})),this}getTerrain(){var z,l;return(l=(z=this.terrain)===null||z===void 0?void 0:z.options)!==null&&l!==void 0?l:null}areTilesLoaded(){const z=this.style&&this.style.sourceCaches;for(const l in z){const g=z[l]._tiles;for(const S in g){const k=g[S];if(k.state!=="loaded"&&k.state!=="errored")return!1}}return!0}addSourceType(z,l,g){return this._lazyInitEmptyStyle(),this.style.addSourceType(z,l,g)}removeSource(z){return this.style.removeSource(z),this._update(!0)}getSource(z){return this.style.getSource(z)}addImage(z,l,g={}){const{pixelRatio:S=1,sdf:k=!1,stretchX:F,stretchY:Z,content:u}=g;if(this._lazyInitEmptyStyle(),!(l instanceof HTMLImageElement||P.a(l))){if(l.width===void 0||l.height===void 0)return this.fire(new P.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:h,height:f,data:y}=l,b=l;return this.style.addImage(z,{data:new P.R({width:h,height:f},new Uint8Array(y)),pixelRatio:S,stretchX:F,stretchY:Z,content:u,sdf:k,version:0,userImage:b}),b.onAdd&&b.onAdd(this,z),this}}{const{width:h,height:f,data:y}=P.h.getImageData(l);this.style.addImage(z,{data:new P.R({width:h,height:f},y),pixelRatio:S,stretchX:F,stretchY:Z,content:u,sdf:k,version:0})}}updateImage(z,l){const g=this.style.getImage(z);if(!g)return this.fire(new P.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const S=l instanceof HTMLImageElement||P.a(l)?P.h.getImageData(l):l,{width:k,height:F,data:Z}=S;if(k===void 0||F===void 0)return this.fire(new P.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(k!==g.data.width||F!==g.data.height)return this.fire(new P.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const u=!(l instanceof HTMLImageElement||P.a(l));return g.data.replace(Z,u),this.style.updateImage(z,g),this}getImage(z){return this.style.getImage(z)}hasImage(z){return z?!!this.style.getImage(z):(this.fire(new P.j(new Error("Missing required image id"))),!1)}removeImage(z){this.style.removeImage(z)}loadImage(z,l){di.getImage(this._requestManager.transformRequest(z,Ei.Image),l)}listImages(){return this.style.listImages()}addLayer(z,l){return this._lazyInitEmptyStyle(),this.style.addLayer(z,l),this._update(!0)}moveLayer(z,l){return this.style.moveLayer(z,l),this._update(!0)}removeLayer(z){return this.style.removeLayer(z),this._update(!0)}getLayer(z){return this.style.getLayer(z)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(z,l,g){return this.style.setLayerZoomRange(z,l,g),this._update(!0)}setFilter(z,l,g={}){return this.style.setFilter(z,l,g),this._update(!0)}getFilter(z){return this.style.getFilter(z)}setPaintProperty(z,l,g,S={}){return this.style.setPaintProperty(z,l,g,S),this._update(!0)}getPaintProperty(z,l){return this.style.getPaintProperty(z,l)}setLayoutProperty(z,l,g,S={}){return this.style.setLayoutProperty(z,l,g,S),this._update(!0)}getLayoutProperty(z,l){return this.style.getLayoutProperty(z,l)}setGlyphs(z,l={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(z,l),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(z,l,g={}){return this._lazyInitEmptyStyle(),this.style.addSprite(z,l,g,S=>{S||this._update(!0)}),this}removeSprite(z){return this._lazyInitEmptyStyle(),this.style.removeSprite(z),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(z,l={}){return this._lazyInitEmptyStyle(),this.style.setSprite(z,l,g=>{g||this._update(!0)}),this}setLight(z,l={}){return this._lazyInitEmptyStyle(),this.style.setLight(z,l),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(z,l){return this.style.setFeatureState(z,l),this._update()}removeFeatureState(z,l){return this.style.removeFeatureState(z,l),this._update()}getFeatureState(z){return this.style.getFeatureState(z)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let z=0,l=0;return this._container&&(z=this._container.clientWidth||400,l=this._container.clientHeight||300),[z,l]}_setupContainer(){const z=this._container;z.classList.add("maplibregl-map");const l=this._canvasContainer=me.create("div","maplibregl-canvas-container",z);this._interactive&&l.classList.add("maplibregl-interactive"),this._canvas=me.create("canvas","maplibregl-canvas",l),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const g=this._containerDimensions(),S=this._getClampedPixelRatio(g[0],g[1]);this._resizeCanvas(g[0],g[1],S);const k=this._controlContainer=me.create("div","maplibregl-control-container",z),F=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(Z=>{F[Z]=me.create("div",`maplibregl-ctrl-${Z} `,k)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){this._cooperativeGesturesScreen=me.create("div","maplibregl-cooperative-gesture-screen",this._container);let z=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(z=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use ⌘ + scroll to zoom the map"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${z}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,this._cooperativeGesturesScreen.setAttribute("aria-hidden","true"),this._canvasContainer.addEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.add("maplibregl-cooperative-gestures")}_destroyCooperativeGestures(){me.remove(this._cooperativeGesturesScreen),this._canvasContainer.removeEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.remove("maplibregl-cooperative-gestures")}_resizeCanvas(z,l,g){this._canvas.width=Math.floor(g*z),this._canvas.height=Math.floor(g*l),this._canvas.style.width=`${z}px`,this._canvas.style.height=`${l}px`}_setupPainter(){const z={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let l=null;this._canvas.addEventListener("webglcontextcreationerror",S=>{l={requestedAttributes:z},S&&(l.statusMessage=S.statusMessage,l.type=S.type)},{once:!0});const g=this._canvas.getContext("webgl2",z)||this._canvas.getContext("webgl",z);if(!g){const S="Failed to initialize WebGL";throw l?(l.message=S,new Error(JSON.stringify(l))):new Error(S)}this.painter=new va(g,this.transform),Xt.testSupport(g)}_onCooperativeGesture(z,l,g){return!l&&g<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(z){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||z,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(z){return this._update(),this._renderTaskQueue.add(z)}_cancelRenderFrame(z){this._renderTaskQueue.remove(z)}_render(z){const l=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(z),this._removed)return;let g=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const k=this.transform.zoom,F=P.h.now();this.style.zoomHistory.update(k,F);const Z=new P.a8(k,{now:F,fadeDuration:l,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),u=Z.crossFadingFactor();u===1&&u===this._crossFadingFactor||(g=!0,this._crossFadingFactor=u),this.style.update(Z)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,l,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:l,showPadding:this.showPadding}),this.fire(new P.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,P.bg.mark(P.bh.load),this.fire(new P.k("load"))),this.style&&(this.style.hasTransitions()||g)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const S=this._sourcesDirty||this._styleDirty||this._placementDirty;return S||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new P.k("idle")),!this._loaded||this._fullyLoaded||S||(this._fullyLoaded=!0,P.bg.mark(P.bh.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){var z;this._hash&&this._hash.remove();for(const g of this._controls)g.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),di.removeThrottleControl(this._imageQueueHandle),(z=this._resizeObserver)===null||z===void 0||z.disconnect();const l=this.painter.context.gl.getExtension("WEBGL_lose_context");l&&l.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),me.remove(this._canvasContainer),me.remove(this._controlContainer),this._cooperativeGestures&&this._destroyCooperativeGestures(),this._container.classList.remove("maplibregl-map"),P.bg.clearMetrics(),this._removed=!0,this.fire(new P.k("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=P.h.frame(z=>{P.bg.frame(z),this._frame=null,this._render(z)}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(z){this._showTileBoundaries!==z&&(this._showTileBoundaries=z,this._update())}get showPadding(){return!!this._showPadding}set showPadding(z){this._showPadding!==z&&(this._showPadding=z,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(z){this._showCollisionBoxes!==z&&(this._showCollisionBoxes=z,z?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(z){this._showOverdrawInspector!==z&&(this._showOverdrawInspector=z,this._update())}get repaint(){return!!this._repaint}set repaint(z){this._repaint!==z&&(this._repaint=z,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(z){this._vertices=z,this._update()}get version(){return Vt}getCameraTargetElevation(){return this.transform.elevation}},tt.NavigationControl=class{constructor(z){this._updateZoomButtons=()=>{const l=this._map.getZoom(),g=l===this._map.getMaxZoom(),S=l===this._map.getMinZoom();this._zoomInButton.disabled=g,this._zoomOutButton.disabled=S,this._zoomInButton.setAttribute("aria-disabled",g.toString()),this._zoomOutButton.setAttribute("aria-disabled",S.toString())},this._rotateCompassArrow=()=>{const l=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=l},this._setButtonTitle=(l,g)=>{const S=this._map._getUIString(`NavigationControl.${g}`);l.title=S,l.setAttribute("aria-label",S)},this.options=P.e({},vl,z),this._container=me.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",l=>l.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",l=>this._map.zoomIn({},{originalEvent:l})),me.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",l=>this._map.zoomOut({},{originalEvent:l})),me.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",l=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:l}):this._map.resetNorth({},{originalEvent:l})}),this._compassIcon=me.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(z){return this._map=z,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Vl(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){me.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(z,l){const g=me.create("button",z,this._container);return g.type="button",g.addEventListener("click",l),g}},tt.GeolocateControl=class extends P.E{constructor(z){super(),this._onSuccess=l=>{if(this._map){if(this._isOutOfMapMaxBounds(l))return this._setErrorState(),this.fire(new P.k("outofmaxbounds",l)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=l,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(l),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(l),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new P.k("geolocate",l)),this._finish()}},this._updateCamera=l=>{const g=new P.L(l.coords.longitude,l.coords.latitude),S=l.coords.accuracy,k=this._map.getBearing(),F=P.e({bearing:k},this.options.fitBoundsOptions),Z=Yr.fromLngLat(g,S);this._map.fitBounds(Z,F,{geolocateSource:!0})},this._updateMarker=l=>{if(l){const g=new P.L(l.coords.longitude,l.coords.latitude);this._accuracyCircleMarker.setLngLat(g).addTo(this._map),this._userLocationDotMarker.setLngLat(g).addTo(this._map),this._accuracy=l.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=l=>{if(this._map){if(this.options.trackUserLocation)if(l.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const g=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=g,this._geolocateButton.setAttribute("aria-label",g),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(l.code===3&&j)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new P.k("error",l)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=l=>{if(this._map){if(this._container.addEventListener("contextmenu",g=>g.preventDefault()),this._geolocateButton=me.create("button","maplibregl-ctrl-geolocate",this._container),me.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",l===!1){P.w("Geolocation support is not available so the GeolocateControl will be disabled.");const g=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=g,this._geolocateButton.setAttribute("aria-label",g)}else{const g=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=g,this._geolocateButton.setAttribute("aria-label",g)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=me.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new T({element:this._dotElement}),this._circleElement=me.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new T({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",g=>{g.geolocateSource||this._watchState!=="ACTIVE_LOCK"||g.originalEvent&&g.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new P.k("trackuserlocationend")))})}},this.options=P.e({},M,z)}onAdd(z){return this._map=z,this._container=me.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(l,g=!1){tn===void 0||g?window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(S=>{tn=S.state!=="denied",l(tn)}).catch(()=>{tn=!!window.navigator.geolocation,l(tn)}):(tn=!!window.navigator.geolocation,l(tn)):l(tn)}(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),me.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,L=0,j=!1}_isOutOfMapMaxBounds(z){const l=this._map.getMaxBounds(),g=z.coords;return l&&(g.longitude<l.getWest()||g.longitude>l.getEast()||g.latitude<l.getSouth()||g.latitude>l.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const z=this._map.getBounds(),l=z.getSouthEast(),g=z.getNorthEast(),S=l.distanceTo(g),k=Math.ceil(this._accuracy/(S/this._map._container.clientHeight)*2);this._circleElement.style.width=`${k}px`,this._circleElement.style.height=`${k}px`}trigger(){if(!this._setup)return P.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new P.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":L--,j=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new P.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new P.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let z;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),L++,L>1?(z={maximumAge:6e5,timeout:0},j=!0):(z=this.options.positionOptions,j=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,z)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},tt.AttributionControl=aa,tt.LogoControl=Gn,tt.ScaleControl=class{constructor(z){this._onMove=()=>{Q(this._map,this._container,this.options)},this.setUnit=l=>{this.options.unit=l,Q(this._map,this._container,this.options)},this.options=P.e({},H,z)}getDefaultPosition(){return"bottom-left"}onAdd(z){return this._map=z,this._container=me.create("div","maplibregl-ctrl maplibregl-ctrl-scale",z.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){me.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},tt.FullscreenControl=class extends P.E{constructor(z={}){super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,z&&z.container&&(z.container instanceof HTMLElement?this._container=z.container:P.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(z){return this._map=z,this._container||(this._container=this._map.getContainer()),this._controlContainer=me.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){me.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const z=this._fullscreenButton=me.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);me.create("span","maplibregl-ctrl-icon",z).setAttribute("aria-hidden","true"),z.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const z=this._getTitle();this._fullscreenButton.setAttribute("aria-label",z),this._fullscreenButton.title=z}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new P.k("fullscreenstart")),this._map._cooperativeGestures&&(this._prevCooperativeGestures=this._map._cooperativeGestures,this._map.setCooperativeGestures())):(this.fire(new P.k("fullscreenend")),this._prevCooperativeGestures&&(this._map.setCooperativeGestures(this._prevCooperativeGestures),delete this._prevCooperativeGestures))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},tt.TerrainControl=class{constructor(z){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))},this.options=z}onAdd(z){return this._map=z,this._container=me.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=me.create("button","maplibregl-ctrl-terrain",this._container),me.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){me.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},tt.Popup=class extends P.E{constructor(z){super(),this.remove=()=>(this._content&&me.remove(this._content),this._container&&(me.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new P.k("close")),this),this._onMouseUp=l=>{this._update(l.point)},this._onMouseMove=l=>{this._update(l.point)},this._onDrag=l=>{this._update(l.point)},this._update=l=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=me.create("div","maplibregl-popup",this._map.getContainer()),this._tip=me.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const Z of this.options.className.split(" "))this._container.classList.add(Z);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=la(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!l)return;const g=this._pos=this._trackPointer&&l?l:this._map.project(this._lngLat);let S=this.options.anchor;const k=De(this.options.offset);if(!S){const Z=this._container.offsetWidth,u=this._container.offsetHeight;let h;h=g.y+k.bottom.y<u?["top"]:g.y>this._map.transform.height-u?["bottom"]:[],g.x<Z/2?h.push("left"):g.x>this._map.transform.width-Z/2&&h.push("right"),S=h.length===0?"bottom":h.join("-")}const F=g.add(k[S]).round();me.setTransform(this._container,`${Zn[S]} translate(${F.x}px,${F.y}px)`),x(this._container,S,"popup")},this._onClose=()=>{this.remove()},this.options=P.e(Object.create(ue),z)}addTo(z){return this._map&&this.remove(),this._map=z,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new P.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(z){return this._lngLat=P.L.convert(z),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(z){return this.setDOMContent(document.createTextNode(z))}setHTML(z){const l=document.createDocumentFragment(),g=document.createElement("body");let S;for(g.innerHTML=z;S=g.firstChild,S;)l.appendChild(S);return this.setDOMContent(l)}getMaxWidth(){var z;return(z=this._container)===null||z===void 0?void 0:z.style.maxWidth}setMaxWidth(z){return this.options.maxWidth=z,this._update(),this}setDOMContent(z){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=me.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(z),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(z){this._container&&this._container.classList.add(z)}removeClassName(z){this._container&&this._container.classList.remove(z)}setOffset(z){return this.options.offset=z,this._update(),this}toggleClassName(z){if(this._container)return this._container.classList.toggle(z)}_createCloseButton(){this.options.closeButton&&(this._closeButton=me.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const z=this._container.querySelector(Se);z&&z.focus()}},tt.Marker=T,tt.Style=Hs,tt.LngLat=P.L,tt.LngLatBounds=Yr,tt.Point=P.P,tt.MercatorCoordinate=P.U,tt.Evented=P.E,tt.AJAXError=P.bi,tt.config=P.c,tt.CanvasSource=La,tt.GeoJSONSource=dr,tt.ImageSource=Es,tt.RasterDEMTileSource=zt,tt.RasterTileSource=to,tt.VectorTileSource=Co,tt.VideoSource=Il,tt.setRTLTextPlugin=P.bj,tt.getRTLTextPluginStatus=P.bk,tt.prewarm=function(){Ki().acquire(ri)},tt.clearPrewarmedResources=function(){const z=Qi;z&&(z.isPreloaded()&&z.numActive()===1?(z.release(ri),Qi=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},_t.extend(tt,{isSafari:P.ac,getPerformanceMetrics:P.bg.getPerformanceMetrics}),tt});var Bt=wt;return Bt})})(m2);var cI=m2.exports;const lp=p2(cI);var uI=hI;function hI(Le){var ne,Fe,ze;if(Le){if(Array.isArray(Le)){for(ne=[],Fe=Le.length,ze=0;ze<Fe;ze++){var wt=Le[ze];wt!=null&&ne.push(wt)}return ne}if(typeof Le=="object"){ne={};var dt=Object.keys(Le);for(Fe=dt.length,ze=0;ze<Fe;ze++){var Bt=dt[ze],P=Le[Bt];P!=null&&(ne[Bt]=P)}return ne}}}function dI(Le,ne,Fe){let ze;const{map:wt}=k_();xf(Le,wt,We=>Fe(4,ze=We));let{position:dt="top-left"}=ne,{container:Bt=void 0}=ne,P=null;return C_(()=>{ze!=null&&ze.loaded()&&P&&ze.removeControl(P)}),Le.$$set=We=>{"position"in We&&Fe(1,dt=We.position),"container"in We&&Fe(2,Bt=We.container)},Le.$$.update=()=>{if(Le.$$.dirty&30&&ze&&!P){let We;typeof Bt=="string"?We=document.querySelector(Bt)??void 0:We=Bt,Fe(3,P=new lp.FullscreenControl({container:We})),ze.addControl(P,dt)}},[wt,dt,Bt,P,ze]}class fI extends vh{constructor(ne){super(),bh(this,ne,dI,null,xh,{position:1,container:2})}}function pI(Le,ne,Fe){let ze;const{map:wt}=k_();xf(Le,wt,yt=>Fe(8,ze=yt));let{position:dt="top-left"}=ne,{positionOptions:Bt=void 0}=ne,{fitBoundsOptions:P=void 0}=ne,{trackUserLocation:We=!1}=ne,{showAccuracyCircle:me=!0}=ne,{showUserLocation:Xt=!0}=ne,Rt=null;return C_(()=>{ze!=null&&ze.loaded()&&Rt&&ze.removeControl(Rt)}),Le.$$set=yt=>{"position"in yt&&Fe(1,dt=yt.position),"positionOptions"in yt&&Fe(2,Bt=yt.positionOptions),"fitBoundsOptions"in yt&&Fe(3,P=yt.fitBoundsOptions),"trackUserLocation"in yt&&Fe(4,We=yt.trackUserLocation),"showAccuracyCircle"in yt&&Fe(5,me=yt.showAccuracyCircle),"showUserLocation"in yt&&Fe(6,Xt=yt.showUserLocation)},Le.$$.update=()=>{Le.$$.dirty&510&&ze&&!Rt&&(Fe(7,Rt=new lp.GeolocateControl({positionOptions:Bt,fitBoundsOptions:P,trackUserLocation:We,showAccuracyCircle:me,showUserLocation:Xt})),ze.addControl(Rt,dt))},[wt,dt,Bt,P,We,me,Xt,Rt,ze]}class mI extends vh{constructor(ne){super(),bh(this,ne,pI,null,xh,{position:1,positionOptions:2,fitBoundsOptions:3,trackUserLocation:4,showAccuracyCircle:5,showUserLocation:6})}}function _I(Le){let ne=Le.getCenter(),Fe=Math.round(Le.getZoom()*100)/100,ze=Math.ceil((Fe*Math.LN2+Math.log(512/360/.5))/Math.LN10),wt=Math.pow(10,ze),dt=Math.round(ne.lat*wt)/wt,Bt=Math.round(ne.lng*wt)/wt,P=`${Fe}/${dt}/${Bt}`,We=Le.getBearing(),me=Le.getPitch();return(We||me)&&(P+=`/${Math.round(We*10)/10}`),me&&(P+=`/${Math.round(me)}`),`#${P}`}function gI(Le){return Le.replace("#","").split("/").map(parseFloat)}var T_=o1;function o1(Le,ne){return Le===ne||Le!==Le&&ne!==ne?!0:typeof Le!=typeof ne||{}.toString.call(Le)!={}.toString.call(ne)||Le!==Object(Le)||!Le?!1:Array.isArray(Le)?Ow(Le,ne):{}.toString.call(Le)=="[object Set]"?Ow(Array.from(Le),Array.from(ne)):{}.toString.call(Le)=="[object Object]"?xI(Le,ne):yI(Le,ne)}function yI(Le,ne){return Le.toString()===ne.toString()}function Ow(Le,ne){var Fe=Le.length;if(Fe!=ne.length)return!1;for(var ze=0;ze<Fe;ze++)if(!o1(Le[ze],ne[ze]))return!1;return!0}function xI(Le,ne){var Fe=Object.keys(Le),ze=Fe.length;if(ze!=Object.keys(ne).length)return!1;for(var wt=0;wt<ze;wt++){var dt=Fe[wt];if(!(ne.hasOwnProperty(dt)&&o1(Le[dt],ne[dt])))return!1}return!0}function vI(Le,ne,Fe){let ze;const{map:wt}=k_();xf(Le,wt,Xt=>Fe(6,ze=Xt));let{position:dt="top-left"}=ne,{showCompass:Bt=!0}=ne,{showZoom:P=!0}=ne,{visualizePitch:We=!1}=ne,me=null;return C_(()=>{ze!=null&&ze.loaded()&&me&&ze.removeControl(me)}),Le.$$set=Xt=>{"position"in Xt&&Fe(1,dt=Xt.position),"showCompass"in Xt&&Fe(2,Bt=Xt.showCompass),"showZoom"in Xt&&Fe(3,P=Xt.showZoom),"visualizePitch"in Xt&&Fe(4,We=Xt.visualizePitch)},Le.$$.update=()=>{Le.$$.dirty&126&&ze&&!me&&(Fe(5,me=new lp.NavigationControl({showCompass:Bt,showZoom:P,visualizePitch:We})),ze.addControl(me,dt))},[wt,dt,Bt,P,We,me,ze]}class bI extends vh{constructor(ne){super(),bh(this,ne,vI,null,xh,{position:1,showCompass:2,showZoom:3,visualizePitch:4})}}function wI(Le,ne,Fe){let ze;const{map:wt}=k_();xf(Le,wt,me=>Fe(5,ze=me));let{position:dt="bottom-left"}=ne,{maxWidth:Bt=void 0}=ne,{unit:P="metric"}=ne,We=null;return C_(()=>{ze!=null&&ze.loaded()&&We&&ze.removeControl(We)}),Le.$$set=me=>{"position"in me&&Fe(1,dt=me.position),"maxWidth"in me&&Fe(2,Bt=me.maxWidth),"unit"in me&&Fe(3,P=me.unit)},Le.$$.update=()=>{Le.$$.dirty&62&&ze&&!We&&(Fe(4,We=new lp.ScaleControl({maxWidth:Bt,unit:P})),ze.addControl(We,dt))},[wt,dt,Bt,P,We,ze]}class TI extends vh{constructor(ne){super(),bh(this,ne,wI,null,xh,{position:1,maxWidth:2,unit:3})}}const EI=Le=>({map:Le[0]&8,loadedImages:Le[0]&16,allImagesLoaded:Le[0]&32}),Vw=Le=>({map:Le[3],loadedImages:Le[4],allImagesLoaded:Le[5]});function Nw(Le){let ne,Fe,ze=Le[2]&&Uw(Le);const wt=Le[34].default,dt=JS(wt,Le,Le[33],Vw);return{c(){ze&&ze.c(),ne=Ad(),dt&&dt.c()},l(Bt){ze&&ze.l(Bt),ne=cd(Bt),dt&&dt.l(Bt)},m(Bt,P){ze&&ze.m(Bt,P),ud(Bt,ne,P),dt&&dt.m(Bt,P),Fe=!0},p(Bt,P){Bt[2]?ze?(ze.p(Bt,P),P[0]&4&&kA(ze,1)):(ze=Uw(Bt),ze.c(),kA(ze,1),ze.m(ne.parentNode,ne)):ze&&(u2(),bc(ze,1,1,()=>{ze=null}),h2()),dt&&dt.p&&(!Fe||P[0]&56|P[1]&4)&&eI(dt,wt,Bt,Bt[33],Fe?iI(wt,Bt[33],P,EI):tI(Bt[33]),Vw)},i(Bt){Fe||(kA(ze),kA(dt,Bt),Fe=!0)},o(Bt){bc(ze),bc(dt,Bt),Fe=!1},d(Bt){Bt&&vc(ne),ze&&ze.d(Bt),dt&&dt.d(Bt)}}}function Uw(Le){let ne,Fe,ze,wt,dt,Bt,P,We;return ne=new bI({props:{position:Le[6]}}),ze=new mI({props:{position:Le[6],fitBoundsOptions:{maxZoom:12}}}),dt=new fI({props:{position:Le[6]}}),P=new TI({props:{position:Le[6]}}),{c(){sd(ne.$$.fragment),Fe=Ad(),sd(ze.$$.fragment),wt=Ad(),sd(dt.$$.fragment),Bt=Ad(),sd(P.$$.fragment)},l(me){od(ne.$$.fragment,me),Fe=cd(me),od(ze.$$.fragment,me),wt=cd(me),od(dt.$$.fragment,me),Bt=cd(me),od(P.$$.fragment,me)},m(me,Xt){ad(ne,me,Xt),ud(me,Fe,Xt),ad(ze,me,Xt),ud(me,wt,Xt),ad(dt,me,Xt),ud(me,Bt,Xt),ad(P,me,Xt),We=!0},p(me,Xt){const Rt={};Xt[0]&64&&(Rt.position=me[6]),ne.$set(Rt);const yt={};Xt[0]&64&&(yt.position=me[6]),ze.$set(yt);const qt={};Xt[0]&64&&(qt.position=me[6]),dt.$set(qt);const $t={};Xt[0]&64&&($t.position=me[6]),P.$set($t)},i(me){We||(kA(ne.$$.fragment,me),kA(ze.$$.fragment,me),kA(dt.$$.fragment,me),kA(P.$$.fragment,me),We=!0)},o(me){bc(ne.$$.fragment,me),bc(ze.$$.fragment,me),bc(dt.$$.fragment,me),bc(P.$$.fragment,me),We=!1},d(me){me&&(vc(Fe),vc(wt),vc(Bt)),ld(ne,me),ld(ze,me),ld(dt,me),ld(P,me)}}}function MI(Le){let ne,Fe,ze,wt,dt,Bt=Le[3]&&Le[0]&&Nw(Le);return{c(){ne=sp("div"),Bt&&Bt.c(),this.h()},l(P){ne=op(P,"DIV",{class:!0});var We=ap(ne);Bt&&Bt.l(We),We.forEach(vc),this.h()},h(){r1(ne,"class",Fe=n1(Le[1])+" svelte-p00lfq"),zw(ne,"expand-map",!Le[1])},m(P,We){ud(P,ne,We),Bt&&Bt.m(ne,null),ze=!0,wt||(dt=YS(Le[9].call(null,ne)),wt=!0)},p(P,We){P[3]&&P[0]?Bt?(Bt.p(P,We),We[0]&9&&kA(Bt,1)):(Bt=Nw(P),Bt.c(),kA(Bt,1),Bt.m(ne,null)):Bt&&(u2(),bc(Bt,1,1,()=>{Bt=null}),h2()),(!ze||We[0]&2&&Fe!==(Fe=n1(P[1])+" svelte-p00lfq"))&&r1(ne,"class",Fe),(!ze||We[0]&2)&&zw(ne,"expand-map",!P[1])},i(P){ze||(kA(Bt),ze=!0)},o(P){bc(Bt),ze=!1},d(P){P&&vc(ne),Bt&&Bt.d(),wt=!1,dt()}}}function SI(Le,ne,Fe){let ze,wt,dt,Bt,{$$slots:P={},$$scope:We}=ne,{map:me=null}=ne,{class:Xt=void 0}=ne,{style:Rt}=ne,{diffStyleUpdates:yt=!1}=ne,{center:qt=void 0}=ne,{zoom:$t=void 0}=ne,{pitch:ui=0}=ne,{bearing:di=0}=ne,{bounds:Ei=void 0}=ne,{hash:Vr=!1}=ne,{loaded:kr=!1}=ne,{minZoom:qr=0}=ne,{maxZoom:cn=22}=ne,{zoomOnDoubleClick:jr=!0}=ne,{interactive:Jn=!0}=ne,{attributionControl:rn=!0}=ne,{cooperativeGestures:pn=!1}=ne,{preserveDrawingBuffer:At=!1}=ne,{maxBounds:tr=void 0}=ne,{images:Sn=[]}=ne,{standardControls:Nn=!1}=ne,{filterLayers:Li=void 0}=ne,{transformRequest:Ir=void 0}=ne;const as=KS(),{map:es,loadedImages:wo}=lI();xf(Le,es,zt=>Fe(3,dt=zt)),xf(Le,wo,zt=>Fe(4,Bt=zt));let Io=new Set;function Zo(zt){dt!=null&&dt.loaded()&&("url"in zt?(Io.add(zt.id),dt.loadImage(zt.url,(dr,In)=>{Io.delete(zt.id),dr?as("error",dr):In&&(dt==null||dt.addImage(zt.id,In,zt.options),Bt.add(zt.id),wo.set(Bt))})):(dt.addImage(zt.id,zt.data,zt.options),Bt.add(zt.id),wo.set(Bt)))}let gs,hi,Yr,Hn;function Co(zt){if(Vr){let dr=gI(window.location.hash);dr.length>=3&&(Fe(11,$t=dr[0]),Fe(10,qt=[dr[2],dr[1]])),dr.length==5&&(Fe(15,di=dr[3]),Fe(14,ui=dr[4]))}return Bw(es,dt=new lp.Map(uI({container:zt,style:Rt,center:qt,zoom:$t,pitch:ui,bearing:di,minZoom:qr,maxZoom:cn,interactive:Jn,preserveDrawingBuffer:At,maxBounds:tr,bounds:Ei,attributionControl:rn,transformRequest:Ir,cooperativeGestures:pn})),dt),dt.on("load",dr=>{Fe(0,kr=!0),as("load",dt)}),dt.on("error",dr=>as("error",{...dr,map:dt})),dt.on("movestart",dr=>as("movestart",{...dr,map:dt})),dt.on("moveend",dr=>{if(Fe(10,qt=dr.target.getCenter()),Fe(11,$t=dr.target.getZoom()),Fe(12,Ei=dr.target.getBounds()),as("moveend",{...dr,map:dt}),Vr){let In=window.location.href.replace(/(#.+)?$/,_I(dt));window.history.replaceState(window.history.state,"",In)}}),dt.on("zoomstart",dr=>as("zoomstart",{...dr,map:dt})),dt.on("zoom",dr=>{Fe(11,$t=dr.target.getZoom()),as("zoom",{...dr,map:dt})}),dt.on("zoomend",dr=>{Fe(11,$t=dr.target.getZoom()),as("zoomend",{...dr,map:dt})}),dt.on("style.load",()=>{if(dt){const dr=dt.getStyle();if(Fe(30,gs=dr.layers.map(In=>In.id)),Fe(31,hi=Object.keys(dr.sources)),Hn)for(const[In,Es]of Object.entries(Hn))dt.addSource(In,Es);if(Yr)for(const In of Yr)dt.addLayer(In)}}),dt.on("styledata",dr=>{if(dt&&Li){const In=dt.getStyle().layers;if(In)for(let Es of In)Li(Es)||dt.setLayoutProperty(Es.id,"visibility","none")}as("styledata",{...dr,map:dt})}),{destroy(){Fe(0,kr=!1),dt==null||dt.remove(),Bw(es,dt=null,dt)}}}let to=Rt;return Le.$$set=zt=>{"map"in zt&&Fe(13,me=zt.map),"class"in zt&&Fe(1,Xt=zt.class),"style"in zt&&Fe(16,Rt=zt.style),"diffStyleUpdates"in zt&&Fe(17,yt=zt.diffStyleUpdates),"center"in zt&&Fe(10,qt=zt.center),"zoom"in zt&&Fe(11,$t=zt.zoom),"pitch"in zt&&Fe(14,ui=zt.pitch),"bearing"in zt&&Fe(15,di=zt.bearing),"bounds"in zt&&Fe(12,Ei=zt.bounds),"hash"in zt&&Fe(18,Vr=zt.hash),"loaded"in zt&&Fe(0,kr=zt.loaded),"minZoom"in zt&&Fe(19,qr=zt.minZoom),"maxZoom"in zt&&Fe(20,cn=zt.maxZoom),"zoomOnDoubleClick"in zt&&Fe(21,jr=zt.zoomOnDoubleClick),"interactive"in zt&&Fe(22,Jn=zt.interactive),"attributionControl"in zt&&Fe(23,rn=zt.attributionControl),"cooperativeGestures"in zt&&Fe(24,pn=zt.cooperativeGestures),"preserveDrawingBuffer"in zt&&Fe(25,At=zt.preserveDrawingBuffer),"maxBounds"in zt&&Fe(26,tr=zt.maxBounds),"images"in zt&&Fe(27,Sn=zt.images),"standardControls"in zt&&Fe(2,Nn=zt.standardControls),"filterLayers"in zt&&Fe(28,Li=zt.filterLayers),"transformRequest"in zt&&Fe(29,Ir=zt.transformRequest),"$$scope"in zt&&Fe(33,We=zt.$$scope)},Le.$$.update=()=>{if(Le.$$.dirty[0]&4&&Fe(6,ze=typeof Nn=="boolean"?void 0:Nn),Le.$$.dirty[0]&8&&Fe(13,me=dt),Le.$$.dirty[0]&134217737&&kr&&dt!=null&&dt.loaded())for(let zt of Sn)!Io.has(zt.id)&&!dt.hasImage(zt.id)&&Zo(zt);if(Le.$$.dirty[0]&134217744&&Fe(5,wt=Sn.every(zt=>Bt.has(zt.id))),Le.$$.dirty[0]&1073938440|Le.$$.dirty[1]&3&&dt&&!T_(Rt,to)){const zt=dt.getStyle();if(gs&&(Yr=zt.layers.filter(dr=>!gs.includes(dr.id))),hi){const dr=Object.keys(zt.sources).filter(In=>!hi.includes(In));Hn={};for(const In of dr)Hn[In]=zt.sources[In]}Fe(32,to=Rt),dt.setStyle(Rt,{diff:yt})}Le.$$.dirty[0]&1032&&qt&&!T_(qt,dt==null?void 0:dt.getCenter())&&(dt==null||dt.panTo(qt)),Le.$$.dirty[0]&2056&&$t&&!T_($t,dt==null?void 0:dt.getZoom())&&(dt==null||dt.zoomTo($t)),Le.$$.dirty[0]&4104&&Ei&&!T_(Ei,dt==null?void 0:dt.getBounds())&&(dt==null||dt.fitBounds(Ei)),Le.$$.dirty[0]&2097160&&(jr?dt==null||dt.doubleClickZoom.enable():dt==null||dt.doubleClickZoom.disable())},[kr,Xt,Nn,dt,Bt,wt,ze,es,wo,Co,qt,$t,Ei,me,ui,di,Rt,yt,Vr,qr,cn,jr,Jn,rn,pn,At,tr,Sn,Li,Ir,gs,hi,to,We,P]}class II extends vh{constructor(ne){super(),bh(this,ne,SI,MI,xh,{map:13,class:1,style:16,diffStyleUpdates:17,center:10,zoom:11,pitch:14,bearing:15,bounds:12,hash:18,loaded:0,minZoom:19,maxZoom:20,zoomOnDoubleClick:21,interactive:22,attributionControl:23,cooperativeGestures:24,preserveDrawingBuffer:25,maxBounds:26,images:27,standardControls:2,filterLayers:28,transformRequest:29},null,[-1,-1])}}var Ap=Uint8Array,g2=Uint16Array,CI=Int32Array,kI=new Ap([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),DI=new Ap([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),y2=function(Le,ne){for(var Fe=new g2(31),ze=0;ze<31;++ze)Fe[ze]=ne+=1<<Le[ze-1];for(var wt=new CI(Fe[30]),ze=1;ze<30;++ze)for(var dt=Fe[ze];dt<Fe[ze+1];++dt)wt[dt]=dt-Fe[ze]<<5|ze;return{b:Fe,r:wt}},x2=y2(kI,2),PI=x2.b,zI=x2.r;PI[28]=258,zI[258]=28;y2(DI,0);var BI=new g2(32768);for(Ts=0;Ts<32768;++Ts)Ou=(Ts&43690)>>1|(Ts&21845)<<1,Ou=(Ou&52428)>>2|(Ou&13107)<<2,Ou=(Ou&61680)>>4|(Ou&3855)<<4,BI[Ts]=((Ou&65280)>>8|(Ou&255)<<8)>>1;var Ou,Ts,D_=new Ap(288);for(Ts=0;Ts<144;++Ts)D_[Ts]=8;var Ts;for(Ts=144;Ts<256;++Ts)D_[Ts]=9;var Ts;for(Ts=256;Ts<280;++Ts)D_[Ts]=7;var Ts;for(Ts=280;Ts<288;++Ts)D_[Ts]=8;var Ts,LI=new Ap(32);for(Ts=0;Ts<32;++Ts)LI[Ts]=5;var Ts,RI=new Ap(0),FI=typeof TextDecoder<"u"&&new TextDecoder,OI=0;try{FI.decode(RI,{stream:!0}),OI=1}catch{}var P_={exports:{}},VI=UI,NI={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"};function UI(Le){if(!Le||!Le.type)return null;var ne=NI[Le.type];if(!ne)return null;if(ne==="geometry")return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:Le}]};if(ne==="feature")return{type:"FeatureCollection",features:[Le]};if(ne==="featurecollection")return Le}function M_(Le){switch(Le&&Le.type||null){case"FeatureCollection":return Le.features=Le.features.reduce(function(ne,Fe){return ne.concat(M_(Fe))},[]),Le;case"Feature":return Le.geometry?M_(Le.geometry).map(function(ne){var Fe={type:"Feature",properties:JSON.parse(JSON.stringify(Le.properties)),geometry:ne};return Le.id!==void 0&&(Fe.id=Le.id),Fe}):[Le];case"MultiPoint":return Le.coordinates.map(function(ne){return{type:"Point",coordinates:ne}});case"MultiPolygon":return Le.coordinates.map(function(ne){return{type:"Polygon",coordinates:ne}});case"MultiLineString":return Le.coordinates.map(function(ne){return{type:"LineString",coordinates:ne}});case"GeometryCollection":return Le.geometries.map(M_).reduce(function(ne,Fe){return ne.concat(Fe)},[]);case"Point":case"Polygon":case"LineString":return[Le]}}const jI=Object.freeze(Object.defineProperty({__proto__:null,default:M_},Symbol.toStringTag,{value:"Module"})),GI=AI(jI);var ZI=function(ne){return Fe(ne);function Fe(ze){return Array.isArray(ze)&&ze.length&&typeof ze[0]=="number"?[ze]:ze.reduce(function(wt,dt){return Array.isArray(dt)&&Array.isArray(dt[0])?wt.concat(Fe(dt)):(wt.push(dt),wt)},[])}},qI=VI,S_=GI,QI=ZI;S_ instanceof Function||(S_=S_.default);var HI=function(Le){if(!Le)return[];var ne=S_(qI(Le)),Fe=[];return ne.features.forEach(function(ze){ze.geometry&&(Fe=Fe.concat(QI(ze.geometry.coordinates)))}),Fe};function vf(Le){return Object.prototype.toString.call(Le)}function WI(Le){return vf(Le)==="[object Date]"}function $I(Le){return vf(Le)==="[object RegExp]"}function XI(Le){return vf(Le)==="[object Error]"}function YI(Le){return vf(Le)==="[object Boolean]"}function KI(Le){return vf(Le)==="[object Number]"}function JI(Le){return vf(Le)==="[object String]"}var v2=Array.isArray||function(ne){return Object.prototype.toString.call(ne)==="[object Array]"};function z_(Le,ne){if(Le.forEach)return Le.forEach(ne);for(var Fe=0;Fe<Le.length;Fe++)ne(Le[Fe],Fe,Le)}var eC=Object.keys||function(ne){var Fe=[];for(var ze in ne)Fe.push(ze);return Fe},tC=Object.prototype.propertyIsEnumerable,jw=Object.getOwnPropertySymbols;function B_(Le){var ne=eC(Le);if(jw)for(var Fe=jw(Le),ze=0;ze<Fe.length;ze++)tC.call(Le,Fe[ze])&&ne.push(Fe[ze]);return ne}var L_=Object.prototype.hasOwnProperty||function(Le,ne){return ne in Le};function b2(Le){if(typeof Le=="object"&&Le!==null){var ne;if(v2(Le))ne=[];else if(WI(Le))ne=new Date(Le.getTime?Le.getTime():Le);else if($I(Le))ne=new RegExp(Le);else if(XI(Le))ne={message:Le.message};else if(YI(Le)||KI(Le)||JI(Le))ne=Object(Le);else if(Object.create&&Object.getPrototypeOf)ne=Object.create(Object.getPrototypeOf(Le));else if(Le.constructor===Object)ne={};else{var Fe=Le.constructor&&Le.constructor.prototype||Le.__proto__||{},ze=function(){};ze.prototype=Fe,ne=new ze}return z_(B_(Le),function(wt){ne[wt]=Le[wt]}),ne}return Le}function w2(Le,ne,Fe){var ze=[],wt=[],dt=!0;return function Bt(P){var We=Fe?b2(P):P,me={},Xt=!0,Rt={node:We,node_:P,path:[].concat(ze),parent:wt[wt.length-1],parents:wt,key:ze[ze.length-1],isRoot:ze.length===0,level:ze.length,circular:null,update:function($t,ui){Rt.isRoot||(Rt.parent.node[Rt.key]=$t),Rt.node=$t,ui&&(Xt=!1)},delete:function($t){delete Rt.parent.node[Rt.key],$t&&(Xt=!1)},remove:function($t){v2(Rt.parent.node)?Rt.parent.node.splice(Rt.key,1):delete Rt.parent.node[Rt.key],$t&&(Xt=!1)},keys:null,before:function($t){me.before=$t},after:function($t){me.after=$t},pre:function($t){me.pre=$t},post:function($t){me.post=$t},stop:function(){dt=!1},block:function(){Xt=!1}};if(!dt)return Rt;function yt(){if(typeof Rt.node=="object"&&Rt.node!==null){(!Rt.keys||Rt.node_!==Rt.node)&&(Rt.keys=B_(Rt.node)),Rt.isLeaf=Rt.keys.length===0;for(var $t=0;$t<wt.length;$t++)if(wt[$t].node_===P){Rt.circular=wt[$t];break}}else Rt.isLeaf=!0,Rt.keys=null;Rt.notLeaf=!Rt.isLeaf,Rt.notRoot=!Rt.isRoot}yt();var qt=ne.call(Rt,Rt.node);return qt!==void 0&&Rt.update&&Rt.update(qt),me.before&&me.before.call(Rt,Rt.node),Xt&&(typeof Rt.node=="object"&&Rt.node!==null&&!Rt.circular&&(wt.push(Rt),yt(),z_(Rt.keys,function($t,ui){ze.push($t),me.pre&&me.pre.call(Rt,Rt.node[$t],$t);var di=Bt(Rt.node[$t]);Fe&&L_.call(Rt.node,$t)&&(Rt.node[$t]=di.node),di.isLast=ui===Rt.keys.length-1,di.isFirst=ui===0,me.post&&me.post.call(Rt,di),ze.pop()}),wt.pop()),me.after&&me.after.call(Rt,Rt.node)),Rt}(Le).node}function wc(Le){this.value=Le}wc.prototype.get=function(Le){for(var ne=this.value,Fe=0;Fe<Le.length;Fe++){var ze=Le[Fe];if(!ne||!L_.call(ne,ze))return;ne=ne[ze]}return ne};wc.prototype.has=function(Le){for(var ne=this.value,Fe=0;Fe<Le.length;Fe++){var ze=Le[Fe];if(!ne||!L_.call(ne,ze))return!1;ne=ne[ze]}return!0};wc.prototype.set=function(Le,ne){for(var Fe=this.value,ze=0;ze<Le.length-1;ze++){var wt=Le[ze];L_.call(Fe,wt)||(Fe[wt]={}),Fe=Fe[wt]}return Fe[Le[ze]]=ne,ne};wc.prototype.map=function(Le){return w2(this.value,Le,!0)};wc.prototype.forEach=function(Le){return this.value=w2(this.value,Le,!1),this.value};wc.prototype.reduce=function(Le,ne){var Fe=arguments.length===1,ze=Fe?this.value:ne;return this.forEach(function(wt){(!this.isRoot||!Fe)&&(ze=Le.call(this,ze,wt))}),ze};wc.prototype.paths=function(){var Le=[];return this.forEach(function(){Le.push(this.path)}),Le};wc.prototype.nodes=function(){var Le=[];return this.forEach(function(){Le.push(this.node)}),Le};wc.prototype.clone=function(){var Le=[],ne=[];return function Fe(ze){for(var wt=0;wt<Le.length;wt++)if(Le[wt]===ze)return ne[wt];if(typeof ze=="object"&&ze!==null){var dt=b2(ze);return Le.push(ze),ne.push(dt),z_(B_(ze),function(Bt){dt[Bt]=Fe(ze[Bt])}),Le.pop(),ne.pop(),dt}return ze}(this.value)};function T2(Le){return new wc(Le)}z_(B_(wc.prototype),function(Le){T2[Le]=function(ne){var Fe=[].slice.call(arguments,1),ze=new wc(ne);return ze[Le].apply(ze,Fe)}});var iC=T2,rC=cA;function cA(Le){if(!(this instanceof cA))return new cA(Le);this._bbox=Le||[1/0,1/0,-1/0,-1/0],this._valid=!!Le}cA.prototype.include=function(Le){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],Le[0]),this._bbox[1]=Math.min(this._bbox[1],Le[1]),this._bbox[2]=Math.max(this._bbox[2],Le[0]),this._bbox[3]=Math.max(this._bbox[3],Le[1]),this};cA.prototype.equals=function(Le){var ne;return Le instanceof cA?ne=Le.bbox():ne=Le,this._bbox[0]==ne[0]&&this._bbox[1]==ne[1]&&this._bbox[2]==ne[2]&&this._bbox[3]==ne[3]};cA.prototype.center=function(Le){return this._valid?[(this._bbox[0]+this._bbox[2])/2,(this._bbox[1]+this._bbox[3])/2]:null};cA.prototype.union=function(Le){this._valid=!0;var ne;return Le instanceof cA?ne=Le.bbox():ne=Le,this._bbox[0]=Math.min(this._bbox[0],ne[0]),this._bbox[1]=Math.min(this._bbox[1],ne[1]),this._bbox[2]=Math.max(this._bbox[2],ne[2]),this._bbox[3]=Math.max(this._bbox[3],ne[3]),this};cA.prototype.bbox=function(){return this._valid?this._bbox:null};cA.prototype.contains=function(Le){if(!Le)return this._fastContains();if(!this._valid)return null;var ne=Le[0],Fe=Le[1];return this._bbox[0]<=ne&&this._bbox[1]<=Fe&&this._bbox[2]>=ne&&this._bbox[3]>=Fe};cA.prototype.intersect=function(Le){if(!this._valid)return null;var ne;return Le instanceof cA?ne=Le.bbox():ne=Le,!(this._bbox[0]>ne[2]||this._bbox[2]<ne[0]||this._bbox[3]<ne[1]||this._bbox[1]>ne[3])};cA.prototype._fastContains=function(){if(!this._valid)return new Function("return null;");var Le="return "+this._bbox[0]+"<= ll[0] &&"+this._bbox[1]+"<= ll[1] &&"+this._bbox[2]+">= ll[0] &&"+this._bbox[3]+">= ll[1]";return new Function("ll",Le)};cA.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null};var nC=HI,sC=iC,oC=rC,E2={features:["FeatureCollection"],coordinates:["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],geometry:["Feature"],geometries:["GeometryCollection"]},aC=Object.keys(E2);P_.exports=function(Le){return a1(Le).bbox()};P_.exports.polygon=function(Le){return a1(Le).polygon()};P_.exports.bboxify=function(Le){return sC(Le).map(function(ne){if(ne){var Fe=aC.some(function(ze){return ne[ze]?E2[ze].indexOf(ne.type)!==-1:!1});Fe&&(ne.bbox=a1(ne).bbox(),this.update(ne))}})};function a1(Le){for(var ne=oC(),Fe=nC(Le),ze=0;ze<Fe.length;ze++)ne.include(Fe[ze]);return ne}var lC=P_.exports;const AC=p2(lC);var Yc=function(Le){Le=Le||{};var ne=typeof Le<"u"?Le:{},Fe={},ze;for(ze in ne)ne.hasOwnProperty(ze)&&(Fe[ze]=ne[ze]);var wt="";function dt(xe){return ne.locateFile?ne.locateFile(xe,wt):wt+xe}var Bt;typeof document<"u"&&document.currentScript&&(wt=document.currentScript.src),wt.indexOf("blob:")!==0?wt=wt.substr(0,wt.lastIndexOf("/")+1):wt="",Bt=function(Me,ct,Pt){var o=new XMLHttpRequest;o.open("GET",Me,!0),o.responseType="arraybuffer",o.onload=function(){if(o.status==200||o.status==0&&o.response){ct(o.response);return}var ti=Cn(Me);if(ti){ct(ti.buffer);return}Pt()},o.onerror=Pt,o.send(null)};var P=ne.print||console.log.bind(console),We=ne.printErr||console.warn.bind(console);for(ze in Fe)Fe.hasOwnProperty(ze)&&(ne[ze]=Fe[ze]);Fe=null,ne.arguments&&ne.arguments;var me=0,Xt=function(xe){me=xe},Rt=function(){return me},yt=8;function qt(xe,Me,ct,Pt){switch(ct=ct||"i8",ct.charAt(ct.length-1)==="*"&&(ct="i32"),ct){case"i1":Sn[xe>>0]=Me;break;case"i8":Sn[xe>>0]=Me;break;case"i16":Li[xe>>1]=Me;break;case"i32":Ir[xe>>2]=Me;break;case"i64":Qt=[Me>>>0,(ri=Me,+Cl(ri)>=1?ri>0?(pa(+Ra(ri/4294967296),4294967295)|0)>>>0:~~+Un((ri-+(~~ri>>>0))/4294967296)>>>0:0)],Ir[xe>>2]=Qt[0],Ir[xe+4>>2]=Qt[1];break;case"float":as[xe>>2]=Me;break;case"double":es[xe>>3]=Me;break;default:Et("invalid type for setValue: "+ct)}}function $t(xe,Me,ct){switch(Me=Me||"i8",Me.charAt(Me.length-1)==="*"&&(Me="i32"),Me){case"i1":return Sn[xe>>0];case"i8":return Sn[xe>>0];case"i16":return Li[xe>>1];case"i32":return Ir[xe>>2];case"i64":return Ir[xe>>2];case"float":return as[xe>>2];case"double":return es[xe>>3];default:Et("invalid type for getValue: "+Me)}return null}var ui=!1;function di(xe,Me){xe||Et("Assertion failed: "+Me)}function Ei(xe){var Me=ne["_"+xe];return di(Me,"Cannot call unknown function "+xe+", make sure it is exported"),Me}function Vr(xe,Me,ct,Pt,o){var oe={string:function(zi){var fn=0;if(zi!=null&&zi!==0){var Qs=(zi.length<<2)+1;fn=Ae(Qs),rn(zi,fn,Qs)}return fn},array:function(zi){var fn=Ae(zi.length);return pn(zi,fn),fn}};function ti(zi){return Me==="string"?jr(zi):Me==="boolean"?!!zi:zi}var xi=Ei(xe),yi=[],ai=0;if(Pt)for(var pi=0;pi<Pt.length;pi++){var gr=oe[ct[pi]];gr?(ai===0&&(ai=Te()),yi[pi]=gr(Pt[pi])):yi[pi]=Pt[pi]}var bi=xi.apply(null,yi);return bi=ti(bi),ai!==0&&pe(ai),bi}function kr(xe,Me,ct,Pt){ct=ct||[];var o=ct.every(function(ti){return ti==="number"}),oe=Me!=="string";return oe&&o&&!Pt?Ei(xe):function(){return Vr(xe,Me,ct,arguments)}}var qr=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function cn(xe,Me,ct){for(var Pt=Me+ct,o=Me;xe[o]&&!(o>=Pt);)++o;if(o-Me>16&&xe.subarray&&qr)return qr.decode(xe.subarray(Me,o));for(var oe="";Me<o;){var ti=xe[Me++];if(!(ti&128)){oe+=String.fromCharCode(ti);continue}var xi=xe[Me++]&63;if((ti&224)==192){oe+=String.fromCharCode((ti&31)<<6|xi);continue}var yi=xe[Me++]&63;if((ti&240)==224?ti=(ti&15)<<12|xi<<6|yi:ti=(ti&7)<<18|xi<<12|yi<<6|xe[Me++]&63,ti<65536)oe+=String.fromCharCode(ti);else{var ai=ti-65536;oe+=String.fromCharCode(55296|ai>>10,56320|ai&1023)}}return oe}function jr(xe,Me){return xe?cn(Nn,xe,Me):""}function Jn(xe,Me,ct,Pt){if(!(Pt>0))return 0;for(var o=ct,oe=ct+Pt-1,ti=0;ti<xe.length;++ti){var xi=xe.charCodeAt(ti);if(xi>=55296&&xi<=57343){var yi=xe.charCodeAt(++ti);xi=65536+((xi&1023)<<10)|yi&1023}if(xi<=127){if(ct>=oe)break;Me[ct++]=xi}else if(xi<=2047){if(ct+1>=oe)break;Me[ct++]=192|xi>>6,Me[ct++]=128|xi&63}else if(xi<=65535){if(ct+2>=oe)break;Me[ct++]=224|xi>>12,Me[ct++]=128|xi>>6&63,Me[ct++]=128|xi&63}else{if(ct+3>=oe)break;Me[ct++]=240|xi>>18,Me[ct++]=128|xi>>12&63,Me[ct++]=128|xi>>6&63,Me[ct++]=128|xi&63}}return Me[ct]=0,ct-o}function rn(xe,Me,ct){return Jn(xe,Nn,Me,ct)}typeof TextDecoder<"u"&&new TextDecoder("utf-16le");function pn(xe,Me){Sn.set(xe,Me)}function At(xe,Me){return xe%Me>0&&(xe+=Me-xe%Me),xe}var tr,Sn,Nn,Li,Ir,as,es;function wo(xe){tr=xe,ne.HEAP8=Sn=new Int8Array(xe),ne.HEAP16=Li=new Int16Array(xe),ne.HEAP32=Ir=new Int32Array(xe),ne.HEAPU8=Nn=new Uint8Array(xe),ne.HEAPU16=new Uint16Array(xe),ne.HEAPU32=new Uint32Array(xe),ne.HEAPF32=as=new Float32Array(xe),ne.HEAPF64=es=new Float64Array(xe)}var Io=5267040,Zo=24128,gs=ne.TOTAL_MEMORY||33554432;ne.buffer?tr=ne.buffer:tr=new ArrayBuffer(gs),gs=tr.byteLength,wo(tr),Ir[Zo>>2]=Io;function hi(xe){for(;xe.length>0;){var Me=xe.shift();if(typeof Me=="function"){Me();continue}var ct=Me.func;typeof ct=="number"?Me.arg===void 0?ne.dynCall_v(ct):ne.dynCall_vi(ct,Me.arg):ct(Me.arg===void 0?null:Me.arg)}}var Yr=[],Hn=[],Co=[],to=[];function zt(){if(ne.preRun)for(typeof ne.preRun=="function"&&(ne.preRun=[ne.preRun]);ne.preRun.length;)Il(ne.preRun.shift());hi(Yr)}function dr(){hi(Hn)}function In(){hi(Co)}function Es(){if(ne.postRun)for(typeof ne.postRun=="function"&&(ne.postRun=[ne.postRun]);ne.postRun.length;)La(ne.postRun.shift());hi(to)}function Il(xe){Yr.unshift(xe)}function La(xe){to.unshift(xe)}var Cl=Math.abs,Un=Math.ceil,Ra=Math.floor,pa=Math.min,Yt=0,Ue=null;function $e(xe){Yt++,ne.monitorRunDependencies&&ne.monitorRunDependencies(Yt)}function Pe(xe){if(Yt--,ne.monitorRunDependencies&&ne.monitorRunDependencies(Yt),Yt==0&&Ue){var Me=Ue;Ue=null,Me()}}ne.preloadedImages={},ne.preloadedAudios={};var Ft=null,Zt="data:application/octet-stream;base64,";function ni(xe){return String.prototype.startsWith?xe.startsWith(Zt):xe.indexOf(Zt)===0}var ri,Qt;Ft="data:application/octet-stream;base64,AAAAAAAAAAAAAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAAAQAAAAQAAAADAAAABgAAAAUAAAACAAAAAAAAAAIAAAADAAAAAQAAAAQAAAAGAAAAAAAAAAUAAAADAAAABgAAAAQAAAAFAAAAAAAAAAEAAAACAAAABAAAAAUAAAAGAAAAAAAAAAIAAAADAAAAAQAAAAUAAAACAAAAAAAAAAEAAAADAAAABgAAAAQAAAAGAAAAAAAAAAUAAAACAAAAAQAAAAQAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAIAAAADAAAAAAAAAAAAAAACAAAAAAAAAAEAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAYAAAAAAAAABQAAAAAAAAAAAAAABAAAAAUAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAYAAAAAAAAABgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAIAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAIAAAADAAAABQAAAAYAAAAAAAAAAQAAAAIAAAADAAAABAAAAAYAAAAAAAAAAQAAAAIAAAADAAAABAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAIAAAAAAAAAAAAAAAYAAAAAAAAAAwAAAAIAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAFAAAABAAAAAAAAAABAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAYAAAAAAAAABAAAAAAAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAgAAAAQAAAADAAAACAAAAAEAAAAHAAAABgAAAAkAAAAAAAAAAwAAAAIAAAACAAAABgAAAAoAAAALAAAAAAAAAAEAAAAFAAAAAwAAAA0AAAABAAAABwAAAAQAAAAMAAAAAAAAAAQAAAB/AAAADwAAAAgAAAADAAAAAAAAAAwAAAAFAAAAAgAAABIAAAAKAAAACAAAAAAAAAAQAAAABgAAAA4AAAALAAAAEQAAAAEAAAAJAAAAAgAAAAcAAAAVAAAACQAAABMAAAADAAAADQAAAAEAAAAIAAAABQAAABYAAAAQAAAABAAAAAAAAAAPAAAACQAAABMAAAAOAAAAFAAAAAEAAAAHAAAABgAAAAoAAAALAAAAGAAAABcAAAAFAAAAAgAAABIAAAALAAAAEQAAABcAAAAZAAAAAgAAAAYAAAAKAAAADAAAABwAAAANAAAAGgAAAAQAAAAPAAAAAwAAAA0AAAAaAAAAFQAAAB0AAAADAAAADAAAAAcAAAAOAAAAfwAAABEAAAAbAAAACQAAABQAAAAGAAAADwAAABYAAAAcAAAAHwAAAAQAAAAIAAAADAAAABAAAAASAAAAIQAAAB4AAAAIAAAABQAAABYAAAARAAAACwAAAA4AAAAGAAAAIwAAABkAAAAbAAAAEgAAABgAAAAeAAAAIAAAAAUAAAAKAAAAEAAAABMAAAAiAAAAFAAAACQAAAAHAAAAFQAAAAkAAAAUAAAADgAAABMAAAAJAAAAKAAAABsAAAAkAAAAFQAAACYAAAATAAAAIgAAAA0AAAAdAAAABwAAABYAAAAQAAAAKQAAACEAAAAPAAAACAAAAB8AAAAXAAAAGAAAAAsAAAAKAAAAJwAAACUAAAAZAAAAGAAAAH8AAAAgAAAAJQAAAAoAAAAXAAAAEgAAABkAAAAXAAAAEQAAAAsAAAAtAAAAJwAAACMAAAAaAAAAKgAAAB0AAAArAAAADAAAABwAAAANAAAAGwAAACgAAAAjAAAALgAAAA4AAAAUAAAAEQAAABwAAAAfAAAAKgAAACwAAAAMAAAADwAAABoAAAAdAAAAKwAAACYAAAAvAAAADQAAABoAAAAVAAAAHgAAACAAAAAwAAAAMgAAABAAAAASAAAAIQAAAB8AAAApAAAALAAAADUAAAAPAAAAFgAAABwAAAAgAAAAHgAAABgAAAASAAAANAAAADIAAAAlAAAAIQAAAB4AAAAxAAAAMAAAABYAAAAQAAAAKQAAACIAAAATAAAAJgAAABUAAAA2AAAAJAAAADMAAAAjAAAALgAAAC0AAAA4AAAAEQAAABsAAAAZAAAAJAAAABQAAAAiAAAAEwAAADcAAAAoAAAANgAAACUAAAAnAAAANAAAADkAAAAYAAAAFwAAACAAAAAmAAAAfwAAACIAAAAzAAAAHQAAAC8AAAAVAAAAJwAAACUAAAAZAAAAFwAAADsAAAA5AAAALQAAACgAAAAbAAAAJAAAABQAAAA8AAAALgAAADcAAAApAAAAMQAAADUAAAA9AAAAFgAAACEAAAAfAAAAKgAAADoAAAArAAAAPgAAABwAAAAsAAAAGgAAACsAAAA+AAAALwAAAEAAAAAaAAAAKgAAAB0AAAAsAAAANQAAADoAAABBAAAAHAAAAB8AAAAqAAAALQAAACcAAAAjAAAAGQAAAD8AAAA7AAAAOAAAAC4AAAA8AAAAOAAAAEQAAAAbAAAAKAAAACMAAAAvAAAAJgAAACsAAAAdAAAARQAAADMAAABAAAAAMAAAADEAAAAeAAAAIQAAAEMAAABCAAAAMgAAADEAAAB/AAAAPQAAAEIAAAAhAAAAMAAAACkAAAAyAAAAMAAAACAAAAAeAAAARgAAAEMAAAA0AAAAMwAAAEUAAAA2AAAARwAAACYAAAAvAAAAIgAAADQAAAA5AAAARgAAAEoAAAAgAAAAJQAAADIAAAA1AAAAPQAAAEEAAABLAAAAHwAAACkAAAAsAAAANgAAAEcAAAA3AAAASQAAACIAAAAzAAAAJAAAADcAAAAoAAAANgAAACQAAABIAAAAPAAAAEkAAAA4AAAARAAAAD8AAABNAAAAIwAAAC4AAAAtAAAAOQAAADsAAABKAAAATgAAACUAAAAnAAAANAAAADoAAAB/AAAAPgAAAEwAAAAsAAAAQQAAACoAAAA7AAAAPwAAAE4AAABPAAAAJwAAAC0AAAA5AAAAPAAAAEgAAABEAAAAUAAAACgAAAA3AAAALgAAAD0AAAA1AAAAMQAAACkAAABRAAAASwAAAEIAAAA+AAAAKwAAADoAAAAqAAAAUgAAAEAAAABMAAAAPwAAAH8AAAA4AAAALQAAAE8AAAA7AAAATQAAAEAAAAAvAAAAPgAAACsAAABUAAAARQAAAFIAAABBAAAAOgAAADUAAAAsAAAAVgAAAEwAAABLAAAAQgAAAEMAAABRAAAAVQAAADEAAAAwAAAAPQAAAEMAAABCAAAAMgAAADAAAABXAAAAVQAAAEYAAABEAAAAOAAAADwAAAAuAAAAWgAAAE0AAABQAAAARQAAADMAAABAAAAALwAAAFkAAABHAAAAVAAAAEYAAABDAAAANAAAADIAAABTAAAAVwAAAEoAAABHAAAAWQAAAEkAAABbAAAAMwAAAEUAAAA2AAAASAAAAH8AAABJAAAANwAAAFAAAAA8AAAAWAAAAEkAAABbAAAASAAAAFgAAAA2AAAARwAAADcAAABKAAAATgAAAFMAAABcAAAANAAAADkAAABGAAAASwAAAEEAAAA9AAAANQAAAF4AAABWAAAAUQAAAEwAAABWAAAAUgAAAGAAAAA6AAAAQQAAAD4AAABNAAAAPwAAAEQAAAA4AAAAXQAAAE8AAABaAAAATgAAAEoAAAA7AAAAOQAAAF8AAABcAAAATwAAAE8AAABOAAAAPwAAADsAAABdAAAAXwAAAE0AAABQAAAARAAAAEgAAAA8AAAAYwAAAFoAAABYAAAAUQAAAFUAAABeAAAAZQAAAD0AAABCAAAASwAAAFIAAABgAAAAVAAAAGIAAAA+AAAATAAAAEAAAABTAAAAfwAAAEoAAABGAAAAZAAAAFcAAABcAAAAVAAAAEUAAABSAAAAQAAAAGEAAABZAAAAYgAAAFUAAABXAAAAZQAAAGYAAABCAAAAQwAAAFEAAABWAAAATAAAAEsAAABBAAAAaAAAAGAAAABeAAAAVwAAAFMAAABmAAAAZAAAAEMAAABGAAAAVQAAAFgAAABIAAAAWwAAAEkAAABjAAAAUAAAAGkAAABZAAAAYQAAAFsAAABnAAAARQAAAFQAAABHAAAAWgAAAE0AAABQAAAARAAAAGoAAABdAAAAYwAAAFsAAABJAAAAWQAAAEcAAABpAAAAWAAAAGcAAABcAAAAUwAAAE4AAABKAAAAbAAAAGQAAABfAAAAXQAAAE8AAABaAAAATQAAAG0AAABfAAAAagAAAF4AAABWAAAAUQAAAEsAAABrAAAAaAAAAGUAAABfAAAAXAAAAE8AAABOAAAAbQAAAGwAAABdAAAAYAAAAGgAAABiAAAAbgAAAEwAAABWAAAAUgAAAGEAAAB/AAAAYgAAAFQAAABnAAAAWQAAAG8AAABiAAAAbgAAAGEAAABvAAAAUgAAAGAAAABUAAAAYwAAAFAAAABpAAAAWAAAAGoAAABaAAAAcQAAAGQAAABmAAAAUwAAAFcAAABsAAAAcgAAAFwAAABlAAAAZgAAAGsAAABwAAAAUQAAAFUAAABeAAAAZgAAAGUAAABXAAAAVQAAAHIAAABwAAAAZAAAAGcAAABbAAAAYQAAAFkAAAB0AAAAaQAAAG8AAABoAAAAawAAAG4AAABzAAAAVgAAAF4AAABgAAAAaQAAAFgAAABnAAAAWwAAAHEAAABjAAAAdAAAAGoAAABdAAAAYwAAAFoAAAB1AAAAbQAAAHEAAABrAAAAfwAAAGUAAABeAAAAcwAAAGgAAABwAAAAbAAAAGQAAABfAAAAXAAAAHYAAAByAAAAbQAAAG0AAABsAAAAXQAAAF8AAAB1AAAAdgAAAGoAAABuAAAAYgAAAGgAAABgAAAAdwAAAG8AAABzAAAAbwAAAGEAAABuAAAAYgAAAHQAAABnAAAAdwAAAHAAAABrAAAAZgAAAGUAAAB4AAAAcwAAAHIAAABxAAAAYwAAAHQAAABpAAAAdQAAAGoAAAB5AAAAcgAAAHAAAABkAAAAZgAAAHYAAAB4AAAAbAAAAHMAAABuAAAAawAAAGgAAAB4AAAAdwAAAHAAAAB0AAAAZwAAAHcAAABvAAAAcQAAAGkAAAB5AAAAdQAAAH8AAABtAAAAdgAAAHEAAAB5AAAAagAAAHYAAAB4AAAAbAAAAHIAAAB1AAAAeQAAAG0AAAB3AAAAbwAAAHMAAABuAAAAeQAAAHQAAAB4AAAAeAAAAHMAAAByAAAAcAAAAHkAAAB3AAAAdgAAAHkAAAB0AAAAeAAAAHcAAAB1AAAAcQAAAHYAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAABAAAABQAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAACAAAABQAAAAEAAAAAAAAA/////wEAAAAAAAAAAwAAAAQAAAACAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAFAAAAAQAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAAAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAADAAAABQAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAEAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAAAAAABAAAAAwAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAUAAAABAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAABAAAAAUAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAIAAAAFAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAD/////AQAAAAAAAAADAAAABAAAAAIAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAUAAAABAAAAAAAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAEAAAD//////////wEAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAACAAAAAAAAAAAAAAABAAAAAgAAAAYAAAAEAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAcAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAKAAAAAgAAAAAAAAAAAAAAAQAAAAEAAAAFAAAABgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAACAAAAAAAAAAAAAAABAAAAAwAAAAcAAAAGAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABwAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAADgAAAAIAAAAAAAAAAAAAAAEAAAAAAAAACQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAMAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAIAAAAAAAAAAAAAAAEAAAAEAAAACAAAAAoAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAALAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAACQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAgAAAAAAAAAAAAAAAQAAAAsAAAAPAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAIAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAgAAAAAAAAAAAAAAAQAAAAwAAAAQAAAADAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAoAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAPAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAADwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAACAAAAAAAAAAAAAAABAAAACgAAABMAAAAIAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAQAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAACQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAIAAAAAAAAAAAAAAAEAAAANAAAAEQAAAA0AAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAARAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA0AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAACAAAAAAAAAAAAAAABAAAADgAAABIAAAAPAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAADwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABIAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAATAAAAAgAAAAAAAAAAAAAAAQAAAP//////////EwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAASAAAAAAAAABgAAAAAAAAAIQAAAAAAAAAeAAAAAAAAACAAAAADAAAAMQAAAAEAAAAwAAAAAwAAADIAAAADAAAACAAAAAAAAAAFAAAABQAAAAoAAAAFAAAAFgAAAAAAAAAQAAAAAAAAABIAAAAAAAAAKQAAAAEAAAAhAAAAAAAAAB4AAAAAAAAABAAAAAAAAAAAAAAABQAAAAIAAAAFAAAADwAAAAEAAAAIAAAAAAAAAAUAAAAFAAAAHwAAAAEAAAAWAAAAAAAAABAAAAAAAAAAAgAAAAAAAAAGAAAAAAAAAA4AAAAAAAAACgAAAAAAAAALAAAAAAAAABEAAAADAAAAGAAAAAEAAAAXAAAAAwAAABkAAAADAAAAAAAAAAAAAAABAAAABQAAAAkAAAAFAAAABQAAAAAAAAACAAAAAAAAAAYAAAAAAAAAEgAAAAEAAAAKAAAAAAAAAAsAAAAAAAAABAAAAAEAAAADAAAABQAAAAcAAAAFAAAACAAAAAEAAAAAAAAAAAAAAAEAAAAFAAAAEAAAAAEAAAAFAAAAAAAAAAIAAAAAAAAABwAAAAAAAAAVAAAAAAAAACYAAAAAAAAACQAAAAAAAAATAAAAAAAAACIAAAADAAAADgAAAAEAAAAUAAAAAwAAACQAAAADAAAAAwAAAAAAAAANAAAABQAAAB0AAAAFAAAAAQAAAAAAAAAHAAAAAAAAABUAAAAAAAAABgAAAAEAAAAJAAAAAAAAABMAAAAAAAAABAAAAAIAAAAMAAAABQAAABoAAAAFAAAAAAAAAAEAAAADAAAAAAAAAA0AAAAFAAAAAgAAAAEAAAABAAAAAAAAAAcAAAAAAAAAGgAAAAAAAAAqAAAAAAAAADoAAAAAAAAAHQAAAAAAAAArAAAAAAAAAD4AAAADAAAAJgAAAAEAAAAvAAAAAwAAAEAAAAADAAAADAAAAAAAAAAcAAAABQAAACwAAAAFAAAADQAAAAAAAAAaAAAAAAAAACoAAAAAAAAAFQAAAAEAAAAdAAAAAAAAACsAAAAAAAAABAAAAAMAAAAPAAAABQAAAB8AAAAFAAAAAwAAAAEAAAAMAAAAAAAAABwAAAAFAAAABwAAAAEAAAANAAAAAAAAABoAAAAAAAAAHwAAAAAAAAApAAAAAAAAADEAAAAAAAAALAAAAAAAAAA1AAAAAAAAAD0AAAADAAAAOgAAAAEAAABBAAAAAwAAAEsAAAADAAAADwAAAAAAAAAWAAAABQAAACEAAAAFAAAAHAAAAAAAAAAfAAAAAAAAACkAAAAAAAAAKgAAAAEAAAAsAAAAAAAAADUAAAAAAAAABAAAAAQAAAAIAAAABQAAABAAAAAFAAAADAAAAAEAAAAPAAAAAAAAABYAAAAFAAAAGgAAAAEAAAAcAAAAAAAAAB8AAAAAAAAAMgAAAAAAAAAwAAAAAAAAADEAAAADAAAAIAAAAAAAAAAeAAAAAwAAACEAAAADAAAAGAAAAAMAAAASAAAAAwAAABAAAAADAAAARgAAAAAAAABDAAAAAAAAAEIAAAADAAAANAAAAAMAAAAyAAAAAAAAADAAAAAAAAAAJQAAAAMAAAAgAAAAAAAAAB4AAAADAAAAUwAAAAAAAABXAAAAAwAAAFUAAAADAAAASgAAAAMAAABGAAAAAAAAAEMAAAAAAAAAOQAAAAEAAAA0AAAAAwAAADIAAAAAAAAAGQAAAAAAAAAXAAAAAAAAABgAAAADAAAAEQAAAAAAAAALAAAAAwAAAAoAAAADAAAADgAAAAMAAAAGAAAAAwAAAAIAAAADAAAALQAAAAAAAAAnAAAAAAAAACUAAAADAAAAIwAAAAMAAAAZAAAAAAAAABcAAAAAAAAAGwAAAAMAAAARAAAAAAAAAAsAAAADAAAAPwAAAAAAAAA7AAAAAwAAADkAAAADAAAAOAAAAAMAAAAtAAAAAAAAACcAAAAAAAAALgAAAAMAAAAjAAAAAwAAABkAAAAAAAAAJAAAAAAAAAAUAAAAAAAAAA4AAAADAAAAIgAAAAAAAAATAAAAAwAAAAkAAAADAAAAJgAAAAMAAAAVAAAAAwAAAAcAAAADAAAANwAAAAAAAAAoAAAAAAAAABsAAAADAAAANgAAAAMAAAAkAAAAAAAAABQAAAAAAAAAMwAAAAMAAAAiAAAAAAAAABMAAAADAAAASAAAAAAAAAA8AAAAAwAAAC4AAAADAAAASQAAAAMAAAA3AAAAAAAAACgAAAAAAAAARwAAAAMAAAA2AAAAAwAAACQAAAAAAAAAQAAAAAAAAAAvAAAAAAAAACYAAAADAAAAPgAAAAAAAAArAAAAAwAAAB0AAAADAAAAOgAAAAMAAAAqAAAAAwAAABoAAAADAAAAVAAAAAAAAABFAAAAAAAAADMAAAADAAAAUgAAAAMAAABAAAAAAAAAAC8AAAAAAAAATAAAAAMAAAA+AAAAAAAAACsAAAADAAAAYQAAAAAAAABZAAAAAwAAAEcAAAADAAAAYgAAAAMAAABUAAAAAAAAAEUAAAAAAAAAYAAAAAMAAABSAAAAAwAAAEAAAAAAAAAASwAAAAAAAABBAAAAAAAAADoAAAADAAAAPQAAAAAAAAA1AAAAAwAAACwAAAADAAAAMQAAAAMAAAApAAAAAwAAAB8AAAADAAAAXgAAAAAAAABWAAAAAAAAAEwAAAADAAAAUQAAAAMAAABLAAAAAAAAAEEAAAAAAAAAQgAAAAMAAAA9AAAAAAAAADUAAAADAAAAawAAAAAAAABoAAAAAwAAAGAAAAADAAAAZQAAAAMAAABeAAAAAAAAAFYAAAAAAAAAVQAAAAMAAABRAAAAAwAAAEsAAAAAAAAAOQAAAAAAAAA7AAAAAAAAAD8AAAADAAAASgAAAAAAAABOAAAAAwAAAE8AAAADAAAAUwAAAAMAAABcAAAAAwAAAF8AAAADAAAAJQAAAAAAAAAnAAAAAwAAAC0AAAADAAAANAAAAAAAAAA5AAAAAAAAADsAAAAAAAAARgAAAAMAAABKAAAAAAAAAE4AAAADAAAAGAAAAAAAAAAXAAAAAwAAABkAAAADAAAAIAAAAAMAAAAlAAAAAAAAACcAAAADAAAAMgAAAAMAAAA0AAAAAAAAADkAAAAAAAAALgAAAAAAAAA8AAAAAAAAAEgAAAADAAAAOAAAAAAAAABEAAAAAwAAAFAAAAADAAAAPwAAAAMAAABNAAAAAwAAAFoAAAADAAAAGwAAAAAAAAAoAAAAAwAAADcAAAADAAAAIwAAAAAAAAAuAAAAAAAAADwAAAAAAAAALQAAAAMAAAA4AAAAAAAAAEQAAAADAAAADgAAAAAAAAAUAAAAAwAAACQAAAADAAAAEQAAAAMAAAAbAAAAAAAAACgAAAADAAAAGQAAAAMAAAAjAAAAAAAAAC4AAAAAAAAARwAAAAAAAABZAAAAAAAAAGEAAAADAAAASQAAAAAAAABbAAAAAwAAAGcAAAADAAAASAAAAAMAAABYAAAAAwAAAGkAAAADAAAAMwAAAAAAAABFAAAAAwAAAFQAAAADAAAANgAAAAAAAABHAAAAAAAAAFkAAAAAAAAANwAAAAMAAABJAAAAAAAAAFsAAAADAAAAJgAAAAAAAAAvAAAAAwAAAEAAAAADAAAAIgAAAAMAAAAzAAAAAAAAAEUAAAADAAAAJAAAAAMAAAA2AAAAAAAAAEcAAAAAAAAAYAAAAAAAAABoAAAAAAAAAGsAAAADAAAAYgAAAAAAAABuAAAAAwAAAHMAAAADAAAAYQAAAAMAAABvAAAAAwAAAHcAAAADAAAATAAAAAAAAABWAAAAAwAAAF4AAAADAAAAUgAAAAAAAABgAAAAAAAAAGgAAAAAAAAAVAAAAAMAAABiAAAAAAAAAG4AAAADAAAAOgAAAAAAAABBAAAAAwAAAEsAAAADAAAAPgAAAAMAAABMAAAAAAAAAFYAAAADAAAAQAAAAAMAAABSAAAAAAAAAGAAAAAAAAAAVQAAAAAAAABXAAAAAAAAAFMAAAADAAAAZQAAAAAAAABmAAAAAwAAAGQAAAADAAAAawAAAAMAAABwAAAAAwAAAHIAAAADAAAAQgAAAAAAAABDAAAAAwAAAEYAAAADAAAAUQAAAAAAAABVAAAAAAAAAFcAAAAAAAAAXgAAAAMAAABlAAAAAAAAAGYAAAADAAAAMQAAAAAAAAAwAAAAAwAAADIAAAADAAAAPQAAAAMAAABCAAAAAAAAAEMAAAADAAAASwAAAAMAAABRAAAAAAAAAFUAAAAAAAAAXwAAAAAAAABcAAAAAAAAAFMAAAAAAAAATwAAAAAAAABOAAAAAAAAAEoAAAADAAAAPwAAAAEAAAA7AAAAAwAAADkAAAADAAAAbQAAAAAAAABsAAAAAAAAAGQAAAAFAAAAXQAAAAEAAABfAAAAAAAAAFwAAAAAAAAATQAAAAEAAABPAAAAAAAAAE4AAAAAAAAAdQAAAAQAAAB2AAAABQAAAHIAAAAFAAAAagAAAAEAAABtAAAAAAAAAGwAAAAAAAAAWgAAAAEAAABdAAAAAQAAAF8AAAAAAAAAWgAAAAAAAABNAAAAAAAAAD8AAAAAAAAAUAAAAAAAAABEAAAAAAAAADgAAAADAAAASAAAAAEAAAA8AAAAAwAAAC4AAAADAAAAagAAAAAAAABdAAAAAAAAAE8AAAAFAAAAYwAAAAEAAABaAAAAAAAAAE0AAAAAAAAAWAAAAAEAAABQAAAAAAAAAEQAAAAAAAAAdQAAAAMAAABtAAAABQAAAF8AAAAFAAAAcQAAAAEAAABqAAAAAAAAAF0AAAAAAAAAaQAAAAEAAABjAAAAAQAAAFoAAAAAAAAAaQAAAAAAAABYAAAAAAAAAEgAAAAAAAAAZwAAAAAAAABbAAAAAAAAAEkAAAADAAAAYQAAAAEAAABZAAAAAwAAAEcAAAADAAAAcQAAAAAAAABjAAAAAAAAAFAAAAAFAAAAdAAAAAEAAABpAAAAAAAAAFgAAAAAAAAAbwAAAAEAAABnAAAAAAAAAFsAAAAAAAAAdQAAAAIAAABqAAAABQAAAFoAAAAFAAAAeQAAAAEAAABxAAAAAAAAAGMAAAAAAAAAdwAAAAEAAAB0AAAAAQAAAGkAAAAAAAAAdwAAAAAAAABvAAAAAAAAAGEAAAAAAAAAcwAAAAAAAABuAAAAAAAAAGIAAAADAAAAawAAAAEAAABoAAAAAwAAAGAAAAADAAAAeQAAAAAAAAB0AAAAAAAAAGcAAAAFAAAAeAAAAAEAAAB3AAAAAAAAAG8AAAAAAAAAcAAAAAEAAABzAAAAAAAAAG4AAAAAAAAAdQAAAAEAAABxAAAABQAAAGkAAAAFAAAAdgAAAAEAAAB5AAAAAAAAAHQAAAAAAAAAcgAAAAEAAAB4AAAAAQAAAHcAAAAAAAAAcgAAAAAAAABwAAAAAAAAAGsAAAAAAAAAZAAAAAAAAABmAAAAAAAAAGUAAAADAAAAUwAAAAEAAABXAAAAAwAAAFUAAAADAAAAdgAAAAAAAAB4AAAAAAAAAHMAAAAFAAAAbAAAAAEAAAByAAAAAAAAAHAAAAAAAAAAXAAAAAEAAABkAAAAAAAAAGYAAAAAAAAAdQAAAAAAAAB5AAAABQAAAHcAAAAFAAAAbQAAAAEAAAB2AAAAAAAAAHgAAAAAAAAAXwAAAAEAAABsAAAAAQAAAHIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAGAAAAAgAAAAUAAAABAAAABAAAAAAAAAAAAAAABQAAAAMAAAABAAAABgAAAAQAAAACAAAAAAAAAH6iBfbytuk/Gq6akm/58z/Xrm0Liez0P5doSdOpSwRAWs602ULg8D/dT7Rcbo/1v1N1RQHFNOM/g9Snx7HW3L8HWsP8Q3jfP6VwOLosutk/9rjk1YQcxj+gnmKMsNn6P/HDeuPFY+M/YHwDjqKhB0Ci19/fCVrbP4UxKkDWOP6/pvljWa09tL9wi7wrQXjnv/Z6yLImkM2/3yTlOzY14D+m+WNZrT20PzwKVQnrQwNA9nrIsiaQzT/g40rFrRQFwPa45NWEHMa/kbslHEZq97/xw3rjxWPjv4cLC2SMBci/otff3wla27+rKF5oIAv0P1N1RQHFNOO/iDJPGyWHBUAHWsP8Q3jfvwQf/by16gXAfqIF9vK26b8XrO0Vh0r+v9eubQuJ7PS/BxLrA0ZZ479azrTZQuDwv1MK1EuItPw/yscgV9Z6FkAwHBR2WjQMQJNRzXsQ5vY/GlUHVJYKF0DONuFv2lMNQNCGZ28QJfk/0WUwoIL36D8ggDOMQuATQNqMOeAy/wZAWFYOYM+M2z/LWC4uH3oSQDE+LyTsMgRAkJzhRGWFGEDd4soovCQQQKqk0DJMEP8/rGmNdwOLBUAW2X/9xCbjP4hu3dcqJhNAzuYItRvdB0CgzW3zJW/sPxotm/Y2TxRAQAk9XmdDDEC1Kx9MKgT3P1M+NctcghZAFVqcLlb0C0Bgzd3sB2b2P77mZDPUWhZAFROHJpUGCEDAfma5CxXtPz1DWq/zYxRAmhYY5824F0DOuQKWSbAOQNCMqrvu3fs/L6DR22K2wT9nAAxPBU8RQGiN6mW43AFAZhu25b633D8c1YgmzowSQNM25BRKWARArGS08/lNxD+LFssHwmMRQLC5aNcxBgJABL9HT0WRF0CjCmJmOGEOQHsuaVzMP/s/TWJCaGGwBUCeu1PAPLzjP9nqN9DZOBNAKE4JcydbCkCGtbd1qjPzP8dgm9U8jhVAtPeKTkVwDkCeCLss5l37P401XMPLmBdAFd29VMVQDUBg0yA55h75Pz6odcYLCRdApBM4rBrkAkDyAVWgQxbRP4XDMnK20hFAymLlF7EmzD8GUgo9XBHlP3lbK7T9COc/k+OhPthhy7+YGEpnrOvCPzBFhLs15u4/epbqB6H4uz9IuuLF5svev6lzLKY31es/CaQ0envF5z8ZY0xlUADXv7zaz7HYEuI/CfbK1sn16T8uAQfWwxLWPzKn/YuFN94/5KdbC1AFu793fyCSnlfvPzK2y4doAMY/NRg5t1/X6b/shq4QJaHDP5yNIAKPOeI/vpn7BSE30r/X4YQrO6nrv78Ziv/Thto/DqJ1Y6+y5z9l51NaxFrlv8QlA65HOLS/86dxiEc96z+Hj0+LFjneP6LzBZ8LTc2/DaJ1Y6+y579l51NaxFrlP8QlA65HOLQ/8qdxiEc967+Jj0+LFjnev6LzBZ8LTc0/1qdbC1AFuz93fyCSnlfvvzK2y4doAMa/NRg5t1/X6T/vhq4QJaHDv5yNIAKPOeK/wJn7BSE30j/W4YQrO6nrP78Ziv/Thtq/CaQ0envF578XY0xlUADXP7zaz7HYEuK/CvbK1sn16b8rAQfWwxLWvzKn/YuFN96/zWLlF7EmzL8GUgo9XBHlv3lbK7T9COe/kOOhPthhyz+cGEpnrOvCvzBFhLs15u6/c5bqB6H4u79IuuLF5sveP6lzLKY31eu/AQAAAP////8HAAAA/////zEAAAD/////VwEAAP////9hCQAA/////6dBAAD/////kcsBAP/////3kAwA/////8H2VwAAAAAAAAAAAAAAAAACAAAA/////w4AAAD/////YgAAAP////+uAgAA/////8ISAAD/////ToMAAP////8ilwMA/////+4hGQD/////gu2vAAAAAAAAAAAAAAAAAAAAAAACAAAA//////////8BAAAAAwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////AgAAAP//////////AQAAAAAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD/////////////////////AQAAAP///////////////wIAAAD///////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP///////////////////////////////wIAAAD///////////////8BAAAA/////////////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAABAAAA//////////8CAAAA//////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAAAQAAAP//////////AgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAACAAAAAAAAAAIAAAABAAAAAQAAAAIAAAACAAAAAAAAAAUAAAAFAAAAAAAAAAIAAAACAAAAAwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAgAAAAEAAAACAAAAAgAAAAIAAAAAAAAABQAAAAYAAAAAAAAAAgAAAAIAAAADAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAAAAAACAAAAAQAAAAMAAAACAAAAAgAAAAAAAAAFAAAABwAAAAAAAAACAAAAAgAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAACAAAAAAAAAAIAAAABAAAABAAAAAIAAAACAAAAAAAAAAUAAAAIAAAAAAAAAAIAAAACAAAAAwAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAIAAAAAAAAAAgAAAAEAAAAAAAAAAgAAAAIAAAAAAAAABQAAAAkAAAAAAAAAAgAAAAIAAAADAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAgAAAAIAAAAAAAAAAwAAAA4AAAACAAAAAAAAAAIAAAADAAAAAAAAAAAAAAACAAAAAgAAAAMAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAACAAAAAgAAAAAAAAADAAAACgAAAAIAAAAAAAAAAgAAAAMAAAABAAAAAAAAAAIAAAACAAAAAwAAAAcAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAIAAAACAAAAAAAAAAMAAAALAAAAAgAAAAAAAAACAAAAAwAAAAIAAAAAAAAAAgAAAAIAAAADAAAACAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAgAAAAIAAAAAAAAAAwAAAAwAAAACAAAAAAAAAAIAAAADAAAAAwAAAAAAAAACAAAAAgAAAAMAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAACAAAAAgAAAAAAAAADAAAADQAAAAIAAAAAAAAAAgAAAAMAAAAEAAAAAAAAAAIAAAACAAAAAwAAAAoAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAIAAAACAAAAAAAAAAMAAAAGAAAAAgAAAAAAAAACAAAAAwAAAA8AAAAAAAAAAgAAAAIAAAADAAAACwAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAgAAAAIAAAAAAAAAAwAAAAcAAAACAAAAAAAAAAIAAAADAAAAEAAAAAAAAAACAAAAAgAAAAMAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAcAAAACAAAAAgAAAAAAAAADAAAACAAAAAIAAAAAAAAAAgAAAAMAAAARAAAAAAAAAAIAAAACAAAAAwAAAA0AAAAAAAAAAAAAAAAAAAAAAAAACAAAAAIAAAACAAAAAAAAAAMAAAAJAAAAAgAAAAAAAAACAAAAAwAAABIAAAAAAAAAAgAAAAIAAAADAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAgAAAAIAAAAAAAAAAwAAAAUAAAACAAAAAAAAAAIAAAADAAAAEwAAAAAAAAACAAAAAgAAAAMAAAAPAAAAAAAAAAAAAAAAAAAAAAAAABAAAAACAAAAAAAAAAIAAAABAAAAEwAAAAIAAAACAAAAAAAAAAUAAAAKAAAAAAAAAAIAAAACAAAAAwAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEQAAAAIAAAAAAAAAAgAAAAEAAAAPAAAAAgAAAAIAAAAAAAAABQAAAAsAAAAAAAAAAgAAAAIAAAADAAAAEQAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAgAAAAAAAAACAAAAAQAAABAAAAACAAAAAgAAAAAAAAAFAAAADAAAAAAAAAACAAAAAgAAAAMAAAASAAAAAAAAAAAAAAAAAAAAAAAAABMAAAACAAAAAAAAAAIAAAABAAAAEQAAAAIAAAACAAAAAAAAAAUAAAANAAAAAAAAAAIAAAACAAAAAwAAABMAAAAAAAAAAAAAAAAAAAAAAAAADwAAAAIAAAAAAAAAAgAAAAEAAAASAAAAAgAAAAIAAAAAAAAABQAAAA4AAAAAAAAAAgAAAAIAAAADAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAAAAAAAAAAAAAIAAAABAAAAAAAAAAEAAAACAAAAAQAAAAAAAAACAAAAAAAAAAUAAAAEAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAQAAAAAAAAABQAAAAAAAAACAAAAAQAAAAAAAAABAAAAAgAAAAAAAAAAAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAABAAAAAAAAAAIAAAACAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAAEAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAQAAAAAAAAABQAAAAUAAAAAAAAAAQAAAAAAAAAAAAAAOgehWlKfUEEz1zLi+JsiQa2og3wcMfVAWCbHorc0yEDi+Yn/Y6mbQJ11/mfsnG9At6bnG4UQQkBvMCQWKqUUQJVmwwswmOc/3hVgVBL3uj//qqOEOdGOPw/WDN4gnGE/H3ANkCUgND+AA8btKgAHPwTXBqJVSdo+XfRQAqsKrj4fc+zLYbSPQklEmCZHv2FCUP+uDso1NEKYtPhwphUHQptxnyFXYdpB7CddZAMmrkGAt1AxSTqBQUibBVdTsFNBSuX3MV+AJkFocv82SLf5QAqmgj7AY81A23VDSEnLoEDGEJVSeDFzQDYrqvBk70VA8U157pcRGUBWfEF+ZKbsP7KBdLHZTpFAqKYk69AqekDbeGY41MdjQD8AZzHK501A1vcrrjubNkD5LnquvBYhQCbiRRD71QlAqt72EbOH8z8Eu+jL1YbdP4uaox/xUcY/abedg1XfsD+BsUdzJ4KZP5wE9YFySIM/rW1kAKMpbT+rZFthVRhWPy4PKlXIs0A/qMZLlwDnMEHByqEF0I0ZQQYSFD8lUQNBPpY+dFs07UAH8BZImBPWQN9RY0I0sMBA2T7kLfc6qUByFYvfhBKTQMq+0Mis1XxA0XQbeQXMZUBJJ5aEGXpQQP7/SY0a6ThAaMD92b/UIkAs8s8yqXoMQNIegOvCk/U/aOi7NZJP4D8AAAAA/////wAAAAAAAAAAAAAAAAAAAAAAAAAA/////////////////////////////////////wAAAAD/////AAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAA/////wAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAP////8AAAAABQAAAAAAAAAAAAAAAAAAAAAAAAD/////BQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAA/////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP////////////////////////////////////8AAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/////////////////////////////////////AAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAABQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/////////////////////////////////////wAAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAQAAAAAAAAABAAAAAAAAAAUAAAABAAAAAQAAAAAAAAAAAAAAAQAAAAEAAAAAAAAAAQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAEAAQAAAQEAAAAAAAEAAAABAAAAAQABAAAAAAAAAAAAAAAAAAAAAAcAAAAHAAAAAQAAAAIAAAAEAAAAAwAAAAAAAAAAAAAABwAAAAMAAAABAAAAAgAAAAUAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAAAAAACAAAAAQAAAAMAAAAOAAAABgAAAAsAAAACAAAABwAAAAEAAAAYAAAABQAAAAoAAAABAAAABgAAAAAAAAAmAAAABwAAAAwAAAADAAAACAAAAAIAAAAxAAAACQAAAA4AAAAAAAAABQAAAAQAAAA6AAAACAAAAA0AAAAEAAAACQAAAAMAAAA/AAAACwAAAAYAAAAPAAAACgAAABAAAABIAAAADAAAAAcAAAAQAAAACwAAABEAAABTAAAACgAAAAUAAAATAAAADgAAAA8AAABhAAAADQAAAAgAAAARAAAADAAAABIAAABrAAAADgAAAAkAAAASAAAADQAAABMAAAB1AAAADwAAABMAAAARAAAAEgAAABAAAAAGAAAAAgAAAAMAAAAFAAAABAAAAAAAAAAAAAAAAAAAAAYAAAACAAAAAwAAAAEAAAAFAAAABAAAAAAAAAAAAAAABwAAAAUAAAADAAAABAAAAAEAAAAAAAAAAgAAAAAAAAACAAAAAwAAAAEAAAAFAAAABAAAAAYAAAAAAAAAAAAAAGFsZ29zLmMAaDNOZWlnaGJvclJvdGF0aW9ucwBjb29yZGlqay5jAF91cEFwN0NoZWNrZWQAX3VwQXA3ckNoZWNrZWQAZGlyZWN0ZWRFZGdlLmMAZGlyZWN0ZWRFZGdlVG9Cb3VuZGFyeQBhZGphY2VudEZhY2VEaXJbdG1wRmlqay5mYWNlXVtmaWprLmZhY2VdID09IEtJAGZhY2VpamsuYwBfZmFjZUlqa1BlbnRUb0NlbGxCb3VuZGFyeQBhZGphY2VudEZhY2VEaXJbY2VudGVySUpLLmZhY2VdW2ZhY2UyXSA9PSBLSQBfZmFjZUlqa1RvQ2VsbEJvdW5kYXJ5AGgzSW5kZXguYwBjb21wYWN0Q2VsbHMAbGF0TG5nVG9DZWxsAGNlbGxUb0NoaWxkUG9zAHZhbGlkYXRlQ2hpbGRQb3MAbGF0TG5nLmMAY2VsbEFyZWFSYWRzMgBwb2x5Z29uLT5uZXh0ID09IE5VTEwAbGlua2VkR2VvLmMAYWRkTmV3TGlua2VkUG9seWdvbgBuZXh0ICE9IE5VTEwAbG9vcCAhPSBOVUxMAGFkZE5ld0xpbmtlZExvb3AAcG9seWdvbi0+Zmlyc3QgPT0gTlVMTABhZGRMaW5rZWRMb29wAGNvb3JkICE9IE5VTEwAYWRkTGlua2VkQ29vcmQAbG9vcC0+Zmlyc3QgPT0gTlVMTABpbm5lckxvb3BzICE9IE5VTEwAbm9ybWFsaXplTXVsdGlQb2x5Z29uAGJib3hlcyAhPSBOVUxMAGNhbmRpZGF0ZXMgIT0gTlVMTABmaW5kUG9seWdvbkZvckhvbGUAY2FuZGlkYXRlQkJveGVzICE9IE5VTEwAcmV2RGlyICE9IElOVkFMSURfRElHSVQAbG9jYWxpai5jAGNlbGxUb0xvY2FsSWprAGJhc2VDZWxsICE9IG9yaWdpbkJhc2VDZWxsACEob3JpZ2luT25QZW50ICYmIGluZGV4T25QZW50KQBiYXNlQ2VsbCA9PSBvcmlnaW5CYXNlQ2VsbABiYXNlQ2VsbCAhPSBJTlZBTElEX0JBU0VfQ0VMTABsb2NhbElqa1RvQ2VsbAAhX2lzQmFzZUNlbGxQZW50YWdvbihiYXNlQ2VsbCkAYmFzZUNlbGxSb3RhdGlvbnMgPj0gMABncmlkUGF0aENlbGxzADAAdmVydGV4LmMAY2VsbFRvVmVydGV4AGdyYXBoLT5idWNrZXRzICE9IE5VTEwAdmVydGV4R3JhcGguYwBpbml0VmVydGV4R3JhcGgAbm9kZSAhPSBOVUxMAGFkZFZlcnRleE5vZGU=";var Oi=24144;function Qi(xe){return xe}function Ki(xe){var Me=/\b__Z[\w\d_]+/g;return xe.replace(Me,function(ct){var Pt=ct;return ct===Pt?ct:Pt+" ["+ct+"]"})}function Kr(){var xe=new Error;if(!xe.stack){try{throw new Error(0)}catch(Me){xe=Me}if(!xe.stack)return"(no stack trace available)"}return xe.stack.toString()}function _n(){var xe=Kr();return ne.extraStackTrace&&(xe+=`
`+ne.extraStackTrace()),Ki(xe)}function ts(xe,Me,ct,Pt){Et("Assertion failed: "+jr(xe)+", at: "+[Me?jr(Me):"unknown filename",ct,Pt?jr(Pt):"unknown function"])}function oi(){return Sn.length}function gn(xe,Me,ct){Nn.set(Nn.subarray(Me,Me+ct),xe)}function vr(xe){return ne.___errno_location&&(Ir[ne.___errno_location()>>2]=xe),xe}function ys(xe){Et("OOM")}function ls(xe){try{var Me=new ArrayBuffer(xe);return Me.byteLength!=xe?void 0:(new Int8Array(Me).set(Sn),we(Me),wo(Me),1)}catch{}}function gi(xe){var Me=oi(),ct=16777216,Pt=2147483648-ct;if(xe>Pt)return!1;for(var o=16777216,oe=Math.max(Me,o);oe<xe;)oe<=536870912?oe=At(2*oe,ct):oe=Math.min(At((3*oe+2147483648)/4,ct),Pt);var ti=ls(oe);return!!ti}var br=typeof atob=="function"?atob:function(xe){var Me="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",ct="",Pt,o,oe,ti,xi,yi,ai,pi=0;xe=xe.replace(/[^A-Za-z0-9\+\/\=]/g,"");do ti=Me.indexOf(xe.charAt(pi++)),xi=Me.indexOf(xe.charAt(pi++)),yi=Me.indexOf(xe.charAt(pi++)),ai=Me.indexOf(xe.charAt(pi++)),Pt=ti<<2|xi>>4,o=(xi&15)<<4|yi>>2,oe=(yi&3)<<6|ai,ct=ct+String.fromCharCode(Pt),yi!==64&&(ct=ct+String.fromCharCode(o)),ai!==64&&(ct=ct+String.fromCharCode(oe));while(pi<xe.length);return ct};function wr(xe){try{for(var Me=br(xe),ct=new Uint8Array(Me.length),Pt=0;Pt<Me.length;++Pt)ct[Pt]=Me.charCodeAt(Pt);return ct}catch{throw new Error("Converting base64 string to bytes failed.")}}function Cn(xe){if(ni(xe))return wr(xe.slice(Zt.length))}var io={Math,Int8Array,Int32Array,Uint8Array,Float32Array,Float64Array},Sr={a:Et,b:Xt,c:Rt,d:ts,e:vr,f:oi,g:gn,h:gi,i:ys,j:Qi,k:Ki,l:ls,m:Kr,n:_n,o:Oi,p:Zo},kt=function(xe,Me,ct){"almost asm";var Pt=new xe.Int8Array(ct),o=new xe.Int32Array(ct);new xe.Uint8Array(ct),new xe.Float32Array(ct);var oe=new xe.Float64Array(ct),ti=Me.o|0,xi=Me.p|0,yi=xe.Math.floor,ai=xe.Math.abs,pi=xe.Math.sqrt,gr=xe.Math.pow,bi=xe.Math.cos,zi=xe.Math.sin,fn=xe.Math.tan,Qs=xe.Math.acos,HA=xe.Math.asin,Ls=xe.Math.atan,Rs=xe.Math.atan2,ko=xe.Math.ceil,nn=xe.Math.imul,qo=xe.Math.min,Dr=xe.Math.max,gt=xe.Math.clz32,Di=Me.b,Je=Me.c,Ar=Me.d,Hs=Me.e,DA=Me.f,kl=Me.g,nt=Me.h,yn=Me.i,Ze=24160;function As(u){return Pt=new Int8Array(u),o=new Int32Array(u),oe=new Float64Array(u),ct=u,!0}function Xl(u){u=u|0;var h=0;return h=Ze,Ze=Ze+u|0,Ze=Ze+15&-16,h|0}function ro(){return Ze|0}function WA(u){u=u|0,Ze=u}function Xi(u,h){u=u|0,Ze=u}function mn(u,h){u=u|0,h=h|0;var f=0,y=0,b=0;return(u|0)<0?(h=2,h|0):(u|0)>13780509?(h=FA(15,h)|0,h|0):(f=((u|0)<0)<<31>>31,b=ue(u|0,f|0,3,0)|0,y=Je()|0,f=M(u|0,f|0,1,0)|0,f=ue(b|0,y|0,f|0,Je()|0)|0,f=M(f|0,Je()|0,1,0)|0,u=Je()|0,o[h>>2]=f,o[h+4>>2]=u,h=0,h|0)}function Qo(u,h,f,y){return u=u|0,h=h|0,f=f|0,y=y|0,Fs(u,h,f,y,0)|0}function Fs(u,h,f,y,b){u=u|0,h=h|0,f=f|0,y=y|0,b=b|0;var I=0,R=0,V=0,W=0,Y=0;if(W=Ze,Ze=Ze+16|0,R=W,!(Wn(u,h,f,y,b)|0))return y=0,Ze=W,y|0;do if((f|0)>=0){if((f|0)>13780509){if(I=FA(15,R)|0,I|0)break;V=R,R=o[V>>2]|0,V=o[V+4>>2]|0}else I=((f|0)<0)<<31>>31,Y=ue(f|0,I|0,3,0)|0,V=Je()|0,I=M(f|0,I|0,1,0)|0,I=ue(Y|0,V|0,I|0,Je()|0)|0,I=M(I|0,Je()|0,1,0)|0,V=Je()|0,o[R>>2]=I,o[R+4>>2]=V,R=I;if(k(y|0,0,R<<3|0)|0,b|0){k(b|0,0,R<<2|0)|0,I=co(u,h,f,y,b,R,V,0)|0;break}I=T(R,4)|0,I?(Y=co(u,h,f,y,I,R,V,0)|0,x(I),I=Y):I=13}else I=2;while(!1);return Y=I,Ze=W,Y|0}function Wn(u,h,f,y,b){u=u|0,h=h|0,f=f|0,y=y|0,b=b|0;var I=0,R=0,V=0,W=0,Y=0,le=0,fe=0,ye=0,Ie=0,ke=0,qe=0;if(qe=Ze,Ze=Ze+16|0,Ie=qe,ke=qe+8|0,ye=Ie,o[ye>>2]=u,o[ye+4>>2]=h,(f|0)<0)return ke=2,Ze=qe,ke|0;if(I=y,o[I>>2]=u,o[I+4>>2]=h,I=(b|0)!=0,I&&(o[b>>2]=0),Ln(u,h)|0)return ke=9,Ze=qe,ke|0;o[ke>>2]=0;e:do if((f|0)>=1)if(I)for(le=1,Y=0,fe=0,ye=1,I=u;;){if(!(Y|fe)){if(I=Ds(I,h,4,ke,Ie)|0,I|0)break e;if(h=Ie,I=o[h>>2]|0,h=o[h+4>>2]|0,Ln(I,h)|0){I=9;break e}}if(I=Ds(I,h,o[22384+(fe<<2)>>2]|0,ke,Ie)|0,I|0)break e;if(h=Ie,I=o[h>>2]|0,h=o[h+4>>2]|0,u=y+(le<<3)|0,o[u>>2]=I,o[u+4>>2]=h,o[b+(le<<2)>>2]=ye,u=Y+1|0,R=(u|0)==(ye|0),V=fe+1|0,W=(V|0)==6,Ln(I,h)|0){I=9;break e}if(ye=ye+(W&R&1)|0,(ye|0)>(f|0)){I=0;break}else le=le+1|0,Y=R?0:u,fe=R?W?0:V:fe}else for(le=1,Y=0,fe=0,ye=1,I=u;;){if(!(Y|fe)){if(I=Ds(I,h,4,ke,Ie)|0,I|0)break e;if(h=Ie,I=o[h>>2]|0,h=o[h+4>>2]|0,Ln(I,h)|0){I=9;break e}}if(I=Ds(I,h,o[22384+(fe<<2)>>2]|0,ke,Ie)|0,I|0)break e;if(h=Ie,I=o[h>>2]|0,h=o[h+4>>2]|0,u=y+(le<<3)|0,o[u>>2]=I,o[u+4>>2]=h,u=Y+1|0,R=(u|0)==(ye|0),V=fe+1|0,W=(V|0)==6,Ln(I,h)|0){I=9;break e}if(ye=ye+(W&R&1)|0,(ye|0)>(f|0)){I=0;break}else le=le+1|0,Y=R?0:u,fe=R?W?0:V:fe}else I=0;while(!1);return ke=I,Ze=qe,ke|0}function co(u,h,f,y,b,I,R,V){u=u|0,h=h|0,f=f|0,y=y|0,b=b|0,I=I|0,R=R|0,V=V|0;var W=0,Y=0,le=0,fe=0,ye=0,Ie=0,ke=0,qe=0,ut=0,mt=0;if(qe=Ze,Ze=Ze+16|0,Ie=qe+8|0,ke=qe,W=De(u|0,h|0,I|0,R|0)|0,le=Je()|0,fe=y+(W<<3)|0,ut=fe,mt=o[ut>>2]|0,ut=o[ut+4>>2]|0,Y=(mt|0)==(u|0)&(ut|0)==(h|0),!((mt|0)==0&(ut|0)==0|Y))do W=M(W|0,le|0,1,0)|0,W=Se(W|0,Je()|0,I|0,R|0)|0,le=Je()|0,fe=y+(W<<3)|0,mt=fe,ut=o[mt>>2]|0,mt=o[mt+4>>2]|0,Y=(ut|0)==(u|0)&(mt|0)==(h|0);while(!((ut|0)==0&(mt|0)==0|Y));if(W=b+(W<<2)|0,Y&&(o[W>>2]|0)<=(V|0)||(mt=fe,o[mt>>2]=u,o[mt+4>>2]=h,o[W>>2]=V,(V|0)>=(f|0)))return mt=0,Ze=qe,mt|0;switch(Y=V+1|0,o[Ie>>2]=0,W=Ds(u,h,2,Ie,ke)|0,W|0){case 9:{ye=9;break}case 0:{W=ke,W=co(o[W>>2]|0,o[W+4>>2]|0,f,y,b,I,R,Y)|0,W||(ye=9);break}}e:do if((ye|0)==9){switch(o[Ie>>2]=0,W=Ds(u,h,3,Ie,ke)|0,W|0){case 9:break;case 0:{if(W=ke,W=co(o[W>>2]|0,o[W+4>>2]|0,f,y,b,I,R,Y)|0,W|0)break e;break}default:break e}switch(o[Ie>>2]=0,W=Ds(u,h,1,Ie,ke)|0,W|0){case 9:break;case 0:{if(W=ke,W=co(o[W>>2]|0,o[W+4>>2]|0,f,y,b,I,R,Y)|0,W|0)break e;break}default:break e}switch(o[Ie>>2]=0,W=Ds(u,h,5,Ie,ke)|0,W|0){case 9:break;case 0:{if(W=ke,W=co(o[W>>2]|0,o[W+4>>2]|0,f,y,b,I,R,Y)|0,W|0)break e;break}default:break e}switch(o[Ie>>2]=0,W=Ds(u,h,4,Ie,ke)|0,W|0){case 9:break;case 0:{if(W=ke,W=co(o[W>>2]|0,o[W+4>>2]|0,f,y,b,I,R,Y)|0,W|0)break e;break}default:break e}switch(o[Ie>>2]=0,W=Ds(u,h,6,Ie,ke)|0,W|0){case 9:break;case 0:{if(W=ke,W=co(o[W>>2]|0,o[W+4>>2]|0,f,y,b,I,R,Y)|0,W|0)break e;break}default:break e}return mt=0,Ze=qe,mt|0}while(!1);return mt=W,Ze=qe,mt|0}function Ds(u,h,f,y,b){u=u|0,h=h|0,f=f|0,y=y|0,b=b|0;var I=0,R=0,V=0,W=0,Y=0,le=0,fe=0,ye=0,Ie=0,ke=0;if(f>>>0>6)return b=1,b|0;if(fe=(o[y>>2]|0)%6|0,o[y>>2]=fe,(fe|0)>0){I=0;do f=el(f)|0,I=I+1|0;while((I|0)<(o[y>>2]|0))}if(fe=Xe(u|0,h|0,45)|0,Je()|0,le=fe&127,le>>>0>121)return b=5,b|0;W=oo(u,h)|0,I=Xe(u|0,h|0,52)|0,Je()|0,I=I&15;e:do if(!I)Y=8;else{for(;;){if(R=(15-I|0)*3|0,V=Xe(u|0,h|0,R|0)|0,Je()|0,V=V&7,(V|0)==7){h=5;break}if(ke=(ho(I)|0)==0,I=I+-1|0,ye=tt(7,0,R|0)|0,h=h&~(Je()|0),Ie=tt(o[(ke?432:16)+(V*28|0)+(f<<2)>>2]|0,0,R|0)|0,R=Je()|0,f=o[(ke?640:224)+(V*28|0)+(f<<2)>>2]|0,u=Ie|u&~ye,h=R|h,!f){f=0;break e}if(!I){Y=8;break e}}return h|0}while(!1);(Y|0)==8&&(ke=o[848+(le*28|0)+(f<<2)>>2]|0,Ie=tt(ke|0,0,45)|0,u=Ie|u,h=Je()|0|h&-1040385,f=o[4272+(le*28|0)+(f<<2)>>2]|0,(ke&127|0)==127&&(ke=tt(o[848+(le*28|0)+20>>2]|0,0,45)|0,h=Je()|0|h&-1040385,f=o[4272+(le*28|0)+20>>2]|0,u=ml(ke|u,h)|0,h=Je()|0,o[y>>2]=(o[y>>2]|0)+1)),V=Xe(u|0,h|0,45)|0,Je()|0,V=V&127;e:do if(jn(V)|0){t:do if((oo(u,h)|0)==1){if((le|0)!=(V|0))if(vi(V,o[7696+(le*28|0)>>2]|0)|0){u=JA(u,h)|0,R=1,h=Je()|0;break}else Ar(23313,22416,436,22424);switch(W|0){case 3:{u=ml(u,h)|0,h=Je()|0,o[y>>2]=(o[y>>2]|0)+1,R=0;break t}case 5:{u=JA(u,h)|0,h=Je()|0,o[y>>2]=(o[y>>2]|0)+5,R=0;break t}case 0:return ke=9,ke|0;default:return ke=1,ke|0}}else R=0;while(!1);if((f|0)>0){I=0;do u=na(u,h)|0,h=Je()|0,I=I+1|0;while((I|0)!=(f|0))}if((le|0)!=(V|0)){if(!(hA(V)|0)){if((R|0)!=0|(oo(u,h)|0)!=5)break;o[y>>2]=(o[y>>2]|0)+1;break}switch(fe&127){case 8:case 118:break e}(oo(u,h)|0)!=3&&(o[y>>2]=(o[y>>2]|0)+1)}}else if((f|0)>0){I=0;do u=ml(u,h)|0,h=Je()|0,I=I+1|0;while((I|0)!=(f|0))}while(!1);return o[y>>2]=((o[y>>2]|0)+f|0)%6|0,ke=b,o[ke>>2]=u,o[ke+4>>2]=h,ke=0,ke|0}function Dl(u,h,f,y){u=u|0,h=h|0,f=f|0,y=y|0;var b=0,I=0,R=0,V=0,W=0,Y=0;for(V=Ze,Ze=Ze+16|0,I=V,R=V+8|0,b=(Ln(u,h)|0)==0,b=b?1:2;;){if(o[R>>2]=0,Y=(Ds(u,h,b,R,I)|0)==0,W=I,Y&((o[W>>2]|0)==(f|0)?(o[W+4>>2]|0)==(y|0):0)){u=4;break}if(b=b+1|0,b>>>0>=7){b=7,u=4;break}}return(u|0)==4?(Ze=V,b|0):0}function $A(u,h,f,y){u=u|0,h=h|0,f=f|0,y=y|0;var b=0,I=0,R=0,V=0,W=0,Y=0,le=0,fe=0,ye=0,Ie=0,ke=0;if(ke=Ze,Ze=Ze+16|0,ye=ke,Ie=ke+8|0,fe=ye,o[fe>>2]=u,o[fe+4>>2]=h,!f)return Ie=y,o[Ie>>2]=u,o[Ie+4>>2]=h,Ie=0,Ze=ke,Ie|0;o[Ie>>2]=0;e:do if(Ln(u,h)|0)u=9;else{if(I=(f|0)>0,I){b=0,fe=u;do{if(u=Ds(fe,h,4,Ie,ye)|0,u|0)break e;if(h=ye,fe=o[h>>2]|0,h=o[h+4>>2]|0,b=b+1|0,Ln(fe,h)|0){u=9;break e}}while((b|0)<(f|0));if(le=y,o[le>>2]=fe,o[le+4>>2]=h,le=f+-1|0,I){Y=0,u=1;do{if(b=22384+(Y<<2)|0,(Y|0)==5)for(R=o[b>>2]|0,I=0,b=u;;){if(u=ye,u=Ds(o[u>>2]|0,o[u+4>>2]|0,R,Ie,ye)|0,u|0)break e;if((I|0)!=(le|0))if(W=ye,V=o[W>>2]|0,W=o[W+4>>2]|0,u=y+(b<<3)|0,o[u>>2]=V,o[u+4>>2]=W,!(Ln(V,W)|0))u=b+1|0;else{u=9;break e}else u=b;if(I=I+1|0,(I|0)>=(f|0))break;b=u}else for(R=ye,W=o[b>>2]|0,V=0,b=u,I=o[R>>2]|0,R=o[R+4>>2]|0;;){if(u=Ds(I,R,W,Ie,ye)|0,u|0)break e;if(R=ye,I=o[R>>2]|0,R=o[R+4>>2]|0,u=y+(b<<3)|0,o[u>>2]=I,o[u+4>>2]=R,u=b+1|0,Ln(I,R)|0){u=9;break e}if(V=V+1|0,(V|0)>=(f|0))break;b=u}Y=Y+1|0}while(Y>>>0<6);u=ye,R=fe,b=o[u>>2]|0,I=h,u=o[u+4>>2]|0}else R=fe,b=fe,I=h,u=h}else R=y,o[R>>2]=u,o[R+4>>2]=h,R=u,b=u,I=h,u=h;u=(R|0)==(b|0)&(I|0)==(u|0)?0:9}while(!1);return Ie=u,Ze=ke,Ie|0}function XA(u,h,f,y){u=u|0,h=h|0,f=f|0,y=y|0;var b=0,I=0,R=0,V=0,W=0,Y=0;if(V=Ze,Ze=Ze+48|0,b=V+16|0,I=V+8|0,R=V,f|0)return R=15,Ze=V,R|0;if(Y=u,W=o[Y+4>>2]|0,f=I,o[f>>2]=o[Y>>2],o[f+4>>2]=W,nc(I,b),h=Kl(b,h,R)|0,!h){if(f=o[I>>2]|0,I=o[u+8>>2]|0,(I|0)>0){b=o[u+12>>2]|0,h=0;do f=(o[b+(h<<3)>>2]|0)+f|0,h=h+1|0;while((h|0)<(I|0))}h=R,b=o[h>>2]|0,h=o[h+4>>2]|0,I=((f|0)<0)<<31>>31,(h|0)<(I|0)|(h|0)==(I|0)&b>>>0<f>>>0?(h=R,o[h>>2]=f,o[h+4>>2]=I,h=I):f=b,W=M(f|0,h|0,12,0)|0,Y=Je()|0,h=R,o[h>>2]=W,o[h+4>>2]=Y,h=y,o[h>>2]=W,o[h+4>>2]=Y,h=0}return Y=h,Ze=V,Y|0}function Pl(u,h,f,y,b,I,R){u=u|0,h=h|0,f=f|0,y=y|0,b=b|0,I=I|0,R=R|0;var V=0,W=0,Y=0,le=0,fe=0,ye=0,Ie=0,ke=0,qe=0,ut=0,mt=0,st=0,ht=0,ft=0,Ai=0,Nt=0,Wt=0,Gt=0,lr=0,Hi=0,Zi=0,Fi=0,sr=0,er=0,Nr=0,Yi=0,Rr=0,kn=0,Kn=0;if(Nr=Ze,Ze=Ze+64|0,Zi=Nr+48|0,Fi=Nr+32|0,sr=Nr+24|0,Ai=Nr+8|0,Nt=Nr,W=o[u>>2]|0,(W|0)<=0)return er=0,Ze=Nr,er|0;for(Wt=u+4|0,Gt=Zi+8|0,lr=Fi+8|0,Hi=Ai+8|0,V=0,ht=0;;){Y=o[Wt>>2]|0,st=Y+(ht<<4)|0,o[Zi>>2]=o[st>>2],o[Zi+4>>2]=o[st+4>>2],o[Zi+8>>2]=o[st+8>>2],o[Zi+12>>2]=o[st+12>>2],(ht|0)==(W+-1|0)?(o[Fi>>2]=o[Y>>2],o[Fi+4>>2]=o[Y+4>>2],o[Fi+8>>2]=o[Y+8>>2],o[Fi+12>>2]=o[Y+12>>2]):(st=Y+(ht+1<<4)|0,o[Fi>>2]=o[st>>2],o[Fi+4>>2]=o[st+4>>2],o[Fi+8>>2]=o[st+8>>2],o[Fi+12>>2]=o[st+12>>2]),W=dA(Zi,Fi,y,sr)|0;e:do if(W)Y=0,V=W;else if(Y=sr,W=o[Y>>2]|0,Y=o[Y+4>>2]|0,(Y|0)>0|(Y|0)==0&W>>>0>0){mt=0,st=0;t:for(;;){if(Kn=+oe[Zi>>3],ut=L(W|0,Y|0,mt|0,st|0)|0,kn=+(ut>>>0)+4294967296*+(Je()|0),Yi=+(W>>>0)+4294967296*+(Y|0),Rr=+(mt>>>0)+4294967296*+(st|0),oe[Ai>>3]=Kn*kn/Yi+ +oe[Fi>>3]*Rr/Yi,oe[Hi>>3]=+oe[Gt>>3]*kn/Yi+ +oe[lr>>3]*Rr/Yi,W=$o(Ai,y,Nt)|0,W|0){V=W;break}ut=Nt,qe=o[ut>>2]|0,ut=o[ut+4>>2]|0,ye=De(qe|0,ut|0,h|0,f|0)|0,le=Je()|0,W=R+(ye<<3)|0,fe=W,Y=o[fe>>2]|0,fe=o[fe+4>>2]|0;i:do if((Y|0)==0&(fe|0)==0)ft=W,er=16;else for(Ie=0,ke=0;;){if((Ie|0)>(f|0)|(Ie|0)==(f|0)&ke>>>0>h>>>0){V=1;break t}if((Y|0)==(qe|0)&(fe|0)==(ut|0))break i;if(W=M(ye|0,le|0,1,0)|0,ye=Se(W|0,Je()|0,h|0,f|0)|0,le=Je()|0,ke=M(ke|0,Ie|0,1,0)|0,Ie=Je()|0,W=R+(ye<<3)|0,fe=W,Y=o[fe>>2]|0,fe=o[fe+4>>2]|0,(Y|0)==0&(fe|0)==0){ft=W,er=16;break}}while(!1);if((er|0)==16&&(er=0,!((qe|0)==0&(ut|0)==0))&&(ke=ft,o[ke>>2]=qe,o[ke+4>>2]=ut,ke=I+(o[b>>2]<<3)|0,o[ke>>2]=qe,o[ke+4>>2]=ut,ke=b,ke=M(o[ke>>2]|0,o[ke+4>>2]|0,1,0)|0,qe=Je()|0,ut=b,o[ut>>2]=ke,o[ut+4>>2]=qe),mt=M(mt|0,st|0,1,0)|0,st=Je()|0,Y=sr,W=o[Y>>2]|0,Y=o[Y+4>>2]|0,!((Y|0)>(st|0)|(Y|0)==(st|0)&W>>>0>mt>>>0)){Y=1;break e}}Y=0}else Y=1;while(!1);if(ht=ht+1|0,!Y){er=21;break}if(W=o[u>>2]|0,(ht|0)>=(W|0)){V=0,er=21;break}}return(er|0)==21?(Ze=Nr,V|0):0}function uA(u,h,f,y){u=u|0,h=h|0,f=f|0,y=y|0;var b=0,I=0,R=0,V=0,W=0,Y=0,le=0,fe=0,ye=0,Ie=0,ke=0,qe=0,ut=0,mt=0,st=0,ht=0,ft=0,Ai=0,Nt=0,Wt=0,Gt=0,lr=0,Hi=0,Zi=0,Fi=0,sr=0,er=0,Nr=0,Yi=0,Rr=0,kn=0;if(kn=Ze,Ze=Ze+112|0,er=kn+80|0,W=kn+72|0,Nr=kn,Yi=kn+56|0,f|0)return Rr=15,Ze=kn,Rr|0;if(Y=u+8|0,Rr=Zn((o[Y>>2]<<5)+32|0)|0,!Rr)return Rr=13,Ze=kn,Rr|0;if(VA(u,Rr),Fi=u,sr=o[Fi+4>>2]|0,f=W,o[f>>2]=o[Fi>>2],o[f+4>>2]=sr,nc(W,er),f=Kl(er,h,Nr)|0,f)Fi=0,sr=0;else{if(f=o[W>>2]|0,I=o[Y>>2]|0,(I|0)>0){R=o[u+12>>2]|0,b=0;do f=(o[R+(b<<3)>>2]|0)+f|0,b=b+1|0;while((b|0)!=(I|0));b=f}else b=f;f=Nr,I=o[f>>2]|0,f=o[f+4>>2]|0,R=((b|0)<0)<<31>>31,(f|0)<(R|0)|(f|0)==(R|0)&I>>>0<b>>>0?(f=Nr,o[f>>2]=b,o[f+4>>2]=R,f=R):b=I,Fi=M(b|0,f|0,12,0)|0,sr=Je()|0,f=Nr,o[f>>2]=Fi,o[f+4>>2]=sr,f=0}if(f|0)return x(Rr),Rr=f,Ze=kn,Rr|0;if(b=T(Fi,8)|0,!b)return x(Rr),Rr=13,Ze=kn,Rr|0;if(V=T(Fi,8)|0,!V)return x(Rr),x(b),Rr=13,Ze=kn,Rr|0;Hi=er,o[Hi>>2]=0,o[Hi+4>>2]=0,Hi=u,Zi=o[Hi+4>>2]|0,f=W,o[f>>2]=o[Hi>>2],o[f+4>>2]=Zi,f=Pl(W,Fi,sr,h,er,b,V)|0;e:do if(f)x(b),x(V),x(Rr);else{t:do if((o[Y>>2]|0)>0){for(R=u+12|0,I=0;f=Pl((o[R>>2]|0)+(I<<3)|0,Fi,sr,h,er,b,V)|0,I=I+1|0,!(f|0);)if((I|0)>=(o[Y>>2]|0))break t;x(b),x(V),x(Rr);break e}while(!1);(sr|0)>0|(sr|0)==0&Fi>>>0>0&&k(V|0,0,Fi<<3|0)|0,Zi=er,Hi=o[Zi+4>>2]|0;t:do if((Hi|0)>0|(Hi|0)==0&(o[Zi>>2]|0)>>>0>0){Wt=b,Gt=V,lr=b,Hi=V,Zi=b,f=b,ft=b,Ai=V,Nt=V,b=V;i:for(;;){for(ut=0,mt=0,st=0,ht=0,I=0,R=0;;){V=Nr,W=V+56|0;do o[V>>2]=0,V=V+4|0;while((V|0)<(W|0));if(h=Wt+(ut<<3)|0,Y=o[h>>2]|0,h=o[h+4>>2]|0,Wn(Y,h,1,Nr,0)|0){V=Nr,W=V+56|0;do o[V>>2]=0,V=V+4|0;while((V|0)<(W|0));V=T(7,4)|0,V|0&&(co(Y,h,1,Nr,V,7,0,0)|0,x(V))}for(qe=0;;){ke=Nr+(qe<<3)|0,Ie=o[ke>>2]|0,ke=o[ke+4>>2]|0;r:do if((Ie|0)==0&(ke|0)==0)V=I,W=R;else{if(le=De(Ie|0,ke|0,Fi|0,sr|0)|0,Y=Je()|0,V=y+(le<<3)|0,h=V,W=o[h>>2]|0,h=o[h+4>>2]|0,!((W|0)==0&(h|0)==0)){fe=0,ye=0;do{if((fe|0)>(sr|0)|(fe|0)==(sr|0)&ye>>>0>Fi>>>0)break i;if((W|0)==(Ie|0)&(h|0)==(ke|0)){V=I,W=R;break r}V=M(le|0,Y|0,1,0)|0,le=Se(V|0,Je()|0,Fi|0,sr|0)|0,Y=Je()|0,ye=M(ye|0,fe|0,1,0)|0,fe=Je()|0,V=y+(le<<3)|0,h=V,W=o[h>>2]|0,h=o[h+4>>2]|0}while(!((W|0)==0&(h|0)==0))}(Ie|0)==0&(ke|0)==0?(V=I,W=R):(va(Ie,ke,Yi)|0,sc(u,Rr,Yi)|0&&(ye=M(I|0,R|0,1,0)|0,R=Je()|0,fe=V,o[fe>>2]=Ie,o[fe+4>>2]=ke,I=Gt+(I<<3)|0,o[I>>2]=Ie,o[I+4>>2]=ke,I=ye),V=I,W=R)}while(!1);if(qe=qe+1|0,qe>>>0>=7)break;I=V,R=W}if(ut=M(ut|0,mt|0,1,0)|0,mt=Je()|0,st=M(st|0,ht|0,1,0)|0,ht=Je()|0,R=er,I=o[R>>2]|0,R=o[R+4>>2]|0,(ht|0)<(R|0)|(ht|0)==(R|0)&st>>>0<I>>>0)I=V,R=W;else break}if((R|0)>0|(R|0)==0&I>>>0>0){I=0,R=0;do ht=Wt+(I<<3)|0,o[ht>>2]=0,o[ht+4>>2]=0,I=M(I|0,R|0,1,0)|0,R=Je()|0,ht=er,st=o[ht+4>>2]|0;while((R|0)<(st|0)|((R|0)==(st|0)?I>>>0<(o[ht>>2]|0)>>>0:0))}if(ht=er,o[ht>>2]=V,o[ht+4>>2]=W,(W|0)>0|(W|0)==0&V>>>0>0)qe=b,ut=Nt,mt=Zi,st=Ai,ht=Gt,b=ft,Nt=f,Ai=lr,ft=qe,f=ut,Zi=Hi,Hi=mt,lr=st,Gt=Wt,Wt=ht;else break t}x(lr),x(Hi),x(Rr),f=1;break e}else f=V;while(!1);x(Rr),x(b),x(f),f=0}while(!1);return Rr=f,Ze=kn,Rr|0}function is(u,h,f){u=u|0,h=h|0,f=f|0;var y=0,b=0,I=0,R=0,V=0,W=0,Y=0,le=0;if(le=Ze,Ze=Ze+176|0,W=le,(h|0)<1)return lc(f,0,0),Y=0,Ze=le,Y|0;for(V=u,V=Xe(o[V>>2]|0,o[V+4>>2]|0,52)|0,Je()|0,lc(f,(h|0)>6?h:6,V&15),V=0;y=u+(V<<3)|0,y=Rn(o[y>>2]|0,o[y+4>>2]|0,W)|0,!(y|0);){if(y=o[W>>2]|0,(y|0)>0){R=0;do I=W+8+(R<<4)|0,R=R+1|0,y=W+8+(((R|0)%(y|0)|0)<<4)|0,b=sA(f,y,I)|0,b?Vt(f,b)|0:Jt(f,I,y)|0,y=o[W>>2]|0;while((R|0)<(y|0))}if(V=V+1|0,(V|0)>=(h|0)){y=0,Y=13;break}}return(Y|0)==13?(Ze=le,y|0):(_o(f),Y=y,Ze=le,Y|0)}function YA(u,h,f){u=u|0,h=h|0,f=f|0;var y=0,b=0,I=0,R=0;if(I=Ze,Ze=Ze+32|0,y=I,b=I+16|0,u=is(u,h,b)|0,u|0)return f=u,Ze=I,f|0;if(o[f>>2]=0,o[f+4>>2]=0,o[f+8>>2]=0,u=Ea(b)|0,u|0)do{h=Jc(f)|0;do tA(h,u)|0,R=u+16|0,o[y>>2]=o[R>>2],o[y+4>>2]=o[R+4>>2],o[y+8>>2]=o[R+8>>2],o[y+12>>2]=o[R+12>>2],Vt(b,u)|0,u=vl(b,y)|0;while(u|0);u=Ea(b)|0}while(u|0);return _o(b),u=Ga(f)|0,u?(ll(f),R=u,Ze=I,R|0):(R=0,Ze=I,R|0)}function jn(u){return u=u|0,u>>>0>121?(u=0,u|0):(u=o[7696+(u*28|0)+16>>2]|0,u|0)}function hA(u){return u=u|0,(u|0)==4|(u|0)==117|0}function ei(u){return u=u|0,o[11120+((o[u>>2]|0)*216|0)+((o[u+4>>2]|0)*72|0)+((o[u+8>>2]|0)*24|0)+(o[u+12>>2]<<3)>>2]|0}function ir(u){return u=u|0,o[11120+((o[u>>2]|0)*216|0)+((o[u+4>>2]|0)*72|0)+((o[u+8>>2]|0)*24|0)+(o[u+12>>2]<<3)+4>>2]|0}function rs(u,h){u=u|0,h=h|0,u=7696+(u*28|0)|0,o[h>>2]=o[u>>2],o[h+4>>2]=o[u+4>>2],o[h+8>>2]=o[u+8>>2],o[h+12>>2]=o[u+12>>2]}function xt(u,h){u=u|0,h=h|0;var f=0,y=0;if(h>>>0>20)return h=-1,h|0;do if((o[11120+(h*216|0)>>2]|0)!=(u|0))if((o[11120+(h*216|0)+8>>2]|0)!=(u|0))if((o[11120+(h*216|0)+16>>2]|0)!=(u|0))if((o[11120+(h*216|0)+24>>2]|0)!=(u|0))if((o[11120+(h*216|0)+32>>2]|0)!=(u|0))if((o[11120+(h*216|0)+40>>2]|0)!=(u|0))if((o[11120+(h*216|0)+48>>2]|0)!=(u|0))if((o[11120+(h*216|0)+56>>2]|0)!=(u|0))if((o[11120+(h*216|0)+64>>2]|0)!=(u|0))if((o[11120+(h*216|0)+72>>2]|0)!=(u|0))if((o[11120+(h*216|0)+80>>2]|0)!=(u|0))if((o[11120+(h*216|0)+88>>2]|0)!=(u|0))if((o[11120+(h*216|0)+96>>2]|0)!=(u|0))if((o[11120+(h*216|0)+104>>2]|0)!=(u|0))if((o[11120+(h*216|0)+112>>2]|0)!=(u|0))if((o[11120+(h*216|0)+120>>2]|0)!=(u|0))if((o[11120+(h*216|0)+128>>2]|0)!=(u|0))if((o[11120+(h*216|0)+136>>2]|0)==(u|0))u=2,f=1,y=2;else{if((o[11120+(h*216|0)+144>>2]|0)==(u|0)){u=0,f=2,y=0;break}if((o[11120+(h*216|0)+152>>2]|0)==(u|0)){u=0,f=2,y=1;break}if((o[11120+(h*216|0)+160>>2]|0)==(u|0)){u=0,f=2,y=2;break}if((o[11120+(h*216|0)+168>>2]|0)==(u|0)){u=1,f=2,y=0;break}if((o[11120+(h*216|0)+176>>2]|0)==(u|0)){u=1,f=2,y=1;break}if((o[11120+(h*216|0)+184>>2]|0)==(u|0)){u=1,f=2,y=2;break}if((o[11120+(h*216|0)+192>>2]|0)==(u|0)){u=2,f=2,y=0;break}if((o[11120+(h*216|0)+200>>2]|0)==(u|0)){u=2,f=2,y=1;break}if((o[11120+(h*216|0)+208>>2]|0)==(u|0)){u=2,f=2,y=2;break}else u=-1;return u|0}else u=2,f=1,y=1;else u=2,f=1,y=0;else u=1,f=1,y=2;else u=1,f=1,y=1;else u=1,f=1,y=0;else u=0,f=1,y=2;else u=0,f=1,y=1;else u=0,f=1,y=0;else u=2,f=0,y=2;else u=2,f=0,y=1;else u=2,f=0,y=0;else u=1,f=0,y=2;else u=1,f=0,y=1;else u=1,f=0,y=0;else u=0,f=0,y=2;else u=0,f=0,y=1;else u=0,f=0,y=0;while(!1);return h=o[11120+(h*216|0)+(f*72|0)+(u*24|0)+(y<<3)+4>>2]|0,h|0}function vi(u,h){return u=u|0,h=h|0,(o[7696+(u*28|0)+20>>2]|0)==(h|0)?(h=1,h|0):(h=(o[7696+(u*28|0)+24>>2]|0)==(h|0),h|0)}function Do(u,h){return u=u|0,h=h|0,o[848+(u*28|0)+(h<<2)>>2]|0}function Ho(u,h){return u=u|0,h=h|0,(o[848+(u*28|0)>>2]|0)==(h|0)?(h=0,h|0):(o[848+(u*28|0)+4>>2]|0)==(h|0)?(h=1,h|0):(o[848+(u*28|0)+8>>2]|0)==(h|0)?(h=2,h|0):(o[848+(u*28|0)+12>>2]|0)==(h|0)?(h=3,h|0):(o[848+(u*28|0)+16>>2]|0)==(h|0)?(h=4,h|0):(o[848+(u*28|0)+20>>2]|0)==(h|0)?(h=5,h|0):((o[848+(u*28|0)+24>>2]|0)==(h|0)?6:7)|0}function xn(){return 122}function ta(u){u=u|0;var h=0,f=0,y=0;h=0;do tt(h|0,0,45)|0,y=Je()|0|134225919,f=u+(h<<3)|0,o[f>>2]=-1,o[f+4>>2]=y,h=h+1|0;while((h|0)!=122);return 0}function Yl(u){return u=u|0,+oe[u+16>>3]<+oe[u+24>>3]|0}function Po(u,h){u=u|0,h=h|0;var f=0,y=0,b=0;return f=+oe[h>>3],!(f>=+oe[u+8>>3])||!(f<=+oe[u>>3])?(h=0,h|0):(y=+oe[u+16>>3],f=+oe[u+24>>3],b=+oe[h+8>>3],h=b>=f,u=b<=y&1,y<f?h&&(u=1):h||(u=0),h=(u|0)!=0,h|0)}function Kl(u,h,f){u=u|0,h=h|0,f=f|0;var y=0,b=0,I=0,R=0,V=0,W=0,Y=0,le=0,fe=0,ye=0,Ie=0,ke=0,qe=0,ut=0;ke=Ze,Ze=Ze+288|0,le=ke+264|0,fe=ke+96|0,Y=ke,V=Y,W=V+96|0;do o[V>>2]=0,V=V+4|0;while((V|0)<(W|0));return h=fo(h,Y)|0,h|0?(Ie=h,Ze=ke,Ie|0):(W=Y,Y=o[W>>2]|0,W=o[W+4>>2]|0,va(Y,W,le)|0,Rn(Y,W,fe)|0,R=+po(le,fe+8|0),oe[le>>3]=+oe[u>>3],W=le+8|0,oe[W>>3]=+oe[u+16>>3],oe[fe>>3]=+oe[u+8>>3],Y=fe+8|0,oe[Y>>3]=+oe[u+24>>3],b=+po(le,fe),ut=+oe[W>>3]-+oe[Y>>3],I=+ai(+ut),qe=+oe[le>>3]-+oe[fe>>3],y=+ai(+qe),!(ut==0|qe==0)&&(ut=+z(+I,+y),ut=+ko(+(b*b/+l(+(ut/+l(+I,+y)),3)/(R*(R*2.59807621135)*.8))),oe[ti>>3]=ut,ye=~~ut>>>0,Ie=+ai(ut)>=1?ut>0?~~+qo(+yi(ut/4294967296),4294967295)>>>0:~~+ko((ut-+(~~ut>>>0))/4294967296)>>>0:0,(o[ti+4>>2]&2146435072|0)!=2146435072)?(fe=(ye|0)==0&(Ie|0)==0,h=f,o[h>>2]=fe?1:ye,o[h+4>>2]=fe?0:Ie,h=0):h=1,Ie=h,Ze=ke,Ie|0)}function dA(u,h,f,y){u=u|0,h=h|0,f=f|0,y=y|0;var b=0,I=0,R=0,V=0,W=0,Y=0,le=0;Y=Ze,Ze=Ze+288|0,R=Y+264|0,V=Y+96|0,W=Y,b=W,I=b+96|0;do o[b>>2]=0,b=b+4|0;while((b|0)<(I|0));return f=fo(f,W)|0,f|0?(y=f,Ze=Y,y|0):(f=W,b=o[f>>2]|0,f=o[f+4>>2]|0,va(b,f,R)|0,Rn(b,f,V)|0,le=+po(R,V+8|0),le=+ko(+(+po(u,h)/(le*2))),oe[ti>>3]=le,f=~~le>>>0,b=+ai(le)>=1?le>0?~~+qo(+yi(le/4294967296),4294967295)>>>0:~~+ko((le-+(~~le>>>0))/4294967296)>>>0:0,(o[ti+4>>2]&2146435072|0)==2146435072?(y=1,Ze=Y,y|0):(W=(f|0)==0&(b|0)==0,o[y>>2]=W?1:f,o[y+4>>2]=W?0:b,y=0,Ze=Y,y|0))}function $n(u,h,f,y){u=u|0,h=h|0,f=f|0,y=y|0,o[u>>2]=h,o[u+4>>2]=f,o[u+8>>2]=y}function Ht(u,h){u=u|0,h=h|0;var f=0,y=0,b=0,I=0,R=0,V=0,W=0,Y=0,le=0,fe=0,ye=0;fe=h+8|0,o[fe>>2]=0,W=+oe[u>>3],R=+ai(+W),Y=+oe[u+8>>3],V=+ai(+Y)/.8660254037844386,R=R+V*.5,f=~~R,u=~~V,R=R-+(f|0),V=V-+(u|0);do if(R<.5)if(R<.3333333333333333)if(o[h>>2]=f,V<(R+1)*.5){o[h+4>>2]=u;break}else{u=u+1|0,o[h+4>>2]=u;break}else if(ye=1-R,u=(!(V<ye)&1)+u|0,o[h+4>>2]=u,ye<=V&V<R*2){f=f+1|0,o[h>>2]=f;break}else{o[h>>2]=f;break}else{if(!(R<.6666666666666666))if(f=f+1|0,o[h>>2]=f,V<R*.5){o[h+4>>2]=u;break}else{u=u+1|0,o[h+4>>2]=u;break}if(V<1-R){if(o[h+4>>2]=u,R*2+-1<V){o[h>>2]=f;break}}else u=u+1|0,o[h+4>>2]=u;f=f+1|0,o[h>>2]=f}while(!1);do if(W<0)if(u&1){le=(u+1|0)/2|0,le=L(f|0,((f|0)<0)<<31>>31|0,le|0,((le|0)<0)<<31>>31|0)|0,f=~~(+(f|0)-((+(le>>>0)+4294967296*+(Je()|0))*2+1)),o[h>>2]=f;break}else{le=(u|0)/2|0,le=L(f|0,((f|0)<0)<<31>>31|0,le|0,((le|0)<0)<<31>>31|0)|0,f=~~(+(f|0)-(+(le>>>0)+4294967296*+(Je()|0))*2),o[h>>2]=f;break}while(!1);le=h+4|0,Y<0&&(f=f-((u<<1|1|0)/2|0)|0,o[h>>2]=f,u=0-u|0,o[le>>2]=u),y=u-f|0,(f|0)<0?(b=0-f|0,o[le>>2]=y,o[fe>>2]=b,o[h>>2]=0,u=y,f=0):b=0,(u|0)<0&&(f=f-u|0,o[h>>2]=f,b=b-u|0,o[fe>>2]=b,o[le>>2]=0,u=0),I=f-b|0,y=u-b|0,(b|0)<0&&(o[h>>2]=I,o[le>>2]=y,o[fe>>2]=0,u=y,f=I,b=0),y=(u|0)<(f|0)?u:f,y=(b|0)<(y|0)?b:y,!((y|0)<=0)&&(o[h>>2]=f-y,o[le>>2]=u-y,o[fe>>2]=b-y)}function ji(u){u=u|0;var h=0,f=0,y=0,b=0,I=0,R=0;h=o[u>>2]|0,R=u+4|0,f=o[R>>2]|0,(h|0)<0&&(f=f-h|0,o[R>>2]=f,I=u+8|0,o[I>>2]=(o[I>>2]|0)-h,o[u>>2]=0,h=0),(f|0)<0?(h=h-f|0,o[u>>2]=h,I=u+8|0,b=(o[I>>2]|0)-f|0,o[I>>2]=b,o[R>>2]=0,f=0):(b=u+8|0,I=b,b=o[b>>2]|0),(b|0)<0&&(h=h-b|0,o[u>>2]=h,f=f-b|0,o[R>>2]=f,o[I>>2]=0,b=0),y=(f|0)<(h|0)?f:h,y=(b|0)<(y|0)?b:y,!((y|0)<=0)&&(o[u>>2]=h-y,o[R>>2]=f-y,o[I>>2]=b-y)}function ar(u,h){u=u|0,h=h|0;var f=0,y=0;y=o[u+8>>2]|0,f=+((o[u+4>>2]|0)-y|0),oe[h>>3]=+((o[u>>2]|0)-y|0)-f*.5,oe[h+8>>3]=f*.8660254037844386}function sn(u,h,f){u=u|0,h=h|0,f=f|0,o[f>>2]=(o[h>>2]|0)+(o[u>>2]|0),o[f+4>>2]=(o[h+4>>2]|0)+(o[u+4>>2]|0),o[f+8>>2]=(o[h+8>>2]|0)+(o[u+8>>2]|0)}function ia(u,h,f){u=u|0,h=h|0,f=f|0,o[f>>2]=(o[u>>2]|0)-(o[h>>2]|0),o[f+4>>2]=(o[u+4>>2]|0)-(o[h+4>>2]|0),o[f+8>>2]=(o[u+8>>2]|0)-(o[h+8>>2]|0)}function Pr(u,h){u=u|0,h=h|0;var f=0,y=0;f=nn(o[u>>2]|0,h)|0,o[u>>2]=f,f=u+4|0,y=nn(o[f>>2]|0,h)|0,o[f>>2]=y,u=u+8|0,h=nn(o[u>>2]|0,h)|0,o[u>>2]=h}function ma(u){u=u|0;var h=0,f=0,y=0,b=0,I=0,R=0,V=0;R=o[u>>2]|0,V=(R|0)<0,y=(o[u+4>>2]|0)-(V?R:0)|0,I=(y|0)<0,b=(I?0-y|0:0)+((o[u+8>>2]|0)-(V?R:0))|0,f=(b|0)<0,u=f?0:b,h=(I?0:y)-(f?b:0)|0,b=(V?0:R)-(I?y:0)-(f?b:0)|0,f=(h|0)<(b|0)?h:b,f=(u|0)<(f|0)?u:f,y=(f|0)>0,u=u-(y?f:0)|0,h=h-(y?f:0)|0;e:do switch(b-(y?f:0)|0){case 0:switch(h|0){case 0:return V=u|0?(u|0)==1?1:7:0,V|0;case 1:return V=u|0?(u|0)==1?3:7:2,V|0;default:break e}case 1:switch(h|0){case 0:return V=u|0?(u|0)==1?5:7:4,V|0;case 1:{if(!u)u=6;else break e;return u|0}default:break e}}while(!1);return V=7,V|0}function Ja(u){u=u|0;var h=0,f=0,y=0,b=0,I=0,R=0,V=0;R=u+8|0,b=o[R>>2]|0,I=(o[u>>2]|0)-b|0,V=u+4|0,b=(o[V>>2]|0)-b|0;do if(I>>>0>715827881|b>>>0>715827881){if(f=(I|0)>0,f){if((2147483647-I|0)<(I|0)||(2147483647-(I<<1)|0)<(I|0))return V=1,V|0}else if((-2147483648-I|0)>(I|0)||(-2147483648-(I<<1)|0)>(I|0))return V=1,V|0;if(h=I*3|0,(b|0)>0){if((2147483647-b|0)<(b|0))return V=1,V|0}else if((-2147483648-b|0)>(b|0))return V=1,V|0;if(y=b<<1,(I|0)>-1){if((h|-2147483648|0)>=(b|0))return V=1,V|0}else if((h^-2147483648|0)<(b|0))return V=1,V|0;if(f){if((2147483647-I|0)<(y|0))h=1;else{f=y;break}return h|0}else{if((-2147483648-I|0)>(y|0))h=1;else{f=y;break}return h|0}}else f=b<<1,h=I*3|0;while(!1);y=la(+(h-b|0)/7)|0,o[u>>2]=y,b=la(+(f+I|0)/7)|0,o[V>>2]=b,o[R>>2]=0,f=(b|0)<(y|0),h=f?y:b,f=f?b:y;do if((f|0)<0){if((h|0)>0){if((h|-2147483648|0)<(f|0)&((f|0)!=-2147483648&(2147483647-h|0)>=(f|0)))break;Ar(23313,22444,355,22455)}if((f|0)==-2147483648|(-2147483648-h|0)>(f|0)&&Ar(23313,22444,355,22455),(h|0)>-1){if((h|-2147483648|0)<(f|0))break;Ar(23313,22444,355,22455)}else{if((h^-2147483648|0)>=(f|0))break;Ar(23313,22444,355,22455)}}while(!1);return h=b-y|0,(y|0)<0?(f=0-y|0,o[V>>2]=h,o[R>>2]=f,o[u>>2]=0,y=0):(h=b,f=0),(h|0)<0&&(y=y-h|0,o[u>>2]=y,f=f-h|0,o[R>>2]=f,o[V>>2]=0,h=0),I=y-f|0,b=h-f|0,(f|0)<0?(o[u>>2]=I,o[V>>2]=b,o[R>>2]=0,h=b,b=I,f=0):b=y,y=(h|0)<(b|0)?h:b,y=(f|0)<(y|0)?f:y,(y|0)<=0?(V=0,V|0):(o[u>>2]=b-y,o[V>>2]=h-y,o[R>>2]=f-y,V=0,V|0)}function ra(u){u=u|0;var h=0,f=0,y=0,b=0,I=0,R=0,V=0;R=u+8|0,b=o[R>>2]|0,I=(o[u>>2]|0)-b|0,V=u+4|0,b=(o[V>>2]|0)-b|0;do if(I>>>0>715827881|b>>>0>715827881){if(f=(I|0)>0,f){if((2147483647-I|0)<(I|0))return V=1,V|0}else if((-2147483648-I|0)>(I|0))return V=1,V|0;if(h=I<<1,(b|0)>0){if((2147483647-b|0)<(b|0)||(2147483647-(b<<1)|0)<(b|0))return V=1,V|0}else if((-2147483648-b|0)>(b|0)||(-2147483648-(b<<1)|0)>(b|0))return V=1,V|0;if(y=b*3|0,f){if((2147483647-h|0)<(b|0))return V=1,V|0}else if((-2147483648-h|0)>(b|0))return V=1,V|0;if((b|0)>-1){if((y|-2147483648|0)<(I|0)){f=y;break}else h=1;return h|0}else{if((y^-2147483648|0)<(I|0))h=1;else{f=y;break}return h|0}}else f=b*3|0,h=I<<1;while(!1);y=la(+(h+b|0)/7)|0,o[u>>2]=y,b=la(+(f-I|0)/7)|0,o[V>>2]=b,o[R>>2]=0,f=(b|0)<(y|0),h=f?y:b,f=f?b:y;do if((f|0)<0){if((h|0)>0){if((h|-2147483648|0)<(f|0)&((f|0)!=-2147483648&(2147483647-h|0)>=(f|0)))break;Ar(23313,22444,404,22469)}if((f|0)==-2147483648|(-2147483648-h|0)>(f|0)&&Ar(23313,22444,404,22469),(h|0)>-1){if((h|-2147483648|0)<(f|0))break;Ar(23313,22444,404,22469)}else{if((h^-2147483648|0)>=(f|0))break;Ar(23313,22444,404,22469)}}while(!1);return h=b-y|0,(y|0)<0?(f=0-y|0,o[V>>2]=h,o[R>>2]=f,o[u>>2]=0,y=0):(h=b,f=0),(h|0)<0&&(y=y-h|0,o[u>>2]=y,f=f-h|0,o[R>>2]=f,o[V>>2]=0,h=0),I=y-f|0,b=h-f|0,(f|0)<0?(o[u>>2]=I,o[V>>2]=b,o[R>>2]=0,h=b,b=I,f=0):b=y,y=(h|0)<(b|0)?h:b,y=(f|0)<(y|0)?f:y,(y|0)<=0?(V=0,V|0):(o[u>>2]=b-y,o[V>>2]=h-y,o[R>>2]=f-y,V=0,V|0)}function no(u){u=u|0;var h=0,f=0,y=0,b=0,I=0,R=0,V=0;R=u+8|0,f=o[R>>2]|0,h=(o[u>>2]|0)-f|0,V=u+4|0,f=(o[V>>2]|0)-f|0,y=la(+((h*3|0)-f|0)/7)|0,o[u>>2]=y,h=la(+((f<<1)+h|0)/7)|0,o[V>>2]=h,o[R>>2]=0,f=h-y|0,(y|0)<0?(I=0-y|0,o[V>>2]=f,o[R>>2]=I,o[u>>2]=0,h=f,y=0,f=I):f=0,(h|0)<0&&(y=y-h|0,o[u>>2]=y,f=f-h|0,o[R>>2]=f,o[V>>2]=0,h=0),I=y-f|0,b=h-f|0,(f|0)<0?(o[u>>2]=I,o[V>>2]=b,o[R>>2]=0,h=b,b=I,f=0):b=y,y=(h|0)<(b|0)?h:b,y=(f|0)<(y|0)?f:y,!((y|0)<=0)&&(o[u>>2]=b-y,o[V>>2]=h-y,o[R>>2]=f-y)}function Xn(u){u=u|0;var h=0,f=0,y=0,b=0,I=0,R=0,V=0;R=u+8|0,f=o[R>>2]|0,h=(o[u>>2]|0)-f|0,V=u+4|0,f=(o[V>>2]|0)-f|0,y=la(+((h<<1)+f|0)/7)|0,o[u>>2]=y,h=la(+((f*3|0)-h|0)/7)|0,o[V>>2]=h,o[R>>2]=0,f=h-y|0,(y|0)<0?(I=0-y|0,o[V>>2]=f,o[R>>2]=I,o[u>>2]=0,h=f,y=0,f=I):f=0,(h|0)<0&&(y=y-h|0,o[u>>2]=y,f=f-h|0,o[R>>2]=f,o[V>>2]=0,h=0),I=y-f|0,b=h-f|0,(f|0)<0?(o[u>>2]=I,o[V>>2]=b,o[R>>2]=0,h=b,b=I,f=0):b=y,y=(h|0)<(b|0)?h:b,y=(f|0)<(y|0)?f:y,!((y|0)<=0)&&(o[u>>2]=b-y,o[V>>2]=h-y,o[R>>2]=f-y)}function fl(u){u=u|0;var h=0,f=0,y=0,b=0,I=0,R=0,V=0;h=o[u>>2]|0,R=u+4|0,f=o[R>>2]|0,V=u+8|0,y=o[V>>2]|0,b=f+(h*3|0)|0,o[u>>2]=b,f=y+(f*3|0)|0,o[R>>2]=f,h=(y*3|0)+h|0,o[V>>2]=h,y=f-b|0,(b|0)<0?(h=h-b|0,o[R>>2]=y,o[V>>2]=h,o[u>>2]=0,f=y,y=0):y=b,(f|0)<0&&(y=y-f|0,o[u>>2]=y,h=h-f|0,o[V>>2]=h,o[R>>2]=0,f=0),I=y-h|0,b=f-h|0,(h|0)<0?(o[u>>2]=I,o[R>>2]=b,o[V>>2]=0,y=I,h=0):b=f,f=(b|0)<(y|0)?b:y,f=(h|0)<(f|0)?h:f,!((f|0)<=0)&&(o[u>>2]=y-f,o[R>>2]=b-f,o[V>>2]=h-f)}function Os(u){u=u|0;var h=0,f=0,y=0,b=0,I=0,R=0,V=0;b=o[u>>2]|0,R=u+4|0,h=o[R>>2]|0,V=u+8|0,f=o[V>>2]|0,y=(h*3|0)+b|0,b=f+(b*3|0)|0,o[u>>2]=b,o[R>>2]=y,h=(f*3|0)+h|0,o[V>>2]=h,f=y-b|0,(b|0)<0?(h=h-b|0,o[R>>2]=f,o[V>>2]=h,o[u>>2]=0,b=0):f=y,(f|0)<0&&(b=b-f|0,o[u>>2]=b,h=h-f|0,o[V>>2]=h,o[R>>2]=0,f=0),I=b-h|0,y=f-h|0,(h|0)<0?(o[u>>2]=I,o[R>>2]=y,o[V>>2]=0,b=I,h=0):y=f,f=(y|0)<(b|0)?y:b,f=(h|0)<(f|0)?h:f,!((f|0)<=0)&&(o[u>>2]=b-f,o[R>>2]=y-f,o[V>>2]=h-f)}function _a(u,h){u=u|0,h=h|0;var f=0,y=0,b=0,I=0,R=0,V=0;(h+-1|0)>>>0>=6||(b=(o[15440+(h*12|0)>>2]|0)+(o[u>>2]|0)|0,o[u>>2]=b,V=u+4|0,y=(o[15440+(h*12|0)+4>>2]|0)+(o[V>>2]|0)|0,o[V>>2]=y,R=u+8|0,h=(o[15440+(h*12|0)+8>>2]|0)+(o[R>>2]|0)|0,o[R>>2]=h,f=y-b|0,(b|0)<0?(h=h-b|0,o[V>>2]=f,o[R>>2]=h,o[u>>2]=0,y=0):(f=y,y=b),(f|0)<0&&(y=y-f|0,o[u>>2]=y,h=h-f|0,o[R>>2]=h,o[V>>2]=0,f=0),I=y-h|0,b=f-h|0,(h|0)<0?(o[u>>2]=I,o[V>>2]=b,o[R>>2]=0,y=I,h=0):b=f,f=(b|0)<(y|0)?b:y,f=(h|0)<(f|0)?h:f,!((f|0)<=0)&&(o[u>>2]=y-f,o[V>>2]=b-f,o[R>>2]=h-f))}function zl(u){u=u|0;var h=0,f=0,y=0,b=0,I=0,R=0,V=0;b=o[u>>2]|0,R=u+4|0,h=o[R>>2]|0,V=u+8|0,f=o[V>>2]|0,y=h+b|0,b=f+b|0,o[u>>2]=b,o[R>>2]=y,h=f+h|0,o[V>>2]=h,f=y-b|0,(b|0)<0?(h=h-b|0,o[R>>2]=f,o[V>>2]=h,o[u>>2]=0,y=0):(f=y,y=b),(f|0)<0&&(y=y-f|0,o[u>>2]=y,h=h-f|0,o[V>>2]=h,o[R>>2]=0,f=0),I=y-h|0,b=f-h|0,(h|0)<0?(o[u>>2]=I,o[R>>2]=b,o[V>>2]=0,y=I,h=0):b=f,f=(b|0)<(y|0)?b:y,f=(h|0)<(f|0)?h:f,!((f|0)<=0)&&(o[u>>2]=y-f,o[R>>2]=b-f,o[V>>2]=h-f)}function ga(u){u=u|0;var h=0,f=0,y=0,b=0,I=0,R=0,V=0;h=o[u>>2]|0,R=u+4|0,y=o[R>>2]|0,V=u+8|0,f=o[V>>2]|0,b=y+h|0,o[u>>2]=b,y=f+y|0,o[R>>2]=y,h=f+h|0,o[V>>2]=h,f=y-b|0,(b|0)<0?(h=h-b|0,o[R>>2]=f,o[V>>2]=h,o[u>>2]=0,y=0):(f=y,y=b),(f|0)<0&&(y=y-f|0,o[u>>2]=y,h=h-f|0,o[V>>2]=h,o[R>>2]=0,f=0),I=y-h|0,b=f-h|0,(h|0)<0?(o[u>>2]=I,o[R>>2]=b,o[V>>2]=0,y=I,h=0):b=f,f=(b|0)<(y|0)?b:y,f=(h|0)<(f|0)?h:f,!((f|0)<=0)&&(o[u>>2]=y-f,o[R>>2]=b-f,o[V>>2]=h-f)}function el(u){switch(u=u|0,u|0){case 1:{u=5;break}case 5:{u=4;break}case 4:{u=6;break}case 6:{u=2;break}case 2:{u=3;break}case 3:{u=1;break}}return u|0}function Fa(u){switch(u=u|0,u|0){case 1:{u=3;break}case 3:{u=2;break}case 2:{u=6;break}case 6:{u=4;break}case 4:{u=5;break}case 5:{u=1;break}}return u|0}function KA(u){u=u|0;var h=0,f=0,y=0,b=0,I=0,R=0,V=0;h=o[u>>2]|0,R=u+4|0,f=o[R>>2]|0,V=u+8|0,y=o[V>>2]|0,b=f+(h<<1)|0,o[u>>2]=b,f=y+(f<<1)|0,o[R>>2]=f,h=(y<<1)+h|0,o[V>>2]=h,y=f-b|0,(b|0)<0?(h=h-b|0,o[R>>2]=y,o[V>>2]=h,o[u>>2]=0,f=y,y=0):y=b,(f|0)<0&&(y=y-f|0,o[u>>2]=y,h=h-f|0,o[V>>2]=h,o[R>>2]=0,f=0),I=y-h|0,b=f-h|0,(h|0)<0?(o[u>>2]=I,o[R>>2]=b,o[V>>2]=0,y=I,h=0):b=f,f=(b|0)<(y|0)?b:y,f=(h|0)<(f|0)?h:f,!((f|0)<=0)&&(o[u>>2]=y-f,o[R>>2]=b-f,o[V>>2]=h-f)}function fA(u){u=u|0;var h=0,f=0,y=0,b=0,I=0,R=0,V=0;b=o[u>>2]|0,R=u+4|0,h=o[R>>2]|0,V=u+8|0,f=o[V>>2]|0,y=(h<<1)+b|0,b=f+(b<<1)|0,o[u>>2]=b,o[R>>2]=y,h=(f<<1)+h|0,o[V>>2]=h,f=y-b|0,(b|0)<0?(h=h-b|0,o[R>>2]=f,o[V>>2]=h,o[u>>2]=0,b=0):f=y,(f|0)<0&&(b=b-f|0,o[u>>2]=b,h=h-f|0,o[V>>2]=h,o[R>>2]=0,f=0),I=b-h|0,y=f-h|0,(h|0)<0?(o[u>>2]=I,o[R>>2]=y,o[V>>2]=0,b=I,h=0):y=f,f=(y|0)<(b|0)?y:b,f=(h|0)<(f|0)?h:f,!((f|0)<=0)&&(o[u>>2]=b-f,o[R>>2]=y-f,o[V>>2]=h-f)}function PA(u,h){u=u|0,h=h|0;var f=0,y=0,b=0,I=0,R=0,V=0;return R=(o[u>>2]|0)-(o[h>>2]|0)|0,V=(R|0)<0,y=(o[u+4>>2]|0)-(o[h+4>>2]|0)-(V?R:0)|0,I=(y|0)<0,b=(V?0-R|0:0)+(o[u+8>>2]|0)-(o[h+8>>2]|0)+(I?0-y|0:0)|0,u=(b|0)<0,h=u?0:b,f=(I?0:y)-(u?b:0)|0,b=(V?0:R)-(I?y:0)-(u?b:0)|0,u=(f|0)<(b|0)?f:b,u=(h|0)<(u|0)?h:u,y=(u|0)>0,h=h-(y?u:0)|0,f=f-(y?u:0)|0,u=b-(y?u:0)|0,u=(u|0)>-1?u:0-u|0,f=(f|0)>-1?f:0-f|0,h=(h|0)>-1?h:0-h|0,h=(f|0)>(h|0)?f:h,((u|0)>(h|0)?u:h)|0}function Wo(u,h){u=u|0,h=h|0;var f=0;f=o[u+8>>2]|0,o[h>>2]=(o[u>>2]|0)-f,o[h+4>>2]=(o[u+4>>2]|0)-f}function pr(u,h){u=u|0,h=h|0;var f=0,y=0,b=0,I=0,R=0,V=0;y=o[u>>2]|0,o[h>>2]=y,b=o[u+4>>2]|0,R=h+4|0,o[R>>2]=b,V=h+8|0,o[V>>2]=0,f=(b|0)<(y|0),u=f?y:b,f=f?b:y;do if((f|0)<0){if((u|0)>0){if((u|-2147483648|0)<(f|0)&((f|0)!=-2147483648&(2147483647-u|0)>=(f|0)))break;return u=1,u|0}if((f|0)==-2147483648|(-2147483648-u|0)>(f|0))return h=1,h|0;if((u|0)>-1){if((u|-2147483648|0)<(f|0))break;return u=1,u|0}else{if((u^-2147483648|0)<(f|0))u=1;else break;return u|0}}while(!1);return u=b-y|0,(y|0)<0?(f=0-y|0,o[R>>2]=u,o[V>>2]=f,o[h>>2]=0,y=0):(u=b,f=0),(u|0)<0&&(y=y-u|0,o[h>>2]=y,f=f-u|0,o[V>>2]=f,o[R>>2]=0,u=0),I=y-f|0,b=u-f|0,(f|0)<0?(o[h>>2]=I,o[R>>2]=b,o[V>>2]=0,u=b,b=I,f=0):b=y,y=(u|0)<(b|0)?u:b,y=(f|0)<(y|0)?f:y,(y|0)<=0?(h=0,h|0):(o[h>>2]=b-y,o[R>>2]=u-y,o[V>>2]=f-y,h=0,h|0)}function Oa(u){u=u|0;var h=0,f=0,y=0,b=0;h=u+8|0,b=o[h>>2]|0,f=b-(o[u>>2]|0)|0,o[u>>2]=f,y=u+4|0,u=(o[y>>2]|0)-b|0,o[y>>2]=u,o[h>>2]=0-(u+f)}function zA(u){u=u|0;var h=0,f=0,y=0,b=0,I=0,R=0,V=0;f=o[u>>2]|0,h=0-f|0,o[u>>2]=h,R=u+8|0,o[R>>2]=0,V=u+4|0,y=o[V>>2]|0,b=y+f|0,(f|0)>0?(o[V>>2]=b,o[R>>2]=f,o[u>>2]=0,h=0,y=b):f=0,(y|0)<0?(I=h-y|0,o[u>>2]=I,f=f-y|0,o[R>>2]=f,o[V>>2]=0,b=I-f|0,h=0-f|0,(f|0)<0?(o[u>>2]=b,o[V>>2]=h,o[R>>2]=0,y=h,f=0):(y=0,b=I)):b=h,h=(y|0)<(b|0)?y:b,h=(f|0)<(h|0)?f:h,!((h|0)<=0)&&(o[u>>2]=b-h,o[V>>2]=y-h,o[R>>2]=f-h)}function uo(u,h,f,y,b){u=u|0,h=h|0,f=f|0,y=y|0,b=b|0;var I=0,R=0,V=0,W=0,Y=0,le=0,fe=0;if(fe=Ze,Ze=Ze+64|0,le=fe,V=fe+56|0,!(!0&(h&2013265920|0)==134217728&(!0&(y&2013265920|0)==134217728)))return b=5,Ze=fe,b|0;if((u|0)==(f|0)&(h|0)==(y|0))return o[b>>2]=0,b=0,Ze=fe,b|0;if(R=Xe(u|0,h|0,52)|0,Je()|0,R=R&15,Y=Xe(f|0,y|0,52)|0,Je()|0,(R|0)!=(Y&15|0))return b=12,Ze=fe,b|0;if(I=R+-1|0,R>>>0>1){zo(u,h,I,le)|0,zo(f,y,I,V)|0,Y=le,W=o[Y>>2]|0,Y=o[Y+4>>2]|0;e:do if((W|0)==(o[V>>2]|0)&&(Y|0)==(o[V+4>>2]|0)){R=(R^15)*3|0,I=Xe(u|0,h|0,R|0)|0,Je()|0,I=I&7,R=Xe(f|0,y|0,R|0)|0,Je()|0,R=R&7;do if((I|0)==0|(R|0)==0)o[b>>2]=1,I=0;else if((I|0)==7)I=5;else{if((I|0)==1|(R|0)==1&&Ln(W,Y)|0){I=5;break}if((o[15536+(I<<2)>>2]|0)!=(R|0)&&(o[15568+(I<<2)>>2]|0)!=(R|0))break e;o[b>>2]=1,I=0}while(!1);return b=I,Ze=fe,b|0}while(!1)}I=le,R=I+56|0;do o[I>>2]=0,I=I+4|0;while((I|0)<(R|0));return Qo(u,h,1,le)|0,h=le,!((o[h>>2]|0)==(f|0)&&(o[h+4>>2]|0)==(y|0))&&(h=le+8|0,!((o[h>>2]|0)==(f|0)&&(o[h+4>>2]|0)==(y|0)))&&(h=le+16|0,!((o[h>>2]|0)==(f|0)&&(o[h+4>>2]|0)==(y|0)))&&(h=le+24|0,!((o[h>>2]|0)==(f|0)&&(o[h+4>>2]|0)==(y|0)))&&(h=le+32|0,!((o[h>>2]|0)==(f|0)&&(o[h+4>>2]|0)==(y|0)))&&(h=le+40|0,!((o[h>>2]|0)==(f|0)&&(o[h+4>>2]|0)==(y|0)))?(I=le+48|0,I=((o[I>>2]|0)==(f|0)?(o[I+4>>2]|0)==(y|0):0)&1):I=1,o[b>>2]=I,b=0,Ze=fe,b|0}function so(u,h,f,y,b){return u=u|0,h=h|0,f=f|0,y=y|0,b=b|0,f=Dl(u,h,f,y)|0,(f|0)==7?(b=11,b|0):(y=tt(f|0,0,56)|0,h=h&-2130706433|(Je()|0)|268435456,o[b>>2]=u|y,o[b+4>>2]=h,b=0,b|0)}function Bl(u,h,f){return u=u|0,h=h|0,f=f|0,!0&(h&2013265920|0)==268435456?(o[f>>2]=u,o[f+4>>2]=h&-2130706433|134217728,f=0,f|0):(f=6,f|0)}function Jl(u,h,f){u=u|0,h=h|0,f=f|0;var y=0,b=0,I=0;return b=Ze,Ze=Ze+16|0,y=b,o[y>>2]=0,!0&(h&2013265920|0)==268435456?(I=Xe(u|0,h|0,56)|0,Je()|0,y=Ds(u,h&-2130706433|134217728,I&7,y,f)|0,Ze=b,y|0):(y=6,Ze=b,y|0)}function hs(u,h){u=u|0,h=h|0;var f=0;switch(f=Xe(u|0,h|0,56)|0,Je()|0,f&7){case 0:case 7:return f=0,f|0}return f=h&-2130706433|134217728,!(!0&(h&2013265920|0)==268435456)||!0&(h&117440512|0)==16777216&(Ln(u,f)|0)!=0?(f=0,f|0):(f=pA(u,f)|0,f|0)}function ya(u,h,f){u=u|0,h=h|0,f=f|0;var y=0,b=0,I=0,R=0;return b=Ze,Ze=Ze+16|0,y=b,!0&(h&2013265920|0)==268435456?(I=h&-2130706433|134217728,R=f,o[R>>2]=u,o[R+4>>2]=I,o[y>>2]=0,h=Xe(u|0,h|0,56)|0,Je()|0,y=Ds(u,I,h&7,y,f+8|0)|0,Ze=b,y|0):(y=6,Ze=b,y|0)}function Ll(u,h,f){u=u|0,h=h|0,f=f|0;var y=0,b=0;return b=(Ln(u,h)|0)==0,h=h&-2130706433,y=f,o[y>>2]=b?u:0,o[y+4>>2]=b?h|285212672:0,y=f+8|0,o[y>>2]=u,o[y+4>>2]=h|301989888,y=f+16|0,o[y>>2]=u,o[y+4>>2]=h|318767104,y=f+24|0,o[y>>2]=u,o[y+4>>2]=h|335544320,y=f+32|0,o[y>>2]=u,o[y+4>>2]=h|352321536,f=f+40|0,o[f>>2]=u,o[f+4>>2]=h|369098752,0}function Vs(u,h,f){u=u|0,h=h|0,f=f|0;var y=0,b=0,I=0,R=0;return R=Ze,Ze=Ze+16|0,b=R,I=h&-2130706433|134217728,!0&(h&2013265920|0)==268435456?(y=Xe(u|0,h|0,56)|0,Je()|0,y=Gn(u,I,y&7)|0,(y|0)==-1?(o[f>>2]=0,I=6,Ze=R,I|0):(Pn(u,I,b)|0&&Ar(23313,22484,282,22499),h=Xe(u|0,h|0,52)|0,Je()|0,h=h&15,Ln(u,I)|0?eA(b,h,y,2,f):Tn(b,h,y,2,f),I=0,Ze=R,I|0)):(I=6,Ze=R,I|0)}function cs(u,h,f){u=u|0,h=h|0,f=f|0;var y=0,b=0;y=Ze,Ze=Ze+16|0,b=y,Rl(u,h,f,b),Ht(b,f+4|0),Ze=y}function Rl(u,h,f,y){u=u|0,h=h|0,f=f|0,y=y|0;var b=0,I=0,R=0,V=0,W=0;if(V=Ze,Ze=Ze+16|0,W=V,BA(u,f,W),I=+Qs(+(1-+oe[W>>3]*.5)),I<1e-16){o[y>>2]=0,o[y+4>>2]=0,o[y+8>>2]=0,o[y+12>>2]=0,Ze=V;return}if(W=o[f>>2]|0,b=+oe[15920+(W*24|0)>>3],b=+nl(b-+nl(+Bo(15600+(W<<4)|0,u))),ho(h)|0?R=+nl(b+-.3334731722518321):R=b,b=+fn(+I)/.381966011250105,(h|0)>0){u=0;do b=b*2.6457513110645907,u=u+1|0;while((u|0)!=(h|0))}I=+bi(+R)*b,oe[y>>3]=I,R=+zi(+R)*b,oe[y+8>>3]=R,Ze=V}function BA(u,h,f){u=u|0,h=h|0,f=f|0;var y=0,b=0,I=0;if(I=Ze,Ze=Ze+32|0,b=I,aa(u,b),o[h>>2]=0,oe[f>>3]=5,y=+Ss(16400,b),y<+oe[f>>3]&&(o[h>>2]=0,oe[f>>3]=y),y=+Ss(16424,b),y<+oe[f>>3]&&(o[h>>2]=1,oe[f>>3]=y),y=+Ss(16448,b),y<+oe[f>>3]&&(o[h>>2]=2,oe[f>>3]=y),y=+Ss(16472,b),y<+oe[f>>3]&&(o[h>>2]=3,oe[f>>3]=y),y=+Ss(16496,b),y<+oe[f>>3]&&(o[h>>2]=4,oe[f>>3]=y),y=+Ss(16520,b),y<+oe[f>>3]&&(o[h>>2]=5,oe[f>>3]=y),y=+Ss(16544,b),y<+oe[f>>3]&&(o[h>>2]=6,oe[f>>3]=y),y=+Ss(16568,b),y<+oe[f>>3]&&(o[h>>2]=7,oe[f>>3]=y),y=+Ss(16592,b),y<+oe[f>>3]&&(o[h>>2]=8,oe[f>>3]=y),y=+Ss(16616,b),y<+oe[f>>3]&&(o[h>>2]=9,oe[f>>3]=y),y=+Ss(16640,b),y<+oe[f>>3]&&(o[h>>2]=10,oe[f>>3]=y),y=+Ss(16664,b),y<+oe[f>>3]&&(o[h>>2]=11,oe[f>>3]=y),y=+Ss(16688,b),y<+oe[f>>3]&&(o[h>>2]=12,oe[f>>3]=y),y=+Ss(16712,b),y<+oe[f>>3]&&(o[h>>2]=13,oe[f>>3]=y),y=+Ss(16736,b),y<+oe[f>>3]&&(o[h>>2]=14,oe[f>>3]=y),y=+Ss(16760,b),y<+oe[f>>3]&&(o[h>>2]=15,oe[f>>3]=y),y=+Ss(16784,b),y<+oe[f>>3]&&(o[h>>2]=16,oe[f>>3]=y),y=+Ss(16808,b),y<+oe[f>>3]&&(o[h>>2]=17,oe[f>>3]=y),y=+Ss(16832,b),y<+oe[f>>3]&&(o[h>>2]=18,oe[f>>3]=y),y=+Ss(16856,b),!(y<+oe[f>>3])){Ze=I;return}o[h>>2]=19,oe[f>>3]=y,Ze=I}function Gr(u,h,f,y,b){u=u|0,h=h|0,f=f|0,y=y|0,b=b|0;var I=0,R=0;if(I=+oc(u),I<1e-16){h=15600+(h<<4)|0,o[b>>2]=o[h>>2],o[b+4>>2]=o[h+4>>2],o[b+8>>2]=o[h+8>>2],o[b+12>>2]=o[h+12>>2];return}if(R=+Rs(+ +oe[u+8>>3],+ +oe[u>>3]),(f|0)>0){u=0;do I=I/2.6457513110645907,u=u+1|0;while((u|0)!=(f|0))}y?(I=I/3,f=(ho(f)|0)==0,I=+Ls(+((f?I:I/2.6457513110645907)*.381966011250105))):(I=+Ls(+(I*.381966011250105)),ho(f)|0&&(R=+nl(R+.3334731722518321))),ja(15600+(h<<4)|0,+nl(+oe[15920+(h*24|0)>>3]-R),I,b)}function Yn(u,h,f){u=u|0,h=h|0,f=f|0;var y=0,b=0;y=Ze,Ze=Ze+16|0,b=y,ar(u+4|0,b),Gr(b,o[u>>2]|0,h,0,f),Ze=y}function eA(u,h,f,y,b){u=u|0,h=h|0,f=f|0,y=y|0,b=b|0;var I=0,R=0,V=0,W=0,Y=0,le=0,fe=0,ye=0,Ie=0,ke=0,qe=0,ut=0,mt=0,st=0,ht=0,ft=0,Ai=0,Nt=0,Wt=0,Gt=0,lr=0,Hi=0,Zi=0,Fi=0,sr=0,er=0,Nr=0,Yi=0;if(er=Ze,Ze=Ze+272|0,I=er+256|0,st=er+240|0,Zi=er,Fi=er+224|0,sr=er+208|0,ht=er+176|0,ft=er+160|0,Ai=er+192|0,Nt=er+144|0,Wt=er+128|0,Gt=er+112|0,lr=er+96|0,Hi=er+80|0,o[I>>2]=h,o[st>>2]=o[u>>2],o[st+4>>2]=o[u+4>>2],o[st+8>>2]=o[u+8>>2],o[st+12>>2]=o[u+12>>2],Gi(st,I,Zi),o[b>>2]=0,st=y+f+((y|0)==5&1)|0,(st|0)<=(f|0)){Ze=er;return}W=o[I>>2]|0,Y=Fi+4|0,le=ht+4|0,fe=f+5|0,ye=16880+(W<<2)|0,Ie=16960+(W<<2)|0,ke=Wt+8|0,qe=Gt+8|0,ut=lr+8|0,mt=sr+4|0,V=f;e:for(;;){R=Zi+(((V|0)%5|0)<<4)|0,o[sr>>2]=o[R>>2],o[sr+4>>2]=o[R+4>>2],o[sr+8>>2]=o[R+8>>2],o[sr+12>>2]=o[R+12>>2];do;while((xa(sr,W,0,1)|0)==2);if((V|0)>(f|0)&(ho(h)|0)!=0){if(o[ht>>2]=o[sr>>2],o[ht+4>>2]=o[sr+4>>2],o[ht+8>>2]=o[sr+8>>2],o[ht+12>>2]=o[sr+12>>2],ar(Y,ft),y=o[ht>>2]|0,I=o[17040+(y*80|0)+(o[Fi>>2]<<2)>>2]|0,o[ht>>2]=o[18640+(y*80|0)+(I*20|0)>>2],R=o[18640+(y*80|0)+(I*20|0)+16>>2]|0,(R|0)>0){u=0;do zl(le),u=u+1|0;while((u|0)<(R|0))}switch(R=18640+(y*80|0)+(I*20|0)+4|0,o[Ai>>2]=o[R>>2],o[Ai+4>>2]=o[R+4>>2],o[Ai+8>>2]=o[R+8>>2],Pr(Ai,(o[ye>>2]|0)*3|0),sn(le,Ai,le),ji(le),ar(le,Nt),Nr=+(o[Ie>>2]|0),oe[Wt>>3]=Nr*3,oe[ke>>3]=0,Yi=Nr*-1.5,oe[Gt>>3]=Yi,oe[qe>>3]=Nr*2.598076211353316,oe[lr>>3]=Yi,oe[ut>>3]=Nr*-2.598076211353316,o[17040+((o[ht>>2]|0)*80|0)+(o[sr>>2]<<2)>>2]|0){case 1:{u=Gt,y=Wt;break}case 3:{u=lr,y=Gt;break}case 2:{u=Wt,y=lr;break}default:{u=12;break e}}nA(ft,Nt,y,u,Hi),Gr(Hi,o[ht>>2]|0,W,1,b+8+(o[b>>2]<<4)|0),o[b>>2]=(o[b>>2]|0)+1}if((V|0)<(fe|0)&&(ar(mt,ht),Gr(ht,o[sr>>2]|0,W,1,b+8+(o[b>>2]<<4)|0),o[b>>2]=(o[b>>2]|0)+1),o[Fi>>2]=o[sr>>2],o[Fi+4>>2]=o[sr+4>>2],o[Fi+8>>2]=o[sr+8>>2],o[Fi+12>>2]=o[sr+12>>2],V=V+1|0,(V|0)>=(st|0)){u=3;break}}if((u|0)==3){Ze=er;return}else(u|0)==12&&Ar(22522,22569,571,22579)}function Gi(u,h,f){u=u|0,h=h|0,f=f|0;var y=0,b=0,I=0,R=0,V=0,W=0;W=Ze,Ze=Ze+128|0,y=W+64|0,b=W,I=y,R=20240,V=I+60|0;do o[I>>2]=o[R>>2],I=I+4|0,R=R+4|0;while((I|0)<(V|0));I=b,R=20304,V=I+60|0;do o[I>>2]=o[R>>2],I=I+4|0,R=R+4|0;while((I|0)<(V|0));V=(ho(o[h>>2]|0)|0)==0,y=V?y:b,b=u+4|0,KA(b),fA(b),ho(o[h>>2]|0)|0&&(Os(b),o[h>>2]=(o[h>>2]|0)+1),o[f>>2]=o[u>>2],h=f+4|0,sn(b,y,h),ji(h),o[f+16>>2]=o[u>>2],h=f+20|0,sn(b,y+12|0,h),ji(h),o[f+32>>2]=o[u>>2],h=f+36|0,sn(b,y+24|0,h),ji(h),o[f+48>>2]=o[u>>2],h=f+52|0,sn(b,y+36|0,h),ji(h),o[f+64>>2]=o[u>>2],f=f+68|0,sn(b,y+48|0,f),ji(f),Ze=W}function xa(u,h,f,y){u=u|0,h=h|0,f=f|0,y=y|0;var b=0,I=0,R=0,V=0,W=0,Y=0,le=0,fe=0,ye=0,Ie=0,ke=0;if(ke=Ze,Ze=Ze+32|0,ye=ke+12|0,V=ke,Ie=u+4|0,fe=o[16960+(h<<2)>>2]|0,le=(y|0)!=0,fe=le?fe*3|0:fe,b=o[Ie>>2]|0,Y=u+8|0,R=o[Y>>2]|0,le){if(I=u+12|0,y=o[I>>2]|0,b=R+b+y|0,(b|0)==(fe|0))return Ie=1,Ze=ke,Ie|0;W=I}else W=u+12|0,y=o[W>>2]|0,b=R+b+y|0;if((b|0)<=(fe|0))return Ie=0,Ze=ke,Ie|0;do if((y|0)>0){if(y=o[u>>2]|0,(R|0)>0){I=18640+(y*80|0)+60|0,y=u;break}y=18640+(y*80|0)+40|0,f?($n(ye,fe,0,0),ia(Ie,ye,V),ga(V),sn(V,ye,Ie),I=y,y=u):(I=y,y=u)}else I=18640+((o[u>>2]|0)*80|0)+20|0,y=u;while(!1);if(o[y>>2]=o[I>>2],b=I+16|0,(o[b>>2]|0)>0){y=0;do zl(Ie),y=y+1|0;while((y|0)<(o[b>>2]|0))}return u=I+4|0,o[ye>>2]=o[u>>2],o[ye+4>>2]=o[u+4>>2],o[ye+8>>2]=o[u+8>>2],h=o[16880+(h<<2)>>2]|0,Pr(ye,le?h*3|0:h),sn(Ie,ye,Ie),ji(Ie),le?y=((o[Y>>2]|0)+(o[Ie>>2]|0)+(o[W>>2]|0)|0)==(fe|0)?1:2:y=2,Ie=y,Ze=ke,Ie|0}function ns(u,h){u=u|0,h=h|0;var f=0;do f=xa(u,h,0,1)|0;while((f|0)==2);return f|0}function Tn(u,h,f,y,b){u=u|0,h=h|0,f=f|0,y=y|0,b=b|0;var I=0,R=0,V=0,W=0,Y=0,le=0,fe=0,ye=0,Ie=0,ke=0,qe=0,ut=0,mt=0,st=0,ht=0,ft=0,Ai=0,Nt=0,Wt=0,Gt=0,lr=0,Hi=0,Zi=0;if(lr=Ze,Ze=Ze+240|0,I=lr+224|0,Ai=lr+208|0,Nt=lr,Wt=lr+192|0,Gt=lr+176|0,ut=lr+160|0,mt=lr+144|0,st=lr+128|0,ht=lr+112|0,ft=lr+96|0,o[I>>2]=h,o[Ai>>2]=o[u>>2],o[Ai+4>>2]=o[u+4>>2],o[Ai+8>>2]=o[u+8>>2],o[Ai+12>>2]=o[u+12>>2],Va(Ai,I,Nt),o[b>>2]=0,qe=y+f+((y|0)==6&1)|0,(qe|0)<=(f|0)){Ze=lr;return}W=o[I>>2]|0,Y=f+6|0,le=16960+(W<<2)|0,fe=mt+8|0,ye=st+8|0,Ie=ht+8|0,ke=Wt+4|0,R=0,V=f,y=-1;e:for(;;){if(I=(V|0)%6|0,u=Nt+(I<<4)|0,o[Wt>>2]=o[u>>2],o[Wt+4>>2]=o[u+4>>2],o[Wt+8>>2]=o[u+8>>2],o[Wt+12>>2]=o[u+12>>2],u=R,R=xa(Wt,W,0,1)|0,(V|0)>(f|0)&(ho(h)|0)!=0&&(u|0)!=1&&(o[Wt>>2]|0)!=(y|0)){switch(ar(Nt+(((I+5|0)%6|0)<<4)+4|0,Gt),ar(Nt+(I<<4)+4|0,ut),Hi=+(o[le>>2]|0),oe[mt>>3]=Hi*3,oe[fe>>3]=0,Zi=Hi*-1.5,oe[st>>3]=Zi,oe[ye>>3]=Hi*2.598076211353316,oe[ht>>3]=Zi,oe[Ie>>3]=Hi*-2.598076211353316,I=o[Ai>>2]|0,o[17040+(I*80|0)+(((y|0)==(I|0)?o[Wt>>2]|0:y)<<2)>>2]|0){case 1:{u=st,y=mt;break}case 3:{u=ht,y=st;break}case 2:{u=mt,y=ht;break}default:{u=8;break e}}nA(Gt,ut,y,u,ft),!(xl(Gt,ft)|0)&&!(xl(ut,ft)|0)&&(Gr(ft,o[Ai>>2]|0,W,1,b+8+(o[b>>2]<<4)|0),o[b>>2]=(o[b>>2]|0)+1)}if((V|0)<(Y|0)&&(ar(ke,Gt),Gr(Gt,o[Wt>>2]|0,W,1,b+8+(o[b>>2]<<4)|0),o[b>>2]=(o[b>>2]|0)+1),V=V+1|0,(V|0)>=(qe|0)){u=3;break}else y=o[Wt>>2]|0}if((u|0)==3){Ze=lr;return}else(u|0)==8&&Ar(22606,22569,736,22651)}function Va(u,h,f){u=u|0,h=h|0,f=f|0;var y=0,b=0,I=0,R=0,V=0,W=0;W=Ze,Ze=Ze+160|0,y=W+80|0,b=W,I=y,R=20368,V=I+72|0;do o[I>>2]=o[R>>2],I=I+4|0,R=R+4|0;while((I|0)<(V|0));I=b,R=20448,V=I+72|0;do o[I>>2]=o[R>>2],I=I+4|0,R=R+4|0;while((I|0)<(V|0));V=(ho(o[h>>2]|0)|0)==0,y=V?y:b,b=u+4|0,KA(b),fA(b),ho(o[h>>2]|0)|0&&(Os(b),o[h>>2]=(o[h>>2]|0)+1),o[f>>2]=o[u>>2],h=f+4|0,sn(b,y,h),ji(h),o[f+16>>2]=o[u>>2],h=f+20|0,sn(b,y+12|0,h),ji(h),o[f+32>>2]=o[u>>2],h=f+36|0,sn(b,y+24|0,h),ji(h),o[f+48>>2]=o[u>>2],h=f+52|0,sn(b,y+36|0,h),ji(h),o[f+64>>2]=o[u>>2],h=f+68|0,sn(b,y+48|0,h),ji(h),o[f+80>>2]=o[u>>2],f=f+84|0,sn(b,y+60|0,f),ji(f),Ze=W}function Tc(u,h){return u=u|0,h=h|0,h=Xe(u|0,h|0,52)|0,Je()|0,h&15|0}function tl(u,h){return u=u|0,h=h|0,h=Xe(u|0,h|0,45)|0,Je()|0,h&127|0}function pA(u,h){u=u|0,h=h|0;var f=0,y=0,b=0,I=0,R=0,V=0;if(!(!0&(h&-16777216|0)==134217728)||(R=Xe(u|0,h|0,45)|0,Je()|0,R=R&127,R>>>0>121))return h=0,h|0;f=Xe(u|0,h|0,52)|0,Je()|0,f=f&15;do if(f|0){for(b=1,y=0;;){if(I=Xe(u|0,h|0,(15-b|0)*3|0)|0,Je()|0,I=I&7,(I|0)!=0&(y^1))if((I|0)==1&(jn(R)|0)!=0){V=0,y=13;break}else y=1;if((I|0)==7){V=0,y=13;break}if(b>>>0<f>>>0)b=b+1|0;else{y=9;break}}if((y|0)==9){if((f|0)==15)V=1;else break;return V|0}else if((y|0)==13)return V|0}while(!1);for(;;){if(V=Xe(u|0,h|0,(14-f|0)*3|0)|0,Je()|0,!((V&7|0)==7&!0)){V=0,y=13;break}if(f>>>0<14)f=f+1|0;else{V=1,y=13;break}}return(y|0)==13?V|0:0}function zo(u,h,f,y){u=u|0,h=h|0,f=f|0,y=y|0;var b=0,I=0;if(I=Xe(u|0,h|0,52)|0,Je()|0,I=I&15,f>>>0>15)return y=4,y|0;if((I|0)<(f|0))return y=12,y|0;if((I|0)==(f|0))return o[y>>2]=u,o[y+4>>2]=h,y=0,y|0;if(b=tt(f|0,0,52)|0,b=b|u,u=Je()|0|h&-15728641,(I|0)>(f|0))do h=tt(7,0,(14-f|0)*3|0)|0,f=f+1|0,b=h|b,u=Je()|0|u;while((f|0)<(I|0));return o[y>>2]=b,o[y+4>>2]=u,y=0,y|0}function pl(u,h,f,y){u=u|0,h=h|0,f=f|0,y=y|0;var b=0,I=0,R=0;if(I=Xe(u|0,h|0,52)|0,Je()|0,I=I&15,!((f|0)<16&(I|0)<=(f|0)))return y=4,y|0;b=f-I|0,f=Xe(u|0,h|0,45)|0,Je()|0;e:do if(!(jn(f&127)|0))f=oa(7,0,b,((b|0)<0)<<31>>31)|0,b=Je()|0;else{t:do if(I|0){for(f=1;R=tt(7,0,(15-f|0)*3|0)|0,!!((R&u|0)==0&((Je()|0)&h|0)==0);)if(f>>>0<I>>>0)f=f+1|0;else break t;f=oa(7,0,b,((b|0)<0)<<31>>31)|0,b=Je()|0;break e}while(!1);f=oa(7,0,b,((b|0)<0)<<31>>31)|0,f=ue(f|0,Je()|0,5,0)|0,f=M(f|0,Je()|0,-5,-1)|0,f=Q(f|0,Je()|0,6,0)|0,f=M(f|0,Je()|0,1,0)|0,b=Je()|0}while(!1);return R=y,o[R>>2]=f,o[R+4>>2]=b,R=0,R|0}function Ln(u,h){u=u|0,h=h|0;var f=0,y=0,b=0;if(b=Xe(u|0,h|0,45)|0,Je()|0,!(jn(b&127)|0))return b=0,b|0;b=Xe(u|0,h|0,52)|0,Je()|0,b=b&15;e:do if(!b)f=0;else for(y=1;;){if(f=Xe(u|0,h|0,(15-y|0)*3|0)|0,Je()|0,f=f&7,f|0)break e;if(y>>>0<b>>>0)y=y+1|0;else{f=0;break}}while(!1);return b=(f|0)==0&1,b|0}function Ec(u,h,f,y){u=u|0,h=h|0,f=f|0,y=y|0;var b=0,I=0,R=0,V=0;if(R=Ze,Ze=Ze+16|0,I=R,Mt(I,u,h,f),h=I,u=o[h>>2]|0,h=o[h+4>>2]|0,(u|0)==0&(h|0)==0)return Ze=R,0;b=0,f=0;do V=y+(b<<3)|0,o[V>>2]=u,o[V+4>>2]=h,b=M(b|0,f|0,1,0)|0,f=Je()|0,ec(I),V=I,u=o[V>>2]|0,h=o[V+4>>2]|0;while(!((u|0)==0&(h|0)==0));return Ze=R,0}function mA(u,h,f,y){return u=u|0,h=h|0,f=f|0,y=y|0,(y|0)<(f|0)?(f=h,y=u,Di(f|0),y|0):(f=tt(-1,-1,((y-f|0)*3|0)+3|0)|0,y=tt(~f|0,~(Je()|0)|0,(15-y|0)*3|0)|0,f=~(Je()|0)&h,y=~y&u,Di(f|0),y|0)}function il(u,h,f,y){u=u|0,h=h|0,f=f|0,y=y|0;var b=0;return b=Xe(u|0,h|0,52)|0,Je()|0,b=b&15,(f|0)<16&(b|0)<=(f|0)?((b|0)<(f|0)&&(b=tt(-1,-1,((f+-1-b|0)*3|0)+3|0)|0,b=tt(~b|0,~(Je()|0)|0,(15-f|0)*3|0)|0,h=~(Je()|0)&h,u=~b&u),b=tt(f|0,0,52)|0,f=h&-15728641|(Je()|0),o[y>>2]=u|b,o[y+4>>2]=f,y=0,y|0):(y=4,y|0)}function Na(u,h,f,y){u=u|0,h=h|0,f=f|0,y=y|0;var b=0,I=0,R=0,V=0,W=0,Y=0,le=0,fe=0,ye=0,Ie=0,ke=0,qe=0,ut=0,mt=0,st=0,ht=0,ft=0,Ai=0,Nt=0,Wt=0,Gt=0;if((f|0)==0&(y|0)==0)return Wt=0,Wt|0;if(b=u,I=o[b>>2]|0,b=o[b+4>>2]|0,!0&(b&15728640|0)==0){if(!((y|0)>0|(y|0)==0&f>>>0>0)||(Wt=h,o[Wt>>2]=I,o[Wt+4>>2]=b,(f|0)==1&(y|0)==0))return Wt=0,Wt|0;b=1;do Ai=u+(b<<3)|0,Nt=o[Ai+4>>2]|0,Wt=h+(b<<3)|0,o[Wt>>2]=o[Ai>>2],o[Wt+4>>2]=Nt,b=b+1|0;while(0<(y|0)|(y|0)==0&b>>>0<f>>>0);return b=0,b|0}if(ft=f<<3,Nt=Zn(ft)|0,!Nt)return Wt=13,Wt|0;if(S(Nt|0,u|0,ft|0)|0,Ai=T(f,8)|0,!Ai)return x(Nt),Wt=13,Wt|0;e:do if(f|0){t:for(;;){b=Nt,mt=o[b>>2]|0,b=o[b+4>>2]|0,st=Xe(mt|0,b|0,52)|0,Je()|0,st=st&15,ht=st+-1|0,ut=(f|0)>0;i:do if((st|0)!=0&ut){if(Ie=((f|0)<0)<<31>>31,ke=tt(ht|0,0,52)|0,qe=Je()|0,ht>>>0>15){if(!((mt|0)==0&(b|0)==0)){Wt=17;break t}for(I=0;;){if(I=I+1|0,(I|0)>=(f|0))break i;if(y=Nt+(I<<3)|0,qe=o[y>>2]|0,y=o[y+4>>2]|0,!((qe|0)==0&(y|0)==0)){b=y,Wt=17;break t}}}for(I=0,u=mt,y=b;;){if(!((u|0)==0&(y|0)==0)){if(!(!0&(y&117440512|0)==0)){Wt=22;break t}if(V=Xe(u|0,y|0,52)|0,Je()|0,V=V&15,(V|0)<(ht|0)){b=12,Wt=28;break t}if((V|0)!=(ht|0)&&(u=u|ke,y=y&-15728641|qe,V>>>0>=st>>>0)){R=ht;do ye=tt(7,0,(14-R|0)*3|0)|0,R=R+1|0,u=ye|u,y=Je()|0|y;while(R>>>0<V>>>0)}if(R=De(u|0,y|0,f|0,Ie|0)|0,Je()|0,Y=Ai+(R<<3)|0,V=Y,W=o[V>>2]|0,V=o[V+4>>2]|0,(W|0)==0&(V|0)==0)R=Y;else for(ye=0;;){if((ye|0)>(f|0)){Wt=32;break t}if((W|0)==(u|0)&(V&-117440513|0)==(y|0)){le=Xe(W|0,V|0,56)|0,Je()|0,le=le&7,fe=le+1|0,Gt=Xe(W|0,V|0,45)|0,Je()|0;r:do if(!(jn(Gt&127)|0))V=7;else{if(W=Xe(W|0,V|0,52)|0,Je()|0,W=W&15,!W){V=6;break}for(V=1;;){if(Gt=tt(7,0,(15-V|0)*3|0)|0,!((Gt&u|0)==0&((Je()|0)&y|0)==0)){V=7;break r}if(V>>>0<W>>>0)V=V+1|0;else{V=6;break}}}while(!1);if((le+2|0)>>>0>V>>>0){Wt=42;break t}Gt=tt(fe|0,0,56)|0,y=Je()|0|y&-117440513,fe=Y,o[fe>>2]=0,o[fe+4>>2]=0,u=Gt|u}else R=(R+1|0)%(f|0)|0;if(Y=Ai+(R<<3)|0,V=Y,W=o[V>>2]|0,V=o[V+4>>2]|0,(W|0)==0&(V|0)==0){R=Y;break}else ye=ye+1|0}Gt=R,o[Gt>>2]=u,o[Gt+4>>2]=y}if(I=I+1|0,(I|0)>=(f|0))break i;y=Nt+(I<<3)|0,u=o[y>>2]|0,y=o[y+4>>2]|0}}while(!1);if((f+5|0)>>>0<11){Wt=85;break}if(qe=T((f|0)/6|0,8)|0,!qe){Wt=49;break}i:do if(ut){ye=0,fe=0;do{if(V=Ai+(ye<<3)|0,y=V,I=o[y>>2]|0,y=o[y+4>>2]|0,!((I|0)==0&(y|0)==0)){W=Xe(I|0,y|0,56)|0,Je()|0,W=W&7,u=W+1|0,Y=y&-117440513,Gt=Xe(I|0,y|0,45)|0,Je()|0;r:do if(jn(Gt&127)|0){if(le=Xe(I|0,y|0,52)|0,Je()|0,le=le&15,le|0)for(R=1;;){if(Gt=tt(7,0,(15-R|0)*3|0)|0,!((I&Gt|0)==0&(Y&(Je()|0)|0)==0))break r;if(R>>>0<le>>>0)R=R+1|0;else break}y=tt(u|0,0,56)|0,I=y|I,y=Je()|0|Y,u=V,o[u>>2]=I,o[u+4>>2]=y,u=W+2|0}while(!1);(u|0)==7&&(Gt=qe+(fe<<3)|0,o[Gt>>2]=I,o[Gt+4>>2]=y&-117440513,fe=fe+1|0)}ye=ye+1|0}while((ye|0)!=(f|0));if(ut){if(ye=((f|0)<0)<<31>>31,Ie=tt(ht|0,0,52)|0,ke=Je()|0,ht>>>0>15){if(!((mt|0)==0&(b|0)==0)){b=4,Wt=84;break t}for(b=0;;){if(b=b+1|0,(b|0)>=(f|0)){I=0,b=fe;break i}if(Gt=Nt+(b<<3)|0,!((o[Gt>>2]|0)==0&(o[Gt+4>>2]|0)==0)){b=4,Wt=84;break t}}}for(le=0,I=0,Y=mt;;){do if(!((Y|0)==0&(b|0)==0)){if(V=Xe(Y|0,b|0,52)|0,Je()|0,V=V&15,(V|0)<(ht|0)){b=12,Wt=84;break t}do if((V|0)==(ht|0))y=Y,V=b;else{if(y=Y|Ie,u=b&-15728641|ke,V>>>0<st>>>0){V=u;break}R=ht;do Gt=tt(7,0,(14-R|0)*3|0)|0,R=R+1|0,y=Gt|y,u=Je()|0|u;while(R>>>0<V>>>0);V=u}while(!1);for(R=De(y|0,V|0,f|0,ye|0)|0,Je()|0,u=0;;){if((u|0)>(f|0)){Wt=77;break t}if(Gt=Ai+(R<<3)|0,W=o[Gt+4>>2]|0,(W&-117440513|0)==(V|0)&&(o[Gt>>2]|0)==(y|0)){Wt=79;break}if(R=(R+1|0)%(f|0)|0,Gt=Ai+(R<<3)|0,(o[Gt>>2]|0)==(y|0)&&(o[Gt+4>>2]|0)==(V|0))break;u=u+1|0}if((Wt|0)==79&&(Wt=0,!0&(W&117440512|0)==100663296))break;Gt=h+(I<<3)|0,o[Gt>>2]=Y,o[Gt+4>>2]=b,I=I+1|0}while(!1);if(b=le+1|0,(b|0)>=(f|0)){b=fe;break i}Gt=Nt+(b<<3)|0,le=b,Y=o[Gt>>2]|0,b=o[Gt+4>>2]|0}}else I=0,b=fe}else I=0,b=0;while(!1);if(k(Ai|0,0,ft|0)|0,S(Nt|0,qe|0,b<<3|0)|0,x(qe),b)h=h+(I<<3)|0,f=b;else break e}if((Wt|0)==17)!0&(b&117440512|0)==0?(b=4,Wt=28):Wt=22;else if((Wt|0)==32)Ar(23313,22674,362,22684);else{if((Wt|0)==42)return x(Nt),x(Ai),Gt=10,Gt|0;if((Wt|0)==49)return x(Nt),x(Ai),Gt=13,Gt|0;if((Wt|0)==77)Ar(23313,22674,462,22684);else{if((Wt|0)==84)return x(qe),x(Nt),x(Ai),Gt=b,Gt|0;if((Wt|0)==85){S(h|0,Nt|0,f<<3|0)|0;break}}}if((Wt|0)==22)return x(Nt),x(Ai),Gt=5,Gt|0;if((Wt|0)==28)return x(Nt),x(Ai),Gt=b,Gt|0}while(!1);return x(Nt),x(Ai),Gt=0,Gt|0}function xu(u,h,f,y,b,I,R){u=u|0,h=h|0,f=f|0,y=y|0,b=b|0,I=I|0,R=R|0;var V=0,W=0,Y=0,le=0,fe=0,ye=0,Ie=0,ke=0,qe=0;if(qe=Ze,Ze=Ze+16|0,ke=qe,!((f|0)>0|(f|0)==0&h>>>0>0))return ke=0,Ze=qe,ke|0;if((R|0)>=16)return ke=12,Ze=qe,ke|0;ye=0,Ie=0,fe=0,V=0;e:for(;;){if(Y=u+(ye<<3)|0,W=o[Y>>2]|0,Y=o[Y+4>>2]|0,le=Xe(W|0,Y|0,52)|0,Je()|0,(le&15|0)>(R|0)){V=12,W=11;break}if(Mt(ke,W,Y,R),le=ke,Y=o[le>>2]|0,le=o[le+4>>2]|0,(Y|0)==0&(le|0)==0)W=fe;else{W=fe;do{if(!((V|0)<(I|0)|(V|0)==(I|0)&W>>>0<b>>>0)){W=10;break e}fe=y+(W<<3)|0,o[fe>>2]=Y,o[fe+4>>2]=le,W=M(W|0,V|0,1,0)|0,V=Je()|0,ec(ke),fe=ke,Y=o[fe>>2]|0,le=o[fe+4>>2]|0}while(!((Y|0)==0&(le|0)==0))}if(ye=M(ye|0,Ie|0,1,0)|0,Ie=Je()|0,(Ie|0)<(f|0)|(Ie|0)==(f|0)&ye>>>0<h>>>0)fe=W;else{V=0,W=11;break}}return(W|0)==10?(ke=14,Ze=qe,ke|0):(W|0)==11?(Ze=qe,V|0):0}function Ps(u,h,f,y,b){u=u|0,h=h|0,f=f|0,y=y|0,b=b|0;var I=0,R=0,V=0,W=0,Y=0,le=0,fe=0,ye=0;ye=Ze,Ze=Ze+16|0,fe=ye;e:do if((f|0)>0|(f|0)==0&h>>>0>0){for(Y=0,R=0,I=0,le=0;;){if(W=u+(Y<<3)|0,V=o[W>>2]|0,W=o[W+4>>2]|0,!((V|0)==0&(W|0)==0)&&(W=(pl(V,W,y,fe)|0)==0,V=fe,R=M(o[V>>2]|0,o[V+4>>2]|0,R|0,I|0)|0,I=Je()|0,!W)){I=12;break}if(Y=M(Y|0,le|0,1,0)|0,le=Je()|0,!((le|0)<(f|0)|(le|0)==(f|0)&Y>>>0<h>>>0))break e}return Ze=ye,I|0}else R=0,I=0;while(!1);return o[b>>2]=R,o[b+4>>2]=I,b=0,Ze=ye,b|0}function Ns(u,h){return u=u|0,h=h|0,h=Xe(u|0,h|0,52)|0,Je()|0,h&1|0}function oo(u,h){u=u|0,h=h|0;var f=0,y=0,b=0;if(b=Xe(u|0,h|0,52)|0,Je()|0,b=b&15,!b)return b=0,b|0;for(y=1;;){if(f=Xe(u|0,h|0,(15-y|0)*3|0)|0,Je()|0,f=f&7,f|0){y=5;break}if(y>>>0<b>>>0)y=y+1|0;else{f=0,y=5;break}}return(y|0)==5?f|0:0}function na(u,h){u=u|0,h=h|0;var f=0,y=0,b=0,I=0,R=0,V=0,W=0;if(W=Xe(u|0,h|0,52)|0,Je()|0,W=W&15,!W)return V=h,W=u,Di(V|0),W|0;for(V=1,f=0;;){I=(15-V|0)*3|0,y=tt(7,0,I|0)|0,b=Je()|0,R=Xe(u|0,h|0,I|0)|0,Je()|0,I=tt(el(R&7)|0,0,I|0)|0,R=Je()|0,u=I|u&~y,h=R|h&~b;e:do if(!f)if((I&y|0)==0&(R&b|0)==0)f=0;else if(y=Xe(u|0,h|0,52)|0,Je()|0,y=y&15,!y)f=1;else{f=1;t:for(;;){switch(R=Xe(u|0,h|0,(15-f|0)*3|0)|0,Je()|0,R&7){case 1:break t;case 0:break;default:{f=1;break e}}if(f>>>0<y>>>0)f=f+1|0;else{f=1;break e}}for(f=1;;)if(R=(15-f|0)*3|0,b=Xe(u|0,h|0,R|0)|0,Je()|0,I=tt(7,0,R|0)|0,h=h&~(Je()|0),R=tt(el(b&7)|0,0,R|0)|0,u=u&~I|R,h=h|(Je()|0),f>>>0<y>>>0)f=f+1|0;else{f=1;break}}while(!1);if(V>>>0<W>>>0)V=V+1|0;else break}return Di(h|0),u|0}function ml(u,h){u=u|0,h=h|0;var f=0,y=0,b=0,I=0,R=0;if(y=Xe(u|0,h|0,52)|0,Je()|0,y=y&15,!y)return f=h,y=u,Di(f|0),y|0;for(f=1;I=(15-f|0)*3|0,R=Xe(u|0,h|0,I|0)|0,Je()|0,b=tt(7,0,I|0)|0,h=h&~(Je()|0),I=tt(el(R&7)|0,0,I|0)|0,u=I|u&~b,h=Je()|0|h,f>>>0<y>>>0;)f=f+1|0;return Di(h|0),u|0}function Kc(u,h){u=u|0,h=h|0;var f=0,y=0,b=0,I=0,R=0,V=0,W=0;if(W=Xe(u|0,h|0,52)|0,Je()|0,W=W&15,!W)return V=h,W=u,Di(V|0),W|0;for(V=1,f=0;;){I=(15-V|0)*3|0,y=tt(7,0,I|0)|0,b=Je()|0,R=Xe(u|0,h|0,I|0)|0,Je()|0,I=tt(Fa(R&7)|0,0,I|0)|0,R=Je()|0,u=I|u&~y,h=R|h&~b;e:do if(!f)if((I&y|0)==0&(R&b|0)==0)f=0;else if(y=Xe(u|0,h|0,52)|0,Je()|0,y=y&15,!y)f=1;else{f=1;t:for(;;){switch(R=Xe(u|0,h|0,(15-f|0)*3|0)|0,Je()|0,R&7){case 1:break t;case 0:break;default:{f=1;break e}}if(f>>>0<y>>>0)f=f+1|0;else{f=1;break e}}for(f=1;;)if(b=(15-f|0)*3|0,I=tt(7,0,b|0)|0,R=h&~(Je()|0),h=Xe(u|0,h|0,b|0)|0,Je()|0,h=tt(Fa(h&7)|0,0,b|0)|0,u=u&~I|h,h=R|(Je()|0),f>>>0<y>>>0)f=f+1|0;else{f=1;break}}while(!1);if(V>>>0<W>>>0)V=V+1|0;else break}return Di(h|0),u|0}function JA(u,h){u=u|0,h=h|0;var f=0,y=0,b=0,I=0,R=0;if(y=Xe(u|0,h|0,52)|0,Je()|0,y=y&15,!y)return f=h,y=u,Di(f|0),y|0;for(f=1;R=(15-f|0)*3|0,I=tt(7,0,R|0)|0,b=h&~(Je()|0),h=Xe(u|0,h|0,R|0)|0,Je()|0,h=tt(Fa(h&7)|0,0,R|0)|0,u=h|u&~I,h=Je()|0|b,f>>>0<y>>>0;)f=f+1|0;return Di(h|0),u|0}function Ws(u,h){u=u|0,h=h|0;var f=0,y=0,b=0,I=0,R=0,V=0,W=0,Y=0,le=0;if(W=Ze,Ze=Ze+64|0,V=W+40|0,y=W+24|0,b=W+12|0,I=W,tt(h|0,0,52)|0,f=Je()|0|134225919,!h)return(o[u+4>>2]|0)>2||(o[u+8>>2]|0)>2||(o[u+12>>2]|0)>2?(R=0,V=0,Di(R|0),Ze=W,V|0):(tt(ei(u)|0,0,45)|0,R=Je()|0|f,V=-1,Di(R|0),Ze=W,V|0);if(o[V>>2]=o[u>>2],o[V+4>>2]=o[u+4>>2],o[V+8>>2]=o[u+8>>2],o[V+12>>2]=o[u+12>>2],R=V+4|0,(h|0)>0)for(u=-1;o[y>>2]=o[R>>2],o[y+4>>2]=o[R+4>>2],o[y+8>>2]=o[R+8>>2],h&1?(no(R),o[b>>2]=o[R>>2],o[b+4>>2]=o[R+4>>2],o[b+8>>2]=o[R+8>>2],fl(b)):(Xn(R),o[b>>2]=o[R>>2],o[b+4>>2]=o[R+4>>2],o[b+8>>2]=o[R+8>>2],Os(b)),ia(y,b,I),ji(I),le=(15-h|0)*3|0,Y=tt(7,0,le|0)|0,f=f&~(Je()|0),le=tt(ma(I)|0,0,le|0)|0,u=le|u&~Y,f=Je()|0|f,(h|0)>1;)h=h+-1|0;else u=-1;e:do if((o[R>>2]|0)<=2&&(o[V+8>>2]|0)<=2&&(o[V+12>>2]|0)<=2){if(y=ei(V)|0,h=tt(y|0,0,45)|0,h=h|u,u=Je()|0|f&-1040385,I=ir(V)|0,!(jn(y)|0)){if((I|0)<=0)break;for(b=0;;){if(y=Xe(h|0,u|0,52)|0,Je()|0,y=y&15,y)for(f=1;le=(15-f|0)*3|0,V=Xe(h|0,u|0,le|0)|0,Je()|0,Y=tt(7,0,le|0)|0,u=u&~(Je()|0),le=tt(el(V&7)|0,0,le|0)|0,h=h&~Y|le,u=u|(Je()|0),f>>>0<y>>>0;)f=f+1|0;if(b=b+1|0,(b|0)==(I|0))break e}}b=Xe(h|0,u|0,52)|0,Je()|0,b=b&15;t:do if(b){f=1;i:for(;;){switch(le=Xe(h|0,u|0,(15-f|0)*3|0)|0,Je()|0,le&7){case 1:break i;case 0:break;default:break t}if(f>>>0<b>>>0)f=f+1|0;else break t}if(vi(y,o[V>>2]|0)|0)for(f=1;V=(15-f|0)*3|0,Y=tt(7,0,V|0)|0,le=u&~(Je()|0),u=Xe(h|0,u|0,V|0)|0,Je()|0,u=tt(Fa(u&7)|0,0,V|0)|0,h=h&~Y|u,u=le|(Je()|0),f>>>0<b>>>0;)f=f+1|0;else for(f=1;le=(15-f|0)*3|0,V=Xe(h|0,u|0,le|0)|0,Je()|0,Y=tt(7,0,le|0)|0,u=u&~(Je()|0),le=tt(el(V&7)|0,0,le|0)|0,h=h&~Y|le,u=u|(Je()|0),f>>>0<b>>>0;)f=f+1|0}while(!1);if((I|0)>0){f=0;do h=na(h,u)|0,u=Je()|0,f=f+1|0;while((f|0)!=(I|0))}}else h=0,u=0;while(!1);return Y=u,le=h,Di(Y|0),Ze=W,le|0}function ho(u){return u=u|0,(u|0)%2|0|0}function $o(u,h,f){u=u|0,h=h|0,f=f|0;var y=0,b=0;return b=Ze,Ze=Ze+16|0,y=b,h>>>0>15?(y=4,Ze=b,y|0):(o[u+4>>2]&2146435072|0)==2146435072||(o[u+8+4>>2]&2146435072|0)==2146435072?(y=3,Ze=b,y|0):(cs(u,h,y),h=Ws(y,h)|0,y=Je()|0,o[f>>2]=h,o[f+4>>2]=y,(h|0)==0&(y|0)==0&&Ar(23313,22674,786,22697),y=0,Ze=b,y|0)}function LA(u,h,f){u=u|0,h=h|0,f=f|0;var y=0,b=0,I=0,R=0;if(b=f+4|0,I=Xe(u|0,h|0,52)|0,Je()|0,I=I&15,R=Xe(u|0,h|0,45)|0,Je()|0,y=(I|0)==0,jn(R&127)|0){if(y)return R=1,R|0;y=1}else{if(y)return R=0,R|0;!(o[b>>2]|0)&&!(o[f+8>>2]|0)?y=(o[f+12>>2]|0)!=0&1:y=1}for(f=1;f&1?fl(b):Os(b),R=Xe(u|0,h|0,(15-f|0)*3|0)|0,Je()|0,_a(b,R&7),f>>>0<I>>>0;)f=f+1|0;return y|0}function Pn(u,h,f){u=u|0,h=h|0,f=f|0;var y=0,b=0,I=0,R=0,V=0,W=0,Y=0,le=0;if(le=Ze,Ze=Ze+16|0,W=le,Y=Xe(u|0,h|0,45)|0,Je()|0,Y=Y&127,Y>>>0>121)return o[f>>2]=0,o[f+4>>2]=0,o[f+8>>2]=0,o[f+12>>2]=0,Y=5,Ze=le,Y|0;e:do if(jn(Y)|0&&(I=Xe(u|0,h|0,52)|0,Je()|0,I=I&15,(I|0)!=0)){y=1;t:for(;;){switch(V=Xe(u|0,h|0,(15-y|0)*3|0)|0,Je()|0,V&7){case 5:break t;case 0:break;default:{y=h;break e}}if(y>>>0<I>>>0)y=y+1|0;else{y=h;break e}}for(b=1,y=h;h=(15-b|0)*3|0,R=tt(7,0,h|0)|0,V=y&~(Je()|0),y=Xe(u|0,y|0,h|0)|0,Je()|0,y=tt(Fa(y&7)|0,0,h|0)|0,u=u&~R|y,y=V|(Je()|0),b>>>0<I>>>0;)b=b+1|0}else y=h;while(!1);if(V=7696+(Y*28|0)|0,o[f>>2]=o[V>>2],o[f+4>>2]=o[V+4>>2],o[f+8>>2]=o[V+8>>2],o[f+12>>2]=o[V+12>>2],!(LA(u,y,f)|0))return Y=0,Ze=le,Y|0;if(R=f+4|0,o[W>>2]=o[R>>2],o[W+4>>2]=o[R+4>>2],o[W+8>>2]=o[R+8>>2],I=Xe(u|0,y|0,52)|0,Je()|0,V=I&15,I&1?(Os(R),I=V+1|0):I=V,!(jn(Y)|0))y=0;else{e:do if(!V)y=0;else for(h=1;;){if(b=Xe(u|0,y|0,(15-h|0)*3|0)|0,Je()|0,b=b&7,b|0){y=b;break e}if(h>>>0<V>>>0)h=h+1|0;else{y=0;break}}while(!1);y=(y|0)==4&1}if(!(xa(f,I,y,0)|0))(I|0)!=(V|0)&&(o[R>>2]=o[W>>2],o[R+4>>2]=o[W+4>>2],o[R+8>>2]=o[W+8>>2]);else{if(jn(Y)|0)do;while(xa(f,I,0,0)|0);(I|0)!=(V|0)&&Xn(R)}return Y=0,Ze=le,Y|0}function va(u,h,f){u=u|0,h=h|0,f=f|0;var y=0,b=0,I=0;return I=Ze,Ze=Ze+16|0,y=I,b=Pn(u,h,y)|0,b|0?(Ze=I,b|0):(b=Xe(u|0,h|0,52)|0,Je()|0,Yn(y,b&15,f),b=0,Ze=I,b|0)}function Rn(u,h,f){u=u|0,h=h|0,f=f|0;var y=0,b=0,I=0,R=0,V=0;if(R=Ze,Ze=Ze+16|0,I=R,y=Pn(u,h,I)|0,y|0)return I=y,Ze=R,I|0;y=Xe(u|0,h|0,45)|0,Je()|0,y=(jn(y&127)|0)==0,b=Xe(u|0,h|0,52)|0,Je()|0,b=b&15;e:do if(!y){if(b|0)for(y=1;;){if(V=tt(7,0,(15-y|0)*3|0)|0,!((V&u|0)==0&((Je()|0)&h|0)==0))break e;if(y>>>0<b>>>0)y=y+1|0;else break}return eA(I,b,0,5,f),V=0,Ze=R,V|0}while(!1);return Tn(I,b,0,6,f),V=0,Ze=R,V|0}function Ua(u,h,f){u=u|0,h=h|0,f=f|0;var y=0,b=0,I=0;if(b=Xe(u|0,h|0,45)|0,Je()|0,!(jn(b&127)|0))return b=2,o[f>>2]=b,0;if(b=Xe(u|0,h|0,52)|0,Je()|0,b=b&15,!b)return b=5,o[f>>2]=b,0;for(y=1;;){if(I=tt(7,0,(15-y|0)*3|0)|0,!((I&u|0)==0&((Je()|0)&h|0)==0)){y=2,u=6;break}if(y>>>0<b>>>0)y=y+1|0;else{y=5,u=6;break}}return(u|0)==6&&(o[f>>2]=y),0}function rl(u,h,f){u=u|0,h=h|0,f=f|0;var y=0,b=0,I=0,R=0,V=0,W=0,Y=0,le=0,fe=0;fe=Ze,Ze=Ze+128|0,Y=fe+112|0,I=fe+96|0,le=fe,b=Xe(u|0,h|0,52)|0,Je()|0,V=b&15,o[Y>>2]=V,R=Xe(u|0,h|0,45)|0,Je()|0,R=R&127;e:do if(jn(R)|0){if(V|0)for(y=1;;){if(W=tt(7,0,(15-y|0)*3|0)|0,!((W&u|0)==0&((Je()|0)&h|0)==0)){b=0;break e}if(y>>>0<V>>>0)y=y+1|0;else break}if(b&1)b=1;else return W=tt(V+1|0,0,52)|0,le=Je()|0|h&-15728641,Y=tt(7,0,(14-V|0)*3|0)|0,le=rl((W|u)&~Y,le&~(Je()|0),f)|0,Ze=fe,le|0}else b=0;while(!1);if(y=Pn(u,h,I)|0,!y){b?(Gi(I,Y,le),W=5):(Va(I,Y,le),W=6);e:do if(jn(R)|0)if(!V)u=5;else for(y=1;;){if(R=tt(7,0,(15-y|0)*3|0)|0,!((R&u|0)==0&((Je()|0)&h|0)==0)){u=2;break e}if(y>>>0<V>>>0)y=y+1|0;else{u=5;break}}else u=2;while(!1);k(f|0,-1,u<<2|0)|0;e:do if(b)for(I=0;;){if(R=le+(I<<4)|0,ns(R,o[Y>>2]|0)|0,R=o[R>>2]|0,V=o[f>>2]|0,(V|0)==-1|(V|0)==(R|0))y=f;else{b=0;do{if(b=b+1|0,b>>>0>=u>>>0){y=1;break e}y=f+(b<<2)|0,V=o[y>>2]|0}while(!((V|0)==-1|(V|0)==(R|0)))}if(o[y>>2]=R,I=I+1|0,I>>>0>=W>>>0){y=0;break}}else for(I=0;;){if(R=le+(I<<4)|0,xa(R,o[Y>>2]|0,0,1)|0,R=o[R>>2]|0,V=o[f>>2]|0,(V|0)==-1|(V|0)==(R|0))y=f;else{b=0;do{if(b=b+1|0,b>>>0>=u>>>0){y=1;break e}y=f+(b<<2)|0,V=o[y>>2]|0}while(!((V|0)==-1|(V|0)==(R|0)))}if(o[y>>2]=R,I=I+1|0,I>>>0>=W>>>0){y=0;break}}while(!1)}return le=y,Ze=fe,le|0}function _l(){return 12}function fo(u,h){u=u|0,h=h|0;var f=0,y=0,b=0,I=0,R=0,V=0,W=0;if(u>>>0>15)return V=4,V|0;if(tt(u|0,0,52)|0,V=Je()|0|134225919,!u){f=0,y=0;do jn(y)|0&&(tt(y|0,0,45)|0,R=V|(Je()|0),u=h+(f<<3)|0,o[u>>2]=-1,o[u+4>>2]=R,f=f+1|0),y=y+1|0;while((y|0)!=122);return f=0,f|0}f=0,R=0;do{if(jn(R)|0){for(tt(R|0,0,45)|0,y=1,b=-1,I=V|(Je()|0);W=tt(7,0,(15-y|0)*3|0)|0,b=b&~W,I=I&~(Je()|0),(y|0)!=(u|0);)y=y+1|0;W=h+(f<<3)|0,o[W>>2]=b,o[W+4>>2]=I,f=f+1|0}R=R+1|0}while((R|0)!=122);return f=0,f|0}function ba(u,h,f,y){u=u|0,h=h|0,f=f|0,y=y|0;var b=0,I=0,R=0,V=0,W=0,Y=0,le=0,fe=0,ye=0,Ie=0,ke=0,qe=0,ut=0,mt=0,st=0;if(st=Ze,Ze=Ze+16|0,ut=st,mt=Xe(u|0,h|0,52)|0,Je()|0,mt=mt&15,f>>>0>15)return mt=4,Ze=st,mt|0;if((mt|0)<(f|0))return mt=12,Ze=st,mt|0;if((mt|0)!=(f|0))if(I=tt(f|0,0,52)|0,I=I|u,V=Je()|0|h&-15728641,(mt|0)>(f|0)){W=f;do qe=tt(7,0,(14-W|0)*3|0)|0,W=W+1|0,I=qe|I,V=Je()|0|V;while((W|0)<(mt|0));qe=I}else qe=I;else qe=u,V=h;ke=Xe(qe|0,V|0,45)|0,Je()|0;e:do if(jn(ke&127)|0){if(W=Xe(qe|0,V|0,52)|0,Je()|0,W=W&15,W|0)for(I=1;;){if(ke=tt(7,0,(15-I|0)*3|0)|0,!((ke&qe|0)==0&((Je()|0)&V|0)==0)){Y=33;break e}if(I>>>0<W>>>0)I=I+1|0;else break}if(ke=y,o[ke>>2]=0,o[ke+4>>2]=0,(mt|0)>(f|0)){for(ke=h&-15728641,Ie=mt;;){if(ye=Ie,Ie=Ie+-1|0,Ie>>>0>15|(mt|0)<(Ie|0)){Y=19;break}if((mt|0)!=(Ie|0))if(I=tt(Ie|0,0,52)|0,I=I|u,W=Je()|0|ke,(mt|0)<(ye|0))fe=I;else{Y=Ie;do fe=tt(7,0,(14-Y|0)*3|0)|0,Y=Y+1|0,I=fe|I,W=Je()|0|W;while((Y|0)<(mt|0));fe=I}else fe=u,W=h;if(le=Xe(fe|0,W|0,45)|0,Je()|0,!(jn(le&127)|0))I=0;else{le=Xe(fe|0,W|0,52)|0,Je()|0,le=le&15;t:do if(!le)I=0;else for(Y=1;;){if(I=Xe(fe|0,W|0,(15-Y|0)*3|0)|0,Je()|0,I=I&7,I|0)break t;if(Y>>>0<le>>>0)Y=Y+1|0;else{I=0;break}}while(!1);I=(I|0)==0&1}if(W=Xe(u|0,h|0,(15-ye|0)*3|0)|0,Je()|0,W=W&7,(W|0)==7){b=5,Y=42;break}if(I=(I|0)!=0,(W|0)==1&I){b=5,Y=42;break}if(fe=W+(((W|0)!=0&I)<<31>>31)|0,fe|0&&(Y=mt-ye|0,Y=oa(7,0,Y,((Y|0)<0)<<31>>31)|0,le=Je()|0,I?(I=ue(Y|0,le|0,5,0)|0,I=M(I|0,Je()|0,-5,-1)|0,I=Q(I|0,Je()|0,6,0)|0,I=M(I|0,Je()|0,1,0)|0,W=Je()|0):(I=Y,W=le),ye=fe+-1|0,ye=ue(Y|0,le|0,ye|0,((ye|0)<0)<<31>>31|0)|0,ye=M(I|0,W|0,ye|0,Je()|0)|0,fe=Je()|0,le=y,le=M(ye|0,fe|0,o[le>>2]|0,o[le+4>>2]|0)|0,fe=Je()|0,ye=y,o[ye>>2]=le,o[ye+4>>2]=fe),(Ie|0)<=(f|0)){Y=37;break}}if((Y|0)==19)Ar(23313,22674,1099,22710);else if((Y|0)==37){R=y,b=o[R+4>>2]|0,R=o[R>>2]|0;break}else if((Y|0)==42)return Ze=st,b|0}else b=0,R=0}else Y=33;while(!1);e:do if((Y|0)==33)if(ke=y,o[ke>>2]=0,o[ke+4>>2]=0,(mt|0)>(f|0)){for(I=mt;;){if(b=Xe(u|0,h|0,(15-I|0)*3|0)|0,Je()|0,b=b&7,(b|0)==7){b=5;break}if(R=mt-I|0,R=oa(7,0,R,((R|0)<0)<<31>>31)|0,b=ue(R|0,Je()|0,b|0,0)|0,R=Je()|0,ke=y,R=M(o[ke>>2]|0,o[ke+4>>2]|0,b|0,R|0)|0,b=Je()|0,ke=y,o[ke>>2]=R,o[ke+4>>2]=b,I=I+-1|0,(I|0)<=(f|0))break e}return Ze=st,b|0}else b=0,R=0;while(!1);return pl(qe,V,mt,ut)|0&&Ar(23313,22674,1063,22725),mt=ut,ut=o[mt+4>>2]|0,((b|0)>-1|(b|0)==-1&R>>>0>4294967295)&((ut|0)>(b|0)|((ut|0)==(b|0)?(o[mt>>2]|0)>>>0>R>>>0:0))?(mt=0,Ze=st,mt|0):(Ar(23313,22674,1139,22710),0)}function Fl(u,h,f,y,b,I){u=u|0,h=h|0,f=f|0,y=y|0,b=b|0,I=I|0;var R=0,V=0,W=0,Y=0,le=0,fe=0,ye=0,Ie=0,ke=0,qe=0;if(fe=Ze,Ze=Ze+16|0,R=fe,b>>>0>15)return I=4,Ze=fe,I|0;if(V=Xe(f|0,y|0,52)|0,Je()|0,V=V&15,(V|0)>(b|0))return I=12,Ze=fe,I|0;if(pl(f,y,b,R)|0&&Ar(23313,22674,1063,22725),le=R,Y=o[le+4>>2]|0,!(((h|0)>-1|(h|0)==-1&u>>>0>4294967295)&((Y|0)>(h|0)|((Y|0)==(h|0)?(o[le>>2]|0)>>>0>u>>>0:0))))return I=2,Ze=fe,I|0;le=b-V|0,b=tt(b|0,0,52)|0,W=Je()|0|y&-15728641,Y=I,o[Y>>2]=b|f,o[Y+4>>2]=W,Y=Xe(f|0,y|0,45)|0,Je()|0;e:do if(jn(Y&127)|0){if(V|0)for(R=1;;){if(Y=tt(7,0,(15-R|0)*3|0)|0,!((Y&f|0)==0&((Je()|0)&y|0)==0))break e;if(R>>>0<V>>>0)R=R+1|0;else break}if((le|0)<1)return I=0,Ze=fe,I|0;for(Y=V^15,y=-1,W=1,R=1;;){V=le-W|0,V=oa(7,0,V,((V|0)<0)<<31>>31)|0,f=Je()|0;do if(R)if(R=ue(V|0,f|0,5,0)|0,R=M(R|0,Je()|0,-5,-1)|0,R=Q(R|0,Je()|0,6,0)|0,b=Je()|0,(h|0)>(b|0)|(h|0)==(b|0)&u>>>0>R>>>0){h=M(u|0,h|0,-1,-1)|0,h=L(h|0,Je()|0,R|0,b|0)|0,R=Je()|0,ye=I,ke=o[ye>>2]|0,ye=o[ye+4>>2]|0,qe=(Y+y|0)*3|0,Ie=tt(7,0,qe|0)|0,ye=ye&~(Je()|0),y=Q(h|0,R|0,V|0,f|0)|0,u=Je()|0,b=M(y|0,u|0,2,0)|0,qe=tt(b|0,Je()|0,qe|0)|0,ye=Je()|0|ye,b=I,o[b>>2]=qe|ke&~Ie,o[b+4>>2]=ye,u=ue(y|0,u|0,V|0,f|0)|0,u=L(h|0,R|0,u|0,Je()|0)|0,R=0,h=Je()|0;break}else{qe=I,Ie=o[qe>>2]|0,qe=o[qe+4>>2]|0,ke=tt(7,0,(Y+y|0)*3|0)|0,qe=qe&~(Je()|0),R=I,o[R>>2]=Ie&~ke,o[R+4>>2]=qe,R=1;break}else Ie=I,b=o[Ie>>2]|0,Ie=o[Ie+4>>2]|0,y=(Y+y|0)*3|0,ye=tt(7,0,y|0)|0,Ie=Ie&~(Je()|0),qe=Q(u|0,h|0,V|0,f|0)|0,R=Je()|0,y=tt(qe|0,R|0,y|0)|0,Ie=Je()|0|Ie,ke=I,o[ke>>2]=y|b&~ye,o[ke+4>>2]=Ie,R=ue(qe|0,R|0,V|0,f|0)|0,u=L(u|0,h|0,R|0,Je()|0)|0,R=0,h=Je()|0;while(!1);if((le|0)>(W|0))y=~W,W=W+1|0;else{h=0;break}}return Ze=fe,h|0}while(!1);if((le|0)<1)return qe=0,Ze=fe,qe|0;for(b=V^15,R=1;;)if(ke=le-R|0,ke=oa(7,0,ke,((ke|0)<0)<<31>>31)|0,qe=Je()|0,W=I,f=o[W>>2]|0,W=o[W+4>>2]|0,V=(b-R|0)*3|0,y=tt(7,0,V|0)|0,W=W&~(Je()|0),ye=Q(u|0,h|0,ke|0,qe|0)|0,Ie=Je()|0,V=tt(ye|0,Ie|0,V|0)|0,W=Je()|0|W,Y=I,o[Y>>2]=V|f&~y,o[Y+4>>2]=W,qe=ue(ye|0,Ie|0,ke|0,qe|0)|0,u=L(u|0,h|0,qe|0,Je()|0)|0,h=Je()|0,(le|0)<=(R|0)){h=0;break}else R=R+1|0;return Ze=fe,h|0}function Mt(u,h,f,y){u=u|0,h=h|0,f=f|0,y=y|0;var b=0,I=0;b=Xe(h|0,f|0,52)|0,Je()|0,b=b&15,(h|0)==0&(f|0)==0|((y|0)>15|(b|0)>(y|0))?(y=-1,b=-1,h=0,f=0):(I=mA(h,f,b+1|0,y)|0,f=(Je()|0)&-15728641,h=tt(y|0,0,52)|0,h=I|h,f=f|(Je()|0),I=(Ln(h,f)|0)==0,y=I?-1:y),I=u,o[I>>2]=h,o[I+4>>2]=f,o[u+8>>2]=b,o[u+12>>2]=y}function ec(u){u=u|0;var h=0,f=0,y=0,b=0,I=0,R=0,V=0,W=0,Y=0;if(f=u,h=o[f>>2]|0,f=o[f+4>>2]|0,!((h|0)==0&(f|0)==0)&&(y=Xe(h|0,f|0,52)|0,Je()|0,y=y&15,V=tt(1,0,(y^15)*3|0)|0,h=M(V|0,Je()|0,h|0,f|0)|0,f=Je()|0,V=u,o[V>>2]=h,o[V+4>>2]=f,V=u+8|0,R=o[V>>2]|0,!((y|0)<(R|0)))){for(W=u+12|0,I=y;;){if((I|0)==(R|0)){y=5;break}if(Y=(I|0)==(o[W>>2]|0),b=(15-I|0)*3|0,y=Xe(h|0,f|0,b|0)|0,Je()|0,y=y&7,Y&((y|0)==1&!0)){y=7;break}if(!((y|0)==7&!0)){y=10;break}if(Y=tt(1,0,b|0)|0,h=M(h|0,f|0,Y|0,Je()|0)|0,f=Je()|0,Y=u,o[Y>>2]=h,o[Y+4>>2]=f,(I|0)>(R|0))I=I+-1|0;else{y=10;break}}if((y|0)==5){Y=u,o[Y>>2]=0,o[Y+4>>2]=0,o[V>>2]=-1,o[W>>2]=-1;return}else if((y|0)==7){R=tt(1,0,b|0)|0,R=M(h|0,f|0,R|0,Je()|0)|0,V=Je()|0,Y=u,o[Y>>2]=R,o[Y+4>>2]=V,o[W>>2]=I+-1;return}else if((y|0)==10)return}}function nl(u){u=+u;var h=0;return h=u<0?u+6.283185307179586:u,+(u>=6.283185307179586?h+-6.283185307179586:h)}function sl(u,h){return u=u|0,h=h|0,+ai(+(+oe[u>>3]-+oe[h>>3]))<17453292519943298e-27?(h=+ai(+(+oe[u+8>>3]-+oe[h+8>>3]))<17453292519943298e-27,h|0):(h=0,h|0)}function Mc(u,h){u=u|0,h=h|0;var f=0,y=0,b=0,I=0;return b=+oe[h>>3],y=+oe[u>>3],I=+zi(+((b-y)*.5)),f=+zi(+((+oe[h+8>>3]-+oe[u+8>>3])*.5)),f=I*I+f*(+bi(+b)*+bi(+y)*f),+(+Rs(+ +pi(+f),+ +pi(+(1-f)))*2)}function po(u,h){u=u|0,h=h|0;var f=0,y=0,b=0,I=0;return b=+oe[h>>3],y=+oe[u>>3],I=+zi(+((b-y)*.5)),f=+zi(+((+oe[h+8>>3]-+oe[u+8>>3])*.5)),f=I*I+f*(+bi(+b)*+bi(+y)*f),+(+Rs(+ +pi(+f),+ +pi(+(1-f)))*2*6371.007180918475)}function sa(u,h){u=u|0,h=h|0;var f=0,y=0,b=0,I=0;return b=+oe[h>>3],y=+oe[u>>3],I=+zi(+((b-y)*.5)),f=+zi(+((+oe[h+8>>3]-+oe[u+8>>3])*.5)),f=I*I+f*(+bi(+b)*+bi(+y)*f),+(+Rs(+ +pi(+f),+ +pi(+(1-f)))*2*6371.007180918475*1e3)}function Bo(u,h){u=u|0,h=h|0;var f=0,y=0,b=0,I=0,R=0;return I=+oe[h>>3],y=+bi(+I),b=+oe[h+8>>3]-+oe[u+8>>3],R=y*+zi(+b),f=+oe[u>>3],+ +Rs(+R,+(+zi(+I)*+bi(+f)-+bi(+b)*(y*+zi(+f))))}function ja(u,h,f,y){u=u|0,h=+h,f=+f,y=y|0;var b=0,I=0,R=0,V=0;if(f<1e-16){o[y>>2]=o[u>>2],o[y+4>>2]=o[u+4>>2],o[y+8>>2]=o[u+8>>2],o[y+12>>2]=o[u+12>>2];return}I=h<0?h+6.283185307179586:h,I=h>=6.283185307179586?I+-6.283185307179586:I;do if(I<1e-16)h=+oe[u>>3]+f,oe[y>>3]=h,b=y;else{if(b=+ai(+(I+-3.141592653589793))<1e-16,h=+oe[u>>3],b){h=h-f,oe[y>>3]=h,b=y;break}if(R=+bi(+f),f=+zi(+f),h=R*+zi(+h)+ +bi(+I)*(f*+bi(+h)),h=h>1?1:h,h=+HA(+(h<-1?-1:h)),oe[y>>3]=h,+ai(+(h+-1.5707963267948966))<1e-16){oe[y>>3]=1.5707963267948966,oe[y+8>>3]=0;return}if(+ai(+(h+1.5707963267948966))<1e-16){oe[y>>3]=-1.5707963267948966,oe[y+8>>3]=0;return}if(V=+bi(+h),I=f*+zi(+I)/V,f=+oe[u>>3],h=(R-+zi(+h)*+zi(+f))/+bi(+f)/V,R=I>1?1:I,h=h>1?1:h,h=+oe[u+8>>3]+ +Rs(+(R<-1?-1:R),+(h<-1?-1:h)),h>3.141592653589793)do h=h+-6.283185307179586;while(h>3.141592653589793);if(h<-3.141592653589793)do h=h+6.283185307179586;while(h<-3.141592653589793);oe[y+8>>3]=h;return}while(!1);if(+ai(+(h+-1.5707963267948966))<1e-16){oe[b>>3]=1.5707963267948966,oe[y+8>>3]=0;return}if(+ai(+(h+1.5707963267948966))<1e-16){oe[b>>3]=-1.5707963267948966,oe[y+8>>3]=0;return}if(h=+oe[u+8>>3],h>3.141592653589793)do h=h+-6.283185307179586;while(h>3.141592653589793);if(h<-3.141592653589793)do h=h+6.283185307179586;while(h<-3.141592653589793);oe[y+8>>3]=h}function RA(u,h){return u=u|0,h=h|0,u>>>0>15?(h=4,h|0):(oe[h>>3]=+oe[20528+(u<<3)>>3],h=0,h|0)}function ol(u,h){return u=u|0,h=h|0,u>>>0>15?(h=4,h|0):(oe[h>>3]=+oe[20656+(u<<3)>>3],h=0,h|0)}function tc(u,h){return u=u|0,h=h|0,u>>>0>15?(h=4,h|0):(oe[h>>3]=+oe[20784+(u<<3)>>3],h=0,h|0)}function gl(u,h){return u=u|0,h=h|0,u>>>0>15?(h=4,h|0):(oe[h>>3]=+oe[20912+(u<<3)>>3],h=0,h|0)}function FA(u,h){u=u|0,h=h|0;var f=0;return u>>>0>15?(h=4,h|0):(f=oa(7,0,u,((u|0)<0)<<31>>31)|0,f=ue(f|0,Je()|0,120,0)|0,u=Je()|0,o[h>>2]=f|2,o[h+4>>2]=u,h=0,h|0)}function Lo(u,h,f){u=u|0,h=h|0,f=f|0;var y=0,b=0,I=0,R=0,V=0,W=0,Y=0,le=0,fe=0,ye=0;return ye=+oe[h>>3],le=+oe[u>>3],W=+zi(+((ye-le)*.5)),I=+oe[h+8>>3],Y=+oe[u+8>>3],R=+zi(+((I-Y)*.5)),V=+bi(+le),fe=+bi(+ye),R=W*W+R*(fe*V*R),R=+Rs(+ +pi(+R),+ +pi(+(1-R)))*2,W=+oe[f>>3],ye=+zi(+((W-ye)*.5)),y=+oe[f+8>>3],I=+zi(+((y-I)*.5)),b=+bi(+W),I=ye*ye+I*(fe*b*I),I=+Rs(+ +pi(+I),+ +pi(+(1-I)))*2,W=+zi(+((le-W)*.5)),y=+zi(+((Y-y)*.5)),y=W*W+y*(V*b*y),y=+Rs(+ +pi(+y),+ +pi(+(1-y)))*2,b=(R+I+y)*.5,+(+Ls(+ +pi(+(+fn(+(b*.5))*+fn(+((b-R)*.5))*+fn(+((b-I)*.5))*+fn(+((b-y)*.5)))))*4)}function Xo(u,h,f){u=u|0,h=h|0,f=f|0;var y=0,b=0,I=0,R=0,V=0;if(V=Ze,Ze=Ze+192|0,I=V+168|0,R=V,b=va(u,h,I)|0,b|0)return f=b,Ze=V,f|0;if(Rn(u,h,R)|0&&Ar(23313,22742,386,22751),h=o[R>>2]|0,(h|0)>0){if(y=+Lo(R+8|0,R+8+(((h|0)!=1&1)<<4)|0,I)+0,(h|0)!=1){u=1;do b=u,u=u+1|0,y=y+ +Lo(R+8+(b<<4)|0,R+8+(((u|0)%(h|0)|0)<<4)|0,I);while((u|0)<(h|0))}}else y=0;return oe[f>>3]=y,f=0,Ze=V,f|0}function wa(u,h,f){return u=u|0,h=h|0,f=f|0,u=Xo(u,h,f)|0,u|0||(oe[f>>3]=+oe[f>>3]*6371.007180918475*6371.007180918475),u|0}function al(u,h,f){return u=u|0,h=h|0,f=f|0,u=Xo(u,h,f)|0,u|0||(oe[f>>3]=+oe[f>>3]*6371.007180918475*6371.007180918475*1e3*1e3),u|0}function yl(u,h,f){u=u|0,h=h|0,f=f|0;var y=0,b=0,I=0,R=0,V=0,W=0,Y=0,le=0;if(V=Ze,Ze=Ze+176|0,R=V,u=Vs(u,h,R)|0,u|0)return R=u,Ze=V,R|0;if(oe[f>>3]=0,u=o[R>>2]|0,(u|0)<=1)return R=0,Ze=V,R|0;h=u+-1|0,u=0,y=+oe[R+8>>3],b=+oe[R+16>>3],I=0;do u=u+1|0,Y=y,y=+oe[R+8+(u<<4)>>3],le=+zi(+((y-Y)*.5)),W=b,b=+oe[R+8+(u<<4)+8>>3],W=+zi(+((b-W)*.5)),W=le*le+W*(+bi(+y)*+bi(+Y)*W),I=I+ +Rs(+ +pi(+W),+ +pi(+(1-W)))*2;while((u|0)<(h|0));return oe[f>>3]=I,R=0,Ze=V,R|0}function vu(u,h,f){u=u|0,h=h|0,f=f|0;var y=0,b=0,I=0,R=0,V=0,W=0,Y=0,le=0;if(V=Ze,Ze=Ze+176|0,R=V,u=Vs(u,h,R)|0,u|0)return R=u,I=+oe[f>>3],I=I*6371.007180918475,oe[f>>3]=I,Ze=V,R|0;if(oe[f>>3]=0,u=o[R>>2]|0,(u|0)<=1)return R=0,I=0,I=I*6371.007180918475,oe[f>>3]=I,Ze=V,R|0;h=u+-1|0,u=0,y=+oe[R+8>>3],b=+oe[R+16>>3],I=0;do u=u+1|0,Y=y,y=+oe[R+8+(u<<4)>>3],le=+zi(+((y-Y)*.5)),W=b,b=+oe[R+8+(u<<4)+8>>3],W=+zi(+((b-W)*.5)),W=le*le+W*(+bi(+Y)*+bi(+y)*W),I=I+ +Rs(+ +pi(+W),+ +pi(+(1-W)))*2;while((u|0)!=(h|0));return oe[f>>3]=I,R=0,le=I,le=le*6371.007180918475,oe[f>>3]=le,Ze=V,R|0}function ic(u,h,f){u=u|0,h=h|0,f=f|0;var y=0,b=0,I=0,R=0,V=0,W=0,Y=0,le=0;if(V=Ze,Ze=Ze+176|0,R=V,u=Vs(u,h,R)|0,u|0)return R=u,I=+oe[f>>3],I=I*6371.007180918475,I=I*1e3,oe[f>>3]=I,Ze=V,R|0;if(oe[f>>3]=0,u=o[R>>2]|0,(u|0)<=1)return R=0,I=0,I=I*6371.007180918475,I=I*1e3,oe[f>>3]=I,Ze=V,R|0;h=u+-1|0,u=0,y=+oe[R+8>>3],b=+oe[R+16>>3],I=0;do u=u+1|0,Y=y,y=+oe[R+8+(u<<4)>>3],le=+zi(+((y-Y)*.5)),W=b,b=+oe[R+8+(u<<4)+8>>3],W=+zi(+((b-W)*.5)),W=le*le+W*(+bi(+Y)*+bi(+y)*W),I=I+ +Rs(+ +pi(+W),+ +pi(+(1-W)))*2;while((u|0)!=(h|0));return oe[f>>3]=I,R=0,le=I,le=le*6371.007180918475,le=le*1e3,oe[f>>3]=le,Ze=V,R|0}function Jc(u){u=u|0;var h=0,f=0,y=0;return h=T(1,12)|0,h||Ar(22832,22787,49,22845),f=u+4|0,y=o[f>>2]|0,y|0?(y=y+8|0,o[y>>2]=h,o[f>>2]=h,h|0):(o[u>>2]|0&&Ar(22862,22787,61,22885),y=u,o[y>>2]=h,o[f>>2]=h,h|0)}function tA(u,h){u=u|0,h=h|0;var f=0,y=0;return y=Zn(24)|0,y||Ar(22899,22787,78,22913),o[y>>2]=o[h>>2],o[y+4>>2]=o[h+4>>2],o[y+8>>2]=o[h+8>>2],o[y+12>>2]=o[h+12>>2],o[y+16>>2]=0,h=u+4|0,f=o[h>>2]|0,f|0?(o[f+16>>2]=y,o[h>>2]=y,y|0):(o[u>>2]|0&&Ar(22928,22787,82,22913),o[u>>2]=y,o[h>>2]=y,y|0)}function ll(u){u=u|0;var h=0,f=0,y=0,b=0;if(u)for(y=1;;){if(h=o[u>>2]|0,h|0)do{if(f=o[h>>2]|0,f|0)do b=f,f=o[f+16>>2]|0,x(b);while(f|0);b=h,h=o[h+8>>2]|0,x(b)}while(h|0);if(h=u,u=o[u+8>>2]|0,y||x(h),u)y=0;else break}}function Ga(u){u=u|0;var h=0,f=0,y=0,b=0,I=0,R=0,V=0,W=0,Y=0,le=0,fe=0,ye=0,Ie=0,ke=0,qe=0,ut=0,mt=0,st=0,ht=0,ft=0,Ai=0,Nt=0,Wt=0,Gt=0,lr=0,Hi=0,Zi=0,Fi=0,sr=0,er=0,Nr=0,Yi=0;if(b=u+8|0,o[b>>2]|0)return Yi=1,Yi|0;if(y=o[u>>2]|0,!y)return Yi=0,Yi|0;h=y,f=0;do f=f+1|0,h=o[h+8>>2]|0;while(h|0);if(f>>>0<2)return Yi=0,Yi|0;er=Zn(f<<2)|0,er||Ar(22948,22787,317,22967),sr=Zn(f<<5)|0,sr||Ar(22989,22787,321,22967),o[u>>2]=0,Nt=u+4|0,o[Nt>>2]=0,o[b>>2]=0,f=0,Fi=0,Ai=0,fe=0;e:for(;;){if(le=o[y>>2]|0,le){I=0,R=le;do{if(W=+oe[R+8>>3],h=R,R=o[R+16>>2]|0,Y=(R|0)==0,b=Y?le:R,V=+oe[b+8>>3],+ai(+(W-V))>3.141592653589793){Yi=14;break}I=I+(V-W)*(+oe[h>>3]+ +oe[b>>3])}while(!Y);if((Yi|0)==14){Yi=0,I=0,h=le;do ft=+oe[h+8>>3],Zi=h+16|0,Hi=o[Zi>>2]|0,Hi=Hi|0?Hi:le,ht=+oe[Hi+8>>3],I=I+(+oe[h>>3]+ +oe[Hi>>3])*((ht<0?ht+6.283185307179586:ht)-(ft<0?ft+6.283185307179586:ft)),h=o[(h|0?Zi:y)>>2]|0;while(h|0)}I>0?(o[er+(Fi<<2)>>2]=y,Fi=Fi+1|0,b=Ai,h=fe):Yi=19}else Yi=19;if((Yi|0)==19){Yi=0;do if(f){if(h=f+8|0,o[h>>2]|0){Yi=21;break e}if(f=T(1,12)|0,!f){Yi=23;break e}o[h>>2]=f,b=f+4|0,R=f,h=fe}else if(fe){b=Nt,R=fe+8|0,h=y,f=u;break}else if(o[u>>2]|0){Yi=27;break e}else{b=Nt,R=u,h=y,f=u;break}while(!1);if(o[R>>2]=y,o[b>>2]=y,R=sr+(Ai<<5)|0,Y=o[y>>2]|0,Y){for(le=sr+(Ai<<5)+8|0,oe[le>>3]=17976931348623157e292,fe=sr+(Ai<<5)+24|0,oe[fe>>3]=17976931348623157e292,oe[R>>3]=-17976931348623157e292,ye=sr+(Ai<<5)+16|0,oe[ye>>3]=-17976931348623157e292,mt=17976931348623157e292,st=-17976931348623157e292,b=0,Ie=Y,W=17976931348623157e292,qe=17976931348623157e292,ut=-17976931348623157e292,V=-17976931348623157e292;I=+oe[Ie>>3],ft=+oe[Ie+8>>3],Ie=o[Ie+16>>2]|0,ke=(Ie|0)==0,ht=+oe[(ke?Y:Ie)+8>>3],I<W&&(oe[le>>3]=I,W=I),ft<qe&&(oe[fe>>3]=ft,qe=ft),I>ut?oe[R>>3]=I:I=ut,ft>V&&(oe[ye>>3]=ft,V=ft),mt=ft>0&ft<mt?ft:mt,st=ft<0&ft>st?ft:st,b=b|+ai(+(ft-ht))>3.141592653589793,!ke;)ut=I;b&&(oe[ye>>3]=st,oe[fe>>3]=mt)}else o[R>>2]=0,o[R+4>>2]=0,o[R+8>>2]=0,o[R+12>>2]=0,o[R+16>>2]=0,o[R+20>>2]=0,o[R+24>>2]=0,o[R+28>>2]=0;b=Ai+1|0}if(Zi=y+8|0,y=o[Zi>>2]|0,o[Zi>>2]=0,y)Ai=b,fe=h;else{Yi=45;break}}if((Yi|0)==21)Ar(22765,22787,35,22799);else if((Yi|0)==23)Ar(22819,22787,37,22799);else if((Yi|0)==27)Ar(22862,22787,61,22885);else if((Yi|0)==45){e:do if((Fi|0)>0){for(Zi=(b|0)==0,lr=b<<2,Hi=(u|0)==0,Gt=0,h=0;;){if(Wt=o[er+(Gt<<2)>>2]|0,Zi)Yi=73;else{if(Ai=Zn(lr)|0,!Ai){Yi=50;break}if(Nt=Zn(lr)|0,!Nt){Yi=52;break}t:do if(Hi)f=0;else{for(b=0,f=0,R=u;y=sr+(b<<5)|0,Vi(o[R>>2]|0,y,o[Wt>>2]|0)|0?(o[Ai+(f<<2)>>2]=R,o[Nt+(f<<2)>>2]=y,ke=f+1|0):ke=f,R=o[R+8>>2]|0,R;)b=b+1|0,f=ke;if((ke|0)>0)if(y=o[Ai>>2]|0,(ke|0)==1)f=y;else for(ye=0,Ie=-1,f=y,fe=y;;){for(Y=o[fe>>2]|0,y=0,R=0;b=o[o[Ai+(R<<2)>>2]>>2]|0,(b|0)==(Y|0)?le=y:le=y+((Vi(b,o[Nt+(R<<2)>>2]|0,o[Y>>2]|0)|0)&1)|0,R=R+1|0,(R|0)!=(ke|0);)y=le;if(b=(le|0)>(Ie|0),f=b?fe:f,y=ye+1|0,(y|0)==(ke|0))break t;ye=y,Ie=b?le:Ie,fe=o[Ai+(y<<2)>>2]|0}else f=0}while(!1);if(x(Ai),x(Nt),f){if(b=f+4|0,y=o[b>>2]|0,y)f=y+8|0;else if(o[f>>2]|0){Yi=70;break}o[f>>2]=Wt,o[b>>2]=Wt}else Yi=73}if((Yi|0)==73){if(Yi=0,h=o[Wt>>2]|0,h|0)do Nt=h,h=o[h+16>>2]|0,x(Nt);while(h|0);x(Wt),h=1}if(Gt=Gt+1|0,(Gt|0)>=(Fi|0)){Nr=h;break e}}(Yi|0)==50?Ar(23004,22787,249,23023):(Yi|0)==52?Ar(23042,22787,252,23023):(Yi|0)==70&&Ar(22862,22787,61,22885)}else Nr=0;while(!1);return x(er),x(sr),Yi=Nr,Yi|0}return 0}function Vi(u,h,f){u=u|0,h=h|0,f=f|0;var y=0,b=0,I=0,R=0,V=0,W=0,Y=0,le=0;if(!(Po(h,f)|0)||(h=Yl(h)|0,y=+oe[f>>3],b=+oe[f+8>>3],b=h&b<0?b+6.283185307179586:b,u=o[u>>2]|0,!u))return u=0,u|0;if(h){h=0,Y=b,f=u;e:for(;;){for(;R=+oe[f>>3],b=+oe[f+8>>3],f=f+16|0,le=o[f>>2]|0,le=le|0?le:u,I=+oe[le>>3],V=+oe[le+8>>3],R>I?(W=R,R=V):(W=I,I=R,R=b,b=V),y=y==I|y==W?y+2220446049250313e-31:y,!!(y<I|y>W);)if(f=o[f>>2]|0,!f){f=22;break e}if(V=R<0?R+6.283185307179586:R,R=b<0?b+6.283185307179586:b,Y=V==Y|R==Y?Y+-2220446049250313e-31:Y,W=V+(R-V)*((y-I)/(W-I)),(W<0?W+6.283185307179586:W)>Y&&(h=h^1),f=o[f>>2]|0,!f){f=22;break}}if((f|0)==22)return h|0}else{h=0,Y=b,f=u;e:for(;;){for(;R=+oe[f>>3],b=+oe[f+8>>3],f=f+16|0,le=o[f>>2]|0,le=le|0?le:u,I=+oe[le>>3],V=+oe[le+8>>3],R>I?(W=R,R=V):(W=I,I=R,R=b,b=V),y=y==I|y==W?y+2220446049250313e-31:y,!!(y<I|y>W);)if(f=o[f>>2]|0,!f){f=22;break e}if(Y=R==Y|b==Y?Y+-2220446049250313e-31:Y,R+(b-R)*((y-I)/(W-I))>Y&&(h=h^1),f=o[f>>2]|0,!f){f=22;break}}if((f|0)==22)return h|0}return 0}function Ro(u,h,f,y,b){u=u|0,h=h|0,f=f|0,y=y|0,b=b|0;var I=0,R=0,V=0,W=0,Y=0,le=0,fe=0,ye=0,Ie=0,ke=0,qe=0,ut=0,mt=0,st=0;if(st=Ze,Ze=Ze+32|0,mt=st+16|0,ut=st,I=Xe(u|0,h|0,52)|0,Je()|0,I=I&15,Ie=Xe(f|0,y|0,52)|0,Je()|0,(I|0)!=(Ie&15|0))return mt=12,Ze=st,mt|0;if(Y=Xe(u|0,h|0,45)|0,Je()|0,Y=Y&127,le=Xe(f|0,y|0,45)|0,Je()|0,le=le&127,Y>>>0>121|le>>>0>121)return mt=5,Ze=st,mt|0;if(Ie=(Y|0)!=(le|0),Ie){if(V=Ho(Y,le)|0,(V|0)==7)return mt=1,Ze=st,mt|0;W=Ho(le,Y)|0,(W|0)==7?Ar(23066,23090,161,23100):(ke=V,R=W)}else ke=0,R=0;fe=jn(Y)|0,ye=jn(le)|0,o[mt>>2]=0,o[mt+4>>2]=0,o[mt+8>>2]=0,o[mt+12>>2]=0;do if(ke){if(le=o[4272+(Y*28|0)+(ke<<2)>>2]|0,V=(le|0)>0,ye)if(V){Y=0,W=f,V=y;do W=Kc(W,V)|0,V=Je()|0,R=Fa(R)|0,(R|0)==1&&(R=Fa(1)|0),Y=Y+1|0;while((Y|0)!=(le|0));le=R,Y=W,W=V}else le=R,Y=f,W=y;else if(V){Y=0,W=f,V=y;do W=JA(W,V)|0,V=Je()|0,R=Fa(R)|0,Y=Y+1|0;while((Y|0)!=(le|0));le=R,Y=W,W=V}else le=R,Y=f,W=y;if(LA(Y,W,mt)|0,Ie||Ar(23115,23090,191,23100),V=(fe|0)!=0,R=(ye|0)!=0,V&R&&Ar(23142,23090,192,23100),V){if(R=oo(u,h)|0,(R|0)==7){I=5;break}if(Pt[21872+(R*7|0)+ke>>0]|0){I=1;break}W=o[21040+(R*28|0)+(ke<<2)>>2]|0,Y=W}else if(R){if(R=oo(Y,W)|0,(R|0)==7){I=5;break}if(Pt[21872+(R*7|0)+le>>0]|0){I=1;break}Y=0,W=o[21040+(le*28|0)+(R<<2)>>2]|0}else Y=0,W=0;if((Y|W|0)<0)I=5;else{if((W|0)>0){V=mt+4|0,R=0;do ga(V),R=R+1|0;while((R|0)!=(W|0))}if(o[ut>>2]=0,o[ut+4>>2]=0,o[ut+8>>2]=0,_a(ut,ke),I|0)for(;ho(I)|0?fl(ut):Os(ut),(I|0)>1;)I=I+-1|0;if((Y|0)>0){I=0;do ga(ut),I=I+1|0;while((I|0)!=(Y|0))}qe=mt+4|0,sn(qe,ut,qe),ji(qe),qe=51}}else if(LA(f,y,mt)|0,(fe|0)!=0&(ye|0)!=0)if((le|0)!=(Y|0)&&Ar(23173,23090,261,23100),R=oo(u,h)|0,I=oo(f,y)|0,(R|0)==7|(I|0)==7)I=5;else if(Pt[21872+(R*7|0)+I>>0]|0)I=1;else if(R=o[21040+(R*28|0)+(I<<2)>>2]|0,(R|0)>0){V=mt+4|0,I=0;do ga(V),I=I+1|0;while((I|0)!=(R|0));qe=51}else qe=51;else qe=51;while(!1);return(qe|0)==51&&(I=mt+4|0,o[b>>2]=o[I>>2],o[b+4>>2]=o[I+4>>2],o[b+8>>2]=o[I+8>>2],I=0),mt=I,Ze=st,mt|0}function Za(u,h,f,y){u=u|0,h=h|0,f=f|0,y=y|0;var b=0,I=0,R=0,V=0,W=0,Y=0,le=0,fe=0,ye=0,Ie=0,ke=0,qe=0,ut=0,mt=0,st=0,ht=0;if(qe=Ze,Ze=Ze+48|0,Y=qe+36|0,R=qe+24|0,V=qe+12|0,W=qe,b=Xe(u|0,h|0,52)|0,Je()|0,b=b&15,ye=Xe(u|0,h|0,45)|0,Je()|0,ye=ye&127,ye>>>0>121)return y=5,Ze=qe,y|0;if(le=jn(ye)|0,tt(b|0,0,52)|0,ut=Je()|0|134225919,I=y,o[I>>2]=-1,o[I+4>>2]=ut,!b)return b=ma(f)|0,(b|0)==7||(b=Do(ye,b)|0,(b|0)==127)?(ut=1,Ze=qe,ut|0):(Ie=tt(b|0,0,45)|0,ke=Je()|0,ye=y,ke=o[ye+4>>2]&-1040385|ke,ut=y,o[ut>>2]=o[ye>>2]|Ie,o[ut+4>>2]=ke,ut=0,Ze=qe,ut|0);for(o[Y>>2]=o[f>>2],o[Y+4>>2]=o[f+4>>2],o[Y+8>>2]=o[f+8>>2],f=b;;){if(I=f,f=f+-1|0,o[R>>2]=o[Y>>2],o[R+4>>2]=o[Y+4>>2],o[R+8>>2]=o[Y+8>>2],ho(I)|0){if(b=Ja(Y)|0,b|0){f=13;break}o[V>>2]=o[Y>>2],o[V+4>>2]=o[Y+4>>2],o[V+8>>2]=o[Y+8>>2],fl(V)}else{if(b=ra(Y)|0,b|0){f=13;break}o[V>>2]=o[Y>>2],o[V+4>>2]=o[Y+4>>2],o[V+8>>2]=o[Y+8>>2],Os(V)}if(ia(R,V,W),ji(W),b=y,st=o[b>>2]|0,b=o[b+4>>2]|0,ht=(15-I|0)*3|0,mt=tt(7,0,ht|0)|0,b=b&~(Je()|0),ht=tt(ma(W)|0,0,ht|0)|0,b=Je()|0|b,ut=y,o[ut>>2]=ht|st&~mt,o[ut+4>>2]=b,(I|0)<=1){f=14;break}}e:do if((f|0)!=13&&(f|0)==14)if((o[Y>>2]|0)<=1&&(o[Y+4>>2]|0)<=1&&(o[Y+8>>2]|0)<=1){f=ma(Y)|0,b=Do(ye,f)|0,(b|0)==127?W=0:W=jn(b)|0;t:do if(f){if(le){if(b=oo(u,h)|0,(b|0)==7){b=5;break e}if(I=o[21248+(b*28|0)+(f<<2)>>2]|0,(I|0)>0){b=f,f=0;do b=el(b)|0,f=f+1|0;while((f|0)!=(I|0))}else b=f;if((b|0)==1){b=9;break e}f=Do(ye,b)|0,(f|0)==127&&Ar(23200,23090,411,23230),jn(f)|0?Ar(23245,23090,412,23230):(ke=f,Ie=I,fe=b)}else ke=b,Ie=0,fe=f;if(V=o[4272+(ye*28|0)+(fe<<2)>>2]|0,(V|0)<=-1&&Ar(23276,23090,419,23230),!W){if((Ie|0)<0){b=5;break e}if(Ie|0){I=y,b=0,f=o[I>>2]|0,I=o[I+4>>2]|0;do f=ml(f,I)|0,I=Je()|0,ht=y,o[ht>>2]=f,o[ht+4>>2]=I,b=b+1|0;while((b|0)<(Ie|0))}if((V|0)<=0){b=ke,f=58;break}for(I=y,b=0,f=o[I>>2]|0,I=o[I+4>>2]|0;;)if(f=ml(f,I)|0,I=Je()|0,ht=y,o[ht>>2]=f,o[ht+4>>2]=I,b=b+1|0,(b|0)==(V|0)){b=ke,f=58;break t}}if(R=Ho(ke,ye)|0,(R|0)==7&&Ar(23066,23090,428,23230),b=y,f=o[b>>2]|0,b=o[b+4>>2]|0,(V|0)>0){I=0;do f=ml(f,b)|0,b=Je()|0,ht=y,o[ht>>2]=f,o[ht+4>>2]=b,I=I+1|0;while((I|0)!=(V|0))}if(b=oo(f,b)|0,(b|0)==7&&Ar(23313,23090,440,23230),f=hA(ke)|0,f=o[(f?21664:21456)+(R*28|0)+(b<<2)>>2]|0,(f|0)<0&&Ar(23313,23090,454,23230),!f)b=ke,f=58;else{R=y,b=0,I=o[R>>2]|0,R=o[R+4>>2]|0;do I=na(I,R)|0,R=Je()|0,ht=y,o[ht>>2]=I,o[ht+4>>2]=R,b=b+1|0;while((b|0)<(f|0));b=ke,f=58}}else if((le|0)!=0&(W|0)!=0){if(f=oo(u,h)|0,I=y,I=oo(o[I>>2]|0,o[I+4>>2]|0)|0,(f|0)==7|(I|0)==7){b=5;break e}if(I=o[21248+(f*28|0)+(I<<2)>>2]|0,(I|0)<0){b=5;break e}if(!I)f=59;else{V=y,f=0,R=o[V>>2]|0,V=o[V+4>>2]|0;do R=ml(R,V)|0,V=Je()|0,ht=y,o[ht>>2]=R,o[ht+4>>2]=V,f=f+1|0;while((f|0)<(I|0));f=58}}else f=58;while(!1);if((f|0)==58&&W&&(f=59),(f|0)==59&&(ht=y,(oo(o[ht>>2]|0,o[ht+4>>2]|0)|0)==1)){b=9;break}ht=y,mt=o[ht>>2]|0,ht=o[ht+4>>2]&-1040385,st=tt(b|0,0,45)|0,ht=ht|(Je()|0),b=y,o[b>>2]=mt|st,o[b+4>>2]=ht,b=0}else b=1;while(!1);return ht=b,Ze=qe,ht|0}function Al(u,h,f,y,b,I){u=u|0,h=h|0,f=f|0,y=y|0,b=b|0,I=I|0;var R=0,V=0;return V=Ze,Ze=Ze+16|0,R=V,b?u=15:(u=Ro(u,h,f,y,R)|0,u||(Wo(R,I),u=0)),Ze=V,u|0}function rc(u,h,f,y,b){u=u|0,h=h|0,f=f|0,y=y|0,b=b|0;var I=0,R=0;return R=Ze,Ze=Ze+16|0,I=R,y?f=15:(f=pr(f,I)|0,f||(f=Za(u,h,I,b)|0)),Ze=R,f|0}function Si(u,h,f,y,b){u=u|0,h=h|0,f=f|0,y=y|0,b=b|0;var I=0,R=0,V=0,W=0;return W=Ze,Ze=Ze+32|0,R=W+12|0,V=W,I=Ro(u,h,u,h,R)|0,I|0?(V=I,Ze=W,V|0):(u=Ro(u,h,f,y,V)|0,u|0?(V=u,Ze=W,V|0):(R=PA(R,V)|0,V=b,o[V>>2]=R,o[V+4>>2]=((R|0)<0)<<31>>31,V=0,Ze=W,V|0))}function iA(u,h,f,y,b){u=u|0,h=h|0,f=f|0,y=y|0,b=b|0;var I=0,R=0,V=0,W=0;return W=Ze,Ze=Ze+32|0,R=W+12|0,V=W,I=Ro(u,h,u,h,R)|0,!I&&(I=Ro(u,h,f,y,V)|0,!I)?(y=PA(R,V)|0,y=M(y|0,((y|0)<0)<<31>>31|0,1,0)|0,R=Je()|0,V=b,o[V>>2]=y,o[V+4>>2]=R,V=0,Ze=W,V|0):(V=I,Ze=W,V|0)}function OA(u,h,f,y,b){u=u|0,h=h|0,f=f|0,y=y|0,b=b|0;var I=0,R=0,V=0,W=0,Y=0,le=0,fe=0,ye=0,Ie=0,ke=0,qe=0,ut=0,mt=0,st=0,ht=0,ft=0,Ai=0,Nt=0,Wt=0,Gt=0;if(Wt=Ze,Ze=Ze+48|0,R=Wt+24|0,V=Wt+12|0,Nt=Wt,I=Ro(u,h,u,h,R)|0,!I&&(I=Ro(u,h,f,y,V)|0,!I)){ft=PA(R,V)|0,Ai=((ft|0)<0)<<31>>31,o[R>>2]=0,o[R+4>>2]=0,o[R+8>>2]=0,o[V>>2]=0,o[V+4>>2]=0,o[V+8>>2]=0,Ro(u,h,u,h,R)|0&&Ar(23313,23090,691,23299),Ro(u,h,f,y,V)|0&&Ar(23313,23090,696,23299),Oa(R),Oa(V),ft?(fe=o[R>>2]|0,ke=+(ft|0),mt=R+4|0,ye=o[mt>>2]|0,st=R+8|0,Ie=o[st>>2]|0,ht=R,y=fe,I=ye,f=Ie,qe=+((o[V>>2]|0)-fe|0)/ke,ut=+((o[V+4>>2]|0)-ye|0)/ke,ke=+((o[V+8>>2]|0)-Ie|0)/ke):(I=R+4|0,f=R+8|0,mt=I,st=f,ht=R,y=o[R>>2]|0,I=o[I>>2]|0,f=o[f>>2]|0,qe=0,ut=0,ke=0),o[Nt>>2]=y,Ie=Nt+4|0,o[Ie>>2]=I,ye=Nt+8|0,o[ye>>2]=f;e:do if((ft|0)<0)I=0;else for(le=0,fe=0,I=y;;){Y=+(fe>>>0)+4294967296*+(le|0),Gt=qe*Y+ +(I|0),W=ut*Y+ +(o[mt>>2]|0),Y=ke*Y+ +(o[st>>2]|0),f=~~+g(+Gt),R=~~+g(+W),I=~~+g(+Y),Gt=+ai(+(+(f|0)-Gt)),W=+ai(+(+(R|0)-W)),Y=+ai(+(+(I|0)-Y));do if(Gt>W&Gt>Y)f=0-(R+I)|0,y=R;else if(V=0-f|0,W>Y){y=V-I|0;break}else{y=R,I=V-R|0;break}while(!1);if(o[Nt>>2]=f,o[Ie>>2]=y,o[ye>>2]=I,zA(Nt),I=Za(u,h,Nt,b+(fe<<3)|0)|0,I|0)break e;if(!((le|0)<(Ai|0)|(le|0)==(Ai|0)&fe>>>0<ft>>>0)){I=0;break e}I=M(fe|0,le|0,1,0)|0,V=Je()|0,le=V,fe=I,I=o[ht>>2]|0}while(!1);return Nt=I,Ze=Wt,Nt|0}return Nt=I,Ze=Wt,Nt|0}function oa(u,h,f,y){u=u|0,h=h|0,f=f|0,y=y|0;var b=0,I=0,R=0;if((f|0)==0&(y|0)==0)return b=0,I=1,Di(b|0),I|0;I=u,b=h,u=1,h=0;do R=(f&1|0)==0&!0,u=ue((R?1:I)|0,(R?0:b)|0,u|0,h|0)|0,h=Je()|0,f=_t(f|0,y|0,1)|0,y=Je()|0,I=ue(I|0,b|0,I|0,b|0)|0,b=Je()|0;while(!((f|0)==0&(y|0)==0));return Di(h|0),u|0}function _A(u,h,f){u=u|0,h=h|0,f=f|0;var y=0,b=0,I=0,R=0,V=0,W=0,Y=0,le=0,fe=0,ye=0;if(!(Po(h,f)|0)||(h=Yl(h)|0,y=+oe[f>>3],b=+oe[f+8>>3],b=h&b<0?b+6.283185307179586:b,ye=o[u>>2]|0,(ye|0)<=0))return ye=0,ye|0;if(fe=o[u+4>>2]|0,h){h=0,le=b,f=-1,u=0;e:for(;;){for(Y=u;R=+oe[fe+(Y<<4)>>3],b=+oe[fe+(Y<<4)+8>>3],u=(f+2|0)%(ye|0)|0,I=+oe[fe+(u<<4)>>3],V=+oe[fe+(u<<4)+8>>3],R>I?(W=R,R=V):(W=I,I=R,R=b,b=V),y=y==I|y==W?y+2220446049250313e-31:y,!!(y<I|y>W);)if(f=Y+1|0,(f|0)>=(ye|0)){f=22;break e}else u=Y,Y=f,f=u;if(V=R<0?R+6.283185307179586:R,R=b<0?b+6.283185307179586:b,le=V==le|R==le?le+-2220446049250313e-31:le,W=V+(R-V)*((y-I)/(W-I)),(W<0?W+6.283185307179586:W)>le&&(h=h^1),u=Y+1|0,(u|0)>=(ye|0)){f=22;break}else f=Y}if((f|0)==22)return h|0}else{h=0,le=b,f=-1,u=0;e:for(;;){for(Y=u;R=+oe[fe+(Y<<4)>>3],b=+oe[fe+(Y<<4)+8>>3],u=(f+2|0)%(ye|0)|0,I=+oe[fe+(u<<4)>>3],V=+oe[fe+(u<<4)+8>>3],R>I?(W=R,R=V):(W=I,I=R,R=b,b=V),y=y==I|y==W?y+2220446049250313e-31:y,!!(y<I|y>W);)if(f=Y+1|0,(f|0)>=(ye|0)){f=22;break e}else u=Y,Y=f,f=u;if(le=R==le|b==le?le+-2220446049250313e-31:le,R+(b-R)*((y-I)/(W-I))>le&&(h=h^1),u=Y+1|0,(u|0)>=(ye|0)){f=22;break}else f=Y}if((f|0)==22)return h|0}return 0}function nc(u,h){u=u|0,h=h|0;var f=0,y=0,b=0,I=0,R=0,V=0,W=0,Y=0,le=0,fe=0,ye=0,Ie=0,ke=0,qe=0,ut=0,mt=0,st=0;if(ke=o[u>>2]|0,!ke){o[h>>2]=0,o[h+4>>2]=0,o[h+8>>2]=0,o[h+12>>2]=0,o[h+16>>2]=0,o[h+20>>2]=0,o[h+24>>2]=0,o[h+28>>2]=0;return}if(qe=h+8|0,oe[qe>>3]=17976931348623157e292,ut=h+24|0,oe[ut>>3]=17976931348623157e292,oe[h>>3]=-17976931348623157e292,mt=h+16|0,oe[mt>>3]=-17976931348623157e292,!((ke|0)<=0)){for(ye=o[u+4>>2]|0,Y=17976931348623157e292,le=-17976931348623157e292,fe=0,u=-1,I=17976931348623157e292,R=17976931348623157e292,W=-17976931348623157e292,y=-17976931348623157e292,Ie=0;f=+oe[ye+(Ie<<4)>>3],V=+oe[ye+(Ie<<4)+8>>3],u=u+2|0,b=+oe[ye+(((u|0)==(ke|0)?0:u)<<4)+8>>3],f<I&&(oe[qe>>3]=f,I=f),V<R&&(oe[ut>>3]=V,R=V),f>W?oe[h>>3]=f:f=W,V>y&&(oe[mt>>3]=V,y=V),Y=V>0&V<Y?V:Y,le=V<0&V>le?V:le,fe=fe|+ai(+(V-b))>3.141592653589793,u=Ie+1|0,(u|0)!=(ke|0);)st=Ie,W=f,Ie=u,u=st;fe&&(oe[mt>>3]=le,oe[ut>>3]=Y)}}function VA(u,h){u=u|0,h=h|0;var f=0,y=0,b=0,I=0,R=0,V=0,W=0,Y=0,le=0,fe=0,ye=0,Ie=0,ke=0,qe=0,ut=0,mt=0,st=0,ht=0,ft=0,Ai=0,Nt=0,Wt=0;if(ke=o[u>>2]|0,ke){if(qe=h+8|0,oe[qe>>3]=17976931348623157e292,ut=h+24|0,oe[ut>>3]=17976931348623157e292,oe[h>>3]=-17976931348623157e292,mt=h+16|0,oe[mt>>3]=-17976931348623157e292,(ke|0)>0){for(b=o[u+4>>2]|0,ye=17976931348623157e292,Ie=-17976931348623157e292,y=0,f=-1,W=17976931348623157e292,Y=17976931348623157e292,fe=-17976931348623157e292,R=-17976931348623157e292,st=0;I=+oe[b+(st<<4)>>3],le=+oe[b+(st<<4)+8>>3],Nt=f+2|0,V=+oe[b+(((Nt|0)==(ke|0)?0:Nt)<<4)+8>>3],I<W&&(oe[qe>>3]=I,W=I),le<Y&&(oe[ut>>3]=le,Y=le),I>fe?oe[h>>3]=I:I=fe,le>R&&(oe[mt>>3]=le,R=le),ye=le>0&le<ye?le:ye,Ie=le<0&le>Ie?le:Ie,y=y|+ai(+(le-V))>3.141592653589793,f=st+1|0,(f|0)!=(ke|0);)Nt=st,fe=I,st=f,f=Nt;y&&(oe[mt>>3]=Ie,oe[ut>>3]=ye)}}else o[h>>2]=0,o[h+4>>2]=0,o[h+8>>2]=0,o[h+12>>2]=0,o[h+16>>2]=0,o[h+20>>2]=0,o[h+24>>2]=0,o[h+28>>2]=0;if(Nt=u+8|0,f=o[Nt>>2]|0,!((f|0)<=0)){Ai=u+12|0,ft=0;do if(b=o[Ai>>2]|0,y=ft,ft=ft+1|0,ut=h+(ft<<5)|0,mt=o[b+(y<<3)>>2]|0,mt){if(st=h+(ft<<5)+8|0,oe[st>>3]=17976931348623157e292,u=h+(ft<<5)+24|0,oe[u>>3]=17976931348623157e292,oe[ut>>3]=-17976931348623157e292,ht=h+(ft<<5)+16|0,oe[ht>>3]=-17976931348623157e292,(mt|0)>0){for(ke=o[b+(y<<3)+4>>2]|0,ye=17976931348623157e292,Ie=-17976931348623157e292,b=0,y=-1,qe=0,W=17976931348623157e292,Y=17976931348623157e292,le=-17976931348623157e292,R=-17976931348623157e292;I=+oe[ke+(qe<<4)>>3],fe=+oe[ke+(qe<<4)+8>>3],y=y+2|0,V=+oe[ke+(((y|0)==(mt|0)?0:y)<<4)+8>>3],I<W&&(oe[st>>3]=I,W=I),fe<Y&&(oe[u>>3]=fe,Y=fe),I>le?oe[ut>>3]=I:I=le,fe>R&&(oe[ht>>3]=fe,R=fe),ye=fe>0&fe<ye?fe:ye,Ie=fe<0&fe>Ie?fe:Ie,b=b|+ai(+(fe-V))>3.141592653589793,y=qe+1|0,(y|0)!=(mt|0);)Wt=qe,qe=y,le=I,y=Wt;b&&(oe[ht>>3]=Ie,oe[u>>3]=ye)}}else o[ut>>2]=0,o[ut+4>>2]=0,o[ut+8>>2]=0,o[ut+12>>2]=0,o[ut+16>>2]=0,o[ut+20>>2]=0,o[ut+24>>2]=0,o[ut+28>>2]=0,f=o[Nt>>2]|0;while((ft|0)<(f|0))}}function sc(u,h,f){u=u|0,h=h|0,f=f|0;var y=0,b=0,I=0;if(!(_A(u,h,f)|0))return b=0,b|0;if(b=u+8|0,(o[b>>2]|0)<=0)return b=1,b|0;for(y=u+12|0,u=0;;){if(I=u,u=u+1|0,_A((o[y>>2]|0)+(I<<3)|0,h+(u<<5)|0,f)|0){u=0,y=6;break}if((u|0)>=(o[b>>2]|0)){u=1,y=6;break}}return(y|0)==6?u|0:0}function Ms(){return 8}function gA(){return 16}function NA(){return 168}function UA(){return 8}function Ji(){return 16}function To(){return 12}function Ta(){return 8}function rA(u){return u=u|0,+(+((o[u>>2]|0)>>>0)+4294967296*+(o[u+4>>2]|0))}function oc(u){u=u|0;var h=0,f=0;return f=+oe[u>>3],h=+oe[u+8>>3],+ +pi(+(f*f+h*h))}function nA(u,h,f,y,b){u=u|0,h=h|0,f=f|0,y=y|0,b=b|0;var I=0,R=0,V=0,W=0,Y=0,le=0,fe=0,ye=0;Y=+oe[u>>3],W=+oe[h>>3]-Y,V=+oe[u+8>>3],R=+oe[h+8>>3]-V,fe=+oe[f>>3],I=+oe[y>>3]-fe,ye=+oe[f+8>>3],le=+oe[y+8>>3]-ye,I=(I*(V-ye)-(Y-fe)*le)/(W*le-R*I),oe[b>>3]=Y+W*I,oe[b+8>>3]=V+R*I}function xl(u,h){return u=u|0,h=h|0,+ai(+(+oe[u>>3]-+oe[h>>3]))<11920928955078125e-23?(h=+ai(+(+oe[u+8>>3]-+oe[h+8>>3]))<11920928955078125e-23,h|0):(h=0,h|0)}function Ss(u,h){u=u|0,h=h|0;var f=0,y=0,b=0;return b=+oe[u>>3]-+oe[h>>3],y=+oe[u+8>>3]-+oe[h+8>>3],f=+oe[u+16>>3]-+oe[h+16>>3],+(b*b+y*y+f*f)}function aa(u,h){u=u|0,h=h|0;var f=0,y=0,b=0;f=+oe[u>>3],y=+bi(+f),f=+zi(+f),oe[h+16>>3]=f,f=+oe[u+8>>3],b=y*+bi(+f),oe[h>>3]=b,f=y*+zi(+f),oe[h+8>>3]=f}function Gn(u,h,f){u=u|0,h=h|0,f=f|0;var y=0,b=0,I=0;if(I=Ze,Ze=Ze+16|0,b=I,y=Ln(u,h)|0,(f+-1|0)>>>0>5||(y=(y|0)!=0,(f|0)==1&y))return b=-1,Ze=I,b|0;do if(mo(u,h,b)|0)y=-1;else if(y){y=((o[21936+(f<<2)>>2]|0)+5-(o[b>>2]|0)|0)%5|0;break}else{y=((o[21968+(f<<2)>>2]|0)+6-(o[b>>2]|0)|0)%6|0;break}while(!1);return b=y,Ze=I,b|0}function mo(u,h,f){u=u|0,h=h|0,f=f|0;var y=0,b=0,I=0,R=0,V=0,W=0,Y=0;if(Y=Ze,Ze=Ze+32|0,R=Y+16|0,V=Y,y=Pn(u,h,R)|0,y|0)return f=y,Ze=Y,f|0;I=tl(u,h)|0,W=oo(u,h)|0,rs(I,V),y=xt(I,o[R>>2]|0)|0;e:do if(jn(I)|0){do switch(I|0){case 4:{u=0;break}case 14:{u=1;break}case 24:{u=2;break}case 38:{u=3;break}case 49:{u=4;break}case 58:{u=5;break}case 63:{u=6;break}case 72:{u=7;break}case 83:{u=8;break}case 97:{u=9;break}case 107:{u=10;break}case 117:{u=11;break}default:{y=1;break e}}while(!1);if(b=o[22e3+(u*24|0)+8>>2]|0,h=o[22e3+(u*24|0)+16>>2]|0,u=o[R>>2]|0,(u|0)!=(o[V>>2]|0)&&(V=hA(I)|0,u=o[R>>2]|0,V|(u|0)==(h|0)&&(y=(y+1|0)%6|0)),(W|0)==3&(u|0)==(h|0)){y=(y+5|0)%6|0,b=22;break}(W|0)==5&(u|0)==(b|0)&&(y=(y+1|0)%6|0),b=22}else b=22;while(!1);return(b|0)==22&&(o[f>>2]=y,y=0),f=y,Ze=Y,f|0}function mr(u,h,f,y){u=u|0,h=h|0,f=f|0,y=y|0;var b=0,I=0,R=0,V=0,W=0,Y=0,le=0,fe=0,ye=0,Ie=0,ke=0,qe=0,ut=0,mt=0,st=0,ht=0;if(ht=Ze,Ze=Ze+32|0,st=ht+24|0,ut=ht+20|0,ke=ht+8|0,Ie=ht+16|0,ye=ht,W=(Ln(u,h)|0)==0,W=W?6:5,le=Xe(u|0,h|0,52)|0,Je()|0,le=le&15,W>>>0<=f>>>0)return y=2,Ze=ht,y|0;fe=(le|0)==0,!fe&&(qe=tt(7,0,(le^15)*3|0)|0,(qe&u|0)==0&((Je()|0)&h|0)==0)?b=f:I=4;e:do if((I|0)==4){if(b=(Ln(u,h)|0)!=0,((b?4:5)|0)<(f|0)||mo(u,h,st)|0||(I=(o[st>>2]|0)+f|0,b?b=22288+(((I|0)%5|0)<<2)|0:b=22320+(((I|0)%6|0)<<2)|0,qe=o[b>>2]|0,(qe|0)==7))return y=1,Ze=ht,y|0;o[ut>>2]=0,b=Ds(u,h,qe,ut,ke)|0;do if(!b){if(V=ke,Y=o[V>>2]|0,V=o[V+4>>2]|0,R=V>>>0<h>>>0|(V|0)==(h|0)&Y>>>0<u>>>0,I=R?Y:u,R=R?V:h,!fe&&(fe=tt(7,0,(le^15)*3|0)|0,(Y&fe|0)==0&(V&(Je()|0)|0)==0))b=f;else{if(V=(f+-1+W|0)%(W|0)|0,b=Ln(u,h)|0,(V|0)<0&&Ar(23313,23315,245,23324),W=(b|0)!=0,((W?4:5)|0)<(V|0)&&Ar(23313,23315,245,23324),mo(u,h,st)|0&&Ar(23313,23315,245,23324),b=(o[st>>2]|0)+V|0,W?b=22288+(((b|0)%5|0)<<2)|0:b=22320+(((b|0)%6|0)<<2)|0,V=o[b>>2]|0,(V|0)==7&&Ar(23313,23315,245,23324),o[Ie>>2]=0,b=Ds(u,h,V,Ie,ye)|0,b|0)break;Y=ye,W=o[Y>>2]|0,Y=o[Y+4>>2]|0;do if(Y>>>0<R>>>0|(Y|0)==(R|0)&W>>>0<I>>>0){if(Ln(W,Y)|0?I=Dl(W,Y,u,h)|0:I=o[22384+((((o[Ie>>2]|0)+(o[22352+(V<<2)>>2]|0)|0)%6|0)<<2)>>2]|0,b=Ln(W,Y)|0,(I+-1|0)>>>0>5){b=-1,I=W,R=Y;break}if(b=(b|0)!=0,(I|0)==1&b){b=-1,I=W,R=Y;break}do if(mo(W,Y,st)|0)b=-1;else if(b){b=((o[21936+(I<<2)>>2]|0)+5-(o[st>>2]|0)|0)%5|0;break}else{b=((o[21968+(I<<2)>>2]|0)+6-(o[st>>2]|0)|0)%6|0;break}while(!1);I=W,R=Y}else b=f;while(!1);V=ke,Y=o[V>>2]|0,V=o[V+4>>2]|0}if((I|0)==(Y|0)&(R|0)==(V|0)){if(W=(Ln(Y,V)|0)!=0,W?u=Dl(Y,V,u,h)|0:u=o[22384+((((o[ut>>2]|0)+(o[22352+(qe<<2)>>2]|0)|0)%6|0)<<2)>>2]|0,b=Ln(Y,V)|0,(u+-1|0)>>>0<=5&&(mt=(b|0)!=0,!((u|0)==1&mt)))do if(mo(Y,V,st)|0)b=-1;else if(mt){b=((o[21936+(u<<2)>>2]|0)+5-(o[st>>2]|0)|0)%5|0;break}else{b=((o[21968+(u<<2)>>2]|0)+6-(o[st>>2]|0)|0)%6|0;break}while(!1);else b=-1;b=b+1|0,b=(b|0)==6|W&(b|0)==5?0:b}h=R,u=I;break e}while(!1);return y=b,Ze=ht,y|0}while(!1);return mt=tt(b|0,0,56)|0,st=Je()|0|h&-2130706433|536870912,o[y>>2]=mt|u,o[y+4>>2]=st,y=0,Ze=ht,y|0}function Yo(u,h,f){u=u|0,h=h|0,f=f|0;var y=0,b=0,I=0;return I=(Ln(u,h)|0)==0,y=mr(u,h,0,f)|0,b=(y|0)==0,I?!b||(y=mr(u,h,1,f+8|0)|0,y|0)||(y=mr(u,h,2,f+16|0)|0,y|0)||(y=mr(u,h,3,f+24|0)|0,y|0)||(y=mr(u,h,4,f+32|0)|0,y)?(I=y,I|0):mr(u,h,5,f+40|0)|0:!b||(y=mr(u,h,1,f+8|0)|0,y|0)||(y=mr(u,h,2,f+16|0)|0,y|0)||(y=mr(u,h,3,f+24|0)|0,y|0)||(y=mr(u,h,4,f+32|0)|0,y|0)?(I=y,I|0):(I=f+40|0,o[I>>2]=0,o[I+4>>2]=0,I=0,I|0)}function ac(u,h,f){u=u|0,h=h|0,f=f|0;var y=0,b=0,I=0,R=0,V=0,W=0;return W=Ze,Ze=Ze+192|0,b=W,I=W+168|0,R=Xe(u|0,h|0,56)|0,Je()|0,R=R&7,V=h&-2130706433|134217728,y=Pn(u,V,I)|0,y|0?(V=y,Ze=W,V|0):(h=Xe(u|0,h|0,52)|0,Je()|0,h=h&15,Ln(u,V)|0?eA(I,h,R,1,b):Tn(I,h,R,1,b),V=b+8|0,o[f>>2]=o[V>>2],o[f+4>>2]=o[V+4>>2],o[f+8>>2]=o[V+8>>2],o[f+12>>2]=o[V+12>>2],V=0,Ze=W,V|0)}function Ol(u,h){u=u|0,h=h|0;var f=0,y=0,b=0,I=0;return b=Ze,Ze=Ze+16|0,f=b,!(!0&(h&2013265920|0)==536870912)||(y=h&-2130706433|134217728,!(pA(u,y)|0))?(y=0,Ze=b,y|0):(I=Xe(u|0,h|0,56)|0,Je()|0,I=(mr(u,y,I&7,f)|0)==0,y=f,y=I&((o[y>>2]|0)==(u|0)?(o[y+4>>2]|0)==(h|0):0)&1,Ze=b,y|0)}function lc(u,h,f){u=u|0,h=h|0,f=f|0;var y=0;(h|0)>0?(y=T(h,4)|0,o[u>>2]=y,y||Ar(23337,23360,40,23374)):o[u>>2]=0,o[u+4>>2]=h,o[u+8>>2]=0,o[u+12>>2]=f}function _o(u){u=u|0;var h=0,f=0,y=0,b=0,I=0,R=0,V=0;b=u+4|0,I=u+12|0,R=u+8|0;e:for(;;){for(f=o[b>>2]|0,h=0;;){if((h|0)>=(f|0))break e;if(y=o[u>>2]|0,V=o[y+(h<<2)>>2]|0,!V)h=h+1|0;else break}h=y+(~~(+ai(+(+gr(10,+ +(15-(o[I>>2]|0)|0))*(+oe[V>>3]+ +oe[V+8>>3])))%+(f|0))>>>0<<2)|0,f=o[h>>2]|0;t:do if(f|0){if(y=V+32|0,(f|0)==(V|0))o[h>>2]=o[y>>2];else{if(f=f+32|0,h=o[f>>2]|0,!h)break;for(;(h|0)!=(V|0);)if(f=h+32|0,h=o[f>>2]|0,!h)break t;o[f>>2]=o[y>>2]}x(V),o[R>>2]=(o[R>>2]|0)+-1}while(!1)}x(o[u>>2]|0)}function Ea(u){u=u|0;var h=0,f=0,y=0;for(y=o[u+4>>2]|0,f=0;;){if((f|0)>=(y|0)){h=0,f=4;break}if(h=o[(o[u>>2]|0)+(f<<2)>>2]|0,!h)f=f+1|0;else{f=4;break}}return(f|0)==4?h|0:0}function Vt(u,h){u=u|0,h=h|0;var f=0,y=0,b=0,I=0;if(f=~~(+ai(+(+gr(10,+ +(15-(o[u+12>>2]|0)|0))*(+oe[h>>3]+ +oe[h+8>>3])))%+(o[u+4>>2]|0))>>>0,f=(o[u>>2]|0)+(f<<2)|0,y=o[f>>2]|0,!y)return I=1,I|0;I=h+32|0;do if((y|0)!=(h|0)){if(f=o[y+32>>2]|0,!f)return I=1,I|0;for(b=f;;){if((b|0)==(h|0)){b=8;break}if(f=o[b+32>>2]|0,f)y=b,b=f;else{f=1,b=10;break}}if((b|0)==8){o[y+32>>2]=o[I>>2];break}else if((b|0)==10)return f|0}else o[f>>2]=o[I>>2];while(!1);return x(h),I=u+8|0,o[I>>2]=(o[I>>2]|0)+-1,I=0,I|0}function Jt(u,h,f){u=u|0,h=h|0,f=f|0;var y=0,b=0,I=0,R=0;I=Zn(40)|0,I||Ar(23390,23360,98,23403),o[I>>2]=o[h>>2],o[I+4>>2]=o[h+4>>2],o[I+8>>2]=o[h+8>>2],o[I+12>>2]=o[h+12>>2],b=I+16|0,o[b>>2]=o[f>>2],o[b+4>>2]=o[f+4>>2],o[b+8>>2]=o[f+8>>2],o[b+12>>2]=o[f+12>>2],o[I+32>>2]=0,b=~~(+ai(+(+gr(10,+ +(15-(o[u+12>>2]|0)|0))*(+oe[h>>3]+ +oe[h+8>>3])))%+(o[u+4>>2]|0))>>>0,b=(o[u>>2]|0)+(b<<2)|0,y=o[b>>2]|0;do if(!y)o[b>>2]=I;else{for(;!(sl(y,h)|0&&sl(y+16|0,f)|0);)if(b=o[y+32>>2]|0,y=b|0?b:y,!(o[y+32>>2]|0)){R=10;break}if((R|0)==10){o[y+32>>2]=I;break}return x(I),R=y,R|0}while(!1);return R=u+8|0,o[R>>2]=(o[R>>2]|0)+1,R=I,R|0}function sA(u,h,f){u=u|0,h=h|0,f=f|0;var y=0,b=0;if(b=~~(+ai(+(+gr(10,+ +(15-(o[u+12>>2]|0)|0))*(+oe[h>>3]+ +oe[h+8>>3])))%+(o[u+4>>2]|0))>>>0,b=o[(o[u>>2]|0)+(b<<2)>>2]|0,!b)return f=0,f|0;if(!f){for(u=b;;){if(sl(u,h)|0){y=10;break}if(u=o[u+32>>2]|0,!u){u=0,y=10;break}}if((y|0)==10)return u|0}for(u=b;;){if(sl(u,h)|0&&sl(u+16|0,f)|0){y=10;break}if(u=o[u+32>>2]|0,!u){u=0,y=10;break}}return(y|0)==10?u|0:0}function vl(u,h){u=u|0,h=h|0;var f=0;if(f=~~(+ai(+(+gr(10,+ +(15-(o[u+12>>2]|0)|0))*(+oe[h>>3]+ +oe[h+8>>3])))%+(o[u+4>>2]|0))>>>0,u=o[(o[u>>2]|0)+(f<<2)>>2]|0,!u)return f=0,f|0;for(;;){if(sl(u,h)|0){h=5;break}if(u=o[u+32>>2]|0,!u){u=0,h=5;break}}return(h|0)==5?u|0:0}function Vl(){return 23424}function tn(u){return u=+u,+ +F(+u)}function la(u){return u=+u,~~+tn(u)|0}function Zn(u){u=u|0;var h=0,f=0,y=0,b=0,I=0,R=0,V=0,W=0,Y=0,le=0,fe=0,ye=0,Ie=0,ke=0,qe=0,ut=0,mt=0,st=0,ht=0,ft=0,Ai=0;Ai=Ze,Ze=Ze+16|0,ye=Ai;do if(u>>>0<245){if(Y=u>>>0<11?16:u+11&-8,u=Y>>>3,fe=o[5857]|0,f=fe>>>u,f&3|0)return h=(f&1^1)+u|0,u=23468+(h<<1<<2)|0,f=u+8|0,y=o[f>>2]|0,b=y+8|0,I=o[b>>2]|0,(I|0)==(u|0)?o[5857]=fe&~(1<<h):(o[I+12>>2]=u,o[f>>2]=I),ft=h<<3,o[y+4>>2]=ft|3,ft=y+ft+4|0,o[ft>>2]=o[ft>>2]|1,ft=b,Ze=Ai,ft|0;if(le=o[5859]|0,Y>>>0>le>>>0){if(f|0)return h=2<<u,h=f<<u&(h|0-h),h=(h&0-h)+-1|0,V=h>>>12&16,h=h>>>V,f=h>>>5&8,h=h>>>f,I=h>>>2&4,h=h>>>I,u=h>>>1&2,h=h>>>u,y=h>>>1&1,y=(f|V|I|u|y)+(h>>>y)|0,h=23468+(y<<1<<2)|0,u=h+8|0,I=o[u>>2]|0,V=I+8|0,f=o[V>>2]|0,(f|0)==(h|0)?(u=fe&~(1<<y),o[5857]=u):(o[f+12>>2]=h,o[u>>2]=f,u=fe),ft=y<<3,R=ft-Y|0,o[I+4>>2]=Y|3,b=I+Y|0,o[b+4>>2]=R|1,o[I+ft>>2]=R,le|0&&(y=o[5862]|0,h=le>>>3,f=23468+(h<<1<<2)|0,h=1<<h,u&h?(u=f+8|0,h=o[u>>2]|0):(o[5857]=u|h,h=f,u=f+8|0),o[u>>2]=y,o[h+12>>2]=y,o[y+8>>2]=h,o[y+12>>2]=f),o[5859]=R,o[5862]=b,ft=V,Ze=Ai,ft|0;if(I=o[5858]|0,I){for(f=(I&0-I)+-1|0,b=f>>>12&16,f=f>>>b,y=f>>>5&8,f=f>>>y,R=f>>>2&4,f=f>>>R,V=f>>>1&2,f=f>>>V,W=f>>>1&1,W=o[23732+((y|b|R|V|W)+(f>>>W)<<2)>>2]|0,f=W,V=W,W=(o[W+4>>2]&-8)-Y|0;u=o[f+16>>2]|0,!(!u&&(u=o[f+20>>2]|0,!u));)R=(o[u+4>>2]&-8)-Y|0,b=R>>>0<W>>>0,f=u,V=b?u:V,W=b?R:W;if(R=V+Y|0,R>>>0>V>>>0){b=o[V+24>>2]|0,h=o[V+12>>2]|0;do if((h|0)==(V|0)){if(u=V+20|0,h=o[u>>2]|0,!h&&(u=V+16|0,h=o[u>>2]|0,!h)){f=0;break}for(;;)if(y=h+20|0,f=o[y>>2]|0,f)h=f,u=y;else if(y=h+16|0,f=o[y>>2]|0,f)h=f,u=y;else break;o[u>>2]=0,f=h}else f=o[V+8>>2]|0,o[f+12>>2]=h,o[h+8>>2]=f,f=h;while(!1);do if(b|0){if(h=o[V+28>>2]|0,u=23732+(h<<2)|0,(V|0)==(o[u>>2]|0)){if(o[u>>2]=f,!f){o[5858]=I&~(1<<h);break}}else if(ft=b+16|0,o[((o[ft>>2]|0)==(V|0)?ft:b+20|0)>>2]=f,!f)break;o[f+24>>2]=b,h=o[V+16>>2]|0,h|0&&(o[f+16>>2]=h,o[h+24>>2]=f),h=o[V+20>>2]|0,h|0&&(o[f+20>>2]=h,o[h+24>>2]=f)}while(!1);return W>>>0<16?(ft=W+Y|0,o[V+4>>2]=ft|3,ft=V+ft+4|0,o[ft>>2]=o[ft>>2]|1):(o[V+4>>2]=Y|3,o[R+4>>2]=W|1,o[R+W>>2]=W,le|0&&(y=o[5862]|0,h=le>>>3,f=23468+(h<<1<<2)|0,h=1<<h,h&fe?(u=f+8|0,h=o[u>>2]|0):(o[5857]=h|fe,h=f,u=f+8|0),o[u>>2]=y,o[h+12>>2]=y,o[y+8>>2]=h,o[y+12>>2]=f),o[5859]=W,o[5862]=R),ft=V+8|0,Ze=Ai,ft|0}else fe=Y}else fe=Y}else fe=Y}else if(u>>>0<=4294967231)if(u=u+11|0,Y=u&-8,y=o[5858]|0,y){b=0-Y|0,u=u>>>8,u?Y>>>0>16777215?W=31:(fe=(u+1048320|0)>>>16&8,qe=u<<fe,V=(qe+520192|0)>>>16&4,qe=qe<<V,W=(qe+245760|0)>>>16&2,W=14-(V|fe|W)+(qe<<W>>>15)|0,W=Y>>>(W+7|0)&1|W<<1):W=0,f=o[23732+(W<<2)>>2]|0;e:do if(!f)f=0,u=0,qe=61;else for(u=0,V=Y<<((W|0)==31?0:25-(W>>>1)|0),I=0;;){if(R=(o[f+4>>2]&-8)-Y|0,R>>>0<b>>>0)if(R)u=f,b=R;else{u=f,b=0,qe=65;break e}if(qe=o[f+20>>2]|0,f=o[f+16+(V>>>31<<2)>>2]|0,I=(qe|0)==0|(qe|0)==(f|0)?I:qe,f)V=V<<1;else{f=I,qe=61;break}}while(!1);if((qe|0)==61){if((f|0)==0&(u|0)==0){if(u=2<<W,u=(u|0-u)&y,!u){fe=Y;break}fe=(u&0-u)+-1|0,R=fe>>>12&16,fe=fe>>>R,I=fe>>>5&8,fe=fe>>>I,V=fe>>>2&4,fe=fe>>>V,W=fe>>>1&2,fe=fe>>>W,f=fe>>>1&1,u=0,f=o[23732+((I|R|V|W|f)+(fe>>>f)<<2)>>2]|0}f?qe=65:(V=u,R=b)}if((qe|0)==65)for(I=f;;)if(fe=(o[I+4>>2]&-8)-Y|0,f=fe>>>0<b>>>0,b=f?fe:b,u=f?I:u,f=o[I+16>>2]|0,f||(f=o[I+20>>2]|0),f)I=f;else{V=u,R=b;break}if(V|0&&R>>>0<((o[5859]|0)-Y|0)>>>0&&(le=V+Y|0,le>>>0>V>>>0)){I=o[V+24>>2]|0,h=o[V+12>>2]|0;do if((h|0)==(V|0)){if(u=V+20|0,h=o[u>>2]|0,!h&&(u=V+16|0,h=o[u>>2]|0,!h)){h=0;break}for(;;)if(b=h+20|0,f=o[b>>2]|0,f)h=f,u=b;else if(b=h+16|0,f=o[b>>2]|0,f)h=f,u=b;else break;o[u>>2]=0}else ft=o[V+8>>2]|0,o[ft+12>>2]=h,o[h+8>>2]=ft;while(!1);do if(I){if(u=o[V+28>>2]|0,f=23732+(u<<2)|0,(V|0)==(o[f>>2]|0)){if(o[f>>2]=h,!h){y=y&~(1<<u),o[5858]=y;break}}else if(ft=I+16|0,o[((o[ft>>2]|0)==(V|0)?ft:I+20|0)>>2]=h,!h)break;o[h+24>>2]=I,u=o[V+16>>2]|0,u|0&&(o[h+16>>2]=u,o[u+24>>2]=h),u=o[V+20>>2]|0,u&&(o[h+20>>2]=u,o[u+24>>2]=h)}while(!1);e:do if(R>>>0<16)ft=R+Y|0,o[V+4>>2]=ft|3,ft=V+ft+4|0,o[ft>>2]=o[ft>>2]|1;else{if(o[V+4>>2]=Y|3,o[le+4>>2]=R|1,o[le+R>>2]=R,h=R>>>3,R>>>0<256){f=23468+(h<<1<<2)|0,u=o[5857]|0,h=1<<h,u&h?(u=f+8|0,h=o[u>>2]|0):(o[5857]=u|h,h=f,u=f+8|0),o[u>>2]=le,o[h+12>>2]=le,o[le+8>>2]=h,o[le+12>>2]=f;break}if(h=R>>>8,h?R>>>0>16777215?f=31:(ht=(h+1048320|0)>>>16&8,ft=h<<ht,st=(ft+520192|0)>>>16&4,ft=ft<<st,f=(ft+245760|0)>>>16&2,f=14-(st|ht|f)+(ft<<f>>>15)|0,f=R>>>(f+7|0)&1|f<<1):f=0,h=23732+(f<<2)|0,o[le+28>>2]=f,u=le+16|0,o[u+4>>2]=0,o[u>>2]=0,u=1<<f,!(y&u)){o[5858]=y|u,o[h>>2]=le,o[le+24>>2]=h,o[le+12>>2]=le,o[le+8>>2]=le;break}h=o[h>>2]|0;t:do if((o[h+4>>2]&-8|0)!=(R|0)){for(y=R<<((f|0)==31?0:25-(f>>>1)|0);f=h+16+(y>>>31<<2)|0,u=o[f>>2]|0,!!u;)if((o[u+4>>2]&-8|0)==(R|0)){h=u;break t}else y=y<<1,h=u;o[f>>2]=le,o[le+24>>2]=h,o[le+12>>2]=le,o[le+8>>2]=le;break e}while(!1);ht=h+8|0,ft=o[ht>>2]|0,o[ft+12>>2]=le,o[ht>>2]=le,o[le+8>>2]=ft,o[le+12>>2]=h,o[le+24>>2]=0}while(!1);return ft=V+8|0,Ze=Ai,ft|0}else fe=Y}else fe=Y;else fe=-1;while(!1);if(f=o[5859]|0,f>>>0>=fe>>>0)return h=f-fe|0,u=o[5862]|0,h>>>0>15?(ft=u+fe|0,o[5862]=ft,o[5859]=h,o[ft+4>>2]=h|1,o[u+f>>2]=h,o[u+4>>2]=fe|3):(o[5859]=0,o[5862]=0,o[u+4>>2]=f|3,ft=u+f+4|0,o[ft>>2]=o[ft>>2]|1),ft=u+8|0,Ze=Ai,ft|0;if(R=o[5860]|0,R>>>0>fe>>>0)return st=R-fe|0,o[5860]=st,ft=o[5863]|0,ht=ft+fe|0,o[5863]=ht,o[ht+4>>2]=st|1,o[ft+4>>2]=fe|3,ft=ft+8|0,Ze=Ai,ft|0;if(o[5975]|0?u=o[5977]|0:(o[5977]=4096,o[5976]=4096,o[5978]=-1,o[5979]=-1,o[5980]=0,o[5968]=0,o[5975]=ye&-16^1431655768,u=4096),V=fe+48|0,W=fe+47|0,I=u+W|0,b=0-u|0,Y=I&b,Y>>>0<=fe>>>0||(u=o[5967]|0,u|0&&(le=o[5965]|0,ye=le+Y|0,ye>>>0<=le>>>0|ye>>>0>u>>>0)))return ft=0,Ze=Ai,ft|0;e:do if(o[5968]&4)h=0,qe=143;else{f=o[5863]|0;t:do if(f){for(y=23876;ye=o[y>>2]|0,!(ye>>>0<=f>>>0&&(ye+(o[y+4>>2]|0)|0)>>>0>f>>>0);)if(u=o[y+8>>2]|0,u)y=u;else{qe=128;break t}if(h=I-R&b,h>>>0<2147483647)if(u=Z(h|0)|0,(u|0)==((o[y>>2]|0)+(o[y+4>>2]|0)|0)){if((u|0)!=-1){R=h,I=u,qe=145;break e}}else y=u,qe=136;else h=0}else qe=128;while(!1);do if((qe|0)==128)if(f=Z(0)|0,(f|0)!=-1&&(h=f,Ie=o[5976]|0,ke=Ie+-1|0,h=(ke&h|0?(ke+h&0-Ie)-h|0:0)+Y|0,Ie=o[5965]|0,ke=h+Ie|0,h>>>0>fe>>>0&h>>>0<2147483647)){if(ye=o[5967]|0,ye|0&&ke>>>0<=Ie>>>0|ke>>>0>ye>>>0){h=0;break}if(u=Z(h|0)|0,(u|0)==(f|0)){R=h,I=f,qe=145;break e}else y=u,qe=136}else h=0;while(!1);do if((qe|0)==136){if(f=0-h|0,!(V>>>0>h>>>0&(h>>>0<2147483647&(y|0)!=-1)))if((y|0)==-1){h=0;break}else{R=h,I=y,qe=145;break e}if(u=o[5977]|0,u=W-h+u&0-u,u>>>0>=2147483647){R=h,I=y,qe=145;break e}if((Z(u|0)|0)==-1){Z(f|0)|0,h=0;break}else{R=u+h|0,I=y,qe=145;break e}}while(!1);o[5968]=o[5968]|4,qe=143}while(!1);if((qe|0)==143&&Y>>>0<2147483647&&(st=Z(Y|0)|0,ke=Z(0)|0,ut=ke-st|0,mt=ut>>>0>(fe+40|0)>>>0,!((st|0)==-1|mt^1|st>>>0<ke>>>0&((st|0)!=-1&(ke|0)!=-1)^1))&&(R=mt?ut:h,I=st,qe=145),(qe|0)==145){h=(o[5965]|0)+R|0,o[5965]=h,h>>>0>(o[5966]|0)>>>0&&(o[5966]=h),W=o[5863]|0;e:do if(W){for(h=23876;;){if(u=o[h>>2]|0,f=o[h+4>>2]|0,(I|0)==(u+f|0)){qe=154;break}if(y=o[h+8>>2]|0,y)h=y;else break}if((qe|0)==154&&(ht=h+4|0,(o[h+12>>2]&8|0)==0)&&I>>>0>W>>>0&u>>>0<=W>>>0){o[ht>>2]=f+R,ft=(o[5860]|0)+R|0,st=W+8|0,st=st&7|0?0-st&7:0,ht=W+st|0,st=ft-st|0,o[5863]=ht,o[5860]=st,o[ht+4>>2]=st|1,o[W+ft+4>>2]=40,o[5864]=o[5979];break}for(I>>>0<(o[5861]|0)>>>0&&(o[5861]=I),f=I+R|0,h=23876;;){if((o[h>>2]|0)==(f|0)){qe=162;break}if(u=o[h+8>>2]|0,u)h=u;else break}if((qe|0)==162&&!(o[h+12>>2]&8|0)){o[h>>2]=I,le=h+4|0,o[le>>2]=(o[le>>2]|0)+R,le=I+8|0,le=I+(le&7|0?0-le&7:0)|0,h=f+8|0,h=f+(h&7|0?0-h&7:0)|0,Y=le+fe|0,V=h-le-fe|0,o[le+4>>2]=fe|3;t:do if((W|0)==(h|0))ft=(o[5860]|0)+V|0,o[5860]=ft,o[5863]=Y,o[Y+4>>2]=ft|1;else{if((o[5862]|0)==(h|0)){ft=(o[5859]|0)+V|0,o[5859]=ft,o[5862]=Y,o[Y+4>>2]=ft|1,o[Y+ft>>2]=ft;break}if(u=o[h+4>>2]|0,(u&3|0)==1){R=u&-8,y=u>>>3;i:do if(u>>>0<256)if(u=o[h+8>>2]|0,f=o[h+12>>2]|0,(f|0)==(u|0)){o[5857]=o[5857]&~(1<<y);break}else{o[u+12>>2]=f,o[f+8>>2]=u;break}else{I=o[h+24>>2]|0,u=o[h+12>>2]|0;do if((u|0)==(h|0)){if(f=h+16|0,y=f+4|0,u=o[y>>2]|0,u)f=y;else if(u=o[f>>2]|0,!u){u=0;break}for(;;)if(b=u+20|0,y=o[b>>2]|0,y)u=y,f=b;else if(b=u+16|0,y=o[b>>2]|0,y)u=y,f=b;else break;o[f>>2]=0}else ft=o[h+8>>2]|0,o[ft+12>>2]=u,o[u+8>>2]=ft;while(!1);if(!I)break;f=o[h+28>>2]|0,y=23732+(f<<2)|0;do if((o[y>>2]|0)!=(h|0)){if(ft=I+16|0,o[((o[ft>>2]|0)==(h|0)?ft:I+20|0)>>2]=u,!u)break i}else{if(o[y>>2]=u,u|0)break;o[5858]=o[5858]&~(1<<f);break i}while(!1);if(o[u+24>>2]=I,f=h+16|0,y=o[f>>2]|0,y|0&&(o[u+16>>2]=y,o[y+24>>2]=u),f=o[f+4>>2]|0,!f)break;o[u+20>>2]=f,o[f+24>>2]=u}while(!1);h=h+R|0,b=R+V|0}else b=V;if(h=h+4|0,o[h>>2]=o[h>>2]&-2,o[Y+4>>2]=b|1,o[Y+b>>2]=b,h=b>>>3,b>>>0<256){f=23468+(h<<1<<2)|0,u=o[5857]|0,h=1<<h,u&h?(u=f+8|0,h=o[u>>2]|0):(o[5857]=u|h,h=f,u=f+8|0),o[u>>2]=Y,o[h+12>>2]=Y,o[Y+8>>2]=h,o[Y+12>>2]=f;break}h=b>>>8;do if(!h)y=0;else{if(b>>>0>16777215){y=31;break}ht=(h+1048320|0)>>>16&8,ft=h<<ht,st=(ft+520192|0)>>>16&4,ft=ft<<st,y=(ft+245760|0)>>>16&2,y=14-(st|ht|y)+(ft<<y>>>15)|0,y=b>>>(y+7|0)&1|y<<1}while(!1);if(h=23732+(y<<2)|0,o[Y+28>>2]=y,u=Y+16|0,o[u+4>>2]=0,o[u>>2]=0,u=o[5858]|0,f=1<<y,!(u&f)){o[5858]=u|f,o[h>>2]=Y,o[Y+24>>2]=h,o[Y+12>>2]=Y,o[Y+8>>2]=Y;break}h=o[h>>2]|0;i:do if((o[h+4>>2]&-8|0)!=(b|0)){for(y=b<<((y|0)==31?0:25-(y>>>1)|0);f=h+16+(y>>>31<<2)|0,u=o[f>>2]|0,!!u;)if((o[u+4>>2]&-8|0)==(b|0)){h=u;break i}else y=y<<1,h=u;o[f>>2]=Y,o[Y+24>>2]=h,o[Y+12>>2]=Y,o[Y+8>>2]=Y;break t}while(!1);ht=h+8|0,ft=o[ht>>2]|0,o[ft+12>>2]=Y,o[ht>>2]=Y,o[Y+8>>2]=ft,o[Y+12>>2]=h,o[Y+24>>2]=0}while(!1);return ft=le+8|0,Ze=Ai,ft|0}for(h=23876;u=o[h>>2]|0,!(u>>>0<=W>>>0&&(ft=u+(o[h+4>>2]|0)|0,ft>>>0>W>>>0));)h=o[h+8>>2]|0;b=ft+-47|0,u=b+8|0,u=b+(u&7|0?0-u&7:0)|0,b=W+16|0,u=u>>>0<b>>>0?W:u,h=u+8|0,f=R+-40|0,st=I+8|0,st=st&7|0?0-st&7:0,ht=I+st|0,st=f-st|0,o[5863]=ht,o[5860]=st,o[ht+4>>2]=st|1,o[I+f+4>>2]=40,o[5864]=o[5979],f=u+4|0,o[f>>2]=27,o[h>>2]=o[5969],o[h+4>>2]=o[5970],o[h+8>>2]=o[5971],o[h+12>>2]=o[5972],o[5969]=I,o[5970]=R,o[5972]=0,o[5971]=h,h=u+24|0;do ht=h,h=h+4|0,o[h>>2]=7;while((ht+8|0)>>>0<ft>>>0);if((u|0)!=(W|0)){if(I=u-W|0,o[f>>2]=o[f>>2]&-2,o[W+4>>2]=I|1,o[u>>2]=I,h=I>>>3,I>>>0<256){f=23468+(h<<1<<2)|0,u=o[5857]|0,h=1<<h,u&h?(u=f+8|0,h=o[u>>2]|0):(o[5857]=u|h,h=f,u=f+8|0),o[u>>2]=W,o[h+12>>2]=W,o[W+8>>2]=h,o[W+12>>2]=f;break}if(h=I>>>8,h?I>>>0>16777215?y=31:(ht=(h+1048320|0)>>>16&8,ft=h<<ht,st=(ft+520192|0)>>>16&4,ft=ft<<st,y=(ft+245760|0)>>>16&2,y=14-(st|ht|y)+(ft<<y>>>15)|0,y=I>>>(y+7|0)&1|y<<1):y=0,f=23732+(y<<2)|0,o[W+28>>2]=y,o[W+20>>2]=0,o[b>>2]=0,h=o[5858]|0,u=1<<y,!(h&u)){o[5858]=h|u,o[f>>2]=W,o[W+24>>2]=f,o[W+12>>2]=W,o[W+8>>2]=W;break}h=o[f>>2]|0;t:do if((o[h+4>>2]&-8|0)!=(I|0)){for(y=I<<((y|0)==31?0:25-(y>>>1)|0);f=h+16+(y>>>31<<2)|0,u=o[f>>2]|0,!!u;)if((o[u+4>>2]&-8|0)==(I|0)){h=u;break t}else y=y<<1,h=u;o[f>>2]=W,o[W+24>>2]=h,o[W+12>>2]=W,o[W+8>>2]=W;break e}while(!1);ht=h+8|0,ft=o[ht>>2]|0,o[ft+12>>2]=W,o[ht>>2]=W,o[W+8>>2]=ft,o[W+12>>2]=h,o[W+24>>2]=0}}else ft=o[5861]|0,(ft|0)==0|I>>>0<ft>>>0&&(o[5861]=I),o[5969]=I,o[5970]=R,o[5972]=0,o[5866]=o[5975],o[5865]=-1,o[5870]=23468,o[5869]=23468,o[5872]=23476,o[5871]=23476,o[5874]=23484,o[5873]=23484,o[5876]=23492,o[5875]=23492,o[5878]=23500,o[5877]=23500,o[5880]=23508,o[5879]=23508,o[5882]=23516,o[5881]=23516,o[5884]=23524,o[5883]=23524,o[5886]=23532,o[5885]=23532,o[5888]=23540,o[5887]=23540,o[5890]=23548,o[5889]=23548,o[5892]=23556,o[5891]=23556,o[5894]=23564,o[5893]=23564,o[5896]=23572,o[5895]=23572,o[5898]=23580,o[5897]=23580,o[5900]=23588,o[5899]=23588,o[5902]=23596,o[5901]=23596,o[5904]=23604,o[5903]=23604,o[5906]=23612,o[5905]=23612,o[5908]=23620,o[5907]=23620,o[5910]=23628,o[5909]=23628,o[5912]=23636,o[5911]=23636,o[5914]=23644,o[5913]=23644,o[5916]=23652,o[5915]=23652,o[5918]=23660,o[5917]=23660,o[5920]=23668,o[5919]=23668,o[5922]=23676,o[5921]=23676,o[5924]=23684,o[5923]=23684,o[5926]=23692,o[5925]=23692,o[5928]=23700,o[5927]=23700,o[5930]=23708,o[5929]=23708,o[5932]=23716,o[5931]=23716,ft=R+-40|0,st=I+8|0,st=st&7|0?0-st&7:0,ht=I+st|0,st=ft-st|0,o[5863]=ht,o[5860]=st,o[ht+4>>2]=st|1,o[I+ft+4>>2]=40,o[5864]=o[5979];while(!1);if(h=o[5860]|0,h>>>0>fe>>>0)return st=h-fe|0,o[5860]=st,ft=o[5863]|0,ht=ft+fe|0,o[5863]=ht,o[ht+4>>2]=st|1,o[ft+4>>2]=fe|3,ft=ft+8|0,Ze=Ai,ft|0}return ft=Vl()|0,o[ft>>2]=12,ft=0,Ze=Ai,ft|0}function x(u){u=u|0;var h=0,f=0,y=0,b=0,I=0,R=0,V=0,W=0;if(u){f=u+-8|0,b=o[5861]|0,u=o[u+-4>>2]|0,h=u&-8,W=f+h|0;do if(u&1)V=f,R=f;else{if(y=o[f>>2]|0,!(u&3)||(R=f+(0-y)|0,I=y+h|0,R>>>0<b>>>0))return;if((o[5862]|0)==(R|0)){if(u=W+4|0,h=o[u>>2]|0,(h&3|0)!=3){V=R,h=I;break}o[5859]=I,o[u>>2]=h&-2,o[R+4>>2]=I|1,o[R+I>>2]=I;return}if(f=y>>>3,y>>>0<256)if(u=o[R+8>>2]|0,h=o[R+12>>2]|0,(h|0)==(u|0)){o[5857]=o[5857]&~(1<<f),V=R,h=I;break}else{o[u+12>>2]=h,o[h+8>>2]=u,V=R,h=I;break}b=o[R+24>>2]|0,u=o[R+12>>2]|0;do if((u|0)==(R|0)){if(h=R+16|0,f=h+4|0,u=o[f>>2]|0,u)h=f;else if(u=o[h>>2]|0,!u){u=0;break}for(;;)if(y=u+20|0,f=o[y>>2]|0,f)u=f,h=y;else if(y=u+16|0,f=o[y>>2]|0,f)u=f,h=y;else break;o[h>>2]=0}else V=o[R+8>>2]|0,o[V+12>>2]=u,o[u+8>>2]=V;while(!1);if(b){if(h=o[R+28>>2]|0,f=23732+(h<<2)|0,(o[f>>2]|0)==(R|0)){if(o[f>>2]=u,!u){o[5858]=o[5858]&~(1<<h),V=R,h=I;break}}else if(V=b+16|0,o[((o[V>>2]|0)==(R|0)?V:b+20|0)>>2]=u,!u){V=R,h=I;break}o[u+24>>2]=b,h=R+16|0,f=o[h>>2]|0,f|0&&(o[u+16>>2]=f,o[f+24>>2]=u),h=o[h+4>>2]|0,h?(o[u+20>>2]=h,o[h+24>>2]=u,V=R,h=I):(V=R,h=I)}else V=R,h=I}while(!1);if(!(R>>>0>=W>>>0)&&(u=W+4|0,y=o[u>>2]|0,!!(y&1))){if(y&2)o[u>>2]=y&-2,o[V+4>>2]=h|1,o[R+h>>2]=h,b=h;else{if((o[5863]|0)==(W|0)){if(W=(o[5860]|0)+h|0,o[5860]=W,o[5863]=V,o[V+4>>2]=W|1,(V|0)!=(o[5862]|0))return;o[5862]=0,o[5859]=0;return}if((o[5862]|0)==(W|0)){W=(o[5859]|0)+h|0,o[5859]=W,o[5862]=R,o[V+4>>2]=W|1,o[R+W>>2]=W;return}b=(y&-8)+h|0,f=y>>>3;do if(y>>>0<256)if(h=o[W+8>>2]|0,u=o[W+12>>2]|0,(u|0)==(h|0)){o[5857]=o[5857]&~(1<<f);break}else{o[h+12>>2]=u,o[u+8>>2]=h;break}else{I=o[W+24>>2]|0,u=o[W+12>>2]|0;do if((u|0)==(W|0)){if(h=W+16|0,f=h+4|0,u=o[f>>2]|0,u)h=f;else if(u=o[h>>2]|0,!u){f=0;break}for(;;)if(y=u+20|0,f=o[y>>2]|0,f)u=f,h=y;else if(y=u+16|0,f=o[y>>2]|0,f)u=f,h=y;else break;o[h>>2]=0,f=u}else f=o[W+8>>2]|0,o[f+12>>2]=u,o[u+8>>2]=f,f=u;while(!1);if(I|0){if(u=o[W+28>>2]|0,h=23732+(u<<2)|0,(o[h>>2]|0)==(W|0)){if(o[h>>2]=f,!f){o[5858]=o[5858]&~(1<<u);break}}else if(y=I+16|0,o[((o[y>>2]|0)==(W|0)?y:I+20|0)>>2]=f,!f)break;o[f+24>>2]=I,u=W+16|0,h=o[u>>2]|0,h|0&&(o[f+16>>2]=h,o[h+24>>2]=f),u=o[u+4>>2]|0,u|0&&(o[f+20>>2]=u,o[u+24>>2]=f)}}while(!1);if(o[V+4>>2]=b|1,o[R+b>>2]=b,(V|0)==(o[5862]|0)){o[5859]=b;return}}if(u=b>>>3,b>>>0<256){f=23468+(u<<1<<2)|0,h=o[5857]|0,u=1<<u,h&u?(h=f+8|0,u=o[h>>2]|0):(o[5857]=h|u,u=f,h=f+8|0),o[h>>2]=V,o[u+12>>2]=V,o[V+8>>2]=u,o[V+12>>2]=f;return}u=b>>>8,u?b>>>0>16777215?y=31:(R=(u+1048320|0)>>>16&8,W=u<<R,I=(W+520192|0)>>>16&4,W=W<<I,y=(W+245760|0)>>>16&2,y=14-(I|R|y)+(W<<y>>>15)|0,y=b>>>(y+7|0)&1|y<<1):y=0,u=23732+(y<<2)|0,o[V+28>>2]=y,o[V+20>>2]=0,o[V+16>>2]=0,h=o[5858]|0,f=1<<y;e:do if(!(h&f))o[5858]=h|f,o[u>>2]=V,o[V+24>>2]=u,o[V+12>>2]=V,o[V+8>>2]=V;else{u=o[u>>2]|0;t:do if((o[u+4>>2]&-8|0)!=(b|0)){for(y=b<<((y|0)==31?0:25-(y>>>1)|0);f=u+16+(y>>>31<<2)|0,h=o[f>>2]|0,!!h;)if((o[h+4>>2]&-8|0)==(b|0)){u=h;break t}else y=y<<1,u=h;o[f>>2]=V,o[V+24>>2]=u,o[V+12>>2]=V,o[V+8>>2]=V;break e}while(!1);R=u+8|0,W=o[R>>2]|0,o[W+12>>2]=V,o[R>>2]=V,o[V+8>>2]=W,o[V+12>>2]=u,o[V+24>>2]=0}while(!1);if(W=(o[5865]|0)+-1|0,o[5865]=W,!(W|0)){for(u=23884;u=o[u>>2]|0,u;)u=u+8|0;o[5865]=-1}}}}function T(u,h){u=u|0,h=h|0;var f=0;return u?(f=nn(h,u)|0,(h|u)>>>0>65535&&(f=((f>>>0)/(u>>>0)|0|0)==(h|0)?f:-1)):f=0,u=Zn(f)|0,!u||!(o[u+-4>>2]&3)||k(u|0,0,f|0)|0,u|0}function M(u,h,f,y){return u=u|0,h=h|0,f=f|0,y=y|0,f=u+f>>>0,Di(h+y+(f>>>0<u>>>0|0)>>>0|0),f|0|0}function L(u,h,f,y){return u=u|0,h=h|0,f=f|0,y=y|0,y=h-y-(f>>>0>u>>>0|0)>>>0,Di(y|0),u-f>>>0|0|0}function j(u){return u=u|0,(u?31-(gt(u^u-1)|0)|0:32)|0}function H(u,h,f,y,b){u=u|0,h=h|0,f=f|0,y=y|0,b=b|0;var I=0,R=0,V=0,W=0,Y=0,le=0,fe=0,ye=0,Ie=0,ke=0;if(le=u,W=h,Y=W,R=f,ye=y,V=ye,!Y)return I=(b|0)!=0,V?I?(o[b>>2]=u|0,o[b+4>>2]=h&0,ye=0,b=0,Di(ye|0),b|0):(ye=0,b=0,Di(ye|0),b|0):(I&&(o[b>>2]=(le>>>0)%(R>>>0),o[b+4>>2]=0),ye=0,b=(le>>>0)/(R>>>0)>>>0,Di(ye|0),b|0);I=(V|0)==0;do if(R){if(!I){if(I=(gt(V|0)|0)-(gt(Y|0)|0)|0,I>>>0<=31){fe=I+1|0,V=31-I|0,h=I-31>>31,R=fe,u=le>>>(fe>>>0)&h|Y<<V,h=Y>>>(fe>>>0)&h,I=0,V=le<<V;break}return b?(o[b>>2]=u|0,o[b+4>>2]=W|h&0,ye=0,b=0,Di(ye|0),b|0):(ye=0,b=0,Di(ye|0),b|0)}if(I=R-1|0,I&R|0){V=(gt(R|0)|0)+33-(gt(Y|0)|0)|0,ke=64-V|0,fe=32-V|0,W=fe>>31,Ie=V-32|0,h=Ie>>31,R=V,u=fe-1>>31&Y>>>(Ie>>>0)|(Y<<fe|le>>>(V>>>0))&h,h=h&Y>>>(V>>>0),I=le<<ke&W,V=(Y<<ke|le>>>(Ie>>>0))&W|le<<fe&V-33>>31;break}return b|0&&(o[b>>2]=I&le,o[b+4>>2]=0),(R|0)==1?(Ie=W|h&0,ke=u|0|0,Di(Ie|0),ke|0):(ke=j(R|0)|0,Ie=Y>>>(ke>>>0)|0,ke=Y<<32-ke|le>>>(ke>>>0)|0,Di(Ie|0),ke|0)}else{if(I)return b|0&&(o[b>>2]=(Y>>>0)%(R>>>0),o[b+4>>2]=0),Ie=0,ke=(Y>>>0)/(R>>>0)>>>0,Di(Ie|0),ke|0;if(!le)return b|0&&(o[b>>2]=0,o[b+4>>2]=(Y>>>0)%(V>>>0)),Ie=0,ke=(Y>>>0)/(V>>>0)>>>0,Di(Ie|0),ke|0;if(I=V-1|0,!(I&V))return b|0&&(o[b>>2]=u|0,o[b+4>>2]=I&Y|h&0),Ie=0,ke=Y>>>((j(V|0)|0)>>>0),Di(Ie|0),ke|0;if(I=(gt(V|0)|0)-(gt(Y|0)|0)|0,I>>>0<=30){h=I+1|0,V=31-I|0,R=h,u=Y<<V|le>>>(h>>>0),h=Y>>>(h>>>0),I=0,V=le<<V;break}return b?(o[b>>2]=u|0,o[b+4>>2]=W|h&0,Ie=0,ke=0,Di(Ie|0),ke|0):(Ie=0,ke=0,Di(Ie|0),ke|0)}while(!1);if(!R)Y=V,W=0,V=0;else{fe=f|0|0,le=ye|y&0,Y=M(fe|0,le|0,-1,-1)|0,f=Je()|0,W=V,V=0;do y=W,W=I>>>31|W<<1,I=V|I<<1,y=u<<1|y>>>31|0,ye=u>>>31|h<<1|0,L(Y|0,f|0,y|0,ye|0)|0,ke=Je()|0,Ie=ke>>31|((ke|0)<0?-1:0)<<1,V=Ie&1,u=L(y|0,ye|0,Ie&fe|0,(((ke|0)<0?-1:0)>>31|((ke|0)<0?-1:0)<<1)&le|0)|0,h=Je()|0,R=R-1|0;while(R|0);Y=W,W=0}return R=0,b|0&&(o[b>>2]=u,o[b+4>>2]=h),Ie=(I|0)>>>31|(Y|R)<<1|(R<<1|I>>>31)&0|W,ke=(I<<1|0)&-2|V,Di(Ie|0),ke|0}function Q(u,h,f,y){u=u|0,h=h|0,f=f|0,y=y|0;var b=0,I=0,R=0,V=0,W=0,Y=0;return Y=h>>31|((h|0)<0?-1:0)<<1,W=((h|0)<0?-1:0)>>31|((h|0)<0?-1:0)<<1,I=y>>31|((y|0)<0?-1:0)<<1,b=((y|0)<0?-1:0)>>31|((y|0)<0?-1:0)<<1,V=L(Y^u|0,W^h|0,Y|0,W|0)|0,R=Je()|0,u=I^Y,h=b^W,L((H(V,R,L(I^f|0,b^y|0,I|0,b|0)|0,Je()|0,0)|0)^u|0,(Je()|0)^h|0,u|0,h|0)|0}function K(u,h){u=u|0,h=h|0;var f=0,y=0,b=0,I=0;return I=u&65535,b=h&65535,f=nn(b,I)|0,y=u>>>16,u=(f>>>16)+(nn(b,y)|0)|0,b=h>>>16,h=nn(b,I)|0,Di((u>>>16)+(nn(b,y)|0)+(((u&65535)+h|0)>>>16)|0),u+h<<16|f&65535|0|0}function ue(u,h,f,y){u=u|0,h=h|0,f=f|0,y=y|0;var b=0,I=0;return b=u,I=f,f=K(b,I)|0,u=Je()|0,Di((nn(h,I)|0)+(nn(y,b)|0)+u|u&0|0),f|0|0|0}function Se(u,h,f,y){u=u|0,h=h|0,f=f|0,y=y|0;var b=0,I=0,R=0,V=0,W=0,Y=0;return b=Ze,Ze=Ze+16|0,V=b|0,R=h>>31|((h|0)<0?-1:0)<<1,I=((h|0)<0?-1:0)>>31|((h|0)<0?-1:0)<<1,Y=y>>31|((y|0)<0?-1:0)<<1,W=((y|0)<0?-1:0)>>31|((y|0)<0?-1:0)<<1,u=L(R^u|0,I^h|0,R|0,I|0)|0,h=Je()|0,H(u,h,L(Y^f|0,W^y|0,Y|0,W|0)|0,Je()|0,V)|0,y=L(o[V>>2]^R|0,o[V+4>>2]^I|0,R|0,I|0)|0,f=Je()|0,Ze=b,Di(f|0),y|0}function De(u,h,f,y){u=u|0,h=h|0,f=f|0,y=y|0;var b=0,I=0;return I=Ze,Ze=Ze+16|0,b=I|0,H(u,h,f,y,b)|0,Ze=I,Di(o[b+4>>2]|0),o[b>>2]|0|0}function _t(u,h,f){return u=u|0,h=h|0,f=f|0,(f|0)<32?(Di(h>>f|0),u>>>f|(h&(1<<f)-1)<<32-f):(Di(((h|0)<0?-1:0)|0),h>>f-32|0)}function Xe(u,h,f){return u=u|0,h=h|0,f=f|0,(f|0)<32?(Di(h>>>f|0),u>>>f|(h&(1<<f)-1)<<32-f):(Di(0),h>>>f-32|0)}function tt(u,h,f){return u=u|0,h=h|0,f=f|0,(f|0)<32?(Di(h<<f|(u&(1<<f)-1<<32-f)>>>32-f|0),u<<f):(Di(u<<f-32|0),0)}function z(u,h){return u=+u,h=+h,u!=u?+h:h!=h?+u:+Dr(+u,+h)}function l(u,h){return u=+u,h=+h,u!=u?+h:h!=h?+u:+qo(+u,+h)}function g(u){return u=+u,u>=0?+yi(u+.5):+ko(u-.5)}function S(u,h,f){u=u|0,h=h|0,f=f|0;var y=0,b=0,I=0;if((f|0)>=8192)return kl(u|0,h|0,f|0)|0,u|0;if(I=u|0,b=u+f|0,(u&3)==(h&3)){for(;u&3;){if(!f)return I|0;Pt[u>>0]=Pt[h>>0]|0,u=u+1|0,h=h+1|0,f=f-1|0}for(f=b&-4|0,y=f-64|0;(u|0)<=(y|0);)o[u>>2]=o[h>>2],o[u+4>>2]=o[h+4>>2],o[u+8>>2]=o[h+8>>2],o[u+12>>2]=o[h+12>>2],o[u+16>>2]=o[h+16>>2],o[u+20>>2]=o[h+20>>2],o[u+24>>2]=o[h+24>>2],o[u+28>>2]=o[h+28>>2],o[u+32>>2]=o[h+32>>2],o[u+36>>2]=o[h+36>>2],o[u+40>>2]=o[h+40>>2],o[u+44>>2]=o[h+44>>2],o[u+48>>2]=o[h+48>>2],o[u+52>>2]=o[h+52>>2],o[u+56>>2]=o[h+56>>2],o[u+60>>2]=o[h+60>>2],u=u+64|0,h=h+64|0;for(;(u|0)<(f|0);)o[u>>2]=o[h>>2],u=u+4|0,h=h+4|0}else for(f=b-4|0;(u|0)<(f|0);)Pt[u>>0]=Pt[h>>0]|0,Pt[u+1>>0]=Pt[h+1>>0]|0,Pt[u+2>>0]=Pt[h+2>>0]|0,Pt[u+3>>0]=Pt[h+3>>0]|0,u=u+4|0,h=h+4|0;for(;(u|0)<(b|0);)Pt[u>>0]=Pt[h>>0]|0,u=u+1|0,h=h+1|0;return I|0}function k(u,h,f){u=u|0,h=h|0,f=f|0;var y=0,b=0,I=0,R=0;if(I=u+f|0,h=h&255,(f|0)>=67){for(;u&3;)Pt[u>>0]=h,u=u+1|0;for(y=I&-4|0,R=h|h<<8|h<<16|h<<24,b=y-64|0;(u|0)<=(b|0);)o[u>>2]=R,o[u+4>>2]=R,o[u+8>>2]=R,o[u+12>>2]=R,o[u+16>>2]=R,o[u+20>>2]=R,o[u+24>>2]=R,o[u+28>>2]=R,o[u+32>>2]=R,o[u+36>>2]=R,o[u+40>>2]=R,o[u+44>>2]=R,o[u+48>>2]=R,o[u+52>>2]=R,o[u+56>>2]=R,o[u+60>>2]=R,u=u+64|0;for(;(u|0)<(y|0);)o[u>>2]=R,u=u+4|0}for(;(u|0)<(I|0);)Pt[u>>0]=h,u=u+1|0;return I-f|0}function F(u){return u=+u,u>=0?+yi(u+.5):+ko(u-.5)}function Z(u){u=u|0;var h=0,f=0,y=0;return y=DA()|0,f=o[xi>>2]|0,h=f+u|0,(u|0)>0&(h|0)<(f|0)|(h|0)<0?(yn(h|0)|0,Hs(12),-1):(h|0)>(y|0)&&!(nt(h|0)|0)?(Hs(12),-1):(o[xi>>2]=h,f|0)}return{___divdi3:Q,___muldi3:ue,___remdi3:Se,___uremdi3:De,_areNeighborCells:uo,_bitshift64Ashr:_t,_bitshift64Lshr:Xe,_bitshift64Shl:tt,_calloc:T,_cellAreaKm2:wa,_cellAreaM2:al,_cellAreaRads2:Xo,_cellToBoundary:Rn,_cellToCenterChild:il,_cellToChildPos:ba,_cellToChildren:Ec,_cellToChildrenSize:pl,_cellToLatLng:va,_cellToLocalIj:Al,_cellToParent:zo,_cellToVertex:mr,_cellToVertexes:Yo,_cellsToDirectedEdge:so,_cellsToLinkedMultiPolygon:YA,_childPosToCell:Fl,_compactCells:Na,_destroyLinkedMultiPolygon:ll,_directedEdgeToBoundary:Vs,_directedEdgeToCells:ya,_edgeLengthKm:vu,_edgeLengthM:ic,_edgeLengthRads:yl,_emscripten_replace_memory:As,_free:x,_getBaseCellNumber:tl,_getDirectedEdgeDestination:Jl,_getDirectedEdgeOrigin:Bl,_getHexagonAreaAvgKm2:RA,_getHexagonAreaAvgM2:ol,_getHexagonEdgeLengthAvgKm:tc,_getHexagonEdgeLengthAvgM:gl,_getIcosahedronFaces:rl,_getNumCells:FA,_getPentagons:fo,_getRes0Cells:ta,_getResolution:Tc,_greatCircleDistanceKm:po,_greatCircleDistanceM:sa,_greatCircleDistanceRads:Mc,_gridDisk:Qo,_gridDiskDistances:Fs,_gridDistance:Si,_gridPathCells:OA,_gridPathCellsSize:iA,_gridRingUnsafe:$A,_i64Add:M,_i64Subtract:L,_isPentagon:Ln,_isResClassIII:Ns,_isValidCell:pA,_isValidDirectedEdge:hs,_isValidVertex:Ol,_latLngToCell:$o,_llvm_maxnum_f64:z,_llvm_minnum_f64:l,_llvm_round_f64:g,_localIjToCell:rc,_malloc:Zn,_maxFaceCount:Ua,_maxGridDiskSize:mn,_maxPolygonToCellsSize:XA,_memcpy:S,_memset:k,_originToDirectedEdges:Ll,_pentagonCount:_l,_polygonToCells:uA,_readInt64AsDoubleFromPointer:rA,_res0CellCount:xn,_round:F,_sbrk:Z,_sizeOfCellBoundary:NA,_sizeOfCoordIJ:Ta,_sizeOfGeoLoop:UA,_sizeOfGeoPolygon:Ji,_sizeOfH3Index:Ms,_sizeOfLatLng:gA,_sizeOfLinkedGeoPolygon:To,_uncompactCells:xu,_uncompactCellsSize:Ps,_vertexToLatLng:ac,establishStackSpace:Xi,stackAlloc:Xl,stackRestore:WA,stackSave:ro}}(io,Sr,tr);ne.___divdi3=kt.___divdi3,ne.___muldi3=kt.___muldi3,ne.___remdi3=kt.___remdi3,ne.___uremdi3=kt.___uremdi3,ne._areNeighborCells=kt._areNeighborCells,ne._bitshift64Ashr=kt._bitshift64Ashr,ne._bitshift64Lshr=kt._bitshift64Lshr,ne._bitshift64Shl=kt._bitshift64Shl,ne._calloc=kt._calloc,ne._cellAreaKm2=kt._cellAreaKm2,ne._cellAreaM2=kt._cellAreaM2,ne._cellAreaRads2=kt._cellAreaRads2,ne._cellToBoundary=kt._cellToBoundary,ne._cellToCenterChild=kt._cellToCenterChild,ne._cellToChildPos=kt._cellToChildPos,ne._cellToChildren=kt._cellToChildren,ne._cellToChildrenSize=kt._cellToChildrenSize,ne._cellToLatLng=kt._cellToLatLng,ne._cellToLocalIj=kt._cellToLocalIj,ne._cellToParent=kt._cellToParent,ne._cellToVertex=kt._cellToVertex,ne._cellToVertexes=kt._cellToVertexes,ne._cellsToDirectedEdge=kt._cellsToDirectedEdge,ne._cellsToLinkedMultiPolygon=kt._cellsToLinkedMultiPolygon,ne._childPosToCell=kt._childPosToCell,ne._compactCells=kt._compactCells,ne._destroyLinkedMultiPolygon=kt._destroyLinkedMultiPolygon,ne._directedEdgeToBoundary=kt._directedEdgeToBoundary,ne._directedEdgeToCells=kt._directedEdgeToCells,ne._edgeLengthKm=kt._edgeLengthKm,ne._edgeLengthM=kt._edgeLengthM,ne._edgeLengthRads=kt._edgeLengthRads;var we=ne._emscripten_replace_memory=kt._emscripten_replace_memory;ne._free=kt._free,ne._getBaseCellNumber=kt._getBaseCellNumber,ne._getDirectedEdgeDestination=kt._getDirectedEdgeDestination,ne._getDirectedEdgeOrigin=kt._getDirectedEdgeOrigin,ne._getHexagonAreaAvgKm2=kt._getHexagonAreaAvgKm2,ne._getHexagonAreaAvgM2=kt._getHexagonAreaAvgM2,ne._getHexagonEdgeLengthAvgKm=kt._getHexagonEdgeLengthAvgKm,ne._getHexagonEdgeLengthAvgM=kt._getHexagonEdgeLengthAvgM,ne._getIcosahedronFaces=kt._getIcosahedronFaces,ne._getNumCells=kt._getNumCells,ne._getPentagons=kt._getPentagons,ne._getRes0Cells=kt._getRes0Cells,ne._getResolution=kt._getResolution,ne._greatCircleDistanceKm=kt._greatCircleDistanceKm,ne._greatCircleDistanceM=kt._greatCircleDistanceM,ne._greatCircleDistanceRads=kt._greatCircleDistanceRads,ne._gridDisk=kt._gridDisk,ne._gridDiskDistances=kt._gridDiskDistances,ne._gridDistance=kt._gridDistance,ne._gridPathCells=kt._gridPathCells,ne._gridPathCellsSize=kt._gridPathCellsSize,ne._gridRingUnsafe=kt._gridRingUnsafe,ne._i64Add=kt._i64Add,ne._i64Subtract=kt._i64Subtract,ne._isPentagon=kt._isPentagon,ne._isResClassIII=kt._isResClassIII,ne._isValidCell=kt._isValidCell,ne._isValidDirectedEdge=kt._isValidDirectedEdge,ne._isValidVertex=kt._isValidVertex,ne._latLngToCell=kt._latLngToCell,ne._llvm_maxnum_f64=kt._llvm_maxnum_f64,ne._llvm_minnum_f64=kt._llvm_minnum_f64,ne._llvm_round_f64=kt._llvm_round_f64,ne._localIjToCell=kt._localIjToCell,ne._malloc=kt._malloc,ne._maxFaceCount=kt._maxFaceCount,ne._maxGridDiskSize=kt._maxGridDiskSize,ne._maxPolygonToCellsSize=kt._maxPolygonToCellsSize,ne._memcpy=kt._memcpy,ne._memset=kt._memset,ne._originToDirectedEdges=kt._originToDirectedEdges,ne._pentagonCount=kt._pentagonCount,ne._polygonToCells=kt._polygonToCells,ne._readInt64AsDoubleFromPointer=kt._readInt64AsDoubleFromPointer,ne._res0CellCount=kt._res0CellCount,ne._round=kt._round,ne._sbrk=kt._sbrk,ne._sizeOfCellBoundary=kt._sizeOfCellBoundary,ne._sizeOfCoordIJ=kt._sizeOfCoordIJ,ne._sizeOfGeoLoop=kt._sizeOfGeoLoop,ne._sizeOfGeoPolygon=kt._sizeOfGeoPolygon,ne._sizeOfH3Index=kt._sizeOfH3Index,ne._sizeOfLatLng=kt._sizeOfLatLng,ne._sizeOfLinkedGeoPolygon=kt._sizeOfLinkedGeoPolygon,ne._uncompactCells=kt._uncompactCells,ne._uncompactCellsSize=kt._uncompactCellsSize,ne._vertexToLatLng=kt._vertexToLatLng,ne.establishStackSpace=kt.establishStackSpace;var Ae=ne.stackAlloc=kt.stackAlloc,pe=ne.stackRestore=kt.stackRestore,Te=ne.stackSave=kt.stackSave;if(ne.asm=kt,ne.cwrap=kr,ne.setValue=qt,ne.getValue=$t,Ft){ni(Ft)||(Ft=dt(Ft));{$e();var Be=function(xe){xe.byteLength&&(xe=new Uint8Array(xe)),Nn.set(xe,yt),ne.memoryInitializerRequest&&delete ne.memoryInitializerRequest.response,Pe()},Ve=function(){Bt(Ft,Be,function(){throw"could not load memory initializer "+Ft})},Ke=Cn(Ft);if(Ke)Be(Ke.buffer);else if(ne.memoryInitializerRequest){var Qe=function(){var xe=ne.memoryInitializerRequest,Me=xe.response;if(xe.status!==200&&xe.status!==0){var ct=Cn(ne.memoryInitializerRequestURL);if(ct)Me=ct.buffer;else{console.warn("a problem seems to have happened with Module.memoryInitializerRequest, status: "+xe.status+", retrying "+Ft),Ve();return}}Be(Me)};ne.memoryInitializerRequest.response?setTimeout(Qe,0):ne.memoryInitializerRequest.addEventListener("load",Qe)}else Ve()}}var Ge;Ue=function xe(){Ge||He(),Ge||(Ue=xe)};function He(xe){if(Yt>0||(zt(),Yt>0))return;function Me(){Ge||(Ge=!0,!ui&&(dr(),In(),ne.onRuntimeInitialized&&ne.onRuntimeInitialized(),Es()))}ne.setStatus?(ne.setStatus("Running..."),setTimeout(function(){setTimeout(function(){ne.setStatus("")},1),Me()},1)):Me()}ne.run=He;function Et(xe){throw ne.onAbort&&ne.onAbort(xe),xe+="",P(xe),We(xe),ui=!0,"abort("+xe+"). Build with -s ASSERTIONS=1 for more info."}if(ne.abort=Et,ne.preInit)for(typeof ne.preInit=="function"&&(ne.preInit=[ne.preInit]);ne.preInit.length>0;)ne.preInit.pop()();return He(),Le}(typeof Yc=="object"?Yc:{}),bn="number",en=bn,rp=bn,an=bn,ln=bn,$l=bn,yr=bn,cC=[["sizeOfH3Index",bn],["sizeOfLatLng",bn],["sizeOfCellBoundary",bn],["sizeOfGeoLoop",bn],["sizeOfGeoPolygon",bn],["sizeOfLinkedGeoPolygon",bn],["sizeOfCoordIJ",bn],["readInt64AsDoubleFromPointer",bn],["isValidCell",rp,[an,ln]],["latLngToCell",en,[bn,bn,$l,yr]],["cellToLatLng",en,[an,ln,yr]],["cellToBoundary",en,[an,ln,yr]],["maxGridDiskSize",en,[bn,yr]],["gridDisk",en,[an,ln,bn,yr]],["gridDiskDistances",en,[an,ln,bn,yr,yr]],["gridRingUnsafe",en,[an,ln,bn,yr]],["maxPolygonToCellsSize",en,[yr,$l,bn,yr]],["polygonToCells",en,[yr,$l,bn,yr]],["cellsToLinkedMultiPolygon",en,[yr,bn,yr]],["destroyLinkedMultiPolygon",null,[yr]],["compactCells",en,[yr,yr,bn,bn]],["uncompactCells",en,[yr,bn,bn,yr,bn,$l]],["uncompactCellsSize",en,[yr,bn,bn,$l,yr]],["isPentagon",rp,[an,ln]],["isResClassIII",rp,[an,ln]],["getBaseCellNumber",bn,[an,ln]],["getResolution",bn,[an,ln]],["maxFaceCount",en,[an,ln,yr]],["getIcosahedronFaces",en,[an,ln,yr]],["cellToParent",en,[an,ln,$l,yr]],["cellToChildren",en,[an,ln,$l,yr]],["cellToCenterChild",en,[an,ln,$l,yr]],["cellToChildrenSize",en,[an,ln,$l,yr]],["cellToChildPos",en,[an,ln,$l,yr]],["childPosToCell",en,[bn,bn,an,ln,$l,yr]],["areNeighborCells",en,[an,ln,an,ln,yr]],["cellsToDirectedEdge",en,[an,ln,an,ln,yr]],["getDirectedEdgeOrigin",en,[an,ln,yr]],["getDirectedEdgeDestination",en,[an,ln,yr]],["isValidDirectedEdge",rp,[an,ln]],["directedEdgeToCells",en,[an,ln,yr]],["originToDirectedEdges",en,[an,ln,yr]],["directedEdgeToBoundary",en,[an,ln,yr]],["gridDistance",en,[an,ln,an,ln,yr]],["gridPathCells",en,[an,ln,an,ln,yr]],["gridPathCellsSize",en,[an,ln,an,ln,yr]],["cellToLocalIj",en,[an,ln,an,ln,bn,yr]],["localIjToCell",en,[an,ln,yr,bn,yr]],["getHexagonAreaAvgM2",en,[$l,yr]],["getHexagonAreaAvgKm2",en,[$l,yr]],["getHexagonEdgeLengthAvgM",en,[$l,yr]],["getHexagonEdgeLengthAvgKm",en,[$l,yr]],["greatCircleDistanceM",bn,[yr,yr]],["greatCircleDistanceKm",bn,[yr,yr]],["greatCircleDistanceRads",bn,[yr,yr]],["cellAreaM2",en,[an,ln,yr]],["cellAreaKm2",en,[an,ln,yr]],["cellAreaRads2",en,[an,ln,yr]],["edgeLengthM",en,[an,ln,yr]],["edgeLengthKm",en,[an,ln,yr]],["edgeLengthRads",en,[an,ln,yr]],["getNumCells",en,[$l,yr]],["getRes0Cells",en,[yr]],["res0CellCount",bn],["getPentagons",en,[bn,yr]],["pentagonCount",bn],["cellToVertex",en,[an,ln,bn,yr]],["cellToVertexes",en,[an,ln,yr]],["vertexToLatLng",en,[an,ln,yr]],["isValidVertex",rp,[an,ln]]],uC=0,hC=1,dC=2,fC=3,pC=4,mC=5,_C=6,gC=7,yC=8,xC=9,vC=10,bC=11,wC=12,TC=13,EC=14,MC=15,Sl={};Sl[uC]="Success";Sl[hC]="The operation failed but a more specific error is not available";Sl[dC]="Argument was outside of acceptable range";Sl[fC]="Latitude or longitude arguments were outside of acceptable range";Sl[pC]="Resolution argument was outside of acceptable range";Sl[mC]="Cell argument was not valid";Sl[_C]="Directed edge argument was not valid";Sl[gC]="Undirected edge argument was not valid";Sl[yC]="Vertex argument was not valid";Sl[xC]="Pentagon distortion was encountered";Sl[vC]="Duplicate input";Sl[bC]="Cell arguments were not neighbors";Sl[wC]="Cell arguments had incompatible resolutions";Sl[TC]="Memory allocation failed";Sl[EC]="Bounds of provided memory were insufficient";Sl[MC]="Mode or flags argument was not valid";var SC=1e3,IC=1001,M2=1002,R_={};R_[SC]="Unknown unit";R_[IC]="Array length out of bounds";R_[M2]="Got unexpected null value for H3 index";var CC="Unknown error";function S2(Le,ne,Fe){var ze=Fe&&"value"in Fe,wt=new Error((Le[ne]||CC)+" (code: "+ne+(ze?", value: "+Fe.value:"")+")");return wt.code=ne,wt}function kC(Le,ne){var Fe=arguments.length===2?{value:ne}:{};return S2(Sl,Le,Fe)}function DC(Le,ne){var Fe=arguments.length===2?{value:ne}:{};return S2(R_,Le,Fe)}function PC(Le){if(Le!==0)throw kC(Le)}var Vu={};cC.forEach(function(ne){Vu[ne[0]]=Yc.cwrap.apply(Yc,ne)});var E_=16,zC=4,BC=8,s1=Vu.sizeOfH3Index(),LC=Vu.sizeOfLatLng();Vu.sizeOfCellBoundary();Vu.sizeOfGeoPolygon();Vu.sizeOfGeoLoop();Vu.sizeOfLinkedGeoPolygon();Vu.sizeOfCoordIJ();function RC(Le){if(!Le)throw DC(M2);return Le}function Gw(Le){if(Le>=0)return Le.toString(E_);Le=Le&2147483647;var ne=I2(8,Le.toString(E_)),Fe=(parseInt(ne[0],E_)+8).toString(E_);return ne=Fe+ne.substring(1),ne}function FC(Le,ne){return Gw(ne)+I2(8,Gw(Le))}function I2(Le,ne){for(var Fe=Le-ne.length,ze="",wt=0;wt<Fe;wt++)ze+="0";return ze=ze+ne,ze}function OC(Le,ne){ne===void 0&&(ne=0);var Fe=Yc.getValue(Le+s1*ne,"i32"),ze=Yc.getValue(Le+s1*ne+zC,"i32");return ze?FC(Fe,ze):null}function VC(Le,ne,Fe){var ze=Yc._malloc(LC);Yc.HEAPF64.set([Le,ne].map(NC),ze/BC);var wt=Yc._malloc(s1);try{return PC(Vu.latLngToCell(ze,Fe,wt)),RC(OC(wt))}finally{Yc._free(wt),Yc._free(ze)}}function NC(Le){return Le*Math.PI/180}var UC={exports:{}},Fy,Zw;function jC(){return Zw||(Zw=1,Fy=function(ne){return function Fe(ze){return arguments.length===0||ze!=null&&ze["@@functional/placeholder"]===!0?Fe:ne.apply(this,arguments)}}),Fy}var Oy,qw;function GC(){if(qw)return Oy;qw=1;var Le=jC();return Oy=Le(function(Fe){return Fe===null?"Null":Fe===void 0?"Undefined":Object.prototype.toString.call(Fe).slice(8,-1)}),Oy}var Vy,Qw;function l1(){if(Qw)return Vy;Qw=1;function Le(ne){var Fe=typeof ne;return!!ne&&(Fe=="object"||Fe=="function")}return Vy=Le,Vy}var Ny,Hw;function ZC(){if(Hw)return Ny;Hw=1;var Le=l1();function ne(Fe){return Le(Fe)?Fe:Object(Fe)}return Ny=ne,Ny}var Uy,Ww;function qC(){if(Ww)return Uy;Ww=1;var Le=ZC();function ne(Fe){return function(ze,wt,dt){for(var Bt=Le(ze),P=dt(ze),We=P.length,me=Fe?We:-1;Fe?me--:++me<We;){var Xt=P[me];if(wt(Bt[Xt],Xt,Bt)===!1)break}return ze}}return Uy=ne,Uy}var jy,$w;function QC(){if($w)return jy;$w=1;var Le=qC(),ne=Le();return jy=ne,jy}var Gy,Xw;function HC(){if(Xw)return Gy;Xw=1;function Le(ne){return function(Fe){return Fe==null?void 0:Fe[ne]}}return Gy=Le,Gy}var Zy,Yw;function WC(){if(Yw)return Zy;Yw=1;var Le=HC(),ne=Le("length");return Zy=ne,Zy}var qy,Kw;function A1(){if(Kw)return qy;Kw=1;var Le=9007199254740991;function ne(Fe){return typeof Fe=="number"&&Fe>-1&&Fe%1==0&&Fe<=Le}return qy=ne,qy}var Qy,Jw;function $C(){if(Jw)return Qy;Jw=1;var Le=WC(),ne=A1();function Fe(ze){return ze!=null&&ne(Le(ze))}return Qy=Fe,Qy}var Hy,e2;function F_(){if(e2)return Hy;e2=1;function Le(ne){return!!ne&&typeof ne=="object"}return Hy=Le,Hy}var Wy,t2;function C2(){if(t2)return Wy;t2=1;var Le=$C(),ne=F_(),Fe=Object.prototype,ze=Fe.hasOwnProperty,wt=Fe.propertyIsEnumerable;function dt(Bt){return ne(Bt)&&Le(Bt)&&ze.call(Bt,"callee")&&!wt.call(Bt,"callee")}return Wy=dt,Wy}var $y,i2;function XC(){if(i2)return $y;i2=1;var Le=l1(),ne="[object Function]",Fe=Object.prototype,ze=Fe.toString;function wt(dt){return Le(dt)&&ze.call(dt)==ne}return $y=wt,$y}var Xy,r2;function YC(){if(r2)return Xy;r2=1;var Le=XC(),ne=F_(),Fe=/^\[object .+?Constructor\]$/,ze=Object.prototype,wt=Function.prototype.toString,dt=ze.hasOwnProperty,Bt=RegExp("^"+wt.call(dt).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function P(We){return We==null?!1:Le(We)?Bt.test(wt.call(We)):ne(We)&&Fe.test(We)}return Xy=P,Xy}var Yy,n2;function KC(){if(n2)return Yy;n2=1;var Le=YC();function ne(Fe,ze){var wt=Fe==null?void 0:Fe[ze];return Le(wt)?wt:void 0}return Yy=ne,Yy}var Ky,s2;function JC(){if(s2)return Ky;s2=1;var Le=KC(),ne=A1(),Fe=F_(),ze="[object Array]",wt=Object.prototype,dt=wt.toString,Bt=Le(Array,"isArray"),P=Bt||function(We){return Fe(We)&&ne(We.length)&&dt.call(We)==ze};return Ky=P,Ky}var Jy,o2;function e5(){if(o2)return Jy;o2=1;var Le=/^\d+$/,ne=9007199254740991;function Fe(ze,wt){return ze=typeof ze=="number"||Le.test(ze)?+ze:-1,wt=wt??ne,ze>-1&&ze%1==0&&ze<wt}return Jy=Fe,Jy}var e1,a2;function t5(){if(a2)return e1;a2=1;var Le=C2(),ne=JC(),Fe=e5(),ze=A1(),wt=l1(),dt=Object.prototype,Bt=dt.hasOwnProperty;function P(We){if(We==null)return[];wt(We)||(We=Object(We));var me=We.length;me=me&&ze(me)&&(ne(We)||Le(We))&&me||0;for(var Xt=We.constructor,Rt=-1,yt=typeof Xt=="function"&&Xt.prototype===We,qt=Array(me),$t=me>0;++Rt<me;)qt[Rt]=Rt+"";for(var ui in We)!($t&&Fe(ui,me))&&!(ui=="constructor"&&(yt||!Bt.call(We,ui)))&&qt.push(ui);return qt}return e1=P,e1}var t1,l2;function i5(){if(l2)return t1;l2=1;var Le=QC(),ne=t5();function Fe(ze,wt){return Le(ze,wt,ne)}return t1=Fe,t1}var i1,A2;function r5(){if(A2)return i1;A2=1;var Le=i5(),ne=C2(),Fe=F_(),ze="[object Object]",wt=Object.prototype,dt=wt.hasOwnProperty,Bt=wt.toString;function P(We){var me;if(!(Fe(We)&&Bt.call(We)==ze&&!ne(We))||!dt.call(We,"constructor")&&(me=We.constructor,typeof me=="function"&&!(me instanceof me)))return!1;var Xt;return Le(We,function(Rt,yt){Xt=yt}),Xt===void 0||dt.call(We,Xt)}return i1=P,i1}(function(Le){Le.exports=function(ne){var Fe={};function ze(wt){if(Fe[wt])return Fe[wt].exports;var dt=Fe[wt]={exports:{},id:wt,loaded:!1};return ne[wt].call(dt.exports,dt,dt.exports,ze),dt.loaded=!0,dt.exports}return ze.m=ne,ze.c=Fe,ze.p="/lib/",ze(0)}([function(ne,Fe,ze){ne.exports=ze(1)},function(ne,Fe,ze){Object.defineProperty(Fe,"__esModule",{value:!0}),Fe.union=ze(2).default,Fe.any=ze(12).default,Fe.nil=ze(14).default,Fe.mapOf=ze(16).default,Fe.arrayOf=ze(18).default,Fe.record=ze(20).default,Fe.optional=ze(23).default,Fe.validate=ze(25).default,Fe.deferred=ze(26).default,Fe.createValidator=ze(4).default,Fe.isValid=ze(28).default},function(ne,Fe,ze){Object.defineProperty(Fe,"__esModule",{value:!0}),Fe.default=P;var wt=ze(3),dt=Bt(wt);function Bt(We){return We&&We.__esModule?We:{default:We}}function P(){for(var We=arguments.length,me=Array(We),Xt=0;Xt<We;Xt++)me[Xt]=arguments[Xt];return new dt.default(me)}},function(ne,Fe,ze){var wt=function(){function Xt(Rt,yt){for(var qt=0;qt<yt.length;qt++){var $t=yt[qt];$t.enumerable=$t.enumerable||!1,$t.configurable=!0,"value"in $t&&($t.writable=!0),Object.defineProperty(Rt,$t.key,$t)}}return function(Rt,yt,qt){return yt&&Xt(Rt.prototype,yt),qt&&Xt(Rt,qt),Rt}}();Object.defineProperty(Fe,"__esModule",{value:!0});var dt=ze(4),Bt=P(dt);ze(5),ze(6);function P(Xt){return Xt&&Xt.__esModule?Xt:{default:Xt}}function We(Xt,Rt){if(!(Xt instanceof Rt))throw new TypeError("Cannot call a class as a function")}var me=function(){function Xt(Rt){We(this,Xt),this.validators=[];var yt=!0,qt=!1,$t=void 0;try{for(var ui=Rt[Symbol.iterator](),di;!(yt=(di=ui.next()).done);yt=!0){var Ei=di.value;this.validators.push((0,Bt.default)(Ei))}}catch(Vr){qt=!0,$t=Vr}finally{try{!yt&&ui.return&&ui.return()}finally{if(qt)throw $t}}}return wt(Xt,[{key:"isValid",value:function(yt){var qt=!0,$t=!1,ui=void 0;try{for(var di=this.validators[Symbol.iterator](),Ei;!(qt=(Ei=di.next()).done);qt=!0){var Vr=Ei.value;if(Vr.isValid(yt))return!0}}catch(kr){$t=!0,ui=kr}finally{try{!qt&&di.return&&di.return()}finally{if($t)throw ui}}return!1}},{key:"getValidationResult",value:function(yt){if(this.isValid(yt))return{isValid:"true"};var qt=this._getValidationDetails(yt);return{isValid:"false",message:`Value doesn't match any of the expected variants.
Value: `+JSON.stringify(yt)+`
Details: 
`+qt.message,score:qt.score}}},{key:"_getValidationDetails",value:function(yt){var qt=[],$t=!0,ui=!1,di=void 0;try{for(var Ei=this.validators[Symbol.iterator](),Vr;!($t=(Vr=Ei.next()).done);$t=!0){var kr=Vr.value;qt.push(kr.getValidationResult(yt))}}catch(cn){ui=!0,di=cn}finally{try{!$t&&Ei.return&&Ei.return()}finally{if(ui)throw di}}qt.sort(function(cn,jr){return cn.score<jr.score?1:cn.score>jr.score?-1:0}),qt.length>3&&(qt.length=3);var qr=qt.map(function(cn){return cn.message}).join(`
`);return{message:qr,score:qt[0].score}}}]),Xt}();Fe.default=me},function(ne,Fe,ze){Object.defineProperty(Fe,"__esModule",{value:!0}),Fe.default=ui,ze(5);var wt=ze(7),dt=qt(wt),Bt=ze(9),P=qt(Bt),We=ze(10),me=qt(We),Xt=ze(3);qt(Xt);var Rt=ze(11),yt=qt(Rt);function qt(di){return di&&di.__esModule?di:{default:di}}function $t(di){return di&&typeof Symbol<"u"&&di.constructor===Symbol?"symbol":typeof di}function ui(di){if(di==null)throw Error("Null cannot be a valid validation descriptor");if(di===String)return dt.default;if(di===Number)return P.default;if(di===Boolean)return me.default;if((typeof di>"u"?"undefined":$t(di))==="object"&&di&&typeof di.isValid=="function"&&typeof di.getValidationResult=="function")return di;if(typeof di=="string"||typeof di=="number"||typeof di=="boolean")return new yt.default(di);throw new Error("Can't recognize this descriptor: "+di)}},function(ne,Fe,ze){ze(6)},function(ne,Fe){},function(ne,Fe,ze){Object.defineProperty(Fe,"__esModule",{value:!0});var wt=ze(8),dt=Bt(wt);ze(6),ze(5);function Bt(We){return We&&We.__esModule?We:{default:We}}var P={isValid:function(me){return typeof me=="string"},getValidationResult:function(me){return P.isValid(me)?{isValid:"true"}:{isValid:"false",message:"String expected, "+(0,dt.default)(me)+" given.",score:0}}};Fe.default=P},function(ne,Fe){ne.exports=GC()},function(ne,Fe,ze){Object.defineProperty(Fe,"__esModule",{value:!0});var wt=ze(8),dt=Bt(wt);ze(6),ze(5);function Bt(We){return We&&We.__esModule?We:{default:We}}var P={isValid:function(me){return typeof me=="number"},getValidationResult:function(me){return P.isValid(me)?{isValid:"true"}:{isValid:"false",message:"Number expected. '"+(0,dt.default)(me)+"' given.",score:0}}};Fe.default=P},function(ne,Fe,ze){Object.defineProperty(Fe,"__esModule",{value:!0});var wt=ze(8),dt=Bt(wt);ze(6),ze(5);function Bt(We){return We&&We.__esModule?We:{default:We}}var P={isValid:function(me){return typeof me=="boolean"},getValidationResult:function(me){return P.isValid(me)?{isValid:"true"}:{isValid:"false",message:"Boolean expected. "+(0,dt.default)(me)+" given.",score:0}}};Fe.default=P},function(ne,Fe,ze){var wt=function(){function me(Xt,Rt){for(var yt=0;yt<Rt.length;yt++){var qt=Rt[yt];qt.enumerable=qt.enumerable||!1,qt.configurable=!0,"value"in qt&&(qt.writable=!0),Object.defineProperty(Xt,qt.key,qt)}}return function(Xt,Rt,yt){return Rt&&me(Xt.prototype,Rt),yt&&me(Xt,yt),Xt}}();Object.defineProperty(Fe,"__esModule",{value:!0});var dt=ze(4);Bt(dt),ze(5),ze(6);function Bt(me){return me&&me.__esModule?me:{default:me}}function P(me,Xt){if(!(me instanceof Xt))throw new TypeError("Cannot call a class as a function")}var We=function(){function me(Xt){P(this,me),this.expectedValue=Xt}return wt(me,[{key:"isValid",value:function(Rt){return Rt===this.expectedValue}},{key:"getValidationResult",value:function(Rt){return this.isValid(Rt)?{isValid:"true"}:{isValid:"false",message:"Expected: "+JSON.stringify(this.expectedValue)+". Given: "+Rt,score:0}}}]),me}();Fe.default=We},function(ne,Fe,ze){Object.defineProperty(Fe,"__esModule",{value:!0});var wt=ze(13),dt=Bt(wt);function Bt(P){return P&&P.__esModule?P:{default:P}}Fe.default=dt.default},function(ne,Fe,ze){Object.defineProperty(Fe,"__esModule",{value:!0});var wt=ze(8);dt(wt),ze(6),ze(5);function dt(P){return P&&P.__esModule?P:{default:P}}var Bt={isValid:function(We){return!0},getValidationResult:function(We){return{isValid:"true"}}};Fe.default=Bt},function(ne,Fe,ze){Object.defineProperty(Fe,"__esModule",{value:!0});var wt=ze(15),dt=Bt(wt);function Bt(P){return P&&P.__esModule?P:{default:P}}Fe.default=dt.default},function(ne,Fe,ze){Object.defineProperty(Fe,"__esModule",{value:!0});var wt=ze(8),dt=Bt(wt);ze(6),ze(5);function Bt(We){return We&&We.__esModule?We:{default:We}}var P={isValid:function(me){return me==null},getValidationResult:function(me){return P.isValid(me)?{isValid:"true"}:{isValid:"false",message:"Null expected. "+(0,dt.default)(me)+" given.",score:0}}};Fe.default=P},function(ne,Fe,ze){Object.defineProperty(Fe,"__esModule",{value:!0}),Fe.default=P;var wt=ze(17),dt=Bt(wt);function Bt(We){return We&&We.__esModule?We:{default:We}}function P(We){return new dt.default(We)}},function(ne,Fe,ze){var wt=function(){function qt($t,ui){for(var di=0;di<ui.length;di++){var Ei=ui[di];Ei.enumerable=Ei.enumerable||!1,Ei.configurable=!0,"value"in Ei&&(Ei.writable=!0),Object.defineProperty($t,Ei.key,Ei)}}return function($t,ui,di){return ui&&qt($t.prototype,ui),di&&qt($t,di),$t}}();Object.defineProperty(Fe,"__esModule",{value:!0});var dt=ze(8),Bt=me(dt),P=ze(4),We=me(P);ze(6),ze(5);function me(qt){return qt&&qt.__esModule?qt:{default:qt}}function Xt(qt,$t){if(!(qt instanceof $t))throw new TypeError("Cannot call a class as a function")}function Rt(qt){return qt&&typeof Symbol<"u"&&qt.constructor===Symbol?"symbol":typeof qt}var yt=function(){function qt($t){Xt(this,qt),this.validator=(0,We.default)($t)}return wt(qt,[{key:"isValid",value:function(ui){if(!((typeof ui>"u"?"undefined":Rt(ui))==="object"&&ui))return!1;var di=Object.keys(ui),Ei=!0,Vr=!1,kr=void 0;try{for(var qr=di[Symbol.iterator](),cn;!(Ei=(cn=qr.next()).done);Ei=!0){var jr=cn.value,Jn=ui[jr];if(this.validator.isValid(Jn)===!1)return!1}}catch(rn){Vr=!0,kr=rn}finally{try{!Ei&&qr.return&&qr.return()}finally{if(Vr)throw kr}}return!0}},{key:"getValidationResult",value:function(ui){if(!((typeof ui>"u"?"undefined":Rt(ui))==="object"&&ui))return{isValid:"false",message:"Object expected. "+(0,Bt.default)(ui)+" given.",score:0};var di=Object.keys(ui),Ei=!0,Vr=!1,kr=void 0;try{for(var qr=di[Symbol.iterator](),cn;!(Ei=(cn=qr.next()).done);Ei=!0){var jr=cn.value,Jn=ui[jr],rn=this.validator.getValidationResult(Jn);if(rn.isValid==="false")return{isValid:"false",message:"Validation failed for key '"+jr+"': "+rn.message,score:1}}}catch(pn){Vr=!0,kr=pn}finally{try{!Ei&&qr.return&&qr.return()}finally{if(Vr)throw kr}}return{isValid:"true"}}}]),qt}();Fe.default=yt},function(ne,Fe,ze){Object.defineProperty(Fe,"__esModule",{value:!0}),Fe.default=P;var wt=ze(19),dt=Bt(wt);function Bt(We){return We&&We.__esModule?We:{default:We}}function P(We){return new dt.default(We)}},function(ne,Fe,ze){var wt=function(){function yt(qt,$t){for(var ui=0;ui<$t.length;ui++){var di=$t[ui];di.enumerable=di.enumerable||!1,di.configurable=!0,"value"in di&&(di.writable=!0),Object.defineProperty(qt,di.key,di)}}return function(qt,$t,ui){return $t&&yt(qt.prototype,$t),ui&&yt(qt,ui),qt}}();Object.defineProperty(Fe,"__esModule",{value:!0});var dt=ze(8),Bt=me(dt),P=ze(4),We=me(P);ze(6),ze(5);function me(yt){return yt&&yt.__esModule?yt:{default:yt}}function Xt(yt,qt){if(!(yt instanceof qt))throw new TypeError("Cannot call a class as a function")}var Rt=function(){function yt(qt){Xt(this,yt),this.validator=(0,We.default)(qt)}return wt(yt,[{key:"isValid",value:function($t){if(!Array.isArray($t))return!1;var ui=!0,di=!1,Ei=void 0;try{for(var Vr=$t[Symbol.iterator](),kr;!(ui=(kr=Vr.next()).done);ui=!0){var qr=kr.value;if(this.validator.isValid(qr)===!1)return!1}}catch(cn){di=!0,Ei=cn}finally{try{!ui&&Vr.return&&Vr.return()}finally{if(di)throw Ei}}return!0}},{key:"getValidationResult",value:function($t){if(!Array.isArray($t))return{isValid:"false",message:"Array expected. "+(0,Bt.default)($t)+" given.",score:0};for(var ui=0;ui<$t.length;ui++){var di=$t[ui],Ei=this.validator.getValidationResult(di);if(Ei.isValid==="false")return{isValid:"false",message:"Validation failed on item #"+ui+": "+Ei.message,score:1}}return{isValid:"true"}}}]),yt}();Fe.default=Rt},function(ne,Fe,ze){Object.defineProperty(Fe,"__esModule",{value:!0}),Fe.default=P;var wt=ze(21),dt=Bt(wt);function Bt(We){return We&&We.__esModule?We:{default:We}}function P(We){return new dt.default(We)}},function(ne,Fe,ze){var wt=function(){function ui(di,Ei){for(var Vr=0;Vr<Ei.length;Vr++){var kr=Ei[Vr];kr.enumerable=kr.enumerable||!1,kr.configurable=!0,"value"in kr&&(kr.writable=!0),Object.defineProperty(di,kr.key,kr)}}return function(di,Ei,Vr){return Ei&&ui(di.prototype,Ei),Vr&&ui(di,Vr),di}}();Object.defineProperty(Fe,"__esModule",{value:!0});var dt=ze(8),Bt=Rt(dt),P=ze(22),We=Rt(P),me=ze(4),Xt=Rt(me);ze(5),ze(6);function Rt(ui){return ui&&ui.__esModule?ui:{default:ui}}function yt(ui,di){if(!(ui instanceof di))throw new TypeError("Cannot call a class as a function")}function qt(ui){return ui&&typeof Symbol<"u"&&ui.constructor===Symbol?"symbol":typeof ui}var $t=function(){function ui(di){if(yt(this,ui),!((typeof di>"u"?"undefined":qt(di))==="object"&&di&&(0,We.default)(di)))throw Error("A record must be defined by an object.");this.shape={};var Ei=!0,Vr=!1,kr=void 0;try{for(var qr=Object.getOwnPropertyNames(di)[Symbol.iterator](),cn;!(Ei=(cn=qr.next()).done);Ei=!0){var jr=cn.value;try{this.shape[jr]=(0,Xt.default)(di[jr])}catch(pn){var Jn=jr,rn=pn.stack;throw pn.originalStack?(rn=pn.originalStack,Jn+="."+pn.propertyName,pn.propertyName=Jn):pn.originalStack=pn.stack,pn.stack="Error defining prop '"+Jn+"': "+pn.originalStack,pn}}}catch(pn){Vr=!0,kr=pn}finally{try{!Ei&&qr.return&&qr.return()}finally{if(Vr)throw kr}}}return wt(ui,[{key:"isValid",value:function(Ei){if(!((typeof Ei>"u"?"undefined":qt(Ei))==="object"&&Ei))return!1;var Vr=!0,kr=!1,qr=void 0;try{for(var cn=Object.keys(this.shape)[Symbol.iterator](),jr;!(Vr=(jr=cn.next()).done);Vr=!0){var Jn=jr.value,rn=this.shape[Jn];if(rn.isValid(Ei[Jn])===!1)return!1}}catch(pn){kr=!0,qr=pn}finally{try{!Vr&&cn.return&&cn.return()}finally{if(kr)throw qr}}return!0}},{key:"getValidationResult",value:function(Ei){if(!((typeof Ei>"u"?"undefined":qt(Ei))==="object"&&Ei))return{isValid:"false",message:"Object expected, "+(0,Bt.default)(Ei)+" given.",score:0};var Vr=0,kr=!0,qr=!1,cn=void 0;try{for(var jr=Object.keys(this.shape)[Symbol.iterator](),Jn;!(kr=(Jn=jr.next()).done);kr=!0){var rn=Jn.value,pn=this.shape[rn],At=pn.getValidationResult(Ei[rn]);if(At.isValid==="false")return{isValid:"false",message:"Error validating prop "+rn+`:
 `+At.message,score:1+Vr};Vr++}}catch(tr){qr=!0,cn=tr}finally{try{!kr&&jr.return&&jr.return()}finally{if(qr)throw cn}}return{isValid:"true"}}}]),ui}();Fe.default=$t},function(ne,Fe){ne.exports=r5()},function(ne,Fe,ze){Object.defineProperty(Fe,"__esModule",{value:!0}),Fe.default=P;var wt=ze(24),dt=Bt(wt);function Bt(We){return We&&We.__esModule?We:{default:We}}function P(We){return new dt.default(We)}},function(ne,Fe,ze){var wt=function(){function Xt(Rt,yt){for(var qt=0;qt<yt.length;qt++){var $t=yt[qt];$t.enumerable=$t.enumerable||!1,$t.configurable=!0,"value"in $t&&($t.writable=!0),Object.defineProperty(Rt,$t.key,$t)}}return function(Rt,yt,qt){return yt&&Xt(Rt.prototype,yt),qt&&Xt(Rt,qt),Rt}}();Object.defineProperty(Fe,"__esModule",{value:!0});var dt=ze(4),Bt=P(dt);ze(6),ze(5);function P(Xt){return Xt&&Xt.__esModule?Xt:{default:Xt}}function We(Xt,Rt){if(!(Xt instanceof Rt))throw new TypeError("Cannot call a class as a function")}var me=function(){function Xt(Rt){We(this,Xt),this.validator=(0,Bt.default)(Rt)}return wt(Xt,[{key:"isValid",value:function(yt){return yt?this.validator.isValid(yt):!0}},{key:"getValidationResult",value:function(yt){return yt?this.validator.getValidationResult(yt):{isValid:"true"}}}]),Xt}();Fe.default=me},function(ne,Fe,ze){Object.defineProperty(Fe,"__esModule",{value:!0}),Fe.default=P;var wt=ze(4),dt=Bt(wt);function Bt(We){return We&&We.__esModule?We:{default:We}}function P(We,me){var Xt=(0,dt.default)(We),Rt=Xt.getValidationResult(me);if(Rt.isValid==="false")throw Error(Rt.message);return me}},function(ne,Fe,ze){Object.defineProperty(Fe,"__esModule",{value:!0}),Fe.default=P;var wt=ze(27),dt=Bt(wt);function Bt(We){return We&&We.__esModule?We:{default:We}}function P(We){return new dt.default(We)}},function(ne,Fe,ze){var wt=function(){function Rt(yt,qt){for(var $t=0;$t<qt.length;$t++){var ui=qt[$t];ui.enumerable=ui.enumerable||!1,ui.configurable=!0,"value"in ui&&(ui.writable=!0),Object.defineProperty(yt,ui.key,ui)}}return function(yt,qt,$t){return qt&&Rt(yt.prototype,qt),$t&&Rt(yt,$t),yt}}();Object.defineProperty(Fe,"__esModule",{value:!0});var dt=ze(8),Bt=We(dt),P=ze(4);We(P),ze(6),ze(5);function We(Rt){return Rt&&Rt.__esModule?Rt:{default:Rt}}function me(Rt,yt){if(!(Rt instanceof yt))throw new TypeError("Cannot call a class as a function")}var Xt=function(){function Rt(yt){if(me(this,Rt),typeof yt!="function")throw Error("Deferred validator only accepts a function. "+(0,Bt.default)(yt)+" given");this.deferredValidator=yt}return wt(Rt,[{key:"isValid",value:function(qt){return this._getValidator().isValid(qt)}},{key:"getValidationResult",value:function(qt){return this._getValidator().getValidationResult(qt)}},{key:"_getValidator",value:function(){return this.validator||(this.validator=this.deferredValidator()),this.validator}}]),Rt}();Fe.default=Xt},function(ne,Fe,ze){Object.defineProperty(Fe,"__esModule",{value:!0}),Fe.default=P;var wt=ze(4),dt=Bt(wt);function Bt(We){return We&&We.__esModule?We:{default:We}}function P(We,me){var Xt=(0,dt.default)(We);return Xt.isValid(me)}}])})(UC);function n5(Le){let ne,Fe,ze,wt;function dt(We){Le[4](We)}function Bt(We){Le[5](We)}let P={style:"https://basemaps.cartocdn.com/gl/positron-gl-style/style.json",standardControls:!0,center:[-98.137,40.137],zoom:4};return Le[0]!==void 0&&(P.map=Le[0]),Le[1]!==void 0&&(P.loaded=Le[1]),ne=new II({props:P}),Lw.push(()=>Fw(ne,"map",dt)),Lw.push(()=>Fw(ne,"loaded",Bt)),{c(){sd(ne.$$.fragment)},l(We){od(ne.$$.fragment,We)},m(We,me){ad(ne,We,me),wt=!0},p(We,[me]){const Xt={};!Fe&&me&1&&(Fe=!0,Xt.map=We[0],Rw(()=>Fe=!1)),!ze&&me&2&&(ze=!0,Xt.loaded=We[1],Rw(()=>ze=!1)),ne.$set(Xt)},i(We){wt||(kA(ne.$$.fragment,We),wt=!0)},o(We){bc(ne.$$.fragment,We),wt=!1},d(We){ld(ne,We)}}}let c2=6;function s5(Le,ne,Fe){let ze,wt=!1,dt,Bt;const P=["#0af574","#00dda5","#00c1d4","#00a2f5","#007ffc","#0056e3","#3517ab"];function We(){const yt=P.length;let qt=P.map(($t,ui)=>[$t,ui/yt]);return qt[qt.length-1]=qt[qt.length-1][0],qt=qt.flat(),console.log(qt),["step",["get","pd"],...qt]}let{update:me}=ne;rI(()=>{fetch(`/phast/CA_hexbinned@${c2}_populated.json`).then(yt=>yt.json()).then(yt=>Bt=yt).then(()=>{console.log(We()),ze.addSource("hexlayer",{type:"geojson",data:Bt}),ze.addLayer({id:"hex",type:"fill",source:"hexlayer",layout:{},paint:{"fill-color":We(),"fill-opacity":.8}});let yt=AC(Bt),qt=window.innerWidth/3;console.log(yt),ze.fitBounds(yt,{padding:{top:50,left:10,bottom:50,right:qt}}),ze.on("click","hex",$t=>{let ui=VC($t.lngLat.lat,$t.lngLat.lng,c2);console.log(ui),me({latlng:$t.lngLat,hex:ui,properties:$t.features[0].properties})}),ze.on("mouseenter","hex",()=>{ze.getCanvas().style.cursor="pointer"}),ze.on("mouseleave","hex",()=>{ze.getCanvas().style.cursor=""})})});function Xt(yt){ze=yt,Fe(0,ze)}function Rt(yt){wt=yt,Fe(1,wt)}return Le.$$set=yt=>{"update"in yt&&Fe(2,me=yt.update)},Le.$$.update=()=>{Le.$$.dirty&11&&ze&&wt&&(Fe(3,dt=ze.getStyle().layers.filter(yt=>yt["source-layer"]==="place")),console.log(dt))},[ze,wt,me,dt,Xt,Rt]}let o5=class extends vh{constructor(ne){super(),bh(this,ne,s5,n5,xh,{update:2})}};var a5={exports:{}};(function(Le,ne){var Fe={};(function(ze,wt){Le.exports=wt()})(f2,function(){var ze,wt,dt;function Bt(We,me){if(!ze)ze=me;else if(!wt)wt=me;else{var Xt="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+ze+")(sharedChunk); ("+wt+")(sharedChunk); self.onerror = null;",Rt={};ze(Rt),dt=me(Rt),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(dt.workerUrl=window.URL.createObjectURL(new Blob([Xt],{type:"text/javascript"})))}}Bt(["exports"],function(We){var me=typeof self<"u"?self:{},Xt="3.1.2";let Rt;const yt={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(Rt==null){const t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{Rt=Fe.API_URL_REGEX!=null?new RegExp(Fe.API_URL_REGEX):t}catch{Rt=t}}return Rt},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!yt.API_URL)return null;try{const t=new URL(yt.API_URL);return t.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":t.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},qt={supported:!1,testSupport:function(t){!di&&ui&&(Ei?Vr(t):$t=t)}};let $t,ui,di=!1,Ei=!1;function Vr(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,ui),t.isContextLost())return;qt.supported=!0}catch{}t.deleteTexture(e),di=!0}me.document&&(ui=me.document.createElement("img"),ui.onload=function(){$t&&Vr($t),$t=null,Ei=!0},ui.onerror=function(){di=!0,$t=null},ui.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const kr="01";function qr(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var cn=jr;function jr(t,e,i,r){this.cx=3*t,this.bx=3*(i-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(r-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=i,this.p2y=r}jr.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(e===void 0&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var i=t,r=0;r<8;r++){var n=this.sampleCurveX(i)-t;if(Math.abs(n)<e)return i;var s=this.sampleCurveDerivativeX(i);if(Math.abs(s)<1e-6)break;i-=n/s}var a=0,c=1;for(i=t,r=0;r<20&&(n=this.sampleCurveX(i),!(Math.abs(n-t)<e));r++)t>n?a=i:c=i,i=.5*(c-a)+a;return i},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var Jn=qr(cn),rn=pn;function pn(t,e){this.x=t,this.y=e}pn.prototype={clone:function(){return new pn(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),i=Math.sin(t),r=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=r,this},_rotateAround:function(t,e){var i=Math.cos(t),r=Math.sin(t),n=e.y+r*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-r*(this.y-e.y),this.y=n,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},pn.convert=function(t){return t instanceof pn?t:Array.isArray(t)?new pn(t[0],t[1]):t};var At=qr(rn);function tr(t,e){if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(!tr(t[i],e[i]))return!1;return!0}if(typeof t=="object"&&t!==null&&e!==null){if(typeof e!="object"||Object.keys(t).length!==Object.keys(e).length)return!1;for(const i in t)if(!tr(t[i],e[i]))return!1;return!0}return t===e}const Sn=Math.PI/180,Nn=180/Math.PI;function Li(t){return t*Sn}function Ir(t){return t*Nn}const as=[[0,0],[1,0],[1,1],[0,1]];function es(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,i=e*t;return 4*(t<.5?i:3*(t-e)+i-.75)}function wo(t){let e=1/0,i=1/0,r=-1/0,n=-1/0;for(const s of t)e=Math.min(e,s.x),i=Math.min(i,s.y),r=Math.max(r,s.x),n=Math.max(n,s.y);return{min:new At(e,i),max:new At(r,n)}}function Io(t,e,i=0,r=!0){const n=new At(i,i),s=t.sub(n),a=e.add(n),c=[s,new At(a.x,s.y),a,new At(s.x,a.y)];return r&&c.push(s.clone()),c}function Zo(t,e,i,r){const n=new Jn(t,e,i,r);return function(s){return n.solve(s)}}const gs=Zo(.25,.1,.25,1);function hi(t,e,i){return Math.min(i,Math.max(e,t))}function Yr(t,e,i){return(i=hi((i-t)/(e-t),0,1))*i*(3-2*i)}function Hn(t,e,i){const r=i-e,n=((t-e)%r+r)%r+e;return n===e?i:n}function Co(t,e,i){if(!t.length)return i(null,[]);let r=t.length;const n=new Array(t.length);let s=null;t.forEach((a,c)=>{e(a,(p,_)=>{p&&(s=p),n[c]=_,--r==0&&i(s,n)})})}function to(t){const e=[];for(const i in t)e.push(t[i]);return e}function zt(t,...e){for(const i of e)for(const r in i)t[r]=i[r];return t}function dr(t,e){const i={};for(let r=0;r<e.length;r++){const n=e[r];n in t&&(i[n]=t[n])}return i}let In=1;function Es(){return In++}function Il(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function La(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function Cl(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function Un(t,e){t.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function Ra(t,e){return t.indexOf(e,t.length-e.length)!==-1}function pa(t,e,i){const r={};for(const n in t)r[n]=e.call(i||this,t[n],n,t);return r}function Yt(t,e,i){const r={};for(const n in t)e.call(i||this,t[n],n,t)&&(r[n]=t[n]);return r}function Ue(t){return Array.isArray(t)?t.map(Ue):typeof t=="object"&&t?pa(t,Ue):t}const $e={};function Pe(t){$e[t]||(typeof console<"u"&&console.warn(t),$e[t]=!0)}function Ft(t,e,i){return(i.y-t.y)*(e.x-t.x)>(e.y-t.y)*(i.x-t.x)}function Zt(t){let e=0;for(let i,r,n=0,s=t.length,a=s-1;n<s;a=n++)i=t[n],r=t[a],e+=(r.x-i.x)*(i.y+r.y);return e}function ni([t,e,i]){const r=Li(e+90),n=Li(i);return{x:t*Math.cos(r)*Math.sin(n),y:t*Math.sin(r)*Math.sin(n),z:t*Math.cos(n),azimuthal:e,polar:i}}function ri(t,e,i){const r=Math.sqrt(t*t+e*e+i*i),n=r>0?Math.acos(i/r)*Nn:0;let s=t!==0||e!==0?Math.atan2(-e,-t)*Nn+90:0;return s<0&&(s+=360),[r,s,n]}function Qt(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Oi(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,r,n,s)=>{const a=n||s;return e[r]=!a||a.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let Qi=null;function Ki(){return!!me.document.fullscreenElement||!!me.document.webkitFullscreenElement}function Kr(t){try{const e=me[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function _n(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}function ts(t,e,i){t[4*e+0]=i[0],t[4*e+1]=i[1],t[4*e+2]=i[2],t[4*e+3]=i[3]}function oi(t,e){return[Math.pow(t[0],2.2)*e,Math.pow(t[1],2.2)*e,Math.pow(t[2],2.2)*e]}function gn(t){return[Math.pow(t[0],1/2.2),Math.pow(t[1],1/2.2),Math.pow(t[2],1/2.2)]}const vr="mapbox-tiles";let ys=500,ls=50,gi,br;function wr(){try{return me.caches}catch{}}function Cn(){wr()&&!gi&&(gi=me.caches.open(vr))}function io(t){const e=t.indexOf("?");if(e<0)return t;const i=function(n){const s=n.indexOf("?");return s>0?n.slice(s+1).split("&"):[]}(t),r=i.filter(n=>{const s=n.split("=");return s[0]==="language"||s[0]==="worldview"});return r.length?`${t.slice(0,e)}?${r.join("&")}`:t.slice(0,e)}let Sr=1/0;function kt(t){Sr++,Sr>ls&&(t.getActor().send("enforceCacheSizeLimit",ys),Sr=0)}const we={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(we);class Ae extends Error{constructor(e,i,r){i===401&&Pt(r)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=r}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const pe=Qt()?()=>self.worker&&self.worker.referrer:()=>(me.location.protocol==="blob:"?me.parent:me).location.href,Te=function(t,e){if(!(/^file:/.test(i=t.url)||/^file:/.test(pe())&&!/^\w+:/.test(i))){if(me.fetch&&me.Request&&me.AbortController&&me.Request.prototype.hasOwnProperty("signal"))return function(r,n){const s=new me.AbortController,a=new me.Request(r.url,{method:r.method||"GET",body:r.body,credentials:r.credentials,headers:r.headers,referrer:pe(),referrerPolicy:r.referrerPolicy,signal:s.signal});let c=!1,p=!1;const _=(v=a.url).indexOf("sku=")>0&&Pt(v);var v;r.type==="json"&&a.headers.set("Accept","application/json");const E=(B,O,G)=>{if(p)return;if(B&&B.message!=="SecurityError"&&Pe(B.toString()),O&&G)return C(O);const q=Date.now();me.fetch(a).then($=>{if($.ok){const J=_?$.clone():null;return C($,J,q)}return n(new Ae($.statusText,$.status,r.url))}).catch($=>{$.name!=="AbortError"&&n(new Error(`${$.message} ${r.url}`))})},C=(B,O,G)=>{(r.type==="arrayBuffer"?B.arrayBuffer():r.type==="json"?B.json():B.text()).then(q=>{p||(O&&G&&function($,J,ie){if(Cn(),!gi)return;const re={status:J.status,statusText:J.statusText,headers:new me.Headers};J.headers.forEach((he,ve)=>re.headers.set(ve,he));const te=Oi(J.headers.get("Cache-Control")||"");if(te["no-store"])return;te["max-age"]&&re.headers.set("Expires",new Date(ie+1e3*te["max-age"]).toUTCString());const se=re.headers.get("Expires");se&&(new Date(se).getTime()-ie<42e4||function(he,ve){if(br===void 0)try{new Response(new ReadableStream),br=!0}catch{br=!1}br?ve(he.body):he.blob().then(ve)}(J,he=>{const ve=new me.Response(he,re);Cn(),gi&&gi.then(be=>be.put(io($.url),ve)).catch(be=>Pe(be.message))}))}(a,O,G),c=!0,n(null,q,B.headers.get("Cache-Control"),B.headers.get("Expires")))}).catch(q=>{p||n(new Error(q.message))})};return _?function(B,O){if(Cn(),!gi)return O(null);const G=io(B.url);gi.then(q=>{q.match(G).then($=>{const J=function(ie){if(!ie)return!1;const re=new Date(ie.headers.get("Expires")||0),te=Oi(ie.headers.get("Cache-Control")||"");return re>Date.now()&&!te["no-cache"]}($);q.delete(G),J&&q.put(G,$.clone()),O(null,$,J)}).catch(O)}).catch(O)}(a,E):E(null,null),{cancel:()=>{p=!0,c||s.abort()}}}(t,e);if(Qt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var i;return function(r,n){const s=new me.XMLHttpRequest;s.open(r.method||"GET",r.url,!0),r.type==="arrayBuffer"&&(s.responseType="arraybuffer");for(const a in r.headers)s.setRequestHeader(a,r.headers[a]);return r.type==="json"&&(s.responseType="text",s.setRequestHeader("Accept","application/json")),s.withCredentials=r.credentials==="include",s.onerror=()=>{n(new Error(s.statusText))},s.onload=()=>{if((s.status>=200&&s.status<300||s.status===0)&&s.response!==null){let a=s.response;if(r.type==="json")try{a=JSON.parse(s.response)}catch(c){return n(c)}n(null,a,s.getResponseHeader("Cache-Control"),s.getResponseHeader("Expires"))}else n(new Ae(s.statusText,s.status,r.url))},s.send(r.body),{cancel:()=>s.abort()}}(t,e)},Be=function(t,e){return Te(zt(t,{type:"json"}),e)},Ve=function(t,e){return Te(zt(t,{type:"arrayBuffer"}),e)};function Ke(t){const e=me.document.createElement("a");return e.href=t,e.protocol===me.document.location.protocol&&e.host===me.document.location.host}const Qe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Ge,He;Ge=[],He=0;const Et=function(t,e){if(qt.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),He>=yt.MAX_PARALLEL_IMAGE_REQUESTS){const s={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Ge.push(s),s}He++;let i=!1;const r=()=>{if(!i)for(i=!0,He--;Ge.length&&He<yt.MAX_PARALLEL_IMAGE_REQUESTS;){const s=Ge.shift(),{requestParameters:a,callback:c,cancelled:p}=s;p||(s.cancel=Et(a,c).cancel)}},n=Ve(t,(s,a,c,p)=>{r(),s?e(s):a&&(me.createImageBitmap?function(_,v){const E=new me.Blob([new Uint8Array(_)],{type:"image/png"});me.createImageBitmap(E).then(C=>{v(null,C)}).catch(C=>{v(new Error(`Could not load image because of ${C.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(a,(_,v)=>e(_,v,c,p)):function(_,v){const E=new me.Image,C=me.URL;E.onload=()=>{v(null,E),C.revokeObjectURL(E.src),E.onload=null,me.requestAnimationFrame(()=>{E.src=Qe})},E.onerror=()=>v(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const B=new me.Blob([new Uint8Array(_)],{type:"image/png"});E.src=_.byteLength?C.createObjectURL(B):Qe}(a,(_,v)=>e(_,v,c,p)))});return{cancel:()=>{n.cancel(),r()}}},xe="NO_ACCESS_TOKEN";class Me{constructor(e,i,r){this._transformRequestFn=e,this._customAccessToken=i,this._silenceAuthErrors=!!r,this._createSkuToken()}_createSkuToken(){const e=function(){let i="";for(let r=0;r<10;r++)i+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",kr,i].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(e,i){return this._transformRequestFn&&this._transformRequestFn(e,i)||{url:e}}normalizeStyleURL(e,i){if(!ct(e))return e;const r=yi(e);return r.params.push(`sdk=js-${Xt}`),r.path=`/styles/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||i)}normalizeGlyphsURL(e,i){if(!ct(e))return e;const r=yi(e);return r.path=`/fonts/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||i)}normalizeModelURL(e,i){if(!ct(e))return e;const r=yi(e);return r.path=`/models/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||i)}normalizeSourceURL(e,i,r,n){if(!ct(e))return e;const s=yi(e);return s.path=`/v4/${s.authority}.json`,s.params.push("secure"),r&&s.params.push(`language=${r}`),n&&s.params.push(`worldview=${n}`),this._makeAPIURL(s,this._customAccessToken||i)}normalizeSpriteURL(e,i,r,n){const s=yi(e);return ct(e)?(s.path=`/styles/v1${s.path}/sprite${i}${r}`,this._makeAPIURL(s,this._customAccessToken||n)):(s.path+=`${i}${r}`,ai(s))}normalizeTileURL(e,i,r){if(this._isSkuTokenExpired()&&this._createSkuToken(),e&&!ct(e))return e;const n=yi(e);n.path=n.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${i||r&&n.authority!=="raster"&&r===512?"@2x":""}${qt.supported?".webp":"$1"}`),n.authority==="raster"?n.path=`/${yt.RASTER_URL_PREFIX}${n.path}`:(n.path=n.path.replace(/^.+\/v4\//,"/"),n.path=`/${yt.TILE_URL_VERSION}${n.path}`);const s=this._customAccessToken||function(a){for(const c of a){const p=c.match(/^access_token=(.*)$/);if(p)return p[1]}return null}(n.params)||yt.ACCESS_TOKEN;return yt.REQUIRE_ACCESS_TOKEN&&s&&this._skuToken&&n.params.push(`sku=${this._skuToken}`),this._makeAPIURL(n,s)}canonicalizeTileURL(e,i){const r=yi(e);if(!r.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!r.path.match(/\.[\w]+$/))return e;let n="mapbox://";r.path.match(/^\/raster\/v1\//)?n+=`raster/${r.path.replace(`/${yt.RASTER_URL_PREFIX}/`,"")}`:n+=`tiles/${r.path.replace(`/${yt.TILE_URL_VERSION}/`,"")}`;let s=r.params;return i&&(s=s.filter(a=>!a.match(/^access_token=/))),s.length&&(n+=`?${s.join("&")}`),n}canonicalizeTileset(e,i){const r=!!i&&ct(i),n=[];for(const s of e.tiles||[])Pt(s)?n.push(this.canonicalizeTileURL(s,r)):n.push(s);return n}_makeAPIURL(e,i){const r="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",n=yi(yt.API_URL);if(e.protocol=n.protocol,e.authority=n.authority,e.protocol==="http"){const s=e.params.indexOf("secure");s>=0&&e.params.splice(s,1)}if(n.path!=="/"&&(e.path=`${n.path}${e.path}`),!yt.REQUIRE_ACCESS_TOKEN)return ai(e);if(i=i||yt.ACCESS_TOKEN,!this._silenceAuthErrors){if(!i)throw new Error(`An API access token is required to use Mapbox GL. ${r}`);if(i[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${r}`)}return e.params=e.params.filter(s=>s.indexOf("access_token")===-1),e.params.push(`access_token=${i||""}`),ai(e)}}function ct(t){return t.indexOf("mapbox:")===0}function Pt(t){return yt.API_URL_REGEX.test(t)}function o(t){return yt.API_CDN_URL_REGEX.test(t)}function oe(t){return yt.API_STYLE_REGEX.test(t)&&!ti(t)}function ti(t){return yt.API_SPRITE_REGEX.test(t)}const xi=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function yi(t){const e=t.match(xi);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function ai(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}const pi="mapbox.eventData";function gr(t){if(!t)return null;const e=t.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(me.atob(e[1]).split("").map(i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class bi{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const i=gr(yt.ACCESS_TOKEN);let r="";return r=i&&i.u?me.btoa(encodeURIComponent(i.u).replace(/%([0-9A-F]{2})/g,(n,s)=>String.fromCharCode(+("0x"+s)))):yt.ACCESS_TOKEN||"",e?`${pi}.${e}:${r}`:`${pi}:${r}`}fetchEventData(){const e=Kr("localStorage"),i=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{const n=me.localStorage.getItem(i);n&&(this.eventData=JSON.parse(n));const s=me.localStorage.getItem(r);s&&(this.anonId=s)}catch{Pe("Unable to read from LocalStorage")}}saveEventData(){const e=Kr("localStorage"),i=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{me.localStorage.setItem(r,this.anonId),Object.keys(this.eventData).length>=1&&me.localStorage.setItem(i,JSON.stringify(this.eventData))}catch{Pe("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,i,r,n){if(!yt.EVENTS_URL)return;const s=yi(yt.EVENTS_URL);s.params.push(`access_token=${n||yt.ACCESS_TOKEN||""}`);const a={event:this.type,created:new Date(e).toISOString()},c=i?zt(a,i):a,p={url:ai(s),headers:{"Content-Type":"text/plain"},body:JSON.stringify([c])};this.pendingRequest=function(_,v){return Te(zt(_,{method:"POST"}),v)}(p,_=>{this.pendingRequest=null,r(_),this.saveEventData(),this.processRequests(n)})}queueRequest(e,i){this.queue.push(e),this.processRequests(i)}}const zi=new class extends bi{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){yt.EVENTS_URL&&yt.ACCESS_TOKEN&&Array.isArray(t)&&t.some(i=>ct(i)||Pt(i))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=gr(yt.ACCESS_TOKEN),i=e?e.u:yt.ACCESS_TOKEN;let r=i!==this.eventData.tokenU;Cl(this.anonId)||(this.anonId=Il(),r=!0);const n=this.queue.shift();if(this.eventData.lastSuccess){const s=new Date(this.eventData.lastSuccess),a=new Date(n),c=(n-this.eventData.lastSuccess)/864e5;r=r||c>=1||c<-1||s.getDate()!==a.getDate()}else r=!0;r?this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Xt,skuId:kr,"enabled.telemetry":!1,userId:this.anonId},s=>{s||(this.eventData.lastSuccess=n,this.eventData.tokenU=i)},t):this.processRequests()}},fn=zi.postTurnstileEvent.bind(zi),Qs=new class extends bi{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,i,r){this.skuToken=e,this.errorCb=r,yt.EVENTS_URL&&(i||yt.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(xe)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),Cl(this.anonId)||(this.anonId=Il()),this.postEvent(i,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Xt,skuId:kr,skuToken:this.skuToken,userId:this.anonId},r=>{r?this.errorCb(r):e&&(this.success[e]=!0)},t))}},HA=Qs.postMapLoadEvent.bind(Qs),Ls=new class extends bi{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){yt.EVENTS_URL&&(t||yt.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:e,performanceData:i}=this.queue.shift(),r=function(n){const s=me.performance.getEntriesByType("resource"),a=me.performance.getEntriesByType("mark"),c=function(C){const B={};if(C){for(const O in C)if(O!=="other")for(const G of C[O]){const q=`${O}ResolveRangeMin`,$=`${O}ResolveRangeMax`,J=`${O}RequestCount`,ie=`${O}RequestCachedCount`;B[q]=Math.min(B[q]||1/0,G.startTime),B[$]=Math.max(B[$]||-1/0,G.responseEnd);const re=te=>{B[te]===void 0&&(B[te]=0),++B[te]};G.transferSize!==void 0&&G.transferSize===0&&re(ie),re(J)}}return B}(function(C,B){const O={};if(C)for(const G of C){const q=B(G);O[q]===void 0&&(O[q]=[]),O[q].push(G)}return O}(s,Je)),p=me.devicePixelRatio,_=me.navigator.connection||me.navigator.mozConnection||me.navigator.webkitConnection,v={counters:[],metadata:[],attributes:[]},E=(C,B,O)=>{O!=null&&C.push({name:B,value:O.toString()})};for(const C in c)E(v.counters,C,c[C]);if(n.interactionRange[0]!==1/0&&n.interactionRange[1]!==-1/0&&(E(v.counters,"interactionRangeMin",n.interactionRange[0]),E(v.counters,"interactionRangeMax",n.interactionRange[1])),a)for(const C of Object.keys(gt)){const B=gt[C],O=a.find(G=>G.name===B);O&&E(v.counters,B,O.startTime)}return E(v.counters,"visibilityHidden",n.visibilityHidden),E(v.attributes,"style",function(C){if(C)for(const B of C){const O=B.name.split("?")[0];if(oe(O)){const G=O.split("/").slice(-2);if(G.length===2)return`mapbox://styles/${G[0]}/${G[1]}`}}}(s)),E(v.attributes,"terrainEnabled",n.terrainEnabled?"true":"false"),E(v.attributes,"fogEnabled",n.fogEnabled?"true":"false"),E(v.attributes,"projection",n.projection),E(v.attributes,"zoom",n.zoom),E(v.metadata,"devicePixelRatio",p),E(v.metadata,"connectionEffectiveType",_?_.effectiveType:void 0),E(v.metadata,"navigatorUserAgent",me.navigator.userAgent),E(v.metadata,"screenWidth",me.screen.width),E(v.metadata,"screenHeight",me.screen.height),E(v.metadata,"windowWidth",me.innerWidth),E(v.metadata,"windowHeight",me.innerHeight),E(v.metadata,"mapWidth",n.width/p),E(v.metadata,"mapHeight",n.height/p),E(v.metadata,"webglRenderer",n.renderer),E(v.metadata,"webglVendor",n.vendor),E(v.metadata,"sdkVersion",Xt),E(v.metadata,"sdkIdentifier","mapbox-gl-js"),v}(i);for(const n of r.metadata);for(const n of r.counters);for(const n of r.attributes);this.postEvent(e,r,()=>{},t)}},Rs=Ls.postPerformanceEvent.bind(Ls),ko=new class extends bi{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,i,r){if(!yt.API_URL||!yt.SESSION_PATH)return;const n=yi(yt.API_URL+yt.SESSION_PATH);n.params.push(`sku=${e||""}`),n.params.push(`access_token=${r||yt.ACCESS_TOKEN||""}`);const s={url:ai(n),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(a,c){return Te(zt(a,{method:"GET"}),c)}(s,a=>{this.pendingRequest=null,i(a),this.saveEventData(),this.processRequests(r)})}getSessionAPI(t,e,i,r){this.skuToken=e,this.errorCb=r,yt.SESSION_PATH&&yt.API_URL&&(i||yt.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(xe)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||this.getSession(i,this.skuToken,r=>{r?this.errorCb(r):e&&(this.success[e]=!0)},t)}},nn=ko.getSessionAPI.bind(ko),qo=new Set;function Dr(t,e){e?qo.add(t):qo.delete(t)}const gt={create:"create",load:"load",fullLoad:"fullLoad"},Di={mark(t){me.performance.mark(t)},measure(t,e,i){me.performance.measure(t,e,i)}};function Je(t){const e=t.name.split("?")[0];return o(e)&&e.includes("mapbox-gl.js")?"javascript":o(e)&&e.includes("mapbox-gl.css")?"css":function(i){return yt.API_FONTS_REGEX.test(i)}(e)?"fontRange":ti(e)?"sprite":oe(e)?"style":function(i){return yt.API_TILEJSON_REGEX.test(i)}(e)?"tilejson":"other"}const Ar=me.performance;function Hs(t){const e=t?t.url.toString():void 0;return Ar.getEntriesByName(e)}var DA=kl;function kl(t){return!function(e){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var r,n,s=new Blob([""],{type:"text/javascript"}),a=URL.createObjectURL(s);try{n=new Worker(a),r=!0}catch{r=!1}return n&&n.terminate(),URL.revokeObjectURL(a),r}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var r=document.createElement("canvas");r.width=r.height=1;var n=r.getContext("2d");if(!n)return!1;var s=n.getImageData(0,0,1,1);return s&&s.width===r.width}()?(nt[i=e&&e.failIfMajorPerformanceCaveat]===void 0&&(nt[i]=function(r){var n,s=function(a){var c=document.createElement("canvas"),p=Object.create(kl.webGLContextAttributes);return p.failIfMajorPerformanceCaveat=a,c.getContext("webgl",p)||c.getContext("experimental-webgl",p)}(r);if(!s)return!1;try{n=s.createShader(s.VERTEX_SHADER)}catch{return!1}return!(!n||s.isContextLost())&&(s.shaderSource(n,"void main() {}"),s.compileShader(n),s.getShaderParameter(n,s.COMPILE_STATUS)===!0)}(i)),nt[i]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var i}(t)}var nt={};let yn,Ze,As,Xl,ro;function WA(){return yn==null&&(yn=me.OffscreenCanvas&&new me.OffscreenCanvas(1,1).getContext("2d")&&typeof me.createImageBitmap=="function"),yn}kl.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Xi={now:()=>Xl!==void 0?Xl:me.performance.now(),setNow(t){Xl=t},restoreNow(){Xl=void 0},frame(t){const e=me.requestAnimationFrame(t);return{cancel:()=>me.cancelAnimationFrame(e)}},getImageData(t,e=0){const{width:i,height:r}=t;ro||(ro=me.document.createElement("canvas"));const n=ro.getContext("2d",{willReadFrequently:!0});if(!n)throw new Error("failed to create canvas 2d context");return(i>ro.width||r>ro.height)&&(ro.width=i,ro.height=r),n.clearRect(-e,-e,i+2*e,r+2*e),n.drawImage(t,0,0,i,r),n.getImageData(-e,-e,i+2*e,r+2*e)},resolveURL:t=>(Ze||(Ze=me.document.createElement("a")),Ze.href=t,Ze.href),get devicePixelRatio(){return me.devicePixelRatio},get prefersReducedMotion(){return!!me.matchMedia&&(As==null&&(As=me.matchMedia("(prefers-reduced-motion: reduce)")),As.matches)},hasCanvasFingerprintNoise(){if(!WA())return!1;const t=new me.OffscreenCanvas(85,1),e=t.getContext("2d",{willReadFrequently:!0});let i=0;for(let n=0;n<t.width;++n)e.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,e.fillRect(n,0,1,1);const r=e.getImageData(0,0,t.width,t.height);i=0;for(let n=0;n<r.data.length;++n)if(n%4!=3&&i++!==r.data[n])return!0;return!1}};function mn(t,e,i){const r=me.document.createElement(t);return e!==void 0&&(r.className=e),i&&i.appendChild(r),r}function Qo(t,e,i){const r=me.document.createElementNS("http://www.w3.org/2000/svg",t);for(const n of Object.keys(e))r.setAttributeNS(null,n,e[n]);return i&&i.appendChild(r),r}const Fs=me.document&&me.document.documentElement.style,Wn=Fs&&Fs.userSelect!==void 0?"userSelect":"WebkitUserSelect";let co;function Ds(){Fs&&Wn&&(co=Fs[Wn],Fs[Wn]="none")}function Dl(){Fs&&Wn&&(Fs[Wn]=co)}function $A(t){t.preventDefault(),t.stopPropagation(),me.removeEventListener("click",$A,!0)}function XA(){me.addEventListener("click",$A,!0),me.setTimeout(()=>{me.removeEventListener("click",$A,!0)},0)}function Pl(t,e){const i=t.getBoundingClientRect();return YA(t,i,e)}function uA(t,e){const i=t.getBoundingClientRect(),r=[];for(let n=0;n<e.length;n++)r.push(YA(t,i,e[n]));return r}function is(t){return me.InstallTrigger!==void 0&&t.button===2&&t.ctrlKey&&me.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:t.button}function YA(t,e,i){const r=t.offsetWidth===e.width?1:t.offsetWidth/e.width;return new At((i.clientX-e.left)*r,(i.clientY-e.top)*r)}function jn(t,e,i){i[t]&&i[t].indexOf(e)!==-1||(i[t]=i[t]||[],i[t].push(e))}function hA(t,e,i){if(i&&i[t]){const r=i[t].indexOf(e);r!==-1&&i[t].splice(r,1)}}class ei{constructor(e,i={}){zt(this,i),this.type=e}}class ir extends ei{constructor(e,i={}){super("error",zt({error:e},i))}}class rs{on(e,i){return this._listeners=this._listeners||{},jn(e,i,this._listeners),this}off(e,i){return hA(e,i,this._listeners),hA(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},jn(e,i,this._oneTimeListeners),this):new Promise(r=>this.once(e,r))}fire(e,i){typeof e=="string"&&(e=new ei(e,i||{}));const r=e.type;if(this.listens(r)){e.target=this;const n=this._listeners&&this._listeners[r]?this._listeners[r].slice():[];for(const c of n)c.call(this,e);const s=this._oneTimeListeners&&this._oneTimeListeners[r]?this._oneTimeListeners[r].slice():[];for(const c of s)hA(r,c,this._oneTimeListeners),c.call(this,e);const a=this._eventedParent;a&&(zt(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),a.fire(e))}else e instanceof ir&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}var xt=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","default":[0,1],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');class vi{constructor(e,i,r,n){this.message=(e?`${e}: `:"")+r,n&&(this.identifier=n),i!=null&&i.__line__&&(this.line=i.__line__)}}class Do extends vi{}function Ho(t,...e){for(const i of e)for(const r in i)t[r]=i[r];return t}function xn(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function ta(t){if(Array.isArray(t))return t.map(ta);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const i in t)e[i]=ta(t[i]);return e}return xn(t)}class Yl extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}var Po=Yl;class Kl{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[r,n]of i)this.bindings[r]=n}concat(e){return new Kl(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var dA=Kl;const $n={kind:"null"},Ht={kind:"number"},ji={kind:"string"},ar={kind:"boolean"},sn={kind:"color"},ia={kind:"object"},Pr={kind:"value"},ma={kind:"collator"},Ja={kind:"formatted"},ra={kind:"resolvedImage"};function no(t,e){return{kind:"array",itemType:t,N:e}}function Xn(t){if(t.kind==="array"){const e=Xn(t.itemType);return typeof t.N=="number"?`array<${e}, ${t.N}>`:t.itemType.kind==="value"?"array":`array<${e}>`}return t.kind}const fl=[$n,Ht,ji,ar,sn,Ja,ia,no(Pr),ra];function Os(t,e){if(e.kind==="error")return null;if(t.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Os(t.itemType,e.itemType))&&(typeof t.N!="number"||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if(t.kind==="value"){for(const i of fl)if(!Os(i,e))return null}}return`Expected ${Xn(t)} but found ${Xn(e)} instead.`}function _a(t,e){return e.some(i=>i.kind===t.kind)}function zl(t,e){return e.some(i=>i==="null"?t===null:i==="array"?Array.isArray(t):i==="object"?t&&!Array.isArray(t)&&typeof t=="object":i===typeof t)}var ga,el={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Fa(t){return(t=Math.round(t))<0?0:t>255?255:t}function KA(t){return Fa(t[t.length-1]==="%"?parseFloat(t)/100*255:parseInt(t))}function fA(t){return(e=t[t.length-1]==="%"?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function PA(t,e,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?t+(e-t)*i*6:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t}try{ga={}.parseCSSColor=function(t){var e,i=t.replace(/ /g,"").toLowerCase();if(i in el)return el[i].slice();if(i[0]==="#")return i.length===4?(e=parseInt(i.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:i.length===7&&(e=parseInt(i.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var r=i.indexOf("("),n=i.indexOf(")");if(r!==-1&&n+1===i.length){var s=i.substr(0,r),a=i.substr(r+1,n-(r+1)).split(","),c=1;switch(s){case"rgba":if(a.length!==4)return null;c=fA(a.pop());case"rgb":return a.length!==3?null:[KA(a[0]),KA(a[1]),KA(a[2]),c];case"hsla":if(a.length!==4)return null;c=fA(a.pop());case"hsl":if(a.length!==3)return null;var p=(parseFloat(a[0])%360+360)%360/360,_=fA(a[1]),v=fA(a[2]),E=v<=.5?v*(_+1):v+_-v*_,C=2*v-E;return[Fa(255*PA(C,E,p+1/3)),Fa(255*PA(C,E,p)),Fa(255*PA(C,E,p-1/3)),c];default:return null}}return null}}catch{}class Wo{constructor(e,i,r,n=1){this.r=e,this.g=i,this.b=r,this.a=n}static parse(e){if(!e)return;if(e instanceof Wo)return e;if(typeof e!="string")return;const i=ga(e);return i?new Wo(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toString(){const[e,i,r,n]=this.toArray();return`rgba(${Math.round(e)},${Math.round(i)},${Math.round(r)},${n})`}toArray(){const{r:e,g:i,b:r,a:n}=this;return n===0?[0,0,0,0]:[255*e/n,255*i/n,255*r/n,n]}toArray01(){const{r:e,g:i,b:r,a:n}=this;return n===0?[0,0,0,0]:[e/n,i/n,r/n,n]}toArray01Scaled(e){const{r:i,g:r,b:n,a:s}=this;return s===0?[0,0,0]:[i/s*e,r/s*e,n/s*e]}toArray01PremultipliedAlpha(){const{r:e,g:i,b:r,a:n}=this;return[e,i,r,n]}toArray01Linear(){const{r:e,g:i,b:r,a:n}=this;return n===0?[0,0,0,0]:[Math.pow(e/n,2.2),Math.pow(i/n,2.2),Math.pow(r/n,2.2),n]}}Wo.black=new Wo(0,0,0,1),Wo.white=new Wo(1,1,1,1),Wo.transparent=new Wo(0,0,0,0),Wo.red=new Wo(1,0,0,1),Wo.blue=new Wo(0,0,1,1);var pr=Wo;class Oa{constructor(e,i,r){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class zA{constructor(e,i,r,n,s){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=r,this.fontStack=n,this.textColor=s}}class uo{constructor(e){this.sections=e}static fromString(e){return new uo([new zA(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.namePrimary.length!==0)}static factory(e){return e instanceof uo?e:uo.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){e.push(["image",i.image.namePrimary]);continue}e.push(i.text);const r={};i.fontStack&&(r["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(r["font-scale"]=i.scale),i.textColor&&(r["text-color"]=["rgba"].concat(i.textColor.toArray())),e.push(r)}return e}}class so{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),this.available=e.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(e,i){return e?new so({namePrimary:e,nameSecondary:i,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function Bl(t,e,i,r){return typeof t=="number"&&t>=0&&t<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?r===void 0||typeof r=="number"&&r>=0&&r<=1?null:`Invalid rgba value [${[t,e,i,r].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof r=="number"?[t,e,i,r]:[t,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Jl(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof pr||t instanceof Oa||t instanceof uo||t instanceof so)return!0;if(Array.isArray(t)){for(const e of t)if(!Jl(e))return!1;return!0}if(typeof t=="object"){for(const e in t)if(!Jl(t[e]))return!1;return!0}return!1}function hs(t){if(t===null)return $n;if(typeof t=="string")return ji;if(typeof t=="boolean")return ar;if(typeof t=="number")return Ht;if(t instanceof pr)return sn;if(t instanceof Oa)return ma;if(t instanceof uo)return Ja;if(t instanceof so)return ra;if(Array.isArray(t)){const e=t.length;let i;for(const r of t){const n=hs(r);if(i){if(i===n)continue;i=Pr;break}i=n}return no(i||Pr,e)}return ia}function ya(t){const e=typeof t;return t===null?"":e==="string"||e==="number"||e==="boolean"?String(t):t instanceof pr||t instanceof uo||t instanceof so?t.toString():JSON.stringify(t)}class Ll{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Jl(e[1]))return i.error("invalid value");const r=e[1];let n=hs(r);const s=i.expectedType;return n.kind!=="array"||n.N!==0||!s||s.kind!=="array"||typeof s.N=="number"&&s.N!==0||(n=s),new Ll(n,r)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof pr?["rgba"].concat(this.value.toArray()):this.value instanceof uo?this.value.serialize():this.value}}var Vs=Ll,cs=class{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}};const Rl={string:ji,number:Ht,boolean:ar,object:ia};class BA{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let r,n=1;const s=e[0];if(s==="array"){let c,p;if(e.length>2){const _=e[1];if(typeof _!="string"||!(_ in Rl)||_==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);c=Rl[_],n++}else c=Pr;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);p=e[2],n++}r=no(c,p)}else r=Rl[s];const a=[];for(;n<e.length;n++){const c=i.parse(e[n],n,Pr);if(!c)return null;a.push(c)}return new BA(r,a)}evaluate(e){for(let i=0;i<this.args.length;i++){const r=this.args[i].evaluate(e);if(!Os(this.type,hs(r)))return r;if(i===this.args.length-1)throw new cs(`Expected value to be of type ${Xn(this.type)}, but found ${Xn(hs(r))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,i=[e.kind];if(e.kind==="array"){const r=e.itemType;if(r.kind==="string"||r.kind==="number"||r.kind==="boolean"){i.push(r.kind);const n=e.N;(typeof n=="number"||this.args.length>1)&&i.push(n)}}return i.concat(this.args.map(r=>r.serialize()))}}var Gr=BA;class Yn{constructor(e){this.type=Ja,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const r=e[1];if(!Array.isArray(r)&&typeof r=="object")return i.error("First argument must be an image or text section.");const n=[];let s=!1;for(let a=1;a<=e.length-1;++a){const c=e[a];if(s&&typeof c=="object"&&!Array.isArray(c)){s=!1;let p=null;if(c["font-scale"]&&(p=i.parse(c["font-scale"],1,Ht),!p))return null;let _=null;if(c["text-font"]&&(_=i.parse(c["text-font"],1,no(ji)),!_))return null;let v=null;if(c["text-color"]&&(v=i.parse(c["text-color"],1,sn),!v))return null;const E=n[n.length-1];E.scale=p,E.font=_,E.textColor=v}else{const p=i.parse(e[a],1,Pr);if(!p)return null;const _=p.type.kind;if(_!=="string"&&_!=="value"&&_!=="null"&&_!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");s=!0,n.push({content:p,scale:null,font:null,textColor:null})}}return new Yn(n)}evaluate(e){return new uo(this.sections.map(i=>{const r=i.content.evaluate(e);return hs(r)===ra?new zA("",r,null,null,null):new zA(ya(r),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const r={};i.scale&&(r["font-scale"]=i.scale.serialize()),i.font&&(r["text-font"]=i.font.serialize()),i.textColor&&(r["text-color"]=i.textColor.serialize()),e.push(r)}return e}}class eA{constructor(e,i){this.type=ra,this.inputPrimary=e,this.inputSecondary=i}static parse(e,i){if(e.length<2)return i.error("Expected two or more arguments.");const r=i.parse(e[1],1,ji);if(!r)return i.error("No image name provided.");if(e.length===2)return new eA(r);const n=i.parse(e[2],1,ji);return n?new eA(r,n):i.error("Secondary image variant is not a string.")}evaluate(e){const i=so.fromString(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0);return i&&e.availableImages&&(i.available=e.availableImages.indexOf(i.namePrimary)>-1,i.nameSecondary&&i.available&&e.availableImages&&(i.available=e.availableImages.indexOf(i.nameSecondary)>-1)),i}eachChild(e){e(this.inputPrimary),this.inputSecondary&&e(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function Gi(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}const xa={"to-boolean":ar,"to-color":sn,"to-number":Ht,"to-string":ji};class ns{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const r=e[0],n=[];let s=$n;if(r==="to-array"){if(!Array.isArray(e[1]))return null;const a=e[1].length;if(i.expectedType){if(i.expectedType.kind!=="array")return i.error(`Expected ${i.expectedType.kind} but found array.`);s=no(i.expectedType.itemType,a)}else{if(!(a>0&&Jl(e[1][0])))return null;s=no(hs(e[1][0]),a)}for(let c=0;c<a;c++){const p=e[1][c];let _;if(Gi(p)==="array")_=i.parse(p,void 0,s.itemType);else{const v=Gi(p);if(v!==s.itemType.kind)return i.error(`Expected ${s.itemType.kind} but found ${v}.`);_=i.registry.literal.parse(["literal",p===void 0?null:p],i)}if(!_)return null;n.push(_)}}else{if((r==="to-boolean"||r==="to-string")&&e.length!==2)return i.error("Expected one argument.");s=xa[r];for(let a=1;a<e.length;a++){const c=i.parse(e[a],a,Pr);if(!c)return null;n.push(c)}}return new ns(s,n)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let i,r;for(const n of this.args){if(i=n.evaluate(e),r=null,i instanceof pr)return i;if(typeof i=="string"){const s=e.parseColor(i);if(s)return s}else if(Array.isArray(i)&&(r=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:Bl(i[0],i[1],i[2],i[3]),!r))return new pr(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new cs(r||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const r of this.args){if(i=r.evaluate(e),i===null)return 0;const n=Number(i);if(!isNaN(n))return n}throw new cs(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?uo.fromString(ya(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?so.fromString(ya(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(i=>i.evaluate(e)):ya(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Yn([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new eA(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}var Tn=ns;const Va=["Unknown","Point","LineString","Polygon"];var Tc=class{constructor(t){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.options=t}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Va[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(t){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:i,y:r}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(i*e-t[0])+this.featureDistanceData.bearing[1]*(r*e-t[1])}return 0}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=pr.parse(t)),e}getConfig(t){return this.options?this.options.get(t):null}};class tl{constructor(e,i,r,n,s){this.name=e,this.type=i,this._evaluate=r,this.args=n,this._overloadIndex=s}evaluate(e){if(!this._evaluate){const i=tl.definitions[this.name];this._evaluate=Array.isArray(i)?i[2]:i.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){const r=e[0],n=tl.definitions[r];if(!n)return i.error(`Unknown expression "${r}". If you wanted a literal array, use ["literal", [...]].`,0);const s=Array.isArray(n)?n[0]:n.type,a=Array.isArray(n)?[[n[1],n[2]]]:n.overloads,c=[];let p=null,_=-1;for(const[v,E]of a){if(Array.isArray(v)&&v.length!==e.length-1)continue;c.push(v),_++,p=new sc(i.registry,i.path,null,i.scope,void 0,i.options);const C=[];let B=!1;for(let O=1;O<e.length;O++){const G=e[O],q=Array.isArray(v)?v[O-1]:v.type,$=p.parse(G,1+C.length,q);if(!$){B=!0;break}C.push($)}if(!B)if(Array.isArray(v)&&v.length!==C.length)p.error(`Expected ${v.length} arguments, but found ${C.length} instead.`);else{for(let O=0;O<C.length;O++){const G=Array.isArray(v)?v[O]:v.type,q=C[O];p.concat(O+1).checkSubtype(G,q.type)}if(p.errors.length===0)return new tl(r,s,E,C,_)}}if(c.length===1)i.errors.push(...p.errors);else{const v=(c.length?c:a.map(([C])=>C)).map(pA).join(" | "),E=[];for(let C=1;C<e.length;C++){const B=i.parse(e[C],1+E.length);if(!B)return null;E.push(Xn(B.type))}i.error(`Expected arguments of type ${v}, but found (${E.join(", ")}) instead.`)}return null}static register(e,i){tl.definitions=i;for(const r in i)e[r]=tl}}function pA(t){return Array.isArray(t)?`(${t.map(Xn).join(", ")})`:`(${Xn(t.type)}...)`}var zo=tl;class pl{constructor(e,i,r){this.type=ma,this.locale=r,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const r=e[1];if(typeof r!="object"||Array.isArray(r))return i.error("Collator options argument must be an object.");const n=i.parse(r["case-sensitive"]!==void 0&&r["case-sensitive"],1,ar);if(!n)return null;const s=i.parse(r["diacritic-sensitive"]!==void 0&&r["diacritic-sensitive"],1,ar);if(!s)return null;let a=null;return r.locale&&(a=i.parse(r.locale,1,ji),!a)?null:new pl(n,s,a)}evaluate(e){return new Oa(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}var Ln={exports:{}};Ln.exports=function(){function t(r,n,s,a,c){for(;a>s;){if(a-s>600){var p=a-s+1,_=n-s+1,v=Math.log(p),E=.5*Math.exp(2*v/3),C=.5*Math.sqrt(v*E*(p-E)/p)*(_-p/2<0?-1:1);t(r,n,Math.max(s,Math.floor(n-_*E/p+C)),Math.min(a,Math.floor(n+(p-_)*E/p+C)),c)}var B=r[n],O=s,G=a;for(e(r,s,n),c(r[a],B)>0&&e(r,s,a);O<G;){for(e(r,O,G),O++,G--;c(r[O],B)<0;)O++;for(;c(r[G],B)>0;)G--}c(r[s],B)===0?e(r,s,G):e(r,++G,a),G<=n&&(s=G+1),n<=G&&(a=G-1)}}function e(r,n,s){var a=r[n];r[n]=r[s],r[s]=a}function i(r,n){return r<n?-1:r>n?1:0}return function(r,n,s,a,c){t(r,n,s||0,a||r.length-1,c||i)}}();var Ec=qr(Ln.exports);function mA(t){let e=0;for(let i,r,n=0,s=t.length,a=s-1;n<s;a=n++)i=t[n],r=t[a],e+=(r.x-i.x)*(i.y+r.y);return e}function il(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function Na(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function xu(t,e,i){const r=t[0]-e[0],n=t[1]-e[1],s=t[0]-i[0],a=t[1]-i[1];return r*a-s*n==0&&r*s<=0&&n*a<=0}function Ps(t,e,i=!1){let r=!1;for(let c=0,p=e.length;c<p;c++){const _=e[c];for(let v=0,E=_.length,C=E-1;v<E;C=v++){const B=_[C],O=_[v];if(xu(t,B,O))return i;(s=B)[1]>(n=t)[1]!=(a=O)[1]>n[1]&&n[0]<(a[0]-s[0])*(n[1]-s[1])/(a[1]-s[1])+s[0]&&(r=!r)}}var n,s,a;return r}function Ns(t,e,i,r){const n=r[0]-i[0],s=r[1]-i[1],a=(t[0]-i[0])*s-n*(t[1]-i[1]),c=(e[0]-i[0])*s-n*(e[1]-i[1]);return a>0&&c<0||a<0&&c>0}function oo(t,e,i,r){return(n=[r[0]-i[0],r[1]-i[1]])[0]*(s=[e[0]-t[0],e[1]-t[1]])[1]-n[1]*s[0]!=0&&!(!Ns(t,e,i,r)||!Ns(i,r,t,e));var n,s}const na=8192;function ml(t,e){const i=(180+t[0])/360,r=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,n=Math.pow(2,e.z);return[Math.round(i*n*na),Math.round(r*n*na)]}function Kc(t,e){for(let i=0;i<e.length;i++)if(Ps(t,e[i]))return!0;return!1}function JA(t,e,i){for(const r of i)for(let n=0,s=r.length,a=s-1;n<s;a=n++)if(oo(t,e,r[a],r[n]))return!0;return!1}function Ws(t,e){for(let i=0;i<t.length;++i)if(!Ps(t[i],e))return!1;for(let i=0;i<t.length-1;++i)if(JA(t[i],t[i+1],e))return!1;return!0}function ho(t,e){for(let i=0;i<e.length;i++)if(Ws(t,e[i]))return!0;return!1}function $o(t,e,i){const r=[];for(let n=0;n<t.length;n++){const s=[];for(let a=0;a<t[n].length;a++){const c=ml(t[n][a],i);il(e,c),s.push(c)}r.push(s)}return r}function LA(t,e,i){const r=[];for(let n=0;n<t.length;n++){const s=$o(t[n],e,i);r.push(s)}return r}function Pn(t,e,i,r){if(t[0]<i[0]||t[0]>i[2]){const n=.5*r;let s=t[0]-i[0]>n?-r:i[0]-t[0]>n?r:0;s===0&&(s=t[0]-i[2]>n?-r:i[2]-t[0]>n?r:0),t[0]+=s}il(e,t)}function va(t,e,i,r){const n=Math.pow(2,r.z)*na,s=[r.x*na,r.y*na],a=[];if(!t)return a;for(const c of t)for(const p of c){const _=[p.x+s[0],p.y+s[1]];Pn(_,e,i,n),a.push(_)}return a}function Rn(t,e,i,r){const n=Math.pow(2,r.z)*na,s=[r.x*na,r.y*na],a=[];if(!t)return a;for(const p of t){const _=[];for(const v of p){const E=[v.x+s[0],v.y+s[1]];il(e,E),_.push(E)}a.push(_)}if(e[2]-e[0]<=n/2){(c=e)[0]=c[1]=1/0,c[2]=c[3]=-1/0;for(const p of a)for(const _ of p)Pn(_,e,i,n)}var c;return a}class Ua{constructor(e,i){this.type=ar,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Jl(e[1])){const r=e[1];if(r.type==="FeatureCollection")for(let n=0;n<r.features.length;++n){const s=r.features[n].geometry.type;if(s==="Polygon"||s==="MultiPolygon")return new Ua(r,r.features[n].geometry)}else if(r.type==="Feature"){const n=r.geometry.type;if(n==="Polygon"||n==="MultiPolygon")return new Ua(r,r.geometry)}else if(r.type==="Polygon"||r.type==="MultiPolygon")return new Ua(r,r)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(i,r){const n=[1/0,1/0,-1/0,-1/0],s=[1/0,1/0,-1/0,-1/0],a=i.canonicalID();if(!a)return!1;if(r.type==="Polygon"){const c=$o(r.coordinates,s,a),p=va(i.geometry(),n,s,a);if(!Na(n,s))return!1;for(const _ of p)if(!Ps(_,c))return!1}if(r.type==="MultiPolygon"){const c=LA(r.coordinates,s,a),p=va(i.geometry(),n,s,a);if(!Na(n,s))return!1;for(const _ of p)if(!Kc(_,c))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(i,r){const n=[1/0,1/0,-1/0,-1/0],s=[1/0,1/0,-1/0,-1/0],a=i.canonicalID();if(!a)return!1;if(r.type==="Polygon"){const c=$o(r.coordinates,s,a),p=Rn(i.geometry(),n,s,a);if(!Na(n,s))return!1;for(const _ of p)if(!Ws(_,c))return!1}if(r.type==="MultiPolygon"){const c=LA(r.coordinates,s,a),p=Rn(i.geometry(),n,s,a);if(!Na(n,s))return!1;for(const _ of p)if(!ho(_,c))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var rl=Ua,_l={exports:{}};_l.exports=function(){var t={kilometers:1,miles:.621371192237334,nauticalmiles:.5399568034557235,meters:1e3,metres:1e3,yards:1093.6132983377079,feet:3280.839895013123,inches:39370.078740157485},e=1/298.257223563,i=e*(2-e),r=Math.PI/180,n=function(_,v){if(_===void 0)throw new Error("No latitude given.");if(v&&!t[v])throw new Error("Unknown unit "+v+". Use one of: "+Object.keys(t).join(", "));var E=6378.137*r*(v?t[v]:1),C=Math.cos(_*r),B=1/(1-i*(1-C*C)),O=Math.sqrt(B);this.kx=E*O*C,this.ky=E*O*B*(1-i)},s={units:{configurable:!0}};function a(_,v){return _[0]===v[0]&&_[1]===v[1]}function c(_,v,E){var C=p(v[0]-_[0]);return[_[0]+C*E,_[1]+(v[1]-_[1])*E]}function p(_){for(;_<-180;)_+=360;for(;_>180;)_-=360;return _}return n.fromTile=function(_,v,E){var C=Math.PI*(1-2*(_+.5)/Math.pow(2,v)),B=Math.atan(.5*(Math.exp(C)-Math.exp(-C)))/r;return new n(B,E)},s.units.get=function(){return t},n.prototype.distance=function(_,v){var E=p(_[0]-v[0])*this.kx,C=(_[1]-v[1])*this.ky;return Math.sqrt(E*E+C*C)},n.prototype.bearing=function(_,v){var E=p(v[0]-_[0])*this.kx;return Math.atan2(E,(v[1]-_[1])*this.ky)/r},n.prototype.destination=function(_,v,E){var C=E*r;return this.offset(_,Math.sin(C)*v,Math.cos(C)*v)},n.prototype.offset=function(_,v,E){return[_[0]+v/this.kx,_[1]+E/this.ky]},n.prototype.lineDistance=function(_){for(var v=0,E=0;E<_.length-1;E++)v+=this.distance(_[E],_[E+1]);return v},n.prototype.area=function(_){for(var v=0,E=0;E<_.length;E++)for(var C=_[E],B=0,O=C.length,G=O-1;B<O;G=B++)v+=p(C[B][0]-C[G][0])*(C[B][1]+C[G][1])*(E?-1:1);return Math.abs(v)/2*this.kx*this.ky},n.prototype.along=function(_,v){var E=0;if(v<=0)return _[0];for(var C=0;C<_.length-1;C++){var B=_[C],O=_[C+1],G=this.distance(B,O);if((E+=G)>v)return c(B,O,(v-(E-G))/G)}return _[_.length-1]},n.prototype.pointToSegmentDistance=function(_,v,E){var C=v[0],B=v[1],O=p(E[0]-C)*this.kx,G=(E[1]-B)*this.ky,q=0;return O===0&&G===0||((q=(p(_[0]-C)*this.kx*O+(_[1]-B)*this.ky*G)/(O*O+G*G))>1?(C=E[0],B=E[1]):q>0&&(C+=O/this.kx*q,B+=G/this.ky*q)),O=p(_[0]-C)*this.kx,G=(_[1]-B)*this.ky,Math.sqrt(O*O+G*G)},n.prototype.pointOnLine=function(_,v){for(var E,C,B,O,G=1/0,q=0;q<_.length-1;q++){var $=_[q][0],J=_[q][1],ie=p(_[q+1][0]-$)*this.kx,re=(_[q+1][1]-J)*this.ky,te=0;ie===0&&re===0||((te=(p(v[0]-$)*this.kx*ie+(v[1]-J)*this.ky*re)/(ie*ie+re*re))>1?($=_[q+1][0],J=_[q+1][1]):te>0&&($+=ie/this.kx*te,J+=re/this.ky*te));var se=(ie=p(v[0]-$)*this.kx)*ie+(re=(v[1]-J)*this.ky)*re;se<G&&(G=se,E=$,C=J,B=q,O=te)}return{point:[E,C],index:B,t:Math.max(0,Math.min(1,O))}},n.prototype.lineSlice=function(_,v,E){var C=this.pointOnLine(E,_),B=this.pointOnLine(E,v);if(C.index>B.index||C.index===B.index&&C.t>B.t){var O=C;C=B,B=O}var G=[C.point],q=C.index+1,$=B.index;!a(E[q],G[0])&&q<=$&&G.push(E[q]);for(var J=q+1;J<=$;J++)G.push(E[J]);return a(E[$],B.point)||G.push(B.point),G},n.prototype.lineSliceAlong=function(_,v,E){for(var C=0,B=[],O=0;O<E.length-1;O++){var G=E[O],q=E[O+1],$=this.distance(G,q);if((C+=$)>_&&B.length===0&&B.push(c(G,q,(_-(C-$))/$)),C>=v)return B.push(c(G,q,(v-(C-$))/$)),B;C>_&&B.push(q)}return B},n.prototype.bufferPoint=function(_,v){var E=v/this.ky,C=v/this.kx;return[_[0]-C,_[1]-E,_[0]+C,_[1]+E]},n.prototype.bufferBBox=function(_,v){var E=v/this.ky,C=v/this.kx;return[_[0]-C,_[1]-E,_[2]+C,_[3]+E]},n.prototype.insideBBox=function(_,v){return p(_[0]-v[0])>=0&&p(_[0]-v[2])<=0&&_[1]>=v[1]&&_[1]<=v[3]},Object.defineProperties(n,s),n}();var fo=qr(_l.exports),ba={exports:{}};ba.exports=function(){var t=function(i,r){if(i===void 0&&(i=[]),r===void 0&&(r=e),this.data=i,this.length=this.data.length,this.compare=r,this.length>0)for(var n=(this.length>>1)-1;n>=0;n--)this._down(n)};function e(i,r){return i<r?-1:i>r?1:0}return t.prototype.push=function(i){this.data.push(i),this.length++,this._up(this.length-1)},t.prototype.pop=function(){if(this.length!==0){var i=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),i}},t.prototype.peek=function(){return this.data[0]},t.prototype._up=function(i){for(var r=this.data,n=this.compare,s=r[i];i>0;){var a=i-1>>1,c=r[a];if(n(s,c)>=0)break;r[i]=c,i=a}r[i]=s},t.prototype._down=function(i){for(var r=this.data,n=this.compare,s=this.length>>1,a=r[i];i<s;){var c=1+(i<<1),p=r[c],_=c+1;if(_<this.length&&n(r[_],p)<0&&(c=_,p=r[_]),n(p,a)>=0)break;r[i]=p,i=c}r[i]=a},t}();var Fl=qr(ba.exports),Mt=8192;function ec(t,e){return e.dist-t.dist}const nl=100,sl=50;function Mc(t){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}function po(t){return t[1]-t[0]+1}function sa(t,e){const i=t[1]>=t[0]&&t[1]<e;return i||console.warn("Distance Expression: Index is out of range"),i}function Bo(t,e){if(t[0]>t[1])return[null,null];const i=po(t);if(e){if(i===2)return[t,null];const r=Math.floor(i/2);return[[t[0],t[0]+r],[t[0]+r,t[1]]]}{if(i===1)return[t,null];const r=Math.floor(i/2)-1;return[[t[0],t[0]+r],[t[0]+r+1,t[1]]]}}function ja(t,e){const i=[1/0,1/0,-1/0,-1/0];if(!sa(e,t.length))return i;for(let r=e[0];r<=e[1];++r)il(i,t[r]);return i}function RA(t){const e=[1/0,1/0,-1/0,-1/0];for(let i=0;i<t.length;++i)for(let r=0;r<t[i].length;++r)il(e,t[i][r]);return e}function ol(t,e,i){if(Mc(t)||Mc(e))return NaN;let r=0,n=0;return t[2]<e[0]&&(r=e[0]-t[2]),t[0]>e[2]&&(r=t[0]-e[2]),t[1]>e[3]&&(n=t[1]-e[3]),t[3]<e[1]&&(n=e[1]-t[3]),i.distance([0,0],[r,n])}function tc(t,e){const i=Math.pow(2,e.z);return[(n=(t.x/Mt+e.x)/i,360*n-180),(r=(t.y/Mt+e.y)/i,360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90)];var r,n}function gl(t,e){const i=[];for(let r=0;r<t.length;++r)i.push(tc(t[r],e));return i}function FA(t,e,i){const r=i.pointOnLine(e,t).point;return i.distance(t,r)}function Lo(t,e,i,r,n){const s=i.slice(r[0],r[1]+1);let a=1/0;for(let c=e[0];c<=e[1];++c)if((a=Math.min(a,FA(t[c],s,n)))===0)return 0;return a}function Xo(t,e,i,r,n){const s=Math.min(n.pointToSegmentDistance(t,i,r),n.pointToSegmentDistance(e,i,r)),a=Math.min(n.pointToSegmentDistance(i,t,e),n.pointToSegmentDistance(r,t,e));return Math.min(s,a)}function wa(t,e,i,r,n){if(!sa(e,t.length)||!sa(r,i.length))return NaN;let s=1/0;for(let a=e[0];a<e[1];++a)for(let c=r[0];c<r[1];++c){if(oo(t[a],t[a+1],i[c],i[c+1]))return 0;s=Math.min(s,Xo(t[a],t[a+1],i[c],i[c+1],n))}return s}function al(t,e,i,r,n){if(!sa(e,t.length)||!sa(r,i.length))return NaN;let s=1/0;for(let a=e[0];a<=e[1];++a)for(let c=r[0];c<=r[1];++c)if((s=Math.min(s,n.distance(t[a],i[c])))===0)return s;return s}function yl(t,e,i){if(Ps(t,e,!0))return 0;let r=1/0;for(const n of e){const s=n.length;if(s<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(n[0]!==n[s-1]&&(r=Math.min(r,i.pointToSegmentDistance(t,n[s-1],n[0])))===0||(r=Math.min(r,FA(t,n,i)))===0)return r}return r}function vu(t,e,i,r){if(!sa(e,t.length))return NaN;for(let s=e[0];s<=e[1];++s)if(Ps(t[s],i,!0))return 0;let n=1/0;for(let s=e[0];s<e[1];++s)for(const a of i)for(let c=0,p=a.length,_=p-1;c<p;_=c++){if(oo(t[s],t[s+1],a[_],a[c]))return 0;n=Math.min(n,Xo(t[s],t[s+1],a[_],a[c],r))}return n}function ic(t,e){for(const i of t)for(let r=0;r<=i.length-1;++r)if(Ps(i[r],e,!0))return!0;return!1}function Jc(t,e,i,r=1/0){const n=RA(t),s=RA(e);if(r!==1/0&&ol(n,s,i)>=r)return r;if(Na(n,s)){if(ic(t,e))return 0}else if(ic(e,t))return 0;let a=r;for(const c of t)for(let p=0,_=c.length,v=_-1;p<_;v=p++)for(const E of e)for(let C=0,B=E.length,O=B-1;C<B;O=C++){if(oo(c[v],c[p],E[O],E[C]))return 0;a=Math.min(a,Xo(c[v],c[p],E[O],E[C],i))}return a}function tA(t,e,i,r,n,s,a){if(s===null||a===null)return;const c=ol(ja(r,s),ja(n,a),i);c<e&&t.push({dist:c,range1:s,range2:a})}function ll(t,e,i,r,n=1/0){let s=Math.min(r.distance(t[0],i[0][0]),n);if(s===0)return s;const a=new Fl([{dist:0,range1:[0,t.length-1],range2:[0,0]}],ec),c=e?sl:nl,p=RA(i);for(;a.length;){const _=a.pop();if(_.dist>=s)continue;const v=_.range1;if(po(v)<=c){if(!sa(v,t.length))return NaN;if(e){const E=vu(t,v,i,r);if((s=Math.min(s,E))===0)return s}else for(let E=v[0];E<=v[1];++E){const C=yl(t[E],i,r);if((s=Math.min(s,C))===0)return s}}else{const E=Bo(v,e);if(E[0]!==null){const C=ol(ja(t,E[0]),p,r);C<s&&a.push({dist:C,range1:E[0],range2:[0,0]})}if(E[1]!==null){const C=ol(ja(t,E[1]),p,r);C<s&&a.push({dist:C,range1:E[1],range2:[0,0]})}}}return s}function Ga(t,e,i,r,n,s=1/0){let a=Math.min(s,n.distance(t[0],i[0]));if(a===0)return a;const c=new Fl([{dist:0,range1:[0,t.length-1],range2:[0,i.length-1]}],ec),p=e?sl:nl,_=r?sl:nl;for(;c.length;){const v=c.pop();if(v.dist>=a)continue;const E=v.range1,C=v.range2;if(po(E)<=p&&po(C)<=_){if(!sa(E,t.length)||!sa(C,i.length))return NaN;if(e&&r?a=Math.min(a,wa(t,E,i,C,n)):e||r?e&&!r?a=Math.min(a,Lo(i,C,t,E,n)):!e&&r&&(a=Math.min(a,Lo(t,E,i,C,n))):a=Math.min(a,al(t,E,i,C,n)),a===0)return a}else{const B=Bo(E,e),O=Bo(C,r);tA(c,a,n,t,i,B[0],O[0]),tA(c,a,n,t,i,B[0],O[1]),tA(c,a,n,t,i,B[1],O[0]),tA(c,a,n,t,i,B[1],O[1])}}return a}function Vi(t,e,i,r,n=1/0){let s=n;const a=ja(t,[0,t.length-1]);for(const c of i)if(!(s!==1/0&&ol(a,ja(c,[0,c.length-1]),r)>=s)&&(s=Math.min(s,Ga(t,e,c,!0,r,s)),s===0))return s;return s}function Ro(t,e,i,r,n=1/0){let s=n;const a=ja(t,[0,t.length-1]);for(const c of i){if(s!==1/0&&ol(a,RA(c),r)>=s)continue;const p=ll(t,e,c,r,s);if(isNaN(p))return p;if((s=Math.min(s,p))===0)return s}return s}function Za(t){return t==="Point"||t==="MultiPoint"||t==="LineString"||t==="MultiLineString"||t==="Polygon"||t==="MultiPolygon"}class Al{constructor(e,i){this.type=Ht,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(Jl(e[1])){const r=e[1];if(r.type==="FeatureCollection"){for(let n=0;n<r.features.length;++n)if(Za(r.features[n].geometry.type))return new Al(r,r.features[n].geometry)}else if(r.type==="Feature"){if(Za(r.geometry.type))return new Al(r,r.geometry)}else if(Za(r.type))return new Al(r,r)}return i.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const i=e.geometry(),r=e.canonicalID();if(i!=null&&r!=null){if(e.geometryType()==="Point")return function(n,s,a){const c=[];for(const _ of n)for(const v of _)c.push(tc(v,s));const p=new fo(c[0][1],"meters");return a.type==="Point"||a.type==="MultiPoint"||a.type==="LineString"?Ga(c,!1,a.type==="Point"?[a.coordinates]:a.coordinates,a.type==="LineString",p):a.type==="MultiLineString"?Vi(c,!1,a.coordinates,p):a.type==="Polygon"||a.type==="MultiPolygon"?Ro(c,!1,a.type==="Polygon"?[a.coordinates]:a.coordinates,p):null}(i,r,this.geometries);if(e.geometryType()==="LineString")return function(n,s,a){const c=[];for(const _ of n){const v=[];for(const E of _)v.push(tc(E,s));c.push(v)}const p=new fo(c[0][0][1],"meters");if(a.type==="Point"||a.type==="MultiPoint"||a.type==="LineString")return Vi(a.type==="Point"?[a.coordinates]:a.coordinates,a.type==="LineString",c,p);if(a.type==="MultiLineString"){let _=1/0;for(let v=0;v<a.coordinates.length;v++){const E=Vi(a.coordinates[v],!0,c,p,_);if(isNaN(E))return E;if((_=Math.min(_,E))===0)return _}return _}if(a.type==="Polygon"||a.type==="MultiPolygon"){let _=1/0;for(let v=0;v<c.length;v++){const E=Ro(c[v],!0,a.type==="Polygon"?[a.coordinates]:a.coordinates,p,_);if(isNaN(E))return E;if((_=Math.min(_,E))===0)return _}return _}return null}(i,r,this.geometries);if(e.geometryType()==="Polygon")return function(n,s,a){const c=[];for(const _ of function(v,E){const C=v.length;if(C<=1)return[v];const B=[];let O,G;for(let q=0;q<C;q++){const $=mA(v[q]);$!==0&&(v[q].area=Math.abs($),G===void 0&&(G=$<0),G===$<0?(O&&B.push(O),O=[v[q]]):O.push(v[q]))}return O&&B.push(O),B}(n)){const v=[];for(let E=0;E<_.length;++E)v.push(gl(_[E],s));c.push(v)}const p=new fo(c[0][0][0][1],"meters");if(a.type==="Point"||a.type==="MultiPoint"||a.type==="LineString")return Ro(a.type==="Point"?[a.coordinates]:a.coordinates,a.type==="LineString",c,p);if(a.type==="MultiLineString"){let _=1/0;for(let v=0;v<a.coordinates.length;v++){const E=Ro(a.coordinates[v],!0,c,p,_);if(isNaN(E))return E;if((_=Math.min(_,E))===0)return _}return _}return a.type==="Polygon"||a.type==="MultiPolygon"?function(_,v,E){let C=1/0;for(const B of _)for(const O of v){const G=Jc(B,O,E,C);if(isNaN(G))return G;if((C=Math.min(C,G))===0)return C}return C}(a.type==="Polygon"?[a.coordinates]:a.coordinates,c,p):null}(i,r,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}var rc=Al;function Si(t){if(t instanceof zo&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof rl||t instanceof rc)return!1;let e=!0;return t.eachChild(i=>{e&&!Si(i)&&(e=!1)}),e}function iA(t){if(t instanceof zo&&t.name==="feature-state")return!1;let e=!0;return t.eachChild(i=>{e&&!iA(i)&&(e=!1)}),e}function OA(t){if(t instanceof zo&&t.name==="config")return!1;let e=!0;return t.eachChild(i=>{e&&!OA(i)&&(e=!1)}),e}function oa(t,e){if(t instanceof zo&&e.indexOf(t.name)>=0)return!1;let i=!0;return t.eachChild(r=>{i&&!oa(r,e)&&(i=!1)}),i}class _A{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const r=e[1];return i.scope.has(r)?new _A(r,i.scope.get(r)):i.error(`Unknown variable "${r}". Make sure "${r}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var nc=_A;class VA{constructor(e,i=[],r,n=new dA,s=[],a){this.registry=e,this.path=i,this.key=i.map(c=>`[${c}]`).join(""),this.scope=n,this.errors=s,this.expectedType=r,this.options=a}parse(e,i,r,n,s={}){return i||r?this.concat(i,r,n)._parse(e,s):this._parse(e,s)}_parse(e,i){function r(n,s,a){return a==="assert"?new Gr(s,[n]):a==="coerce"?new Tn(s,[n]):n}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const n=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(n){let s=n.parse(e,this);if(!s)return null;if(this.expectedType){const a=this.expectedType,c=s.type;if(a.kind!=="string"&&a.kind!=="number"&&a.kind!=="boolean"&&a.kind!=="object"&&a.kind!=="array"||c.kind!=="value")if(a.kind!=="color"&&a.kind!=="formatted"&&a.kind!=="resolvedImage"||c.kind!=="value"&&c.kind!=="string"){if(this.checkSubtype(a,c))return null}else s=r(s,a,i.typeAnnotation||"coerce");else s=r(s,a,i.typeAnnotation||"assert")}if(!(s instanceof Vs)&&s.type.kind!=="resolvedImage"&&Ms(s)){const a=new Tc(this.options);try{s=new Vs(s.type,s.evaluate(a))}catch(c){return this.error(c.message),null}}return s}return Tn.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,r){const n=typeof e=="number"?this.path.concat(e):this.path,s=r?this.scope.concat(r):this.scope;return new VA(this.registry,n,i||null,s,this.errors,this.options)}error(e,...i){const r=`${this.key}${i.map(n=>`[${n}]`).join("")}`;this.errors.push(new Po(r,e))}checkSubtype(e,i){const r=Os(e,i);return r&&this.error(r),r}}var sc=VA;function Ms(t){if(t instanceof nc)return Ms(t.boundExpression);if(t instanceof zo&&t.name==="error"||t instanceof zo&&t.name==="config"||t instanceof pl||t instanceof rl||t instanceof rc)return!1;const e=t instanceof Tn||t instanceof Gr;let i=!0;return t.eachChild(r=>{i=e?i&&Ms(r):i&&r instanceof Vs}),!!i&&Si(t)&&oa(t,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light"])}function gA(t,e){const i=t.length-1;let r,n,s=0,a=i,c=0;for(;s<=a;)if(c=Math.floor((s+a)/2),r=t[c],n=t[c+1],r<=e){if(c===i||e<n)return c;s=c+1}else{if(!(r>e))throw new cs("Input is not a number.");a=c-1}return 0}class NA{constructor(e,i,r){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[n,s]of r)this.labels.push(n),this.outputs.push(s)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const r=i.parse(e[1],1,Ht);if(!r)return null;const n=[];let s=null;i.expectedType&&i.expectedType.kind!=="value"&&(s=i.expectedType);for(let a=1;a<e.length;a+=2){const c=a===1?-1/0:e[a],p=e[a+1],_=a,v=a+1;if(typeof c!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',_);if(n.length&&n[n.length-1][0]>=c)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',_);const E=i.parse(p,v,s);if(!E)return null;s=s||E.type,n.push([c,E])}return new NA(s,r,n)}evaluate(e){const i=this.labels,r=this.outputs;if(i.length===1)return r[0].evaluate(e);const n=this.input.evaluate(e);if(n<=i[0])return r[0].evaluate(e);const s=i.length;return n>=i[s-1]?r[s-1].evaluate(e):r[gA(i,n)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}var UA=NA;function Ji(t,e,i){return t*(1-i)+e*i}function To(t,e,i){return t.map((r,n)=>Ji(r,e[n],i))}var Ta=Object.freeze({__proto__:null,array:To,color:function(t,e,i){return new pr(Ji(t.r,e.r,i),Ji(t.g,e.g,i),Ji(t.b,e.b,i),Ji(t.a,e.a,i))},number:Ji});const rA=.95047,oc=1.08883,nA=4/29,xl=6/29,Ss=3*xl*xl,aa=xl*xl*xl,Gn=Math.PI/180,mo=180/Math.PI;function mr(t){return t>aa?Math.pow(t,1/3):t/Ss+nA}function Yo(t){return t>xl?t*t*t:Ss*(t-nA)}function ac(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Ol(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function lc(t){const e=Ol(t.r),i=Ol(t.g),r=Ol(t.b),n=mr((.4124564*e+.3575761*i+.1804375*r)/rA),s=mr((.2126729*e+.7151522*i+.072175*r)/1);return{l:116*s-16,a:500*(n-s),b:200*(s-mr((.0193339*e+.119192*i+.9503041*r)/oc)),alpha:t.a}}function _o(t){let e=(t.l+16)/116,i=isNaN(t.a)?e:e+t.a/500,r=isNaN(t.b)?e:e-t.b/200;return e=1*Yo(e),i=rA*Yo(i),r=oc*Yo(r),new pr(ac(3.2404542*i-1.5371385*e-.4985314*r),ac(-.969266*i+1.8760108*e+.041556*r),ac(.0556434*i-.2040259*e+1.0572252*r),t.alpha)}function Ea(t,e,i){const r=e-t;return t+i*(r>180||r<-180?r-360*Math.round(r/360):r)}const Vt={forward:lc,reverse:_o,interpolate:function(t,e,i){return{l:Ji(t.l,e.l,i),a:Ji(t.a,e.a,i),b:Ji(t.b,e.b,i),alpha:Ji(t.alpha,e.alpha,i)}}},Jt={forward:function(t){const{l:e,a:i,b:r}=lc(t),n=Math.atan2(r,i)*mo;return{h:n<0?n+360:n,c:Math.sqrt(i*i+r*r),l:e,alpha:t.a}},reverse:function(t){const e=t.h*Gn,i=t.c;return _o({l:t.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:t.alpha})},interpolate:function(t,e,i){return{h:Ea(t.h,e.h,i),c:Ji(t.c,e.c,i),l:Ji(t.l,e.l,i),alpha:Ji(t.alpha,e.alpha,i)}}};var sA=Object.freeze({__proto__:null,hcl:Jt,lab:Vt});class vl{constructor(e,i,r,n,s){this.type=e,this.operator=i,this.interpolation=r,this.input=n,this.labels=[],this.outputs=[];for(const[a,c]of s)this.labels.push(a),this.outputs.push(c)}static interpolationFactor(e,i,r,n){let s=0;if(e.name==="exponential")s=Vl(i,e.base,r,n);else if(e.name==="linear")s=Vl(i,1,r,n);else if(e.name==="cubic-bezier"){const a=e.controlPoints;s=new Jn(a[0],a[1],a[2],a[3]).solve(Vl(i,1,r,n))}return s}static parse(e,i){let[r,n,s,...a]=e;if(!Array.isArray(n)||n.length===0)return i.error("Expected an interpolation type expression.",1);if(n[0]==="linear")n={name:"linear"};else if(n[0]==="exponential"){const _=n[1];if(typeof _!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);n={name:"exponential",base:_}}else{if(n[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(n[0])}`,1,0);{const _=n.slice(1);if(_.length!==4||_.some(v=>typeof v!="number"||v<0||v>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);n={name:"cubic-bezier",controlPoints:_}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(s=i.parse(s,2,Ht),!s)return null;const c=[];let p=null;r==="interpolate-hcl"||r==="interpolate-lab"?p=sn:i.expectedType&&i.expectedType.kind!=="value"&&(p=i.expectedType);for(let _=0;_<a.length;_+=2){const v=a[_],E=a[_+1],C=_+3,B=_+4;if(typeof v!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',C);if(c.length&&c[c.length-1][0]>=v)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',C);const O=i.parse(E,B,p);if(!O)return null;p=p||O.type,c.push([v,O])}return p.kind==="number"||p.kind==="color"||p.kind==="array"&&p.itemType.kind==="number"&&typeof p.N=="number"?new vl(p,r,n,s,c):i.error(`Type ${Xn(p)} is not interpolatable.`)}evaluate(e){const i=this.labels,r=this.outputs;if(i.length===1)return r[0].evaluate(e);const n=this.input.evaluate(e);if(n<=i[0])return r[0].evaluate(e);const s=i.length;if(n>=i[s-1])return r[s-1].evaluate(e);const a=gA(i,n),c=vl.interpolationFactor(this.interpolation,n,i[a],i[a+1]),p=r[a].evaluate(e),_=r[a+1].evaluate(e);return this.operator==="interpolate"?Ta[this.type.kind.toLowerCase()](p,_,c):this.operator==="interpolate-hcl"?Jt.reverse(Jt.interpolate(Jt.forward(p),Jt.forward(_),c)):Vt.reverse(Vt.interpolate(Vt.forward(p),Vt.forward(_),c))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const i=[this.operator,e,this.input.serialize()];for(let r=0;r<this.labels.length;r++)i.push(this.labels[r],this.outputs[r].serialize());return i}}function Vl(t,e,i,r){const n=r-i,s=t-i;return n===0?0:e===1?s/n:(Math.pow(e,s)-1)/(Math.pow(e,n)-1)}var tn=vl;class la{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let r=null;const n=i.expectedType;n&&n.kind!=="value"&&(r=n);const s=[];for(const c of e.slice(1)){const p=i.parse(c,1+s.length,r,void 0,{typeAnnotation:"omit"});if(!p)return null;r=r||p.type,s.push(p)}const a=n&&s.some(c=>Os(n,c.type));return new la(a?Pr:r,s)}evaluate(e){let i,r=null,n=0;for(const s of this.args){if(n++,r=s.evaluate(e),r&&r instanceof so&&!r.available&&(i||(i=r),r=null,n===this.args.length))return i;if(r!==null)break}return r}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}var Zn=la;class x{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const r=[];for(let s=1;s<e.length-1;s+=2){const a=e[s];if(typeof a!="string")return i.error(`Expected string, but found ${typeof a} instead.`,s);if(/[^a-zA-Z0-9_]/.test(a))return i.error("Variable names must contain only alphanumeric characters or '_'.",s);const c=i.parse(e[s+1],s+1);if(!c)return null;r.push([a,c])}const n=i.parse(e[e.length-1],e.length-1,i.expectedType,r);return n?new x(r,n):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,r]of this.bindings)e.push(i,r.serialize());return e.push(this.result.serialize()),e}}var T=x;class M{constructor(e,i,r){this.type=e,this.index=i,this.input=r}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const r=i.parse(e[1],1,Ht),n=i.parse(e[2],2,no(i.expectedType||Pr));return r&&n?new M(n.type.itemType,r,n):null}evaluate(e){const i=this.index.evaluate(e),r=this.input.evaluate(e);if(i<0)throw new cs(`Array index out of bounds: ${i} < 0.`);if(i>=r.length)throw new cs(`Array index out of bounds: ${i} > ${r.length-1}.`);if(i!==Math.floor(i))throw new cs(`Array index must be an integer, but found ${i} instead.`);return r[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var L=M;class j{constructor(e,i){this.type=ar,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const r=i.parse(e[1],1,Pr),n=i.parse(e[2],2,Pr);return r&&n?_a(r.type,[ar,ji,Ht,$n,Pr])?new j(r,n):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Xn(r.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(r==null)return!1;if(!zl(i,["boolean","string","number","null"]))throw new cs(`Expected first argument to be of type boolean, string, number or null, but found ${Xn(hs(i))} instead.`);if(!zl(r,["string","array"]))throw new cs(`Expected second argument to be of type array or string, but found ${Xn(hs(r))} instead.`);return r.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var H=j;class Q{constructor(e,i,r){this.type=Ht,this.needle=e,this.haystack=i,this.fromIndex=r}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const r=i.parse(e[1],1,Pr),n=i.parse(e[2],2,Pr);if(!r||!n)return null;if(!_a(r.type,[ar,ji,Ht,$n,Pr]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Xn(r.type)} instead`);if(e.length===4){const s=i.parse(e[3],3,Ht);return s?new Q(r,n,s):null}return new Q(r,n)}evaluate(e){const i=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!zl(i,["boolean","string","number","null"]))throw new cs(`Expected first argument to be of type boolean, string, number or null, but found ${Xn(hs(i))} instead.`);if(!zl(r,["string","array"]))throw new cs(`Expected second argument to be of type array or string, but found ${Xn(hs(r))} instead.`);if(this.fromIndex){const n=this.fromIndex.evaluate(e);return r.indexOf(i,n)}return r.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var K=Q;class ue{constructor(e,i,r,n,s,a){this.inputType=e,this.type=i,this.input=r,this.cases=n,this.outputs=s,this.otherwise=a}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let r,n;i.expectedType&&i.expectedType.kind!=="value"&&(n=i.expectedType);const s={},a=[];for(let _=2;_<e.length-1;_+=2){let v=e[_];const E=e[_+1];Array.isArray(v)||(v=[v]);const C=i.concat(_);if(v.length===0)return C.error("Expected at least one branch label.");for(const O of v){if(typeof O!="number"&&typeof O!="string")return C.error("Branch labels must be numbers or strings.");if(typeof O=="number"&&Math.abs(O)>Number.MAX_SAFE_INTEGER)return C.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof O=="number"&&Math.floor(O)!==O)return C.error("Numeric branch labels must be integer values.");if(r){if(C.checkSubtype(r,hs(O)))return null}else r=hs(O);if(s[String(O)]!==void 0)return C.error("Branch labels must be unique.");s[String(O)]=a.length}const B=i.parse(E,_,n);if(!B)return null;n=n||B.type,a.push(B)}const c=i.parse(e[1],1,Pr);if(!c)return null;const p=i.parse(e[e.length-1],e.length-1,n);return p?c.type.kind!=="value"&&i.concat(1).checkSubtype(r,c.type)?null:new ue(r,n,c,s,a,p):null}evaluate(e){const i=this.input.evaluate(e);return(hs(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),r=[],n={};for(const a of i){const c=n[this.cases[a]];c===void 0?(n[this.cases[a]]=r.length,r.push([this.cases[a],[a]])):r[c][1].push(a)}const s=a=>this.inputType.kind==="number"?Number(a):a;for(const[a,c]of r)e.push(c.length===1?s(c[0]):c.map(s)),e.push(this.outputs[a].serialize());return e.push(this.otherwise.serialize()),e}}var Se=ue;class De{constructor(e,i,r){this.type=e,this.branches=i,this.otherwise=r}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let r;i.expectedType&&i.expectedType.kind!=="value"&&(r=i.expectedType);const n=[];for(let a=1;a<e.length-1;a+=2){const c=i.parse(e[a],a,ar);if(!c)return null;const p=i.parse(e[a+1],a+1,r);if(!p)return null;n.push([c,p]),r=r||p.type}const s=i.parse(e[e.length-1],e.length-1,r);return s?new De(r,n,s):null}evaluate(e){for(const[i,r]of this.branches)if(i.evaluate(e))return r.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,r]of this.branches)e(i),e(r);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}var _t=De;class Xe{constructor(e,i,r,n){this.type=e,this.input=i,this.beginIndex=r,this.endIndex=n}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const r=i.parse(e[1],1,Pr),n=i.parse(e[2],2,Ht);if(!r||!n)return null;if(!_a(r.type,[no(Pr),ji,Pr]))return i.error(`Expected first argument to be of type array or string, but found ${Xn(r.type)} instead`);if(e.length===4){const s=i.parse(e[3],3,Ht);return s?new Xe(r.type,r,n,s):null}return new Xe(r.type,r,n)}evaluate(e){const i=this.input.evaluate(e),r=this.beginIndex.evaluate(e);if(!zl(i,["string","array"]))throw new cs(`Expected first argument to be of type array or string, but found ${Xn(hs(i))} instead.`);if(this.endIndex){const n=this.endIndex.evaluate(e);return i.slice(r,n)}return i.slice(r)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var tt=Xe;function z(t,e){return t==="=="||t==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function l(t,e,i,r){return r.compare(e,i)===0}function g(t,e,i){const r=t!=="=="&&t!=="!=";return class k2{constructor(s,a,c){this.type=ar,this.lhs=s,this.rhs=a,this.collator=c,this.hasUntypedArgument=s.type.kind==="value"||a.type.kind==="value"}static parse(s,a){if(s.length!==3&&s.length!==4)return a.error("Expected two or three arguments.");const c=s[0];let p=a.parse(s[1],1,Pr);if(!p)return null;if(!z(c,p.type))return a.concat(1).error(`"${c}" comparisons are not supported for type '${Xn(p.type)}'.`);let _=a.parse(s[2],2,Pr);if(!_)return null;if(!z(c,_.type))return a.concat(2).error(`"${c}" comparisons are not supported for type '${Xn(_.type)}'.`);if(p.type.kind!==_.type.kind&&p.type.kind!=="value"&&_.type.kind!=="value")return a.error(`Cannot compare types '${Xn(p.type)}' and '${Xn(_.type)}'.`);r&&(p.type.kind==="value"&&_.type.kind!=="value"?p=new Gr(_.type,[p]):p.type.kind!=="value"&&_.type.kind==="value"&&(_=new Gr(p.type,[_])));let v=null;if(s.length===4){if(p.type.kind!=="string"&&_.type.kind!=="string"&&p.type.kind!=="value"&&_.type.kind!=="value")return a.error("Cannot use collator to compare non-string types.");if(v=a.parse(s[3],3,ma),!v)return null}return new k2(p,_,v)}evaluate(s){const a=this.lhs.evaluate(s),c=this.rhs.evaluate(s);if(r&&this.hasUntypedArgument){const p=hs(a),_=hs(c);if(p.kind!==_.kind||p.kind!=="string"&&p.kind!=="number")throw new cs(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${p.kind}, ${_.kind}) instead.`)}if(this.collator&&!r&&this.hasUntypedArgument){const p=hs(a),_=hs(c);if(p.kind!=="string"||_.kind!=="string")return e(s,a,c)}return this.collator?i(s,a,c,this.collator.evaluate(s)):e(s,a,c)}eachChild(s){s(this.lhs),s(this.rhs),this.collator&&s(this.collator)}outputDefined(){return!0}serialize(){const s=[t];return this.eachChild(a=>{s.push(a.serialize())}),s}}}const S=g("==",function(t,e,i){return e===i},l),k=g("!=",function(t,e,i){return e!==i},function(t,e,i,r){return!l(0,e,i,r)}),F=g("<",function(t,e,i){return e<i},function(t,e,i,r){return r.compare(e,i)<0}),Z=g(">",function(t,e,i){return e>i},function(t,e,i,r){return r.compare(e,i)>0}),u=g("<=",function(t,e,i){return e<=i},function(t,e,i,r){return r.compare(e,i)<=0}),h=g(">=",function(t,e,i){return e>=i},function(t,e,i,r){return r.compare(e,i)>=0});class f{constructor(e,i,r,n,s,a){this.type=ji,this.number=e,this.locale=i,this.currency=r,this.unit=n,this.minFractionDigits=s,this.maxFractionDigits=a}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const r=i.parse(e[1],1,Ht);if(!r)return null;const n=e[2];if(typeof n!="object"||Array.isArray(n))return i.error("NumberFormat options argument must be an object.");let s=null;if(n.locale&&(s=i.parse(n.locale,1,ji),!s))return null;let a=null;if(n.currency&&(a=i.parse(n.currency,1,ji),!a))return null;let c=null;if(n.unit&&(c=i.parse(n.unit,1,ji),!c))return null;let p=null;if(n["min-fraction-digits"]&&(p=i.parse(n["min-fraction-digits"],1,Ht),!p))return null;let _=null;return n["max-fraction-digits"]&&(_=i.parse(n["max-fraction-digits"],1,Ht),!_)?null:new f(r,s,a,c,p,_)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class y{constructor(e){this.type=Ht,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const r=i.parse(e[1],1);return r?r.type.kind!=="array"&&r.type.kind!=="string"&&r.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${Xn(r.type)} instead.`):new y(r):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new cs(`Expected value to be of type string or array, but found ${Xn(hs(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}function b(t){return function(){t=1831565813+(t|=0)|0;let e=Math.imul(t^t>>>15,1|t);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const I={"==":S,"!=":k,">":Z,"<":F,">=":h,"<=":u,array:Gr,at:L,boolean:Gr,case:_t,coalesce:Zn,collator:pl,format:Yn,image:eA,in:H,"index-of":K,interpolate:tn,"interpolate-hcl":tn,"interpolate-lab":tn,length:y,let:T,literal:Vs,match:Se,number:Gr,"number-format":f,object:Gr,slice:tt,step:UA,string:Gr,"to-boolean":Tn,"to-color":Tn,"to-number":Tn,"to-string":Tn,var:nc,within:rl,distance:rc};function R(t,[e,i,r,n]){e=e.evaluate(t),i=i.evaluate(t),r=r.evaluate(t);const s=n?n.evaluate(t):1,a=Bl(e,i,r,s);if(a)throw new cs(a);return new pr(e/255*s,i/255*s,r/255*s,s)}function V(t,[e,i,r,n]){e=e.evaluate(t),i=i.evaluate(t),r=r.evaluate(t);const s=n?n.evaluate(t):1,a=function(_,v,E,C){return typeof _=="number"&&_>=0&&_<=360?typeof v=="number"&&v>=0&&v<=100&&typeof E=="number"&&E>=0&&E<=100?C===void 0||typeof C=="number"&&C>=0&&C<=1?null:`Invalid hsla value [${[_,v,E,C].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof C=="number"?[_,v,E,C]:[_,v,E]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof C=="number"?[_,v,E,C]:[_,v,E]).join(", ")}]: 'h' must be between 0 and 360.`}(e,i,r,s);if(a)throw new cs(a);const c=`hsla(${e}, ${i}%, ${r}%, ${s})`,p=pr.parse(c);if(!p)throw new cs(`Failed to parse HSLA color: ${c}`);return p}function W(t,e){return t in e}function Y(t,e){const i=e[t];return i===void 0?null:i}function le(t,e){switch(t){case"string":return String(e);case"number":return+e;case"boolean":return!!e;case"color":return pr.parse(e)}return e}function fe(t,e,i,r){return r!==void 0&&(t=r*Math.round(t/r)),e!==void 0&&t<e&&(t=e),i!==void 0&&t>i&&(t=i),t}function ye(t,e,i){i.length&&(e+=`${i}`);const r=t.getConfig(e);if(!r)return null;const{type:n,value:s,values:a,minValue:c,maxValue:p,stepValue:_}=r,v=r.default.evaluate(t);let E=s?s.evaluate(t):v;return n&&(E=le(n,E)),s!==void 0&&E!==void 0&&a&&!a.includes(E)&&(E=v,n&&(E=le(n,E))),E===void 0||c===void 0&&p===void 0&&_===void 0||(typeof E=="number"?E=fe(E,c,p,_):Array.isArray(E)&&(E=E.map(C=>typeof C=="number"?fe(C,c,p,_):C))),E}function Ie(t){return{type:t}}zo.register(I,{error:[{kind:"error"},[ji],(t,[e])=>{throw new cs(e.evaluate(t))}],typeof:[ji,[Pr],(t,[e])=>Xn(hs(e.evaluate(t)))],"to-rgba":[no(Ht,4),[sn],(t,[e])=>e.evaluate(t).toArray()],rgb:[sn,[Ht,Ht,Ht],R],rgba:[sn,[Ht,Ht,Ht,Ht],R],hsl:[sn,[Ht,Ht,Ht],V],hsla:[sn,[Ht,Ht,Ht,Ht],V],has:{type:ar,overloads:[[[ji],(t,[e])=>W(e.evaluate(t),t.properties())],[[ji,ia],(t,[e,i])=>W(e.evaluate(t),i.evaluate(t))]]},get:{type:Pr,overloads:[[[ji],(t,[e])=>Y(e.evaluate(t),t.properties())],[[ji,ia],(t,[e,i])=>Y(e.evaluate(t),i.evaluate(t))]]},config:{type:Pr,overloads:[[[ji],(t,[e])=>ye(t,e.evaluate(t),"")],[[ji,ji],(t,[e,i])=>ye(t,e.evaluate(t),i.evaluate(t))]]},"feature-state":[Pr,[ji],(t,[e])=>Y(e.evaluate(t),t.featureState||{})],properties:[ia,[],t=>t.properties()],"geometry-type":[ji,[],t=>t.geometryType()],id:[Pr,[],t=>t.id()],zoom:[Ht,[],t=>t.globals.zoom],pitch:[Ht,[],t=>t.globals.pitch||0],"distance-from-center":[Ht,[],t=>t.distanceFromCenter()],"measure-light":[Ht,[ji],(t,[e])=>t.measureLight(e.evaluate(t))],"heatmap-density":[Ht,[],t=>t.globals.heatmapDensity||0],"line-progress":[Ht,[],t=>t.globals.lineProgress||0],"raster-value":[Ht,[],t=>t.globals.rasterValue||0],"sky-radial-progress":[Ht,[],t=>t.globals.skyRadialProgress||0],accumulated:[Pr,[],t=>t.globals.accumulated===void 0?null:t.globals.accumulated],"+":[Ht,Ie(Ht),(t,e)=>{let i=0;for(const r of e)i+=r.evaluate(t);return i}],"*":[Ht,Ie(Ht),(t,e)=>{let i=1;for(const r of e)i*=r.evaluate(t);return i}],"-":{type:Ht,overloads:[[[Ht,Ht],(t,[e,i])=>e.evaluate(t)-i.evaluate(t)],[[Ht],(t,[e])=>-e.evaluate(t)]]},"/":[Ht,[Ht,Ht],(t,[e,i])=>e.evaluate(t)/i.evaluate(t)],"%":[Ht,[Ht,Ht],(t,[e,i])=>e.evaluate(t)%i.evaluate(t)],ln2:[Ht,[],()=>Math.LN2],pi:[Ht,[],()=>Math.PI],e:[Ht,[],()=>Math.E],"^":[Ht,[Ht,Ht],(t,[e,i])=>Math.pow(e.evaluate(t),i.evaluate(t))],sqrt:[Ht,[Ht],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[Ht,[Ht],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[Ht,[Ht],(t,[e])=>Math.log(e.evaluate(t))],log2:[Ht,[Ht],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[Ht,[Ht],(t,[e])=>Math.sin(e.evaluate(t))],cos:[Ht,[Ht],(t,[e])=>Math.cos(e.evaluate(t))],tan:[Ht,[Ht],(t,[e])=>Math.tan(e.evaluate(t))],asin:[Ht,[Ht],(t,[e])=>Math.asin(e.evaluate(t))],acos:[Ht,[Ht],(t,[e])=>Math.acos(e.evaluate(t))],atan:[Ht,[Ht],(t,[e])=>Math.atan(e.evaluate(t))],min:[Ht,Ie(Ht),(t,e)=>Math.min(...e.map(i=>i.evaluate(t)))],max:[Ht,Ie(Ht),(t,e)=>Math.max(...e.map(i=>i.evaluate(t)))],abs:[Ht,[Ht],(t,[e])=>Math.abs(e.evaluate(t))],round:[Ht,[Ht],(t,[e])=>{const i=e.evaluate(t);return i<0?-Math.round(-i):Math.round(i)}],floor:[Ht,[Ht],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[Ht,[Ht],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[ar,[ji,Pr],(t,[e,i])=>t.properties()[e.value]===i.value],"filter-id-==":[ar,[Pr],(t,[e])=>t.id()===e.value],"filter-type-==":[ar,[ji],(t,[e])=>t.geometryType()===e.value],"filter-<":[ar,[ji,Pr],(t,[e,i])=>{const r=t.properties()[e.value],n=i.value;return typeof r==typeof n&&r<n}],"filter-id-<":[ar,[Pr],(t,[e])=>{const i=t.id(),r=e.value;return typeof i==typeof r&&i<r}],"filter->":[ar,[ji,Pr],(t,[e,i])=>{const r=t.properties()[e.value],n=i.value;return typeof r==typeof n&&r>n}],"filter-id->":[ar,[Pr],(t,[e])=>{const i=t.id(),r=e.value;return typeof i==typeof r&&i>r}],"filter-<=":[ar,[ji,Pr],(t,[e,i])=>{const r=t.properties()[e.value],n=i.value;return typeof r==typeof n&&r<=n}],"filter-id-<=":[ar,[Pr],(t,[e])=>{const i=t.id(),r=e.value;return typeof i==typeof r&&i<=r}],"filter->=":[ar,[ji,Pr],(t,[e,i])=>{const r=t.properties()[e.value],n=i.value;return typeof r==typeof n&&r>=n}],"filter-id->=":[ar,[Pr],(t,[e])=>{const i=t.id(),r=e.value;return typeof i==typeof r&&i>=r}],"filter-has":[ar,[Pr],(t,[e])=>e.value in t.properties()],"filter-has-id":[ar,[],t=>t.id()!==null&&t.id()!==void 0],"filter-type-in":[ar,[no(ji)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[ar,[no(Pr)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[ar,[ji,no(Pr)],(t,[e,i])=>i.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[ar,[ji,no(Pr)],(t,[e,i])=>function(r,n,s,a){for(;s<=a;){const c=s+a>>1;if(n[c]===r)return!0;n[c]>r?a=c-1:s=c+1}return!1}(t.properties()[e.value],i.value,0,i.value.length-1)],all:{type:ar,overloads:[[[ar,ar],(t,[e,i])=>e.evaluate(t)&&i.evaluate(t)],[Ie(ar),(t,e)=>{for(const i of e)if(!i.evaluate(t))return!1;return!0}]]},any:{type:ar,overloads:[[[ar,ar],(t,[e,i])=>e.evaluate(t)||i.evaluate(t)],[Ie(ar),(t,e)=>{for(const i of e)if(i.evaluate(t))return!0;return!1}]]},"!":[ar,[ar],(t,[e])=>!e.evaluate(t)],"is-supported-script":[ar,[ji],(t,[e])=>{const i=t.globals&&t.globals.isSupportedScript;return!i||i(e.evaluate(t))}],upcase:[ji,[ji],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[ji,[ji],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[ji,Ie(Pr),(t,e)=>e.map(i=>ya(i.evaluate(t))).join("")],"resolved-locale":[ji,[ma],(t,[e])=>e.evaluate(t).resolvedLocale()],random:[Ht,[Ht,Ht,Pr],(t,e)=>{const[i,r,n]=e.map(a=>a.evaluate(t));if(i>r||i===r)return i;let s;if(typeof n=="string")s=function(a){let c=0;if(a.length===0)return c;for(let p=0;p<a.length;p++)c=(c<<5)-c+a.charCodeAt(p),c&=c;return c}(n);else{if(typeof n!="number")throw new cs(`Invalid seed input: ${n}`);s=n}return i+b(s)()*(r-i)}]});var ke=I;function qe(t){return{result:"success",value:t}}function ut(t){return{result:"error",value:t}}function mt(t,e){return!!t&&!!t.parameters&&t.parameters.indexOf(e)>-1}function st(t){return t["property-type"]==="data-driven"}function ht(t){return mt(t.expression,"measure-light")}function ft(t){return mt(t.expression,"zoom")}function Ai(t){return!!t.expression&&t.expression.interpolated}function Nt(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function Wt(t){return t}function Gt(t,e){const i=e.type==="color",r=t.stops&&typeof t.stops[0][0]=="object",n=r||!(r||t.property!==void 0),s=t.type||(Ai(e)?"exponential":"interval");if(i&&((t=Ho({},t)).stops&&(t.stops=t.stops.map(_=>[_[0],pr.parse(_[1])])),t.default=pr.parse(t.default?t.default:e.default)),t.colorSpace&&t.colorSpace!=="rgb"&&!sA[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let a,c,p;if(s==="exponential")a=Fi;else if(s==="interval")a=Zi;else if(s==="categorical"){a=Hi,c=Object.create(null);for(const _ of t.stops)c[_[0]]=_[1];p=typeof t.stops[0][0]}else{if(s!=="identity")throw new Error(`Unknown function type "${s}"`);a=sr}if(r){const _={},v=[];for(let B=0;B<t.stops.length;B++){const O=t.stops[B],G=O[0].zoom;_[G]===void 0&&(_[G]={zoom:G,type:t.type,property:t.property,default:t.default,stops:[]},v.push(G)),_[G].stops.push([O[0].value,O[1]])}const E=[];for(const B of v)E.push([_[B].zoom,Gt(_[B],e)]);const C={name:"linear"};return{kind:"composite",interpolationType:C,interpolationFactor:tn.interpolationFactor.bind(void 0,C),zoomStops:E.map(B=>B[0]),evaluate:({zoom:B},O)=>Fi({stops:E,base:t.base},e,B).evaluate(B,O)}}if(n){const _=s==="exponential"?{name:"exponential",base:t.base!==void 0?t.base:1}:null;return{kind:"camera",interpolationType:_,interpolationFactor:tn.interpolationFactor.bind(void 0,_),zoomStops:t.stops.map(v=>v[0]),evaluate:({zoom:v})=>a(t,e,v,c,p)}}return{kind:"source",evaluate(_,v){const E=v&&v.properties?v.properties[t.property]:void 0;return E===void 0?lr(t.default,e.default):a(t,e,E,c,p)}}}function lr(t,e,i){return t!==void 0?t:e!==void 0?e:i!==void 0?i:void 0}function Hi(t,e,i,r,n){return lr(typeof i===n?r[i]:void 0,t.default,e.default)}function Zi(t,e,i){if(Gi(i)!=="number")return lr(t.default,e.default);const r=t.stops.length;if(r===1||i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[r-1][0])return t.stops[r-1][1];const n=gA(t.stops.map(s=>s[0]),i);return t.stops[n][1]}function Fi(t,e,i){const r=t.base!==void 0?t.base:1;if(Gi(i)!=="number")return lr(t.default,e.default);const n=t.stops.length;if(n===1||i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[n-1][0])return t.stops[n-1][1];const s=gA(t.stops.map(v=>v[0]),i),a=function(v,E,C,B){const O=B-C,G=v-C;return O===0?0:E===1?G/O:(Math.pow(E,G)-1)/(Math.pow(E,O)-1)}(i,r,t.stops[s][0],t.stops[s+1][0]),c=t.stops[s][1],p=t.stops[s+1][1];let _=Ta[e.type]||Wt;if(t.colorSpace&&t.colorSpace!=="rgb"){const v=sA[t.colorSpace];_=(E,C)=>v.reverse(v.interpolate(v.forward(E),v.forward(C),a))}return typeof c.evaluate=="function"?{evaluate(...v){const E=c.evaluate.apply(void 0,v),C=p.evaluate.apply(void 0,v);if(E!==void 0&&C!==void 0)return _(E,C,a)}}:_(c,p,a)}function sr(t,e,i){return e.type==="color"?i=pr.parse(i):e.type==="formatted"?i=uo.fromString(i.toString()):e.type==="resolvedImage"?i=so.fromString(i.toString()):Gi(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),lr(i,t.default,e.default)}class er{constructor(e,i,r){this.expression=e,this._warningHistory={},this._evaluator=new Tc(r),this._defaultValue=i?function(n){return n.type==="color"&&(Nt(n.default)||Array.isArray(n.default))?new pr(0,0,0,0):n.type==="color"?pr.parse(n.default)||null:n.default===void 0?null:n.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null}evaluateWithoutErrorHandling(e,i,r,n,s,a,c,p){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=r,this._evaluator.canonical=n||null,this._evaluator.availableImages=s||null,this._evaluator.formattedSection=a,this._evaluator.featureTileCoord=c||null,this._evaluator.featureDistanceData=p||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,r,n,s,a,c,p){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=r||null,this._evaluator.canonical=n||null,this._evaluator.availableImages=s||null,this._evaluator.formattedSection=a||null,this._evaluator.featureTileCoord=c||null,this._evaluator.featureDistanceData=p||null;try{const _=this.expression.evaluate(this._evaluator);if(_==null||typeof _=="number"&&_!=_)return this._defaultValue;if(this._enumValues&&!(_ in this._enumValues))throw new cs(`Expected value to be one of ${Object.keys(this._enumValues).map(v=>JSON.stringify(v)).join(", ")}, but found ${JSON.stringify(_)} instead.`);return _}catch(_){return this._warningHistory[_.message]||(this._warningHistory[_.message]=!0,typeof console<"u"&&console.warn(_.message)),this._defaultValue}}}function Nr(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in ke}function Yi(t,e,i){const r=new sc(ke,[],e?function(s){const a={color:sn,string:ji,number:Ht,enum:ji,boolean:ar,formatted:Ja,resolvedImage:ra};return s.type==="array"?no(a[s.value]||Pr,s.length):a[s.type]}(e):void 0,void 0,void 0,i),n=r.parse(t,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return n?qe(new er(n,e,i)):ut(r.errors)}class Rr{constructor(e,i,r){this.kind=e,this._styleExpression=i,this.isLightConstant=r,this.isStateDependent=e!=="constant"&&!iA(i.expression),this.isConfigDependent=!OA(i.expression)}evaluateWithoutErrorHandling(e,i,r,n,s,a){return this._styleExpression.evaluateWithoutErrorHandling(e,i,r,n,s,a)}evaluate(e,i,r,n,s,a){return this._styleExpression.evaluate(e,i,r,n,s,a)}}class kn{constructor(e,i,r,n,s){this.kind=e,this.zoomStops=r,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!iA(i.expression),this.isLightConstant=s,this.isConfigDependent=!OA(i.expression),this.interpolationType=n}evaluateWithoutErrorHandling(e,i,r,n,s,a){return this._styleExpression.evaluateWithoutErrorHandling(e,i,r,n,s,a)}evaluate(e,i,r,n,s,a){return this._styleExpression.evaluate(e,i,r,n,s,a)}interpolationFactor(e,i,r){return this.interpolationType?tn.interpolationFactor(this.interpolationType,e,i,r):0}}function Kn(t,e,i){if((t=Yi(t,e,i)).result==="error")return t;const r=t.value.expression,n=Si(r);if(!n&&!st(e))return ut([new Po("","data expressions not supported")]);const s=oa(r,["zoom","pitch","distance-from-center"]);if(!s&&!ft(e))return ut([new Po("","zoom expressions not supported")]);const a=oa(r,["measure-light"]);if(!a&&!ht(e))return ut([new Po("","measure-light expression not supported")]);const c=e.expression&&e.expression.relaxZoomRestriction,p=wl(r);return p||s||c?p instanceof Po?ut([p]):p instanceof tn&&!Ai(e)?ut([new Po("",'"interpolate" expressions cannot be used with this property')]):qe(p?new kn(n?"camera":"composite",t.value,p.labels,p instanceof tn?p.interpolation:void 0,a):new Rr(n?"constant":"source",t.value,a)):ut([new Po("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class bl{constructor(e,i){this._parameters=e,this._specification=i,Ho(this,Gt(this._parameters,this._specification))}static deserialize(e){return new bl(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function wl(t){let e=null;if(t instanceof T)e=wl(t.result);else if(t instanceof Zn){for(const i of t.args)if(e=wl(i),e)break}else(t instanceof UA||t instanceof tn)&&t.input instanceof zo&&t.input.name==="zoom"&&(e=t);return e instanceof Po||t.eachChild(i=>{const r=wl(i);r instanceof Po?e=r:e&&r&&e!==r&&(e=new Po("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function Fo(t){const e=t.key,i=t.value,r=t.valueSpec||{},n=t.objectElementValidators||{},s=t.style,a=t.styleSpec;let c=[];const p=Gi(i);if(p!=="object")return[new vi(e,i,`object expected, ${p} found`)];for(const _ in i){const v=_.split(".")[0];let E;n[v]?E=n[v]:r[v]?E=ca:n["*"]?E=n["*"]:r["*"]&&(E=ca),E?c=c.concat(E({key:(e&&`${e}.`)+_,value:i[_],valueSpec:r[v]||r["*"],style:s,styleSpec:a,object:i,objectKey:_},i)):c.push(new Do(e,i[_],`unknown property "${_}"`))}for(const _ in r)n[_]||r[_].required&&r[_].default===void 0&&i[_]===void 0&&c.push(new vi(e,i,`missing required property "${_}"`));return c}function Ac(t){const e=t.value,i=t.valueSpec,r=t.style,n=t.styleSpec,s=t.key,a=t.arrayElementValidator||ca;if(Gi(e)!=="array")return[new vi(s,e,`array expected, ${Gi(e)} found`)];if(i.length&&e.length!==i.length)return[new vi(s,e,`array length ${i.length} expected, length ${e.length} found`)];if(i["min-length"]&&e.length<i["min-length"])return[new vi(s,e,`array length at least ${i["min-length"]} expected, length ${e.length} found`)];let c={type:i.value,values:i.values,minimum:i.minimum,maximum:i.maximum,function:void 0};n.$version<7&&(c.function=i.function),Gi(i.value)==="object"&&(c=i.value);let p=[];for(let _=0;_<e.length;_++)p=p.concat(a({array:e,arrayIndex:_,value:e[_],valueSpec:c,style:r,styleSpec:n,key:`${s}[${_}]`},!0));return p}function Sc(t){const e=t.key,i=t.value,r=t.valueSpec;let n=Gi(i);if(n==="number"&&i!=i&&(n="NaN"),n!=="number")return[new vi(e,i,`number expected, ${n} found`)];if("minimum"in r){let s=r.minimum;if(Gi(r.minimum)==="array"&&(s=r.minimum[t.arrayIndex]),i<s)return[new vi(e,i,`${i} is less than the minimum value ${s}`)]}if("maximum"in r){let s=r.maximum;if(Gi(r.maximum)==="array"&&(s=r.maximum[t.arrayIndex]),i>s)return[new vi(e,i,`${i} is greater than the maximum value ${s}`)]}return[]}function Aa(t){const e=t.valueSpec,i=xn(t.value.type);let r,n,s,a={};const c=i!=="categorical"&&t.value.property===void 0,p=!c,_=Gi(t.value.stops)==="array"&&Gi(t.value.stops[0])==="array"&&Gi(t.value.stops[0][0])==="object",v=Fo({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(B){if(i==="identity")return[new vi(B.key,B.value,'identity function may not have a "stops" property')];let O=[];const G=B.value;return O=O.concat(Ac({key:B.key,value:G,valueSpec:B.valueSpec,style:B.style,styleSpec:B.styleSpec,arrayElementValidator:E})),Gi(G)==="array"&&G.length===0&&O.push(new vi(B.key,G,"array must have at least one stop")),O},default:function(B){return ca({key:B.key,value:B.value,valueSpec:e,style:B.style,styleSpec:B.styleSpec})}}});return i==="identity"&&c&&v.push(new vi(t.key,t.value,'missing required property "property"')),i==="identity"||t.value.stops||v.push(new vi(t.key,t.value,'missing required property "stops"')),i==="exponential"&&t.valueSpec.expression&&!Ai(t.valueSpec)&&v.push(new vi(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(p&&!st(t.valueSpec)?v.push(new vi(t.key,t.value,"property functions not supported")):c&&!ft(t.valueSpec)&&v.push(new vi(t.key,t.value,"zoom functions not supported"))),i!=="categorical"&&!_||t.value.property!==void 0||v.push(new vi(t.key,t.value,'"property" property is required')),v;function E(B){let O=[];const G=B.value,q=B.key;if(Gi(G)!=="array")return[new vi(q,G,`array expected, ${Gi(G)} found`)];if(G.length!==2)return[new vi(q,G,`array length 2 expected, length ${G.length} found`)];if(_){if(Gi(G[0])!=="object")return[new vi(q,G,`object expected, ${Gi(G[0])} found`)];if(G[0].zoom===void 0)return[new vi(q,G,"object stop key must have zoom")];if(G[0].value===void 0)return[new vi(q,G,"object stop key must have value")];const $=xn(G[0].zoom);if(typeof $!="number")return[new vi(q,G[0].zoom,"stop zoom values must be numbers")];if(s&&s>$)return[new vi(q,G[0].zoom,"stop zoom values must appear in ascending order")];$!==s&&(s=$,n=void 0,a={}),O=O.concat(Fo({key:`${q}[0]`,value:G[0],valueSpec:{zoom:{}},style:B.style,styleSpec:B.styleSpec,objectElementValidators:{zoom:Sc,value:C}}))}else O=O.concat(C({key:`${q}[0]`,value:G[0],valueSpec:{},style:B.style,styleSpec:B.styleSpec},G));return Nr(ta(G[1]))?O.concat([new vi(`${q}[1]`,G[1],"expressions are not allowed in function stops.")]):O.concat(ca({key:`${q}[1]`,value:G[1],valueSpec:e,style:B.style,styleSpec:B.styleSpec}))}function C(B,O){const G=Gi(B.value),q=xn(B.value),$=B.value!==null?B.value:O;if(r){if(G!==r)return[new vi(B.key,$,`${G} stop domain type must match previous stop domain type ${r}`)]}else r=G;if(G!=="number"&&G!=="string"&&G!=="boolean"&&typeof q!="number"&&typeof q!="string"&&typeof q!="boolean")return[new vi(B.key,$,"stop domain value must be a number, string, or boolean")];if(G!=="number"&&i!=="categorical"){let J=`number expected, ${G} found`;return st(e)&&i===void 0&&(J+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new vi(B.key,$,J)]}return i!=="categorical"||G!=="number"||typeof q=="number"&&isFinite(q)&&Math.floor(q)===q?i!=="categorical"&&G==="number"&&typeof q=="number"&&typeof n=="number"&&n!==void 0&&q<n?[new vi(B.key,$,"stop domain values must appear in ascending order")]:(n=q,i==="categorical"&&q in a?[new vi(B.key,$,"stop domain values must be unique")]:(a[q]=!0,[])):[new vi(B.key,$,`integer expected, found ${String(q)}`)]}}function $s(t){const e=(t.expressionContext==="property"?Kn:Yi)(ta(t.value),t.valueSpec);if(e.result==="error")return e.value.map(r=>new vi(`${t.key}${r.key}`,t.value,r.message));const i=e.value.expression||e.value._styleExpression.expression;if(t.expressionContext==="property"&&t.propertyKey==="text-font"&&!i.outputDefined())return[new vi(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if(t.expressionContext==="property"&&t.propertyType==="layout"&&!iA(i))return[new vi(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if(t.expressionContext==="filter")return Ma(i,t);if(t.expressionContext&&t.expressionContext.indexOf("cluster")===0){if(!oa(i,["zoom","feature-state"]))return[new vi(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(t.expressionContext==="cluster-initial"&&!Si(i))return[new vi(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ma(t,e){const i=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const n of e.valueSpec.expression.parameters)i.delete(n);if(i.size===0)return[];const r=[];return t instanceof zo&&i.has(t.name)?[new vi(e.key,e.value,`["${t.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(t.eachChild(n=>{r.push(...Ma(n,e))}),r)}function yA(t){const e=t.key,i=t.value,r=t.valueSpec,n=[];return Array.isArray(r.values)?r.values.indexOf(xn(i))===-1&&n.push(new vi(e,i,`expected one of [${r.values.join(", ")}], ${JSON.stringify(i)} found`)):Object.keys(r.values).indexOf(xn(i))===-1&&n.push(new vi(e,i,`expected one of [${Object.keys(r.values).join(", ")}], ${JSON.stringify(i)} found`)),n}function Us(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!Us(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function ao(t,e="fill"){if(t==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Us(t)||(t=Uu(t));const i=t;let r=!0;try{r=function(_){if(!Nl(_))return _;let v=ta(_);return Xs(v),v=qa(v),v}(i)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(i,null,2)}
        `)}const n=xt[`filter_${e}`],s=Yi(r,n);let a=null;if(s.result==="error")throw new Error(s.value.map(_=>`${_.key}: ${_.message}`).join(", "));a=(_,v,E)=>s.value.evaluate(_,v,{},E);let c=null,p=null;if(r!==i){const _=Yi(i,n);if(_.result==="error")throw new Error(_.value.map(v=>`${v.key}: ${v.message}`).join(", "));c=(v,E,C,B,O)=>_.value.evaluate(v,E,{},C,void 0,void 0,B,O),p=!Si(_.value.expression)}return{filter:a,dynamicFilter:c||void 0,needGeometry:Th(r),needFeature:!!p}}function qa(t){if(!Array.isArray(t))return t;const e=function(i){if(Nu.has(i[0])){for(let r=1;r<i.length;r++)if(Nl(i[r]))return!0}return i}(t);return e===!0?e:e.map(i=>qa(i))}function Xs(t){let e=!1;const i=[];if(t[0]==="case"){for(let r=1;r<t.length-1;r+=2)e=e||Nl(t[r]),i.push(t[r+1]);i.push(t[t.length-1])}else if(t[0]==="match"){e=e||Nl(t[1]);for(let r=2;r<t.length-1;r+=2)i.push(t[r+1]);i.push(t[t.length-1])}else if(t[0]==="step"){e=e||Nl(t[1]);for(let r=1;r<t.length-1;r+=2)i.push(t[r+1])}e&&(t.length=0,t.push("any",...i));for(let r=1;r<t.length;r++)Xs(t[r])}function Nl(t){if(!Array.isArray(t))return!1;if((e=t[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<t.length;i++)if(Nl(t[i]))return!0;return!1}const Nu=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function hd(t,e){return t<e?-1:t>e?1:0}function Th(t){if(!Array.isArray(t))return!1;if(t[0]==="within"||t[0]==="distance")return!0;for(let e=1;e<t.length;e++)if(Th(t[e]))return!0;return!1}function Uu(t){if(!t)return!0;const e=t[0];return t.length<=1?e!=="any":e==="=="?bu(t[1],t[2],"=="):e==="!="?Tl(bu(t[1],t[2],"==")):e==="<"||e===">"||e==="<="||e===">="?bu(t[1],t[2],e):e==="any"?(i=t.slice(1),["any"].concat(i.map(Uu))):e==="all"?["all"].concat(t.slice(1).map(Uu)):e==="none"?["all"].concat(t.slice(1).map(Uu).map(Tl)):e==="in"?oA(t[1],t.slice(2)):e==="!in"?Tl(oA(t[1],t.slice(2))):e==="has"?cc(t[1]):e!=="!has"||Tl(cc(t[1]));var i}function bu(t,e,i){switch(t){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,t,e]}}function oA(t,e){if(e.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",t,["literal",e.sort(hd)]]:["filter-in-small",t,["literal",e]]}}function cc(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Tl(t){return["!",t]}function cl(t){return Us(ta(t.value))?$s(Ho({},t,{expressionContext:"filter",valueSpec:t.styleSpec[`filter_${t.layerType||"fill"}`]})):aA(t)}function aA(t){const e=t.value,i=t.key;if(Gi(e)!=="array")return[new vi(i,e,`array expected, ${Gi(e)} found`)];const r=t.styleSpec;let n,s=[];if(e.length<1)return[new vi(i,e,"filter array must have at least 1 element")];switch(s=s.concat(yA({key:`${i}[0]`,value:e[0],valueSpec:r.filter_operator,style:t.style,styleSpec:t.styleSpec})),xn(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&xn(e[1])==="$type"&&s.push(new vi(i,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&s.push(new vi(i,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(n=Gi(e[1]),n!=="string"&&s.push(new vi(`${i}[1]`,e[1],`string expected, ${n} found`)));for(let a=2;a<e.length;a++)n=Gi(e[a]),xn(e[1])==="$type"?s=s.concat(yA({key:`${i}[${a}]`,value:e[a],valueSpec:r.geometry_type,style:t.style,styleSpec:t.styleSpec})):n!=="string"&&n!=="number"&&n!=="boolean"&&s.push(new vi(`${i}[${a}]`,e[a],`string, number, or boolean expected, ${n} found`));break;case"any":case"all":case"none":for(let a=1;a<e.length;a++)s=s.concat(aA({key:`${i}[${a}]`,value:e[a],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":n=Gi(e[1]),e.length!==2?s.push(new vi(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):n!=="string"&&s.push(new vi(`${i}[1]`,e[1],`string expected, ${n} found`))}return s}function ju(t,e){const i=t.key,r=t.style,n=t.layer,s=t.styleSpec,a=t.value,c=t.objectKey,p=s[`${e}_${t.layerType}`];if(!p)return[];const _=c.match(/^(.*)-transition$/);if(e==="paint"&&_&&p[_[1]]&&p[_[1]].transition)return ca({key:i,value:a,valueSpec:s.transition,style:r,styleSpec:s});const v=t.valueSpec||p[c];if(!v)return[new Do(i,a,`unknown property "${c}"`)];let E;if(Gi(a)==="string"&&st(v)&&!v.tokens&&(E=/^{([^}]+)}$/.exec(a))){const B=`\`{ "type": "identity", "property": ${E?JSON.stringify(E[1]):'"_"'} }\``;return[new vi(i,a,`"${c}" does not support interpolation syntax
Use an identity property function instead: ${B}.`)]}const C=[];if(t.layerType==="symbol")c!=="text-field"||!r||r.glyphs||r.imports||C.push(new vi(i,a,'use of "text-field" requires a style "glyphs" property')),c==="text-font"&&Nt(ta(a))&&xn(a.type)==="identity"&&C.push(new vi(i,a,'"text-font" does not support identity functions'));else if(t.layerType==="model"&&e==="paint"&&n&&n.layout&&n.layout.hasOwnProperty("model-id")&&st(v)&&(ht(v)||ft(v))){const B=Kn(ta(a),v),O=B.value.expression||B.value._styleExpression.expression;O&&!oa(O,["measure-light"])&&(c==="model-emissive-strength"&&Si(O)&&iA(O)||C.push(new vi(i,a,`${c} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return C.concat(ca({key:t.key,value:a,valueSpec:v,style:r,styleSpec:s,expressionContext:"property",propertyType:e,propertyKey:c}))}function xA(t){return ju(t,"paint")}function cp(t){return ju(t,"layout")}function bf(t){let e=[];const i=t.value,r=t.key,n=t.style,s=t.styleSpec;i.type||i.ref||e.push(new vi(r,i,'either "type" or "ref" is required'));let a=xn(i.type);const c=xn(i.ref);if(i.id){const p=xn(i.id);for(let _=0;_<t.arrayIndex;_++){const v=n.layers[_];xn(v.id)===p&&e.push(new vi(r,i.id,`duplicate layer id "${i.id}", previously used at line ${v.id.__line__}`))}}if("ref"in i){let p;["type","source","source-layer","filter","layout"].forEach(_=>{_ in i&&e.push(new vi(r,i[_],`"${_}" is prohibited for ref layers`))}),n.layers.forEach(_=>{xn(_.id)===c&&(p=_)}),p?p.ref?e.push(new vi(r,i.ref,"ref cannot reference another ref layer")):a=xn(p.type):typeof c=="string"&&e.push(new vi(r,i.ref,`ref layer "${c}" not found`))}else if(a!=="background"&&a!=="sky"&&a!=="slot")if(i.source){const p=n.sources&&n.sources[i.source],_=p&&xn(p.type);p?_==="vector"&&a==="raster"?e.push(new vi(r,i.source,`layer "${i.id}" requires a raster source`)):_==="raster"&&a!=="raster"?e.push(new vi(r,i.source,`layer "${i.id}" requires a vector source`)):_!=="vector"||i["source-layer"]?_==="raster-dem"&&a!=="hillshade"?e.push(new vi(r,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):a!=="line"||!i.paint||!i.paint["line-gradient"]&&!i.paint["line-trim-offset"]||_==="geojson"&&p.lineMetrics||e.push(new vi(r,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new vi(r,i,`layer "${i.id}" must specify a "source-layer"`)):e.push(new vi(r,i.source,`source "${i.source}" not found`))}else e.push(new vi(r,i,'missing required property "source"'));return e=e.concat(Fo({key:r,value:i,valueSpec:s.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>ca({key:`${r}.type`,value:i.type,valueSpec:s.layer.type,style:t.style,styleSpec:t.styleSpec,object:i,objectKey:"type"}),filter:p=>cl(Ho({layerType:a},p)),layout:p=>Fo({layer:i,key:p.key,value:p.value,valueSpec:{},style:p.style,styleSpec:p.styleSpec,objectElementValidators:{"*":_=>cp(Ho({layerType:a},_))}}),paint:p=>Fo({layer:i,key:p.key,value:p.value,valueSpec:{},style:p.style,styleSpec:p.styleSpec,objectElementValidators:{"*":_=>xA(Ho({layerType:a,layer:i},_))}})}})),e}function zs(t){const e=t.value,i=t.key,r=Gi(e);return r!=="string"?[new vi(i,e,`string expected, ${r} found`)]:[]}const dd={promoteId:function({key:t,value:e}){if(Gi(e)==="string")return zs({key:t,value:e});{const i=[];for(const r in e)i.push(...zs({key:`${t}.${r}`,value:e[r]}));return i}}};function wf(t){const e=t.value,i=t.key,r=t.styleSpec,n=t.style;if(!e.type)return[new vi(i,e,'"type" is required')];const s=xn(e.type);let a=[];switch(["vector","raster","raster-dem"].includes(s)&&(e.url||e.tiles||a.push(new vi(i,e,'Either "url" or "tiles" is required.'))),s){case"vector":case"raster":case"raster-dem":return a=a.concat(Fo({key:i,value:e,valueSpec:r[`source_${s.replace("-","_")}`],style:t.style,styleSpec:r,objectElementValidators:dd})),a;case"geojson":if(a=Fo({key:i,value:e,valueSpec:r.source_geojson,style:n,styleSpec:r,objectElementValidators:dd}),e.cluster)for(const c in e.clusterProperties){const[p,_]=e.clusterProperties[c],v=typeof p=="string"?[p,["accumulated"],["get",c]]:p;a.push(...$s({key:`${i}.${c}.map`,value:_,expressionContext:"cluster-map"})),a.push(...$s({key:`${i}.${c}.reduce`,value:v,expressionContext:"cluster-reduce"}))}return a;case"video":return Fo({key:i,value:e,valueSpec:r.source_video,style:n,styleSpec:r});case"image":return Fo({key:i,value:e,valueSpec:r.source_image,style:n,styleSpec:r});case"canvas":return[new vi(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return yA({key:`${i}.type`,value:e.type,valueSpec:{values:wu(r)},style:n,styleSpec:r})}}function wu(t){return t.source.reduce((e,i)=>{const r=t[i];return r.type.type==="enum"&&(e=e.concat(Object.keys(r.type.values))),e},[])}function eu(t){const e=t.value;let i=[];if(!e)return i;const r=Gi(e);return r!=="string"?(i=i.concat([new vi(t.key,e,`string expected, "${r}" found`)]),i):(function(n){const s=n.indexOf("://")===-1;try{return new URL(n,s?"http://example.com":void 0),!0}catch{return!1}}(e)||(i=i.concat([new vi(t.key,e,`invalid url "${e}"`)])),i)}function Eh(t){const e=t.value,i=t.styleSpec,r=i.light,n=t.style;let s=[];const a=Gi(e);if(e===void 0)return s;if(a!=="object")return s=s.concat([new vi("light",e,`object expected, ${a} found`)]),s;for(const c in e){const p=c.match(/^(.*)-transition$/);s=s.concat(p&&r[p[1]]&&r[p[1]].transition?ca({key:c,value:e[c],valueSpec:i.transition,style:n,styleSpec:i}):r[c]?ca({key:c,value:e[c],valueSpec:r[c],style:n,styleSpec:i}):[new vi(c,e[c],`unknown property "${c}"`)])}return s}function fd(t){const e=t.value;let i=[];if(!e)return i;const r=Gi(e);if(r!=="object")return i=i.concat([new vi("light-3d",e,`object expected, ${r} found`)]),i;const n=t.styleSpec,s=n["light-3d"],a=t.key,c=t.style,p=t.style.lights;for(const E of["type","id"])if(!(E in e))return i=i.concat([new vi("light-3d",e,`missing property ${E} on light`)]),i;if(e.type&&p)for(let E=0;E<t.arrayIndex;E++){const C=xn(e.type),B=p[E];xn(B.type)===C&&i.push(new vi(a,e.id,`duplicate light type "${e.type}", previously defined at line ${B.id.__line__}`))}const _=`properties_light_${e.type}`;if(!(_ in n))return i=i.concat([new vi("light-3d",e,`Invalid light type ${e.type}`)]),i;const v=n[_];for(const E in e)if(E==="properties"){const C=e[E],B=Gi(C);if(B!=="object")return i=i.concat([new vi("properties",C,`object expected, ${B} found`)]),i;for(const O in C)i=i.concat(v[O]?ca({key:O,value:C[O],valueSpec:v[O],style:c,styleSpec:n}):[new Do(t.key,C[O],`unknown property "${O}"`)])}else{const C=E.match(/^(.*)-transition$/);i=i.concat(C&&s[C[1]]&&s[C[1]].transition?ca({key:E,value:e[E],valueSpec:n.transition,style:c,styleSpec:n}):s[E]?ca({key:E,value:e[E],valueSpec:s[E],style:c,styleSpec:n}):[new Do(E,e[E],`unknown property "${E}"`)])}return i}function Tf(t){const e=t.value,i=t.key,r=t.style,n=t.styleSpec,s=n.terrain;let a=[];const c=Gi(e);if(e===void 0||c==="null")return a;if(c!=="object")return a=a.concat([new vi("terrain",e,`object expected, ${c} found`)]),a;for(const p in e){const _=p.match(/^(.*)-transition$/);a=a.concat(_&&s[_[1]]&&s[_[1]].transition?ca({key:p,value:e[p],valueSpec:n.transition,style:r,styleSpec:n}):s[p]?ca({key:p,value:e[p],valueSpec:s[p],style:r,styleSpec:n}):[new Do(p,e[p],`unknown property "${p}"`)])}if(e.source){const p=r.sources&&r.sources[e.source],_=p&&xn(p.type);p?_!=="raster-dem"&&a.push(new vi(i,e.source,`terrain cannot be used with a source of type ${String(_)}, it only be used with a "raster-dem" source type`)):a.push(new vi(i,e.source,`source "${e.source}" not found`))}else a.push(new vi(i,e,'terrain is missing required property "source"'));return a}function up(t){const e=t.value,i=t.style,r=t.styleSpec,n=r.fog;let s=[];const a=Gi(e);if(e===void 0)return s;if(a!=="object")return s=s.concat([new vi("fog",e,`object expected, ${a} found`)]),s;for(const c in e){const p=c.match(/^(.*)-transition$/);s=s.concat(p&&n[p[1]]&&n[p[1]].transition?ca({key:c,value:e[c],valueSpec:r.transition,style:i,styleSpec:r}):n[c]?ca({key:c,value:e[c],valueSpec:n[c],style:i,styleSpec:r}):[new Do(c,e[c],`unknown property "${c}"`)])}return s}const Ef={"*":()=>[],array:Ac,boolean:function(t){const e=t.value,i=t.key,r=Gi(e);return r!=="boolean"?[new vi(i,e,`boolean expected, ${r} found`)]:[]},number:Sc,color:function(t){const e=t.key,i=t.value,r=Gi(i);return r!=="string"?[new vi(e,i,`color expected, ${r} found`)]:ga(i)===null?[new vi(e,i,`color expected, "${i}" found`)]:[]},enum:yA,filter:cl,function:Aa,layer:bf,object:Fo,source:wf,model:eu,light:Eh,"light-3d":fd,terrain:Tf,fog:up,string:zs,formatted:function(t){return zs(t).length===0?[]:$s(t)},resolvedImage:function(t){return zs(t).length===0?[]:$s(t)},projection:function(t){const e=t.value,i=t.styleSpec,r=i.projection,n=t.style;let s=[];const a=Gi(e);if(a==="object")for(const c in e)s=s.concat(ca({key:c,value:e[c],valueSpec:r[c],style:n,styleSpec:i}));else a!=="string"&&(s=s.concat([new vi("projection",e,`object or string expected, ${a} found`)]));return s},import:function(t){const{value:e,styleSpec:i}=t,{data:r,...n}=e;Object.defineProperty(n,"__line__",{value:e.__line__,enumerable:!1});let s=Fo(Ho({},t,{value:n,valueSpec:i.import}));return xn(n.id)===""&&s.push(new vi(`${t.key}.id`,n,"import id can't be an empty string")),r&&(s=s.concat(hp(r,i,{key:`${t.key}.data`}))),s}};function ca(t,e=!1){const i=t.value,r=t.valueSpec,n=t.styleSpec;if(r.expression&&Nt(xn(i)))return Aa(t);if(r.expression&&Nr(ta(i)))return $s(t);if(r.type&&Ef[r.type]){const s=Ef[r.type](t);return e===!0&&s.length>0&&Gi(t.value)==="array"?$s(t):s}return Fo(Ho({},t,{valueSpec:r.type?n[r.type]:r}))}function Mf(t){const e=t.value,i=t.key,r=zs(t);return r.length||(e.indexOf("{fontstack}")===-1&&r.push(new vi(i,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&r.push(new vi(i,e,'"glyphs" url must include a "{range}" token'))),r}function hp(t,e=xt,i={}){return ca({key:i.key||"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:Mf,"*":()=>[]}})}function tu(t,e=xt){return js(hp(t,e))}const dp=t=>js(wf(t)),fp=t=>js(Eh(t)),Gu=t=>js(fd(t)),O_=t=>js(Tf(t)),Mh=t=>js(up(t)),pd=t=>js(bf(t)),Zu=t=>js(cl(t)),pp=t=>js(xA(t)),mp=t=>js(cp(t)),V_=t=>js(eu(t));function js(t){return t.slice().sort((e,i)=>e.line&&i.line?e.line-i.line:0)}function Ic(t,e){let i=!1;if(e&&e.length)for(const r of e)r instanceof Do?Pe(r.message):(t.fire(new ir(new Error(r.message))),i=!0);return i}var Sf=Ul,Cc=3;function Ul(t,e,i){var r=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var n=new Int32Array(this.arrayBuffer);t=n[0],this.d=(e=n[1])+2*(i=n[2]);for(var s=0;s<this.d*this.d;s++){var a=n[Cc+s],c=n[Cc+s+1];r.push(a===c?null:n.subarray(a,c))}var p=n[Cc+r.length+1];this.keys=n.subarray(n[Cc+r.length],p),this.bboxes=n.subarray(p),this.insert=this._insertReadonly}else{this.d=e+2*i;for(var _=0;_<this.d*this.d;_++)r.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=i,this.scale=e/t,this.uid=0;var v=i/e*t;this.min=-v,this.max=t+v}Ul.prototype.insert=function(t,e,i,r,n){this._forEachCell(e,i,r,n,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(r),this.bboxes.push(n)},Ul.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Ul.prototype._insertCell=function(t,e,i,r,n,s){this.cells[n].push(s)},Ul.prototype.query=function(t,e,i,r,n){var s=this.min,a=this.max;if(t<=s&&e<=s&&a<=i&&a<=r&&!n)return Array.prototype.slice.call(this.keys);var c=[];return this._forEachCell(t,e,i,r,this._queryCell,c,{},n),c},Ul.prototype._queryCell=function(t,e,i,r,n,s,a,c){var p=this.cells[n];if(p!==null)for(var _=this.keys,v=this.bboxes,E=0;E<p.length;E++){var C=p[E];if(a[C]===void 0){var B=4*C;(c?c(v[B+0],v[B+1],v[B+2],v[B+3]):t<=v[B+2]&&e<=v[B+3]&&i>=v[B+0]&&r>=v[B+1])?(a[C]=!0,s.push(_[C])):a[C]=!1}}},Ul.prototype._forEachCell=function(t,e,i,r,n,s,a,c){for(var p=this._convertToCellCoord(t),_=this._convertToCellCoord(e),v=this._convertToCellCoord(i),E=this._convertToCellCoord(r),C=p;C<=v;C++)for(var B=_;B<=E;B++){var O=this.d*B+C;if((!c||c(this._convertFromCellCoord(C),this._convertFromCellCoord(B),this._convertFromCellCoord(C+1),this._convertFromCellCoord(B+1)))&&n.call(this,t,e,i,r,O,s,a,c))return}},Ul.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},Ul.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},Ul.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=Cc+this.cells.length+1+1,i=0,r=0;r<this.cells.length;r++)i+=this.cells[r].length;var n=new Int32Array(e+i+this.keys.length+this.bboxes.length);n[0]=this.extent,n[1]=this.n,n[2]=this.padding;for(var s=e,a=0;a<t.length;a++){var c=t[a];n[Cc+a]=s,n.set(c,s),s+=c.length}return n[Cc+t.length]=s,n.set(this.keys,s),n[Cc+t.length+1]=s+=this.keys.length,n.set(this.bboxes,s),s+=this.bboxes.length,n.buffer};var qu=qr(Sf);const Tu={};function Ii(t,e,i={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),Tu[e]={klass:t,omit:i.omit||[]}}Ii(Object,"Object"),qu.serialize=function(t,e){const i=t.toArrayBuffer();return e&&e.add(i),{buffer:i}},qu.deserialize=function(t){return new qu(t.buffer)},Object.defineProperty(qu,"name",{value:"Grid"}),Ii(qu,"Grid"),Ii(pr,"Color"),Ii(Error,"Error"),Ii(Ae,"AJAXError"),Ii(so,"ResolvedImage"),Ii(bl,"StylePropertyFunction"),Ii(er,"StyleExpression",{omit:["_evaluator"]}),Ii(kn,"ZoomDependentExpression"),Ii(Rr,"ZoomConstantExpression"),Ii(zo,"CompoundExpression",{omit:["_evaluate"]});for(const t in ke)Tu[ke[t]._classRegistryKey]||Ii(ke[t],`Expression${t}`);function If(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function Cf(t){return me.ImageBitmap&&t instanceof me.ImageBitmap}function Eu(t,e){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(If(t)||Cf(t))return e&&e.add(t),t;if(ArrayBuffer.isView(t)){const i=t;return e&&e.add(i.buffer),i}if(t instanceof me.ImageData)return e&&e.add(t.data.buffer),t;if(Array.isArray(t)){const i=[];for(const r of t)i.push(Eu(r,e));return i}if(t instanceof Map){const i={$name:"Map"};for(const[r,n]of t.entries())i[r]=Eu(n);return i}if(typeof t=="object"){const i=t.constructor,r=i._classRegistryKey;if(!r)throw new Error(`can't serialize object of unregistered class ${r}`);const n=i.serialize?i.serialize(t,e):{};if(!i.serialize){for(const s in t)t.hasOwnProperty(s)&&(Tu[r].omit.indexOf(s)>=0||(n[s]=Eu(t[s],e)));t instanceof Error&&(n.message=t.message)}if(n.$name)throw new Error("$name property is reserved for worker serialization logic.");return r!=="Object"&&(n.$name=r),n}throw new Error("can't serialize object of type "+typeof t)}function Qu(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||If(t)||Cf(t)||ArrayBuffer.isView(t)||t instanceof me.ImageData)return t;if(Array.isArray(t))return t.map(Qu);if(typeof t=="object"){const e=t.$name||"Object";if(e==="Map"){const n=new Map;for(const s of Object.keys(t))s!=="$name"&&n.set(s,Qu(t[s]));return n}const{klass:i}=Tu[e];if(!i)throw new Error(`can't deserialize unregistered class ${e}`);if(i.deserialize)return i.deserialize(t);const r=Object.create(i.prototype);for(const n of Object.keys(t))n!=="$name"&&(r[n]=Qu(t[n]));return r}throw new Error("can't deserialize object of type "+typeof t)}const Bi={"Latin-1 Supplement":t=>t>=128&&t<=255,Arabic:t=>t>=1536&&t<=1791,"Arabic Supplement":t=>t>=1872&&t<=1919,"Arabic Extended-A":t=>t>=2208&&t<=2303,"Hangul Jamo":t=>t>=4352&&t<=4607,"Unified Canadian Aboriginal Syllabics":t=>t>=5120&&t<=5759,Khmer:t=>t>=6016&&t<=6143,"Unified Canadian Aboriginal Syllabics Extended":t=>t>=6320&&t<=6399,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"CJK Radicals Supplement":t=>t>=11904&&t<=12031,"Kangxi Radicals":t=>t>=12032&&t<=12255,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Bopomofo:t=>t>=12544&&t<=12591,"Hangul Compatibility Jamo":t=>t>=12592&&t<=12687,Kanbun:t=>t>=12688&&t<=12703,"Bopomofo Extended":t=>t>=12704&&t<=12735,"CJK Strokes":t=>t>=12736&&t<=12783,"Katakana Phonetic Extensions":t=>t>=12784&&t<=12799,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"CJK Unified Ideographs Extension A":t=>t>=13312&&t<=19903,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Yi Syllables":t=>t>=40960&&t<=42127,"Yi Radicals":t=>t>=42128&&t<=42191,"Hangul Jamo Extended-A":t=>t>=43360&&t<=43391,"Hangul Syllables":t=>t>=44032&&t<=55215,"Hangul Jamo Extended-B":t=>t>=55216&&t<=55295,"Private Use Area":t=>t>=57344&&t<=63743,"CJK Compatibility Ideographs":t=>t>=63744&&t<=64255,"Arabic Presentation Forms-A":t=>t>=64336&&t<=65023,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Arabic Presentation Forms-B":t=>t>=65136&&t<=65279,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519,"CJK Unified Ideographs Extension B":t=>t>=131072&&t<=173791};function md(t){for(const e of t)if(El(e.charCodeAt(0)))return!0;return!1}function kf(t){for(const e of t)if(!Sh(e.charCodeAt(0)))return!1;return!0}function Sh(t){return!(Bi.Arabic(t)||Bi["Arabic Supplement"](t)||Bi["Arabic Extended-A"](t)||Bi["Arabic Presentation Forms-A"](t)||Bi["Arabic Presentation Forms-B"](t))}function El(t){return!(t!==746&&t!==747&&(t<4352||!(Bi["Bopomofo Extended"](t)||Bi.Bopomofo(t)||Bi["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||Bi["CJK Compatibility Ideographs"](t)||Bi["CJK Compatibility"](t)||Bi["CJK Radicals Supplement"](t)||Bi["CJK Strokes"](t)||!(!Bi["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||Bi["CJK Unified Ideographs Extension A"](t)||Bi["CJK Unified Ideographs"](t)||Bi["Enclosed CJK Letters and Months"](t)||Bi["Hangul Compatibility Jamo"](t)||Bi["Hangul Jamo Extended-A"](t)||Bi["Hangul Jamo Extended-B"](t)||Bi["Hangul Jamo"](t)||Bi["Hangul Syllables"](t)||Bi.Hiragana(t)||Bi["Ideographic Description Characters"](t)||Bi.Kanbun(t)||Bi["Kangxi Radicals"](t)||Bi["Katakana Phonetic Extensions"](t)||Bi.Katakana(t)&&t!==12540||!(!Bi["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!Bi["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||Bi["Unified Canadian Aboriginal Syllabics"](t)||Bi["Unified Canadian Aboriginal Syllabics Extended"](t)||Bi["Vertical Forms"](t)||Bi["Yijing Hexagram Symbols"](t)||Bi["Yi Syllables"](t)||Bi["Yi Radicals"](t))))}function Df(t){return!(El(t)||function(e){return!!(Bi["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Bi["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Bi["Letterlike Symbols"](e)||Bi["Number Forms"](e)||Bi["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Bi["Control Pictures"](e)&&e!==9251||Bi["Optical Character Recognition"](e)||Bi["Enclosed Alphanumerics"](e)||Bi["Geometric Shapes"](e)||Bi["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Bi["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Bi["CJK Symbols and Punctuation"](e)||Bi.Katakana(e)||Bi["Private Use Area"](e)||Bi["CJK Compatibility Forms"](e)||Bi["Small Form Variants"](e)||Bi["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(t))}function _p(t){return t>=1424&&t<=2303||Bi["Arabic Presentation Forms-A"](t)||Bi["Arabic Presentation Forms-B"](t)}function gp(t,e){return!(!e&&_p(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||Bi.Khmer(t))}function N_(t){for(const e of t)if(_p(e.charCodeAt(0)))return!0;return!1}const Pf="deferred",zf="loading",Bf="loaded";let Ih=null,Qa="unavailable",kc=null;const iu=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(Qa="error"),Ih&&Ih(t)};function Mu(){Lf.fire(new ei("pluginStateChange",{pluginStatus:Qa,pluginURL:kc}))}const Lf=new rs,Rf=function(){return Qa},yp=function(){if(Qa!==Pf||!kc)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Qa=zf,Mu(),kc&&Ve({url:kc},t=>{t?iu(t):(Qa=Bf,Mu())})},vA={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Qa===Bf||vA.applyArabicShaping!=null,isLoading:()=>Qa===zf,setState(t){Qa=t.pluginStatus,kc=t.pluginURL},isParsed:()=>vA.applyArabicShaping!=null&&vA.processBidirectionalText!=null&&vA.processStyledBidirectionalText!=null,getPluginURL:()=>kc};class ds{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch,this.brightness=i.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(i,r){for(const n of i)if(!gp(n.charCodeAt(0),r))return!1;return!0}(e,vA.isLoaded())}}class _d{constructor(e,i,r){this.property=e,this.value=i,this.expression=function(n,s,a){if(Nt(n))return new bl(n,s);if(Nr(n)||Array.isArray(n)&&n.length>0){const c=Kn(n,s,a);if(c.result==="error")throw new Error(c.value.map(p=>`${p.key}: ${p.message}`).join(", "));return c.value}{let c=n;return typeof n=="string"&&s.type==="color"&&(c=pr.parse(n)),{kind:"constant",isConfigDependent:!1,evaluate:()=>c}}}(i===void 0?e.specification.default:i,e.specification,r)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,r){return this.property.possiblyEvaluate(this,e,i,r)}}class Ff{constructor(e,i){this.property=e,this.value=new _d(e,void 0,i)}transitioned(e,i){return new xp(this.property,this.value,i,zt({},e.transition,this.transition),e.now)}untransitioned(){return new xp(this.property,this.value,null,{},0)}}class Su{constructor(e,i){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._options=i,this.isConfigDependent=!1}getValue(e){return Ue(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new Ff(this._values[e].property,this._options)),this._values[e].value=new _d(this._values[e].property,i===null?void 0:Ue(i),this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].value.expression.isConfigDependent}setTransitionOrValue(e,i){i&&(this._options=i);const r=this._properties.properties;if(e)for(const n in e){const s=e[n];if(Ra(n,"-transition")){const a=n.slice(0,-11);r[a]&&this.setTransition(a,s)}else r[n]&&this.setValue(n,s)}}getTransition(e){return Ue(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new Ff(this._values[e].property)),this._values[e].transition=Ue(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const r=this.getValue(i);r!==void 0&&(e[i]=r);const n=this.getTransition(i);n!==void 0&&(e[`${i}-transition`]=n)}return e}transitioned(e,i){const r=new Iu(this._properties);for(const n of Object.keys(this._values))r._values[n]=this._values[n].transitioned(e,i._values[n]);return r}untransitioned(){const e=new Iu(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class xp{constructor(e,i,r,n,s){const a=n.delay||0,c=n.duration||0;s=s||0,this.property=e,this.value=i,this.begin=s+a,this.end=this.begin+c,e.specification.transition&&(n.delay||n.duration)&&(this.prior=r)}possiblyEvaluate(e,i,r){const n=e.now||0,s=this.value.possiblyEvaluate(e,i,r),a=this.prior;if(a){if(n>this.end)return this.prior=null,s;if(this.value.isDataDriven())return this.prior=null,s;if(n<this.begin)return a.possiblyEvaluate(e,i,r);{const c=(n-this.begin)/(this.end-this.begin);return this.property.interpolate(a.possiblyEvaluate(e,i,r),s,es(c))}}return s}}class Iu{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,r){const n=new ru(this._properties);for(const s of Object.keys(this._values))n._values[s]=this._values[s].possiblyEvaluate(e,i,r);return n}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class U_{constructor(e,i){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._options=i,this.isConfigDependent=!1}getValue(e){return Ue(this._values[e].value)}setValue(e,i){this._values[e]=new _d(this._values[e].property,i===null?void 0:Ue(i),this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].expression.isConfigDependent}serialize(){const e={};for(const i of Object.keys(this._values)){const r=this.getValue(i);r!==void 0&&(e[i]=r)}return e}possiblyEvaluate(e,i,r){const n=new ru(this._properties);for(const s of Object.keys(this._values))n._values[s]=this._values[s].possiblyEvaluate(e,i,r);return n}}class Is{constructor(e,i,r){this.property=e,this.value=i,this.parameters=r}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,r,n){return this.property.evaluate(this.value,this.parameters,e,i,r,n)}}class ru{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class si{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,r){const n=Ta[this.specification.type];return n?n(e,i,r):e}}class qi{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,r,n){return new Is(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(i,null,{},r,n)}:e.expression,i)}interpolate(e,i,r){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new Is(this,{kind:"constant",value:void 0},e.parameters);const n=Ta[this.specification.type];return n?new Is(this,{kind:"constant",value:n(e.value.value,i.value.value,r)},e.parameters):e}evaluate(e,i,r,n,s,a){return e.kind==="constant"?e.value:e.evaluate(i,r,n,s,a)}}class nu{constructor(e){this.specification=e}possiblyEvaluate(e,i,r,n){return!!e.expression.evaluate(i,null,{},r,n)}interpolate(){return!1}}class ss{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new ds(0,{});for(const r in e){const n=e[r];n.specification.overridable&&this.overridableProperties.push(r);const s=this.defaultPropertyValues[r]=new _d(n,void 0),a=this.defaultTransitionablePropertyValues[r]=new Ff(n);this.defaultTransitioningPropertyValues[r]=a.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=s.possiblyEvaluate(i)}}}Ii(qi,"DataDrivenProperty"),Ii(si,"DataConstantProperty"),Ii(nu,"ColorRampProperty");const Ch="";function Of(t){return t.indexOf(Ch)>=0}function Oo(t,e){return e?`${t}${Ch}${e}`:t}function Hu(t){const e=t.indexOf(Ch);return e>=0?t.slice(0,e):t}const gd="-transition";class jl extends rs{constructor(e,i,r){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),this.options=r,e.slot&&(this.slot=e.slot),i.layout&&(this._unevaluatedLayout=new U_(i.layout,r),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),i.paint)){this._transitionablePaint=new Su(i.paint,r);for(const n in e.paint)this.setPaintProperty(n,e.paint[n],{validate:!1});for(const n in e.layout)this.setLayoutProperty(n,e.layout[n],{validate:!1});this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ru(i.paint)}}setScope(e){this.scope=e,this.fqid=Oo(this.id,e)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i,r={}){if(i!=null&&this._validate(mp,`layers.${this.id}.layout.${e}`,e,i,r))return;if(this.type==="custom"&&e==="visibility")return void(this.visibility=i);const n=this._unevaluatedLayout;n._properties.properties[e]&&(n.setValue(e,i),this.isConfigDependent=this.isConfigDependent||n.isConfigDependent,e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(e){return Ra(e,gd)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i,r={}){if(i!=null&&this._validate(pp,`layers.${this.id}.paint.${e}`,e,i,r))return!1;const n=this._transitionablePaint,s=n._properties.properties;if(Ra(e,gd)){const C=e.slice(0,-11);return s[C]&&n.setTransition(C,i||void 0),!1}if(!s[e])return!1;const a=n._values[e],c=a.value.isDataDriven(),p=a.value;n.setValue(e,i),this.isConfigDependent=this.isConfigDependent||n.isConfigDependent,this._handleSpecialPaintPropertyUpdate(e);const _=n._values[e].value,v=_.isDataDriven(),E=Ra(e,"pattern")||e==="line-dasharray";return v||c||E||this._handleOverridablePaintPropertyUpdate(e,p,_)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,i){return null}_handleOverridablePaintPropertyUpdate(e,i,r){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){return Yt({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,i)=>!(e===void 0||i==="layout"&&!Object.keys(e).length||i==="paint"&&!Object.keys(e).length))}_validate(e,i,r,n,s={}){return(!s||s.validate!==!1)&&Ic(this,e.call(tu,{key:i,layerType:this.type,objectKey:r,value:n,styleSpec:xt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof Is&&st(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=ao(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(){this._stats&&(this._stats.numRenderedVerticesInShadowPass=0,this._stats.numRenderedVerticesInTransparentPass=0)}}class j_{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(e,i){this._updatedSourceCaches[e]=i,this.setDirty()}discardSourceCacheUpdate(e){delete this._updatedSourceCaches[e]}updateLayer(e){const i=e.scope;this._updatedLayers[i]=this._updatedLayers[i]||new Set,this._updatedLayers[i].add(e.id),this.setDirty()}removeLayer(e){const i=e.scope;this._removedLayers[i]=this._removedLayers[i]||{},this._updatedLayers[i]=this._updatedLayers[i]||new Set,this._removedLayers[i][e.id]=e,this._updatedLayers[i].delete(e.id),this._updatedPaintProps.delete(e.fqid),this.setDirty()}getRemovedLayer(e){return this._removedLayers[e.scope]?this._removedLayers[e.scope][e.id]:null}discardLayerRemoval(e){this._removedLayers[e.scope]&&delete this._removedLayers[e.scope][e.id]}getLayerUpdatesByScope(){const e={};for(const i in this._updatedLayers)e[i]=e[i]||{},e[i].updatedIds=Array.from(this._updatedLayers[i].values());for(const i in this._removedLayers)e[i]=e[i]||{},e[i].removedIds=Object.keys(this._removedLayers[i]);return e}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(e){this._updatedPaintProps.add(e.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(e){this._updatedImages.add(e),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}const vp={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class su{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class fs{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function un(t,e=1){let i=0,r=0;return{members:t.map(n=>{const s=vp[n.type].BYTES_PER_ELEMENT,a=i=bp(i,Math.max(e,s)),c=n.components||1;return r=Math.max(r,s),i+=s*c,{name:n.name,type:n.type,components:c,offset:a}}),size:bp(i,Math.max(r,e)),alignment:e}}function bp(t,e){return Math.ceil(t/e)*e}class ul extends fs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,i)}emplace(e,i,r){const n=2*e;return this.int16[n+0]=i,this.int16[n+1]=r,e}}ul.prototype.bytesPerElement=4,Ii(ul,"StructArrayLayout2i4");class Wu extends fs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,i,r)}emplace(e,i,r,n){const s=3*e;return this.int16[s+0]=i,this.int16[s+1]=r,this.int16[s+2]=n,e}}Wu.prototype.bytesPerElement=6,Ii(Wu,"StructArrayLayout3i6");class Dc extends fs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,r,n){const s=this.length;return this.resize(s+1),this.emplace(s,e,i,r,n)}emplace(e,i,r,n,s){const a=4*e;return this.int16[a+0]=i,this.int16[a+1]=r,this.int16[a+2]=n,this.int16[a+3]=s,e}}Dc.prototype.bytesPerElement=8,Ii(Dc,"StructArrayLayout4i8");class yd extends fs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,r,n,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,i,r,n,s)}emplace(e,i,r,n,s,a){const c=5*e;return this.int16[c+0]=i,this.int16[c+1]=r,this.int16[c+2]=n,this.int16[c+3]=s,this.int16[c+4]=a,e}}yd.prototype.bytesPerElement=10,Ii(yd,"StructArrayLayout5i10");class xd extends fs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,n,s,a,c){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,r,n,s,a,c)}emplace(e,i,r,n,s,a,c,p){const _=6*e,v=12*e,E=3*e;return this.int16[_+0]=i,this.int16[_+1]=r,this.uint8[v+4]=n,this.uint8[v+5]=s,this.uint8[v+6]=a,this.uint8[v+7]=c,this.float32[E+2]=p,e}}xd.prototype.bytesPerElement=12,Ii(xd,"StructArrayLayout2i4ub1f12");class Pc extends fs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,n){const s=this.length;return this.resize(s+1),this.emplace(s,e,i,r,n)}emplace(e,i,r,n,s){const a=4*e;return this.float32[a+0]=i,this.float32[a+1]=r,this.float32[a+2]=n,this.float32[a+3]=s,e}}Pc.prototype.bytesPerElement=16,Ii(Pc,"StructArrayLayout4f16");class ou extends fs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,n,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,i,r,n,s)}emplace(e,i,r,n,s,a){const c=6*e,p=3*e;return this.uint16[c+0]=i,this.uint16[c+1]=r,this.uint16[c+2]=n,this.uint16[c+3]=s,this.float32[p+2]=a,e}}ou.prototype.bytesPerElement=12,Ii(ou,"StructArrayLayout4ui1f12");class vd extends fs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,r,n){const s=this.length;return this.resize(s+1),this.emplace(s,e,i,r,n)}emplace(e,i,r,n,s){const a=4*e;return this.uint16[a+0]=i,this.uint16[a+1]=r,this.uint16[a+2]=n,this.uint16[a+3]=s,e}}vd.prototype.bytesPerElement=8,Ii(vd,"StructArrayLayout4ui8");class bd extends fs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,r,n,s,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,r,n,s,a)}emplace(e,i,r,n,s,a,c){const p=6*e;return this.int16[p+0]=i,this.int16[p+1]=r,this.int16[p+2]=n,this.int16[p+3]=s,this.int16[p+4]=a,this.int16[p+5]=c,e}}bd.prototype.bytesPerElement=12,Ii(bd,"StructArrayLayout6i12");class Vf extends fs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,r,n,s,a,c,p,_,v,E,C){const B=this.length;return this.resize(B+1),this.emplace(B,e,i,r,n,s,a,c,p,_,v,E,C)}emplace(e,i,r,n,s,a,c,p,_,v,E,C,B){const O=12*e;return this.int16[O+0]=i,this.int16[O+1]=r,this.int16[O+2]=n,this.int16[O+3]=s,this.uint16[O+4]=a,this.uint16[O+5]=c,this.uint16[O+6]=p,this.uint16[O+7]=_,this.int16[O+8]=v,this.int16[O+9]=E,this.int16[O+10]=C,this.int16[O+11]=B,e}}Vf.prototype.bytesPerElement=24,Ii(Vf,"StructArrayLayout4i4ui4i24");class uc extends fs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,n,s,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,r,n,s,a)}emplace(e,i,r,n,s,a,c){const p=10*e,_=5*e;return this.int16[p+0]=i,this.int16[p+1]=r,this.int16[p+2]=n,this.float32[_+2]=s,this.float32[_+3]=a,this.float32[_+4]=c,e}}uc.prototype.bytesPerElement=20,Ii(uc,"StructArrayLayout3i3f20");class Nf extends fs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}Nf.prototype.bytesPerElement=4,Ii(Nf,"StructArrayLayout1ul4");class zc extends fs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,i)}emplace(e,i,r){const n=2*e;return this.uint16[n+0]=i,this.uint16[n+1]=r,e}}zc.prototype.bytesPerElement=4,Ii(zc,"StructArrayLayout2ui4");class au extends fs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,r,n,s,a,c,p,_,v,E,C,B){const O=this.length;return this.resize(O+1),this.emplace(O,e,i,r,n,s,a,c,p,_,v,E,C,B)}emplace(e,i,r,n,s,a,c,p,_,v,E,C,B,O){const G=20*e,q=10*e;return this.int16[G+0]=i,this.int16[G+1]=r,this.int16[G+2]=n,this.int16[G+3]=s,this.int16[G+4]=a,this.float32[q+3]=c,this.float32[q+4]=p,this.float32[q+5]=_,this.float32[q+6]=v,this.int16[G+14]=E,this.uint32[q+8]=C,this.uint16[G+18]=B,this.uint16[G+19]=O,e}}au.prototype.bytesPerElement=40,Ii(au,"StructArrayLayout5i4f1i1ul2ui40");class wd extends fs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,r,n,s,a,c){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,r,n,s,a,c)}emplace(e,i,r,n,s,a,c,p){const _=8*e;return this.int16[_+0]=i,this.int16[_+1]=r,this.int16[_+2]=n,this.int16[_+4]=s,this.int16[_+5]=a,this.int16[_+6]=c,this.int16[_+7]=p,e}}wd.prototype.bytesPerElement=16,Ii(wd,"StructArrayLayout3i2i2i16");class Uf extends fs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,r,n,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,i,r,n,s)}emplace(e,i,r,n,s,a){const c=4*e,p=8*e;return this.float32[c+0]=i,this.float32[c+1]=r,this.float32[c+2]=n,this.int16[p+6]=s,this.int16[p+7]=a,e}}Uf.prototype.bytesPerElement=16,Ii(Uf,"StructArrayLayout2f1f2i16");class jf extends fs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,n){const s=this.length;return this.resize(s+1),this.emplace(s,e,i,r,n)}emplace(e,i,r,n,s){const a=12*e,c=3*e;return this.uint8[a+0]=i,this.uint8[a+1]=r,this.float32[c+1]=n,this.float32[c+2]=s,e}}jf.prototype.bytesPerElement=12,Ii(jf,"StructArrayLayout2ub2f12");class Ys extends fs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,i,r)}emplace(e,i,r,n){const s=3*e;return this.uint16[s+0]=i,this.uint16[s+1]=r,this.uint16[s+2]=n,e}}Ys.prototype.bytesPerElement=6,Ii(Ys,"StructArrayLayout3ui6");class Td extends fs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,r,n,s,a,c,p,_,v,E,C,B,O,G,q,$,J,ie,re,te){const se=this.length;return this.resize(se+1),this.emplace(se,e,i,r,n,s,a,c,p,_,v,E,C,B,O,G,q,$,J,ie,re,te)}emplace(e,i,r,n,s,a,c,p,_,v,E,C,B,O,G,q,$,J,ie,re,te,se){const he=30*e,ve=15*e,be=60*e;return this.int16[he+0]=i,this.int16[he+1]=r,this.int16[he+2]=n,this.float32[ve+2]=s,this.float32[ve+3]=a,this.uint16[he+8]=c,this.uint16[he+9]=p,this.uint32[ve+5]=_,this.uint32[ve+6]=v,this.uint32[ve+7]=E,this.uint16[he+16]=C,this.uint16[he+17]=B,this.uint16[he+18]=O,this.float32[ve+10]=G,this.float32[ve+11]=q,this.uint8[be+48]=$,this.uint8[be+49]=J,this.uint8[be+50]=ie,this.uint32[ve+13]=re,this.int16[he+28]=te,this.uint8[be+58]=se,e}}Td.prototype.bytesPerElement=60,Ii(Td,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Gf extends fs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,r,n,s,a,c,p,_,v,E,C,B,O,G,q,$,J,ie,re,te,se,he,ve,be,Ce,Ne,je,Ye,Re,rt,lt){const vt=this.length;return this.resize(vt+1),this.emplace(vt,e,i,r,n,s,a,c,p,_,v,E,C,B,O,G,q,$,J,ie,re,te,se,he,ve,be,Ce,Ne,je,Ye,Re,rt,lt)}emplace(e,i,r,n,s,a,c,p,_,v,E,C,B,O,G,q,$,J,ie,re,te,se,he,ve,be,Ce,Ne,je,Ye,Re,rt,lt,vt){const it=20*e,at=40*e,Tt=80*e;return this.float32[it+0]=i,this.float32[it+1]=r,this.int16[at+4]=n,this.int16[at+5]=s,this.int16[at+6]=a,this.int16[at+7]=c,this.int16[at+8]=p,this.int16[at+9]=_,this.int16[at+10]=v,this.int16[at+11]=E,this.int16[at+12]=C,this.uint16[at+13]=B,this.uint16[at+14]=O,this.uint16[at+15]=G,this.uint16[at+16]=q,this.uint16[at+17]=$,this.uint16[at+18]=J,this.uint16[at+19]=ie,this.uint16[at+20]=re,this.uint16[at+21]=te,this.uint16[at+22]=se,this.uint16[at+23]=he,this.uint16[at+24]=ve,this.uint16[at+25]=be,this.uint16[at+26]=Ce,this.uint16[at+27]=Ne,this.uint32[it+14]=je,this.float32[it+15]=Ye,this.float32[it+16]=Re,this.float32[it+17]=rt,this.float32[it+18]=lt,this.uint8[Tt+76]=vt,e}}Gf.prototype.bytesPerElement=80,Ii(Gf,"StructArrayLayout2f9i15ui1ul4f1ub80");class kh extends fs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}kh.prototype.bytesPerElement=4,Ii(kh,"StructArrayLayout1f4");class Cu extends fs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,n,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,i,r,n,s)}emplace(e,i,r,n,s,a){const c=5*e;return this.float32[c+0]=i,this.float32[c+1]=r,this.float32[c+2]=n,this.float32[c+3]=s,this.float32[c+4]=a,e}}Cu.prototype.bytesPerElement=20,Ii(Cu,"StructArrayLayout5f20");class Zf extends fs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,n,s,a,c){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,r,n,s,a,c)}emplace(e,i,r,n,s,a,c,p){const _=7*e;return this.float32[_+0]=i,this.float32[_+1]=r,this.float32[_+2]=n,this.float32[_+3]=s,this.float32[_+4]=a,this.float32[_+5]=c,this.float32[_+6]=p,e}}Zf.prototype.bytesPerElement=28,Ii(Zf,"StructArrayLayout7f28");class Dh extends fs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,r,n){const s=this.length;return this.resize(s+1),this.emplace(s,e,i,r,n)}emplace(e,i,r,n,s){const a=6*e;return this.uint32[3*e+0]=i,this.uint16[a+2]=r,this.uint16[a+3]=n,this.uint16[a+4]=s,e}}Dh.prototype.bytesPerElement=12,Ii(Dh,"StructArrayLayout1ul3ui12");class Bc extends fs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}Bc.prototype.bytesPerElement=2,Ii(Bc,"StructArrayLayout1ui2");class Lc extends fs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,i,r)}emplace(e,i,r,n){const s=3*e;return this.float32[s+0]=i,this.float32[s+1]=r,this.float32[s+2]=n,e}}Lc.prototype.bytesPerElement=12,Ii(Lc,"StructArrayLayout3f12");class Ph extends fs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,i)}emplace(e,i,r){const n=2*e;return this.float32[n+0]=i,this.float32[n+1]=r,e}}Ph.prototype.bytesPerElement=8,Ii(Ph,"StructArrayLayout2f8");class qf extends fs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,n,s,a,c,p,_,v,E,C,B,O,G,q){const $=this.length;return this.resize($+1),this.emplace($,e,i,r,n,s,a,c,p,_,v,E,C,B,O,G,q)}emplace(e,i,r,n,s,a,c,p,_,v,E,C,B,O,G,q,$){const J=16*e;return this.float32[J+0]=i,this.float32[J+1]=r,this.float32[J+2]=n,this.float32[J+3]=s,this.float32[J+4]=a,this.float32[J+5]=c,this.float32[J+6]=p,this.float32[J+7]=_,this.float32[J+8]=v,this.float32[J+9]=E,this.float32[J+10]=C,this.float32[J+11]=B,this.float32[J+12]=O,this.float32[J+13]=G,this.float32[J+14]=q,this.float32[J+15]=$,e}}qf.prototype.bytesPerElement=64,Ii(qf,"StructArrayLayout16f64");class zh extends fs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,n,s,a,c){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,r,n,s,a,c)}emplace(e,i,r,n,s,a,c,p){const _=10*e,v=5*e;return this.uint16[_+0]=i,this.uint16[_+1]=r,this.uint16[_+2]=n,this.uint16[_+3]=s,this.float32[v+2]=a,this.float32[v+3]=c,this.float32[v+4]=p,e}}zh.prototype.bytesPerElement=20,Ii(zh,"StructArrayLayout4ui3f20");class Qf extends fs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint8[1*e+0]=i,e}}Qf.prototype.bytesPerElement=1,Ii(Qf,"StructArrayLayout1ub1");class wp extends su{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}wp.prototype.size=40;class ku extends au{get(e){return new wp(this,e)}}Ii(ku,"CollisionBoxArray");class Hf extends su{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Hf.prototype.size=60;class Tp extends Td{get(e){return new Hf(this,e)}}Ii(Tp,"PlacedSymbolArray");class Ep extends su{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}Ep.prototype.size=80;class Mp extends Gf{get(e){return new Ep(this,e)}}Ii(Mp,"SymbolInstanceArray");class Sp extends kh{getoffsetX(e){return this.float32[1*e+0]}}Ii(Sp,"GlyphOffsetArray");class Ip extends ul{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Ii(Ip,"SymbolLineVertexArray");class Cp extends su{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Cp.prototype.size=12;class Wf extends Dh{get(e){return new Cp(this,e)}}Ii(Wf,"FeatureIndexArray");class Ed extends zc{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Ii(Ed,"FillExtrusionCentroidArray");const kp=un([{name:"a_pos",components:2,type:"Int16"}],4),Dp=un([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class wn{constructor(e=[]){this.segments=e}_prepareSegment(e,i,r,n){let s=this.segments[this.segments.length-1];return e>wn.MAX_VERTEX_ARRAY_LENGTH&&Pe(`Max vertices per segment is ${wn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!s||s.vertexLength+e>wn.MAX_VERTEX_ARRAY_LENGTH||s.sortKey!==n)&&(s={vertexOffset:i,primitiveOffset:r,vertexLength:0,primitiveLength:0},n!==void 0&&(s.sortKey=n),this.segments.push(s)),s}prepareSegment(e,i,r,n){return this._prepareSegment(e,i.length,r.length,n)}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,r,n){return new wn([{vertexOffset:e,primitiveOffset:i,vertexLength:r,primitiveLength:n,vaos:{},sortKey:0}])}}function Pp(t,e){return 256*(t=hi(Math.floor(t),0,255))+hi(Math.floor(e),0,255)}wn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ii(wn,"SegmentVector");const Md=un([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),G_=un([{name:"a_dash",components:4,type:"Uint16"}]);var Bh={exports:{}},zp={exports:{}};(function(t){t.exports=function(e,i){var r,n,s,a,c,p,_,v;for(n=e.length-(r=3&e.length),s=i,c=3432918353,p=461845907,v=0;v<n;)_=255&e.charCodeAt(v)|(255&e.charCodeAt(++v))<<8|(255&e.charCodeAt(++v))<<16|(255&e.charCodeAt(++v))<<24,++v,s=27492+(65535&(a=5*(65535&(s=(s^=_=(65535&(_=(_=(65535&_)*c+(((_>>>16)*c&65535)<<16)&4294967295)<<15|_>>>17))*p+(((_>>>16)*p&65535)<<16)&4294967295)<<13|s>>>19))+((5*(s>>>16)&65535)<<16)&4294967295))+((58964+(a>>>16)&65535)<<16);switch(_=0,r){case 3:_^=(255&e.charCodeAt(v+2))<<16;case 2:_^=(255&e.charCodeAt(v+1))<<8;case 1:s^=_=(65535&(_=(_=(65535&(_^=255&e.charCodeAt(v)))*c+(((_>>>16)*c&65535)<<16)&4294967295)<<15|_>>>17))*p+(((_>>>16)*p&65535)<<16)&4294967295}return s^=e.length,s=2246822507*(65535&(s^=s>>>16))+((2246822507*(s>>>16)&65535)<<16)&4294967295,s=3266489909*(65535&(s^=s>>>13))+((3266489909*(s>>>16)&65535)<<16)&4294967295,(s^=s>>>16)>>>0}})(zp);var Z_=zp.exports,Bp={exports:{}};(function(t){t.exports=function(e,i){for(var r,n=e.length,s=i^n,a=0;n>=4;)r=1540483477*(65535&(r=255&e.charCodeAt(a)|(255&e.charCodeAt(++a))<<8|(255&e.charCodeAt(++a))<<16|(255&e.charCodeAt(++a))<<24))+((1540483477*(r>>>16)&65535)<<16),s=1540483477*(65535&s)+((1540483477*(s>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),n-=4,++a;switch(n){case 3:s^=(255&e.charCodeAt(a+2))<<16;case 2:s^=(255&e.charCodeAt(a+1))<<8;case 1:s=1540483477*(65535&(s^=255&e.charCodeAt(a)))+((1540483477*(s>>>16)&65535)<<16)}return s=1540483477*(65535&(s^=s>>>13))+((1540483477*(s>>>16)&65535)<<16),(s^=s>>>15)>>>0}})(Bp);var $f=Z_,q_=Bp.exports;Bh.exports=$f,Bh.exports.murmur3=$f,Bh.exports.murmur2=q_;var Xf=qr(Bh.exports);class Rc{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,i,r,n){this.ids.push(Eo(e)),this.positions.push(i,r,n)}eachPosition(e,i){const r=Eo(e);let n=0,s=this.ids.length-1;for(;n<s;){const a=n+s>>1;this.ids[a]>=r?s=a:n=a+1}for(;this.ids[n]===r;)i(this.positions[3*n],this.positions[3*n+1],this.positions[3*n+2]),n++}static serialize(e,i){const r=new Float64Array(e.ids),n=new Uint32Array(e.positions);return Sd(r,n,0,r.length-1),i&&(i.add(r.buffer),i.add(n.buffer)),{ids:r,positions:n}}static deserialize(e){const i=new Rc;let r;i.ids=e.ids,i.positions=e.positions;for(const n of i.ids)n!==r&&i.uniqueIds.push(n),r=n;return i.indexed=!0,i}}function Eo(t){const e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Xf(String(t))}function Sd(t,e,i,r){for(;i<r;){const n=t[i+r>>1];let s=i-1,a=r+1;for(;;){do s++;while(t[s]<n);do a--;while(t[a]>n);if(s>=a)break;Lh(t,s,a),Lh(e,3*s,3*a),Lh(e,3*s+1,3*a+1),Lh(e,3*s+2,3*a+2)}a-i<r-a?(Sd(t,e,i,a),i=a+1):(Sd(t,e,a+1,r),r=a)}}function Lh(t,e,i){const r=t[e];t[e]=t[i],t[i]=r}Ii(Rc,"FeaturePositionMap");class hc{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}}class Ni extends hc{constructor(e){super(e),this.current=0}set(e,i,r){this.fetchUniformLocation(e,i)&&this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}}class ii extends hc{constructor(e){super(e),this.current=0}set(e,i,r){this.fetchUniformLocation(e,i)&&this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))}}class zr extends hc{constructor(e){super(e),this.current=[0,0]}set(e,i,r){this.fetchUniformLocation(e,i)&&(r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1])))}}class Tr extends hc{constructor(e){super(e),this.current=[0,0,0]}set(e,i,r){this.fetchUniformLocation(e,i)&&(r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2])))}}class Mo extends hc{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,r){this.fetchUniformLocation(e,i)&&(r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3])))}}class jA extends hc{constructor(e){super(e),this.current=pr.transparent}set(e,i,r){this.fetchUniformLocation(e,i)&&(r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a)))}}const Lp=new Float32Array(16);class xr extends hc{constructor(e){super(e),this.current=Lp}set(e,i,r){if(this.fetchUniformLocation(e,i)){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let n=1;n<16;n++)if(r[n]!==this.current[n]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}}}const Q_=new Float32Array(9);class Yf extends hc{constructor(e){super(e),this.current=Q_}set(e,i,r){if(this.fetchUniformLocation(e,i)){for(let n=0;n<9;n++)if(r[n]!==this.current[n]){this.current=r,this.gl.uniformMatrix3fv(this.location,!1,r);break}}}}const H_=new Float32Array(4);class Kf extends hc{constructor(e){super(e),this.current=H_}set(e,i,r){if(this.fetchUniformLocation(e,i)){for(let n=0;n<4;n++)if(r[n]!==this.current[n]){this.current=r,this.gl.uniformMatrix2fv(this.location,!1,r);break}}}}function Jf(t){return[Pp(255*t.r,255*t.g),Pp(255*t.b,255*t.a)]}class Rh{constructor(e,i,r){this.value=e,this.uniformNames=i.map(n=>`u_${n}`),this.type=r}setUniform(e,i,r,n,s){i.set(e,s,n.constantOr(this.value))}getBinding(e,i){return this.type==="color"?new jA(e):new ii(e)}}class $u{constructor(e,i){this.uniformNames=i.map(r=>`u_${r}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,i,r,n,s){const a=s==="u_pattern"||s==="u_dash"?this.pattern:s==="u_pixel_ratio"?this.pixelRatio:null;a&&i.set(e,s,a)}getBinding(e,i){return i==="u_pattern"||i==="u_dash"?new Mo(e):new ii(e)}}class Fc{constructor(e,i,r,n){this.expression=e,this.type=r,this.maxValue=0,this.paintVertexAttributes=i.map(s=>({name:`a_${s}`,type:"Float32",components:r==="color"?2:1,offset:0})),this.paintVertexArray=new n}populatePaintArray(e,i,r,n,s,a,c){const p=this.paintVertexArray.length,_=this.expression.evaluate(new ds(0,{brightness:a}),i,{},s,n,c);this.paintVertexArray.resize(e),this._setPaintValue(p,e,_)}updatePaintArray(e,i,r,n,s,a,c){const p=this.expression.evaluate({zoom:0,brightness:c},r,n,void 0,s);this._setPaintValue(e,i,p)}_setPaintValue(e,i,r){if(this.type==="color"){const n=Jf(r);for(let s=e;s<i;s++)this.paintVertexArray.emplace(s,n[0],n[1])}else{for(let n=e;n<i;n++)this.paintVertexArray.emplace(n,r);this.maxValue=Math.max(this.maxValue,Math.abs(r))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Gl{constructor(e,i,r,n,s,a){this.expression=e,this.uniformNames=i.map(c=>`u_${c}_t`),this.type=r,this.useIntegerZoom=n,this.zoom=s,this.maxValue=0,this.paintVertexAttributes=i.map(c=>({name:`a_${c}`,type:"Float32",components:r==="color"?4:2,offset:0})),this.paintVertexArray=new a}populatePaintArray(e,i,r,n,s,a,c){const p=this.expression.evaluate(new ds(this.zoom,{brightness:a}),i,{},s,n,c),_=this.expression.evaluate(new ds(this.zoom+1,{brightness:a}),i,{},s,n,c),v=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(v,e,p,_)}updatePaintArray(e,i,r,n,s,a,c){const p=this.expression.evaluate({zoom:this.zoom,brightness:c},r,n,void 0,s),_=this.expression.evaluate({zoom:this.zoom+1,brightness:c},r,n,void 0,s);this._setPaintValue(e,i,p,_)}_setPaintValue(e,i,r,n){if(this.type==="color"){const s=Jf(r),a=Jf(n);for(let c=e;c<i;c++)this.paintVertexArray.emplace(c,s[0],s[1],a[0],a[1])}else{for(let s=e;s<i;s++)this.paintVertexArray.emplace(s,r,n);this.maxValue=Math.max(this.maxValue,Math.abs(r),Math.abs(n))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,r,n,s){const a=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,c=hi(this.expression.interpolationFactor(a,this.zoom,this.zoom+1),0,1);i.set(e,s,c)}getBinding(e,i){return new ii(e)}}class lA{constructor(e,i,r,n,s){this.expression=e,this.layerId=s,this.paintVertexAttributes=(r==="array"?G_:Md).members;for(let a=0;a<i.length;++a);this.paintVertexArray=new n}populatePaintArray(e,i,r){const n=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(n,e,i.patterns&&i.patterns[this.layerId],r)}updatePaintArray(e,i,r,n,s,a,c){this._setPaintValues(e,i,r.patterns&&r.patterns[this.layerId],a)}_setPaintValues(e,i,r,n){if(!n||!r)return;const s=n[r];if(!s)return;const{tl:a,br:c,pixelRatio:p}=s;for(let _=e;_<i;_++)this.paintVertexArray.emplace(_,a[0],a[1],c[0],c[1],p)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class lu{constructor(e,i,r=()=>!0){this.binders={},this._buffers=[];const n=[];for(const s in e.paint._values){const a=e.paint.get(s);if(!r(s)||!(a instanceof Is&&st(a.property.specification)))continue;const c=W_(s,e.type),p=a.value,_=a.property.specification.type,v=!!a.property.useIntegerZoom,E=s==="line-dasharray"||s.endsWith("pattern"),C=s==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(p.kind!=="constant"||C)if(p.kind==="source"||C||E){const B=t0(s,_,"source");this.binders[s]=E?new lA(p,c,_,B,e.id):new Fc(p,c,_,B),n.push(`/a_${s}`)}else{const B=t0(s,_,"composite");this.binders[s]=new Gl(p,c,_,v,i,B),n.push(`/z_${s}`)}else this.binders[s]=E?new $u(p.value,c):new Rh(p.value,c,_),n.push(`/u_${s}`)}this.cacheKey=n.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof Fc||i instanceof Gl?i.maxValue:0}populatePaintArrays(e,i,r,n,s,a,c){for(const p in this.binders){const _=this.binders[p];(_ instanceof Fc||_ instanceof Gl||_ instanceof lA)&&_.populatePaintArray(e,i,r,n,s,a,c)}}setConstantPatternPositions(e){for(const i in this.binders){const r=this.binders[i];r instanceof $u&&r.setConstantPatternPositions(e)}}updatePaintArrays(e,i,r,n,s,a,c,p){let _=!1;const v=Object.keys(e),E=v.length!==0,C=E?v:i.uniqueIds;for(const B in this.binders){const O=this.binders[B];if((O instanceof Fc||O instanceof Gl||O instanceof lA)&&(O.expression.isStateDependent===!0||O.expression.isLightConstant===!1)){const G=s.paint.get(B);O.expression=G.value;for(const q of C){const $=e[q.toString()];i.eachPosition(q,(J,ie,re)=>{const te=n.feature(J);O.updatePaintArray(ie,re,te,$,a,c,p)})}if(!E)for(const q of r.uniqueIds){const $=e[q.toString()];r.eachPosition(q,(J,ie,re)=>{const te=n.feature(J);O.updatePaintArray(ie,re,te,$,a,c,p)})}_=!0}}return _}defines(){const e=[];for(const i in this.binders){const r=this.binders[i];(r instanceof Rh||r instanceof $u)&&e.push(...r.uniformNames.map(n=>`#define HAS_UNIFORM_${n}`))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const r=this.binders[i];if(r instanceof Fc||r instanceof Gl||r instanceof lA)for(let n=0;n<r.paintVertexAttributes.length;n++)e.push(r.paintVertexAttributes[n].name)}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const r=this.binders[i];if(r instanceof Rh||r instanceof $u||r instanceof Gl)for(const n of r.uniformNames)e.push(n)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const r in this.binders){const n=this.binders[r];if(n instanceof Rh||n instanceof $u||n instanceof Gl)for(const s of n.uniformNames)i.push({name:s,property:r,binding:n.getBinding(e,s)})}return i}setUniforms(e,i,r,n,s){for(const{name:a,property:c,binding:p}of r)this.binders[c].setUniform(e,p,s,n.get(c),a)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const i=this.binders[e];(i instanceof Fc||i instanceof Gl||i instanceof lA)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}}upload(e){for(const i in this.binders){const r=this.binders[i];(r instanceof Fc||r instanceof Gl||r instanceof lA)&&r.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof Fc||i instanceof Gl||i instanceof lA)&&i.destroy()}}}class dc{constructor(e,i,r=()=>!0){this.programConfigurations={};for(const n of e)this.programConfigurations[n.id]=new lu(n,i,r);this.needsUpload=!1,this._featureMap=new Rc,this._featureMapWithoutIds=new Rc,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,i,r,n,s,a,c,p){for(const _ in this.programConfigurations)this.programConfigurations[_].populatePaintArrays(e,i,n,s,a,c,p);i.id!==void 0?this._featureMap.add(i.id,r,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,r,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,r,n,s,a){for(const c of r)this.needsUpload=this.programConfigurations[c.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,i,c,n,s,a||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const e0={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function W_(t,e){return e0[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}const $_={"line-pattern":{source:ou,composite:ou},"fill-pattern":{source:ou,composite:ou},"fill-extrusion-pattern":{source:ou,composite:ou},"line-dasharray":{source:vd,composite:vd}},X_={color:{source:Ph,composite:Pc},number:{source:kh,composite:Ph}};function t0(t,e,i){const r=$_[t];return r&&r[i]||X_[e][i]}Ii(Rh,"ConstantBinder"),Ii($u,"PatternConstantBinder"),Ii(Fc,"SourceExpressionBinder"),Ii(lA,"PatternCompositeBinder"),Ii(Gl,"CompositeExpressionBinder"),Ii(lu,"ProgramConfiguration",{omit:["_buffers"]}),Ii(dc,"ProgramConfigurationSet");class Ml{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof rr?new rr(e.lng,e.lat):rr.convert(e),this}setSouthWest(e){return this._sw=e instanceof rr?new rr(e.lng,e.lat):rr.convert(e),this}extend(e){const i=this._sw,r=this._ne;let n,s;if(e instanceof rr)n=e,s=e;else{if(!(e instanceof Ml))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Ml.convert(e)):this.extend(rr.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(rr.convert(e)):this;if(n=e._sw,s=e._ne,!n||!s)return this}return i||r?(i.lng=Math.min(n.lng,i.lng),i.lat=Math.min(n.lat,i.lat),r.lng=Math.max(s.lng,r.lng),r.lat=Math.max(s.lat,r.lat)):(this._sw=new rr(n.lng,n.lat),this._ne=new rr(s.lng,s.lat)),this}getCenter(){return new rr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new rr(this.getWest(),this.getNorth())}getSouthEast(){return new rr(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:r}=rr.convert(e);let n=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(n=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=r&&r<=this._ne.lat&&n}static convert(e){return!e||e instanceof Ml?e:new Ml(e)}}var qn={},go={};Object.defineProperty(go,"__esModule",{value:!0}),go.setMatrixArrayType=function(t){go.ARRAY_TYPE=Oc=t},go.toRadian=function(t){return t*Oh},go.equals=function(t,e){return Math.abs(t-e)<=i0*Math.max(1,Math.abs(t),Math.abs(e))},go.RANDOM=go.ARRAY_TYPE=go.EPSILON=void 0;var i0=1e-6;go.EPSILON=i0;var Oc=typeof Float32Array<"u"?Float32Array:Array;go.ARRAY_TYPE=Oc;var Fh=Math.random;go.RANDOM=Fh;var Oh=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Qn={};function Xu(t){return Xu=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Xu(t)}Object.defineProperty(Qn,"__esModule",{value:!0}),Qn.create=function(){var t=new GA.ARRAY_TYPE(4);return GA.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},Qn.clone=function(t){var e=new GA.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Qn.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Qn.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},Qn.fromValues=function(t,e,i,r){var n=new GA.ARRAY_TYPE(4);return n[0]=t,n[1]=e,n[2]=i,n[3]=r,n},Qn.set=function(t,e,i,r,n){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t},Qn.transpose=function(t,e){if(t===e){var i=e[1];t[1]=e[2],t[2]=i}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},Qn.invert=function(t,e){var i=e[0],r=e[1],n=e[2],s=e[3],a=i*s-n*r;return a?(t[0]=s*(a=1/a),t[1]=-r*a,t[2]=-n*a,t[3]=i*a,t):null},Qn.adjoint=function(t,e){var i=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=i,t},Qn.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},Qn.multiply=r0,Qn.rotate=function(t,e,i){var r=e[0],n=e[1],s=e[2],a=e[3],c=Math.sin(i),p=Math.cos(i);return t[0]=r*p+s*c,t[1]=n*p+a*c,t[2]=r*-c+s*p,t[3]=n*-c+a*p,t},Qn.scale=function(t,e,i){var r=e[1],n=e[2],s=e[3],a=i[0],c=i[1];return t[0]=e[0]*a,t[1]=r*a,t[2]=n*c,t[3]=s*c,t},Qn.fromRotation=function(t,e){var i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=-i,t[3]=r,t},Qn.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},Qn.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Qn.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},Qn.LDU=function(t,e,i,r){return t[2]=r[2]/r[0],i[0]=r[0],i[1]=r[1],i[3]=r[3]-t[2]*i[1],[t,e,i]},Qn.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t},Qn.subtract=n0,Qn.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},Qn.equals=function(t,e){var i=t[0],r=t[1],n=t[2],s=t[3],a=e[0],c=e[1],p=e[2],_=e[3];return Math.abs(i-a)<=GA.EPSILON*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(r-c)<=GA.EPSILON*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(n-p)<=GA.EPSILON*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(s-_)<=GA.EPSILON*Math.max(1,Math.abs(s),Math.abs(_))},Qn.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t},Qn.multiplyScalarAndAdd=function(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t},Qn.sub=Qn.mul=void 0;var GA=function(t,e){if(t&&t.__esModule)return t;if(t===null||Xu(t)!=="object"&&typeof t!="function")return{default:t};var i=Rp(void 0);if(i&&i.has(t))return i.get(t);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in t)if(s!=="default"&&Object.prototype.hasOwnProperty.call(t,s)){var a=n?Object.getOwnPropertyDescriptor(t,s):null;a&&(a.get||a.set)?Object.defineProperty(r,s,a):r[s]=t[s]}return r.default=t,i&&i.set(t,r),r}(go);function Rp(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(Rp=function(r){return r?i:e})(t)}function r0(t,e,i){var r=e[0],n=e[1],s=e[2],a=e[3],c=i[0],p=i[1],_=i[2],v=i[3];return t[0]=r*c+s*p,t[1]=n*c+a*p,t[2]=r*_+s*v,t[3]=n*_+a*v,t}function n0(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}Qn.mul=r0,Qn.sub=n0;var xs={};function Id(t){return Id=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Id(t)}Object.defineProperty(xs,"__esModule",{value:!0}),xs.create=function(){var t=new ZA.ARRAY_TYPE(6);return ZA.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t},xs.clone=function(t){var e=new ZA.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},xs.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},xs.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},xs.fromValues=function(t,e,i,r,n,s){var a=new ZA.ARRAY_TYPE(6);return a[0]=t,a[1]=e,a[2]=i,a[3]=r,a[4]=n,a[5]=s,a},xs.set=function(t,e,i,r,n,s,a){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t[4]=s,t[5]=a,t},xs.invert=function(t,e){var i=e[0],r=e[1],n=e[2],s=e[3],a=e[4],c=e[5],p=i*s-r*n;return p?(t[0]=s*(p=1/p),t[1]=-r*p,t[2]=-n*p,t[3]=i*p,t[4]=(n*c-s*a)*p,t[5]=(r*a-i*c)*p,t):null},xs.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},xs.multiply=kd,xs.rotate=function(t,e,i){var r=e[0],n=e[1],s=e[2],a=e[3],c=e[4],p=e[5],_=Math.sin(i),v=Math.cos(i);return t[0]=r*v+s*_,t[1]=n*v+a*_,t[2]=r*-_+s*v,t[3]=n*-_+a*v,t[4]=c,t[5]=p,t},xs.scale=function(t,e,i){var r=e[1],n=e[2],s=e[3],a=e[4],c=e[5],p=i[0],_=i[1];return t[0]=e[0]*p,t[1]=r*p,t[2]=n*_,t[3]=s*_,t[4]=a,t[5]=c,t},xs.translate=function(t,e,i){var r=e[0],n=e[1],s=e[2],a=e[3],c=e[4],p=e[5],_=i[0],v=i[1];return t[0]=r,t[1]=n,t[2]=s,t[3]=a,t[4]=r*_+s*v+c,t[5]=n*_+a*v+p,t},xs.fromRotation=function(t,e){var i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=-i,t[3]=r,t[4]=0,t[5]=0,t},xs.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},xs.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},xs.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},xs.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)},xs.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t},xs.subtract=Fp,xs.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t},xs.multiplyScalarAndAdd=function(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t},xs.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},xs.equals=function(t,e){var i=t[0],r=t[1],n=t[2],s=t[3],a=t[4],c=t[5],p=e[0],_=e[1],v=e[2],E=e[3],C=e[4],B=e[5];return Math.abs(i-p)<=ZA.EPSILON*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(r-_)<=ZA.EPSILON*Math.max(1,Math.abs(r),Math.abs(_))&&Math.abs(n-v)<=ZA.EPSILON*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(s-E)<=ZA.EPSILON*Math.max(1,Math.abs(s),Math.abs(E))&&Math.abs(a-C)<=ZA.EPSILON*Math.max(1,Math.abs(a),Math.abs(C))&&Math.abs(c-B)<=ZA.EPSILON*Math.max(1,Math.abs(c),Math.abs(B))},xs.sub=xs.mul=void 0;var ZA=function(t,e){if(t&&t.__esModule)return t;if(t===null||Id(t)!=="object"&&typeof t!="function")return{default:t};var i=Cd(void 0);if(i&&i.has(t))return i.get(t);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in t)if(s!=="default"&&Object.prototype.hasOwnProperty.call(t,s)){var a=n?Object.getOwnPropertyDescriptor(t,s):null;a&&(a.get||a.set)?Object.defineProperty(r,s,a):r[s]=t[s]}return r.default=t,i&&i.set(t,r),r}(go);function Cd(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(Cd=function(r){return r?i:e})(t)}function kd(t,e,i){var r=e[0],n=e[1],s=e[2],a=e[3],c=e[4],p=e[5],_=i[0],v=i[1],E=i[2],C=i[3],B=i[4],O=i[5];return t[0]=r*_+s*v,t[1]=n*_+a*v,t[2]=r*E+s*C,t[3]=n*E+a*C,t[4]=r*B+s*O+c,t[5]=n*B+a*O+p,t}function Fp(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t}xs.mul=kd,xs.sub=Fp;var zn={};function Dd(t){return Dd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Dd(t)}Object.defineProperty(zn,"__esModule",{value:!0}),zn.create=function(){var t=new Ha.ARRAY_TYPE(9);return Ha.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},zn.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},zn.clone=function(t){var e=new Ha.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},zn.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},zn.fromValues=function(t,e,i,r,n,s,a,c,p){var _=new Ha.ARRAY_TYPE(9);return _[0]=t,_[1]=e,_[2]=i,_[3]=r,_[4]=n,_[5]=s,_[6]=a,_[7]=c,_[8]=p,_},zn.set=function(t,e,i,r,n,s,a,c,p,_){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t[4]=s,t[5]=a,t[6]=c,t[7]=p,t[8]=_,t},zn.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},zn.transpose=function(t,e){if(t===e){var i=e[1],r=e[2],n=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=r,t[7]=n}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},zn.invert=function(t,e){var i=e[0],r=e[1],n=e[2],s=e[3],a=e[4],c=e[5],p=e[6],_=e[7],v=e[8],E=v*a-c*_,C=-v*s+c*p,B=_*s-a*p,O=i*E+r*C+n*B;return O?(t[0]=E*(O=1/O),t[1]=(-v*r+n*_)*O,t[2]=(c*r-n*a)*O,t[3]=C*O,t[4]=(v*i-n*p)*O,t[5]=(-c*i+n*s)*O,t[6]=B*O,t[7]=(-_*i+r*p)*O,t[8]=(a*i-r*s)*O,t):null},zn.adjoint=function(t,e){var i=e[0],r=e[1],n=e[2],s=e[3],a=e[4],c=e[5],p=e[6],_=e[7],v=e[8];return t[0]=a*v-c*_,t[1]=n*_-r*v,t[2]=r*c-n*a,t[3]=c*p-s*v,t[4]=i*v-n*p,t[5]=n*s-i*c,t[6]=s*_-a*p,t[7]=r*p-i*_,t[8]=i*a-r*s,t},zn.determinant=function(t){var e=t[3],i=t[4],r=t[5],n=t[6],s=t[7],a=t[8];return t[0]*(a*i-r*s)+t[1]*(-a*e+r*n)+t[2]*(s*e-i*n)},zn.multiply=Vc,zn.translate=function(t,e,i){var r=e[0],n=e[1],s=e[2],a=e[3],c=e[4],p=e[5],_=e[6],v=e[7],E=e[8],C=i[0],B=i[1];return t[0]=r,t[1]=n,t[2]=s,t[3]=a,t[4]=c,t[5]=p,t[6]=C*r+B*a+_,t[7]=C*n+B*c+v,t[8]=C*s+B*p+E,t},zn.rotate=function(t,e,i){var r=e[0],n=e[1],s=e[2],a=e[3],c=e[4],p=e[5],_=e[6],v=e[7],E=e[8],C=Math.sin(i),B=Math.cos(i);return t[0]=B*r+C*a,t[1]=B*n+C*c,t[2]=B*s+C*p,t[3]=B*a-C*r,t[4]=B*c-C*n,t[5]=B*p-C*s,t[6]=_,t[7]=v,t[8]=E,t},zn.scale=function(t,e,i){var r=i[0],n=i[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=n*e[3],t[4]=n*e[4],t[5]=n*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},zn.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},zn.fromRotation=function(t,e){var i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=0,t[3]=-i,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},zn.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},zn.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},zn.fromQuat=function(t,e){var i=e[0],r=e[1],n=e[2],s=e[3],a=i+i,c=r+r,p=n+n,_=i*a,v=r*a,E=r*c,C=n*a,B=n*c,O=n*p,G=s*a,q=s*c,$=s*p;return t[0]=1-E-O,t[3]=v-$,t[6]=C+q,t[1]=v+$,t[4]=1-_-O,t[7]=B-G,t[2]=C-q,t[5]=B+G,t[8]=1-_-E,t},zn.normalFromMat4=function(t,e){var i=e[0],r=e[1],n=e[2],s=e[3],a=e[4],c=e[5],p=e[6],_=e[7],v=e[8],E=e[9],C=e[10],B=e[11],O=e[12],G=e[13],q=e[14],$=e[15],J=i*c-r*a,ie=i*p-n*a,re=i*_-s*a,te=r*p-n*c,se=r*_-s*c,he=n*_-s*p,ve=v*G-E*O,be=v*q-C*O,Ce=v*$-B*O,Ne=E*q-C*G,je=E*$-B*G,Ye=C*$-B*q,Re=J*Ye-ie*je+re*Ne+te*Ce-se*be+he*ve;return Re?(t[0]=(c*Ye-p*je+_*Ne)*(Re=1/Re),t[1]=(p*Ce-a*Ye-_*be)*Re,t[2]=(a*je-c*Ce+_*ve)*Re,t[3]=(n*je-r*Ye-s*Ne)*Re,t[4]=(i*Ye-n*Ce+s*be)*Re,t[5]=(r*Ce-i*je-s*ve)*Re,t[6]=(G*he-q*se+$*te)*Re,t[7]=(q*re-O*he-$*ie)*Re,t[8]=(O*se-G*re+$*J)*Re,t):null},zn.projection=function(t,e,i){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/i,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t},zn.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},zn.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},zn.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t},zn.subtract=s0,zn.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t},zn.multiplyScalarAndAdd=function(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t[6]=e[6]+i[6]*r,t[7]=e[7]+i[7]*r,t[8]=e[8]+i[8]*r,t},zn.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},zn.equals=function(t,e){var i=t[0],r=t[1],n=t[2],s=t[3],a=t[4],c=t[5],p=t[6],_=t[7],v=t[8],E=e[0],C=e[1],B=e[2],O=e[3],G=e[4],q=e[5],$=e[6],J=e[7],ie=e[8];return Math.abs(i-E)<=Ha.EPSILON*Math.max(1,Math.abs(i),Math.abs(E))&&Math.abs(r-C)<=Ha.EPSILON*Math.max(1,Math.abs(r),Math.abs(C))&&Math.abs(n-B)<=Ha.EPSILON*Math.max(1,Math.abs(n),Math.abs(B))&&Math.abs(s-O)<=Ha.EPSILON*Math.max(1,Math.abs(s),Math.abs(O))&&Math.abs(a-G)<=Ha.EPSILON*Math.max(1,Math.abs(a),Math.abs(G))&&Math.abs(c-q)<=Ha.EPSILON*Math.max(1,Math.abs(c),Math.abs(q))&&Math.abs(p-$)<=Ha.EPSILON*Math.max(1,Math.abs(p),Math.abs($))&&Math.abs(_-J)<=Ha.EPSILON*Math.max(1,Math.abs(_),Math.abs(J))&&Math.abs(v-ie)<=Ha.EPSILON*Math.max(1,Math.abs(v),Math.abs(ie))},zn.sub=zn.mul=void 0;var Ha=function(t,e){if(t&&t.__esModule)return t;if(t===null||Dd(t)!=="object"&&typeof t!="function")return{default:t};var i=qA(void 0);if(i&&i.has(t))return i.get(t);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in t)if(s!=="default"&&Object.prototype.hasOwnProperty.call(t,s)){var a=n?Object.getOwnPropertyDescriptor(t,s):null;a&&(a.get||a.set)?Object.defineProperty(r,s,a):r[s]=t[s]}return r.default=t,i&&i.set(t,r),r}(go);function qA(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(qA=function(r){return r?i:e})(t)}function Vc(t,e,i){var r=e[0],n=e[1],s=e[2],a=e[3],c=e[4],p=e[5],_=e[6],v=e[7],E=e[8],C=i[0],B=i[1],O=i[2],G=i[3],q=i[4],$=i[5],J=i[6],ie=i[7],re=i[8];return t[0]=C*r+B*a+O*_,t[1]=C*n+B*c+O*v,t[2]=C*s+B*p+O*E,t[3]=G*r+q*a+$*_,t[4]=G*n+q*c+$*v,t[5]=G*s+q*p+$*E,t[6]=J*r+ie*a+re*_,t[7]=J*n+ie*c+re*v,t[8]=J*s+ie*p+re*E,t}function s0(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t}zn.mul=Vc,zn.sub=s0;var Er={};function o0(t){return o0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o0(t)}Object.defineProperty(Er,"__esModule",{value:!0}),Er.create=function(){var t=new Bs.ARRAY_TYPE(16);return Bs.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},Er.clone=function(t){var e=new Bs.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},Er.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},Er.fromValues=function(t,e,i,r,n,s,a,c,p,_,v,E,C,B,O,G){var q=new Bs.ARRAY_TYPE(16);return q[0]=t,q[1]=e,q[2]=i,q[3]=r,q[4]=n,q[5]=s,q[6]=a,q[7]=c,q[8]=p,q[9]=_,q[10]=v,q[11]=E,q[12]=C,q[13]=B,q[14]=O,q[15]=G,q},Er.set=function(t,e,i,r,n,s,a,c,p,_,v,E,C,B,O,G,q){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t[4]=s,t[5]=a,t[6]=c,t[7]=p,t[8]=_,t[9]=v,t[10]=E,t[11]=C,t[12]=B,t[13]=O,t[14]=G,t[15]=q,t},Er.identity=Pd,Er.transpose=function(t,e){if(t===e){var i=e[1],r=e[2],n=e[3],s=e[6],a=e[7],c=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=s,t[11]=e[14],t[12]=n,t[13]=a,t[14]=c}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},Er.invert=function(t,e){var i=e[0],r=e[1],n=e[2],s=e[3],a=e[4],c=e[5],p=e[6],_=e[7],v=e[8],E=e[9],C=e[10],B=e[11],O=e[12],G=e[13],q=e[14],$=e[15],J=i*c-r*a,ie=i*p-n*a,re=i*_-s*a,te=r*p-n*c,se=r*_-s*c,he=n*_-s*p,ve=v*G-E*O,be=v*q-C*O,Ce=v*$-B*O,Ne=E*q-C*G,je=E*$-B*G,Ye=C*$-B*q,Re=J*Ye-ie*je+re*Ne+te*Ce-se*be+he*ve;return Re?(t[0]=(c*Ye-p*je+_*Ne)*(Re=1/Re),t[1]=(n*je-r*Ye-s*Ne)*Re,t[2]=(G*he-q*se+$*te)*Re,t[3]=(C*se-E*he-B*te)*Re,t[4]=(p*Ce-a*Ye-_*be)*Re,t[5]=(i*Ye-n*Ce+s*be)*Re,t[6]=(q*re-O*he-$*ie)*Re,t[7]=(v*he-C*re+B*ie)*Re,t[8]=(a*je-c*Ce+_*ve)*Re,t[9]=(r*Ce-i*je-s*ve)*Re,t[10]=(O*se-G*re+$*J)*Re,t[11]=(E*re-v*se-B*J)*Re,t[12]=(c*be-a*Ne-p*ve)*Re,t[13]=(i*Ne-r*be+n*ve)*Re,t[14]=(G*ie-O*te-q*J)*Re,t[15]=(v*te-E*ie+C*J)*Re,t):null},Er.adjoint=function(t,e){var i=e[0],r=e[1],n=e[2],s=e[3],a=e[4],c=e[5],p=e[6],_=e[7],v=e[8],E=e[9],C=e[10],B=e[11],O=e[12],G=e[13],q=e[14],$=e[15];return t[0]=c*(C*$-B*q)-E*(p*$-_*q)+G*(p*B-_*C),t[1]=-(r*(C*$-B*q)-E*(n*$-s*q)+G*(n*B-s*C)),t[2]=r*(p*$-_*q)-c*(n*$-s*q)+G*(n*_-s*p),t[3]=-(r*(p*B-_*C)-c*(n*B-s*C)+E*(n*_-s*p)),t[4]=-(a*(C*$-B*q)-v*(p*$-_*q)+O*(p*B-_*C)),t[5]=i*(C*$-B*q)-v*(n*$-s*q)+O*(n*B-s*C),t[6]=-(i*(p*$-_*q)-a*(n*$-s*q)+O*(n*_-s*p)),t[7]=i*(p*B-_*C)-a*(n*B-s*C)+v*(n*_-s*p),t[8]=a*(E*$-B*G)-v*(c*$-_*G)+O*(c*B-_*E),t[9]=-(i*(E*$-B*G)-v*(r*$-s*G)+O*(r*B-s*E)),t[10]=i*(c*$-_*G)-a*(r*$-s*G)+O*(r*_-s*c),t[11]=-(i*(c*B-_*E)-a*(r*B-s*E)+v*(r*_-s*c)),t[12]=-(a*(E*q-C*G)-v*(c*q-p*G)+O*(c*C-p*E)),t[13]=i*(E*q-C*G)-v*(r*q-n*G)+O*(r*C-n*E),t[14]=-(i*(c*q-p*G)-a*(r*q-n*G)+O*(r*p-n*c)),t[15]=i*(c*C-p*E)-a*(r*C-n*E)+v*(r*p-n*c),t},Er.determinant=function(t){var e=t[0],i=t[1],r=t[2],n=t[3],s=t[4],a=t[5],c=t[6],p=t[7],_=t[8],v=t[9],E=t[10],C=t[11],B=t[12],O=t[13],G=t[14],q=t[15];return(e*a-i*s)*(E*q-C*G)-(e*c-r*s)*(v*q-C*O)+(e*p-n*s)*(v*G-E*O)+(i*c-r*a)*(_*q-C*B)-(i*p-n*a)*(_*G-E*B)+(r*p-n*c)*(_*O-v*B)},Er.multiply=Op,Er.translate=function(t,e,i){var r,n,s,a,c,p,_,v,E,C,B,O,G=i[0],q=i[1],$=i[2];return e===t?(t[12]=e[0]*G+e[4]*q+e[8]*$+e[12],t[13]=e[1]*G+e[5]*q+e[9]*$+e[13],t[14]=e[2]*G+e[6]*q+e[10]*$+e[14],t[15]=e[3]*G+e[7]*q+e[11]*$+e[15]):(n=e[1],s=e[2],a=e[3],c=e[4],p=e[5],_=e[6],v=e[7],E=e[8],C=e[9],B=e[10],O=e[11],t[0]=r=e[0],t[1]=n,t[2]=s,t[3]=a,t[4]=c,t[5]=p,t[6]=_,t[7]=v,t[8]=E,t[9]=C,t[10]=B,t[11]=O,t[12]=r*G+c*q+E*$+e[12],t[13]=n*G+p*q+C*$+e[13],t[14]=s*G+_*q+B*$+e[14],t[15]=a*G+v*q+O*$+e[15]),t},Er.scale=function(t,e,i){var r=i[0],n=i[1],s=i[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},Er.rotate=function(t,e,i,r){var n,s,a,c,p,_,v,E,C,B,O,G,q,$,J,ie,re,te,se,he,ve,be,Ce,Ne,je=r[0],Ye=r[1],Re=r[2],rt=Math.hypot(je,Ye,Re);return rt<Bs.EPSILON?null:(je*=rt=1/rt,Ye*=rt,Re*=rt,n=Math.sin(i),s=Math.cos(i),p=e[1],_=e[2],v=e[3],C=e[5],B=e[6],O=e[7],q=e[9],$=e[10],J=e[11],se=je*Ye*(a=1-s)-Re*n,he=Ye*Ye*a+s,ve=Re*Ye*a+je*n,be=je*Re*a+Ye*n,Ce=Ye*Re*a-je*n,Ne=Re*Re*a+s,t[0]=(c=e[0])*(ie=je*je*a+s)+(E=e[4])*(re=Ye*je*a+Re*n)+(G=e[8])*(te=Re*je*a-Ye*n),t[1]=p*ie+C*re+q*te,t[2]=_*ie+B*re+$*te,t[3]=v*ie+O*re+J*te,t[4]=c*se+E*he+G*ve,t[5]=p*se+C*he+q*ve,t[6]=_*se+B*he+$*ve,t[7]=v*se+O*he+J*ve,t[8]=c*be+E*Ce+G*Ne,t[9]=p*be+C*Ce+q*Ne,t[10]=_*be+B*Ce+$*Ne,t[11]=v*be+O*Ce+J*Ne,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},Er.rotateX=function(t,e,i){var r=Math.sin(i),n=Math.cos(i),s=e[4],a=e[5],c=e[6],p=e[7],_=e[8],v=e[9],E=e[10],C=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*n+_*r,t[5]=a*n+v*r,t[6]=c*n+E*r,t[7]=p*n+C*r,t[8]=_*n-s*r,t[9]=v*n-a*r,t[10]=E*n-c*r,t[11]=C*n-p*r,t},Er.rotateY=function(t,e,i){var r=Math.sin(i),n=Math.cos(i),s=e[0],a=e[1],c=e[2],p=e[3],_=e[8],v=e[9],E=e[10],C=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*n-_*r,t[1]=a*n-v*r,t[2]=c*n-E*r,t[3]=p*n-C*r,t[8]=s*r+_*n,t[9]=a*r+v*n,t[10]=c*r+E*n,t[11]=p*r+C*n,t},Er.rotateZ=function(t,e,i){var r=Math.sin(i),n=Math.cos(i),s=e[0],a=e[1],c=e[2],p=e[3],_=e[4],v=e[5],E=e[6],C=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*n+_*r,t[1]=a*n+v*r,t[2]=c*n+E*r,t[3]=p*n+C*r,t[4]=_*n-s*r,t[5]=v*n-a*r,t[6]=E*n-c*r,t[7]=C*n-p*r,t},Er.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},Er.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Er.fromRotation=function(t,e,i){var r,n,s,a=i[0],c=i[1],p=i[2],_=Math.hypot(a,c,p);return _<Bs.EPSILON?null:(a*=_=1/_,c*=_,p*=_,r=Math.sin(e),n=Math.cos(e),t[0]=a*a*(s=1-n)+n,t[1]=c*a*s+p*r,t[2]=p*a*s-c*r,t[3]=0,t[4]=a*c*s-p*r,t[5]=c*c*s+n,t[6]=p*c*s+a*r,t[7]=0,t[8]=a*p*s+c*r,t[9]=c*p*s-a*r,t[10]=p*p*s+n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},Er.fromXRotation=function(t,e){var i=Math.sin(e),r=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=i,t[7]=0,t[8]=0,t[9]=-i,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Er.fromYRotation=function(t,e){var i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=0,t[2]=-i,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=i,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Er.fromZRotation=function(t,e){var i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=0,t[3]=0,t[4]=-i,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Er.fromRotationTranslation=zd,Er.fromQuat2=function(t,e){var i=new Bs.ARRAY_TYPE(3),r=-e[0],n=-e[1],s=-e[2],a=e[3],c=e[4],p=e[5],_=e[6],v=e[7],E=r*r+n*n+s*s+a*a;return E>0?(i[0]=2*(c*a+v*r+p*s-_*n)/E,i[1]=2*(p*a+v*n+_*r-c*s)/E,i[2]=2*(_*a+v*s+c*n-p*r)/E):(i[0]=2*(c*a+v*r+p*s-_*n),i[1]=2*(p*a+v*n+_*r-c*s),i[2]=2*(_*a+v*s+c*n-p*r)),zd(t,e,i),t},Er.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},Er.getScaling=Bd,Er.getRotation=function(t,e){var i=new Bs.ARRAY_TYPE(3);Bd(i,e);var r=1/i[0],n=1/i[1],s=1/i[2],a=e[0]*r,c=e[1]*n,p=e[2]*s,_=e[4]*r,v=e[5]*n,E=e[6]*s,C=e[8]*r,B=e[9]*n,O=e[10]*s,G=a+v+O,q=0;return G>0?(q=2*Math.sqrt(G+1),t[3]=.25*q,t[0]=(E-B)/q,t[1]=(C-p)/q,t[2]=(c-_)/q):a>v&&a>O?(q=2*Math.sqrt(1+a-v-O),t[3]=(E-B)/q,t[0]=.25*q,t[1]=(c+_)/q,t[2]=(C+p)/q):v>O?(q=2*Math.sqrt(1+v-a-O),t[3]=(C-p)/q,t[0]=(c+_)/q,t[1]=.25*q,t[2]=(E+B)/q):(q=2*Math.sqrt(1+O-a-v),t[3]=(c-_)/q,t[0]=(C+p)/q,t[1]=(E+B)/q,t[2]=.25*q),t},Er.fromRotationTranslationScale=function(t,e,i,r){var n=e[0],s=e[1],a=e[2],c=e[3],p=n+n,_=s+s,v=a+a,E=n*p,C=n*_,B=n*v,O=s*_,G=s*v,q=a*v,$=c*p,J=c*_,ie=c*v,re=r[0],te=r[1],se=r[2];return t[0]=(1-(O+q))*re,t[1]=(C+ie)*re,t[2]=(B-J)*re,t[3]=0,t[4]=(C-ie)*te,t[5]=(1-(E+q))*te,t[6]=(G+$)*te,t[7]=0,t[8]=(B+J)*se,t[9]=(G-$)*se,t[10]=(1-(E+O))*se,t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t},Er.fromRotationTranslationScaleOrigin=function(t,e,i,r,n){var s=e[0],a=e[1],c=e[2],p=e[3],_=s+s,v=a+a,E=c+c,C=s*_,B=s*v,O=s*E,G=a*v,q=a*E,$=c*E,J=p*_,ie=p*v,re=p*E,te=r[0],se=r[1],he=r[2],ve=n[0],be=n[1],Ce=n[2],Ne=(1-(G+$))*te,je=(B+re)*te,Ye=(O-ie)*te,Re=(B-re)*se,rt=(1-(C+$))*se,lt=(q+J)*se,vt=(O+ie)*he,it=(q-J)*he,at=(1-(C+G))*he;return t[0]=Ne,t[1]=je,t[2]=Ye,t[3]=0,t[4]=Re,t[5]=rt,t[6]=lt,t[7]=0,t[8]=vt,t[9]=it,t[10]=at,t[11]=0,t[12]=i[0]+ve-(Ne*ve+Re*be+vt*Ce),t[13]=i[1]+be-(je*ve+rt*be+it*Ce),t[14]=i[2]+Ce-(Ye*ve+lt*be+at*Ce),t[15]=1,t},Er.fromQuat=function(t,e){var i=e[0],r=e[1],n=e[2],s=e[3],a=i+i,c=r+r,p=n+n,_=i*a,v=r*a,E=r*c,C=n*a,B=n*c,O=n*p,G=s*a,q=s*c,$=s*p;return t[0]=1-E-O,t[1]=v+$,t[2]=C-q,t[3]=0,t[4]=v-$,t[5]=1-_-O,t[6]=B+G,t[7]=0,t[8]=C+q,t[9]=B-G,t[10]=1-_-E,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Er.frustum=function(t,e,i,r,n,s,a){var c=1/(i-e),p=1/(n-r),_=1/(s-a);return t[0]=2*s*c,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*s*p,t[6]=0,t[7]=0,t[8]=(i+e)*c,t[9]=(n+r)*p,t[10]=(a+s)*_,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*s*2*_,t[15]=0,t},Er.perspectiveNO=Du,Er.perspectiveZO=function(t,e,i,r,n){var s,a=1/Math.tan(e/2);return t[0]=a/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,n!=null&&n!==1/0?(t[10]=n*(s=1/(r-n)),t[14]=n*r*s):(t[10]=-1,t[14]=-r),t},Er.perspectiveFromFieldOfView=function(t,e,i,r){var n=Math.tan(e.upDegrees*Math.PI/180),s=Math.tan(e.downDegrees*Math.PI/180),a=Math.tan(e.leftDegrees*Math.PI/180),c=Math.tan(e.rightDegrees*Math.PI/180),p=2/(a+c),_=2/(n+s);return t[0]=p,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=_,t[6]=0,t[7]=0,t[8]=-(a-c)*p*.5,t[9]=(n-s)*_*.5,t[10]=r/(i-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*i/(i-r),t[15]=0,t},Er.orthoNO=a0,Er.orthoZO=function(t,e,i,r,n,s,a){var c=1/(e-i),p=1/(r-n),_=1/(s-a);return t[0]=-2*c,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*p,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=_,t[11]=0,t[12]=(e+i)*c,t[13]=(n+r)*p,t[14]=s*_,t[15]=1,t},Er.lookAt=function(t,e,i,r){var n,s,a,c,p,_,v,E,C,B,O=e[0],G=e[1],q=e[2],$=r[0],J=r[1],ie=r[2],re=i[0],te=i[1],se=i[2];return Math.abs(O-re)<Bs.EPSILON&&Math.abs(G-te)<Bs.EPSILON&&Math.abs(q-se)<Bs.EPSILON?Pd(t):(v=O-re,E=G-te,C=q-se,n=J*(C*=B=1/Math.hypot(v,E,C))-ie*(E*=B),s=ie*(v*=B)-$*C,a=$*E-J*v,(B=Math.hypot(n,s,a))?(n*=B=1/B,s*=B,a*=B):(n=0,s=0,a=0),c=E*a-C*s,p=C*n-v*a,_=v*s-E*n,(B=Math.hypot(c,p,_))?(c*=B=1/B,p*=B,_*=B):(c=0,p=0,_=0),t[0]=n,t[1]=c,t[2]=v,t[3]=0,t[4]=s,t[5]=p,t[6]=E,t[7]=0,t[8]=a,t[9]=_,t[10]=C,t[11]=0,t[12]=-(n*O+s*G+a*q),t[13]=-(c*O+p*G+_*q),t[14]=-(v*O+E*G+C*q),t[15]=1,t)},Er.targetTo=function(t,e,i,r){var n=e[0],s=e[1],a=e[2],c=r[0],p=r[1],_=r[2],v=n-i[0],E=s-i[1],C=a-i[2],B=v*v+E*E+C*C;B>0&&(v*=B=1/Math.sqrt(B),E*=B,C*=B);var O=p*C-_*E,G=_*v-c*C,q=c*E-p*v;return(B=O*O+G*G+q*q)>0&&(O*=B=1/Math.sqrt(B),G*=B,q*=B),t[0]=O,t[1]=G,t[2]=q,t[3]=0,t[4]=E*q-C*G,t[5]=C*O-v*q,t[6]=v*G-E*O,t[7]=0,t[8]=v,t[9]=E,t[10]=C,t[11]=0,t[12]=n,t[13]=s,t[14]=a,t[15]=1,t},Er.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},Er.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},Er.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t[9]=e[9]+i[9],t[10]=e[10]+i[10],t[11]=e[11]+i[11],t[12]=e[12]+i[12],t[13]=e[13]+i[13],t[14]=e[14]+i[14],t[15]=e[15]+i[15],t},Er.subtract=l0,Er.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12]*i,t[13]=e[13]*i,t[14]=e[14]*i,t[15]=e[15]*i,t},Er.multiplyScalarAndAdd=function(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t[6]=e[6]+i[6]*r,t[7]=e[7]+i[7]*r,t[8]=e[8]+i[8]*r,t[9]=e[9]+i[9]*r,t[10]=e[10]+i[10]*r,t[11]=e[11]+i[11]*r,t[12]=e[12]+i[12]*r,t[13]=e[13]+i[13]*r,t[14]=e[14]+i[14]*r,t[15]=e[15]+i[15]*r,t},Er.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},Er.equals=function(t,e){var i=t[0],r=t[1],n=t[2],s=t[3],a=t[4],c=t[5],p=t[6],_=t[7],v=t[8],E=t[9],C=t[10],B=t[11],O=t[12],G=t[13],q=t[14],$=t[15],J=e[0],ie=e[1],re=e[2],te=e[3],se=e[4],he=e[5],ve=e[6],be=e[7],Ce=e[8],Ne=e[9],je=e[10],Ye=e[11],Re=e[12],rt=e[13],lt=e[14],vt=e[15];return Math.abs(i-J)<=Bs.EPSILON*Math.max(1,Math.abs(i),Math.abs(J))&&Math.abs(r-ie)<=Bs.EPSILON*Math.max(1,Math.abs(r),Math.abs(ie))&&Math.abs(n-re)<=Bs.EPSILON*Math.max(1,Math.abs(n),Math.abs(re))&&Math.abs(s-te)<=Bs.EPSILON*Math.max(1,Math.abs(s),Math.abs(te))&&Math.abs(a-se)<=Bs.EPSILON*Math.max(1,Math.abs(a),Math.abs(se))&&Math.abs(c-he)<=Bs.EPSILON*Math.max(1,Math.abs(c),Math.abs(he))&&Math.abs(p-ve)<=Bs.EPSILON*Math.max(1,Math.abs(p),Math.abs(ve))&&Math.abs(_-be)<=Bs.EPSILON*Math.max(1,Math.abs(_),Math.abs(be))&&Math.abs(v-Ce)<=Bs.EPSILON*Math.max(1,Math.abs(v),Math.abs(Ce))&&Math.abs(E-Ne)<=Bs.EPSILON*Math.max(1,Math.abs(E),Math.abs(Ne))&&Math.abs(C-je)<=Bs.EPSILON*Math.max(1,Math.abs(C),Math.abs(je))&&Math.abs(B-Ye)<=Bs.EPSILON*Math.max(1,Math.abs(B),Math.abs(Ye))&&Math.abs(O-Re)<=Bs.EPSILON*Math.max(1,Math.abs(O),Math.abs(Re))&&Math.abs(G-rt)<=Bs.EPSILON*Math.max(1,Math.abs(G),Math.abs(rt))&&Math.abs(q-lt)<=Bs.EPSILON*Math.max(1,Math.abs(q),Math.abs(lt))&&Math.abs($-vt)<=Bs.EPSILON*Math.max(1,Math.abs($),Math.abs(vt))},Er.sub=Er.mul=Er.ortho=Er.perspective=void 0;var Bs=function(t,e){if(t&&t.__esModule)return t;if(t===null||o0(t)!=="object"&&typeof t!="function")return{default:t};var i=Vh(void 0);if(i&&i.has(t))return i.get(t);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in t)if(s!=="default"&&Object.prototype.hasOwnProperty.call(t,s)){var a=n?Object.getOwnPropertyDescriptor(t,s):null;a&&(a.get||a.set)?Object.defineProperty(r,s,a):r[s]=t[s]}return r.default=t,i&&i.set(t,r),r}(go);function Vh(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(Vh=function(r){return r?i:e})(t)}function Pd(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Op(t,e,i){var r=e[0],n=e[1],s=e[2],a=e[3],c=e[4],p=e[5],_=e[6],v=e[7],E=e[8],C=e[9],B=e[10],O=e[11],G=e[12],q=e[13],$=e[14],J=e[15],ie=i[0],re=i[1],te=i[2],se=i[3];return t[0]=ie*r+re*c+te*E+se*G,t[1]=ie*n+re*p+te*C+se*q,t[2]=ie*s+re*_+te*B+se*$,t[3]=ie*a+re*v+te*O+se*J,t[4]=(ie=i[4])*r+(re=i[5])*c+(te=i[6])*E+(se=i[7])*G,t[5]=ie*n+re*p+te*C+se*q,t[6]=ie*s+re*_+te*B+se*$,t[7]=ie*a+re*v+te*O+se*J,t[8]=(ie=i[8])*r+(re=i[9])*c+(te=i[10])*E+(se=i[11])*G,t[9]=ie*n+re*p+te*C+se*q,t[10]=ie*s+re*_+te*B+se*$,t[11]=ie*a+re*v+te*O+se*J,t[12]=(ie=i[12])*r+(re=i[13])*c+(te=i[14])*E+(se=i[15])*G,t[13]=ie*n+re*p+te*C+se*q,t[14]=ie*s+re*_+te*B+se*$,t[15]=ie*a+re*v+te*O+se*J,t}function zd(t,e,i){var r=e[0],n=e[1],s=e[2],a=e[3],c=r+r,p=n+n,_=s+s,v=r*c,E=r*p,C=r*_,B=n*p,O=n*_,G=s*_,q=a*c,$=a*p,J=a*_;return t[0]=1-(B+G),t[1]=E+J,t[2]=C-$,t[3]=0,t[4]=E-J,t[5]=1-(v+G),t[6]=O+q,t[7]=0,t[8]=C+$,t[9]=O-q,t[10]=1-(v+B),t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t}function Bd(t,e){var i=e[4],r=e[5],n=e[6],s=e[8],a=e[9],c=e[10];return t[0]=Math.hypot(e[0],e[1],e[2]),t[1]=Math.hypot(i,r,n),t[2]=Math.hypot(s,a,c),t}function Du(t,e,i,r,n){var s,a=1/Math.tan(e/2);return t[0]=a/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,n!=null&&n!==1/0?(t[10]=(n+r)*(s=1/(r-n)),t[14]=2*n*r*s):(t[10]=-1,t[14]=-2*r),t}function a0(t,e,i,r,n,s,a){var c=1/(e-i),p=1/(r-n),_=1/(s-a);return t[0]=-2*c,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*p,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*_,t[11]=0,t[12]=(e+i)*c,t[13]=(n+r)*p,t[14]=(a+s)*_,t[15]=1,t}function l0(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t[9]=e[9]-i[9],t[10]=e[10]-i[10],t[11]=e[11]-i[11],t[12]=e[12]-i[12],t[13]=e[13]-i[13],t[14]=e[14]-i[14],t[15]=e[15]-i[15],t}Er.perspective=Du,Er.ortho=a0,Er.mul=Op,Er.sub=l0;var _r={},Mr={};function Yu(t){return Yu=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Yu(t)}Object.defineProperty(Mr,"__esModule",{value:!0}),Mr.create=Np,Mr.clone=function(t){var e=new fc.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},Mr.length=A0,Mr.fromValues=function(t,e,i){var r=new fc.ARRAY_TYPE(3);return r[0]=t,r[1]=e,r[2]=i,r},Mr.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},Mr.set=function(t,e,i,r){return t[0]=e,t[1]=i,t[2]=r,t},Mr.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t},Mr.subtract=Up,Mr.multiply=jp,Mr.divide=Gp,Mr.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},Mr.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},Mr.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t},Mr.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t},Mr.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},Mr.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t},Mr.scaleAndAdd=function(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t},Mr.distance=Zp,Mr.squaredDistance=Ld,Mr.squaredLength=Nc,Mr.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},Mr.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},Mr.normalize=function(t,e){var i=e[0],r=e[1],n=e[2],s=i*i+r*r+n*n;return s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t},Mr.dot=c0,Mr.cross=function(t,e,i){var r=e[0],n=e[1],s=e[2],a=i[0],c=i[1],p=i[2];return t[0]=n*p-s*c,t[1]=s*a-r*p,t[2]=r*c-n*a,t},Mr.lerp=function(t,e,i,r){var n=e[0],s=e[1],a=e[2];return t[0]=n+r*(i[0]-n),t[1]=s+r*(i[1]-s),t[2]=a+r*(i[2]-a),t},Mr.hermite=function(t,e,i,r,n,s){var a=s*s,c=a*(2*s-3)+1,p=a*(s-2)+s,_=a*(s-1),v=a*(3-2*s);return t[0]=e[0]*c+i[0]*p+r[0]*_+n[0]*v,t[1]=e[1]*c+i[1]*p+r[1]*_+n[1]*v,t[2]=e[2]*c+i[2]*p+r[2]*_+n[2]*v,t},Mr.bezier=function(t,e,i,r,n,s){var a=1-s,c=a*a,p=s*s,_=c*a,v=3*s*c,E=3*p*a,C=p*s;return t[0]=e[0]*_+i[0]*v+r[0]*E+n[0]*C,t[1]=e[1]*_+i[1]*v+r[1]*E+n[1]*C,t[2]=e[2]*_+i[2]*v+r[2]*E+n[2]*C,t},Mr.random=function(t,e){e=e||1;var i=2*fc.RANDOM()*Math.PI,r=2*fc.RANDOM()-1,n=Math.sqrt(1-r*r)*e;return t[0]=Math.cos(i)*n,t[1]=Math.sin(i)*n,t[2]=r*e,t},Mr.transformMat4=function(t,e,i){var r=e[0],n=e[1],s=e[2],a=i[3]*r+i[7]*n+i[11]*s+i[15];return t[0]=(i[0]*r+i[4]*n+i[8]*s+i[12])/(a=a||1),t[1]=(i[1]*r+i[5]*n+i[9]*s+i[13])/a,t[2]=(i[2]*r+i[6]*n+i[10]*s+i[14])/a,t},Mr.transformMat3=function(t,e,i){var r=e[0],n=e[1],s=e[2];return t[0]=r*i[0]+n*i[3]+s*i[6],t[1]=r*i[1]+n*i[4]+s*i[7],t[2]=r*i[2]+n*i[5]+s*i[8],t},Mr.transformQuat=function(t,e,i){var r=i[0],n=i[1],s=i[2],a=e[0],c=e[1],p=e[2],_=n*p-s*c,v=s*a-r*p,E=r*c-n*a,C=n*E-s*v,B=s*_-r*E,O=r*v-n*_,G=2*i[3];return v*=G,E*=G,B*=2,O*=2,t[0]=a+(_*=G)+(C*=2),t[1]=c+v+B,t[2]=p+E+O,t},Mr.rotateX=function(t,e,i,r){var n=[],s=[];return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],s[0]=n[0],s[1]=n[1]*Math.cos(r)-n[2]*Math.sin(r),s[2]=n[1]*Math.sin(r)+n[2]*Math.cos(r),t[0]=s[0]+i[0],t[1]=s[1]+i[1],t[2]=s[2]+i[2],t},Mr.rotateY=function(t,e,i,r){var n=[],s=[];return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],s[0]=n[2]*Math.sin(r)+n[0]*Math.cos(r),s[1]=n[1],s[2]=n[2]*Math.cos(r)-n[0]*Math.sin(r),t[0]=s[0]+i[0],t[1]=s[1]+i[1],t[2]=s[2]+i[2],t},Mr.rotateZ=function(t,e,i,r){var n=[],s=[];return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],s[0]=n[0]*Math.cos(r)-n[1]*Math.sin(r),s[1]=n[0]*Math.sin(r)+n[1]*Math.cos(r),s[2]=n[2],t[0]=s[0]+i[0],t[1]=s[1]+i[1],t[2]=s[2]+i[2],t},Mr.angle=function(t,e){var i=t[0],r=t[1],n=t[2],s=e[0],a=e[1],c=e[2],p=Math.sqrt(i*i+r*r+n*n)*Math.sqrt(s*s+a*a+c*c),_=p&&c0(t,e)/p;return Math.acos(Math.min(Math.max(_,-1),1))},Mr.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t},Mr.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},Mr.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},Mr.equals=function(t,e){var i=t[0],r=t[1],n=t[2],s=e[0],a=e[1],c=e[2];return Math.abs(i-s)<=fc.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(r-a)<=fc.EPSILON*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(n-c)<=fc.EPSILON*Math.max(1,Math.abs(n),Math.abs(c))},Mr.forEach=Mr.sqrLen=Mr.len=Mr.sqrDist=Mr.dist=Mr.div=Mr.mul=Mr.sub=void 0;var fc=function(t,e){if(t&&t.__esModule)return t;if(t===null||Yu(t)!=="object"&&typeof t!="function")return{default:t};var i=Vp(void 0);if(i&&i.has(t))return i.get(t);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in t)if(s!=="default"&&Object.prototype.hasOwnProperty.call(t,s)){var a=n?Object.getOwnPropertyDescriptor(t,s):null;a&&(a.get||a.set)?Object.defineProperty(r,s,a):r[s]=t[s]}return r.default=t,i&&i.set(t,r),r}(go);function Vp(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(Vp=function(r){return r?i:e})(t)}function Np(){var t=new fc.ARRAY_TYPE(3);return fc.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function A0(t){return Math.hypot(t[0],t[1],t[2])}function Up(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function jp(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t}function Gp(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t}function Zp(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])}function Ld(t,e){var i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2];return i*i+r*r+n*n}function Nc(t){var e=t[0],i=t[1],r=t[2];return e*e+i*i+r*r}function c0(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}Mr.sub=Up,Mr.mul=jp,Mr.div=Gp,Mr.dist=Zp,Mr.sqrDist=Ld,Mr.len=A0,Mr.sqrLen=Nc;var pc,qp=(pc=Np(),function(t,e,i,r,n,s){var a,c;for(e||(e=3),i||(i=0),c=r?Math.min(r*e+i,t.length):t.length,a=i;a<c;a+=e)pc[0]=t[a],pc[1]=t[a+1],pc[2]=t[a+2],n(pc,pc,s),t[a]=pc[0],t[a+1]=pc[1],t[a+2]=pc[2];return t});Mr.forEach=qp;var Fr={};function Rd(t){return Rd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Rd(t)}Object.defineProperty(Fr,"__esModule",{value:!0}),Fr.create=Nh,Fr.clone=function(t){var e=new AA.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Fr.fromValues=function(t,e,i,r){var n=new AA.ARRAY_TYPE(4);return n[0]=t,n[1]=e,n[2]=i,n[3]=r,n},Fr.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Fr.set=function(t,e,i,r,n){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t},Fr.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t},Fr.subtract=u0,Fr.multiply=Od,Fr.divide=h0,Fr.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},Fr.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},Fr.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t[3]=Math.min(e[3],i[3]),t},Fr.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t[3]=Math.max(e[3],i[3]),t},Fr.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},Fr.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t},Fr.scaleAndAdd=function(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t},Fr.distance=Zl,Fr.squaredDistance=Ku,Fr.length=d0,Fr.squaredLength=f0,Fr.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},Fr.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},Fr.normalize=function(t,e){var i=e[0],r=e[1],n=e[2],s=e[3],a=i*i+r*r+n*n+s*s;return a>0&&(a=1/Math.sqrt(a)),t[0]=i*a,t[1]=r*a,t[2]=n*a,t[3]=s*a,t},Fr.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},Fr.cross=function(t,e,i,r){var n=i[0]*r[1]-i[1]*r[0],s=i[0]*r[2]-i[2]*r[0],a=i[0]*r[3]-i[3]*r[0],c=i[1]*r[2]-i[2]*r[1],p=i[1]*r[3]-i[3]*r[1],_=i[2]*r[3]-i[3]*r[2],v=e[0],E=e[1],C=e[2],B=e[3];return t[0]=E*_-C*p+B*c,t[1]=-v*_+C*a-B*s,t[2]=v*p-E*a+B*n,t[3]=-v*c+E*s-C*n,t},Fr.lerp=function(t,e,i,r){var n=e[0],s=e[1],a=e[2],c=e[3];return t[0]=n+r*(i[0]-n),t[1]=s+r*(i[1]-s),t[2]=a+r*(i[2]-a),t[3]=c+r*(i[3]-c),t},Fr.random=function(t,e){var i,r,n,s,a,c;e=e||1;do a=(i=2*AA.RANDOM()-1)*i+(r=2*AA.RANDOM()-1)*r;while(a>=1);do c=(n=2*AA.RANDOM()-1)*n+(s=2*AA.RANDOM()-1)*s;while(c>=1);var p=Math.sqrt((1-a)/c);return t[0]=e*i,t[1]=e*r,t[2]=e*n*p,t[3]=e*s*p,t},Fr.transformMat4=function(t,e,i){var r=e[0],n=e[1],s=e[2],a=e[3];return t[0]=i[0]*r+i[4]*n+i[8]*s+i[12]*a,t[1]=i[1]*r+i[5]*n+i[9]*s+i[13]*a,t[2]=i[2]*r+i[6]*n+i[10]*s+i[14]*a,t[3]=i[3]*r+i[7]*n+i[11]*s+i[15]*a,t},Fr.transformQuat=function(t,e,i){var r=e[0],n=e[1],s=e[2],a=i[0],c=i[1],p=i[2],_=i[3],v=_*r+c*s-p*n,E=_*n+p*r-a*s,C=_*s+a*n-c*r,B=-a*r-c*n-p*s;return t[0]=v*_+B*-a+E*-p-C*-c,t[1]=E*_+B*-c+C*-a-v*-p,t[2]=C*_+B*-p+v*-c-E*-a,t[3]=e[3],t},Fr.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},Fr.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Fr.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},Fr.equals=function(t,e){var i=t[0],r=t[1],n=t[2],s=t[3],a=e[0],c=e[1],p=e[2],_=e[3];return Math.abs(i-a)<=AA.EPSILON*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(r-c)<=AA.EPSILON*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(n-p)<=AA.EPSILON*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(s-_)<=AA.EPSILON*Math.max(1,Math.abs(s),Math.abs(_))},Fr.forEach=Fr.sqrLen=Fr.len=Fr.sqrDist=Fr.dist=Fr.div=Fr.mul=Fr.sub=void 0;var AA=function(t,e){if(t&&t.__esModule)return t;if(t===null||Rd(t)!=="object"&&typeof t!="function")return{default:t};var i=Fd(void 0);if(i&&i.has(t))return i.get(t);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in t)if(s!=="default"&&Object.prototype.hasOwnProperty.call(t,s)){var a=n?Object.getOwnPropertyDescriptor(t,s):null;a&&(a.get||a.set)?Object.defineProperty(r,s,a):r[s]=t[s]}return r.default=t,i&&i.set(t,r),r}(go);function Fd(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(Fd=function(r){return r?i:e})(t)}function Nh(){var t=new AA.ARRAY_TYPE(4);return AA.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function u0(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}function Od(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t[3]=e[3]*i[3],t}function h0(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t[3]=e[3]/i[3],t}function Zl(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3])}function Ku(t,e){var i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2],s=e[3]-t[3];return i*i+r*r+n*n+s*s}function d0(t){return Math.hypot(t[0],t[1],t[2],t[3])}function f0(t){var e=t[0],i=t[1],r=t[2],n=t[3];return e*e+i*i+r*r+n*n}Fr.sub=u0,Fr.mul=Od,Fr.div=h0,Fr.dist=Zl,Fr.sqrDist=Ku,Fr.len=d0,Fr.sqrLen=f0;var Qp=function(){var t=Nh();return function(e,i,r,n,s,a){var c,p;for(i||(i=4),r||(r=0),p=n?Math.min(n*i+r,e.length):e.length,c=r;c<p;c+=i)t[0]=e[c],t[1]=e[c+1],t[2]=e[c+2],t[3]=e[c+3],s(t,t,a),e[c]=t[0],e[c+1]=t[1],e[c+2]=t[2],e[c+3]=t[3];return e}}();function Vd(t){return Vd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Vd(t)}Fr.forEach=Qp,Object.defineProperty(_r,"__esModule",{value:!0}),_r.create=Nd,_r.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},_r.setAxisAngle=p0,_r.getAxisAngle=function(t,e){var i=2*Math.acos(e[3]),r=Math.sin(i/2);return r>Au.EPSILON?(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r):(t[0]=1,t[1]=0,t[2]=0),i},_r.getAngle=function(t,e){var i=Gh(t,e);return Math.acos(2*i*i-1)},_r.multiply=m0,_r.rotateX=function(t,e,i){i*=.5;var r=e[0],n=e[1],s=e[2],a=e[3],c=Math.sin(i),p=Math.cos(i);return t[0]=r*p+a*c,t[1]=n*p+s*c,t[2]=s*p-n*c,t[3]=a*p-r*c,t},_r.rotateY=function(t,e,i){i*=.5;var r=e[0],n=e[1],s=e[2],a=e[3],c=Math.sin(i),p=Math.cos(i);return t[0]=r*p-s*c,t[1]=n*p+a*c,t[2]=s*p+r*c,t[3]=a*p-n*c,t},_r.rotateZ=function(t,e,i){i*=.5;var r=e[0],n=e[1],s=e[2],a=e[3],c=Math.sin(i),p=Math.cos(i);return t[0]=r*p+n*c,t[1]=n*p-r*c,t[2]=s*p+a*c,t[3]=a*p-s*c,t},_r.calculateW=function(t,e){var i=e[0],r=e[1],n=e[2];return t[0]=i,t[1]=r,t[2]=n,t[3]=Math.sqrt(Math.abs(1-i*i-r*r-n*n)),t},_r.exp=Wp,_r.ln=$p,_r.pow=function(t,e,i){return $p(t,e),_0(t,t,i),Wp(t,t),t},_r.slerp=jh,_r.random=function(t){var e=Au.RANDOM(),i=Au.RANDOM(),r=Au.RANDOM(),n=Math.sqrt(1-e),s=Math.sqrt(e);return t[0]=n*Math.sin(2*Math.PI*i),t[1]=n*Math.cos(2*Math.PI*i),t[2]=s*Math.sin(2*Math.PI*r),t[3]=s*Math.cos(2*Math.PI*r),t},_r.invert=function(t,e){var i=e[0],r=e[1],n=e[2],s=e[3],a=i*i+r*r+n*n+s*s,c=a?1/a:0;return t[0]=-i*c,t[1]=-r*c,t[2]=-n*c,t[3]=s*c,t},_r.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},_r.fromMat3=Pu,_r.fromEuler=function(t,e,i,r){var n=.5*Math.PI/180;e*=n,i*=n,r*=n;var s=Math.sin(e),a=Math.cos(e),c=Math.sin(i),p=Math.cos(i),_=Math.sin(r),v=Math.cos(r);return t[0]=s*p*v-a*c*_,t[1]=a*c*v+s*p*_,t[2]=a*p*_-s*c*v,t[3]=a*p*v+s*c*_,t},_r.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},_r.setAxes=_r.sqlerp=_r.rotationTo=_r.equals=_r.exactEquals=_r.normalize=_r.sqrLen=_r.squaredLength=_r.len=_r.length=_r.lerp=_r.dot=_r.scale=_r.mul=_r.add=_r.set=_r.copy=_r.fromValues=_r.clone=void 0;var Au=Uh(go),Hp=Uh(zn),Uc=Uh(Mr),ql=Uh(Fr);function jc(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(jc=function(r){return r?i:e})(t)}function Uh(t,e){if(!e&&t&&t.__esModule)return t;if(t===null||Vd(t)!=="object"&&typeof t!="function")return{default:t};var i=jc(e);if(i&&i.has(t))return i.get(t);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in t)if(s!=="default"&&Object.prototype.hasOwnProperty.call(t,s)){var a=n?Object.getOwnPropertyDescriptor(t,s):null;a&&(a.get||a.set)?Object.defineProperty(r,s,a):r[s]=t[s]}return r.default=t,i&&i.set(t,r),r}function Nd(){var t=new Au.ARRAY_TYPE(4);return Au.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function p0(t,e,i){i*=.5;var r=Math.sin(i);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(i),t}function m0(t,e,i){var r=e[0],n=e[1],s=e[2],a=e[3],c=i[0],p=i[1],_=i[2],v=i[3];return t[0]=r*v+a*c+n*_-s*p,t[1]=n*v+a*p+s*c-r*_,t[2]=s*v+a*_+r*p-n*c,t[3]=a*v-r*c-n*p-s*_,t}function Wp(t,e){var i=e[0],r=e[1],n=e[2],s=e[3],a=Math.sqrt(i*i+r*r+n*n),c=Math.exp(s),p=a>0?c*Math.sin(a)/a:0;return t[0]=i*p,t[1]=r*p,t[2]=n*p,t[3]=c*Math.cos(a),t}function $p(t,e){var i=e[0],r=e[1],n=e[2],s=e[3],a=Math.sqrt(i*i+r*r+n*n),c=a>0?Math.atan2(a,s)/a:0;return t[0]=i*c,t[1]=r*c,t[2]=n*c,t[3]=.5*Math.log(i*i+r*r+n*n+s*s),t}function jh(t,e,i,r){var n,s,a,c,p,_=e[0],v=e[1],E=e[2],C=e[3],B=i[0],O=i[1],G=i[2],q=i[3];return(s=_*B+v*O+E*G+C*q)<0&&(s=-s,B=-B,O=-O,G=-G,q=-q),1-s>Au.EPSILON?(n=Math.acos(s),a=Math.sin(n),c=Math.sin((1-r)*n)/a,p=Math.sin(r*n)/a):(c=1-r,p=r),t[0]=c*_+p*B,t[1]=c*v+p*O,t[2]=c*E+p*G,t[3]=c*C+p*q,t}function Pu(t,e){var i,r=e[0]+e[4]+e[8];if(r>0)i=Math.sqrt(r+1),t[3]=.5*i,t[0]=(e[5]-e[7])*(i=.5/i),t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{var n=0;e[4]>e[0]&&(n=1),e[8]>e[3*n+n]&&(n=2);var s=(n+1)%3,a=(n+2)%3;i=Math.sqrt(e[3*n+n]-e[3*s+s]-e[3*a+a]+1),t[n]=.5*i,t[3]=(e[3*s+a]-e[3*a+s])*(i=.5/i),t[s]=(e[3*s+n]+e[3*n+s])*i,t[a]=(e[3*a+n]+e[3*n+a])*i}return t}_r.clone=ql.clone,_r.fromValues=ql.fromValues,_r.copy=ql.copy,_r.set=ql.set,_r.add=ql.add,_r.mul=m0;var _0=ql.scale;_r.scale=_0;var Gh=ql.dot;_r.dot=Gh,_r.lerp=ql.lerp;var g0=ql.length;_r.length=g0,_r.len=g0;var Zh=ql.squaredLength;_r.squaredLength=Zh,_r.sqrLen=Zh;var Ju=ql.normalize;_r.normalize=Ju,_r.exactEquals=ql.exactEquals,_r.equals=ql.equals;var Ql,Xp,Yp,Y_=(Ql=Uc.create(),Xp=Uc.fromValues(1,0,0),Yp=Uc.fromValues(0,1,0),function(t,e,i){var r=Uc.dot(e,i);return r<-.999999?(Uc.cross(Ql,Xp,e),Uc.len(Ql)<1e-6&&Uc.cross(Ql,Yp,e),Uc.normalize(Ql,Ql),p0(t,Ql,Math.PI),t):r>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(Uc.cross(Ql,e,i),t[0]=Ql[0],t[1]=Ql[1],t[2]=Ql[2],t[3]=1+r,Ju(t,t))});_r.rotationTo=Y_;var y0,cu,Sa=(y0=Nd(),cu=Nd(),function(t,e,i,r,n,s){return jh(y0,e,n,s),jh(cu,i,r,s),jh(t,y0,cu,2*s*(1-s)),t});_r.sqlerp=Sa;var Ia,x0=(Ia=Hp.create(),function(t,e,i,r){return Ia[0]=i[0],Ia[3]=i[1],Ia[6]=i[2],Ia[1]=r[0],Ia[4]=r[1],Ia[7]=r[2],Ia[2]=-e[0],Ia[5]=-e[1],Ia[8]=-e[2],Ju(t,Pu(t,Ia))});_r.setAxes=x0;var Qr={};function Ud(t){return Ud=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ud(t)}Object.defineProperty(Qr,"__esModule",{value:!0}),Qr.create=function(){var t=new Wa.ARRAY_TYPE(8);return Wa.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t},Qr.clone=function(t){var e=new Wa.ARRAY_TYPE(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e},Qr.fromValues=function(t,e,i,r,n,s,a,c){var p=new Wa.ARRAY_TYPE(8);return p[0]=t,p[1]=e,p[2]=i,p[3]=r,p[4]=n,p[5]=s,p[6]=a,p[7]=c,p},Qr.fromRotationTranslationValues=function(t,e,i,r,n,s,a){var c=new Wa.ARRAY_TYPE(8);c[0]=t,c[1]=e,c[2]=i,c[3]=r;var p=.5*n,_=.5*s,v=.5*a;return c[4]=p*r+_*i-v*e,c[5]=_*r+v*t-p*i,c[6]=v*r+p*e-_*t,c[7]=-p*t-_*e-v*i,c},Qr.fromRotationTranslation=T0,Qr.fromTranslation=function(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t},Qr.fromRotation=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},Qr.fromMat4=function(t,e){var i=Gc.create();v0.getRotation(i,e);var r=new Wa.ARRAY_TYPE(3);return v0.getTranslation(r,e),T0(t,i,r),t},Qr.copy=jd,Qr.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},Qr.set=function(t,e,i,r,n,s,a,c,p){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t[4]=s,t[5]=a,t[6]=c,t[7]=p,t},Qr.getDual=function(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t},Qr.setDual=function(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t},Qr.getTranslation=function(t,e){var i=e[4],r=e[5],n=e[6],s=e[7],a=-e[0],c=-e[1],p=-e[2],_=e[3];return t[0]=2*(i*_+s*a+r*p-n*c),t[1]=2*(r*_+s*c+n*a-i*p),t[2]=2*(n*_+s*p+i*c-r*a),t},Qr.translate=function(t,e,i){var r=e[0],n=e[1],s=e[2],a=e[3],c=.5*i[0],p=.5*i[1],_=.5*i[2],v=e[4],E=e[5],C=e[6],B=e[7];return t[0]=r,t[1]=n,t[2]=s,t[3]=a,t[4]=a*c+n*_-s*p+v,t[5]=a*p+s*c-r*_+E,t[6]=a*_+r*p-n*c+C,t[7]=-r*c-n*p-s*_+B,t},Qr.rotateX=function(t,e,i){var r=-e[0],n=-e[1],s=-e[2],a=e[3],c=e[4],p=e[5],_=e[6],v=e[7],E=c*a+v*r+p*s-_*n,C=p*a+v*n+_*r-c*s,B=_*a+v*s+c*n-p*r,O=v*a-c*r-p*n-_*s;return Gc.rotateX(t,e,i),t[4]=E*(a=t[3])+O*(r=t[0])+C*(s=t[2])-B*(n=t[1]),t[5]=C*a+O*n+B*r-E*s,t[6]=B*a+O*s+E*n-C*r,t[7]=O*a-E*r-C*n-B*s,t},Qr.rotateY=function(t,e,i){var r=-e[0],n=-e[1],s=-e[2],a=e[3],c=e[4],p=e[5],_=e[6],v=e[7],E=c*a+v*r+p*s-_*n,C=p*a+v*n+_*r-c*s,B=_*a+v*s+c*n-p*r,O=v*a-c*r-p*n-_*s;return Gc.rotateY(t,e,i),t[4]=E*(a=t[3])+O*(r=t[0])+C*(s=t[2])-B*(n=t[1]),t[5]=C*a+O*n+B*r-E*s,t[6]=B*a+O*s+E*n-C*r,t[7]=O*a-E*r-C*n-B*s,t},Qr.rotateZ=function(t,e,i){var r=-e[0],n=-e[1],s=-e[2],a=e[3],c=e[4],p=e[5],_=e[6],v=e[7],E=c*a+v*r+p*s-_*n,C=p*a+v*n+_*r-c*s,B=_*a+v*s+c*n-p*r,O=v*a-c*r-p*n-_*s;return Gc.rotateZ(t,e,i),t[4]=E*(a=t[3])+O*(r=t[0])+C*(s=t[2])-B*(n=t[1]),t[5]=C*a+O*n+B*r-E*s,t[6]=B*a+O*s+E*n-C*r,t[7]=O*a-E*r-C*n-B*s,t},Qr.rotateByQuatAppend=function(t,e,i){var r=i[0],n=i[1],s=i[2],a=i[3],c=e[0],p=e[1],_=e[2],v=e[3];return t[0]=c*a+v*r+p*s-_*n,t[1]=p*a+v*n+_*r-c*s,t[2]=_*a+v*s+c*n-p*r,t[3]=v*a-c*r-p*n-_*s,t[4]=(c=e[4])*a+(v=e[7])*r+(p=e[5])*s-(_=e[6])*n,t[5]=p*a+v*n+_*r-c*s,t[6]=_*a+v*s+c*n-p*r,t[7]=v*a-c*r-p*n-_*s,t},Qr.rotateByQuatPrepend=function(t,e,i){var r=e[0],n=e[1],s=e[2],a=e[3],c=i[0],p=i[1],_=i[2],v=i[3];return t[0]=r*v+a*c+n*_-s*p,t[1]=n*v+a*p+s*c-r*_,t[2]=s*v+a*_+r*p-n*c,t[3]=a*v-r*c-n*p-s*_,t[4]=r*(v=i[7])+a*(c=i[4])+n*(_=i[6])-s*(p=i[5]),t[5]=n*v+a*p+s*c-r*_,t[6]=s*v+a*_+r*p-n*c,t[7]=a*v-r*c-n*p-s*_,t},Qr.rotateAroundAxis=function(t,e,i,r){if(Math.abs(r)<Wa.EPSILON)return jd(t,e);var n=Math.hypot(i[0],i[1],i[2]);r*=.5;var s=Math.sin(r),a=s*i[0]/n,c=s*i[1]/n,p=s*i[2]/n,_=Math.cos(r),v=e[0],E=e[1],C=e[2],B=e[3];t[0]=v*_+B*a+E*p-C*c,t[1]=E*_+B*c+C*a-v*p,t[2]=C*_+B*p+v*c-E*a,t[3]=B*_-v*a-E*c-C*p;var O=e[4],G=e[5],q=e[6],$=e[7];return t[4]=O*_+$*a+G*p-q*c,t[5]=G*_+$*c+q*a-O*p,t[6]=q*_+$*p+O*c-G*a,t[7]=$*_-O*a-G*c-q*p,t},Qr.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t},Qr.multiply=Gd,Qr.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t},Qr.lerp=function(t,e,i,r){var n=1-r;return E0(e,i)<0&&(r=-r),t[0]=e[0]*n+i[0]*r,t[1]=e[1]*n+i[1]*r,t[2]=e[2]*n+i[2]*r,t[3]=e[3]*n+i[3]*r,t[4]=e[4]*n+i[4]*r,t[5]=e[5]*n+i[5]*r,t[6]=e[6]*n+i[6]*r,t[7]=e[7]*n+i[7]*r,t},Qr.invert=function(t,e){var i=th(e);return t[0]=-e[0]/i,t[1]=-e[1]/i,t[2]=-e[2]/i,t[3]=e[3]/i,t[4]=-e[4]/i,t[5]=-e[5]/i,t[6]=-e[6]/i,t[7]=e[7]/i,t},Qr.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t},Qr.normalize=function(t,e){var i=th(e);if(i>0){i=Math.sqrt(i);var r=e[0]/i,n=e[1]/i,s=e[2]/i,a=e[3]/i,c=e[4],p=e[5],_=e[6],v=e[7],E=r*c+n*p+s*_+a*v;t[0]=r,t[1]=n,t[2]=s,t[3]=a,t[4]=(c-r*E)/i,t[5]=(p-n*E)/i,t[6]=(_-s*E)/i,t[7]=(v-a*E)/i}return t},Qr.str=function(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"},Qr.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]},Qr.equals=function(t,e){var i=t[0],r=t[1],n=t[2],s=t[3],a=t[4],c=t[5],p=t[6],_=t[7],v=e[0],E=e[1],C=e[2],B=e[3],O=e[4],G=e[5],q=e[6],$=e[7];return Math.abs(i-v)<=Wa.EPSILON*Math.max(1,Math.abs(i),Math.abs(v))&&Math.abs(r-E)<=Wa.EPSILON*Math.max(1,Math.abs(r),Math.abs(E))&&Math.abs(n-C)<=Wa.EPSILON*Math.max(1,Math.abs(n),Math.abs(C))&&Math.abs(s-B)<=Wa.EPSILON*Math.max(1,Math.abs(s),Math.abs(B))&&Math.abs(a-O)<=Wa.EPSILON*Math.max(1,Math.abs(a),Math.abs(O))&&Math.abs(c-G)<=Wa.EPSILON*Math.max(1,Math.abs(c),Math.abs(G))&&Math.abs(p-q)<=Wa.EPSILON*Math.max(1,Math.abs(p),Math.abs(q))&&Math.abs(_-$)<=Wa.EPSILON*Math.max(1,Math.abs(_),Math.abs($))},Qr.sqrLen=Qr.squaredLength=Qr.len=Qr.length=Qr.dot=Qr.mul=Qr.setReal=Qr.getReal=void 0;var Wa=w0(go),Gc=w0(_r),v0=w0(Er);function b0(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(b0=function(r){return r?i:e})(t)}function w0(t,e){if(!e&&t&&t.__esModule)return t;if(t===null||Ud(t)!=="object"&&typeof t!="function")return{default:t};var i=b0(e);if(i&&i.has(t))return i.get(t);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in t)if(s!=="default"&&Object.prototype.hasOwnProperty.call(t,s)){var a=n?Object.getOwnPropertyDescriptor(t,s):null;a&&(a.get||a.set)?Object.defineProperty(r,s,a):r[s]=t[s]}return r.default=t,i&&i.set(t,r),r}function T0(t,e,i){var r=.5*i[0],n=.5*i[1],s=.5*i[2],a=e[0],c=e[1],p=e[2],_=e[3];return t[0]=a,t[1]=c,t[2]=p,t[3]=_,t[4]=r*_+n*p-s*c,t[5]=n*_+s*a-r*p,t[6]=s*_+r*c-n*a,t[7]=-r*a-n*c-s*p,t}function jd(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function Gd(t,e,i){var r=e[0],n=e[1],s=e[2],a=e[3],c=i[4],p=i[5],_=i[6],v=i[7],E=e[4],C=e[5],B=e[6],O=e[7],G=i[0],q=i[1],$=i[2],J=i[3];return t[0]=r*J+a*G+n*$-s*q,t[1]=n*J+a*q+s*G-r*$,t[2]=s*J+a*$+r*q-n*G,t[3]=a*J-r*G-n*q-s*$,t[4]=r*v+a*c+n*_-s*p+E*J+O*G+C*$-B*q,t[5]=n*v+a*p+s*c-r*_+C*J+O*q+B*G-E*$,t[6]=s*v+a*_+r*p-n*c+B*J+O*$+E*q-C*G,t[7]=a*v-r*c-n*p-s*_+O*J-E*G-C*q-B*$,t}Qr.getReal=Gc.copy,Qr.setReal=Gc.copy,Qr.mul=Gd;var E0=Gc.dot;Qr.dot=E0;var eh=Gc.length;Qr.length=eh,Qr.len=eh;var th=Gc.squaredLength;Qr.squaredLength=th,Qr.sqrLen=th;var Cr={};function qh(t){return qh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},qh(t)}Object.defineProperty(Cr,"__esModule",{value:!0}),Cr.create=Zd,Cr.clone=function(t){var e=new mc.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},Cr.fromValues=function(t,e){var i=new mc.ARRAY_TYPE(2);return i[0]=t,i[1]=e,i},Cr.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},Cr.set=function(t,e,i){return t[0]=e,t[1]=i,t},Cr.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t},Cr.subtract=qd,Cr.multiply=Qd,Cr.divide=Kp,Cr.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},Cr.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},Cr.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t},Cr.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t},Cr.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},Cr.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t},Cr.scaleAndAdd=function(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t},Cr.distance=d,Cr.squaredDistance=A,Cr.length=m,Cr.squaredLength=w,Cr.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},Cr.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},Cr.normalize=function(t,e){var i=e[0],r=e[1],n=i*i+r*r;return n>0&&(n=1/Math.sqrt(n)),t[0]=e[0]*n,t[1]=e[1]*n,t},Cr.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},Cr.cross=function(t,e,i){var r=e[0]*i[1]-e[1]*i[0];return t[0]=t[1]=0,t[2]=r,t},Cr.lerp=function(t,e,i,r){var n=e[0],s=e[1];return t[0]=n+r*(i[0]-n),t[1]=s+r*(i[1]-s),t},Cr.random=function(t,e){e=e||1;var i=2*mc.RANDOM()*Math.PI;return t[0]=Math.cos(i)*e,t[1]=Math.sin(i)*e,t},Cr.transformMat2=function(t,e,i){var r=e[0],n=e[1];return t[0]=i[0]*r+i[2]*n,t[1]=i[1]*r+i[3]*n,t},Cr.transformMat2d=function(t,e,i){var r=e[0],n=e[1];return t[0]=i[0]*r+i[2]*n+i[4],t[1]=i[1]*r+i[3]*n+i[5],t},Cr.transformMat3=function(t,e,i){var r=e[0],n=e[1];return t[0]=i[0]*r+i[3]*n+i[6],t[1]=i[1]*r+i[4]*n+i[7],t},Cr.transformMat4=function(t,e,i){var r=e[0],n=e[1];return t[0]=i[0]*r+i[4]*n+i[12],t[1]=i[1]*r+i[5]*n+i[13],t},Cr.rotate=function(t,e,i,r){var n=e[0]-i[0],s=e[1]-i[1],a=Math.sin(r),c=Math.cos(r);return t[0]=n*c-s*a+i[0],t[1]=n*a+s*c+i[1],t},Cr.angle=function(t,e){var i=t[0],r=t[1],n=e[0],s=e[1],a=Math.sqrt(i*i+r*r)*Math.sqrt(n*n+s*s);return Math.acos(Math.min(Math.max(a&&(i*n+r*s)/a,-1),1))},Cr.zero=function(t){return t[0]=0,t[1]=0,t},Cr.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},Cr.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},Cr.equals=function(t,e){var i=t[0],r=t[1],n=e[0],s=e[1];return Math.abs(i-n)<=mc.EPSILON*Math.max(1,Math.abs(i),Math.abs(n))&&Math.abs(r-s)<=mc.EPSILON*Math.max(1,Math.abs(r),Math.abs(s))},Cr.forEach=Cr.sqrLen=Cr.sqrDist=Cr.dist=Cr.div=Cr.mul=Cr.sub=Cr.len=void 0;var mc=function(t,e){if(t&&t.__esModule)return t;if(t===null||qh(t)!=="object"&&typeof t!="function")return{default:t};var i=ih(void 0);if(i&&i.has(t))return i.get(t);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in t)if(s!=="default"&&Object.prototype.hasOwnProperty.call(t,s)){var a=n?Object.getOwnPropertyDescriptor(t,s):null;a&&(a.get||a.set)?Object.defineProperty(r,s,a):r[s]=t[s]}return r.default=t,i&&i.set(t,r),r}(go);function ih(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(ih=function(r){return r?i:e})(t)}function Zd(){var t=new mc.ARRAY_TYPE(2);return mc.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0),t}function qd(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t}function Qd(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t}function Kp(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t}function d(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1])}function A(t,e){var i=e[0]-t[0],r=e[1]-t[1];return i*i+r*r}function m(t){return Math.hypot(t[0],t[1])}function w(t){var e=t[0],i=t[1];return e*e+i*i}Cr.len=m,Cr.sub=qd,Cr.mul=Qd,Cr.div=Kp,Cr.dist=d,Cr.sqrDist=A,Cr.sqrLen=w;var D=function(){var t=Zd();return function(e,i,r,n,s,a){var c,p;for(i||(i=2),r||(r=0),p=n?Math.min(n*i+r,e.length):e.length,c=r;c<p;c+=i)t[0]=e[c],t[1]=e[c+1],s(t,t,a),e[c]=t[0],e[c+1]=t[1];return e}}();function N(t){return N=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},N(t)}Cr.forEach=D,Object.defineProperty(qn,"__esModule",{value:!0});var U=qn.vec4=_e=qn.vec3=qn.vec2=qn.quat2=ot=qn.quat=ce=qn.mat4=Ee=qn.mat3=qn.mat2d=ae=qn.mat2=qn.glMatrix=void 0,X=Ci(go);qn.glMatrix=X;var ee=Ci(Qn),ae=qn.mat2=ee,de=Ci(xs);qn.mat2d=de;var ge=Ci(zn),Ee=qn.mat3=ge,Oe=Ci(Er),ce=qn.mat4=Oe,et=Ci(_r),ot=qn.quat=et,pt=Ci(Qr);qn.quat2=pt;var Ct=Ci(Cr);qn.vec2=Ct;var bt=Ci(Mr),_e=qn.vec3=bt,Ut=Ci(Fr);function li(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(li=function(r){return r?i:e})(t)}function Ci(t,e){if(!e&&t&&t.__esModule)return t;if(t===null||N(t)!=="object"&&typeof t!="function")return{default:t};var i=li(e);if(i&&i.has(t))return i.get(t);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in t)if(s!=="default"&&Object.prototype.hasOwnProperty.call(t,s)){var a=n?Object.getOwnPropertyDescriptor(t,s):null;a&&(a.get||a.set)?Object.defineProperty(r,s,a):r[s]=t[s]}return r.default=t,i&&i.set(t,r),r}U=qn.vec4=Ut;const nr=un([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Ri}=nr,Pi=un([{name:"a_pos_3",components:3,type:"Int16"}]);var wi=un([{name:"a_pos",type:"Int16",components:2}]),Wi={};(function(t,e){(function(i){function r(s,a,c){var p=n(256*s,256*(a=Math.pow(2,c)-a-1),c),_=n(256*(s+1),256*(a+1),c);return p[0]+","+p[1]+","+_[0]+","+_[1]}function n(s,a,c){var p=2*Math.PI*6378137/256/Math.pow(2,c);return[s*p-2*Math.PI*6378137/2,a*p-2*Math.PI*6378137/2]}i.getURL=function(s,a,c,p,_,v){return v=v||{},s+"?"+["bbox="+r(c,p,_),"format="+(v.format||"image/png"),"service="+(v.service||"WMS"),"version="+(v.version||"1.1.1"),"request="+(v.request||"GetMap"),"srs="+(v.srs||"EPSG:3857"),"width="+(v.width||256),"height="+(v.height||256),"layers="+a].join("&")},i.getTileBBox=r,i.getMercCoords=n,Object.defineProperty(i,"__esModule",{value:!0})})(e)})(0,Wi);var ki=Wi;class ci{constructor(e,i,r){this.z=e,this.x=i,this.y=r,this.key=Wr(0,e,e,i,r)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i){const r=ki.getTileBBox(this.x,this.y,this.z),n=function(s,a,c){let p,_="";for(let v=s;v>0;v--)p=1<<v-1,_+=(a&p?1:0)+(c&p?2:0);return _}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",n).replace("{bbox-epsg-3857}",r)}toString(){return`${this.z}/${this.x}/${this.y}`}}class fr{constructor(e,i){this.wrap=e,this.canonical=i,this.key=Wr(e,i.z,i.z,i.x,i.y)}}class fi{constructor(e,i,r,n,s){this.overscaledZ=e,this.wrap=i,this.canonical=new ci(r,+n,+s),this.key=i===0&&e===r?this.canonical.key:Wr(i,e,r,n,s)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new fi(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new fi(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return Wr(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const r=this.canonical.z-e;return Wr(this.wrap*+i,e,e,this.canonical.x>>r,this.canonical.y>>r)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new fi(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,r=2*this.canonical.x,n=2*this.canonical.y;return[new fi(i,this.wrap,i,r,n),new fi(i,this.wrap,i,r+1,n),new fi(i,this.wrap,i,r,n+1),new fi(i,this.wrap,i,r+1,n+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new fi(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new fi(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new fr(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Wr(t,e,i,r,n){const s=1<<Math.min(i,22);let a=s*(n%s)+r%s;return t&&i<22&&(a+=s*s*((t<0?-2*t-1:2*t)%(1<<2*(22-i)))),16*(32*a+i)+(e-i)}const vs=[t=>{let e=t.canonical.x-1,i=t.wrap;return e<0&&(e=(1<<t.canonical.z)-1,i--),new fi(t.overscaledZ,i,t.canonical.z,e,t.canonical.y)},t=>{let e=t.canonical.x+1,i=t.wrap;return e===1<<t.canonical.z&&(e=0,i++),new fi(t.overscaledZ,i,t.canonical.z,e,t.canonical.y)},t=>new fi(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,(t.canonical.y===0?1<<t.canonical.z:t.canonical.y)-1),t=>new fi(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y===(1<<t.canonical.z)-1?0:t.canonical.y+1)];Ii(ci,"CanonicalTileID"),Ii(fi,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});class ps{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,r){const n=_e.dot(i,this.dir);if(Math.abs(n)<1e-6)return!1;const s=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/n;return r[0]=this.pos[0]+this.dir[0]*s,r[1]=this.pos[1]+this.dir[1]*s,r[2]=this.pos[2]+this.dir[2]*s,!0}closestPointOnSphere(e,i,r){if(_e.equals(this.pos,e)||i===0)return r[0]=r[1]=r[2]=0,!1;const[n,s,a]=this.dir,c=this.pos[0]-e[0],p=this.pos[1]-e[1],_=this.pos[2]-e[2],v=n*n+s*s+a*a,E=2*(c*n+p*s+_*a),C=E*E-4*v*(c*c+p*p+_*_-i*i);if(C<0){const B=Math.max(-E/2,0),O=c+n*B,G=p+s*B,q=_+a*B,$=Math.hypot(O,G,q);return r[0]=O*i/$,r[1]=G*i/$,r[2]=q*i/$,!1}{const B=(-E-Math.sqrt(C))/(2*v);if(B<0){const O=Math.hypot(c,p,_);return r[0]=c*i/O,r[1]=p*i/O,r[2]=_*i/O,!1}return r[0]=c+n*B,r[1]=p+s*B,r[2]=_+a*B,!0}}}class yo{constructor(e,i,r,n,s){this.TL=e,this.TR=i,this.BR=r,this.BL=n,this.horizon=s}static fromInvProjectionMatrix(e,i,r){const n=[-1,1,1],s=[1,1,1],a=[1,-1,1],c=[-1,-1,1],p=_e.transformMat4(n,n,e),_=_e.transformMat4(s,s,e),v=_e.transformMat4(a,a,e),E=_e.transformMat4(c,c,e);return new yo(p,_,v,E,i/r)}}function Ca(t,e,i){let r=1/0,n=-1/0;const s=[];for(const a of t){_e.sub(s,a,e);const c=_e.dot(s,i);r=Math.min(r,c),n=Math.max(n,c)}return[r,n]}function $a(t,e){let i=!0;for(let r=0;r<t.planes.length;r++){const n=t.planes[r];let s=0;for(let a=0;a<e.length;a++)s+=_e.dot(n,e[a])+n[3]>=0;if(s===0)return 0;s!==e.length&&(i=!1)}return i?2:1}function xo(t,e){for(const i of t.projections){const r=Ca(e,t.points[0],i.axis);if(i.projection[1]<r[0]||i.projection[0]>r[1])return 0}return 1}function Ko(t,e){let i=0;const r=[0,0,0,0];for(let n=0;n<t.length;n++)r[0]=t[n][0],r[1]=t[n][1],r[2]=t[n][2],r[3]=1,U.dot(r,e)>=0&&i++;return i}class Gs{constructor(e,i){this.points=e||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=$r.fromPoints(this.points),this.projections=[],this.frustumEdges=[_e.sub([],this.points[2],this.points[3]),_e.sub([],this.points[0],this.points[3]),_e.sub([],this.points[4],this.points[0]),_e.sub([],this.points[5],this.points[1]),_e.sub([],this.points[6],this.points[2]),_e.sub([],this.points[7],this.points[3])];for(const r of this.frustumEdges){const n=[0,-r[2],r[1]],s=[r[2],0,-r[0]];this.projections.push({axis:n,projection:Ca(this.points,this.points[0],n)}),this.projections.push({axis:s,projection:Ca(this.points,this.points[0],s)})}}static fromInvProjectionMatrix(e,i,r,n){const s=Math.pow(2,r),a=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(_=>{const v=U.transformMat4([],_,e),E=1/v[3]/i*s;return U.mul(v,v,[E,E,n?1/v[3]:E,E])}),c=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(_=>{const v=_e.sub([],a[_[0]],a[_[1]]),E=_e.sub([],a[_[2]],a[_[1]]),C=_e.normalize([],_e.cross([],v,E)),B=-_e.dot(C,a[_[1]]);return C.concat(B)}),p=[];for(let _=0;_<a.length;_++)p.push([a[_][0],a[_][1],a[_][2]]);return new Gs(p,c)}intersectsPrecise(e,i,r){for(let n=0;n<i.length;n++)if(!Ko(e,i[n]))return 0;for(let n=0;n<this.planes.length;n++)if(!Ko(e,this.planes[n]))return 0;for(const n of r)for(const s of this.frustumEdges){const a=_e.cross([],n,s),c=_e.length(a);if(c===0)continue;_e.scale(a,a,1/c);const p=Ca(this.points,this.points[0],a),_=Ca(e,this.points[0],a);if(p[0]>_[1]||_[0]>p[1])return 0}return 1}}class $r{static fromPoints(e){const i=[1/0,1/0,1/0],r=[-1/0,-1/0,-1/0];for(const n of e)_e.min(i,i,n),_e.max(r,r,n);return new $r(i,r)}static fromTileIdAndHeight(e,i,r){const n=1<<e.canonical.z,s=e.canonical.x,a=e.canonical.y;return new $r([s/n,a/n,i],[(s+1)/n,(a+1)/n,r])}static applyTransform(e,i){const r=e.getCorners();for(let n=0;n<r.length;++n)_e.transformMat4(r[n],r[n],i);return $r.fromPoints(r)}static projectAabbCorners(e,i){const r=e.getCorners();for(let n=0;n<r.length;++n)_e.transformMat4(r[n],r[n],i);return r}constructor(e,i){this.min=e,this.max=i,this.center=_e.scale([],_e.add([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],r=_e.clone(this.min),n=_e.clone(this.max);for(let s=0;s<i.length;s++)r[s]=i[s]?this.min[s]:this.center[s],n[s]=i[s]?this.center[s]:this.max[s];return n[2]=this.max[2],new $r(r,n)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?$a(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?$a(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,i){return i||this.intersects(e)?xo(e,this.getCorners()):0}intersectsPreciseFlat(e,i){return i||this.intersectsFlat(e)?xo(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let i=0;i<3;++i)if(this.min[i]>e.max[i]||e.min[i]>this.max[i])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e.min[i]),this.max[i]=Math.max(this.max[i],e.max[i])}encapsulatePoint(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e[i]),this.max[i]=Math.max(this.max[i],e[i])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}Ii($r,"Aabb");const Jo=5,Cs=6,Fn=Mt/Math.PI/2,Xa=16383,Vo=64,ua=[Vo,32,16],Zs=-Fn,qs=Fn,No=[new $r([Zs,Zs,Zs],[qs,qs,qs]),new $r([Zs,Zs,Zs],[0,0,qs]),new $r([0,Zs,Zs],[qs,0,qs]),new $r([Zs,0,Zs],[0,qs,qs]),new $r([0,0,Zs],[qs,qs,qs])];function hn(t){return t*Fn/Pa}function ka(t,e,i,r=!0){const n=_e.scale([],t._camera.position,t.worldSize),s=[e,i,1,1];U.transformMat4(s,s,t.pixelMatrixInverse),U.scale(s,s,1/s[3]);const a=_e.sub([],s,n),c=_e.normalize([],a),p=t.globeMatrix,_=[p[12],p[13],p[14]],v=_e.sub([],_,n),E=_e.length(v),C=_e.normalize([],v),B=t.worldSize/(2*Math.PI),O=_e.dot(C,c),G=Math.asin(B/E);if(G<Math.acos(O)){if(!r)return null;const Ne=[],je=[];_e.scale(Ne,c,E/O),_e.normalize(je,_e.sub(je,Ne,v)),_e.normalize(c,_e.add(c,v,_e.scale(c,je,Math.tan(G)*E)))}const q=[];new ps(n,c).closestPointOnSphere(_,B,q);const $=_e.normalize([],_n(p,0)),J=_e.normalize([],_n(p,1)),ie=_e.normalize([],_n(p,2)),re=_e.dot($,q),te=_e.dot(J,q),se=_e.dot(ie,q),he=Ir(Math.asin(-te/B));let ve=Ir(Math.atan2(re,se));ve=t.center.lng+function(Ne,je){const Ye=(je-Ne+180)%360-180;return Ye<-180?Ye+360:Ye}(t.center.lng,ve);const be=jo(ve),Ce=hi(ea(he),0,1);return new Xr(be,Ce)}class Da{constructor(e,i,r){this.a=_e.sub([],e,r),this.b=_e.sub([],i,r),this.center=r;const n=_e.normalize([],this.a),s=_e.normalize([],this.b);this.angle=Math.acos(_e.dot(n,s))}}function vo(t,e){if(t.angle===0)return null;let i;return i=t.a[e]===0?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),i<0||i>1?null:function(r,n,s,a){const c=Math.sin(s);return r*(Math.sin((1-a)*s)/c)+n*(Math.sin(a*s)/c)}(t.a[e],t.b[e],t.angle,hi(i,0,1))+t.center[e]}function lo(t){if(t.z<=1)return No[t.z+2*t.y+t.x];const e=Ya(hl(t));return $r.fromPoints(e)}function ha(t,e,i){return _e.scale(t,t,1-i),_e.scaleAndAdd(t,t,e,i)}function bA(t,e){const i=Uo(e.zoom);if(i===0)return lo(t);const r=hl(t),n=Ya(r),s=jo(r.getWest())*e.worldSize,a=jo(r.getEast())*e.worldSize,c=ea(r.getNorth())*e.worldSize,p=ea(r.getSouth())*e.worldSize,_=[s,c,0],v=[a,c,0],E=[s,p,0],C=[a,p,0],B=ce.invert([],e.globeMatrix);return _e.transformMat4(_,_,B),_e.transformMat4(v,v,B),_e.transformMat4(E,E,B),_e.transformMat4(C,C,B),n[0]=ha(n[0],E,i),n[1]=ha(n[1],C,i),n[2]=ha(n[2],v,i),n[3]=ha(n[3],_,i),$r.fromPoints(n)}function _c(t,e,i){for(const r of t)_e.transformMat4(r,r,e),_e.scale(r,r,i)}function Hl(t,e,i,r){const n=e/t.worldSize,s=t.globeMatrix;if(i.z<=1){const be=lo(i).getCorners();return _c(be,s,n),$r.fromPoints(be)}const a=hl(i,r),c=Ya(a);_c(c,s,n);const p=Number.MAX_VALUE,_=[-p,-p,-p],v=[p,p,p];if(a.contains(t.center)){for(const Ne of c)_e.min(v,v,Ne),_e.max(_,_,Ne);_[2]=0;const be=t.point,Ce=[be.x*n,be.y*n,0];return _e.min(v,v,Ce),_e.max(_,_,Ce),new $r(v,_)}const E=[s[12]*n,s[13]*n,s[14]*n],C=a.getCenter(),B=hi(t.center.lat,-Ks,Ks),O=hi(C.lat,-Ks,Ks),G=jo(t.center.lng),q=ea(B);let $=G-jo(C.lng);const J=q-ea(O);$>.5?$-=1:$<-.5&&($+=1);let ie=0;if(Math.abs($)>Math.abs(J))ie=$>=0?1:3;else{ie=J>=0?0:2;const be=[s[4]*n,s[5]*n,s[6]*n],Ce=-Math.sin(Li(J>=0?a.getSouth():a.getNorth()))*Fn;_e.scaleAndAdd(E,E,be,Ce)}const re=c[ie],te=c[(ie+1)%4],se=new Da(re,te,E),he=[vo(se,0)||re[0],vo(se,1)||re[1],vo(se,2)||re[2]],ve=Uo(t.zoom);if(ve>0){const be=function({x:Ne,y:je,z:Ye},Re,rt,lt,vt){const it=1/(1<<Ye);let at=Ne*it,Tt=at+it,It=je*it,St=It+it,Lt=0;const Ot=(at+Tt)/2-lt;return Ot>.5?Lt=-1:Ot<-.5&&(Lt=1),at=((at+Lt)*Re-(lt*=Re))*rt+lt,Tt=((Tt+Lt)*Re-lt)*rt+lt,It=(It*Re-(vt*=Re))*rt+vt,St=(St*Re-vt)*rt+vt,[[at,St,0],[Tt,St,0],[Tt,It,0],[at,It,0]]}(i,e,t._pixelsPerMercatorPixel,G,q);for(let Ne=0;Ne<c.length;Ne++)ha(c[Ne],be[Ne],ve);const Ce=_e.add([],be[ie],be[(ie+1)%4]);_e.scale(Ce,Ce,.5),ha(he,Ce,ve)}for(const be of c)_e.min(v,v,be),_e.max(_,_,be);return v[2]=Math.min(re[2],te[2]),_e.min(v,v,he),_e.max(_,_,he),new $r(v,_)}function hl({x:t,y:e,z:i},r=!1){const n=1/(1<<i),s=new rr(TA(t*n),e===(1<<i)-1&&r?-90:So((e+1)*n)),a=new rr(TA((t+1)*n),e===0&&r?90:So(e*n));return new Ml(s,a)}function Ya(t){const e=Li(t.getNorth()),i=Li(t.getSouth()),r=Math.cos(e),n=Math.cos(i),s=Math.sin(e),a=Math.sin(i),c=t.getWest(),p=t.getEast();return[Wl(n,a,c),Wl(n,a,p),Wl(r,s,p),Wl(r,s,c)]}function Wl(t,e,i,r=Fn){return i=Li(i),[t*Math.sin(i)*r,-e*r,t*Math.cos(i)*r]}function da(t,e,i){return Wl(Math.cos(Li(t)),Math.sin(Li(t)),e,i)}function rh(t,e,i,r){const n=1<<i.z,s=(t/Mt+i.x)/n;return da(So((e/Mt+i.y)/n),TA(s),r)}function nh({min:t,max:e}){return Xa/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}const Hd=new Float64Array(16);function dl(t){const e=nh(t),i=ce.fromScaling(Hd,[e,e,e]);return ce.translate(i,i,_e.negate([],t.min))}function Wd(t){const e=ce.fromTranslation(Hd,t.min),i=1/nh(t);return ce.scale(e,e,[i,i,i])}function $d(t){const e=Mt/(2*Math.PI);return t/(2*Math.PI)/e}function Jp(t,e){return Mt/(512*Math.pow(2,t))*nh(lo(e))}function em(t,e,i,r,n){const s=$d(i),a=[t,e,-i/(2*Math.PI)],c=ce.identity(new Float64Array(16));return ce.translate(c,c,a),ce.scale(c,c,[s,s,s]),ce.rotateX(c,c,Li(-n)),ce.rotateY(c,c,Li(-r)),c}function tm(t){const e=t.pixelsPerMeter,i=e/On(1,t.center.lat),r=ce.identity(new Float64Array(16));return ce.translate(r,r,[t.point.x,t.point.y,0]),ce.scale(r,r,[i,i,e]),Float32Array.from(r)}function Uo(t){return Yr(Jo,Cs,t)}function im(t,e,i){const r=ce.identity(new Float64Array(16)),n=(e/(1<<t)-.5)*Math.PI*2;return ce.rotateY(r,i.globeMatrix,n),Float32Array.from(r)}function rm(t,e,i){const r=Uo(i.zoom),n=t.style.map._antialias,s=e.options.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return r===0&&!n&&!s}function nm(t,e,i,r){const n=e.getNorth(),s=e.getSouth(),a=e.getWest(),c=e.getEast(),p=1<<t.z,_=c-a,v=n-s,E=_/Vo,C=-v/ua[i],B=[0,E,0,C,0,0,n,a,0];if(t.z>0){const O=180/r;Ee.multiply(B,B,[O/_+1,0,0,0,O/v+1,0,-.5*O/E,.5*O/C,1])}return B[2]=p,B[5]=t.x,B[8]=t.y,B}function K_(t){const e=Ks-5;t=hi(t,-e,e)/e*90;const i=Math.pow(Math.abs(Math.sin(Li(t))),3);return Math.round(i*(ua.length-1))}function wA(t){const e=[0,0,0],i=ce.identity(new Float64Array(16));return ce.multiply(i,t.pixelMatrix,t.globeMatrix),_e.transformMat4(e,e,i),new At(e[0],e[1])}function Qh(t,e){const i=da(e.lat,e.lng),r=function(s){const a=da(s._center.lat,s._center.lng),c=_e.fromValues(0,1,0);let p=_e.cross([],c,a);const _=ce.fromRotation([],-s.angle,a);p=_e.transformMat4(p,p,_),ce.fromRotation(_,-s._pitch,p);const v=_e.normalize([],a);return _e.scale(v,v,hn(s.cameraToCenterDistance/s.pixelsPerMeter)),_e.transformMat4(v,v,_),_e.add([],a,v)}(t),n=_e.subtract([],r,i);return _e.angle(n,i)}function Hh(t,e){return Qh(t,e)>Math.PI/2*1.01}const sm=Li(85),J_=Math.cos(sm),eg=Math.sin(sm);class Ka{constructor(e){this._createGrid(e),this._createPoles(e)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const e of this._poleSegments)e.destroy();for(const e of this._gridSegments)e.withSkirts.destroy(),e.withoutSkirts.destroy()}_fillGridMeshWithLods(e,i){const r=new ul,n=new Ys,s=[],a=e+1+2,c=i[0]+1,p=i[0]+1+(1+i.length),_=(v,E,C)=>{let B=v===a-1?v-2:v===0?v:v-1;return B+=C?24575:0,[B,E]};for(let v=0;v<a;++v)r.emplaceBack(..._(v,0,!0));for(let v=0;v<c;++v)for(let E=0;E<a;++E)r.emplaceBack(..._(E,v,(E===0||E===a-1)&&!0));for(let v=0;v<i.length;++v){const E=i[v];for(let C=0;C<a;++C)r.emplaceBack(..._(C,E,!0))}for(let v=0;v<i.length;++v){const E=n.length,C=i[v]+1+2,B=new Ys;for(let q=0;q<C-1;q++){const $=q===C-2,J=$?a*(p-i.length+v-q):a;for(let ie=0;ie<a-1;ie++){const re=q*a+ie;q===0||$||ie===0||ie===a-2?(B.emplaceBack(re+1,re,re+J),B.emplaceBack(re+J,re+J+1,re+1)):(n.emplaceBack(re+1,re,re+J),n.emplaceBack(re+J,re+J+1,re+1))}}const O=wn.simpleSegment(0,E,r.length,n.length-E);for(let q=0;q<B.uint16.length;q+=3)n.emplaceBack(B.uint16[q],B.uint16[q+1],B.uint16[q+2]);const G=wn.simpleSegment(0,E,r.length,n.length-E);s.push({withoutSkirts:O,withSkirts:G})}return{vertices:r,indices:n,segments:s}}_createGrid(e){const i=this._fillGridMeshWithLods(Vo,ua);this._gridSegments=i.segments,this._gridBuffer=e.createVertexBuffer(i.vertices,wi.members),this._gridIndexBuffer=e.createIndexBuffer(i.indices,!0)}_createPoles(e){const i=new Ys;for(let c=0;c<=Vo;c++)i.emplaceBack(0,c+1,c+2);this._poleIndexBuffer=e.createIndexBuffer(i,!0);const r=new Cu,n=new Cu,s=new Cu,a=new Cu;this._poleSegments=[];for(let c=0,p=0;c<Jo;c++){const _=360/(1<<c);r.emplaceBack(0,-Fn,0,.5,0),n.emplaceBack(0,-Fn,0,.5,1),s.emplaceBack(0,-Fn,0,.5,.5),a.emplaceBack(0,-Fn,0,.5,.5);for(let v=0;v<=Vo;v++){let E=v/Vo,C=0;const B=Ji(0,_,E),[O,G,q]=Wl(J_,eg,B,Fn);r.emplaceBack(O,G,q,E,C),n.emplaceBack(O,G,q,E,1-C);const $=Li(B);E=.5+.5*Math.sin($),C=.5+.5*Math.cos($),s.emplaceBack(O,G,q,E,C),a.emplaceBack(O,G,q,E,1-C)}this._poleSegments.push(wn.simpleSegment(p,0,66,64)),p+=66}this._poleNorthVertexBuffer=e.createVertexBuffer(r,Ri,!1),this._poleSouthVertexBuffer=e.createVertexBuffer(n,Ri,!1),this._texturedPoleNorthVertexBuffer=e.createVertexBuffer(s,Ri,!1),this._texturedPoleSouthVertexBuffer=e.createVertexBuffer(a,Ri,!1)}getGridBuffers(e,i){return[this._gridBuffer,this._gridIndexBuffer,i?this._gridSegments[e].withSkirts:this._gridSegments[e].withoutSkirts]}getPoleBuffers(e,i){return[i?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,i?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[e]]}}const Pa=63710088e-1,Zc=2*Math.PI*Pa;class za{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new za(Hn(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,r=this.lat*i,n=e.lat*i,s=Math.sin(r)*Math.sin(n)+Math.cos(r)*Math.cos(n)*Math.cos((e.lng-this.lng)*i);return Pa*Math.acos(Math.min(s,1))}toBounds(e=0){const i=360*e/40075017,r=i/Math.cos(Math.PI/180*this.lat);return new Ml(new za(this.lng-r,this.lat-i),new za(this.lng+r,this.lat+i))}toEcef(e){const i=hn(e);return da(this.lat,this.lng,Fn+i)}static convert(e){if(e instanceof za)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new za(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new za(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var rr=za;const gc=0,D2=25.5;function om(t){return Zc*Math.cos(t*Math.PI/180)}function jo(t){return(180+t)/360}function ea(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function On(t,e){return t/om(e)}function TA(t){return 360*t-180}function So(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function c1(t,e){return t*om(So(e))}const Ks=85.051129;function u1(t){return Math.cos(Li(hi(t,-Ks,Ks)))}function sh(t,e){const i=hi(e,gc,D2),r=Math.pow(2,i);return u1(t)*Zc/(512*r)}function tg(t){return 1/Math.cos(t*Math.PI/180)}function M0(t,e=0){const i=Math.exp(Math.PI*(1-(t.y+e/Mt)/(1<<t.z)*2));return 80150034*i/(i*i+1)/Mt/(1<<t.z)}class Xr{constructor(e,i,r=0){this.x=+e,this.y=+i,this.z=+r}static fromLngLat(e,i=0){const r=rr.convert(e);return new Xr(jo(r.lng),ea(r.lat),On(i,r.lat))}toLngLat(){return new rr(TA(this.x),So(this.y))}toAltitude(){return c1(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Zc*tg(So(this.y))}}function ig(t,e,i,r,n,s,a,c,p){const _=(e+r)/2,v=(i+n)/2,E=new At(_,v);c(E),function(C,B,O,G,q,$){const J=O-q,ie=G-$;return Math.abs((G-B)*J-(O-C)*ie)/Math.hypot(J,ie)}(E.x,E.y,s.x,s.y,a.x,a.y)>=p?(ig(t,e,i,_,v,s,E,c,p),ig(t,_,v,r,n,E,a,c,p)):t.push(a)}function h1(t,e,i){let r=t[0],n=r.x,s=r.y;e(r);const a=[r];for(let c=1;c<t.length;c++){const p=t[c],{x:_,y:v}=p;e(p),ig(a,n,s,_,v,r,p,e,i),n=_,s=v,r=p}return a}function rg(t,e,i,r){if(r(e,i)){const n=e.add(i)._mult(.5);rg(t,e,n,r),rg(t,n,i,r)}else t.push(i)}function P2(t,e){let i=t[0];const r=[i];for(let n=1;n<t.length;n++){const s=t[n];rg(r,i,s,e),i=s}return r}const ng=Math.pow(2,14)-1,d1=-ng-1;function z2(t,e){const i=Math.round(t.x*e),r=Math.round(t.y*e);return t.x=hi(i,d1,ng),t.y=hi(r,d1,ng),(i<t.x||i>t.x+1||r<t.y||r>t.y+1)&&Pe("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function uu(t,e,i){const r=t.loadGeometry(),n=t.extent,s=Mt/n;if(e&&i&&i.projection.isReprojectedInTileSpace){const a=1<<e.z,{scale:c,x:p,y:_,projection:v}=i,E=C=>{const B=TA((e.x+C.x/n)/a),O=So((e.y+C.y/n)/a),G=v.project(B,O);C.x=(G.x*c-p)*n,C.y=(G.y*c-_)*n};for(let C=0;C<r.length;C++)if(t.type!==1)r[C]=h1(r[C],E,1);else{const B=[];for(const O of r[C])O.x<0||O.x>=n||O.y<0||O.y>=n||(E(O),B.push(O));r[C]=B}}for(const a of r)for(const c of a)z2(c,s);return r}function oh(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?uu(t):[]}}function am(t,e,i,r,n){t.emplaceBack(2*e+(r+1)/2,2*i+(n+1)/2)}function lm(t,e,i){t.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class sg{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new ul,this.indexArray=new Ys,this.segments=new wn,this.programConfigurations=new dc(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,r,n){const s=this.layers[0],a=[];let c=null;s.type==="circle"&&(c=s.layout.get("circle-sort-key"));for(const{feature:_,id:v,index:E,sourceLayerIndex:C}of e){const B=this.layers[0]._featureFilter.needGeometry,O=oh(_,B);if(!this.layers[0]._featureFilter.filter(new ds(this.zoom),O,r))continue;const G=c?c.evaluate(O,{},r):void 0,q={id:v,properties:_.properties,type:_.type,sourceLayerIndex:C,index:E,geometry:B?O.geometry:uu(_,r,n),patterns:{},sortKey:G};a.push(q)}c&&a.sort((_,v)=>_.sortKey-v.sortKey);let p=null;n.projection.name==="globe"&&(this.globeExtVertexArray=new bd,p=n.projection);for(const _ of a){const{geometry:v,index:E,sourceLayerIndex:C}=_,B=e[E].feature;this.addFeature(_,v,E,i.availableImages,r,p,i.brightness),i.featureIndex.insert(B,v,E,C,this.index)}}update(e,i,r,n,s){const a=Object.keys(e).length!==0;a&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,i,a?this.stateDependentLayers:this.layers,r,n,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,kp.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Dp.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,i,r,n,s,a,c){for(const p of i)for(const _ of p){const v=_.x,E=_.y;if(v<0||v>=Mt||E<0||E>=Mt)continue;if(a){const O=a.projectTilePoint(v,E,s),G=a.upVector(s,v,E),q=this.globeExtVertexArray;lm(q,O,G),lm(q,O,G),lm(q,O,G),lm(q,O,G)}const C=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),B=C.vertexLength;am(this.layoutVertexArray,v,E,-1,-1),am(this.layoutVertexArray,v,E,1,-1),am(this.layoutVertexArray,v,E,1,1),am(this.layoutVertexArray,v,E,-1,1),this.indexArray.emplaceBack(B,B+1,B+2),this.indexArray.emplaceBack(B,B+2,B+3),C.vertexLength+=4,C.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,{},n,s,c)}}function f1(t,e){for(let i=0;i<t.length;i++)if(ah(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(ah(t,e[i]))return!0;return!!og(t,e)}function B2(t,e,i){return!!ah(t,e)||!!ag(e,t,i)}function p1(t,e){if(t.length===1)return _1(e,t[0]);for(let i=0;i<e.length;i++){const r=e[i];for(let n=0;n<r.length;n++)if(ah(t,r[n]))return!0}for(let i=0;i<t.length;i++)if(_1(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(og(t,e[i]))return!0;return!1}function L2(t,e,i){if(t.length>1){if(og(t,e))return!0;for(let r=0;r<e.length;r++)if(ag(e[r],t,i))return!0}for(let r=0;r<t.length;r++)if(ag(t[r],e,i))return!0;return!1}function og(t,e){if(t.length===0||e.length===0)return!1;for(let i=0;i<t.length-1;i++){const r=t[i],n=t[i+1];for(let s=0;s<e.length-1;s++)if(R2(r,n,e[s],e[s+1]))return!0}return!1}function R2(t,e,i,r){return Ft(t,i,r)!==Ft(e,i,r)&&Ft(t,e,i)!==Ft(t,e,r)}function ag(t,e,i){const r=i*i;if(e.length===1)return t.distSqr(e[0])<r;for(let n=1;n<e.length;n++)if(m1(t,e[n-1],e[n])<r)return!0;return!1}function m1(t,e,i){const r=e.distSqr(i);if(r===0)return t.distSqr(e);const n=((t.x-e.x)*(i.x-e.x)+(t.y-e.y)*(i.y-e.y))/r;return t.distSqr(n<0?e:n>1?i:i.sub(e)._mult(n)._add(e))}function _1(t,e){let i,r,n,s=!1;for(let a=0;a<t.length;a++){i=t[a];for(let c=0,p=i.length-1;c<i.length;p=c++)r=i[c],n=i[p],r.y>e.y!=n.y>e.y&&e.x<(n.x-r.x)*(e.y-r.y)/(n.y-r.y)+r.x&&(s=!s)}return s}function ah(t,e){let i=!1;for(let r=0,n=t.length-1;r<t.length;n=r++){const s=t[r],a=t[n];s.y>e.y!=a.y>e.y&&e.x<(a.x-s.x)*(e.y-s.y)/(a.y-s.y)+s.x&&(i=!i)}return i}function g1(t,e,i,r,n){for(const a of t)if(e<=a.x&&i<=a.y&&r>=a.x&&n>=a.y)return!0;const s=[new At(e,i),new At(e,n),new At(r,n),new At(r,i)];if(t.length>2){for(const a of s)if(ah(t,a))return!0}for(let a=0;a<t.length-1;a++)if(F2(t[a],t[a+1],s))return!0;return!1}function F2(t,e,i){const r=i[0],n=i[2];if(t.x<r.x&&e.x<r.x||t.x>n.x&&e.x>n.x||t.y<r.y&&e.y<r.y||t.y>n.y&&e.y>n.y)return!1;const s=Ft(t,e,i[0]);return s!==Ft(t,e,i[1])||s!==Ft(t,e,i[2])||s!==Ft(t,e,i[3])}function Xd(t,e,i,r,n,s){let a=e.y-t.y,c=t.x-e.x;if(s=s||0){const p=a*a+c*c;if(p===0)return!0;const _=Math.sqrt(p);a/=_,c/=_}return!((i.x-t.x)*a+(i.y-t.y)*c-s<0||(r.x-t.x)*a+(r.y-t.y)*c-s<0||(n.x-t.x)*a+(n.y-t.y)*c-s<0)}function lg(t,e,i,r,n,s,a){return!(Xd(t,e,r,n,s,a)||Xd(e,i,r,n,s,a)||Xd(i,t,r,n,s,a)||Xd(r,n,t,e,i,a)||Xd(n,s,t,e,i,a)||Xd(s,r,t,e,i,a))}function Yd(t,e,i){const r=e.paint.get(t).value;return r.kind==="constant"?r.value:i.programConfigurations.get(e.id).getMaxValue(t)}function Am(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function y1(t,e,i,r,n){if(!e[0]&&!e[1])return t;const s=At.convert(e)._mult(n);i==="viewport"&&s._rotate(-r);const a=[];for(let c=0;c<t.length;c++)a.push(t[c].sub(s));return a}function x1(t,e,i,r){const n=At.convert(t)._mult(r);return e==="viewport"&&n._rotate(-i),n}Ii(sg,"CircleBucket",{omit:["layers"]});const O2=new ss({"circle-sort-key":new qi(xt.layout_circle["circle-sort-key"]),visibility:new si(xt.layout_circle.visibility)});var V2={paint:new ss({"circle-radius":new qi(xt.paint_circle["circle-radius"]),"circle-color":new qi(xt.paint_circle["circle-color"]),"circle-blur":new qi(xt.paint_circle["circle-blur"]),"circle-opacity":new qi(xt.paint_circle["circle-opacity"]),"circle-translate":new si(xt.paint_circle["circle-translate"]),"circle-translate-anchor":new si(xt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new si(xt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new si(xt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new qi(xt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new qi(xt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new qi(xt.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new si(xt.paint_circle["circle-emissive-strength"])}),layout:O2};const N2=ce.create(),U2=(t,e,i,r,n,s)=>{const a=t.transform,c=a.projection.name==="globe";let p;if(s.paint.get("circle-pitch-alignment")==="map")if(c){const v=Jp(a.zoom,e.canonical)*a._pixelsPerMercatorPixel;p=Float32Array.from([v,0,0,v])}else p=a.calculatePixelsToTileUnitsMatrix(i);else p=new Float32Array([a.pixelsToGLUnits[0],0,0,a.pixelsToGLUnits[1]]);const _={u_camera_to_center_distance:t.transform.getCameraToCenterDistance(a.projection),u_matrix:t.translatePosMatrix(e.projMatrix,i,s.paint.get("circle-translate"),s.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Xi.devicePixelRatio,u_extrude_scale:p,u_inv_rot_matrix:N2,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:s.paint.get("circle-emissive-strength")};if(c){_.u_inv_rot_matrix=r,_.u_merc_center=n,_.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],_.u_zoom_transition=Uo(a.zoom);const v=n[0]*Mt,E=n[1]*Mt;_.u_up_dir=a.projection.upVector(new ci(0,0,0),v,E)}return _},v1=t=>{const e=[];return t.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),t.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function b1(t,e,i,r,n,s,a,c,p){if(s&&t.queryGeometry.isAboveHorizon)return!1;s&&(p*=t.pixelToTileUnitsFactor);const _=t.tileID.canonical,v=i.projection.upVectorScale(_,i.center.lat,i.worldSize).metersToTile;for(const E of e)for(const C of E){const B=C.add(c),O=n&&i.elevation?i.elevation.exaggeration()*n.getElevationAt(B.x,B.y,!0):0,G=i.projection.projectTilePoint(B.x,B.y,_);if(O>0){const ie=i.projection.upVector(_,B.x,B.y);G.x+=ie[0]*v*O,G.y+=ie[1]*v*O,G.z+=ie[2]*v*O}const q=s?B:j2(G.x,G.y,G.z,r),$=s?t.tilespaceRays.map(ie=>Z2(ie,O)):t.queryGeometry.screenGeometry,J=U.transformMat4([],[G.x,G.y,G.z,1],r);if(!a&&s?p*=J[3]/i.cameraToCenterDistance:a&&!s&&(p*=i.cameraToCenterDistance/J[3]),s){const ie=So((C.y/Mt+_.y)/(1<<_.z));p/=i.projection.pixelsPerMeter(ie,1)/On(1,ie)}if(B2($,q,p))return!0}return!1}function j2(t,e,i,r){const n=U.transformMat4([],[t,e,i,1],r);return new At(n[0]/n[3],n[1]/n[3])}const w1=_e.fromValues(0,0,0),G2=_e.fromValues(0,0,1);function Z2(t,e){const i=_e.create();return w1[2]=e,t.intersectsPlane(w1,G2,i),new At(i[0],i[1])}class T1 extends sg{}function E1(t,{width:e,height:i},r,n){if(n){if(n instanceof Uint8ClampedArray)n=new Uint8Array(n.buffer);else if(n.length!==e*i*r)throw new RangeError("mismatched image size")}else n=new Uint8Array(e*i*r);return t.width=e,t.height=i,t.data=n,t}function M1(t,e,i){const{width:r,height:n}=e;r===t.width&&n===t.height||(Ag(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,r),height:Math.min(t.height,n)},i),t.width=r,t.height=n,t.data=e.data)}function Ag(t,e,i,r,n,s){if(n.width===0||n.height===0)return e;if(n.width>t.width||n.height>t.height||i.x>t.width-n.width||i.y>t.height-n.height)throw new RangeError("out of range source coordinates for image copy");if(n.width>e.width||n.height>e.height||r.x>e.width-n.width||r.y>e.height-n.height)throw new RangeError("out of range destination coordinates for image copy");const a=t.data,c=e.data;for(let p=0;p<n.height;p++){const _=((i.y+p)*t.width+i.x)*s,v=((r.y+p)*e.width+r.x)*s;for(let E=0;E<n.width*s;E++)c[v+E]=a[_+E]}return e}Ii(T1,"HeatmapBucket",{omit:["layers"]});class zu{constructor(e,i){E1(this,e,1,i)}resize(e){M1(this,new zu(e),1)}clone(){return new zu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,r,n,s){Ag(e,i,r,n,s,1)}}class bo{constructor(e,i){E1(this,e,4,i)}resize(e){M1(this,new bo(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new bo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,r,n,s){Ag(e,i,r,n,s,4)}}class S1{constructor(e,i){this.width=e.width,this.height=e.height,this.data=i instanceof Uint8Array?new Float32Array(i.buffer):i}}Ii(zu,"AlphaImage"),Ii(bo,"RGBAImage");const q2=new ss({visibility:new si(xt.layout_heatmap.visibility)});var Q2={paint:new ss({"heatmap-radius":new qi(xt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new qi(xt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new si(xt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new nu(xt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new si(xt.paint_heatmap["heatmap-opacity"])}),layout:q2};function cm(t){const e={},i=t.resolution||256,r=t.clips?t.clips.length:1,n=t.image||new bo({width:i,height:r}),s=(a,c,p)=>{e[t.evaluationKey]=p;const _=t.expression.evaluate(e);_&&(n.data[a+c+0]=Math.floor(255*_.r/_.a),n.data[a+c+1]=Math.floor(255*_.g/_.a),n.data[a+c+2]=Math.floor(255*_.b/_.a),n.data[a+c+3]=Math.floor(255*_.a))};if(t.clips)for(let a=0,c=0;a<r;++a,c+=4*i)for(let p=0,_=0;p<i;p++,_+=4){const v=p/(i-1),{start:E,end:C}=t.clips[a];s(c,_,E*(1-v)+C*v)}else for(let a=0,c=0;a<i;a++,c+=4)s(0,c,a/(i-1));return n}const H2=new ss({visibility:new si(xt.layout_hillshade.visibility)});var W2={paint:new ss({"hillshade-illumination-direction":new si(xt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new si(xt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new si(xt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new si(xt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new si(xt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new si(xt.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new si(xt.paint_hillshade["hillshade-emissive-strength"])}),layout:H2};const $2=un([{name:"a_pos",components:2,type:"Int16"}],4),{members:X2}=$2;var cg={exports:{}};function um(t,e,i){i=i||2;var r,n,s,a,c,p,_,v=e&&e.length,E=v?e[0]*i:t.length,C=I1(t,0,E,i,!0),B=[];if(!C||C.next===C.prev)return B;if(v&&(C=function(G,q,$,J){var ie,re,te,se=[];for(ie=0,re=q.length;ie<re;ie++)(te=I1(G,q[ie]*J,ie<re-1?q[ie+1]*J:G.length,J,!1))===te.next&&(te.steiner=!0),se.push(n3(te));for(se.sort(t3),ie=0;ie<se.length;ie++)$=i3(se[ie],$);return $}(t,e,C,i)),t.length>80*i){r=s=t[0],n=a=t[1];for(var O=i;O<E;O+=i)(c=t[O])<r&&(r=c),(p=t[O+1])<n&&(n=p),c>s&&(s=c),p>a&&(a=p);_=(_=Math.max(s-r,a-n))!==0?32767/_:0}return S0(C,B,i,r,n,_,0),B}function I1(t,e,i,r,n){var s,a;if(n===dg(t,e,i,r)>0)for(s=e;s<i;s+=r)a=D1(s,t[s],t[s+1],a);else for(s=i-r;s>=e;s-=r)a=D1(s,t[s],t[s+1],a);return a&&hm(a,a.next)&&(C0(a),a=a.next),a}function Wh(t,e){if(!t)return t;e||(e=t);var i,r=t;do if(i=!1,r.steiner||!hm(r,r.next)&&Go(r.prev,r,r.next)!==0)r=r.next;else{if(C0(r),(r=e=r.prev)===r.next)break;i=!0}while(i||r!==e);return e}function S0(t,e,i,r,n,s,a){if(t){!a&&s&&function(v,E,C,B){var O=v;do O.z===0&&(O.z=ug(O.x,O.y,E,C,B)),O.prevZ=O.prev,O.nextZ=O.next,O=O.next;while(O!==v);O.prevZ.nextZ=null,O.prevZ=null,function(G){var q,$,J,ie,re,te,se,he,ve=1;do{for($=G,G=null,re=null,te=0;$;){for(te++,J=$,se=0,q=0;q<ve&&(se++,J=J.nextZ);q++);for(he=ve;se>0||he>0&&J;)se!==0&&(he===0||!J||$.z<=J.z)?(ie=$,$=$.nextZ,se--):(ie=J,J=J.nextZ,he--),re?re.nextZ=ie:G=ie,ie.prevZ=re,re=ie;$=J}re.nextZ=null,ve*=2}while(te>1)}(O)}(t,r,n,s);for(var c,p,_=t;t.prev!==t.next;)if(c=t.prev,p=t.next,s?K2(t,r,n,s):Y2(t))e.push(c.i/i|0),e.push(t.i/i|0),e.push(p.i/i|0),C0(t),t=p.next,_=p.next;else if((t=p)===_){a?a===1?S0(t=J2(Wh(t),e,i),e,i,r,n,s,2):a===2&&e3(t,e,i,r,n,s):S0(Wh(t),e,i,r,n,s,1);break}}}function Y2(t){var e=t.prev,i=t,r=t.next;if(Go(e,i,r)>=0)return!1;for(var n=e.x,s=i.x,a=r.x,c=e.y,p=i.y,_=r.y,v=n<s?n<a?n:a:s<a?s:a,E=c<p?c<_?c:_:p<_?p:_,C=n>s?n>a?n:a:s>a?s:a,B=c>p?c>_?c:_:p>_?p:_,O=r.next;O!==e;){if(O.x>=v&&O.x<=C&&O.y>=E&&O.y<=B&&Kd(n,c,s,p,a,_,O.x,O.y)&&Go(O.prev,O,O.next)>=0)return!1;O=O.next}return!0}function K2(t,e,i,r){var n=t.prev,s=t,a=t.next;if(Go(n,s,a)>=0)return!1;for(var c=n.x,p=s.x,_=a.x,v=n.y,E=s.y,C=a.y,B=c<p?c<_?c:_:p<_?p:_,O=v<E?v<C?v:C:E<C?E:C,G=c>p?c>_?c:_:p>_?p:_,q=v>E?v>C?v:C:E>C?E:C,$=ug(B,O,e,i,r),J=ug(G,q,e,i,r),ie=t.prevZ,re=t.nextZ;ie&&ie.z>=$&&re&&re.z<=J;){if(ie.x>=B&&ie.x<=G&&ie.y>=O&&ie.y<=q&&ie!==n&&ie!==a&&Kd(c,v,p,E,_,C,ie.x,ie.y)&&Go(ie.prev,ie,ie.next)>=0||(ie=ie.prevZ,re.x>=B&&re.x<=G&&re.y>=O&&re.y<=q&&re!==n&&re!==a&&Kd(c,v,p,E,_,C,re.x,re.y)&&Go(re.prev,re,re.next)>=0))return!1;re=re.nextZ}for(;ie&&ie.z>=$;){if(ie.x>=B&&ie.x<=G&&ie.y>=O&&ie.y<=q&&ie!==n&&ie!==a&&Kd(c,v,p,E,_,C,ie.x,ie.y)&&Go(ie.prev,ie,ie.next)>=0)return!1;ie=ie.prevZ}for(;re&&re.z<=J;){if(re.x>=B&&re.x<=G&&re.y>=O&&re.y<=q&&re!==n&&re!==a&&Kd(c,v,p,E,_,C,re.x,re.y)&&Go(re.prev,re,re.next)>=0)return!1;re=re.nextZ}return!0}function J2(t,e,i){var r=t;do{var n=r.prev,s=r.next.next;!hm(n,s)&&C1(n,r,r.next,s)&&I0(n,s)&&I0(s,n)&&(e.push(n.i/i|0),e.push(r.i/i|0),e.push(s.i/i|0),C0(r),C0(r.next),r=t=s),r=r.next}while(r!==t);return Wh(r)}function e3(t,e,i,r,n,s){var a=t;do{for(var c=a.next.next;c!==a.prev;){if(a.i!==c.i&&s3(a,c)){var p=k1(a,c);return a=Wh(a,a.next),p=Wh(p,p.next),S0(a,e,i,r,n,s,0),void S0(p,e,i,r,n,s,0)}c=c.next}a=a.next}while(a!==t)}function t3(t,e){return t.x-e.x}function i3(t,e){var i=function(n,s){var a,c=s,p=n.x,_=n.y,v=-1/0;do{if(_<=c.y&&_>=c.next.y&&c.next.y!==c.y){var E=c.x+(_-c.y)*(c.next.x-c.x)/(c.next.y-c.y);if(E<=p&&E>v&&(v=E,a=c.x<c.next.x?c:c.next,E===p))return a}c=c.next}while(c!==s);if(!a)return null;var C,B=a,O=a.x,G=a.y,q=1/0;c=a;do p>=c.x&&c.x>=O&&p!==c.x&&Kd(_<G?p:v,_,O,G,_<G?v:p,_,c.x,c.y)&&(C=Math.abs(_-c.y)/(p-c.x),I0(c,n)&&(C<q||C===q&&(c.x>a.x||c.x===a.x&&r3(a,c)))&&(a=c,q=C)),c=c.next;while(c!==B);return a}(t,e);if(!i)return e;var r=k1(i,t);return Wh(r,r.next),Wh(i,i.next)}function r3(t,e){return Go(t.prev,t,e.prev)<0&&Go(e.next,t,t.next)<0}function ug(t,e,i,r,n){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*n|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*n|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function n3(t){var e=t,i=t;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==t);return i}function Kd(t,e,i,r,n,s,a,c){return(n-a)*(e-c)>=(t-a)*(s-c)&&(t-a)*(r-c)>=(i-a)*(e-c)&&(i-a)*(s-c)>=(n-a)*(r-c)}function s3(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(i,r){var n=i;do{if(n.i!==i.i&&n.next.i!==i.i&&n.i!==r.i&&n.next.i!==r.i&&C1(n,n.next,i,r))return!0;n=n.next}while(n!==i);return!1}(t,e)&&(I0(t,e)&&I0(e,t)&&function(i,r){var n=i,s=!1,a=(i.x+r.x)/2,c=(i.y+r.y)/2;do n.y>c!=n.next.y>c&&n.next.y!==n.y&&a<(n.next.x-n.x)*(c-n.y)/(n.next.y-n.y)+n.x&&(s=!s),n=n.next;while(n!==i);return s}(t,e)&&(Go(t.prev,t,e.prev)||Go(t,e.prev,e))||hm(t,e)&&Go(t.prev,t,t.next)>0&&Go(e.prev,e,e.next)>0)}function Go(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function hm(t,e){return t.x===e.x&&t.y===e.y}function C1(t,e,i,r){var n=fm(Go(t,e,i)),s=fm(Go(t,e,r)),a=fm(Go(i,r,t)),c=fm(Go(i,r,e));return n!==s&&a!==c||!(n!==0||!dm(t,i,e))||!(s!==0||!dm(t,r,e))||!(a!==0||!dm(i,t,r))||!(c!==0||!dm(i,e,r))}function dm(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function fm(t){return t>0?1:t<0?-1:0}function I0(t,e){return Go(t.prev,t,t.next)<0?Go(t,e,t.next)>=0&&Go(t,t.prev,e)>=0:Go(t,e,t.prev)<0||Go(t,t.next,e)<0}function k1(t,e){var i=new hg(t.i,t.x,t.y),r=new hg(e.i,e.x,e.y),n=t.next,s=e.prev;return t.next=e,e.prev=t,i.next=n,n.prev=i,r.next=i,i.prev=r,s.next=r,r.prev=s,r}function D1(t,e,i,r){var n=new hg(t,e,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function C0(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function hg(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function dg(t,e,i,r){for(var n=0,s=e,a=i-r;s<i;s+=r)n+=(t[a]-t[s])*(t[s+1]+t[a+1]),a=s;return n}cg.exports=um,cg.exports.default=um,um.deviation=function(t,e,i,r){var n=e&&e.length,s=Math.abs(dg(t,0,n?e[0]*i:t.length,i));if(n)for(var a=0,c=e.length;a<c;a++)s-=Math.abs(dg(t,e[a]*i,a<c-1?e[a+1]*i:t.length,i));var p=0;for(a=0;a<r.length;a+=3){var _=r[a]*i,v=r[a+1]*i,E=r[a+2]*i;p+=Math.abs((t[_]-t[E])*(t[v+1]-t[_+1])-(t[_]-t[v])*(t[E+1]-t[_+1]))}return s===0&&p===0?0:Math.abs((p-s)/s)},um.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},r=0,n=0;n<t.length;n++){for(var s=0;s<t[n].length;s++)for(var a=0;a<e;a++)i.vertices.push(t[n][s][a]);n>0&&i.holes.push(r+=t[n-1].length)}return i};var pm=qr(cg.exports);function fg(t,e){const i=t.length;if(i<=1)return[t];const r=[];let n,s;for(let a=0;a<i;a++){const c=Zt(t[a]);c!==0&&(t[a].area=Math.abs(c),s===void 0&&(s=c<0),s===c<0?(n&&r.push(n),n=[t[a]]):n.push(t[a]))}if(n&&r.push(n),e>1)for(let a=0;a<r.length;a++)r[a].length<=e||(Ec(r[a],e,1,r[a].length-1,o3),r[a]=r[a].slice(0,e));return r}function o3(t,e){return e.area-t.area}function pg(t,e,i){const r=i.patternDependencies;let n=!1;for(const s of e){const a=s.paint.get(`${t}-pattern`);a.isConstant()||(n=!0);const c=a.constantOr(null);c&&(n=!0,r[c]=!0)}return n}function mg(t,e,i,r,n){const s=n.patternDependencies;for(const a of e){const c=a.paint.get(`${t}-pattern`).value;if(c.kind!=="constant"){let p=c.evaluate({zoom:r},i,{},n.availableImages);p=p&&p.name?p.name:p,s[p]=!0,i.patterns[a.id]=p}}return i}class mm{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ul,this.indexArray=new Ys,this.indexArray2=new zc,this.programConfigurations=new dc(e.layers,e.zoom),this.segments=new wn,this.segments2=new wn,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection}populate(e,i,r,n){this.hasPattern=pg("fill",this.layers,i);const s=this.layers[0].layout.get("fill-sort-key"),a=[];for(const{feature:c,id:p,index:_,sourceLayerIndex:v}of e){const E=this.layers[0]._featureFilter.needGeometry,C=oh(c,E);if(!this.layers[0]._featureFilter.filter(new ds(this.zoom),C,r))continue;const B=s?s.evaluate(C,{},r,i.availableImages):void 0,O={id:p,properties:c.properties,type:c.type,sourceLayerIndex:v,index:_,geometry:E?C.geometry:uu(c,r,n),patterns:{},sortKey:B};a.push(O)}s&&a.sort((c,p)=>c.sortKey-p.sortKey);for(const c of a){const{geometry:p,index:_,sourceLayerIndex:v}=c;if(this.hasPattern){const E=mg("fill",this.layers,c,this.zoom,i);this.patternFeatures.push(E)}else this.addFeature(c,p,_,r,{},i.availableImages,i.brightness);i.featureIndex.insert(e[_].feature,p,_,v,this.index)}}update(e,i,r,n,s){const a=Object.keys(e).length!==0;a&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,i,a?this.stateDependentLayers:this.layers,r,n,s)}addFeatures(e,i,r,n,s,a){for(const c of this.patternFeatures)this.addFeature(c,c.geometry,c.index,i,r,n,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,X2),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,i,r,n,s,a=[],c){for(const p of fg(i,500)){let _=0;for(const G of p)_+=G.length;const v=this.segments.prepareSegment(_,this.layoutVertexArray,this.indexArray),E=v.vertexLength,C=[],B=[];for(const G of p){if(G.length===0)continue;G!==p[0]&&B.push(C.length/2);const q=this.segments2.prepareSegment(G.length,this.layoutVertexArray,this.indexArray2),$=q.vertexLength;this.layoutVertexArray.emplaceBack(G[0].x,G[0].y),this.indexArray2.emplaceBack($+G.length-1,$),C.push(G[0].x),C.push(G[0].y);for(let J=1;J<G.length;J++)this.layoutVertexArray.emplaceBack(G[J].x,G[J].y),this.indexArray2.emplaceBack($+J-1,$+J),C.push(G[J].x),C.push(G[J].y);q.vertexLength+=G.length,q.primitiveLength+=G.length}const O=pm(C,B);for(let G=0;G<O.length;G+=3)this.indexArray.emplaceBack(E+O[G],E+O[G+1],E+O[G+2]);v.vertexLength+=_,v.primitiveLength+=O.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,s,a,n,c)}}Ii(mm,"FillBucket",{omit:["layers","patternFeatures"]});const a3=new ss({"fill-sort-key":new qi(xt.layout_fill["fill-sort-key"]),visibility:new si(xt.layout_fill.visibility)});var l3={paint:new ss({"fill-antialias":new si(xt.paint_fill["fill-antialias"]),"fill-opacity":new qi(xt.paint_fill["fill-opacity"]),"fill-color":new qi(xt.paint_fill["fill-color"]),"fill-outline-color":new qi(xt.paint_fill["fill-outline-color"]),"fill-translate":new si(xt.paint_fill["fill-translate"]),"fill-translate-anchor":new si(xt.paint_fill["fill-translate-anchor"]),"fill-pattern":new qi(xt.paint_fill["fill-pattern"]),"fill-emissive-strength":new si(xt.paint_fill["fill-emissive-strength"])}),layout:a3};const A3=un([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),c3=un([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),u3=un([{name:"a_centroid_pos",components:2,type:"Uint16"}]),h3=un([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),d3=un([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:f3}=A3;var _m={},p3=rn,P1=Jd;function Jd(t,e,i,r,n){this.properties={},this.extent=i,this.type=0,this._pbf=t,this._geometry=-1,this._keys=r,this._values=n,t.readFields(m3,this,e)}function m3(t,e,i){t==1?e.id=i.readVarint():t==2?function(r,n){for(var s=r.readVarint()+r.pos;r.pos<s;){var a=n._keys[r.readVarint()],c=n._values[r.readVarint()];n.properties[a]=c}}(i,e):t==3?e.type=i.readVarint():t==4&&(e._geometry=i.pos)}function _3(t){for(var e,i,r=0,n=0,s=t.length,a=s-1;n<s;a=n++)r+=((i=t[a]).x-(e=t[n]).x)*(e.y+i.y);return r}Jd.types=["Unknown","Point","LineString","Polygon"],Jd.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,i=t.readVarint()+t.pos,r=1,n=0,s=0,a=0,c=[];t.pos<i;){if(n<=0){var p=t.readVarint();r=7&p,n=p>>3}if(n--,r===1||r===2)s+=t.readSVarint(),a+=t.readSVarint(),r===1&&(e&&c.push(e),e=[]),e.push(new p3(s,a));else{if(r!==7)throw new Error("unknown command "+r);e&&e.push(e[0].clone())}}return e&&c.push(e),c},Jd.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,i=1,r=0,n=0,s=0,a=1/0,c=-1/0,p=1/0,_=-1/0;t.pos<e;){if(r<=0){var v=t.readVarint();i=7&v,r=v>>3}if(r--,i===1||i===2)(n+=t.readSVarint())<a&&(a=n),n>c&&(c=n),(s+=t.readSVarint())<p&&(p=s),s>_&&(_=s);else if(i!==7)throw new Error("unknown command "+i)}return[a,p,c,_]},Jd.prototype.toGeoJSON=function(t,e,i){var r,n,s=this.extent*Math.pow(2,i),a=this.extent*t,c=this.extent*e,p=this.loadGeometry(),_=Jd.types[this.type];function v(B){for(var O=0;O<B.length;O++){var G=B[O];B[O]=[360*(G.x+a)/s-180,360/Math.PI*Math.atan(Math.exp((180-360*(G.y+c)/s)*Math.PI/180))-90]}}switch(this.type){case 1:var E=[];for(r=0;r<p.length;r++)E[r]=p[r][0];v(p=E);break;case 2:for(r=0;r<p.length;r++)v(p[r]);break;case 3:for(p=function(B){var O=B.length;if(O<=1)return[B];for(var G,q,$=[],J=0;J<O;J++){var ie=_3(B[J]);ie!==0&&(q===void 0&&(q=ie<0),q===ie<0?(G&&$.push(G),G=[B[J]]):G.push(B[J]))}return G&&$.push(G),$}(p),r=0;r<p.length;r++)for(n=0;n<p[r].length;n++)v(p[r][n])}p.length===1?p=p[0]:_="Multi"+_;var C={type:"Feature",geometry:{type:_,coordinates:p},properties:this.properties};return"id"in this&&(C.id=this.id),C};var g3=P1,z1=B1;function B1(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(y3,this,e),this.length=this._features.length}function y3(t,e,i){t===15?e.version=i.readVarint():t===1?e.name=i.readString():t===5?e.extent=i.readVarint():t===2?e._features.push(i.pos):t===3?e._keys.push(i.readString()):t===4&&e._values.push(function(r){for(var n=null,s=r.readVarint()+r.pos;r.pos<s;){var a=r.readVarint()>>3;n=a===1?r.readString():a===2?r.readFloat():a===3?r.readDouble():a===4?r.readVarint64():a===5?r.readVarint():a===6?r.readSVarint():a===7?r.readBoolean():null}return n}(i))}B1.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new g3(this._pbf,e,this.extent,this._keys,this._values)};var x3=z1;function v3(t,e,i){if(t===3){var r=new x3(i,i.readVarint()+i.pos);r.length&&(e[r.name]=r)}}var _g=_m.VectorTile=function(t,e){this.layers=t.readFields(v3,{},e)},gm=_m.VectorTileFeature=P1;function ym(t,e,i,r){const n=[],s=r===0?(a,c,p,_,v,E)=>{a.push(new At(E,p+(E-c)/(_-c)*(v-p)))}:(a,c,p,_,v,E)=>{a.push(new At(c+(E-p)/(v-p)*(_-c),E))};for(const a of t){const c=[];for(const p of a){if(p.length<=2)continue;const _=[];for(let C=0;C<p.length-1;C++){const B=p[C].x,O=p[C].y,G=p[C+1].x,q=p[C+1].y,$=r===0?B:O,J=r===0?G:q;$<e?J>e&&s(_,B,O,G,q,e):$>i?J<i&&s(_,B,O,G,q,i):_.push(p[C]),J<e&&$>=e&&s(_,B,O,G,q,e),J>i&&$<=i&&s(_,B,O,G,q,i)}let v=p[p.length-1];const E=r===0?v.x:v.y;E>=e&&E<=i&&_.push(v),_.length&&(v=_[_.length-1],_[0].x===v.x&&_[0].y===v.y||_.push(_[0]),c.push(_))}c.length&&n.push(c)}return n}_m.VectorTileLayer=z1;class L1{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const r=e[i];this._stringToNumber[r]=i,this._numberToString[i]=r}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}var b3={read:function(t,e,i,r,n){var s,a,c=8*n-r-1,p=(1<<c)-1,_=p>>1,v=-7,E=i?n-1:0,C=i?-1:1,B=t[e+E];for(E+=C,s=B&(1<<-v)-1,B>>=-v,v+=c;v>0;s=256*s+t[e+E],E+=C,v-=8);for(a=s&(1<<-v)-1,s>>=-v,v+=r;v>0;a=256*a+t[e+E],E+=C,v-=8);if(s===0)s=1-_;else{if(s===p)return a?NaN:1/0*(B?-1:1);a+=Math.pow(2,r),s-=_}return(B?-1:1)*a*Math.pow(2,s-r)},write:function(t,e,i,r,n,s){var a,c,p,_=8*s-n-1,v=(1<<_)-1,E=v>>1,C=n===23?Math.pow(2,-24)-Math.pow(2,-77):0,B=r?0:s-1,O=r?1:-1,G=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(c=isNaN(e)?1:0,a=v):(a=Math.floor(Math.log(e)/Math.LN2),e*(p=Math.pow(2,-a))<1&&(a--,p*=2),(e+=a+E>=1?C/p:C*Math.pow(2,1-E))*p>=2&&(a++,p/=2),a+E>=v?(c=0,a=v):a+E>=1?(c=(e*p-1)*Math.pow(2,n),a+=E):(c=e*Math.pow(2,E-1)*Math.pow(2,n),a=0));n>=8;t[i+B]=255&c,B+=O,c/=256,n-=8);for(a=a<<n|c,_+=n;_>0;t[i+B]=255&a,B+=O,a/=256,_-=8);t[i+B-O]|=128*G}},R1=bs,xm=b3;function bs(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}bs.Varint=0,bs.Fixed64=1,bs.Bytes=2,bs.Fixed32=5;var gg=4294967296,F1=1/gg,O1=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Bu(t){return t.type===bs.Bytes?t.readVarint()+t.pos:t.pos+1}function ef(t,e,i){return i?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function V1(t,e,i){var r=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(r);for(var n=i.pos-1;n>=t;n--)i.buf[n+r]=i.buf[n]}function w3(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function T3(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function E3(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function M3(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function S3(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function I3(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function C3(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function k3(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function D3(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function vm(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function tf(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function N1(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}bs.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var r=this.readVarint(),n=r>>3,s=this.pos;this.type=7&r,t(n,e,this),this.pos===s&&this.skip(r)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=vm(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=N1(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=vm(this.buf,this.pos)+vm(this.buf,this.pos+4)*gg;return this.pos+=8,t},readSFixed64:function(){var t=vm(this.buf,this.pos)+N1(this.buf,this.pos+4)*gg;return this.pos+=8,t},readFloat:function(){var t=xm.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=xm.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,i,r=this.buf;return e=127&(i=r[this.pos++]),i<128?e:(e|=(127&(i=r[this.pos++]))<<7,i<128?e:(e|=(127&(i=r[this.pos++]))<<14,i<128?e:(e|=(127&(i=r[this.pos++]))<<21,i<128?e:function(n,s,a){var c,p,_=a.buf;if(c=(112&(p=_[a.pos++]))>>4,p<128||(c|=(127&(p=_[a.pos++]))<<3,p<128)||(c|=(127&(p=_[a.pos++]))<<10,p<128)||(c|=(127&(p=_[a.pos++]))<<17,p<128)||(c|=(127&(p=_[a.pos++]))<<24,p<128)||(c|=(1&(p=_[a.pos++]))<<31,p<128))return ef(n,c,s);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=r[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&O1?function(i,r,n){return O1.decode(i.subarray(r,n))}(this.buf,e,t):function(i,r,n){for(var s="",a=r;a<n;){var c,p,_,v=i[a],E=null,C=v>239?4:v>223?3:v>191?2:1;if(a+C>n)break;C===1?v<128&&(E=v):C===2?(192&(c=i[a+1]))==128&&(E=(31&v)<<6|63&c)<=127&&(E=null):C===3?(p=i[a+2],(192&(c=i[a+1]))==128&&(192&p)==128&&((E=(15&v)<<12|(63&c)<<6|63&p)<=2047||E>=55296&&E<=57343)&&(E=null)):C===4&&(p=i[a+2],_=i[a+3],(192&(c=i[a+1]))==128&&(192&p)==128&&(192&_)==128&&((E=(15&v)<<18|(63&c)<<12|(63&p)<<6|63&_)<=65535||E>=1114112)&&(E=null)),E===null?(E=65533,C=1):E>65535&&(E-=65536,s+=String.fromCharCode(E>>>10&1023|55296),E=56320|1023&E),s+=String.fromCharCode(E),a+=C}return s}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==bs.Bytes)return t.push(this.readVarint(e));var i=Bu(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==bs.Bytes)return t.push(this.readSVarint());var e=Bu(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==bs.Bytes)return t.push(this.readBoolean());var e=Bu(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==bs.Bytes)return t.push(this.readFloat());var e=Bu(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==bs.Bytes)return t.push(this.readDouble());var e=Bu(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==bs.Bytes)return t.push(this.readFixed32());var e=Bu(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==bs.Bytes)return t.push(this.readSFixed32());var e=Bu(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==bs.Bytes)return t.push(this.readFixed64());var e=Bu(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==bs.Bytes)return t.push(this.readSFixed64());var e=Bu(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===bs.Varint)for(;this.buf[this.pos++]>127;);else if(e===bs.Bytes)this.pos=this.readVarint()+this.pos;else if(e===bs.Fixed32)this.pos+=4;else{if(e!==bs.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),tf(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),tf(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),tf(this.buf,-1&t,this.pos),tf(this.buf,Math.floor(t*F1),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),tf(this.buf,-1&t,this.pos),tf(this.buf,Math.floor(t*F1),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,i){var r,n;if(e>=0?(r=e%4294967296|0,n=e/4294967296|0):(n=~(-e/4294967296),4294967295^(r=~(-e%4294967296))?r=r+1|0:(r=0,n=n+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),function(s,a,c){c.buf[c.pos++]=127&s|128,s>>>=7,c.buf[c.pos++]=127&s|128,s>>>=7,c.buf[c.pos++]=127&s|128,s>>>=7,c.buf[c.pos++]=127&s|128,c.buf[c.pos]=127&(s>>>=7)}(r,0,i),function(s,a){var c=(7&s)<<4;a.buf[a.pos++]|=c|((s>>>=3)?128:0),s&&(a.buf[a.pos++]=127&s|((s>>>=7)?128:0),s&&(a.buf[a.pos++]=127&s|((s>>>=7)?128:0),s&&(a.buf[a.pos++]=127&s|((s>>>=7)?128:0),s&&(a.buf[a.pos++]=127&s|((s>>>=7)?128:0),s&&(a.buf[a.pos++]=127&s)))))}(n,i)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(r,n,s){for(var a,c,p=0;p<n.length;p++){if((a=n.charCodeAt(p))>55295&&a<57344){if(!c){a>56319||p+1===n.length?(r[s++]=239,r[s++]=191,r[s++]=189):c=a;continue}if(a<56320){r[s++]=239,r[s++]=191,r[s++]=189,c=a;continue}a=c-55296<<10|a-56320|65536,c=null}else c&&(r[s++]=239,r[s++]=191,r[s++]=189,c=null);a<128?r[s++]=a:(a<2048?r[s++]=a>>6|192:(a<65536?r[s++]=a>>12|224:(r[s++]=a>>18|240,r[s++]=a>>12&63|128),r[s++]=a>>6&63|128),r[s++]=63&a|128)}return s}(this.buf,t,this.pos);var i=this.pos-e;i>=128&&V1(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),xm.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),xm.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var r=this.pos-i;r>=128&&V1(i,r,this),this.pos=i-1,this.writeVarint(r),this.pos+=r},writeMessage:function(t,e,i){this.writeTag(t,bs.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,w3,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,T3,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,S3,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,E3,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,M3,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,I3,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,C3,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,k3,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,D3,e)},writeBytesField:function(t,e){this.writeTag(t,bs.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,bs.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,bs.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,bs.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,bs.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,bs.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,bs.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,bs.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,bs.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,bs.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};var bm=qr(R1);const P3=["tile","layer","source","sourceLayer","state"];class U1{constructor(e,i,r,n,s){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=r,this._y=n,this.properties=e.properties,this.id=s}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(const i of P3)this[i]!==void 0&&(e[i]=this[i]);return e}}class z3{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,i,r){const n=String(i);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][n]=this.stateChanges[e][n]||{},zt(this.stateChanges[e][n],r),this.deletedStates[e]===null){this.deletedStates[e]={};for(const s in this.state[e])s!==n&&(this.deletedStates[e][s]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][n]===null){this.deletedStates[e][n]={};for(const s in this.state[e][n])r[s]||(this.deletedStates[e][n][s]=null)}else for(const s in r)this.deletedStates[e]&&this.deletedStates[e][n]&&this.deletedStates[e][n][s]===null&&delete this.deletedStates[e][n][s]}removeFeatureState(e,i,r){if(this.deletedStates[e]===null)return;const n=String(i);if(this.deletedStates[e]=this.deletedStates[e]||{},r&&i!==void 0)this.deletedStates[e][n]!==null&&(this.deletedStates[e][n]=this.deletedStates[e][n]||{},this.deletedStates[e][n][r]=null);else if(i!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][n])for(r in this.deletedStates[e][n]={},this.stateChanges[e][n])this.deletedStates[e][n][r]=null;else this.deletedStates[e][n]=null;else this.deletedStates[e]=null}getState(e,i){const r=String(i),n=zt({},(this.state[e]||{})[r],(this.stateChanges[e]||{})[r]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const s=this.deletedStates[e][i];if(s===null)return{};for(const a in s)delete n[a]}return n}initializeTileState(e,i){e.setFeatureState(this.state,i)}coalesceChanges(e,i){const r={};for(const n in this.stateChanges){this.state[n]=this.state[n]||{};const s={};for(const a in this.stateChanges[n])this.state[n][a]||(this.state[n][a]={}),zt(this.state[n][a],this.stateChanges[n][a]),s[a]=this.state[n][a];r[n]=s}for(const n in this.deletedStates){this.state[n]=this.state[n]||{};const s={};if(this.deletedStates[n]===null)for(const a in this.state[n])s[a]={},this.state[n][a]={};else for(const a in this.deletedStates[n]){if(this.deletedStates[n][a]===null)this.state[n][a]={};else if(this.state[n][a])for(const c of Object.keys(this.deletedStates[n][a]))delete this.state[n][a][c];s[a]=this.state[n][a]}r[n]=r[n]||{},zt(r[n],s)}if(this.stateChanges={},this.deletedStates={},Object.keys(r).length!==0)for(const n in e)e[n].setFeatureState(r,i)}}class j1{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const r=this.toIdx(e,i);return{min:this.minimums[r],max:this.maximums[r]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function G1(t,e,i,r){let n=0,s=Number.MAX_VALUE;for(let a=0;a<3;a++)if(Math.abs(r[a])<1e-15){if(i[a]<t[a]||i[a]>e[a])return null}else{const c=1/r[a];let p=(t[a]-i[a])*c,_=(e[a]-i[a])*c;if(p>_){const v=p;p=_,_=v}if(p>n&&(n=p),_<s&&(s=_),n>s)return null}return n}function Z1(t,e,i,r,n,s,a,c,p,_,v){const E=r-t,C=n-e,B=s-i,O=a-t,G=c-e,q=p-i,$=v[1]*q-v[2]*G,J=v[2]*O-v[0]*q,ie=v[0]*G-v[1]*O,re=E*$+C*J+B*ie;if(Math.abs(re)<1e-15)return null;const te=1/re,se=_[0]-t,he=_[1]-e,ve=_[2]-i,be=(se*$+he*J+ve*ie)*te;if(be<0||be>1)return null;const Ce=he*B-ve*C,Ne=ve*E-se*B,je=se*C-he*E,Ye=(v[0]*Ce+v[1]*Ne+v[2]*je)*te;return Ye<0||be+Ye>1?null:(O*Ce+G*Ne+q*je)*te}function q1(t,e,i){return(t-e)/(i-e)}function Q1(t,e,i,r,n,s,a,c,p){const _=1<<i,v=s-r,E=a-n,C=(t+1)/_*v+r,B=(e+0)/_*E+n,O=(e+1)/_*E+n;c[0]=(t+0)/_*v+r,c[1]=B,p[0]=C,p[1]=O}class H1{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(s){const a=Math.ceil(Math.log2(s.dim/8)),c=[];let p=Math.ceil(Math.pow(2,a));const _=1/p,v=(B,O,G,q,$)=>{const J=q?1:0,ie=(B+1)*G-J,re=O*G,te=(O+1)*G-J;$[0]=B*G,$[1]=re,$[2]=ie,$[3]=te};let E=new j1(p);const C=[];for(let B=0;B<p*p;B++){v(B%p,Math.floor(B/p),_,!1,C);const O=lh(C[0],C[1],s),G=lh(C[2],C[1],s),q=lh(C[2],C[3],s),$=lh(C[0],C[3],s);E.minimums.push(Math.min(O,G,q,$)),E.maximums.push(Math.max(O,G,q,$)),E.leaves.push(1)}for(c.push(E),p/=2;p>=1;p/=2){const B=c[c.length-1];E=new j1(p);for(let O=0;O<p*p;O++){v(O%p,Math.floor(O/p),2,!0,C);const G=B.getElevation(C[0],C[1]),q=B.getElevation(C[2],C[1]),$=B.getElevation(C[2],C[3]),J=B.getElevation(C[0],C[3]),ie=B.isLeaf(C[0],C[1]),re=B.isLeaf(C[2],C[1]),te=B.isLeaf(C[2],C[3]),se=B.isLeaf(C[0],C[3]),he=Math.min(G.min,q.min,$.min,J.min),ve=Math.max(G.max,q.max,$.max,J.max),be=ie&&re&&te&&se;E.maximums.push(ve),E.minimums.push(he),E.leaves.push(ve-he<=5&&be?1:0)}c.push(E)}return c}(this.dem),r=i.length-1,n=i[r];this._addNode(n.minimums[0],n.maximums[0],n.leaves[0]),this._construct(i,0,0,r,0)}raycastRoot(e,i,r,n,s,a,c=1){return G1([e,i,-100],[r,n,this.maximums[0]*c],s,a)}raycast(e,i,r,n,s,a,c=1){if(!this.nodeCount)return null;const p=this.raycastRoot(e,i,r,n,s,a,c);if(p==null)return null;const _=[],v=[],E=[],C=[],B=[{idx:0,t:p,nodex:0,nodey:0,depth:0}];for(;B.length>0;){const{idx:O,t:G,nodex:q,nodey:$,depth:J}=B.pop();if(this.leaves[O]){Q1(q,$,J,e,i,r,n,E,C);const re=1<<J,te=(q+0)/re,se=(q+1)/re,he=($+0)/re,ve=($+1)/re,be=lh(te,he,this.dem)*c,Ce=lh(se,he,this.dem)*c,Ne=lh(se,ve,this.dem)*c,je=lh(te,ve,this.dem)*c,Ye=Z1(E[0],E[1],be,C[0],E[1],Ce,C[0],C[1],Ne,s,a),Re=Z1(C[0],C[1],Ne,E[0],C[1],je,E[0],E[1],be,s,a),rt=Math.min(Ye!==null?Ye:Number.MAX_VALUE,Re!==null?Re:Number.MAX_VALUE);if(rt!==Number.MAX_VALUE)return rt;{const lt=_e.scaleAndAdd([],s,a,G);if(W1(be,Ce,je,Ne,q1(lt[0],E[0],C[0]),q1(lt[1],E[1],C[1]))>=lt[2])return G}continue}let ie=0;for(let re=0;re<this._siblingOffset.length;re++){Q1((q<<1)+this._siblingOffset[re][0],($<<1)+this._siblingOffset[re][1],J+1,e,i,r,n,E,C),E[2]=-100,C[2]=this.maximums[this.childOffsets[O]+re]*c;const te=G1(E,C,s,a);if(te!=null){const se=te;_[re]=se;let he=!1;for(let ve=0;ve<ie&&!he;ve++)se>=_[v[ve]]&&(v.splice(ve,0,re),he=!0);he||(v[ie]=re),ie++}}for(let re=0;re<ie;re++){const te=v[re];B.push({idx:this.childOffsets[O]+te,t:_[te],nodex:(q<<1)+this._siblingOffset[te][0],nodey:($<<1)+this._siblingOffset[te][1],depth:J+1})}}return null}_addNode(e,i,r){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(r),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,r,n,s){if(e[n].isLeaf(i,r)===1)return;this.childOffsets[s]||(this.childOffsets[s]=this.nodeCount);const a=n-1,c=e[a];let p=0,_=0;for(let v=0;v<this._siblingOffset.length;v++){const E=2*i+this._siblingOffset[v][0],C=2*r+this._siblingOffset[v][1],B=c.getElevation(E,C),O=c.isLeaf(E,C),G=this._addNode(B.min,B.max,O);O&&(p|=1<<v),_||(_=G)}for(let v=0;v<this._siblingOffset.length;v++)p&1<<v||this._construct(e,2*i+this._siblingOffset[v][0],2*r+this._siblingOffset[v][1],a,_+v)}}function W1(t,e,i,r,n,s){return Ji(Ji(t,i,s),Ji(e,r,s),n)}function lh(t,e,i){const r=i.dim,n=hi(t*r-.5,0,r-1),s=hi(e*r-.5,0,r-1),a=Math.floor(n),c=Math.floor(s),p=Math.min(a+1,r-1),_=Math.min(c+1,r-1);return W1(i.get(a,c),i.get(p,c),i.get(a,_),i.get(p,_),n-a,s-c)}const B3={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function L3(t,e,i){return(256*t*256+256*e+i)/10-1e4}function R3(t,e,i){return 256*t+e+i/256-32768}class wm{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,r,n=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(r&&r!=="mapbox"&&r!=="terrarium")return Pe(`"${r}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const s=this.dim=i.height-2,a=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.floatView=new Float32Array(i.data.buffer),this.borderReady=n,this._modifiedForSources={},!n){for(let p=0;p<s;p++)a[this._idx(-1,p)]=a[this._idx(0,p)],a[this._idx(s,p)]=a[this._idx(s-1,p)],a[this._idx(p,-1)]=a[this._idx(p,0)],a[this._idx(p,s)]=a[this._idx(p,s-1)];a[this._idx(-1,-1)]=a[this._idx(0,0)],a[this._idx(s,-1)]=a[this._idx(s-1,0)],a[this._idx(-1,s)]=a[this._idx(0,s-1)],a[this._idx(s,s)]=a[this._idx(s-1,s-1)]}const c=r==="terrarium"?R3:L3;for(let p=0;p<a.length;++p){const _=4*p;this.floatView[p]=c(this.pixels[_],this.pixels[_+1],this.pixels[_+2])}this._timestamp=Xi.now()}_buildQuadTree(){this._tree=new H1(this)}get(e,i,r=!1){r&&(e=hi(e,-1,this.dim),i=hi(i,-1,this.dim));const n=this._idx(e,i);return this.floatView[n]}set(e,i,r){const n=this._idx(e,i),s=this.floatView[n];return this.floatView[n]=r,r-s}static getUnpackVector(e){return B3[e]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}static pack(e,i){const r=[0,0,0,0],n=wm.getUnpackVector(i);let s=Math.floor((e+n[3])/n[2]);return r[2]=s%256,s=Math.floor(s/256),r[1]=s%256,s=Math.floor(s/256),r[0]=s,r}getPixels(){return new S1({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,r){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let n=i*this.dim,s=i*this.dim+this.dim,a=r*this.dim,c=r*this.dim+this.dim;switch(i){case-1:n=s-1;break;case 1:s=n+1}switch(r){case-1:a=c-1;break;case 1:c=a+1}const p=-i*this.dim,_=-r*this.dim;for(let v=a;v<c;v++)for(let E=n;E<s;E++){const C=4*this._idx(E,v),B=4*this._idx(E+p,v+_);this.pixels[C+0]=e.pixels[B+0],this.pixels[C+1]=e.pixels[B+1],this.pixels[C+2]=e.pixels[B+2],this.pixels[C+3]=e.pixels[B+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Ii(wm,"DEMData"),Ii(H1,"DemMinMaxQuadTree",{omit:["dem"]});class F3{isDataAvailableAtPoint(e){const i=this._source();if(this.isUsingMockSource()||!i||e.y<0||e.y>1)return!1;const r=i.getSource().maxzoom,n=1<<r,s=Math.floor(e.x),a=Math.floor((e.x-s)*n),c=Math.floor(e.y*n),p=this.findDEMTileFor(new fi(r,s,r,a,c));return!(!p||!p.dem)}getAtPointOrZero(e,i=0){return this.getAtPoint(e,i)||0}getAtPoint(e,i,r=!0){if(this.isUsingMockSource())return null;i==null&&(i=null);const n=this._source();if(!n||e.y<0||e.y>1)return i;const s=n.getSource().maxzoom,a=1<<s,c=Math.floor(e.x),p=e.x-c,_=new fi(s,c,s,Math.floor(p*a),Math.floor(e.y*a)),v=this.findDEMTileFor(_);if(!v||!v.dem)return i;const E=v.dem,C=1<<v.tileID.canonical.z,B=(p*C-v.tileID.canonical.x)*E.dim,O=(e.y*C-v.tileID.canonical.y)*E.dim,G=Math.floor(B),q=Math.floor(O);return(r?this.exaggeration():1)*Ji(Ji(E.get(G,q),E.get(G,q+1),O-q),Ji(E.get(G+1,q),E.get(G+1,q+1),O-q),B-G)}getAtTileOffset(e,i,r){const n=1<<e.canonical.z;return this.getAtPointOrZero(new Xr(e.wrap+(e.canonical.x+i/Mt)/n,(e.canonical.y+r/Mt)/n))}getAtTileOffsetFunc(e,i,r,n){return s=>{const a=this.getAtTileOffset(e,s.x,s.y),c=n.upVector(e.canonical,s.x,s.y),p=n.upVectorScale(e.canonical,i,r).metersToTile;return _e.scale(c,c,a*p),c}}getForTilePoints(e,i,r,n){if(this.isUsingMockSource())return!1;const s=rf.create(this,e,n);return!!s&&(i.forEach(a=>{a[2]=this.exaggeration()*s.getElevationAt(a[0],a[1],r)}),!0)}getMinMaxForTile(e){if(this.isUsingMockSource())return null;const i=this.findDEMTileFor(e);if(!i||!i.dem)return null;const r=i.dem.tree,n=i.tileID,s=1<<e.canonical.z-n.canonical.z;let a=e.canonical.x/s-n.canonical.x,c=e.canonical.y/s-n.canonical.y,p=0;for(let _=0;_<e.canonical.z-n.canonical.z&&!r.leaves[p];_++){a*=2,c*=2;const v=2*Math.floor(c)+Math.floor(a);p=r.childOffsets[p]+v,a%=1,c%=1}return{min:this.exaggeration()*r.minimums[p],max:this.exaggeration()*r.maximums[p]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(e,i,r){throw new Error("Pure virtual method called.")}pointCoordinate(e){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(e){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const e=this.visibleDemTiles;if(e.length===0)return null;let i=!1,r=Number.MAX_VALUE,n=Number.MIN_VALUE;for(const s of e){const a=this.getMinMaxForTile(s.tileID);a&&(r=Math.min(r,a.min),n=Math.max(n,a.max),i=!0)}return i?{min:r,max:n}:null}}class rf{constructor(e,i,r){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=r}static create(e,i,r){const n=r||e.findDEMTileFor(i);if(!n||!n.dem)return;const s=n.dem,a=n.tileID,c=1<<i.canonical.z-a.canonical.z;return new rf(n,s.dim/Mt/c,[(i.canonical.x/c-a.canonical.x)*s.dim,(i.canonical.y/c-a.canonical.y)*s.dim])}tileCoordToPixel(e,i){const r=i*this._scale+this._offset[1],n=Math.floor(e*this._scale+this._offset[0]),s=Math.floor(r);return new At(n,s)}getElevationAt(e,i,r,n){const s=e*this._scale+this._offset[0],a=i*this._scale+this._offset[1],c=Math.floor(s),p=Math.floor(a),_=this._dem;return n=!!n,r?Ji(Ji(_.get(c,p,n),_.get(c,p+1,n),a-p),Ji(_.get(c+1,p,n),_.get(c+1,p+1,n),a-p),s-c):_.get(c,p,n)}getElevationAtPixel(e,i,r){return this._dem.get(e,i,!!r)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*On(1,e)*this._dem.stride}}class yg{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new qu(Mt,16,0),this.featureIndexArray=new Wf,this.promoteId=i}insert(e,i,r,n,s,a=0){const c=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(r,n,s,a);const p=this.grid;for(let _=0;_<i.length;_++){const v=i[_],E=[1/0,1/0,-1/0,-1/0];for(let C=0;C<v.length;C++){const B=v[C];E[0]=Math.min(E[0],B.x),E[1]=Math.min(E[1],B.y),E[2]=Math.max(E[2],B.x),E[3]=Math.max(E[3],B.y)}E[0]<Mt&&E[1]<Mt&&E[2]>=0&&E[3]>=0&&p.insert(c,E[0],E[1],E[2],E[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new _g(new bm(this.rawTileData)).layers,this.sourceLayerCoder=new L1(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i,r,n){this.loadVTLayers();const s=e.params||{},a=ao(s.filter),c=e.tileResult,p=e.transform,_=c.bufferedTilespaceBounds,v=this.grid.query(_.min.x,_.min.y,_.max.x,_.max.y,(O,G,q,$)=>g1(c.bufferedTilespaceGeometry,O,G,q,$));v.sort(O3);let E=null;p.elevation&&v.length>0&&(E=rf.create(p.elevation,this.tileID));const C={};let B;for(let O=0;O<v.length;O++){const G=v[O];if(G===B)continue;B=G;const q=this.featureIndexArray.get(G);let $=null;this.loadMatchingFeature(C,q,a,s.layers,s.availableImages,i,r,n,(J,ie,re,te=0)=>($||($=uu(J,this.tileID.canonical,e.tileTransform)),ie.queryIntersectsFeature(c,J,re,$,this.z,e.transform,e.pixelPosMatrix,E,te)))}return C}loadMatchingFeature(e,i,r,n,s,a,c,p,_){const{featureIndex:v,bucketIndex:E,sourceLayerIndex:C,layoutVertexArrayOffset:B}=i,O=this.bucketLayerIDs[E];if(n&&!function(J,ie){for(let re=0;re<J.length;re++)if(ie.indexOf(J[re])>=0)return!0;return!1}(n,O))return;const G=this.sourceLayerCoder.decode(C),q=this.vtLayers[G].feature(v);if(r.needGeometry){const J=oh(q,!0);if(!r.filter(new ds(this.tileID.overscaledZ),J,this.tileID.canonical))return}else if(!r.filter(new ds(this.tileID.overscaledZ),q))return;const $=this.getId(q,G);for(let J=0;J<O.length;J++){const ie=O[J];if(n&&n.indexOf(ie)<0)continue;const re=a[ie];if(!re)continue;let te={};$!==void 0&&p&&(te=p.getState(re.sourceLayer||"_geojsonTileLayer",$));const se=zt({},c[ie]);se.paint=$1(se.paint,re.paint,q,te,s),se.layout=$1(se.layout,re.layout,q,te,s);const he=!_||_(q,re,te,B);if(!he)continue;const ve=new U1(q,this.z,this.x,this.y,$);ve.layer=se;let be=e[ie];be===void 0&&(be=e[ie]=[]),be.push({featureIndex:v,feature:ve,intersectionZ:he})}}lookupSymbolFeatures(e,i,r,n,s,a,c,p){const _={};this.loadVTLayers();const v=ao(s);for(const E of e)this.loadMatchingFeature(_,{bucketIndex:r,sourceLayerIndex:n,featureIndex:E,layoutVertexArrayOffset:0},v,a,c,p,i);return _}loadFeature(e){const{featureIndex:i,sourceLayerIndex:r}=e;this.loadVTLayers();const n=this.sourceLayerCoder.decode(r),s=this.vtFeatures[n];if(s[i])return s[i];const a=this.vtLayers[n].feature(i);return s[i]=a,a}hasLayer(e){for(const i of this.bucketLayerIDs)for(const r of i)if(e===r)return!0;return!1}getId(e,i){let r=e.id;if(this.promoteId){const n=typeof this.promoteId=="string"?this.promoteId:this.promoteId[i];n!=null&&(r=e.properties[n]),typeof r=="boolean"&&(r=Number(r))}return r}}function $1(t,e,i,r,n){return pa(t,(s,a)=>{const c=e instanceof ru?e.get(a):null;return c&&c.evaluate?c.evaluate(i,r,n):c})}function O3(t,e){return e-t}Ii(yg,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const V3=un([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),N3=un([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),U3=un([{name:"a_projected_pos",components:4,type:"Float32"}],4);un([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const j3=un([{name:"a_z_offset",components:1,type:"Float32"}],4),G3=un([{name:"a_texb",components:2,type:"Uint16"}]),Z3=un([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),q3=un([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);un([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const X1=un([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Q3=un([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);un([{name:"triangle",components:3,type:"Uint16"}]),un([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),un([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),un([{type:"Float32",name:"offsetX"}]),un([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var fa=24;const qc=128;function xg(t,e){const{expression:i}=e;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new ds(t+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:r,interpolationType:n}=i;let s=0;for(;s<r.length&&r[s]<=t;)s++;s=Math.max(0,s-1);let a=s;for(;a<r.length&&r[a]<t+1;)a++;a=Math.min(r.length-1,a);const c=r[s],p=r[a];return i.kind==="composite"?{kind:"composite",minZoom:c,maxZoom:p,interpolationType:n}:{kind:"camera",minZoom:c,maxZoom:p,minSize:i.evaluate(new ds(c)),maxSize:i.evaluate(new ds(p)),interpolationType:n}}}function k0(t,{uSize:e,uSizeT:i},{lowerSize:r,upperSize:n}){return t.kind==="source"?r/qc:t.kind==="composite"?Ji(r/qc,n/qc,i):e}function hu(t,e){let i=0,r=0;if(t.kind==="constant")r=t.layoutSize;else if(t.kind!=="source"){const{interpolationType:n,minZoom:s,maxZoom:a}=t,c=n?hi(tn.interpolationFactor(n,e,s,a),0,1):0;t.kind==="camera"?r=Ji(t.minSize,t.maxSize,c):i=c}return{uSizeT:i,uSize:r}}var H3=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:qc,evaluateSizeForFeature:k0,evaluateSizeForZoom:hu,getSizeData:xg});function W3(t,e,i){return t.sections.forEach(r=>{r.text=function(n,s,a){const c=s.layout.get("text-transform").evaluate(a,{});return c==="uppercase"?n=n.toLocaleUpperCase():c==="lowercase"&&(n=n.toLocaleLowerCase()),vA.applyArabicShaping&&(n=vA.applyArabicShaping(n)),n}(r.text,e,i)}),t}const D0={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function $3(t){return t==="︶"||t==="﹈"||t==="︸"||t==="﹄"||t==="﹂"||t==="︾"||t==="︼"||t==="︺"||t==="︘"||t==="﹀"||t==="︐"||t==="︓"||t==="︔"||t==="｀"||t==="￣"||t==="︑"||t==="︒"}function X3(t){return t==="︵"||t==="﹇"||t==="︷"||t==="﹃"||t==="﹁"||t==="︽"||t==="︻"||t==="︹"||t==="︗"||t==="︿"}const vg=3;function Y3(t,e,i){e.glyphs=[],t===1&&i.readMessage(K3,e)}function K3(t,e,i){if(t===3){const{id:r,bitmap:n,width:s,height:a,left:c,top:p,advance:_}=i.readMessage(J3,{});e.glyphs.push({id:r,bitmap:new zu({width:s+2*vg,height:a+2*vg},n),metrics:{width:s,height:a,left:c,top:p,advance:_}})}else t===4?e.ascender=i.readSVarint():t===5&&(e.descender=i.readSVarint())}function J3(t,e,i){t===1?e.id=i.readVarint():t===2?e.bitmap=i.readBytes():t===3?e.width=i.readVarint():t===4?e.height=i.readVarint():t===5?e.left=i.readSVarint():t===6?e.top=i.readSVarint():t===7&&(e.advance=i.readVarint())}const Y1=vg,ws={horizontal:1,vertical:2,horizontalOnly:3},K1=-17;class P0{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,i){const r=new P0;return r.scale=e||1,r.fontStack=i,r}static forImage(e){const i=new P0;return i.imageName=e,i}}class nf{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i){const r=new nf;for(let n=0;n<e.sections.length;n++){const s=e.sections[n];s.image?r.addImageSection(s):r.addTextSection(s,i)}return r}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(i,r){let n="";for(let s=0;s<i.length;s++){const a=i.charCodeAt(s+1)||null,c=i.charCodeAt(s-1)||null;n+=!r&&(a&&Df(a)&&!D0[i[s+1]]||c&&Df(c)&&!D0[i[s-1]])||!D0[i[s]]?i[s]:D0[i[s]]}return n}(this.text,e)}trim(){let e=0;for(let r=0;r<this.text.length&&Tm[this.text.charCodeAt(r)];r++)e++;let i=this.text.length;for(let r=this.text.length-1;r>=0&&r>=e&&Tm[this.text.charCodeAt(r)];r--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const r=new nf;return r.text=this.text.substring(e,i),r.sectionIndex=this.sectionIndex.slice(e,i),r.sections=this.sections,r}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(P0.forText(e.scale,e.fontStack||i));const r=this.sections.length-1;for(let n=0;n<e.text.length;++n)this.sectionIndex.push(r)}addImageSection(e){const i=e.image?e.image.namePrimary:"";if(i.length===0)return void Pe("Can't add FormattedSection with an empty image.");const r=this.getNextImageSectionCharCode();r?(this.text+=String.fromCodePoint(r),this.sections.push(P0.forImage(i)),this.sectionIndex.push(this.sections.length-1)):Pe("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function bg(t,e,i,r,n,s,a,c,p,_,v,E,C,B,O){const G=nf.fromFeature(t,n);E===ws.vertical&&G.verticalizePunctuation(C);let q=[];const $=function(se,he,ve,be,Ce,Ne){if(!se)return[];const je=[],Ye=function(vt,it,at,Tt,It,St){let Lt=0;for(let Ot=0;Ot<vt.length();Ot++){const jt=vt.getSection(Ot);Lt+=J1(vt.getCodePoint(Ot),jt,Tt,It,it,St)}return Lt/Math.max(1,Math.ceil(Lt/at))}(se,he,ve,be,Ce,Ne),Re=se.text.indexOf("​")>=0;let rt=0;for(let vt=0;vt<se.length();vt++){const it=se.getSection(vt),at=se.getCodePoint(vt);if(Tm[at]||(rt+=J1(at,it,be,Ce,he,Ne)),vt<se.length()-1){const Tt=!((lt=at)<11904||!(Bi["Bopomofo Extended"](lt)||Bi.Bopomofo(lt)||Bi["CJK Compatibility Forms"](lt)||Bi["CJK Compatibility Ideographs"](lt)||Bi["CJK Compatibility"](lt)||Bi["CJK Radicals Supplement"](lt)||Bi["CJK Strokes"](lt)||Bi["CJK Symbols and Punctuation"](lt)||Bi["CJK Unified Ideographs Extension A"](lt)||Bi["CJK Unified Ideographs"](lt)||Bi["Enclosed CJK Letters and Months"](lt)||Bi["Halfwidth and Fullwidth Forms"](lt)||Bi.Hiragana(lt)||Bi["Ideographic Description Characters"](lt)||Bi["Kangxi Radicals"](lt)||Bi["Katakana Phonetic Extensions"](lt)||Bi.Katakana(lt)||Bi["Vertical Forms"](lt)||Bi["Yi Radicals"](lt)||Bi["Yi Syllables"](lt)));(eT[at]||Tt||it.imageName)&&je.push(tx(vt+1,rt,Ye,je,tT(at,se.getCodePoint(vt+1),Tt&&Re),!1))}}var lt;return ix(tx(se.length(),rt,Ye,je,0,!0))}(G,_,s,e,r,B),{processBidirectionalText:J,processStyledBidirectionalText:ie}=vA;if(J&&G.sections.length===1){const se=J(G.toString(),$);for(const he of se){const ve=new nf;ve.text=he,ve.sections=G.sections;for(let be=0;be<he.length;be++)ve.sectionIndex.push(0);q.push(ve)}}else if(ie){const se=ie(G.text,G.sectionIndex,$);for(const he of se){const ve=new nf;ve.text=he[0],ve.sectionIndex=he[1],ve.sections=G.sections,q.push(ve)}}else q=function(se,he){const ve=[],be=se.text;let Ce=0;for(const Ne of he)ve.push(se.substring(Ce,Ne)),Ce=Ne;return Ce<be.length&&ve.push(se.substring(Ce,be.length)),ve}(G,$);const re=[],te={positionedLines:re,text:G.toString(),top:v[1],bottom:v[1],left:v[0],right:v[0],writingMode:E,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(se,he,ve,be,Ce,Ne,je,Ye,Re,rt,lt,vt){let it=0,at=0,Tt=0;const It=Ye==="right"?1:Ye==="left"?0:.5;let St=!1;for(const mi of Ce){const _i=mi.getSections();for(const Ti of _i){if(Ti.imageName)continue;const Mi=he[Ti.fontStack];if(Mi&&(St=Mi.ascender!==void 0&&Mi.descender!==void 0,!St))break}if(!St)break}let Lt=0;for(const mi of Ce){mi.trim();const _i=mi.getMaxScale(),Ti=(_i-1)*fa,Mi={positionedGlyphs:[],lineOffset:0};se.positionedLines[Lt]=Mi;const ur=Mi.positionedGlyphs;let Ui=0;if(!mi.length()){at+=Ne,++Lt;continue}let on=0,Zr=0;for(let or=0;or<mi.length();or++){const $i=mi.getSection(or),Hr=mi.getSectionIndex(or),Jr=mi.getCodePoint(or);let Br=$i.scale,Vn=null,Js=null,Bn=null,us=fa,Ao=0;const eo=!(Re===ws.horizontal||!lt&&!El(Jr)||lt&&(Tm[Jr]||(Ot=Jr,Bi.Arabic(Ot)||Bi["Arabic Supplement"](Ot)||Bi["Arabic Extended-A"](Ot)||Bi["Arabic Presentation Forms-A"](Ot)||Bi["Arabic Presentation Forms-B"](Ot))));if($i.imageName){const _s=be[$i.imageName];if(!_s)continue;Bn=$i.imageName,se.iconsInText=se.iconsInText||!0,Js=_s.paddedRect;const Dn=_s.displaySize;Br=Br*fa/vt,Vn={width:Dn[0],height:Dn[1],left:0,top:-Y1,advance:eo?Dn[1]:Dn[0],localGlyph:!1},Ao=St?-Vn.height*Br:K1+_i*fa-Dn[1]*Br,us=Vn.advance;const Ba=(eo?Dn[0]:Dn[1])*Br-fa*_i;Ba>0&&Ba>Ui&&(Ui=Ba)}else{const _s=ve[$i.fontStack];if(!_s)continue;_s[Jr]&&(Js=_s[Jr]);const Dn=he[$i.fontStack];if(!Dn)continue;const Ba=Dn.glyphs[Jr];if(!Ba)continue;if(Vn=Ba.metrics,us=Jr!==8203?fa:0,St){const gu=Dn.ascender!==void 0?Math.abs(Dn.ascender):0,Ru=Dn.descender!==void 0?Math.abs(Dn.descender):0,Fu=(gu+Ru)*Br;on<Fu&&(on=Fu,Zr=(gu-Ru)/2*Br),Ao=-gu*Br}else Ao=K1+(_i-Br)*fa}eo?(se.verticalizable=!0,ur.push({glyph:Jr,imageName:Bn,x:it,y:at+Ao,vertical:eo,scale:Br,localGlyph:Vn.localGlyph,fontStack:$i.fontStack,sectionIndex:Hr,metrics:Vn,rect:Js}),it+=us*Br+rt):(ur.push({glyph:Jr,imageName:Bn,x:it,y:at+Ao,vertical:eo,scale:Br,localGlyph:Vn.localGlyph,fontStack:$i.fontStack,sectionIndex:Hr,metrics:Vn,rect:Js}),it+=Vn.advance*Br+rt)}ur.length!==0&&(Tt=Math.max(it-rt,Tt),St?rx(ur,It,Ui,Zr,Ne*_i/2):rx(ur,It,Ui,0,Ne/2)),it=0;const hr=Ne*_i+Ui;Mi.lineOffset=Math.max(Ui,Ti),at+=hr,++Lt}var Ot;const jt=at,{horizontalAlign:Dt,verticalAlign:Kt}=Em(je);(function(mi,_i,Ti,Mi,ur,Ui){const on=(_i-Ti)*ur,Zr=-Ui*Mi;for(const hr of mi)for(const or of hr.positionedGlyphs)or.x+=on,or.y+=Zr})(se.positionedLines,It,Dt,Kt,Tt,jt),se.top+=-Kt*jt,se.bottom=se.top+jt,se.left+=-Dt*Tt,se.right=se.left+Tt,se.hasBaseline=St}(te,e,i,r,q,a,c,p,E,_,C,O),!function(se){for(const he of se)if(he.positionedGlyphs.length!==0)return!1;return!0}(re)&&te}const Tm={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},eT={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function J1(t,e,i,r,n,s){if(e.imageName){const a=r[e.imageName];return a?a.displaySize[0]*e.scale*fa/s+n:0}{const a=i[e.fontStack],c=a&&a.glyphs[t];return c?c.metrics.advance*e.scale+n:0}}function ex(t,e,i,r){const n=Math.pow(t-e,2);return r?t<e?n/2:2*n:n+Math.abs(i)*i}function tT(t,e,i){let r=0;return t===10&&(r-=1e4),i&&(r+=150),t!==40&&t!==65288||(r+=50),e!==41&&e!==65289||(r+=50),r}function tx(t,e,i,r,n,s){let a=null,c=ex(e,i,n,s);for(const p of r){const _=ex(e-p.x,i,n,s)+p.badness;_<=c&&(a=p,c=_)}return{index:t,x:e,priorBreak:a,badness:c}}function ix(t){return t?ix(t.priorBreak).concat(t.index):[]}function Em(t){let e=.5,i=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function rx(t,e,i,r,n){if(!(e||i||r||n))return;const s=t.length-1,a=t[s],c=(a.x+a.metrics.advance*a.scale)*e;for(let p=0;p<=s;p++)t[p].x-=c,t[p].y+=i+r+n}function iT(t,e,i,r){const{horizontalAlign:n,verticalAlign:s}=Em(r),a=i[0]-t.displaySize[0]*n,c=i[1]-t.displaySize[1]*s;return{imagePrimary:t,imageSecondary:e,top:c,bottom:c+t.displaySize[1],left:a,right:a+t.displaySize[0]}}function nx(t,e,i,r,n,s){const a=t.imagePrimary;let c;if(a.content){const q=a.content,$=a.pixelRatio||1;c=[q[0]/$,q[1]/$,a.displaySize[0]-q[2]/$,a.displaySize[1]-q[3]/$]}const p=e.left*s,_=e.right*s;let v,E,C,B;i==="width"||i==="both"?(B=n[0]+p-r[3],E=n[0]+_+r[1]):(B=n[0]+(p+_-a.displaySize[0])/2,E=B+a.displaySize[0]);const O=e.top*s,G=e.bottom*s;return i==="height"||i==="both"?(v=n[1]+O-r[0],C=n[1]+G+r[2]):(v=n[1]+(O+G-a.displaySize[1])/2,C=v+a.displaySize[1]),{imagePrimary:a,imageSecondary:void 0,top:v,right:E,bottom:C,left:B,collisionPadding:c}}class Lu extends At{constructor(e,i,r,n,s){super(e,i),this.angle=n,this.z=r,s!==void 0&&(this.segment=s)}clone(){return new Lu(this.x,this.y,this.z,this.angle,this.segment)}}function sx(t,e,i,r,n){if(e.segment===void 0)return!0;let s=e,a=e.segment+1,c=0;for(;c>-i/2;){if(a--,a<0)return!1;c-=t[a].dist(s),s=t[a]}c+=t[a].dist(t[a+1]),a++;const p=[];let _=0;for(;c<i/2;){const v=t[a],E=t[a+1];if(!E)return!1;let C=t[a-1].angleTo(v)-v.angleTo(E);for(C=Math.abs((C+3*Math.PI)%(2*Math.PI)-Math.PI),p.push({distance:c,angleDelta:C}),_+=C;c-p[0].distance>r;)_-=p.shift().angleDelta;if(_>n)return!1;a++,c+=v.dist(E)}return!0}function ox(t){let e=0;for(let i=0;i<t.length-1;i++)e+=t[i].dist(t[i+1]);return e}function ax(t,e,i){return t?.6*e*i:0}function lx(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function rT(t,e,i,r,n,s){const a=ax(i,n,s),c=lx(i,r)*s;let p=0;const _=ox(t)/2;for(let v=0;v<t.length-1;v++){const E=t[v],C=t[v+1],B=E.dist(C);if(p+B>_){const O=(_-p)/B,G=Ji(E.x,C.x,O),q=Ji(E.y,C.y,O),$=new Lu(G,q,0,C.angleTo(E),v);return!a||sx(t,$,c,a,e)?$:void 0}p+=B}}function nT(t,e,i,r,n,s,a,c,p){const _=ax(r,s,a),v=lx(r,n),E=v*a,C=t[0].x===0||t[0].x===p||t[0].y===0||t[0].y===p;return e-E<e/4&&(e=E+e/4),Ax(t,C?e/2*c%e:(v/2+2*s)*a*c%e,e,_,i,E,C,!1,p)}function Ax(t,e,i,r,n,s,a,c,p){const _=s/2,v=ox(t);let E=0,C=e-i,B=[];for(let O=0;O<t.length-1;O++){const G=t[O],q=t[O+1],$=G.dist(q),J=q.angleTo(G);for(;C+i<E+$;){C+=i;const ie=(C-E)/$,re=Ji(G.x,q.x,ie),te=Ji(G.y,q.y,ie);if(re>=0&&re<p&&te>=0&&te<p&&C-_>=0&&C+_<=v){const se=new Lu(re,te,0,J,O);r&&!sx(t,se,s,r,n)||B.push(se)}}E+=$}return c||B.length||a||(B=Ax(t,E/2,i,r,n,s,a,!0,p)),B}function cx(t,e,i,r,n){const s=[];for(let a=0;a<t.length;a++){const c=t[a];let p;for(let _=0;_<c.length-1;_++){let v=c[_],E=c[_+1];v.x<e&&E.x<e||(v.x<e?v=new At(e,v.y+(e-v.x)/(E.x-v.x)*(E.y-v.y))._round():E.x<e&&(E=new At(e,v.y+(e-v.x)/(E.x-v.x)*(E.y-v.y))._round()),v.y<i&&E.y<i||(v.y<i?v=new At(v.x+(i-v.y)/(E.y-v.y)*(E.x-v.x),i)._round():E.y<i&&(E=new At(v.x+(i-v.y)/(E.y-v.y)*(E.x-v.x),i)._round()),v.x>=r&&E.x>=r||(v.x>=r?v=new At(r,v.y+(r-v.x)/(E.x-v.x)*(E.y-v.y))._round():E.x>=r&&(E=new At(r,v.y+(r-v.x)/(E.x-v.x)*(E.y-v.y))._round()),v.y>=n&&E.y>=n||(v.y>=n?v=new At(v.x+(n-v.y)/(E.y-v.y)*(E.x-v.x),n)._round():E.y>=n&&(E=new At(v.x+(n-v.y)/(E.y-v.y)*(E.x-v.x),n)._round()),p&&v.equals(p[p.length-1])||(p=[v],s.push(p)),p.push(E)))))}}return s}function wg(t){let e=0,i=0;for(const a of t)e+=a.w*a.h,i=Math.max(i,a.w);t.sort((a,c)=>c.h-a.h);const r=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let n=0,s=0;for(const a of t)for(let c=r.length-1;c>=0;c--){const p=r[c];if(!(a.w>p.w||a.h>p.h)){if(a.x=p.x,a.y=p.y,s=Math.max(s,a.y+a.h),n=Math.max(n,a.x+a.w),a.w===p.w&&a.h===p.h){const _=r.pop();c<r.length&&(r[c]=_)}else a.h===p.h?(p.x+=a.w,p.w-=a.w):a.w===p.w?(p.y+=a.h,p.h-=a.h):(r.push({x:p.x+a.w,y:p.y,w:p.w-a.w,h:a.h}),p.y+=a.h,p.h-=a.h);break}}return{w:n,h:s,fill:e/(n*s)||0}}Ii(Lu,"Anchor");const EA=1;class Tg{constructor(e,{pixelRatio:i,version:r,stretchX:n,stretchY:s,content:a}){this.paddedRect=e,this.pixelRatio=i,this.stretchX=n,this.stretchY=s,this.content=a,this.version=r}get tl(){return[this.paddedRect.x+EA,this.paddedRect.y+EA]}get br(){return[this.paddedRect.x+this.paddedRect.w-EA,this.paddedRect.y+this.paddedRect.h-EA]}get displaySize(){return[(this.paddedRect.w-2*EA)/this.pixelRatio,(this.paddedRect.h-2*EA)/this.pixelRatio]}}class ux{constructor(e,i){const r={},n={};this.haveRenderCallbacks=[];const s=[];this.addImages(e,r,s),this.addImages(i,n,s);const{w:a,h:c}=wg(s),p=new bo({width:a||1,height:c||1});for(const _ in e){const v=e[_],E=r[_].paddedRect;bo.copy(v.data,p,{x:0,y:0},{x:E.x+EA,y:E.y+EA},v.data)}for(const _ in i){const v=i[_],E=n[_].paddedRect,C=E.x+EA,B=E.y+EA,O=v.data.width,G=v.data.height;bo.copy(v.data,p,{x:0,y:0},{x:C,y:B},v.data),bo.copy(v.data,p,{x:0,y:G-1},{x:C,y:B-1},{width:O,height:1}),bo.copy(v.data,p,{x:0,y:0},{x:C,y:B+G},{width:O,height:1}),bo.copy(v.data,p,{x:O-1,y:0},{x:C-1,y:B},{width:1,height:G}),bo.copy(v.data,p,{x:0,y:0},{x:C+O,y:B},{width:1,height:G})}this.image=p,this.iconPositions=r,this.patternPositions=n}addImages(e,i,r){for(const n in e){const s=e[n],a={x:0,y:0,w:s.data.width+2*EA,h:s.data.height+2*EA};r.push(a),i[n]=new Tg(a,s),s.hasRenderCallback&&this.haveRenderCallbacks.push(n)}}patchUpdatedImages(e,i,r){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(n=>e.hasImage(n,r)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,r);for(const n in e.getUpdatedImages(r))this.patchUpdatedImage(this.iconPositions[n],e.getImage(n,r),i),this.patchUpdatedImage(this.patternPositions[n],e.getImage(n,r),i)}patchUpdatedImage(e,i,r){if(!e||!i||e.version===i.version)return;e.version=i.version;const[n,s]=e.tl;r.update(i.data,void 0,{x:n,y:s})}}Ii(Tg,"ImagePosition"),Ii(ux,"ImageAtlas");const z0=1e20;function hx(t,e,i,r,n,s,a,c,p){for(let _=e;_<e+r;_++)dx(t,i*s+_,s,n,a,c,p);for(let _=i;_<i+n;_++)dx(t,_*s+e,1,r,a,c,p)}function dx(t,e,i,r,n,s,a){s[0]=0,a[0]=-z0,a[1]=z0,n[0]=t[e];for(let c=1,p=0,_=0;c<r;c++){n[c]=t[e+c*i];const v=c*c;do{const E=s[p];_=(n[c]-n[E]+v-E*E)/(c-E)/2}while(_<=a[p]&&--p>-1);p++,s[p]=c,a[p]=_,a[p+1]=z0}for(let c=0,p=0;c<r;c++){for(;a[p+1]<c;)p++;const _=s[p],v=c-_;t[e+c*i]=n[_]+v*v}}const Qc=2;class sf{constructor(e,i,r){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=r,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,i){this.urls[i]=e}getGlyphs(e,i,r){const n=[],s=this.urls[i]||yt.GLYPHS_URL;for(const a in e)for(const c of e[a])n.push({stack:a,id:c});Co(n,({stack:a,id:c},p)=>{let _=this.entries[a];_||(_=this.entries[a]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let v=_.glyphs[c];if(v!==void 0)return void p(null,{stack:a,id:c,glyph:v});if(v=this._tinySDF(_,a,c),v)return _.glyphs[c]=v,void p(null,{stack:a,id:c,glyph:v});const E=Math.floor(c/256);if(256*E>65535)return void p(new Error("glyphs > 65535 not supported"));if(_.ranges[E])return void p(null,{stack:a,id:c,glyph:v});let C=_.requests[E];C||(C=_.requests[E]=[],sf.loadGlyphRange(a,E,s,this.requestManager,(B,O)=>{if(O){_.ascender=O.ascender,_.descender=O.descender;for(const G in O.glyphs)this._doesCharSupportLocalGlyph(+G)||(_.glyphs[+G]=O.glyphs[+G]);_.ranges[E]=!0}for(const G of C)G(B,O);delete _.requests[E]})),C.push((B,O)=>{B?p(B):O&&p(null,{stack:a,id:c,glyph:O.glyphs[c]||null})})},(a,c)=>{if(a)r(a);else if(c){const p={};for(const{stack:_,id:v,glyph:E}of c)p[_]===void 0&&(p[_]={}),p[_].glyphs===void 0&&(p[_].glyphs={}),p[_].glyphs[v]=E&&{id:E.id,bitmap:E.bitmap.clone(),metrics:E.metrics},p[_].ascender=this.entries[_].ascender,p[_].descender=this.entries[_].descender;r(null,p)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==0&&(this.localGlyphMode===2?!!this.localFontFamily:!!this.localFontFamily&&(Bi["CJK Unified Ideographs"](e)||Bi["Hangul Syllables"](e)||Bi.Hiragana(e)||Bi.Katakana(e)||Bi["CJK Symbols and Punctuation"](e)||Bi["CJK Unified Ideographs Extension A"](e)||Bi["CJK Unified Ideographs Extension B"](e)))}_tinySDF(e,i,r){const n=this.localFontFamily;if(!n||!this._doesCharSupportLocalGlyph(r))return;let s=e.tinySDF;if(!s){let G="400";/bold/i.test(i)?G="900":/medium/i.test(i)?G="500":/light/i.test(i)&&(G="200"),s=e.tinySDF=new sf.TinySDF({fontFamily:n,fontWeight:G,fontSize:24*Qc,buffer:3*Qc,radius:8*Qc}),s.fontWeight=G}if(this.localGlyphs[s.fontWeight][r])return this.localGlyphs[s.fontWeight][r];const a=String.fromCodePoint(r),{data:c,width:p,height:_,glyphWidth:v,glyphHeight:E,glyphLeft:C,glyphTop:B,glyphAdvance:O}=s.draw(a);return this.localGlyphs[s.fontWeight][r]={id:r,bitmap:new zu({width:p,height:_},c),metrics:{width:v/Qc,height:E/Qc,left:C/Qc,top:B/Qc-27,advance:O/Qc,localGlyph:!0}}}}sf.loadGlyphRange=function(t,e,i,r,n){const s=256*e,a=s+255,c=r.transformRequest(r.normalizeGlyphsURL(i).replace("{fontstack}",t).replace("{range}",`${s}-${a}`),we.Glyphs);Ve(c,(p,_)=>{if(p)n(p);else if(_){const v={},E=function(C){return new bm(C).readFields(Y3,{})}(_);for(const C of E.glyphs)v[C.id]=C;n(null,{glyphs:v,ascender:E.ascender,descender:E.descender})}})},sf.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:i=8,cutoff:r=.25,fontFamily:n="sans-serif",fontWeight:s="normal",fontStyle:a="normal"}={}){this.buffer=e,this.cutoff=r,this.radius=i;const c=this.size=t+4*e,p=this._createCanvas(c),_=this.ctx=p.getContext("2d",{willReadFrequently:!0});_.font=`${a} ${s} ${t}px ${n}`,_.textBaseline="alphabetic",_.textAlign="left",_.fillStyle="black",this.gridOuter=new Float64Array(c*c),this.gridInner=new Float64Array(c*c),this.f=new Float64Array(c),this.z=new Float64Array(c+1),this.v=new Uint16Array(c)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:r,actualBoundingBoxLeft:n,actualBoundingBoxRight:s}=this.ctx.measureText(t),a=Math.ceil(i),c=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(s-n))),p=Math.min(this.size-this.buffer,a+Math.ceil(r)),_=c+2*this.buffer,v=p+2*this.buffer,E=Math.max(_*v,0),C=new Uint8ClampedArray(E),B={data:C,width:_,height:v,glyphWidth:c,glyphHeight:p,glyphTop:a,glyphLeft:0,glyphAdvance:e};if(c===0||p===0)return B;const{ctx:O,buffer:G,gridInner:q,gridOuter:$}=this;O.clearRect(G,G,c,p),O.fillText(t,G,G+a);const J=O.getImageData(G,G,c,p);$.fill(z0,0,E),q.fill(0,0,E);for(let ie=0;ie<p;ie++)for(let re=0;re<c;re++){const te=J.data[4*(ie*c+re)+3]/255;if(te===0)continue;const se=(ie+G)*_+re+G;if(te===1)$[se]=0,q[se]=z0;else{const he=.5-te;$[se]=he>0?he*he:0,q[se]=he<0?he*he:0}}hx($,0,0,_,v,_,this.f,this.v,this.z),hx(q,G,G,c,p,_,this.f,this.v,this.z);for(let ie=0;ie<E;ie++){const re=Math.sqrt($[ie])-Math.sqrt(q[ie]);C[ie]=Math.round(255-255*(re/this.radius+this.cutoff))}return B}};const Ah=EA;function fx(t,e,i,r){const n=[],s=t.imagePrimary,a=s.pixelRatio,c=s.paddedRect.w-2*Ah,p=s.paddedRect.h-2*Ah,_=t.right-t.left,v=t.bottom-t.top,E=s.stretchX||[[0,c]],C=s.stretchY||[[0,p]],B=(Ne,je)=>Ne+je[1]-je[0],O=E.reduce(B,0),G=C.reduce(B,0),q=c-O,$=p-G;let J=0,ie=O,re=0,te=G,se=0,he=q,ve=0,be=$;if(s.content&&r){const Ne=s.content;J=Mm(E,0,Ne[0]),re=Mm(C,0,Ne[1]),ie=Mm(E,Ne[0],Ne[2]),te=Mm(C,Ne[1],Ne[3]),se=Ne[0]-J,ve=Ne[1]-re,he=Ne[2]-Ne[0]-ie,be=Ne[3]-Ne[1]-te}const Ce=(Ne,je,Ye,Re)=>{const rt=Sm(Ne.stretch-J,ie,_,t.left),lt=Im(Ne.fixed-se,he,Ne.stretch,O),vt=Sm(je.stretch-re,te,v,t.top),it=Im(je.fixed-ve,be,je.stretch,G),at=Sm(Ye.stretch-J,ie,_,t.left),Tt=Im(Ye.fixed-se,he,Ye.stretch,O),It=Sm(Re.stretch-re,te,v,t.top),St=Im(Re.fixed-ve,be,Re.stretch,G),Lt=new At(rt,vt),Ot=new At(at,vt),jt=new At(at,It),Dt=new At(rt,It),Kt=new At(lt/a,it/a),mi=new At(Tt/a,St/a),_i=e*Math.PI/180;if(_i){const Zr=Math.sin(_i),hr=Math.cos(_i),or=[hr,-Zr,Zr,hr];Lt._matMult(or),Ot._matMult(or),Dt._matMult(or),jt._matMult(or)}const Ti=Ne.stretch+Ne.fixed,Mi=Ye.stretch+Ye.fixed,ur=je.stretch+je.fixed,Ui=Re.stretch+Re.fixed,on=t.imageSecondary;return{tl:Lt,tr:Ot,bl:Dt,br:jt,texPrimary:{x:s.paddedRect.x+Ah+Ti,y:s.paddedRect.y+Ah+ur,w:Mi-Ti,h:Ui-ur},texSecondary:on?{x:on.paddedRect.x+Ah+Ti,y:on.paddedRect.y+Ah+ur,w:Mi-Ti,h:Ui-ur}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Kt,pixelOffsetBR:mi,minFontScaleX:he/a/_,minFontScaleY:be/a/v,isSDF:i}};if(r&&(s.stretchX||s.stretchY)){const Ne=px(E,q,O),je=px(C,$,G);for(let Ye=0;Ye<Ne.length-1;Ye++){const Re=Ne[Ye],rt=Ne[Ye+1];for(let lt=0;lt<je.length-1;lt++)n.push(Ce(Re,je[lt],rt,je[lt+1]))}}else n.push(Ce({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:c+1},{fixed:0,stretch:p+1}));return n}function Mm(t,e,i){let r=0;for(const n of t)r+=Math.max(e,Math.min(i,n[1]))-Math.max(e,Math.min(i,n[0]));return r}function px(t,e,i){const r=[{fixed:-Ah,stretch:0}];for(const[n,s]of t){const a=r[r.length-1];r.push({fixed:n-a.stretch,stretch:a.stretch}),r.push({fixed:n-a.stretch,stretch:a.stretch+(s-n)})}return r.push({fixed:e+Ah,stretch:i}),r}function Sm(t,e,i,r){return t/e*i+r}function Im(t,e,i,r){return t-e*i/r}function sT(t,e,i,r){const n=e+t.positionedLines[r].lineOffset;return r===0?i+n/2:i+(n+(e+t.positionedLines[r-1].lineOffset))/2}function oT(t,e=1,i=!1){let r=1/0,n=1/0,s=-1/0,a=-1/0;const c=t[0];for(let B=0;B<c.length;B++){const O=c[B];(!B||O.x<r)&&(r=O.x),(!B||O.y<n)&&(n=O.y),(!B||O.x>s)&&(s=O.x),(!B||O.y>a)&&(a=O.y)}const p=Math.min(s-r,a-n);let _=p/2;const v=new Fl([],aT);if(p===0)return new At(r,n);for(let B=r;B<s;B+=p)for(let O=n;O<a;O+=p)v.push(new of(B+_,O+_,_,t));let E=function(B){let O=0,G=0,q=0;const $=B[0];for(let J=0,ie=$.length,re=ie-1;J<ie;re=J++){const te=$[J],se=$[re],he=te.x*se.y-se.x*te.y;G+=(te.x+se.x)*he,q+=(te.y+se.y)*he,O+=3*he}return new of(G/O,q/O,0,B)}(t),C=v.length;for(;v.length;){const B=v.pop();(B.d>E.d||!E.d)&&(E=B,i&&console.log("found best %d after %d probes",Math.round(1e4*B.d)/1e4,C)),B.max-E.d<=e||(_=B.h/2,v.push(new of(B.p.x-_,B.p.y-_,_,t)),v.push(new of(B.p.x+_,B.p.y-_,_,t)),v.push(new of(B.p.x-_,B.p.y+_,_,t)),v.push(new of(B.p.x+_,B.p.y+_,_,t)),C+=4)}return i&&(console.log(`num probes: ${C}`),console.log(`best distance: ${E.d}`)),E.p}function aT(t,e){return e.max-t.max}class of{constructor(e,i,r,n){this.p=new At(e,i),this.h=r,this.d=function(s,a){let c=!1,p=1/0;for(let _=0;_<a.length;_++){const v=a[_];for(let E=0,C=v.length,B=C-1;E<C;B=E++){const O=v[E],G=v[B];O.y>s.y!=G.y>s.y&&s.x<(G.x-O.x)*(s.y-O.y)/(G.y-O.y)+O.x&&(c=!c),p=Math.min(p,m1(s,O,G))}}return(c?1:-1)*Math.sqrt(p)}(this.p,n),this.max=this.d+this.h*Math.SQRT2}}const af=7,Eg=Number.POSITIVE_INFINITY,lT=Math.sqrt(2);function Mg(t,[e,i]){let r=0,n=0;if(i===Eg){e<0&&(e=0);const s=e/lT;switch(t){case"top-right":case"top-left":n=s-af;break;case"bottom-right":case"bottom-left":n=-s+af;break;case"bottom":n=-e+af;break;case"top":n=e-af}switch(t){case"top-right":case"bottom-right":r=-s;break;case"top-left":case"bottom-left":r=s;break;case"left":r=e;break;case"right":r=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),t){case"top-right":case"top-left":case"top":n=i-af;break;case"bottom-right":case"bottom-left":case"bottom":n=-i+af}switch(t){case"top-right":case"bottom-right":case"right":r=-e;break;case"top-left":case"bottom-left":case"left":r=e}}return[r,n]}function AT(t,e,i,r,n,s,a,c,p,_,v){t.createArrays(),t.tilePixelRatio=Mt/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const E=t.layers[0].layout,C=t.layers[0]._unevaluatedLayout._values,B={};if(t.textSizeData.kind==="composite"){const{minZoom:$,maxZoom:J}=t.textSizeData;B.compositeTextSizes=[C["text-size"].possiblyEvaluate(new ds($),c),C["text-size"].possiblyEvaluate(new ds(J),c)]}if(t.iconSizeData.kind==="composite"){const{minZoom:$,maxZoom:J}=t.iconSizeData;B.compositeIconSizes=[C["icon-size"].possiblyEvaluate(new ds($),c),C["icon-size"].possiblyEvaluate(new ds(J),c)]}B.layoutTextSize=C["text-size"].possiblyEvaluate(new ds(p+1),c),B.layoutIconSize=C["icon-size"].possiblyEvaluate(new ds(p+1),c),B.textMaxSize=C["text-size"].possiblyEvaluate(new ds(18),c);const O=E.get("text-rotation-alignment")==="map"&&E.get("symbol-placement")!=="point",G=E.get("text-size");let q=!1;for(const $ of t.features)if($.icon&&$.icon.nameSecondary){q=!0;break}for(const $ of t.features){const J=E.get("text-font").evaluate($,{},c).join(","),ie=G.evaluate($,{},c),re=B.layoutTextSize.evaluate($,{},c),te=(B.layoutIconSize.evaluate($,{},c),{horizontal:{},vertical:void 0}),se=$.text;let he,ve=[0,0];if(se){const Ne=se.toString(),je=E.get("text-letter-spacing").evaluate($,{},c)*fa,Ye=E.get("text-line-height").evaluate($,{},c)*fa,Re=kf(Ne)?je:0,rt=E.get("text-anchor").evaluate($,{},c),lt=E.get("text-variable-anchor");if(!lt){const It=E.get("text-radial-offset").evaluate($,{},c);ve=It?Mg(rt,[It*fa,Eg]):E.get("text-offset").evaluate($,{},c).map(St=>St*fa)}let vt=O?"center":E.get("text-justify").evaluate($,{},c);const it=E.get("symbol-placement")==="point",at=it?E.get("text-max-width").evaluate($,{},c)*fa:1/0,Tt=It=>{t.allowVerticalPlacement&&md(Ne)&&(te.vertical=bg(se,e,i,n,J,at,Ye,rt,It,Re,ve,ws.vertical,!0,re,ie))};if(!O&&lt){const It=vt==="auto"?lt.map(Lt=>Sg(Lt)):[vt];let St=!1;for(let Lt=0;Lt<It.length;Lt++){const Ot=It[Lt];if(!te.horizontal[Ot])if(St)te.horizontal[Ot]=te.horizontal[0];else{const jt=bg(se,e,i,n,J,at,Ye,"center",Ot,Re,ve,ws.horizontal,!1,re,ie);jt&&(te.horizontal[Ot]=jt,St=jt.positionedLines.length===1)}}Tt("left")}else{if(vt==="auto"&&(vt=Sg(rt)),it||E.get("text-writing-mode").indexOf("horizontal")>=0||!md(Ne)){const It=bg(se,e,i,n,J,at,Ye,rt,vt,Re,ve,ws.horizontal,!1,re,ie);It&&(te.horizontal[vt]=It)}Tt(it?"left":vt)}}let be=!1;if($.icon&&$.icon.namePrimary){const Ne=r[$.icon.namePrimary];Ne&&(he=iT(n[$.icon.namePrimary],$.icon.nameSecondary?n[$.icon.nameSecondary]:void 0,E.get("icon-offset").evaluate($,{},c),E.get("icon-anchor").evaluate($,{},c)),be=Ne.sdf,t.sdfIcons===void 0?t.sdfIcons=Ne.sdf:t.sdfIcons!==Ne.sdf&&Pe("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ne.pixelRatio!==t.pixelRatio||E.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}const Ce=_x(te.horizontal)||te.vertical;t.iconsInText||(t.iconsInText=!!Ce&&Ce.iconsInText),(Ce||he)&&cT(t,$,te,he,r,B,re,0,ve,be,a,c,_,v,q)}s&&t.generateCollisionDebugBuffers(p,t.collisionBoxArray)}function Sg(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function cT(t,e,i,r,n,s,a,c,p,_,v,E,C,B,O){let G=s.textMaxSize.evaluate(e,{},E);G===void 0&&(G=a);const q=t.layers[0].layout,$=q.get("icon-offset").evaluate(e,{},E),J=_x(i.horizontal)||i.vertical,ie=C.name==="globe",re=fa,te=a/re,se=t.tilePixelRatio*G/re,he=(rt=t.overscaling,t.zoom>18&&rt>2&&(rt>>=1),Math.max(Mt/(512*rt),1)*q.get("symbol-spacing")),ve=q.get("text-padding")*t.tilePixelRatio,be=q.get("icon-padding")*t.tilePixelRatio,Ce=Li(q.get("text-max-angle")),Ne=q.get("text-rotation-alignment")==="map"&&q.get("symbol-placement")!=="point",je=q.get("icon-rotation-alignment")==="map"&&q.get("symbol-placement")!=="point",Ye=q.get("symbol-placement"),Re=he/2;var rt;const lt=q.get("icon-text-fit").evaluate(e,{},E),vt=q.get("icon-text-fit-padding").evaluate(e,{},E),it=lt!=="none";let at;t.hasAnyIconTextFit===!1&&it&&(t.hasAnyIconTextFit=!0),r&&it&&(t.allowVerticalPlacement&&i.vertical&&(at=nx(r,i.vertical,lt,vt,$,te)),J&&(r=nx(r,J,lt,vt,$,te)));const Tt=(It,St,Lt)=>{if(St.x<0||St.x>=Mt||St.y<0||St.y>=Mt)return;let Ot=null;if(ie){const{x:jt,y:Dt,z:Kt}=C.projectTilePoint(St.x,St.y,Lt);Ot={anchor:new Lu(jt,Dt,Kt,0,void 0),up:C.upVector(Lt,St.x,St.y)}}(function(jt,Dt,Kt,mi,_i,Ti,Mi,ur,Ui,on,Zr,hr,or,$i,Hr,Jr,Br,Vn,Js,Bn,us,Ao,eo,_s,Dn,Ba,gu){const Ru=jt.addToLineVertexArray(Dt,mi);let Fu,tp,ip,w_,ww,Tw,Ew,Mw=0,Sw=0,Iw=0,Cw=0,Sy=-1,Iy=-1;const yu={};let kw=Xf("");const rd=Kt?Kt.anchor:Dt,Cy=Ui.layout.get("icon-text-fit").evaluate(us,{},Dn)!=="none";let ky=0,Dy=0;if(Ui._unevaluatedLayout.getValue("text-radial-offset")===void 0?[ky,Dy]=Ui.layout.get("text-offset").evaluate(us,{},Dn).map(SA=>SA*fa):(ky=Ui.layout.get("text-radial-offset").evaluate(us,{},Dn)*fa,Dy=Eg),jt.allowVerticalPlacement&&_i.vertical){const SA=_i.vertical;if(Hr)Tw=Ig(SA),ur&&(Ew=Ig(ur));else{const IA=Ui.layout.get("text-rotate").evaluate(us,{},Dn)+90;ip=Cm(on,rd,Dt,Zr,hr,or,SA,$i,IA,Jr),ur&&(w_=Cm(on,rd,Dt,Zr,hr,or,ur,Vn,IA))}}if(Ti){const SA=Ui.layout.get("icon-rotate").evaluate(us,{},Dn),IA=fx(Ti,SA,eo,Cy),gf=ur?fx(ur,SA,eo,Cy):void 0;tp=Cm(on,rd,Dt,Zr,hr,or,Ti,Vn,SA),Mw=4*IA.length;const Dw=jt.iconSizeData;let nd=null;Dw.kind==="source"?(nd=[qc*Ui.layout.get("icon-size").evaluate(us,{},Dn)],nd[0]>ch&&Pe(`${jt.layerIds[0]}: Value for "icon-size" is >= ${B0}. Reduce your "icon-size".`)):Dw.kind==="composite"&&(nd=[qc*Ao.compositeIconSizes[0].evaluate(us,{},Dn),qc*Ao.compositeIconSizes[1].evaluate(us,{},Dn)],(nd[0]>ch||nd[1]>ch)&&Pe(`${jt.layerIds[0]}: Value for "icon-size" is >= ${B0}. Reduce your "icon-size".`)),jt.addSymbols(jt.icon,IA,nd,Bn,Js,us,!1,Kt,Dt,Ru.lineStartIndex,Ru.lineLength,-1,_s,Dn,Ba,gu),Sy=jt.icon.placedSymbolArray.length-1,gf&&(Sw=4*gf.length,jt.addSymbols(jt.icon,gf,nd,Bn,Js,us,ws.vertical,Kt,Dt,Ru.lineStartIndex,Ru.lineLength,-1,_s,Dn,Ba,gu),Iy=jt.icon.placedSymbolArray.length-1)}for(const SA in _i.horizontal){const IA=_i.horizontal[SA];Fu||(kw=Xf(IA.text),Hr?ww=Ig(IA):Fu=Cm(on,rd,Dt,Zr,hr,or,IA,$i,Ui.layout.get("text-rotate").evaluate(us,{},Dn),Jr));const gf=IA.positionedLines.length===1;if(Iw+=mx(jt,Kt,Dt,IA,Mi,Ui,Hr,us,Jr,Ru,_i.vertical?ws.horizontal:ws.horizontalOnly,gf?Object.keys(_i.horizontal):[SA],yu,Sy,Ao,_s,Dn,Ba),gf)break}_i.vertical&&(Cw+=mx(jt,Kt,Dt,_i.vertical,Mi,Ui,Hr,us,Jr,Ru,ws.vertical,["vertical"],yu,Iy,Ao,_s,Dn,Ba));let gh=-1;const Py=(SA,IA)=>SA?Math.max(SA,IA):IA;gh=Py(ww,gh),gh=Py(Tw,gh),gh=Py(Ew,gh);const WS=gh>-1?1:0;jt.glyphOffsetArray.length>=V0.MAX_GLYPHS&&Pe("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),us.sortKey!==void 0&&jt.addToSortKeyRanges(jt.symbolInstances.length,us.sortKey),jt.symbolInstances.emplaceBack(Dt.x,Dt.y,rd.x,rd.y,rd.z,yu.right>=0?yu.right:-1,yu.center>=0?yu.center:-1,yu.left>=0?yu.left:-1,yu.vertical>=0?yu.vertical:-1,Sy,Iy,kw,Fu!==void 0?Fu:jt.collisionBoxArray.length,Fu!==void 0?Fu+1:jt.collisionBoxArray.length,ip!==void 0?ip:jt.collisionBoxArray.length,ip!==void 0?ip+1:jt.collisionBoxArray.length,tp!==void 0?tp:jt.collisionBoxArray.length,tp!==void 0?tp+1:jt.collisionBoxArray.length,w_||jt.collisionBoxArray.length,w_?w_+1:jt.collisionBoxArray.length,Zr,Iw,Cw,Mw,Sw,WS,0,ky,Dy,gh,0,Cy?1:0)})(t,St,Ot,It,i,r,n,at,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,ve,Ne,p,0,be,je,$,e,s,_,v,E,B,O)};if(Ye==="line")for(const It of cx(e.geometry,0,0,Mt,Mt)){const St=nT(It,he,Ce,i.vertical||J,r,re,se,t.overscaling,Mt);for(const Lt of St)J&&uT(t,J.text,Re,Lt)||Tt(It,Lt,E)}else if(Ye==="line-center"){for(const It of e.geometry)if(It.length>1){const St=rT(It,Ce,i.vertical||J,r,re,se);St&&Tt(It,St,E)}}else if(e.type==="Polygon")for(const It of fg(e.geometry,0)){const St=oT(It,16);Tt(It[0],new Lu(St.x,St.y,0,0,void 0),E)}else if(e.type==="LineString")for(const It of e.geometry)Tt(It,new Lu(It[0].x,It[0].y,0,0,void 0),E);else if(e.type==="Point")for(const It of e.geometry)for(const St of It)Tt([St],new Lu(St.x,St.y,0,0,void 0),E)}const B0=255,ch=B0*qc;function mx(t,e,i,r,n,s,a,c,p,_,v,E,C,B,O,G,q,$){const J=function(te,se,he,ve,be,Ce,Ne,je){const Ye=[];if(se.positionedLines.length===0)return Ye;const Re=ve.layout.get("text-rotate").evaluate(Ce,{})*Math.PI/180,rt=function(Tt){const It=Tt[0],St=Tt[1],Lt=It*St;return Lt>0?[It,-St]:Lt<0?[-It,St]:It===0?[St,It]:[St,-It]}(he);let lt=Math.abs(se.top-se.bottom);for(const Tt of se.positionedLines)lt-=Tt.lineOffset;const vt=se.positionedLines.length,it=lt/vt;let at=se.top-he[1];for(let Tt=0;Tt<vt;++Tt){const It=se.positionedLines[Tt];at=sT(se,it,at,Tt);for(const St of It.positionedGlyphs){if(!St.rect)continue;const Lt=St.rect||{};let Ot=Y1+1,jt=!0,Dt=1,Kt=0;if(St.imageName){const Bn=Ne[St.imageName];if(!Bn)continue;if(Bn.sdf){Pe("SDF images are not supported in formatted text and will be ignored.");continue}jt=!1,Dt=Bn.pixelRatio,Ot=EA/Dt}const mi=(be||je)&&St.vertical,_i=St.metrics.advance*St.scale/2,Ti=St.metrics,Mi=St.rect;if(Mi===null)continue;je&&se.verticalizable&&(Kt=St.imageName?_i-St.metrics.width*St.scale/2:0);const ur=be?[St.x+_i,St.y]:[0,0];let Ui=[0,0],on=[0,0],Zr=!1;be||(mi?(on=[St.x+_i+rt[0],St.y+rt[1]-Kt],Zr=!0):Ui=[St.x+_i+he[0],St.y+he[1]-Kt]);const hr=Mi.w*St.scale/(Dt*(St.localGlyph?Qc:1)),or=Mi.h*St.scale/(Dt*(St.localGlyph?Qc:1));let $i,Hr,Jr,Br;if(mi){const Bn=St.y-at,us=new At(-_i,_i-Bn),Ao=-Math.PI/2,eo=new At(...on);$i=new At(-_i+Ui[0],Ui[1]),$i._rotateAround(Ao,us)._add(eo),$i.x+=-Bn+_i,$i.y-=(Ti.left-Ot)*St.scale;const _s=St.imageName?Ti.advance*St.scale:fa*St.scale,Dn=String.fromCodePoint(St.glyph);$3(Dn)?$i.x+=(1-Ot)*St.scale:X3(Dn)?$i.x+=_s-Ti.height*St.scale+(-Ot-1)*St.scale:$i.x+=St.imageName||Ti.width+2*Ot===Mi.w&&Ti.height+2*Ot===Mi.h?(_s-or)/2:(_s-(Ti.height+2*Ot)*St.scale)/2,Hr=new At($i.x,$i.y-hr),Jr=new At($i.x+or,$i.y),Br=new At($i.x+or,$i.y-hr)}else{const Bn=(Ti.left-Ot)*St.scale-_i+Ui[0],us=(-Ti.top-Ot)*St.scale+Ui[1],Ao=Bn+hr,eo=us+or;$i=new At(Bn,us),Hr=new At(Ao,us),Jr=new At(Bn,eo),Br=new At(Ao,eo)}if(Re){let Bn;Bn=be?new At(0,0):Zr?new At(rt[0],rt[1]):new At(he[0],he[1]),$i._rotateAround(Re,Bn),Hr._rotateAround(Re,Bn),Jr._rotateAround(Re,Bn),Br._rotateAround(Re,Bn)}const Vn=new At(0,0),Js=new At(0,0);Ye.push({tl:$i,tr:Hr,bl:Jr,br:Br,texPrimary:Lt,texSecondary:void 0,writingMode:se.writingMode,glyphOffset:ur,sectionIndex:St.sectionIndex,isSDF:jt,pixelOffsetTL:Vn,pixelOffsetBR:Js,minFontScaleX:0,minFontScaleY:0})}}return Ye}(0,r,p,s,a,c,n,t.allowVerticalPlacement),ie=t.textSizeData;let re=null;ie.kind==="source"?(re=[qc*s.layout.get("text-size").evaluate(c,{},q)],re[0]>ch&&Pe(`${t.layerIds[0]}: Value for "text-size" is >= ${B0}. Reduce your "text-size".`)):ie.kind==="composite"&&(re=[qc*O.compositeTextSizes[0].evaluate(c,{},q),qc*O.compositeTextSizes[1].evaluate(c,{},q)],(re[0]>ch||re[1]>ch)&&Pe(`${t.layerIds[0]}: Value for "text-size" is >= ${B0}. Reduce your "text-size".`)),t.addSymbols(t.text,J,re,p,a,c,v,e,i,_.lineStartIndex,_.lineLength,B,G,q,$,!1);for(const te of E)C[te]=t.text.placedSymbolArray.length-1;return 4*J.length}function _x(t){for(const e in t)return t[e];return null}function Cm(t,e,i,r,n,s,a,c,p,_){let v=a.top,E=a.bottom,C=a.left,B=a.right;const O=a.collisionPadding;if(O&&(C-=O[0],v-=O[1],B+=O[2],E+=O[3]),p){const G=new At(C,v),q=new At(B,v),$=new At(C,E),J=new At(B,E),ie=Li(p);let re=new At(0,0);_&&(re=new At(_[0],_[1])),G._rotateAround(ie,re),q._rotateAround(ie,re),$._rotateAround(ie,re),J._rotateAround(ie,re),C=Math.min(G.x,q.x,$.x,J.x),B=Math.max(G.x,q.x,$.x,J.x),v=Math.min(G.y,q.y,$.y,J.y),E=Math.max(G.y,q.y,$.y,J.y)}return t.emplaceBack(e.x,e.y,e.z,i.x,i.y,C,v,B,E,c,r,n,s),t.length-1}function Ig(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function uT(t,e,i,r){const n=t.compareText;if(e in n){const s=n[e];for(let a=s.length-1;a>=0;a--)if(r.dist(s[a])<i)return!0}else n[e]=[];return n[e].push(r),!1}function gx(t,e){const i=t.fovAboveCenter,r=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,n=(t._camera.position[2]*t.worldSize-r)/Math.cos(t._pitch),s=Math.sin(i)*n/Math.sin(Math.max(Math.PI/2-t._pitch-i,.01)),a=Math.sin(t._pitch)*s+n;return Math.min(1.01*a,n*(1/t._horizonShift))}function $h(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};const i=Math.pow(2,-t.z),r=t.x*i,n=(t.x+1)*i,s=t.y*i,a=(t.y+1)*i,c=TA(r),p=TA(n),_=So(s),v=So(a),E=e.project(c,_),C=e.project(p,_),B=e.project(p,v),O=e.project(c,v);let G=Math.min(E.x,C.x,B.x,O.x),q=Math.min(E.y,C.y,B.y,O.y),$=Math.max(E.x,C.x,B.x,O.x),J=Math.max(E.y,C.y,B.y,O.y);const ie=i/16;function re(se,he,ve,be,Ce,Ne){const je=(ve+Ce)/2,Ye=(be+Ne)/2,Re=e.project(TA(je),So(Ye)),rt=Math.max(0,G-Re.x,q-Re.y,Re.x-$,Re.y-J);G=Math.min(G,Re.x),$=Math.max($,Re.x),q=Math.min(q,Re.y),J=Math.max(J,Re.y),rt>ie&&(re(se,Re,ve,be,je,Ye),re(Re,he,je,Ye,Ce,Ne))}re(E,C,r,s,n,s),re(C,B,n,s,n,a),re(B,O,n,a,r,a),re(O,E,r,a,r,s),G-=ie,q-=ie,$+=ie,J+=ie;const te=1/Math.max($-G,J-q);return{scale:te,x:G*te,y:q*te,x2:$*te,y2:J*te,projection:e}}function yx(t,e,i,r,n,s,a,c,p){if(p.name==="globe")return Hl(t,e,new ci(i,r,n),!1);const _=$h({z:i,x:r,y:n},p);return new $r([(s+_.x/_.scale)*e,e*(_.y/_.scale),a],[(s+_.x2/_.scale)*e,e*(_.y2/_.scale),c])}function xx(t,{x:e,y:i},r=0){return new At(((e-r)*t.scale-t.x)*Mt,(i*t.scale-t.y)*Mt)}function vx(t,e,i=0){return _e.fromValues(((e.x-i)*t.scale-t.x)*Mt,(e.y*t.scale-t.y)*Mt,c1(e.z,e.y))}const hT=ce.identity(new Float32Array(16));class uh{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new rr(0,0)}projectTilePoint(e,i,r){return{x:e,y:i,z:0}}locationPoint(e,i,r=!0){return e._coordinatePoint(e.locationCoordinate(i),r)}pixelsPerMeter(e,i){return On(1,e)*i}pixelSpaceConversion(e,i,r){return 1}farthestPixelDistance(e){return gx(e,e.pixelsPerMeter)}pointCoordinate(e,i,r,n){const s=e.horizonLineFromTop(!1),a=new At(i,Math.max(s,r));return e.rayIntersectionCoordinate(e.pointRayIntersection(a,n))}pointCoordinate3D(e,i,r){const n=new At(i,r);if(e.elevation)return e.elevation.pointCoordinate(n);{const s=this.pointCoordinate(e,n.x,n.y,0);return[s.x,s.y,s.z]}}isPointAboveHorizon(e,i){if(e.elevation)return!this.pointCoordinate3D(e,i.x,i.y);const r=e.horizonLineFromTop();return i.y<r}createInversionMatrix(e,i){return hT}createTileMatrix(e,i,r){let n,s,a;const c=r.canonical,p=ce.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const _=$h(c,this);n=1,s=_.x+r.wrap*_.scale,a=_.y,ce.scale(p,p,[n/_.scale,n/_.scale,e.pixelsPerMeter/i])}else n=i/e.zoomScale(c.z),s=(c.x+Math.pow(2,c.z)*r.wrap)*n,a=c.y*n;return ce.translate(p,p,[s,a,0]),ce.scale(p,p,[n/Mt,n/Mt,1]),p}upVector(e,i,r){return[0,0,1]}upVectorScale(e,i,r){return{metersToTile:1}}}class dT extends uh{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,r]=this.parallels=e.parallels||[29.5,45.5],n=Math.sin(Li(i));this.n=(n+Math.sin(Li(r)))/2,this.c=1+n*(2*this.n-n),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:r,c:n,r0:s}=this,a=Li(e-this.center[0]),c=Li(i),p=Math.sqrt(n-2*r*Math.sin(c))/r;return{x:p*Math.sin(a*r),y:p*Math.cos(a*r)-s,z:0}}unproject(e,i){const{n:r,c:n,r0:s}=this,a=s+i;let c=Math.atan2(e,Math.abs(a))*Math.sign(a);a*r<0&&(c-=Math.PI*Math.sign(e)*Math.sign(a));const p=Li(this.center[0])*r;c=Hn(c,-Math.PI-p,Math.PI-p);const _=hi(Ir(c/r)+this.center[0],-180,180),v=Math.asin(hi((n-(e*e+a*a)*r*r)/(2*r),-1,1)),E=hi(Ir(v),-Ks,Ks);return new rr(_,E)}}const L0=1.340264,R0=-.081106,F0=893e-6,O0=.003796,km=Math.sqrt(3)/2;class fT extends uh{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const r=Math.asin(km*Math.sin(i)),n=r*r,s=n*n*n;return{x:.5*(e*Math.cos(r)/(km*(L0+3*R0*n+s*(7*F0+9*O0*n)))/Math.PI+.5),y:1-.5*(r*(L0+R0*n+s*(F0+O0*n))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let r=i=(2*(1-i)-1)*Math.PI,n=r*r,s=n*n*n;for(let v,E,C,B=0;B<12&&(E=r*(L0+R0*n+s*(F0+O0*n))-i,C=L0+3*R0*n+s*(7*F0+9*O0*n),v=E/C,r=hi(r-v,-Math.PI/3,Math.PI/3),n=r*r,s=n*n*n,!(Math.abs(v)<1e-12));++B);const a=km*e*(L0+3*R0*n+s*(7*F0+9*O0*n))/Math.cos(r),c=Math.asin(Math.sin(r)/km),p=hi(180*a/Math.PI,-180,180),_=hi(180*c/Math.PI,-Ks,Ks);return new rr(p,_)}}class pT extends uh{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const r=360*(e-.5),n=hi(360*(.5-i),-Ks,Ks);return new rr(r,n)}}const lf=Math.PI/2;function Dm(t){return Math.tan((lf+t)/2)}class mT extends uh{constructor(e){super(e),this.center=e.center||[0,30];const[i,r]=this.parallels=e.parallels||[30,30];let n=Li(i),s=Li(r);this.southernCenter=n+s<0,this.southernCenter&&(n=-n,s=-s);const a=Math.cos(n),c=Dm(n);this.n=n===s?Math.sin(n):Math.log(a/Math.cos(s))/Math.log(Dm(s)/c),this.f=a*Math.pow(Dm(n),this.n)/this.n}project(e,i){i=Li(i),this.southernCenter&&(i=-i),e=Li(e-this.center[0]);const r=1e-6,{n,f:s}=this;s>0?i<-lf+r&&(i=-lf+r):i>lf-r&&(i=lf-r);const a=s/Math.pow(Dm(i),n);let c=a*Math.sin(n*e),p=s-a*Math.cos(n*e);return c=.5*(c/Math.PI+.5),p=.5*(p/Math.PI+.5),{x:c,y:this.southernCenter?p:1-p,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:r,f:n}=this,s=n-i,a=Math.sign(s),c=Math.sign(r)*Math.sqrt(e*e+s*s);let p=Math.atan2(e,Math.abs(s))*a;s*r<0&&(p-=Math.PI*Math.sign(e)*a);const _=hi(Ir(p/r)+this.center[0],-180,180),v=hi(Ir(2*Math.atan(Math.pow(n/c,1/r))-lf),-Ks,Ks);return new rr(_,this.southernCenter?-v:v)}}class bx extends uh{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:jo(e),y:ea(i),z:0}}unproject(e,i){const r=TA(e),n=So(i);return new rr(r,n)}}const wx=Li(Ks);class _T extends uh{project(e,i){const r=(i=Li(i))*i,n=r*r;return{x:.5*((e=Li(e))*(.8707-.131979*r+n*(n*(.003971*r-.001529*n)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+r*(.015085+n*(.028874*r-.044475-.005916*n)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let r=i=(2*(1-i)-1)*Math.PI,n=25,s=0,a=r*r;do{a=r*r;const _=a*a;s=(r*(1.007226+a*(.015085+_*(.028874*a-.044475-.005916*_)))-i)/(1.007226+a*(.045255+_*(.259866*a-.311325-.005916*11*_))),r=hi(r-s,-wx,wx)}while(Math.abs(s)>1e-6&&--n>0);a=r*r;const c=hi(Ir(e/(.8707+a*(a*(a*a*a*(.003971-.001529*a)-.013791)-.131979))),-180,180),p=Ir(r);return new rr(c,p)}}const Tx=Li(Ks);class gT extends uh{project(e,i){i=Li(i),e=Li(e);const r=Math.cos(i),n=2/Math.PI,s=Math.acos(r*Math.cos(e/2)),a=Math.sin(s)/s,c=.5*(e*n+2*r*Math.sin(e/2)/a)||0,p=.5*(i+Math.sin(i)/a)||0;return{x:.5*(c/Math.PI+.5),y:1-.5*(p/Math.PI+1),z:0}}unproject(e,i){let r=e=(2*e-.5)*Math.PI,n=i=(2*(1-i)-1)*Math.PI,s=25;const a=1e-6;let c=0,p=0;do{const _=Math.cos(n),v=Math.sin(n),E=2*v*_,C=v*v,B=_*_,O=Math.cos(r/2),G=Math.sin(r/2),q=2*O*G,$=G*G,J=1-B*O*O,ie=J?1/J:0,re=J?Math.acos(_*O)*Math.sqrt(1/J):0,te=.5*(2*re*_*G+2*r/Math.PI)-e,se=.5*(re*v+n)-i,he=.5*ie*(B*$+re*_*O*C)+1/Math.PI,ve=ie*(q*E/4-re*v*G),be=.125*ie*(E*G-re*v*B*q),Ce=.5*ie*(C*O+re*$*_)+.5,Ne=ve*be-Ce*he;c=(se*ve-te*Ce)/Ne,p=(te*be-se*he)/Ne,r=hi(r-c,-Math.PI,Math.PI),n=hi(n-p,-Tx,Tx)}while((Math.abs(c)>a||Math.abs(p)>a)&&--s>0);return new rr(Ir(r),Ir(n))}}class Ex extends uh{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Li(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:r,cosPhi:n}=this;return{x:Li(e)*n*r+.5,y:-Math.sin(Li(i))/n*r+.5,z:0}}unproject(e,i){const{scale:r,cosPhi:n}=this,s=-(i-.5)/r,a=hi(Ir((e-.5)/r)/n,-180,180),c=Math.asin(hi(s*n,-1,1)),p=hi(Ir(c),-Ks,Ks);return new rr(a,p)}}class yT extends bx{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,r){const n=rh(e,i,r),s=dl(lo(r));return _e.transformMat4(n,n,s),{x:n[0],y:n[1],z:n[2]}}locationPoint(e,i){const r=da(i.lat,i.lng),n=_e.normalize([],r),s=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude,a=On(1,0)*Mt*s;_e.scaleAndAdd(r,r,n,a);const c=ce.identity(new Float64Array(16));return ce.multiply(c,e.pixelMatrix,e.globeMatrix),_e.transformMat4(r,r,c),new At(r[0],r[1])}pixelsPerMeter(e,i){return On(1,0)*i}pixelSpaceConversion(e,i,r){const n=On(1,e)*i,s=Ji(On(1,45)*i,n,r);return this.pixelsPerMeter(e,i)/s}createTileMatrix(e,i,r){const n=Wd(lo(r.canonical));return ce.multiply(new Float64Array(16),e.globeMatrix,n)}createInversionMatrix(e,i){const{center:r}=e,n=dl(lo(i));return ce.rotateY(n,n,Li(r.lng)),ce.rotateX(n,n,Li(r.lat)),ce.scale(n,n,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(n)}pointCoordinate(e,i,r,n){return ka(e,i,r,!0)||new Xr(0,0)}pointCoordinate3D(e,i,r){const n=this.pointCoordinate(e,i,r,0);return[n.x,n.y,n.z]}isPointAboveHorizon(e,i){return!ka(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=function(n,s){const a=n.cameraToCenterDistance,c=n._centerAltitude*s,p=n._camera,_=n._camera.forward(),v=_e.add([],_e.scale([],_,-a),[0,0,c]),E=n.worldSize/(2*Math.PI),C=[0,0,-E],B=n.width/n.height,O=Math.tan(n.fovAboveCenter),G=_e.scale([],p.up(),O),q=_e.scale([],p.right(),O*B),$=_e.normalize([],_e.add([],_e.add([],_,G),q)),J=[];let ie;if(new ps(v,$).closestPointOnSphere(C,E,J)){const re=_e.add([],J,C),te=_e.sub([],re,v);ie=Math.cos(n.fovAboveCenter)*_e.length(te)}else{const re=_e.sub([],v,C),te=_e.sub([],C,v);_e.normalize(te,te);const se=_e.length(re)-E;ie=Math.sqrt(se*(se+2*E));const he=Math.acos(ie/(E+se))-Math.acos(_e.dot(_,te));ie*=Math.cos(he)}return 1.01*ie}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),r=Uo(e.zoom);if(r>0){const n=gx(e,On(1,e.center.lat)*e.worldSize),s=e.worldSize/(2*Math.PI),a=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Ji(i,n+s*(1-Math.cos(a)),Math.pow(r,10))}return i}upVector(e,i,r){return rh(i,r,e,1)}upVectorScale(e){return{metersToTile:hn(nh(lo(e)))}}}function Pm(t){const e=t.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new bx(t);case"equirectangular":return new pT(t);case"naturalEarth":return new _T(t);case"equalEarth":return new fT(t);case"winkelTripel":return new gT(t);case"albers":return i?new Ex(t):new dT(t);case"lambertConformalConic":return i?new Ex(t):new mT(t);case"globe":return new yT(t)}throw new Error(`Invalid projection name: ${t.name}`)}const xT=new ss({"symbol-placement":new si(xt.layout_symbol["symbol-placement"]),"symbol-spacing":new si(xt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new si(xt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new qi(xt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new si(xt.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new si(xt.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new si(xt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new si(xt.layout_symbol["icon-ignore-placement"]),"icon-optional":new si(xt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new si(xt.layout_symbol["icon-rotation-alignment"]),"icon-size":new qi(xt.layout_symbol["icon-size"]),"icon-text-fit":new qi(xt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new qi(xt.layout_symbol["icon-text-fit-padding"]),"icon-image":new qi(xt.layout_symbol["icon-image"]),"icon-rotate":new qi(xt.layout_symbol["icon-rotate"]),"icon-padding":new si(xt.layout_symbol["icon-padding"]),"icon-keep-upright":new si(xt.layout_symbol["icon-keep-upright"]),"icon-offset":new qi(xt.layout_symbol["icon-offset"]),"icon-anchor":new qi(xt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new si(xt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new si(xt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new si(xt.layout_symbol["text-rotation-alignment"]),"text-field":new qi(xt.layout_symbol["text-field"]),"text-font":new qi(xt.layout_symbol["text-font"]),"text-size":new qi(xt.layout_symbol["text-size"]),"text-max-width":new qi(xt.layout_symbol["text-max-width"]),"text-line-height":new qi(xt.layout_symbol["text-line-height"]),"text-letter-spacing":new qi(xt.layout_symbol["text-letter-spacing"]),"text-justify":new qi(xt.layout_symbol["text-justify"]),"text-radial-offset":new qi(xt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new si(xt.layout_symbol["text-variable-anchor"]),"text-anchor":new qi(xt.layout_symbol["text-anchor"]),"text-max-angle":new si(xt.layout_symbol["text-max-angle"]),"text-writing-mode":new si(xt.layout_symbol["text-writing-mode"]),"text-rotate":new qi(xt.layout_symbol["text-rotate"]),"text-padding":new si(xt.layout_symbol["text-padding"]),"text-keep-upright":new si(xt.layout_symbol["text-keep-upright"]),"text-transform":new qi(xt.layout_symbol["text-transform"]),"text-offset":new qi(xt.layout_symbol["text-offset"]),"text-allow-overlap":new si(xt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new si(xt.layout_symbol["text-ignore-placement"]),"text-optional":new si(xt.layout_symbol["text-optional"]),visibility:new si(xt.layout_symbol.visibility)});var Cg={paint:new ss({"icon-opacity":new qi(xt.paint_symbol["icon-opacity"]),"icon-emissive-strength":new qi(xt.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new qi(xt.paint_symbol["text-emissive-strength"]),"icon-color":new qi(xt.paint_symbol["icon-color"]),"icon-halo-color":new qi(xt.paint_symbol["icon-halo-color"]),"icon-halo-width":new qi(xt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new qi(xt.paint_symbol["icon-halo-blur"]),"icon-translate":new si(xt.paint_symbol["icon-translate"]),"icon-translate-anchor":new si(xt.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new qi(xt.paint_symbol["icon-image-cross-fade"]),"text-opacity":new qi(xt.paint_symbol["text-opacity"]),"text-color":new qi(xt.paint_symbol["text-color"],{runtimeType:sn,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new qi(xt.paint_symbol["text-halo-color"]),"text-halo-width":new qi(xt.paint_symbol["text-halo-width"]),"text-halo-blur":new qi(xt.paint_symbol["text-halo-blur"]),"text-translate":new si(xt.paint_symbol["text-translate"]),"text-translate-anchor":new si(xt.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new si(xt.paint_symbol["icon-color-saturation"])}),layout:xT};class Mx{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:$n,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ii(Mx,"FormatSectionOverride",{omit:["defaultValue"]});class zm extends jl{constructor(e,i){super(e,Cg,i)}recalculate(e,i){super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const r=this.layout.get("text-writing-mode");if(r){const n=[];for(const s of r)n.indexOf(s)<0&&n.push(s);this.layout._values["text-writing-mode"]=n}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,i,r,n){const s=this.layout.get(e).evaluate(i,{},r,n),a=this._unevaluatedLayout._values[e];return a.isDataDriven()||Nr(a.value)||!s?s:function(c,p){return p.replace(/{([^{}]+)}/g,(_,v)=>v in c?String(c[v]):"")}(i.properties,s)}createBucket(e){return new V0(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Cg.paint.overridableProperties){if(!zm.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),r=new Mx(i),n=new er(r,i.property.specification);let s=null;s=i.value.kind==="constant"||i.value.kind==="source"?new Rr("source",n):new kn("composite",n,i.value.zoomStops,i.value._interpolationType),this.paint._values[e]=new Is(i.property,s,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,r){return!(!this.layout||i.isDataDriven()||r.isDataDriven())&&zm.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const r=e.get("text-field"),n=Cg.paint.properties[i];let s=!1;const a=c=>{for(const p of c)if(n.overrides&&n.overrides.hasOverride(p))return void(s=!0)};if(r.value.kind==="constant"&&r.value.value instanceof uo)a(r.value.value.sections);else if(r.value.kind==="source"){const c=_=>{s||(_ instanceof Vs&&hs(_.value)===Ja?a(_.value.sections):_ instanceof Yn?a(_.sections):_.eachChild(c))},p=r.value;p._styleExpression&&c(p._styleExpression.expression)}return s}getProgramIds(){const e=this.paint.get("icon-opacity").constantOr(1)!==0,i=this.paint.get("text-opacity").constantOr(1)!==0,r=[];return e&&r.push("symbolIcon"),i&&r.push("symbolSDF"),r}getDefaultProgramParams(e,i){return{config:new lu(this,i),overrideFog:!1}}}const vT=gm.types,bT=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Bm(t,e,i,r,n,s,a,c,p,_,v,E,C){const B=c?Math.min(ch,Math.round(c[0])):0,O=c?Math.min(ch,Math.round(c[1])):0;t.emplaceBack(e,i,Math.round(32*r),Math.round(32*n),s,a,(B<<1)+(p?1:0),O,16*_,16*v,256*E,256*C)}function Lm(t,e,i){t.emplaceBack(e,i)}function Rm(t,e,i,r,n,s,a){t.emplaceBack(e,i,r,n,s,a)}function Fm(t,e,i,r,n){const s=5*e+2;t.float32[s+0]=i,t.float32[s+1]=r,t.float32[s+2]=n}function Af(t,e,i,r,n){t.emplaceBack(e,i,r,n),t.emplaceBack(e,i,r,n),t.emplaceBack(e,i,r,n),t.emplaceBack(e,i,r,n)}function wT(t){for(const e of t.sections)if(N_(e.text))return!0;return!1}class kg{constructor(e){this.layoutVertexArray=new Vf,this.indexArray=new Ys,this.programConfigurations=e,this.segments=new wn,this.dynamicLayoutVertexArray=new Pc,this.opacityVertexArray=new Nf,this.placedSymbolArray=new Tp,this.iconTransitioningVertexArray=new zc,this.globeExtVertexArray=new uc,this.zOffsetVertexArray=new kh}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,i,r,n,s){this.isEmpty()||(r&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,V3.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,U3.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,bT,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,G3.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,N3.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||s)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,j3.members,!0)),this.opacityVertexBuffer.itemSize=1),(r||n)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}Ii(kg,"SymbolBuffers");class Dg{constructor(e,i,r){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new r,this.segments=new wn,this.collisionVertexArray=new jf,this.collisionVertexArrayExt=new Pc}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Z3.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,q3.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Ii(Dg,"CollisionBuffers");class Om{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ce.identity([]),this.placementViewportMatrix=ce.identity([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=xg(this.zoom,i["text-size"]),this.iconSizeData=xg(this.zoom,i["icon-size"]);const r=this.layers[0].layout,n=r.get("symbol-sort-key"),s=r.get("symbol-z-order");this.canOverlap=r.get("text-allow-overlap")||r.get("icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement"),this.sortFeaturesByKey=s!=="viewport-y"&&n.constantOr(1)!==void 0,this.sortFeaturesByY=(s==="viewport-y"||s==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=r.get("text-writing-mode").map(a=>ws[a]),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=r.get("symbol-z-elevate")}createArrays(){this.text=new kg(new dc(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new kg(new dc(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Sp,this.lineVertexArray=new Ip,this.symbolInstances=new Mp}calculateGlyphDependencies(e,i,r,n,s){for(let a=0;a<e.length;a++){const c=e.codePointAt(a);if(c===void 0)break;if(i[c]=!0,n&&s&&c<=65535){const p=D0[e.charAt(a)];p&&(i[p.charCodeAt(0)]=!0)}}}populate(e,i,r,n){const s=this.layers[0],a=s.layout,c=this.projection.name==="globe",p=a.get("text-font"),_=a.get("text-field"),v=a.get("icon-image"),E=(_.value.kind!=="constant"||_.value.value instanceof uo&&!_.value.value.isEmpty()||_.value.value.toString().length>0)&&(p.value.kind!=="constant"||p.value.value.length>0),C=v.value.kind!=="constant"||!!v.value.value||Object.keys(v.parameters).length>0,B=a.get("symbol-sort-key");if(this.features=[],!E&&!C)return;const O=i.iconDependencies,G=i.glyphDependencies,q=i.availableImages,$=new ds(this.zoom);for(const{feature:J,id:ie,index:re,sourceLayerIndex:te}of e){const se=s._featureFilter.needGeometry,he=oh(J,se);if(!s._featureFilter.filter($,he,r))continue;if(se||(he.geometry=uu(J,r,n)),c&&J.type!==1&&r.z<=5){const Ne=he.geometry,je=.98078528056,Ye=(Re,rt)=>{const lt=rh(Re.x,Re.y,r,1),vt=rh(rt.x,rt.y,r,1);return _e.dot(lt,vt)<je};for(let Re=0;Re<Ne.length;Re++)Ne[Re]=P2(Ne[Re],Ye)}let ve,be;if(E){const Ne=s.getValueAndResolveTokens("text-field",he,r,q),je=uo.factory(Ne);wT(je)&&(this.hasRTLText=!0),(!this.hasRTLText||Rf()==="unavailable"||this.hasRTLText&&vA.isParsed())&&(ve=W3(je,s,he))}if(C){const Ne=s.getValueAndResolveTokens("icon-image",he,r,q);be=Ne instanceof so?Ne:so.fromString(Ne)}if(!ve&&!be)continue;const Ce=this.sortFeaturesByKey?B.evaluate(he,{},r):void 0;if(this.features.push({id:ie,text:ve,icon:be,index:re,sourceLayerIndex:te,geometry:he.geometry,properties:J.properties,type:vT[J.type],sortKey:Ce}),be&&(O[be.namePrimary]=!0,be.nameSecondary&&(O[be.nameSecondary]=!0)),ve){const Ne=p.evaluate(he,{},r).join(","),je=a.get("text-rotation-alignment")==="map"&&a.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(ws.vertical)>=0;for(const Ye of ve.sections)if(Ye.image)O[Ye.image.namePrimary]=!0;else{const Re=md(ve.toString()),rt=Ye.fontStack||Ne,lt=G[rt]=G[rt]||{};this.calculateGlyphDependencies(Ye.text,lt,je,this.allowVerticalPlacement,Re)}}}a.get("symbol-placement")==="line"&&(this.features=function(J){const ie={},re={},te=[];let se=0;function he(Ne){te.push(J[Ne]),se++}function ve(Ne,je,Ye){const Re=re[Ne];return delete re[Ne],re[je]=Re,te[Re].geometry[0].pop(),te[Re].geometry[0]=te[Re].geometry[0].concat(Ye[0]),Re}function be(Ne,je,Ye){const Re=ie[je];return delete ie[je],ie[Ne]=Re,te[Re].geometry[0].shift(),te[Re].geometry[0]=Ye[0].concat(te[Re].geometry[0]),Re}function Ce(Ne,je,Ye){const Re=Ye?je[0][je[0].length-1]:je[0][0];return`${Ne}:${Re.x}:${Re.y}`}for(let Ne=0;Ne<J.length;Ne++){const je=J[Ne],Ye=je.geometry,Re=je.text?je.text.toString():null;if(!Re){he(Ne);continue}const rt=Ce(Re,Ye),lt=Ce(Re,Ye,!0);if(rt in re&&lt in ie&&re[rt]!==ie[lt]){const vt=be(rt,lt,Ye),it=ve(rt,lt,te[vt].geometry);delete ie[rt],delete re[lt],re[Ce(Re,te[it].geometry,!0)]=it,te[vt].geometry=null}else rt in re?ve(rt,lt,Ye):lt in ie?be(rt,lt,Ye):(he(Ne),ie[rt]=se-1,re[lt]=se-1)}return te.filter(Ne=>Ne.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((J,ie)=>J.sortKey-ie.sortKey)}update(e,i,r,n,s){const a=Object.keys(e).length!==0;if(a&&!this.stateDependentLayers.length)return;const c=a?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(e,i,c,r,n,s),this.icon.programConfigurations.updatePaintArrays(e,i,c,r,n,s)}updateZOffset(){const e=(s,a,c)=>{r+=a,r>s.length&&s.resize(r);for(let p=-a;p<0;p++)s.emplace(p+r,c)},i=(s,a,c)=>{n+=a,n>s.length&&s.resize(n);for(let p=-a;p<0;p++)s.emplace(p+n,c)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let r=0,n=0;for(let s=0;s<this.symbolInstances.length;s++){const a=this.symbolInstances.get(s),{numHorizontalGlyphVertices:c,numVerticalGlyphVertices:p,numIconVertices:_}=a,v=a.zOffset,E=_>0;if((c>0||p>0)&&(e(this.text.zOffsetVertexArray,c,v),e(this.text.zOffsetVertexArray,p,v)),E){const{placedIconSymbolIndex:C,verticalPlacedIconSymbolIndex:B}=a;C>=0&&i(this.icon.zOffsetVertexArray,_,v),B>=0&&i(this.icon.zOffsetVertexArray,a.numVerticalIconVertices,v)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Pm(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const r=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:n,y:s}of i)this.lineVertexArray.emplaceBack(n,s);return{lineStartIndex:r,lineLength:this.lineVertexArray.length-r}}addSymbols(e,i,r,n,s,a,c,p,_,v,E,C,B,O,G,q){const $=e.indexArray,J=e.layoutVertexArray,ie=e.globeExtVertexArray,re=e.segments.prepareSegment(4*i.length,J,$,this.canOverlap?a.sortKey:void 0),te=this.glyphOffsetArray.length,se=re.vertexLength,he=this.allowVerticalPlacement&&c===ws.vertical?Math.PI/2:0,ve=a.text&&a.text.sections;for(let Ce=0;Ce<i.length;Ce++){const{tl:Ne,tr:je,bl:Ye,br:Re,texPrimary:rt,texSecondary:lt,pixelOffsetTL:vt,pixelOffsetBR:it,minFontScaleX:at,minFontScaleY:Tt,glyphOffset:It,isSDF:St,sectionIndex:Lt}=i[Ce],Ot=re.vertexLength,jt=It[1];if(Bm(J,_.x,_.y,Ne.x,jt+Ne.y,rt.x,rt.y,r,St,vt.x,vt.y,at,Tt),Bm(J,_.x,_.y,je.x,jt+je.y,rt.x+rt.w,rt.y,r,St,it.x,vt.y,at,Tt),Bm(J,_.x,_.y,Ye.x,jt+Ye.y,rt.x,rt.y+rt.h,r,St,vt.x,it.y,at,Tt),Bm(J,_.x,_.y,Re.x,jt+Re.y,rt.x+rt.w,rt.y+rt.h,r,St,it.x,it.y,at,Tt),p){const{x:Dt,y:Kt,z:mi}=p.anchor,[_i,Ti,Mi]=p.up;Rm(ie,Dt,Kt,mi,_i,Ti,Mi),Rm(ie,Dt,Kt,mi,_i,Ti,Mi),Rm(ie,Dt,Kt,mi,_i,Ti,Mi),Rm(ie,Dt,Kt,mi,_i,Ti,Mi),Af(e.dynamicLayoutVertexArray,Dt,Kt,mi,he)}else Af(e.dynamicLayoutVertexArray,_.x,_.y,_.z,he);if(q){const Dt=lt||rt;Lm(e.iconTransitioningVertexArray,Dt.x,Dt.y),Lm(e.iconTransitioningVertexArray,Dt.x+Dt.w,Dt.y),Lm(e.iconTransitioningVertexArray,Dt.x,Dt.y+Dt.h),Lm(e.iconTransitioningVertexArray,Dt.x+Dt.w,Dt.y+Dt.h)}$.emplaceBack(Ot,Ot+1,Ot+2),$.emplaceBack(Ot+1,Ot+2,Ot+3),re.vertexLength+=4,re.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(It[0]),Ce!==i.length-1&&Lt===i[Ce+1].sectionIndex||e.programConfigurations.populatePaintArrays(J.length,a,a.index,{},B,O,G,ve&&ve[Lt])}const be=p?p.anchor:_;e.placedSymbolArray.emplaceBack(be.x,be.y,be.z,_.x,_.y,te,this.glyphOffsetArray.length-te,se,v,E,_.segment,r?r[0]:0,r?r[1]:0,n[0],n[1],c,0,!1,0,C,0)}_commitLayoutVertex(e,i,r,n,s,a,c){e.emplaceBack(i,r,n,s,a,Math.round(c.x),Math.round(c.y))}_addCollisionDebugVertices(e,i,r,n,s,a,c){const p=r.segments.prepareSegment(4,r.layoutVertexArray,r.indexArray),_=p.vertexLength,v=c.tileAnchorX,E=c.tileAnchorY;for(let B=0;B<4;B++)r.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(r.collisionVertexArrayExt,i,e.padding,c.zOffset),this._commitLayoutVertex(r.layoutVertexArray,n,s,a,v,E,new At(e.x1,e.y1)),this._commitLayoutVertex(r.layoutVertexArray,n,s,a,v,E,new At(e.x2,e.y1)),this._commitLayoutVertex(r.layoutVertexArray,n,s,a,v,E,new At(e.x2,e.y2)),this._commitLayoutVertex(r.layoutVertexArray,n,s,a,v,E,new At(e.x1,e.y2)),p.vertexLength+=4;const C=r.indexArray;C.emplaceBack(_,_+1),C.emplaceBack(_+1,_+2),C.emplaceBack(_+2,_+3),C.emplaceBack(_+3,_),p.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,r,n,s,a){for(let c=n;c<s;c++){const p=r.get(c),_=this.getSymbolInstanceTextSize(e,a,i,c);this._addCollisionDebugVertices(p,_,this.textCollisionBox,p.projectedAnchorX,p.projectedAnchorY,p.projectedAnchorZ,a)}}_addIconDebugCollisionBoxes(e,i,r,n,s,a){for(let c=n;c<s;c++){const p=r.get(c),_=this.getSymbolInstanceIconSize(e,i,a.placedIconSymbolIndex);this._addCollisionDebugVertices(p,_,this.iconCollisionBox,p.projectedAnchorX,p.projectedAnchorY,p.projectedAnchorZ,a)}}generateCollisionDebugBuffers(e,i){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Dg(wd,X1.members,zc),this.iconCollisionBox=new Dg(wd,X1.members,zc);const r=hu(this.iconSizeData,e),n=hu(this.textSizeData,e);for(let s=0;s<this.symbolInstances.length;s++){const a=this.symbolInstances.get(s);this._addTextDebugCollisionBoxes(n,e,i,a.textBoxStartIndex,a.textBoxEndIndex,a),this._addTextDebugCollisionBoxes(n,e,i,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a),this._addIconDebugCollisionBoxes(r,e,i,a.iconBoxStartIndex,a.iconBoxEndIndex,a),this._addIconDebugCollisionBoxes(r,e,i,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex,a)}}getSymbolInstanceTextSize(e,i,r,n){const s=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:n),a=k0(this.textSizeData,e,s)/fa;return this.tilePixelRatio*a}getSymbolInstanceIconSize(e,i,r){const n=this.icon.placedSymbolArray.get(r),s=k0(this.iconSizeData,e,n);return this.tilePixelRatio*s}_commitDebugCollisionVertexUpdate(e,i,r,n){e.emplaceBack(i,-r,-r,n),e.emplaceBack(i,r,-r,n),e.emplaceBack(i,r,r,n),e.emplaceBack(i,-r,r,n)}_updateTextDebugCollisionBoxes(e,i,r,n,s,a){for(let c=n;c<s;c++){const p=r.get(c),_=this.getSymbolInstanceTextSize(e,a,i,c);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,_,p.padding,a.zOffset)}}_updateIconDebugCollisionBoxes(e,i,r,n,s,a){for(let c=n;c<s;c++){const p=r.get(c),_=this.getSymbolInstanceIconSize(e,i,a.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,_,p.padding,a.zOffset)}}updateCollisionDebugBuffers(e,i){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const r=hu(this.iconSizeData,e),n=hu(this.textSizeData,e);for(let s=0;s<this.symbolInstances.length;s++){const a=this.symbolInstances.get(s);this._updateTextDebugCollisionBoxes(n,e,i,a.textBoxStartIndex,a.textBoxEndIndex,a),this._updateTextDebugCollisionBoxes(n,e,i,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a),this._updateIconDebugCollisionBoxes(r,e,i,a.iconBoxStartIndex,a.iconBoxEndIndex,a),this._updateIconDebugCollisionBoxes(r,e,i,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex,a)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,r,n,s,a,c,p,_){const v={};if(i<r){const{x1:E,y1:C,x2:B,y2:O,padding:G,projectedAnchorX:q,projectedAnchorY:$,projectedAnchorZ:J,tileAnchorX:ie,tileAnchorY:re,featureIndex:te}=e.get(i);v.textBox={x1:E,y1:C,x2:B,y2:O,padding:G,projectedAnchorX:q,projectedAnchorY:$,projectedAnchorZ:J,tileAnchorX:ie,tileAnchorY:re},v.textFeatureIndex=te}if(n<s){const{x1:E,y1:C,x2:B,y2:O,padding:G,projectedAnchorX:q,projectedAnchorY:$,projectedAnchorZ:J,tileAnchorX:ie,tileAnchorY:re,featureIndex:te}=e.get(n);v.verticalTextBox={x1:E,y1:C,x2:B,y2:O,padding:G,projectedAnchorX:q,projectedAnchorY:$,projectedAnchorZ:J,tileAnchorX:ie,tileAnchorY:re},v.verticalTextFeatureIndex=te}if(a<c){const{x1:E,y1:C,x2:B,y2:O,padding:G,projectedAnchorX:q,projectedAnchorY:$,projectedAnchorZ:J,tileAnchorX:ie,tileAnchorY:re,featureIndex:te}=e.get(a);v.iconBox={x1:E,y1:C,x2:B,y2:O,padding:G,projectedAnchorX:q,projectedAnchorY:$,projectedAnchorZ:J,tileAnchorX:ie,tileAnchorY:re},v.iconFeatureIndex=te}if(p<_){const{x1:E,y1:C,x2:B,y2:O,padding:G,projectedAnchorX:q,projectedAnchorY:$,projectedAnchorZ:J,tileAnchorX:ie,tileAnchorY:re,featureIndex:te}=e.get(p);v.verticalIconBox={x1:E,y1:C,x2:B,y2:O,padding:G,projectedAnchorX:q,projectedAnchorY:$,projectedAnchorZ:J,tileAnchorX:ie,tileAnchorY:re},v.verticalIconFeatureIndex=te}return v}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const r=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,r.textBoxStartIndex,r.textBoxEndIndex,r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r.iconBoxStartIndex,r.iconBoxEndIndex,r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,i){const r=e.placedSymbolArray.get(i),n=r.vertexStartIndex+4*r.numGlyphs;for(let s=r.vertexStartIndex;s<n;s+=4)e.indexArray.emplaceBack(s,s+1,s+2),e.indexArray.emplaceBack(s+1,s+2,s+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),r=Math.cos(e),n=[],s=[],a=[];for(let c=0;c<this.symbolInstances.length;++c){a.push(c);const p=this.symbolInstances.get(c);n.push(0|Math.round(i*p.tileAnchorX+r*p.tileAnchorY)),s.push(p.featureIndex)}return a.sort((c,p)=>n[c]-n[p]||s[p]-s[c]),a}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,i)=>this.symbolInstances.get(i).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,i){const r=this.sortKeyRanges[this.sortKeyRanges.length-1];r&&r.sortKey===i?r.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const r=this.symbolInstances.get(i);this.featureSortOrder.push(r.featureIndex);const{rightJustifiedTextSymbolIndex:n,centerJustifiedTextSymbolIndex:s,leftJustifiedTextSymbolIndex:a,verticalPlacedTextSymbolIndex:c,placedIconSymbolIndex:p,verticalPlacedIconSymbolIndex:_}=r;n>=0&&this.addIndicesForPlacedSymbol(this.text,n),s>=0&&s!==n&&this.addIndicesForPlacedSymbol(this.text,s),a>=0&&a!==s&&a!==n&&this.addIndicesForPlacedSymbol(this.text,a),c>=0&&this.addIndicesForPlacedSymbol(this.text,c),p>=0&&this.addIndicesForPlacedSymbol(this.icon,p),_>=0&&this.addIndicesForPlacedSymbol(this.icon,_)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Ii(Om,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Om.MAX_GLYPHS=65535,Om.addDynamicAttributes=Af;var V0=Om;const TT=un([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:ET}=TT,MT=un([{name:"a_packed",components:4,type:"Float32"}]),{members:ST}=MT,IT=gm.types,CT=Math.cos(Math.PI/180*37.5);class Vm{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new xd,this.layoutVertexArray2=new Pc,this.indexArray=new Ys,this.programConfigurations=new dc(e.layers,e.zoom),this.segments=new wn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,r,n){this.hasPattern=pg("line",this.layers,i);const s=this.layers[0].layout.get("line-sort-key"),a=[];for(const{feature:v,id:E,index:C,sourceLayerIndex:B}of e){const O=this.layers[0]._featureFilter.needGeometry,G=oh(v,O);if(!this.layers[0]._featureFilter.filter(new ds(this.zoom),G,r))continue;const q=s?s.evaluate(G,{},r):void 0,$={id:E,properties:v.properties,type:v.type,sourceLayerIndex:B,index:C,geometry:O?G.geometry:uu(v,r,n),patterns:{},sortKey:q};a.push($)}s&&a.sort((v,E)=>v.sortKey-E.sortKey);const{lineAtlas:c,featureIndex:p}=i,_=this.addConstantDashes(c);for(const v of a){const{geometry:E,index:C,sourceLayerIndex:B}=v;if(_&&this.addFeatureDashes(v,c),this.hasPattern){const O=mg("line",this.layers,v,this.zoom,i);this.patternFeatures.push(O)}else this.addFeature(v,E,C,r,c.positions,i.availableImages,i.brightness);p.insert(e[C].feature,E,C,B,this.index)}}addConstantDashes(e){let i=!1;for(const r of this.layers){const n=r.paint.get("line-dasharray").value,s=r.layout.get("line-cap").value;if(n.kind!=="constant"||s.kind!=="constant")i=!0;else{const a=s.value,c=n.value;if(!c)continue;e.addDash(c,a)}}return i}addFeatureDashes(e,i){const r=this.zoom;for(const n of this.layers){const s=n.paint.get("line-dasharray").value,a=n.layout.get("line-cap").value;if(s.kind==="constant"&&a.kind==="constant")continue;let c,p;if(s.kind==="constant"){if(c=s.value,!c)continue}else c=s.evaluate({zoom:r},e);p=a.kind==="constant"?a.value:a.evaluate({zoom:r},e),i.addDash(c,p),e.patterns[n.id]=i.getKey(c,p)}}update(e,i,r,n,s){const a=Object.keys(e).length!==0;a&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,i,a?this.stateDependentLayers:this.layers,r,n,s)}addFeatures(e,i,r,n,s,a){for(const c of this.patternFeatures)this.addFeature(c,c.geometry,c.index,i,r,n,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,ST)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ET),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,r,n,s,a,c){const p=this.layers[0].layout,_=p.get("line-join").evaluate(e,{}),v=p.get("line-cap").evaluate(e,{}),E=p.get("line-miter-limit"),C=p.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const B of i)this.addLine(B,e,_,v,E,C);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,s,a,n,c)}addLine(e,i,r,n,s,a){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let $=0;$<e.length-1;$++)this.totalDistance+=e[$].dist(e[$+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const c=IT[i.type]==="Polygon";let p=e.length;for(;p>=2&&e[p-1].equals(e[p-2]);)p--;let _=0;for(;_<p-1&&e[_].equals(e[_+1]);)_++;if(p<(c?3:2))return;r==="bevel"&&(s=1.05);const v=this.overscaling<=16?15*Mt/(512*this.overscaling):0,E=this.segments.prepareSegment(10*p,this.layoutVertexArray,this.indexArray);let C,B,O,G,q;this.e1=this.e2=-1,c&&(C=e[p-2],q=e[_].sub(C)._unit()._perp());for(let $=_;$<p;$++){if(O=$===p-1?c?e[_+1]:void 0:e[$+1],O&&e[$].equals(O))continue;q&&(G=q),C&&(B=C),C=e[$],q=O?O.sub(C)._unit()._perp():G,G=G||q;let J=G.add(q);J.x===0&&J.y===0||J._unit();const ie=G.x*q.x+G.y*q.y,re=J.x*q.x+J.y*q.y,te=re!==0?1/re:1/0,se=2*Math.sqrt(2-2*re),he=re<CT&&B&&O,ve=G.x*q.y-G.y*q.x>0;if(he&&$>_){const Ne=C.dist(B);if(Ne>2*v){const je=C.sub(C.sub(B)._mult(v/Ne)._round());this.updateDistance(B,je),this.addCurrentVertex(je,G,0,0,E),B=je}}const be=B&&O;let Ce=be?r:c?"butt":n;if(be&&Ce==="round"&&(te<a?Ce="miter":te<=2&&(Ce="fakeround")),Ce==="miter"&&te>s&&(Ce="bevel"),Ce==="bevel"&&(te>2&&(Ce="flipbevel"),te<s&&(Ce="miter")),B&&this.updateDistance(B,C),Ce==="miter")J._mult(te),this.addCurrentVertex(C,J,0,0,E);else if(Ce==="flipbevel"){if(te>100)J=q.mult(-1);else{const Ne=te*G.add(q).mag()/G.sub(q).mag();J._perp()._mult(Ne*(ve?-1:1))}this.addCurrentVertex(C,J,0,0,E),this.addCurrentVertex(C,J.mult(-1),0,0,E)}else if(Ce==="bevel"||Ce==="fakeround"){const Ne=-Math.sqrt(te*te-1),je=ve?Ne:0,Ye=ve?0:Ne;if(B&&this.addCurrentVertex(C,G,je,Ye,E),Ce==="fakeround"){const Re=Math.round(180*se/Math.PI/20);for(let rt=1;rt<Re;rt++){let lt=rt/Re;if(lt!==.5){const it=lt-.5;lt+=lt*it*(lt-1)*((1.0904+ie*(ie*(3.55645-1.43519*ie)-3.2452))*it*it+(.848013+ie*(.215638*ie-1.06021)))}const vt=q.sub(G)._mult(lt)._add(G)._unit()._mult(ve?-1:1);this.addHalfVertex(C,vt.x,vt.y,!1,ve,0,E)}}O&&this.addCurrentVertex(C,q,-je,-Ye,E)}else if(Ce==="butt")this.addCurrentVertex(C,J,0,0,E);else if(Ce==="square"){const Ne=B?1:-1;B||this.addCurrentVertex(C,J,Ne,Ne,E),this.addCurrentVertex(C,J,0,0,E),B&&this.addCurrentVertex(C,J,Ne,Ne,E)}else Ce==="round"&&(B&&(this.addCurrentVertex(C,G,0,0,E),this.addCurrentVertex(C,G,1,1,E,!0)),O&&(this.addCurrentVertex(C,q,-1,-1,E,!0),this.addCurrentVertex(C,q,0,0,E)));if(he&&$<p-1){const Ne=C.dist(O);if(Ne>2*v){const je=C.add(O.sub(C)._mult(v/Ne)._round());this.updateDistance(C,je),this.addCurrentVertex(je,q,0,0,E),C=je}}}}addCurrentVertex(e,i,r,n,s,a=!1){const c=i.y*n-i.x,p=-i.y-i.x*n;this.addHalfVertex(e,i.x+i.y*r,i.y-i.x*r,a,!1,r,s),this.addHalfVertex(e,c,p,a,!0,-n,s)}addHalfVertex({x:e,y:i},r,n,s,a,c,p){this.layoutVertexArray.emplaceBack((e<<1)+(s?1:0),(i<<1)+(a?1:0),Math.round(63*r)+128,Math.round(63*n)+128,1+(c===0?0:c<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const _=p.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,_),p.primitiveLength++),a?this.e2=_:this.e1=_}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,i){this.distance+=e.dist(i),this.updateScaledDistance()}}Ii(Vm,"LineBucket",{omit:["layers","patternFeatures"]});class ks{constructor(e,i,r,n){this.context=e,this.format=r,this.texture=e.gl.createTexture(),this.update(i,n)}update(e,i,r){const{width:n,height:s}=e,{context:a}=this,{gl:c}=a,{HTMLImageElement:p,HTMLCanvasElement:_,HTMLVideoElement:v,ImageData:E,ImageBitmap:C}=me;if(c.bindTexture(c.TEXTURE_2D,this.texture),a.pixelStoreUnpackFlipY.set(!1),a.pixelStoreUnpack.set(1),a.pixelStoreUnpackPremultiplyAlpha.set(this.format===c.RGBA&&(!i||i.premultiply!==!1)),r||this.size&&this.size[0]===n&&this.size[1]===s){const{x:B,y:O}=r||{x:0,y:0};if(e instanceof p||e instanceof _||e instanceof v||e instanceof E||C&&e instanceof C)c.texSubImage2D(c.TEXTURE_2D,0,B,O,c.RGBA,c.UNSIGNED_BYTE,e);else{let G=this.format,q=c.UNSIGNED_BYTE;this.format===c.R32F&&(G=c.RED,q=c.FLOAT),c.texSubImage2D(c.TEXTURE_2D,0,B,O,n,s,G,q,e.data)}}else if(this.size=[n,s],e instanceof p||e instanceof _||e instanceof v||e instanceof E||C&&e instanceof C){let B=this.format;this.format===c.R8&&(B=c.RED),c.texImage2D(c.TEXTURE_2D,0,this.format,B,c.UNSIGNED_BYTE,e)}else{let B=this.format,O=this.format,G=c.UNSIGNED_BYTE;this.format===c.DEPTH_COMPONENT&&(B=c.DEPTH_COMPONENT16,G=c.UNSIGNED_SHORT),this.format===c.R32F&&(G=c.FLOAT,O=c.RED),c.texImage2D(c.TEXTURE_2D,0,B,n,s,0,O,G,e.data)}this.useMipmap=!!(i&&i.useMipmap),this.useMipmap&&c.generateMipmap(c.TEXTURE_2D)}bind(e,i){const{context:r}=this,{gl:n}=r;n.bindTexture(n.TEXTURE_2D,this.texture),e!==this.minFilter&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,this.useMipmap?e===n.NEAREST?n.NEAREST_MIPMAP_NEAREST:n.LINEAR_MIPMAP_NEAREST:e),this.minFilter=e),i!==this.wrapS&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,i),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,i),this.wrapS=i)}bindExtraParam(e,i,r,n){const{context:s}=this,{gl:a}=s;a.bindTexture(a.TEXTURE_2D,this.texture),i!==this.magFilter&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,i),this.magFilter=i),e!==this.minFilter&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,this.useMipmap?e===a.NEAREST?a.NEAREST_MIPMAP_NEAREST:a.LINEAR_MIPMAP_NEAREST:e),this.minFilter=e),r!==this.wrapS&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,r),this.wrapS=r),n!==this.wrapT&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,n),this.wrapT=n)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Nm{constructor(e,i){this.context=e,this.texture=i}bind(e,i){const{context:r}=this,{gl:n}=r;n.bindTexture(n.TEXTURE_2D,this.texture),e!==this.minFilter&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,e),this.minFilter=e),i!==this.wrapS&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,i),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,i),this.wrapS=i)}}const yc=32,du=33,hh=new Uint16Array(8184);for(let t=0;t<2046;t++){let e=t+2,i=0,r=0,n=0,s=0,a=0,c=0;for(1&e?n=s=a=yc:i=r=c=yc;(e>>=1)>1;){const _=i+n>>1,v=r+s>>1;1&e?(n=i,s=r,i=a,r=c):(i=n,r=s,n=a,s=c),a=_,c=v}const p=4*t;hh[p+0]=i,hh[p+1]=r,hh[p+2]=n,hh[p+3]=s}const fu=new Uint16Array(2178),dh=new Uint8Array(1089),Um=new Uint16Array(1089);function Sx(t){return t===0?-.03125:t===32?.03125:0}var Pg=un([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const Ix={type:2,extent:Mt,loadGeometry:()=>[[new At(0,0),new At(Mt+1,0),new At(Mt+1,Mt+1),new At(0,Mt+1),new At(0,0)]]};class N0{constructor(e,i,r,n,s){this.tileID=e,this.uid=Es(),this.uses=0,this.tileSize=i,this.tileZoom=r,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=s,n&&n.style&&(this._lastUpdatedBrightness=n.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",n&&n.transform&&(this.projection=n.transform.projection)}registerFadeDuration(e){const i=e+this.timeAdded;i<Xi.now()||this.fadeEndTime&&i<this.fadeEndTime||(this.fadeEndTime=i)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=$h(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,i,r){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(n,s){const a={};if(!s)return a;for(const c of n){const p=c.layerIds.map(_=>s.getLayer(_)).filter(Boolean);if(p.length!==0){c.layers=p,c.stateDependentLayerIds&&(c.stateDependentLayers=c.stateDependentLayerIds.map(_=>p.filter(v=>v.id===_)[0]));for(const _ of p)a[_.fqid]=c}}return a}(e.buckets,i.style),this.hasSymbolBuckets=!1;for(const n in this.buckets){const s=this.buckets[n];if(s instanceof V0){if(this.hasSymbolBuckets=!0,!r)break;s.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const n in this.buckets){const s=this.buckets[n];if(s instanceof V0&&s.hasRTLText){this.hasRTLText=!0,vA.isLoading()||vA.isLoaded()||Rf()!=="deferred"||yp();break}}this.queryPadding=0;for(const n in this.buckets){const s=this.buckets[n],a=i.style.getOwnLayer(n);if(!a)continue;const c=a.queryRadius(s);this.queryPadding=Math.max(this.queryPadding,c)}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas),this._lastUpdatedBrightness=e.brightness}else this.collisionBoxArray=new ku}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.fqid]}upload(e){for(const r in this.buckets){const n=this.buckets[r];n.uploadPending()&&n.upload(e)}const i=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ks(e,this.imageAtlas.image,i.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ks(e,this.glyphAtlasImage,i.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new ks(e,this.lineAtlas.image,i.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e,i,r){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture,r),!i||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const n=i.style.getBrightness();(this._lastUpdatedBrightness||n)&&(this._lastUpdatedBrightness&&n&&Math.abs(this._lastUpdatedBrightness-n)<.001||(this._lastUpdatedBrightness=n,this.updateBuckets(void 0,i)))}queryRenderedFeatures(e,i,r,n,s,a,c,p){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:n,pixelPosMatrix:c,transform:a,params:s,tileTransform:this.tileTransform},e,i,r):{}}querySourceFeatures(e,i){const r=this.latestFeatureIndex;if(!r||!r.rawTileData)return;const n=r.loadVTLayers(),s=i?i.sourceLayer:"",a=n._geojsonTileLayer||n[s];if(!a)return;const c=ao(i&&i.filter),{z:p,x:_,y:v}=this.tileID.canonical,E={z:p,x:_,y:v};for(let C=0;C<a.length;C++){const B=a.feature(C);if(c.needGeometry){const q=oh(B,!0);if(!c.filter(new ds(this.tileID.overscaledZ),q,this.tileID.canonical))continue}else if(!c.filter(new ds(this.tileID.overscaledZ),B))continue;const O=r.getId(B,s),G=new U1(B,p,_,v,O);G.tile=E,e.push(G)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}bucketsLoaded(){for(const e in this.buckets)if(this.buckets[e].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const i=this.expirationTime;if(e.cacheControl){const r=Oi(e.cacheControl);r["max-age"]&&(this.expirationTime=Date.now()+1e3*r["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const r=Date.now();let n=!1;if(this.expirationTime>r)n=!1;else if(i)if(this.expirationTime<i)n=!0;else{const s=this.expirationTime-i;s?this.expirationTime=r+Math.max(s,3e4):n=!0}else n=!0;n?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,i){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(e).length!==0&&i&&this.updateBuckets(e,i)}updateBuckets(e,i){if(!this.latestFeatureIndex)return;const r=this.latestFeatureIndex.loadVTLayers(),n=i.style.listImages(),s=i.style.getBrightness();for(const a in this.buckets){if(!i.style.hasLayer(a))continue;const c=this.buckets[a],p=c.layers[0].sourceLayer||"_geojsonTileLayer",_=r[p];let v={};if(e&&(v=e[p],!_||!v||Object.keys(v).length===0))continue;if(c.update(v,_,n,this.imageAtlas&&this.imageAtlas.patternPositions||{},s),c instanceof Vm||c instanceof mm){const C=i.style.getOwnSourceCache(c.layers[0].source);i._terrain&&i._terrain.enabled&&C&&c.programConfigurations.needsUpload&&i._terrain._clearRenderCacheForTile(C.id,this.tileID)}const E=i&&i.style&&i.style.getOwnLayer(a);E&&(this.queryPadding=Math.max(this.queryPadding,E.queryRadius(c)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Xi.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Xi.now()+e}setTexture(e,i){const r=i.context,n=r.gl;this.texture=this.texture||i.getTileTexture(e.width),this.texture&&this.texture instanceof ks?this.texture.update(e,{useMipmap:!0}):(this.texture=new ks(r,e,n.RGBA,{useMipmap:!0}),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE))}setDependencies(e,i){const r={};for(const n of i)r[n]=!0;this.dependencies[e]=r}hasDependency(e,i){for(const r of e){const n=this.dependencies[r];if(n){for(const s of i)if(n[s])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,i){if(!i||i.name==="mercator"||this._tileDebugBuffer)return;const r=uu(Ix,this.tileID.canonical,this.tileTransform)[0],n=new ul,s=new Bc;for(let a=0;a<r.length;a++){const{x:c,y:p}=r[a];n.emplaceBack(c,p),s.emplaceBack(a)}s.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(s),this._tileDebugBuffer=e.createVertexBuffer(n,wi.members),this._tileDebugSegments=wn.simpleSegment(0,0,n.length,s.length)}_makeTileBoundsBuffers(e,i){if(this._tileBoundsBuffer||!i||i.name==="mercator")return;const r=uu(Ix,this.tileID.canonical,this.tileTransform)[0];let n,s;if(this.isRaster){const a=function(c,p){const _=$h(c,p),v=Math.pow(2,c.z);for(let q=0;q<du;q++)for(let $=0;$<du;$++){const J=TA((c.x+($+Sx($))/yc)/v),ie=So((c.y+(q+Sx(q))/yc)/v),re=p.project(J,ie),te=q*du+$;fu[2*te+0]=Math.round((re.x*_.scale-_.x)*Mt),fu[2*te+1]=Math.round((re.y*_.scale-_.y)*Mt)}dh.fill(0),Um.fill(0);for(let q=2045;q>=0;q--){const $=4*q,J=hh[$+0],ie=hh[$+1],re=hh[$+2],te=hh[$+3],se=J+re>>1,he=ie+te>>1,ve=se+he-ie,be=he+J-se,Ce=ie*du+J,Ne=te*du+re,je=he*du+se,Ye=Math.hypot((fu[2*Ce+0]+fu[2*Ne+0])/2-fu[2*je+0],(fu[2*Ce+1]+fu[2*Ne+1])/2-fu[2*je+1])>=16;dh[je]=dh[je]||(Ye?1:0),q<1022&&(dh[je]=dh[je]||dh[(ie+be>>1)*du+(J+ve>>1)]||dh[(te+be>>1)*du+(re+ve>>1)])}const E=new Dc,C=new Ys;let B=0;function O(q,$){const J=$*du+q;return Um[J]===0&&(E.emplaceBack(fu[2*J+0],fu[2*J+1],q*Mt/yc,$*Mt/yc),Um[J]=++B),Um[J]-1}function G(q,$,J,ie,re,te){const se=q+J>>1,he=$+ie>>1;if(Math.abs(q-re)+Math.abs($-te)>1&&dh[he*du+se])G(re,te,q,$,se,he),G(J,ie,re,te,se,he);else{const ve=O(q,$),be=O(J,ie),Ce=O(re,te);C.emplaceBack(ve,be,Ce)}}return G(0,0,yc,yc,yc,0),G(yc,yc,0,0,0,yc),{vertices:E,indices:C}}(this.tileID.canonical,i);n=a.vertices,s=a.indices}else{n=new Dc,s=new Ys;for(const{x:c,y:p}of r)n.emplaceBack(c,p,0,0);const a=pm(n.int16,void 0,4);for(let c=0;c<a.length;c+=3)s.emplaceBack(a[c],a[c+1],a[c+2])}this._tileBoundsBuffer=e.createVertexBuffer(n,Pg.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(s),this._tileBoundsSegments=wn.simpleSegment(0,0,n.length,s.length)}_makeGlobeTileDebugBuffers(e,i){const r=i.projection;if(!r||r.name!=="globe"||i.freezeTileCoverage)return;const n=this.tileID.canonical,s=dl(bA(n,i)),a=Uo(i.zoom);let c;a>0&&(c=ce.invert(new Float64Array(16),i.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,n,i,s,c,a),this._makeGlobeTileDebugTextBuffer(e,n,i,s,c,a)}_globePoint(e,i,r,n,s,a,c){let p=rh(e,i,r);if(a){const _=1<<r.z,v=jo(n.center.lng),E=ea(n.center.lat),C=(r.x+.5)/_-v;let B=0;C>.5?B=-1:C<-.5&&(B=1);let O=(e/Mt+r.x)/_+B,G=(i/Mt+r.y)/_;O=(O-v)*n._pixelsPerMercatorPixel+v,G=(G-E)*n._pixelsPerMercatorPixel+E;const q=[O*n.worldSize,G*n.worldSize,0];_e.transformMat4(q,q,a),p=ha(p,q,c)}return _e.transformMat4(p,p,s)}_makeGlobeTileDebugBorderBuffer(e,i,r,n,s,a){const c=new ul,p=new Bc,_=new Wu,v=(C,B,O,G,q)=>{const $=(O-C)/(q-1),J=(G-B)/(q-1),ie=c.length;for(let re=0;re<q;re++){const te=C+re*$,se=B+re*J;c.emplaceBack(te,se);const he=this._globePoint(te,se,i,r,n,s,a);_.emplaceBack(he[0],he[1],he[2]),p.emplaceBack(ie+re)}},E=Mt;v(0,0,E,0,16),v(E,0,E,E,16),v(E,E,0,E,16),v(0,E,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(p),this._tileDebugBuffer=e.createVertexBuffer(c,wi.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(_,Pi.members),this._tileDebugSegments=wn.simpleSegment(0,0,c.length,p.length)}_makeGlobeTileDebugTextBuffer(e,i,r,n,s,a){const c=Mt/4,p=new ul,_=new Ys,v=new Wu,E=25;_.reserve(32),p.reserve(E),v.reserve(E);const C=(B,O)=>E*B+O;for(let B=0;B<E;B++){const O=B*c;for(let G=0;G<E;G++){const q=G*c;p.emplaceBack(q,O);const $=this._globePoint(q,O,i,r,n,s,a);v.emplaceBack($[0],$[1],$[2])}}for(let B=0;B<4;B++)for(let O=0;O<4;O++){const G=C(B,O),q=C(B,O+1),$=C(B+1,O),J=C(B+1,O+1);_.emplaceBack(G,q,$),_.emplaceBack($,q,J)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(_),this._tileDebugTextBuffer=e.createVertexBuffer(p,wi.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(v,Pi.members),this._tileDebugTextSegments=wn.simpleSegment(0,0,E,32)}destroy(e=!1){for(const i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!e&&this.texture&&this.texture instanceof ks&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.latestFeatureIndex=null,this.state="unloaded"}}class kT{constructor(e,i){this.max=e,this.onRemove=i,this.reset()}reset(){for(const e in this.data)for(const i of this.data[e])i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value);return this.data={},this.order=[],this}add(e,i,r){const n=e.wrapped().key;this.data[n]===void 0&&(this.data[n]=[]);const s={value:i,timeout:void 0};if(r!==void 0&&(s.timeout=setTimeout(()=>{this.remove(e,s)},r)),this.data[n].push(s),this.order.push(n),this.order.length>this.max){const a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const i=this.data[e].shift();return i.timeout&&clearTimeout(i.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),i.value}getByKey(e){const i=this.data[e];return i?i[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,i){if(!this.has(e))return this;const r=e.wrapped().key,n=i===void 0?0:this.data[r].indexOf(i),s=this.data[r][n];return this.data[r].splice(n,1),s.timeout&&clearTimeout(s.timeout),this.data[r].length===0&&delete this.data[r],this.onRemove(s.value),this.order.splice(this.order.indexOf(r),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const i=this._getAndRemoveByKey(this.order[0]);i&&this.onRemove(i)}return this}filter(e){const i=[];for(const r in this.data)for(const n of this.data[r])e(n.value)||i.push(n);for(const r of i)this.remove(r.value.tileID,r)}}class fh{constructor(e,i,r,n){this.id=fh.uniqueIdxCounter,fh.uniqueIdxCounter++,this.context=e;const s=e.gl;this.buffer=s.createBuffer(),this.dynamicDraw=!!r,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),s.bufferData(s.ELEMENT_ARRAY_BUFFER,i.arrayBuffer,this.dynamicDraw?s.DYNAMIC_DRAW:s.STATIC_DRAW),this.dynamicDraw||n||i.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){this.id=fh.uniqueIdxCounter,fh.uniqueIdxCounter++;const i=this.context.gl;this.context.unbindVAO(),this.bind(),i.bufferSubData(i.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}fh.uniqueIdxCounter=0;const DT={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class PT{constructor(e,i,r,n,s,a){this.length=i.length,this.attributes=r,this.itemSize=i.bytesPerElement,this.dynamicDraw=n,this.instanceCount=a,this.context=e;const c=e.gl;this.buffer=c.createBuffer(),e.bindVertexBuffer.set(this.buffer),c.bufferData(c.ARRAY_BUFFER,i.arrayBuffer,this.dynamicDraw?c.DYNAMIC_DRAW:c.STATIC_DRAW),this.dynamicDraw||s||i.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){const i=this.context.gl;this.bind(),i.bufferSubData(i.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,i){for(let r=0;r<this.attributes.length;r++){const n=i.attributes[this.attributes[r].name];n!==void 0&&e.enableVertexAttribArray(n)}}setVertexAttribPointers(e,i,r){for(let n=0;n<this.attributes.length;n++){const s=this.attributes[n],a=i.attributes[s.name];a!==void 0&&e.vertexAttribPointer(a,s.components,e[DT[s.type]],!1,this.itemSize,s.offset+this.itemSize*(r||0))}}setVertexAttribDivisor(e,i,r){for(let n=0;n<this.attributes.length;n++){const s=i.attributes[this.attributes[n].name];s!==void 0&&this.instanceCount&&this.instanceCount>0&&e.vertexAttribDivisor(s,r)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class ms{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class zT extends ms{getDefault(){return pr.transparent}set(e){const i=this.current;(e.r!==i.r||e.g!==i.g||e.b!==i.b||e.a!==i.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class BT extends ms{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class LT extends ms{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class RT extends ms{getDefault(){return[!0,!0,!0,!0]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||e[2]!==i[2]||e[3]!==i[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class FT extends ms{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class OT extends ms{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class VT extends ms{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const i=this.current;(e.func!==i.func||e.ref!==i.ref||e.mask!==i.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class NT extends ms{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||e[2]!==i[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class UT extends ms{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;e?i.enable(i.STENCIL_TEST):i.disable(i.STENCIL_TEST),this.current=e,this.dirty=!1}}class jT extends ms{getDefault(){return[0,1]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class GT extends ms{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;e?i.enable(i.DEPTH_TEST):i.disable(i.DEPTH_TEST),this.current=e,this.dirty=!1}}class ZT extends ms{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class qT extends ms{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;e?i.enable(i.BLEND):i.disable(i.BLEND),this.current=e,this.dirty=!1}}class QT extends ms{getDefault(){const e=this.gl;return[e.ONE,e.ZERO,e.ONE,e.ZERO]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||e[2]!==i[2]||e[3]!==i[3]||this.dirty)&&(this.gl.blendFuncSeparate(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class HT extends ms{getDefault(){return pr.transparent}set(e){const i=this.current;(e.r!==i.r||e.g!==i.g||e.b!==i.b||e.a!==i.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class WT extends ms{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(e,e),this.current=e,this.dirty=!1)}}class $T extends ms{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;e?i.enable(i.CULL_FACE):i.disable(i.CULL_FACE),this.current=e,this.dirty=!1}}class XT extends ms{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class YT extends ms{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}let KT=class extends ms{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}};class JT extends ms{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class eE extends ms{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||e[2]!==i[2]||e[3]!==i[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class tE extends ms{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.bindFramebuffer(i.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class iE extends ms{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.bindRenderbuffer(i.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class rE extends ms{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.bindTexture(i.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class nE extends ms{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.bindBuffer(i.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class sE extends ms{getDefault(){return null}set(e){const i=this.gl;i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class oE extends ms{getDefault(){return null}set(e){this.gl&&(e!==this.current||this.dirty)&&(this.gl.bindVertexArray(e),this.current=e,this.dirty=!1)}}class aE extends ms{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.pixelStorei(i.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class lE extends ms{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class AE extends ms{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class zg extends ms{constructor(e,i){super(e),this.context=e,this.parent=i}getDefault(){return null}}class cE extends zg{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const i=this.gl;i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class Cx extends zg{attachment(){return this.gl.DEPTH_ATTACHMENT}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const i=this.gl;i.framebufferRenderbuffer(i.FRAMEBUFFER,this.attachment(),i.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class uE extends zg{attachment(){return this.gl.DEPTH_ATTACHMENT}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const i=this.gl;i.framebufferTexture2D(i.FRAMEBUFFER,this.attachment(),i.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class hE extends Cx{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class dE{constructor(e,i,r,n,s){this.context=e,this.width=i,this.height=r;const a=this.framebuffer=e.gl.createFramebuffer();n&&(this.colorAttachment=new cE(e,a)),s&&(this.depthAttachmentType=s,this.depthAttachment=s==="renderbuffer"?new Cx(e,a):new uE(e,a))}destroy(){const e=this.context.gl;if(this.colorAttachment){const i=this.colorAttachment.get();i&&e.deleteTexture(i)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const i=this.depthAttachment.get();i&&e.deleteRenderbuffer(i)}else{const i=this.depthAttachment.get();i&&e.deleteTexture(i)}e.deleteFramebuffer(this.framebuffer)}}class cr{constructor(e,i,r){this.func=e,this.mask=i,this.range=r}}cr.ReadOnly=!1,cr.ReadWrite=!0,cr.disabled=new cr(519,cr.ReadOnly,[0,1]);const Bg=7680;class Lr{constructor(e,i,r,n,s,a){this.test=e,this.ref=i,this.mask=r,this.fail=n,this.depthFail=s,this.pass=a}}Lr.disabled=new Lr({func:519,mask:0},0,0,Bg,Bg,Bg);const jm=771;class dn{constructor(e,i,r,n){this.blendFunction=e,this.blendColor=i,this.mask=r,this.blendEquation=n}}dn.Replace=[1,0,1,0],dn.disabled=new dn(dn.Replace,pr.transparent,[!1,!1,!1,!1]),dn.unblended=new dn(dn.Replace,pr.transparent,[!0,!0,!0,!0]),dn.alphaBlended=new dn([1,jm,1,jm],pr.transparent,[!0,!0,!0,!0]),dn.multiply=new dn([774,0,774,0],pr.transparent,[!0,!0,!0,!0]);const Lg=1029,Rg=2305;class Or{constructor(e,i,r){this.enable=e,this.mode=i,this.frontFace=r}}Or.disabled=new Or(!1,Lg,Rg),Or.backCCW=new Or(!0,Lg,Rg),Or.backCW=new Or(!0,Lg,2304),Or.frontCW=new Or(!0,1028,2304),Or.frontCCW=new Or(!0,1028,Rg);class fE{constructor(e,i){this.gl=e,this.clearColor=new zT(this),this.clearDepth=new BT(this),this.clearStencil=new LT(this),this.colorMask=new RT(this),this.depthMask=new FT(this),this.stencilMask=new OT(this),this.stencilFunc=new VT(this),this.stencilOp=new NT(this),this.stencilTest=new UT(this),this.depthRange=new jT(this),this.depthTest=new GT(this),this.depthFunc=new ZT(this),this.blend=new qT(this),this.blendFunc=new QT(this),this.blendColor=new HT(this),this.blendEquation=new WT(this),this.cullFace=new $T(this),this.cullFaceSide=new XT(this),this.frontFace=new YT(this),this.program=new KT(this),this.activeTexture=new JT(this),this.viewport=new eE(this),this.bindFramebuffer=new tE(this),this.bindRenderbuffer=new iE(this),this.bindTexture=new rE(this),this.bindVertexBuffer=new nE(this),this.bindElementBuffer=new sE(this),this.bindVertexArrayOES=new oE(this),this.pixelStoreUnpack=new aE(this),this.pixelStoreUnpackPremultiplyAlpha=new lE(this),this.pixelStoreUnpackFlipY=new AE(this),this.options=i?{...i}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=e.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=e.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=e.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=e.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=e.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=e.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,i,r){return new fh(this,e,i,r)}createVertexBuffer(e,i,r,n,s){return new PT(this,e,i,r,n,s)}createRenderbuffer(e,i,r){const n=this.gl,s=n.createRenderbuffer();return this.bindRenderbuffer.set(s),n.renderbufferStorage(n.RENDERBUFFER,e,i,r),this.bindRenderbuffer.set(null),s}createFramebuffer(e,i,r,n){return new dE(this,e,i,r,n)}clear({color:e,depth:i,stencil:r,colorMask:n}){const s=this.gl;let a=0;e&&(a|=s.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set(n||[!0,!0,!0,!0])),i!==void 0&&(a|=s.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(i),this.depthMask.set(!0)),r!==void 0&&(a|=s.STENCIL_BUFFER_BIT,this.clearStencil.set(r),this.stencilMask.set(255)),s.clear(a)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){tr(e.blendFunction,dn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor),e.blendEquation?this.blendEquation.set(e.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(e.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}class Hc extends rs{constructor(e,i,r){super(),this.id=e,this._onlySymbols=r,i.on("data",n=>{n.dataType==="source"&&n.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&n.dataType==="source"&&n.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),i.on("error",()=>{this._sourceErrored=!0}),this._source=i,this._tiles={},this._cache=new kT(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=i.minTileCacheSize,this._maxTileCacheSize=i.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this._coveredTiles={},this._shadowCasterTiles={},this._state=new z3,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const i=this._tiles[e];if(i.state!=="errored"&&(i.state!=="loaded"||!i.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,i){return e.isSymbolTile=this._onlySymbols,e.isExtraShadowCaster=this._shadowCasterTiles[e.tileID.key],this._source.loadTile(e,i)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const i in this._tiles){const r=this._tiles[i];r.upload(e),r.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return to(this._tiles).map(e=>e.tileID).sort(kx).map(e=>e.key)}getRenderableIds(e,i){const r=[];for(const n in this._tiles)this._isIdRenderable(+n,e,i)&&r.push(this._tiles[n]);return e?r.sort((n,s)=>{const a=n.tileID,c=s.tileID,p=new At(a.canonical.x,a.canonical.y)._rotate(this.transform.angle),_=new At(c.canonical.x,c.canonical.y)._rotate(this.transform.angle);return a.overscaledZ-c.overscaledZ||_.y-p.y||_.x-p.x}).map(n=>n.tileID.key):r.map(n=>n.tileID).sort(kx).map(n=>n.key)}hasRenderableParent(e){const i=this.findLoadedParent(e,0);return!!i&&this._isIdRenderable(i.tileID.key)}_isIdRenderable(e,i,r){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(i||!this._tiles[e].holdingForFade())&&(r||!this._shadowCasterTiles[e])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,i){const r=this._tiles[e];r&&(r.state!=="loading"&&(r.state=i),this._loadTile(r,this._tileLoaded.bind(this,r,e,i)))}_tileLoaded(e,i,r,n){if(n)if(e.state="errored",n.status!==404)this._source.fire(new ir(n,{tile:e}));else{if(!(e.tileID.key in this._loadedParentTiles))return void this._source.fire(new ei("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id}));if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const s=this.map.painter.terrain;this.update(this.transform,s.getScaledDemTileSize(),!0),s.resetTileLookupCache(this.id)}else this.update(this.transform)}else e.timeAdded=Xi.now(),r==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(i,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new ei("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const i=this.getRenderableIds();for(let n=0;n<i.length;n++){const s=i[n];if(e.neighboringTiles&&e.neighboringTiles[s]){const a=this.getTileByID(s);r(e,a),r(a,e)}}function r(n,s){if(!n.dem||n.dem.borderReady)return;n.needsHillshadePrepare=!0,n.needsDEMTextureUpload=!0;let a=s.tileID.canonical.x-n.tileID.canonical.x;const c=s.tileID.canonical.y-n.tileID.canonical.y,p=Math.pow(2,n.tileID.canonical.z),_=s.tileID.key;a===0&&c===0||Math.abs(c)>1||(Math.abs(a)>1&&(Math.abs(a+p)===1?a+=p:Math.abs(a-p)===1&&(a-=p)),s.dem&&n.dem&&(n.dem.backfillBorder(s.dem,a,c),n.neighboringTiles&&n.neighboringTiles[_]&&(n.neighboringTiles[_].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,i,r,n){for(const s in this._tiles){let a=this._tiles[s];if(n[s]||!a.hasData()||a.tileID.overscaledZ<=i||a.tileID.overscaledZ>r)continue;let c=a.tileID;for(;a&&a.tileID.overscaledZ>i+1;){const _=a.tileID.scaledTo(a.tileID.overscaledZ-1);a=this._tiles[_.key],a&&a.hasData()&&(c=_)}let p=c;for(;p.overscaledZ>i;)if(p=p.scaledTo(p.overscaledZ-1),e[p.key]){n[c.key]=c;break}}}findLoadedParent(e,i){if(e.key in this._loadedParentTiles){const r=this._loadedParentTiles[e.key];return r&&r.tileID.overscaledZ>=i?r:null}for(let r=e.overscaledZ-1;r>=i;r--){const n=e.scaledTo(r),s=this._getLoadedTile(n);if(s)return s}}_getLoadedTile(e){const i=this._tiles[e.key];return i&&i.hasData()?i:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,i){i=i||this._source.tileSize;const r=Math.ceil(e.width/i)+1,n=Math.ceil(e.height/i)+1,s=Math.floor(r*n*5),a=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,s):s,c=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,a):a;this._cache.setMaxSize(c)}handleWrapJump(e){const i=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,i){const r={};for(const n in this._tiles){const s=this._tiles[n];s.tileID=s.tileID.unwrapTo(s.tileID.wrap+i),r[s.tileID.key]=s}this._tiles=r;for(const n in this._timers)clearTimeout(this._timers[n]),delete this._timers[n];for(const n in this._tiles)this._setTileReloadTimer(+n,this._tiles[n])}}update(e,i,r,n){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!r)return;let s;if(this.updateCacheSize(e,i),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?s=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(p=>new fi(p.canonical.z,p.wrap,p.canonical.z,p.canonical.x,p.canonical.y)):(s=e.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!r,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(s=s.filter(p=>this._source.hasTile(p)))):s=[],s.length>0&&this.castsShadows&&n&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Fg(this._source.type)){const p=e.coveringZoomLevel({tileSize:i||this._source.tileSize,roundZoom:this._source.roundZoom&&!r}),_=Math.min(p,this._source.maxzoom),v=e.extendTileCoverForShadows(s,n,_);for(const E of v)this._shadowCasterTiles[E.key]=!0,s.push(E)}const a=this._updateRetainedTiles(s);if(Fg(this._source.type)&&s.length!==0){const p={},_={},v=Object.keys(a);for(const C of v){const B=a[C],O=this._tiles[C];if(!O||O.fadeEndTime&&O.fadeEndTime<=Xi.now())continue;const G=this.findLoadedParent(B,Math.max(B.overscaledZ-Hc.maxOverzooming,this._source.minzoom));G&&(this._addTile(G.tileID),p[G.tileID.key]=G.tileID),_[C]=B}const E=s[s.length-1].overscaledZ;for(const C in this._tiles){const B=this._tiles[C];if(a[C]||!B.hasData())continue;let O=B.tileID;for(;O.overscaledZ>E;){O=O.scaledTo(O.overscaledZ-1);const G=this._tiles[O.key];if(G&&G.hasData()&&_[O.key]){a[C]=B.tileID;break}}}for(const C in p)a[C]||(this._coveredTiles[C]=!0,a[C]=p[C])}for(const p in a)this._tiles[p].clearFadeHold();const c=function(p,_){const v=[];for(const E in p)E in _||v.push(E);return v}(this._tiles,a);for(const p of c){const _=this._tiles[p];_.hasSymbolBuckets&&!_.holdingForFade()?_.setHoldDuration(this.map._fadeDuration):_.hasSymbolBuckets&&!_.symbolFadeFinished()||this._removeTile(+p)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const i={};if(e.length===0)return i;const r={},n=e.reduce((_,v)=>Math.min(_,v.overscaledZ),1/0),s=e[0].overscaledZ,a=Math.max(s-Hc.maxOverzooming,this._source.minzoom),c=Math.max(s+Hc.maxUnderzooming,this._source.minzoom),p={};for(const _ of e){const v=this._addTile(_);i[_.key]=_,v.hasData()||n<this._source.maxzoom&&(p[_.key]=_)}this._retainLoadedChildren(p,n,c,i);for(const _ of e){let v=this._tiles[_.key];if(v.hasData())continue;if(_.canonical.z>=this._source.maxzoom){const C=_.children(this._source.maxzoom)[0],B=this.getTile(C);if(B&&B.hasData()){i[C.key]=C;continue}}else{const C=_.children(this._source.maxzoom);if(i[C[0].key]&&i[C[1].key]&&i[C[2].key]&&i[C[3].key])continue}let E=v.wasRequested();for(let C=_.overscaledZ-1;C>=a;--C){const B=_.scaledTo(C);if(r[B.key]||(r[B.key]=!0,v=this.getTile(B),!v&&E&&(v=this._addTile(B)),v&&(i[B.key]=B,E=v.wasRequested(),v.hasData())))break}}return i}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const i=[];let r,n=this._tiles[e].tileID;for(;n.overscaledZ>0;){if(n.key in this._loadedParentTiles){r=this._loadedParentTiles[n.key];break}i.push(n.key);const s=n.scaledTo(n.overscaledZ-1);if(r=this._getLoadedTile(s),r)break;n=s}for(const s of i)this._loadedParentTiles[s]=r}}_addTile(e){let i=this._tiles[e.key];if(i)return i.isExtraShadowCaster!==!0||this._shadowCasterTiles[e.key]||this._reloadTile(e.key,"reloading"),i;i=this._cache.getAndRemove(e),i&&(this._setTileReloadTimer(e.key,i),i.tileID=e,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,i)));const r=!!i;if(!r){const n=this.map?this.map.painter:null;i=new N0(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,n,this._isRaster),this._loadTile(i,this._tileLoaded.bind(this,i,e.key,i.state))}return i?(i.uses++,this._tiles[e.key]=i,r||this._source.fire(new ei("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i):null}_setTileReloadTimer(e,i){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const r=i.getExpiryTimeout();r&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},r))}_removeTile(e){const i=this._tiles[e];i&&(i.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),i.uses>0||(i.hasData()&&i.state!=="reloading"?this._cache.add(i.tileID,i,i.getExpiryTimeout()):(i.aborted=!0,this._abortTile(i),this._unloadTile(i))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,i,r){const n=[],s=this.transform;if(!s)return n;const a=s.projection.name==="globe",c=jo(s.center.lng);for(const p in this._tiles){const _=this._tiles[p];if(r&&_.clearQueryDebugViz(),_.holdingForFade())continue;let v;if(a){const E=_.tileID.canonical;if(E.z===0){const C=[Math.abs(hi(c,...U0(E,-1))-c),Math.abs(hi(c,...U0(E,1))-c)];v=[0,2*C.indexOf(Math.min(...C))-1]}else{const C=[Math.abs(hi(c,...U0(E,-1))-c),Math.abs(hi(c,...U0(E,0))-c),Math.abs(hi(c,...U0(E,1))-c)];v=[C.indexOf(Math.min(...C))-1]}}else v=[0];for(const E of v){const C=e.containsTile(_,s,i,E);C&&n.push(C)}}return n}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(e){return this._getRenderableCoordinates(e)}_getRenderableCoordinates(e,i){const r=this.getRenderableIds(e,i).map(s=>this._tiles[s].tileID),n=this.transform.projection.name==="globe";for(const s of r)s.projMatrix=this.transform.calculateProjMatrix(s.toUnwrapped()),s.expandedProjMatrix=n?this.transform.calculateProjMatrix(s.toUnwrapped(),!1,!0):s.projMatrix;return r}sortCoordinatesByDistance(e){const i=e.slice(),r=this.transform._camera.position,n=this.transform._camera.forward(),s={};for(const a of i){const c=1/(1<<a.canonical.z);s[a.key]=((a.canonical.x+.5)*c+a.wrap-r[0])*n[0]+((a.canonical.y+.5)*c-r[1])*n[1]-r[2]*n[2]}return i.sort((a,c)=>s[a.key]-s[c.key]),i}hasTransition(){if(this._source.hasTransition())return!0;if(Fg(this._source.type))for(const e in this._tiles){const i=this._tiles[e];if(i.fadeEndTime!==void 0&&i.fadeEndTime>=Xi.now())return!0}return!1}setFeatureState(e,i,r){this._state.updateState(e=e||"_geojsonTileLayer",i,r)}removeFeatureState(e,i,r){this._state.removeFeatureState(e=e||"_geojsonTileLayer",i,r)}getFeatureState(e,i){return this._state.getState(e=e||"_geojsonTileLayer",i)}setDependencies(e,i,r){const n=this._tiles[e];n&&n.setDependencies(i,r)}reloadTilesForDependencies(e,i){for(const r in this._tiles)this._tiles[r].hasDependency(e,i)&&this._reloadTile(+r,"reloading");this._cache.filter(r=>!r.hasDependency(e,i))}_preloadTiles(e,i){if(!this._sourceLoaded){const c=()=>{this._sourceLoaded&&(this._source.off("data",c),this._preloadTiles(e,i))};return void this._source.on("data",c)}const r=new Map,n=Array.isArray(e)?e:[e],s=this.map.painter.terrain,a=this.usedForTerrain&&s?s.getScaledDemTileSize():this._source.tileSize;for(const c of n){const p=c.coveringTiles({tileSize:a,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const _ of p)r.set(_.key,_);this.usedForTerrain&&c.updateElevation(!1)}Co(Array.from(r.values()),(c,p)=>{const _=new N0(c,this._source.tileSize*c.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(_,v=>{this._source.type==="raster-dem"&&_.dem&&this._backfillDEM(_),p(v,_)})},i)}}function kx(t,e){const i=Math.abs(2*t.wrap)-+(t.wrap<0),r=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||r-i||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function Fg(t){return t==="raster"||t==="image"||t==="video"||t==="custom"}function U0(t,e){const i=1<<t.z;return[t.x/i+e,(t.x+1)/i+e]}Hc.maxOverzooming=10,Hc.maxUnderzooming=3;const pE=un([{name:"a_pos_3f",components:3,type:"Float32"}]),mE=un([{name:"a_color_3f",components:3,type:"Float32"}]),_E=un([{name:"a_color_4f",components:4,type:"Float32"}]),gE=un([{name:"a_uv_2f",components:2,type:"Float32"}]),yE=un([{name:"a_normal_3f",components:3,type:"Float32"}]),xE=un([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),vE=un([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class Og{constructor(e=0,i=0,r=0,n=0){if(isNaN(e)||e<0||isNaN(i)||i<0||isNaN(r)||r<0||isNaN(n)||n<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=i,this.left=r,this.right=n}interpolate(e,i,r){return i.top!=null&&e.top!=null&&(this.top=Ji(e.top,i.top,r)),i.bottom!=null&&e.bottom!=null&&(this.bottom=Ji(e.bottom,i.bottom,r)),i.left!=null&&e.left!=null&&(this.left=Ji(e.left,i.left,r)),i.right!=null&&e.right!=null&&(this.right=Ji(e.right,i.right,r)),this}getCenter(e,i){const r=hi((this.left+e-this.right)/2,0,e),n=hi((this.top+i-this.bottom)/2,0,i);return new At(r,n)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new Og(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Dx(t,e){const i=_n(t,3);ce.fromQuat(t,e),ts(t,3,i)}function Vg(t,e){const i=ot.identity([]);return ot.rotateZ(i,i,-e),ot.rotateX(i,i,-t),i}function Px(t,e){const i=[t[0],t[1],0],r=[e[0],e[1],0];if(_e.length(i)>=1e-15){const a=_e.normalize([],i);_e.scale(r,a,_e.dot(r,a)),e[0]=r[0],e[1]=r[1]}const n=_e.cross([],e,t);if(_e.len(n)<1e-15)return null;const s=Math.atan2(-n[1],n[0]);return Vg(Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2]),s)}class zx{constructor(e,i){this.position=e,this.orientation=i}get position(){return this._position}set position(e){if(e){const i=e instanceof Xr?e:new Xr(e[0],e[1],e[2]);this._renderWorldCopies&&(i.x=Hn(i.x,0,1)),this._position=i}else this._position=null}lookAtPoint(e,i){if(this.orientation=null,!this.position)return;const r=this.position,n=this._elevation?this._elevation.getAtPointOrZero(Xr.fromLngLat(e)):0,s=Xr.fromLngLat(e,n),a=[s.x-r.x,s.y-r.y,s.z-r.z];i||(i=[0,0,1]),i[2]=Math.abs(i[2]),this.orientation=Px(a,i)}setPitchBearing(e,i){this.orientation=Vg(Li(e),Li(-i))}}class Gm{constructor(e,i){this._transform=ce.identity([]),this.orientation=i,this.position=e}get mercatorPosition(){const e=this.position;return new Xr(e[0],e[1],e[2])}get position(){const e=_n(this._transform,3);return[e[0],e[1],e[2]]}set position(e){var i;e&&ts(this._transform,3,[(i=e)[0],i[1],i[2],1])}get orientation(){return this._orientation}set orientation(e){this._orientation=e||ot.identity([]),e&&Dx(this._transform,this._orientation)}getPitchBearing(){const e=this.forward(),i=this.right();return{bearing:Math.atan2(-i[1],i[0]),pitch:Math.atan2(Math.sqrt(e[0]*e[0]+e[1]*e[1]),-e[2])}}setPitchBearing(e,i){this._orientation=Vg(e,i),Dx(this._transform,this._orientation)}forward(){const e=_n(this._transform,2);return[-e[0],-e[1],-e[2]]}up(){const e=_n(this._transform,1);return[-e[0],-e[1],-e[2]]}right(){const e=_n(this._transform,0);return[e[0],e[1],e[2]]}getCameraToWorld(e,i){const r=new Float64Array(16);return ce.invert(r,this.getWorldToCamera(e,i)),r}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(e,i,r){const n=this.position;_e.scale(n,n,-e);const s=new Float64Array(16);return ce.fromScaling(s,[r,r,r]),ce.translate(s,s,n),s[10]*=i,s}getWorldToCamera(e,i){const r=new Float64Array(16),n=new Float64Array(4),s=this.position;return ot.conjugate(n,this._orientation),_e.scale(s,s,-e),ce.fromQuat(r,n),ce.translate(r,r,s),r[1]*=-1,r[5]*=-1,r[9]*=-1,r[13]*=-1,r[8]*=i,r[9]*=i,r[10]*=i,r[11]*=i,r}getCameraToClipPerspective(e,i,r,n){const s=new Float64Array(16);return ce.perspective(s,e,i,r,n),s}getCameraToClipOrthographic(e,i,r,n,s,a){const c=new Float64Array(16);return ce.ortho(c,e,i,r,n,s,a),c}getDistanceToElevation(e,i=!1){const r=e===0?0:On(e,i?So(this.position[1]):this.position[1]),n=this.forward();return(r-this.position[2])/n[2]}clone(){return new Gm([...this.position],[...this.orientation])}}function Bx(t,e){const i=j0(t.projection,t.zoom,t.width,t.height),r=function(s,a,c,p,_){const v=new rr(c.lng-180*ph,c.lat),E=new rr(c.lng+180*ph,c.lat),C=s.project(v.lng,v.lat),B=s.project(E.lng,E.lat),O=-Math.atan2(B.y-C.y,B.x-C.x),G=Xr.fromLngLat(c);G.y=hi(G.y,-1+ph,1-ph);const q=G.toLngLat(),$=s.project(q.lng,q.lat),J=Xr.fromLngLat(q);J.x+=ph;const ie=J.toLngLat(),re=s.project(ie.lng,ie.lat),te=Fx(re.x-$.x,re.y-$.y,O),se=Xr.fromLngLat(q);se.y+=ph;const he=se.toLngLat(),ve=s.project(he.lng,he.lat),be=Fx(ve.x-$.x,ve.y-$.y,O),Ce=Math.abs(te.x)/Math.abs(be.y),Ne=ce.identity([]);ce.rotateZ(Ne,Ne,-O*(1-(_?0:p)));const je=ce.identity([]);return ce.scale(je,je,[1,1-(1-Ce)*p,1]),je[4]=-be.x/be.y*p,ce.rotateZ(je,je,O),ce.multiply(je,Ne,je),je}(t.projection,0,t.center,i,e),n=Lx(t);return ce.scale(r,r,[n,n,1]),r}function Lx(t){const e=t.projection,i=j0(t.projection,t.zoom,t.width,t.height),r=Rx(e,t.center),n=Rx(e,rr.convert(e.center));return Math.pow(2,r*i+(1-i)*n)}function j0(t,e,i,r,n=1/0){const s=t.range;if(!s)return 0;const a=Math.min(n,Math.max(i,r)),c=Math.log(a/1024)/Math.LN2;return Yr(s[0]+c,s[1]+c,e)}const ph=1/4e4;function Rx(t,e){const i=hi(e.lat,-Ks,Ks),r=new rr(e.lng-180*ph,i),n=new rr(e.lng+180*ph,i),s=t.project(r.lng,i),a=t.project(n.lng,i),c=Xr.fromLngLat(r),p=Xr.fromLngLat(n),_=a.x-s.x,v=a.y-s.y,E=p.x-c.x,C=p.y-c.y,B=Math.sqrt((E*E+C*C)/(_*_+v*v));return Math.log(B)/Math.LN2}function Fx(t,e,i){const r=Math.cos(i),n=Math.sin(i);return{x:t*r-e*n,y:t*n+e*r}}function Xh(t,e,i){return e*(Mt/(t.tileSize*Math.pow(2,i-t.tileID.overscaledZ)))}const cf={unknown:0,flipRequired:1,flipNotRequired:2},bE=Math.tan(85*Math.PI/180);function Zm(t,e,i,r,n,s,a){const c=ce.create();if(i)if(s.name==="globe"){const p=function(_,v){const{x:E,y:C}=_.point,B=em(E,C,_.worldSize/_._pixelsPerMercatorPixel,0,0);return ce.multiply(B,B,Wd(lo(v)))}(n,e);ce.multiply(c,c,p)}else{const p=ae.invert([],a);c[0]=p[0],c[1]=p[1],c[4]=p[2],c[5]=p[3],r||ce.rotateZ(c,c,n.angle)}else ce.multiply(c,n.labelPlaneMatrix,t);return c}function Ox(t,e,i,r,n,s,a){const c=Zm(t,e,i,r,n,s,a);return s.name==="globe"&&i||(c[2]=c[6]=c[10]=c[14]=0),c}function Vx(t,e,i,r,n,s,a){if(i){if(s.name==="globe"){const c=Zm(t,e,i,r,n,s,a);return ce.invert(c,c),ce.multiply(c,t,c),c}{const c=ce.clone(t),p=ce.identity([]);return p[0]=a[0],p[1]=a[1],p[4]=a[2],p[5]=a[3],ce.multiply(c,c,p),r||ce.rotateZ(c,c,-n.angle),c}}return n.glCoordMatrix}function Wc(t,e,i,r){const n=[t,e,i,1];i?U.transformMat4(n,n,r):Qx(n,n,r);const s=n[3];return n[0]/=s,n[1]/=s,n[2]/=s,n}function Nx(t,e){return Math.min(.5+t/e*.5,1.5)}function wE(t,e){const i=t[0]/t[3],r=t[1]/t[3];return i>=-e[0]&&i<=e[0]&&r>=-e[1]&&r<=e[1]}function TE(t,e,i,r,n,s,a,c,p,_){const v=i.transform,E=r?t.textSizeData:t.iconSizeData,C=hu(E,i.transform.zoom),B=v.projection.name==="globe",O=[256/i.width*2+1,256/i.height*2+1],G=r?t.text.dynamicLayoutVertexArray:t.icon.dynamicLayoutVertexArray;G.clear();let q=null;B&&(q=r?t.text.globeExtVertexArray:t.icon.globeExtVertexArray);const $=t.lineVertexArray,J=r?t.text.placedSymbolArray:t.icon.placedSymbolArray,ie=i.transform.width/i.transform.height;let re,te=!1;for(let se=0;se<J.length;se++){const he=J.get(se),{numGlyphs:ve,writingMode:be}=he;if(be!==ws.vertical||te||re===ws.horizontal||(te=!0),re=be,(he.hidden||be===ws.vertical)&&!te){uf(ve,G);continue}te=!1;const Ce=new At(he.tileAnchorX,he.tileAnchorY);let{x:Ne,y:je,z:Ye}=v.projection.projectTilePoint(Ce.x,Ce.y,_.canonical);if(p){const[Lt,Ot,jt]=p(Ce);Ne+=Lt,je+=Ot,Ye+=jt}const Re=[Ne,je,Ye,1];if(U.transformMat4(Re,Re,e),!wE(Re,O)){uf(ve,G);continue}const rt=Re[3],lt=Nx(i.transform.getCameraToCenterDistance(v.projection),rt),vt=k0(E,C,he),it=a?vt/lt:vt*lt,at=Wc(Ne,je,Ye,n);if(at[3]<=0){uf(ve,G);continue}let Tt={};const It=a?null:p,St=Gx(he,it,!1,c,e,n,s,t.glyphOffsetArray,$,G,q,at,Ce,Tt,ie,It,v.projection,_,a);te=St.useVertical,It&&St.needsFlipping&&(Tt={}),(St.notEnoughRoom||te||St.needsFlipping&&Gx(he,it,!0,c,e,n,s,t.glyphOffsetArray,$,G,q,at,Ce,Tt,ie,It,v.projection,_,a).notEnoughRoom)&&uf(ve,G)}r?(t.text.dynamicLayoutVertexBuffer.updateData(G),q&&t.text.globeExtVertexBuffer&&t.text.globeExtVertexBuffer.updateData(q)):(t.icon.dynamicLayoutVertexBuffer.updateData(G),q&&t.icon.globeExtVertexBuffer&&t.icon.globeExtVertexBuffer.updateData(q))}function Ux(t,e,i,r,n,s,a,c,p,_,v,E,C,B,O,G){const{lineStartIndex:q,glyphStartIndex:$,segment:J}=c,ie=$+c.numGlyphs,re=q+c.lineLength,te=e.getoffsetX($),se=e.getoffsetX(ie-1),he=qm(t*te,i,r,n,s,a,J,q,re,p,_,v,E,C,!0,B,O,G);if(!he)return null;const ve=qm(t*se,i,r,n,s,a,J,q,re,p,_,v,E,C,!0,B,O,G);return ve?{first:he,last:ve}:null}function jx(t,e,i,r){return t===ws.horizontal&&Math.abs(r)>Math.abs(i)?{useVertical:!0}:t===ws.vertical?r>0?{needsFlipping:!0}:null:e!==cf.unknown&&function(n,s){return n===0||Math.abs(s/n)>bE}(i,r)?e===cf.flipRequired?{needsFlipping:!0}:null:i<0?{needsFlipping:!0}:null}function Gx(t,e,i,r,n,s,a,c,p,_,v,E,C,B,O,G,q,$,J){const ie=e/24,re=t.lineOffsetX*ie,te=t.lineOffsetY*ie,{lineStartIndex:se,glyphStartIndex:he,numGlyphs:ve,segment:be,writingMode:Ce,flipState:Ne}=t,je=se+t.lineLength,Ye=Re=>{if(v){const[it,at,Tt]=Re.up,It=_.length;Fm(v,It+0,it,at,Tt),Fm(v,It+1,it,at,Tt),Fm(v,It+2,it,at,Tt),Fm(v,It+3,it,at,Tt)}const[rt,lt,vt]=Re.point;Af(_,rt,lt,vt,Re.angle)};if(ve>1){const Re=Ux(ie,c,re,te,i,E,C,t,p,s,B,G,!1,q,$,J);if(!Re)return{notEnoughRoom:!0};if(r&&!i){let[rt,lt,vt]=Re.first.point,[it,at,Tt]=Re.last.point;[rt,lt]=Wc(rt,lt,vt,a),[it,at]=Wc(it,at,Tt,a);const It=jx(Ce,Ne,(it-rt)*O,at-lt);if(t.flipState=It&&It.needsFlipping?cf.flipRequired:cf.flipNotRequired,It)return It}Ye(Re.first);for(let rt=he+1;rt<he+ve-1;rt++){const lt=qm(ie*c.getoffsetX(rt),re,te,i,E,C,be,se,je,p,s,B,G,!1,!1,q,$,J);if(!lt)return _.length-=4*(rt-he),{notEnoughRoom:!0};Ye(lt)}Ye(Re.last)}else{if(r&&!i){const rt=Wc(C.x,C.y,0,n),lt=se+be+1,vt=new At(p.getx(lt),p.gety(lt)),it=Wc(vt.x,vt.y,0,n),at=it[3]>0?it:qx(C,vt,rt,1,n,void 0,q,$.canonical),Tt=jx(Ce,Ne,(at[0]-rt[0])*O,at[1]-rt[1]);if(t.flipState=Tt&&Tt.needsFlipping?cf.flipRequired:cf.flipNotRequired,Tt)return Tt}const Re=qm(ie*c.getoffsetX(he),re,te,i,E,C,be,se,je,p,s,B,G,!1,!1,q,$,J);if(!Re)return{notEnoughRoom:!0};Ye(Re)}return{}}function Zx(t,e,i,r,n){const{x:s,y:a,z:c}=r.projectTilePoint(t.x,t.y,e);if(!n)return Wc(s,a,c,i);const[p,_,v]=n(t);return Wc(s+p,a+_,c+v,i)}function qx(t,e,i,r,n,s,a,c){const p=Zx(t.sub(e)._unit()._add(t),c,n,a,s);return _e.sub(p,i,p),_e.normalize(p,p),_e.scaleAndAdd(p,i,p,r)}function qm(t,e,i,r,n,s,a,c,p,_,v,E,C,B,O,G,q,$){const J=r?t-e:t+e;let ie=J>0?1:-1,re=0;r&&(ie*=-1,re=Math.PI),ie<0&&(re+=Math.PI);let te=c+a+(ie>0?0:1)|0,se=n,he=n,ve=0,be=0;const Ce=Math.abs(J),Ne=[],je=[];let Ye=s,Re=Ye;const rt=()=>qx(Re,Ye,he,Ce-ve+1,v,C,G,q.canonical);for(;ve+be<=Ce;){if(te+=ie,te<c||te>=p)return null;if(he=se,Re=Ye,Ne.push(he),B&&je.push(Re),Ye=new At(_.getx(te),_.gety(te)),se=E[te],!se){const Ot=Zx(Ye,q.canonical,v,G,C);se=Ot[3]>0?E[te]=Ot:rt()}ve+=be,be=_e.distance(he,se)}O&&C&&(E[te]&&(se=rt(),be=_e.distance(he,se)),E[te]=se);const lt=(Ce-ve)/be,vt=Ye.sub(Re)._mult(lt)._add(Re),it=_e.sub([],se,he),at=_e.scaleAndAdd([],he,it,lt);let Tt=[0,0,1],It=it[0],St=it[1];if($&&(Tt=G.upVector(q.canonical,vt.x,vt.y),Tt[0]!==0||Tt[1]!==0||Tt[2]!==1)){const Ot=[Tt[2],0,-Tt[0]],jt=_e.cross([],Tt,Ot);_e.normalize(Ot,Ot),_e.normalize(jt,jt),It=_e.dot(it,Ot),St=_e.dot(it,jt)}if(i){const Ot=_e.cross([],Tt,it);_e.normalize(Ot,Ot),_e.scaleAndAdd(at,at,Ot,i*ie)}const Lt=re+Math.atan2(St,It);return Ne.push(at),B&&je.push(vt),{point:at,angle:Lt,path:Ne,tilePath:je,up:Tt}}function uf(t,e){const i=e.length,r=i+4*t;e.resize(r),e.float32.fill(-1/0,4*i,4*r)}function Qx(t,e,i){const r=e[0],n=e[1];return t[0]=i[0]*r+i[4]*n+i[12],t[1]=i[1]*r+i[5]*n+i[13],t[3]=i[3]*r+i[7]*n+i[15],t}const Hx=(t,e,i)=>(1-i)*t+i*e,Wx=t=>t*t*t*t*t;class Ng{constructor(e,i,r,n,s,a,c){this.tileSize=512,this._renderWorldCopies=s===void 0||s,this._minZoom=e||0,this._maxZoom=i||22,this._minPitch=r??0,this._maxPitch=n??60,this.setProjection(a),this.setMaxBounds(c),this.width=0,this.height=0,this._center=new rr(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Og,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Gm,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const e=new Ng(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return e._elevation=this._elevation,e._centerAltitude=this._centerAltitude,e._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,e.tileSize=this.tileSize,e.mercatorFromTransition=this.mercatorFromTransition,e.width=this.width,e.height=this.height,e.cameraElevationReference=this.cameraElevationReference,e._center=this._center,e._setZoom(this.zoom),e._seaLevelZoom=this._seaLevelZoom,e.angle=this.angle,e._fov=this._fov,e._pitch=this._pitch,e._nearZ=this._nearZ,e._farZ=this._farZ,e._averageElevation=this._averageElevation,e._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,e._unmodified=this._unmodified,e._edgeInsets=this._edgeInsets.clone(),e._camera=this._camera.clone(),e._calcMatrices(),e.freezeTileCoverage=this.freezeTileCoverage,e.frustumCorners=this.frustumCorners,e}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(e){this._elevation!==e&&(this._elevation=e,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(e,i=!1){const r=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||r)&&this._updateCameraOnTerrain(),(e||r)&&this._constrainCamera(i),this._calcMatrices()}getProjection(){return dr(this.projection,["name","center","parallels"])}setProjection(e){this.projectionOptions=e||{name:"mercator"};const i=this.projection?this.getProjection():void 0;this.projection=Pm(this.projectionOptions);const r=!tr(i,this.getProjection());return r&&this._calcMatrices(),this.mercatorFromTransition=!1,r}setOrthographicProjectionAtLowPitch(e){return this._orthographicProjectionAtLowPitch!==e&&(this._orthographicProjectionAtLowPitch=e,this._calcMatrices(),!0)}setMercatorFromTransition(){const e=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=Pm({name:"mercator"});const i=e!==this.projection.name;return i&&this._calcMatrices(),i}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const e=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(e))}get cameraWorldSize(){const e=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(e))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return On(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new At(this.width,this.height)}get bearing(){return Hn(this.rotation,-180,180)}set bearing(e){this.rotation=e}get rotation(){return-this.angle/Math.PI*180}set rotation(e){const i=-e*Math.PI/180;this.angle!==i&&(this._unmodified=!1,this.angle=i,this._calcMatrices(),this.rotationMatrix=ae.create(),ae.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){const i=hi(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==i&&(this._unmodified=!1,this._pitch=i,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const e=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/e)}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=Li(e),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(e){this._averageElevation=e,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(e){const i=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==i&&(this._unmodified=!1,this._setZoom(i),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(e){this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom}_updateCameraOnTerrain(){const e=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,i=this.elevation&&e===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||e===Number.NEGATIVE_INFINITY&&(!i||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const r=this._elevation;i||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&r.exaggeration()&&this._centerAltitudeValidForExaggeration!==r.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*r.exaggeration(),this._centerAltitudeValidForExaggeration=r.exaggeration()):(this._centerAltitude=e||0,this._centerAltitudeValidForExaggeration=r.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const e=this._elevation,i=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],r=this.horizonLineFromTop();let n=0,s=0;for(let a=0;a<i.length;a++){const c=new At(i[a][0]*this.width,r+i[a][1]*(this.height-r)),p=e.pointCoordinate(c);if(!p)continue;const _=1/Math.hypot(p[0]-this._camera.position[0],p[1]-this._camera.position[1]);n+=p[3]*_,s+=_}return s===0?NaN:n/s}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const e=this._seaLevelZoom,i=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),r=this.pixelsPerMeter/this.worldSize*i,n=this._mercatorZfromZoom(e),s=this._mercatorZfromZoom(this._maxZoom),a=Math.max(n-r,s);this._setZoom(this._zoomFromMercatorZ(a))}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}computeZoomRelativeTo(e){const i=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,e.toAltitude()));let r;r=e.z<this._camera.position[2]?[i.x,i.y,i.z]:[e.x,e.y,e.z];const n=_e.length(_e.sub([],this._camera.position,r));return hi(this._zoomFromMercatorZ(n),this._minZoom,this._maxZoom)}setFreeCameraOptions(e){if(!this.height||!e.position&&!e.orientation)return;this._updateCameraState();let i=!1;if(e.orientation&&!ot.exactEquals(e.orientation,this._camera.orientation)&&(i=this._setCameraOrientation(e.orientation)),e.position){const r=[e.position.x,e.position.y,e.position.z];_e.exactEquals(r,this._camera.position)||(this._setCameraPosition(r),i=!0)}i&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const e=this._camera.position,i=new zx;return i.position=new Xr(e[0],e[1],e[2]),i.orientation=this._camera.orientation,i._elevation=this.elevation,i._renderWorldCopies=this.renderWorldCopies,i}_setCameraOrientation(e){if(!ot.length(e))return!1;ot.normalize(e,e);const i=_e.transformQuat([],[0,0,-1],e),r=_e.transformQuat([],[0,-1,0],e);if(r[2]<0)return!1;const n=Px(i,r);return!!n&&(this._camera.orientation=n,!0)}_setCameraPosition(e){const i=this.zoomScale(this.minZoom)*this.tileSize,r=this.zoomScale(this.maxZoom)*this.tileSize,n=this.cameraToCenterDistance;e[2]=hi(e[2],n/r,n/i),this._camera.position=e}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,i,r){this._unmodified=!1,this._edgeInsets.interpolate(e,i,r),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const i=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,i)}getVisibleUnwrappedCoordinates(e){const i=[new fr(0,e)];if(this.renderWorldCopies){const r=this.pointCoordinate(new At(0,0)),n=this.pointCoordinate(new At(this.width,0)),s=this.pointCoordinate(new At(this.width,this.height)),a=this.pointCoordinate(new At(0,this.height)),c=Math.floor(Math.min(r.x,n.x,s.x,a.x)),p=Math.floor(Math.max(r.x,n.x,s.x,a.x)),_=1;for(let v=c-_;v<=p+_;v++)v!==0&&i.push(new fr(v,e))}return i}isLODDisabled(e){return(!e||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(e,i,r){let n=[];if(i[0]===0&&i[1]===0)return n;for(const a of e){const c=a.canonical,p=a.overscaledZ,_=a.wrap,v=1<<c.z,E=c.x+1<v,C=c.x>0,B=c.y+1<v,O=c.y>0,G=a.wrap-(C?0:1),q=a.wrap+(E?0:1),$=C?c.x-1:v-1,J=E?c.x+1:0;i[0]<0?(n.push(new fi(p,q,c.z,J,c.y)),i[1]<0&&B&&(n.push(new fi(p,_,c.z,c.x,c.y+1)),n.push(new fi(p,q,c.z,J,c.y+1))),i[1]>0&&O&&(n.push(new fi(p,_,c.z,c.x,c.y-1)),n.push(new fi(p,q,c.z,J,c.y-1)))):i[0]>0?(n.push(new fi(p,G,c.z,$,c.y)),i[1]<0&&B&&(n.push(new fi(p,_,c.z,c.x,c.y+1)),n.push(new fi(p,G,c.z,$,c.y+1))),i[1]>0&&O&&(n.push(new fi(p,_,c.z,c.x,c.y-1)),n.push(new fi(p,G,c.z,$,c.y-1)))):i[1]<0&&B?n.push(new fi(p,_,c.z,c.x,c.y+1)):O&&n.push(new fi(p,_,c.z,c.x,c.y-1))}if(n.length>1){n.sort((p,_)=>p.overscaledZ-_.overscaledZ||p.wrap-_.wrap||p.canonical.z-_.canonical.z||p.canonical.x-_.canonical.x||p.canonical.y-_.canonical.y);let a=0,c=0;for(;c<n.length;)n[c].equals(n[a])?++c:n[++a]=n[c++];n.length=a+1}const s=[];for(const a of n)n.some(c=>a.isChildOf(c))||s.push(a);return n=s.filter(a=>!e.some(c=>!!(a.overscaledZ<r&&c.isChildOf(a))||a.equals(c)||a.isChildOf(c))),n}coveringTiles(e){let i=this.coveringZoomLevel(e);const r=i,n=this.elevation&&this.elevation.exaggeration(),s=n&&!e.isTerrainDEM,a=this.projection.name==="mercator";if(e.minzoom!==void 0&&i<e.minzoom)return[];e.maxzoom!==void 0&&i>e.maxzoom&&(i=e.maxzoom);const c=this.locationCoordinate(this.center),p=this.center.lat,_=1<<i,v=[_*c.x,_*c.y,0],E=this.projection.name==="globe",C=!E,B=Gs.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,i,C),O=E?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),G=_*On(1,this.center.lat),q=this._camera.position[2]/On(1,this.center.lat),$=[_*O.x,_*O.y,q*(C?1:G)],J=E||n,ie=this.cameraToCenterDistance/e.tileSize*(e.roundZoom?1:.502),re=this.isLODDisabled(!0)?i:0;let te;if(this._elevation&&e.isTerrainDEM)te=1e4*this._elevation.exaggeration();else if(this._elevation){const it=this._elevation.getMinMaxForVisibleTiles();te=it?it.max:this._centerAltitude}else te=this._centerAltitude;const se=e.isTerrainDEM?-te:this._elevation?this._elevation.getMinElevationBelowMSL():0,he=this.projection.isReprojectedInTileSpace?Lx(this):1,ve=it=>{const Tt=new Xr(it.x+25e-6,it.y,it.z),It=new Xr(it.x,it.y+25e-6,it.z),St=it.toLngLat(),Lt=Tt.toLngLat(),Ot=It.toLngLat(),jt=this.locationCoordinate(St),Dt=this.locationCoordinate(Lt),Kt=this.locationCoordinate(Ot),mi=Math.hypot(Dt.x-jt.x,Dt.y-jt.y),_i=Math.hypot(Kt.x-jt.x,Kt.y-jt.y);return Math.sqrt(mi*_i)*he/25e-6},be=it=>{const at=te,Tt=se;return{aabb:yx(this,_,0,0,0,it,Tt,at,this.projection),zoom:0,x:0,y:0,minZ:Tt,maxZ:at,wrap:it,fullyVisible:!1}},Ce=[];let Ne=[];const je=i,Ye=e.reparseOverscaled?r:i,Re=it=>it*it,rt=Re((q-this._centerAltitude)*G),lt=it=>{if(!this._elevation||!it.tileID||!a)return;const at=this._elevation.getMinMaxForTile(it.tileID),Tt=it.aabb;at?(Tt.min[2]=at.min,Tt.max[2]=at.max,Tt.center[2]=(Tt.min[2]+Tt.max[2])/2):(it.shouldSplit=vt(it),it.shouldSplit||(Tt.min[2]=Tt.max[2]=Tt.center[2]=this._centerAltitude))},vt=it=>{if(it.zoom<re)return!0;if(it.zoom===je)return!1;if(it.shouldSplit!=null)return it.shouldSplit;const at=it.aabb.distanceX($),Tt=it.aabb.distanceY($);let It=rt,St=1;if(E){It=Re(it.aabb.distanceZ($));const jt=Math.pow(2,it.zoom),Dt=So((it.y+1)/jt),Kt=So(it.y/jt),mi=Math.min(Math.max(p,Dt),Kt),_i=om(mi)/om(p);if(St=mi===p?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,_i/this._mercatorScaleRatio),this.zoom<=Jo&&it.zoom===je-1&&_i>=.9)return!0}else if(s&&(It=Re(it.aabb.distanceZ($)*G)),this.projection.isReprojectedInTileSpace&&r<=5){const jt=Math.pow(2,it.zoom),Dt=ve(new Xr((it.x+.5)/jt,(it.y+.5)/jt));St=Dt>.85?1:Dt}const Lt=at*at+Tt*Tt+It,Ot=Re((1<<je-it.zoom)*ie*St*((jt,Dt)=>{if(Dt*Re(.707)<jt)return 1;const Kt=Math.sqrt(Dt/jt);return Kt/(1.4144271570014144+(Math.pow(1.1,Kt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(It,rt),Lt));return Lt<Ot};if(this.renderWorldCopies)for(let it=1;it<=3;it++)Ce.push(be(-it)),Ce.push(be(it));for(Ce.push(be(0));Ce.length>0;){const it=Ce.pop(),at=it.x,Tt=it.y;let It=it.fullyVisible;const St=()=>this.projection.name==="globe"&&(it.y===0||it.y===(1<<it.zoom)-1);if(!It){let Lt=J?it.aabb.intersects(B):it.aabb.intersectsFlat(B);if(Lt===0&&St()){const Ot=new ci(it.zoom,at,Tt);Lt=Hl(this,_,Ot,!0).intersects(B)}if(Lt===0)continue;It=Lt===2}if(it.zoom!==je&&vt(it))for(let Lt=0;Lt<4;Lt++){const Ot=(at<<1)+Lt%2,jt=(Tt<<1)+(Lt>>1),Dt={aabb:a?it.aabb.quadrant(Lt):yx(this,_,it.zoom+1,Ot,jt,it.wrap,it.minZ,it.maxZ,this.projection),zoom:it.zoom+1,x:Ot,y:jt,wrap:it.wrap,fullyVisible:It,tileID:void 0,shouldSplit:void 0,minZ:it.minZ,maxZ:it.maxZ};s&&!E&&(Dt.tileID=new fi(it.zoom+1===je?Ye:it.zoom+1,it.wrap,it.zoom+1,Ot,jt),lt(Dt)),Ce.push(Dt)}else{const Lt=it.zoom===je?Ye:it.zoom;if(e.minzoom&&e.minzoom>Lt)continue;if(!It){let Kt=J?it.aabb.intersectsPrecise(B):it.aabb.intersectsPreciseFlat(B);if(Kt===0&&St()){const mi=new ci(it.zoom,at,Tt);Kt=Hl(this,_,mi,!0).intersectsPrecise(B)}if(Kt===0)continue}const Ot=v[0]-(.5+at+(it.wrap<<it.zoom))*(1<<i-it.zoom),jt=v[1]-.5-Tt,Dt=it.tileID?it.tileID:new fi(Lt,it.wrap,it.zoom,at,Tt);Ne.push({tileID:Dt,distanceSq:Ot*Ot+jt*jt})}}if(this.fogCullDistSq){const it=this.fogCullDistSq,at=this.horizonLineFromTop();Ne=Ne.filter(Tt=>{const It=[0,0,0,1],St=[Mt,Mt,0,1],Lt=this.calculateFogTileMatrix(Tt.tileID.toUnwrapped());U.transformMat4(It,It,Lt),U.transformMat4(St,St,Lt);const Ot=function(Kt,mi,_i){let Ti=0;for(let Mi=0;Mi<2;++Mi)Kt[Mi]>0&&(Ti+=(Kt[Mi]-0)*(Kt[Mi]-0)),mi[Mi]<0&&(Ti+=(0-mi[Mi])*(0-mi[Mi]));return Ti}(U.min([],It,St),U.max([],It,St));if(Ot===0)return!0;let jt=!1;const Dt=this._elevation;if(Dt&&Ot>it&&at!==0){const Kt=this.calculateProjMatrix(Tt.tileID.toUnwrapped());let mi;e.isTerrainDEM||(mi=Dt.getMinMaxForTile(Tt.tileID)),mi||(mi={min:se,max:te});const _i=function(Mi){const ur=Math.round((Mi+45+360)%360/90)%4;return as[ur]}(this.rotation),Ti=[_i[0]*Mt,_i[1]*Mt,mi.max];_e.transformMat4(Ti,Ti,Kt),jt=(1-Ti[1])*this.height*.5<at}return Ot<it||jt})}return Ne.sort((it,at)=>it.distanceSq-at.distanceSq).map(it=>it.tileID)}resize(e,i){this.width=e,this.height=i,this.pixelsToGLUnits=[2/e,-2/i],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(e){const i=hi(e.lat,-Ks,Ks),r=this.projection.project(e.lng,i);return new At(r.x*this.worldSize,r.y*this.worldSize)}unproject(e){return this.projection.unproject(e.x/this.worldSize,e.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/On(1,this.center.lat)/this.worldSize}setLocationAtPoint(e,i){let r,n;const s=this.centerPoint;if(this.projection.name==="globe"){const c=this.worldSize;r=(i.x-s.x)/c,n=(i.y-s.y)/c}else{const c=this.pointCoordinate(i),p=this.pointCoordinate(s);r=c.x-p.x,n=c.y-p.y}const a=this.locationCoordinate(e);this.setLocation(new Xr(a.x-r,a.y-n))}setLocation(e){this.center=this.coordinateLocation(e),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(e){return this.projection.locationPoint(this,e)}locationPoint3D(e){return this.projection.locationPoint(this,e,!0)}pointLocation(e){return this.coordinateLocation(this.pointCoordinate(e))}pointLocation3D(e){return this.coordinateLocation(this.pointCoordinate3D(e))}locationCoordinate(e,i){const r=i?On(i,e.lat):void 0,n=this.projection.project(e.lng,e.lat);return new Xr(n.x,n.y,r)}coordinateLocation(e){return this.projection.unproject(e.x,e.y)}pointRayIntersection(e,i){const r=i??this._centerAltitude,n=[e.x,e.y,0,1],s=[e.x,e.y,1,1];U.transformMat4(n,n,this.pixelMatrixInverse),U.transformMat4(s,s,this.pixelMatrixInverse);const a=s[3];U.scale(n,n,1/n[3]),U.scale(s,s,1/a);const c=n[2],p=s[2];return{p0:n,p1:s,t:c===p?0:(r-c)/(p-c)}}screenPointToMercatorRay(e){const i=[e.x,e.y,0,1],r=[e.x,e.y,1,1];return U.transformMat4(i,i,this.pixelMatrixInverse),U.transformMat4(r,r,this.pixelMatrixInverse),U.scale(i,i,1/i[3]),U.scale(r,r,1/r[3]),i[2]=On(i[2],this._center.lat)*this.worldSize,r[2]=On(r[2],this._center.lat)*this.worldSize,U.scale(i,i,1/this.worldSize),U.scale(r,r,1/this.worldSize),new ps([i[0],i[1],i[2]],_e.normalize([],_e.sub([],r,i)))}rayIntersectionCoordinate(e){const{p0:i,p1:r,t:n}=e,s=On(i[2],this._center.lat),a=On(r[2],this._center.lat);return new Xr(Ji(i[0],r[0],n)/this.worldSize,Ji(i[1],r[1],n)/this.worldSize,Ji(s,a,n))}pointCoordinate(e,i=this._centerAltitude){return this.projection.pointCoordinate(this,e.x,e.y,i)}pointCoordinate3D(e){if(!this.elevation)return this.pointCoordinate(e);let i=this.projection.pointCoordinate3D(this,e.x,e.y);if(i)return new Xr(i[0],i[1],i[2]);let r=0,n=this.horizonLineFromTop();if(e.y>n)return this.pointCoordinate(e);const s=.02*n,a=e.clone();for(let c=0;c<10&&n-r>s;c++){a.y=Ji(r,n,.66);const p=this.projection.pointCoordinate3D(this,a.x,a.y);p?(n=a.y,i=p):r=a.y}return i?new Xr(i[0],i[1],i[2]):this.pointCoordinate(e)}isPointAboveHorizon(e){return this.projection.isPointAboveHorizon(this,e)}isPointOnSurface(e){if(e.y<0||e.y>this.height||e.x<0||e.x>this.width)return!1;if(this.elevation||this.zoom>=Cs)return!this.isPointAboveHorizon(e);const i=this.pointCoordinate(e);return i.y>=0&&i.y<=1}_coordinatePoint(e,i){const r=i&&this.elevation?this.elevation.getAtPointOrZero(e,this._centerAltitude):this._centerAltitude,n=[e.x*this.worldSize,e.y*this.worldSize,r+e.toAltitude(),1];return U.transformMat4(n,n,this.pixelMatrix),n[3]>0?new At(n[0]/n[3],n[1]/n[3]):new At(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:e,left:i}=this._edgeInsets,r=this.height-this._edgeInsets.bottom,n=this.width-this._edgeInsets.right,s=this.pointLocation3D(new At(i,e)),a=this.pointLocation3D(new At(n,e)),c=this.pointLocation3D(new At(n,r)),p=this.pointLocation3D(new At(i,r));let _=Math.min(s.lng,a.lng,c.lng,p.lng),v=Math.max(s.lng,a.lng,c.lng,p.lng),E=Math.min(s.lat,a.lat,c.lat,p.lat),C=Math.max(s.lat,a.lat,c.lat,p.lat);const B=Math.pow(2,-this.zoom)/16*270,O=this.projection.name==="globe"?1:4,G=(q,$,J,ie,re)=>{const te=(q+J)/2,se=($+ie)/2,he=new At(te,se),{lng:ve,lat:be}=this.pointLocation3D(he),Ce=Math.max(0,_-ve,E-be,ve-v,be-C);_=Math.min(_,ve),v=Math.max(v,ve),E=Math.min(E,be),C=Math.max(C,be),(re<O||Ce>B)&&(G(q,$,te,se,re+1),G(te,se,J,ie,re+1))};if(G(i,e,n,e,1),G(n,e,n,r,1),G(n,r,i,r,1),G(i,r,i,e,1),this.projection.name==="globe"){const[q,$]=function(J){const ie=ce.identity(new Float64Array(16));ce.multiply(ie,J.pixelMatrix,J.globeMatrix);const re=[0,Zs,0],te=[0,qs,0];return _e.transformMat4(re,re,ie),_e.transformMat4(te,te,ie),[re[0]>0&&re[0]<=J.width&&re[1]>0&&re[1]<=J.height&&!Hh(J,new rr(J.center.lat,90)),te[0]>0&&te[0]<=J.width&&te[1]>0&&te[1]<=J.height&&!Hh(J,new rr(J.center.lat,-90))]}(this);q?(C=90,v=180,_=-180):$&&(E=-90,v=180,_=-180)}return new Ml(new rr(_,E),new rr(v,C))}_getBoundsRectangular(e,i){const{top:r,left:n}=this._edgeInsets,s=this.height-this._edgeInsets.bottom,a=this.width-this._edgeInsets.right,c=new At(n,r),p=new At(a,r),_=new At(a,s),v=new At(n,s);let E=this.pointCoordinate(c,e),C=this.pointCoordinate(p,e);const B=this.pointCoordinate(_,i),O=this.pointCoordinate(v,i),G=(q,$)=>($.y-q.y)/($.x-q.x);return E.y>1&&C.y>=0?E=new Xr((1-O.y)/G(O,E)+O.x,1):E.y<0&&C.y<=1&&(E=new Xr(-O.y/G(O,E)+O.x,0)),C.y>1&&E.y>=0?C=new Xr((1-B.y)/G(B,C)+B.x,1):C.y<0&&E.y<=1&&(C=new Xr(-B.y/G(B,C)+B.x,0)),new Ml().extend(this.coordinateLocation(E)).extend(this.coordinateLocation(C)).extend(this.coordinateLocation(O)).extend(this.coordinateLocation(B))}_getBoundsRectangularTerrain(){const e=this.elevation;if(!e.visibleDemTiles.length||e.isUsingMockSource())return this._getBoundsRectangular(0,0);const i=e.visibleDemTiles.reduce((r,n)=>{if(n.dem){const s=n.dem.tree;r.min=Math.min(r.min,s.minimums[0]),r.max=Math.max(r.max,s.maximums[0])}return r},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(i.min*e.exaggeration(),i.max*e.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(e=!0){const i=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,r=this.height/2-i*(1-this._horizonShift);return e?Math.max(0,r):r}getMaxBounds(){return this.maxBounds}setMaxBounds(e){this.maxBounds=e,this.minLat=-Ks,this.maxLat=Ks,this.minLng=-180,this.maxLng=180,e&&(this.minLat=e.getSouth(),this.maxLat=e.getNorth(),this.minLng=e.getWest(),this.maxLng=e.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=jo(this.minLng)*this.tileSize,this.worldMaxX=jo(this.maxLng)*this.tileSize,this.worldMinY=ea(this.maxLat)*this.tileSize,this.worldMaxY=ea(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(e,i){return this.projection.createTileMatrix(this,i,e)}calculateDistanceTileData(e){const i=e.key,r=this._distanceTileDataCache;if(r[i])return r[i];const n=e.canonical,s=1/this.height,a=this.cameraWorldSize,c=a/this.zoomScale(n.z),p=(n.x+Math.pow(2,n.z)*e.wrap)*c,_=n.y*c,v=this.point;v.x*=a/this.worldSize,v.y*=a/this.worldSize;const E=this.angle,C=Math.sin(-E),B=-Math.cos(-E);return r[i]={bearing:[C,B],center:[(v.x-p)*s,(v.y-_)*s],scale:c/Mt*s},r[i]}calculateFogTileMatrix(e){const i=e.key,r=this._fogTileMatrixCache;if(r[i])return r[i];const n=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,e);return ce.multiply(n,this.worldToFogMatrix,n),r[i]=new Float32Array(n),r[i]}calculateProjMatrix(e,i=!1,r=!1){const n=e.key;let s;if(s=r?this._expandedProjMatrixCache:i?this._alignedProjMatrixCache:this._projMatrixCache,s[n])return s[n];const a=this.calculatePosMatrix(e,this.worldSize);let c;return c=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:r?this.expandedFarZProjMatrix:i?this.alignedProjMatrix:this.projMatrix,ce.multiply(a,c,a),s[n]=new Float32Array(a),s[n]}calculatePixelsToTileUnitsMatrix(e){const i=e.tileID.key,r=this._pixelsToTileUnitsCache;if(r[i])return r[i];const n=function(s,a){const{scale:c}=s.tileTransform,p=c*Mt/(s.tileSize*Math.pow(2,a.zoom-s.tileID.overscaledZ+s.tileID.canonical.z));return ae.scale(new Float32Array(4),a.inverseAdjustmentMatrix,[p,p])}(e,this);return r[i]=n,r[i]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const e=1/this.worldSize,i=ce.fromScaling([],[e,e,e]);return ce.multiply(i,i,this.globeMatrix),i}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const e=this._elevation;this._updateCameraState();const i=On(1,this._center.lat)*this.worldSize,r=this._computeCameraPosition(i),n=this._camera.forward(),s=On(1,this._center.lat);r[2]/=s,n[2]/=s,_e.normalize(n,n);const a=e.raycast(r,n,e.exaggeration());if(a){const c=_e.scaleAndAdd([],r,n,a),p=new Xr(c[0],c[1],On(c[2],So(c[1]))),_=(p.z+_e.length([p.x-r[0],p.y-r[1],p.z-r[2]*s]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(_),this._centerAltitude=p.toAltitude(),this._center=this.coordinateLocation(p),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(e=!1){if(!this._elevation)return;const i=this._elevation,r=On(1,this._center.lat)*this.worldSize,n=this._computeCameraPosition(r),s=i.getAtPointOrZero(new Xr(...n)),a=this.pixelsPerMeter/this.worldSize*s,c=this._minimumHeightOverTerrain(),p=n[2]-a;if(p<=c)if(p<0||e){const _=this.locationCoordinate(this._center,this._centerAltitude),v=[n[0],n[1],_.z-n[2]],E=_e.length(v);v[2]-=(c-p)/this._pixelsPerMercatorPixel;const C=_e.length(v);if(C===0)return;_e.scale(v,v,E/C*this._pixelsPerMercatorPixel),this._camera.position=[n[0],n[1],_.z*this._pixelsPerMercatorPixel-v[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const e=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||e){const C=this.center;return C.lat=hi(C.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!e)&&(C.lng=hi(C.lng,this.minLng,this.maxLng)),this.center=C,void(this._constraining=!1)}const i=this._unmodified,{x:r,y:n}=this.point;let s=0,a=r,c=n;const p=this.width/2,_=this.height/2,v=this.worldMinY*this.scale,E=this.worldMaxY*this.scale;if(n-_<v&&(c=v+_),n+_>E&&(c=E-_),E-v<this.height&&(s=Math.max(s,this.height/(E-v)),c=(E+v)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const C=this.worldMinX*this.scale,B=this.worldMaxX*this.scale,O=this.worldSize/2-(C+B)/2;a=(r+O+this.worldSize)%this.worldSize-O,a-p<C&&(a=C+p),a+p>B&&(a=B-p),B-C<this.width&&(s=Math.max(s,this.width/(B-C)),a=(B+C)/2)}a===r&&c===n||(this.center=this.unproject(new At(a,c))),s&&(this.zoom+=this.scaleZoom(s)),this._constrainCamera(),this._unmodified=i,this._constraining=!1}_minZoomForBounds(){let e=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(e=Math.max(e,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),e}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const e=this.centerOffset,i=this.projection.name==="globe",r=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=On(1,this.center.lat)/On(1,45));const n=j0(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,n),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const s=this.projection.zAxisUnit==="meters"?r:1,a=this._camera.getWorldToCamera(this.worldSize,s);let c;const p=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(p[8]=2*-e.x/this.width,p[9]=2*e.y/this.height,this.isOrthographic){let be=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Ce=be*this.aspect,Ne=-Ce,je=-be;Ce-=e.x,Ne-=e.x,be+=e.y,je+=e.y,c=this._camera.getCameraToClipOrthographic(Ne,Ce,je,be,this._nearZ,this._farZ),((Ye,Re,rt,lt)=>{for(let vt=0;vt<16;vt++)Ye[vt]=Hx(Re[vt],rt[vt],lt)})(c,c,p,Wx(this.pitch>=15?1:this.pitch/15))}else c=p;const _=ce.mul([],p,a);let v=ce.mul([],c,a);if(this.projection.isReprojectedInTileSpace){const be=this.locationCoordinate(this.center),Ce=ce.identity([]);ce.translate(Ce,Ce,[be.x*this.worldSize,be.y*this.worldSize,0]),ce.multiply(Ce,Ce,Bx(this)),ce.translate(Ce,Ce,[-be.x*this.worldSize,-be.y*this.worldSize,0]),ce.multiply(v,v,Ce),ce.multiply(_,_,Ce),this.inverseAdjustmentMatrix=function(Ne){const je=Bx(Ne,!0);return ae.invert([],[je[0],je[1],je[4],je[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=ce.scale([],v,[this.worldSize,this.worldSize,this.worldSize/s,1]),this.projMatrix=v,this.invProjMatrix=ce.invert(new Float64Array(16),this.projMatrix),i){const be=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);be[8]=2*-e.x/this.width,be[9]=2*e.y/this.height,this.expandedFarZProjMatrix=ce.mul([],be,a)}else this.expandedFarZProjMatrix=this.projMatrix;const E=ce.invert([],c);this.frustumCorners=yo.fromInvProjectionMatrix(E,this.horizonLineFromTop(),this.height),this.cameraFrustum=Gs.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!i);const C=new Float32Array(16);ce.identity(C),ce.scale(C,C,[1,-1,1]),ce.rotateX(C,C,this._pitch),ce.rotateZ(C,C,this.angle);const B=ce.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=ce.clone(B);const O=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;B[8]=2*-e.x/this.width,B[9]=2*(e.y+O)/this.height,this.skyboxMatrix=ce.multiply(C,B,C);const G=this.point,q=G.x,$=G.y,J=this.width%2/2,ie=this.height%2/2,re=Math.cos(this.angle),te=Math.sin(this.angle),se=q-Math.round(q)+re*J+te*ie,he=$-Math.round($)+re*ie+te*J,ve=new Float64Array(v);if(ce.translate(ve,ve,[se>.5?se-1:se,he>.5?he-1:he,0]),this.alignedProjMatrix=ve,v=ce.create(),ce.scale(v,v,[this.width/2,-this.height/2,1]),ce.translate(v,v,[1,-1,0]),this.labelPlaneMatrix=v,v=ce.create(),ce.scale(v,v,[1,-1,1]),ce.translate(v,v,[-1,-1,0]),ce.scale(v,v,[2/this.width,2/this.height,1]),this.glCoordMatrix=v,this.pixelMatrix=ce.multiply(new Float64Array(16),this.labelPlaneMatrix,_),this._calcFogMatrices(),this._distanceTileDataCache={},v=ce.invert(new Float64Array(16),this.pixelMatrix),!v)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=v,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=function(Ce){const{x:Ne,y:je}=Ce.point,{lng:Ye,lat:Re}=Ce._center;return em(Ne,je,Ce.worldSize,Ye,Re)}(this);const be=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=_e.transformMat4(be,be,a),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=v;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const e=this.cameraWorldSizeForFog,i=this.cameraPixelsPerMeter,r=this._camera.position,n=1/this.height/this._pixelsPerMercatorPixel,s=[e,e,i];_e.scale(s,s,n),_e.scale(r,r,-1),_e.multiply(r,r,s);const a=ce.create();ce.translate(a,a,r),ce.scale(a,a,s),this.mercatorFogMatrix=a,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(e,i,n)}_computeCameraPosition(e){const i=(e=e||this.pixelsPerMeter)/this.pixelsPerMeter,r=this._camera.forward(),n=this.point,s=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*i-e/this.worldSize*this._centerAltitude;return[n.x/this.worldSize-r[0]*s,n.y/this.worldSize-r[1]*s,e/this.worldSize*this._centerAltitude-r[2]*s]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(e){const i=this._maxCameraBoundsDistance()*Math.cos(this._pitch),r=this._camera.position[2],n=e[2];let s=1;this.projection.wrap&&(this.center=this.center.wrap()),n>0&&(s=Math.min((i-r)/n,1)),this._camera.position=_e.scaleAndAdd([],this._camera.position,e,s),this._updateStateFromCamera()}_updateStateFromCamera(){const e=this._camera.position,i=this._camera.forward(),{pitch:r,bearing:n}=this._camera.getPitchBearing(),s=On(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,a=this._mercatorZfromZoom(this._maxZoom)*Math.cos(Li(this._maxPitch)),c=Math.max((e[2]-s)/Math.cos(r),a),p=this._zoomFromMercatorZ(c);_e.scaleAndAdd(e,e,i,c),this._pitch=hi(r,Li(this.minPitch),Li(this.maxPitch)),this.angle=Hn(n,-Math.PI,Math.PI),this._setZoom(hi(p,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new Xr(e[0],e[1],e[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(e){return Math.pow(2,e)*this.tileSize}_mercatorZfromZoom(e){return this.cameraToCenterDistance/this._worldSizeFromZoom(e)}_minimumHeightOverTerrain(){const e=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(e)}_zoomFromMercatorZ(e){return this.scaleZoom(this.cameraToCenterDistance/(e*this.tileSize))}zoomFromMercatorZAdjusted(e){let i=0,r=Cs,n=0,s=1/0;for(;r-i>1e-6&&r>i;){const a=i+.5*(r-i),c=this.tileSize*Math.pow(2,a),p=this.getCameraToCenterDistance(this.projection,a,c),_=this.scaleZoom(p/(e*this.tileSize)),v=Math.abs(a-_);v<s&&(s=v,n=a),a<_?i=a:r=a}return n}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(Pe("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(e,i){const r=Math.min(e.x,i.x),n=Math.max(e.x,i.x),s=Math.min(e.y,i.y),a=Math.max(e.y,i.y);if(s<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const c=[new At(r,s),new At(n,a),new At(r,a),new At(n,s)],p=this.renderWorldCopies?-3:0,_=this.renderWorldCopies?4:1;for(const v of c){const E=this.pointRayIntersection(v);if(E.t<0)return!0;const C=this.rayIntersectionCoordinate(E);if(C.x<p||C.y<0||C.x>_||C.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+Ir(this.fovAboveCenter)>88||this.anyCornerOffEdge(new At(0,0),new At(this.width,this.height))}zoomDeltaToMovement(e,i){const r=_e.length(_e.sub([],this._camera.position,e)),n=this._zoomFromMercatorZ(r)+i;return r-this._mercatorZfromZoom(n)}getCameraPoint(){if(this.projection.name==="globe"){const e=function([i,r,n],s){const a=[i,r,n,1];U.transformMat4(a,a,s);const c=a[3]=Math.max(a[3],1e-6);return a[0]/=c,a[1]/=c,a[2]/=c,a}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new At(e[0],e[1])}{const e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new At(0,e))}}getCameraToCenterDistance(e,i=this.zoom,r=this.worldSize){const n=j0(e,i,this.width,this.height,1024),s=e.pixelSpaceConversion(this.center.lat,r,n);let a=.5/Math.tan(.5*this._fov)*this.height*s;return this.isOrthographic&&(a=Hx(1,a,Wx(this.pitch>=15?1:this.pitch/15))),a}getWorldToCameraMatrix(){const e=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&ce.multiply(e,e,this.globeMatrix),e}getFrustum(e){return Gs.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,e,this.projection.zAxisUnit==="meters")}}function $x(t,e,i){ce.identity(t),ce.rotateZ(t,t,Li(e[2])),ce.rotateX(t,t,Li(e[0])),ce.rotateY(t,t,Li(e[1])),ce.scale(t,t,i),ce.multiply(t,t,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Qm(t,e,i,r,n,s,a,c){const p=[i[0]-e[0],i[1]-e[1],0],_=[r[0]-e[0],r[1]-e[1],0];if(_e.length(p)<1e-12||_e.length(_)<1e-12)return ot.identity(t);const v=_e.cross([],p,_);_e.normalize(v,v),_e.subtract(_,r,e),p[2]=(s-n)*c,_[2]=(a-n)*c;const E=p;return _e.cross(E,p,_),_e.normalize(E,E),ot.rotationTo(t,v,E)}function Xx(t,e,i=!1){const r=Uo(e.zoom),n=function(s,a,c){const p=a.worldSize,_=[s[12],s[13],s[14]],v=So(_[1]/p),E=TA(_[0]/p),C=ce.identity([]),B=On(1,v)*p,O=On(1,0)*p*sh(v,a.zoom),G=1/$d(p);let q=O*G;if(c){const re=j0(a.projection,a.zoom,a.width,a.height,1024);q=G*a.projection.pixelSpaceConversion(a.center.lat,p,re)}const $=da(v,E);_e.add($,$,_e.scale([],_e.normalize([],$),B*q*_[2]));const J=function(re){const te=[re[0],re[1],re[2]];let se=[0,1,0];const he=_e.cross([],se,te);return _e.cross(se,te,he),_e.squaredLength(se)===0&&(se=[0,1,0],_e.cross(he,te,se)),_e.normalize(he,he),_e.normalize(se,se),_e.normalize(te,te),[he[0],he[1],he[2],0,se[0],se[1],se[2],0,te[0],te[1],te[2],0,re[0],re[1],re[2],1]}($);ce.scale(C,C,[q,q,q*B]),ce.translate(C,C,[-_[0],-_[1],-_[2]]);const ie=ce.multiply([],a.globeMatrix,J);return ce.multiply(ie,ie,C),ce.multiply(ie,ie,s),ie}(t,e,i);if(r>0){const s=function(a,c){const p=c.worldSize,_=On(1,0)*p*sh(c.center.lat,c.zoom)/$d(p),v=On(1,c.center.lat)*p,E=ce.identity([]);return ce.rotateY(E,E,Li(c.center.lng)),ce.rotateX(E,E,Li(c.center.lat)),ce.translate(E,E,[0,0,Fn]),ce.scale(E,E,[_,_,_*v]),ce.translate(E,E,[c.point.x-.5*p,c.point.y-.5*p,0]),ce.multiply(E,E,a),ce.multiply(E,c.globeMatrix,E)}(t,e);return function(a,c,p){const _=(O,G,q)=>{const $=_e.length(O),J=_e.length(G),ie=ha(O,G,q);return _e.scale(ie,ie,1/_e.length(ie)*Ji($,J,q))},v=_([a[0],a[1],a[2]],[c[0],c[1],c[2]],p),E=_([a[4],a[5],a[6]],[c[4],c[5],c[6]],p),C=_([a[8],a[9],a[10]],[c[8],c[9],c[10]],p),B=ha([a[12],a[13],a[14]],[c[12],c[13],c[14]],p);return[v[0],v[1],v[2],0,E[0],E[1],E[2],0,C[0],C[1],C[2],0,B[0],B[1],B[2],1]}(n,s,r)}return n}const Yh=64,EE=[1,1,1];class Yx{constructor(e,i,r,n){this.id=e,this.position=i!=null?new rr(i[0],i[1]):new rr(0,0),this.orientation=r??[0,0,0],this.nodes=n,this.uploaded=!1,this.aabb=new $r([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(e,i){if(ce.multiply(e.matrix,i,e.matrix),e.meshes)for(const r of e.meshes){const n=$r.applyTransform(r.aabb,e.matrix);this.aabb.encapsulate(n)}if(e.children)for(const r of e.children)this._applyTransformations(r,e.matrix)}computeBoundsAndApplyParent(){const e=ce.identity([]);for(const i of this.nodes)this._applyTransformations(i,e)}_positionModelOnTerrain(e,i){const r=e.elevation;if(!r)return 0;const n=$r.projectAabbCorners(this.aabb,this.matrix),s=On(1,this.position.lat)*e.worldSize,a=function($,J){const ie=[0,0,1],re=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const te of re){const se=$[te.corners[0]],he=$[te.corners[1]],ve=$[te.corners[2]],be=[he[0]-se[0],he[1]-se[1],J*(he[2]-se[2])],Ce=_e.cross(be,be,[ve[0]-se[0],ve[1]-se[1],J*(ve[2]-se[2])]);_e.normalize(Ce,Ce),te.dotProductWithUp=_e.dot(Ce,ie)}return re.sort((te,se)=>te.dotProductWithUp-se.dotProductWithUp),re[0].corners}(n,s),c=n[a[0]],p=n[a[1]],_=n[a[2]],v=n[a[3]],E=r.getAtPointOrZero(new Xr(c[0]/e.worldSize,c[1]/e.worldSize),0),C=r.getAtPointOrZero(new Xr(p[0]/e.worldSize,p[1]/e.worldSize),0),B=r.getAtPointOrZero(new Xr(_[0]/e.worldSize,_[1]/e.worldSize),0),O=r.getAtPointOrZero(new Xr(v[0]/e.worldSize,v[1]/e.worldSize),0),G=(E+O)/2,q=(C+B)/2;return G>q?C<B?Qm(i,p,v,c,C,O,E,s):Qm(i,_,c,v,B,E,O,s):E<O?Qm(i,c,p,_,E,C,B,s):Qm(i,v,_,p,O,B,C,s),Math.max(G,q)}computeModelMatrix(e,i,r,n,s,a,c=!1){const p=e.transform,_=p.zoom,v=p.project(this.position),E=sh(this.position.lat,_),C=1/E;ce.identity(this.matrix),ce.translate(this.matrix,this.matrix,[v.x+n[0]*C,v.y+n[1]*C,n[2]]);let B=1,O=1;const G=p.worldSize;if(c){if(p.projection.name==="mercator"){let ie=0;p.elevation&&(ie=p.elevation.getAtPointOrZero(new Xr(v.x/G,v.y/G),0));const re=U.transformMat4([],[v.x,v.y,ie,1],p.projMatrix)[3]/p.cameraToCenterDistance;B=re,O=re*sh(p.center.lat,_)}else if(p.projection.name==="globe"){const ie=Xx(this.matrix,p),re=ce.multiply([],p.projMatrix,ie),te=[0,0,0,1];U.transformMat4(te,te,re);const se=te[3]/p.cameraToCenterDistance,he=Uo(_),ve=p.projection.pixelsPerMeter(this.position.lat,G)*sh(this.position.lat,_),be=p.projection.pixelsPerMeter(p.center.lat,G)*sh(p.center.lat,_);B=se/Ji(ve,u1(p.center.lat),he),O=se*E/ve,B*=be,O*=be}}else B=C;ce.scale(this.matrix,this.matrix,[B,B,O]);const q=[...this.matrix],$=this.orientation,J=[];if($x(J,[$[0]+i[0],$[1]+i[1],$[2]+i[2]],r),ce.multiply(this.matrix,q,J),s&&p.elevation){let ie=0;const re=[];if(a&&p.elevation){ie=this._positionModelOnTerrain(p,re);const te=ce.fromQuat([],re),se=ce.multiply([],te,J);ce.multiply(this.matrix,q,se)}else ie=p.elevation.getAtPointOrZero(new Xr(v.x/G,v.y/G),0);ie!==0&&(this.matrix[14]+=ie)}}upload(e){if(!this.uploaded){for(const i of this.nodes)Ug(i,e);for(const i of this.nodes)Hm(i);this.uploaded=!0}}destroy(){for(const e of this.nodes)Wm(e)}}function G0(t,e,i=!1){t.uploaded||(t.gfxTexture=new ks(e,t.image,i?e.gl.R8:e.gl.RGBA,{useMipmap:t.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),t.uploaded=!0,t.image=null)}function ME(t,e,i){t.indexBuffer=e.createIndexBuffer(t.indexArray,!1,!0),t.vertexBuffer=e.createVertexBuffer(t.vertexArray,pE.members,!1,!0),t.normalArray&&(t.normalBuffer=e.createVertexBuffer(t.normalArray,yE.members,!1,!0)),t.texcoordArray&&(t.texcoordBuffer=e.createVertexBuffer(t.texcoordArray,gE.members,!1,!0)),t.colorArray&&(t.colorBuffer=e.createVertexBuffer(t.colorArray,(t.colorArray.bytesPerElement===12?mE:_E).members,!1,!0)),t.featureArray&&(t.pbrBuffer=e.createVertexBuffer(t.featureArray,vE.members,!0)),t.segments=wn.simpleSegment(0,0,t.vertexArray.length,t.indexArray.length);const r=t.material;r.pbrMetallicRoughness.baseColorTexture&&G0(r.pbrMetallicRoughness.baseColorTexture,e),r.pbrMetallicRoughness.metallicRoughnessTexture&&G0(r.pbrMetallicRoughness.metallicRoughnessTexture,e),r.normalTexture&&G0(r.normalTexture,e),r.occlusionTexture&&G0(r.occlusionTexture,e,i),r.emissionTexture&&G0(r.emissionTexture,e)}function Ug(t,e,i){if(t.meshes)for(const r of t.meshes)ME(r,e,i);if(t.children)for(const r of t.children)Ug(r,e,i)}function Hm(t){if(t.meshes)for(const e of t.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(t.children)for(const e of t.children)Hm(e)}function Wm(t){if(t.meshes)for(const i of t.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((e=i.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(t.children)for(const i of t.children)Wm(i)}class Kx{constructor(e,i){this.feature=e,this.instancedDataOffset=i,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class Jx{constructor(){this.instancedDataArray=new qf,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class ev{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0}}populate(e,i,r,n){this.tileToMeter=M0(r);const s=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:a,id:c,index:p,sourceLayerIndex:_}of e){const v=oh(a,s);if(!this.layers[0]._featureFilter.filter(new ds(this.zoom),v,r))continue;const E={id:c,sourceLayerIndex:_,index:p,geometry:s?v.geometry:uu(a,r,n),properties:a.properties,type:a.type,patterns:{}},C=this.addFeature(E,E.geometry,v);C&&i.featureIndex.insert(a,E.geometry,p,_,this.index,this.instancesPerModel[C].instancedDataArray.length)}this.lookup=null}update(e,i,r,n){for(const s in this.instancesPerModel){const a=this.instancesPerModel[s];for(const c in e)a.idToFeaturesIndex.hasOwnProperty(c)&&this.evaluate(a.features[a.idToFeaturesIndex[c]],e[c],a,!0)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const i in this.instancesPerModel){const r=this.instancesPerModel[i];for(const n of r.features){const s=this.layers[0],a=n.feature,c=this.canonical,p=s.paint.get("model-rotation").evaluate(a,{},c),_=s.paint.get("model-scale").evaluate(a,{},c),v=s.paint.get("model-translation").evaluate(a,{},c);_e.exactEquals(n.rotation,p)&&_e.exactEquals(n.scale,_)&&_e.exactEquals(n.translation,v)||(this.evaluate(n,n.featureStates,r,!0),e=!0)}}return e}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const i in this.instancesPerModel){const r=this.instancesPerModel[i];r.instancedDataArray.length<0||r.instancedDataArray.length===0||(r.instancedDataBuffer?r.instancedDataBuffer.updateData(r.instancedDataArray):r.instancedDataBuffer=e.createVertexBuffer(r.instancedDataArray,xE.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const e in this.instancesPerModel){const i=this.instancesPerModel[e];i.instancedDataArray.length!==0&&i.instancedDataBuffer&&i.instancedDataBuffer.destroy()}}addFeature(e,i,r){const n=this.layers[0],s=n.layout.get("model-id").evaluate(r,{},this.canonical);if(!s)return Pe(`modelId is not evaluated for layer ${n.id} and it is not going to get rendered.`),s;this.instancesPerModel[s]||(this.instancesPerModel[s]=new Jx);const a=this.instancesPerModel[s],c=a.instancedDataArray,p=new Kx(r,c.length);for(const _ of i)for(const v of _){if(v.x<0||v.x>=Mt||v.y<0||v.y>=Mt)continue;const E=(this.lookupDim-1)/Mt,C=this.lookupDim*(v.y*E|0)+v.x*E|0;if(this.lookup){if(this.lookup[C]!==0)continue;this.lookup[C]=1}this.instanceCount++;const B=c.length;c.resize(B+1),a.instancesEvaluatedElevation.push(0),c.float32[16*B]=v.x,c.float32[16*B+1]=v.y}return p.instancedDataCount=a.instancedDataArray.length-p.instancedDataOffset,p.instancedDataCount>0&&(e.id&&(a.idToFeaturesIndex[e.id]=a.features.length),a.features.push(p),this.evaluate(p,{},a,!1)),s}evaluate(e,i,r,n){const s=this.layers[0],a=e.feature,c=this.canonical,p=e.rotation=s.paint.get("model-rotation").evaluate(a,i,c),_=e.scale=s.paint.get("model-scale").evaluate(a,i,c),v=e.translation=s.paint.get("model-translation").evaluate(a,i,c),E=s.paint.get("model-color").evaluate(a,i,c);E.a=s.paint.get("model-color-mix-intensity").evaluate(a,i,c);const C=[];this.maxVerticalOffset<v[2]&&(this.maxVerticalOffset=v[2]),this.maxScale=Math.max(Math.max(this.maxScale,_[0]),Math.max(_[1],_[2])),$x(C,p,_);const B=Math.round(100*E.a)+E.b/1.05;for(let O=0;O<e.instancedDataCount;++O){const G=e.instancedDataOffset+O,q=16*G,$=r.instancedDataArray.float32;let J=0;n&&(J=$[q+6]-r.instancesEvaluatedElevation[G]);const ie=0|$[q+1];$[q]=(0|$[q])+E.r/1.05,$[q+1]=ie+E.g/1.05,$[q+2]=B,$[q+3]=1/(c.z>10?this.tileToMeter:M0(c,ie)),$[q+4]=v[0],$[q+5]=v[1],$[q+6]=v[2]+J,$[q+7]=C[0],$[q+8]=C[1],$[q+9]=C[2],$[q+10]=C[4],$[q+11]=C[5],$[q+12]=C[6],$[q+13]=C[8],$[q+14]=C[9],$[q+15]=C[10],r.instancesEvaluatedElevation[G]=v[2]}}}Ii(ev,"ModelBucket",{omit:["layers"]}),Ii(Jx,"PerModelAttributes"),Ii(Kx,"ModelFeature");const SE=new ss({visibility:new si(xt.layout_model.visibility),"model-id":new qi(xt.layout_model["model-id"])});var IE={paint:new ss({"model-opacity":new si(xt.paint_model["model-opacity"]),"model-rotation":new qi(xt.paint_model["model-rotation"]),"model-scale":new qi(xt.paint_model["model-scale"]),"model-translation":new qi(xt.paint_model["model-translation"]),"model-color":new qi(xt.paint_model["model-color"]),"model-color-mix-intensity":new qi(xt.paint_model["model-color-mix-intensity"]),"model-type":new si(xt.paint_model["model-type"]),"model-cast-shadows":new si(xt.paint_model["model-cast-shadows"]),"model-receive-shadows":new si(xt.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new si(xt.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new qi(xt.paint_model["model-emissive-strength"]),"model-roughness":new qi(xt.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new qi(xt.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new si(xt.paint_model["model-cutoff-fade-range"])}),layout:SE};const jg=new Float32Array(262144),Kh=new Uint8Array(262144);function tv(t){let e=0;if(t.meshes)for(const i of t.meshes)e=Math.max(e,i.aabb.max[2]);if(t.children)for(const i of t.children)e=Math.max(e,tv(i));return e}const iv=["","wall","door","roof","window","lamp","logo"];class rv{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:e.id,geometry:[],properties:{height:tv(e)}}}}class nv{constructor(e,i,r,n){this.nodes=e,this.id=i,this.modelTraits|=1,this.uploaded=!1,this.hasPattern=!1,r&&(this.modelTraits|=4),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=n,this.dirty=!0,this.needsUpload=!1}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const i=this.getNodesInfo();for(const r of i){const n=r.node;this.uploaded?this.updatePbrBuffer(n):Ug(n,e,!0)}for(const r of i)Hm(r.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let i=!1;if(!e.meshes)return i;for(const r of e.meshes)r.pbrBuffer&&(r.pbrBuffer.updateData(r.featureArray),i=!0);return i}needsReEvaluation(e,i,r){const n=e.transform.projectionOptions,s=e.style.getBrightness(),a=this.brightness!==s;return!!(!this.uploaded||this.dirty||n.name!==this.projection.name||Z0(r.paint.get("model-color").value,a)||Z0(r.paint.get("model-color-mix-intensity").value,a)||Z0(r.paint.get("model-roughness").value,a)||Z0(r.paint.get("model-emissive-strength").value,a)||Z0(r.paint.get("model-height-based-emissive-strength-multiplier").value,a))&&(this.projection=n,this.brightness=s,!0)}evaluateScale(e,i){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const r=this.getNodesInfo(),n=this.id.canonical;for(const s of r){const a=s.feature;s.evaluatedScale=i.paint.get("model-scale").evaluate(a,{},n)}}evaluate(e){const i=this.getNodesInfo();for(const r of i){if(!r.node.meshes)continue;const n=r.feature,s=r.node.meshes&&r.node.meshes[0].featureData,a=r.evaluatedColor[2],c=r.evaluatedRMEA[2],p=this.id.canonical;if(r.hasTranslucentParts=!1,s){for(let _=0;_<iv.length;_++){const v=iv[_];v.length&&(n.properties.part=v);const E=e.paint.get("model-color").evaluate(n,{},p),C=e.paint.get("model-color-mix-intensity").evaluate(n,{},p);r.evaluatedColor[_]=[E.r,E.g,E.b,C],r.evaluatedRMEA[_][0]=e.paint.get("model-roughness").evaluate(n,{},p),r.evaluatedRMEA[_][2]=e.paint.get("model-emissive-strength").evaluate(n,{},p),r.evaluatedRMEA[_][3]=E.a,r.emissionHeightBasedParams[_]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(n,{},p),!r.hasTranslucentParts&&E.a<1&&(r.hasTranslucentParts=!0)}delete n.properties.part,kE(r,a!==r.evaluatedColor[2]||c!==r.evaluatedRMEA[2])}r.evaluatedScale=e.paint.get("model-scale").evaluate(n,{},p),this.updatePbrBuffer(r.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,i,r,n){const s=e.findDEMTileFor(r);if(s&&(s.tileID.canonical!==this.terrainTile||i!==this.terrainExaggeration)){if(s.dem&&s.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=s.tileID.overscaledZ;const a=rf.create(e,r,s);if(!a)return;4&this.modelTraits&&this.updateDEM(e,a,r,n);for(const c of this.getNodesInfo()){const p=c.node;if(!p.footprint||!p.footprint.vertices||!p.footprint.vertices.length)continue;const _=p.footprint.vertices;let v=a.getElevationAt(_[0].x,_[0].y,!0,!0);for(let E=1;E<_.length;E++)v=Math.min(v,a.getElevationAt(_[E].x,_[E].y,!0,!0));p.elevation=v}}this.terrainTile=s.tileID.canonical,this.terrainExaggeration=i}}updateDEM(e,i,r,n){let s=i._dem._modifiedForSources[n];if(s===void 0&&(i._dem._modifiedForSources[n]=[],s=i._dem._modifiedForSources[n]),s.includes(r.canonical))return;const a=i._dem.dim;s.push(r.canonical);let c=!1;for(const p of this.getNodesInfo()){const _=p.node;if(!_.footprint||!_.footprint.grid)continue;const v=_.footprint.grid,E=i.tileCoordToPixel(v.min.x,v.min.y),C=i.tileCoordToPixel(v.max.x,v.max.y),B=Math.min(Math.min(a-C.y,E.x),Math.min(E.y,a-C.x));if(B<0)continue;const O=hi(B,2,5);let G=Math.max(0,E.x-O),q=Math.max(0,E.y-O),$=Math.min(C.x+O,a-1),J=Math.min(C.y+O,a-1);for(let se=q;se<=J;++se)for(let he=G;he<=$;++he)Kh[se*a+he]=255;let ie=0,re=0;for(let se=0;se<v.cellsY;++se)for(let he=0;he<v.cellsX;++he){if(!v.cells[se*v.cellsX+he])continue;const ve=i.tileCoordToPixel(v.min.x+he/v.xScale,v.min.y+se/v.yScale),be=i.tileCoordToPixel(v.min.x+(he+1)/v.xScale,v.min.y+(se+1)/v.yScale);for(let Ce=ve.y;Ce<=Math.min(be.y+1,a-1);++Ce)for(let Ne=ve.x;Ne<=Math.min(be.x+1,a-1);++Ne)Kh[Ce*a+Ne]===255&&(Kh[Ce*a+Ne]=0,ie+=i.getElevationAtPixel(Ne,Ce),re++)}const te=ie/re;G=Math.max(1,E.x-O),q=Math.max(1,E.y-O),$=Math.min(C.x+O,a-2),J=Math.min(C.y+O,a-2),c=!0;for(let se=q;se<=J;++se)for(let he=G;he<=$;++he)Kh[se*a+he]===0&&(jg[se*a+he]=i._dem.set(he,se,te));for(let se=1;se<O;++se){G=Math.max(1,E.x-se),q=Math.max(1,E.y-se),$=Math.min(C.x+se,a-2),J=Math.min(C.y+se,a-2);for(let he=q;he<=J;++he)for(let ve=G;ve<=$;++ve){const be=he*a+ve;if(Kh[be]===255){let Ce=0,Ne=0,je=-1,Ye=-1;for(let Re=-1;Re<=1;++Re)for(let rt=-1;rt<=1;++rt){const lt=(he+Re)*a+ve+rt;if(Kh[lt]>=se)continue;const vt=jg[lt],it=Math.abs(vt);it>Ne&&(Ce=vt,Ne=it,je=rt,Ye=Re)}if(Ne>.1){const Re=1-(se+.5*Math.abs(je*Ye))/O;let rt=i._dem.get(ve,he)+Ce*Re;const lt=i._dem.get(ve+je,he+Ye),vt=i._dem.get(ve-je,he-Ye,!0);(rt-lt)*(rt-vt)>0&&(rt=(lt+vt)/2),jg[be]=i._dem.set(ve,he,rt),Kh[be]=se}}}}}c&&(i._demTile.needsDEMTextureUpload=!0,i._dem._timestamp=Xi.now())}getNodesInfo(){if(!this.nodesInfo){this.nodesInfo=[];for(const e of this.nodes)this.nodesInfo.push(new rv(e));this.freeNodes()}return this.nodesInfo}freeNodes(){if(this.nodes){for(const e of this.nodes)Wm(e);this.nodes.splice(0,this.nodes.length)}}destroy(){this.freeNodes();const e=this.getNodesInfo();for(const i of e)Hm(i.node),Wm(i.node)}isEmpty(){return!this.nodes.length}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const r=i.getReplacementRegionsForTile(e.toUnwrapped()),n=this.getNodesInfo();for(let s=0;s<this.nodesInfo.length;s++){const a=n[s].node;n[s].hiddenByReplacement=!!a.footprint&&!r.find(c=>c.footprint===a.footprint)}}getHeightAtTileCoord(e,i){const r=this.getNodesInfo(),n=[];for(let s=0;s<this.nodesInfo.length;s++){const a=r[s],c=a.node.meshes[0];if(e<c.aabb.min[0]||i<c.aabb.min[1]||e>c.aabb.max[0]||i>c.aabb.max[1])continue;const p=(e-c.aabb.min[0])/(c.aabb.max[0]-c.aabb.min[0])*Yh|0,_=Math.min(63,(i-c.aabb.min[1])/(c.aabb.max[1]-c.aabb.min[1])*Yh|0)*Yh+Math.min(63,p);if(!(c.heightmap[_]<0&&a.node.footprint))return a.hiddenByReplacement?void 0:{height:c.heightmap[_],maxHeight:a.feature.properties.height,hidden:!1,verticalScale:a.evaluatedScale[2]};if(a.node.footprint.grid.query(new At(e,i),new At(e,i),n),n.length>0)return{height:void 0,maxHeight:a.feature.properties.height,hidden:a.hiddenByReplacement,verticalScale:a.evaluatedScale[2]}}}}function Z0(t,e){return!t.isLightConstant&&e}function CE(t,e,i,r,n,s,a,c){let p=(61440&e|(61440&e)>>4)>>8,_=(3840&e|(3840&e)>>4)>>4,v=240&e|(240&e)>>4;i[3]>0&&(p=Ji(p,255*i[0],i[3]),_=Ji(_,255*i[1],i[3]),v=Ji(v,255*i[2],i[3]));const E=p<<8|_,C=v<<8|Math.floor(255*r[3]),B=function(se){const he=hi(se,0,2);return Math.min(Math.round(.5*he*255),255)}(r[2])<<8|15*r[0]<<4|15*r[1],O=hi(n[0],0,1),G=hi(n[1],0,1),q=hi(n[2],0,1),$=hi(n[3],0,1);let J,ie,re,te;if(O!==G&&a!==s&&G!==O){const se=a-s;ie=1/(se*(G-O)),re=-(s+se*O)/(se*(G-O));const he=hi(n[4],-1,1);te=Math.pow(10,he),J=255*q<<8|255*$}else J=65535,ie=0,re=1,te=1;if(t.emplaceBack(E,C,B,J,ie,re,te),c){const se=c.length;c.clear();for(let he=0;he<se;he++)c.emplaceBack(E,C,B,J,ie,re,te)}}function kE(t,e){const i=t.node;let r=0;for(const n of i.meshes){if(i.lights&&i.lightMeshIndex===r||!n.featureData)continue;n.featureArray=new zh,n.featureArray.reserve(n.featureData.length);let s=e;for(const a of n.featureData){let c;const p=65535&a,_=(15&p)<8?15&p:0,v=a>>16&65535,E=t.evaluatedRMEA[_],C=t.evaluatedColor[_],B=t.emissionHeightBasedParams[_];if(s&&_===2&&i.lights&&(c=new zh,c.resize(10*i.lights.length)),CE(n.featureArray,v,C,E,B,n.aabb.min[2],n.aabb.max[2],c),c&&s){s=!1;const O=i.meshes[i.lightMeshIndex];O.featureArray=c,O.featureArray._trim()}}n.featureArray._trim(),r++}}Ii(nv,"Tiled3dModelBucket",{omit:["layers"]}),Ii(rv,"Tiled3dModelFeature");class DE{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[]}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(e){const i=av(new At(0,0),new At(Mt,Mt),e),r=[];for(const n of this._activeRegions){if(n.hiddenByOverlap||!ov(i,n))continue;const s=PE(n.min,n.max,e);r.push({min:s.min,max:s.max,sourceId:this._sourceIds[n.priority],footprint:n.footprint,footprintTileId:n.tileId})}return r}setSources(e){this._setSources(e.map(i=>({getSourceId:()=>i.cache.id,getFootprints:()=>{const r=[];for(const n of i.cache.getVisibleCoordinates()){const s=i.cache.getTile(n).buckets[i.layer];if(s)for(const a of s.getNodesInfo()){const c=a.node;c.footprint&&r.push({footprint:c.footprint,id:n.toUnwrapped()})}}return r}})))}_addSource(e){const i=e.getFootprints();if(i.length!==0){for(const r of i){if(!r.footprint)continue;const n=av(r.footprint.min,r.footprint.max,r.id);this._activeRegions.push({min:n.min,max:n.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:r.id,footprint:r.footprint})}this._sourceIds.push(e.getSourceId())}}_computeReplacement(){this._activeRegions.sort((i,r)=>i.priority-r.priority||$m(i.min,r.min)||$m(i.max,r.max));let e=this._activeRegions.length!==this._prevRegions.length;if(!e){let i=0,r=0;for(;!e&&i!==this._activeRegions.length;){const n=this._activeRegions[i],s=this._prevRegions[r];e=n.priority!==s.priority||!sv(n,s),++i,++r}}if(e){++this._updateTime;const i=r=>{const n=this._activeRegions;if(r>=n.length)return r;const s=n[r].priority;for(;r<n.length&&n[r].priority===s;)++r;return r};if(this._sourceIds.length>1){let r=0,n=i(r);for(;r!==n;){let s=r;const a=r;for(;s!==n;){const c=this._activeRegions[s];c.hiddenByOverlap=!1;for(let p=0;p<a;p++){const _=this._activeRegions[p];if(!_.hiddenByOverlap&&ov(c,_)&&(c.hiddenByOverlap=Av(c.footprint,c.tileId,_.footprint,_.tileId),c.hiddenByOverlap))break}++s}r=n,n=i(r)}}}}_setSources(e){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let i=e.length-1;i>=0;i--)this._addSource(e[i]);this._computeReplacement()}}function $m(t,e){return t.x-e.x||t.y-e.y}function sv(t,e){return $m(t.min,e.min)===0&&$m(t.max,e.max)===0}function ov(t,e){return!(t.min.x>e.max.x||t.max.x<e.min.x||t.min.y>e.max.y||t.max.y<e.min.y)}function av(t,e,i){const r=1/Mt,n=1/(1<<i.canonical.z),s=(e.x*r+i.canonical.x)*n+i.wrap,a=(e.y*r+i.canonical.y)*n;return{min:new At((t.x*r+i.canonical.x)*n+i.wrap,(t.y*r+i.canonical.y)*n),max:new At(s,a)}}function PE(t,e,i){const r=1<<i.canonical.z,n=((e.x-i.wrap)*r-i.canonical.x)*Mt,s=(e.y*r-i.canonical.y)*Mt;return{min:new At(((t.x-i.wrap)*r-i.canonical.x)*Mt,(t.y*r-i.canonical.y)*Mt),max:new At(n,s)}}function lv(t,e,i,r,n,s,a){const c=t.indices,p=t.vertices,_=[];for(let v=r;v<r+n;v+=3){const E=e[i[v+0]+s],C=e[i[v+1]+s],B=e[i[v+2]+s],O=Math.min(E.x,C.x,B.x),G=Math.max(E.x,C.x,B.x),q=Math.min(E.y,C.y,B.y),$=Math.max(E.y,C.y,B.y);_.length=0,t.grid.query(new At(O,q),new At(G,$),_);for(let J=0;J<_.length;J++){const ie=_[J];if(lg(p[c[3*ie+0]],p[c[3*ie+1]],p[c[3*ie+2]],E,C,B,a))return!0}}return!1}function Av(t,e,i,r){if(!t||!i)return!1;let n=t.vertices;if(!e.canonical.equals(r.canonical)||e.wrap!==r.wrap){if(i.vertices.length<t.vertices.length)return Av(i,r,t,e);const s=e.canonical,a=r.canonical,c=Math.pow(2,a.z-s.z);n=t.vertices.map(p=>new At(p.x*s.x*Mt*c-a.x*Mt,p.y*s.y*Mt*c-a.y*Mt))}return lv(i,n,t.indices,0,t.indices.length,0,0)}const zE=gm.types,BE=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],LE=["fill-extrusion-flood-light-ground-radius"],RE=Math.pow(2,13),FE=Math.pow(2,15)-1,cv=new At(0,1),pu=2147483648;function q0(t,e,i,r,n,s,a,c){t.emplaceBack((e<<1)+a,(i<<1)+s,(Math.floor(r*RE)<<1)+n,Math.round(c))}function Xm(t,e,i,r,n,s){t.emplaceBack(e.x,e.y,(i.x<<1)+r,(i.y<<1)+n,s)}function Q0(t,e,i){t.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class uv{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class hv{constructor(){this.centroidXY=new At(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new At(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new At(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new At(this.max.x-this.min.x,this.max.y-this.min.y)}}class dv{constructor(){this.acc=new At(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,i){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=i.x,e.min.y=e.max.y=i.y)}appendEdge(e,i,r){this.accCount++,this.acc._add(i);let n=!!this.borders;i.x<e.min.x?(e.min.x=i.x,n=!0):i.x>e.max.x&&(e.max.x=i.x,n=!0),i.y<e.min.y?(e.min.y=i.y,n=!0):i.y>e.max.y&&(e.max.y=i.y,n=!0),((i.x===0||i.x===Mt)&&i.x===r.x)!=((i.y===0||i.y===Mt)&&i.y===r.y)&&this.processBorderOverlap(i,r),n&&this.checkBorderIntersection(i,r)}checkBorderIntersection(e,i){i.x<0!=e.x<0&&this.addBorderIntersection(0,Ji(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>Mt!=e.x>Mt&&this.addBorderIntersection(1,Ji(i.y,e.y,(Mt-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,Ji(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>Mt!=e.y>Mt&&this.addBorderIntersection(3,Ji(i.x,e.x,(Mt-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const r=this.borders[e];i<r[0]&&(r[0]=i),i>r[1]&&(r[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const r=e.x===0?0:1;this.addBorderIntersection(r,i.y),this.addBorderIntersection(r,e.y)}else{const r=e.y===0?2:3;this.addBorderIntersection(r,i.x),this.addBorderIntersection(r,e.x)}}centroid(){return this.accCount===0?new At(0,0):new At(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0):0}}function fv(t,e){const i=t.add(e)._unit(),r=hi(t.x*i.x+t.y*i.y,-1,1);var n,s,a;return n=Math.acos(r),Math.min(4,Math.max(-4,Math.tan(n)))/4*FE*((s=t).x*(a=e).y-s.y*a.x<0?-1:1)}const OE=[t=>t.x<0,t=>t.x>Mt,t=>t.y<0,t=>t.y>Mt];function VE(t,e,i,r){const n=[4];if(r===0)return n;i._mult(r);const s=t.sub(i),a=e.sub(i),c=[t,e,s,a];for(let p=0;p<4;p++)for(const _ of c)if(OE[p](_)){n.push(p);break}return n}class pv{constructor(e){this.vertexArray=new yd,this.indexArray=new Ys,this.programConfigurations=new dc(e.layers,e.zoom,i=>LE.includes(i)),this._segments=new wn,this.hiddenByLandmarkVertexArray=new Qf,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new wn}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,i,r,n=!1){const s=e.length;if(s>2){let a=Math.max(0,this._segments.get().length-1);const c=this._segments._prepareSegment(4*s,this.vertexArray.length,2*this._segmentToGroundQuads[a].length);let p;a!==this._segments.get().length-1&&(a++,this._segmentToGroundQuads[a]=[],this._segmentToRegionTriCounts[a]=[0,0,0,0,0]);{const _=e[0],v=e[1];p=fv(_.sub(e[s-1])._perp()._unit(),v.sub(_)._perp()._unit())}for(let _=0;_<s;_++){const v=_===s-1?0:_+1,E=e[_],C=e[v],B=e[v===s-1?0:v+1],O=C.sub(E)._perp()._unit(),G=fv(O,B.sub(C)._perp()._unit()),q=p,$=G;if(Gg(E,C,i)||n&&gv(E,i)&&gv(C,i)){p=G;continue}const J=c.vertexLength;Xm(this.vertexArray,E,C,1,1,q),Xm(this.vertexArray,E,C,1,0,q),Xm(this.vertexArray,E,C,0,1,$),Xm(this.vertexArray,E,C,0,0,$),c.vertexLength+=4;const ie=VE(E,C,O,r);for(const re of ie)this._segmentToGroundQuads[a].push({id:J,region:re}),this._segmentToRegionTriCounts[a][re]+=2,c.primitiveLength+=2;p=G}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),i=e.length;for(let r=0;r<i;r++)this._segmentToGroundQuads[r].sort((n,s)=>n.region-s.region);for(let r=0;r<i;r++){const n=this._segmentToGroundQuads[r],s=e[r],a=this._segmentToRegionTriCounts[r];a.reduce((p,_)=>p+_,0);let c=0;for(let p=0;p<=4;p++){const _=a[p];if(_!==0){let v=this.regionSegments[p];v||(v=this.regionSegments[p]=new wn);const E={vertexOffset:s.vertexOffset,primitiveOffset:s.primitiveOffset+c,vertexLength:s.vertexLength,primitiveLength:_};v.get().push(E)}c+=_}for(let p=0;p<n.length;p++){const _=n[p].id;this.indexArray.emplaceBack(_,_+1,_+3),this.indexArray.emplaceBack(_,_+3,_+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,i,r,n,s,a){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,i,r,n,s,a)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,c3.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,i,r,n,s,a){this.hasData()&&this.programConfigurations.updatePaintArrays(e,i,r,n,s,a)}updateHiddenByLandmark(e){if(!this.hasData())return;const i=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;const r=e.flags&pu?1:0;for(let n=e.groundVertexArrayOffset;n<i;++n)this.hiddenByLandmarkVertexArray.emplace(n,r);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,h3.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const i=this.regionSegments[e];i&&i.destroy()}}}}class H0{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Ys,this.footprintVertices=new ul,this.footprintSegments=[],this.layoutVertexArray=new Dc,this.centroidVertexArray=new Ed,this.indexArray=new Ys,this.programConfigurations=new dc(e.layers,e.zoom,i=>BE.includes(i)),this.segments=new wn,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.groundEffect=new pv(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}populate(e,i,r,n){this.features=[],this.hasPattern=pg("fill-extrusion",this.layers,i),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=M0(r),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:s,id:a,index:c,sourceLayerIndex:p}of e){const _=this.layers[0]._featureFilter.needGeometry,v=oh(s,_);if(!this.layers[0]._featureFilter.filter(new ds(this.zoom),v,r))continue;const E={id:a,sourceLayerIndex:p,index:c,geometry:_?v.geometry:uu(s,r,n),properties:s.properties,type:s.type,patterns:{}},C=this.layoutVertexArray.length;this.hasPattern?this.features.push(mg("fill-extrusion",this.layers,E,this.zoom,i)):this.addFeature(E,E.geometry,c,r,{},i.availableImages,n,i.brightness),i.featureIndex.insert(s,E.geometry,c,p,this.index,C)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,i,r,n,s,a){for(const c of this.features){const{geometry:p}=c;this.addFeature(c,p,c.index,i,r,n,s,a)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,i,r,n,s){const a=Object.keys(e).length!==0;if(a&&!this.stateDependentLayers.length)return;const c=a?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(e,i,c,r,n,s),this.groundEffect.update(e,i,c,r,n,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,f3),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,d3.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,u3.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,r,n,s,a,c,p){const _=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,v=[new At(0,0),new At(Mt,Mt)],E=c.projection,C=E.name==="globe",B=zE[e.type]==="Polygon",O=new dv;O.centroidDataIndex=this.centroidData.length;const G=new hv,q=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},n)<=0,$=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},n);G.height=$,G.vertexArrayOffset=this.layoutVertexArray.length,G.groundVertexArrayOffset=this.groundEffect.vertexArray.length,C&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new bd);const J=fg(i,500);for(let ve=J.length-1;ve>=0;ve--){const be=J[ve];(be.length===0||(ie=be[0]).every(Ce=>Ce.x<=0)||ie.every(Ce=>Ce.x>=Mt)||ie.every(Ce=>Ce.y<=0)||ie.every(Ce=>Ce.y>=Mt))&&J.splice(ve,1)}var ie;let re;if(C)re=bv(J,v,n);else{re=[];for(const ve of J)re.push({polygon:ve,bounds:v})}const te=B?this.edgeRadius:0,se=te>0&&this.zoom<17,he=(ve,be)=>{if(ve.length===0)return!1;const Ce=ve[ve.length-1];return be.x===Ce.x&&be.y===Ce.y};for(const{polygon:ve,bounds:be}of re){let Ce=0,Ne=0;for(const rt of ve)B&&!rt[0].equals(rt[rt.length-1])&&rt.push(rt[0]),Ne+=B?rt.length-1:rt.length;const je=this.segments.prepareSegment((B?5:4)*Ne,this.layoutVertexArray,this.indexArray);G.footprintSegIdx<0&&(G.footprintSegIdx=this.footprintSegments.length),G.polygonSegIdx<0&&(G.polygonSegIdx=this.polygonSegments.length);const Ye={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Re=new uv;if(Re.vertexOffset=this.footprintVertices.length,Re.indexOffset=3*this.footprintIndices.length,Re.ringIndices=[],B){const rt=[],lt=[];Ce=je.vertexLength;for(let it=0;it<ve.length;it++){const at=ve[it];at.length&&it!==0&&lt.push(rt.length/2);const Tt=[];let It,St;It=at[1].sub(at[0])._perp()._unit(),Re.ringIndices.push(at.length-1);for(let Lt=1;Lt<at.length;Lt++){const Ot=at[Lt],jt=at[Lt===at.length-1?1:Lt+1],Dt=Ot.clone();if(te){St=jt.sub(Ot)._perp()._unit();const Kt=It.add(St)._unit(),mi=te*Math.min(4,1/(It.x*Kt.x+It.y*Kt.y));Dt.x+=mi*Kt.x,Dt.y+=mi*Kt.y,Dt.x=Math.round(Dt.x),Dt.y=Math.round(Dt.y),It=St}!q||te!==0&&!se||he(Tt,Dt)||Tt.push(Dt),q0(this.layoutVertexArray,Dt.x,Dt.y,0,0,1,1,0),je.vertexLength++,this.footprintVertices.emplaceBack(Ot.x,Ot.y),rt.push(Ot.x,Ot.y),C&&Q0(this.layoutVertexExtArray,E.projectTilePoint(Dt.x,Dt.y,n),E.upVector(n,Dt.x,Dt.y))}q&&(te===0||se)&&(Tt.length!==0&&he(Tt,Tt[0])&&Tt.pop(),this.groundEffect.addData(Tt,be,_))}const vt=pm(rt,lt);for(let it=0;it<vt.length;it+=3)this.footprintIndices.emplaceBack(Re.vertexOffset+vt[it+0],Re.vertexOffset+vt[it+1],Re.vertexOffset+vt[it+2]),this.indexArray.emplaceBack(Ce+vt[it],Ce+vt[it+2],Ce+vt[it+1]),je.primitiveLength++;Re.indexCount+=vt.length,Re.vertexCount+=this.footprintVertices.length-Re.vertexOffset}for(let rt=0;rt<ve.length;rt++){const lt=ve[rt];O.startRing(G,lt[0]);let vt=lt.length>4&&yv(lt[lt.length-2],lt[0],lt[1]),it=te?NE(lt[lt.length-2],lt[0],lt[1],te):0;const at=[];let Tt,It,St;It=lt[1].sub(lt[0])._perp()._unit();let Lt=!0;for(let Ot=1,jt=0;Ot<lt.length;Ot++){let Dt=lt[Ot-1],Kt=lt[Ot];const mi=lt[Ot===lt.length-1?1:Ot+1];if(O.appendEdge(G,Kt,Dt),Gg(Kt,Dt,be)){te&&(It=mi.sub(Kt)._perp()._unit(),Lt=!Lt);continue}const _i=Kt.sub(Dt)._perp(),Ti=_i.x/(Math.abs(_i.x)+Math.abs(_i.y)),Mi=_i.y>0?1:0,ur=Dt.dist(Kt);if(jt+ur>32768&&(jt=0),te){St=mi.sub(Kt)._perp()._unit();let hr=_v(Dt,Kt,mi,mv(It,St),te);isNaN(hr)&&(hr=0);const or=Kt.sub(Dt)._unit();Dt=Dt.add(or.mult(it))._round(),Kt=Kt.add(or.mult(-hr))._round(),it=hr,It=St,q&&this.zoom>=17&&(he(at,Dt)||at.push(Dt),he(at,Kt)||at.push(Kt))}const Ui=je.vertexLength,on=lt.length>4&&yv(Dt,Kt,mi);let Zr=xv(jt,vt,Lt);if(q0(this.layoutVertexArray,Dt.x,Dt.y,Ti,Mi,0,0,Zr),q0(this.layoutVertexArray,Dt.x,Dt.y,Ti,Mi,0,1,Zr),jt+=ur,Zr=xv(jt,on,!Lt),vt=on,q0(this.layoutVertexArray,Kt.x,Kt.y,Ti,Mi,0,0,Zr),q0(this.layoutVertexArray,Kt.x,Kt.y,Ti,Mi,0,1,Zr),je.vertexLength+=4,this.indexArray.emplaceBack(Ui+0,Ui+1,Ui+2),this.indexArray.emplaceBack(Ui+1,Ui+3,Ui+2),je.primitiveLength+=2,te){const hr=Ce+(Ot===1?lt.length-2:Ot-2),or=Ot===1?Ce:hr+1;if(this.indexArray.emplaceBack(Ui+1,hr,Ui+3),this.indexArray.emplaceBack(hr,or,Ui+3),je.primitiveLength+=2,Tt===void 0&&(Tt=Ui),!Gg(mi,lt[Ot],be)){const $i=Ot===lt.length-1?Tt:je.vertexLength;this.indexArray.emplaceBack(Ui+2,Ui+3,$i),this.indexArray.emplaceBack(Ui+3,$i+1,$i),this.indexArray.emplaceBack(Ui+3,or,$i+1),je.primitiveLength+=3}Lt=!Lt}if(C){const hr=this.layoutVertexExtArray,or=E.projectTilePoint(Dt.x,Dt.y,n),$i=E.projectTilePoint(Kt.x,Kt.y,n),Hr=E.upVector(n,Dt.x,Dt.y),Jr=E.upVector(n,Kt.x,Kt.y);Q0(hr,or,Hr),Q0(hr,or,Hr),Q0(hr,$i,Jr),Q0(hr,$i,Jr)}}B&&(Ce+=lt.length-1),q&&te&&this.zoom>=17&&(at.length!==0&&he(at,at[0])&&at.pop(),this.groundEffect.addData(at,be,_,te>0))}this.footprintSegments.push(Re),Ye.triangleCount=this.indexArray.length-Ye.triangleArrayOffset,this.polygonSegments.push(Ye),++G.footprintSegLen,++G.polygonSegLen}if(G.vertexCount=this.layoutVertexArray.length-G.vertexArrayOffset,G.groundVertexCount=this.groundEffect.vertexArray.length-G.groundVertexArrayOffset,G.vertexCount!==0){if(G.centroidXY=O.borders?cv:this.encodeCentroid(O,G),this.centroidData.push(G),O.borders){this.featuresOnBorder.push(O);const ve=this.featuresOnBorder.length-1;for(let be=0;be<O.borders.length;be++)O.borders[be][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[be].push(ve)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,s,a,n,p),this.groundEffect.addPaintPropertiesData(e,r,s,a,n,p),this.maxHeight=Math.max(this.maxHeight,$)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((i,r)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[r].borders[e][0])}splitToSubtiles(){const e=[];for(let c=0;c<this.centroidData.length;c++){const p=this.centroidData[c],_=+(p.min.y+p.max.y>Mt),v=2*_+(+(p.min.x+p.max.x>Mt)^_);for(let E=0;E<p.polygonSegLen;E++){const C=p.polygonSegIdx+E;e.push({centroidIdx:c,subtile:v,polygonSegmentIdx:C,triangleSegmentIdx:this.polygonSegments[C].triangleSegIdx})}}const i=new Ys;e.sort((c,p)=>c.triangleSegmentIdx===p.triangleSegmentIdx?c.subtile-p.subtile:c.triangleSegmentIdx-p.triangleSegmentIdx);let r=0,n=0,s=0;for(const c of e){if(c.triangleSegmentIdx!==r)break;s++}const a=e.length;for(;n!==e.length;){r=e[n].triangleSegmentIdx;let c=0,p=n,_=n;for(let v=p;v<s&&e[v].subtile===c;v++)_++;for(;p!==s;){const v=e[p];c=v.subtile;const E=this.centroidData[v.centroidIdx].min.clone(),C=this.centroidData[v.centroidIdx].max.clone(),B={vertexOffset:this.segments.segments[r].vertexOffset,primitiveOffset:i.length,vertexLength:this.segments.segments[r].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let O=p;O<_;O++){const G=e[O],q=this.polygonSegments[G.polygonSegmentIdx],$=this.centroidData[G.centroidIdx].min,J=this.centroidData[G.centroidIdx].max,ie=this.indexArray.uint16;for(let re=q.triangleArrayOffset;re<q.triangleArrayOffset+q.triangleCount;re++)i.emplaceBack(ie[3*re],ie[3*re+1],ie[3*re+2]);B.primitiveLength+=q.triangleCount,E.x=Math.min(E.x,$.x),E.y=Math.min(E.y,$.y),C.x=Math.max(C.x,J.x),C.y=Math.max(C.y,J.y)}B.primitiveLength>0&&this.triangleSubSegments.push({segment:B,min:E,max:C}),p=_;for(let O=p;O<s&&e[O].subtile===e[p].subtile;O++)_++}n=s;for(let v=n;v<a&&e[v].triangleSegmentIdx===e[n].triangleSegmentIdx;v++)s++}i._trim(),this.indexArray=i}getVisibleSegments(e,i,r){let n=0,s=0;const a=1<<e.canonical.z;if(i){const G=i.getMinMaxForTile(e);G&&(n=G.min,s=G.max)}s+=this.maxHeight;const c=e.toUnwrapped();let p;const _=[c.canonical.x/a+c.wrap,c.canonical.y/a],v=[(c.canonical.x+1)/a+c.wrap,(c.canonical.y+1)/a],E=new wn,C=(G,q,$)=>[G[0]*(1-$[0])+q[0]*$[0],G[1]*(1-$[1])+q[1]*$[1]],B=[],O=[];for(const G of this.triangleSubSegments){B[0]=G.min.x/Mt,B[1]=G.min.y/Mt,O[0]=G.max.x/Mt,O[1]=G.max.y/Mt;const q=C(_,v,B),$=C(_,v,O);if(new $r([q[0],q[1],n],[$[0],$[1],s]).intersectsPrecise(r)===0){p&&(E.segments.push(p),p=void 0);continue}const J=G.segment;p&&p.vertexOffset!==J.vertexOffset&&(E.segments.push(p),p=void 0),p?(p.vertexLength+=J.vertexLength,p.primitiveLength+=J.primitiveLength):p={vertexOffset:J.vertexOffset,primitiveLength:J.primitiveLength,vertexLength:J.vertexLength,primitiveOffset:J.primitiveOffset,sortKey:void 0,vaos:{}}}return p&&E.segments.push(p),E}encodeCentroid(e,i){const r=e.centroid(),n=i.span(),s=Math.min(7,Math.round(n.x*this.tileToMeter/10)),a=Math.min(7,Math.round(n.y*this.tileToMeter/10));return new At(hi(r.x,1,Mt-1)<<3|s,hi(r.y,1,Mt-1)<<3|a)}showCentroid(e){const i=this.centroidData[e.centroidDataIndex];i.flags&=pu,i.centroidXY.x=0,i.centroidXY.y=0,this.writeCentroidToBuffer(i)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const i=e.vertexArrayOffset,r=e.vertexCount+e.vertexArrayOffset,n=e.flags&pu?cv:e.centroidXY,s=this.centroidVertexArray.geta_centroid_pos0(i);if(this.centroidVertexArray.geta_centroid_pos1(i)!==n.y||s!==n.x){for(let a=i;a<r;++a)this.centroidVertexArray.emplace(a,n.x,n.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const r=i.getReplacementRegionsForTile(e.toUnwrapped());if(function(s,a){if(s.length!==a.length)return!1;for(let c=0;c<s.length;c++)if(s[c].sourceId!==a[c].sourceId||!sv(s[c],a[c]))return!1;return!0}(this.activeReplacements,r))return;if(this.activeReplacements=r,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const s of this.centroidData)s.flags&=2147483647;const n=[];for(const s of this.activeReplacements){const a=Math.pow(2,s.footprintTileId.canonical.z-e.canonical.z);for(const c of this.centroidData)if(!(c.flags&pu||s.min.x>c.max.x||c.min.x>s.max.x||s.min.y>c.max.y||c.min.y>s.max.y))for(let p=0;p<c.footprintSegLen;p++){const _=this.footprintSegments[c.footprintSegIdx+p];if(n.length=0,UE(this.footprintVertices,_.vertexOffset,_.vertexCount,s.footprintTileId.canonical,e.canonical,n),lv(s.footprint,n,this.footprintIndices.uint16,_.indexOffset,_.indexCount,-_.vertexOffset,-a)){c.flags|=pu;break}}}for(const s of this.centroidData)this.writeCentroidToBuffer(s);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,i,r){let n=!1;for(let s=0;s<r.footprintSegLen;s++){const a=this.footprintSegments[r.footprintSegIdx+s];let c=0;for(const p of a.ringIndices){for(let _=c,v=p+c-1;_<p+c;v=_++){const E=this.footprintVertices.int16[2*(_+a.vertexOffset)+0],C=this.footprintVertices.int16[2*(_+a.vertexOffset)+1],B=this.footprintVertices.int16[2*(v+a.vertexOffset)+1];C>i!=B>i&&e<(this.footprintVertices.int16[2*(v+a.vertexOffset)+0]-E)*(i-C)/(B-C)+E&&(n=!n)}c=p}}return n}getHeightAtTileCoord(e,i){let r=Number.NEGATIVE_INFINITY,n=!0;const s=4*(e+Mt)*Mt+(i+Mt);if(this.partLookup.hasOwnProperty(s)){const a=this.partLookup[s];return a?{height:a.height,hidden:!!(a.flags&pu)}:void 0}for(const a of this.centroidData)e>a.max.x||a.min.x>e||i>a.max.y||a.min.y>i||this.footprintContainsPoint(e,i,a)&&a&&a.height>r&&(r=a.height,this.partLookup[s]=a,n=!!(a.flags&pu));if(r!==Number.NEGATIVE_INFINITY)return{height:r,hidden:n};this.partLookup[s]=void 0}}function mv(t,e){const i=t.add(e)._unit();return t.x*i.x+t.y*i.y}function NE(t,e,i,r){const n=e.sub(t)._perp()._unit(),s=i.sub(e)._perp()._unit();return _v(t,e,i,mv(n,s),r)}function _v(t,e,i,r,n){const s=Math.sqrt(1-r*r);return Math.min(t.dist(e)/3,e.dist(i)/3,n*s/r)}function Gg(t,e,i){return t.x<i[0].x&&e.x<i[0].x||t.x>i[1].x&&e.x>i[1].x||t.y<i[0].y&&e.y<i[0].y||t.y>i[1].y&&e.y>i[1].y}function gv(t,e){return t.x<e[0].x||t.x>e[1].x||t.y<e[0].y||t.y>e[1].y}function yv(t,e,i){if(t.x<0||t.x>=Mt||e.x<0||e.x>=Mt||i.x<0||i.x>=Mt)return!1;const r=i.sub(e),n=r.perp(),s=t.sub(e);return(r.x*s.x+r.y*s.y)/Math.sqrt((r.x*r.x+r.y*r.y)*(s.x*s.x+s.y*s.y))>-.866&&n.x*s.x+n.y*s.y<0}function xv(t,e,i){const r=e?2|t:-3&t;return i?1|r:-2&r}function vv(){const t=Math.PI/32,e=Math.tan(t),i=Pa;return i*Math.sqrt(1+2*e*e)-i}function bv(t,e,i){const r=1<<i.z,n=TA(i.x/r),s=TA((i.x+1)/r),a=So(i.y/r),c=So((i.y+1)/r);return function(p,_,v,E,C=0,B){const O=[];if(!p.length||!v||!E)return O;const G=(se,he)=>{for(const ve of se)O.push({polygon:ve,bounds:he})},q=Math.ceil(Math.log2(v)),$=Math.ceil(Math.log2(E)),J=q-$,ie=[];for(let se=0;se<Math.abs(J);se++)ie.push(J>0?0:1);for(let se=0;se<Math.min(q,$);se++)ie.push(0),ie.push(1);let re=p;if(re=ym(re,_[0].y-C,_[1].y+C,1),re=ym(re,_[0].x-C,_[1].x+C,0),!re.length)return O;const te=[];for(ie.length?te.push({polygons:re,bounds:_,depth:0}):G(re,_);te.length;){const se=te.pop(),he=se.depth,ve=ie[he],be=se.bounds[0],Ce=se.bounds[1],Ne=ve===0?be.x:be.y,je=ve===0?Ce.x:Ce.y,Ye=B?B(ve,Ne,je):.5*(Ne+je),Re=ym(se.polygons,Ne-C,Ye+C,ve),rt=ym(se.polygons,Ye-C,je+C,ve);if(Re.length){const lt=[be,new At(ve===0?Ye:Ce.x,ve===1?Ye:Ce.y)];ie.length>he+1?te.push({polygons:Re,bounds:lt,depth:he+1}):G(Re,lt)}if(rt.length){const lt=[new At(ve===0?Ye:be.x,ve===1?Ye:be.y),Ce];ie.length>he+1?te.push({polygons:rt,bounds:lt,depth:he+1}):G(rt,lt)}}return O}(t,e,Math.ceil((s-n)/11.25),Math.ceil((a-c)/11.25),1,(p,_,v)=>{if(p===0)return .5*(_+v);{const E=So((i.y+_/Mt)/r);return(ea(.5*(So((i.y+v/Mt)/r)+E))*r-i.y)*Mt}})}function UE(t,e,i,r,n,s){const a=Math.pow(2,r.z-n.z);for(let c=0;c<i;c++){let p=t.int16[2*(c+e)+0],_=t.int16[2*(c+e)+1];p=(p+n.x*Mt)*a-r.x*Mt,_=(_+n.y*Mt)*a-r.y*Mt,s.push(new At(p,_))}}Ii(H0,"FillExtrusionBucket",{omit:["layers","features"]}),Ii(hv,"PartData"),Ii(uv,"FootprintSegment"),Ii(dv,"BorderCentroidData"),Ii(pv,"GroundEffect");const jE=new ss({visibility:new si(xt["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new si(xt["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var GE={paint:new ss({"fill-extrusion-opacity":new si(xt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new qi(xt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new si(xt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new si(xt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new qi(xt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new qi(xt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new qi(xt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new si(xt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new si(xt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new si(xt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new si(xt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new si(xt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new si(xt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new si(xt["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new si(xt["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new qi(xt["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new qi(xt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new si(xt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new si(xt["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new si(xt["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new si(xt["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new si(xt["paint_fill-extrusion"]["fill-extrusion-emissive-strength"])}),layout:jE};class hf extends At{constructor(e,i,r){super(e,i),this.z=r}}function W0(t,e){return t.x*e.x+t.y*e.y}function wv(t,e){if(t.length===1){let i=0;const r=e[i++];let n;for(;!n||r.equals(n);)if(n=e[i++],!n)return 1/0;for(;i<e.length;i++){const s=e[i],a=t[0],c=n.sub(r),p=s.sub(r),_=a.sub(r),v=W0(c,c),E=W0(c,p),C=W0(p,p),B=W0(_,c),O=W0(_,p),G=v*C-E*E,q=(C*B-E*O)/G,$=(v*O-E*B)/G,J=r.z*(1-q-$)+n.z*q+s.z*$;if(isFinite(J))return J}return 1/0}{let i=1/0;for(const r of e)i=Math.min(i,r.z);return i}}function Tv(t,e,i,r,n,s,a,c){const p=a*n.getElevationAt(t,e,!0,!0),_=s[0]!==0,v=_?s[1]===0?a*(s[0]/7-450):a*function(E,C,B){const O=Math.floor(C[0]/8),G=Math.floor(C[1]/8),q=10*(C[0]-8*O),$=10*(C[1]-8*G),J=E.getElevationAt(O,G,!0,!0),ie=E.getMeterToDEM(B),re=Math.floor(.5*(q*ie-1)),te=Math.floor(.5*($*ie-1)),se=E.tileCoordToPixel(O,G),he=2*re+1,ve=2*te+1,be=function(rt,lt,vt,it,at){return[rt.getElevationAtPixel(lt,vt,!0),rt.getElevationAtPixel(lt+at,vt,!0),rt.getElevationAtPixel(lt,vt+at,!0),rt.getElevationAtPixel(lt+it,vt+at,!0)]}(E,se.x-re,se.y-te,he,ve),Ce=Math.abs(be[0]-be[1]),Ne=Math.abs(be[2]-be[3]),je=Math.abs(be[0]-be[2])+Math.abs(be[1]-be[3]),Ye=Math.min(.25,.5*ie*(Ce+Ne)/he),Re=Math.min(.25,.5*ie*je/ve);return J+Math.max(Ye*q,Re*$)}(n,s,c):p;return{base:p+(i===0)?-1:i,top:_?Math.max(v+r,p+i+2):p+r}}const ZE=new ss({"line-cap":new qi(xt.layout_line["line-cap"]),"line-join":new qi(xt.layout_line["line-join"]),"line-miter-limit":new si(xt.layout_line["line-miter-limit"]),"line-round-limit":new si(xt.layout_line["line-round-limit"]),"line-sort-key":new qi(xt.layout_line["line-sort-key"]),visibility:new si(xt.layout_line.visibility)});var Ev={paint:new ss({"line-opacity":new qi(xt.paint_line["line-opacity"]),"line-color":new qi(xt.paint_line["line-color"]),"line-translate":new si(xt.paint_line["line-translate"]),"line-translate-anchor":new si(xt.paint_line["line-translate-anchor"]),"line-width":new qi(xt.paint_line["line-width"]),"line-gap-width":new qi(xt.paint_line["line-gap-width"]),"line-offset":new qi(xt.paint_line["line-offset"]),"line-blur":new qi(xt.paint_line["line-blur"]),"line-dasharray":new qi(xt.paint_line["line-dasharray"]),"line-pattern":new qi(xt.paint_line["line-pattern"]),"line-gradient":new nu(xt.paint_line["line-gradient"]),"line-trim-offset":new si(xt.paint_line["line-trim-offset"]),"line-emissive-strength":new si(xt.paint_line["line-emissive-strength"]),"line-border-width":new qi(xt.paint_line["line-border-width"]),"line-border-color":new qi(xt.paint_line["line-border-color"])}),layout:ZE};const qE=(t,e,i,r,n,s,a)=>{const c=t.transform,p=c.calculatePixelsToTileUnitsMatrix(e);return{u_matrix:Sv(t,e,i,r),u_pixels_to_tile_units:p,u_device_pixel_ratio:s,u_units_to_pixels:[1/c.pixelsToGLUnits[0],1/c.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:n,u_texsize:Cv(i)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Mv(e,t.transform),u_alpha_discard_threshold:0,u_trim_offset:a,u_emissive_strength:i.paint.get("line-emissive-strength")}},QE=(t,e,i,r,n)=>{const s=t.transform;return{u_matrix:Sv(t,e,i,r),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:s.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:n,u_image:0,u_tile_units_to_pixels:Mv(e,s),u_units_to_pixels:[1/s.pixelsToGLUnits[0],1/s.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Mv(t,e){return 1/Xh(t,1,e.tileZoom)}function Sv(t,e,i,r){return t.translatePosMatrix(r||e.tileID.projMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const Iv=t=>{const e=[];Cv(t)&&e.push("RENDER_LINE_DASH"),t.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const i=t.paint.get("line-trim-offset");return i[0]===0&&i[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),t.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER"),e};function Cv(t){const e=t.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}const kv=new class extends qi{possiblyEvaluate(t,e){return e=new ds(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,i,r){return e=zt({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,i,r)}}(Ev.paint.properties["line-width"].specification);function Dv(t,e){return e>0?e+2*t:t}kv.useIntegerZoom=!0;const HE=new ss({visibility:new si(xt.layout_background.visibility)});var WE={paint:new ss({"background-color":new si(xt.paint_background["background-color"]),"background-pattern":new si(xt.paint_background["background-pattern"]),"background-opacity":new si(xt.paint_background["background-opacity"]),"background-emissive-strength":new si(xt.paint_background["background-emissive-strength"])}),layout:HE};const $E=new ss({visibility:new si(xt.layout_raster.visibility)});var XE={paint:new ss({"raster-opacity":new si(xt.paint_raster["raster-opacity"]),"raster-color":new nu(xt.paint_raster["raster-color"]),"raster-color-mix":new si(xt.paint_raster["raster-color-mix"]),"raster-color-range":new si(xt.paint_raster["raster-color-range"]),"raster-hue-rotate":new si(xt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new si(xt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new si(xt.paint_raster["raster-brightness-max"]),"raster-saturation":new si(xt.paint_raster["raster-saturation"]),"raster-contrast":new si(xt.paint_raster["raster-contrast"]),"raster-resampling":new si(xt.paint_raster["raster-resampling"]),"raster-fade-duration":new si(xt.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new si(xt.paint_raster["raster-emissive-strength"]),"raster-array-band":new si(xt.paint_raster["raster-array-band"]),"raster-elevation":new si(xt.paint_raster["raster-elevation"])}),layout:$E};function Pv(t,e,i,r,n,s,a,c){const p=[t,i,n,e,r,s,1,1,1],_=[a,c,1],v=Ee.adjoint([],p),[E,C,B]=_e.transformMat3(_,_,Ee.transpose(v,v));return Ee.multiply(p,[E,0,0,0,C,0,0,0,B],p)}class xc extends rs{constructor(e,i,r,n){super(),this.id=e,this.dispatcher=r,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(n),this.options=i,this._dirty=!1}load(e,i){if(this._loaded=i||!1,this.fire(new ei("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=Et(this.map._requestManager.transformRequest(this.url,we.Image),(r,n)=>{if(this._imageRequest=null,this._loaded=!0,r)this.fire(new ir(r));else if(n){const{HTMLImageElement:s}=me;this.image=n instanceof s?Xi.getImageData(n):n,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading()}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Nm(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new ei("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Nm||this.texture.destroy()}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let i=e[0][1],r=e[0][1];for(const s of e)s[1]>r&&(r=s[1]),s[1]<i&&(i=s[1]);const n=(r+i)/2;if(n>Ks?this.onNorthPole=!0:n<-Ks&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const s=e.map(Xr.fromLngLat);this.tileID=function(a){let c=1/0,p=1/0,_=-1/0,v=-1/0;for(const O of a)c=Math.min(c,O.x),p=Math.min(p,O.y),_=Math.max(_,O.x),v=Math.max(v,O.y);const E=Math.max(_-c,v-p),C=Math.max(0,Math.floor(-Math.log(E)/Math.LN2)),B=Math.pow(2,C);return new ci(C,Math.floor((c+_)/2*B),Math.floor((p+v)/2*B))}(s),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new ei("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(e){for(const p in this.tiles){const _=this.tiles[p];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture)}if(this._boundsArray)return;const i=$h(this.tileID,this.map.transform.projection),[r,n,s,a]=this.coordinates.map(p=>{const _=i.projection.project(p[0],p[1]);return xx(i,_)._round()});this.perspectiveTransform=function(p,_,v,E,C,B,O,G,q,$){const J=Pv(0,0,p,0,0,_,p,_),ie=Pv(v,E,C,B,O,G,q,$);return Ee.multiply(ie,Ee.adjoint(J,J),ie),[ie[6]/ie[8]*p/Mt,ie[7]/ie[8]*_/Mt]}(this.width,this.height,r.x,r.y,n.x,n.y,a.x,a.y,s.x,s.y);const c=this._boundsArray=new Dc;c.emplaceBack(r.x,r.y,0,0),c.emplaceBack(n.x,n.y,Mt,0),c.emplaceBack(a.x,a.y,0,Mt),c.emplaceBack(s.x,s.y,Mt,Mt),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=e.createVertexBuffer(c,Pg.members),this.boundsSegments=wn.simpleSegment(0,0,4,2)}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const i=this.map.painter.context,r=i.gl;!this._dirty||this.texture instanceof Nm||(this.texture?this.texture.update(this.image):(this.texture=new ks(i,this.image,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(i)}loadTile(e,i){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},i(null)):(e.state="errored",i(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class YE extends jl{constructor(e){super(e,{}),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}const KE=new ss({visibility:new si(xt.layout_sky.visibility)});var JE={paint:new ss({"sky-type":new si(xt.paint_sky["sky-type"]),"sky-atmosphere-sun":new si(xt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new si(xt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new si(xt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new si(xt.paint_sky["sky-gradient-radius"]),"sky-gradient":new nu(xt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new si(xt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new si(xt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new si(xt.paint_sky["sky-opacity"])}),layout:KE};function Zg(t,e,i){const r=[0,0,1],n=ot.identity([]);return ot.rotateY(n,n,i?-Li(t)+Math.PI:Li(t)),ot.rotateX(n,n,-Li(e)),_e.transformQuat(r,r,n),_e.normalize(r,r)}var eM={paint:new ss({})};const tM={circle:class extends jl{constructor(t,e){super(t,V2,e)}createBucket(t){return new sg(t)}queryRadius(t){const e=t;return Yd("circle-radius",this,e)+Yd("circle-stroke-width",this,e)+Am(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,i,r,n,s,a,c){const p=x1(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),s.angle,t.pixelToTileUnitsFactor),_=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return b1(t,r,s,a,c,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",p,_)}getProgramIds(){return["circle"]}getDefaultProgramParams(t,e){const i=v1(this);return{config:new lu(this,e),defines:i,overrideFog:!1}}},heatmap:class extends jl{createBucket(t){return new T1(t)}constructor(t,e){super(t,Q2,e),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=cm({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return Yd("heatmap-radius",this,t)}queryIntersectsFeature(t,e,i,r,n,s,a,c){const p=this.paint.get("heatmap-radius").evaluate(e,i);return b1(t,r,s,a,c,!0,!0,new At(0,0),p)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(t,e){return t==="heatmap"?{config:new lu(this,e),overrideFog:!1}:{}}},hillshade:class extends jl{constructor(t,e){super(t,W2,e)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(t,e){return{overrideFog:!1}}},fill:class extends jl{constructor(t,e){super(t,l3,e)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(t,e){return{config:new lu(this,e),overrideFog:!1}}recalculate(t,e){super.recalculate(t,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new mm(t)}queryRadius(){return Am(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,i,r,n,s){return!t.queryGeometry.isAboveHorizon&&p1(y1(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),s.angle,t.pixelToTileUnitsFactor),r)}isTileClipped(){return!0}},"fill-extrusion":class extends jl{constructor(t,e){super(t,GE,e),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new H0(t)}queryRadius(){return Am(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(t,e,i,r,n,s,a,c,p){const _=x1(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),s.angle,t.pixelToTileUnitsFactor),v=this.paint.get("fill-extrusion-height").evaluate(e,i),E=this.paint.get("fill-extrusion-base").evaluate(e,i),C=[0,0],B=c&&s.elevation,O=s.elevation?s.elevation.exaggeration():1,G=t.tile.getBucket(this);if(B&&G instanceof H0){const re=G.centroidVertexArray,te=p+1;te<re.length&&(C[0]=re.geta_centroid_pos0(te),C[1]=re.geta_centroid_pos1(te))}if(C[0]===0&&C[1]===1)return!1;s.projection.name==="globe"&&(r=bv([r],[new At(0,0),new At(Mt,Mt)],t.tileID.canonical).map(re=>re.polygon).flat());const q=B?c:null,[$,J]=function(re,te,se,he,ve,be,Ce,Ne,je,Ye,Re){return re.projection.name==="globe"?function(rt,lt,vt,it,at,Tt,It,St,Lt,Ot,jt){const Dt=[],Kt=[],mi=rt.projection.upVectorScale(jt,rt.center.lat,rt.worldSize).metersToTile,_i=[0,0,0,1],Ti=[0,0,0,1],Mi=(Ui,on,Zr,hr)=>{Ui[0]=on,Ui[1]=Zr,Ui[2]=hr,Ui[3]=1},ur=vv();vt>0&&(vt+=ur),it+=ur;for(const Ui of lt){const on=[],Zr=[];for(const hr of Ui){const or=hr.x+at.x,$i=hr.y+at.y,Hr=rt.projection.projectTilePoint(or,$i,jt),Jr=rt.projection.upVector(jt,hr.x,hr.y);let Br=vt,Vn=it;if(It){const Js=Tv(or,$i,vt,it,It,St,Lt,Ot);Br+=Js.base,Vn+=Js.top}vt!==0?Mi(_i,Hr.x+Jr[0]*mi*Br,Hr.y+Jr[1]*mi*Br,Hr.z+Jr[2]*mi*Br):Mi(_i,Hr.x,Hr.y,Hr.z),Mi(Ti,Hr.x+Jr[0]*mi*Vn,Hr.y+Jr[1]*mi*Vn,Hr.z+Jr[2]*mi*Vn),_e.transformMat4(_i,_i,Tt),_e.transformMat4(Ti,Ti,Tt),on.push(new hf(_i[0],_i[1],_i[2])),Zr.push(new hf(Ti[0],Ti[1],Ti[2]))}Dt.push(on),Kt.push(Zr)}return[Dt,Kt]}(re,te,se,he,ve,be,Ce,Ne,je,Ye,Re):Ce?function(rt,lt,vt,it,at,Tt,It,St,Lt){const Ot=[],jt=[],Dt=[0,0,0,1];for(const Kt of rt){const mi=[],_i=[];for(const Ti of Kt){const Mi=Ti.x+it.x,ur=Ti.y+it.y,Ui=Tv(Mi,ur,lt,vt,Tt,It,St,Lt);Dt[0]=Mi,Dt[1]=ur,Dt[2]=Ui.base,Dt[3]=1,U.transformMat4(Dt,Dt,at),Dt[3]=Math.max(Dt[3],1e-5);const on=new hf(Dt[0]/Dt[3],Dt[1]/Dt[3],Dt[2]/Dt[3]);Dt[0]=Mi,Dt[1]=ur,Dt[2]=Ui.top,Dt[3]=1,U.transformMat4(Dt,Dt,at),Dt[3]=Math.max(Dt[3],1e-5);const Zr=new hf(Dt[0]/Dt[3],Dt[1]/Dt[3],Dt[2]/Dt[3]);mi.push(on),_i.push(Zr)}Ot.push(mi),jt.push(_i)}return[Ot,jt]}(te,se,he,ve,be,Ce,Ne,je,Ye):function(rt,lt,vt,it,at){const Tt=[],It=[],St=at[8]*lt,Lt=at[9]*lt,Ot=at[10]*lt,jt=at[11]*lt,Dt=at[8]*vt,Kt=at[9]*vt,mi=at[10]*vt,_i=at[11]*vt;for(const Ti of rt){const Mi=[],ur=[];for(const Ui of Ti){const on=Ui.x+it.x,Zr=Ui.y+it.y,hr=at[0]*on+at[4]*Zr+at[12],or=at[1]*on+at[5]*Zr+at[13],$i=at[2]*on+at[6]*Zr+at[14],Hr=at[3]*on+at[7]*Zr+at[15],Jr=hr+St,Br=or+Lt,Vn=$i+Ot,Js=Math.max(Hr+jt,1e-5),Bn=hr+Dt,us=or+Kt,Ao=$i+mi,eo=Math.max(Hr+_i,1e-5);Mi.push(new hf(Jr/Js,Br/Js,Vn/Js)),ur.push(new hf(Bn/eo,us/eo,Ao/eo))}Tt.push(Mi),It.push(ur)}return[Tt,It]}(te,se,he,ve,be)}(s,r,E,v,_,a,q,C,O,s.center.lat,t.tileID.canonical),ie=t.queryGeometry;return function(re,te,se){let he=1/0;p1(se,te)&&(he=wv(se,te[0]));for(let ve=0;ve<te.length;ve++){const be=te[ve],Ce=re[ve];for(let Ne=0;Ne<be.length-1;Ne++){const je=be[Ne],Ye=[je,be[Ne+1],Ce[Ne+1],Ce[Ne],je];f1(se,Ye)&&(he=Math.min(he,wv(se,Ye)))}}return he!==1/0&&he}($,J,ie.isPointQuery()?ie.screenBounds:ie.screenGeometry)}},line:class extends jl{constructor(t,e){super(t,Ev,e),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof UA,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=kv.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Vm(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(t,e){const i=Iv(this);return{config:new lu(this,e),defines:i,overrideFog:!1}}queryRadius(t){const e=t,i=Dv(Yd("line-width",this,e),Yd("line-gap-width",this,e)),r=Yd("line-offset",this,e);return i/2+Math.abs(r)+Am(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,i,r,n,s){if(t.queryGeometry.isAboveHorizon)return!1;const a=y1(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),s.angle,t.pixelToTileUnitsFactor),c=t.pixelToTileUnitsFactor/2*Dv(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),p=this.paint.get("line-offset").evaluate(e,i);return p&&(r=function(_,v){const E=[],C=new At(0,0);for(let B=0;B<_.length;B++){const O=_[B],G=[];for(let q=0;q<O.length;q++){const $=O[q],J=O[q+1],ie=q===0?C:$.sub(O[q-1])._unit()._perp(),re=q===O.length-1?C:J.sub($)._unit()._perp(),te=ie._add(re)._unit();te._mult(1/(te.x*re.x+te.y*re.y)),G.push(te._mult(v)._add($))}E.push(G)}return E}(r,p*t.pixelToTileUnitsFactor)),function(_,v,E){for(let C=0;C<v.length;C++){const B=v[C];if(_.length>=3){for(let O=0;O<B.length;O++)if(ah(_,B[O]))return!0}if(L2(_,B,E))return!0}return!1}(a,r,c)}isTileClipped(){return!0}},symbol:zm,background:class extends jl{constructor(t,e){super(t,WE,e)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(t,e){return{overrideFog:!1}}},raster:class extends jl{constructor(t,e){super(t,XE,e),this._updateColorRamp()}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}isLayerDraped(t){return!(t&&t._source instanceof xc)||!t._source.onNorthPole&&!t._source.onSouthPole&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(t){t!=="raster-color"&&t!=="raster-color-range"||this._updateColorRamp()}_updateColorRamp(){if(!this.hasColorMap())return;const t=this._transitionablePaint._values["raster-color"].value.expression,[e,i]=this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0});this.colorRamp=cm({expression:t,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:e,end:i}],resolution:256}),this.colorRampTexture=null}},sky:class extends jl{constructor(t,e){super(t,JE,e),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="sky-gradient"?this._updateColorRamp():t!=="sky-atmosphere-sun"&&t!=="sky-atmosphere-halo-color"&&t!=="sky-atmosphere-color"&&t!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=cm({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if(this.paint.get("sky-type")==="atmosphere"){const r=this.paint.get("sky-atmosphere-sun"),n=!r,s=t.style.light,a=s.properties.get("position");return n&&s.properties.get("anchor")==="viewport"&&Pe("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),n?Zg(a.azimuthal,90-a.polar,e):Zg(r[0],90-r[1],e)}const i=this.paint.get("sky-gradient-center");return Zg(i[0],90-i[1],e)}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return t==="atmosphere"?["skyboxCapture","skybox"]:t==="gradient"?["skyboxGradient"]:null}},slot:class extends jl{constructor(t,e){super(t,eM)}},model:class extends jl{constructor(t,e){super(t,IE,e)}createBucket(t){return new ev(t)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(){return 0}queryIntersectsFeature(){return!1}_handleOverridablePaintPropertyUpdate(t,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven()||t!=="model-color"&&t!=="model-color-mix-intensity"&&t!=="model-rotation"&&t!=="model-scale"&&t!=="model-translation"&&t!=="model-emissive-strength")}_isPropertyZoomDependent(t){const e=this._transitionablePaint._values[t];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof kn}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}}};function Ym(t,e){return t.type==="custom"?new YE(t):new tM[t.type](t,e)}function iM(t){const{userImage:e}=t;return!!(e&&e.render&&e.render())&&(t.data.replace(new Uint8Array(e.data.buffer)),!0)}class rM extends rs{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(e){this.images[e]={},this.loaded[e]=!1,this.updatedImages[e]={},this.patterns[e]={},this.callbackDispatchedThisFrame[e]={},this.atlasImage[e]=new bo({width:1,height:1})}isLoaded(){for(const e in this.loaded)if(!this.loaded[e])return!1;return!0}setLoaded(e,i){if(this.loaded[i]!==e&&(this.loaded[i]=e,e)){for(const{ids:r,callback:n}of this.requestors)this._notify(r,i,n);this.requestors=[]}}hasImage(e,i){return!!this.getImage(e,i)}getImage(e,i){return this.images[i][e]}addImage(e,i,r){this._validate(e,r)&&(this.images[i][e]=r)}_validate(e,i){let r=!0;return this._validateStretch(i.stretchX,i.data&&i.data.width)||(this.fire(new ir(new Error(`Image "${e}" has invalid "stretchX" value`))),r=!1),this._validateStretch(i.stretchY,i.data&&i.data.height)||(this.fire(new ir(new Error(`Image "${e}" has invalid "stretchY" value`))),r=!1),this._validateContent(i.content,i)||(this.fire(new ir(new Error(`Image "${e}" has invalid "content" value`))),r=!1),r}_validateStretch(e,i){if(!e)return!0;let r=0;for(const n of e){if(n[0]<r||n[1]<n[0]||i<n[1])return!1;r=n[1]}return!0}_validateContent(e,i){return!(e&&(e.length!==4||e[0]<0||i.data.width<e[0]||e[1]<0||i.data.height<e[1]||e[2]<0||i.data.width<e[2]||e[3]<0||i.data.height<e[3]||e[2]<e[0]||e[3]<e[1]))}updateImage(e,i,r){r.version=this.images[i][e].version+1,this.images[i][e]=r,this.updatedImages[i][e]=!0}removeImage(e,i){const r=this.images[i][e];delete this.images[i][e],delete this.patterns[i][e],r.userImage&&r.userImage.onRemove&&r.userImage.onRemove()}listImages(e){return Object.keys(this.images[e])}getImages(e,i,r){let n=!0;const s=!!this.loaded[i];if(!s)for(const a of e)this.images[i][a]||(n=!1);s||n?this._notify(e,i,r):this.requestors.push({ids:e,scope:i,callback:r})}getUpdatedImages(e){return this.updatedImages[e]}_notify(e,i,r){const n={};for(const s of e){this.images[i][s]||this.fire(new ei("styleimagemissing",{id:s}));const a=this.images[i][s];a?n[s]={data:a.data.clone(),pixelRatio:a.pixelRatio,sdf:a.sdf,version:a.version,stretchX:a.stretchX,stretchY:a.stretchY,content:a.content,hasRenderCallback:!!(a.userImage&&a.userImage.render)}:Pe(`Image "${s}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}r(null,n)}getPixelSize(e){const{width:i,height:r}=this.atlasImage[e];return{width:i,height:r}}getPattern(e,i){const r=this.patterns[i][e],n=this.getImage(e,i);if(!n)return null;if(r&&r.position.version===n.version)return r.position;if(r)r.position.version=n.version;else{const s={w:n.data.width+2,h:n.data.height+2,x:0,y:0},a=new Tg(s,n);this.patterns[i][e]={bin:s,position:a}}return this._updatePatternAtlas(i),this.patterns[i][e].position}bind(e,i){const r=e.gl;let n=this.atlasTexture[i];n?this.dirty&&(n.update(this.atlasImage[i]),this.dirty=!1):(n=new ks(e,this.atlasImage[i],r.RGBA),this.atlasTexture[i]=n),n.bind(r.LINEAR,r.CLAMP_TO_EDGE)}_updatePatternAtlas(e){const i=[];for(const a in this.patterns[e])i.push(this.patterns[e][a].bin);const{w:r,h:n}=wg(i),s=this.atlasImage[e];s.resize({width:r||1,height:n||1});for(const a in this.patterns[e]){const{bin:c}=this.patterns[e][a],p=c.x+1,_=c.y+1,v=this.images[e][a].data,E=v.width,C=v.height;bo.copy(v,s,{x:0,y:0},{x:p,y:_},{width:E,height:C}),bo.copy(v,s,{x:0,y:C-1},{x:p,y:_-1},{width:E,height:1}),bo.copy(v,s,{x:0,y:0},{x:p,y:_+C},{width:E,height:1}),bo.copy(v,s,{x:E-1,y:0},{x:p-1,y:_},{width:1,height:C}),bo.copy(v,s,{x:0,y:0},{x:p+E,y:_},{width:1,height:C})}this.dirty=!0}beginFrame(){for(const e in this.images)this.callbackDispatchedThisFrame[e]={}}dispatchRenderCallbacks(e,i){for(const r of e){if(this.callbackDispatchedThisFrame[i][r])continue;this.callbackDispatchedThisFrame[i][r]=!0;const n=this.images[i][r];iM(n)&&this.updateImage(r,i,n)}}}const nM=new ss({anchor:new si(xt.light.anchor),position:new class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return ni(t.expression.evaluate(e))}interpolate(t,e,i){return{x:Ji(t.x,e.x,i),y:Ji(t.y,e.y,i),z:Ji(t.z,e.z,i),azimuthal:Ji(t.azimuthal,e.azimuthal,i),polar:Ji(t.polar,e.polar,i)}}}(xt.light.position),color:new si(xt.light.color),intensity:new si(xt.light.intensity)});class zv extends rs{constructor(e,i="flat"){super(),this._transitionable=new Su(nM),this.setLight(e,i),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,i,r={}){this._validate(fp,e,r)||(this._transitionable.setTransitionOrValue(e),this.id=i)}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,i,r){return(!r||r.validate!==!1)&&Ic(this,e.call(tu,zt({value:i,style:{glyphs:!0,sprite:!0},styleSpec:xt})))}}const sM=new ss({source:new si(xt.terrain.source),exaggeration:new si(xt.terrain.exaggeration)});let oM=class extends rs{constructor(t,e,i,r){super(),this.scope=i,this._transitionable=new Su(sM,r),this._transitionable.setTransitionOrValue(t,r),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=e}get(){return this._transitionable.serialize()}set(t,e){this._transitionable.setTransitionOrValue(t,e)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}getExaggeration(t){return this._transitioning.possiblyEvaluate(new ds(t)).get("exaggeration")}isZoomDependent(){const t=this._transitionable._values.exaggeration;return t!=null&&t.value!=null&&t.value.expression!=null&&t.value.expression instanceof kn}};const Bv=45,Lv=65,Jh=.05;function Km(t,e,i,r){const n=Yr(Bv,Lv,i),[s,a]=Rv(t,r);let c=1-Math.min(1,Math.exp((e-s)/(a-s)*-6));return c*=c*c,c=Math.min(1,1.00747*c),c*n*t.alpha}function Rv(t,e){const i=.5/Math.tan(.5*e);return[t.range[0]+i,t.range[1]+i]}function Fv(t,e,i,r,n){const s=_e.transformMat4([],[e,i,r],n.mercatorFogMatrix);return Km(t,_e.length(s),n.pitch,n._fov)}function Ov(t,e,i,r,n,s,a){const c=[[i,r,0],[n,r,0],[n,s,0],[i,s,0]];let p=Number.MAX_VALUE,_=-Number.MAX_VALUE;for(const v of c){const E=_e.transformMat4([],v,e),C=_e.length(E);p=Math.min(p,C),_=Math.max(_,C)}return[Km(t,p,a.pitch,a._fov),Km(t,_,a.pitch,a._fov)]}const aM=new ss({range:new si(xt.fog.range),color:new si(xt.fog.color),"high-color":new si(xt.fog["high-color"]),"space-color":new si(xt.fog["space-color"]),"horizon-blend":new si(xt.fog["horizon-blend"]),"star-intensity":new si(xt.fog["star-intensity"]),"vertical-range":new si(xt.fog["vertical-range"])});class lM extends rs{constructor(e,i){super(),this._transitionable=new Su(aM),this.set(e),this._transitioning=this._transitionable.untransitioned(),this._transform=i}get state(){const e=this._transform,i=e.projection.name==="globe",r=Uo(e.zoom),n=this.properties.get("range"),s=[.5,3];return{range:i?[Ji(s[0],n[0],r),Ji(s[1],n[1],r)]:n,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(e,i={}){if(this._validate(Mh,e,i))return;const r=zt({},e);for(const n of Object.keys(xt.fog))r[n]===void 0&&(r[n]=xt.fog[n].default);this._transitionable.setTransitionOrValue(r)}getOpacity(e){if(!this._transform.projection.supportsFog)return 0;const i=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:Yr(Bv,Lv,e))*i.a}getOpacityAtLatLng(e,i){return this._transform.projection.supportsFog?function(r,n,s){const a=Xr.fromLngLat(n),c=s.elevation?s.elevation.getAtPointOrZero(a):0;return Fv(r,a.x,a.y,c,s)}(this.state,e,i):0}getOpacityForTile(e){if(!this._transform.projection.supportsFog)return[1,1];const i=this._transform.calculateFogTileMatrix(e.toUnwrapped());return Ov(this.state,i,0,0,Mt,Mt,this._transform)}getOpacityForBounds(e,i,r,n,s){return this._transform.projection.supportsFog?Ov(this.state,e,i,r,n,s,this._transform):[1,1]}getFovAdjustedRange(e){return this._transform.projection.supportsFog?Rv(this.state,e):[0,1]}isVisibleOnFrustum(e){if(!this._transform.projection.supportsFog)return!1;const i=[4,5,6,7];for(const r of i){const n=e.points[r];let s;if(n[2]>=0)s=n;else{const a=e.points[r-4];s=To(a,n,a[2]/(a[2]-n[2]))}if(Fv(this.state,s[0],s[1],0,this._transform)>=Jh)return!0}return!1}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,i,r){return(!r||r.validate!==!1)&&Ic(this,e.call(tu,zt({value:i,style:{glyphs:!0,sprite:!0},styleSpec:xt})))}}class AM{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class cM{constructor(){this.tasks={},this.taskQueue=[],Un(["process"],this),this.invoker=new AM(this.process),this.nextId=0}add(e,i){const r=this.nextId++,n=function({type:s,isSymbolTile:a,zoom:c}){return c=c||0,s==="message"?0:s!=="maybePrepare"||a?s!=="parseTile"||a?s==="parseTile"&&a?300-c:s==="maybePrepare"&&a?400-c:500:200-c:100-c}(i);if(n===0){Qt();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[r]={fn:e,metadata:i,priority:n,id:r},this.taskQueue.push(r),this.invoker.trigger(),{cancel:()=>{delete this.tasks[r]}}}process(){Qt();try{if(this.taskQueue=this.taskQueue.filter(r=>!!this.tasks[r]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let n=0;n<this.taskQueue.length;n++){const s=this.tasks[this.taskQueue[n]];s.priority<i&&(i=s.priority,e=n)}if(e===null)return null;const r=this.taskQueue[e];return this.taskQueue.splice(e,1),r}remove(){this.invoker.remove()}}class Vv{constructor(e,i,r){this.target=e,this.parent=i,this.mapId=r,this.callbacks={},this.cancelCallbacks={},Un(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new cM}send(e,i,r,n,s=!1,a){const c=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(r.metadata=a,this.callbacks[c]=r);const p=new Set;return this.target.postMessage({id:c,type:e,hasCallback:!!r,targetMapId:n,mustQueue:s,sourceMapId:this.mapId,data:Eu(i,p)},p),{cancel:()=>{r&&delete this.callbacks[c],this.target.postMessage({id:c,type:"<cancel>",targetMapId:n,sourceMapId:this.mapId})}}}receive(e){const i=e.data,r=i.id;if(r&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){const n=this.cancelCallbacks[r];delete this.cancelCallbacks[r],n&&n.cancel()}else if(i.mustQueue||Qt()){const n=this.callbacks[r];this.cancelCallbacks[r]=this.scheduler.add(()=>this.processTask(r,i),n&&n.metadata||{type:"message"})}else this.processTask(r,i)}processTask(e,i){if(i.type==="<response>"){const r=this.callbacks[e];delete this.callbacks[e],r&&(i.error?r(Qu(i.error)):r(null,Qu(i.data)))}else{const r=new Set,n=i.hasCallback?(a,c)=>{delete this.cancelCallbacks[e],this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:a?Eu(a):null,data:Eu(c,r)},r)}:a=>{},s=Qu(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,s,n);else if(this.parent.getWorkerSource){const a=i.type.split(".");this.parent.getWorkerSource(i.sourceMapId,a[0],s.source,s.scope)[a[1]](s,n)}else n(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}class ed{constructor(e,i){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=Es();const r=this.workerPool.acquire(this.id);for(let n=0;n<r.length;n++){const s=new ed.Actor(r[n],i,this.id);s.name=`Worker ${n}`,this.actors.push(s)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,i,r){Co(this.actors,(n,s)=>{n.send(e,i,s)},r=r||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}ed.Actor=Vv;class Nv extends rs{constructor(e,i,r,n){super(),this.scope=r,this._options=e,this.properties=new ru(i),this._transitionable=new Su(i,new Map(n)),this._transitionable.setTransitionOrValue(e.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(e){this._transitionable.setTransitionOrValue(this._options.properties,new Map(e))}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(e,i){this._options=e,this._transitionable.setTransitionOrValue(e.properties,i)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}const uM=new ss({color:new si(xt.properties_light_ambient.color),intensity:new si(xt.properties_light_ambient.intensity)}),hM=new ss({direction:new class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return function([i,r]){const n=ni([1,i,r]);return{x:n.x,y:n.y,z:n.z}}(t.expression.evaluate(e))}interpolate(t,e,i){return{x:Ji(t.x,e.x,i),y:Ji(t.y,e.y,i),z:Ji(t.z,e.z,i)}}}(xt.properties_light_directional.direction),color:new si(xt.properties_light_directional.color),intensity:new si(xt.properties_light_directional.intensity),"cast-shadows":new si(xt.properties_light_directional["cast-shadows"]),"shadow-intensity":new si(xt.properties_light_directional["shadow-intensity"])});class qg{constructor(e,i,r,n){this.screenBounds=e,this.cameraPoint=i,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=r,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,n)}static createFromScreenPoints(e,i){let r,n;if(e instanceof At||typeof e[0]=="number"){const s=At.convert(e);r=[s],n=i.isPointAboveHorizon(s)}else{const s=At.convert(e[0]),a=At.convert(e[1]);r=[s,a],n=Io(s,a).every(c=>i.isPointAboveHorizon(c))}return new qg(r,i.getCameraPoint(),n,i)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(e){return Io(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],e)}bufferedCameraGeometry(e){const i=this.screenBounds[0],r=this.screenBounds.length===1?this.screenBounds[0].add(new At(1,1)):this.screenBounds[1],n=Io(i,r,0,!1);return this.cameraPoint.y>r.y&&(this.cameraPoint.x>i.x&&this.cameraPoint.x<r.x?n.splice(3,0,this.cameraPoint):this.cameraPoint.x>=r.x?n[2]=this.cameraPoint:this.cameraPoint.x<=i.x&&(n[3]=this.cameraPoint)),function(s,a){const c=[];for(let p=0;p<s.length;p++){const _=Hn(p-1,-1,s.length-1),v=Hn(p+1,-1,s.length-1),E=s[p],C=s[v],B=s[_].sub(E).unit(),O=C.sub(E).unit(),G=O.angleWithSep(B.x,B.y),q=B.add(O).unit().mult(-1*a/Math.sin(G/2));c.push(E.add(q))}return c}(n,e)}bufferedCameraGeometryGlobe(e){const i=this.screenBounds[0],r=this.screenBounds.length===1?this.screenBounds[0].add(new At(1,1)):this.screenBounds[1],n=Io(i,r,e),s=this.cameraPoint.clone();switch(3*((s.y>i.y)+(s.y>r.y))+((s.x>i.x)+(s.x>r.x))){case 0:n[0]=s,n[4]=s.clone();break;case 1:n.splice(1,0,s);break;case 2:n[1]=s;break;case 3:n.splice(4,0,s);break;case 5:n.splice(2,0,s);break;case 6:n[3]=s;break;case 7:n.splice(3,0,s);break;case 8:n[2]=s}return n}containsTile(e,i,r,n=0){const s=e.queryPadding/i._pixelsPerMercatorPixel+1,a=r?this._bufferedCameraMercator(s,i):this._bufferedScreenMercator(s,i);let c=e.tileID.wrap+(a.unwrapped?n:0);const p=a.polygon.map(q=>xx(e.tileTransform,q,c));if(!g1(p,0,0,Mt,Mt))return;c=e.tileID.wrap+(this.screenGeometryMercator.unwrapped?n:0);const _=this.screenGeometryMercator.polygon.map(q=>vx(e.tileTransform,q,c)),v=_.map(q=>new At(q[0],q[1])),E=i.getFreeCameraOptions().position||new Xr(0,0,0),C=vx(e.tileTransform,E,c),B=_.map(q=>{const $=_e.sub(q,q,C);return _e.normalize($,$),new ps(C,$)}),O=Xh(e,1,i.zoom)*i._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:v,tilespaceRays:B,bufferedTilespaceGeometry:p,bufferedTilespaceBounds:(G=wo(p),G.min.x=hi(G.min.x,0,Mt),G.min.y=hi(G.min.y,0,Mt),G.max.x=hi(G.max.x,0,Mt),G.max.y=hi(G.max.y,0,Mt),G),tile:e,tileID:e.tileID,pixelToTileUnitsFactor:O};var G}_bufferedScreenMercator(e,i){const r=Uv(e);if(this._screenRaycastCache[r])return this._screenRaycastCache[r];{let n;return n=i.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(e),i):{polygon:this.bufferedScreenGeometry(e).map(s=>i.pointCoordinate3D(s)),unwrapped:!0},this._screenRaycastCache[r]=n,n}}_bufferedCameraMercator(e,i){const r=Uv(e);if(this._cameraRaycastCache[r])return this._cameraRaycastCache[r];{let n;return n=i.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(e),i):{polygon:this.bufferedCameraGeometry(e).map(s=>i.pointCoordinate3D(s)),unwrapped:!0},this._cameraRaycastCache[r]=n,n}}_projectAndResample(e,i){const r=function(s,a){const c=ce.multiply([],a.pixelMatrix,a.globeMatrix),p=[0,-Fn,0,1],_=[0,Fn,0,1],v=[0,0,0,1];U.transformMat4(p,p,c),U.transformMat4(_,_,c),U.transformMat4(v,v,c);const E=new At(p[0]/p[3],p[1]/p[3]),C=new At(_[0]/_[3],_[1]/_[3]),B=ah(s,E)&&p[3]<v[3],O=ah(s,C)&&_[3]<v[3];if(!B&&!O)return null;const G=function(he,ve,be){for(let Ce=1;Ce<he.length;Ce++){const Ne=$0(ve.pointCoordinate3D(he[Ce-1]).x),je=$0(ve.pointCoordinate3D(he[Ce]).x);if(be<0){if(Ne<je)return{idx:Ce,t:-Ne/(je-1-Ne)}}else if(je<Ne)return{idx:Ce,t:(1-Ne)/(je+1-Ne)}}return null}(s,a,B?-1:1);if(!G)return null;const{idx:q,t:$}=G;let J=q>1?Qg(s.slice(0,q),a):[],ie=q<s.length?Qg(s.slice(q),a):[];J=J.map(he=>new At($0(he.x),he.y)),ie=ie.map(he=>new At($0(he.x),he.y));const re=[...J];re.length===0&&re.push(ie[ie.length-1]);const te=Ji(re[re.length-1].y,(ie.length===0?J[0]:ie[0]).y,$);let se;return se=B?[new At(0,te),new At(0,0),new At(1,0),new At(1,te)]:[new At(1,te),new At(1,1),new At(0,1),new At(0,te)],re.push(...se),ie.length===0?re.push(J[0]):re.push(...ie),{polygon:re.map(he=>new Xr(he.x,he.y)),unwrapped:!1}}(e,i);if(r)return r;const n=function(s,a){let c=!1,p=-1/0,_=0;for(let E=0;E<s.length-1;E++)s[E].x>p&&(p=s[E].x,_=E);for(let E=0;E<s.length-1;E++){const C=(_+E)%(s.length-1),B=s[C],O=s[C+1];Math.abs(B.x-O.x)>.5&&(B.x<O.x?(B.x+=1,C===0&&(s[s.length-1].x+=1)):(O.x+=1,C+1===s.length-1&&(s[0].x+=1)),c=!0)}const v=jo(a.center.lng);return c&&v<Math.abs(v-1)&&s.forEach(E=>{E.x-=1}),{polygon:s,unwrapped:c}}(Qg(e,i).map(s=>new At($0(s.x),s.y)),i);return{polygon:n.polygon.map(s=>new Xr(s.x,s.y)),unwrapped:n.unwrapped}}}function Qg(t,e){return h1(t,i=>{const r=e.pointCoordinate3D(i);i.x=r.x,i.y=r.y},1/256)}function $0(t){return t<0?1+t%1:t%1}function Uv(t){return 100*t|0}function Hg(t,e,i,r,n){const s=function(a,c){if(a)return n(a);if(c){t.url&&c.tiles&&t.tiles&&delete t.tiles;const p=dr(zt(c,t),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);c.vector_layers&&(p.vectorLayers=c.vector_layers,p.vectorLayerIds=p.vectorLayers.map(_=>_.id)),p.tiles=e.canonicalizeTileset(p,t.url),n(null,p)}};return t.url?Be(e.transformRequest(e.normalizeSourceURL(t.url,null,i,r),we.Source),s):Xi.frame(()=>s(null,t))}class Jm{constructor(e,i,r){this.bounds=Ml.convert(this.validateBounds(e)),this.minzoom=i||0,this.maxzoom=r||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const i=Math.pow(2,e.z),r=Math.floor(jo(this.bounds.getWest())*i),n=Math.floor(ea(this.bounds.getNorth())*i),s=Math.ceil(jo(this.bounds.getEast())*i),a=Math.ceil(ea(this.bounds.getSouth())*i);return e.x>=r&&e.x<s&&e.y>=n&&e.y<a}}class jv{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new zu({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const r=this.getKey(e,i);return this.positions[r]}trim(){const e=this.width,i=this.height=La(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,r){const n=[];let s=e.length%2==1?-e[e.length-1]*r:0,a=e[0]*r,c=!0;n.push({left:s,right:a,isDash:c,zeroLength:e[0]===0});let p=e[0];for(let _=1;_<e.length;_++){c=!c;const v=e[_];s=p*r,p+=v,a=p*r,n.push({left:s,right:a,isDash:c,zeroLength:v===0})}return n}addRoundDash(e,i,r){const n=i/2;for(let s=-r;s<=r;s++){const a=this.width*(this.nextRow+r+s);let c=0,p=e[c];for(let _=0;_<this.width;_++){_/p.right>1&&(p=e[++c]);const v=Math.abs(_-p.left),E=Math.abs(_-p.right),C=Math.min(v,E);let B;const O=s/r*(n+1);if(p.isDash){const G=n-Math.abs(O);B=Math.sqrt(C*C+G*G)}else B=n-Math.sqrt(C*C+O*O);this.image.data[a+_]=Math.max(0,Math.min(255,B+128))}}}addRegularDash(e,i){for(let p=e.length-1;p>=0;--p){const _=e[p],v=e[p+1];_.zeroLength?e.splice(p,1):v&&v.isDash===_.isDash&&(v.left=_.left,e.splice(p,1))}const r=e[0],n=e[e.length-1];r.isDash===n.isDash&&(r.left=n.left-this.width,n.right=r.right+this.width);const s=this.width*this.nextRow;let a=0,c=e[a];for(let p=0;p<this.width;p++){p/c.right>1&&(c=e[++a]);const _=Math.abs(p-c.left),v=Math.abs(p-c.right),E=Math.min(_,v);this.image.data[s+p]=Math.max(0,Math.min(255,(c.isDash?E:-E)+i+128))}}addDash(e,i){const r=this.getKey(e,i);if(this.positions[r])return this.positions[r];const n=i==="round",s=n?7:0,a=2*s+1;if(this.nextRow+a>this.height)return Pe("LineAtlas out of space"),null;e.length===0&&e.push(1);let c=0;for(let v=0;v<e.length;v++)e[v]<0&&(Pe("Negative value is found in line dasharray, replacing values with 0"),e[v]=0),c+=e[v];if(c!==0){const v=this.width/c,E=this.getDashRanges(e,this.width,v);n?this.addRoundDash(E,v,s):this.addRegularDash(E,i==="square"?.5*v:0)}const p=this.nextRow+s;this.nextRow+=a;const _={tl:[p,s],br:[c,0]};return this.positions[r]=_,_}}Ii(jv,"LineAtlas");const Gv=1*Qc;class Zv{constructor(e){const i={},r=[];for(const c in e){const p=e[c],_=i[c]={};for(const v in p.glyphs){const E=p.glyphs[+v];if(!E||E.bitmap.width===0||E.bitmap.height===0)continue;const C=E.metrics.localGlyph?Gv:1,B={x:0,y:0,w:E.bitmap.width+2*C,h:E.bitmap.height+2*C};r.push(B),_[v]=B}}const{w:n,h:s}=wg(r),a=new zu({width:n||1,height:s||1});for(const c in e){const p=e[c];for(const _ in p.glyphs){const v=p.glyphs[+_];if(!v||v.bitmap.width===0||v.bitmap.height===0)continue;const E=i[c][_],C=v.metrics.localGlyph?Gv:1;zu.copy(v.bitmap,a,{x:0,y:0},{x:E.x+C,y:E.y+C},v.bitmap)}}this.image=a,this.positions=i}}Ii(Zv,"GlyphAtlas");class dM{constructor(e){this.tileID=new fi(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.scope=e.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.promoteId=e.promoteId,this.isSymbolTile=e.isSymbolTile,this.tileTransform=$h(e.tileID.canonical,e.projection),this.projection=e.projection,this.brightness=e.brightness,this.extraShadowCaster=!!e.extraShadowCaster}parse(e,i,r,n,s){this.status="parsing",this.data=e,this.collisionBoxArray=new ku;const a=new L1(Object.keys(e.layers).sort()),c=new yg(this.tileID,this.promoteId);c.bucketLayerIDs=[];const p={},_=new jv(256,256),v={featureIndex:c,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:_,availableImages:r,brightness:this.brightness},E=i.familiesBySource[this.source];for(const J in E){const ie=e.layers[J];if(!ie)continue;let re=!1,te=!1,se=!1;for(const be of E[J])be[0].type==="symbol"?re=!0:te=!0,be[0].is3D()&&be[0].type!=="model"&&(se=!0);if(this.extraShadowCaster&&!se||this.isSymbolTile===!0&&!re||this.isSymbolTile===!1&&!te)continue;ie.version===1&&Pe(`Vector tile source "${this.source}" layer "${J}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const he=a.encode(J),ve=[];for(let be=0;be<ie.length;be++){const Ce=ie.feature(be),Ne=c.getId(Ce,J);ve.push({feature:Ce,id:Ne,index:be,sourceLayerIndex:he})}for(const be of E[J]){const Ce=be[0];(!this.extraShadowCaster||Ce.is3D()&&Ce.type!=="model")&&(this.isSymbolTile!==void 0&&Ce.type==="symbol"!==this.isSymbolTile||Ce.minzoom&&this.zoom<Math.floor(Ce.minzoom)||Ce.maxzoom&&this.zoom>=Ce.maxzoom||Ce.visibility!=="none"&&(Wg(be,this.zoom,v.brightness,r),(p[Ce.id]=Ce.createBucket({index:c.bucketLayerIDs.length,layers:be,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:he,sourceID:this.source,projection:this.projection.spec})).populate(ve,v,this.tileID.canonical,this.tileTransform),c.bucketLayerIDs.push(be.map(Ne=>Ne.id))))}}let C,B,O,G;_.trim();const q={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},$=()=>{if(C)return this.status="done",s(C);if(this.extraShadowCaster)this.status="done",s(null,{buckets:to(p).filter(J=>!J.isEmpty()),featureIndex:c,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:v.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(B&&O&&G){const J=new Zv(B),ie=new ux(O,G);for(const re in p){const te=p[re];te instanceof V0?(Wg(te.layers,this.zoom,v.brightness,r),AT(te,B,J.positions,O,ie.iconPositions,this.showCollisionBoxes,r,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):te.hasPattern&&(te instanceof Vm||te instanceof mm||te instanceof H0)&&(Wg(te.layers,this.zoom,v.brightness,r),te.addFeatures(v,this.tileID.canonical,ie.patternPositions,r,this.tileTransform,this.brightness))}this.status="done",s(null,{buckets:to(p).filter(re=>!re.isEmpty()),featureIndex:c,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:J.image,lineAtlas:_,imageAtlas:ie,brightness:v.brightness})}};if(!this.extraShadowCaster){const J=pa(v.glyphDependencies,te=>Object.keys(te).map(Number));Object.keys(J).length?n.send("getGlyphs",{uid:this.uid,stacks:J,scope:this.scope},(te,se)=>{C||(C=te,B=se,$())},void 0,!1,q):B={};const ie=Object.keys(v.iconDependencies);ie.length?n.send("getImages",{icons:ie,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(te,se)=>{C||(C=te,O=se,$())},void 0,!1,q):O={};const re=Object.keys(v.patternDependencies);re.length?n.send("getImages",{icons:re,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(te,se)=>{C||(C=te,G=se,$())},void 0,!1,q):G={}}$()}}function Wg(t,e,i,r){const n=new ds(e,{brightness:i});for(const s of t)s.recalculate(n,r)}class qv{constructor(e){this.entries={},this.scheduler=e}request(e,i,r,n){const s=this.entries[e]=this.entries[e]||{callbacks:[]};if(s.result){const[a,c]=s.result;return this.scheduler?this.scheduler.add(()=>{n(a,c)},i):n(a,c),()=>{}}return s.callbacks.push(n),s.cancel||(s.cancel=r((a,c)=>{s.result=[a,c];for(const p of s.callbacks)this.scheduler?this.scheduler.add(()=>{p(a,c)},i):p(a,c);setTimeout(()=>delete this.entries[e],3e3)})),()=>{s.result||(s.callbacks=s.callbacks.filter(a=>a!==n),s.callbacks.length||(s.cancel(),delete this.entries[e]))}}}function Qv(t,e,i){const r=JSON.stringify(t.request);return t.data&&(this.deduped.entries[r]={result:[null,t.data]}),this.deduped.request(r,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},n=>{const s=Ve(t.request,(a,c,p,_)=>{a?n(a):c&&n(null,{vectorTile:i?void 0:new _g(new bm(c)),rawData:c,cacheControl:p,expires:_})});return()=>{s.cancel(),n()}},e)}class Hv extends rs{constructor(e,i,r,n){if(super(),this.id=e,this.dispatcher=r,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,zt(this,dr(i,["url","scheme","tileSize","promoteId"])),this._options=zt({type:"vector"},i),this._collectResourceTiming=!!i.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(n),this._tileWorkers={},this._deduped=new qv}load(e){this._loaded=!1,this.fire(new ei("dataloading",{dataType:"source"}));const i=Array.isArray(this.map._language)?this.map._language.join():this.map._language,r=this.map._worldview;this._tileJSONRequest=Hg(this._options,this.map._requestManager,i,r,(n,s)=>{this._tileJSONRequest=null,this._loaded=!0,n?(i&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${i}`),r&&r.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${r}`),this.fire(new ir(n))):s&&(zt(this,s),s.bounds&&(this.tileBounds=new Jm(s.bounds,this.minzoom,this.maxzoom)),fn(s.tiles,this.map._requestManager._customAccessToken),this.fire(new ei("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new ei("data",{dataType:"source",sourceDataType:"content"}))),e&&e(n)})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}reload(){this.cancelTileJSONRequest();const e=Oo(this.id,this.scope);this.load(()=>this.map.style.clearSource(e))}setTiles(e){return this._options.tiles=e,this.reload(),this}setUrl(e){return this.url=e,this._options.url=e,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return zt({},this._options)}loadTile(e,i){const r=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme)),n={request:this.map._requestManager.transformRequest(r,we.Tile),data:void 0,uid:e.uid,tileID:e.tileID,tileZoom:e.tileZoom,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:Xi.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:e.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:e.isExtraShadowCaster};if(n.request.collectResourceTiming=this._collectResourceTiming,e.actor&&e.state!=="expired")e.state==="loading"?e.reloadCallback=i:e.request=e.actor.send("reloadTile",n,s.bind(this));else if(e.actor=this._tileWorkers[r]=this._tileWorkers[r]||this.dispatcher.getActor(),this.dispatcher.ready)e.request=e.actor.send("loadTile",n,s.bind(this),void 0,!0);else{const a=Qv.call({deduped:this._deduped},n,(c,p)=>{c||!p?s.call(this,c):(n.data={cacheControl:p.cacheControl,expires:p.expires,rawData:p.rawData.slice(0)},e.actor&&e.actor.send("loadTile",n,s.bind(this),void 0,!0))},!0);e.request={cancel:a}}function s(a,c){return delete e.request,e.aborted?i(null):a&&a.status!==404?i(a):(c&&c.resourceTiming&&(e.resourceTiming=c.resourceTiming),this.map._refreshExpiredTiles&&c&&e.setExpiryData(c),e.loadVectorData(c,this.map.painter),kt(this.dispatcher),i(null),void(e.reloadCallback&&(this.loadTile(e,e.reloadCallback),e.reloadCallback=null)))}}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.actor&&e.actor.send("abortTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(e){e.actor&&e.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope}),e.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class $g extends rs{constructor(e,i,r,n){super(),this.id=e,this.dispatcher=r,this.setEventedParent(n),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=zt({type:"raster"},i),zt(this,dr(i,["url","scheme","tileSize"]))}load(e){this._loaded=!1,this.fire(new ei("dataloading",{dataType:"source"})),this._tileJSONRequest=Hg(this._options,this.map._requestManager,null,null,(i,r)=>{this._tileJSONRequest=null,this._loaded=!0,i?this.fire(new ir(i)):r&&(zt(this,r),r.bounds&&(this.tileBounds=new Jm(r.bounds,this.minzoom,this.maxzoom)),fn(r.tiles),this.fire(new ei("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new ei("data",{dataType:"source",sourceDataType:"content"}))),e&&e(i)})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}reload(){this.cancelTileJSONRequest();const e=Oo(this.id,this.scope);this.load(()=>this.map.style.clearSource(e))}setTiles(e){return this._options.tiles=e,this.reload(),this}setUrl(e){return this.url=e,this._options.url=e,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return zt({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e,i){const r=Xi.devicePixelRatio>=2,n=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),r,this.tileSize);e.request=Et(this.map._requestManager.transformRequest(n,we.Tile),(s,a,c,p)=>(delete e.request,e.aborted?(e.state="unloaded",i(null)):s?(e.state="errored",i(s)):a?(this.map._refreshExpiredTiles&&e.setExpiryData({cacheControl:c,expires:p}),e.setTexture(a,this.map.painter),e.state="loaded",kt(this.dispatcher),void i(null)):i(null)))}abortTile(e,i){e.request&&(e.request.cancel(),delete e.request),i()}unloadTile(e,i){e.texture&&e.texture instanceof ks?(e.destroy(!0),e.texture&&e.texture instanceof ks&&this.map.painter.saveTileTexture(e.texture)):e.destroy(),i()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function fM(){return b_.workerClass!=null?new b_.workerClass:new me.Worker(b_.workerUrl)}const Xg="mapboxgl_preloaded_worker_pool";class df{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<df.workerCount;)this.workers.push(new fM);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(i=>{i.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Xg]}numActive(){return Object.keys(this.active).length}}let X0;function Y0(){return X0||(X0=new df),X0}df.workerCount=2;let e_,Yg,$c,Kg=null;function Wv(){return Qt()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:Yg||yt.DRACO_URL}const Jg=5123,ey=5126,ty={5120:Int8Array,5121:Uint8Array,5122:Int16Array,[Jg]:Uint16Array,5125:Uint32Array,[ey]:Float32Array},pM={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",[Jg]:"DT_UINT16",5125:"DT_UINT32",[ey]:"DT_FLOAT32"},iy={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function $v(t,e,i){const r=i.json.bufferViews.length,n=i.buffers.length;e.bufferView=r,i.json.bufferViews[r]={buffer:n,byteLength:t.byteLength},i.buffers[n]=t}const ry="KHR_draco_mesh_compression";function mM(t,e){const i=t.extensions&&t.extensions[ry];if(!i)return;const r=new $c.Decoder,n=Jv(e,i.bufferView),s=new $c.Mesh;if(!r.DecodeArrayToMesh(n,n.byteLength,s))throw new Error("Failed to decode Draco mesh");const a=e.json.accessors[t.indices],c=ty[a.componentType],p=a.count*c.BYTES_PER_ELEMENT,_=$c._malloc(p);c===Uint16Array?r.GetTrianglesUInt16Array(s,p,_):r.GetTrianglesUInt32Array(s,p,_),$v($c.memory.buffer.slice(_,_+p),a,e),$c._free(_);for(const v of Object.keys(i.attributes)){const E=r.GetAttributeByUniqueId(s,i.attributes[v]),C=e.json.accessors[t.attributes[v]],B=pM[C.componentType],O=C.count*iy[C.type]*ty[C.componentType].BYTES_PER_ELEMENT,G=$c._malloc(O);r.GetAttributeDataArrayForAllPoints(s,E,$c[B],O,G),$v($c.memory.buffer.slice(G,G+O),C,e),$c._free(G)}r.destroy(),s.destroy(),delete t.extensions[ry]}const Xv=1179937895,Yv=new TextDecoder("utf8");function Kv(t,e){return new URL(t,e).href}function _M(t,e,i,r){return fetch(Kv(t.uri,r)).then(n=>n.arrayBuffer()).then(n=>{e.buffers[i]=n})}function Jv(t,e){const i=t.json.bufferViews[e];return new Uint8Array(t.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function gM(t,e,i,r){if(t.uri){const n=Kv(t.uri,r);return fetch(n).then(s=>s.blob()).then(s=>me.createImageBitmap(s)).then(s=>{e.images[i]=s})}if(t.bufferView!==void 0){const n=Jv(e,t.bufferView),s=new me.Blob([n],{type:t.mimeType});return me.createImageBitmap(s).then(a=>{e.images[i]=a})}}function eb(t,e=0,i){const r={json:null,images:[],buffers:[]};if(new Uint32Array(t,e,1)[0]===Xv){const _=new Uint32Array(t,e);let v=2;const E=(_[v++]>>2)-3,C=_[v++]>>2;if(v++,r.json=JSON.parse(Yv.decode(_.subarray(v,v+C))),v+=C,v<E){const B=_[v++];v++;const O=e+(v<<2);r.buffers[0]=t.slice(O,O+B)}}else r.json=JSON.parse(Yv.decode(new Uint8Array(t,e)));const{buffers:n,images:s,meshes:a,extensionsUsed:c}=r.json;let p=Promise.resolve();if(n){const _=[];for(let v=0;v<n.length;v++){const E=n[v];E.uri?_.push(_M(E,r,v,i)):r.buffers[v]||(r.buffers[v]=null)}p=Promise.all(_)}return p.then(()=>{const _=[],v=c&&c.includes(ry);if(v&&_.push(function(){if(!$c)return e_||(e_=function(E){let C,B=null;function O(){C=new Uint8Array(B.buffer)}function G(){throw new Error("Unexpected Draco error.")}const q={a:{a:G,d:function($,J,ie){return C.copyWithin($,J,J+ie)},c:function($){const J=C.length,ie=Math.max($>>>0,Math.ceil(1.2*J)),re=Math.ceil((ie-J)/65536);try{return B.grow(re),O(),!0}catch{return!1}},b:G}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(E,q):E.then($=>$.arrayBuffer()).then($=>WebAssembly.instantiate($,q))).then($=>{const{Rb:J,Qb:ie,P:re,T:te,X:se,Ja:he,La:ve,Qa:be,Va:Ce,Wa:Ne,eb:je,jb:Ye,f:Re,e:rt,yb:lt,zb:vt,Ab:it,Bb:at,Db:Tt,Gb:It}=$.instance.exports;B=rt;const St=(()=>{let Lt=0,Ot=0,jt=0,Dt=0;return Kt=>{jt&&(J(Dt),J(Lt),Ot+=jt,jt=Lt=0),Lt||(Ot+=128,Lt=ie(Ot));const mi=Kt.length+7&-8;let _i=Lt;mi>=Ot&&(jt=mi,_i=Dt=ie(mi));for(let Ti=0;Ti<Kt.length;Ti++)C[_i+Ti]=Kt[Ti];return _i}})();return O(),Re(),{memory:rt,_free:J,_malloc:ie,Mesh:class{constructor(){this.ptr=re()}destroy(){te(this.ptr)}},Decoder:class{constructor(){this.ptr=he()}destroy(){Ye(this.ptr)}DecodeArrayToMesh(Lt,Ot,jt){const Dt=St(Lt),Kt=ve(this.ptr,Dt,Ot,jt.ptr);return!!se(Kt)}GetAttributeByUniqueId(Lt,Ot){return{ptr:be(this.ptr,Lt.ptr,Ot)}}GetTrianglesUInt16Array(Lt,Ot,jt){Ce(this.ptr,Lt.ptr,Ot,jt)}GetTrianglesUInt32Array(Lt,Ot,jt){Ne(this.ptr,Lt.ptr,Ot,jt)}GetAttributeDataArrayForAllPoints(Lt,Ot,jt,Dt,Kt){je(this.ptr,Lt.ptr,Ot.ptr,jt,Dt,Kt)}},DT_INT8:lt(),DT_UINT8:vt(),DT_INT16:it(),DT_UINT16:at(),DT_UINT32:Tt(),DT_FLOAT32:It()}})}(fetch(Wv())),e_.then(E=>{$c=E,e_=void 0}))}()),s)for(let E=0;E<s.length;E++)_.push(gM(s[E],r,E,i));return(_.length?Promise.all(_):Promise.resolve()).then(()=>{if(v&&a)for(const{primitives:E}of a)for(const C of E)mM(C,r);return r})})}function tb(t){return fetch(t).then(e=>e.arrayBuffer()).then(e=>eb(e,0,t))}class ib{constructor(e,i,r){if(this.triangleCount=i.length/3,this.min=new At(0,0),this.max=new At(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0||r===0)return;const n=e.map(v=>v.x),s=e.map(v=>v.y);this.min=new At(Math.min(...n),Math.min(...s)),this.max=new At(Math.max(...n),Math.max(...s));const a=this.max.sub(this.min);a.x=Math.max(a.x,1),a.y=Math.max(a.y,1);const c=Math.max(a.x,a.y)/r;this.cellsX=Math.max(1,Math.ceil(a.x/c)),this.cellsY=Math.max(1,Math.ceil(a.y/c)),this.xScale=1/c,this.yScale=1/c;const p=[];for(let v=0;v<this.triangleCount;v++){const E=e[i[3*v+0]].sub(this.min),C=e[i[3*v+1]].sub(this.min),B=e[i[3*v+2]].sub(this.min),O=mh(Math.floor(Math.min(E.x,C.x,B.x)),this.xScale,this.cellsX),G=mh(Math.floor(Math.max(E.x,C.x,B.x)),this.xScale,this.cellsX),q=mh(Math.floor(Math.min(E.y,C.y,B.y)),this.yScale,this.cellsY),$=mh(Math.floor(Math.max(E.y,C.y,B.y)),this.yScale,this.cellsY),J=new At(0,0),ie=new At(0,0),re=new At(0,0),te=new At(0,0);for(let se=q;se<=$;++se){J.y=ie.y=se*c,re.y=te.y=(se+1)*c;for(let he=O;he<=G;++he)J.x=re.x=he*c,ie.x=te.x=(he+1)*c,(lg(E,C,B,J,ie,te)||lg(E,C,B,J,te,re))&&p.push({cellIdx:se*this.cellsX+he,triIdx:v})}}if(p.length===0)return;p.sort((v,E)=>v.cellIdx-E.cellIdx||v.triIdx-E.triIdx);let _=0;for(;_<p.length;){const v=p[_].cellIdx,E={start:this.payload.length,len:0};for(;_<p.length&&p[_].cellIdx===v;)++E.len,this.payload.push(p[_++].triIdx);this.cells[v]=E}}query(e,i,r){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>i.x||e.y>this.max.y||this.min.y>i.y)return;this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8)));for(let p=0;p<this.lookup.length;p++)this.lookup[p]=0;const n=mh(e.x-this.min.x,this.xScale,this.cellsX),s=mh(i.x-this.min.x,this.xScale,this.cellsX),a=mh(e.y-this.min.y,this.yScale,this.cellsY),c=mh(i.y-this.min.y,this.yScale,this.cellsY);for(let p=a;p<=c;p++)for(let _=n;_<=s;_++){const v=this.cells[p*this.cellsX+_];if(v)for(let E=0;E<v.len;E++){const C=this.payload[v.start+E],B=Math.floor(C/8),O=1<<C%8;if(!(this.lookup[B]&O)&&(this.lookup[B]|=O,r.push(C),r.length===this.triangleCount))return}}}}function mh(t,e,i){return Math.max(0,Math.min(i-1,Math.floor(t*e)))}function td(t,e){const i=t.json.bufferViews[e.bufferView];return new ty[e.componentType](t.buffers[i.buffer],(e.byteOffset||0)+(i.byteOffset||0),e.count*iy[e.type])}function yM(t,e,i){const r=t.indices,n=t.attributes,s={};s.indexArray=new Ys;const a=e.json.accessors[r],c=a.count/3;s.indexArray.reserve(c);const p=td(e,a);for(let C=0;C<c;C++)s.indexArray.emplaceBack(p[3*C],p[3*C+1],p[3*C+2]);s.indexArray._trim(),s.vertexArray=new Lc;const _=e.json.accessors[n.POSITION];s.vertexArray.reserve(_.count);const v=td(e,_);for(let C=0;C<_.count;C++)s.vertexArray.emplaceBack(v[3*C],v[3*C+1],v[3*C+2]);if(s.vertexArray._trim(),s.aabb=new $r(_.min,_.max),s.centroid=function(C,B){const O=[0,0,0],G=C.length;if(G>0){for(let q=0;q<G;q++){const $=3*C[q];O[0]+=B[$],O[1]+=B[$+1],O[2]+=B[$+2]}O[0]/=G,O[1]/=G,O[2]/=G}return O}(p,v),n.COLOR_0!==void 0){const C=e.json.accessors[n.COLOR_0],B=iy[C.type];if(C.componentType===ey){s.colorArray=B===3?new Lc:new Pc,s.colorArray.reserve(C.count);const O=td(e,C);if(B===3)for(let G=0;G<C.count;G++)s.colorArray.emplaceBack(O[3*G],O[3*G+1],O[3*G+2]);else for(let G=0;G<C.count;G++)s.colorArray.emplaceBack(O[4*G],O[4*G+1],O[4*G+2],O[4*G+3]);s.colorArray._trim()}else if(C.componentType===Jg&&B===4){s.colorArray=new Pc,s.colorArray.resize(C.count);const O=td(e,C),G=1/65535,q=s.colorArray.float32;for(let $=0;$<4*O.length;++$)q[$]=O[$]*G}else Pe(`glTF color buffer parsing for accessor ${JSON.stringify(C)} is not supported`)}if(n.NORMAL!==void 0){s.normalArray=new Lc;const C=e.json.accessors[n.NORMAL];s.normalArray.reserve(C.count);const B=td(e,C);for(let O=0;O<C.count;O++)s.normalArray.emplaceBack(B[3*O],B[3*O+1],B[3*O+2]);s.normalArray._trim()}if(n.TEXCOORD_0!==void 0&&i.length>0){s.texcoordArray=new Ph;const C=e.json.accessors[n.TEXCOORD_0];s.texcoordArray.reserve(C.count);const B=td(e,C);for(let O=0;O<C.count;O++)s.texcoordArray.emplaceBack(B[2*O],B[2*O+1]);s.texcoordArray._trim()}const E=t.material;return s.material=function(C,B){const{emissiveFactor:O=[0,0,0],alphaMode:G="OPAQUE",alphaCutoff:q=.5,normalTexture:$,occlusionTexture:J,emissiveTexture:ie,doubleSided:re}=C,{baseColorFactor:te=[1,1,1,1],metallicFactor:se=1,roughnessFactor:he=1,baseColorTexture:ve,metallicRoughnessTexture:be}=C.pbrMetallicRoughness||{};return{pbrMetallicRoughness:{baseColorFactor:new pr(...te),metallicFactor:se,roughnessFactor:he,baseColorTexture:ve?B[ve.index]:void 0,metallicRoughnessTexture:be?B[be.index]:void 0},doubleSided:re,emissiveFactor:O,alphaMode:G,alphaCutoff:q,normalTexture:$?B[$.index]:void 0,occlusionTexture:J?B[J.index]:void 0,emissionTexture:ie?B[ie.index]:void 0,defined:C.defined===void 0}}(E!==void 0?e.json.materials[E]:{defined:!1},i),n._FEATURE_RGBA4444!==void 0&&(s.featureData=new Uint32Array(td(e,e.json.accessors[n._FEATURE_RGBA4444]).buffer)),s}function rb(t,e,i){const{matrix:r,rotation:n,translation:s,scale:a,mesh:c,extras:p,children:_}=t,v={};if(v.matrix=r||ce.fromRotationTranslationScale([],n||[0,0,0,1],s||[0,0,0],a||[1,1,1]),c!==void 0){v.meshes=i[c];const E=v.anchor=[0,0];for(const C of v.meshes){const{min:B,max:O}=C.aabb;E[0]+=B[0]+O[0],E[1]+=B[1]+O[1]}E[0]=Math.floor(E[0]/v.meshes.length/2),E[1]=Math.floor(E[1]/v.meshes.length/2)}if(p&&(p.id&&(v.id=p.id),p.lights&&(v.lights=function(E){if(!E.length)return[];const C=function($){const J=atob($),ie=new Uint8Array(J.length);for(let re=0;re<J.length;re++)ie[re]=J.codePointAt(re);return ie}(E),B=[],O=C.length/24,G=new Uint16Array(C.buffer),q=new Float32Array(C.buffer);for(let $=0;$<O;$++){const J=G[2*$*6]/30,ie=G[2*$*6+1]/30,re=G[2*$*6+10]/100,te=q[6*$+1],se=q[6*$+2],he=q[6*$+3],ve=q[6*$+4],be=he-te,Ce=ve-se,Ne=Math.hypot(be,Ce);B.push({pos:[te+.5*be,se+.5*Ce,ie],normal:[Ce/Ne,-be/Ne,0],width:Ne,height:J,depth:re,points:[te,se,he,ve]})}return B}(p.lights))),_){const E=[];for(const C of _)E.push(rb(e.json.nodes[C],e,i));v.children=E}return v}function xM(t){if(t.vertices.length===0||t.indices.length===0)return null;const[e,i]=[t.vertices[0].clone(),t.vertices[0].clone()];for(let a=1;a<t.vertices.length;++a){const c=t.vertices[a];e.x=Math.min(e.x,c.x),e.y=Math.min(e.y,c.y),i.x=Math.max(i.x,c.x),i.y=Math.max(i.y,c.y)}const r=Math.ceil(Math.max(i.x-e.x,i.y-e.y)/256),n=Math.max(8,r),s=new ib(t.vertices,t.indices,n);return{vertices:t.vertices,indices:t.indices,grid:s,min:e,max:i}}function vM(t){if(!t.extras||!t.extras.ground)return null;const e=t.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const i=e[0];if(!i||!Array.isArray(i)||i.length===0)return null;const r=[];for(const a of i){if(!Array.isArray(a)||a.length!==2)continue;const c=a[0],p=a[1];typeof c=="number"&&typeof p=="number"&&r.push(new At(c,p))}if(r.length<3)return null;r.length>1&&r[r.length-1].equals(r[0])&&r.pop();let n=0;for(let a=0;a<r.length;a++){const c=r[a],p=r[(a+1)%r.length],_=r[(a+2)%r.length];n+=(c.x-p.x)*(_.y-p.y)-(_.x-p.x)*(c.y-p.y)}n>0&&r.reverse();const s=pm(r.flatMap(a=>[a.x,a.y]),[]);return s.length===0?null:{vertices:r,indices:s}}function bM(t){const e=[],i=[];let r=0;for(const n of t){r=e.length;const s=n.vertexArray.float32,a=n.indexArray.uint16;for(let c=0;c<n.vertexArray.length;c++)e.push(new At(s[3*c+0],s[3*c+1]));for(let c=0;c<3*n.indexArray.length;c++)i.push(a[c]+r)}if(i.length%3!=0)return null;for(let n=0;n<i.length;n+=3){const s=e[i[n+0]],a=e[i[n+1]],c=e[i[n+2]];(s.x-a.x)*(c.y-a.y)-(c.x-a.x)*(s.y-a.y)>0&&([i[n+1],i[n+2]]=[i[n+2],i[n+1]])}return{vertices:e,indices:i}}function ny(t){const e=function(p,_){const v=[],E=me.WebGL2RenderingContext;if(p.json.textures)for(const C of p.json.textures){const B={magFilter:E.LINEAR,minFilter:E.NEAREST,wrapS:E.REPEAT,wrapT:E.REPEAT};C.sampler!==void 0&&Object.assign(B,p.json.samplers[C.sampler]),v.push({image:_[C.source],sampler:B,uploaded:!1})}return v}(t,t.images),i=function(p,_){const v=[];for(const E of p.json.meshes){const C=[];for(const B of E.primitives)C.push(yM(B,p,_));v.push(C)}return v}(t,e),{scenes:r,scene:n,nodes:s}=t.json,a=r?r[n||0].nodes:s,c=[];for(const p of a)c.push(rb(s[p],t,i));return function(p,_,v){const E={},C=new Set;for(let B=0;B<p.length;B++){const O=v[_[B]];if(!O.extras)continue;const G=O.extras["mapbox:footprint:version"],q=O.extras["mapbox:footprint:id"];(G||q)&&C.add(B),G==="1.0.0"&&q&&(E[q]=B)}for(let B=0;B<p.length;B++){if(C.has(B))continue;const O=p[B],G=v[_[B]];if(!G.extras)continue;let q=null;O.id in E&&(q=bM(p[E[O.id]].meshes)),q||(q=vM(G)),q&&(O.footprint=xM(q))}if(C.size>0){const B=Array.from(C.values()).sort((O,G)=>O-G);for(let O=B.length-1;O>=0;O--)p.splice(B[O],1)}}(c,a,t.json.nodes),c}function wM(t){t.heightmap=new Float32Array(4096),t.heightmap.fill(-1);const e=t.vertexArray.float32,i=t.aabb.min[0]-1,r=t.aabb.min[1]-1,n=Yh/(t.aabb.max[0]-i+2),s=Yh/(t.aabb.max[1]-r+2);for(let a=0;a<e.length;a+=3){const c=e[a+2],p=(e[a+0]-i)*n|0,_=(e[a+1]-r)*s|0;c>t.heightmap[_*Yh+p]&&(t.heightmap[_*Yh+p]=c)}}function TM(t,e){const i={};i.indexArray=new Ys,i.indexArray.reserve(4*t.length),i.vertexArray=new Lc,i.vertexArray.reserve(10*t.length),i.colorArray=new Pc,i.vertexArray.reserve(10*t.length);let r=0;for(const a of t){const c=Math.min(10,Math.max(4,1.3*a.height))*e,p=[-a.normal[1],a.normal[0],0],_=Math.min(.29,.1*a.width/a.depth),v=a.width-2*a.depth*e*(_+.01),E=_e.scaleAndAdd([],a.pos,p,v/2),C=_e.scaleAndAdd([],a.pos,p,-v/2),B=[E[0],E[1],E[2]+a.height],O=[C[0],C[1],C[2]+a.height],G=_e.scaleAndAdd([],a.normal,p,_);_e.scale(G,G,c);const q=_e.scaleAndAdd([],a.normal,p,-_);_e.scale(q,q,c),_e.add(G,E,G),_e.add(q,C,q),E[2]+=.1,C[2]+=.1,i.vertexArray.emplaceBack(G[0],G[1],G[2]),i.vertexArray.emplaceBack(q[0],q[1],q[2]),i.vertexArray.emplaceBack(E[0],E[1],E[2]),i.vertexArray.emplaceBack(C[0],C[1],C[2]),i.vertexArray.emplaceBack(B[0],B[1],B[2]),i.vertexArray.emplaceBack(O[0],O[1],O[2]),i.vertexArray.emplaceBack(E[0],E[1],E[2]),i.vertexArray.emplaceBack(C[0],C[1],C[2]),i.vertexArray.emplaceBack(G[0],G[1],G[2]),i.vertexArray.emplaceBack(q[0],q[1],q[2]);const $=v/c/2;i.colorArray.emplaceBack(-$-_,-1,$,.8),i.colorArray.emplaceBack($+_,-1,$,.8),i.colorArray.emplaceBack(-$,0,$,1.3),i.colorArray.emplaceBack($,0,$,1.3),i.colorArray.emplaceBack($+_,-.8,$,.7),i.colorArray.emplaceBack($+_,-.8,$,.7),i.colorArray.emplaceBack(0,0,$,1.3),i.colorArray.emplaceBack(0,0,$,1.3),i.colorArray.emplaceBack($+_,-1.2,$,.8),i.colorArray.emplaceBack($+_,-1.2,$,.8),i.indexArray.emplaceBack(6+r,4+r,8+r),i.indexArray.emplaceBack(7+r,9+r,5+r),i.indexArray.emplaceBack(0+r,1+r,2+r),i.indexArray.emplaceBack(1+r,3+r,2+r),r+=10}const n={defined:!0,emissiveFactor:[0,0,0]},s={};return s.baseColorFactor=pr.white,n.pbrMetallicRoughness=s,i.material=n,i.aabb=new $r([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}Ii(ib,"TriangleGridIndex");const sy={vector:Hv,raster:$g,"raster-dem":class extends $g{constructor(t,e,i,r){super(t,e,i,r),this.type="raster-dem",this.maxzoom=22,this._options=zt({type:"raster-dem"},e),this.encoding=e.encoding||"mapbox"}loadTile(t,e){const i=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function r(n,s){n&&(t.state="errored",e(n)),s&&(t.dem=s,t.dem.onDeserialize(),t.needsHillshadePrepare=!0,t.needsDEMTextureUpload=!0,t.state="loaded",e(null))}t.request=Et(this.map._requestManager.transformRequest(i,we.Tile),(function(n,s,a,c){if(delete t.request,t.aborted)t.state="unloaded",e(null);else if(n)t.state="errored",e(n);else if(s){this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:a,expires:c});const _=me.ImageBitmap&&s instanceof me.ImageBitmap&&WA(),v=1-(s.width-((p=s.width)<=1?1:Math.pow(2,Math.floor(Math.log(p)/Math.LN2))))/2;v<1||t.neighboringTiles||(t.neighboringTiles=this._getNeighboringTiles(t.tileID));const E=_?s:Xi.getImageData(s,v),C={uid:t.uid,coord:t.tileID,source:this.id,scope:this.scope,rawImageData:E,encoding:this.encoding,padding:v};t.actor&&t.state!=="expired"||(t.actor=this.dispatcher.getActor(),t.actor.send("loadDEMTile",C,r.bind(this),void 0,!0))}var p}).bind(this))}_getNeighboringTiles(t){const e=t.canonical,i=Math.pow(2,e.z),r=(e.x-1+i)%i,n=e.x===0?t.wrap-1:t.wrap,s=(e.x+1+i)%i,a=e.x+1===i?t.wrap+1:t.wrap,c={};return c[new fi(t.overscaledZ,n,e.z,r,e.y).key]={backfilled:!1},c[new fi(t.overscaledZ,a,e.z,s,e.y).key]={backfilled:!1},e.y>0&&(c[new fi(t.overscaledZ,n,e.z,r,e.y-1).key]={backfilled:!1},c[new fi(t.overscaledZ,t.wrap,e.z,e.x,e.y-1).key]={backfilled:!1},c[new fi(t.overscaledZ,a,e.z,s,e.y-1).key]={backfilled:!1}),e.y+1<i&&(c[new fi(t.overscaledZ,n,e.z,r,e.y+1).key]={backfilled:!1},c[new fi(t.overscaledZ,t.wrap,e.z,e.x,e.y+1).key]={backfilled:!1},c[new fi(t.overscaledZ,a,e.z,s,e.y+1).key]={backfilled:!1}),c}},geojson:class extends rs{constructor(t,e,i,r){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=i.getActor(),this.setEventedParent(r),this._data=e.data,this._options=zt({},e),this._collectResourceTiming=e.collectResourceTiming,e.maxzoom!==void 0&&(this.maxzoom=e.maxzoom),e.type&&(this.type=e.type),e.attribution&&(this.attribution=e.attribution),this.promoteId=e.promoteId;const n=Mt/this.tileSize;this.workerOptions=zt({source:this.id,scope:this.scope,cluster:e.cluster||!1,geojsonVtOptions:{buffer:(e.buffer!==void 0?e.buffer:128)*n,tolerance:(e.tolerance!==void 0?e.tolerance:.375)*n,extent:Mt,maxZoom:this.maxzoom,lineMetrics:e.lineMetrics||!1,generateId:e.generateId||!1},superclusterOptions:{maxZoom:e.clusterMaxZoom!==void 0?e.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,e.clusterMinPoints||2),extent:Mt,radius:(e.clusterRadius!==void 0?e.clusterRadius:50)*n,log:!1,generateId:e.generateId||!1},clusterProperties:e.clusterProperties,filter:e.filter},e.workerOptions)}onAdd(t){this.map=t,this.setData(this._data)}setData(t){return this._data=t,this._updateWorkerData(),this}getClusterExpansionZoom(t,e){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id,scope:this.scope},e),this}getClusterChildren(t,e){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id,scope:this.scope},e),this}getClusterLeaves(t,e,i,r){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:t,limit:e,offset:i},r),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new ei("dataloading",{dataType:"source"})),this._loaded=!1;const t=zt({},this.workerOptions);t.scope=this.scope;const e=this._data;typeof e=="string"?(t.request=this.map._requestManager.transformRequest(Xi.resolveURL(e),we.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(e),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,(i,r)=>{if(this._loaded=!0,this._pendingLoad=null,i)this.fire(new ir(i));else{const n={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&r&&r.resourceTiming&&r.resourceTiming[this.id]&&(n.resourceTiming=r.resourceTiming[this.id]),this.fire(new ei("data",n)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(t,e){const i=t.actor?"reloadTile":"loadTile";t.actor=this.actor;const r={type:this.type,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,scope:this.scope,pixelRatio:Xi.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0};t.request=this.actor.send(i,r,(n,s)=>(delete t.request,t.destroy(),t.aborted?e(null):n?e(n):(t.loadVectorData(s,this.map.painter,i==="reloadTile"),e(null))),void 0,i==="loadTile")}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0}unloadTile(t){this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return zt({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends xc{constructor(t,e,i,r){super(t,e,i,r),this.roundZoom=!0,this.type="video",this.options=e}load(){this._loaded=!1;const t=this.options;this.urls=[];for(const e of t.urls)this.urls.push(this.map._requestManager.transformRequest(e,we.Source).url);(function(e,i){const r=me.document.createElement("video");r.muted=!0,r.onloadstart=function(){i(null,r)};for(let n=0;n<e.length;n++){const s=me.document.createElement("source");Ke(e[n])||(r.crossOrigin="Anonymous"),s.src=e[n],r.appendChild(s)}})(this.urls,(e,i)=>{this._loaded=!0,e?this.fire(new ir(e)):i&&(this.video=i,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const e=this.video.seekable;t<e.start(0)||t>e.end(0)?this.fire(new ir(new vi(`sources.${this.id}`,null,`Playback for this video can be set only between the ${e.start(0)} and ${e.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,e=t.gl;this.texture?this.video.paused||(this.texture.bind(e.LINEAR,e.CLAMP_TO_EDGE),e.texSubImage2D(e.TEXTURE_2D,0,0,0,e.RGBA,e.UNSIGNED_BYTE,this.video)):(this.texture=new ks(t,this.video,e.RGBA),this.texture.bind(e.LINEAR,e.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(t)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:xc,model:class extends rs{constructor(t,e,i,r){super(),this.id=t,this.type="model",this.models=[],this._loaded=!1,this._options=e}load(){const t=[];for(const e in this._options.models){const i=this._options.models[e],r=tb(this.map._requestManager.transformRequest(i.uri,we.Model).url).then(n=>{if(!n)return;const s=ny(n),a=new Yx(e,i.position,i.orientation,s);a.computeBoundsAndApplyParent(),this.models.push(a)}).catch(n=>{this.fire(new ir(new Error(`Could not load model ${e} from ${i.uri}: ${n.message}`)))});t.push(r)}return Promise.allSettled(t).then(()=>{this._loaded=!0,this.fire(new ei("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(e=>{this.fire(new ir(new Error(`Could not load models: ${e.message}`)))})}onAdd(t){this.map=t,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(t,e){}serialize(){return{type:"model"}}},"batched-model":class extends rs{constructor(t,e,i,r){super(),this.type="batched-model",this.id=t,this.tileSize=512,this._options=e,this.tiles=this._options.tiles,this.maxzoom=e.maxzoom||19,this.minzoom=e.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=i,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(r)}onAdd(t){this.map=t,this.load()}load(t){this._loaded=!1,this.fire(new ei("dataloading",{dataType:"source"}));const e=Array.isArray(this.map._language)?this.map._language.join():this.map._language,i=this.map._worldview;this._tileJSONRequest=Hg(this._options,this.map._requestManager,e,i,(r,n)=>{this._tileJSONRequest=null,this._loaded=!0,r?(e&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${e}`),i&&i.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${i}`),this.fire(new ir(r))):n&&(zt(this,n),n.bounds&&(this.tileBounds=new Jm(n.bounds,this.minzoom,this.maxzoom)),fn(n.tiles,this.map._requestManager._customAccessToken),this.fire(new ei("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new ei("data",{dataType:"source",sourceDataType:"content"}))),t&&t(r)})}hasTransition(){return!1}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loaded(){return this._loaded}loadTile(t,e){const i=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme)),r={request:this.map._requestManager.transformRequest(i,we.Tile),data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(t.actor&&t.state!=="expired")if(t.state==="loading")t.reloadCallback=e;else{if(t.buckets){const s=Object.values(t.buckets);for(const a of s)a.dirty=!0;return void(t.state="loaded")}t.request=t.actor.send("reloadTile",r,n.bind(this))}else t.actor=this.dispatcher.getActor(),t.request=t.actor.send("loadTile",r,n.bind(this),void 0,!0);function n(s,a){return t.aborted?e(null):s&&s.status!==404?e(s):(a&&(a.resourceTiming&&(t.resourceTiming=a.resourceTiming),this.map._refreshExpiredTiles&&t.setExpiryData(a),t.buckets={...t.buckets,...a.buckets}),t.state="loaded",void e(null))}}serialize(){return zt({},this._options)}},canvas:class extends xc{constructor(t,e,i,r){super(t,e,i,r),e.coordinates?Array.isArray(e.coordinates)&&e.coordinates.length===4&&!e.coordinates.some(n=>!Array.isArray(n)||n.length!==2||n.some(s=>typeof s!="number"))||this.fire(new ir(new vi(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new ir(new vi(`sources.${t}`,null,'missing required property "coordinates"'))),e.animate&&typeof e.animate!="boolean"&&this.fire(new ir(new vi(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),e.canvas?typeof e.canvas=="string"||e.canvas instanceof me.HTMLCanvasElement||this.fire(new ir(new vi(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new ir(new vi(`sources.${t}`,null,'missing required property "canvas"'))),this.options=e,this.animate=e.animate===void 0||e.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof me.HTMLCanvasElement?this.options.canvas:me.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new ir(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const e=this.map.painter.context;this.texture?!t&&!this._playing||this.texture instanceof Nm||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new ks(e,this.canvas,e.gl.RGBA,{premultiply:!0}),this._prepareData(e)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}},custom:class extends rs{constructor(t,e,i,r){super(),this.id=t,this.type="custom",this._dataType="raster",this._dispatcher=i,this._implementation=e,this.setEventedParent(r),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new ir(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new ir(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Jm(this._implementation.bounds,this.minzoom,this.maxzoom)),e.update=this._update.bind(this),e.clearTiles=this._clearTiles.bind(this),e.coveringTiles=this._coveringTiles.bind(this),zt(this,dr(e,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return dr(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new ei("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new ei("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(t){this._map=t,this._loaded=!1,this.fire(new ei("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(t),this.load()}onRemove(t){this._implementation.onRemove&&this._implementation.onRemove(t)}hasTile(t){if(this._implementation.hasTile){const{x:e,y:i,z:r}=t.canonical;return this._implementation.hasTile({x:e,y:i,z:r})}return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,e){const{x:i,y:r,z:n}=t.tileID.canonical,s=new me.AbortController;t.request=Promise.resolve(this._implementation.loadTile({x:i,y:r,z:n},{signal:s.signal})).then((function(a){return delete t.request,t.aborted?(t.state="unloaded",e(null)):a===void 0?(t.state="errored",e(null)):a===null?(this.loadTileData(t,{width:this.tileSize,height:this.tileSize,data:null}),t.state="loaded",e(null)):function(c){return c instanceof me.ImageData||c instanceof me.HTMLCanvasElement||c instanceof me.ImageBitmap||c instanceof me.HTMLImageElement}(a)?(this.loadTileData(t,a),t.state="loaded",void e(null)):(t.state="errored",e(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(a=>{a.code!==20&&(t.state="errored",e(a))}),t.request.cancel=()=>s.abort()}loadTileData(t,e){t.setTexture(e,this._map.painter)}unloadTile(t,e){if(t.texture&&t.texture instanceof ks?(t.destroy(!0),t.texture&&t.texture instanceof ks&&this._map.painter.saveTileTexture(t.texture)):t.destroy(),this._implementation.unloadTile){const{x:i,y:r,z:n}=t.tileID.canonical;this._implementation.unloadTile({x:i,y:r,z:n})}e()}abortTile(t,e){t.request&&t.request.cancel&&(t.request.cancel(),delete t.request),e()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(t=>({x:t.canonical.x,y:t.canonical.y,z:t.canonical.z}))}_clearTiles(){const t=Oo(this.id,this.scope);this._map.style.clearSource(t)}_update(){this.fire(new ei("data",{dataType:"source",sourceDataType:"content"}))}}},oy=function(t,e,i,r){const n=new sy[e.type](t,e,i,r);if(n.id!==t)throw new Error(`Expected Source id to be ${t} instead of ${n.id}`);return Un(["load","abort","unload","serialize","prepare"],n),n};function EM(t,e){const i=ce.identity([]);return ce.scale(i,i,[.5*t.width,.5*-t.height,1]),ce.translate(i,i,[1,-1,0]),ce.multiply(i,i,t.calculateProjMatrix(e.toUnwrapped())),Float32Array.from(i)}function MM(t,e,i,r,n,s,a,c=!1){const p=t.tilesIn(r,a,c);p.sort(nb);const _=[];for(const E of p)_.push({wrappedTileID:E.tile.tileID.wrapped().key,queryResults:E.tile.queryRenderedFeatures(e,i,t._state,E,n,s,EM(t.transform,E.tile.tileID),c)});const v=function(E){const C={},B={};for(const O of E){const G=O.queryResults,q=O.wrappedTileID,$=B[q]=B[q]||{};for(const J in G){const ie=G[J],re=$[J]=$[J]||{},te=C[J]=C[J]||[];for(const se of ie)re[se.featureIndex]||(re[se.featureIndex]=!0,te.push(se))}}return C}(_);for(const E in v)v[E].forEach(C=>{const B=C.feature,O=B.layer;O&&O.type!=="background"&&O.type!=="sky"&&O.type!=="slot"&&(B.source=O.source,O["source-layer"]&&(B.sourceLayer=O["source-layer"]),B.state=B.id!==void 0?t.getFeatureState(O["source-layer"],B.id):{})});return v}function SM(t,e){const i=t.getRenderableIds().map(s=>t.getTileByID(s)),r=[],n={};for(let s=0;s<i.length;s++){const a=i[s],c=a.tileID.canonical.key;n[c]||(n[c]=!0,a.querySourceFeatures(r,e))}return r}function nb(t,e){const i=t.tileID,r=e.tileID;return i.overscaledZ-r.overscaledZ||i.canonical.y-r.canonical.y||i.wrap-r.wrap||i.canonical.x-r.canonical.x}class IM{constructor(e){this.style=e}processLayersChanged(){this.layers=[];for(const e in this.style._mergedLayers){const i=this.style._mergedLayers[e];if(i.type==="fill-extrusion")this.layers.push(i);else if(i.type==="model"){const r=this.style.getLayerSource(i);r&&r.type==="batched-model"&&this.layers.push(i)}}}updateZOffset(e,i){this.currentBuildingBuckets=[];for(let n=0;n<this.layers.length;++n){const s=this.layers[n],a=this.style.getLayerSourceCache(s);let c=1;s.type==="fill-extrusion"&&(c=s.paint.get("fill-extrusion-opacity")>0?s.paint.get("fill-extrusion-vertical-scale"):0);let p=a?a.getTile(i):null;if(!p&&a&&i.canonical.z>a.getSource().minzoom){let _=i.scaledTo(Math.min(a.getSource().maxzoom,i.overscaledZ-1));for(;_.overscaledZ>=a.getSource().minzoom&&(p=a.getTile(_),!p&&_.overscaledZ!==0);)_=_.scaledTo(_.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:p?p.getBucket(s):null,tileID:p?p.tileID:i,verticalScale:c})}e.hasAnyZOffset=!1;let r=!1;for(let n=0;n<e.symbolInstances.length;n++){const s=e.symbolInstances.get(n),a=s.zOffset,c=this._getHeightAtTileOffset(i,s.tileAnchorX,s.tileAnchorY);s.zOffset=c!==-1?c:a,r||a===s.zOffset||(r=!0),e.hasAnyZOffset||s.zOffset===0||(e.hasAnyZOffset=!0)}r&&(e.zOffsetBuffersNeedUpload=!0,e.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(e,i,r,n){let s=i,a=r;if(e.canonical.z!==n.canonical.z){const c=n.canonical,p=1/(1<<e.canonical.z-c.z);s=(i+e.canonical.x*Mt)*p-c.x*Mt|0,a=(r+e.canonical.y*Mt)*p-c.y*Mt|0}return{tileX:s,tileY:a}}_getHeightAtTileOffset(e,i,r){let n;for(let s=0;s<this.layers.length;++s){if(this.layers[s].type!=="fill-extrusion")continue;const{bucket:a,tileID:c,verticalScale:p}=this.currentBuildingBuckets[s];if(!a)continue;const{tileX:_,tileY:v}=this._mapCoordToOverlappingTile(e,i,r,c),E=a.getHeightAtTileCoord(_,v);if(E&&E.height!==void 0){if(!E.hidden)return E.height*p;n=E.height}}for(let s=0;s<this.layers.length;++s){if(this.layers[s].type!=="model")continue;const{bucket:a,tileID:c}=this.currentBuildingBuckets[s];if(!a)continue;const{tileX:p,tileY:_}=this._mapCoordToOverlappingTile(e,i,r,c),v=a.getHeightAtTileCoord(p,_);if(v&&!v.hidden)return v.height===void 0&&n!==void 0?Math.min(v.maxHeight,n)*v.verticalScale:(v.height||0)*v.verticalScale}return-1}}var sb=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function CM(t,e){const i={};for(const r in t)r!=="ref"&&(i[r]=t[r]);return sb.forEach(r=>{r in e&&(i[r]=e[r])}),i}function ob(t){t=t.slice();const e=Object.create(null);for(let i=0;i<t.length;i++)e[t[i].id]=t[i];for(let i=0;i<t.length;i++)"ref"in t[i]&&(t[i]=CM(t[i],e[t[i].ref]));return t}const vn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",setImportUrl:"setImportUrl",setImportData:"setImportData",setImportConfig:"setImportConfig"};function ab(t,e,i){i.push({command:vn.addSource,args:[t,e[t]]})}function lb(t,e,i){e.push({command:vn.removeSource,args:[t]}),i[t]=!0}function kM(t,e,i,r){lb(t,i,r),ab(t,e,i)}function DM(t,e,i){let r;for(r in t[i])if(t[i].hasOwnProperty(r)&&r!=="data"&&!tr(t[i][r],e[i][r]))return!1;for(r in e[i])if(e[i].hasOwnProperty(r)&&r!=="data"&&!tr(t[i][r],e[i][r]))return!1;return!0}function t_(t,e,i,r,n,s){let a;for(a in e=e||{},t=t||{})t.hasOwnProperty(a)&&(tr(t[a],e[a])||i.push({command:s,args:[r,a,e[a],n]}));for(a in e)e.hasOwnProperty(a)&&!t.hasOwnProperty(a)&&(tr(t[a],e[a])||i.push({command:s,args:[r,a,e[a],n]}))}function i_(t){return t.id}function r_(t,e){return t[e.id]=e,t}class PM{constructor(e,i){this.reset(e,i)}reset(e,i){this.points=e||[],this._distances=[0];for(let r=1;r<this.points.length;r++)this._distances[r]=this._distances[r-1]+this.points[r].dist(this.points[r-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(i||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=hi(e,0,1);let i=1,r=this._distances[i];const n=e*this.paddedLength+this.padding;for(;r<n&&i<this._distances.length;)r=this._distances[++i];const s=i-1,a=this._distances[s],c=r-a,p=c>0?(n-a)/c:0;return this.points[s].mult(1-p).add(this.points[i].mult(p))}}class Ab{constructor(e,i,r){const n=this.boxCells=[],s=this.circleCells=[];this.xCellCount=Math.ceil(e/r),this.yCellCount=Math.ceil(i/r);for(let a=0;a<this.xCellCount*this.yCellCount;a++)n.push([]),s.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=i,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/i,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,i,r,n,s){this._forEachCell(i,r,n,s,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(i),this.bboxes.push(r),this.bboxes.push(n),this.bboxes.push(s)}insertCircle(e,i,r,n){this._forEachCell(i-n,r-n,i+n,r+n,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(i),this.circles.push(r),this.circles.push(n)}_insertBoxCell(e,i,r,n,s,a){this.boxCells[s].push(a)}_insertCircleCell(e,i,r,n,s,a){this.circleCells[s].push(a)}_query(e,i,r,n,s,a){if(r<0||e>this.width||n<0||i>this.height)return!s&&[];const c=[];if(e<=0&&i<=0&&this.width<=r&&this.height<=n){if(s)return!0;for(let p=0;p<this.boxKeys.length;p++)c.push({key:this.boxKeys[p],x1:this.bboxes[4*p],y1:this.bboxes[4*p+1],x2:this.bboxes[4*p+2],y2:this.bboxes[4*p+3]});for(let p=0;p<this.circleKeys.length;p++){const _=this.circles[3*p],v=this.circles[3*p+1],E=this.circles[3*p+2];c.push({key:this.circleKeys[p],x1:_-E,y1:v-E,x2:_+E,y2:v+E})}return a?c.filter(a):c}return this._forEachCell(e,i,r,n,this._queryCell,c,{hitTest:s,seenUids:{box:{},circle:{}}},a),s?c.length>0:c}_queryCircle(e,i,r,n,s){const a=e-r,c=e+r,p=i-r,_=i+r;if(c<0||a>this.width||_<0||p>this.height)return!n&&[];const v=[];return this._forEachCell(a,p,c,_,this._queryCellCircle,v,{hitTest:n,circle:{x:e,y:i,radius:r},seenUids:{box:{},circle:{}}},s),n?v.length>0:v}query(e,i,r,n,s){return this._query(e,i,r,n,!1,s)}hitTest(e,i,r,n,s){return this._query(e,i,r,n,!0,s)}hitTestCircle(e,i,r,n){return this._queryCircle(e,i,r,!0,n)}_queryCell(e,i,r,n,s,a,c,p){const _=c.seenUids,v=this.boxCells[s];if(v!==null){const C=this.bboxes;for(const B of v)if(!_.box[B]){_.box[B]=!0;const O=4*B;if(e<=C[O+2]&&i<=C[O+3]&&r>=C[O+0]&&n>=C[O+1]&&(!p||p(this.boxKeys[B]))){if(c.hitTest)return a.push(!0),!0;a.push({key:this.boxKeys[B],x1:C[O],y1:C[O+1],x2:C[O+2],y2:C[O+3]})}}}const E=this.circleCells[s];if(E!==null){const C=this.circles;for(const B of E)if(!_.circle[B]){_.circle[B]=!0;const O=3*B;if(this._circleAndRectCollide(C[O],C[O+1],C[O+2],e,i,r,n)&&(!p||p(this.circleKeys[B]))){if(c.hitTest)return a.push(!0),!0;{const G=C[O],q=C[O+1],$=C[O+2];a.push({key:this.circleKeys[B],x1:G-$,y1:q-$,x2:G+$,y2:q+$})}}}}}_queryCellCircle(e,i,r,n,s,a,c,p){const _=c.circle,v=c.seenUids,E=this.boxCells[s];if(E!==null){const B=this.bboxes;for(const O of E)if(!v.box[O]){v.box[O]=!0;const G=4*O;if(this._circleAndRectCollide(_.x,_.y,_.radius,B[G+0],B[G+1],B[G+2],B[G+3])&&(!p||p(this.boxKeys[O])))return a.push(!0),!0}}const C=this.circleCells[s];if(C!==null){const B=this.circles;for(const O of C)if(!v.circle[O]){v.circle[O]=!0;const G=3*O;if(this._circlesCollide(B[G],B[G+1],B[G+2],_.x,_.y,_.radius)&&(!p||p(this.circleKeys[O])))return a.push(!0),!0}}}_forEachCell(e,i,r,n,s,a,c,p){const _=this._convertToXCellCoord(e),v=this._convertToYCellCoord(i),E=this._convertToXCellCoord(r),C=this._convertToYCellCoord(n);for(let B=_;B<=E;B++)for(let O=v;O<=C;O++)if(s.call(this,e,i,r,n,this.xCellCount*O+B,a,c,p))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,i,r,n,s,a){const c=n-e,p=s-i,_=r+a;return _*_>c*c+p*p}_circleAndRectCollide(e,i,r,n,s,a,c){const p=(a-n)/2,_=Math.abs(e-(n+p));if(_>p+r)return!1;const v=(c-s)/2,E=Math.abs(i-(s+v));if(E>v+r)return!1;if(_<=p||E<=v)return!0;const C=_-p,B=E-v;return C*C+B*B<=r*r}}const mu=100;class zM{constructor(e,i,r=new Ab(e.width+200,e.height+200,25),n=new Ab(e.width+200,e.height+200,25)){this.transform=e,this.grid=r,this.ignoredGrid=n,this.pitchfactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+mu,this.screenBottomBoundary=e.height+mu,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.fogState=i}placeCollisionBox(e,i,r,n,s,a,c,p){let _=r.projectedAnchorX,v=r.projectedAnchorY,E=r.projectedAnchorZ;const C=r.elevation,B=r.tileID,O=e.getProjection();if(C&&B){const[se,he,ve]=O.upVector(B.canonical,r.tileAnchorX,r.tileAnchorY),be=O.upVectorScale(B.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;_+=se*C*be,v+=he*C*be,E+=ve*C*be}const G=this.projectAndGetPerspectiveRatio(c,_,v,E,r.tileID,O.name==="globe"||!!C||this.transform.pitch>0,O),q=a*G.perspectiveRatio,$=(r.x1*i+n.x-r.padding)*q+G.point.x,J=(r.y1*i+n.y-r.padding)*q+G.point.y,ie=(r.x2*i+n.x+r.padding)*q+G.point.x,re=(r.y2*i+n.y+r.padding)*q+G.point.y,te=G.perspectiveRatio<=.55||G.occluded;return!this.isInsideGrid($,J,ie,re)||!s&&this.grid.hitTest($,J,ie,re,p)||te?{box:[],offscreen:!1,occluded:G.occluded}:{box:[$,J,ie,re],offscreen:this.isOffscreen($,J,ie,re),occluded:!1}}placeCollisionCircles(e,i,r,n,s,a,c,p,_,v,E,C,B,O,G){const q=[],$=this.transform.elevation,J=e.getProjection(),ie=$?$.getAtTileOffsetFunc(G,this.transform.center.lat,this.transform.worldSize,J):null,re=new At(r.tileAnchorX,r.tileAnchorY);let{x:te,y:se,z:he}=J.projectTilePoint(re.x,re.y,G.canonical);if(ie){const[vt,it,at]=ie(re);te+=vt,se+=it,he+=at}const ve=J.name==="globe",be=this.projectAndGetPerspectiveRatio(c,te,se,he,G,ve||!!$||this.transform.pitch>0,J),{perspectiveRatio:Ce}=be,Ne=(E?a/Ce:a*Ce)/fa,je=Wc(te,se,he,p),Ye=be.signedDistanceFromCamera>0?Ux(Ne,s,r.lineOffsetX*Ne,r.lineOffsetY*Ne,!1,je,re,r,n,p,{},$&&!E?ie:null,E&&!!$,J,G,E):null;let Re=!1,rt=!1,lt=!0;if(Ye&&!be.occluded){const vt=.5*B*Ce+O,it=new At(-100,-100),at=new At(this.screenRightBoundary,this.screenBottomBoundary),Tt=new PM,{first:It,last:St}=Ye,Lt=It.path.length;let Ot=[];for(let Kt=Lt-1;Kt>=1;Kt--)Ot.push(It.path[Kt]);for(let Kt=1;Kt<St.path.length;Kt++)Ot.push(St.path[Kt]);const jt=2.5*vt;_&&(Ot=Ot.map(([Kt,mi,_i],Ti)=>(ie&&!ve&&(_i=ie(Ti<Lt-1?It.tilePath[Lt-1-Ti]:St.tilePath[Ti-Lt+2])[2]),Wc(Kt,mi,_i,_))),Ot.some(Kt=>Kt[3]<=0)&&(Ot=[]));let Dt=[];if(Ot.length>0){let Kt=1/0,mi=-1/0,_i=1/0,Ti=-1/0;for(const Mi of Ot)Kt=Math.min(Kt,Mi[0]),_i=Math.min(_i,Mi[1]),mi=Math.max(mi,Mi[0]),Ti=Math.max(Ti,Mi[1]);mi>=it.x&&Kt<=at.x&&Ti>=it.y&&_i<=at.y&&(Dt=[Ot.map(Mi=>new At(Mi[0],Mi[1]))],(Kt<it.x||mi>at.x||_i<it.y||Ti>at.y)&&(Dt=cx(Dt,it.x,it.y,at.x,at.y)))}for(const Kt of Dt){Tt.reset(Kt,.25*vt);let mi=0;mi=Tt.length<=.5*vt?1:Math.ceil(Tt.paddedLength/jt)+1;for(let _i=0;_i<mi;_i++){const Ti=_i/Math.max(mi-1,1),Mi=Tt.lerp(Ti),ur=Mi.x+mu,Ui=Mi.y+mu;q.push(ur,Ui,vt,0);const on=ur-vt,Zr=Ui-vt,hr=ur+vt,or=Ui+vt;if(lt=lt&&this.isOffscreen(on,Zr,hr,or),rt=rt||this.isInsideGrid(on,Zr,hr,or),!i&&this.grid.hitTestCircle(ur,Ui,vt,C)&&(Re=!0,!v))return{circles:[],offscreen:!1,collisionDetected:Re,occluded:!1}}}}return{circles:!v&&Re||!rt?[]:q,offscreen:lt,collisionDetected:Re,occluded:be.occluded}}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const i=[];let r=1/0,n=1/0,s=-1/0,a=-1/0;for(const v of e){const E=new At(v.x+mu,v.y+mu);r=Math.min(r,E.x),n=Math.min(n,E.y),s=Math.max(s,E.x),a=Math.max(a,E.y),i.push(E)}const c=this.grid.query(r,n,s,a).concat(this.ignoredGrid.query(r,n,s,a)),p={},_={};for(const v of c){const E=v.key;p[E.bucketInstanceId]===void 0&&(p[E.bucketInstanceId]={}),p[E.bucketInstanceId][E.featureIndex]||f1(i,[new At(v.x1,v.y1),new At(v.x2,v.y1),new At(v.x2,v.y2),new At(v.x1,v.y2)])&&(p[E.bucketInstanceId][E.featureIndex]=!0,_[E.bucketInstanceId]===void 0&&(_[E.bucketInstanceId]=[]),_[E.bucketInstanceId].push(E.featureIndex))}return _}insertCollisionBox(e,i,r,n,s){(i?this.ignoredGrid:this.grid).insert({bucketInstanceId:r,featureIndex:n,collisionGroupID:s},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,i,r,n,s){const a=i?this.ignoredGrid:this.grid,c={bucketInstanceId:r,featureIndex:n,collisionGroupID:s};for(let p=0;p<e.length;p+=4)a.insertCircle(c,e[p],e[p+1],e[p+2])}projectAndGetPerspectiveRatio(e,i,r,n,s,a,c){const p=[i,r,n,1];let _=!1;n||this.transform.pitch>0?(U.transformMat4(p,p,e),this.fogState&&s&&c.name!=="globe"&&(_=function(C,B,O,G,q,$){const J=$.calculateFogTileMatrix(q),ie=[B,O,G];return _e.transformMat4(ie,ie,J),Km(C,_e.length(ie),$.pitch,$._fov)}(this.fogState,i,r,n,s.toUnwrapped(),this.transform)>.9)):Qx(p,p,e);const v=p[3];return{point:new At((p[0]/v+1)/2*this.transform.width+mu,(-p[1]/v+1)/2*this.transform.height+mu),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(c)/v*.5,1.5),signedDistanceFromCamera:v,occluded:a&&p[2]>v||_}}isOffscreen(e,i,r,n){return r<mu||e>=this.screenRightBoundary||n<mu||i>this.screenBottomBoundary}isInsideGrid(e,i,r,n){return r>=0&&e<this.gridRightBoundary&&n>=0&&i<this.gridBottomBoundary}getViewportMatrix(){const e=ce.identity([]);return ce.translate(e,e,[-100,-100,0]),e}}function ay(t,e,i){const r=e.createTileMatrix(t,t.worldSize,i.toUnwrapped());return ce.multiply(new Float32Array(16),t.projMatrix,r)}function BM(t,e,i){if(e.projection.name===i.projection.name)return t.projMatrix;const r=i.clone();return r.setProjection(e.projection),ay(r,e.getProjection(),t)}function ly(t,e,i){return e.name===i.projection.name?t.projMatrix:ay(i,e,t)}class cb{constructor(e,i,r,n){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?i:-i))):n&&r?1:0,this.placed=r}isHidden(){return this.opacity===0&&!this.placed}}class K0{constructor(e,i,r,n,s,a=!1){this.text=new cb(e?e.text:null,i,r,s),this.icon=new cb(e?e.icon:null,i,n,s),this.clipped=a}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ay{constructor(e,i,r,n=!1){this.text=e,this.icon=i,this.skipFade=r,this.clipped=n}}class LM{constructor(){this.invProjMatrix=ce.create(),this.viewportMatrix=ce.create(),this.circles=[]}}class RM{constructor(e,i,r,n,s){this.bucketInstanceId=e,this.featureIndex=i,this.sourceLayerIndex=r,this.bucketIndex=n,this.tileID=s}}class FM{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const i=++this.maxGroupID;this.collisionGroups[e]={ID:i,predicate:r=>r.collisionGroupID===i}}return this.collisionGroups[e]}}function ub(t,e,i,r,n){const{horizontalAlign:s,verticalAlign:a}=Em(t),c=-(s-.5)*e,p=-(a-.5)*i,_=Mg(t,r);return new At(c+_[0]*n,p+_[1]*n)}function cy(t,e,i,r,n){const s=new At(t,e);return i&&s._rotate(r?n:-n),s}class OM{constructor(e,i,r,n,s,a){this.transform=e.clone(),this.projection=e.projection.name,this.collisionIndex=new zM(this.transform,s),this.buildingIndex=a,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=i,this.retainedQueryData={},this.collisionGroups=new FM(r),this.collisionCircleArrays={},this.prevPlacement=n,n&&(n.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(e,i,r,n){const s=r.getBucket(i),a=r.latestFeatureIndex;if(!s||!a||i.fqid!==s.layerIds[0])return;const c=s.layers[0].layout,p=r.collisionBoxArray,_=Math.pow(2,this.transform.zoom-r.tileID.overscaledZ),v=r.tileSize/Mt,E=r.tileID.toUnwrapped();this.transform.setProjection(s.projection);const C=(B=r.tileID,O=s.getProjection(),G=this.transform,O.name===this.projection?G.calculateProjMatrix(B.toUnwrapped()):ay(G,O,B));var B,O,G;const q=c.get("text-pitch-alignment")==="map",$=c.get("text-rotation-alignment")==="map";i.compileFilter();const J=i.dynamicFilter(),ie=i.dynamicFilterNeedsFeature(),re=this.transform.calculatePixelsToTileUnitsMatrix(r),te=Ox(C,r.tileID.canonical,q,$,this.transform,s.getProjection(),re);let se=null;if(q){const be=Vx(C,r.tileID.canonical,q,$,this.transform,s.getProjection(),re);se=ce.multiply([],this.transform.labelPlaneMatrix,be)}let he=null;J&&r.latestFeatureIndex&&(he={unwrappedTileID:E,dynamicFilter:J,dynamicFilterNeedsFeature:ie,featureIndex:r.latestFeatureIndex}),this.retainedQueryData[s.bucketInstanceId]=new RM(s.bucketInstanceId,a,s.sourceLayerIndex,s.index,r.tileID);const ve={bucket:s,layout:c,posMatrix:C,textLabelPlaneMatrix:te,labelToScreenMatrix:se,clippingData:he,scale:_,textPixelRatio:v,holdingForFade:r.holdingForFade(),collisionBoxArray:p,partiallyEvaluatedTextSize:hu(s.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:hu(s.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(s.sourceID)};if(n)for(const be of s.sortKeyRanges){const{sortKey:Ce,symbolInstanceStart:Ne,symbolInstanceEnd:je}=be;e.push({sortKey:Ce,symbolInstanceStart:Ne,symbolInstanceEnd:je,parameters:ve})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:s.symbolInstances.length,parameters:ve})}attemptAnchorPlacement(e,i,r,n,s,a,c,p,_,v,E,C,B,O,G,q,$,J){const{textOffset0:ie,textOffset1:re,crossTileID:te}=C,se=[ie,re],he=ub(e,r,n,se,s),ve=this.collisionIndex.placeCollisionBox(O,s,i,cy(he.x,he.y,a,c,this.transform.angle),E,p,_,v.predicate);if(q){const be=O.getSymbolInstanceIconSize(J,this.transform.zoom,C.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(O,be,q,cy(he.x,he.y,a,c,this.transform.angle),E,p,_,v.predicate).box.length===0)return}if(ve.box.length>0){let be;return this.prevPlacement&&this.prevPlacement.variableOffsets[te]&&this.prevPlacement.placements[te]&&this.prevPlacement.placements[te].text&&(be=this.prevPlacement.variableOffsets[te].anchor),this.variableOffsets[te]={textOffset:se,width:r,height:n,anchor:e,textScale:s,prevAnchor:be},this.markUsedJustification(O,e,C,G),O.allowVerticalPlacement&&(this.markUsedOrientation(O,G,C),this.placedOrientations[te]=G),{shift:he,placedGlyphBoxes:ve}}}placeLayerBucketPart(e,i,r,n){const{bucket:s,layout:a,posMatrix:c,textLabelPlaneMatrix:p,labelToScreenMatrix:_,clippingData:v,textPixelRatio:E,holdingForFade:C,collisionBoxArray:B,partiallyEvaluatedTextSize:O,partiallyEvaluatedIconSize:G,collisionGroup:q}=e.parameters,$=a.get("text-optional"),J=a.get("icon-optional"),ie=a.get("text-allow-overlap"),re=a.get("icon-allow-overlap"),te=a.get("text-rotation-alignment")==="map",se=a.get("text-pitch-alignment")==="map",he=a.get("symbol-z-order")==="viewport-y",ve=a.get("symbol-z-elevate");this.transform.setProjection(s.projection);let be=ie&&(re||!s.hasIconData()||J),Ce=re&&(ie||!s.hasTextData()||$);!s.collisionArrays&&B&&s.deserializeCollisionBoxes(B),r&&n&&s.updateCollisionDebugBuffers(this.transform.zoom,B);const Ne=(je,Ye,Re)=>{const{crossTileID:rt,numVerticalGlyphVertices:lt}=je;if(v){const hr={zoom:this.transform.zoom,pitch:this.transform.pitch};let or=null;if(v.dynamicFilterNeedsFeature){const $i=this.retainedQueryData[s.bucketInstanceId];or=v.featureIndex.loadFeature({featureIndex:je.featureIndex,bucketIndex:$i.bucketIndex,sourceLayerIndex:$i.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,v.dynamicFilter)(hr,or,this.retainedQueryData[s.bucketInstanceId].tileID.canonical,new At(je.tileAnchorX,je.tileAnchorY),this.transform.calculateDistanceTileData(v.unwrappedTileID)))return this.placements[rt]=new Ay(!1,!1,!1,!0),void i.add(rt)}if(i.has(rt))return;if(C)return void(this.placements[rt]=new Ay(!1,!1,!1));let vt=!1,it=!1,at=!0,Tt=!1,It=!1,St=null,Lt={box:null,offscreen:null,occluded:null},Ot={box:null,offscreen:null,occluded:null},jt=null,Dt=null,Kt=null,mi=0,_i=0,Ti=0;Re.textFeatureIndex?mi=Re.textFeatureIndex:je.useRuntimeCollisionCircles&&(mi=je.featureIndex),Re.verticalTextFeatureIndex&&(_i=Re.verticalTextFeatureIndex);const Mi=hr=>{hr.tileID=this.retainedQueryData[s.bucketInstanceId].tileID;const or=this.transform.elevation;hr.elevation=je.zOffset+(or?or.getAtTileOffset(hr.tileID,hr.tileAnchorX,hr.tileAnchorY):0)},ur=Re.textBox;if(ur){Mi(ur);const hr=$i=>{let Hr=ws.horizontal;if(s.allowVerticalPlacement&&!$i&&this.prevPlacement){const Jr=this.prevPlacement.placedOrientations[rt];Jr&&(this.placedOrientations[rt]=Jr,Hr=Jr,this.markUsedOrientation(s,Hr,je))}return Hr},or=($i,Hr)=>{if(s.allowVerticalPlacement&&lt>0&&Re.verticalTextBox){for(const Jr of s.writingModes)if(Jr===ws.vertical?(Lt=Hr(),Ot=Lt):Lt=$i(),Lt&&Lt.box&&Lt.box.length)break}else Lt=$i()};if(a.get("text-variable-anchor")){let $i=a.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[rt]){const Br=this.prevPlacement.variableOffsets[rt];$i.indexOf(Br.anchor)>0&&($i=$i.filter(Vn=>Vn!==Br.anchor),$i.unshift(Br.anchor))}const Hr=(Br,Vn,Js)=>{const Bn=s.getSymbolInstanceTextSize(O,je,this.transform.zoom,Ye),us=(Br.x2-Br.x1)*Bn+2*Br.padding,Ao=(Br.y2-Br.y1)*Bn+2*Br.padding,eo=je.hasIconTextFit&&!re?Vn:null;eo&&Mi(eo);let _s={box:[],offscreen:!1,occluded:!1};const Dn=ie?2*$i.length:$i.length;for(let Ba=0;Ba<Dn;++Ba){const gu=this.attemptAnchorPlacement($i[Ba%$i.length],Br,us,Ao,Bn,te,se,E,c,q,Ba>=$i.length,je,Ye,s,Js,eo,O,G);if(gu&&(_s=gu.placedGlyphBoxes,_s&&_s.box&&_s.box.length)){vt=!0,St=gu.shift;break}}return _s};or(()=>Hr(ur,Re.iconBox,ws.horizontal),()=>{const Br=Re.verticalTextBox;return Br&&Mi(Br),s.allowVerticalPlacement&&!(Lt&&Lt.box&&Lt.box.length)&&lt>0&&Br?Hr(Br,Re.verticalIconBox,ws.vertical):{box:null,offscreen:null,occluded:null}}),Lt&&(vt=Lt.box,at=Lt.offscreen,Tt=Lt.occluded);const Jr=hr(!(!Lt||!Lt.box));if(!vt&&this.prevPlacement){const Br=this.prevPlacement.variableOffsets[rt];Br&&(this.variableOffsets[rt]=Br,this.markUsedJustification(s,Br.anchor,je,Jr))}}else{const $i=(Hr,Jr)=>{const Br=s.getSymbolInstanceTextSize(O,je,this.transform.zoom,Ye),Vn=this.collisionIndex.placeCollisionBox(s,Br,Hr,new At(0,0),ie,E,c,q.predicate);return Vn&&Vn.box&&Vn.box.length&&(this.markUsedOrientation(s,Jr,je),this.placedOrientations[rt]=Jr),Vn};or(()=>$i(ur,ws.horizontal),()=>{const Hr=Re.verticalTextBox;return s.allowVerticalPlacement&&lt>0&&Hr?(Mi(Hr),$i(Hr,ws.vertical)):{box:null,offscreen:null,occluded:null}}),hr(!!(Lt&&Lt.box&&Lt.box.length))}}if(jt=Lt,vt=jt&&jt.box&&jt.box.length>0,at=jt&&jt.offscreen,Tt=jt&&jt.occluded,je.useRuntimeCollisionCircles){const hr=s.text.placedSymbolArray.get(je.centerJustifiedTextSymbolIndex>=0?je.centerJustifiedTextSymbolIndex:je.verticalPlacedTextSymbolIndex),or=k0(s.textSizeData,O,hr),$i=a.get("text-padding");Dt=this.collisionIndex.placeCollisionCircles(s,ie,hr,s.lineVertexArray,s.glyphOffsetArray,or,c,p,_,r,se,q.predicate,je.collisionCircleDiameter*or/fa,$i,this.retainedQueryData[s.bucketInstanceId].tileID),vt=ie||Dt.circles.length>0&&!Dt.collisionDetected,at=at&&Dt.offscreen,Tt=Dt.occluded}if(Re.iconFeatureIndex&&(Ti=Re.iconFeatureIndex),Re.iconBox){const hr=or=>{Mi(or);const $i=je.hasIconTextFit&&St?cy(St.x,St.y,te,se,this.transform.angle):new At(0,0),Hr=s.getSymbolInstanceIconSize(G,this.transform.zoom,je.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(s,Hr,or,$i,re,E,c,q.predicate)};Ot&&Ot.box&&Ot.box.length&&Re.verticalIconBox?(Kt=hr(Re.verticalIconBox),it=Kt.box.length>0):(Kt=hr(Re.iconBox),it=Kt.box.length>0),at=at&&Kt.offscreen,It=Kt.occluded}const Ui=$||je.numHorizontalGlyphVertices===0&&lt===0,on=J||je.numIconVertices===0;if(Ui||on?on?Ui||(it=it&&vt):vt=it&&vt:it=vt=it&&vt,vt&&jt&&jt.box&&this.collisionIndex.insertCollisionBox(jt.box,a.get("text-ignore-placement"),s.bucketInstanceId,Ot&&Ot.box&&_i?_i:mi,q.ID),it&&Kt&&this.collisionIndex.insertCollisionBox(Kt.box,a.get("icon-ignore-placement"),s.bucketInstanceId,Ti,q.ID),Dt&&(vt&&this.collisionIndex.insertCollisionCircles(Dt.circles,a.get("text-ignore-placement"),s.bucketInstanceId,mi,q.ID),r)){const hr=s.bucketInstanceId;let or=this.collisionCircleArrays[hr];or===void 0&&(or=this.collisionCircleArrays[hr]=new LM);for(let $i=0;$i<Dt.circles.length;$i+=4)or.circles.push(Dt.circles[$i+0]),or.circles.push(Dt.circles[$i+1]),or.circles.push(Dt.circles[$i+2]),or.circles.push(Dt.collisionDetected?1:0)}const Zr=s.projection.name!=="globe";be=be&&(Zr||!Tt),Ce=Ce&&(Zr||!It),this.placements[rt]=new Ay(vt||be,it||Ce,at||s.justReloaded),i.add(rt)};if(ve&&this.buildingIndex&&(this.buildingIndex.updateZOffset(s,this.retainedQueryData[s.bucketInstanceId].tileID),s.updateZOffset()),he){const je=s.getSortedSymbolIndexes(this.transform.angle);for(let Ye=je.length-1;Ye>=0;--Ye){const Re=je[Ye];Ne(s.symbolInstances.get(Re),Re,s.collisionArrays[Re])}s.hasAnyZOffset&&Pe(`${s.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(s.hasAnyZOffset){const je=s.getSortedIndexesByZOffset();for(let Ye=0;Ye<je.length;++Ye){const Re=je[Ye];Ne(s.symbolInstances.get(Re),Re,s.collisionArrays[Re])}}else for(let je=e.symbolInstanceStart;je<e.symbolInstanceEnd;je++)Ne(s.symbolInstances.get(je),je,s.collisionArrays[je]);if(r&&s.bucketInstanceId in this.collisionCircleArrays){const je=this.collisionCircleArrays[s.bucketInstanceId];ce.invert(je.invProjMatrix,c),je.viewportMatrix=this.collisionIndex.getViewportMatrix()}s.justReloaded=!1}markUsedJustification(e,i,r,n){const{leftJustifiedTextSymbolIndex:s,centerJustifiedTextSymbolIndex:a,rightJustifiedTextSymbolIndex:c,verticalPlacedTextSymbolIndex:p,crossTileID:_}=r,v=Sg(i),E=n===ws.vertical?p:v==="left"?s:v==="center"?a:v==="right"?c:-1;s>=0&&(e.text.placedSymbolArray.get(s).crossTileID=E>=0&&s!==E?0:_),a>=0&&(e.text.placedSymbolArray.get(a).crossTileID=E>=0&&a!==E?0:_),c>=0&&(e.text.placedSymbolArray.get(c).crossTileID=E>=0&&c!==E?0:_),p>=0&&(e.text.placedSymbolArray.get(p).crossTileID=E>=0&&p!==E?0:_)}markUsedOrientation(e,i,r){const n=i===ws.horizontal||i===ws.horizontalOnly?i:0,s=i===ws.vertical?i:0,{leftJustifiedTextSymbolIndex:a,centerJustifiedTextSymbolIndex:c,rightJustifiedTextSymbolIndex:p,verticalPlacedTextSymbolIndex:_}=r,v=e.text.placedSymbolArray;a>=0&&(v.get(a).placedOrientation=n),c>=0&&(v.get(c).placedOrientation=n),p>=0&&(v.get(p).placedOrientation=n),_>=0&&(v.get(_).placedOrientation=s)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const i=this.prevPlacement;let r=!1;this.prevZoomAdjustment=i?i.zoomAdjustment(this.transform.zoom):0;const n=i?i.symbolFadeChange(e):1,s=i?i.opacities:{},a=i?i.variableOffsets:{},c=i?i.placedOrientations:{};for(const p in this.placements){const _=this.placements[p],v=s[p];v?(this.opacities[p]=new K0(v,n,_.text,_.icon,null,_.clipped),r=r||_.text!==v.text.placed||_.icon!==v.icon.placed):(this.opacities[p]=new K0(null,n,_.text,_.icon,_.skipFade,_.clipped),r=r||_.text||_.icon)}for(const p in s){const _=s[p];if(!this.opacities[p]){const v=new K0(_,n,!1,!1);v.isHidden()||(this.opacities[p]=v,r=r||_.text.placed||_.icon.placed)}}for(const p in a)this.variableOffsets[p]||!this.opacities[p]||this.opacities[p].isHidden()||(this.variableOffsets[p]=a[p]);for(const p in c)this.placedOrientations[p]||!this.opacities[p]||this.opacities[p].isHidden()||(this.placedOrientations[p]=c[p]);r?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=i?i.lastPlacementChangeTime:e)}updateLayerOpacities(e,i){const r=new Set;for(const n of i){const s=n.getBucket(e);s&&n.latestFeatureIndex&&e.fqid===s.layerIds[0]&&(this.updateBucketOpacities(s,r,n.collisionBoxArray),s.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(s,n.tileID),s.updateZOffset()))}}updateBucketOpacities(e,i,r){e.hasTextData()&&e.text.opacityVertexArray.clear(),e.hasIconData()&&e.icon.opacityVertexArray.clear(),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const n=e.layers[0].layout,s=!!e.layers[0].dynamicFilter(),a=new K0(null,0,!1,!1,!0),c=n.get("text-allow-overlap"),p=n.get("icon-allow-overlap"),_=n.get("text-variable-anchor"),v=n.get("text-rotation-alignment")==="map",E=n.get("text-pitch-alignment")==="map",C=new K0(null,0,c&&(p||!e.hasIconData()||n.get("icon-optional")),p&&(c||!e.hasTextData()||n.get("text-optional")),!0);!e.collisionArrays&&r&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(r);const B=(G,q,$)=>{for(let J=0;J<q/4;J++)G.opacityVertexArray.emplaceBack($)};let O=0;for(let G=0;G<e.symbolInstances.length;G++){const q=e.symbolInstances.get(G),{numHorizontalGlyphVertices:$,numVerticalGlyphVertices:J,crossTileID:ie,numIconVertices:re}=q,te=i.has(ie);let se=this.opacities[ie];te?se=a:se||(se=C,this.opacities[ie]=se),i.add(ie);const he=$>0||J>0,ve=re>0,be=this.placedOrientations[ie],Ce=be===ws.vertical,Ne=be===ws.horizontal||be===ws.horizontalOnly;if(!he&&!ve||se.isHidden()||O++,he){const je=hb(se.text);B(e.text,$,Ce?s_:je),B(e.text,J,Ne?s_:je);const Ye=se.text.isHidden(),{leftJustifiedTextSymbolIndex:Re,centerJustifiedTextSymbolIndex:rt,rightJustifiedTextSymbolIndex:lt,verticalPlacedTextSymbolIndex:vt}=q,it=e.text.placedSymbolArray,at=Ye||Ce?1:0;Re>=0&&(it.get(Re).hidden=at),rt>=0&&(it.get(rt).hidden=at),lt>=0&&(it.get(lt).hidden=at),vt>=0&&(it.get(vt).hidden=Ye||Ne?1:0);const Tt=this.variableOffsets[ie];Tt&&this.markUsedJustification(e,Tt.anchor,q,be);const It=this.placedOrientations[ie];It&&(this.markUsedJustification(e,"left",q,It),this.markUsedOrientation(e,It,q))}if(ve){const je=hb(se.icon),{placedIconSymbolIndex:Ye,verticalPlacedIconSymbolIndex:Re}=q,rt=e.icon.placedSymbolArray,lt=se.icon.isHidden()?1:0;Ye>=0&&(B(e.icon,re,Ce?s_:je),rt.get(Ye).hidden=lt),Re>=0&&(B(e.icon,q.numVerticalIconVertices,Ne?s_:je),rt.get(Re).hidden=lt)}if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const je=e.collisionArrays[G];if(je){let Ye=new At(0,0),Re=!0;if(je.textBox||je.verticalTextBox){if(_){const lt=this.variableOffsets[ie];lt?(Ye=ub(lt.anchor,lt.width,lt.height,lt.textOffset,lt.textScale),v&&Ye._rotate(E?this.transform.angle:-this.transform.angle)):Re=!1}s&&(Re=!se.clipped),je.textBox&&n_(e.textCollisionBox.collisionVertexArray,se.text.placed,!Re||Ce,Ye.x,Ye.y),je.verticalTextBox&&n_(e.textCollisionBox.collisionVertexArray,se.text.placed,!Re||Ne,Ye.x,Ye.y)}const rt=Re&&!!(!Ne&&je.verticalIconBox);je.iconBox&&n_(e.iconCollisionBox.collisionVertexArray,se.icon.placed,rt,q.hasIconTextFit?Ye.x:0,q.hasIconTextFit?Ye.y:0),je.verticalIconBox&&n_(e.iconCollisionBox.collisionVertexArray,se.icon.placed,!rt,q.hasIconTextFit?Ye.x:0,q.hasIconTextFit?Ye.y:0)}}}if(e.fullyClipped=O===0,e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.bucketInstanceId in this.collisionCircleArrays){const G=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=G.invProjMatrix,e.placementViewportMatrix=G.viewportMatrix,e.collisionCircleArray=G.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,i){const r=this.zoomAtLastRecencyCheck===i?1-this.zoomAdjustment(i):1;return this.zoomAtLastRecencyCheck=i,this.commitTime+this.fadeDuration*r>e}setStale(){this.stale=!0}}function n_(t,e,i,r,n){t.emplaceBack(e?1:0,i?1:0,r||0,n||0),t.emplaceBack(e?1:0,i?1:0,r||0,n||0),t.emplaceBack(e?1:0,i?1:0,r||0,n||0),t.emplaceBack(e?1:0,i?1:0,r||0,n||0)}const VM=Math.pow(2,25),NM=Math.pow(2,24),UM=Math.pow(2,17),jM=Math.pow(2,16),GM=Math.pow(2,9),ZM=Math.pow(2,8),qM=Math.pow(2,1);function hb(t){if(t.opacity===0&&!t.placed)return 0;if(t.opacity===1&&t.placed)return 4294967295;const e=t.placed?1:0,i=Math.floor(127*t.opacity);return i*VM+e*NM+i*UM+e*jM+i*GM+e*ZM+i*qM+e}const s_=0;class QM{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&e.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(e,i,r,n,s){const a=this._bucketParts;for(;this._currentTileIndex<e.length;)if(i.getBucketParts(a,n,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,s())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,a.sort((c,p)=>c.sortKey-p.sortKey));this._currentPartIndex<a.length;){const c=a[this._currentPartIndex];if(i.placeLayerBucketPart(c,this._seenCrossTileIDs,r,c.symbolInstanceStart===0),this._currentPartIndex++,s())return!0}return!1}}class HM{constructor(e,i,r,n,s,a,c,p,_){this.placement=new OM(e,s,a,c,p,_),this._currentPlacementIndex=i.length-1,this._forceFullPlacement=r,this._showCollisionBoxes=n,this._done=!1}isDone(){return this._done}continuePlacement(e,i,r,n){const s=Xi.now(),a=()=>{const c=Xi.now()-s;return!this._forceFullPlacement&&c>2};for(;this._currentPlacementIndex>=0;){const c=i[e[this._currentPlacementIndex]],p=this.placement.collisionIndex.transform.zoom;if(c.type==="symbol"&&(!c.minzoom||c.minzoom<=p)&&(!c.maxzoom||c.maxzoom>p)){const _=c,v=_.layout.get("symbol-z-elevate"),E=this._inProgressLayer=this._inProgressLayer||new QM(_),C=Oo(c.source,c.scope);if(E.continuePlacement(v?n[C]:r[C],this.placement,this._showCollisionBoxes,c,a))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const db=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class o_{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,r]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const n=r>>4;if(n!==1)throw new Error(`Got v${n} data when expected v1.`);const s=db[15&r];if(!s)throw new Error("Unrecognized array type.");const[a]=new Uint16Array(e,2,1),[c]=new Uint32Array(e,4,1);return new o_(c,a,s,e)}constructor(e,i=64,r=Float64Array,n){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=r,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const s=db.indexOf(this.ArrayType),a=2*e*this.ArrayType.BYTES_PER_ELEMENT,c=e*this.IndexArrayType.BYTES_PER_ELEMENT,p=(8-c%8)%8;if(s<0)throw new Error(`Unexpected typed array class: ${r}.`);n&&n instanceof ArrayBuffer?(this.data=n,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+c+p,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+a+c+p),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+c+p,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+s]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const r=this._pos>>1;return this.ids[r]=r,this.coords[this._pos++]=e,this.coords[this._pos++]=i,r}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return uy(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,r,n){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:s,coords:a,nodeSize:c}=this,p=[0,s.length-1,0],_=[];for(;p.length;){const v=p.pop()||0,E=p.pop()||0,C=p.pop()||0;if(E-C<=c){for(let q=C;q<=E;q++){const $=a[2*q],J=a[2*q+1];$>=e&&$<=r&&J>=i&&J<=n&&_.push(s[q])}continue}const B=C+E>>1,O=a[2*B],G=a[2*B+1];O>=e&&O<=r&&G>=i&&G<=n&&_.push(s[B]),(v===0?e<=O:i<=G)&&(p.push(C),p.push(B-1),p.push(1-v)),(v===0?r>=O:n>=G)&&(p.push(B+1),p.push(E),p.push(1-v))}return _}within(e,i,r){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:n,coords:s,nodeSize:a}=this,c=[0,n.length-1,0],p=[],_=r*r;for(;c.length;){const v=c.pop()||0,E=c.pop()||0,C=c.pop()||0;if(E-C<=a){for(let q=C;q<=E;q++)pb(s[2*q],s[2*q+1],e,i)<=_&&p.push(n[q]);continue}const B=C+E>>1,O=s[2*B],G=s[2*B+1];pb(O,G,e,i)<=_&&p.push(n[B]),(v===0?e-r<=O:i-r<=G)&&(c.push(C),c.push(B-1),c.push(1-v)),(v===0?e+r>=O:i+r>=G)&&(c.push(B+1),c.push(E),c.push(1-v))}return p}}function uy(t,e,i,r,n,s){if(n-r<=i)return;const a=r+n>>1;fb(t,e,a,r,n,s),uy(t,e,i,r,a-1,1-s),uy(t,e,i,a+1,n,1-s)}function fb(t,e,i,r,n,s){for(;n>r;){if(n-r>600){const _=n-r+1,v=i-r+1,E=Math.log(_),C=.5*Math.exp(2*E/3),B=.5*Math.sqrt(E*C*(_-C)/_)*(v-_/2<0?-1:1);fb(t,e,i,Math.max(r,Math.floor(i-v*C/_+B)),Math.min(n,Math.floor(i+(_-v)*C/_+B)),s)}const a=e[2*i+s];let c=r,p=n;for(J0(t,e,r,i),e[2*n+s]>a&&J0(t,e,r,n);c<p;){for(J0(t,e,c,p),c++,p--;e[2*c+s]<a;)c++;for(;e[2*p+s]>a;)p--}e[2*r+s]===a?J0(t,e,r,p):(p++,J0(t,e,p,n)),p<=i&&(r=p+1),i<=p&&(n=p-1)}}function J0(t,e,i,r){hy(t,i,r),hy(e,2*i,2*r),hy(e,2*i+1,2*r+1)}function hy(t,e,i){const r=t[e];t[e]=t[i],t[i]=r}function pb(t,e,i,r){const n=t-i,s=e-r;return n*n+s*s}const dy=512/Mt/2;class WM{constructor(e,i,r){this.tileID=e,this.bucketInstanceId=r,this.index=new o_(i.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const n=e.canonical.x*Mt,s=e.canonical.y*Mt;for(let a=0;a<i.length;a++){const{key:c,crossTileID:p,tileAnchorX:_,tileAnchorY:v}=i.get(a),E=Math.floor((n+_)*dy),C=Math.floor((s+v)*dy);this.index.add(E,C),this.keys.push(c),this.crossTileIDs.push(p)}this.index.finish()}findMatches(e,i,r){const n=this.tileID.canonical.z<i.canonical.z?1:Math.pow(2,this.tileID.canonical.z-i.canonical.z),s=dy/Math.pow(2,i.canonical.z-this.tileID.canonical.z),a=i.canonical.x*Mt,c=i.canonical.y*Mt;for(let p=0;p<e.length;p++){const _=e.get(p);if(_.crossTileID)continue;const{key:v,tileAnchorX:E,tileAnchorY:C}=_,B=Math.floor((a+E)*s),O=Math.floor((c+C)*s),G=this.index.range(B-n,O-n,B+n,O+n);for(const q of G){const $=this.crossTileIDs[q];if(this.keys[q]===v&&!r.has($)){r.add($),_.crossTileID=$;break}}}}}class $M{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class XM{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const i=Math.round((e-this.lng)/360);if(i!==0)for(const r in this.indexes){const n=this.indexes[r],s={};for(const a in n){const c=n[a];c.tileID=c.tileID.unwrapTo(c.tileID.wrap+i),s[c.tileID.key]=c}this.indexes[r]=s}this.lng=e}addBucket(e,i,r){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===i.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let s=0;s<i.symbolInstances.length;s++)i.symbolInstances.get(s).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]=new Set);const n=this.usedCrossTileIDs[e.overscaledZ];for(const s in this.indexes){const a=this.indexes[s];if(Number(s)>e.overscaledZ)for(const c in a){const p=a[c];p.tileID.isChildOf(e)&&p.findMatches(i.symbolInstances,e,n)}else{const c=a[e.scaledTo(Number(s)).key];c&&c.findMatches(i.symbolInstances,e,n)}}for(let s=0;s<i.symbolInstances.length;s++){const a=i.symbolInstances.get(s);a.crossTileID||(a.crossTileID=r.generate(),n.add(a.crossTileID))}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new WM(e,i.symbolInstances,i.bucketInstanceId),!0}removeBucketCrossTileIDs(e,i){for(const r of i.crossTileIDs)this.usedCrossTileIDs[e].delete(r)}removeStaleBuckets(e){let i=!1;for(const r in this.indexes){const n=this.indexes[r];for(const s in n)e[n[s].bucketInstanceId]||(this.removeBucketCrossTileIDs(r,n[s]),delete n[s],i=!0)}return i}}class YM{constructor(){this.layerIndexes={},this.crossTileIDs=new $M,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,i,r,n){let s=this.layerIndexes[e.fqid];s===void 0&&(s=this.layerIndexes[e.fqid]=new XM);let a=!1;const c={};n.name!=="globe"&&s.handleWrapJump(r);for(const p of i){const _=p.getBucket(e);_&&e.fqid===_.layerIds[0]&&(_.bucketInstanceId||(_.bucketInstanceId=++this.maxBucketInstanceId),s.addBucket(p.tileID,_,this.crossTileIDs)&&(a=!0),c[_.bucketInstanceId]=!0)}return s.removeStaleBuckets(c)&&(a=!0),a}pruneUnusedLayers(e){const i={};e.forEach(r=>{i[r]=!0});for(const r in this.layerIndexes)i[r]||delete this.layerIndexes[r]}}var mb=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w-0.0001;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,_b="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",gb=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture(u_depth,uv-df.xz)),unpack_depth(texture(u_depth,uv+df.xz)),unpack_depth(texture(u_depth,uv-df.zy)),unpack_depth(texture(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,yb=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,xb=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,vb=`#ifdef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);vec4 _raTexLinearCoord(vec2 texCoord,vec2 texResolution,out vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return (texCoord.xxyy+vec2(1.5,0.5).xyxy)/texResolution.xxyy;}vec2 _raTexLinearMix(vec2 fxy,vec4 colorMix,float colorOffset,vec4 t00,vec4 t10,vec4 t01,vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(vec2 texCoord,vec2 texResolution,vec4 colorMix,float colorOffset) {vec2 fxy;vec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texture(u_image0,c.yz),texture(u_image0,c.xz),texture(u_image0,c.yw),texture(u_image0,c.xw)
);}vec2 raTexture2D_image1_linear(vec2 texCoord,vec2 texResolution,vec4 colorMix,float colorOffset) {vec2 fxy;vec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texture(u_image1,c.yz),texture(u_image1,c.xz),texture(u_image1,c.yw),texture(u_image1,c.xw)
);}vec2 raTexture2D_image0_nearest(vec2 texCoord,vec2 texResolution,vec4 colorMix,float colorOffset) {vec4 t=texture(u_image0,texCoord);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(vec2 texCoord,vec2 texResolution,vec4 colorMix,float colorOffset) {vec4 t=texture(u_image1,texCoord);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,bb=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,wb=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef NATIVE
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Tb=[];A_(mb,Tb);const a_={"_prelude_fog.vertex.glsl":yb,"_prelude_terrain.vertex.glsl":gb,"_prelude_shadow.vertex.glsl":bb,"_prelude_fog.fragment.glsl":xb,"_prelude_shadow.fragment.glsl":wb,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":vb},l_={};En("",gb),En(xb,yb),En(wb,bb),En(vb,"");const Eb=En(`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif`,`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`),Mb=mb;var Sb={background:En(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:En(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:En(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:En("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:En(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:En(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:En("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:En("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:En("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:En(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:En(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:En(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in vec2 v_pos;in vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;out vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:En(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:En(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
uniform float u_emissive_strength;in float v_height;void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,v_depth);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef RENDER_CUTOFF
color*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
#ifdef RENDER_CUTOFF
invariant gl_Position;
#endif
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),fillExtrusionDepth:En(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:En(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
out vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:En(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,v_depth));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);v_depth=gl_Position.w;
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:En(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;HANDLE_WIREFRAME_DEBUG;
#endif
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;
#ifdef FORCE_ABS_FL_GROUND_RADIUS
fl_ground_radius=abs(flood_light_ground_radius);
#endif
float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:En(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:En(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:En(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trimmed,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:En(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture(u_image,pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting_ground(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:En(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform vec4 u_tl_br;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#elif defined(PROJECTION_GLOBE_VIEW)
in vec2 a_pos;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec2 globe_tl=vec2(u_tl_br.x,u_tl_br.y);vec2 globe_br=vec2(u_tl_br.z,u_tl_br.w);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=1.0-((mercatorY-globe_br.y)/(globe_tl.y-globe_br.y));float mercatorX=mercatorXfromLng(latLng[1]);float uvX=(mercatorX-globe_br.x)/(globe_tl.x-globe_br.x);vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);uv=vec2(uvX,uvY);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
uv=a_texture_pos/8192.0;
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),symbolIcon:En(`#include "_prelude_lighting.glsl"
uniform sampler2D u_texture;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
in float v_fade_opacity;in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
uniform mediump float u_icon_saturation;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
lowp float alpha=opacity*v_fade_opacity;vec4 out_color;
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b)*alpha;
#else
out_color=texture(u_texture,v_tex_a)*alpha;
#endif
#ifdef SATURATION
vec3 luma=vec3(dot(out_color.rgb,vec3(0.2126,0.7152,0.0722)));out_color.rgb=mix(luma,out_color.rgb,u_icon_saturation);
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
v_tex_a=a_tex/u_texsize;
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
v_fade_opacity=out_fade_opacity;}`),symbolSDF:En(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}`),symbolTextAndIcon:En(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}`),terrainRaster:En(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,v_depth,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:En("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:En(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,_b),skyboxGradient:En(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,_b),skyboxCapture:En(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:En(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:En(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:En(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture(u_depthTexture,coord));return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
texColor.rgb=sRGBToLinear(texColor.rgb);if(u_baseTextureIsAlpha) {if (texColor.w < 0.5) {discard;}albedo*=mix(vec4(texColor.rgb,texColor.a),vec4(texColor.a),float(u_baseTextureIsAlpha));} else {albedo*=texColor;}
#endif
return vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 diffuse=getDiffuseShadedColor(getBaseColor().rgb,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(diffuse,1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
ao=(texture(u_occlusionTexture,uv_2f).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);color=mix(color,v_color_mix.rgb,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=u_matrix*pos;pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=local_pos;
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1);v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:En(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=u_matrix*pos;
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:En(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`)};function A_(t,e){const i=t.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let r of i)if(r=r.trim(),r[0]==="#"&&r.includes("if")&&!r.includes("endif")){r=r.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const n=r.split(" ");for(const s of n)e.includes(s)||e.push(s)}}function En(t,e){const i=/#include\s+"([^"]+)"/g,r=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let n=e.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);n&&(n=n.map(_=>{const v=_.split(" ");return v[v.length-1]}),n=[...new Set(n)]);const s={},a=[],c=[];t=t.replace(i,(_,v)=>(c.push(v),"")),e=e.replace(i,(_,v)=>(a.push(v),""));let p=[...Tb];A_(t,p),A_(e,p);for(const _ of[...a,...c])a_[_]||console.error(`Undefined include: ${_}`),l_[_]||(l_[_]=[],A_(a_[_],l_[_])),p=[...p,...l_[_]];return{fragmentSource:t=t.replace(r,(_,v,E,C,B)=>(s[B]=!0,v==="define"?`
#ifndef HAS_UNIFORM_u_${B}
in ${E} ${C} ${B};
#else
uniform ${E} ${C} u_${B};
#endif
`:v==="initialize"?`
#ifdef HAS_UNIFORM_u_${B}
    ${E} ${C} ${B} = u_${B};
#endif
`:v==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${B}
    in ${E} ${C} ${B};
#endif
`:v==="initialize-attribute"?"":void 0)),vertexSource:e=e.replace(r,(_,v,E,C,B)=>{const O=C==="float"?"vec2":C,G=B.match(/color/)?"color":O;return v==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${B}
in ${E} ${C} a_${B};
#endif
`:s[B]?v==="define"?`
#ifndef HAS_UNIFORM_u_${B}
uniform lowp float u_${B}_t;
in ${E} ${O} a_${B};
out ${E} ${C} ${B};
#else
uniform ${E} ${C} u_${B};
#endif
`:v==="initialize"?G==="vec4"?`
#ifndef HAS_UNIFORM_u_${B}
    ${B} = a_${B};
#else
    ${E} ${C} ${B} = u_${B};
#endif
`:`
#ifndef HAS_UNIFORM_u_${B}
    ${B} = unpack_mix_${G}(a_${B}, u_${B}_t);
#else
    ${E} ${C} ${B} = u_${B};
#endif
`:v==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${B}
    in ${E} ${C} a_${B};
    out ${E} ${C} ${B};
#endif
`:v==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${B}
    ${B} = a_${B};
#endif
`:void 0:v==="define"?`
#ifndef HAS_UNIFORM_u_${B}
uniform lowp float u_${B}_t;
in ${E} ${O} a_${B};
#else
uniform ${E} ${C} u_${B};
#endif
`:v==="define-instanced"?G==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${B}0;
in vec4 a_${B}1;
in vec4 a_${B}2;
in vec4 a_${B}3;
#else
uniform ${E} ${C} u_${B};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${E} ${O} a_${B};
#else
uniform ${E} ${C} u_${B};
#endif
`:v==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${B}
    ${E} ${C} ${B} = a_${B};
#endif
`:G==="vec4"?`
#ifndef HAS_UNIFORM_u_${B}
    ${E} ${C} ${B} = a_${B};
#else
    ${E} ${C} ${B} = u_${B};
#endif
`:`
#ifndef HAS_UNIFORM_u_${B}
    ${E} ${C} ${B} = unpack_mix_${G}(a_${B}, u_${B}_t);
#else
    ${E} ${C} ${B} = u_${B};
#endif
`}),staticAttributes:n,usedDefines:p,vertexIncludes:a,fragmentIncludes:c}}class KM{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(e,i,r,n,s,a,c,p){this.context=e;let _=this.boundPaintVertexBuffers.length!==n.length;for(let E=0;!_&&E<n.length;E++)this.boundPaintVertexBuffers[E]!==n[E]&&(_=!0);let v=this.boundDynamicVertexBuffers.length!==c.length;for(let E=0;!v&&E<c.length;E++)this.boundDynamicVertexBuffers[E]!==c[E]&&(v=!0);if(!this.vao||this.boundProgram!==i||this.boundLayoutVertexBuffer!==r||_||v||this.boundIndexBuffer!==s||this.boundVertexOffset!==a)this.freshBind(i,r,n,s,a,c,p);else{e.bindVertexArrayOES.set(this.vao);for(const E of c)E&&(E.bind(),p&&E.instanceCount&&E.setVertexAttribDivisor(e.gl,i,p));s&&s.dynamicDraw&&s.bind()}}freshBind(e,i,r,n,s,a,c){const p=e.numAttributes,_=this.context,v=_.gl;this.vao&&this.destroy(),this.vao=_.gl.createVertexArray(),_.bindVertexArrayOES.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=i,this.boundPaintVertexBuffers=r,this.boundIndexBuffer=n,this.boundVertexOffset=s,this.boundDynamicVertexBuffers=a,i.enableAttributes(v,e),i.bind(),i.setVertexAttribPointers(v,e,s);for(const E of r)E.enableAttributes(v,e),E.bind(),E.setVertexAttribPointers(v,e,s);for(const E of a)E&&(E.enableAttributes(v,e),E.bind(),E.setVertexAttribPointers(v,e,s),c&&E.instanceCount&&E.setVertexAttribDivisor(v,e,c));n&&n.bind(),_.currentNumAttributes=p}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function JM(t,e){const i=Math.pow(2,e.canonical.z),r=e.canonical.y;return[new Xr(0,r/i).toLngLat().lat,new Xr(0,(r+1)/i).toLngLat().lat]}function e4(t,e,i,r,n,s,a){const c=t.context,p=c.gl,_=i.hillshadeFBO;if(!_)return;t.prepareDrawTile();const v=t.isTileAffectedByFog(e),E=t.getOrCreateProgram("hillshade",{overrideFog:v});c.activeTexture.set(p.TEXTURE0),p.bindTexture(p.TEXTURE_2D,_.colorAttachment.get());const C=((q,$,J,ie)=>{const re=J.paint.get("hillshade-shadow-color"),te=J.paint.get("hillshade-highlight-color"),se=J.paint.get("hillshade-accent-color"),he=J.paint.get("hillshade-emissive-strength");let ve=Li(J.paint.get("hillshade-illumination-direction"));if(J.paint.get("hillshade-illumination-anchor")==="viewport")ve-=q.transform.angle;else if(q.style&&q.style.enable3dLights()&&q.style.directionalLight){const Ce=q.style.directionalLight.properties.get("direction");ve=Li(ri(Ce.x,Ce.y,Ce.z)[1])}const be=!q.options.moving;return{u_matrix:ie||q.transform.calculateProjMatrix($.tileID.toUnwrapped(),be),u_image:0,u_latrange:JM(0,$.tileID),u_light:[J.paint.get("hillshade-exaggeration"),ve],u_shadow:re,u_highlight:te,u_emissive_strength:he,u_accent:se}})(t,i,r,t.terrain?e.projMatrix:null);t.uploadCommonUniforms(c,E,e.toUnwrapped());const{tileBoundsBuffer:B,tileBoundsIndexBuffer:O,tileBoundsSegments:G}=t.getTileBoundsBuffers(i);E.draw(t,p.TRIANGLES,n,s,a,Or.disabled,C,r.id,B,O,G)}function Ib(t,e,i){if(!e.needsDEMTextureUpload)return;const r=t.context,n=r.gl;r.pixelStoreUnpackPremultiplyAlpha.set(!1),e.demTexture=e.demTexture||t.getTileTexture(i.stride);const s=i.getPixels();e.demTexture?e.demTexture.update(s,{premultiply:!1}):e.demTexture=new ks(r,s,n.R32F,{premultiply:!1}),e.needsDEMTextureUpload=!1}function t4(t,e,i){const r=t.context,n=r.gl;if(!e.dem)return;const s=e.dem;if(r.activeTexture.set(n.TEXTURE1),Ib(t,e,s),!e.demTexture)return;e.demTexture.bind(n.NEAREST,n.CLAMP_TO_EDGE);const a=s.dim;r.activeTexture.set(n.TEXTURE0);let c=e.hillshadeFBO;if(!c){const C=new ks(r,{width:a,height:a,data:null},n.RGBA);C.bind(n.LINEAR,n.CLAMP_TO_EDGE),c=e.hillshadeFBO=r.createFramebuffer(a,a,!0,"renderbuffer"),c.colorAttachment.set(C.texture)}r.bindFramebuffer.set(c.framebuffer),r.viewport.set([0,0,a,a]);const{tileBoundsBuffer:p,tileBoundsIndexBuffer:_,tileBoundsSegments:v}=t.getMercatorTileBoundsBuffers(),E=[];t.linearFloatFilteringSupported()&&E.push("TERRAIN_DEM_FLOAT_FORMAT"),t.getOrCreateProgram("hillshadePrepare",{defines:E}).draw(t,n.TRIANGLES,cr.disabled,Lr.disabled,dn.unblended,Or.disabled,((C,B)=>{const O=B.stride,G=ce.create();return ce.ortho(G,0,Mt,-Mt,0,0,1),ce.translate(G,G,[0,-Mt,0]),{u_matrix:G,u_image:1,u_dimension:[O,O],u_zoom:C.overscaledZ}})(e.tileID,s),i.id,p,_,v),e.needsHillshadePrepare=!1}const Cb=t=>({u_matrix:new xr(t),u_image0:new Ni(t),u_skirt_height:new ii(t),u_ground_shadow_factor:new Tr(t)}),kb=(t,e,i)=>({u_matrix:t,u_image0:0,u_skirt_height:e,u_ground_shadow_factor:i}),Db=(t,e,i,r,n,s,a,c,p,_,v,E,C,B,O)=>({u_proj_matrix:Float32Array.from(t),u_globe_matrix:e,u_normalize_matrix:Float32Array.from(r),u_merc_matrix:i,u_zoom_transition:n,u_merc_center:s,u_image0:0,u_frustum_tl:a,u_frustum_tr:c,u_frustum_br:p,u_frustum_bl:_,u_globe_pos:v,u_globe_radius:E,u_viewport:C,u_grid_matrix:O?Float32Array.from(O):new Float32Array(9),u_skirt_height:B}),ff=(t,e)=>{if(e>0&&t.terrain&&Pe("Cutoff is currently disabled on terrain"),e<=0||t.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,0]}};const i=t.transform,r=Math.max(Math.abs(i._zoom-(t.minCutoffZoom-1)),1),n=i.isLODDisabled(!1)?Yr(60,45,i.pitch):Yr(30,15,i.pitch),s=i._farZ-i._nearZ,a=e*i.height,c=((1-(p=n))*(.75*i.cameraToCenterDistance)+p*(i._farZ+a))*r;var p;return{shouldRenderCutoff:n<1,uniformValues:{u_cutoff_params:[i._nearZ,i._farZ,(c-i._nearZ)/s,(c-a-i._nearZ)/s]}}};function Pb(t,e){return t!=null&&e!=null&&!(!t.hasData()||!e.hasData())&&t.demTexture!=null&&e.demTexture!=null&&t.tileID.key!==e.tileID.key}const pf=new class{constructor(){this.operations={}}newMorphing(t,e,i,r,n){if(t in this.operations){const s=this.operations[t];s.to.tileID.key!==i.tileID.key&&(s.queued=i)}else this.operations[t]={startTime:r,phase:0,duration:n,from:e,to:i,queued:null}}getMorphValuesForProxy(t){if(!(t in this.operations))return null;const e=this.operations[t];return{from:e.from,to:e.to,phase:e.phase}}update(t){for(const e in this.operations){const i=this.operations[e];for(i.phase=(t-i.startTime)/i.duration;i.phase>=1||!this._validOp(i);)if(!this._nextOp(i,t)){delete this.operations[e];break}}}_nextOp(t,e){return!!t.queued&&(t.from=t.to,t.to=t.queued,t.queued=null,t.phase=0,t.startTime=e,!0)}_validOp(t){return t.from.hasData()&&t.to.hasData()}},zb={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Bb(t,e,i){if(e===0)return 0;const r=e<1&&i===514?.25/e:1;return 6*Math.pow(1.5,22-t)*Math.max(e,1)*r}function i4(t,e){const i=1<<t.z;return!e&&(t.x===0||t.x===i-1)||t.y===0||t.y===i-1}const fy=t=>({u_matrix:t});function Lb(t,e,i,r,n){if(n>0){const s=Xi.now(),a=(s-t.timeAdded)/n,c=e?(s-e.timeAdded)/n:-1,p=i.getSource(),_=r.coveringZoomLevel({tileSize:p.tileSize,roundZoom:p.roundZoom}),v=!e||Math.abs(e.tileID.overscaledZ-_)>Math.abs(t.tileID.overscaledZ-_),E=v&&t.refreshedUponExpiration?1:hi(v?a:1-c,0,1);return t.refreshedUponExpiration&&a>=1&&(t.refreshedUponExpiration=!1),e?{opacity:1,mix:1-E}:{opacity:E,mix:0}}return{opacity:1,mix:0}}class r4 extends Hc{constructor(e){const i={type:"raster-dem",maxzoom:e.transform.maxZoom},r=new ed(Y0(),null),n=oy("mock-dem",i,r,e.style);super("mock-dem",n,!1),n.setEventedParent(this),this._sourceLoaded=!0}_loadTile(e,i){e.state="loaded",i(null)}}class n4 extends Hc{constructor(e){const i=oy("proxy",{type:"geojson",maxzoom:e.transform.maxZoom},new ed(Y0(),null),e.style);super("proxy",i,!1),i.setEventedParent(this),this.map=this.getSource().map=e,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(e,i,r){if(e.freezeTileCoverage)return;this.transform=e;const n=e.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((s,a)=>{if(s[a.key]="",!this._tiles[a.key]){const c=new N0(a,this._source.tileSize*a.overscaleFactor(),e.tileZoom);c.state="loaded",this._tiles[a.key]=c}return s},{});for(const s in this._tiles)s in n||(this.freeFBO(s),this._tiles[s].unloadVectorData(),delete this._tiles[s])}freeFBO(e){const i=this.proxyCachedFBO[e];if(i!==void 0){const r=Object.values(i);this.renderCachePool.push(...r),delete this.proxyCachedFBO[e]}}deallocRenderCache(){this.renderCache.forEach(e=>e.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Rb extends fi{constructor(e,i,r){super(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y),this.proxyTileKey=i,this.projMatrix=r}}class s4 extends F3{constructor(e,i){super(),this.painter=e,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[r,n,s]=function(p){const _=new ul,v=new Ys,E=131;_.reserve(17161),v.reserve(33800);const C=Mt/128,B=Mt+C/2,O=B+C;for(let q=-C;q<O;q+=C)for(let $=-C;$<O;$+=C){const J=$<0||$>B||q<0||q>B?24575:0,ie=hi(Math.round($),0,Mt),re=hi(Math.round(q),0,Mt);_.emplaceBack(ie+J,re)}const G=(q,$)=>{const J=$*E+q;v.emplaceBack(J+1,J,J+E),v.emplaceBack(J+E,J+E+1,J+1)};for(let q=1;q<129;q++)for(let $=1;$<129;$++)G($,q);return[0,129].forEach(q=>{for(let $=0;$<130;$++)G($,q),G(q,$)}),[_,v,32768]}(),a=e.context;this.gridBuffer=a.createVertexBuffer(r,wi.members),this.gridIndexBuffer=a.createIndexBuffer(n),this.gridSegments=wn.simpleSegment(0,0,r.length,n.length),this.gridNoSkirtSegments=wn.simpleSegment(0,0,r.length,s),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new n4(i.map),this.orthoMatrix=ce.create(),ce.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,Mt,0,Mt,0,1);const c=a.gl;this._overlapStencilMode=new Lr({func:c.GEQUAL,mask:255},0,255,c.KEEP,c.KEEP,c.REPLACE),this._previousZoom=e.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=i,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new r4(i.map),this._pendingGroundEffectLayers=[]}set style(e){e.on("data",this._onStyleDataEvent.bind(this)),this._style=e,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(e,i,r){if(e&&e.terrain){this._style!==e&&(this.style=e,this._evaluationZoom=void 0);const n=e.terrain.properties,s=e.terrain.drapeRenderMode===0,a=e.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=Xi.now();const c=e.terrain&&e.terrain.scope,p=n.get("source"),_=s?this._mockSourceCache:e.getSourceCache(p,c);if(!_)return void Pe(`Couldn't find terrain source "${p}".`);if(this.sourceCache=_,this._exaggeration=a?this.calculateExaggeration(i):n.get("exaggeration"),!i.projection.requiresDraping&&a&&this._exaggeration===0)return void this._disable();this.enabled=!0;const v=()=>{this.sourceCache.used&&Pe(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const E=this.getScaledDemTileSize();this.sourceCache.update(i,E,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,v(),this._initializing=!0),v(),i.updateElevation(!0,r),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(i),this._emptyDEMTextureDirty=!0,this._previousZoom=i.zoom}else this._disable()}calculateExaggeration(e){const i=this._previousCameraAltitude,r=e.getFreeCameraOptions().position.z/e.pixelsPerMeter*e.worldSize;this._previousCameraAltitude=r;const n=i!=null?r-i:Number.MAX_VALUE;if(Math.abs(n)<2)return this._exaggeration;const s=e.zoom,a=this._style.terrain;if(!this._previousUpdateTimestamp)return a.getExaggeration(s);let c=s-this._previousZoom;const p=this._previousUpdateTimestamp;let _=s;this._evaluationZoom!=null&&(_=this._evaluationZoom,Math.abs(s-_)>.5&&(c=.5*(s-_+c)),c*n<0&&(_+=c)),this._evaluationZoom=_;const v=a.getExaggeration(_),E=v===a.getExaggeration(Math.max(0,_-.1));if(E&&Math.abs(v-this._exaggeration)<.01)return v;let C=Math.min(.1,.00375*(this._updateTimestamp-p));return(E||v<.1||Math.abs(c)<1e-4)&&(C=Math.min(.2,4*C)),Ji(this._exaggeration,v,C)}resetTileLookupCache(e){this._findCoveringTileCache[e]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(e){e.coord&&e.dataType==="source"?this._clearRenderCacheForTile(e.sourceCacheId,e.coord):e.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const e in this._style._mergedSourceCaches)this._style._mergedSourceCaches[e].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(e=>e.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const e=2*this.proxySourceCache.getSource().tileSize;return[e,e]}set useVertexMorphing(e){this._useVertexMorphing=e}updateTileBinding(e){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const i=this.proxySourceCache,r=this.painter.transform;this._initializing&&(this._initializing=r._centerAltitude===0&&this.getAtPointOrZero(Xr.fromLngLat(r.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const n=this.proxyCoords=i.getIds().map(p=>{const _=i.getTileByID(p).tileID;return _.projMatrix=r.calculateProjMatrix(_.toUnwrapped()),_});(function(p,_){const v=_.transform.pointCoordinate(_.transform.getCameraPoint()),E=new At(v.x,v.y);p.sort((C,B)=>{if(B.overscaledZ-C.overscaledZ)return B.overscaledZ-C.overscaledZ;const O=new At(C.canonical.x+(1<<C.canonical.z)*C.wrap,C.canonical.y),G=new At(B.canonical.x+(1<<B.canonical.z)*B.wrap,B.canonical.y),q=E.mult(1<<C.canonical.z);return q.x-=.5,q.y-=.5,q.distSqr(O)-q.distSqr(G)})})(n,this.painter);const s=this.proxyToSource||{};this.proxyToSource={},n.forEach(p=>{this.proxyToSource[p.key]={}}),this.terrainTileForTile={};const a=this._style._mergedSourceCaches;for(const p in a){const _=a[p];if(!_.used||(_!==this.sourceCache&&this.resetTileLookupCache(_.id),this._setupProxiedCoordsForOrtho(_,e[p],s),_.usedForTerrain))continue;const v=e[p];_.getSource().reparseOverscaled&&this._assignTerrainTiles(v)}this.proxiedCoords[i.id]=n.map(p=>new Rb(p,p.key,this.orthoMatrix)),this._assignTerrainTiles(n),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(s),this.renderingToTexture=!1;const c={};this._visibleDemTiles=[];for(const p of this.proxyCoords){const _=this.terrainTileForTile[p.key];if(!_)continue;const v=_.tileID.key;v in c||(this._visibleDemTiles.push(_),c[v]=v)}}_assignTerrainTiles(e){this._initializing||e.forEach(i=>{if(this.terrainTileForTile[i.key])return;const r=this._findTileCoveringTileID(i,this.sourceCache);r&&(this.terrainTileForTile[i.key]=r)})}_prepareDEMTextures(){const e=this.painter.context,i=e.gl;for(const r in this.terrainTileForTile){const n=this.terrainTileForTile[r],s=n.dem;!s||n.demTexture&&!n.needsDEMTextureUpload||(e.activeTexture.set(i.TEXTURE1),Ib(this.painter,n,s))}}_prepareDemTileUniforms(e,i,r,n){if(!i||i.demTexture==null)return!1;const s=e.tileID.canonical,a=Math.pow(2,i.tileID.canonical.z-s.z),c=n||"";return r[`u_dem_tl${c}`]=[s.x*a%1,s.y*a%1],r[`u_dem_scale${c}`]=a,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const e=this.painter.context,i=e.gl;if(!this._emptyDepthBufferTexture){const r=new bo({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new ks(e,r,i.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let e=0;const i=this._visibleDemTiles.reduce((r,n)=>{if(!n.dem)return r;const s=n.dem.tree.minimums[0];return s>0&&e++,r+s},0);return e?i/e:0}_updateEmptyDEMTexture(){const e=this.painter.context,i=e.gl;e.activeTexture.set(i.TEXTURE2);const r=this._getLoadedAreaMinimum(),[n,s]=(()=>{const c=new S1({width:1,height:1},new Float32Array([r]));return[i.R32F,c]})();this._emptyDEMTextureDirty=!1;let a=this._emptyDEMTexture;return a?a.update(s,{premultiply:!1}):a=this._emptyDEMTexture=new ks(e,s,n,{premultiply:!1}),a}setupElevationDraw(e,i,r){const n=this.painter.context,s=n.gl,a={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0};a.u_exaggeration=this.exaggeration();let c=null,p=null,_=1;if(r&&r.morphing&&this._useVertexMorphing){const C=r.morphing.srcDemTile,B=r.morphing.dstDemTile;_=r.morphing.phase,C&&B&&(this._prepareDemTileUniforms(e,C,a,"_prev")&&(p=C),this._prepareDemTileUniforms(e,B,a)&&(c=B))}const v=C=>C&&C.demTexture&&this.painter.linearFloatFilteringSupported()?s.LINEAR:s.NEAREST,E=C=>{a.u_dem_size=C.size[0]===1?1:C.size[0]-2};if(p&&c)n.activeTexture.set(s.TEXTURE2),c.demTexture.bind(v(c),s.CLAMP_TO_EDGE),n.activeTexture.set(s.TEXTURE4),p.demTexture.bind(v(p),s.CLAMP_TO_EDGE),c.demTexture&&E(c.demTexture),a.u_dem_lerp=_;else{c=this.terrainTileForTile[e.tileID.key],n.activeTexture.set(s.TEXTURE2);const C=this._prepareDemTileUniforms(e,c,a)?c.demTexture:this.emptyDEMTexture;C.bind(v(c),s.CLAMP_TO_EDGE),E(C)}if(n.activeTexture.set(s.TEXTURE3),r&&r.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(s.NEAREST,s.CLAMP_TO_EDGE),this._depthFBO&&(a.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(s.NEAREST,s.CLAMP_TO_EDGE),a.u_depth_size_inv=[1,1]),r&&r.useMeterToDem&&c){const C=(1<<c.tileID.canonical.z)*On(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;a.u_meter_to_dem=C}if(r&&r.labelPlaneMatrixInv&&(a.u_label_plane_matrix_inv=r.labelPlaneMatrixInv),i.setTerrainUniformValues(n,a),this.painter.transform.projection.name==="globe"){const C=this.globeUniformValues(this.painter.transform,e.tileID.canonical,r&&r.useDenormalizedUpVectorScale);i.setGlobeUniformValues(n,C)}}globeUniformValues(e,i,r){const n=e.projection;return{u_tile_tl_up:n.upVector(i,0,0),u_tile_tr_up:n.upVector(i,Mt,0),u_tile_br_up:n.upVector(i,Mt,Mt),u_tile_bl_up:n.upVector(i,0,Mt),u_tile_up_scale:r?hn(1):n.upVectorScale(i,e.center.lat,e.worldSize).metersToTile}}renderToBackBuffer(e){const i=this.painter,r=this.painter.context;e.length!==0&&(r.bindFramebuffer.set(null),r.viewport.set([0,0,i.width,i.height]),i.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(n,s,a,c,p){if(n.transform.projection.name==="globe")(function(_,v,E,C,B){const O=_.context,G=O.gl;let q,$;const J=_.transform,ie=rm(_,O,J),re=(Ye,Re)=>{if($===Re)return;const rt=[zb[Re],"PROJECTION_GLOBE_VIEW"];ie&&rt.push("CUSTOM_ANTIALIASING");const lt=_.isTileAffectedByFog(Ye);q=_.getOrCreateProgram("globeRaster",{defines:rt,overrideFog:lt}),$=Re},te=_.colorModeForRenderPass(),se=new cr(G.LEQUAL,cr.ReadWrite,_.depthRangeFor3D);pf.update(B);const he=tm(J),ve=[jo(J.center.lng),ea(J.center.lat)],be=_.globeSharedBuffers,Ce=[J.width*Xi.devicePixelRatio,J.height*Xi.devicePixelRatio],Ne=Float32Array.from(J.globeMatrix),je={useDenormalizedUpVectorScale:!0};{const Ye=_.transform,Re=Bb(Ye.zoom,v.exaggeration(),v.sourceCache._source.tileSize);$=-1;const rt=G.TRIANGLES;for(const lt of C){const vt=E.getTile(lt),it=Lr.disabled,at=v.prevTerrainTileForTile[lt.key],Tt=v.terrainTileForTile[lt.key];Pb(at,Tt)&&pf.newMorphing(lt.key,at,Tt,B,250),O.activeTexture.set(G.TEXTURE0),vt.texture&&vt.texture.bind(G.LINEAR,G.CLAMP_TO_EDGE);const It=pf.getMorphValuesForProxy(lt.key),St=It?1:0;It&&Ho(je,{morphing:{srcDemTile:It.from,dstDemTile:It.to,phase:es(It.phase)}});const Lt=hl(lt.canonical),Ot=K_(Lt.getCenter().lat),jt=nm(lt.canonical,Lt,Ot,Ye.worldSize/Ye._pixelsPerMercatorPixel),Dt=dl(lo(lt.canonical)),Kt=Db(Ye.expandedFarZProjMatrix,Ne,he,Dt,Uo(Ye.zoom),ve,Ye.frustumCorners.TL,Ye.frustumCorners.TR,Ye.frustumCorners.BR,Ye.frustumCorners.BL,Ye.globeCenterInViewSpace,Ye.globeRadius,Ce,Re,jt);if(re(lt,St),q&&(v.setupElevationDraw(vt,q,je),_.uploadCommonUniforms(O,q,lt.toUnwrapped()),be)){const[mi,_i,Ti]=be.getGridBuffers(Ot,Re!==0);q.draw(_,rt,se,it,te,Or.backCCW,Kt,"globe_raster",mi,_i,Ti)}}}if(be&&(_.renderDefaultNorthPole||_.renderDefaultSouthPole)){const Ye=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ie&&Ye.push("CUSTOM_ANTIALIASING"),q=_.getOrCreateProgram("globeRaster",{defines:Ye});for(const Re of C){const{x:rt,y:lt,z:vt}=Re.canonical,it=lt===0,at=lt===(1<<vt)-1,[Tt,It,St,Lt]=be.getPoleBuffers(vt,!1);if(Lt&&(it||at)){const Ot=E.getTile(Re);O.activeTexture.set(G.TEXTURE0),Ot.texture&&Ot.texture.bind(G.LINEAR,G.CLAMP_TO_EDGE);let jt=im(vt,rt,J);const Dt=dl(lo(Re.canonical)),Kt=(mi,_i)=>mi.draw(_,G.TRIANGLES,se,Lr.disabled,te,Or.disabled,Db(J.expandedFarZProjMatrix,jt,jt,Dt,0,ve,J.frustumCorners.TL,J.frustumCorners.TR,J.frustumCorners.BR,J.frustumCorners.BL,J.globeCenterInViewSpace,J.globeRadius,Ce,0),"globe_pole_raster",_i,St,Lt);v.setupElevationDraw(Ot,q,je),_.uploadCommonUniforms(O,q,Re.toUnwrapped()),it&&_.renderDefaultNorthPole&&Kt(q,Tt),at&&_.renderDefaultSouthPole&&(jt=ce.scale(ce.create(),jt,[1,-1,1]),Kt(q,It))}}}})(n,s,a,c,p);else{const _=n.context,v=_.gl;let E,C;const B=n.shadowRenderer,O=ff(n,n.longestCutoffRange),G=te=>{if(C===te)return;const se=[];se.push(zb[te]),O.shouldRenderCutoff&&se.push("RENDER_CUTOFF"),E=n.getOrCreateProgram("terrainRaster",{defines:se}),C=te},q=n.colorModeForRenderPass(),$=new cr(v.LEQUAL,cr.ReadWrite,n.depthRangeFor3D);pf.update(p);const J=n.transform,ie=Bb(J.zoom,s.exaggeration(),s.sourceCache._source.tileSize);let re=[0,0,0];if(B){const te=n.style.directionalLight,se=n.style.ambientLight;te&&se&&(re=yy(te,se))}{C=-1;const te=v.TRIANGLES,[se,he]=[s.gridIndexBuffer,s.gridSegments];for(const ve of c){const be=a.getTile(ve),Ce=Lr.disabled,Ne=s.prevTerrainTileForTile[ve.key],je=s.terrainTileForTile[ve.key];Pb(Ne,je)&&pf.newMorphing(ve.key,Ne,je,p,250),_.activeTexture.set(v.TEXTURE0),be.texture&&be.texture.bind(v.LINEAR,v.CLAMP_TO_EDGE);const Ye=pf.getMorphValuesForProxy(ve.key),Re=Ye?1:0;let rt;Ye&&(rt={morphing:{srcDemTile:Ye.from,dstDemTile:Ye.to,phase:es(Ye.phase)}});const lt=kb(ve.projMatrix,i4(ve.canonical,J.renderWorldCopies)?ie/10:ie,re);if(G(Re),!E)continue;s.setupElevationDraw(be,E,rt);const vt=ve.toUnwrapped();B&&B.setupShadows(vt,E),n.uploadCommonUniforms(_,E,vt,null,O),E.draw(n,te,$,Ce,q,Or.backCCW,lt,"terrain_raster",s.gridBuffer,se,he)}}}}(i,this,this.proxySourceCache,e,this._updateTimestamp),this.renderingToTexture=!0,i.gpuTimingDeferredRenderEnd(),e.splice(0,e.length))}renderBatch(e){if(this._drapedRenderBatches.length===0)return e+1;this.renderingToTexture=!0;const i=this.painter,r=this.painter.context,n=this.proxySourceCache,s=this.proxiedCoords[n.id],a=this._drapedRenderBatches.shift(),c=i.style.order,p=[];let _=0;for(const v of s){const E=n.getTileByID(v.proxyTileKey),C=n.proxyCachedFBO[v.key]?n.proxyCachedFBO[v.key][e]:void 0,B=C!==void 0?n.renderCache[C]:this.pool[_++],O=C!==void 0;if(E.texture=B.tex,O&&!B.dirty){p.push(E.tileID);continue}let G;r.bindFramebuffer.set(B.fb.framebuffer),this.renderedToTile=!1,B.dirty&&(r.clear({color:pr.transparent,stencil:0}),B.dirty=!1);for(let q=a.start;q<=a.end;++q){const $=i.style._mergedLayers[c[q]];if($.isHidden(i.transform.zoom))continue;const J=i.style.getLayerSourceCache($),ie=J?this.proxyToSource[v.key][J.id]:[v];if(!ie)continue;const re=ie;r.viewport.set([0,0,B.fb.width,B.fb.height]),G!==(J?J.id:null)&&(this._setupStencil(B,ie,$,J),G=J?J.id:null),i.renderLayer(i,J,$,re)}if(this._drapedRenderBatches.length===0)for(const q of this._pendingGroundEffectLayers){const $=i.style._mergedLayers[c[q]];if($.isHidden(i.transform.zoom))continue;const J=i.style.getLayerSourceCache($),ie=J?this.proxyToSource[v.key][J.id]:[v];if(!ie)continue;const re=ie;r.viewport.set([0,0,B.fb.width,B.fb.height]),G!==(J?J.id:null)&&(this._setupStencil(B,ie,$,J),G=J?J.id:null),i.renderLayer(i,J,$,re)}this.renderedToTile?(B.dirty=!0,p.push(E.tileID)):O||--_,_===5&&(_=0,this.renderToBackBuffer(p))}return this.renderToBackBuffer(p),this.renderingToTexture=!1,r.bindFramebuffer.set(null),r.viewport.set([0,0,i.width,i.height]),a.end+1}postRender(){}isLayerOrderingCorrect(e){const i=e.order.length;let r=-1,n=i;for(let s=0;s<i;++s)this._style.isLayerDraped(e._mergedLayers[e.order[s]])?r=Math.max(r,s):n=Math.min(n,s);return n>r}getMinElevationBelowMSL(){let e=0;return this._visibleDemTiles.filter(i=>i.dem).forEach(i=>{e=Math.min(e,i.dem.tree.minimums[0])}),e===0?e:(e-30)*this._exaggeration}raycast(e,i,r){if(!this._visibleDemTiles)return null;const n=this._visibleDemTiles.filter(s=>s.dem).map(s=>{const a=s.tileID,c=1<<a.overscaledZ,{x:p,y:_}=a.canonical,v=p/c,E=(p+1)/c,C=_/c,B=(_+1)/c;return{minx:v,miny:C,maxx:E,maxy:B,t:s.dem.tree.raycastRoot(v,C,E,B,e,i,r),tile:s}});n.sort((s,a)=>(s.t!==null?s.t:Number.MAX_VALUE)-(a.t!==null?a.t:Number.MAX_VALUE));for(const s of n){if(s.t==null)return null;const a=s.tile.dem.tree.raycast(s.minx,s.miny,s.maxx,s.maxy,e,i,r);if(a!=null)return a}return null}_createFBO(){const e=this.painter.context,i=e.gl,r=this.drapeBufferSize;e.activeTexture.set(i.TEXTURE0);const n=new ks(e,{width:r[0],height:r[1],data:null},i.RGBA);n.bind(i.LINEAR,i.CLAMP_TO_EDGE);const s=e.createFramebuffer(r[0],r[1],!0,null);return s.colorAttachment.set(n.texture),s.depthAttachment=new hE(e,s.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=e.createRenderbuffer(e.gl.DEPTH_STENCIL,r[0],r[1]),this._stencilRef=0,s.depthAttachment.set(this._sharedDepthStencil),e.clear({stencil:0})):s.depthAttachment.set(this._sharedDepthStencil),e.extTextureFilterAnisotropic&&i.texParameterf(i.TEXTURE_2D,e.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,e.extTextureFilterAnisotropicMax),{fb:s,tex:n,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.hasLightTransitions())return!0;for(const e in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[e].hasTransition())return!0;return this._style.order.some(e=>{const i=this._style._mergedLayers[e],r=i.isHidden(this.painter.transform.zoom);return i.type==="custom"?!r&&i.shouldRedrape():!r&&i.hasTransition()})}_clearLineLayersFromRenderCache(){let e=!1;for(const r of this._style.getSources())if(r instanceof Hv){e=!0;break}if(!e)return;const i={};for(let r=0;r<this._style.order.length;++r){const n=this._style._mergedLayers[this._style.order[r]],s=this._style.getLayerSourceCache(n);if(s&&!i[s.id]&&!n.isHidden(this.painter.transform.zoom)&&n.type==="line"&&n.widthExpression()instanceof kn){i[s.id]=!0;for(const a of this.proxyCoords){const c=this.proxyToSource[a.key][s.id];if(c)for(const p of c)this._clearRenderCacheForTile(s.id,p)}}}}_clearRasterLayersFromRenderCache(){let e=!1;for(const r in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[r]._source instanceof $g){e=!0;break}if(!e)return;const i={};for(let r=0;r<this._style.order.length;++r){const n=this._style._mergedLayers[this._style.order[r]],s=this._style.getLayerSourceCache(n);if(!s||i[s.id]||n.isHidden(this.painter.transform.zoom)||n.type!=="raster")continue;const a=n.paint.get("raster-fade-duration");for(const c of this.proxyCoords){const p=this.proxyToSource[c.key][s.id];if(p)for(const _ of p){const v=Lb(s.getTile(_),s.findLoadedParent(_,0),s,this.painter.transform,a);(v.opacity!==1||v.mix!==0)&&this._clearRenderCacheForTile(s.id,_)}}}}_setupDrapedRenderBatches(){const e=this._style.order,i=e.length;if(i===0)return;const r=[];this._pendingGroundEffectLayers=[];let n,s=0,a=this._style._mergedLayers[e[s]];for(;!this._style.isLayerDraped(a)&&a.isHidden(this.painter.transform.zoom)&&++s<i;)a=this._style._mergedLayers[e[s]];for(;s<i;++s){const c=this._style._mergedLayers[e[s]];c.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(c)?n===void 0&&(n=s):(c.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(s),n!==void 0&&(r.push({start:n,end:s-1}),n=void 0)))}if(n!==void 0&&r.push({start:n,end:s-1}),r.length!==0){const c=r[r.length-1];this._pendingGroundEffectLayers.every(_=>_>c.end)||Pe("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=r}_setupRenderCache(e){const i=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,i.renderCache.length>i.renderCachePool.length){const a=Object.values(i.proxyCachedFBO);i.proxyCachedFBO={};for(let c=0;c<a.length;++c){const p=Object.values(a[c]);i.renderCachePool.push(...p)}}return}this._clearRasterLayersFromRenderCache();const r=this.proxyCoords,n=this._tilesDirty;for(let a=r.length-1;a>=0;a--){const c=r[a];if(i.getTileByID(c.key),i.proxyCachedFBO[c.key]!==void 0){const p=e[c.key],_=this.proxyToSource[c.key];let v=0;for(const E in _){const C=_[E],B=p[E];if(!B||B.length!==C.length||C.some((O,G)=>O!==B[G]||n[E]&&n[E].hasOwnProperty(O.key))){v=-1;break}++v}for(const E in i.proxyCachedFBO[c.key])i.renderCache[i.proxyCachedFBO[c.key][E]].dirty=v<0||v!==Object.values(p).length}}const s=[...this._drapedRenderBatches];s.sort((a,c)=>c.end-c.start-(a.end-a.start));for(const a of s)for(const c of r){if(i.proxyCachedFBO[c.key])continue;let p=i.renderCachePool.pop();p===void 0&&i.renderCache.length<50&&(p=i.renderCache.length,i.renderCache.push(this._createFBO())),p!==void 0&&(i.proxyCachedFBO[c.key]={},i.proxyCachedFBO[c.key][a.start]=p,i.renderCache[p].dirty=!0)}this._tilesDirty={}}_setupStencil(e,i,r,n){if(!n||!this._sourceTilesOverlap[n.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const s=this.painter.context,a=s.gl;if(i.length<=1)return void(this._overlapStencilType=!1);let c;if(r.isTileClipped())c=i.length,this._overlapStencilMode.test={func:a.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(i[0].overscaledZ>i[i.length-1].overscaledZ))return void(this._overlapStencilType=!1);c=1,this._overlapStencilMode.test={func:a.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+c>255&&(s.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=c,this._overlapStencilMode.ref=this._stencilRef,r.isTileClipped()&&this._renderTileClippingMasks(i,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(e){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[e.key]),this._overlapStencilMode):Lr.disabled}_renderTileClippingMasks(e,i){const r=this.painter,n=this.painter.context,s=n.gl;r._tileClippingMaskIDs={},n.setColorMode(dn.disabled),n.setDepthMode(cr.disabled);const a=r.getOrCreateProgram("clippingMask");for(const c of e){const p=r._tileClippingMaskIDs[c.key]=--i;a.draw(r,s.TRIANGLES,cr.disabled,new Lr({func:s.ALWAYS,mask:0},p,255,s.KEEP,s.KEEP,s.REPLACE),dn.disabled,Or.disabled,fy(c.projMatrix),"$clipping",r.tileExtentBuffer,r.quadTriangleIndexBuffer,r.tileExtentSegments)}}pointCoordinate(e){const i=this.painter.transform;if(e.x<0||e.x>i.width||e.y<0||e.y>i.height)return null;const r=[e.x,e.y,1,1];U.transformMat4(r,r,i.pixelMatrixInverse),U.scale(r,r,1/r[3]),r[0]/=i.worldSize,r[1]/=i.worldSize;const n=i._camera.position,s=On(1,i.center.lat),a=[n[0],n[1],n[2]/s,0],c=_e.subtract([],r.slice(0,3),a);_e.normalize(c,c);const p=this.raycast(a,c,this._exaggeration);return p!==null&&p?(_e.scaleAndAdd(a,a,c,p),a[3]=a[2],a[2]*=s,a):null}drawDepth(){const e=this.painter,i=e.context,r=this.proxySourceCache,n=Math.ceil(e.width),s=Math.ceil(e.height);if(!this._depthFBO||this._depthFBO.width===n&&this._depthFBO.height===s||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const a=i.gl,c=i.createFramebuffer(n,s,!0,"renderbuffer");i.activeTexture.set(a.TEXTURE0);const p=new ks(i,{width:n,height:s,data:null},a.RGBA);p.bind(a.NEAREST,a.CLAMP_TO_EDGE),c.colorAttachment.set(p.texture);const _=i.createRenderbuffer(i.gl.DEPTH_COMPONENT16,n,s);c.depthAttachment.set(_),this._depthFBO=c,this._depthTexture=p}i.bindFramebuffer.set(this._depthFBO.framebuffer),i.viewport.set([0,0,n,s]),function(a,c,p,_){if(a.transform.projection.name==="globe")return;const v=a.context,E=v.gl;v.clear({depth:1});const C=a.getOrCreateProgram("terrainDepth"),B=new cr(E.LESS,cr.ReadWrite,a.depthRangeFor3D);for(const O of _){const G=p.getTile(O),q=kb(O.projMatrix,0,[0,0,0]);c.setupElevationDraw(G,C),C.draw(a,E.TRIANGLES,B,Lr.disabled,dn.unblended,Or.backCCW,q,"terrain_depth",c.gridBuffer,c.gridIndexBuffer,c.gridNoSkirtSegments)}}(e,this,r,this.proxyCoords)}_setupProxiedCoordsForOrtho(e,i,r){if(e.getSource()instanceof xc)return this._setupProxiedCoordsForImageSource(e,i,r);this._findCoveringTileCache[e.id]=this._findCoveringTileCache[e.id]||{};const n=this.proxiedCoords[e.id]=[],s=this.proxyCoords;for(let c=0;c<s.length;c++){const p=s[c],_=this._findTileCoveringTileID(p,e);if(_){const v=this._createProxiedId(p,_,r[p.key]&&r[p.key][e.id]);n.push(v),this.proxyToSource[p.key][e.id]=[v]}}let a=!1;for(let c=0;c<i.length;c++){const p=e.getTile(i[c]);if(!p||!p.hasData())continue;const _=this._findTileCoveringTileID(p.tileID,this.proxySourceCache);if(_&&_.tileID.canonical.z!==p.tileID.canonical.z){const v=this.proxyToSource[_.tileID.key][e.id],E=this._createProxiedId(_.tileID,p,r[_.tileID.key]&&r[_.tileID.key][e.id]);v?v.splice(v.length-1,0,E):this.proxyToSource[_.tileID.key][e.id]=[E],n.push(E),a=!0}}this._sourceTilesOverlap[e.id]=a}_setupProxiedCoordsForImageSource(e,i,r){if(!e.getSource().loaded())return;const n=this.proxiedCoords[e.id]=[],s=this.proxyCoords,a=e.getSource(),c=a.tileID;if(!c)return;const p=new At(c.x,c.y)._div(1<<c.z),_=a.coordinates.map(Xr.fromLngLat).reduce((E,C)=>(E.min.x=Math.min(E.min.x,C.x-p.x),E.min.y=Math.min(E.min.y,C.y-p.y),E.max.x=Math.max(E.max.x,C.x-p.x),E.max.y=Math.max(E.max.y,C.y-p.y),E),{min:new At(Number.MAX_VALUE,Number.MAX_VALUE),max:new At(-Number.MAX_VALUE,-Number.MAX_VALUE)}),v=(E,C)=>{const B=E.wrap+E.canonical.x/(1<<E.canonical.z),O=E.canonical.y/(1<<E.canonical.z),G=Mt/(1<<E.canonical.z),q=C.wrap+C.canonical.x/(1<<C.canonical.z),$=C.canonical.y/(1<<C.canonical.z);return B+G<q+_.min.x||B>q+_.max.x||O+G<$+_.min.y||O>$+_.max.y};for(let E=0;E<s.length;E++){const C=s[E];for(let B=0;B<i.length;B++){const O=e.getTile(i[B]);if(!O||!O.hasData()||v(C,O.tileID))continue;const G=this._createProxiedId(C,O,r[C.key]&&r[C.key][e.id]),q=this.proxyToSource[C.key][e.id];q?q.push(G):this.proxyToSource[C.key][e.id]=[G],n.push(G)}}}_createProxiedId(e,i,r){let n=this.orthoMatrix;if(r){const s=r.find(a=>a.key===i.tileID.key);if(s)return s}if(i.tileID.key!==e.key){const s=e.canonical.z-i.tileID.canonical.z;let a,c,p;n=ce.create();const _=i.tileID.wrap-e.wrap<<e.overscaledZ;s>0?(a=Mt>>s,c=a*((i.tileID.canonical.x<<s)-e.canonical.x+_),p=a*((i.tileID.canonical.y<<s)-e.canonical.y)):(a=Mt<<-s,c=Mt*(i.tileID.canonical.x-(e.canonical.x+_<<-s)),p=Mt*(i.tileID.canonical.y-(e.canonical.y<<-s))),ce.ortho(n,0,a,0,a,0,1),ce.translate(n,n,[c,p,0])}return new Rb(i.tileID,e.key,n)}_findTileCoveringTileID(e,i){let r=i.getTile(e);if(r&&r.hasData())return r;const n=this._findCoveringTileCache[i.id],s=n[e.key];if(r=s?i.getTileByID(s):null,r&&r.hasData()||s===null)return r;let a=r?r.tileID:e,c=a.overscaledZ;const p=i.getSource().minzoom,_=[];if(!s){const E=i.getSource().maxzoom;if(e.canonical.z>=E){const C=e.canonical.z-E;i.getSource().reparseOverscaled?(c=Math.max(e.canonical.z+2,i.transform.tileZoom),a=new fi(c,e.wrap,E,e.canonical.x>>C,e.canonical.y>>C)):C!==0&&(c=E,a=new fi(c,e.wrap,E,e.canonical.x>>C,e.canonical.y>>C))}a.key!==e.key&&(_.push(a.key),r=i.getTile(a))}const v=E=>{_.forEach(C=>{n[C]=E}),_.length=0};for(c-=1;c>=p&&(!r||!r.hasData());c--){r&&v(r.tileID.key);const E=a.calculateScaledKey(c);if(r=i.getTileByID(E),r&&r.hasData())break;const C=n[E];if(C===null)break;C===void 0?_.push(E):r=i.getTileByID(C)}return v(r?r.tileID.key:null),r&&r.hasData()?r:null}findDEMTileFor(e){return this.enabled?this._findTileCoveringTileID(e,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(e,i){let r=this._tilesDirty[e];r||(r=this._tilesDirty[e]={}),r[i.key]=!0}}function o4(t,e,i){const r=function(c,p,_){const v=_e.dot(p,c),E=_e.dot(_,[.2126,.7152,.0722]),C=(O,G,q)=>(1-q)*O+q*G,B=C(1-.3*Math.min(E,1),1,Math.min(v+1,1));return C(.92,1,Math.asin(hi(p[2],-1,1))/Math.PI+.5)*B}(t,[0,0,1],e),n=[0,0,0];_e.scale(n,i.slice(0,3),r);const s=[0,0,0];_e.scale(s,e.slice(0,3),t[2]);const a=[0,0,0];return _e.add(a,n,s),gn(a)}const a4=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],l4=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class Fb{static cacheKey(e,i,r,n){let s=`${i}${n?n.cacheKey:""}`;for(const a of r)e.usedDefines.includes(a)&&(s+=`/${a}`);return s}constructor(e,i,r,n,s,a){const c=e.gl;this.program=c.createProgram(),this.configuration=n,this.name=i,this.fixedDefines=[...a];const p=n?n.getBinderAttributes():[],_=(r.staticAttributes||[]).concat(p);let v=n?n.defines():[];v=v.concat(a.map(q=>`#define ${q}`));const E=`#version 300 es
`;let C=E+v.concat("precision mediump float;",Mb,Eb.fragmentSource).join(`
`);for(const q of r.fragmentIncludes)C+=`
${a_[q]}`;C+=`
${r.fragmentSource}`;let B=E+v.concat("precision highp float;",Mb,Eb.vertexSource).join(`
`);for(const q of r.vertexIncludes)B+=`
${a_[q]}`;B+=`
${r.vertexSource}`;const O=c.createShader(c.FRAGMENT_SHADER);if(c.isContextLost())return void(this.failedToCreate=!0);c.shaderSource(O,C),c.compileShader(O),c.attachShader(this.program,O);const G=c.createShader(c.VERTEX_SHADER);if(c.isContextLost())this.failedToCreate=!0;else{c.shaderSource(G,B),c.compileShader(G),c.attachShader(this.program,G),this.attributes={},this.numAttributes=_.length;for(let q=0;q<this.numAttributes;q++)if(_[q]){const $=_[q].startsWith("a_")?_[q]:`a_${_[q]}`;c.bindAttribLocation(this.program,q,$),this.attributes[$]=q}c.linkProgram(this.program),c.deleteShader(G),c.deleteShader(O),this.fixedUniforms=s(e),this.binderUniforms=n?n.getUniforms(e):[],a.includes("TERRAIN")&&(this.terrainUniforms=(q=>({u_dem:new Ni(q),u_dem_prev:new Ni(q),u_dem_tl:new zr(q),u_dem_scale:new ii(q),u_dem_tl_prev:new zr(q),u_dem_scale_prev:new ii(q),u_dem_size:new ii(q),u_dem_lerp:new ii(q),u_exaggeration:new ii(q),u_depth:new Ni(q),u_depth_size_inv:new zr(q),u_meter_to_dem:new ii(q),u_label_plane_matrix_inv:new xr(q)}))(e)),a.includes("GLOBE")&&(this.globeUniforms=(q=>({u_tile_tl_up:new Tr(q),u_tile_tr_up:new Tr(q),u_tile_br_up:new Tr(q),u_tile_bl_up:new Tr(q),u_tile_up_scale:new ii(q)}))(e)),a.includes("FOG")&&(this.fogUniforms=(q=>({u_fog_matrix:new xr(q),u_fog_range:new zr(q),u_fog_color:new Mo(q),u_fog_horizon_blend:new ii(q),u_fog_vertical_limit:new zr(q),u_fog_temporal_offset:new ii(q),u_frustum_tl:new Tr(q),u_frustum_tr:new Tr(q),u_frustum_br:new Tr(q),u_frustum_bl:new Tr(q),u_globe_pos:new Tr(q),u_globe_radius:new ii(q),u_globe_transition:new ii(q),u_is_globe:new Ni(q),u_viewport:new zr(q)}))(e)),a.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(q=>({u_cutoff_params:new Mo(q)}))(e)),a.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(q=>({u_lighting_ambient_color:new Tr(q),u_lighting_directional_dir:new Tr(q),u_lighting_directional_color:new Tr(q),u_ground_radiance:new Tr(q)}))(e)),a.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(q=>({u_light_matrix_0:new xr(q),u_light_matrix_1:new xr(q),u_fade_range:new zr(q),u_shadow_normal_offset:new Tr(q),u_shadow_intensity:new ii(q),u_shadow_texel_size:new ii(q),u_shadow_map_resolution:new ii(q),u_shadow_direction:new Tr(q),u_shadow_bias:new Tr(q),u_shadowmap_0:new Ni(q),u_shadowmap_1:new Ni(q)}))(e))}}setTerrainUniformValues(e,i){if(!this.terrainUniforms)return;const r=this.terrainUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const n in i)r[n]&&r[n].set(this.program,n,i[n])}}setGlobeUniformValues(e,i){if(!this.globeUniforms)return;const r=this.globeUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const n in i)r[n]&&r[n].set(this.program,n,i[n])}}setFogUniformValues(e,i){if(!this.fogUniforms)return;const r=this.fogUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const n in i)r[n].set(this.program,n,i[n])}}setCutoffUniformValues(e,i){if(!this.cutoffUniforms)return;const r=this.cutoffUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const n in i)r[n].set(this.program,n,i[n])}}setLightsUniformValues(e,i){if(!this.lightsUniforms)return;const r=this.lightsUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const n in i)r[n].set(this.program,n,i[n])}}setShadowUniformValues(e,i){if(this.failedToCreate||!this.shadowUniforms)return;const r=this.shadowUniforms;e.program.set(this.program);for(const n in i)r[n].set(this.program,n,i[n])}_drawDebugWireframe(e,i,r,n,s,a,c,p,_,v){const E=e.options.wireframe;if(E.terrain===!1&&E.layers2D===!1&&E.layers3D===!1)return;const C=e.context;if(!(!(!E.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!E.layers2D||e._terrain&&e._terrain.renderingToTexture||!a4.includes(this.name))||!(!E.layers3D||!l4.includes(this.name))))return;const B=C.gl,O=e.wireframeDebugCache.getLinesFromTrianglesBuffer(e.frameCounter,s,C);if(!O)return;const G=[...this.fixedDefines];G.push("DEBUG_WIREFRAME");const q=e.getOrCreateProgram(this.name,{config:this.configuration,defines:G});C.program.set(q.program);const $=(re,te,se)=>{if(te[re]&&se[re])for(const he in te[re])se[re][he]&&se[re][he].set(se.program,he,te[re][he].current)};_&&_.setUniforms(q.program,C,q.binderUniforms,c,{zoom:p}),$("fixedUniforms",this,q),$("terrainUniforms",this,q),$("globeUniforms",this,q),$("fogUniforms",this,q),$("lightsUniforms",this,q),$("shadowUniforms",this,q),O.bind(),C.setColorMode(new dn([B.ONE,B.ONE_MINUS_SRC_ALPHA,B.ZERO,B.ONE],pr.transparent,[!0,!0,!0,!1])),C.setDepthMode(new cr(i.func===B.LESS?B.LEQUAL:i.func,cr.ReadOnly,i.range)),C.setStencilMode(Lr.disabled);const J=3*a.primitiveLength*2,ie=3*a.primitiveOffset*2*2;v&&v>1?B.drawElementsInstanced(B.LINES,J,B.UNSIGNED_SHORT,ie,v):B.drawElements(B.LINES,J,B.UNSIGNED_SHORT,ie),s.bind(),C.program.set(this.program),C.setDepthMode(i),C.setStencilMode(r),C.setColorMode(n)}draw(e,i,r,n,s,a,c,p,_,v,E,C,B,O,G,q){const $=e.context,J=$.gl;if(this.failedToCreate)return;$.program.set(this.program),$.setDepthMode(r),$.setStencilMode(n),$.setColorMode(s),$.setCullFace(a);for(const te of Object.keys(this.fixedUniforms))this.fixedUniforms[te].set(this.program,te,c[te]);O&&O.setUniforms(this.program,$,this.binderUniforms,C,{zoom:B});const ie={[J.LINES]:2,[J.TRIANGLES]:3,[J.LINE_STRIP]:1}[i],re=q&&q>0?1:void 0;for(const te of E.get()){const se=te.vaos||(te.vaos={});(se[p]||(se[p]=new KM)).bind($,this,_,O?O.getPaintVertexBuffers():[],v,te.vertexOffset,G||[],re),q&&q>1?J.drawElementsInstanced(i,te.primitiveLength*ie,J.UNSIGNED_SHORT,te.primitiveOffset*ie*2,q):J.drawElements(i,te.primitiveLength*ie,J.UNSIGNED_SHORT,te.primitiveOffset*ie*2),i===J.TRIANGLES&&this._drawDebugWireframe(e,r,n,s,v,te,C,B,O,q)}}}function Ob(t,e){const i=Math.pow(2,e.tileID.overscaledZ),r=e.tileSize*Math.pow(2,t.transform.tileZoom)/i,n=r*(e.tileID.canonical.x+e.tileID.wrap*i),s=r*e.tileID.canonical.y;return{u_image:0,u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/Xh(e,1,t.transform.tileZoom),u_pixel_coord_upper:[n>>16,s>>16],u_pixel_coord_lower:[65535&n,65535&s]}}const A4=ce.create(),Vb=(t,e,i,r,n,s,a,c,p,_,v,E,C,B,O,G)=>{const q=e.style.light,$=q.properties.get("position"),J=[$.x,$.y,$.z],ie=Ee.create();q.properties.get("anchor")==="viewport"&&(Ee.fromRotation(ie,-e.transform.angle),_e.transformMat3(J,J,ie));const re=q.properties.get("color"),te=e.transform,se={u_matrix:t,u_lightpos:J,u_lightintensity:q.properties.get("intensity"),u_lightcolor:[re.r,re.g,re.b],u_vertical_gradient:+i,u_opacity:r,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:A4,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:n,u_edge_radius:s,u_flood_light_color:E,u_vertical_scale:C,u_flood_light_intensity:B,u_ground_shadow_factor:O,u_emissive_strength:G};return te.projection.name==="globe"&&(se.u_tile_id=[a.canonical.x,a.canonical.y,1<<a.canonical.z],se.u_zoom_transition=p,se.u_inv_rot_matrix=v,se.u_merc_center=_,se.u_up_dir=te.projection.upVector(new ci(0,0,0),_[0]*Mt,_[1]*Mt),se.u_height_lift=c),se},c4=(t,e,i)=>({u_matrix:t,u_edge_radius:e,u_vertical_scale:i}),u4=(t,e,i,r,n,s,a,c,p,_,v,E,C,B)=>{const O=Vb(t,e,i,r,n,s,a,p,_,v,E,C,B,1,[0,0,0],0),G={u_height_factor:-Math.pow(2,a.overscaledZ)/c.tileSize/8};return zt(O,Ob(e,c),G)},Nb=(t,e)=>({u_matrix:t,u_emissive_strength:e}),Ub=(t,e,i,r)=>zt(Nb(t,e),Ob(i,r)),h4=(t,e,i)=>({u_matrix:t,u_world:i,u_emissive_strength:e}),d4=(t,e,i,r,n)=>zt(Ub(t,e,i,r),{u_world:n}),f4=(t,e,i,r)=>{const n=Mt/i.tileSize;return{u_matrix:t,u_camera_to_center_distance:e.getCameraToCenterDistance(r),u_extrude_scale:[e.pixelsToGLUnits[0]/n,e.pixelsToGLUnits[1]/n]}},jb=(t,e,i=1)=>({u_matrix:t,u_color:e,u_overlay:0,u_overlay_scale:i}),p4=ce.create(),m4=(t,e,i,r,n,s,a)=>{const c=t.transform,p=c.projection.name==="globe",_=p?Jp(c.zoom,e.canonical)*c._pixelsPerMercatorPixel:Xh(i,1,s),v={u_matrix:e.projMatrix,u_extrude_scale:_,u_intensity:a,u_inv_rot_matrix:p4,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(p){v.u_inv_rot_matrix=r,v.u_merc_center=n,v.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],v.u_zoom_transition=Uo(c.zoom);const E=n[0]*Mt,C=n[1]*Mt;v.u_up_dir=c.projection.upVector(new ci(0,0,0),E,C)}return v},Gb=(t,e,i,r,n,s,a,c,p,_,v,E,C,B,O,G,q,$,J,ie,re,te)=>{return{u_matrix:t,u_normalize_matrix:e,u_globe_matrix:i,u_merc_matrix:r,u_grid_matrix:n,u_tl_parent:s,u_scale_parent:v,u_fade_t:E.mix,u_opacity:E.opacity*C.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:C.paint.get("raster-brightness-min"),u_brightness_high:C.paint.get("raster-brightness-max"),u_saturation_factor:(he=C.paint.get("raster-saturation"),he>0?1-1/(1.001-he):-he),u_contrast_factor:(se=C.paint.get("raster-contrast"),se>0?1/(1-se):1+se),u_spin_weights:_4(C.paint.get("raster-hue-rotate")),u_perspective_transform:B,u_raster_elevation:O,u_tl_br:a,u_zoom_transition:c,u_merc_center:p,u_cutoff_params:_,u_colorization_mix:g4(q,J),u_colorization_offset:y4($,J),u_color_ramp:G,u_texture_offset:[re/(ie+2*re),ie/(ie+2*re)],u_texture_res:[ie+2*re,ie+2*re],u_emissive_strength:te};var se,he};function _4(t){t*=Math.PI/180;const e=Math.sin(t),i=Math.cos(t);return[(2*i+1)/3,(-Math.sqrt(3)*e-i+1)/3,(Math.sqrt(3)*e-i+1)/3]}function g4([t,e,i,r],[n,s]){if(n===s)return[0,0,0,0];const a=259/257/(s-n);return[t*a,e*a,i*a,r*a]}function y4(t,[e,i]){return e===i?0:((t-e)/(i-e)*259-1)/257}const Zb=ce.create(),qb=(t,e,i,r,n,s,a,c,p,_,v,E,C,B,O,G,q,$)=>{const J=n.transform,ie={u_is_size_zoom_constant:+(t==="constant"||t==="source"),u_is_size_feature_constant:+(t==="constant"||t==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:J.getCameraToCenterDistance(G),u_rotate_symbol:+i,u_aspect_ratio:J.width/J.height,u_fade_change:n.options.fadeDuration?n.symbolFadeChange:1,u_matrix:s,u_label_plane_matrix:a,u_coord_matrix:c,u_is_text:+p,u_pitch_with_map:+r,u_texsize:_,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Zb,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Zb,u_up_vector:[0,-1,0],u_icon_transition:$||0,u_icon_saturation:q};return G.name==="globe"&&(ie.u_tile_id=[v.canonical.x,v.canonical.y,1<<v.canonical.z],ie.u_zoom_transition=E,ie.u_inv_rot_matrix=B,ie.u_merc_center=C,ie.u_camera_forward=J._camera.forward(),ie.u_ecef_origin=function(re,te){const se=[0,0,0],he=dl(lo(te.canonical));return _e.transformMat4(se,se,he),_e.transformMat4(se,se,re),se}(J.globeMatrix,v.toUnwrapped()),ie.u_tile_matrix=Float32Array.from(J.globeMatrix),ie.u_up_vector=O),ie},Qb=(t,e,i,r,n,s,a,c,p,_,v,E,C,B,O,G,q)=>zt(qb(t,e,i,r,n,s,a,c,p,_,E,C,B,O,G,q,1),{u_gamma_scale:r?n.transform.getCameraToCenterDistance(q)*Math.cos(n.terrain?0:n.transform._pitch):1,u_device_pixel_ratio:Xi.devicePixelRatio,u_is_halo:+v,undefined:void 0}),x4=(t,e,i,r,n,s,a,c,p,_,v,E,C,B,O,G)=>zt(Qb(t,e,i,r,n,s,a,c,!0,p,!0,v,E,C,B,O,G),{u_texsize_icon:_,u_texture_icon:1}),v4=(t,e,i,r)=>({u_matrix:t,u_emissive_strength:e,u_opacity:i,u_color:r}),b4=(t,e,i,r,n,s,a)=>zt(function(c,p,_,v){const E=_.imageManager.getPattern(c.toString(),p),{width:C,height:B}=_.imageManager.getPixelSize(p),O=Math.pow(2,v.tileID.overscaledZ),G=v.tileSize*Math.pow(2,_.transform.tileZoom)/O,q=G*(v.tileID.canonical.x+v.tileID.wrap*O),$=G*v.tileID.canonical.y;return{u_image:0,u_pattern_tl:E.tl,u_pattern_br:E.br,u_texsize:[C,B],u_pattern_size:E.displaySize,u_tile_units_to_pixels:1/Xh(v,1,_.transform.tileZoom),u_pixel_coord_upper:[q>>16,$>>16],u_pixel_coord_lower:[65535&q,65535&$]}}(n,s,r,a),{u_matrix:t,u_emissive_strength:e,u_opacity:i}),MA={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,ShadowMap0:10},py=(t,e,i,r,n,s,a,c,p,_,v,E,C=[0,0,0])=>{const B=r.style.light,O=B.properties.get("position"),G=[-O.x,-O.y,O.z],q=Ee.create();B.properties.get("anchor")==="viewport"&&(Ee.fromRotation(q,-r.transform.angle),_e.transformMat3(G,G,q));const $=_.alphaMode==="MASK",J=B.properties.get("color"),ie=E.paint.get("model-ambient-occlusion-intensity"),re=E.paint.get("model-color").constantOr(pr.white),te=E.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:t,u_lighting_matrix:e,u_normal_matrix:i,u_lightpos:G,u_lightintensity:B.properties.get("intensity"),u_lightcolor:[J.r,J.g,J.b],u_camera_pos:C,u_opacity:n,u_baseTextureIsAlpha:0,u_alphaMask:+$,u_alphaCutoff:_.alphaCutoff,u_baseColorFactor:[s.r,s.g,s.b,s.a],u_emissiveFactor:[a[0],a[1],a[2],1],u_metallicFactor:c,u_roughnessFactor:p,u_baseColorTexture:MA.BaseColor,u_metallicRoughnessTexture:MA.MetallicRoughness,u_normalTexture:MA.Normal,u_occlusionTexture:MA.Occlusion,u_emissionTexture:MA.Emission,u_color_mix:[re.r,re.g,re.b,te],u_aoIntensity:ie,u_emissive_strength:v}},Hb=new Float32Array(16),Wb=(t,e=Hb,i=Hb)=>({u_matrix:t,u_instance:e,u_node_matrix:i}),w4={fillExtrusion:t=>({u_matrix:new xr(t),u_lightpos:new Tr(t),u_lightintensity:new ii(t),u_lightcolor:new Tr(t),u_vertical_gradient:new ii(t),u_opacity:new ii(t),u_edge_radius:new ii(t),u_ao:new zr(t),u_tile_id:new Tr(t),u_zoom_transition:new ii(t),u_inv_rot_matrix:new xr(t),u_merc_center:new zr(t),u_up_dir:new Tr(t),u_height_lift:new ii(t),u_flood_light_color:new Tr(t),u_vertical_scale:new ii(t),u_flood_light_intensity:new ii(t),u_ground_shadow_factor:new Tr(t),u_emissive_strength:new ii(t)}),fillExtrusionDepth:t=>({u_matrix:new xr(t),u_edge_radius:new ii(t),u_vertical_scale:new ii(t)}),fillExtrusionPattern:t=>({u_matrix:new xr(t),u_lightpos:new Tr(t),u_lightintensity:new ii(t),u_lightcolor:new Tr(t),u_vertical_gradient:new ii(t),u_height_factor:new ii(t),u_edge_radius:new ii(t),u_ao:new zr(t),u_tile_id:new Tr(t),u_zoom_transition:new ii(t),u_inv_rot_matrix:new xr(t),u_merc_center:new zr(t),u_up_dir:new Tr(t),u_height_lift:new ii(t),u_image:new Ni(t),u_texsize:new zr(t),u_pixel_coord_upper:new zr(t),u_pixel_coord_lower:new zr(t),u_tile_units_to_pixels:new ii(t),u_opacity:new ii(t)}),fillExtrusionGroundEffect:t=>({u_matrix:new xr(t),u_opacity:new ii(t),u_ao_pass:new ii(t),u_meter_to_tile:new ii(t),u_ao:new zr(t),u_flood_light_intensity:new ii(t),u_flood_light_color:new Tr(t),u_attenuation:new ii(t),u_edge_radius:new ii(t),u_fb:new Ni(t),u_fb_size:new ii(t)}),fill:t=>({u_matrix:new xr(t),u_emissive_strength:new ii(t)}),fillPattern:t=>({u_matrix:new xr(t),u_emissive_strength:new ii(t),u_image:new Ni(t),u_texsize:new zr(t),u_pixel_coord_upper:new zr(t),u_pixel_coord_lower:new zr(t),u_tile_units_to_pixels:new ii(t)}),fillOutline:t=>({u_matrix:new xr(t),u_emissive_strength:new ii(t),u_world:new zr(t)}),fillOutlinePattern:t=>({u_matrix:new xr(t),u_emissive_strength:new ii(t),u_world:new zr(t),u_image:new Ni(t),u_texsize:new zr(t),u_pixel_coord_upper:new zr(t),u_pixel_coord_lower:new zr(t),u_tile_units_to_pixels:new ii(t)}),circle:t=>({u_camera_to_center_distance:new ii(t),u_extrude_scale:new Kf(t),u_device_pixel_ratio:new ii(t),u_matrix:new xr(t),u_inv_rot_matrix:new xr(t),u_merc_center:new zr(t),u_tile_id:new Tr(t),u_zoom_transition:new ii(t),u_up_dir:new Tr(t),u_emissive_strength:new ii(t)}),collisionBox:t=>({u_matrix:new xr(t),u_camera_to_center_distance:new ii(t),u_extrude_scale:new zr(t)}),collisionCircle:t=>({u_matrix:new xr(t),u_inv_matrix:new xr(t),u_camera_to_center_distance:new ii(t),u_viewport_size:new zr(t)}),debug:t=>({u_color:new jA(t),u_matrix:new xr(t),u_overlay:new Ni(t),u_overlay_scale:new ii(t)}),clippingMask:t=>({u_matrix:new xr(t)}),heatmap:t=>({u_extrude_scale:new ii(t),u_intensity:new ii(t),u_matrix:new xr(t),u_inv_rot_matrix:new xr(t),u_merc_center:new zr(t),u_tile_id:new Tr(t),u_zoom_transition:new ii(t),u_up_dir:new Tr(t)}),heatmapTexture:t=>({u_image:new Ni(t),u_color_ramp:new Ni(t),u_opacity:new ii(t)}),hillshade:t=>({u_matrix:new xr(t),u_image:new Ni(t),u_latrange:new zr(t),u_light:new zr(t),u_shadow:new jA(t),u_highlight:new jA(t),u_emissive_strength:new ii(t),u_accent:new jA(t)}),hillshadePrepare:t=>({u_matrix:new xr(t),u_image:new Ni(t),u_dimension:new zr(t),u_zoom:new ii(t)}),line:t=>({u_matrix:new xr(t),u_pixels_to_tile_units:new Kf(t),u_device_pixel_ratio:new ii(t),u_units_to_pixels:new zr(t),u_dash_image:new Ni(t),u_gradient_image:new Ni(t),u_image_height:new ii(t),u_texsize:new zr(t),u_tile_units_to_pixels:new ii(t),u_alpha_discard_threshold:new ii(t),u_trim_offset:new zr(t),u_emissive_strength:new ii(t)}),linePattern:t=>({u_matrix:new xr(t),u_texsize:new zr(t),u_pixels_to_tile_units:new Kf(t),u_device_pixel_ratio:new ii(t),u_image:new Ni(t),u_units_to_pixels:new zr(t),u_tile_units_to_pixels:new ii(t),u_alpha_discard_threshold:new ii(t)}),raster:t=>({u_matrix:new xr(t),u_normalize_matrix:new xr(t),u_globe_matrix:new xr(t),u_merc_matrix:new xr(t),u_grid_matrix:new Yf(t),u_tl_parent:new zr(t),u_scale_parent:new ii(t),u_fade_t:new ii(t),u_opacity:new ii(t),u_image0:new Ni(t),u_image1:new Ni(t),u_brightness_low:new ii(t),u_brightness_high:new ii(t),u_saturation_factor:new ii(t),u_contrast_factor:new ii(t),u_spin_weights:new Tr(t),u_perspective_transform:new zr(t),u_raster_elevation:new ii(t),u_tl_br:new Mo(t),u_zoom_transition:new ii(t),u_merc_center:new zr(t),u_cutoff_params:new Mo(t),u_colorization_mix:new Mo(t),u_colorization_offset:new ii(t),u_color_ramp:new Ni(t),u_texture_offset:new zr(t),u_texture_res:new zr(t),u_emissive_strength:new ii(t)}),symbolIcon:t=>({u_is_size_zoom_constant:new Ni(t),u_is_size_feature_constant:new Ni(t),u_size_t:new ii(t),u_size:new ii(t),u_camera_to_center_distance:new ii(t),u_rotate_symbol:new Ni(t),u_aspect_ratio:new ii(t),u_fade_change:new ii(t),u_matrix:new xr(t),u_label_plane_matrix:new xr(t),u_coord_matrix:new xr(t),u_is_text:new Ni(t),u_pitch_with_map:new Ni(t),u_texsize:new zr(t),u_tile_id:new Tr(t),u_zoom_transition:new ii(t),u_inv_rot_matrix:new xr(t),u_merc_center:new zr(t),u_camera_forward:new Tr(t),u_tile_matrix:new xr(t),u_up_vector:new Tr(t),u_ecef_origin:new Tr(t),u_texture:new Ni(t),u_icon_transition:new ii(t),u_icon_saturation:new ii(t)}),symbolSDF:t=>({u_is_size_zoom_constant:new Ni(t),u_is_size_feature_constant:new Ni(t),u_size_t:new ii(t),u_size:new ii(t),u_camera_to_center_distance:new ii(t),u_rotate_symbol:new Ni(t),u_aspect_ratio:new ii(t),u_fade_change:new ii(t),u_matrix:new xr(t),u_label_plane_matrix:new xr(t),u_coord_matrix:new xr(t),u_is_text:new Ni(t),u_pitch_with_map:new Ni(t),u_texsize:new zr(t),u_texture:new Ni(t),u_gamma_scale:new ii(t),u_device_pixel_ratio:new ii(t),u_tile_id:new Tr(t),u_zoom_transition:new ii(t),u_inv_rot_matrix:new xr(t),u_merc_center:new zr(t),u_camera_forward:new Tr(t),u_tile_matrix:new xr(t),u_up_vector:new Tr(t),u_ecef_origin:new Tr(t),u_is_halo:new Ni(t)}),symbolTextAndIcon:t=>({u_is_size_zoom_constant:new Ni(t),u_is_size_feature_constant:new Ni(t),u_size_t:new ii(t),u_size:new ii(t),u_camera_to_center_distance:new ii(t),u_rotate_symbol:new Ni(t),u_aspect_ratio:new ii(t),u_fade_change:new ii(t),u_matrix:new xr(t),u_label_plane_matrix:new xr(t),u_coord_matrix:new xr(t),u_is_text:new Ni(t),u_pitch_with_map:new Ni(t),u_texsize:new zr(t),u_texsize_icon:new zr(t),u_texture:new Ni(t),u_texture_icon:new Ni(t),u_gamma_scale:new ii(t),u_device_pixel_ratio:new ii(t),u_is_halo:new Ni(t)}),background:t=>({u_matrix:new xr(t),u_emissive_strength:new ii(t),u_opacity:new ii(t),u_color:new jA(t)}),backgroundPattern:t=>({u_matrix:new xr(t),u_emissive_strength:new ii(t),u_opacity:new ii(t),u_image:new Ni(t),u_pattern_tl:new zr(t),u_pattern_br:new zr(t),u_texsize:new zr(t),u_pattern_size:new zr(t),u_pixel_coord_upper:new zr(t),u_pixel_coord_lower:new zr(t),u_tile_units_to_pixels:new ii(t)}),terrainRaster:Cb,terrainDepth:Cb,skybox:t=>({u_matrix:new xr(t),u_sun_direction:new Tr(t),u_cubemap:new Ni(t),u_opacity:new ii(t),u_temporal_offset:new ii(t)}),skyboxGradient:t=>({u_matrix:new xr(t),u_color_ramp:new Ni(t),u_center_direction:new Tr(t),u_radius:new ii(t),u_opacity:new ii(t),u_temporal_offset:new ii(t)}),skyboxCapture:t=>({u_matrix_3f:new Yf(t),u_sun_direction:new Tr(t),u_sun_intensity:new ii(t),u_color_tint_r:new Mo(t),u_color_tint_m:new Mo(t),u_luminance:new ii(t)}),globeRaster:t=>({u_proj_matrix:new xr(t),u_globe_matrix:new xr(t),u_normalize_matrix:new xr(t),u_merc_matrix:new xr(t),u_zoom_transition:new ii(t),u_merc_center:new zr(t),u_image0:new Ni(t),u_grid_matrix:new Yf(t),u_skirt_height:new ii(t),u_frustum_tl:new Tr(t),u_frustum_tr:new Tr(t),u_frustum_br:new Tr(t),u_frustum_bl:new Tr(t),u_globe_pos:new Tr(t),u_globe_radius:new ii(t),u_viewport:new zr(t)}),globeAtmosphere:t=>({u_frustum_tl:new Tr(t),u_frustum_tr:new Tr(t),u_frustum_br:new Tr(t),u_frustum_bl:new Tr(t),u_horizon:new ii(t),u_transition:new ii(t),u_fadeout_range:new ii(t),u_color:new Mo(t),u_high_color:new Mo(t),u_space_color:new Mo(t),u_temporal_offset:new ii(t),u_horizon_angle:new ii(t)}),model:t=>({u_matrix:new xr(t),u_lighting_matrix:new xr(t),u_normal_matrix:new xr(t),u_lightpos:new Tr(t),u_lightintensity:new ii(t),u_lightcolor:new Tr(t),u_camera_pos:new Tr(t),u_opacity:new ii(t),u_baseColorFactor:new Mo(t),u_emissiveFactor:new Mo(t),u_metallicFactor:new ii(t),u_roughnessFactor:new ii(t),u_baseTextureIsAlpha:new Ni(t),u_alphaMask:new Ni(t),u_alphaCutoff:new ii(t),u_baseColorTexture:new Ni(t),u_metallicRoughnessTexture:new Ni(t),u_normalTexture:new Ni(t),u_occlusionTexture:new Ni(t),u_emissionTexture:new Ni(t),u_color_mix:new Mo(t),u_aoIntensity:new ii(t),u_emissive_strength:new ii(t)}),modelDepth:t=>({u_matrix:new xr(t),u_instance:new xr(t),u_node_matrix:new xr(t)}),groundShadow:t=>({u_matrix:new xr(t),u_ground_shadow_factor:new Tr(t)}),stars:t=>({u_matrix:new xr(t),u_up:new Tr(t),u_right:new Tr(t),u_intensity_multiplier:new ii(t)})};let c_;function $b(t,e,i,r,n,s,a){const c=t.context,p=c.gl,_=t.transform,v=t.getOrCreateProgram("collisionBox"),E=[];let C=0,B=0;for(let re=0;re<r.length;re++){const te=r[re],se=e.getTile(te),he=se.getBucket(i);if(!he)continue;const ve=BM(te,he,_);let be=ve;n[0]===0&&n[1]===0||(be=t.translatePosMatrix(ve,se,n,s));const Ce=a?he.textCollisionBox:he.iconCollisionBox,Ne=he.collisionCircleArray;if(Ne.length>0){const je=ce.create(),Ye=be;ce.mul(je,he.placementInvProjMatrix,_.glCoordMatrix),ce.mul(je,je,he.placementViewportMatrix),E.push({circleArray:Ne,circleOffset:B,transform:Ye,invTransform:je,projection:he.getProjection()}),C+=Ne.length/4,B=C}Ce&&(t.terrain&&t.terrain.setupElevationDraw(se,v),v.draw(t,p.LINES,cr.disabled,Lr.disabled,t.colorModeForRenderPass(),Or.disabled,f4(be,_,se,he.getProjection()),i.id,Ce.layoutVertexBuffer,Ce.indexBuffer,Ce.segments,null,_.zoom,null,[Ce.collisionVertexBuffer,Ce.collisionVertexBufferExt]))}if(!a||!E.length)return;const O=t.getOrCreateProgram("collisionCircle"),G=new Uf;G.resize(4*C),G._trim();let q=0;for(const re of E)for(let te=0;te<re.circleArray.length/4;te++){const se=4*te,he=re.circleArray[se+0],ve=re.circleArray[se+1],be=re.circleArray[se+2],Ce=re.circleArray[se+3];G.emplace(q++,he,ve,be,Ce,0),G.emplace(q++,he,ve,be,Ce,1),G.emplace(q++,he,ve,be,Ce,2),G.emplace(q++,he,ve,be,Ce,3)}(!c_||c_.length<2*C)&&(c_=function(re){const te=2*re,se=new Ys;se.resize(te),se._trim();for(let he=0;he<te;he++){const ve=6*he;se.uint16[ve+0]=4*he+0,se.uint16[ve+1]=4*he+1,se.uint16[ve+2]=4*he+2,se.uint16[ve+3]=4*he+2,se.uint16[ve+4]=4*he+3,se.uint16[ve+5]=4*he+0}return se}(C));const $=c.createIndexBuffer(c_,!0),J=c.createVertexBuffer(G,Q3.members,!0);for(const re of E){const te={u_matrix:re.transform,u_inv_matrix:re.invTransform,u_camera_to_center_distance:(ie=_).getCameraToCenterDistance(re.projection),u_viewport_size:[ie.width,ie.height]};O.draw(t,p.TRIANGLES,cr.disabled,Lr.disabled,t.colorModeForRenderPass(),Or.disabled,te,i.id,J,$,wn.simpleSegment(0,2*re.circleOffset,re.circleArray.length,re.circleArray.length/2),null,_.zoom)}var ie;J.destroy(),$.destroy()}const Xb=ce.create();function T4({width:t,height:e,anchor:i,textOffset:r,textScale:n},s){const{horizontalAlign:a,verticalAlign:c}=Em(i),p=-(a-.5)*t,_=-(c-.5)*e,v=Mg(i,r);return new At((p/n+v[0])*s,(_/n+v[1])*s)}function E4(t,e,i,r,n,s,a,c,p,_,v){const E=t.text.placedSymbolArray,C=t.text.dynamicLayoutVertexArray,B=t.icon.dynamicLayoutVertexArray,O={},G=t.getProjection(),q=ly(c,G,s),$=s.elevation,J=G.upVectorScale(c.canonical,s.center.lat,s.worldSize).metersToTile;C.clear();for(let ie=0;ie<E.length;ie++){const re=E.get(ie),{tileAnchorX:te,tileAnchorY:se,numGlyphs:he}=re,ve=re.hidden||!re.crossTileID||t.allowVerticalPlacement&&!re.placedOrientation?null:r[re.crossTileID];if(ve){let be=0,Ce=0,Ne=0;if($){const Tt=$?$.getAtTileOffset(c,te,se):0,[It,St,Lt]=G.upVector(c.canonical,te,se);be=Tt*It*J,Ce=Tt*St*J,Ne=Tt*Lt*J}let[je,Ye,Re,rt]=Wc(re.projectedAnchorX+be,re.projectedAnchorY+Ce,re.projectedAnchorZ+Ne,i?q:a);const lt=Nx(s.getCameraToCenterDistance(G),rt);let vt=n.evaluateSizeForFeature(t.textSizeData,_,re)*lt/fa;i&&(vt*=t.tilePixelRatio/p);const it=T4(ve,vt);i?({x:je,y:Ye,z:Re}=G.projectTilePoint(te+it.x,se+it.y,c.canonical),[je,Ye,Re]=Wc(je+be,Ye+Ce,Re+Ne,a)):(e&&it._rotate(-s.angle),je+=it.x,Ye+=it.y,Re=0);const at=t.allowVerticalPlacement&&re.placedOrientation===ws.vertical?Math.PI/2:0;for(let Tt=0;Tt<he;Tt++)Af(C,je,Ye,Re,at);v&&re.associatedIconIndex>=0&&(O[re.associatedIconIndex]={x:je,y:Ye,z:Re,angle:at})}else uf(he,C)}if(v){B.clear();const ie=t.icon.placedSymbolArray;for(let re=0;re<ie.length;re++){const te=ie.get(re),{numGlyphs:se}=te,he=O[re];if(te.hidden||!he)uf(se,B);else{const{x:ve,y:be,z:Ce,angle:Ne}=he;for(let je=0;je<se;je++)Af(B,ve,be,Ce,Ne)}}t.icon.dynamicLayoutVertexBuffer.updateData(B)}t.text.dynamicLayoutVertexBuffer.updateData(C)}function M4(t,e,i){return i.iconsInText&&e?"symbolTextAndIcon":t?"symbolSDF":"symbolIcon"}function Yb(t,e,i,r,n,s,a,c,p,_,v,E,C){const B=t.context,O=B.gl,G=t.transform,q=c==="map",$=p==="map",J=q&&i.layout.get("symbol-placement")!=="point",ie=q&&!$&&!J,re=i.layout.get("symbol-sort-key").constantOr(1)!==void 0;let te=!1;const se=t.depthModeForSublayer(0,cr.ReadOnly),he=[jo(G.center.lng),ea(G.center.lat)],ve=i.layout.get("text-variable-anchor"),be=G.projection.name==="globe",Ce=[],Ne=[0,-1,0];let je=Ne;!be&&!G.mercatorFromTransition||q||(je=function(Ye){const Re=Ye._camera.getWorldToCamera(Ye.worldSize,1),rt=ce.multiply([],Re,Ye.globeMatrix);ce.invert(rt,rt);const lt=[0,0,0],vt=[0,1,0,0];return U.transformMat4(vt,vt,rt),lt[0]=vt[0],lt[1]=vt[1],lt[2]=vt[2],_e.normalize(lt,lt),lt}(G));for(const Ye of r){const Re=e.getTile(Ye),rt=Re.getBucket(i);if(!rt||rt.projection.name==="mercator"&&be)continue;const lt=n?rt.text:rt.icon;if(!lt||rt.fullyClipped||!lt.segments.get().length)continue;const vt=lt.programConfigurations.get(i.id),it=n||rt.sdfIcons,at=n?rt.textSizeData:rt.iconSizeData,Tt=$||G.pitch!==0,It=hu(at,G.zoom);let St,Lt,Ot,jt,Dt=[0,0],Kt=null;if(n)Lt=Re.glyphAtlasTexture?Re.glyphAtlasTexture:null,Ot=O.LINEAR,St=Re.glyphAtlasTexture?Re.glyphAtlasTexture.size:[0,0],rt.iconsInText&&(Dt=Re.imageAtlasTexture?Re.imageAtlasTexture.size:[0,0],Kt=Re.imageAtlasTexture?Re.imageAtlasTexture:null,jt=Tt||t.options.rotating||t.options.zooming||at.kind==="composite"||at.kind==="camera"?O.LINEAR:O.NEAREST);else{const _s=i.layout.get("icon-size").constantOr(0)!==1||rt.iconsNeedLinear;Lt=Re.imageAtlasTexture?Re.imageAtlasTexture:null,Ot=it||t.options.rotating||t.options.zooming||_s||Tt?O.LINEAR:O.NEAREST,St=Re.imageAtlasTexture?Re.imageAtlasTexture.size:[0,0]}const mi=rt.projection.name==="globe",_i=mi?je:Ne,Ti=mi?Uo(G.zoom):0,Mi=ly(Ye,rt.getProjection(),G),ur=G.calculatePixelsToTileUnitsMatrix(Re),Ui=Zm(Mi,Re.tileID.canonical,$,q,G,rt.getProjection(),ur),on=t.terrain&&$&&J?ce.invert(ce.create(),Ui):Xb,Zr=Vx(Mi,Re.tileID.canonical,$,q,G,rt.getProjection(),ur),hr=ve&&rt.hasTextData(),or=rt.hasIconTextFit()&&hr&&rt.hasIconData();if(J){const _s=G.elevation,Dn=_s?_s.getAtTileOffsetFunc(Ye,G.center.lat,G.worldSize,rt.getProjection()):null,Ba=Ox(Mi,Re.tileID.canonical,$,q,G,rt.getProjection(),ur);TE(rt,Mi,t,n,Ba,Zr,$,_,Dn,Ye)}const $i=J||n&&ve||or,Hr=t.translatePosMatrix(Mi,Re,s,a),Jr=$i?Xb:Ui,Br=t.translatePosMatrix(Zr,Re,s,a,!0),Vn=rt.getProjection().createInversionMatrix(G,Ye.canonical),Js=i.paint.get("icon-image-cross-fade").constantOr(0),Bn=[];t.terrainRenderModeElevated()&&$&&Bn.push("PITCH_WITH_MAP_TERRAIN"),mi&&(Bn.push("PROJECTION_GLOBE_VIEW"),$i&&Bn.push("PROJECTED_POS_ON_VIEWPORT")),Js>0&&Bn.push("ICON_TRANSITION"),lt.zOffsetVertexBuffer&&Bn.push("Z_OFFSET");const us=it&&i.paint.get(n?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Ao;it?Ao=rt.iconsInText?x4(at.kind,It,ie,$,t,Hr,Jr,Br,St,Dt,Ye,Ti,he,Vn,_i,rt.getProjection()):Qb(at.kind,It,ie,$,t,Hr,Jr,Br,n,St,!0,Ye,Ti,he,Vn,_i,rt.getProjection()):(v<1&&Bn.push("SATURATION"),Ao=qb(at.kind,It,ie,$,t,Hr,Jr,Br,n,St,Ye,Ti,he,Vn,_i,rt.getProjection(),v,Js));const eo={program:t.getOrCreateProgram(M4(it,n,rt),{config:vt,defines:Bn}),buffers:lt,uniformValues:Ao,atlasTexture:Lt,atlasTextureIcon:Kt,atlasInterpolation:Ot,atlasInterpolationIcon:jt,isSDF:it,hasHalo:us,tile:Re,labelPlaneMatrixInv:on};if(re&&rt.canOverlap){te=!0;const _s=lt.segments.get();for(const Dn of _s)Ce.push({segments:new wn([Dn]),sortKey:Dn.sortKey,state:eo})}else Ce.push({segments:lt.segments,sortKey:0,state:eo})}te&&Ce.sort((Ye,Re)=>Ye.sortKey-Re.sortKey);for(const Ye of Ce){const Re=Ye.state;if(t.terrain&&t.terrain.setupElevationDraw(Re.tile,Re.program,{useDepthForOcclusion:G.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Re.labelPlaneMatrixInv}),B.activeTexture.set(O.TEXTURE0),Re.atlasTexture&&Re.atlasTexture.bind(Re.atlasInterpolation,O.CLAMP_TO_EDGE),Re.atlasTextureIcon&&(B.activeTexture.set(O.TEXTURE1),Re.atlasTextureIcon&&Re.atlasTextureIcon.bind(Re.atlasInterpolationIcon,O.CLAMP_TO_EDGE)),t.uploadCommonLightUniforms(t.context,Re.program),Re.hasHalo){const rt=Re.uniformValues;rt.u_is_halo=1,my(Re.buffers,Ye.segments,i,t,Re.program,se,E,C,rt,2),rt.u_is_halo=0}else{if(Re.isSDF){const rt=Re.uniformValues;Re.hasHalo&&(rt.u_is_halo=1,my(Re.buffers,Ye.segments,i,t,Re.program,se,E,C,rt,1)),rt.u_is_halo=0}my(Re.buffers,Ye.segments,i,t,Re.program,se,E,C,Re.uniformValues,1)}}}function my(t,e,i,r,n,s,a,c,p,_){const v=[t.dynamicLayoutVertexBuffer,t.opacityVertexBuffer,t.iconTransitioningVertexBuffer,t.globeExtVertexBuffer,t.zOffsetVertexBuffer];n.draw(r,r.context.gl.TRIANGLES,s,a,c,Or.disabled,p,i.id,t.layoutVertexBuffer,t.indexBuffer,e,i.paint,r.transform.zoom,t.programConfigurations.get(i.id),v,_)}function Kb(t,e,i,r,n,s,a){const c=t.context.gl,p=i.paint.get("fill-pattern"),_=p&&p.constantOr(1);let v,E,C,B,O;a?(E=_&&!i.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",v=c.LINES):(E=_?"fillPattern":"fill",v=c.TRIANGLES);for(const G of r){const q=e.getTile(G);if(_&&!q.patternsLoaded())continue;const $=q.getBucket(i);if(!$)continue;t.prepareDrawTile();const J=$.programConfigurations.get(i.id),ie=t.isTileAffectedByFog(G),re=t.getOrCreateProgram(E,{config:J,overrideFog:ie});_&&(t.context.activeTexture.set(c.TEXTURE0),q.imageAtlasTexture&&q.imageAtlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE),J.updatePaintBuffers());const te=p.constantOr(null);if(te&&q.imageAtlas){const ve=q.imageAtlas.patternPositions[te.toString()];ve&&J.setConstantPatternPositions(ve)}const se=t.translatePosMatrix(G.projMatrix,q,i.paint.get("fill-translate"),i.paint.get("fill-translate-anchor")),he=i.paint.get("fill-emissive-strength");if(a){B=$.indexBuffer2,O=$.segments2;const ve=t.terrain&&t.terrain.renderingToTexture?t.terrain.drapeBufferSize:[c.drawingBufferWidth,c.drawingBufferHeight];C=E==="fillOutlinePattern"&&_?d4(se,he,t,q,ve):h4(se,he,ve)}else B=$.indexBuffer,O=$.segments,C=_?Ub(se,he,t,q):Nb(se,he);t.uploadCommonUniforms(t.context,re,G.toUnwrapped()),re.draw(t,v,n,t.stencilModeForClipping(G),s,Or.disabled,C,i.id,$.layoutVertexBuffer,B,O,i.paint,t.transform.zoom,J,void 0)}}function u_(t,e,i,r,n,s,a,c){i.resetLayerRenderingStats();const p=t.context,_=p.gl,v=t.transform,E=i.paint.get("fill-extrusion-pattern"),C=E.constantOr(1),B=i.paint.get("fill-extrusion-opacity"),O=t.style.enable3dLights(),G=i.paint.get(O&&!C?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),q=[i.paint.get("fill-extrusion-ambient-occlusion-intensity"),G],$=i.layout.get("fill-extrusion-edge-radius"),J=$>0&&!i.paint.get("fill-extrusion-rounded-roof"),ie=J?0:$,re=v.projection.name==="globe"?vv():0,te=v.projection.name==="globe",se=te?Uo(v.zoom):0,he=[jo(v.center.lng),ea(v.center.lat)],ve=i.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),be=i.paint.get("fill-extrusion-flood-light-intensity"),Ce=i.paint.get("fill-extrusion-vertical-scale"),Ne=ff(t,i.paint.get("fill-extrusion-cutoff-fade-range")),je=i.paint.get("fill-extrusion-emissive-strength"),Ye=[];let Re;te&&Ye.push("PROJECTION_GLOBE_VIEW"),q[0]>0&&Ye.push("FAUX_AO"),J&&Ye.push("ZERO_ROOF_RADIUS"),c&&Ye.push("HAS_CENTROID"),be>0&&Ye.push("FLOOD_LIGHT"),Ne.shouldRenderCutoff&&Ye.push("RENDER_CUTOFF");const rt=t.renderPass==="shadow",lt=t.shadowRenderer,vt=rt&&!!lt;t.shadowRenderer&&(t.shadowRenderer.useNormalOffset=!0);let it=[0,0,0];if(lt){const It=t.style.directionalLight,St=t.style.ambientLight;It&&St&&(it=yy(It,St)),Re=Ye.concat(["SHADOWS_SINGLE_CASCADE"])}const at=vt?"fillExtrusionDepth":C?"fillExtrusionPattern":"fillExtrusion",Tt=i.getLayerRenderingStats();for(const It of r){const St=e.getTile(It),Lt=St.getBucket(i);if(!Lt||Lt.projection.name!==v.projection.name)continue;let Ot=!1;lt&&(Ot=lt.getMaxCascadeForTile(It.toUnwrapped())===0);const jt=t.isTileAffectedByFog(It),Dt=Lt.programConfigurations.get(i.id),Kt=t.getOrCreateProgram(at,{config:Dt,defines:Ot?Re:Ye,overrideFog:jt});if(t.terrain&&t.terrain.setupElevationDraw(St,Kt,{useMeterToDem:!0}),!Lt.centroidVertexBuffer){const Ui=Kt.attributes.a_centroid_pos;Ui!==void 0&&_.vertexAttrib2f(Ui,0,0)}!rt&&lt&&lt.setupShadows(St.tileID.toUnwrapped(),Kt,"vector-tile",St.tileID.overscaledZ),C&&(t.context.activeTexture.set(_.TEXTURE0),St.imageAtlasTexture&&St.imageAtlasTexture.bind(_.LINEAR,_.CLAMP_TO_EDGE),Dt.updatePaintBuffers());const mi=E.constantOr(null);if(mi&&St.imageAtlas){const Ui=St.imageAtlas.patternPositions[mi.toString()];Ui&&Dt.setConstantPatternPositions(Ui)}const _i=i.paint.get("fill-extrusion-vertical-gradient");let Ti;if(rt&&lt){if(D4(St.tileID,Lt,t))continue;const Ui=lt.calculateShadowPassMatrixFromTile(St.tileID.toUnwrapped());Ti=c4(Ui,ie,Ce)}else{const Ui=t.translatePosMatrix(It.expandedProjMatrix,St,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),on=v.projection.createInversionMatrix(v,It.canonical);Ti=C?u4(Ui,t,_i,B,q,ie,It,St,re,se,he,on,ve,Ce):Vb(Ui,t,_i,B,q,ie,It,re,se,he,on,ve,Ce,be,it,je)}t.uploadCommonUniforms(p,Kt,It.toUnwrapped(),null,Ne);let Mi=Lt.segments;if(v.projection.name==="mercator"&&!rt&&(Mi=Lt.getVisibleSegments(St.tileID,t.terrain,t.transform.getFrustum(0)),!Mi.get().length))continue;if(Tt)if(rt)for(const Ui of Mi.get())Tt.numRenderedVerticesInShadowPass+=Ui.primitiveLength;else for(const Ui of Mi.get())Tt.numRenderedVerticesInTransparentPass+=Ui.primitiveLength;const ur=[];(t.terrain||c)&&ur.push(Lt.centroidVertexBuffer),te&&ur.push(Lt.layoutVertexExtBuffer),Kt.draw(t,p.gl.TRIANGLES,n,s,a,Or.backCCW,Ti,i.id,Lt.layoutVertexBuffer,Lt.indexBuffer,Mi,i.paint,t.transform.zoom,Dt,ur)}t.shadowRenderer&&(t.shadowRenderer.useNormalOffset=!1)}function mf(t,e,i,r,n,s,a,c,p,_,v,E,C,B,O,G,q,$,J){const ie=t.context,re=ie.gl,te=t.transform,se=t.transform.zoom,he=[],ve=ff(t,i.paint.get("fill-extrusion-cutoff-fade-range"));_==="clear"?(he.push("CLEAR_SUBPASS"),J&&(he.push("CLEAR_FROM_TEXTURE"),ie.activeTexture.set(re.TEXTURE0),J.bind(re.LINEAR,re.CLAMP_TO_EDGE))):_==="sdf"&&he.push("SDF_SUBPASS"),q&&he.push("HAS_CENTROID"),ve.shouldRenderCutoff&&he.push("RENDER_CUTOFF");const be=i.layout.get("fill-extrusion-edge-radius"),Ce=(Ne,je,Ye,Re,rt)=>{const lt=je.programConfigurations.get(i.id),vt=t.isTileAffectedByFog(Ne),it=t.getOrCreateProgram("fillExtrusionGroundEffect",{config:lt,defines:he,overrideFog:vt}),at=((It,St,Lt,Ot,jt,Dt,Kt,mi,_i,Ti,Mi)=>({u_matrix:St,u_opacity:Lt,u_ao_pass:Ot?1:0,u_meter_to_tile:jt,u_ao:Dt,u_flood_light_intensity:Kt,u_flood_light_color:mi,u_attenuation:_i,u_edge_radius:Ti,u_fb:0,u_fb_size:Mi}))(0,Re,v,p,rt,[E,C*rt],B,O,G,se>=17?0:be*rt,J?J.size[0]:0),Tt=[];q&&Tt.push(je.hiddenByLandmarkVertexBuffer),t.uploadCommonUniforms(ie,it,Ne.toUnwrapped(),null,ve),it.draw(t,ie.gl.TRIANGLES,n,s,a,c,at,i.id,je.vertexBuffer,je.indexBuffer,Ye,i.paint,se,lt,Tt)};for(const Ne of r){const je=e.getTile(Ne),Ye=je.getBucket(i);if(!Ye||Ye.projection.name!==te.projection.name||!Ye.groundEffect||Ye.groundEffect&&!Ye.groundEffect.hasData())continue;const Re=Ye.groundEffect,rt=1/Ye.tileToMeter;{const lt=t.translatePosMatrix(Ne.projMatrix,je,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),vt=Re.getDefaultSegment();Ce(Ne,Re,vt,lt,rt)}if($)for(let lt=0;lt<4;lt++){const vt=vs[lt](Ne),it=e.getTile(vt);if(!it)continue;const at=it.getBucket(i);if(!at||at.projection.name!==te.projection.name||!at.groundEffect||at.groundEffect&&!at.groundEffect.hasData())continue;const Tt=at.groundEffect;let It,St;lt===0?(It=[-Mt,0,0],St=1):lt===1?(It=[Mt,0,0],St=0):lt===2?(It=[0,-Mt,0],St=3):(It=[0,Mt,0],St=2);const Lt=Tt.regionSegments[St];if(!Lt)continue;const Ot=new Float32Array(16);ce.translate(Ot,Ne.projMatrix,It),Ce(Ne,Tt,Lt,t.translatePosMatrix(Ot,je,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),rt)}}}function S4(t,e,i,r,n,s,a){r.centroidVertexArray.length===0&&r.createCentroidsBuffer();const c=s?s.findDEMTileFor(i):null;if(!(c&&c.dem||a))return;const p=$=>{const J=e.getSource().minzoom,ie=te=>{const se=e.getTileByID(te);if(se&&se.hasData())return se.getBucket(n)},re=[0,-1,1];for(const te of re){if($.overscaledZ+te<J)continue;const se=ie($.calculateScaledKey($.overscaledZ+te));if(se)return se}},_=[0,0,0],v=($,J)=>(_[0]=Math.min($.min.y,J.min.y),_[1]=Math.max($.max.y,J.max.y),_[2]=Mt-J.min.x>$.max.x?J.min.x-Mt:$.max.x,_),E=($,J)=>(_[0]=Math.min($.min.x,J.min.x),_[1]=Math.max($.max.x,J.max.x),_[2]=Mt-J.min.y>$.max.y?J.min.y-Mt:$.max.y,_),C=[($,J)=>v($,J),($,J)=>v(J,$),($,J)=>E($,J),($,J)=>E(J,$)],B=($,J,ie,re,te,se,he)=>{if(!s)return 0;const ve=[[se?ie:$,se?$:ie,0],[se?ie:J,se?J:ie,0]],be=he<0?Mt+he:he,Ce=[se?be:($+J)/2,se?($+J)/2:be,0];return ie===0&&he<0||ie!==0&&he>0?s.getForTilePoints(te,[Ce],!0,re):ve.push(Ce),s.getForTilePoints(i,ve,!0,c),Math.max(ve[0][2],ve[1][2],Ce[2])/s.exaggeration()};for(let $=0;$<4;$++){const J=r.borderFeatureIndices[$];if(J.length===0)continue;const ie=vs[$](i),re=p(ie);if(!(re&&re instanceof H0)||r.borderDoneWithNeighborZ[$]===re.canonical.z)continue;re.centroidVertexArray.length===0&&re.createCentroidsBuffer();const te=s?s.findDEMTileFor(ie):null;if(!(te&&te.dem||a))continue;const se=($<2?1:5)-$,he=re.borderDoneWithNeighborZ[se]!==r.canonical.z,ve=re.borderFeatureIndices[se];let be=0;if(r.canonical.z!==re.canonical.z){for(const Ce of J)r.showCentroid(r.featuresOnBorder[Ce]);if(he)for(const Ce of ve)re.showCentroid(re.featuresOnBorder[Ce]);r.borderDoneWithNeighborZ[$]=re.canonical.z,re.borderDoneWithNeighborZ[se]=r.canonical.z}for(const Ce of J){const Ne=r.featuresOnBorder[Ce],je=r.centroidData[Ne.centroidDataIndex],Ye=Ne.borders[$];let Re;for(;be<ve.length;){Re=re.featuresOnBorder[ve[be]];const rt=Re.borders[se];if(rt[1]>Ye[0]+3||rt[0]>Ye[0]-3)break;re.showCentroid(Re),be++}if(Re&&be<ve.length){const rt=be;let lt=0;for(;!(Re.borders[se][0]>Ye[1]-3)&&(lt++,++be!==ve.length);)Re=re.featuresOnBorder[ve[be]];if(Re=re.featuresOnBorder[ve[rt]],lt>1){const at=Re.borders[se];Math.abs(Ye[0]-at[0])<3&&Math.abs(Ye[1]-at[1])<3&&(lt=1,be=rt+1)}else if(lt===0){r.showCentroid(Ne);continue}const vt=re.centroidData[Re.centroidDataIndex];a&&lt===1&&(((G=je).flags|(q=vt).flags)&pu?(G.flags|=pu,q.flags|=pu):(G.flags&=2147483647,q.flags&=2147483647));let it=new At(0,0);if(lt>1)be=rt;else if(te&&te.dem&&!(Ne.intersectsCount()>1||Re.intersectsCount()>1)){const at=C[$](je,vt),Tt=$%2?Mt-1:0;O=B(at[0],Math.min(Mt-1,at[1]),Tt,te,ie,$<2,at[2]),it=new At(Math.ceil(7*(O+450)),0)}je.centroidXY=vt.centroidXY=it,r.writeCentroidToBuffer(je),re.writeCentroidToBuffer(vt)}else r.showCentroid(Ne)}r.borderDoneWithNeighborZ[$]=re.canonical.z,re.borderDoneWithNeighborZ[se]=r.canonical.z}var O,G,q;(r.needsCentroidUpdate||!r.centroidVertexBuffer&&r.centroidVertexArray.length!==0)&&r.uploadCentroid(t)}const I4=[1,0,0],C4=[0,1,0],k4=[0,0,1];function D4(t,e,i){const r=i.transform,n=i.shadowRenderer;if(!n)return!0;const s=t.toUnwrapped(),a=r.tileSize*n._cascades[i.currentShadowCascade].scale;let c=e.maxHeight;if(r.elevation){const G=r.elevation.getMinMaxForTile(t);G&&(c+=G.max)}const p=[...n.shadowDirection];p[2]=-p[2];const _=n.computeSimplifiedTileShadowVolume(s,c,a,p);if(!_)return!1;const v=[I4,C4,k4,p,[p[0],0,p[2]],[0,p[1],p[2]]],E=r.projection.name==="globe",C=r.scaleZoom(a),B=Gs.fromInvProjectionMatrix(r.invProjMatrix,r.worldSize,C,!E),O=n.getCurrentCascadeFrustum();return B.intersectsPrecise(_.vertices,_.planes,v)===0||O.intersectsPrecise(_.vertices,_.planes,v)===0}function P4(t){const e=t._nearZ,i=t.projection.farthestPixelDistance(t),r=i-e,n=.2*t.height,s=e+n;return[e,i,(s-n-e)/r,(s-e)/r]}const z4=new pr(1,0,0,1),B4=new pr(0,1,0,1),L4=new pr(0,0,1,1),R4=new pr(1,0,1,1),F4=new pr(0,1,1,1);function O4(t,e,i){const r=t.context,n=t.transform,s=r.gl,a=n.projection.name==="globe",c=a?["PROJECTION_GLOBE_VIEW"]:[];let p=i.projMatrix;if(a&&Uo(n.zoom)>0){const Ce=Wd(bA(i.canonical,n));p=ce.multiply(new Float32Array(16),n.globeMatrix,Ce),ce.multiply(p,n.projMatrix,p)}const _=t.getOrCreateProgram("debug",{defines:c}),v=e.getTileByID(i.key);t.terrain&&t.terrain.setupElevationDraw(v,_);const E=cr.disabled,C=Lr.disabled,B=t.colorModeForRenderPass(),O="$debug";r.activeTexture.set(s.TEXTURE0),t.emptyTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE),a?v._makeGlobeTileDebugBuffers(t.context,n):v._makeDebugTileBoundsBuffers(t.context,n.projection);const G=v._tileDebugBuffer||t.debugBuffer,q=v._tileDebugIndexBuffer||t.debugIndexBuffer,$=v._tileDebugSegments||t.debugSegments;_.draw(t,s.LINE_STRIP,E,C,B,Or.disabled,jb(p,pr.red),O,G,q,$,null,null,null,[v._globeTileDebugBorderBuffer]);const J=v.latestRawTileData,ie=Math.floor((J&&J.byteLength||0)/1024),re=e.getTile(i).tileSize,te=512/Math.min(re,512)*(i.overscaledZ/n.zoom)*.5;let se=i.canonical.toString();i.overscaledZ!==i.canonical.z&&(se+=` => ${i.overscaledZ}`),se+=` ${ie}kb`,function(Ce,Ne){Ce.initDebugOverlayCanvas();const je=Ce.debugOverlayCanvas,Ye=Ce.context.gl,Re=Ce.debugOverlayCanvas.getContext("2d");Re.clearRect(0,0,je.width,je.height),Re.shadowColor="white",Re.shadowBlur=2,Re.lineWidth=1.5,Re.strokeStyle="white",Re.textBaseline="top",Re.font="bold 36px Open Sans, sans-serif",Re.fillText(Ne,5,5),Re.strokeText(Ne,5,5),Ce.debugOverlayTexture.update(je),Ce.debugOverlayTexture.bind(Ye.LINEAR,Ye.CLAMP_TO_EDGE)}(t,se);const he=v._tileDebugTextBuffer||t.debugBuffer,ve=v._tileDebugTextIndexBuffer||t.quadTriangleIndexBuffer,be=v._tileDebugTextSegments||t.debugSegments;_.draw(t,s.TRIANGLES,E,C,dn.alphaBlended,Or.disabled,jb(p,pr.transparent,te),O,he,ve,be,null,null,null,[v._globeTileDebugTextBuffer])}function Jb(t,e,i,r){h_(t,0,e+i/2,t.transform.width,i,r)}function ew(t,e,i,r){h_(t,e-i/2,0,i,t.transform.height,r)}function h_(t,e,i,r,n,s){const a=t.context,c=a.gl;c.enable(c.SCISSOR_TEST),c.scissor(e*Xi.devicePixelRatio,i*Xi.devicePixelRatio,r*Xi.devicePixelRatio,n*Xi.devicePixelRatio),a.clear({color:s}),c.disable(c.SCISSOR_TEST)}const V4=un([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:N4}=V4;function _h(t,e,i,r){t.emplaceBack(e,i,r)}class tw{constructor(e){this.vertexArray=new Lc,this.indices=new Ys,_h(this.vertexArray,-1,-1,1),_h(this.vertexArray,1,-1,1),_h(this.vertexArray,-1,1,1),_h(this.vertexArray,1,1,1),_h(this.vertexArray,-1,-1,-1),_h(this.vertexArray,1,-1,-1),_h(this.vertexArray,-1,1,-1),_h(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=e.createVertexBuffer(this.vertexArray,N4),this.indexBuffer=e.createIndexBuffer(this.indices),this.segment=wn.simpleSegment(0,0,36,12)}}function _f(t,e,i,r,n,s){const a=t.context.gl,c=e.paint.get("sky-atmosphere-color"),p=e.paint.get("sky-atmosphere-halo-color"),_=e.paint.get("sky-atmosphere-sun-intensity"),v=((E,C,B,O,G)=>({u_matrix_3f:E,u_sun_direction:C,u_sun_intensity:B,u_color_tint_r:[O.r,O.g,O.b,O.a],u_color_tint_m:[G.r,G.g,G.b,G.a],u_luminance:5e-5}))(Ee.fromMat4(Ee.create(),r),n,_,c,p);a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_CUBE_MAP_POSITIVE_X+s,e.skyboxTexture,0),i.draw(t,a.TRIANGLES,cr.disabled,Lr.disabled,dn.unblended,Or.frontCW,v,"skyboxCapture",e.skyboxGeometry.vertexBuffer,e.skyboxGeometry.indexBuffer,e.skyboxGeometry.segment)}const U4=un([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class j4{constructor(e){const i=new Cu;i.emplaceBack(-1,1,1,0,0),i.emplaceBack(1,1,1,1,0),i.emplaceBack(1,-1,1,1,1),i.emplaceBack(-1,-1,1,0,1);const r=new Ys;r.emplaceBack(0,1,2),r.emplaceBack(2,3,0),this.vertexBuffer=e.createVertexBuffer(i,U4.members),this.indexBuffer=e.createIndexBuffer(r),this.segments=wn.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const G4=un([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Z4{constructor(){this.colorModeAlphaBlendedWriteRGB=new dn([1,jm,1,jm],pr.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new dn([1,0,1,0],pr.transparent,[!1,!1,!1,!0])}update(e){const i=e.context;if(!this.atmosphereBuffer){this.atmosphereBuffer=new j4(i);const r=100,n=200,s=function(v){const E=b(30),C=[];for(let B=0;B<16e3;++B){const O=2*Math.PI*E(),G=Math.acos(1-2*E())-.5*Math.PI;C.push(_e.fromValues(Math.cos(G)*Math.cos(O),Math.cos(G)*Math.sin(O),Math.sin(G)))}return C}(),a=b(300),c=new Zf,p=new Ys;let _=0;for(let v=0;v<s.length;++v){const E=_e.scale([],s[v],200),C=Math.max(0,1+.01*r*(1*a()-.5)),B=Math.max(0,1+.01*n*(1*a()-.5));c.emplaceBack(E[0],E[1],E[2],-1,-1,C,B),c.emplaceBack(E[0],E[1],E[2],1,-1,C,B),c.emplaceBack(E[0],E[1],E[2],1,1,C,B),c.emplaceBack(E[0],E[1],E[2],-1,1,C,B),p.emplaceBack(_+0,_+1,_+2),p.emplaceBack(_+0,_+2,_+3),_+=4}this.starsVx=i.createVertexBuffer(c,G4.members),this.starsIdx=i.createIndexBuffer(p),this.starsSegments=wn.simpleSegment(0,0,c.length,p.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(e,i){const r=e.context,n=r.gl,s=e.transform,a=new cr(n.LEQUAL,cr.ReadOnly,[0,1]),c=Uo(s.zoom),p=i.properties.get("color").toArray01(),_=i.properties.get("high-color").toArray01(),v=i.properties.get("space-color").toArray01PremultipliedAlpha(),E=5e-4,C=hi((i.properties.get("horizon-blend")-0)/1*.2495+E,5e-4,.25),B=rm(e,r,s)&&C===E?s.worldSize/(2*Math.PI*1.025)-1:s.globeRadius,O=e.frameCounter/1e3%1,G=_e.length(s.globeCenterInViewSpace),q=Math.sqrt(Math.pow(G,2)-Math.pow(B,2)),$=Math.acos(q/G),J=ie=>{const re=s.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];ie&&re.push("ALPHA_PASS");const te=e.getOrCreateProgram("globeAtmosphere",{defines:re}),se=((ve,be,Ce,Ne,je,Ye,Re,rt,lt,vt,it,at)=>({u_frustum_tl:ve,u_frustum_tr:be,u_frustum_br:Ce,u_frustum_bl:Ne,u_horizon:je,u_transition:Ye,u_fadeout_range:Re,u_color:rt,u_high_color:lt,u_space_color:vt,u_temporal_offset:it,u_horizon_angle:at}))(s.frustumCorners.TL,s.frustumCorners.TR,s.frustumCorners.BR,s.frustumCorners.BL,s.frustumCorners.horizon,c,C,p,_,v,O,$);e.uploadCommonUniforms(r,te);const he=this.atmosphereBuffer;he&&te.draw(e,n.TRIANGLES,a,Lr.disabled,ie?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Or.backCW,se,ie?"atmosphere_glow_alpha":"atmosphere_glow",he.vertexBuffer,he.indexBuffer,he.segments)};J(!1),J(!0)}drawStars(e,i){const r=hi(i.properties.get("star-intensity"),0,1);if(r===0)return;const n=e.context,s=n.gl,a=e.transform,c=e.getOrCreateProgram("stars"),p=ot.identity([]);ot.rotateX(p,p,-a._pitch),ot.rotateZ(p,p,-a.angle),ot.rotateX(p,p,Li(a._center.lat)),ot.rotateY(p,p,-Li(a._center.lng));const _=ce.fromQuat(new Float32Array(16),p),v=ce.multiply([],a.starsProjMatrix,_),E=Ee.fromMat4([],_),C=Ee.invert([],E),B=[0,1,0];_e.transformMat3(B,B,C),_e.scale(B,B,.15);const O=[1,0,0];_e.transformMat3(O,O,C),_e.scale(O,O,.15);const G=((q,$,J,ie)=>({u_matrix:Float32Array.from(q),u_up:$,u_right:J,u_intensity_multiplier:ie}))(v,B,O,r);e.uploadCommonUniforms(n,c),this.starsVx&&this.starsIdx&&c.draw(e,s.TRIANGLES,cr.disabled,Lr.disabled,this.colorModeAlphaBlendedWriteRGB,Or.disabled,G,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function iw(t,e){const i=[...t],r=e.cameraWorldSizeForFog/e.worldSize,n=ce.identity([]);return ce.scale(n,n,[r,r,1]),ce.multiply(i,n,i),ce.multiply(i,e.worldToFogMatrix,i),i}function _y(t,e,i,r){const n=i.material,s=r.context,{baseColorTexture:a,metallicRoughnessTexture:c}=n.pbrMetallicRoughness,{normalTexture:p,occlusionTexture:_,emissionTexture:v}=n;function E(C,B,O){if(C&&(t.push(B),s.activeTexture.set(s.gl.TEXTURE0+O),C.gfxTexture)){const{minFilter:G,magFilter:q,wrapS:$,wrapT:J}=C.sampler;C.gfxTexture.bindExtraParam(G,q,$,J)}}E(a,"HAS_TEXTURE_u_baseColorTexture",MA.BaseColor),E(c,"HAS_TEXTURE_u_metallicRoughnessTexture",MA.MetallicRoughness),E(p,"HAS_TEXTURE_u_normalTexture",MA.Normal),E(_,"HAS_TEXTURE_u_occlusionTexture",MA.Occlusion),E(v,"HAS_TEXTURE_u_emissionTexture",MA.Emission),i.texcoordBuffer&&(t.push("HAS_ATTRIBUTE_a_uv_2f"),e.push(i.texcoordBuffer)),i.colorBuffer&&(t.push(i.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),e.push(i.colorBuffer)),i.normalBuffer&&(t.push("HAS_ATTRIBUTE_a_normal_3f"),e.push(i.normalBuffer)),i.pbrBuffer&&(t.push("HAS_ATTRIBUTE_a_pbr"),t.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),e.push(i.pbrBuffer)),n.alphaMode!=="OPAQUE"&&n.alphaMode!=="MASK"||t.push("UNPREMULT_TEXTURE_IN_SHADER"),n.defined||t.push("DIFFUSE_SHADED"),t.push("USE_STANDARD_DERIVATIVES")}function d_(t,e,i,r,n,s){const a=i.paint.get("model-opacity"),c=e.context,p=new cr(e.context.gl.LEQUAL,cr.ReadWrite,e.depthRangeFor3D),_=e.transform,v=t.mesh,E=v.material,C=E.pbrMetallicRoughness,B=e.style.fog;let O;O=e.transform.projection.zAxisUnit==="pixels"?[...t.nodeModelMatrix]:ce.multiply([],r.zScaleMatrix,t.nodeModelMatrix),ce.multiply(O,r.negCameraPosMatrix,O);const G=ce.invert([],O);ce.transpose(G,G);const q=i.paint.get("model-emissive-strength").constantOr(0),$=py(new Float32Array(t.worldViewProjection),new Float32Array(O),new Float32Array(G),e,a,C.baseColorFactor,E.emissiveFactor,C.metallicFactor,C.roughnessFactor,E,q,i),J={defines:[]},ie=[];_y(J.defines,ie,v,e);const re=e.shadowRenderer;re&&(re.useNormalOffset=!1);let te=null;if(B){const ve=iw(t.nodeModelMatrix,e.transform);if(te=new Float32Array(ve),_.projection.name!=="globe"){const be=v.aabb.min,Ce=v.aabb.max,[Ne,je]=B.getOpacityForBounds(ve,be[0],be[1],Ce[0],Ce[1]);J.overrideFog=Ne>=Jh||je>=Jh}}const se=ff(e,i.paint.get("model-cutoff-fade-range"));se.shouldRenderCutoff&&J.defines.push("RENDER_CUTOFF");const he=e.getOrCreateProgram("model",J);e.uploadCommonUniforms(c,he,null,te,se),e.renderPass!=="shadow"&&re&&re.setupShadowsFromMatrix(t.nodeModelMatrix,he),he.draw(e,c.gl.TRIANGLES,p,n,s,v.material.doubleSided?Or.disabled:Or.backCCW,$,i.id,v.vertexBuffer,v.indexBuffer,v.segments,i.paint,e.transform.zoom,void 0,ie)}function rw(t,e,i,r,n,s,a){let c;c=t.projection.name==="globe"?Xx(i,t):[...i],ce.multiply(c,c,e.matrix);const p=ce.multiply([],r,c);if(e.meshes)for(const _ of e.meshes){if(_.material.alphaMode!=="BLEND"){a.push({mesh:_,depth:0,modelIndex:n,worldViewProjection:p,nodeModelMatrix:c});continue}const v=_e.transformMat4([],_.centroid,p);v[2]>0&&s.push({mesh:_,depth:v[2],modelIndex:n,worldViewProjection:p,nodeModelMatrix:c})}if(e.children)for(const _ of e.children)rw(t,_,i,r,n,s,a)}function gy(t,e,i,r){const n=i.shadowRenderer;if(!n)return;const s=n.getShadowPassDepthMode(),a=n.getShadowPassColorMode(),c=n.calculateShadowPassMatrixFromMatrix(e),p=Wb(c);i.getOrCreateProgram("modelDepth",{defines:["DEPTH_TEXTURE"]}).draw(i,i.context.gl.TRIANGLES,s,Lr.disabled,a,Or.backCCW,p,r.id,t.vertexBuffer,t.indexBuffer,t.segments,r.paint,i.transform.zoom,void 0,void 0)}function q4(t,e,i){const r=e.updateZoomBasedPaintProperties(),n=function(s,a,c){let p,_,v,E=s.terrain?s.terrain.exaggeration():0;if(s.terrain&&E>0){const C=s.terrain,B=C.findDEMTileFor(c);B&&B.dem?p=rf.create(C,c,B):E=0}if(E===0&&(a.terrainElevationMin=0,a.terrainElevationMax=0),E===a.validForExaggeration&&(E===0||p&&p._demTile&&p._demTile.tileID===a.validForDEMTile.id&&p._dem._timestamp===a.validForDEMTile.timestamp))return!1;for(const C in a.instancesPerModel){const B=a.instancesPerModel[C];for(let O=0;O<B.instancedDataArray.length;++O){const G=(p?E*p.getElevationAt(0|B.instancedDataArray.float32[16*O],0|B.instancedDataArray.float32[16*O+1],!0,!0):0)+B.instancesEvaluatedElevation[O];B.instancedDataArray.float32[16*O+6]=G,_=_?Math.min(a.terrainElevationMin,G):G,v=v?Math.max(a.terrainElevationMax,G):G}}return a.terrainElevationMin=_||0,a.terrainElevationMax=v||0,a.validForExaggeration=E,a.validForDEMTile=p&&p._demTile?{id:p._demTile.tileID,timestamp:p._dem._timestamp}:{id:void 0,timestamp:0},!0}(t,e,i);(r||n)&&(e.uploaded=!1,e.upload(t.context))}const _u={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new $r([0,0,0],[Mt,Mt,0])};function Q4(t,e){const i=1<<t.canonical.z,r=e.getFreeCameraOptions().position,n=e.elevation,s=t.canonical.x/i,a=(t.canonical.x+1)/i,c=t.canonical.y/i,p=(t.canonical.y+1)/i;let _=e._centerAltitude;if(n){const B=n.getMinMaxForTile(t);B&&B.max>_&&(_=B.max)}const v=hi(r.x,s,a)-r.x,E=hi(r.y,c,p)-r.y,C=On(_,e.center.lat)-r.z;return e._zoomFromMercatorZ(Math.sqrt(v*v+E*E+C*C))}function nw(t,e,i,r,n,s,a){const c=t.context,p=t.renderPass==="shadow",_=t.shadowRenderer,v=p&&_?_.getShadowPassDepthMode():new cr(c.gl.LEQUAL,cr.ReadWrite,t.depthRangeFor3D),E=t.isTileAffectedByFog(s);if(i.meshes)for(const C of i.meshes){const B=["MODEL_POSITION_ON_GPU"],O=[];let G,q,$;r.instancedDataArray.length>20&&B.push("INSTANCED_ARRAYS");const J=ff(t,e.paint.get("model-cutoff-fade-range"));if(J.shouldRenderCutoff&&B.push("RENDER_CUTOFF"),p&&_)G=t.getOrCreateProgram("modelDepth",{defines:B}),q=Wb(a.shadowTileMatrix,a.shadowTileMatrix,Float32Array.from(i.matrix)),$=_.getShadowPassColorMode();else{_y(B,O,C,t),G=t.getOrCreateProgram("model",{defines:B,overrideFog:E});const re=C.material,te=re.pbrMetallicRoughness,se=e.paint.get("model-opacity"),he=e.paint.get("model-emissive-strength").constantOr(0);q=py(s.expandedProjMatrix,Float32Array.from(i.matrix),new Float32Array(16),t,se,te.baseColorFactor,re.emissiveFactor,te.metallicFactor,te.roughnessFactor,re,he,e,n),_&&(a.shadowUniformsInitialized?G.setShadowUniformValues(c,_.getShadowUniformValues()):(_.setupShadows(s.toUnwrapped(),G,"model-tile",s.overscaledZ),a.shadowUniformsInitialized=!0)),$=J.shouldRenderCutoff||se<1||re.alphaMode!=="OPAQUE"?dn.alphaBlended:dn.unblended}t.uploadCommonUniforms(c,G,s.toUnwrapped(),null,J);const ie=C.material.doubleSided?Or.disabled:Or.backCCW;if(r.instancedDataArray.length>20)O.push(r.instancedDataBuffer),G.draw(t,c.gl.TRIANGLES,v,Lr.disabled,$,ie,q,e.id,C.vertexBuffer,C.indexBuffer,C.segments,e.paint,t.transform.zoom,void 0,O,r.instancedDataArray.length);else{const re=p?"u_instance":"u_normal_matrix";for(let te=0;te<r.instancedDataArray.length;++te)q[re]=new Float32Array(r.instancedDataArray.arrayBuffer,64*te,16),G.draw(t,c.gl.TRIANGLES,v,Lr.disabled,$,ie,q,e.id,C.vertexBuffer,C.indexBuffer,C.segments,e.paint,t.transform.zoom,void 0,O)}}if(i.children)for(const C of i.children)nw(t,e,C,r,n,s,a)}const H4=[1,-1,1];function W4(t,e,i,r){if(!i.modelManager)return!0;const n=i.modelManager;if(!i.shadowRenderer)return!0;const s=i.shadowRenderer,a=e.aabb;let c=!0,p=t.maxHeight;if(p===0){let v=0;for(const E in t.instancesPerModel){const C=n.getModel(E,r);C?v=Math.max(v,Math.max(Math.max(C.aabb.max[0],C.aabb.max[1]),C.aabb.max[2])):c=!1}p=t.maxScale*v*1.41+t.maxVerticalOffset,c&&(t.maxHeight=p)}a.max[2]=p,a.min[2]+=t.terrainElevationMin,a.max[2]+=t.terrainElevationMax,_e.transformMat4(a.min,a.min,e.tileMatrix),_e.transformMat4(a.max,a.max,e.tileMatrix);const _=a.intersects(s.getCurrentCascadeFrustum());return i.currentShadowCascade===0&&(t.isInsideFirstShadowMapFrustum=_===2),_===0}class $4{}class X4{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(e,i,r){{const E=this._storage.get(i.id);if(E)return E.lastUsedFrameIdx=e,E.buf}const n=r.gl,s=n.getBufferParameter(n.ELEMENT_ARRAY_BUFFER,n.BUFFER_SIZE),a=new ArrayBuffer(s),c=new Int16Array(a);n.getBufferSubData(n.ELEMENT_ARRAY_BUFFER,0,new Int16Array(a));const p=new zc;for(let E=0;E<s/2;E+=3){const C=c[E],B=c[E+1],O=c[E+2];p.emplaceBack(C,B),p.emplaceBack(B,O),p.emplaceBack(O,C)}const _=r.bindVertexArrayOES.current,v=new $4;return v.buf=new fh(r,p),v.lastUsedFrameIdx=e,this._storage.set(i.id,v),r.bindVertexArrayOES.set(_),v.buf}update(e){for(const[i,r]of this._storage)e-r.lastUsedFrameIdx>30&&(r.buf.destroy(),this._storage.delete(i))}destroy(){for(const[e,i]of this._storage)i.buf.destroy(),this._storage.delete(e)}}const sw={symbol:function(t,e,i,r,n){if(t.renderPass!=="translucent")return;const s=Lr.disabled,a=t.colorModeForRenderPass();i.layout.get("text-variable-anchor")&&function(c,p,_,v,E,C,B){const O=p.transform,G=E==="map",q=C==="map";for(const $ of c){const J=v.getTile($),ie=J.getBucket(_);if(!ie||!ie.text||!ie.text.segments.get().length)continue;const re=hu(ie.textSizeData,O.zoom),te=ly($,ie.getProjection(),O),se=O.calculatePixelsToTileUnitsMatrix(J),he=Zm(te,J.tileID.canonical,q,G,O,ie.getProjection(),se),ve=ie.hasIconTextFit()&&ie.hasIconData();if(re){const be=Math.pow(2,O.zoom-J.tileID.overscaledZ);E4(ie,G,q,B,H3,O,he,$,be,re,ve)}}}(r,t,i,e,i.layout.get("text-rotation-alignment"),i.layout.get("text-pitch-alignment"),n),i.paint.get("icon-opacity").constantOr(1)!==0&&Yb(t,e,i,r,!1,i.paint.get("icon-translate"),i.paint.get("icon-translate-anchor"),i.layout.get("icon-rotation-alignment"),i.layout.get("icon-pitch-alignment"),i.layout.get("icon-keep-upright"),i.paint.get("icon-color-saturation"),s,a),i.paint.get("text-opacity").constantOr(1)!==0&&Yb(t,e,i,r,!0,i.paint.get("text-translate"),i.paint.get("text-translate-anchor"),i.layout.get("text-rotation-alignment"),i.layout.get("text-pitch-alignment"),i.layout.get("text-keep-upright"),i.paint.get("icon-color-saturation"),s,a),e.map.showCollisionBoxes&&($b(t,e,i,r,i.paint.get("text-translate"),i.paint.get("text-translate-anchor"),!0),$b(t,e,i,r,i.paint.get("icon-translate"),i.paint.get("icon-translate-anchor"),!1))},circle:function(t,e,i,r){if(t.renderPass!=="translucent")return;const n=i.paint.get("circle-opacity"),s=i.paint.get("circle-stroke-width"),a=i.paint.get("circle-stroke-opacity"),c=i.layout.get("circle-sort-key").constantOr(1)!==void 0,p=i.paint.get("circle-emissive-strength");if(n.constantOr(1)===0&&(s.constantOr(1)===0||a.constantOr(1)===0))return;const _=t.context,v=_.gl,E=t.transform,C=t.depthModeForSublayer(0,cr.ReadOnly),B=Lr.disabled,O=t.colorModeForDrapableLayerRenderPass(p),G=E.projection.name==="globe",q=[jo(E.center.lng),ea(E.center.lat)],$=[];for(let ie=0;ie<r.length;ie++){const re=r[ie],te=e.getTile(re),se=te.getBucket(i);if(!se||se.projection.name!==E.projection.name)continue;const he=se.programConfigurations.get(i.id),ve=v1(i),be=t.isTileAffectedByFog(re);G&&ve.push("PROJECTION_GLOBE_VIEW");const Ce=t.getOrCreateProgram("circle",{config:he,defines:ve,overrideFog:be}),Ne=se.layoutVertexBuffer,je=se.globeExtVertexBuffer,Ye=se.indexBuffer,Re=E.projection.createInversionMatrix(E,re.canonical),rt={programConfiguration:he,program:Ce,layoutVertexBuffer:Ne,globeExtVertexBuffer:je,indexBuffer:Ye,uniformValues:U2(t,re,te,Re,q,i),tile:te};if(c){const lt=se.segments.get();for(const vt of lt)$.push({segments:new wn([vt]),sortKey:vt.sortKey,state:rt})}else $.push({segments:se.segments,sortKey:0,state:rt})}c&&$.sort((ie,re)=>ie.sortKey-re.sortKey);const J={useDepthForOcclusion:E.depthOcclusionForSymbolsAndCircles};for(const ie of $){const{programConfiguration:re,program:te,layoutVertexBuffer:se,globeExtVertexBuffer:he,indexBuffer:ve,uniformValues:be,tile:Ce}=ie.state,Ne=ie.segments;t.terrain&&t.terrain.setupElevationDraw(Ce,te,J),t.uploadCommonUniforms(_,te,Ce.tileID.toUnwrapped()),te.draw(t,v.TRIANGLES,C,B,O,Or.disabled,be,i.id,se,ve,Ne,i.paint,E.zoom,re,[he])}},heatmap:function(t,e,i,r){if(i.paint.get("heatmap-opacity")!==0)if(t.renderPass==="offscreen"){const n=t.context,s=n.gl,a=Lr.disabled,c=new dn([s.ONE,s.ONE,s.ONE,s.ONE],pr.transparent,[!0,!0,!0,!0]);(function(B,O,G,q){const $=B.gl,J=O.width*q,ie=O.height*q;B.activeTexture.set($.TEXTURE1),B.viewport.set([0,0,J,ie]);let re=G.heatmapFbo;if(!re||re&&(re.width!==J||re.height!==ie)){re&&re.destroy();const te=$.createTexture();$.bindTexture($.TEXTURE_2D,te),$.texParameteri($.TEXTURE_2D,$.TEXTURE_WRAP_S,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_2D,$.TEXTURE_WRAP_T,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_2D,$.TEXTURE_MIN_FILTER,$.LINEAR),$.texParameteri($.TEXTURE_2D,$.TEXTURE_MAG_FILTER,$.LINEAR),re=G.heatmapFbo=B.createFramebuffer(J,ie,!0,null),function(se,he,ve,be,Ce,Ne){const je=se.gl;je.texImage2D(je.TEXTURE_2D,0,se.extRenderToTextureHalfFloat?je.RGBA16F:je.RGBA,Ce,Ne,0,je.RGBA,se.extRenderToTextureHalfFloat?je.HALF_FLOAT:je.UNSIGNED_BYTE,null),be.colorAttachment.set(ve)}(B,0,te,re,J,ie)}else $.bindTexture($.TEXTURE_2D,re.colorAttachment.get()),B.bindFramebuffer.set(re.framebuffer)})(n,t,i,t.transform.projection.name==="globe"?.5:.25),n.clear({color:pr.transparent});const p=t.transform,_=p.projection.name==="globe",v=_?["PROJECTION_GLOBE_VIEW"]:[],E=_?Or.frontCCW:Or.disabled,C=[jo(p.center.lng),ea(p.center.lat)];for(let B=0;B<r.length;B++){const O=r[B];if(e.hasRenderableParent(O))continue;const G=e.getTile(O),q=G.getBucket(i);if(!q||q.projection.name!==p.projection.name)continue;const $=t.isTileAffectedByFog(O),J=q.programConfigurations.get(i.id),ie=t.getOrCreateProgram("heatmap",{config:J,defines:v,overrideFog:$}),{zoom:re}=t.transform;t.terrain&&t.terrain.setupElevationDraw(G,ie),t.uploadCommonUniforms(n,ie,O.toUnwrapped());const te=p.projection.createInversionMatrix(p,O.canonical);ie.draw(t,s.TRIANGLES,cr.disabled,a,c,E,m4(t,O,G,te,C,re,i.paint.get("heatmap-intensity")),i.id,q.layoutVertexBuffer,q.indexBuffer,q.segments,i.paint,t.transform.zoom,J,_?[q.globeExtVertexBuffer]:null)}n.viewport.set([0,0,t.width,t.height])}else t.renderPass==="translucent"&&(t.context.setColorMode(t.colorModeForRenderPass()),function(n,s){const a=n.context,c=a.gl,p=s.heatmapFbo;if(!p)return;a.activeTexture.set(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,p.colorAttachment.get()),a.activeTexture.set(c.TEXTURE1);let _=s.colorRampTexture;_||(_=s.colorRampTexture=new ks(a,s.colorRamp,c.RGBA)),_.bind(c.LINEAR,c.CLAMP_TO_EDGE),n.getOrCreateProgram("heatmapTexture").draw(n,c.TRIANGLES,cr.disabled,Lr.disabled,n.colorModeForRenderPass(),Or.disabled,((v,E,C,B)=>({u_image:0,u_color_ramp:1,u_opacity:E.paint.get("heatmap-opacity")}))(0,s),s.id,n.viewportBuffer,n.quadTriangleIndexBuffer,n.viewportSegments,s.paint,n.transform.zoom)}(t,i))},line:function(t,e,i,r){if(t.renderPass!=="translucent")return;const n=i.paint.get("line-opacity"),s=i.paint.get("line-width");if(n.constantOr(1)===0||s.constantOr(1)===0)return;const a=i.paint.get("line-emissive-strength"),c=t.depthModeForSublayer(0,cr.ReadOnly),p=t.colorModeForDrapableLayerRenderPass(a),_=t.terrain&&t.terrain.renderingToTexture?1:Xi.devicePixelRatio,v=i.paint.get("line-dasharray"),E=v.constantOr(1),C=i.layout.get("line-cap"),B=i.paint.get("line-pattern"),O=B.constantOr(1),G=i.paint.get("line-pattern").constantOr(1),q=i.paint.get("line-opacity").constantOr(1)!==1;let $=!G&&q;const J=i.paint.get("line-gradient"),ie=O?"linePattern":"line",re=t.context,te=re.gl,se=Iv(i);t.terrain&&t.terrain.clipOrMaskOverlapStencilType()&&($=!1);for(const he of r){const ve=e.getTile(he);if(O&&!ve.patternsLoaded())continue;const be=ve.getBucket(i);if(!be)continue;t.prepareDrawTile();const Ce=be.programConfigurations.get(i.id),Ne=t.isTileAffectedByFog(he),je=t.getOrCreateProgram(ie,{config:Ce,defines:se,overrideFog:Ne}),Ye=B.constantOr(null);if(Ye&&ve.imageAtlas){const It=ve.imageAtlas.patternPositions[Ye.toString()];It&&Ce.setConstantPatternPositions(It)}const Re=v.constantOr(null),rt=C.constantOr(null);if(!O&&Re&&rt&&ve.lineAtlas){const It=ve.lineAtlas.getDash(Re,rt);It&&Ce.setConstantPatternPositions(It)}let[lt,vt]=i.paint.get("line-trim-offset");(rt==="round"||rt==="square")&&lt!==vt&&(lt===0&&(lt-=1),vt===1&&(vt+=1));const it=t.terrain?he.projMatrix:null,at=O?QE(t,ve,i,it,_):qE(t,ve,i,it,be.lineClipsArray.length,_,[lt,vt]);if(J){const It=be.gradients[i.id];let St=It.texture;if(i.gradientVersion!==It.version){let Lt=256;if(i.stepInterpolant){const Ot=e.getSource().maxzoom,jt=he.canonical.z===Ot?Math.ceil(1<<t.transform.maxZoom-he.canonical.z):1;Lt=hi(La(be.maxLineLength/Mt*1024*jt),256,re.maxTextureSize)}It.gradient=cm({expression:i.gradientExpression(),evaluationKey:"lineProgress",resolution:Lt,image:It.gradient||void 0,clips:be.lineClipsArray}),It.texture?It.texture.update(It.gradient):It.texture=new ks(re,It.gradient,te.RGBA),It.version=i.gradientVersion,St=It.texture}re.activeTexture.set(te.TEXTURE1),St.bind(i.stepInterpolant?te.NEAREST:te.LINEAR,te.CLAMP_TO_EDGE)}E&&(re.activeTexture.set(te.TEXTURE0),ve.lineAtlasTexture&&ve.lineAtlasTexture.bind(te.LINEAR,te.REPEAT),Ce.updatePaintBuffers()),O&&(re.activeTexture.set(te.TEXTURE0),ve.imageAtlasTexture&&ve.imageAtlasTexture.bind(te.LINEAR,te.CLAMP_TO_EDGE),Ce.updatePaintBuffers()),t.uploadCommonUniforms(re,je,he.toUnwrapped());const Tt=It=>{je.draw(t,te.TRIANGLES,c,It,p,Or.disabled,at,i.id,be.layoutVertexBuffer,be.indexBuffer,be.segments,i.paint,t.transform.zoom,Ce,[be.layoutVertexBuffer2])};if($){const It=t.stencilModeForClipping(he).ref;It===0&&t.terrain&&re.clear({stencil:0});const St={func:te.EQUAL,mask:255};at.u_alpha_discard_threshold=.8,Tt(new Lr(St,It,255,te.KEEP,te.KEEP,te.INVERT)),at.u_alpha_discard_threshold=0,Tt(new Lr(St,It,255,te.KEEP,te.KEEP,te.KEEP))}else Tt(t.stencilModeForClipping(he))}$&&(t.resetStencilClippingMasks(),t.terrain&&re.clear({stencil:0}))},fill:function(t,e,i,r){const n=i.paint.get("fill-color"),s=i.paint.get("fill-opacity");if(s.constantOr(1)===0)return;const a=i.paint.get("fill-emissive-strength"),c=t.colorModeForDrapableLayerRenderPass(a),p=i.paint.get("fill-pattern"),_=t.opaquePassEnabledForLayer()&&!p.constantOr(1)&&n.constantOr(pr.transparent).a===1&&s.constantOr(0)===1?"opaque":"translucent";if(t.renderPass===_){const v=t.depthModeForSublayer(1,t.renderPass==="opaque"?cr.ReadWrite:cr.ReadOnly);Kb(t,e,i,r,v,c,!1)}if(t.renderPass==="translucent"&&i.paint.get("fill-antialias")){const v=t.depthModeForSublayer(i.getPaintProperty("fill-outline-color")?2:0,cr.ReadOnly);Kb(t,e,i,r,v,c,!0)}},"fill-extrusion":function(t,e,i,r){const n=i.paint.get("fill-extrusion-opacity"),s=t.context,a=s.gl,c=t.terrain,p=c&&c.renderingToTexture,_=i.paint.get("fill-extrusion-cutoff-fade-range");if(n===0)return;const v=t.conflationActive&&t.layerUsedInConflation(i,e.getSource());if(v&&function(E,C,B,O){for(const G of O){const q=C.getTile(G).getBucket(B);q&&(q.updateReplacement(G,E.replacementSource),q.uploadCentroid(E.context))}}(t,e,i,r),c||v)for(const E of r){const C=e.getTile(E).getBucket(i);C&&S4(t.context,e,E,C,i,c,v)}if(t.renderPass==="shadow"&&t.shadowRenderer){const E=t.shadowRenderer;if(c&&n<.65&&i._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof kn)return;const C=E.getShadowPassDepthMode(),B=E.getShadowPassColorMode();u_(t,e,i,r,C,Lr.disabled,B,v)}else if(t.renderPass==="translucent"){const E=!i.paint.get("fill-extrusion-pattern").constantOr(1);if(!p){const C=new cr(t.context.gl.LEQUAL,cr.ReadWrite,t.depthRangeFor3D);_===0&&n===1&&E?u_(t,e,i,r,C,Lr.disabled,dn.unblended,v):(u_(t,e,i,r,C,Lr.disabled,dn.disabled,v),u_(t,e,i,r,C,t.stencilModeFor3D(),t.colorModeForRenderPass(),v),t.resetStencilClippingMasks())}if(t.style.enable3dLights()&&E&&(!c&&t.transform.projection.name!=="globe"||p)){const C=i.paint.get("fill-extrusion-opacity"),B=i.paint.get("fill-extrusion-ambient-occlusion-intensity"),O=i.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),G=i.paint.get("fill-extrusion-flood-light-intensity"),q=i.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),$=B>0&&O>0,J=G>0,ie=(te,se,he)=>(1-he)*te+he*se,re=te=>{const se=t.depthModeForSublayer(1,cr.ReadOnly,a.LEQUAL,!0),he=i.paint.get(te?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),ve=ie(.1,3,he),be=t._showOverdrawInspector;if(!be){const Ce=new Lr({func:a.ALWAYS,mask:255},255,255,a.KEEP,a.KEEP,a.REPLACE),Ne=new dn([a.ONE,a.ONE,a.ONE,a.ONE],pr.transparent,[!1,!1,!1,!0],a.MIN);mf(t,e,i,r,se,Ce,Ne,Or.disabled,te,"sdf",C,B,O,G,q,ve,v,!1)}{const Ce=be?Lr.disabled:new Lr({func:a.EQUAL,mask:255},255,255,a.KEEP,a.DECR,a.DECR),Ne=be?t.colorModeForRenderPass():new dn([a.ONE_MINUS_DST_ALPHA,a.DST_ALPHA,a.ONE,a.ONE],pr.transparent,[!0,!0,!0,!0]);mf(t,e,i,r,se,Ce,Ne,Or.disabled,te,"color",C,B,O,G,q,ve,v,!1)}};if(p){const te=(se,he,ve)=>{const be=t.depthModeForSublayer(1,cr.ReadOnly,a.LEQUAL,!1),Ce=i.paint.get(se?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ne=ie(.1,3,Ce);{const je=new dn([a.ONE,a.ONE,a.ONE,a.ONE],pr.transparent,[!1,!1,!1,!0]);mf(t,e,i,r,be,Lr.disabled,je,Or.disabled,se,"clear",C,B,O,G,q,Ne,v,he)}{const je=new Lr({func:a.ALWAYS,mask:255},255,255,a.KEEP,a.KEEP,a.REPLACE),Ye=new dn([a.ONE,a.ONE,a.ONE,a.ONE],pr.transparent,[!1,!1,!1,!0],a.MIN);mf(t,e,i,r,be,je,Ye,Or.disabled,se,"sdf",C,B,O,G,q,Ne,v,he)}{const je=se?a.ZERO:a.ONE_MINUS_DST_ALPHA,Ye=new Lr({func:a.EQUAL,mask:255},255,255,a.KEEP,a.DECR,a.DECR),Re=new dn([je,a.DST_ALPHA,a.ONE_MINUS_DST_ALPHA,a.ZERO],pr.transparent,[!0,!0,!0,!0]);mf(t,e,i,r,be,Ye,Re,Or.disabled,se,"color",C,B,O,G,q,Ne,v,he)}{const je=new dn([a.ONE,a.ONE,a.ONE,se?a.ZERO:a.ONE],pr.transparent,[!1,!1,!1,!0],se?a.FUNC_ADD:a.MAX);mf(t,e,i,r,be,Lr.disabled,je,Or.disabled,se,"clear",C,B,O,G,q,Ne,v,he,ve)}};if($||J){let se;if(t.prepareDrawTile(),c){const he=c.drapeBufferSize[0],ve=c.drapeBufferSize[1];se=c.framebufferCopyTexture,se&&(!se||se.size[0]===he&&se.size[1]===ve)||(se&&se.destroy(),se=c.framebufferCopyTexture=new ks(s,new bo({width:he,height:ve}),a.RGBA)),se.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.copyTexImage2D(a.TEXTURE_2D,0,a.RGBA,0,0,he,ve,0)}$&&te(!0,!1,se),J&&te(!1,!0,se)}}else $&&re(!0),J&&re(!1)}}},hillshade:function(t,e,i,r){if(t.renderPass!=="offscreen"&&t.renderPass!=="translucent"||t.style.disableElevatedTerrain)return;const n=t.context,s=t.terrain&&t.terrain.renderingToTexture,[a,c]=t.renderPass!=="translucent"||s?[{},r]:t.stencilConfigForOverlap(r);for(const p of c){const _=e.getTile(p);if(_.needsHillshadePrepare&&t.renderPass==="offscreen")t4(t,_,i);else if(t.renderPass==="translucent"){const v=t.depthModeForSublayer(0,cr.ReadOnly),E=i.paint.get("hillshade-emissive-strength"),C=t.colorModeForDrapableLayerRenderPass(E),B=s&&t.terrain?t.terrain.stencilModeForRTTOverlap(p):a[p.overscaledZ];e4(t,p,_,i,v,B,C)}}n.viewport.set([0,0,t.width,t.height]),t.resetStencilClippingMasks()},raster:function(t,e,i,r,n,s){if(t.renderPass!=="translucent"||i.paint.get("raster-opacity")===0)return;const a=t.context,c=a.gl,p=e.getSource(),_=function(he,ve,be){const Ce=he.paint.get("raster-color"),Ne=[],je=he.paint.get("raster-resampling"),Ye=he.paint.get("raster-color-mix"),Re=he.paint.get("raster-color-range"),rt=[Ye[0],Ye[1],Ye[2],0],lt=Ye[3],vt=je==="nearest"?be.NEAREST:be.LINEAR;if(Ce&&Ne.push("RASTER_COLOR"),Ce){ve.activeTexture.set(be.TEXTURE2);let it=he.colorRampTexture;it||(it=he.colorRampTexture=new ks(ve,he.colorRamp,be.RGBA)),it.bind(be.LINEAR,be.CLAMP_TO_EDGE)}return{mix:rt,range:Re,offset:lt,defines:Ne,resampling:vt}}(i,a,c),v=_.defines,E=t.transform.projection.name==="globe";let C=!1;if(p instanceof xc&&!r.length){if(!E)return;if(p.onNorthPole)C=!0,v.push("GLOBE_POLES");else{if(!p.onSouthPole)return;C=!0,v.push("GLOBE_POLES")}}const B=i.paint.get("raster-emissive-strength"),O=t.colorModeForDrapableLayerRenderPass(B),G=t.terrain&&t.terrain.renderingToTexture,q=p instanceof xc&&i.paint.get("raster-elevation")!==0,$=!t.options.moving,J=i.paint.get("raster-resampling")==="nearest"?c.NEAREST:c.LINEAR;if(C){const he=e.getSource();if(!(he instanceof xc))return;const ve=he.texture;if(!ve)return;const be=t.globeSharedBuffers;if(!be)return;const Ce=new cr(c.LEQUAL,cr.ReadWrite,t.depthRangeFor3D),Ne=Float32Array.from(t.transform.expandedFarZProjMatrix);let je=im(0,0,t.transform);const Ye=Float32Array.from(dl(lo(new ci(0,0,0)))),Re={opacity:1,mix:0};t.terrain&&t.terrain.prepareDrawTile(),a.activeTexture.set(c.TEXTURE0),ve.bind(J,c.CLAMP_TO_EDGE),a.activeTexture.set(c.TEXTURE1),ve.bind(J,c.CLAMP_TO_EDGE),ve.useMipmap&&a.extTextureFilterAnisotropic&&t.transform.pitch>20&&c.texParameterf(c.TEXTURE_2D,a.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a.extTextureFilterAnisotropicMax);const[rt,lt,vt,it]=be.getPoleBuffers(0,!0);let at;he.onNorthPole?(at=rt,t.renderDefaultNorthPole=!1):(je=ce.scale(ce.create(),je,[1,-1,1]),at=lt,t.renderDefaultSouthPole=!1);const Tt=((St,Lt,Ot,jt,Dt,Kt,mi,_i,Ti,Mi,ur,Ui)=>Gb(St,Lt,Ot,new Float32Array(16),new Float32Array(9),[0,0],[0,0,0,0],0,[0,0],[0,0,0,0],1,jt,Dt,Kt||[0,0],mi,2,Ti,Mi,ur,1,0,Ui))(Ne,Ye,je,Re,i,he.perspectiveTransform||[0,0],i.paint.get("raster-elevation"),0,_.mix,_.offset,_.range,B),It=t.getOrCreateProgram("raster",{defines:_.defines});return t.uploadCommonUniforms(a,It,null),void It.draw(t,c.TRIANGLES,Ce,Lr.disabled,O,Or.disabled,Tt,i.id,at,vt,it)}if(!r.length)return;const[ie,re]=p instanceof xc||G?[{},r]:t.stencilConfigForOverlap(r),te=re[re.length-1].overscaledZ,se=q&&E;se&&_.defines.push("PROJECTION_GLOBE_VIEW"),q&&_.defines.push("RENDER_CUTOFF");for(const he of re){const ve=he.toUnwrapped(),be=e.getTile(he);if(G&&(!be||!be.hasData())||!be.texture)continue;let Ce,Ne;G?(Ce=cr.disabled,Ne=he.projMatrix):q?(Ce=new cr(c.LEQUAL,cr.ReadWrite,t.depthRangeFor3D),Ne=E?Float32Array.from(t.transform.expandedFarZProjMatrix):t.transform.calculateProjMatrix(ve,$)):(Ce=t.depthModeForSublayer(he.overscaledZ-te,i.paint.get("raster-opacity")===1?cr.ReadWrite:cr.ReadOnly,c.LESS),Ne=t.transform.calculateProjMatrix(ve,$));const je=t.terrain&&G?t.terrain.stencilModeForRTTOverlap(he):ie[he.overscaledZ],Ye=s?0:i.paint.get("raster-fade-duration");be.registerFadeDuration(Ye);const Re=e.findLoadedParent(he,0),rt=Lb(be,Re,e,t.transform,Ye);let lt,vt;t.terrain&&t.terrain.prepareDrawTile(),a.activeTexture.set(c.TEXTURE0),be.texture&&be.texture.bind(J,c.CLAMP_TO_EDGE),a.activeTexture.set(c.TEXTURE1),Re?(Re.texture&&Re.texture.bind(J,c.CLAMP_TO_EDGE),lt=Math.pow(2,Re.tileID.overscaledZ-be.tileID.overscaledZ),vt=[be.tileID.canonical.x*lt%1,be.tileID.canonical.y*lt%1]):be.texture&&be.texture.bind(J,c.CLAMP_TO_EDGE),be.texture&&be.texture.useMipmap&&a.extTextureFilterAnisotropic&&t.transform.pitch>20&&c.texParameterf(c.TEXTURE_2D,a.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a.extTextureFilterAnisotropicMax);const it=t.transform,at=p instanceof xc?p.perspectiveTransform:[0,0],Tt=q?P4(it):[0,0,0,0];let It,St,Lt,Ot,jt,Dt;if(se&&p instanceof xc&&p.coordinates.length>3){It=Float32Array.from(dl(lo(new ci(0,0,0)))),St=Float32Array.from(it.globeMatrix),Lt=Float32Array.from(tm(it)),Ot=[jo(it.center.lng),ea(it.center.lat)],Dt=[jo(p.coordinates[1][0]),ea(p.coordinates[1][1]),jo(p.coordinates[3][0]),ea(p.coordinates[3][1])];const Ti=new Ml(p.coordinates[1],p.coordinates[3]);jt=Float32Array.from(nm(new ci(0,0,0),Ti,0,it.worldSize/t.transform._pixelsPerMercatorPixel))}else It=new Float32Array(16),St=new Float32Array(9),Lt=new Float32Array(16),Ot=[0,0],jt=new Float32Array(16),Dt=[0,0,0,0];const Kt=Gb(Ne,It,St,Lt,jt,vt||[0,0],Dt,Uo(t.transform.zoom),Ot,Tt,lt||1,rt,i,at,q?i.paint.get("raster-elevation"):0,2,_.mix,_.offset,_.range,1,0,B),mi=t.isTileAffectedByFog(he),_i=t.getOrCreateProgram("raster",{defines:_.defines,overrideFog:mi});if(t.uploadCommonUniforms(a,_i,ve),p instanceof xc){if(G||!E)p.boundsBuffer&&p.boundsSegments&&_i.draw(t,c.TRIANGLES,Ce,Lr.disabled,O,Or.disabled,Kt,i.id,p.boundsBuffer,t.quadTriangleIndexBuffer,p.boundsSegments);else if(t.globeSharedBuffers){const[Ti,Mi,ur]=t.globeSharedBuffers.getGridBuffers(0,!1);_i.draw(t,c.TRIANGLES,Ce,Lr.disabled,O,Or.frontCCW,Kt,i.id,Ti,Mi,ur),_i.draw(t,c.TRIANGLES,Ce,Lr.disabled,O,Or.backCCW,Kt,i.id,Ti,Mi,ur)}}else{const{tileBoundsBuffer:Ti,tileBoundsIndexBuffer:Mi,tileBoundsSegments:ur}=t.getTileBoundsBuffers(be);_i.draw(t,c.TRIANGLES,Ce,je,O,Or.disabled,Kt,i.id,Ti,Mi,ur)}}t.resetStencilClippingMasks()},background:function(t,e,i,r){const n=i.paint.get("background-color"),s=i.paint.get("background-opacity"),a=i.paint.get("background-emissive-strength");if(s===0)return;const c=t.context,p=c.gl,_=t.transform,v=_.tileSize,E=i.paint.get("background-pattern");if(t.isPatternMissing(E,i.scope))return;const C=!E&&n.a===1&&s===1&&t.opaquePassEnabledForLayer()?"opaque":"translucent";if(t.renderPass!==C)return;const B=Lr.disabled,O=t.depthModeForSublayer(0,C==="opaque"?cr.ReadWrite:cr.ReadOnly),G=t.colorModeForDrapableLayerRenderPass(a),q=E?"backgroundPattern":"background";let $,J=r;J||($=t.getBackgroundTiles(),J=Object.values($).map(ie=>ie.tileID)),E&&(c.activeTexture.set(p.TEXTURE0),t.imageManager.bind(t.context,i.scope));for(const ie of J){const re=t.isTileAffectedByFog(ie),te=t.getOrCreateProgram(q,{overrideFog:re}),se=ie.toUnwrapped(),he=r?ie.projMatrix:t.transform.calculateProjMatrix(se);t.prepareDrawTile();const ve=e?e.getTile(ie):$?$[ie.key]:new N0(ie,v,_.zoom,t),be=E?b4(he,a,s,t,E,i.scope,{tileID:ie,tileSize:v}):v4(he,a,s,n);t.uploadCommonUniforms(c,te,se);const{tileBoundsBuffer:Ce,tileBoundsIndexBuffer:Ne,tileBoundsSegments:je}=t.getTileBoundsBuffers(ve);te.draw(t,p.TRIANGLES,O,B,G,Or.disabled,be,i.id,Ce,Ne,je)}},sky:function(t,e,i){const r=t._atmosphere?Uo(t.transform.zoom):1,n=i.paint.get("sky-opacity")*r;if(n===0)return;const s=t.context,a=i.paint.get("sky-type"),c=new cr(s.gl.LEQUAL,cr.ReadOnly,[0,1]),p=t.frameCounter/1e3%1;a==="atmosphere"?t.renderPass==="offscreen"?i.needsSkyboxCapture(t)&&(function(_,v,E,C){const B=_.context,O=B.gl;let G=v.skyboxFbo;if(!G){G=v.skyboxFbo=B.createFramebuffer(32,32,!0,null),v.skyboxGeometry=new tw(B),v.skyboxTexture=B.gl.createTexture(),O.bindTexture(O.TEXTURE_CUBE_MAP,v.skyboxTexture),O.texParameteri(O.TEXTURE_CUBE_MAP,O.TEXTURE_WRAP_S,O.CLAMP_TO_EDGE),O.texParameteri(O.TEXTURE_CUBE_MAP,O.TEXTURE_WRAP_T,O.CLAMP_TO_EDGE),O.texParameteri(O.TEXTURE_CUBE_MAP,O.TEXTURE_MIN_FILTER,O.LINEAR),O.texParameteri(O.TEXTURE_CUBE_MAP,O.TEXTURE_MAG_FILTER,O.LINEAR);for(let ie=0;ie<6;++ie)O.texImage2D(O.TEXTURE_CUBE_MAP_POSITIVE_X+ie,0,O.RGBA,32,32,0,O.RGBA,O.UNSIGNED_BYTE,null)}B.bindFramebuffer.set(G.framebuffer),B.viewport.set([0,0,32,32]);const q=v.getCenter(_,!0),$=_.getOrCreateProgram("skyboxCapture"),J=new Float64Array(16);ce.identity(J),ce.rotateY(J,J,.5*-Math.PI),_f(_,v,$,J,q,0),ce.identity(J),ce.rotateY(J,J,.5*Math.PI),_f(_,v,$,J,q,1),ce.identity(J),ce.rotateX(J,J,.5*-Math.PI),_f(_,v,$,J,q,2),ce.identity(J),ce.rotateX(J,J,.5*Math.PI),_f(_,v,$,J,q,3),ce.identity(J),_f(_,v,$,J,q,4),ce.identity(J),ce.rotateY(J,J,Math.PI),_f(_,v,$,J,q,5),B.viewport.set([0,0,_.width,_.height])}(t,i),i.markSkyboxValid(t)):t.renderPass==="sky"&&function(_,v,E,C,B){const O=_.context,G=O.gl,q=_.transform,$=_.getOrCreateProgram("skybox");O.activeTexture.set(G.TEXTURE0),G.bindTexture(G.TEXTURE_CUBE_MAP,v.skyboxTexture);const J=((ie,re,te,se,he)=>({u_matrix:ie,u_sun_direction:re,u_cubemap:0,u_opacity:se,u_temporal_offset:he}))(q.skyboxMatrix,v.getCenter(_,!1),0,C,B);_.uploadCommonUniforms(O,$),$.draw(_,G.TRIANGLES,E,Lr.disabled,_.colorModeForRenderPass(),Or.backCW,J,"skybox",v.skyboxGeometry.vertexBuffer,v.skyboxGeometry.indexBuffer,v.skyboxGeometry.segment)}(t,i,c,n,p):a==="gradient"&&t.renderPass==="sky"&&function(_,v,E,C,B){const O=_.context,G=O.gl,q=_.transform,$=_.getOrCreateProgram("skyboxGradient");v.skyboxGeometry||(v.skyboxGeometry=new tw(O)),O.activeTexture.set(G.TEXTURE0);let J=v.colorRampTexture;J||(J=v.colorRampTexture=new ks(O,v.colorRamp,G.RGBA)),J.bind(G.LINEAR,G.CLAMP_TO_EDGE);const ie=((re,te,se,he,ve)=>({u_matrix:re,u_color_ramp:0,u_center_direction:te,u_radius:Li(se),u_opacity:he,u_temporal_offset:ve}))(q.skyboxMatrix,v.getCenter(_,!1),v.paint.get("sky-gradient-radius"),C,B);_.uploadCommonUniforms(O,$),$.draw(_,G.TRIANGLES,E,Lr.disabled,_.colorModeForRenderPass(),Or.backCW,ie,"skyboxGradient",v.skyboxGeometry.vertexBuffer,v.skyboxGeometry.indexBuffer,v.skyboxGeometry.segment)}(t,i,c,n,p)},debug:function(t,e,i){for(let r=0;r<i.length;r++)O4(t,e,i[r])},custom:function(t,e,i,r){const n=t.context,s=i.implementation;if(!t.transform.projection.unsupportedLayers||!t.transform.projection.unsupportedLayers.includes("custom")||t.terrain&&(t.terrain.renderingToTexture||t.renderPass==="offscreen")&&i.isLayerDraped(e)){if(t.renderPass==="offscreen"){const a=s.prerender;if(a){if(t.setCustomLayerDefaults(),n.setColorMode(t.colorModeForRenderPass()),t.transform.projection.name==="globe"){const c=t.transform.pointMerc;a.call(s,n.gl,t.transform.customLayerMatrix(),t.transform.getProjection(),t.transform.globeToMercatorMatrix(),Uo(t.transform.zoom),[c.x,c.y],t.transform.pixelsPerMeterRatio)}else a.call(s,n.gl,t.transform.customLayerMatrix());n.setDirty(),t.setBaseState()}}else if(t.renderPass==="translucent"){if(t.terrain&&t.terrain.renderingToTexture){const c=s.renderToTile;if(c){const p=r[0].canonical,_=new Xr(p.x+r[0].wrap*(1<<p.z),p.y,p.z);n.setDepthMode(cr.disabled),n.setStencilMode(Lr.disabled),n.setColorMode(t.colorModeForRenderPass()),t.setCustomLayerDefaults(),c.call(s,n.gl,_),n.setDirty(),t.setBaseState()}return}t.setCustomLayerDefaults(),n.setColorMode(t.colorModeForRenderPass()),n.setStencilMode(Lr.disabled);const a=s.renderingMode==="3d"?new cr(t.context.gl.LEQUAL,cr.ReadWrite,t.depthRangeFor3D):t.depthModeForSublayer(0,cr.ReadOnly);if(n.setDepthMode(a),t.transform.projection.name==="globe"){const c=t.transform.pointMerc;s.render(n.gl,t.transform.customLayerMatrix(),t.transform.getProjection(),t.transform.globeToMercatorMatrix(),Uo(t.transform.zoom),[c.x,c.y],t.transform.pixelsPerMeterRatio)}else s.render(n.gl,t.transform.customLayerMatrix());n.setDirty(),t.setBaseState(),n.bindFramebuffer.set(null)}}else Pe("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(t,e,i,r){if(t.renderPass==="opaque")return;const n=i.paint.get("model-opacity");if(n===0)return;const s=i.paint.get("model-cast-shadows");if(t.renderPass==="shadow"&&(!s||t.terrain&&n<.65&&i._transitionablePaint._values["model-opacity"].value.expression instanceof kn))return;const a=t.shadowRenderer,c=i.paint.get("model-receive-shadows");a&&(a.useNormalOffset=!0,c||(a.enabled=!1));const p=()=>{a&&(a.useNormalOffset=!0,c||(a.enabled=!0))},_=e.getSource();if(t.renderPass==="light-beam"&&_.type!=="batched-model")return;if(_.type==="vector"||_.type==="geojson")return function($,J,ie,re){const te=$.transform;if(te.projection.name!=="mercator")return void Pe(`Drawing 3D models for ${te.projection.name} projection is not yet implemented`);const se=te.getFreeCameraOptions().position;if(!$.modelManager)return;const he=$.modelManager,ve=$.shadowRenderer;if(!ie._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const be=ie._unevaluatedLayout._values["model-id"],Ce={...ie.layout.get("model-id").parameters};for(const Ne of re){const je=J.getTile(Ne).getBucket(ie);if(!je||je.projection.name!==te.projection.name)continue;const Ye=Q4(Ne,te);Ce.zoom=Ye;const Re=be.possiblyEvaluate(Ce);if(q4($,je,Ne),_u.shadowUniformsInitialized=!1,_u.useSingleShadowCascade=!!ve&&ve.getMaxCascadeForTile(Ne.toUnwrapped())===0,$.renderPass==="shadow"&&ve){if($.currentShadowCascade===1&&je.isInsideFirstShadowMapFrustum)continue;const vt=te.calculatePosMatrix(Ne.toUnwrapped(),te.worldSize);if(_u.tileMatrix.set(vt),_u.shadowTileMatrix=Float32Array.from(ve.calculateShadowPassMatrixFromMatrix(vt)),_u.aabb.min.fill(0),_u.aabb.max[0]=_u.aabb.max[1]=Mt,_u.aabb.max[2]=0,W4(je,_u,$,ie.scope))continue}const rt=1<<Ne.canonical.z,lt=[((se.x-Ne.wrap)*rt-Ne.canonical.x)*Mt,(se.y*rt-Ne.canonical.y)*Mt,se.z*rt*Mt];for(let vt in je.instancesPerModel){const it=je.instancesPerModel[vt];it.features.length>0&&(vt=Re.evaluate(it.features[0].feature,{}));const at=he.getModel(vt,ie.scope);if(at&&at.uploaded)for(const Tt of at.nodes)nw($,ie,Tt,it,lt,Ne,_u)}}}(t,e,i,r),void p();if(!_.loaded())return;if(_.type==="batched-model")return function($,J,ie,re){const te=$.context,se=$.transform,he=$.style.fog,ve=$.shadowRenderer;if(se.projection.name!=="mercator")return void Pe(`Drawing 3D landmark models for ${se.projection.name} projection is not yet implemented`);const be=$.transform.getFreeCameraOptions().position,Ce=_e.scale([],[be.x,be.y,be.z],$.transform.worldSize);_e.negate(Ce,Ce);const Ne=ce.identity([]),je=sh(se.center.lat,se.zoom),Ye=ce.fromScaling([],[1,1,1/je]);ce.translate(Ne,Ne,Ce);const Re=ie.paint.get("model-opacity"),rt=new cr(te.gl.LEQUAL,cr.ReadWrite,$.depthRangeFor3D),lt=new cr(te.gl.LEQUAL,cr.ReadOnly,$.depthRangeFor3D),vt=function(it,at){for(const Tt of re){const It=J.getTile(Tt).getBucket(ie);if(!It||!It.uploaded)continue;let St=!1;ve&&(St=ve.getMaxCascadeForTile(Tt.toUnwrapped())===0);const Lt=se.calculatePosMatrix(Tt.toUnwrapped(),se.worldSize),Ot=It.modelTraits;for(const jt of It.getNodesInfo()){if(jt.hiddenByReplacement||!jt.node.meshes)continue;const Dt=jt.node,Kt=$.renderPass==="light-beam",mi=[...Lt],_i=jt.evaluatedScale;let Ti=0;$.terrain&&Dt.elevation&&(Ti=Dt.elevation*$.terrain.exaggeration()),ce.translate(mi,mi,[(Dt.anchor?Dt.anchor[0]:0)*(_i[0]-1),(Dt.anchor?Dt.anchor[1]:0)*(_i[1]-1),Ti]),_i!==EE&&ce.scale(mi,mi,_i),ce.multiply(mi,mi,Dt.matrix);const Mi=ce.multiply([],Ye,mi);ce.multiply(Mi,Ne,Mi);const ur=ce.invert([],Mi);ce.transpose(ur,ur),ce.scale(ur,ur,H4);const Ui=ce.multiply([],se.expandedFarZProjMatrix,mi);for(let on=0;on<Dt.meshes.length;++on){const Zr=Dt.meshes[on],hr=on===Dt.lightMeshIndex;if(hr){if(!Kt&&!$.terrain&&$.shadowRenderer){$.currentLayer<$.firstLightBeamLayer&&($.firstLightBeamLayer=$.currentLayer);continue}}else if(Kt)continue;const or={defines:[]},$i=[];_y(or.defines,$i,Zr,$),4&Ot||or.defines.push("DIFFUSE_SHADED"),St&&or.defines.push("SHADOWS_SINGLE_CASCADE");const Hr=$.renderPass==="shadow";if(Hr){gy(Zr,mi,$,ie);continue}let Jr=null;if(he){const Ao=iw(mi,$.transform);if(Jr=new Float32Array(Ao),se.projection.name!=="globe"){const eo=Zr.aabb.min,_s=Zr.aabb.max,[Dn,Ba]=he.getOpacityForBounds(Ao,eo[0],eo[1],_s[0],_s[1]);or.overrideFog=Dn>=Jh||Ba>=Jh}}const Br=$.getOrCreateProgram("model",or);!Hr&&ve&&(ve.useNormalOffset=!!Zr.normalBuffer,ve.setupShadowsFromMatrix(mi,Br,ve.useNormalOffset)),$.uploadCommonUniforms(te,Br,Tt.toUnwrapped(),Jr);const Vn=Zr.material,Js=Vn.pbrMetallicRoughness;Js.metallicFactor=.9,Js.roughnessFactor=.5;const Bn=0,us=py(new Float32Array(Ui),new Float32Array(Mi),new Float32Array(ur),$,Re,Js.baseColorFactor,Vn.emissiveFactor,Js.metallicFactor,Js.roughnessFactor,Vn,Bn,ie);Br.draw($,te.gl.TRIANGLES,at&&!hr?rt:lt,Lr.disabled,it?hr||Re<1||jt.hasTranslucentParts?dn.alphaBlended:dn.unblended:dn.disabled,Or.backCCW,us,ie.id,Zr.vertexBuffer,Zr.indexBuffer,Zr.segments,ie.paint,$.transform.zoom,void 0,$i)}}}};(function(it,at,Tt,It){const St=it.terrain?it.terrain.exaggeration():0,Lt=it.transform.zoom;for(const Ot of It){const jt=at.getTile(Ot).getBucket(Tt);jt&&(it.conflationActive&&jt.updateReplacement(Ot,it.replacementSource),jt.evaluateScale(it,Tt),it.terrain&&St>0&&jt.elevationUpdate(it.terrain,St,Ot,Tt.source),jt.needsReEvaluation(it,Lt,Tt)&&jt.evaluate(Tt))}})($,J,ie,re),Re===1?vt(!0,!0):(vt(!1,!0),vt(!0,!1))}(t,e,i,r),void p();const v=_.getModels(),E=[],C=t.transform.getFreeCameraOptions().position,B=_e.scale([],[C.x,C.y,C.z],t.transform.worldSize);_e.negate(B,B);const O=[],G=[];let q=0;for(const $ of v){const J=i.paint.get("model-rotation").constantOr(null),ie=i.paint.get("model-scale").constantOr(null),re=i.paint.get("model-translation").constantOr(null);$.computeModelMatrix(t,J,ie,re,!0,!0,!1);const te=ce.identity([]),se=sh($.position.lat,t.transform.zoom),he=ce.fromScaling([],[1,1,1/se]);ce.translate(te,te,B),E.push({zScaleMatrix:he,negCameraPosMatrix:te});for(const ve of $.nodes)rw(t.transform,ve,$.matrix,t.transform.expandedFarZProjMatrix,q,O,G);q++}if(O.sort(($,J)=>J.depth-$.depth),t.renderPass!=="shadow"){if(n===1)for(const $ of G)d_($,t,i,E[$.modelIndex],Lr.disabled,t.colorModeForRenderPass());else{for(const $ of G)d_($,t,i,E[$.modelIndex],Lr.disabled,dn.disabled);for(const $ of G)d_($,t,i,E[$.modelIndex],t.stencilModeFor3D(),t.colorModeForRenderPass());t.resetStencilClippingMasks()}for(const $ of O)d_($,t,i,E[$.modelIndex],Lr.disabled,t.colorModeForRenderPass());p()}else{for(const $ of G)gy($.mesh,$.nodeModelMatrix,t,i);for(const $ of O)gy($.mesh,$.nodeModelMatrix,t,i);p()}}},ow={modelUpload:function(t,e,i){const r=e.getSource();if(!r.loaded())return;if(r.type==="vector"||r.type==="geojson")return void(t.modelManager&&t.modelManager.upload(t,i));if(r.type==="batched-model")return;const n=r.getModels();for(const s of n)s.upload(t.context)}};class Y4{constructor(e,i,r){this.context=new fE(e,i),this.transform=r,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=Hc.maxUnderzooming+Hc.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new DE,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new eS(this),this._wireframeDebugCache=new X4,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0}updateTerrain(e,i){const r=!!e&&!!e.terrain&&this.transform.projection.supportsTerrain;if(!(r||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new s4(this,e));const n=this._terrain;this.transform.elevation=r?n:null,n.update(e,this.transform,i),this.transform.elevation&&!n.enabled&&(this.transform.elevation=null)}_updateFog(e){const i=e.fog;if(!i||this.transform.projection.name==="globe"||i.getOpacity(this.transform.pitch)<1||i.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[r,n]=i.getFovAdjustedRange(this.transform._fov);if(r>n)return void(this.transform.fogCullDistSq=null);const s=r+.78*(n-r);this.transform.fogCullDistSq=s*s}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(e,i){if(this.width=e*Xi.devicePixelRatio,this.height=i*Xi.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const r of this.style.order)this.style._mergedLayers[r].resize()}setup(){const e=this.context,i=new ul;i.emplaceBack(0,0),i.emplaceBack(Mt,0),i.emplaceBack(0,Mt),i.emplaceBack(Mt,Mt),this.tileExtentBuffer=e.createVertexBuffer(i,wi.members),this.tileExtentSegments=wn.simpleSegment(0,0,4,2);const r=new ul;r.emplaceBack(0,0),r.emplaceBack(Mt,0),r.emplaceBack(0,Mt),r.emplaceBack(Mt,Mt),this.debugBuffer=e.createVertexBuffer(r,wi.members),this.debugSegments=wn.simpleSegment(0,0,4,5);const n=new ul;n.emplaceBack(-1,-1),n.emplaceBack(1,-1),n.emplaceBack(-1,1),n.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(n,wi.members),this.viewportSegments=wn.simpleSegment(0,0,4,2);const s=new Dc;s.emplaceBack(0,0,0,0),s.emplaceBack(Mt,0,Mt,0),s.emplaceBack(0,Mt,0,Mt),s.emplaceBack(Mt,Mt,Mt,Mt),this.mercatorBoundsBuffer=e.createVertexBuffer(s,Pg.members),this.mercatorBoundsSegments=wn.simpleSegment(0,0,4,2);const a=new Ys;a.emplaceBack(0,1,2),a.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(a);const c=new Bc;for(const _ of[0,1,3,2,0])c.emplaceBack(_);this.debugIndexBuffer=e.createIndexBuffer(c),this.emptyTexture=new ks(e,new bo({width:1,height:1},Uint8Array.of(0,0,0,0)),e.gl.RGBA),this.identityMat=ce.create();const p=this.context.gl;this.stencilClearMode=new Lr({func:p.ALWAYS,mask:0},0,255,p.ZERO,p.ZERO,p.ZERO),this.loadTimeStamps.push(me.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(e){return e._makeTileBoundsBuffers(this.context,this.transform.projection),e._tileBoundsBuffer?{tileBoundsBuffer:e._tileBoundsBuffer,tileBoundsIndexBuffer:e._tileBoundsIndexBuffer,tileBoundsSegments:e._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const e=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,e.TRIANGLES,cr.disabled,this.stencilClearMode,dn.disabled,Or.disabled,fy(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(e,i,r){if(!i||this.currentStencilSource===i.id||!e.isTileClipped()||!r||r.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let c=!1;for(const p of r)if(this._tileClippingMaskIDs[p.key]===void 0){c=!0;break}if(!c)return}this.currentStencilSource=i.id;const n=this.context,s=n.gl;this.nextStencilID+r.length>256&&this.clearStencil(),n.setColorMode(dn.disabled),n.setDepthMode(cr.disabled);const a=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const c of r){const p=i.getTile(c),_=this._tileClippingMaskIDs[c.key]=this.nextStencilID++,{tileBoundsBuffer:v,tileBoundsIndexBuffer:E,tileBoundsSegments:C}=this.getTileBoundsBuffers(p);a.draw(this,s.TRIANGLES,cr.disabled,new Lr({func:s.ALWAYS,mask:0},_,255,s.KEEP,s.KEEP,s.REPLACE),dn.disabled,Or.disabled,fy(c.projMatrix),"$clipping",v,E,C)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,i=this.context.gl;return new Lr({func:i.NOTEQUAL,mask:255},e,255,i.KEEP,i.KEEP,i.REPLACE)}stencilModeForClipping(e){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(e);const i=this.context.gl;return new Lr({func:i.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,i.KEEP,i.KEEP,i.REPLACE)}stencilConfigForOverlap(e){const i=this.context.gl,r=e.sort((a,c)=>c.overscaledZ-a.overscaledZ),n=r[r.length-1].overscaledZ,s=r[0].overscaledZ-n+1;if(s>1){this.currentStencilSource=void 0,this.nextStencilID+s>256&&this.clearStencil();const a={};for(let c=0;c<s;c++)a[c+n]=new Lr({func:i.GEQUAL,mask:255},c+this.nextStencilID,255,i.KEEP,i.KEEP,i.REPLACE);return this.nextStencilID+=s,[a,r]}return[{[n]:Lr.disabled},r]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new dn([e.CONSTANT_COLOR,e.ONE,e.CONSTANT_COLOR,e.ONE],new pr(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?dn.unblended:dn.alphaBlended}colorModeForDrapableLayerRenderPass(e){const i=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new dn([i.ONE,i.ONE_MINUS_SRC_ALPHA,i.CONSTANT_ALPHA,i.ONE_MINUS_SRC_ALPHA],new pr(0,0,0,e===void 0?0:e),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(e,i,r,n=!1){if(!this.opaquePassEnabledForLayer()&&!n)return cr.disabled;const s=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new cr(r||this.context.gl.LEQUAL,i,[s,s])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,i){this._wireframeDebugCache.update(this.frameCounter),this.style=e,this.options=i;const r=this.style._mergedLayers,n=this.style.order,s=n.map(te=>r[te]),a=this.style._mergedSourceCaches;this.imageManager=e.imageManager,this.modelManager=e.modelManager,this.symbolFadeChange=e.placement.symbolFadeChange(Xi.now()),this.imageManager.beginFrame();let c=0,p=!1;for(const te in a){const se=a[te];se.used&&(se.prepare(this.context),se.getSource().usedInConflation&&++c)}const _={},v={},E={},C={},B={};for(const te in a){const se=a[te];_[te]=se.getVisibleCoordinates(),v[te]=_[te].slice().reverse(),E[te]=se.getVisibleCoordinates(!0).reverse(),C[te]=se.getShadowCasterCoordinates(),B[te]=se.sortCoordinatesByDistance(_[te])}const O=te=>{const se=this.style.getLayerSourceCache(te);return se&&se.used?se.getSource():null};if(c){const te=[];for(const se of s)this.layerUsedInConflation(se,O(se))&&te.push(se);if(te&&te.length>1){const se=[];for(const he of te){const ve=this.style.getLayerSourceCache(he);ve&&ve.used&&ve.getSource().usedInConflation&&se.push({layer:he.fqid,cache:ve})}this.replacementSource.setSources(se),p=!0}}p||this.replacementSource.clear(),this.conflationActive=p,this.minCutoffZoom=0,this.longestCutoffRange=0;for(const te of s){const se=te.cutoffRange();if(this.longestCutoffRange=Math.max(se,this.longestCutoffRange),se>0){const he=O(te);he&&(this.minCutoffZoom=Math.max(he.minzoom,this.minCutoffZoom)),te.minzoom&&(this.minCutoffZoom=Math.max(te.minzoom,this.minCutoffZoom))}}this.opaquePassCutoff=1/0;for(let te=0;te<s.length;te++)if(s[te].is3D()){this.opaquePassCutoff=te;break}const G=this.style&&this.style.fog;G?(this._fogVisible=G.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=G.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(E),this.opaquePassCutoff=0);const q=this._shadowRenderer;if(q){q.updateShadowParameters(this.transform,this.style.directionalLight);for(const te in a)for(const se of _[te]){let he={min:0,max:0};this.terrain&&(he=this.terrain.getMinMaxForTile(se)||he),q.addShadowReceiver(se.toUnwrapped(),he.min,he.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new Ka(this.context));for(const te of s){if(te.isHidden(this.transform.zoom))continue;const se=e.getLayerSourceCache(te);this.uploadLayer(this,te,se)}if(this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Z4),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!qo.has(this.context.gl))return;this.renderPass="offscreen";for(const te of s){const se=e.getLayerSourceCache(te);if(!te.hasOffscreenPass()||te.isHidden(this.transform.zoom))continue;const he=se?v[se.id]:void 0;(te.type==="custom"||te.type==="raster"||te.isSky()||he&&he.length)&&this.renderLayer(this,se,te,he)}this.depthRangeFor3D=[0,1-(s.length+2)*this.numSublayers*this.depthEpsilon];const $=this.terrain;$&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&$.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,C)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const J=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),ie=(()=>{if(i.showOverdrawInspector)return pr.black;if(this.style.fog&&this.transform.projection.supportsFog&&!J){const te=this.style.fog.properties.get("color").toArray01();return new pr(...te)}if(this.style.fog&&this.transform.projection.supportsFog&&J){const te=this.style.fog.properties.get("space-color").toArray01();return new pr(...te)}return pr.transparent})();if(this.context.clear({color:ie,depth:1}),this.clearStencil(),this._showOverdrawInspector=i.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&J&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=n.length-1;this.currentLayer>=0;this.currentLayer--){const te=s[this.currentLayer],se=e.getLayerSourceCache(te);if(te.isSky())continue;const he=se?(te.is3D()?B:v)[se.id]:void 0;this._renderTileClippingMasks(te,se,he),this.renderLayer(this,se,te,he)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&J&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||Uo(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<n.length;this.currentLayer++){const te=s[this.currentLayer],se=e.getLayerSourceCache(te);te.isSky()&&this.renderLayer(this,se,te,se?v[se.id]:void 0)}this.renderPass="translucent",this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let re=0;for(q&&(re=q.getShadowCastingLayerCount());this.currentLayer<n.length;){const te=s[this.currentLayer],se=e.getLayerSourceCache(te);if(te.isSky()){++this.currentLayer;continue}if($&&this.style.isLayerDraped(te)){if(te.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=$.renderBatch(this.currentLayer);continue}let he;if(se&&(he=(te.type==="symbol"?E:te.is3D()?B:v)[se.id]),this._renderTileClippingMasks(te,se,se?_[se.id]:void 0),this.renderLayer(this,se,te,he),!$&&q&&re>0&&te.hasShadowPass()&&--re==0&&(q.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const ve=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=ve;this.currentLayer++){const be=s[this.currentLayer];if(!be.hasLightBeamPass())continue;const Ce=e.getLayerSourceCache(be);this.renderLayer(this,Ce,be,Ce?v[Ce.id]:void 0)}this.currentLayer=ve,this.renderPass="translucent"}++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let te=null;s.forEach(se=>{const he=e.getLayerSourceCache(se);he&&!se.isHidden(this.transform.zoom)&&he.getVisibleCoordinates().length&&(!te||te.getSource().maxzoom<he.getSource().maxzoom)&&(te=he)}),te&&this.options.showTileBoundaries&&sw.debug(this,te,te.getVisibleCoordinates())}this.options.showPadding&&function(te){const se=te.transform.padding;Jb(te,te.transform.height-(se.top||0),3,z4),Jb(te,se.bottom||0,3,B4),ew(te,se.left||0,3,L4),ew(te,te.transform.width-(se.right||0),3,R4);const he=te.transform.centerPoint;(function(ve,be,Ce,Ne){h_(ve,be-1,Ce-10,2,20,Ne),h_(ve,be-10,Ce-1,20,2,Ne)})(te,he.x,te.transform.height-he.y,F4)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(me.performance.now()),this.saveCanvasCopy()),p||(this.conflationActive=!1)}uploadLayer(e,i,r){this.gpuTimingStart(i),(!e.transform.projection.unsupportedLayers||!e.transform.projection.unsupportedLayers.includes(i.type)||e.terrain&&i.type==="custom")&&ow[`${i.type}Upload`]&&ow[`${i.type}Upload`](e,r,i.scope),this.gpuTimingEnd()}renderLayer(e,i,r,n){r.isHidden(this.transform.zoom)||(r.type==="background"||r.type==="sky"||r.type==="custom"||r.type==="model"||r.type==="raster"||n&&n.length)&&(this.id=r.id,this.gpuTimingStart(r),(!e.transform.projection.unsupportedLayers||!e.transform.projection.unsupportedLayers.includes(r.type)||e.terrain&&r.type==="custom")&&sw[r.type](e,i,r,n,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(e){if(!this.options.gpuTiming)return;const i=this.context.extTimerQuery,r=this.context.gl;let n=this.gpuTimers[e.id];n||(n=this.gpuTimers[e.id]={calls:0,cpuTime:0,query:r.createQuery()}),n.calls++,r.beginQuery(i.TIME_ELAPSED_EXT,n.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const e=this.context.extTimerQuery,i=this.context.gl,r=i.createQuery();this.deferredRenderGpuTimeQueries.push(r),i.beginQuery(e.TIME_ELAPSED_EXT,r)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const e=this.gpuTimers;return this.gpuTimers={},e}collectDeferredRenderGpuQueries(){const e=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],e}queryGpuTimers(e){const i={};for(const r in e){const n=e[r],s=this.context.extTimerQuery,a=s.getQueryParameter(n.query,this.context.gl.QUERY_RESULT)/1e6;s.deleteQueryEXT(n.query),i[r]=a}return i}queryGpuTimeDeferredRender(e){if(!this.options.gpuTimingDeferredRender)return 0;const i=this.context.extTimerQuery,r=this.context.gl;let n=0;for(const s of e)n+=i.getQueryParameter(s,r.QUERY_RESULT)/1e6,i.deleteQueryEXT(s);return n}translatePosMatrix(e,i,r,n,s){if(!r[0]&&!r[1])return e;const a=s?n==="map"?this.transform.angle:0:n==="viewport"?-this.transform.angle:0;if(a){const _=Math.sin(a),v=Math.cos(a);r=[r[0]*v-r[1]*_,r[0]*_+r[1]*v]}const c=[s?r[0]:Xh(i,r[0],this.transform.zoom),s?r[1]:Xh(i,r[1],this.transform.zoom),0],p=new Float32Array(16);return ce.translate(p,e,c),p}saveTileTexture(e){const i=e.size[0],r=this._tileTextures[i];r?r.push(e):this._tileTextures[i]=[e]}getTileTexture(e){const i=this._tileTextures[e];return i&&i.length>0?i.pop():null}isPatternMissing(e,i){return e===null||e!==void 0&&!this.imageManager.getPattern(e.toString(),i)}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(e,i,r){const n=r===void 0?this.terrain&&this.terrain.renderingToTexture:r,s=this.terrain&&this.terrain.exaggeration()===0,a=[];return this.style&&this.style.enable3dLights()&&(e==="globeRaster"||e==="terrainRaster"?(a.push("LIGHTING_3D_MODE"),a.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):n||a.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"?this._shadowMapDebug||a.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?a.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):a.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(a.push("TERRAIN"),this.linearFloatFilteringSupported()&&a.push("TERRAIN_DEM_FLOAT_FORMAT"),s&&a.push("ZERO_EXAGGERATION")),this.transform.projection.name==="globe"&&a.push("GLOBE"),!this._fogVisible||n||i!==void 0&&!i||a.push("FOG","FOG_DITHERING"),n&&a.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&a.push("OVERDRAW_INSPECTOR"),a}getOrCreateProgram(e,i){this.cache=this.cache||{};const r=i&&i.defines||[],n=i&&i.config,s=this.currentGlobalDefines(e,i&&i.overrideFog,i&&i.overrideRtt).concat(r),a=Fb.cacheKey(Sb[e],e,s,n);return this.cache[a]||(this.cache[a]=new Fb(this.context,e,Sb[e],n,w4[e],s)),this.cache[a]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=me.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new ks(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(e,i){if(this.style.enable3dLights()){const r=this.style.directionalLight,n=this.style.ambientLight;if(r&&n){const s=((a,c)=>{const p=a.properties.get("direction"),_=a.properties.get("color").toArray01(),v=a.properties.get("intensity"),E=c.properties.get("color").toArray01(),C=c.properties.get("intensity"),B=[p.x,p.y,p.z],O=oi(E,C),G=oi(_,v);return{u_lighting_ambient_color:O,u_lighting_directional_dir:B,u_lighting_directional_color:G,u_ground_radiance:o4(B,G,O)}})(r,n);i.setLightsUniformValues(e,s)}}}uploadCommonUniforms(e,i,r,n,s){if(this.uploadCommonLightUniforms(e,i),this.terrain&&this.terrain.renderingToTexture)return;const a=this.style.fog;if(a){const c=a.getOpacity(this.transform.pitch),p=((_,v,E,C,B,O,G,q,$,J,ie,re)=>{const te=_.transform,se=v.properties.get("color").toArray01();se[3]=C;const he=_.frameCounter/1e3%1,[ve,be]=v.properties.get("vertical-range");return{u_fog_matrix:E?te.calculateFogTileMatrix(E):re||_.identityMat,u_fog_range:v.getFovAdjustedRange(te._fov),u_fog_color:se,u_fog_horizon_blend:v.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(ve,be),be],u_fog_temporal_offset:he,u_frustum_tl:B,u_frustum_tr:O,u_frustum_br:G,u_frustum_bl:q,u_globe_pos:$,u_globe_radius:J,u_viewport:ie,u_globe_transition:Uo(te.zoom),u_is_globe:+(te.projection.name==="globe")}})(this,a,r,c,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*Xi.devicePixelRatio,this.transform.height*Xi.devicePixelRatio],n);i.setFogUniformValues(e,p)}s&&i.setCutoffUniformValues(e,s.uniformValues)}setTileLoadedFlag(e){this.tileLoaded=e}saveCanvasCopy(){const e=this.canvasCopy();e&&(this.frameCopies.push(e),this.tileLoaded=!1)}canvasCopy(){const e=this.context.gl,i=e.createTexture();return e.bindTexture(e.TEXTURE_2D,i),e.copyTexImage2D(e.TEXTURE_2D,0,e.RGBA,0,0,e.drawingBufferWidth,e.drawingBufferHeight,0),i}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const e=this.style&&this.style.fog;return!!e&&e.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const e=this._backgroundTiles,i=this._backgroundTiles={},r=this.transform.coveringTiles({tileSize:512});for(const n of r)i[n.key]=e[n.key]||new N0(n,512,this.transform.tileZoom,this);return i}clearBackgroundTiles(){this._backgroundTiles={}}layerUsedInConflation(e,i){return!(!e.is3D()||e.minzoom&&e.minzoom>this.transform.zoom||e.sourceLayer!=="building"&&(!i||i.type!=="batched-model"))}isTileAffectedByFog(e){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let i=this._cachedTileFogOpacities[e.key];return i||(this._cachedTileFogOpacities[e.key]=i=this.style.fog.getOpacityForTile(e)),i[0]>=Jh||i[1]>=Jh}}const id=2048;class K4{constructor(e,i){this.aabb=e,this.lastCascade=i}}class J4{add(e,i){const r=this.receivers[e.key];r!==void 0?(r.aabb.min[0]=Math.min(r.aabb.min[0],i.min[0]),r.aabb.min[1]=Math.min(r.aabb.min[1],i.min[1]),r.aabb.min[2]=Math.min(r.aabb.min[2],i.min[2]),r.aabb.max[0]=Math.max(r.aabb.max[0],i.max[0]),r.aabb.max[1]=Math.max(r.aabb.max[1],i.max[1]),r.aabb.max[2]=Math.max(r.aabb.max[2],i.max[2])):this.receivers[e.key]=new K4(i,null)}clear(){this.receivers={}}get(e){return this.receivers[e.key]}computeRequiredCascades(e,i,r){const n=$r.fromPoints(e.points);let s=0;for(const a in this.receivers){const c=this.receivers[a];if(!c||!n.intersectsAabb(c.aabb))continue;c.aabb.min=n.closestPoint(c.aabb.min),c.aabb.max=n.closestPoint(c.aabb.max);const p=c.aabb.getCorners();for(let _=0;_<r.length;_++){let v=!0;for(const E of p){const C=[E[0]*i,E[1]*i,E[2]];if(_e.transformMat4(C,C,r[_].matrix),C[0]<-1||C[0]>1||C[1]<-1||C[1]>1){v=!1;break}}if(c.lastCascade=_,s=Math.max(s,_),v)break}}return s+1}}class eS{constructor(e){this.painter=e,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new J4,this._depthMode=new cr(e.context.gl.LEQUAL,cr.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this.useNormalOffset=!1}destroy(){for(const e of this._cascades)e.texture.destroy(),e.framebuffer.destroy();this._cascades=[]}updateShadowParameters(e,i){const r=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!i||!i.properties)return;const n=i.properties.get("shadow-intensity");if(!i.shadowsEnabled()||n<=0||(this._shadowLayerCount=r.style.order.reduce((B,O)=>{const G=r.style._mergedLayers[O];return B+(G.hasShadowPass()&&!G.isHidden(e.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this._enabled))return;const s=r.context,a=id,c=id;if(this._cascades.length===0)for(let B=0;B<2;++B){const O=r._shadowMapDebug,G=s.gl,q=s.createFramebuffer(a,c,O,"texture"),$=new ks(s,{width:a,height:c,data:null},G.DEPTH_COMPONENT);if(q.depthAttachment.set($.texture),O){const J=new ks(s,{width:a,height:c,data:null},G.RGBA);q.colorAttachment.set(J.texture)}this._cascades.push({framebuffer:q,texture:$,matrix:[],far:0,boundingSphereRadius:0,frustum:new Gs,scale:0})}this.shadowDirection=aw(i);let p=0;if(e.elevation){const B=e.elevation,O=[1e4,-1e4];B.visibleDemTiles.filter(G=>G.dem).forEach(G=>{const q=G.dem.tree;O[0]=Math.min(O[0],q.minimums[0]),O[1]=Math.max(O[1],q.maximums[0])}),O[0]!==1e4&&(p=(O[1]-O[0])*B.exaggeration())}const _=1.5*e.cameraToCenterDistance,v=3*_,E=new Float64Array(16);for(let B=0;B<2;++B){const O=this._cascades[B];let G=e.height/50,q=1;B===0?q=_:(G=_,q=v);const[$,J]=tS(e,this.shadowDirection,G,q,id,p);O.scale=e.scale,O.matrix=$,O.boundingSphereRadius=J,ce.invert(E,O.matrix),O.frustum=Gs.fromInvProjectionMatrix(E,1,0,!0),O.far=q}this._uniformValues.u_fade_range=[.75*this._cascades[1].far,this._cascades[1].far],this._uniformValues.u_shadow_intensity=n,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=.00048828125,this._uniformValues.u_shadow_map_resolution=id,this._uniformValues.u_shadowmap_0=MA.ShadowMap0,this._uniformValues.u_shadowmap_1=MA.ShadowMap0+1,this._groundShadowTiles=r.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const C=r.transform.elevation;for(const B of this._groundShadowTiles){let O={min:0,max:0};if(C){const G=C.getMinMaxForTile(B);G&&(O=G)}this.addShadowReceiver(B.toUnwrapped(),O.min,O.max)}}get enabled(){return this._enabled}set enabled(e){this._enabled=e}drawShadowPass(e,i){if(!this._enabled)return;const r=this.painter,n=r.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(r.transform.getFrustum(0),r.transform.worldSize,this._cascades),n.viewport.set([0,0,id,id]);for(let s=0;s<this._numCascadesToRender;++s){r.currentShadowCascade=s,n.bindFramebuffer.set(this._cascades[s].framebuffer.framebuffer),n.clear({color:pr.white,depth:1});for(const a of e.order){const c=e._mergedLayers[a];if(!c.hasShadowPass()||c.isHidden(r.transform.zoom))continue;const p=e.getLayerSourceCache(c),_=p?i[p.id]:void 0;(c.type==="model"||_&&_.length)&&r.renderLayer(r,p,c,_)}}r.currentShadowCascade=0}drawGroundShadows(){if(!this._enabled)return;const e=this.painter,i=e.style,r=e.context,n=i.directionalLight,s=i.ambientLight;if(!n||!s)return;const a=[],c=ff(e,e.longestCutoffRange);c.shouldRenderCutoff&&a.push("RENDER_CUTOFF");const p=yy(n,s),_=new cr(r.gl.LEQUAL,cr.ReadOnly,e.depthRangeFor3D);for(const v of this._groundShadowTiles){const E=v.toUnwrapped(),C=e.isTileAffectedByFog(v),B=e.getOrCreateProgram("groundShadow",{defines:a,overrideFog:C});this.setupShadows(E,B),e.uploadCommonUniforms(r,B,E,null,c);const O={u_matrix:e.transform.calculateProjMatrix(E),u_ground_shadow_factor:p};B.draw(e,r.gl.TRIANGLES,_,Lr.disabled,dn.multiply,Or.disabled,O,"ground_shadow",e.tileExtentBuffer,e.quadTriangleIndexBuffer,e.tileExtentSegments,{},e.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?dn.unblended:dn.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(e){const i=this.painter.transform,r=i.calculatePosMatrix(e,i.worldSize);return ce.multiply(r,this._cascades[this.painter.currentShadowCascade].matrix,r),Float32Array.from(r)}calculateShadowPassMatrixFromMatrix(e){return ce.multiply(e,this._cascades[this.painter.currentShadowCascade].matrix,e),Float32Array.from(e)}setupShadows(e,i,r,n=0){if(!this._enabled)return;const s=this.painter.transform,a=this.painter.context,c=a.gl,p=this._uniformValues,_=new Float64Array(16),v=s.calculatePosMatrix(e,s.worldSize);for(let E=0;E<2;E++)ce.multiply(_,this._cascades[E].matrix,v),p[E===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(_),a.activeTexture.set(c.TEXTURE0+MA.ShadowMap0+E),this._cascades[E].texture.bind(c.NEAREST,c.CLAMP_TO_EDGE);if(this.useNormalOffset=!!r,this.useNormalOffset){const E=M0(e.canonical),C=2/s.tileSize*Mt/id,B=C*this._cascades[0].boundingSphereRadius,O=C*this._cascades[1].boundingSphereRadius,G=(r==="vector-tile"?1:3)/Math.pow(2,n-e.canonical.z-(1-s.zoom+Math.floor(s.zoom)));p.u_shadow_normal_offset=[E,B*G,O*G],p.u_shadow_bias=[6e-5,.0012,.012]}else p.u_shadow_bias=[36e-5,.0012,.012];i.setShadowUniformValues(a,p)}setupShadowsFromMatrix(e,i,r=!1){if(!this._enabled)return;const n=this.painter.context,s=n.gl,a=this._uniformValues,c=new Float64Array(16);for(let p=0;p<2;p++)ce.multiply(c,this._cascades[p].matrix,e),a[p===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(c),n.activeTexture.set(s.TEXTURE0+MA.ShadowMap0+p),this._cascades[p].texture.bind(s.NEAREST,s.CLAMP_TO_EDGE);this.useNormalOffset=r,r?(a.u_shadow_normal_offset=[1,5,5],a.u_shadow_bias=[6e-5,.0012,.012]):a.u_shadow_bias=[36e-5,.0012,.012],i.setShadowUniformValues(n,a)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(e,i,r,n){if(n[2]>=0)return{};const s=function(p,_,v){const E=v/(1<<p.canonical.z);return new $r([p.canonical.x*E+p.wrap*v,p.canonical.y*E+p.wrap*v,0],[(p.canonical.x+1)*E+p.wrap*v,(p.canonical.y+1)*E+p.wrap*v,_])}(e,i,r).getCorners(),a=i/-n[2];n[0]<0?(_e.add(s[0],s[0],[n[0]*a,0,0]),_e.add(s[3],s[3],[n[0]*a,0,0])):n[0]>0&&(_e.add(s[1],s[1],[n[0]*a,0,0]),_e.add(s[2],s[2],[n[0]*a,0,0])),n[1]<0?(_e.add(s[0],s[0],[0,n[1]*a,0]),_e.add(s[1],s[1],[0,n[1]*a,0])):n[1]>0&&(_e.add(s[2],s[2],[0,n[1]*a,0]),_e.add(s[3],s[3],[0,n[1]*a,0]));const c={};return c.vertices=s,c.planes=[f_(s[1],s[0],s[4]),f_(s[2],s[1],s[5]),f_(s[3],s[2],s[6]),f_(s[0],s[3],s[7])],c}addShadowReceiver(e,i,r){this._receivers.add(e,$r.fromTileIdAndHeight(e,i,r))}getMaxCascadeForTile(e){const i=this._receivers.get(e);return i&&i.lastCascade?i.lastCascade:0}}function f_(t,e,i){const r=_e.sub([],i,e),n=_e.sub([],t,e),s=_e.cross([],r,n),a=_e.length(s);return a===0?[0,0,1,0]:(_e.scale(s,s,1/a),[s[0],s[1],s[2],-_e.dot(s,e)])}function aw(t){const e=t.properties.get("direction"),i=ri(e.x,e.y,e.z);i[2]=hi(i[2],0,75);const r=ni([i[0],i[1],i[2]]);return _e.fromValues(r.x,r.y,r.z)}function yy(t,e){const i=t.properties.get("color"),r=t.properties.get("intensity"),n=t.properties.get("direction"),s=[n.x,n.y,n.z],a=e.properties.get("color"),c=e.properties.get("intensity"),p=Math.max(_e.dot([0,0,1],s),0),_=[0,0,0];_e.scale(_,a.toArray01Linear().slice(0,3),c);const v=[0,0,0];return _e.scale(v,i.toArray01Linear().slice(0,3),p*r),gn([_[0]>0?_[0]/(_[0]+v[0]):0,_[1]>0?_[1]/(_[1]+v[1]):0,_[2]>0?_[2]/(_[2]+v[2]):0])}function tS(t,e,i,r,n,s){const a=t.zoom,c=t.scale,p=t.worldSize,_=1/p,v=t.aspect,E=Math.sqrt(1+v*v)*Math.tan(.5*t.fovX),C=E*E,B=r-i,O=r+i;let G,q;C>B/O?(G=r,q=r*E):(G=.5*O*(1+C),q=.5*Math.sqrt(B*B+2*(r*r+i*i)*C+O*O*C*C));const $=t.projection.pixelsPerMeter(t.center.lat,p),J=t._camera.getCameraToWorldMercator(),ie=[0,0,-G*_];_e.transformMat4(ie,ie,J);let re=q*_;const te=t._edgeInsets;if(!(te.left===0&&te.top===0&&te.right===0&&te.bottom===0||te.left===te.right&&te.top===te.bottom)){const It=t._camera.getWorldToCamera(t.worldSize,t.projection.zAxisUnit==="meters"?$:1),St=t._camera.getCameraToClipPerspective(t._fov,t.width/t.height,i,r);St[8]=2*-t.centerOffset.x/t.width,St[9]=2*t.centerOffset.y/t.height;const Lt=new Float64Array(16);ce.mul(Lt,St,It);const Ot=new Float64Array(16);ce.invert(Ot,Lt);const jt=Gs.fromInvProjectionMatrix(Ot,p,a,!0);for(const Dt of jt.points){const Kt=((se=Dt)[0]/=c,se[1]/=c,se[2]=On(se[2],t._center.lat),se);re=Math.max(re,_e.len(_e.subtract([],ie,Kt)))}}var se;re*=n/(n-1);const he=Math.acos(e[2]),ve=Math.atan2(-e[0],-e[1]),be=new Gm;be.position=ie,be.setPitchBearing(he,ve);const Ce=be.getWorldToCamera(p,$),Ne=re*p,je=Math.min(t._mercatorZfromZoom(17)*p*-2,-2*Ne),Ye=be.getCameraToClipOrthographic(-Ne,Ne,-Ne,Ne,je,(Ne+s*$)/e[2]),Re=new Float64Array(16);ce.multiply(Re,Ye,Ce);const rt=_e.fromValues(Math.floor(1e6*ie[0])/1e6*p,Math.floor(1e6*ie[1])/1e6*p,0),lt=.5*n,vt=[0,0,0];_e.transformMat4(vt,rt,Re),_e.scale(vt,vt,lt);const it=[Math.floor(vt[0]),Math.floor(vt[1]),Math.floor(vt[2])],at=[0,0,0];_e.sub(at,vt,it),_e.scale(at,at,-1/lt);const Tt=new Float64Array(16);return ce.identity(Tt),ce.translate(Tt,Tt,at),ce.multiply(Re,Tt,Re),[Re,Ne]}class iS extends rs{constructor(e){super(),this.requestManager=e,this.models={"":{}},this.numModelsLoading={}}loadModel(e,i){return tb(this.requestManager.transformRequest(i,we.Model).url).then(r=>{if(!r)return;const n=ny(r),s=new Yx(e,void 0,void 0,n);return s.computeBoundsAndApplyParent(),s}).catch(r=>{this.fire(new ir(new Error(`Could not load model ${e} from ${i}: ${r.message}`)))})}load(e,i){this.models[i]||(this.models[i]={});const r=Object.keys(e);this.numModelsLoading[i]=(this.numModelsLoading[i]||0)+r.length;const n=[];for(const s of r)n.push(this.loadModel(s,e[s]));Promise.allSettled(n).then(s=>{for(let a=0;a<s.length;a++){const{status:c,value:p}=s[a];c==="fulfilled"&&p&&(this.models[i][r[a]]=p)}this.numModelsLoading[i]-=r.length,this.fire(new ei("data",{dataType:"style"}))}).catch(s=>{this.fire(new ir(new Error(`Could not load models: ${s.message}`)))})}isLoaded(){for(const e in this.numModelsLoading)if(this.numModelsLoading[e]>0)return!1;return!0}hasModel(e,i){return!!this.getModel(e,i)}getModel(e,i){return this.models[i]||(this.models[i]={}),this.models[i][e]}addModel(e,i,r){this.models[r]||(this.models[r]={}),this.hasModel(e,r)&&this.removeModel(e,r),this.load({[e]:this.requestManager.normalizeModelURL(i)},r)}addModels(e,i){const r={};for(const n in e)r[n]=this.requestManager.normalizeModelURL(e[n]);this.load(r,i)}removeModel(e,i){this.models[i]||(this.models[i]={});const r=this.models[i][e];delete this.models[i][e],r.destroy()}listModels(e){return this.models[e]||(this.models[e]={}),Object.keys(this.models[e])}upload(e,i){this.models[i]||(this.models[i]={});for(const r in this.models[i])this.models[i][r].upload(e.context)}}const ep=(t,e)=>Ic(t,e&&e.filter(i=>i.identifier!=="source.canvas")),rS=dr(vn,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","setImportUrl","setImportData","setImportConfig"]),nS=dr(vn,["setCenter","setZoom","setBearing","setPitch"]),lw={version:8,layers:[],sources:{}},Aw={duration:300,delay:0},sS=new Set(["fill","line","background","hillshade","raster"]);class Xc extends rs{constructor(e,i={}){super(),this.map=e,this.scope=i.scope||"",this.fragments=[],this.importDepth=i.importDepth||0,this.importsCache=i.importsCache||new Map,this.resolvedImports=i.resolvedImports||new Set,this.transition=zt({},Aw),this._buildingIndex=new IM(this),this.crossTileSymbolIndex=new YM,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=i.styleChanges||new j_,this.dispatcher=i.dispatcher?i.dispatcher:new ed(Y0(),this),i.imageManager?this.imageManager=i.imageManager:(this.imageManager=new rM,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=i.glyphManager?i.glyphManager:new sf(e._requestManager,i.localFontFamily?2:i.localIdeographFontFamily?1:0,i.localFontFamily||i.localIdeographFontFamily),i.modelManager?this.modelManager=i.modelManager:(this.modelManager=new iS(e._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=new Map,this._configDependentLayers=new Set,this._config=i.config,this.dispatcher.broadcast("setReferrer",pe());const r=this;this._rtlTextPluginCallback=Xc.registerForPluginStateChange(n=>{r.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:n.pluginStatus,pluginURL:n.pluginURL},(s,a)=>{if(iu(s),a&&a.every(c=>c))for(const c in r._sourceCaches){const p=r._sourceCaches[c],_=p.getSource().type;_!=="vector"&&_!=="geojson"||p.reload()}})}),this.on("data",n=>{if(n.dataType!=="source"||n.sourceDataType!=="metadata")return;const s=this.getOwnSource(n.sourceId);if(s&&s.vectorLayerIds)for(const a in this._layers){const c=this._layers[a];c.source===s.id&&this._validateLayer(c)}})}loadURL(e,i={}){this.fire(new ei("dataloading",{dataType:"style"}));const r=typeof i.validate=="boolean"?i.validate:!ct(e);e=this.map._requestManager.normalizeStyleURL(e,i.accessToken),this.resolvedImports.add(e);const n=this.importsCache.get(e);if(n)return this._load(n,r);const s=this.map._requestManager.transformRequest(e,we.Style);this._request=Be(s,(a,c)=>{if(this._request=null,a)this.fire(new ir(a));else if(c)return this.importsCache.set(e,c),this._load(c,r)})}loadJSON(e,i={}){this.fire(new ei("dataloading",{dataType:"style"})),this._request=Xi.frame(()=>{this._request=null,this._load(e,i.validate!==!1)})}loadEmpty(){this.fire(new ei("dataloading",{dataType:"style"})),this._load(lw,!1)}_loadImports(e,i){if(this.importDepth>=4)return Pe("Style doesn't support nesting deeper than 5"),Promise.resolve();const r=[];for(const n of e){const s=this._createFragmentStyle(n),a=new Promise(p=>{s.once("style.import.load",p),s.once("error",p)}).then(()=>this.mergeAll());if(r.push(a),this.resolvedImports.has(n.url)){s.loadEmpty();continue}const c=n.data||this.importsCache.get(n.url);c?s.loadJSON(c,{validate:i}):n.url?s.loadURL(n.url,{validate:i}):s.loadEmpty(),this.fragments.push({style:s,id:n.id,config:n.config})}return Promise.allSettled(r)}_createFragmentStyle(e){const i=this.scope?Oo(e.id,this.scope):e.id,r=new Xc(this.map,{scope:i,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:e.config});return r.setEventedParent(this.map,{style:r}),r}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options});const e=this.isRootStyle();this._shouldPrecompile=e,this.fire(new ei(e?"style.load":"style.import.load"))}_load(e,i){const r=e.schema;if(this.isRootStyle()&&(e.fragment||r&&e.fragment!==!1)){const a=zt({},lw,{imports:[{id:"basemap",data:e,url:""}]});return void this._load(a,i)}if(this.setConfig(this._config,r),i&&ep(this,tu(e)))return;this._loaded=!0,this.stylesheet=Ue(e);for(const a in e.sources)this.addSource(a,e.sources[a],{validate:!1,isInitialLoad:!0});e.sprite?this._loadSprite(e.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(e.glyphs,this.scope);const n=ob(this.stylesheet.layers);if(this._order=n.map(a=>a.id),this.stylesheet.light&&Pe("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const a=this.stylesheet.lights[0];this.light=new zv(a.properties,a.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new zv(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(const a of n){const c=Ym(a,this.options);c.setScope(this.scope),c.isConfigDependent&&this._configDependentLayers.add(c.fqid),c.setEventedParent(this,{layer:{id:c.id}}),this._layers[c.id]=c,this._serializedLayers[c.id]=c.serialize();const p=this.getOwnLayerSourceCache(c),_=!!this.directionalLight&&this.directionalLight.shadowsEnabled();p&&c.canCastShadows()&&_&&(p.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const s=this.stylesheet.terrain;s&&(this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=Xi.hasCanvasFingerprintNoise()),this.disableElevatedTerrain?Pe("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."):this.terrainSetForDrapingOnly()||this._createTerrain(s,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new ei("data",{dataType:"style"})),e.imports?this._loadImports(e.imports,i).then(()=>this._reloadImports()):this._reloadImports()}isRootStyle(){return this.importDepth===0}mergeAll(){let e,i,r,n,s,a,c,p;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(_=>{if(_.stylesheet){if(_.light!=null&&(e=_.light),_.stylesheet.lights)for(const v of _.stylesheet.lights)v.type==="ambient"&&_.ambientLight!=null&&(i=_.ambientLight),v.type==="directional"&&_.directionalLight!=null&&(r=_.directionalLight);n=this._prioritizeTerrain(n,_.terrain,_.stylesheet.terrain),_.stylesheet.fog&&_.fog!=null&&(s=_.fog),_.stylesheet.camera!=null&&(p=_.stylesheet.camera),_.stylesheet.projection!=null&&(a=_.stylesheet.projection),_.stylesheet.transition!=null&&(c=_.stylesheet.transition)}}),this.light=e,this.ambientLight=i,this.directionalLight=r,this.fog=s,n===null?delete this.terrain:this.terrain=n,this.camera=p||{"camera-projection":"perspective"},this.projection=a||{name:"mercator"},this.transition=zt({},Aw,c),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(e){const i=r=>{for(const n of r.fragments)i(n.style);e(r)};i(this)}_prioritizeTerrain(e,i,r){const n=e&&e.drapeRenderMode===0;return r===null?i&&i.drapeRenderMode===0?i:n?e:null:i!=null&&(!e||n||i&&i.drapeRenderMode===1)?i:e}mergeTerrain(){let e;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(i=>{e=this._prioritizeTerrain(e,i.terrain,i.stylesheet.terrain)}),e===null?delete this.terrain:this.terrain=e}mergeProjection(){let e;this.forEachFragmentStyle(i=>{i.stylesheet.projection!=null&&(e=i.stylesheet.projection)}),this.projection=e||{name:"mercator"}}mergeSources(){const e={},i={},r={};this.forEachFragmentStyle(n=>{for(const s in n._sourceCaches){const a=Oo(s,n.scope);e[a]=n._sourceCaches[s]}for(const s in n._otherSourceCaches){const a=Oo(s,n.scope);i[a]=n._otherSourceCaches[s]}for(const s in n._symbolSourceCaches){const a=Oo(s,n.scope);r[a]=n._symbolSourceCaches[s]}}),this._mergedSourceCaches=e,this._mergedOtherSourceCaches=i,this._mergedSymbolSourceCaches=r}mergeLayers(){const e={},i=[],r={};this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(s=>{for(const a of s._order){const c=s._layers[a];if(c.type==="slot"){const p=Hu(a);if(e[p])continue;e[p]=[]}c.slot&&e[c.slot]?e[c.slot].push(c):i.push(c)}}),this._mergedOrder=[];const n=(s=[])=>{for(const a of s)if(a.type==="slot"){const c=Hu(a.id);e[c]&&n(e[c])}else{const c=Oo(a.id,a.scope);this._mergedOrder.push(c),r[c]=a,a.is3D()&&(this._has3DLayers=!0),a.type==="circle"&&(this._hasCircleLayers=!0),a.type==="symbol"&&(this._hasSymbolLayers=!0)}};n(i),this._mergedLayers=r,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(e){return this.stylesheet.camera=zt({},this.stylesheet.camera,e),this.camera=this.stylesheet.camera,this}setProjection(e){e?this.stylesheet.projection=e:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(e){this._spriteRequest=function(i,r,n){let s,a,c;const p=Xi.devicePixelRatio>1?"@2x":"";let _=Be(r.transformRequest(r.normalizeSpriteURL(i,p,".json"),we.SpriteJSON),(C,B)=>{_=null,c||(c=C,s=B,E())}),v=Et(r.transformRequest(r.normalizeSpriteURL(i,p,".png"),we.SpriteImage),(C,B)=>{v=null,c||(c=C,a=B,E())});function E(){if(c)n(c);else if(s&&a){const C=Xi.getImageData(a),B={};for(const O in s){const{width:G,height:q,x:$,y:J,sdf:ie,pixelRatio:re,stretchX:te,stretchY:se,content:he}=s[O],ve=new bo({width:G,height:q});bo.copy(C,ve,{x:$,y:J},{x:0,y:0},{width:G,height:q}),B[O]={data:ve,pixelRatio:re,sdf:ie,stretchX:te,stretchY:se,content:he}}n(null,B)}}return{cancel(){_&&(_.cancel(),_=null),v&&(v.cancel(),v=null)}}}(e,this.map._requestManager,(i,r)=>{if(this._spriteRequest=null,i)this.fire(new ir(i));else if(r)for(const n in r)this.imageManager.addImage(n,this.scope,r[n]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new ei("data",{dataType:"style"}))})}_validateLayer(e){const i=this.getOwnSource(e.source);if(!i)return;const r=e.sourceLayer;r&&(i.type==="geojson"||i.vectorLayerIds&&i.vectorLayerIds.indexOf(r)===-1)&&this.fire(new ir(new Error(`Source layer "${r}" does not exist on source "${i.id}" as specified by style layer "${e.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const e in this._sourceCaches)if(!this._sourceCaches[e].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded())return!1;for(const{style:e}of this.fragments)if(!e.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((e,i)=>{const r=this.fragments[i];return r&&r.style&&(e.data=r.style.serialize()),e})}_serializeSources(){const e={};for(const i in this._sourceCaches){const r=this._sourceCaches[i].getSource();e[r.id]||(e[r.id]=r.serialize())}return e}_serializeLayers(e){const i=[];for(const r of e){const n=this._layers[r];n&&n.type!=="custom"&&i.push(n.serialize())}return i}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(const e in this._sourceCaches)if(this._sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(e){return!!this.terrain&&(typeof e.isLayerDraped=="function"?e.isLayerDraped(this.getLayerSourceCache(e)):sS.has(e.type))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(e){const i=this.getOwnLayer(e);if(i)return i;this.fire(new ir(new Error(`The layer '${e}' does not exist in the map's style.`)))}_checkSource(e){const i=this.getOwnSource(e);if(i)return i;this.fire(new ir(new Error(`The source '${e}' does not exist in the map's style.`)))}update(e){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(e),this.directionalLight&&this.directionalLight.recalculate(e);const i=this.calculateLightsBrightness();e.brightness=i||0,i!==this._brightness&&(this._brightness=i,this.dispatcher.broadcast("setBrightness",i));const r=this._changes.isDirty();if(this._changes.isDirty()){const s=this._changes.getLayerUpdatesByScope();for(const a in s){const{updatedIds:c,removedIds:p}=s[a];(c||p)&&this._updateWorkerLayers(a,c,p)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(e),this.light&&this.light.updateTransitions(e),this.ambientLight&&this.ambientLight.updateTransitions(e),this.directionalLight&&this.directionalLight.updateTransitions(e),this.fog&&this.fog.updateTransitions(e),this._changes.reset()}const n={};for(const s in this._mergedSourceCaches){const a=this._mergedSourceCaches[s];n[s]=a.used,a.used=!1}for(const s of this._mergedOrder){const a=this._mergedLayers[s];if(a.recalculate(e,this._availableImages),!a.isHidden(e.zoom)){const c=this.getLayerSourceCache(a);c&&(c.used=!0)}if(!this._precompileDone&&this._shouldPrecompile)for(let c=a.minzoom||0;c<(a.maxzoom||25.5);c++){const p=this.map.painter;if(p){const _=a.getProgramIds();if(!_)continue;for(const v of _){const E=a.getDefaultProgramParams(v,e.zoom);E&&(p.style=this,this.fog&&(p._fogVisible=!0,E.overrideFog=!0,p.getOrCreateProgram(v,E)),p._fogVisible=!1,E.overrideFog=!1,p.getOrCreateProgram(v,E),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(E.overrideRtt=!0,p.getOrCreateProgram(v,E)))}}}}this._shouldPrecompile&&(this._precompileDone=!0);for(const s in n){const a=this._mergedSourceCaches[s];n[s]!==a.used&&a.getSource().fire(new ei("data",{sourceDataType:"visibility",dataType:"source",sourceId:a.getSource().id}))}this.light&&this.light.recalculate(e),this.terrain&&this.terrain.recalculate(e),this.fog&&this.fog.recalculate(e),this.z=e.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),r&&this.fire(new ei("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=this._changes.getUpdatedImages();if(e.length){for(const i in this._sourceCaches)this._sourceCaches[i].reloadTilesForDependencies(["icons","patterns"],e);this._changes.resetUpdatedImages()}}_updateWorkerLayers(e,i,r){const n=this.getFragmentStyle(e);n&&this.dispatcher.broadcast("updateLayers",{layers:i?n._serializeLayers(i):[],scope:e,removedIds:r||[],options:n.options})}setState(e){if(this._checkLoaded(),ep(this,tu(e)))return!1;(e=Ue(e)).layers=ob(e.layers);const i=function(n,s){if(!n)return[{command:vn.setStyle,args:[s]}];let a=[];try{if(!tr(n.version,s.version))return[{command:vn.setStyle,args:[s]}];tr(n.center,s.center)||a.push({command:vn.setCenter,args:[s.center]}),tr(n.zoom,s.zoom)||a.push({command:vn.setZoom,args:[s.zoom]}),tr(n.bearing,s.bearing)||a.push({command:vn.setBearing,args:[s.bearing]}),tr(n.pitch,s.pitch)||a.push({command:vn.setPitch,args:[s.pitch]}),tr(n.sprite,s.sprite)||a.push({command:vn.setSprite,args:[s.sprite]}),tr(n.glyphs,s.glyphs)||a.push({command:vn.setGlyphs,args:[s.glyphs]}),tr(n.imports,s.imports)||function(E=[],C=[],B){C=C||[];const O=(E=E||[]).map(i_),G=C.map(i_),q=E.reduce(r_,{}),$=C.reduce(r_,{}),J=O.slice();let ie,re,te,se;for(ie=0,re=0;ie<O.length;ie++)te=O[ie],$.hasOwnProperty(te)?re++:(B.push({command:vn.removeImport,args:[te]}),J.splice(J.indexOf(te,re),1));for(ie=0,re=0;ie<G.length;ie++)te=G[G.length-1-ie],J[J.length-1-ie]!==te&&(q.hasOwnProperty(te)?(B.push({command:vn.removeImport,args:[te]}),J.splice(J.lastIndexOf(te,J.length-re),1)):re++,se=J[J.length-ie],B.push({command:vn.addImport,args:[$[te],se]}),J.splice(J.length-ie,0,te));for(const he of C){const ve=q[he.id];if(!ve||tr(ve,he))continue;tr(ve.config,he.config)||B.push({command:vn.setImportConfig,args:[he.id,he.config]}),tr(ve.url,he.url)||B.push({command:vn.setImportUrl,args:[he.id,he.url]});const be=he.data;tr(ve&&ve.data,be)||B.push({command:vn.setImportData,args:[he.id,be]})}}(n.imports,s.imports,a),tr(n.transition,s.transition)||a.push({command:vn.setTransition,args:[s.transition]}),tr(n.light,s.light)||a.push({command:vn.setLight,args:[s.light]}),tr(n.fog,s.fog)||a.push({command:vn.setFog,args:[s.fog]}),tr(n.projection,s.projection)||a.push({command:vn.setProjection,args:[s.projection]}),tr(n.lights,s.lights)||a.push({command:vn.setLights,args:[s.lights]}),tr(n.camera,s.camera)||a.push({command:vn.setCamera,args:[s.camera]});const c={},p=[];(function(E,C,B,O){let G;for(G in C=C||{},E=E||{})E.hasOwnProperty(G)&&(C.hasOwnProperty(G)||lb(G,B,O));for(G in C){if(!C.hasOwnProperty(G))continue;const q=C[G];E.hasOwnProperty(G)?tr(E[G],q)||(E[G].type==="geojson"&&q.type==="geojson"&&DM(E,C,G)?B.push({command:vn.setGeoJSONSourceData,args:[G,q.data]}):kM(G,C,B,O)):ab(G,C,B)}})(n.sources,s.sources,p,c);const _=[];n.layers&&n.layers.forEach(E=>{E.source&&c[E.source]?a.push({command:vn.removeLayer,args:[E.id]}):_.push(E)});let v=n.terrain;v&&c[v.source]&&(a.push({command:vn.setTerrain,args:[void 0]}),v=void 0),a=a.concat(p),tr(v,s.terrain)||a.push({command:vn.setTerrain,args:[s.terrain]}),function(E,C,B){C=C||[];const O=(E=E||[]).map(i_),G=C.map(i_),q=E.reduce(r_,{}),$=C.reduce(r_,{}),J=O.slice(),ie=Object.create(null);let re,te,se,he,ve,be,Ce;for(re=0,te=0;re<O.length;re++)se=O[re],$.hasOwnProperty(se)?te++:(B.push({command:vn.removeLayer,args:[se]}),J.splice(J.indexOf(se,te),1));for(re=0,te=0;re<G.length;re++)se=G[G.length-1-re],J[J.length-1-re]!==se&&(q.hasOwnProperty(se)?(B.push({command:vn.removeLayer,args:[se]}),J.splice(J.lastIndexOf(se,J.length-te),1)):te++,be=J[J.length-re],B.push({command:vn.addLayer,args:[$[se],be]}),J.splice(J.length-re,0,se),ie[se]=!0);for(re=0;re<G.length;re++)if(se=G[re],he=q[se],ve=$[se],!ie[se]&&!tr(he,ve))if(tr(he.source,ve.source)&&tr(he["source-layer"],ve["source-layer"])&&tr(he.type,ve.type)){for(Ce in t_(he.layout,ve.layout,B,se,null,vn.setLayoutProperty),t_(he.paint,ve.paint,B,se,null,vn.setPaintProperty),tr(he.slot,ve.slot)||B.push({command:vn.setSlot,args:[se,ve.slot]}),tr(he.filter,ve.filter)||B.push({command:vn.setFilter,args:[se,ve.filter]}),tr(he.minzoom,ve.minzoom)&&tr(he.maxzoom,ve.maxzoom)||B.push({command:vn.setLayerZoomRange,args:[se,ve.minzoom,ve.maxzoom]}),he)he.hasOwnProperty(Ce)&&Ce!=="layout"&&Ce!=="paint"&&Ce!=="filter"&&Ce!=="metadata"&&Ce!=="minzoom"&&Ce!=="maxzoom"&&Ce!=="slot"&&(Ce.indexOf("paint.")===0?t_(he[Ce],ve[Ce],B,se,Ce.slice(6),vn.setPaintProperty):tr(he[Ce],ve[Ce])||B.push({command:vn.setLayerProperty,args:[se,Ce,ve[Ce]]}));for(Ce in ve)ve.hasOwnProperty(Ce)&&!he.hasOwnProperty(Ce)&&Ce!=="layout"&&Ce!=="paint"&&Ce!=="filter"&&Ce!=="metadata"&&Ce!=="minzoom"&&Ce!=="maxzoom"&&Ce!=="slot"&&(Ce.indexOf("paint.")===0?t_(he[Ce],ve[Ce],B,se,Ce.slice(6),vn.setPaintProperty):tr(he[Ce],ve[Ce])||B.push({command:vn.setLayerProperty,args:[se,Ce,ve[Ce]]}))}else B.push({command:vn.removeLayer,args:[se]}),be=J[J.lastIndexOf(se)+1],B.push({command:vn.addLayer,args:[ve,be]})}(_,s.layers,a)}catch(c){console.warn("Unable to compute style diff:",c),a=[{command:vn.setStyle,args:[s]}]}return a}(this.serialize(),e).filter(n=>!(n.command in nS));if(i.length===0)return!1;const r=i.filter(n=>!(n.command in rS));if(r.length>0)throw new Error(`Unimplemented: ${r.map(n=>n.command).join(", ")}.`);return i.forEach(n=>{this[n.command].apply(this,n.args)}),this.stylesheet=e,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(e,i){return this.getImage(e)?this.fire(new ir(new Error("An image with this name already exists."))):(this.imageManager.addImage(e,this.scope,i),this._afterImageUpdated(e),this)}updateImage(e,i){this.imageManager.updateImage(e,this.scope,i)}getImage(e){return this.imageManager.getImage(e,this.scope)}removeImage(e){return this.getImage(e)?(this.imageManager.removeImage(e,this.scope),this._afterImageUpdated(e),this):this.fire(new ir(new Error("No image with this name exists.")))}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(e),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new ei("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(e,i,r={}){return this._checkLoaded(),this._validate(V_,`models.${e}`,i,null,r)||(this.modelManager.addModel(e,i,this.scope),this._changes.setDirty()),this}hasModel(e){return this.modelManager.hasModel(e,this.scope)}removeModel(e){return this.hasModel(e)?(this.modelManager.removeModel(e,this.scope),this):this.fire(new ir(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(e,i,r={}){if(this._checkLoaded(),this.getOwnSource(e)!==void 0)throw new Error(`There is already a source with ID "${e}".`);if(!i.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(i).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(i.type)>=0&&this._validate(dp,`sources.${e}`,i,null,r))return;this.map&&this.map._collectResourceTiming&&(i.collectResourceTiming=!0);const n=oy(e,i,this.dispatcher,this);n.scope=this.scope,n.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(n.id),source:n.serialize(),sourceId:n.id}));const s=a=>{const c=(a?"symbol:":"other:")+n.id,p=Oo(c,this.scope),_=this._sourceCaches[c]=new Hc(p,n,a);(a?this._symbolSourceCaches:this._otherSourceCaches)[n.id]=_,_.onAdd(this.map)};s(!1),i.type!=="vector"&&i.type!=="geojson"||s(!0),n.onAdd&&n.onAdd(this.map),r.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(e){this._checkLoaded();const i=this.getOwnSource(e);if(!i)throw new Error("There is no source with this ID");for(const n in this._layers)if(this._layers[n].source===e)return this.fire(new ir(new Error(`Source "${e}" cannot be removed while layer "${n}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===e)return this.fire(new ir(new Error(`Source "${e}" cannot be removed while terrain is using it.`)));const r=this.getOwnSourceCaches(e);for(const n of r){const s=Hu(n.id);delete this._sourceCaches[s],this._changes.discardSourceCacheUpdate(n.id),n.fire(new ei("data",{sourceDataType:"metadata",dataType:"source",sourceId:n.getSource().id})),n.setEventedParent(null),n.clearTiles()}return delete this._otherSourceCaches[e],delete this._symbolSourceCaches[e],this.mergeSources(),i.setEventedParent(null),i.onRemove&&i.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(e,i){this._checkLoaded(),this.getOwnSource(e).setData(i),this._changes.setDirty()}getOwnSource(e){const i=this.getOwnSourceCache(e);return i&&i.getSource()}getOwnSources(){const e=[];for(const i in this._otherSourceCaches){const r=this.getOwnSourceCache(i);r&&e.push(r.getSource())}return e}setLights(e){if(this._checkLoaded(),!e)return delete this.ambientLight,void delete this.directionalLight;const i=this._getTransitionParameters();for(const n of e){if(this._validate(Gu,"lights",n))return;switch(n.type){case"ambient":if(this.ambientLight){const s=this.ambientLight;s.set(n),s.updateTransitions(i)}else this.ambientLight=new Nv(n,uM,this.scope,this.options);break;case"directional":if(this.directionalLight){const s=this.directionalLight;s.set(n),s.updateTransitions(i)}else this.directionalLight=new Nv(n,hM,this.scope,this.options)}}const r=new ds(this.z||0,i);this.ambientLight&&this.ambientLight.recalculate(r),this.directionalLight&&this.directionalLight.recalculate(r),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const e=this.directionalLight,i=this.ambientLight;if(!e||!i)return;const r=E=>.2126*(E[0]<=.03928?E[0]/12.92:Math.pow((E[0]+.055)/1.055,2.4))+.7152*(E[1]<=.03928?E[1]/12.92:Math.pow((E[1]+.055)/1.055,2.4))+.0722*(E[2]<=.03928?E[2]/12.92:Math.pow((E[2]+.055)/1.055,2.4)),n=e.properties.get("color").toArray01(),s=e.properties.get("intensity"),a=e.properties.get("direction"),c=1-ri(a.x,a.y,a.z)[2]/90,p=r(n)*s*c,_=i.properties.get("color").toArray01(),v=i.properties.get("intensity");return(p+r(_)*v)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const e=[];return this.directionalLight&&e.push(this.directionalLight.get()),this.ambientLight&&e.push(this.ambientLight.get()),e}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(e){if(!e)return this;if(Of(e)){const i=function(s){const a=s.indexOf(Ch);return a>=0?s.slice(a+1):""}(e),r=this.fragments.find(({id:s})=>s===i);if(!r)throw new Error(`Style import not found: ${e}`);const n=Hu(e);return r.style.getFragmentStyle(n)}{const i=this.fragments.find(({id:r})=>r===e);if(!i)throw new Error(`Style import not found: ${e}`);return i.style}}getConfigProperty(e,i){const r=this.getFragmentStyle(e);if(!r)return null;const n=r.options.get(i),s=n?n.value||n.default:null;return s?s.serialize():null}setConfigProperty(e,i,r){const n=Yi(r);if(n.result!=="success")return void ep(this,n.value);const s=n.value.expression,a=this.getFragmentStyle(e);if(!a)return;const c=a.options.get(i);c&&(a.options.set(i,{...c,value:s}),a.updateConfigDependencies())}setConfig(e,i){if(this._config=e,e||i)if(i){this.options.clear();for(const r in i){let n,s;const a=Yi(i[r].default);if(a.result==="success"&&(n=a.value.expression),e&&e[r]!==void 0){const C=Yi(e[r]);C.result==="success"&&(s=C.value.expression)}const{minValue:c,maxValue:p,stepValue:_,type:v,values:E}=i[r];n?this.options.set(r,{default:n,value:s,minValue:c,maxValue:p,stepValue:_,type:v,values:E}):this.fire(new ir(new Error(`No schema defined for config option "${r}".`)))}}else this.fire(new ir(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(){for(const e of this._configDependentLayers){const i=this.getLayer(e);i&&(i.possiblyEvaluateVisibility(),this._updateLayer(i))}this.ambientLight&&this.ambientLight.scope===this.scope&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.scope===this.scope&&this.directionalLight.updateConfig(this.options),this._changes.setDirty()}addLayer(e,i,r={}){this._checkLoaded();const n=e.id;if(this._layers[n])return void this.fire(new ir(new Error(`Layer with id "${n}" already exists on this map`)));let s;if(e.type==="custom"){if(ep(this,function(v){const E=[],C=v.id;return C===void 0&&E.push({message:`layers.${C}: missing required property "id"`}),v.render===void 0&&E.push({message:`layers.${C}: missing required method "render"`}),v.renderingMode&&v.renderingMode!=="2d"&&v.renderingMode!=="3d"&&E.push({message:`layers.${C}: property "renderingMode" must be either "2d" or "3d"`}),E}(e)))return;s=Ym(e,this.options)}else{if(typeof e.source=="object"&&(this.addSource(n,e.source),e=zt(e=Ue(e),{source:n})),this._validate(pd,`layers.${n}`,e,{arrayIndex:-1},r))return;s=Ym(e,this.options),this._validateLayer(s),s.setEventedParent(this,{layer:{id:n}}),this._serializedLayers[s.id]=s.serialize()}s.isConfigDependent&&this._configDependentLayers.add(s.fqid),s.setScope(this.scope);let a=this._order.length;if(i){const v=this._order.indexOf(i);if(v===-1)return void this.fire(new ir(new Error(`Layer with id "${i}" does not exist on this map.`)));s.slot===this._layers[i].slot?a=v:Pe(`Layer with id "${i}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(a,0,n),this._layerOrderChanged=!0,this._layers[n]=s;const c=this.getOwnLayerSourceCache(s),p=!!this.directionalLight&&this.directionalLight.shadowsEnabled();c&&s.canCastShadows()&&p&&(c.castsShadows=!0);const _=this._changes.getRemovedLayer(s);if(_&&s.source&&c&&s.type!=="custom"){this._changes.discardLayerRemoval(s);const v=Oo(s.source,s.scope);_.type!==s.type?this._changes.updateSourceCache(v,"clear"):(this._changes.updateSourceCache(v,"reload"),c.pause())}this._updateLayer(s),s.onAdd&&s.onAdd(this.map),s.scope=this.scope,this.mergeLayers()}moveLayer(e,i){this._checkLoaded();const r=this._checkLayer(e);if(!r||e===i)return;const n=this._order.indexOf(e);this._order.splice(n,1);let s=this._order.length;if(i){const a=this._order.indexOf(i);if(a===-1)return void this.fire(new ir(new Error(`Layer with id "${i}" does not exist on this map.`)));r.slot===this._layers[i].slot?s=a:Pe(`Layer with id "${i}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(s,0,e),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(e){this._checkLoaded();const i=this._checkLayer(e);if(!i)return;i.setEventedParent(null);const r=this._order.indexOf(e);this._order.splice(r,1),delete this._layers[e],delete this._serializedLayers[e],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(i.fqid),this._changes.removeLayer(i);const n=this.getOwnLayerSourceCache(i);if(n&&n.castsShadows){let s=!1;for(const a in this._layers)if(this._layers[a].source===i.source&&this._layers[a].canCastShadows()){s=!0;break}n.castsShadows=s}i.onRemove&&i.onRemove(this.map),this.mergeLayers()}getOwnLayer(e){return this._layers[e]}hasLayer(e){return e in this._mergedLayers}hasLayerType(e){for(const i in this._layers)if(this._layers[i].type===e)return!0;return!1}setLayerZoomRange(e,i,r){this._checkLoaded();const n=this._checkLayer(e);n&&(n.minzoom===i&&n.maxzoom===r||(i!=null&&(n.minzoom=i),r!=null&&(n.maxzoom=r),this._updateLayer(n)))}setSlot(e,i){this._checkLoaded();const r=this._checkLayer(e);r&&r.slot!==i&&(r.slot=i,this._updateLayer(r))}setFilter(e,i,r={}){this._checkLoaded();const n=this._checkLayer(e);if(n&&!tr(n.filter,i))return i==null?(n.filter=void 0,void this._updateLayer(n)):void(this._validate(Zu,`layers.${n.id}.filter`,i,{layerType:n.type},r)||(n.filter=Ue(i),this._updateLayer(n)))}getFilter(e){const i=this._checkLayer(e);if(i)return Ue(i.filter)}setLayoutProperty(e,i,r,n={}){this._checkLoaded();const s=this._checkLayer(e);s&&(tr(s.getLayoutProperty(i),r)||(s.setLayoutProperty(i,r,n),s.isConfigDependent&&this._configDependentLayers.add(s.fqid),this._updateLayer(s)))}getLayoutProperty(e,i){const r=this._checkLayer(e);if(r)return r.getLayoutProperty(i)}setPaintProperty(e,i,r,n={}){this._checkLoaded();const s=this._checkLayer(e);if(!s||tr(s.getPaintProperty(i),r))return;const a=s.setPaintProperty(i,r,n);s.isConfigDependent&&this._configDependentLayers.add(s.fqid),a&&this._updateLayer(s),this._changes.updatePaintProperties(s)}getPaintProperty(e,i){const r=this._checkLayer(e);if(r)return r.getPaintProperty(i)}setFeatureState(e,i){this._checkLoaded();const r=e.source,n=e.sourceLayer,s=this._checkSource(r);if(!s)return;const a=s.type;if(a==="geojson"&&n)return void this.fire(new ir(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(a==="vector"&&!n)return void this.fire(new ir(new Error("The sourceLayer parameter must be provided for vector source types.")));e.id===void 0&&this.fire(new ir(new Error("The feature id parameter must be provided.")));const c=this.getOwnSourceCaches(r);for(const p of c)p.setFeatureState(n,e.id,i)}removeFeatureState(e,i){this._checkLoaded();const r=e.source,n=this._checkSource(r);if(!n)return;const s=n.type,a=s==="vector"?e.sourceLayer:void 0;if(s==="vector"&&!a)return void this.fire(new ir(new Error("The sourceLayer parameter must be provided for vector source types.")));if(i&&typeof e.id!="string"&&typeof e.id!="number")return void this.fire(new ir(new Error("A feature id is required to remove its specific state property.")));const c=this.getOwnSourceCaches(r);for(const p of c)p.removeFeatureState(a,e.id,i)}getFeatureState(e){this._checkLoaded();const i=e.source,r=e.sourceLayer,n=this._checkSource(i);if(n){if(n.type!=="vector"||r)return e.id===void 0&&this.fire(new ir(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(i)[0].getFeatureState(r,e.id);this.fire(new ir(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(e){return this.stylesheet.transition=zt({},this.stylesheet.transition,e),this.transition=this.stylesheet.transition,this}getTransition(){return zt({},this.stylesheet.transition)}serialize(){this._checkLoaded();const e=this.getTerrain(),i=e&&this.terrain&&this.terrain.scope===this.scope?e:this.stylesheet.terrain;return Yt({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:i,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},r=>r!==void 0)}_updateLayer(e){this._changes.updateLayer(e);const i=this.getLayerSourceCache(e),r=Oo(e.source,e.scope),n=this._changes.getUpdatedSourceCaches();e.source&&!n[r]&&i&&i.getSource().type!=="raster"&&(this._changes.updateSourceCache(r,"reload"),i.pause()),e.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(e){const i=c=>this._mergedLayers[c].type==="fill-extrusion",r=this.order,n={},s=[];for(let c=r.length-1;c>=0;c--){const p=r[c];if(i(p)){n[p]=c;for(const _ of e){const v=_[p];if(v)for(const E of v)s.push(E)}}}s.sort((c,p)=>p.intersectionZ-c.intersectionZ);const a=[];for(let c=r.length-1;c>=0;c--){const p=r[c];if(i(p))for(let _=s.length-1;_>=0;_--){const v=s[_].feature;if(n[v.layer.id]<c)break;a.push(v),s.pop()}else for(const _ of e){const v=_[p];if(v)for(const E of v)a.push(E.feature)}}return a}queryRenderedFeatures(e,i,r){i&&i.filter&&this._validate(Zu,"queryRenderedFeatures.filter",i.filter,null,i),i.scope=this.scope,i.availableImages=this._availableImages,i.serializedLayers=this._serializedLayers;const n={};if(i&&i.layers){if(!Array.isArray(i.layers))return this.fire(new ir(new Error("parameters.layers must be an Array."))),[];for(const _ of i.layers){const v=this._mergedLayers[_];if(!v)return this.fire(new ir(new Error(`The layer '${_}' does not exist in the map's style and cannot be queried for features.`))),[];n[v.source]=!0}}const s=[],a=i.serializedLayers||{},c=i&&i.layers?i.layers.some(_=>{const v=this.getLayer(_);return v&&v.is3D()}):this.has3DLayers(),p=qg.createFromScreenPoints(e,r);for(const _ in this._mergedSourceCaches){const v=this._mergedSourceCaches[_].getSource();if(!v||v.scope!==i.scope)continue;const E=this._mergedSourceCaches[_].getSource().id;i.layers&&!n[E]||s.push(MM(this._mergedSourceCaches[_],this._mergedLayers,a,p,i,r,c,!!this.map._showQueryGeometry))}return this.placement&&s.push(function(_,v,E,C,B,O,G){const q={},$=O.queryRenderedSymbols(C),J=[];for(const ie of Object.keys($).map(Number))J.push(G[ie]);J.sort(nb);for(const ie of J){const re=ie.featureIndex.lookupSymbolFeatures($[ie.bucketInstanceId],v,ie.bucketIndex,ie.sourceLayerIndex,B.filter,B.layers,B.availableImages,_);for(const te in re){const se=q[te]=q[te]||[],he=re[te];he.sort((ve,be)=>{const Ce=ie.featureSortOrder;if(Ce){const Ne=Ce.indexOf(ve.featureIndex);return Ce.indexOf(be.featureIndex)-Ne}return be.featureIndex-ve.featureIndex});for(const ve of he)se.push(ve)}}for(const ie in q)q[ie].forEach(re=>{const te=re.feature,se=E(_[ie]);if(!se)return;const he=se.getFeatureState(te.layer["source-layer"],te.id);te.source=te.layer.source,te.layer["source-layer"]&&(te.sourceLayer=te.layer["source-layer"]),te.state=he});return q}(this._mergedLayers,a,this.getLayerSourceCache.bind(this),p.screenGeometry,i,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(s)}querySourceFeatures(e,i){i&&i.filter&&this._validate(Zu,"querySourceFeatures.filter",i.filter,null,i);const r=this.getOwnSourceCaches(e);let n=[];for(const s of r)n=n.concat(SM(s,i));return n}addSourceType(e,i,r){return Xc.getSourceType(e)?r(new Error(`A source type called "${e}" already exists.`)):(Xc.setSourceType(e,i),i.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:e,url:i.workerSourceURL},r):r(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(e,i,r={}){this._checkLoaded();const n=this.light.getLight();let s=!1;for(const c in e)if(!tr(e[c],n[c])){s=!0;break}if(!s)return;const a=this._getTransitionParameters();this.light.setLight(e,i,r),this.light.updateTransitions(a)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(e,i=1){if(this._checkLoaded(),!e)return delete this.terrain,e===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let r=e;const n=e.source==null;if(i===1){if(typeof r.source=="object"){const c="terrain-dem-src";this.addSource(c,r.source),r=Ue(r),r=zt(r,{source:c})}const s=zt({},r),a={};if(this.terrain&&n){s.source=this.terrain.get().source;const c=this.terrain?this.getFragmentStyle(this.terrain.scope):null;c&&(a.style=c.serialize())}if(this._validate(O_,"terrain",s,a))return}if(!this.terrain||this.terrain.scope!==this.scope&&!n||this.terrain&&i!==this.terrain.drapeRenderMode){if(!r)return;this._createTerrain(r,i),this.fire(new ei("data",{dataType:"style"}))}else{const s=this.terrain,a=s.get();for(const c of Object.keys(xt.terrain))!r.hasOwnProperty(c)&&xt.terrain[c].default&&(r[c]=xt.terrain[c].default);for(const c in e)if(!tr(e[c],a[c])){s.set(e,this.options),this.stylesheet.terrain=e;const p=this._getTransitionParameters({duration:0});s.updateTransitions(p),this.fire(new ei("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(e){const i=this.fog=new lM(e,this.map.transform);this.stylesheet.fog=i.get();const r=this._getTransitionParameters({duration:0});i.updateTransitions(r)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const e of this.map._markers)e._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(e){if(this._checkLoaded(),!e)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const i=this.fog;if(!tr(i.get(),e)){i.set(e),this.stylesheet.fog=i.get();const r=this._getTransitionParameters({duration:0});i.updateTransitions(r)}}else this._createFog(e);this._markersNeedUpdate=!0}_getTransitionParameters(e){return{now:Xi.now(),transition:zt(this.transition,e)}}updateDrapeFirstLayers(){if(!this.terrain)return;const e=[],i=[];for(const r in this._mergedLayers)this.isLayerDraped(this._mergedLayers[r])?e.push(r):i.push(r);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...e),this._drapedFirstOrder.push(...i)}_createTerrain(e,i){const r=this.terrain=new oM(e,i,this.scope,this.options);i===1&&(this.stylesheet.terrain=e),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const n=this._getTransitionParameters({duration:0});r.updateTransitions(n)}_force3DLayerUpdate(){for(const e in this._layers){const i=this._layers[e];i.type==="fill-extrusion"&&this._updateLayer(i)}}_forceSymbolLayerUpdate(){for(const e in this._layers){const i=this._layers[e];i.type==="symbol"&&this._updateLayer(i)}}_validate(e,i,r,n,s={}){if(s&&s.validate===!1)return!1;const a=zt({},this.serialize());return ep(this,e.call(tu,zt({key:i,style:a,value:r,styleSpec:xt},n)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),Lf.off("pluginStateChange",this._rtlTextPluginCallback);for(const e in this._mergedLayers)this._mergedLayers[e].setEventedParent(null);for(const e in this._mergedSourceCaches)this._mergedSourceCaches[e].clearTiles(),this._mergedSourceCaches[e].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(e){const i=this.getSourceCaches(e);for(const r of i)r.clearTiles()}clearSources(){for(const e in this._mergedSourceCaches)this._mergedSourceCaches[e].clearTiles()}reloadSource(e){const i=this.getSourceCaches(e);for(const r of i)r.resume(),r.reload()}reloadSources(){for(const e of this.getSources())e.reload&&e.reload()}updateSources(e){let i;this.directionalLight&&(i=aw(this.directionalLight));for(const r in this._mergedSourceCaches)this._mergedSourceCaches[r].update(e,void 0,void 0,i)}_generateCollisionBoxes(){for(const e in this._sourceCaches){const i=this._sourceCaches[e];i.resume(),i.reload()}}_updatePlacement(e,i,r,n,s=!1){let a=!1,c=!1;const p={},_={};for(const v of this._mergedOrder){const E=this._mergedLayers[v];if(E.type!=="symbol")continue;const C=Oo(E.source,E.scope);let B=p[C];if(!B){const G=this.getLayerSourceCache(E);if(!G)continue;const q=G.getRenderableIds(!0).map($=>G.getTileByID($));_[C]=q.slice(),B=p[C]=q.sort(($,J)=>J.tileID.overscaledZ-$.tileID.overscaledZ||($.tileID.isLessThan(J.tileID)?-1:1))}const O=this.crossTileSymbolIndex.addLayer(E,B,e.center.lng,e.projection);a=a||O}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),s=s||this._layerOrderChanged||r===0,this._layerOrderChanged&&this.fire(new ei("neworder")),(s||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(Xi.now(),e.zoom))&&(this.pauseablePlacement=new HM(e,this._mergedOrder,s,i,r,n,this.placement,this.fog&&e.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,p,_),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(Xi.now()),c=!0),a&&this.pauseablePlacement.placement.setStale()),c||a)for(const v of this._mergedOrder){const E=this._mergedLayers[v];E.type==="symbol"&&this.placement.updateLayerOpacities(E,p[Oo(E.source,E.scope)])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(Xi.now())}_releaseSymbolFadeTiles(){for(const e in this._sourceCaches)this._sourceCaches[e].releaseSymbolFadeTiles()}addImport(e){this._checkLoaded();const i=this.stylesheet.imports=this.stylesheet.imports||[];return i.findIndex(({id:n})=>n===e.id)!==-1?this.fire(new ir(new Error(`Import with id '${e.id}' already exists in the map's style.`))):(i.push(e),this._loadImports([e],!0),this)}setImportUrl(e,i){this._checkLoaded();const r=this.stylesheet.imports||[],n=this.getImportIndex(e);if(n===-1)return this;r[n].url=i;const s=this.fragments[n];return s.style=this._createFragmentStyle(r[n]),s.style.on("style.import.load",()=>this.mergeAll()),s.style.loadURL(i),this}setImportData(e,i){this._checkLoaded();const r=this.getImportIndex(e),n=this.stylesheet.imports||[];return r===-1?this:i?(this.fragments[r].style.setState(i),this._reloadImports(),this):(delete n[r].data,this.setImportUrl(e,n[r].url))}setImportConfig(e,i){this._checkLoaded();const r=this.getImportIndex(e),n=this.stylesheet.imports||[];if(r===-1)return this;i?n[r].config=i:delete n[r].config;const s=this.fragments[r],a=s.style.stylesheet&&s.style.stylesheet.schema;return s.config=i,s.style.setConfig(i,a),s.style.updateConfigDependencies(),this}removeImport(e){this._checkLoaded();const i=this.stylesheet.imports||[],r=this.getImportIndex(e);return r===-1||(i.splice(r,1),this.fragments[r].style._remove(),this.fragments.splice(r,1),this._reloadImports()),this}getImportIndex(e){const i=(this.stylesheet.imports||[]).findIndex(r=>r.id===e);return i===-1&&this.fire(new ir(new Error(`Import '${e}' does not exist in the map's style and cannot be updated.`))),i}getLayer(e){return this._mergedLayers[e]}getSources(){const e=[];for(const i in this._mergedOtherSourceCaches){const r=this._mergedOtherSourceCaches[i];r&&e.push(r.getSource())}return e}getSource(e,i){const r=this.getSourceCache(e,i);return r&&r.getSource()}getLayerSource(e){const i=this.getLayerSourceCache(e);return i&&i.getSource()}getSourceCache(e,i){const r=Oo(e,i);return this._mergedOtherSourceCaches[r]}getLayerSourceCache(e){const i=Oo(e.source,e.scope);return e.type==="symbol"?this._mergedSymbolSourceCaches[i]:this._mergedOtherSourceCaches[i]}getSourceCaches(e){const i=[];return this._mergedOtherSourceCaches[e]&&i.push(this._mergedOtherSourceCaches[e]),this._mergedSymbolSourceCaches[e]&&i.push(this._mergedSymbolSourceCaches[e]),i}updateSourceCaches(){const e=this._changes.getUpdatedSourceCaches();for(const i in e){const r=e[i];r==="reload"?this.reloadSource(i):r==="clear"&&this.clearSource(i)}}updateLayers(e){const i=this._changes.getUpdatedPaintProperties();for(const r of i){const n=this.getLayer(r);n&&n.updateTransitions(e)}}getImages(e,i,r){this.imageManager.getImages(i.icons,i.scope,r),this._updateTilesForChangedImages();const n=s=>{s&&s.setDependencies(i.tileID.key,i.type,i.icons)};n(this._otherSourceCaches[i.source]),n(this._symbolSourceCaches[i.source])}getGlyphs(e,i,r){this.glyphManager.getGlyphs(i.stacks,i.scope,r)}getResource(e,i,r){return Te(i,r)}getOwnSourceCache(e){return this._otherSourceCaches[e]}getOwnLayerSourceCache(e){return e.type==="symbol"?this._symbolSourceCaches[e.source]:this._otherSourceCaches[e.source]}getOwnSourceCaches(e){const i=[];return this._otherSourceCaches[e]&&i.push(this._otherSourceCaches[e]),this._symbolSourceCaches[e]&&i.push(this._symbolSourceCaches[e]),i}_isSourceCacheLoaded(e){const i=this.getOwnSourceCaches(e);return i.length===0?(this.fire(new ir(new Error(`There is no source with ID '${e}'`))),!1):i.every(r=>r.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}function cw(t,e){let i=!1,r=null;const n=()=>{r=null,i&&(t(),r=setTimeout(n,e),i=!1)};return()=>(i=!0,r||n(),r)}Xc.getSourceType=function(t){return sy[t]},Xc.setSourceType=function(t,e){sy[t]=e},Xc.registerForPluginStateChange=function(t){return t({pluginStatus:Qa,pluginURL:kc}),Lf.on("pluginStateChange",t),t};class oS{constructor(e){this._hashName=e&&encodeURIComponent(e),Un(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=cw(this._updateHashUnthrottled.bind(this),300)}addTo(e){return this._map=e,me.addEventListener("hashchange",this._onHashChange,!1),e.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),me.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const e=this._map;if(!e)return"";const i=uw(e);if(this._hashName){const r=this._hashName;let n=!1;const s=me.location.hash.slice(1).split("&").map(a=>{const c=a.split("=")[0];return c===r?(n=!0,`${c}=${i}`):a}).filter(a=>a);return n||s.push(`${r}=${i}`),`#${s.join("&")}`}return`#${i}`}_getCurrentHash(){const e=me.location.hash.replace("#","");if(this._hashName){let i;return e.split("&").map(r=>r.split("=")).forEach(r=>{r[0]===this._hashName&&(i=r)}),(i&&i[1]||"").split("/")}return e.split("/")}_onHashChange(){const e=this._map;if(!e)return!1;const i=this._getCurrentHash();if(i.length>=3&&!i.some(r=>isNaN(r))){const r=e.dragRotate.isEnabled()&&e.touchZoomRotate.isEnabled()?+(i[3]||0):e.getBearing();return e.jumpTo({center:[+i[2],+i[1]],zoom:+i[0],bearing:r,pitch:+(i[4]||0)}),!0}return!1}_updateHashUnthrottled(){const e=me.location.href.replace(/(#.+)?$/,this.getHashString());me.history.replaceState(me.history.state,null,e)}}function uw(t,e){const i=t.getCenter(),r=Math.round(100*t.getZoom())/100,n=Math.ceil((r*Math.LN2+Math.log(512/360/.5))/Math.LN10),s=Math.pow(10,n),a=Math.round(i.lng*s)/s,c=Math.round(i.lat*s)/s,p=t.getBearing(),_=t.getPitch();let v=e?`/${a}/${c}/${r}`:`${r}/${c}/${a}`;return(p||_)&&(v+="/"+Math.round(10*p)/10),_&&(v+=`/${Math.round(_)}`),v}const p_={linearity:.3,easing:Zo(0,0,.3,1)},aS=zt({deceleration:2500,maxSpeed:1400},p_),lS=zt({deceleration:20,maxSpeed:1400},p_),AS=zt({deceleration:1e3,maxSpeed:360},p_),cS=zt({deceleration:1e3,maxSpeed:90},p_);class uS{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:Xi.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,i=Xi.now();for(;e.length>0&&i-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const i={zoom:0,bearing:0,pitch:0,pan:new At(0,0),pinchAround:void 0,around:void 0};for(const{settings:s}of this._inertiaBuffer)i.zoom+=s.zoomDelta||0,i.bearing+=s.bearingDelta||0,i.pitch+=s.pitchDelta||0,s.panDelta&&i.pan._add(s.panDelta),s.around&&(i.around=s.around),s.pinchAround&&(i.pinchAround=s.pinchAround);const r=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,n={};if(i.pan.mag()){const s=__(i.pan.mag(),r,zt({},aS,e||{}));n.offset=i.pan.mult(s.amount/i.pan.mag()),n.center=this._map.transform.center,m_(n,s)}if(i.zoom){const s=__(i.zoom,r,lS);n.zoom=this._map.transform.zoom+s.amount,m_(n,s)}if(i.bearing){const s=__(i.bearing,r,AS);n.bearing=this._map.transform.bearing+hi(s.amount,-179,179),m_(n,s)}if(i.pitch){const s=__(i.pitch,r,cS);n.pitch=this._map.transform.pitch+s.amount,m_(n,s)}if(n.zoom||n.bearing){const s=i.pinchAround===void 0?i.around:i.pinchAround;n.around=s?this._map.unproject(s):this._map.getCenter()}return this.clear(),n.noMoveStart=!0,n}}function m_(t,e){(!t.duration||t.duration<e.duration)&&(t.duration=e.duration,t.easing=e.easing)}function __(t,e,i){const{maxSpeed:r,linearity:n,deceleration:s}=i,a=hi(t*n/(e/1e3),-r,r),c=Math.abs(a)/(s*n);return{easing:i.easing,duration:1e3*c,amount:a*(c/2)}}class QA extends ei{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,i,r,n={}){const s=Pl(i.getCanvasContainer(),r);super(e,zt({point:s,lngLat:i.unproject(s),originalEvent:r},n)),this._defaultPrevented=!1,this.target=i}}class g_ extends ei{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,i,r){const n=e==="touchend"?r.changedTouches:r.touches,s=uA(i.getCanvasContainer(),n),a=s.map(p=>i.unproject(p)),c=s.reduce((p,_,v,E)=>p.add(_.div(E.length)),new At(0,0));super(e,{points:s,point:c,lngLats:a,lngLat:i.unproject(c),originalEvent:r}),this._defaultPrevented=!1}}class hS extends ei{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,i,r){super(e,{originalEvent:r}),this._defaultPrevented=!1}}class dS{constructor(e,i){this._map=e,this._clickTolerance=i.clickTolerance}reset(){this._mousedownPos=void 0}wheel(e){return this._firePreventable(new hS(e.type,this._map,e))}mousedown(e,i){return this._mousedownPos=i,this._firePreventable(new QA(e.type,this._map,e))}mouseup(e){this._map.fire(new QA(e.type,this._map,e))}preclick(e){const i=zt({},e);i.type="preclick",this._map.fire(new QA(i.type,this._map,i))}click(e,i){this._mousedownPos&&this._mousedownPos.dist(i)>=this._clickTolerance||(this.preclick(e),this._map.fire(new QA(e.type,this._map,e)))}dblclick(e){return this._firePreventable(new QA(e.type,this._map,e))}mouseover(e){this._map.fire(new QA(e.type,this._map,e))}mouseout(e){this._map.fire(new QA(e.type,this._map,e))}touchstart(e){return this._firePreventable(new g_(e.type,this._map,e))}touchmove(e){this._map.fire(new g_(e.type,this._map,e))}touchend(e){this._map.fire(new g_(e.type,this._map,e))}touchcancel(e){this._map.fire(new g_(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class fS{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(e){this._map.fire(new QA(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new QA("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._map.fire(new QA(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class pS{constructor(e,i){this._map=e,this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=i.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,i){this.isEnabled()&&e.shiftKey&&e.button===0&&(Ds(),this._startPos=this._lastPos=i,this._active=!0)}mousemoveWindow(e,i){if(!this._active)return;const r=i,n=this._startPos,s=this._lastPos;if(!n||!s||s.equals(r)||!this._box&&r.dist(n)<this._clickTolerance)return;this._lastPos=r,this._box||(this._box=mn("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",e));const a=Math.min(n.x,r.x),c=Math.max(n.x,r.x),p=Math.min(n.y,r.y),_=Math.max(n.y,r.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${a}px,${p}px)`,this._box.style.width=c-a+"px",this._box.style.height=_-p+"px")})}mouseupWindow(e,i){if(!this._active)return;const r=this._startPos,n=i;if(r&&e.button===0){if(this.reset(),XA(),r.x!==n.x||r.y!==n.y)return this._map.fire(new ei("boxzoomend",{originalEvent:e})),{cameraAnimation:s=>s.fitScreenCoordinates(r,n,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",e)}}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Dl(),delete this._startPos,delete this._lastPos}_fireEvent(e,i){return this._map.fire(new ei(e,{originalEvent:i}))}}function xy(t,e){const i={};for(let r=0;r<t.length;r++)i[t[r].identifier]=e[r];return i}class mS{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(e,i,r){(this.centroid||r.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=e.timeStamp),r.length===this.numTouches&&(this.centroid=function(n){const s=new At(0,0);for(const a of n)s._add(a);return s.div(n.length)}(i),this.touches=xy(r,i)))}touchmove(e,i,r){if(this.aborted||!this.centroid)return;const n=xy(r,i);for(const s in this.touches){const a=n[s];(!a||a.dist(this.touches[s])>30)&&(this.aborted=!0)}}touchend(e,i,r){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),r.length===0){const n=!this.aborted&&this.centroid;if(this.reset(),n)return n}}}class vy{constructor(e){this.singleTap=new mS(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(e,i,r){this.singleTap.touchstart(e,i,r)}touchmove(e,i,r){this.singleTap.touchmove(e,i,r)}touchend(e,i,r){const n=this.singleTap.touchend(e,i,r);if(n){const s=e.timeStamp-this.lastTime<500,a=!this.lastTap||this.lastTap.dist(n)<30;if(s&&a||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=n,this.count===this.numTaps)return this.reset(),n}}}class _S{constructor(){this._zoomIn=new vy({numTouches:1,numTaps:2}),this._zoomOut=new vy({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,i,r){this._zoomIn.touchstart(e,i,r),this._zoomOut.touchstart(e,i,r)}touchmove(e,i,r){this._zoomIn.touchmove(e,i,r),this._zoomOut.touchmove(e,i,r)}touchend(e,i,r){const n=this._zoomIn.touchend(e,i,r),s=this._zoomOut.touchend(e,i,r);return n?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:a=>a.easeTo({duration:300,zoom:a.getZoom()+1,around:a.unproject(n)},{originalEvent:e})}):s?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:a=>a.easeTo({duration:300,zoom:a.getZoom()-1,around:a.unproject(s)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const gS={0:1,2:2};class by{constructor(e){this.reset(),this._clickTolerance=e.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(e,i){return!1}_move(e,i){return{}}mousedown(e,i){if(this._lastPoint)return;const r=is(e);this._correctButton(e,r)&&(this._lastPoint=i,this._eventButton=r)}mousemoveWindow(e,i){const r=this._lastPoint;if(r){if(e.preventDefault(),this._eventButton!=null&&function(n,s){const a=gS[s];return n.buttons===void 0||(n.buttons&a)!==a}(e,this._eventButton))this.reset();else if(this._moved||!(i.dist(r)<this._clickTolerance))return this._moved=!0,this._lastPoint=i,this._move(r,i)}}mouseupWindow(e){this._lastPoint&&is(e)===this._eventButton&&(this._moved&&XA(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class yS extends by{mousedown(e,i){super.mousedown(e,i),this._lastPoint&&(this._active=!0)}_correctButton(e,i){return i===0&&!e.ctrlKey}_move(e,i){return{around:i,panDelta:i.sub(e)}}}class hw extends by{_correctButton(e,i){return i===0&&e.ctrlKey||i===2}_move(e,i){const r=.8*(i.x-e.x);if(r)return this._active=!0,{bearingDelta:r}}contextmenu(e){e.preventDefault()}}class dw extends by{_correctButton(e,i){return i===0&&e.ctrlKey||i===2}_move(e,i){const r=-.5*(i.y-e.y);if(r)return this._active=!0,{pitchDelta:r}}contextmenu(e){e.preventDefault()}}class xS{constructor(e,i){this._map=e,this._el=e.getCanvasContainer(),this._minTouches=1,this._clickTolerance=i.clickTolerance||1,this.reset(),Un(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new At(0,0)}touchstart(e,i,r){return this._calculateTransform(e,i,r)}touchmove(e,i,r){if(this._active&&!(r.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(r.length===1&&!Ki())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return e.cancelable&&e.preventDefault(),this._calculateTransform(e,i,r)}}touchend(e,i,r){this._calculateTransform(e,i,r),this._active&&r.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,i,r){r.length>0&&(this._active=!0);const n=xy(r,i),s=new At(0,0),a=new At(0,0);let c=0;for(const _ in n){const v=n[_],E=this._touches[_];E&&(s._add(v),a._add(v.sub(E)),c++,n[_]=v)}if(this._touches=n,c<this._minTouches||!a.mag())return;const p=a.div(c);return this._sum._add(p),this._sum.mag()<this._clickTolerance?void 0:{around:s.div(c),panDelta:p}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=mn("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class wy{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(e){}_move(e,i,r){return{}}touchstart(e,i,r){this._firstTwoTouches||r.length<2||(this._firstTwoTouches=[r[0].identifier,r[1].identifier],this._start([i[0],i[1]]))}touchmove(e,i,r){const n=this._firstTwoTouches;if(!n)return;e.preventDefault();const[s,a]=n,c=y_(r,i,s),p=y_(r,i,a);if(!c||!p)return;const _=this._aroundCenter?null:c.add(p).div(2);return this._move([c,p],_,e)}touchend(e,i,r){if(!this._firstTwoTouches)return;const[n,s]=this._firstTwoTouches,a=y_(r,i,n),c=y_(r,i,s);a&&c||(this._active&&XA(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function y_(t,e,i){for(let r=0;r<t.length;r++)if(t[r].identifier===i)return e[r]}function fw(t,e){return Math.log(t/e)/Math.LN2}class vS extends wy{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,i){const r=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(fw(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:fw(this._distance,r),pinchAround:i}}}function pw(t,e){return 180*t.angleWith(e)/Math.PI}class bS extends wy{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,i){const r=this._vector;if(this._vector=e[0].sub(e[1]),r&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:pw(this._vector,r),pinchAround:i}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const i=25/(Math.PI*this._minDiameter)*360,r=this._startVector;if(!r)return!1;const n=pw(e,r);return Math.abs(n)<i}}function Ty(t){return Math.abs(t.y)>Math.abs(t.x)}class wS extends wy{constructor(e){super(),this._map=e}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(e){this._lastPoints=e,Ty(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,i,r){const n=this._lastPoints;if(!n)return;const s=e[0].sub(n[0]),a=e[1].sub(n[1]);return this._map._cooperativeGestures&&!Ki()&&r.touches.length<3||(this._valid=this.gestureBeginsVertically(s,a,r.timeStamp),!this._valid)?void 0:(this._lastPoints=e,this._active=!0,{pitchDelta:(s.y+a.y)/2*-.5})}gestureBeginsVertically(e,i,r){if(this._valid!==void 0)return this._valid;const n=e.mag()>=2,s=i.mag()>=2;if(!n&&!s)return;if(!n||!s)return this._firstMove==null&&(this._firstMove=r),r-this._firstMove<100&&void 0;const a=e.y>0==i.y>0;return Ty(e)&&Ty(i)&&a}}const TS={panStep:100,bearingStep:15,pitchStep:10};class ES{constructor(){const e=TS;this._panStep=e.panStep,this._bearingStep=e.bearingStep,this._pitchStep=e.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let i=0,r=0,n=0,s=0,a=0;switch(e.keyCode){case 61:case 107:case 171:case 187:i=1;break;case 189:case 109:case 173:i=-1;break;case 37:e.shiftKey?r=-1:(e.preventDefault(),s=-1);break;case 39:e.shiftKey?r=1:(e.preventDefault(),s=1);break;case 38:e.shiftKey?n=1:(e.preventDefault(),a=-1);break;case 40:e.shiftKey?n=-1:(e.preventDefault(),a=1);break;default:return}return this._rotationDisabled&&(r=0,n=0),{cameraAnimation:c=>{const p=c.getZoom();c.easeTo({duration:300,easeId:"keyboardHandler",easing:MS,zoom:i?Math.round(p)+i*(e.shiftKey?2:1):p,bearing:c.getBearing()+r*this._bearingStep,pitch:c.getPitch()+n*this._pitchStep,offset:[-s*this._panStep,-a*this._panStep],center:c.getCenter()},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function MS(t){return t*(2-t)}const mw=4.000244140625;class SS{constructor(e,i){this._map=e,this._el=e.getCanvasContainer(),this._handler=i,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,Un(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(e){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(e.ctrlKey||e.metaKey||this.isZooming()||Ki()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let i=e.deltaMode===me.WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const r=Xi.now(),n=r-(this._lastWheelEventTime||0);this._lastWheelEventTime=r,i!==0&&i%mw==0?this._type="wheel":i!==0&&Math.abs(i)<4?this._type="trackpad":n>400?(this._type=null,this._lastValue=i,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(n*i)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,i+=this._lastValue)),e.shiftKey&&i&&(i/=4),this._type&&(this._lastWheelEvent=e,this._delta-=i,this._active||this._start(e)),e.preventDefault()}_onTimeout(e){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(e)}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const i=Pl(this._el,e);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:i,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._map.transform;this._type==="wheel"&&e.projection.wrap&&(e._center.lng>=180||e._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const i=()=>e._terrainEnabled()&&this._aroundCoord?e.computeZoomRelativeTo(this._aroundCoord):e.zoom;if(this._delta!==0){const _=this._type==="wheel"&&Math.abs(this._delta)>mw?this._wheelZoomRate:this._defaultZoomRate;let v=2/(1+Math.exp(-Math.abs(this._delta*_)));this._delta<0&&v!==0&&(v=1/v);const E=i(),C=Math.pow(2,E),B=typeof this._targetZoom=="number"?e.zoomScale(this._targetZoom):C;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(B*v))),this._type==="wheel"&&(this._startZoom=E,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const r=typeof this._targetZoom=="number"?this._targetZoom:i(),n=this._startZoom,s=this._easing;let a,c=!1;if(this._type==="wheel"&&n&&s){const _=Math.min((Xi.now()-this._lastWheelEventTime)/200,1);a=Ji(n,r,s(_)),_<1?this._frameId||(this._frameId=!0):c=!0}else a=r,c=!0;this._active=!0,c&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let p=a-i();return p*this._lastDelta<0&&(p=0),{noInertia:!0,needsRenderFrame:!c,zoomDelta:p,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let i=gs;if(this._prevEase){const r=this._prevEase,n=(Xi.now()-r.start)/r.duration,s=r.easing(n+.01)-r.easing(n),a=.27/Math.sqrt(s*s+1e-4)*.01;i=Zo(a,Math.sqrt(.0729-a*a),.25,1)}return this._prevEase={start:Xi.now(),duration:e,easing:i},i}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=mn("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(me.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class IS{constructor(e,i){this._clickZoom=e,this._tapZoom=i}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class CS{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(e,i){return e.preventDefault(),{cameraAnimation:r=>{r.easeTo({duration:300,zoom:r.getZoom()+(e.shiftKey?-1:1),around:r.unproject(i)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class kS{constructor(){this._tap=new vy({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(e,i,r){this._swipePoint||(this._tapTime&&e.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?r.length>0&&(this._swipePoint=i[0],this._swipeTouch=r[0].identifier):this._tap.touchstart(e,i,r))}touchmove(e,i,r){if(this._tapTime){if(this._swipePoint){if(r[0].identifier!==this._swipeTouch)return;const n=i[0],s=n.y-this._swipePoint.y;return this._swipePoint=n,e.preventDefault(),this._active=!0,{zoomDelta:s/128}}}else this._tap.touchmove(e,i,r)}touchend(e,i,r){this._tapTime?this._swipePoint&&r.length===0&&this.reset():this._tap.touchend(e,i,r)&&(this._tapTime=e.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class DS{constructor(e,i,r){this._el=e,this._mousePan=i,this._touchPan=r}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class PS{constructor(e,i,r){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=i,this._mousePitch=r}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class zS{constructor(e,i,r,n){this._el=e,this._touchZoom=i,this._touchRotate=r,this._tapDragZoom=n,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const x_=t=>t.zoom||t.drag||t.pitch||t.rotate;class BS extends ei{}class LS{constructor(){this.constants=[1,1,.01],this.radius=0}setup(e,i){const r=_e.sub([],i,e);this.radius=_e.length(r[2]<0?_e.div([],r,this.constants):[r[0],r[1],0])}projectRay(e){_e.div(e,e,this.constants),_e.normalize(e,e),_e.mul(e,e,this.constants);const i=_e.scale([],e,this.radius);if(i[2]>0){const r=_e.scale([],[0,0,1],_e.dot(i,[0,0,1])),n=_e.scale([],_e.normalize([],[i[0],i[1],0]),this.radius),s=_e.add([],i,_e.scale([],_e.sub([],_e.add([],n,r),i),2));i[0]=s[0],i[1]=s[1]}return i}}function v_(t){return t.panDelta&&t.panDelta.mag()||t.zoomDelta||t.bearingDelta||t.pitchDelta}class RS{constructor(e,i){this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new uS(e),this._bearingSnap=i.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new LS,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(i),Un(["handleEvent","handleWindowEvent"],this);const r=this._el;this._listeners=[[r,"touchstart",{passive:!0}],[r,"touchmove",{passive:!1}],[r,"touchend",void 0],[r,"touchcancel",void 0],[r,"mousedown",void 0],[r,"mousemove",void 0],[r,"mouseup",void 0],[me.document,"mousemove",{capture:!0}],[me.document,"mouseup",void 0],[r,"mouseover",void 0],[r,"mouseout",void 0],[r,"dblclick",void 0],[r,"click",void 0],[r,"keydown",{capture:!1}],[r,"keyup",void 0],[r,"wheel",{passive:!1}],[r,"contextmenu",void 0],[me,"blur",void 0]];for(const[n,s,a]of this._listeners)n.addEventListener(s,n===me.document?this.handleWindowEvent:this.handleEvent,a)}destroy(){for(const[e,i,r]of this._listeners)e.removeEventListener(i,e===me.document?this.handleWindowEvent:this.handleEvent,r)}_addDefaultHandlers(e){const i=this._map,r=i.getCanvasContainer();this._add("mapEvent",new dS(i,e));const n=i.boxZoom=new pS(i,e);this._add("boxZoom",n);const s=new _S,a=new CS;i.doubleClickZoom=new IS(a,s),this._add("tapZoom",s),this._add("clickZoom",a);const c=new kS;this._add("tapDragZoom",c);const p=i.touchPitch=new wS(i);this._add("touchPitch",p);const _=new hw(e),v=new dw(e);i.dragRotate=new PS(e,_,v),this._add("mouseRotate",_,["mousePitch"]),this._add("mousePitch",v,["mouseRotate"]);const E=new yS(e),C=new xS(i,e);i.dragPan=new DS(r,E,C),this._add("mousePan",E),this._add("touchPan",C,["touchZoom","touchRotate"]);const B=new bS,O=new vS;i.touchZoomRotate=new zS(r,O,B,c),this._add("touchRotate",B,["touchPan","touchZoom"]),this._add("touchZoom",O,["touchPan","touchRotate"]),this._add("blockableMapEvent",new fS(i));const G=i.scrollZoom=new SS(i,this);this._add("scrollZoom",G,["mousePan"]);const q=i.keyboard=new ES;this._add("keyboard",q);for(const $ of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])e.interactive&&e[$]&&i[$].enable(e[$])}_add(e,i,r){this._handlers.push({handlerName:e,handler:i,allowed:r}),this._handlersById[e]=i}stop(e){if(!this._updatingCamera){for(const{handler:i}of this._handlers)i.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!x_(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(e,i,r){for(const n in e)if(n!==r&&(!i||i.indexOf(n)<0))return!0;return!1}handleWindowEvent(e){this.handleEvent(e,`${e.type}Window`)}_getMapTouches(e){const i=[];for(const r of e)this._el.contains(r.target)&&i.push(r);return i}handleEvent(e,i){this._updatingCamera=!0;const r=e.type==="renderFrame",n=r?void 0:e,s={needsRenderFrame:!1},a={},c={},p=e.touches?this._getMapTouches(e.touches):void 0,_=p?uA(this._el,p):r?void 0:Pl(this._el,e);for(const{handlerName:C,handler:B,allowed:O}of this._handlers){if(!B.isEnabled())continue;let G;this._blockedByActive(c,O,C)?B.reset():B[i||e.type]&&(G=B[i||e.type](e,_,p),this.mergeHandlerResult(s,a,G,C,n),G&&G.needsRenderFrame&&this._triggerRenderFrame()),(G||B.isActive())&&(c[C]=B)}const v={};for(const C in this._previousActiveHandlers)c[C]||(v[C]=n);this._previousActiveHandlers=c,(Object.keys(v).length||v_(s))&&(this._changes.push([s,a,v]),this._triggerRenderFrame()),(Object.keys(c).length||v_(s))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:E}=s;E&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],E(this._map))}mergeHandlerResult(e,i,r,n,s){if(!r)return;zt(e,r);const a={handlerName:n,originalEvent:r.originalEvent||s};r.zoomDelta!==void 0&&(i.zoom=a),r.panDelta!==void 0&&(i.drag=a),r.pitchDelta!==void 0&&(i.pitch=a),r.bearingDelta!==void 0&&(i.rotate=a)}_applyChanges(){const e={},i={},r={};for(const[n,s,a]of this._changes)n.panDelta&&(e.panDelta=(e.panDelta||new At(0,0))._add(n.panDelta)),n.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+n.zoomDelta),n.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+n.bearingDelta),n.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+n.pitchDelta),n.around!==void 0&&(e.around=n.around),n.aroundCoord!==void 0&&(e.aroundCoord=n.aroundCoord),n.pinchAround!==void 0&&(e.pinchAround=n.pinchAround),n.noInertia&&(e.noInertia=n.noInertia),zt(i,s),zt(r,a);this._updateMapTransform(e,i,r),this._changes=[]}_updateMapTransform(e,i,r){const n=this._map,s=n.transform,a=J=>[J.x,J.y,J.z];if((J=>{const ie=this._eventsInProgress.drag;return ie&&!this._handlersById[ie.handlerName].isActive()})()&&!v_(e)){const J=s.zoom;s.cameraElevationReference="sea",this._originalZoom!=null&&s._orthographicProjectionAtLowPitch&&s.projection.name!=="globe"&&s.pitch===0?(s.cameraElevationReference="ground",s.zoom=this._originalZoom):(s.recenterOnTerrain(),s.cameraElevationReference="ground"),J!==s.zoom&&this._map._update(!0)}if(s._isCameraConstrained&&n._stop(!0),!v_(e))return void this._fireEvents(i,r,!0);let{panDelta:c,zoomDelta:p,bearingDelta:_,pitchDelta:v,around:E,aroundCoord:C,pinchAround:B}=e;s._isCameraConstrained&&(p>0&&(p=0),s._isCameraConstrained=!1),B!==void 0&&(E=B),(p||(J=>i[J]&&!this._eventsInProgress[J])("drag"))&&E&&(this._dragOrigin=a(s.pointCoordinate3D(E)),this._originalZoom=s.zoom,this._trackingEllipsoid.setup(s._camera.position,this._dragOrigin)),s.cameraElevationReference="sea",n._stop(!0),E=E||n.transform.centerPoint,_&&(s.bearing+=_),v&&(s.pitch+=v),s._updateCameraState();const O=[0,0,0];if(c)if(s.projection.name==="mercator"){const J=this._trackingEllipsoid.projectRay(s.screenPointToMercatorRay(E).dir),ie=this._trackingEllipsoid.projectRay(s.screenPointToMercatorRay(E.sub(c)).dir);O[0]=ie[0]-J[0],O[1]=ie[1]-J[1]}else{const J=s.pointCoordinate(E);if(s.projection.name==="globe"){c=c.rotate(-s.angle);const ie=s._pixelsPerMercatorPixel/s.worldSize;O[0]=-c.x*tg(So(J.y))*ie,O[1]=-c.y*tg(s.center.lat)*ie}else{const ie=s.pointCoordinate(E.sub(c));J&&ie&&(O[0]=ie.x-J.x,O[1]=ie.y-J.y)}}const G=s.zoom,q=[0,0,0];if(p){const J=a(C||s.pointCoordinate3D(E)),ie={dir:_e.normalize([],_e.sub([],J,s._camera.position))};if(ie.dir[2]<0){const re=s.zoomDeltaToMovement(J,p);_e.scale(q,ie.dir,re)}}const $=_e.add(O,O,q);s._translateCameraConstrained($),p&&Math.abs(s.zoom-G)>1e-4&&s.recenterOnTerrain(),s.cameraElevationReference="ground",this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(i,r,!0)}_fireEvents(e,i,r){const n=x_(this._eventsInProgress),s=x_(e),a={};for(const v in e){const{originalEvent:E}=e[v];this._eventsInProgress[v]||(a[`${v}start`]=E),this._eventsInProgress[v]=e[v]}!n&&s&&this._fireEvent("movestart",s.originalEvent);for(const v in a)this._fireEvent(v,a[v]);s&&this._fireEvent("move",s.originalEvent);for(const v in e){const{originalEvent:E}=e[v];this._fireEvent(v,E)}const c={};let p;for(const v in this._eventsInProgress){const{handlerName:E,originalEvent:C}=this._eventsInProgress[v];this._handlersById[E].isActive()||(delete this._eventsInProgress[v],p=i[E]||C,c[`${v}end`]=p)}for(const v in c)this._fireEvent(v,c[v]);const _=x_(this._eventsInProgress);if(r&&(n||s)&&!_){this._updatingCamera=!0;const v=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),E=C=>C!==0&&-this._bearingSnap<C&&C<this._bearingSnap;v?(E(v.bearing||this._map.getBearing())&&(v.bearing=0),this._map.easeTo(v,{originalEvent:p})):(this._map.fire(new ei("moveend",{originalEvent:p})),E(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(e,i){this._map.fire(new ei(e,i?{originalEvent:i}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{this._frameId=void 0,this.handleEvent(new BS("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const _w="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class FS extends rs{constructor(e,i){super(),this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=i.bearingSnap,this._respectPrefersReducedMotion=i.respectPrefersReducedMotion!==!1,Un(["_renderFrameCallback"],this)}getCenter(){return new rr(this.transform.center.lng,this.transform.center.lat)}setCenter(e,i){return this.jumpTo({center:e},i)}panBy(e,i,r){return e=At.convert(e).mult(-1),this.panTo(this.transform.center,zt({offset:e},i),r)}panTo(e,i,r){return this.easeTo(zt({center:e},i),r)}getZoom(){return this.transform.zoom}setZoom(e,i){return this.jumpTo({zoom:e},i),this}zoomTo(e,i,r){return this.easeTo(zt({zoom:e},i),r)}zoomIn(e,i){return this.zoomTo(this.getZoom()+1,e,i),this}zoomOut(e,i){return this.zoomTo(this.getZoom()-1,e,i),this}getBearing(){return this.transform.bearing}setBearing(e,i){return this.jumpTo({bearing:e},i),this}getPadding(){return this.transform.padding}setPadding(e,i){return this.jumpTo({padding:e},i),this}rotateTo(e,i,r){return this.easeTo(zt({bearing:e},i),r)}resetNorth(e,i){return this.rotateTo(0,zt({duration:1e3},e),i),this}resetNorthPitch(e,i){return this.easeTo(zt({bearing:0,pitch:0,duration:1e3},e),i),this}snapToNorth(e,i){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,i):this}getPitch(){return this.transform.pitch}setPitch(e,i){return this.jumpTo({pitch:e},i),this}cameraForBounds(e,i){e=Ml.convert(e);const r=i&&i.bearing||0,n=i&&i.pitch||0,s=e.getNorthWest(),a=e.getSouthEast();return this._cameraForBounds(this.transform,s,a,r,n,i)}_extendCameraOptions(e){const i={top:0,bottom:0,right:0,left:0};if(typeof(e=zt({padding:i,offset:[0,0],maxZoom:this.transform.maxZoom},e)).padding=="number"){const r=e.padding;e.padding={top:r,bottom:r,right:r,left:r}}return e.padding=zt(i,e.padding),e}_minimumAABBFrustumDistance(e,i){const r=i.max[0]-i.min[0],n=i.max[1]-i.min[1];return r/n>e.aspect?r/(2*Math.tan(.5*e.fovX)*e.aspect):n/(2*Math.tan(.5*e.fovY)*e.aspect)}_cameraForBoundsOnGlobe(e,i,r,n,s,a){const c=e.clone(),p=this._extendCameraOptions(a);c.bearing=n,c.pitch=s;const _=rr.convert(i),v=rr.convert(r),E=.5*(_.lat+v.lat),C=.5*(_.lng+v.lng),B=da(E,C),O=_e.normalize([],B),G=_e.normalize([],_e.cross([],O,[0,1,0])),q=_e.cross([],G,O),$=[G[0],G[1],G[2],0,q[0],q[1],q[2],0,O[0],O[1],O[2],0,0,0,0,1],J=[B,da(_.lat,_.lng),da(v.lat,_.lng),da(v.lat,v.lng),da(_.lat,v.lng),da(E,_.lng),da(E,v.lng),da(_.lat,C),da(v.lat,C)];let ie=$r.fromPoints(J.map(at=>[_e.dot(G,at),_e.dot(q,at),_e.dot(O,at)]));const re=_e.transformMat4([],ie.center,$);_e.squaredLength(re)===0&&_e.set(re,0,0,1),_e.normalize(re,re),_e.scale(re,re,Fn),c.center=function([at,Tt,It]){const St=Math.hypot(at,Tt,It),Lt=Math.atan2(at,It),Ot=.5*Math.PI-Math.acos(-Tt/St);return new rr(Ir(Lt),Ir(Ot))}(re);const te=c.getWorldToCameraMatrix(),se=ce.invert(new Float64Array(16),te);ie=$r.applyTransform(ie,ce.multiply([],te,$)),_e.transformMat4(re,re,te);const he=.5*(ie.max[2]-ie.min[2]),ve=this._minimumAABBFrustumDistance(c,ie),be=_e.scale([],[0,0,1],he),Ce=_e.add(be,re,be),Ne=ve+(c.pitch===0?0:_e.distance(re,Ce)),je=c.globeCenterInViewSpace,Ye=_e.sub([],re,[je[0],je[1],je[2]]);_e.normalize(Ye,Ye),_e.scale(Ye,Ye,Ne);const Re=_e.add([],re,Ye);_e.transformMat4(Re,Re,se);const rt=Pa/Fn,lt=_e.length(Re),vt=On(Math.max(lt*rt-Pa,Number.EPSILON),0),it=Math.min(c.zoomFromMercatorZAdjusted(vt),p.maxZoom);return it>.5*(Jo+Cs)?(c.setProjection({name:"mercator"}),c.zoom=it,this._cameraForBounds(c,i,r,n,s,a)):{center:c.center,zoom:it,bearing:n,pitch:s}}queryTerrainElevation(e,i){const r=this.transform.elevation;return r?(i=zt({},{exaggerated:!0},i),r.getAtPoint(Xr.fromLngLat(e),null,i.exaggerated)):null}_cameraForBounds(e,i,r,n,s,a){if(e.projection.name==="globe")return this._cameraForBoundsOnGlobe(e,i,r,n,s,a);const c=e.clone(),p=this._extendCameraOptions(a),_=c.padding;c.bearing=n,c.pitch=s;const v=rr.convert(i),E=rr.convert(r),C=new rr(v.lng,E.lat),B=new rr(E.lng,v.lat),O=c.project(v),G=c.project(E),q=this.queryTerrainElevation(v),$=this.queryTerrainElevation(E),J=this.queryTerrainElevation(C),ie=this.queryTerrainElevation(B),re=[[O.x,O.y,Math.min(q||0,$||0,J||0,ie||0)],[G.x,G.y,Math.max(q||0,$||0,J||0,ie||0)]];let te=$r.fromPoints(re);const se=c.getWorldToCameraMatrix(),he=ce.invert(new Float64Array(16),se);te=$r.applyTransform(te,se);const ve=_e.sub([],te.max,te.min),be=_.left||0,Ce=_.right||0,Ne=_.bottom||0,je=_.top||0,{left:Ye,right:Re,top:rt,bottom:lt}=p.padding,vt=.5*(be+Ce),it=.5*(je+Ne),at=Math.min(c.scaleZoom(c.scale*Math.min((c.width-(be+Ce+Ye+Re))/ve[0],(c.height-(Ne+je+lt+rt))/ve[1])),p.maxZoom),Tt=c.scale/c.zoomScale(at);te=new $r([te.min[0]-(Ye+vt)*Tt,te.min[1]-(lt+it)*Tt,te.min[2]],[te.max[0]+(Re+vt)*Tt,te.max[1]+(rt+it)*Tt,te.max[2]]);const It=.5*ve[2],St=this._minimumAABBFrustumDistance(c,te),Lt=[0,0,1,0];U.transformMat4(Lt,Lt,se),U.normalize(Lt,Lt);const Ot=_e.scale([],Lt,St+It),jt=_e.add([],te.center,Ot),Dt=(typeof p.offset.x=="number"&&typeof p.offset.y=="number"?new At(p.offset.x,p.offset.y):At.convert(p.offset)).rotate(-Li(n));te.center[0]-=Dt.x*Tt,te.center[1]+=Dt.y*Tt,_e.transformMat4(te.center,te.center,he),_e.transformMat4(jt,jt,he);const Kt=[te.center[0],te.center[1],jt[2]*c.pixelsPerMeter];_e.scale(Kt,Kt,1/c.worldSize);const mi=TA(Kt[0]),_i=So(Kt[1]),Ti=Math.min(c._zoomFromMercatorZ(Kt[2]),p.maxZoom),Mi=new rr(mi,_i);return c.mercatorFromTransition&&Ti<.5*(Jo+Cs)?(c.setProjection({name:"globe"}),c.zoom=Ti,this._cameraForBounds(c,i,r,n,s,a)):{center:Mi,zoom:Ti,bearing:n,pitch:s}}fitBounds(e,i,r){const n=this.cameraForBounds(e,i);return this._fitInternal(n,i,r)}fitScreenCoordinates(e,i,r,n,s){const a=At.convert(e),c=At.convert(i),p=new At(Math.min(a.x,c.x),Math.min(a.y,c.y)),_=new At(Math.max(a.x,c.x),Math.max(a.y,c.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(a,c))return this;const v=this.transform.pointLocation3D(p),E=this.transform.pointLocation3D(_),C=this.transform.pointLocation3D(new At(p.x,_.y)),B=this.transform.pointLocation3D(new At(_.x,p.y)),O=[Math.min(v.lng,E.lng,C.lng,B.lng),Math.min(v.lat,E.lat,C.lat,B.lat)],G=[Math.max(v.lng,E.lng,C.lng,B.lng),Math.max(v.lat,E.lat,C.lat,B.lat)],q=n&&n.pitch?n.pitch:this.getPitch(),$=this._cameraForBounds(this.transform,O,G,r,q,n);return this._fitInternal($,n,s)}_fitInternal(e,i,r){return e?(delete(i=zt(e,i)).padding,i.linear?this.easeTo(i,r):this.flyTo(i,r)):this}jumpTo(e,i){this.stop();const r=e.preloadOnly?this.transform.clone():this.transform;let n=!1,s=!1,a=!1;return"zoom"in e&&r.zoom!==+e.zoom&&(n=!0,r.zoom=+e.zoom),e.center!==void 0&&(r.center=rr.convert(e.center)),"bearing"in e&&r.bearing!==+e.bearing&&(s=!0,r.bearing=+e.bearing),"pitch"in e&&r.pitch!==+e.pitch&&(a=!0,r.pitch=+e.pitch),e.padding==null||r.isPaddingEqual(e.padding)||(r.padding=e.padding),e.preloadOnly?(this._preloadTiles(r),this):(this.fire(new ei("movestart",i)).fire(new ei("move",i)),n&&this.fire(new ei("zoomstart",i)).fire(new ei("zoom",i)).fire(new ei("zoomend",i)),s&&this.fire(new ei("rotatestart",i)).fire(new ei("rotate",i)).fire(new ei("rotateend",i)),a&&this.fire(new ei("pitchstart",i)).fire(new ei("pitch",i)).fire(new ei("pitchend",i)),this.fire(new ei("moveend",i)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||Pe(_w),this.transform.getFreeCameraOptions()}setFreeCameraOptions(e,i){const r=this.transform;if(!r.projection.supportsFreeCamera)return Pe(_w),this;this.stop();const n=r.zoom,s=r.pitch,a=r.bearing;r.setFreeCameraOptions(e);const c=n!==r.zoom,p=s!==r.pitch,_=a!==r.bearing;return this.fire(new ei("movestart",i)).fire(new ei("move",i)),c&&this.fire(new ei("zoomstart",i)).fire(new ei("zoom",i)).fire(new ei("zoomend",i)),_&&this.fire(new ei("rotatestart",i)).fire(new ei("rotate",i)).fire(new ei("rotateend",i)),p&&this.fire(new ei("pitchstart",i)).fire(new ei("pitch",i)).fire(new ei("pitchend",i)),this.fire(new ei("moveend",i)),this}easeTo(e,i){this._stop(!1,e.easeId),((e=zt({offset:[0,0],duration:500,easing:gs},e)).animate===!1||this._prefersReducedMotion(e))&&(e.duration=0);const r=this.transform,n=this.getZoom(),s=this.getBearing(),a=this.getPitch(),c=this.getPadding(),p="zoom"in e?+e.zoom:n,_="bearing"in e?this._normalizeBearing(e.bearing,s):s,v="pitch"in e?+e.pitch:a,E="padding"in e?e.padding:r.padding,C=At.convert(e.offset);let B,O,G;if(r.projection.name==="globe"){const be=Xr.fromLngLat(r.center),Ce=C.rotate(-r.angle);be.x+=Ce.x/r.worldSize,be.y+=Ce.y/r.worldSize;const Ne=be.toLngLat(),je=rr.convert(e.center||Ne);this._normalizeCenter(je),B=r.centerPoint.add(Ce),O=new At(be.x,be.y).mult(r.worldSize),G=new At(jo(je.lng),ea(je.lat)).mult(r.worldSize).sub(O)}else{B=r.centerPoint.add(C);const be=r.pointLocation(B),Ce=rr.convert(e.center||be);this._normalizeCenter(Ce),O=r.project(be),G=r.project(Ce).sub(O)}const q=r.zoomScale(p-n);let $,J;e.around&&($=rr.convert(e.around),J=r.locationPoint($));const ie=this._zooming||p!==n,re=this._rotating||s!==_,te=this._pitching||v!==a,se=!r.isPaddingEqual(E),he=be=>Ce=>{if(ie&&(be.zoom=Ji(n,p,Ce)),re&&(be.bearing=Ji(s,_,Ce)),te&&(be.pitch=Ji(a,v,Ce)),se&&(be.interpolatePadding(c,E,Ce),B=be.centerPoint.add(C)),$)be.setLocationAtPoint($,J);else{const Ne=be.zoomScale(be.zoom-n),je=p>n?Math.min(2,q):Math.max(.5,q),Ye=Math.pow(je,1-Ce),Re=be.unproject(O.add(G.mult(Ce*Ye)).mult(Ne));be.setLocationAtPoint(be.renderWorldCopies?Re.wrap():Re,B)}return e.preloadOnly||this._fireMoveEvents(i),be};if(e.preloadOnly){const be=this._emulate(he,e.duration,r);return this._preloadTiles(be),this}const ve={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ie,this._rotating=re,this._pitching=te,this._padding=se,this._easeId=e.easeId,this._prepareEase(i,e.noMoveStart,ve),this._ease(he(r),be=>{r.cameraElevationReference==="sea"&&r.recenterOnTerrain(),this._afterEase(i,be)},e),this}_prepareEase(e,i,r={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),i||r.moving||this.fire(new ei("movestart",e)),this._zooming&&!r.zooming&&this.fire(new ei("zoomstart",e)),this._rotating&&!r.rotating&&this.fire(new ei("rotatestart",e)),this._pitching&&!r.pitching&&this.fire(new ei("pitchstart",e))}_fireMoveEvents(e){this.fire(new ei("move",e)),this._zooming&&this.fire(new ei("zoom",e)),this._rotating&&this.fire(new ei("rotate",e)),this._pitching&&this.fire(new ei("pitch",e))}_afterEase(e,i){if(this._easeId&&i&&this._easeId===i)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const r=this._zooming,n=this._rotating,s=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,r&&this.fire(new ei("zoomend",e)),n&&this.fire(new ei("rotateend",e)),s&&this.fire(new ei("pitchend",e)),this.fire(new ei("moveend",e))}flyTo(e,i){if(this._prefersReducedMotion(e)){const at=dr(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(at,i)}this.stop(),e=zt({offset:[0,0],speed:1.2,curve:1.42,easing:gs},e);const r=this.transform,n=this.getZoom(),s=this.getBearing(),a=this.getPitch(),c=this.getPadding(),p="zoom"in e?hi(+e.zoom,r.minZoom,r.maxZoom):n,_="bearing"in e?this._normalizeBearing(e.bearing,s):s,v="pitch"in e?+e.pitch:a,E="padding"in e?e.padding:r.padding,C=r.zoomScale(p-n),B=At.convert(e.offset);let O=r.centerPoint.add(B);const G=r.pointLocation(O),q=rr.convert(e.center||G);this._normalizeCenter(q);const $=r.project(G),J=r.project(q).sub($);let ie=e.curve;const re=Math.max(r.width,r.height),te=re/C,se=J.mag();if("minZoom"in e){const at=hi(Math.min(e.minZoom,n,p),r.minZoom,r.maxZoom),Tt=re/r.zoomScale(at-n);ie=Math.sqrt(Tt/se*2)}const he=ie*ie;function ve(at){const Tt=(te*te-re*re+(at?-1:1)*he*he*se*se)/(2*(at?te:re)*he*se);return Math.log(Math.sqrt(Tt*Tt+1)-Tt)}function be(at){return(Math.exp(at)-Math.exp(-at))/2}function Ce(at){return(Math.exp(at)+Math.exp(-at))/2}const Ne=ve(0);let je=function(at){return Ce(Ne)/Ce(Ne+ie*at)},Ye=function(at){return re*((Ce(Ne)*(be(Tt=Ne+ie*at)/Ce(Tt))-be(Ne))/he)/se;var Tt},Re=(ve(1)-Ne)/ie;if(Math.abs(se)<1e-6||!isFinite(Re)){if(Math.abs(re-te)<1e-6)return this.easeTo(e,i);const at=te<re?-1:1;Re=Math.abs(Math.log(te/re))/ie,Ye=function(){return 0},je=function(Tt){return Math.exp(at*ie*Tt)}}e.duration="duration"in e?+e.duration:1e3*Re/("screenSpeed"in e?+e.screenSpeed/ie:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0);const rt=s!==_,lt=v!==a,vt=!r.isPaddingEqual(E),it=at=>Tt=>{const It=Tt*Re,St=1/je(It);at.zoom=Tt===1?p:n+at.scaleZoom(St),rt&&(at.bearing=Ji(s,_,Tt)),lt&&(at.pitch=Ji(a,v,Tt)),vt&&(at.interpolatePadding(c,E,Tt),O=at.centerPoint.add(B));const Lt=Tt===1?q:at.unproject($.add(J.mult(Ye(It))).mult(St));return at.setLocationAtPoint(at.renderWorldCopies?Lt.wrap():Lt,O),at._updateCameraOnTerrain(),e.preloadOnly||this._fireMoveEvents(i),at};if(e.preloadOnly){const at=this._emulate(it,e.duration,r);return this._preloadTiles(at),this}return this._zooming=!0,this._rotating=rt,this._pitching=lt,this._padding=vt,this._prepareEase(i,!1),this._ease(it(r),()=>this._afterEase(i),e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,i){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const r=this._onEaseEnd;this._onEaseEnd=void 0,r.call(this,i)}if(!e){const r=this.handlers;r&&r.stop(!1)}return this}_ease(e,i,r){r.animate===!1||r.duration===0?(e(1),i()):(this._easeStart=Xi.now(),this._easeOptions=r,this._onEaseFrame=e,this._onEaseEnd=i,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const e=Math.min((Xi.now()-this._easeStart)/this._easeOptions.duration,1),i=this._onEaseFrame;i&&i(this._easeOptions.easing(e)),e<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(e,i){e=Hn(e,-180,180);const r=Math.abs(e-i);return Math.abs(e-360-i)<r&&(e-=360),Math.abs(e+360-i)<r&&(e+=360),e}_normalizeCenter(e){const i=this.transform;if(i.maxBounds||i.projection.name!=="globe"&&!i.renderWorldCopies)return;const r=e.lng-i.center.lng;e.lng+=r>180?-360:r<-180?360:0}_prefersReducedMotion(e){return this._respectPrefersReducedMotion&&Xi.prefersReducedMotion&&!(e&&e.essential)}_emulate(e,i,r){const n=Math.ceil(15*i/1e3),s=[],a=e(r.clone());for(let c=0;c<=n;c++){const p=a(c/n);s.push(p.clone())}return s}}class gw{constructor(e={}){this.options=e,Un(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(e){const i=this.options&&this.options.compact;return this._map=e,this._container=mn("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=mn("button","mapboxgl-ctrl-attrib-button",this._container),mn("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=mn("div","mapboxgl-ctrl-attrib-inner",this._container),i&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),i===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(e,i){const r=this._map._getUIString(`AttributionControl.${i}`);e.removeAttribute("title"),e.firstElementChild&&e.firstElementChild.setAttribute("title",r)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let e=this._editLink;e||(e=this._editLink=this._container.querySelector(".mapbox-improve-map"));const i=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||yt.ACCESS_TOKEN}];if(e){const r=i.reduce((n,s,a)=>(s.value&&(n+=`${s.key}=${s.value}${a<i.length-1?"&":""}`),n),"?");e.href=`${yt.FEEDBACK_URL}/${r}#${uw(this._map,!0)}`,e.rel="noopener nofollow",this._setElementTitle(e,"MapFeedback")}}_updateData(e){!e||e.sourceDataType!=="metadata"&&e.sourceDataType!=="visibility"&&e.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let e=[];if(this._map.style.stylesheet){const n=this._map.style.stylesheet;this.styleOwner=n.owner,this.styleId=n.id}const i=this._map.style._mergedSourceCaches;for(const n in i){const s=i[n];if(s.used){const a=s.getSource();a.attribution&&e.indexOf(a.attribution)<0&&e.push(a.attribution)}}e.sort((n,s)=>n.length-s.length),e=e.filter((n,s)=>{for(let a=s+1;a<e.length;a++)if(e[a].indexOf(n)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=[...this.options.customAttribution,...e]:e.unshift(this.options.customAttribution));const r=e.join(" | ");r!==this._attribHTML&&(this._attribHTML=r,e.length?(this._innerContainer.innerHTML=r,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class yw{constructor(){Un(["_updateLogo","_updateCompact"],this)}onAdd(e){this._map=e,this._container=mn("div","mapboxgl-ctrl");const i=mn("a","mapboxgl-ctrl-logo");return i.target="_blank",i.rel="noopener nofollow",i.href="https://www.mapbox.com/",i.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),i.setAttribute("rel","noopener nofollow"),this._container.appendChild(i),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(e){e&&e.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const e=this._map.style._sourceCaches;if(Object.entries(e).length===0)return!0;for(const i in e){const r=e[i].getSource();if(r.hasOwnProperty("mapbox_logo")&&!r.mapbox_logo)return!1}return!0}_updateCompact(){const e=this._container.children;if(e.length){const i=e[0];this._map.getCanvasContainer().offsetWidth<250?i.classList.add("mapboxgl-compact"):i.classList.remove("mapboxgl-compact")}}}class xw{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const i=++this._id;return this._queue.push({callback:e,id:i,cancelled:!1}),i}remove(e){const i=this._currentlyRunning,r=i?this._queue.concat(i):this._queue;for(const n of r)if(n.id===e)return void(n.cancelled=!0)}run(e=0){const i=this._currentlyRunning=this._queue;this._queue=[];for(const r of i)if(!r.cancelled&&(r.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function vw(t,e,i){if(t=new rr(t.lng,t.lat),e){const r=new rr(t.lng-360,t.lat),n=new rr(t.lng+360,t.lat),s=360*Math.ceil(Math.abs(t.lng-i.center.lng)/360),a=i.locationPoint(t).distSqr(e),c=e.x<0||e.y<0||e.x>i.width||e.y>i.height;i.locationPoint(r).distSqr(e)<a&&(c||Math.abs(r.lng-i.center.lng)<s)?t=r:i.locationPoint(n).distSqr(e)<a&&(c||Math.abs(n.lng-i.center.lng)<s)&&(t=n)}for(;Math.abs(t.lng-i.center.lng)>180;){const r=i.locationPoint(t);if(r.x>=0&&r.y>=0&&r.x<=i.width&&r.y<=i.height)break;t.lng>i.center.lng?t.lng-=360:t.lng+=360}return t}const Ey={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class My extends rs{constructor(e,i){if(super(),(e instanceof me.HTMLElement||i)&&(e=zt({element:e},i)),Un(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=e&&e.occludedOpacity||.2,e&&e.element)this._element=e.element,this._offset=At.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=mn("div");const s=41,a=27,c=Qo("svg",{display:"block",height:s*this._scale+"px",width:a*this._scale+"px",viewBox:`0 0 ${a} ${s}`},this._element),p=Qo("radialGradient",{id:"shadowGradient"},Qo("defs",{},c));Qo("stop",{offset:"10%","stop-opacity":.4},p),Qo("stop",{offset:"100%","stop-opacity":.05},p),Qo("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},c),Qo("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},c),Qo("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},c),Qo("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},c),this._offset=At.convert(e&&e.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",s=>{s.preventDefault()}),this._element.addEventListener("mousedown",s=>{s.preventDefault()});const r=this._element.classList;for(const s in Ey)r.remove(`mapboxgl-marker-anchor-${s}`);r.add(`mapboxgl-marker-anchor-${this._anchor}`);const n=e&&e.className?e.className.trim().split(/\s+/):[];r.add(...n),this._popup=null}addTo(e){return e===this._map||(this.remove(),this._map=e,e.getCanvasContainer().appendChild(this._element),e.on("move",this._updateMoving),e.on("moveend",this._update),e.on("remove",this._clearFadeTimer),e._addMarker(this),this.setDraggable(this._draggable),this._update(),e.on("click",this._onMapClick)),this}remove(){const e=this._map;return e&&(e.off("click",this._onMapClick),e.off("move",this._updateMoving),e.off("moveend",this._update),e.off("mousedown",this._addDragHandler),e.off("touchstart",this._addDragHandler),e.off("mouseup",this._onUp),e.off("touchend",this._onUp),e.off("mousemove",this._onMove),e.off("touchmove",this._onMove),e.off("remove",this._clearFadeTimer),e._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=rr.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const n=Math.sqrt(Math.pow(13.5,2)/2);e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[n,-1*(38.1-13.5+n)],"bottom-right":[-n,-1*(38.1-13.5+n)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,e._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(e){const i=e.code,r=e.charCode||e.keyCode;i!=="Space"&&i!=="Enter"&&r!==32&&r!==13||this.togglePopup()}_onMapClick(e){const i=e.originalEvent.target,r=this._element;this._popup&&(i===r||r.contains(i))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const e=this._popup;return e?(e.isOpen()?(e.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(e.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const e=this._map,i=this._pos;if(!e||!i)return!1;const r=e.unproject(i),n=e.getFreeCameraOptions();if(!n.position)return!1;const s=n.position.toLngLat();return s.distanceTo(r)<.9*s.distanceTo(this._lngLat)}_evaluateOpacity(){const e=this._map;if(!e)return;const i=this._pos;if(!i||i.x<0||i.x>e.transform.width||i.y<0||i.y>e.transform.height)return void this._clearFadeTimer();const r=e.unproject(i);let n;e._showingGlobe()&&Hh(e.transform,this._lngLat)?n=0:(n=1-e._queryFogOpacity(r),e.transform._terrainEnabled()&&e.getTerrain()&&this._behindTerrain()&&(n*=this._occludedOpacity)),this._element.style.opacity=`${n}`,this._element.style.pointerEvents=n>0?"auto":"none",this._popup&&this._popup._setOpacity(n),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const e=this._pos;if(!e||!this._map)return;const i=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${e.x}px,${e.y}px)
            ${Ey[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${i.x}px,${i.y}px)
        `}_calculateXYTransform(){const e=this._pos,i=this._map,r=this.getPitchAlignment();if(!i||!e||r!=="map")return"";if(!i._showingGlobe()){const p=i.getPitch();return p?`rotateX(${p}deg)`:""}const n=Ir(Qh(i.transform,this._lngLat)),s=e.sub(wA(i.transform)),a=Math.abs(s.x)+Math.abs(s.y);if(a===0)return"";const c=n/a;return`rotateX(${-s.y*c}deg) rotateY(${s.x*c}deg)`}_calculateZTransform(){const e=this._pos,i=this._map;if(!i||!e)return"";let r=0;const n=this.getRotationAlignment();if(n==="map")if(i._showingGlobe()){const s=i.project(new rr(this._lngLat.lng,this._lngLat.lat+.001)),a=i.project(new rr(this._lngLat.lng,this._lngLat.lat-.001)).sub(s);r=Ir(Math.atan2(a.y,a.x))-90}else r=-i.getBearing();else if(n==="horizon"){const s=Yr(4,6,i.getZoom()),a=wA(i.transform);a.y+=s*i.transform.height;const c=e.sub(a),p=Ir(Math.atan2(c.y,c.x));r=(p>90?p-270:p+90)*(1-s)}return r+=this._rotation,r?`rotateZ(${r}deg)`:""}_update(e){me.cancelAnimationFrame(this._updateFrameId);const i=this._map;i&&(i.transform.renderWorldCopies&&(this._lngLat=vw(this._lngLat,this._pos,i.transform)),this._pos=i.project(this._lngLat),e===!0?this._updateFrameId=me.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),i._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(i._showingGlobe()||i.getTerrain()||i.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(e){return this._offset=At.convert(e),this._update(),this}addClassName(e){return this._element.classList.add(e),this}removeClassName(e){return this._element.classList.remove(e),this}toggleClassName(e){return this._element.classList.toggle(e)}_onMove(e){const i=this._map;if(!i)return;const r=this._pointerdownPos,n=this._positionDelta;if(r&&n){if(!this._isDragging){const s=this._clickTolerance||i._clickTolerance;if(e.point.dist(r)<s)return;this._isDragging=!0}this._pos=e.point.sub(n),this._lngLat=i.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new ei("dragstart"))),this.fire(new ei("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const e=this._map;e&&(e.off("mousemove",this._onMove),e.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new ei("dragend")),this._state="inactive"}_addDragHandler(e){const i=this._map,r=this._pos;i&&r&&this._element.contains(e.originalEvent.target)&&(e.preventDefault(),this._positionDelta=e.point.sub(r),this._pointerdownPos=e.point,this._state="pending",i.on("mousemove",this._onMove),i.on("touchmove",this._onMove),i.once("mouseup",this._onUp),i.once("touchend",this._onUp))}setDraggable(e){this._draggable=!!e;const i=this._map;return i&&(e?(i.on("mousedown",this._addDragHandler),i.on("touchstart",this._addDragHandler)):(i.off("mousedown",this._addDragHandler),i.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(e){return this._occludedOpacity=e||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const OS={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},VS=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function bw(t=new At(0,0),e="bottom"){if(typeof t=="number"){const i=Math.round(Math.sqrt(.5*Math.pow(t,2)));switch(e){case"top":return new At(0,t);case"top-left":return new At(i,i);case"top-right":return new At(-i,i);case"bottom":return new At(0,-t);case"bottom-left":return new At(i,-i);case"bottom-right":return new At(-i,-i);case"left":return new At(t,0);case"right":return new At(-t,0)}return new At(0,0)}return t instanceof At||Array.isArray(t)?At.convert(t):At.convert(t[e]||[0,0])}class NS{constructor(e){this.jumpTo(e)}getValue(e){if(e<=this._startTime)return this._start;if(e>=this._endTime)return this._end;const i=es((e-this._startTime)/(this._endTime-this._startTime));return this._start*(1-i)+this._end*i}isEasing(e){return e>=this._startTime&&e<=this._endTime}jumpTo(e){this._startTime=-1/0,this._endTime=-1/0,this._start=e,this._end=e}easeTo(e,i,r){this._start=this.getValue(i),this._end=e,this._startTime=i,this._endTime=i+r}}const US={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},jS={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1},GS={showCompass:!0,showZoom:!0,visualizePitch:!1};class ZS{constructor(e,i,r=!1){this._clickTolerance=10,this.element=i,this.mouseRotate=new hw({clickTolerance:e.dragRotate._mouseRotate._clickTolerance}),this.map=e,r&&(this.mousePitch=new dw({clickTolerance:e.dragRotate._mousePitch._clickTolerance})),Un(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),i.addEventListener("mousedown",this.mousedown),i.addEventListener("touchstart",this.touchstart,{passive:!1}),i.addEventListener("touchmove",this.touchmove),i.addEventListener("touchend",this.touchend),i.addEventListener("touchcancel",this.reset)}down(e,i){this.mouseRotate.mousedown(e,i),this.mousePitch&&this.mousePitch.mousedown(e,i),Ds()}move(e,i){const r=this.map,n=this.mouseRotate.mousemoveWindow(e,i),s=n&&n.bearingDelta;if(s&&r.setBearing(r.getBearing()+s),this.mousePitch){const a=this.mousePitch.mousemoveWindow(e,i),c=a&&a.pitchDelta;c&&r.setPitch(r.getPitch()+c)}}off(){const e=this.element;e.removeEventListener("mousedown",this.mousedown),e.removeEventListener("touchstart",this.touchstart,{passive:!1}),e.removeEventListener("touchmove",this.touchmove),e.removeEventListener("touchend",this.touchend),e.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Dl(),me.removeEventListener("mousemove",this.mousemove),me.removeEventListener("mouseup",this.mouseup)}mousedown(e){this.down(zt({},e,{ctrlKey:!0,preventDefault:()=>e.preventDefault()}),Pl(this.element,e)),me.addEventListener("mousemove",this.mousemove),me.addEventListener("mouseup",this.mouseup)}mousemove(e){this.move(e,Pl(this.element,e))}mouseup(e){this.mouseRotate.mouseupWindow(e),this.mousePitch&&this.mousePitch.mouseupWindow(e),this.offTemp()}touchstart(e){e.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=uA(this.element,e.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>e.preventDefault()},this._startPos))}touchmove(e){e.targetTouches.length!==1?this.reset():(this._lastPos=uA(this.element,e.targetTouches)[0],this.move({preventDefault:()=>e.preventDefault()},this._lastPos))}touchend(e){e.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const qS={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},QS={maxWidth:100,unit:"metric"},HS={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},b_={version:Xt,supported:DA,setRTLTextPlugin:function(t,e,i=!1){if(Qa===Pf||Qa===zf||Qa===Bf)throw new Error("setRTLTextPlugin cannot be called multiple times.");kc=Xi.resolveURL(t),Qa=Pf,Ih=e,Mu(),i||yp()},getRTLTextPluginStatus:Rf,Map:class extends FS{constructor(t){Di.mark(gt.create);const e=t;if((t=zt({},jS,t)).minZoom!=null&&t.maxZoom!=null&&t.minZoom>t.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(t.minPitch!=null&&t.maxPitch!=null&&t.minPitch>t.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(t.minPitch!=null&&t.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(t.maxPitch!=null&&t.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(t.antialias&&function(i){const r=i.navigator?i.navigator.userAgent:null;return!!function(n){if(Qi==null){const s=n.navigator?n.navigator.userAgent:null;Qi=!!n.safari||!(!s||!(/\b(iPad|iPhone|iPod)\b/.test(s)||s.match("Safari")&&!s.match("Chrome")))}return Qi}(i)&&r&&(r.match("Version/15.4")||r.match("Version/15.5")||r.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))}(me)&&(t.antialias=!1,Pe("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Ng(t.minZoom,t.maxZoom,t.minPitch,t.maxPitch,t.renderWorldCopies),t),this._interactive=t.interactive,this._minTileCacheSize=t.minTileCacheSize,this._maxTileCacheSize=t.maxTileCacheSize,this._failIfMajorPerformanceCaveat=t.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=t.preserveDrawingBuffer,this._antialias=t.antialias,this._trackResize=t.trackResize,this._bearingSnap=t.bearingSnap,this._refreshExpiredTiles=t.refreshExpiredTiles,this._fadeDuration=t.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=t.crossSourceCollisions,this._collectResourceTiming=t.collectResourceTiming,this._language=this._parseLanguage(t.language),this._worldview=t.worldview,this._renderTaskQueue=new xw,this._domRenderTaskQueue=new xw,this._controls=[],this._markers=[],this._popups=[],this._mapId=Es(),this._locale=zt({},US,t.locale),this._clickTolerance=t.clickTolerance,this._cooperativeGestures=t.cooperativeGestures,this._performanceMetricsCollection=t.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new NS(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new Me(t.transformRequest,t.accessToken,t.testMode),this._silenceAuthErrors=!!t.testMode,this._contextCreateOptions=t.contextCreateOptions?{...t.contextCreateOptions}:{},typeof t.container=="string"){if(this._container=me.document.getElementById(t.container),!this._container)throw new Error(`Container '${t.container.toString()}' not found.`)}else{if(!(t.container instanceof me.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=t.container}if(this._container.childNodes.length>0&&Pe("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),t.maxBounds&&this.setMaxBounds(t.maxBounds),Un(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),me!==void 0&&(this._fullscreenchangeEvent="onfullscreenchange"in me.document?"fullscreenchange":"webkitfullscreenchange",me.addEventListener("online",this._onWindowOnline,!1),me.addEventListener("resize",this._onWindowResize,!1),me.addEventListener("orientationchange",this._onWindowResize,!1),me.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),me.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new RS(this,t),this._localFontFamily=t.localFontFamily,this._localIdeographFontFamily=t.localIdeographFontFamily,(t.style||!t.testMode)&&this.setStyle(t.style||yt.DEFAULT_STYLE,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),t.projection&&this.setProjection(t.projection),t.hash&&(this._hash=new oS(typeof t.hash=="string"&&t.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){e.center==null&&e.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:t.center,zoom:t.zoom,bearing:t.bearing,pitch:t.pitch});const i=t.bounds;i&&(this.resize(),this.fitBounds(i,zt({},t.fitBoundsOptions,{duration:0})))}this.resize(),t.attributionControl&&this.addControl(new gw({customAttribution:t.customAttribution})),this._logoControl=new yw,this.addControl(this._logoControl,t.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",i=>{this._update(i.dataType==="style"),this.fire(new ei(`${i.dataType}data`,i))}),this.on("dataloading",i=>{this.fire(new ei(`${i.dataType}dataloading`,i))})}_getMapId(){return this._mapId}addControl(t,e){if(e===void 0&&(e=t.getDefaultPosition?t.getDefaultPosition():"top-right"),!t||!t.onAdd)return this.fire(new ir(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const i=t.onAdd(this);this._controls.push(t);const r=this._controlPositions[e];return e.indexOf("bottom")!==-1?r.insertBefore(i,r.firstChild):r.appendChild(i),this}removeControl(t){if(!t||!t.onRemove)return this.fire(new ir(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(t);return e>-1&&this._controls.splice(e,1),t.onRemove(this),this}hasControl(t){return this._controls.indexOf(t)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(t){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const e=!this._moving;return e&&this.fire(new ei("movestart",t)).fire(new ei("move",t)),this.fire(new ei("resize",t)),e&&this.fire(new ei("moveend",t)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(t){return this.transform.setMaxBounds(Ml.convert(t)),this._update()}setMinZoom(t){if((t=t??-2)>=-2&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t?this.setZoom(t):this.fire(new ei("zoomstart")).fire(new ei("zoom")).fire(new ei("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(t){if((t=t??22)>=this.transform.minZoom)return this.transform.maxZoom=t,this._update(),this.getZoom()>t?this.setZoom(t):this.fire(new ei("zoomstart")).fire(new ei("zoom")).fire(new ei("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(t){if((t=t??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(t>=0&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this._update(),this.getPitch()<t?this.setPitch(t):this.fire(new ei("pitchstart")).fire(new ei("pitch")).fire(new ei("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(t){if((t=t??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this._update(),this.getPitch()>t?this.setPitch(t):this.fire(new ei("pitchstart")).fire(new ei("pitch")).fire(new ei("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(t){return this.transform.renderWorldCopies=t,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(t){return t==="auto"?me.navigator.language:Array.isArray(t)?t.length===0?void 0:t.map(e=>e==="auto"?me.navigator.language:e):t}setLanguage(t){const e=this._parseLanguage(t);if(!this.style||e===this._language)return this;this._language=e,this.style.reloadSources();for(const i of this._controls)i._setLanguage&&i._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(t){return this.style&&t!==this._worldview?(this._worldview=t,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(t){return this._lazyInitEmptyStyle(),t?typeof t=="string"&&(t={name:t}):t=null,this._useExplicitProjection=!!t,this._prioritizeAndUpdateProjection(t,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const t=this.transform,e=t.projection.name;let i;e==="globe"&&t.zoom>=Cs?(t.setMercatorFromTransition(),i=!0):e==="mercator"&&t.zoom<Cs&&(t.setProjection({name:"globe"}),i=!0),i&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(t,e){return this._updateProjection(t||e||{name:"mercator"})}_updateProjection(t){let e;return e=t.name==="globe"&&this.transform.zoom>=Cs?this.transform.setMercatorFromTransition():this.transform.setProjection(t),this.style.applyProjectionUpdate(),e&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(t){return this.transform.locationPoint3D(rr.convert(t))}unproject(t){return this.transform.pointLocation3D(At.convert(t))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(t,e,i){if(t==="mouseenter"||t==="mouseover"){let r=!1;const n=a=>{const c=e.filter(_=>this.getLayer(_)),p=c.length?this.queryRenderedFeatures(a.point,{layers:c}):[];p.length?r||(r=!0,i.call(this,new QA(t,this,a.originalEvent,{features:p}))):r=!1},s=()=>{r=!1};return{layers:new Set(e),listener:i,delegates:{mousemove:n,mouseout:s}}}if(t==="mouseleave"||t==="mouseout"){let r=!1;const n=a=>{const c=e.filter(p=>this.getLayer(p));(c.length?this.queryRenderedFeatures(a.point,{layers:c}):[]).length?r=!0:r&&(r=!1,i.call(this,new QA(t,this,a.originalEvent)))},s=a=>{r&&(r=!1,i.call(this,new QA(t,this,a.originalEvent)))};return{layers:new Set(e),listener:i,delegates:{mousemove:n,mouseout:s}}}{const r=n=>{const s=e.filter(c=>this.getLayer(c)),a=s.length?this.queryRenderedFeatures(n.point,{layers:s}):[];a.length&&(n.features=a,i.call(this,n),delete n.features)};return{layers:new Set(e),listener:i,delegates:{[t]:r}}}}on(t,e,i){if(i===void 0)return super.on(t,e);if(Array.isArray(e)||(e=[e]),e){for(const n of e)if(!this._isValidId(n))return this}const r=this._createDelegatedListener(t,e,i);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[t]=this._delegatedListeners[t]||[],this._delegatedListeners[t].push(r);for(const n in r.delegates)this.on(n,r.delegates[n]);return this}once(t,e,i){if(i===void 0)return super.once(t,e);if(Array.isArray(e)||(e=[e]),e){for(const n of e)if(!this._isValidId(n))return this}const r=this._createDelegatedListener(t,e,i);for(const n in r.delegates)this.once(n,r.delegates[n]);return this}off(t,e,i){if(i===void 0)return super.off(t,e);e=new Set(Array.isArray(e)?e:[e]);for(const s of e)if(!this._isValidId(s))return this;const r=(s,a)=>{if(s.size!==a.size)return!1;for(const c of s)if(!a.has(c))return!1;return!0},n=this._delegatedListeners?this._delegatedListeners[t]:void 0;return n&&(s=>{for(let a=0;a<s.length;a++){const c=s[a];if(c.listener===i&&r(c.layers,e)){for(const p in c.delegates)this.off(p,c.delegates[p]);return s.splice(a,1),this}}})(n),this}queryRenderedFeatures(t,e){if(!this.style)return[];if(e!==void 0||t===void 0||t instanceof At||Array.isArray(t)||(e=t,t=void 0),t=t||[[0,0],[this.transform.width,this.transform.height]],(e=e||{}).layers&&Array.isArray(e.layers)){for(const i of e.layers)if(!this._isValidId(i))return[]}return this.style.queryRenderedFeatures(t,e,this.transform)}querySourceFeatures(t,e){return this._isValidId(t)?this.style.querySourceFeatures(t,e):[]}isPointOnSurface(t){const{name:e}=this.transform.projection;return e!=="globe"&&e!=="mercator"&&Pe(`${e} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(At.convert(t))}setStyle(t,e){return(e=zt({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&e.localFontFamily===this._localFontFamily&&this.style&&t?(this._diffStyle(t,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._localFontFamily=e.localFontFamily,this._updateStyle(t,e))}_getUIString(t){const e=this._locale[t];if(e==null)throw new Error(`Missing UI string '${t}'`);return e}_updateStyle(t,e){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),t&&(this.style=new Xc(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof t=="string"?this.style.loadURL(t):this.style.loadJSON(t)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Xc(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(t,e){if(typeof t=="string"){const i=this._requestManager.normalizeStyleURL(t),r=this._requestManager.transformRequest(i,we.Style);Be(r,(n,s)=>{n?this.fire(new ir(n)):s&&this._updateDiff(s,e)})}else typeof t=="object"&&this._updateDiff(t,e)}_updateDiff(t,e){try{this.style.setState(t)&&this._update(!0)}catch(i){Pe(`Unable to perform style diff: ${i.message||i.error||i}.  Rebuilding the style from scratch.`),this._updateStyle(t,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(Pe("There is no style added to the map."),!1)}_isValidId(t){return t==null?(this.fire(new ir(new Error("IDs can't be empty."))),!1):!Of(t)||(this.fire(new ir(new Error(`IDs can't contain special symbols: "${t}".`))),!1)}addSource(t,e){return this._isValidId(t)?(this._lazyInitEmptyStyle(),this.style.addSource(t,e),this._update(!0)):this}isSourceLoaded(t){return!!this._isValidId(t)&&!!this.style&&this.style._isSourceCacheLoaded(t)}areTilesLoaded(){const t=this.style&&this.style._sourceCaches;for(const e in t){const i=t[e]._tiles;for(const r in i){const n=i[r];if(n.state!=="loaded"&&n.state!=="errored")return!1}}return!0}addSourceType(t,e,i){this._lazyInitEmptyStyle(),this.style.addSourceType(t,e,i)}removeSource(t){return this._isValidId(t)?(this.style.removeSource(t),this._updateTerrain(),this._update(!0)):this}getSource(t){return this._isValidId(t)?this.style.getOwnSource(t):null}addImage(t,e,{pixelRatio:i=1,sdf:r=!1,stretchX:n,stretchY:s,content:a}={}){if(this._lazyInitEmptyStyle(),e instanceof me.HTMLImageElement||me.ImageBitmap&&e instanceof me.ImageBitmap){const{width:c,height:p,data:_}=Xi.getImageData(e);this.style.addImage(t,{data:new bo({width:c,height:p},_),pixelRatio:i,stretchX:n,stretchY:s,content:a,sdf:r,version:0})}else if(e.width===void 0||e.height===void 0)this.fire(new ir(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:c,height:p}=e,_=e;this.style.addImage(t,{data:new bo({width:c,height:p},new Uint8Array(_.data)),pixelRatio:i,stretchX:n,stretchY:s,content:a,sdf:r,version:0,userImage:_}),_.onAdd&&_.onAdd(this,t)}}updateImage(t,e){this._lazyInitEmptyStyle();const i=this.style.getImage(t);if(!i)return void this.fire(new ir(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const r=e instanceof me.HTMLImageElement||me.ImageBitmap&&e instanceof me.ImageBitmap?Xi.getImageData(e):e,{width:n,height:s}=r;n!==void 0&&s!==void 0?n===i.data.width&&s===i.data.height?(i.data.replace(r.data,!(e instanceof me.HTMLImageElement||me.ImageBitmap&&e instanceof me.ImageBitmap)),this.style.updateImage(t,i)):this.fire(new ir(new Error(`The width and height of the updated image (${n}, ${s})
                must be that same as the previous version of the image
                (${i.data.width}, ${i.data.height})`))):this.fire(new ir(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(t){return t?!!this.style&&!!this.style.getImage(t):(this.fire(new ir(new Error("Missing required image id"))),!1)}removeImage(t){this.style.removeImage(t)}loadImage(t,e){Et(this._requestManager.transformRequest(t,we.Image),(i,r)=>{e(i,r instanceof me.HTMLImageElement?Xi.getImageData(r):r)})}listImages(){return this.style.listImages()}addModel(t,e){this._lazyInitEmptyStyle(),this.style.addModel(t,e)}hasModel(t){return t?this.style.hasModel(t):(this.fire(new ir(new Error("Missing required model id"))),!1)}removeModel(t){this.style.removeModel(t)}listModels(){return this.style.listModels()}addLayer(t,e){return this._isValidId(t.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(t,e),this._update(!0)):this}moveLayer(t,e){return this._isValidId(t)?(this.style.moveLayer(t,e),this._update(!0)):this}removeLayer(t){return this._isValidId(t)?(this.style.removeLayer(t),this._update(!0)):this}getLayer(t){return this._isValidId(t)?this.style.getOwnLayer(t):null}setLayerZoomRange(t,e,i){return this._isValidId(t)?(this.style.setLayerZoomRange(t,e,i),this._update(!0)):this}setFilter(t,e,i={}){return this._isValidId(t)?(this.style.setFilter(t,e,i),this._update(!0)):this}getFilter(t){return this._isValidId(t)?this.style.getFilter(t):null}setPaintProperty(t,e,i,r={}){return this._isValidId(t)?(this.style.setPaintProperty(t,e,i,r),this._update(!0)):this}getPaintProperty(t,e){return this._isValidId(t)?this.style.getPaintProperty(t,e):null}setLayoutProperty(t,e,i,r={}){return this._isValidId(t)?(this.style.setLayoutProperty(t,e,i,r),this._update(!0)):this}getLayoutProperty(t,e){return this._isValidId(t)?this.style.getLayoutProperty(t,e):null}getConfigProperty(t,e){return this.style.getConfigProperty(t,e)}setConfigProperty(t,e,i){return this.style.setConfigProperty(t,e,i),this._update(!0)}setLights(t){if(this._lazyInitEmptyStyle(),t&&t.length===1&&t[0].type==="flat"){const e=t[0];e.properties?this.style.setFlatLight(e.properties,e.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(t),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const t=this.style.getLights()||[];return t.length===0&&t.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),t}setLight(t,e={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:t}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(t){return this._lazyInitEmptyStyle(),!t&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(t),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(t){return this._lazyInitEmptyStyle(),this.style.setFog(t),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setCamera(t){return this.style.setCamera(t),this._triggerCameraUpdate(t)}_triggerCameraUpdate(t){return this._update(this.transform.setOrthographicProjectionAtLowPitch(t["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(t){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(rr.convert(t),this.transform):0}setFeatureState(t,e){return this._isValidId(t.source)?(this.style.setFeatureState(t,e),this._update()):this}removeFeatureState(t,e){return this._isValidId(t.source)?(this.style.removeFeatureState(t,e),this._update()):this}getFeatureState(t){return this._isValidId(t.source)?this.style.getFeatureState(t):null}_updateContainerDimensions(){if(!this._container)return;const t=this._container.getBoundingClientRect().width||400,e=this._container.getBoundingClientRect().height||300;let i,r,n,s=this._container;for(;s&&(!r||!n);){const a=me.getComputedStyle(s).transform;a&&a!=="none"&&(i=a.match(/matrix.*\((.+)\)/)[1].split(", "),i[0]&&i[0]!=="0"&&i[0]!=="1"&&(r=i[0]),i[3]&&i[3]!=="0"&&i[3]!=="1"&&(n=i[3])),s=s.parentElement}this._containerWidth=r?Math.abs(t/r):t,this._containerHeight=n?Math.abs(e/n):e}_detectMissingCSS(){me.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&Pe("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const t=this._container;t.classList.add("mapboxgl-map"),(this._missingCSSCanary=mn("div","mapboxgl-canary",t)).style.visibility="hidden",this._detectMissingCSS();const e=this._canvasContainer=mn("div","mapboxgl-canvas-container",t);this._canvas=mn("canvas","mapboxgl-canvas",e),this._interactive&&(e.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const i=this._controlContainer=mn("div","mapboxgl-control-container",t),r=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(n=>{r[n]=mn("div",`mapboxgl-ctrl-${n}`,i)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(t,e){const i=Xi.devicePixelRatio||1;this._canvas.width=i*Math.ceil(t),this._canvas.height=i*Math.ceil(e),this._canvas.style.width=`${t}px`,this._canvas.style.height=`${e}px`}_addMarker(t){this._markers.push(t)}_removeMarker(t){const e=this._markers.indexOf(t);e!==-1&&this._markers.splice(e,1)}_addPopup(t){this._popups.push(t)}_removePopup(t){const e=this._popups.indexOf(t);e!==-1&&this._popups.splice(e,1)}_setupPainter(){const t=zt({},DA.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),e=this._canvas.getContext("webgl2",t);e?(Dr(e,!0),this.painter=new Y4(e,this._contextCreateOptions,this.transform),this.on("data",i=>{i.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),qt.testSupport(e)):this.fire(new ir(new Error("Failed to initialize WebGL")))}_contextLost(t){t.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new ei("webglcontextlost",{originalEvent:t}))}_contextRestored(t){this._setupPainter(),this.resize(),this._update(),this.fire(new ei("webglcontextrestored",{originalEvent:t}))}_onMapScroll(t){if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(t){return this.style?(this._styleDirty=this._styleDirty||t,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(t){return this._update(),this._renderTaskQueue.add(t)}_cancelRenderFrame(t){this._renderTaskQueue.remove(t)}_requestDomTask(t){!this.loaded()||this.loaded()&&!this.isMoving()?t():this._domRenderTaskQueue.add(t)}_render(t){let e;this.fire(new ei("renderstart"));const i=this.painter.context.extTimerQuery,r=Xi.now(),n=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(e=n.createQuery(),n.beginQuery(i.TIME_ELAPSED_EXT,e)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],me.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],me.performance.now())),this._renderTaskQueue.run(t),this._domRenderTaskQueue.run(t),this._removed)return;this._updateProjectionTransition();const s=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const p=this.transform.zoom,_=this.transform.pitch,v=Xi.now(),E=new ds(p,{now:v,fadeDuration:s,pitch:_,transition:this.style.transition});this.style.update(E)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let a=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),a=this._updateAverageElevation(r),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):a=this._updateAverageElevation(r),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,s,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:s,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new ei("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new ei("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),e){const p=Xi.now()-r;n.endQuery(i.TIME_ELAPSED_EXT),setTimeout(()=>{const _=n.getQueryParameter(e,n.QUERY_RESULT)/1e6;n.deleteQuery(e),this.fire(new ei("gpu-timing-frame",{cpuTime:p,gpuTime:_})),me.performance.mark("frame-gpu",{startTime:r,detail:{gpuTime:_}})},50)}if(this.listens("gpu-timing-layer")){const p=this.painter.collectGpuTimers();setTimeout(()=>{const _=this.painter.queryGpuTimers(p);this.fire(new ei("gpu-timing-layer",{layerTimes:_}))},50)}if(this.listens("gpu-timing-deferred-render")){const p=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const _=this.painter.queryGpuTimeDeferredRender(p);this.fire(new ei("gpu-timing-deferred-render",{gpuTime:_}))},50)}const c=this._sourcesDirty||this._styleDirty||this._placementDirty||a;if(c||this._repaint)this.triggerRepaint();else{const p=!this.isMoving()&&this.loaded();if(p&&(a=this._updateAverageElevation(r,!0)),a)this.triggerRepaint();else if(this._triggerFrame(!1),p&&(this.fire(new ei("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const _=this._calculateSpeedIndex();this.fire(new ei("speedindexcompleted",{speedIndex:_})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||c||(this._fullyLoaded=!0,Di.mark(gt.fullLoad),this._performanceMetricsCollection&&Rs(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(t){for(const e of this._markers)t&&!this.getRenderWorldCopies()&&(e._lngLat=e._lngLat.wrap()),e._update();for(const e of this._popups)!t||this.getRenderWorldCopies()||e._trackPointer||(e._lngLat=e._lngLat.wrap()),e._update()}_updateAverageElevation(t,e=!1){const i=n=>(this.transform.averageElevation=n,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&i(0);const r=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(r||(e||t-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(t)){const n=this.transform.averageElevation;let s=this.transform.sampleAverageElevation();this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(s)?s=0:this._averageElevationLastSampledAt=t;const a=Math.abs(n-s);if(a>1){if(this._isInitialLoad||r)return this._averageElevation.jumpTo(s),i(s);this._averageElevation.easeTo(s,t,300)}else if(a>1e-4)return this._averageElevation.jumpTo(s),i(s)}return!!this._averageElevation.isEasing(t)&&i(this._averageElevation.getValue(t))}_authenticate(){nn(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,t=>{if(t&&(t.message===xe||t.status===401)){const e=this.painter.context.gl;Dr(e,!1),this._logoControl instanceof yw&&this._logoControl._updateLogo(),e&&e.clear(e.DEPTH_BUFFER_BIT|e.COLOR_BUFFER_BIT|e.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new ir(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),HA(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const t=this._isDragging();this.painter.updateTerrain(this.style,t)}_calculateSpeedIndex(){const t=this.painter.canvasCopy(),e=this.painter.getCanvasCopiesAndTimestamps();e.timeStamps.push(performance.now());const i=this.painter.context.gl,r=i.createFramebuffer();function n(s){i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,s,0);const a=new Uint8Array(i.drawingBufferWidth*i.drawingBufferHeight*4);return i.readPixels(0,0,i.drawingBufferWidth,i.drawingBufferHeight,i.RGBA,i.UNSIGNED_BYTE,a),a}return i.bindFramebuffer(i.FRAMEBUFFER,r),this._canvasPixelComparison(n(t),e.canvasCopies.map(n),e.timeStamps)}_canvasPixelComparison(t,e,i){let r=i[1]-i[0];const n=t.length/4;for(let s=0;s<e.length;s++){const a=e[s];let c=0;for(let p=0;p<a.length;p+=4)a[p]===t[p]&&a[p+1]===t[p+1]&&a[p+2]===t[p+2]&&a[p+3]===t[p+3]&&(c+=1);r+=(i[s+2]-i[s+1])*(1-c/n)}return r}remove(){this._hash&&this._hash.remove();for(const e of this._controls)e.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),me!==void 0&&(me.removeEventListener("resize",this._onWindowResize,!1),me.removeEventListener("orientationchange",this._onWindowResize,!1),me.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),me.removeEventListener("online",this._onWindowOnline,!1),me.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),qo.delete(this.painter.context.gl),this._removed=!0,this.fire(new ei("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(t){this._renderNextFrame=this._renderNextFrame||t,this.style&&!this._frame&&(this._frame=Xi.frame(e=>{const i=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,i&&this._render(e)}))}_preloadTiles(t){return Co(this.style?Object.values(this.style._sourceCaches):[],(e,i)=>e._preloadTiles(t,i),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(t){this._trackResize&&this.resize({originalEvent:t})._update()}_onVisibilityChange(){me.document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(t){this._showTileBoundaries!==t&&(this._showTileBoundaries=t,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(t){this._showTerrainWireframe!==t&&(this._showTerrainWireframe=t,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(t){this._showLayers2DWireframe!==t&&(this._showLayers2DWireframe=t,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(t){this._showLayers3DWireframe!==t&&(this._showLayers3DWireframe=t,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(t){this._speedIndexTiming!==t&&(this._speedIndexTiming=t,this._update())}get showPadding(){return!!this._showPadding}set showPadding(t){this._showPadding!==t&&(this._showPadding=t,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(t){this._showCollisionBoxes!==t&&(this._showCollisionBoxes=t,t?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(t){this._showOverdrawInspector!==t&&(this._showOverdrawInspector=t,this._update())}get repaint(){return!!this._repaint}set repaint(t){this._repaint!==t&&(this._repaint=t,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(t){this._vertices=t,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(t){this._showTileAABBs!==t&&(this._showTileAABBs=t,t&&this._update())}_setCacheLimits(t,e){(function(i,r){ys=i,ls=r})(t,e)}get version(){return Xt}},NavigationControl:class{constructor(t){this.options=zt({},GS,t),this._container=mn("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(Un(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",e=>{this._map&&this._map.zoomIn({},{originalEvent:e})}),mn("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",e=>{this._map&&this._map.zoomOut({},{originalEvent:e})}),mn("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(Un(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",e=>{const i=this._map;i&&(this.options.visualizePitch?i.resetNorthPitch({},{originalEvent:e}):i.resetNorth({},{originalEvent:e}))}),this._compassIcon=mn("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const t=this._map;if(!t)return;const e=t.getZoom(),i=e===t.getMaxZoom(),r=e===t.getMinZoom();this._zoomInButton.disabled=i,this._zoomOutButton.disabled=r,this._zoomInButton.setAttribute("aria-disabled",i.toString()),this._zoomOutButton.setAttribute("aria-disabled",r.toString())}_rotateCompassArrow(){const t=this._map;if(!t)return;const e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(t.transform.pitch*(Math.PI/180)),.5)}) rotateX(${t.transform.pitch}deg) rotateZ(${t.transform.angle*(180/Math.PI)}deg)`:`rotate(${t.transform.angle*(180/Math.PI)}deg)`;t._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=e)})}onAdd(t){return this._map=t,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),t.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&t.on("pitch",this._rotateCompassArrow),t.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ZS(t,this._compass,this.options.visualizePitch)),this._container}onRemove(){const t=this._map;t&&(this._container.remove(),this.options.showZoom&&t.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&t.off("pitch",this._rotateCompassArrow),t.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(t,e){const i=mn("button",t,this._container);return i.type="button",i.addEventListener("click",e),i}_setButtonTitle(t,e){if(!this._map)return;const i=this._map._getUIString(`NavigationControl.${e}`);t.setAttribute("aria-label",i),t.firstElementChild&&t.firstElementChild.setAttribute("title",i)}},GeolocateControl:class extends rs{constructor(t){super(),this.options=zt({geolocation:me.navigator.geolocation},qS,t),Un(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=cw(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(t){return this._map=t,this._container=mn("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(t){const e=(i=!!this.options.geolocation)=>{this._supportsGeolocation=i,t(i)};this._supportsGeolocation!==void 0?t(this._supportsGeolocation):me.navigator.permissions!==void 0?me.navigator.permissions.query({name:"geolocation"}).then(i=>e(i.state!=="denied")).catch(()=>e()):e()}_isOutOfMapMaxBounds(t){const e=this._map.getMaxBounds(),i=t.coords;return!!e&&(i.longitude<e.getWest()||i.longitude>e.getEast()||i.latitude<e.getSouth()||i.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(t){if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new ei("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new ei("geolocate",t)),this._finish()}}_updateCamera(t){const e=new rr(t.coords.longitude,t.coords.latitude),i=t.coords.accuracy,r=zt({bearing:this._map.getBearing()},this.options.fitBoundsOptions);this._map.fitBounds(e.toBounds(i),r,{geolocateSource:!0})}_updateMarker(t){if(t){const e=new rr(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(e).addTo(this._map),this._userLocationDotMarker.setLngLat(e).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const t=this._map.transform,e=On(1,t._center.lat)*t.worldSize,i=Math.ceil(2*this._accuracy*e);this._circleElement.style.width=`${i}px`,this._circleElement.style.height=`${i}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(t){if(this._map){if(this.options.trackUserLocation)if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new ei("error",t)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(t){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=mn("button","mapboxgl-ctrl-geolocate",this._container),mn("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",t===!1){Pe("Geolocation support is not available so the GeolocateControl will be disabled.");const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e)}else{const e=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=mn("div","mapboxgl-user-location"),this._dotElement.appendChild(mn("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(mn("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new My({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=mn("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new My({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",e=>{e.geolocateSource||this._watchState!=="ACTIVE_LOCK"||e.originalEvent&&e.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new ei("trackuserlocationend")))})}}_onDeviceOrientation(t){this._userLocationDotMarker&&(t.webkitCompassHeading?this._heading=t.webkitCompassHeading:t.absolute===!0&&(this._heading=-1*t.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return Pe("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new ei("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new ei("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new ei("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let t;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(t={maximumAge:6e5,timeout:0},this._noTimeout=!0):(t=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,t),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const t=()=>{me.addEventListener("ondeviceorientationabsolute"in me?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};me.DeviceMotionEvent!==void 0&&typeof me.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(e=>{e==="granted"&&t()}).catch(console.error):t()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),me.removeEventListener("deviceorientation",this._onDeviceOrientation),me.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:gw,ScaleControl:class{constructor(t){this.options=zt({},QS,t),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),Un(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const t=this.options.maxWidth||100,e=this._map,i=e._containerHeight/2,r=e._containerWidth/2-t/2,n=e.unproject([r,i]),s=e.unproject([r+t,i]),a=n.distanceTo(s);if(this.options.unit==="imperial"){const c=3.2808*a;c>5280?this._setScale(t,c/5280,"mile"):this._setScale(t,c,"foot")}else this.options.unit==="nautical"?this._setScale(t,a/1852,"nautical-mile"):a>=1e3?this._setScale(t,a/1e3,"kilometer"):this._setScale(t,a,"meter")}_setScale(t,e,i){this._map._requestDomTask(()=>{const r=function(s){const a=Math.pow(10,`${Math.floor(s)}`.length-1);let c=s/a;return c=c>=10?10:c>=5?5:c>=3?3:c>=2?2:c>=1?1:function(p){const _=Math.pow(10,Math.ceil(-Math.log(p)/Math.LN10));return Math.round(p*_)/_}(c),a*c}(e),n=r/e;this._container.innerHTML=this._isNumberFormatSupported&&i!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:i}).format(r):`${r}&nbsp;${HS[i]}`,this._container.style.width=t*n+"px"})}onAdd(t){return this._map=t,this._language=t.getLanguage(),this._container=mn("div","mapboxgl-ctrl mapboxgl-ctrl-scale",t.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(t){this._language=t,this._update()}setUnit(t){this.options.unit=t,this._update()}},FullscreenControl:class{constructor(t){this._fullscreen=!1,t&&t.container&&(t.container instanceof me.HTMLElement?this._container=t.container:Pe("Full screen control 'container' must be a DOM element.")),Un(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in me.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in me.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(t){return this._map=t,this._container||(this._container=this._map.getContainer()),this._controlContainer=mn("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",Pe("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,me.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!me.document.fullscreenEnabled&&!me.document.webkitFullscreenEnabled)}_setupUI(){const t=this._fullscreenButton=mn("button","mapboxgl-ctrl-fullscreen",this._controlContainer);mn("span","mapboxgl-ctrl-icon",t).setAttribute("aria-hidden","true"),t.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),me.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const t=this._getTitle();this._fullscreenButton.setAttribute("aria-label",t),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",t)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(me.document.fullscreenElement||me.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?me.document.exitFullscreen?me.document.exitFullscreen():me.document.webkitCancelFullScreen&&me.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends rs{constructor(t){super(),this.options=zt(Object.create(OS),t),Un(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(t&&t.className?t.className.trim().split(/\s+/):[])}addTo(t){return this._map&&this.remove(),this._map=t,this.options.closeOnClick&&t.on("preclick",this._onClose),this.options.closeOnMove&&t.on("move",this._onClose),t.on("remove",this.remove),this._update(),t._addPopup(this),this._focusFirstElement(),this._trackPointer?(t.on("mousemove",this._onMouseEvent),t.on("mouseup",this._onMouseEvent),t._canvasContainer.classList.add("mapboxgl-track-pointer")):t.on("move",this._update),this.fire(new ei("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const t=this._map;return t&&(t.off("move",this._update),t.off("move",this._onClose),t.off("preclick",this._onClose),t.off("click",this._onClose),t.off("remove",this.remove),t.off("mousemove",this._onMouseEvent),t.off("mouseup",this._onMouseEvent),t.off("drag",this._onMouseEvent),t._canvasContainer&&t._canvasContainer.classList.remove("mapboxgl-track-pointer"),t._removePopup(this),this._map=void 0),this.fire(new ei("close")),this}getLngLat(){return this._lngLat}setLngLat(t){this._lngLat=rr.convert(t),this._pos=null,this._trackPointer=!1,this._update();const e=this._map;return e&&(e.on("move",this._update),e.off("mousemove",this._onMouseEvent),e._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const t=this._map;return t&&(t.off("move",this._update),t.on("mousemove",this._onMouseEvent),t.on("drag",this._onMouseEvent),t._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(t){return this.setDOMContent(me.document.createTextNode(t))}setHTML(t){const e=me.document.createDocumentFragment(),i=me.document.createElement("body");let r;for(i.innerHTML=t;r=i.firstChild,r;)e.appendChild(r);return this.setDOMContent(e)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(t){return this.options.maxWidth=t,this._update(),this}setDOMContent(t){let e=this._content;if(e)for(;e.hasChildNodes();)e.firstChild&&e.removeChild(e.firstChild);else e=this._content=mn("div","mapboxgl-popup-content",this._container||void 0);if(e.appendChild(t),this.options.closeButton){const i=this._closeButton=mn("button","mapboxgl-popup-close-button",e);i.type="button",i.setAttribute("aria-label","Close popup"),i.setAttribute("aria-hidden","true"),i.innerHTML="&#215;",i.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(t){return this._classList.add(t),this._updateClassList(),this}removeClassName(t){return this._classList.delete(t),this._updateClassList(),this}setOffset(t){return this.options.offset=t,this._update(),this}toggleClassName(t){let e;return this._classList.delete(t)?e=!1:(this._classList.add(t),e=!0),this._updateClassList(),e}_onMouseEvent(t){this._update(t.point)}_getAnchor(t){if(this.options.anchor)return this.options.anchor;const e=this._map,i=this._container,r=this._pos;if(!e||!i||!r)return"bottom";const n=i.offsetWidth,s=i.offsetHeight,a=r.x<n/2,c=r.x>e.transform.width-n/2;if(r.y+t<s)return a?"top-left":c?"top-right":"top";if(r.y>e.transform.height-s){if(a)return"bottom-left";if(c)return"bottom-right"}return a?"left":c?"right":"bottom"}_updateClassList(){const t=this._container;if(!t)return;const e=[...this._classList];e.push("mapboxgl-popup"),this._anchor&&e.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&e.push("mapboxgl-popup-track-pointer"),t.className=e.join(" ")}_update(t){const e=this._map,i=this._content;if(!e||!this._lngLat&&!this._trackPointer||!i)return;let r=this._container;if(r||(r=this._container=mn("div","mapboxgl-popup",e.getContainer()),this._tip=mn("div","mapboxgl-popup-tip",r),r.appendChild(i)),this.options.maxWidth&&r.style.maxWidth!==this.options.maxWidth&&(r.style.maxWidth=this.options.maxWidth),e.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=vw(this._lngLat,this._pos,e.transform)),!this._trackPointer||t){const n=this._pos=this._trackPointer&&t?t:e.project(this._lngLat),s=bw(this.options.offset),a=this._anchor=this._getAnchor(s.y),c=bw(this.options.offset,a),p=n.add(c).round();e._requestDomTask(()=>{this._container&&a&&(this._container.style.transform=`${Ey[a]} translate(${p.x}px,${p.y}px)`)})}if(!this._marker&&e._showingGlobe()){const n=Hh(e.transform,this._lngLat)?0:1;this._setOpacity(n)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const t=this._container.querySelector(VS);t&&t.focus()}_onClose(){this.remove()}_setOpacity(t){this._container&&(this._container.style.opacity=`${t}`),this._content&&(this._content.style.pointerEvents=t?"auto":"none")}},Marker:My,Style:Xc,LngLat:rr,LngLatBounds:Ml,Point:At,MercatorCoordinate:Xr,FreeCameraOptions:zx,Evented:rs,config:yt,prewarm:function(){Y0().acquire(Xg)},clearPrewarmedResources:function(){const t=X0;t&&(t.isPreloaded()&&t.numActive()===1?(t.release(Xg),X0=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return yt.ACCESS_TOKEN},set accessToken(t){yt.ACCESS_TOKEN=t},get baseApiUrl(){return yt.API_URL},set baseApiUrl(t){yt.API_URL=t},get workerCount(){return df.workerCount},set workerCount(t){df.workerCount=t},get maxParallelImageRequests(){return yt.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(t){yt.MAX_PARALLEL_IMAGE_REQUESTS=t},clearStorage(t){(function(e){if(!wr())return;const i=me.caches.delete(vr);e&&i.catch(e).then(()=>e())})(t)},workerUrl:"",workerClass:null,get dracoUrl(){return Wv()},set dracoUrl(t){(function(e){Yg=Xi.resolveURL(e),Kg||(Kg=new ed(Y0(),new rs)),Kg.broadcast("setDracoUrl",Yg)})(t)},setNow:Xi.setNow,restoreNow:Xi.restoreNow};We.A=Vv,We.D=wm,We.E=Mt,We.F=yg,We.K=o_,We.O=fi,We.P=At,We.T=nv,We.V=gm,We.a=_m,We.b=R1,We.c=Ym,We.d=class extends rs{constructor(t,e,i,r,n,s){super(),this.actor=t,this.layerIndex=e,this.availableImages=i,this.loadVectorData=n||Qv,this.loading={},this.loaded={},this.deduped=new qv(t.scheduler),this.isSpriteLoaded=r,this.scheduler=t.scheduler,this.brightness=s}loadTile(t,e){const i=t.uid,r=t&&t.request,n=r&&r.collectResourceTiming,s=this.loading[i]=new dM(t);s.abort=this.loadVectorData(t,(a,c)=>{const p=!this.loading[i];if(delete this.loading[i],p||a||!c)return s.status="done",p||(this.loaded[i]=s),e(a);const _=c.rawData,v={};c.expires&&(v.expires=c.expires),c.cacheControl&&(v.cacheControl=c.cacheControl),s.vectorTile=c.vectorTile||new _g(new bm(_));const E=()=>{s.parse(s.vectorTile,this.layerIndex,this.availableImages,this.actor,(C,B)=>{if(C||!B)return e(C);const O={};if(n){const G=Hs(r);G.length>0&&(O.resourceTiming=JSON.parse(JSON.stringify(G)))}e(null,zt({rawTileData:_.slice(0)},B,v,O))})};this.isSpriteLoaded?E():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(E,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom}):E()}),this.loaded=this.loaded||{},this.loaded[i]=s})}reloadTile(t,e){const i=this.loaded,r=t.uid,n=this;if(i&&i[r]){const s=i[r];s.showCollisionBoxes=t.showCollisionBoxes,s.projection=t.projection,s.brightness=t.brightness,s.tileTransform=$h(t.tileID.canonical,t.projection),s.extraShadowCaster=t.extraShadowCaster;const a=(c,p)=>{const _=s.reloadCallback;_&&(delete s.reloadCallback,s.parse(s.vectorTile,n.layerIndex,this.availableImages,n.actor,_)),e(c,p)};s.status==="parsing"?s.reloadCallback=a:s.status==="done"&&(s.vectorTile?s.parse(s.vectorTile,this.layerIndex,this.availableImages,this.actor,a):a())}else e(null,void 0)}abortTile(t,e){const i=t.uid,r=this.loading[i];r&&(r.abort&&r.abort(),delete this.loading[i]),e()}removeTile(t,e){const i=this.loaded,r=t.uid;i&&i[r]&&delete i[r],e()}},We.e=Yi,We.f=Hs,We.g=qr,We.h=Be,We.i=Ve,We.j=function(t,e){const i=ny(t);for(const r of i){for(const n of r.meshes)wM(n);r.lights&&(r.lightMeshIndex=r.meshes.length,r.meshes.push(TM(r.lights,e)))}return i},We.k=ds,We.l=function(t){let e=0;if(new Uint32Array(t,0,1)[0]!==Xv){const i=new Uint32Array(t,0,7),[,,r,n,s,a]=i;e=i.byteLength+n+s+a+s,(r!==t.byteLength||e>=t.byteLength)&&Pe("Invalid b3dm header information.")}return eb(t,e)},We.m=Pm,We.n=vA,We.o=ei,We.p=rn,We.q=function(t){Cn(),gi&&gi.then(e=>{e.keys().then(i=>{for(let r=0;r<i.length-t;r++)e.delete(i[r])})})},We.r=sb,We.s=b_,We.t=M0,We.v=to,We.w=me}),Bt(["./shared"],function(We){function me(Yt){if(typeof Yt=="number"||typeof Yt=="boolean"||typeof Yt=="string"||Yt==null)return JSON.stringify(Yt);if(Array.isArray(Yt)){let $e="[";for(const Pe of Yt)$e+=`${me(Pe)},`;return`${$e}]`}let Ue="{";for(const $e of Object.keys(Yt).sort())Ue+=`${$e}:${me(Yt[$e])},`;return`${Ue}}`}function Xt(Yt){let Ue="";for(const $e of We.r)Ue+=`/${me(Yt[$e])}`;return Ue}class Rt{constructor(Ue){this.keyCache={},this._layers={},this._layerConfigs={},Ue&&this.replace(Ue)}replace(Ue,$e){this._layerConfigs={},this._layers={},this.update(Ue,[],$e)}update(Ue,$e,Pe){this._options=Pe;for(const Zt of Ue){this._layerConfigs[Zt.id]=Zt;const ni=this._layers[Zt.id]=We.c(Zt,this._options);ni.setScope(this.scope),ni.compileFilter(),this.keyCache[Zt.id]&&delete this.keyCache[Zt.id]}for(const Zt of $e)delete this.keyCache[Zt],delete this._layerConfigs[Zt],delete this._layers[Zt];this.familiesBySource={};const Ft=function(Zt,ni){const ri={};for(let Oi=0;Oi<Zt.length;Oi++){const Qi=ni&&ni[Zt[Oi].id]||Xt(Zt[Oi]);ni&&(ni[Zt[Oi].id]=Qi);let Ki=ri[Qi];Ki||(Ki=ri[Qi]=[]),Ki.push(Zt[Oi])}const Qt=[];for(const Oi in ri)Qt.push(ri[Oi]);return Qt}(We.v(this._layerConfigs),this.keyCache);for(const Zt of Ft){const ni=Zt.map(Kr=>this._layers[Kr.id]),ri=ni[0];if(ri.visibility==="none")continue;const Qt=ri.source||"";let Oi=this.familiesBySource[Qt];Oi||(Oi=this.familiesBySource[Qt]={});const Qi=ri.sourceLayer||"_geojsonTileLayer";let Ki=Oi[Qi];Ki||(Ki=Oi[Qi]=[]),Ki.push(ni)}}}class yt{loadTile(Ue,$e){const{uid:Pe,encoding:Ft,rawImageData:Zt,padding:ni}=Ue,ri=We.w.ImageBitmap&&Zt instanceof We.w.ImageBitmap?this.getImageData(Zt,ni):Zt;$e(null,new We.D(Pe,ri,Ft,ni<1))}getImageData(Ue,$e){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Ue.width,Ue.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=Ue.width,this.offscreenCanvas.height=Ue.height,this.offscreenCanvasContext.drawImage(Ue,0,0,Ue.width,Ue.height);const Pe=this.offscreenCanvasContext.getImageData(-$e,-$e,Ue.width+2*$e,Ue.height+2*$e);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),Pe}}function qt(Yt,Ue){if(Yt.length!==0){$t(Yt[0],Ue);for(var $e=1;$e<Yt.length;$e++)$t(Yt[$e],!Ue)}}function $t(Yt,Ue){for(var $e=0,Pe=0,Ft=0,Zt=Yt.length,ni=Zt-1;Ft<Zt;ni=Ft++){var ri=(Yt[Ft][0]-Yt[ni][0])*(Yt[ni][1]+Yt[Ft][1]),Qt=$e+ri;Pe+=Math.abs($e)>=Math.abs(ri)?$e-Qt+ri:ri-Qt+$e,$e=Qt}$e+Pe>=0!=!!Ue&&Yt.reverse()}var ui=We.g(function Yt(Ue,$e){var Pe,Ft=Ue&&Ue.type;if(Ft==="FeatureCollection")for(Pe=0;Pe<Ue.features.length;Pe++)Yt(Ue.features[Pe],$e);else if(Ft==="GeometryCollection")for(Pe=0;Pe<Ue.geometries.length;Pe++)Yt(Ue.geometries[Pe],$e);else if(Ft==="Feature")Yt(Ue.geometry,$e);else if(Ft==="Polygon")qt(Ue.coordinates,$e);else if(Ft==="MultiPolygon")for(Pe=0;Pe<Ue.coordinates.length;Pe++)qt(Ue.coordinates[Pe],$e);return Ue});const di=We.V.prototype.toGeoJSON;var Ei={exports:{}},Vr=We.p,kr=We.a.VectorTileFeature,qr=cn;function cn(Yt,Ue){this.options=Ue||{},this.features=Yt,this.length=Yt.length}function jr(Yt,Ue){this.id=typeof Yt.id=="number"?Yt.id:void 0,this.type=Yt.type,this.rawGeometry=Yt.type===1?[Yt.geometry]:Yt.geometry,this.properties=Yt.tags,this.extent=Ue||4096}cn.prototype.feature=function(Yt){return new jr(this.features[Yt],this.options.extent)},jr.prototype.loadGeometry=function(){var Yt=this.rawGeometry;this.geometry=[];for(var Ue=0;Ue<Yt.length;Ue++){for(var $e=Yt[Ue],Pe=[],Ft=0;Ft<$e.length;Ft++)Pe.push(new Vr($e[Ft][0],$e[Ft][1]));this.geometry.push(Pe)}return this.geometry},jr.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Yt=this.geometry,Ue=1/0,$e=-1/0,Pe=1/0,Ft=-1/0,Zt=0;Zt<Yt.length;Zt++)for(var ni=Yt[Zt],ri=0;ri<ni.length;ri++){var Qt=ni[ri];Ue=Math.min(Ue,Qt.x),$e=Math.max($e,Qt.x),Pe=Math.min(Pe,Qt.y),Ft=Math.max(Ft,Qt.y)}return[Ue,Pe,$e,Ft]},jr.prototype.toGeoJSON=kr.prototype.toGeoJSON;var Jn=We.b,rn=qr;function pn(Yt){var Ue=new Jn;return function($e,Pe){for(var Ft in $e.layers)Pe.writeMessage(3,At,$e.layers[Ft])}(Yt,Ue),Ue.finish()}function At(Yt,Ue){var $e;Ue.writeVarintField(15,Yt.version||1),Ue.writeStringField(1,Yt.name||""),Ue.writeVarintField(5,Yt.extent||4096);var Pe={keys:[],values:[],keycache:{},valuecache:{}};for($e=0;$e<Yt.length;$e++)Pe.feature=Yt.feature($e),Ue.writeMessage(2,tr,Pe);var Ft=Pe.keys;for($e=0;$e<Ft.length;$e++)Ue.writeStringField(3,Ft[$e]);var Zt=Pe.values;for($e=0;$e<Zt.length;$e++)Ue.writeMessage(4,as,Zt[$e])}function tr(Yt,Ue){var $e=Yt.feature;$e.id!==void 0&&Ue.writeVarintField(1,$e.id),Ue.writeMessage(2,Sn,Yt),Ue.writeVarintField(3,$e.type),Ue.writeMessage(4,Ir,$e)}function Sn(Yt,Ue){var $e=Yt.feature,Pe=Yt.keys,Ft=Yt.values,Zt=Yt.keycache,ni=Yt.valuecache;for(var ri in $e.properties){var Qt=$e.properties[ri],Oi=Zt[ri];if(Qt!==null){Oi===void 0&&(Pe.push(ri),Zt[ri]=Oi=Pe.length-1),Ue.writeVarint(Oi);var Qi=typeof Qt;Qi!=="string"&&Qi!=="boolean"&&Qi!=="number"&&(Qt=JSON.stringify(Qt));var Ki=Qi+":"+Qt,Kr=ni[Ki];Kr===void 0&&(Ft.push(Qt),ni[Ki]=Kr=Ft.length-1),Ue.writeVarint(Kr)}}}function Nn(Yt,Ue){return(Ue<<3)+(7&Yt)}function Li(Yt){return Yt<<1^Yt>>31}function Ir(Yt,Ue){for(var $e=Yt.loadGeometry(),Pe=Yt.type,Ft=0,Zt=0,ni=$e.length,ri=0;ri<ni;ri++){var Qt=$e[ri],Oi=1;Pe===1&&(Oi=Qt.length),Ue.writeVarint(Nn(1,Oi));for(var Qi=Pe===3?Qt.length-1:Qt.length,Ki=0;Ki<Qi;Ki++){Ki===1&&Pe!==1&&Ue.writeVarint(Nn(2,Qi-1));var Kr=Qt[Ki].x-Ft,_n=Qt[Ki].y-Zt;Ue.writeVarint(Li(Kr)),Ue.writeVarint(Li(_n)),Ft+=Kr,Zt+=_n}Pe===3&&Ue.writeVarint(Nn(7,1))}}function as(Yt,Ue){var $e=typeof Yt;$e==="string"?Ue.writeStringField(1,Yt):$e==="boolean"?Ue.writeBooleanField(7,Yt):$e==="number"&&(Yt%1!=0?Ue.writeDoubleField(3,Yt):Yt<0?Ue.writeSVarintField(6,Yt):Ue.writeVarintField(5,Yt))}Ei.exports=pn,Ei.exports.fromVectorTileJs=pn,Ei.exports.fromGeojsonVt=function(Yt,Ue){Ue=Ue||{};var $e={};for(var Pe in Yt)$e[Pe]=new rn(Yt[Pe].features,Ue),$e[Pe].name=Pe,$e[Pe].version=Ue.version,$e[Pe].extent=Ue.extent;return pn({layers:$e})},Ei.exports.GeoJSONWrapper=rn;var es=We.g(Ei.exports);const wo={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Yt=>Yt},Io=Math.fround||(Zo=new Float32Array(1),Yt=>(Zo[0]=+Yt,Zo[0]));var Zo;const gs=3,hi=5,Yr=6;class Hn{constructor(Ue){this.options=Object.assign(Object.create(wo),Ue),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Ue){const{log:$e,minZoom:Pe,maxZoom:Ft}=this.options;$e&&console.time("total time");const Zt=`prepare ${Ue.length} points`;$e&&console.time(Zt),this.points=Ue;const ni=[];for(let Qt=0;Qt<Ue.length;Qt++){const Oi=Ue[Qt];if(!Oi.geometry)continue;const[Qi,Ki]=Oi.geometry.coordinates,Kr=Io(zt(Qi)),_n=Io(dr(Ki));ni.push(Kr,_n,1/0,Qt,-1,1),this.options.reduce&&ni.push(0)}let ri=this.trees[Ft+1]=this._createTree(ni);$e&&console.timeEnd(Zt);for(let Qt=Ft;Qt>=Pe;Qt--){const Oi=+Date.now();ri=this.trees[Qt]=this._createTree(this._cluster(ri,Qt)),$e&&console.log("z%d: %d clusters in %dms",Qt,ri.numItems,+Date.now()-Oi)}return $e&&console.timeEnd("total time"),this}getClusters(Ue,$e){let Pe=((Ue[0]+180)%360+360)%360-180;const Ft=Math.max(-90,Math.min(90,Ue[1]));let Zt=Ue[2]===180?180:((Ue[2]+180)%360+360)%360-180;const ni=Math.max(-90,Math.min(90,Ue[3]));if(Ue[2]-Ue[0]>=360)Pe=-180,Zt=180;else if(Pe>Zt){const Ki=this.getClusters([Pe,Ft,180,ni],$e),Kr=this.getClusters([-180,Ft,Zt,ni],$e);return Ki.concat(Kr)}const ri=this.trees[this._limitZoom($e)],Qt=ri.range(zt(Pe),dr(ni),zt(Zt),dr(Ft)),Oi=ri.data,Qi=[];for(const Ki of Qt){const Kr=this.stride*Ki;Qi.push(Oi[Kr+hi]>1?Co(Oi,Kr,this.clusterProps):this.points[Oi[Kr+gs]])}return Qi}getChildren(Ue){const $e=this._getOriginId(Ue),Pe=this._getOriginZoom(Ue),Ft="No cluster with the specified id.",Zt=this.trees[Pe];if(!Zt)throw new Error(Ft);const ni=Zt.data;if($e*this.stride>=ni.length)throw new Error(Ft);const ri=this.options.radius/(this.options.extent*Math.pow(2,Pe-1)),Qt=Zt.within(ni[$e*this.stride],ni[$e*this.stride+1],ri),Oi=[];for(const Qi of Qt){const Ki=Qi*this.stride;ni[Ki+4]===Ue&&Oi.push(ni[Ki+hi]>1?Co(ni,Ki,this.clusterProps):this.points[ni[Ki+gs]])}if(Oi.length===0)throw new Error(Ft);return Oi}getLeaves(Ue,$e,Pe){const Ft=[];return this._appendLeaves(Ft,Ue,$e=$e||10,Pe=Pe||0,0),Ft}getTile(Ue,$e,Pe){const Ft=this.trees[this._limitZoom(Ue)],Zt=Math.pow(2,Ue),{extent:ni,radius:ri}=this.options,Qt=ri/ni,Oi=(Pe-Qt)/Zt,Qi=(Pe+1+Qt)/Zt,Ki={features:[]};return this._addTileFeatures(Ft.range(($e-Qt)/Zt,Oi,($e+1+Qt)/Zt,Qi),Ft.data,$e,Pe,Zt,Ki),$e===0&&this._addTileFeatures(Ft.range(1-Qt/Zt,Oi,1,Qi),Ft.data,Zt,Pe,Zt,Ki),$e===Zt-1&&this._addTileFeatures(Ft.range(0,Oi,Qt/Zt,Qi),Ft.data,-1,Pe,Zt,Ki),Ki.features.length?Ki:null}getClusterExpansionZoom(Ue){let $e=this._getOriginZoom(Ue)-1;for(;$e<=this.options.maxZoom;){const Pe=this.getChildren(Ue);if($e++,Pe.length!==1)break;Ue=Pe[0].properties.cluster_id}return $e}_appendLeaves(Ue,$e,Pe,Ft,Zt){const ni=this.getChildren($e);for(const ri of ni){const Qt=ri.properties;if(Qt&&Qt.cluster?Zt+Qt.point_count<=Ft?Zt+=Qt.point_count:Zt=this._appendLeaves(Ue,Qt.cluster_id,Pe,Ft,Zt):Zt<Ft?Zt++:Ue.push(ri),Ue.length===Pe)break}return Zt}_createTree(Ue){const $e=new We.K(Ue.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Pe=0;Pe<Ue.length;Pe+=this.stride)$e.add(Ue[Pe],Ue[Pe+1]);return $e.finish(),$e.data=Ue,$e}_addTileFeatures(Ue,$e,Pe,Ft,Zt,ni){for(const ri of Ue){const Qt=ri*this.stride,Oi=$e[Qt+hi]>1;let Qi,Ki,Kr;if(Oi)Qi=to($e,Qt,this.clusterProps),Ki=$e[Qt],Kr=$e[Qt+1];else{const oi=this.points[$e[Qt+gs]];Qi=oi.properties;const[gn,vr]=oi.geometry.coordinates;Ki=zt(gn),Kr=dr(vr)}const _n={type:1,geometry:[[Math.round(this.options.extent*(Ki*Zt-Pe)),Math.round(this.options.extent*(Kr*Zt-Ft))]],tags:Qi};let ts;ts=Oi||this.options.generateId?$e[Qt+gs]:this.points[$e[Qt+gs]].id,ts!==void 0&&(_n.id=ts),ni.features.push(_n)}}_limitZoom(Ue){return Math.max(this.options.minZoom,Math.min(Math.floor(+Ue),this.options.maxZoom+1))}_cluster(Ue,$e){const{radius:Pe,extent:Ft,reduce:Zt,minPoints:ni}=this.options,ri=Pe/(Ft*Math.pow(2,$e)),Qt=Ue.data,Oi=[],Qi=this.stride;for(let Ki=0;Ki<Qt.length;Ki+=Qi){if(Qt[Ki+2]<=$e)continue;Qt[Ki+2]=$e;const Kr=Qt[Ki],_n=Qt[Ki+1],ts=Ue.within(Qt[Ki],Qt[Ki+1],ri),oi=Qt[Ki+hi];let gn=oi;for(const vr of ts){const ys=vr*Qi;Qt[ys+2]>$e&&(gn+=Qt[ys+hi])}if(gn>oi&&gn>=ni){let vr,ys=Kr*oi,ls=_n*oi,gi=-1;const br=((Ki/Qi|0)<<5)+($e+1)+this.points.length;for(const wr of ts){const Cn=wr*Qi;if(Qt[Cn+2]<=$e)continue;Qt[Cn+2]=$e;const io=Qt[Cn+hi];ys+=Qt[Cn]*io,ls+=Qt[Cn+1]*io,Qt[Cn+4]=br,Zt&&(vr||(vr=this._map(Qt,Ki,!0),gi=this.clusterProps.length,this.clusterProps.push(vr)),Zt(vr,this._map(Qt,Cn)))}Qt[Ki+4]=br,Oi.push(ys/gn,ls/gn,1/0,br,-1,gn),Zt&&Oi.push(gi)}else{for(let vr=0;vr<Qi;vr++)Oi.push(Qt[Ki+vr]);if(gn>1)for(const vr of ts){const ys=vr*Qi;if(!(Qt[ys+2]<=$e)){Qt[ys+2]=$e;for(let ls=0;ls<Qi;ls++)Oi.push(Qt[ys+ls])}}}}return Oi}_getOriginId(Ue){return Ue-this.points.length>>5}_getOriginZoom(Ue){return(Ue-this.points.length)%32}_map(Ue,$e,Pe){if(Ue[$e+hi]>1){const ni=this.clusterProps[Ue[$e+Yr]];return Pe?Object.assign({},ni):ni}const Ft=this.points[Ue[$e+gs]].properties,Zt=this.options.map(Ft);return Pe&&Zt===Ft?Object.assign({},Zt):Zt}}function Co(Yt,Ue,$e){return{type:"Feature",id:Yt[Ue+gs],properties:to(Yt,Ue,$e),geometry:{type:"Point",coordinates:[(Pe=Yt[Ue],360*(Pe-.5)),In(Yt[Ue+1])]}};var Pe}function to(Yt,Ue,$e){const Pe=Yt[Ue+hi],Ft=Pe>=1e4?`${Math.round(Pe/1e3)}k`:Pe>=1e3?Math.round(Pe/100)/10+"k":Pe,Zt=Yt[Ue+Yr],ni=Zt===-1?{}:Object.assign({},$e[Zt]);return Object.assign(ni,{cluster:!0,cluster_id:Yt[Ue+gs],point_count:Pe,point_count_abbreviated:Ft})}function zt(Yt){return Yt/360+.5}function dr(Yt){const Ue=Math.sin(Yt*Math.PI/180),$e=.5-.25*Math.log((1+Ue)/(1-Ue))/Math.PI;return $e<0?0:$e>1?1:$e}function In(Yt){const Ue=(180-360*Yt)*Math.PI/180;return 360*Math.atan(Math.exp(Ue))/Math.PI-90}var Es={exports:{}};Es.exports=function(){function Yt(we,Ae,pe,Te){for(var Be,Ve=Te,Ke=pe-Ae>>1,Qe=pe-Ae,Ge=we[Ae],He=we[Ae+1],Et=we[pe],xe=we[pe+1],Me=Ae+3;Me<pe;Me+=3){var ct=Ue(we[Me],we[Me+1],Ge,He,Et,xe);if(ct>Ve)Be=Me,Ve=ct;else if(ct===Ve){var Pt=Math.abs(Me-Ke);Pt<Qe&&(Be=Me,Qe=Pt)}}Ve>Te&&(Be-Ae>3&&Yt(we,Ae,Be,Te),we[Be+2]=Ve,pe-Be>3&&Yt(we,Be,pe,Te))}function Ue(we,Ae,pe,Te,Be,Ve){var Ke=Be-pe,Qe=Ve-Te;if(Ke!==0||Qe!==0){var Ge=((we-pe)*Ke+(Ae-Te)*Qe)/(Ke*Ke+Qe*Qe);Ge>1?(pe=Be,Te=Ve):Ge>0&&(pe+=Ke*Ge,Te+=Qe*Ge)}return(Ke=we-pe)*Ke+(Qe=Ae-Te)*Qe}function $e(we,Ae,pe,Te){var Be={id:we===void 0?null:we,type:Ae,geometry:pe,tags:Te,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ve){var Ke=Ve.geometry,Qe=Ve.type;if(Qe==="Point"||Qe==="MultiPoint"||Qe==="LineString")Pe(Ve,Ke);else if(Qe==="Polygon"||Qe==="MultiLineString")for(var Ge=0;Ge<Ke.length;Ge++)Pe(Ve,Ke[Ge]);else if(Qe==="MultiPolygon")for(Ge=0;Ge<Ke.length;Ge++)for(var He=0;He<Ke[Ge].length;He++)Pe(Ve,Ke[Ge][He])}(Be),Be}function Pe(we,Ae){for(var pe=0;pe<Ae.length;pe+=3)we.minX=Math.min(we.minX,Ae[pe]),we.minY=Math.min(we.minY,Ae[pe+1]),we.maxX=Math.max(we.maxX,Ae[pe]),we.maxY=Math.max(we.maxY,Ae[pe+1])}function Ft(we,Ae,pe,Te){if(Ae.geometry){var Be=Ae.geometry.coordinates,Ve=Ae.geometry.type,Ke=Math.pow(pe.tolerance/((1<<pe.maxZoom)*pe.extent),2),Qe=[],Ge=Ae.id;if(pe.promoteId?Ge=Ae.properties[pe.promoteId]:pe.generateId&&(Ge=Te||0),Ve==="Point")Zt(Be,Qe);else if(Ve==="MultiPoint")for(var He=0;He<Be.length;He++)Zt(Be[He],Qe);else if(Ve==="LineString")ni(Be,Qe,Ke,!1);else if(Ve==="MultiLineString"){if(pe.lineMetrics){for(He=0;He<Be.length;He++)ni(Be[He],Qe=[],Ke,!1),we.push($e(Ge,"LineString",Qe,Ae.properties));return}ri(Be,Qe,Ke,!1)}else if(Ve==="Polygon")ri(Be,Qe,Ke,!0);else{if(Ve!=="MultiPolygon"){if(Ve==="GeometryCollection"){for(He=0;He<Ae.geometry.geometries.length;He++)Ft(we,{id:Ge,geometry:Ae.geometry.geometries[He],properties:Ae.properties},pe,Te);return}throw new Error("Input data is not a valid GeoJSON object.")}for(He=0;He<Be.length;He++){var Et=[];ri(Be[He],Et,Ke,!0),Qe.push(Et)}}we.push($e(Ge,Ve,Qe,Ae.properties))}}function Zt(we,Ae){Ae.push(Qt(we[0])),Ae.push(Oi(we[1])),Ae.push(0)}function ni(we,Ae,pe,Te){for(var Be,Ve,Ke=0,Qe=0;Qe<we.length;Qe++){var Ge=Qt(we[Qe][0]),He=Oi(we[Qe][1]);Ae.push(Ge),Ae.push(He),Ae.push(0),Qe>0&&(Ke+=Te?(Be*He-Ge*Ve)/2:Math.sqrt(Math.pow(Ge-Be,2)+Math.pow(He-Ve,2))),Be=Ge,Ve=He}var Et=Ae.length-3;Ae[2]=1,Yt(Ae,0,Et,pe),Ae[Et+2]=1,Ae.size=Math.abs(Ke),Ae.start=0,Ae.end=Ae.size}function ri(we,Ae,pe,Te){for(var Be=0;Be<we.length;Be++){var Ve=[];ni(we[Be],Ve,pe,Te),Ae.push(Ve)}}function Qt(we){return we/360+.5}function Oi(we){var Ae=Math.sin(we*Math.PI/180),pe=.5-.25*Math.log((1+Ae)/(1-Ae))/Math.PI;return pe<0?0:pe>1?1:pe}function Qi(we,Ae,pe,Te,Be,Ve,Ke,Qe){if(Te/=Ae,Ve>=(pe/=Ae)&&Ke<Te)return we;if(Ke<pe||Ve>=Te)return null;for(var Ge=[],He=0;He<we.length;He++){var Et=we[He],xe=Et.geometry,Me=Et.type,ct=Be===0?Et.minX:Et.minY,Pt=Be===0?Et.maxX:Et.maxY;if(ct>=pe&&Pt<Te)Ge.push(Et);else if(!(Pt<pe||ct>=Te)){var o=[];if(Me==="Point"||Me==="MultiPoint")Ki(xe,o,pe,Te,Be);else if(Me==="LineString")Kr(xe,o,pe,Te,Be,!1,Qe.lineMetrics);else if(Me==="MultiLineString")ts(xe,o,pe,Te,Be,!1);else if(Me==="Polygon")ts(xe,o,pe,Te,Be,!0);else if(Me==="MultiPolygon")for(var oe=0;oe<xe.length;oe++){var ti=[];ts(xe[oe],ti,pe,Te,Be,!0),ti.length&&o.push(ti)}if(o.length){if(Qe.lineMetrics&&Me==="LineString"){for(oe=0;oe<o.length;oe++)Ge.push($e(Et.id,Me,o[oe],Et.tags));continue}Me!=="LineString"&&Me!=="MultiLineString"||(o.length===1?(Me="LineString",o=o[0]):Me="MultiLineString"),Me!=="Point"&&Me!=="MultiPoint"||(Me=o.length===3?"Point":"MultiPoint"),Ge.push($e(Et.id,Me,o,Et.tags))}}}return Ge.length?Ge:null}function Ki(we,Ae,pe,Te,Be){for(var Ve=0;Ve<we.length;Ve+=3){var Ke=we[Ve+Be];Ke>=pe&&Ke<=Te&&(Ae.push(we[Ve]),Ae.push(we[Ve+1]),Ae.push(we[Ve+2]))}}function Kr(we,Ae,pe,Te,Be,Ve,Ke){for(var Qe,Ge,He=_n(we),Et=Be===0?gn:vr,xe=we.start,Me=0;Me<we.length-3;Me+=3){var ct=we[Me],Pt=we[Me+1],o=we[Me+2],oe=we[Me+3],ti=we[Me+4],xi=Be===0?ct:Pt,yi=Be===0?oe:ti,ai=!1;Ke&&(Qe=Math.sqrt(Math.pow(ct-oe,2)+Math.pow(Pt-ti,2))),xi<pe?yi>pe&&(Ge=Et(He,ct,Pt,oe,ti,pe),Ke&&(He.start=xe+Qe*Ge)):xi>Te?yi<Te&&(Ge=Et(He,ct,Pt,oe,ti,Te),Ke&&(He.start=xe+Qe*Ge)):oi(He,ct,Pt,o),yi<pe&&xi>=pe&&(Ge=Et(He,ct,Pt,oe,ti,pe),ai=!0),yi>Te&&xi<=Te&&(Ge=Et(He,ct,Pt,oe,ti,Te),ai=!0),!Ve&&ai&&(Ke&&(He.end=xe+Qe*Ge),Ae.push(He),He=_n(we)),Ke&&(xe+=Qe)}var pi=we.length-3;ct=we[pi],Pt=we[pi+1],o=we[pi+2],(xi=Be===0?ct:Pt)>=pe&&xi<=Te&&oi(He,ct,Pt,o),pi=He.length-3,Ve&&pi>=3&&(He[pi]!==He[0]||He[pi+1]!==He[1])&&oi(He,He[0],He[1],He[2]),He.length&&Ae.push(He)}function _n(we){var Ae=[];return Ae.size=we.size,Ae.start=we.start,Ae.end=we.end,Ae}function ts(we,Ae,pe,Te,Be,Ve){for(var Ke=0;Ke<we.length;Ke++)Kr(we[Ke],Ae,pe,Te,Be,Ve,!1)}function oi(we,Ae,pe,Te){we.push(Ae),we.push(pe),we.push(Te)}function gn(we,Ae,pe,Te,Be,Ve){var Ke=(Ve-Ae)/(Te-Ae);return we.push(Ve),we.push(pe+(Be-pe)*Ke),we.push(1),Ke}function vr(we,Ae,pe,Te,Be,Ve){var Ke=(Ve-pe)/(Be-pe);return we.push(Ae+(Te-Ae)*Ke),we.push(Ve),we.push(1),Ke}function ys(we,Ae){for(var pe=[],Te=0;Te<we.length;Te++){var Be,Ve=we[Te],Ke=Ve.type;if(Ke==="Point"||Ke==="MultiPoint"||Ke==="LineString")Be=ls(Ve.geometry,Ae);else if(Ke==="MultiLineString"||Ke==="Polygon"){Be=[];for(var Qe=0;Qe<Ve.geometry.length;Qe++)Be.push(ls(Ve.geometry[Qe],Ae))}else if(Ke==="MultiPolygon")for(Be=[],Qe=0;Qe<Ve.geometry.length;Qe++){for(var Ge=[],He=0;He<Ve.geometry[Qe].length;He++)Ge.push(ls(Ve.geometry[Qe][He],Ae));Be.push(Ge)}pe.push($e(Ve.id,Ke,Be,Ve.tags))}return pe}function ls(we,Ae){var pe=[];pe.size=we.size,we.start!==void 0&&(pe.start=we.start,pe.end=we.end);for(var Te=0;Te<we.length;Te+=3)pe.push(we[Te]+Ae,we[Te+1],we[Te+2]);return pe}function gi(we,Ae){if(we.transformed)return we;var pe,Te,Be,Ve=1<<we.z,Ke=we.x,Qe=we.y;for(pe=0;pe<we.features.length;pe++){var Ge=we.features[pe],He=Ge.geometry,Et=Ge.type;if(Ge.geometry=[],Et===1)for(Te=0;Te<He.length;Te+=2)Ge.geometry.push(br(He[Te],He[Te+1],Ae,Ve,Ke,Qe));else for(Te=0;Te<He.length;Te++){var xe=[];for(Be=0;Be<He[Te].length;Be+=2)xe.push(br(He[Te][Be],He[Te][Be+1],Ae,Ve,Ke,Qe));Ge.geometry.push(xe)}}return we.transformed=!0,we}function br(we,Ae,pe,Te,Be,Ve){return[Math.round(pe*(we*Te-Be)),Math.round(pe*(Ae*Te-Ve))]}function wr(we,Ae,pe,Te,Be){for(var Ve=Ae===Be.maxZoom?0:Be.tolerance/((1<<Ae)*Be.extent),Ke={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:pe,y:Te,z:Ae,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Qe=0;Qe<we.length;Qe++){Ke.numFeatures++,Cn(Ke,we[Qe],Ve,Be);var Ge=we[Qe].minX,He=we[Qe].minY,Et=we[Qe].maxX,xe=we[Qe].maxY;Ge<Ke.minX&&(Ke.minX=Ge),He<Ke.minY&&(Ke.minY=He),Et>Ke.maxX&&(Ke.maxX=Et),xe>Ke.maxY&&(Ke.maxY=xe)}return Ke}function Cn(we,Ae,pe,Te){var Be=Ae.geometry,Ve=Ae.type,Ke=[];if(Ve==="Point"||Ve==="MultiPoint")for(var Qe=0;Qe<Be.length;Qe+=3)Ke.push(Be[Qe]),Ke.push(Be[Qe+1]),we.numPoints++,we.numSimplified++;else if(Ve==="LineString")io(Ke,Be,we,pe,!1,!1);else if(Ve==="MultiLineString"||Ve==="Polygon")for(Qe=0;Qe<Be.length;Qe++)io(Ke,Be[Qe],we,pe,Ve==="Polygon",Qe===0);else if(Ve==="MultiPolygon")for(var Ge=0;Ge<Be.length;Ge++){var He=Be[Ge];for(Qe=0;Qe<He.length;Qe++)io(Ke,He[Qe],we,pe,!0,Qe===0)}if(Ke.length){var Et=Ae.tags||null;if(Ve==="LineString"&&Te.lineMetrics){for(var xe in Et={},Ae.tags)Et[xe]=Ae.tags[xe];Et.mapbox_clip_start=Be.start/Be.size,Et.mapbox_clip_end=Be.end/Be.size}var Me={geometry:Ke,type:Ve==="Polygon"||Ve==="MultiPolygon"?3:Ve==="LineString"||Ve==="MultiLineString"?2:1,tags:Et};Ae.id!==null&&(Me.id=Ae.id),we.features.push(Me)}}function io(we,Ae,pe,Te,Be,Ve){var Ke=Te*Te;if(Te>0&&Ae.size<(Be?Ke:Te))pe.numPoints+=Ae.length/3;else{for(var Qe=[],Ge=0;Ge<Ae.length;Ge+=3)(Te===0||Ae[Ge+2]>Ke)&&(pe.numSimplified++,Qe.push(Ae[Ge]),Qe.push(Ae[Ge+1])),pe.numPoints++;Be&&function(He,Et){for(var xe=0,Me=0,ct=He.length,Pt=ct-2;Me<ct;Pt=Me,Me+=2)xe+=(He[Me]-He[Pt])*(He[Me+1]+He[Pt+1]);if(xe>0===Et)for(Me=0,ct=He.length;Me<ct/2;Me+=2){var o=He[Me],oe=He[Me+1];He[Me]=He[ct-2-Me],He[Me+1]=He[ct-1-Me],He[ct-2-Me]=o,He[ct-1-Me]=oe}}(Qe,Ve),we.push(Qe)}}function Sr(we,Ae){var pe=(Ae=this.options=function(Be,Ve){for(var Ke in Ve)Be[Ke]=Ve[Ke];return Be}(Object.create(this.options),Ae)).debug;if(pe&&console.time("preprocess data"),Ae.maxZoom<0||Ae.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Ae.promoteId&&Ae.generateId)throw new Error("promoteId and generateId cannot be used together.");var Te=function(Be,Ve){var Ke=[];if(Be.type==="FeatureCollection")for(var Qe=0;Qe<Be.features.length;Qe++)Ft(Ke,Be.features[Qe],Ve,Qe);else Ft(Ke,Be.type==="Feature"?Be:{geometry:Be},Ve);return Ke}(we,Ae);this.tiles={},this.tileCoords=[],pe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Ae.indexMaxZoom,Ae.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(Te=function(Be,Ve){var Ke=Ve.buffer/Ve.extent,Qe=Be,Ge=Qi(Be,1,-1-Ke,Ke,0,-1,2,Ve),He=Qi(Be,1,1-Ke,2+Ke,0,-1,2,Ve);return(Ge||He)&&(Qe=Qi(Be,1,-Ke,1+Ke,0,-1,2,Ve)||[],Ge&&(Qe=ys(Ge,1).concat(Qe)),He&&(Qe=Qe.concat(ys(He,-1)))),Qe}(Te,Ae)).length&&this.splitTile(Te,0,0,0),pe&&(Te.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function kt(we,Ae,pe){return 32*((1<<we)*pe+Ae)+we}return Sr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Sr.prototype.splitTile=function(we,Ae,pe,Te,Be,Ve,Ke){for(var Qe=[we,Ae,pe,Te],Ge=this.options,He=Ge.debug;Qe.length;){Te=Qe.pop(),pe=Qe.pop(),Ae=Qe.pop(),we=Qe.pop();var Et=1<<Ae,xe=kt(Ae,pe,Te),Me=this.tiles[xe];if(!Me&&(He>1&&console.time("creation"),Me=this.tiles[xe]=wr(we,Ae,pe,Te,Ge),this.tileCoords.push({z:Ae,x:pe,y:Te}),He)){He>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Ae,pe,Te,Me.numFeatures,Me.numPoints,Me.numSimplified),console.timeEnd("creation"));var ct="z"+Ae;this.stats[ct]=(this.stats[ct]||0)+1,this.total++}if(Me.source=we,Be){if(Ae===Ge.maxZoom||Ae===Be)continue;var Pt=1<<Be-Ae;if(pe!==Math.floor(Ve/Pt)||Te!==Math.floor(Ke/Pt))continue}else if(Ae===Ge.indexMaxZoom||Me.numPoints<=Ge.indexMaxPoints)continue;if(Me.source=null,we.length!==0){He>1&&console.time("clipping");var o,oe,ti,xi,yi,ai,pi=.5*Ge.buffer/Ge.extent,gr=.5-pi,bi=.5+pi,zi=1+pi;o=oe=ti=xi=null,yi=Qi(we,Et,pe-pi,pe+bi,0,Me.minX,Me.maxX,Ge),ai=Qi(we,Et,pe+gr,pe+zi,0,Me.minX,Me.maxX,Ge),we=null,yi&&(o=Qi(yi,Et,Te-pi,Te+bi,1,Me.minY,Me.maxY,Ge),oe=Qi(yi,Et,Te+gr,Te+zi,1,Me.minY,Me.maxY,Ge),yi=null),ai&&(ti=Qi(ai,Et,Te-pi,Te+bi,1,Me.minY,Me.maxY,Ge),xi=Qi(ai,Et,Te+gr,Te+zi,1,Me.minY,Me.maxY,Ge),ai=null),He>1&&console.timeEnd("clipping"),Qe.push(o||[],Ae+1,2*pe,2*Te),Qe.push(oe||[],Ae+1,2*pe,2*Te+1),Qe.push(ti||[],Ae+1,2*pe+1,2*Te),Qe.push(xi||[],Ae+1,2*pe+1,2*Te+1)}}},Sr.prototype.getTile=function(we,Ae,pe){var Te=this.options,Be=Te.extent,Ve=Te.debug;if(we<0||we>24)return null;var Ke=1<<we,Qe=kt(we,Ae=(Ae%Ke+Ke)%Ke,pe);if(this.tiles[Qe])return gi(this.tiles[Qe],Be);Ve>1&&console.log("drilling down to z%d-%d-%d",we,Ae,pe);for(var Ge,He=we,Et=Ae,xe=pe;!Ge&&He>0;)He--,Et=Math.floor(Et/2),xe=Math.floor(xe/2),Ge=this.tiles[kt(He,Et,xe)];return Ge&&Ge.source?(Ve>1&&console.log("found parent tile z%d-%d-%d",He,Et,xe),Ve>1&&console.time("drilling down"),this.splitTile(Ge.source,He,Et,xe,we,Ae,pe),Ve>1&&console.timeEnd("drilling down"),this.tiles[Qe]?gi(this.tiles[Qe],Be):null):null},function(we,Ae){return new Sr(we,Ae)}}();var Il=We.g(Es.exports);function La(Yt,Ue){const $e=Yt.tileID.canonical;if(!this._geoJSONIndex)return Ue(null,null);const Pe=this._geoJSONIndex.getTile($e.z,$e.x,$e.y);if(!Pe)return Ue(null,null);const Ft=new class{constructor(ni){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=We.E,this.length=ni.length,this._features=ni}feature(ni){return new class{constructor(ri){this._feature=ri,this.extent=We.E,this.type=ri.type,this.properties=ri.tags,"id"in ri&&!isNaN(ri.id)&&(this.id=parseInt(ri.id,10))}loadGeometry(){if(this._feature.type===1){const ri=[];for(const Qt of this._feature.geometry)ri.push([new We.P(Qt[0],Qt[1])]);return ri}{const ri=[];for(const Qt of this._feature.geometry){const Oi=[];for(const Qi of Qt)Oi.push(new We.P(Qi[0],Qi[1]));ri.push(Oi)}return ri}}toGeoJSON(ri,Qt,Oi){return di.call(this,ri,Qt,Oi)}}(this._features[ni])}}(Pe.features);let Zt=es(Ft);Zt.byteOffset===0&&Zt.byteLength===Zt.buffer.byteLength||(Zt=new Uint8Array(Zt)),Ue(null,{vectorTile:Ft,rawData:Zt.buffer})}class Cl extends We.d{constructor(Ue,$e,Pe,Ft,Zt,ni){super(Ue,$e,Pe,Ft,La,ni),Zt&&(this.loadGeoJSON=Zt)}loadData(Ue,$e){const Pe=Ue&&Ue.request,Ft=Pe&&Pe.collectResourceTiming;this.loadGeoJSON(Ue,(Zt,ni)=>{if(Zt||!ni)return $e(Zt);if(typeof ni!="object")return $e(new Error(`Input data given to '${Ue.source}' is not a valid GeoJSON object.`));{ui(ni,!0);try{if(Ue.filter){const Qt=We.e(Ue.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Qt.result==="error")throw new Error(Qt.value.map(Qi=>`${Qi.key}: ${Qi.message}`).join(", "));ni={type:"FeatureCollection",features:ni.features.filter(Qi=>Qt.value.evaluate({zoom:0},Qi))}}this._geoJSONIndex=Ue.cluster?new Hn(function({superclusterOptions:Qt,clusterProperties:Oi}){if(!Oi||!Qt)return Qt;const Qi={},Ki={},Kr={accumulated:null,zoom:0},_n={properties:null},ts=Object.keys(Oi);for(const oi of ts){const[gn,vr]=Oi[oi],ys=We.e(vr),ls=We.e(typeof gn=="string"?[gn,["accumulated"],["get",oi]]:gn);Qi[oi]=ys.value,Ki[oi]=ls.value}return Qt.map=oi=>{_n.properties=oi;const gn={};for(const vr of ts)gn[vr]=Qi[vr].evaluate(Kr,_n);return gn},Qt.reduce=(oi,gn)=>{_n.properties=gn;for(const vr of ts)Kr.accumulated=oi[vr],oi[vr]=Ki[vr].evaluate(Kr,_n)},Qt}(Ue)).load(ni.features):Il(ni,Ue.geojsonVtOptions)}catch(Qt){return $e(Qt)}this.loaded={};const ri={};if(Ft){const Qt=We.f(Pe);Qt&&(ri.resourceTiming={},ri.resourceTiming[Ue.source]=JSON.parse(JSON.stringify(Qt)))}$e(null,ri)}})}reloadTile(Ue,$e){const Pe=this.loaded;return Pe&&Pe[Ue.uid]?super.reloadTile(Ue,$e):this.loadTile(Ue,$e)}loadGeoJSON(Ue,$e){if(Ue.request)We.h(Ue.request,$e);else{if(typeof Ue.data!="string")return $e(new Error(`Input data given to '${Ue.source}' is not a valid GeoJSON object.`));try{return $e(null,JSON.parse(Ue.data))}catch{return $e(new Error(`Input data given to '${Ue.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(Ue,$e){try{$e(null,this._geoJSONIndex.getClusterExpansionZoom(Ue.clusterId))}catch(Pe){$e(Pe)}}getClusterChildren(Ue,$e){try{$e(null,this._geoJSONIndex.getChildren(Ue.clusterId))}catch(Pe){$e(Pe)}}getClusterLeaves(Ue,$e){try{$e(null,this._geoJSONIndex.getLeaves(Ue.clusterId,Ue.limit,Ue.offset))}catch(Pe){$e(Pe)}}}class Un{constructor(Ue,$e){this.tileID=new We.O(Ue.tileID.overscaledZ,Ue.tileID.wrap,Ue.tileID.canonical.z,Ue.tileID.canonical.x,Ue.tileID.canonical.y),this.tileZoom=Ue.tileZoom,this.uid=Ue.uid,this.zoom=Ue.zoom,this.canonical=Ue.tileID.canonical,this.pixelRatio=Ue.pixelRatio,this.tileSize=Ue.tileSize,this.source=Ue.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=Ue.projection,this.brightness=$e}parse(Ue,$e,Pe,Ft){this.status="parsing";const Zt=new We.O(Pe.tileID.overscaledZ,Pe.tileID.wrap,Pe.tileID.canonical.z,Pe.tileID.canonical.x,Pe.tileID.canonical.y),ni={},ri=$e.familiesBySource[Pe.source],Qt=new We.F(Zt,Pe.promoteId);return Qt.bucketLayerIDs=[],We.l(Ue).then(Oi=>{if(!Oi)return Ft(new Error("Could not parse tile"));const Qi=We.j(Oi,1/We.t(Pe.tileID.canonical)),Ki=Oi.json.extensionsUsed&&Oi.json.extensionsUsed.includes("MAPBOX_mesh_features"),Kr=new We.k(this.zoom,{brightness:this.brightness});for(const _n in ri)for(const ts of ri[_n]){const oi=ts[0],gn=Oi.json.extensionsUsed;oi.recalculate(Kr,[]);const vr=new We.T(Qi,Zt,gn&&gn.includes("MAPBOX_mesh_features"),this.brightness);Ki||(vr.needsUpload=!0),ni[oi.fqid]=vr,vr.evaluate(oi)}this.status="done",Ft(null,{buckets:ni,featureIndex:Qt})}).catch(Oi=>Ft(new Error(Oi.message)))}}class Ra{constructor(Ue,$e,Pe,Ft,Zt,ni){this.actor=Ue,this.layerIndex=$e,this.brightness=ni,this.loading={},this.loaded={}}loadTile(Ue,$e){const Pe=Ue.uid,Ft=this.loading[Pe]=new Un(Ue,this.brightness);We.i(Ue.request,(Zt,ni)=>{const ri=!this.loading[Pe];return delete this.loading[Pe],ri||Zt?(Ft.status="done",ri||(this.loaded[Pe]=Ft),$e(Zt)):ni&&ni.byteLength!==0?void Ft.parse(ni,this.layerIndex,Ue,(Qt,Oi)=>{Ft.status="done",this.loaded=this.loaded||{},this.loaded[Pe]=Ft,Qt||!Oi?$e(Qt):$e(null,Oi)}):(Ft.status="done",this.loaded[Pe]=Ft,$e())})}reloadTile(Ue,$e){const Pe=this.loaded,Ft=Ue.uid;if(Pe&&Pe[Ft]){const Zt=Pe[Ft];Zt.projection=Ue.projection,Zt.brightness=Ue.brightness;const ni=(ri,Qt)=>{Zt.reloadCallback&&(delete Zt.reloadCallback,this.loadTile(Ue,$e)),$e(ri,Qt)};Zt.status==="parsing"?Zt.reloadCallback=ni:Zt.status==="done"&&this.loadTile(Ue,$e)}}abortTile(Ue,$e){const Pe=Ue.uid;this.loading[Pe]&&delete this.loading[Pe],$e()}removeTile(Ue,$e){const Pe=this.loaded,Ft=Ue.uid;Pe&&Pe[Ft]&&delete Pe[Ft],$e()}}class pa{constructor(Ue){this.self=Ue,this.actor=new We.A(Ue,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=We.m({name:"mercator"}),this.workerSourceTypes={vector:We.d,geojson:Cl,"batched-model":Ra},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=($e,Pe)=>{if(this.workerSourceTypes[$e])throw new Error(`Worker source with name "${$e}" already registered.`);this.workerSourceTypes[$e]=Pe},this.self.registerRTLTextPlugin=$e=>{if(We.n.isParsed())throw new Error("RTL text plugin already registered.");We.n.applyArabicShaping=$e.applyArabicShaping,We.n.processBidirectionalText=$e.processBidirectionalText,We.n.processStyledBidirectionalText=$e.processStyledBidirectionalText}}clearCaches(Ue,$e,Pe){delete this.layerIndexes[Ue],delete this.availableImages[Ue],delete this.workerSources[Ue],delete this.demWorkerSources[Ue],Pe()}checkIfReady(Ue,$e,Pe){Pe()}setReferrer(Ue,$e){this.referrer=$e}spriteLoaded(Ue,{scope:$e,isLoaded:Pe}){if(this.isSpriteLoaded[Ue]||(this.isSpriteLoaded[Ue]={}),this.isSpriteLoaded[Ue][$e]=Pe,this.workerSources[Ue]&&this.workerSources[Ue][$e])for(const Ft in this.workerSources[Ue][$e]){const Zt=this.workerSources[Ue][$e][Ft];for(const ni in Zt)Zt[ni]instanceof We.d&&(Zt[ni].isSpriteLoaded=Pe,Zt[ni].fire(new We.o("isSpriteLoaded")))}}setImages(Ue,{scope:$e,images:Pe},Ft){if(this.availableImages[Ue]||(this.availableImages[Ue]={}),this.availableImages[Ue][$e]=Pe,this.workerSources[Ue]&&this.workerSources[Ue][$e]){for(const Zt in this.workerSources[Ue][$e]){const ni=this.workerSources[Ue][$e][Zt];for(const ri in ni)ni[ri].availableImages=Pe}Ft()}else Ft()}setProjection(Ue,$e){this.projections[Ue]=We.m($e)}setBrightness(Ue,$e,Pe){this.brightness=$e,Pe()}setLayers(Ue,$e,Pe){this.getLayerIndex(Ue,$e.scope).replace($e.layers,$e.options),Pe()}updateLayers(Ue,$e,Pe){this.getLayerIndex(Ue,$e.scope).update($e.layers,$e.removedIds,$e.options),Pe()}loadTile(Ue,$e,Pe){$e.projection=this.projections[Ue]||this.defaultProjection,this.getWorkerSource(Ue,$e.type,$e.source,$e.scope).loadTile($e,Pe)}loadDEMTile(Ue,$e,Pe){this.getDEMWorkerSource(Ue,$e.source,$e.scope).loadTile($e,Pe)}reloadTile(Ue,$e,Pe){$e.projection=this.projections[Ue]||this.defaultProjection,this.getWorkerSource(Ue,$e.type,$e.source,$e.scope).reloadTile($e,Pe)}abortTile(Ue,$e,Pe){this.getWorkerSource(Ue,$e.type,$e.source,$e.scope).abortTile($e,Pe)}removeTile(Ue,$e,Pe){this.getWorkerSource(Ue,$e.type,$e.source,$e.scope).removeTile($e,Pe)}removeSource(Ue,$e,Pe){if(!(this.workerSources[Ue]&&this.workerSources[Ue][$e.scope]&&this.workerSources[Ue][$e.scope][$e.type]&&this.workerSources[Ue][$e.scope][$e.type][$e.source]))return;const Ft=this.workerSources[Ue][$e.scope][$e.type][$e.source];delete this.workerSources[Ue][$e.scope][$e.type][$e.source],Ft.removeSource!==void 0?Ft.removeSource($e,Pe):Pe()}loadWorkerSource(Ue,$e,Pe){try{this.self.importScripts($e.url),Pe()}catch(Ft){Pe(Ft.toString())}}syncRTLPluginState(Ue,$e,Pe){try{We.n.setState($e);const Ft=We.n.getPluginURL();if(We.n.isLoaded()&&!We.n.isParsed()&&Ft!=null){this.self.importScripts(Ft);const Zt=We.n.isParsed();Pe(Zt?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Ft}`),Zt)}}catch(Ft){Pe(Ft.toString())}}setDracoUrl(Ue,$e){this.dracoUrl=$e}getAvailableImages(Ue,$e){this.availableImages[Ue]||(this.availableImages[Ue]={});let Pe=this.availableImages[Ue][$e];return Pe||(Pe=[]),Pe}getLayerIndex(Ue,$e){this.layerIndexes[Ue]||(this.layerIndexes[Ue]={});let Pe=this.layerIndexes[Ue][$e];return Pe||(Pe=this.layerIndexes[Ue][$e]=new Rt,Pe.scope=$e),Pe}getWorkerSource(Ue,$e,Pe,Ft){if(this.workerSources[Ue]||(this.workerSources[Ue]={}),this.workerSources[Ue][Ft]||(this.workerSources[Ue][Ft]={}),this.workerSources[Ue][Ft][$e]||(this.workerSources[Ue][Ft][$e]={}),this.isSpriteLoaded[Ue]||(this.isSpriteLoaded[Ue]={}),!this.workerSources[Ue][Ft][$e][Pe]){const Zt={send:(ni,ri,Qt,Oi,Qi,Ki)=>{this.actor.send(ni,ri,Qt,Ue,Qi,Ki)},scheduler:this.actor.scheduler};this.workerSources[Ue][Ft][$e][Pe]=new this.workerSourceTypes[$e](Zt,this.getLayerIndex(Ue,Ft),this.getAvailableImages(Ue,Ft),this.isSpriteLoaded[Ue][Ft],void 0,this.brightness)}return this.workerSources[Ue][Ft][$e][Pe]}getDEMWorkerSource(Ue,$e,Pe){return this.demWorkerSources[Ue]||(this.demWorkerSources[Ue]={}),this.demWorkerSources[Ue][Pe]||(this.demWorkerSources[Ue][Pe]={}),this.demWorkerSources[Ue][Pe][$e]||(this.demWorkerSources[Ue][Pe][$e]=new yt),this.demWorkerSources[Ue][Pe][$e]}enforceCacheSizeLimit(Ue,$e){We.q($e)}getWorkerPerformanceMetrics(Ue,$e,Pe){Pe(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new pa(self)),pa}),Bt(["./shared"],function(We){return We.s});var P=dt;return P})})(a5);var I_=function(Le){Le=Le||{};var ne=typeof Le<"u"?Le:{},Fe={},ze;for(ze in ne)ne.hasOwnProperty(ze)&&(Fe[ze]=ne[ze]);var wt="";function dt(xe){return ne.locateFile?ne.locateFile(xe,wt):wt+xe}var Bt;document.currentScript&&(wt=document.currentScript.src),wt.indexOf("blob:")!==0?wt=wt.substr(0,wt.lastIndexOf("/")+1):wt="",Bt=function(Me,ct,Pt){var o=new XMLHttpRequest;o.open("GET",Me,!0),o.responseType="arraybuffer",o.onload=function(){if(o.status==200||o.status==0&&o.response){ct(o.response);return}var ti=Cn(Me);if(ti){ct(ti.buffer);return}Pt()},o.onerror=Pt,o.send(null)};var P=ne.print||console.log.bind(console),We=ne.printErr||console.warn.bind(console);for(ze in Fe)Fe.hasOwnProperty(ze)&&(ne[ze]=Fe[ze]);Fe=null,ne.arguments&&ne.arguments;var me=0,Xt=function(xe){me=xe},Rt=function(){return me},yt=8;function qt(xe,Me,ct,Pt){switch(ct=ct||"i8",ct.charAt(ct.length-1)==="*"&&(ct="i32"),ct){case"i1":Sn[xe>>0]=Me;break;case"i8":Sn[xe>>0]=Me;break;case"i16":Li[xe>>1]=Me;break;case"i32":Ir[xe>>2]=Me;break;case"i64":Qt=[Me>>>0,(ri=Me,+Cl(ri)>=1?ri>0?(pa(+Ra(ri/4294967296),4294967295)|0)>>>0:~~+Un((ri-+(~~ri>>>0))/4294967296)>>>0:0)],Ir[xe>>2]=Qt[0],Ir[xe+4>>2]=Qt[1];break;case"float":as[xe>>2]=Me;break;case"double":es[xe>>3]=Me;break;default:Et("invalid type for setValue: "+ct)}}function $t(xe,Me,ct){switch(Me=Me||"i8",Me.charAt(Me.length-1)==="*"&&(Me="i32"),Me){case"i1":return Sn[xe>>0];case"i8":return Sn[xe>>0];case"i16":return Li[xe>>1];case"i32":return Ir[xe>>2];case"i64":return Ir[xe>>2];case"float":return as[xe>>2];case"double":return es[xe>>3];default:Et("invalid type for getValue: "+Me)}return null}var ui=!1;function di(xe,Me){xe||Et("Assertion failed: "+Me)}function Ei(xe){var Me=ne["_"+xe];return di(Me,"Cannot call unknown function "+xe+", make sure it is exported"),Me}function Vr(xe,Me,ct,Pt,o){var oe={string:function(zi){var fn=0;if(zi!=null&&zi!==0){var Qs=(zi.length<<2)+1;fn=Ae(Qs),rn(zi,fn,Qs)}return fn},array:function(zi){var fn=Ae(zi.length);return pn(zi,fn),fn}};function ti(zi){return Me==="string"?jr(zi):Me==="boolean"?!!zi:zi}var xi=Ei(xe),yi=[],ai=0;if(Pt)for(var pi=0;pi<Pt.length;pi++){var gr=oe[ct[pi]];gr?(ai===0&&(ai=Te()),yi[pi]=gr(Pt[pi])):yi[pi]=Pt[pi]}var bi=xi.apply(null,yi);return bi=ti(bi),ai!==0&&pe(ai),bi}function kr(xe,Me,ct,Pt){ct=ct||[];var o=ct.every(function(ti){return ti==="number"}),oe=Me!=="string";return oe&&o&&!Pt?Ei(xe):function(){return Vr(xe,Me,ct,arguments)}}var qr=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function cn(xe,Me,ct){for(var Pt=Me+ct,o=Me;xe[o]&&!(o>=Pt);)++o;if(o-Me>16&&xe.subarray&&qr)return qr.decode(xe.subarray(Me,o));for(var oe="";Me<o;){var ti=xe[Me++];if(!(ti&128)){oe+=String.fromCharCode(ti);continue}var xi=xe[Me++]&63;if((ti&224)==192){oe+=String.fromCharCode((ti&31)<<6|xi);continue}var yi=xe[Me++]&63;if((ti&240)==224?ti=(ti&15)<<12|xi<<6|yi:ti=(ti&7)<<18|xi<<12|yi<<6|xe[Me++]&63,ti<65536)oe+=String.fromCharCode(ti);else{var ai=ti-65536;oe+=String.fromCharCode(55296|ai>>10,56320|ai&1023)}}return oe}function jr(xe,Me){return xe?cn(Nn,xe,Me):""}function Jn(xe,Me,ct,Pt){if(!(Pt>0))return 0;for(var o=ct,oe=ct+Pt-1,ti=0;ti<xe.length;++ti){var xi=xe.charCodeAt(ti);if(xi>=55296&&xi<=57343){var yi=xe.charCodeAt(++ti);xi=65536+((xi&1023)<<10)|yi&1023}if(xi<=127){if(ct>=oe)break;Me[ct++]=xi}else if(xi<=2047){if(ct+1>=oe)break;Me[ct++]=192|xi>>6,Me[ct++]=128|xi&63}else if(xi<=65535){if(ct+2>=oe)break;Me[ct++]=224|xi>>12,Me[ct++]=128|xi>>6&63,Me[ct++]=128|xi&63}else{if(ct+3>=oe)break;Me[ct++]=240|xi>>18,Me[ct++]=128|xi>>12&63,Me[ct++]=128|xi>>6&63,Me[ct++]=128|xi&63}}return Me[ct]=0,ct-o}function rn(xe,Me,ct){return Jn(xe,Nn,Me,ct)}typeof TextDecoder<"u"&&new TextDecoder("utf-16le");function pn(xe,Me){Sn.set(xe,Me)}function At(xe,Me){return xe%Me>0&&(xe+=Me-xe%Me),xe}var tr,Sn,Nn,Li,Ir,as,es;function wo(xe){tr=xe,ne.HEAP8=Sn=new Int8Array(xe),ne.HEAP16=Li=new Int16Array(xe),ne.HEAP32=Ir=new Int32Array(xe),ne.HEAPU8=Nn=new Uint8Array(xe),ne.HEAPU16=new Uint16Array(xe),ne.HEAPU32=new Uint32Array(xe),ne.HEAPF32=as=new Float32Array(xe),ne.HEAPF64=es=new Float64Array(xe)}var Io=5266928,Zo=24016,gs=ne.TOTAL_MEMORY||33554432;ne.buffer?tr=ne.buffer:tr=new ArrayBuffer(gs),gs=tr.byteLength,wo(tr),Ir[Zo>>2]=Io;function hi(xe){for(;xe.length>0;){var Me=xe.shift();if(typeof Me=="function"){Me();continue}var ct=Me.func;typeof ct=="number"?Me.arg===void 0?ne.dynCall_v(ct):ne.dynCall_vi(ct,Me.arg):ct(Me.arg===void 0?null:Me.arg)}}var Yr=[],Hn=[],Co=[],to=[];function zt(){if(ne.preRun)for(typeof ne.preRun=="function"&&(ne.preRun=[ne.preRun]);ne.preRun.length;)Il(ne.preRun.shift());hi(Yr)}function dr(){hi(Hn)}function In(){hi(Co)}function Es(){if(ne.postRun)for(typeof ne.postRun=="function"&&(ne.postRun=[ne.postRun]);ne.postRun.length;)La(ne.postRun.shift());hi(to)}function Il(xe){Yr.unshift(xe)}function La(xe){to.unshift(xe)}var Cl=Math.abs,Un=Math.ceil,Ra=Math.floor,pa=Math.min,Yt=0,Ue=null;function $e(xe){Yt++,ne.monitorRunDependencies&&ne.monitorRunDependencies(Yt)}function Pe(xe){if(Yt--,ne.monitorRunDependencies&&ne.monitorRunDependencies(Yt),Yt==0&&Ue){var Me=Ue;Ue=null,Me()}}ne.preloadedImages={},ne.preloadedAudios={};var Ft=null,Zt="data:application/octet-stream;base64,";function ni(xe){return String.prototype.startsWith?xe.startsWith(Zt):xe.indexOf(Zt)===0}var ri,Qt;Ft="data:application/octet-stream;base64,AAAAAAAAAAACAAAAAwAAAAEAAAAFAAAABAAAAAYAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAABAAAABAAAAAMAAAAGAAAABQAAAAIAAAAAAAAAAgAAAAMAAAABAAAABAAAAAYAAAAAAAAABQAAAAMAAAAGAAAABAAAAAUAAAAAAAAAAQAAAAIAAAAEAAAABQAAAAYAAAAAAAAAAgAAAAMAAAABAAAABQAAAAIAAAAAAAAAAQAAAAMAAAAGAAAABAAAAAYAAAAAAAAABQAAAAIAAAABAAAABAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAgAAAAMAAAAAAAAAAAAAAAIAAAAAAAAAAQAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAEAAAABgAAAAAAAAAFAAAAAAAAAAAAAAAEAAAABQAAAAAAAAAAAAAAAAAAAAIAAAAAAAAABgAAAAAAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAACAAAAAwAAAAQAAAAFAAAABgAAAAEAAAACAAAAAwAAAAQAAAAFAAAABgAAAAAAAAACAAAAAwAAAAQAAAAFAAAABgAAAAAAAAABAAAAAwAAAAQAAAAFAAAABgAAAAAAAAABAAAAAgAAAAQAAAAFAAAABgAAAAAAAAABAAAAAgAAAAMAAAAFAAAABgAAAAAAAAABAAAAAgAAAAMAAAAEAAAABgAAAAAAAAABAAAAAgAAAAMAAAAEAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAADAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAACAAAAAgAAAAAAAAAAAAAABgAAAAAAAAADAAAAAgAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAUAAAAEAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAAAAAAABgAAAAAAAAAEAAAAAAAAAAYAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAUAAAACAAAABAAAAAMAAAAIAAAAAQAAAAcAAAAGAAAACQAAAAAAAAADAAAAAgAAAAIAAAAGAAAACgAAAAsAAAAAAAAAAQAAAAUAAAADAAAADQAAAAEAAAAHAAAABAAAAAwAAAAAAAAABAAAAH8AAAAPAAAACAAAAAMAAAAAAAAADAAAAAUAAAACAAAAEgAAAAoAAAAIAAAAAAAAABAAAAAGAAAADgAAAAsAAAARAAAAAQAAAAkAAAACAAAABwAAABUAAAAJAAAAEwAAAAMAAAANAAAAAQAAAAgAAAAFAAAAFgAAABAAAAAEAAAAAAAAAA8AAAAJAAAAEwAAAA4AAAAUAAAAAQAAAAcAAAAGAAAACgAAAAsAAAAYAAAAFwAAAAUAAAACAAAAEgAAAAsAAAARAAAAFwAAABkAAAACAAAABgAAAAoAAAAMAAAAHAAAAA0AAAAaAAAABAAAAA8AAAADAAAADQAAABoAAAAVAAAAHQAAAAMAAAAMAAAABwAAAA4AAAB/AAAAEQAAABsAAAAJAAAAFAAAAAYAAAAPAAAAFgAAABwAAAAfAAAABAAAAAgAAAAMAAAAEAAAABIAAAAhAAAAHgAAAAgAAAAFAAAAFgAAABEAAAALAAAADgAAAAYAAAAjAAAAGQAAABsAAAASAAAAGAAAAB4AAAAgAAAABQAAAAoAAAAQAAAAEwAAACIAAAAUAAAAJAAAAAcAAAAVAAAACQAAABQAAAAOAAAAEwAAAAkAAAAoAAAAGwAAACQAAAAVAAAAJgAAABMAAAAiAAAADQAAAB0AAAAHAAAAFgAAABAAAAApAAAAIQAAAA8AAAAIAAAAHwAAABcAAAAYAAAACwAAAAoAAAAnAAAAJQAAABkAAAAYAAAAfwAAACAAAAAlAAAACgAAABcAAAASAAAAGQAAABcAAAARAAAACwAAAC0AAAAnAAAAIwAAABoAAAAqAAAAHQAAACsAAAAMAAAAHAAAAA0AAAAbAAAAKAAAACMAAAAuAAAADgAAABQAAAARAAAAHAAAAB8AAAAqAAAALAAAAAwAAAAPAAAAGgAAAB0AAAArAAAAJgAAAC8AAAANAAAAGgAAABUAAAAeAAAAIAAAADAAAAAyAAAAEAAAABIAAAAhAAAAHwAAACkAAAAsAAAANQAAAA8AAAAWAAAAHAAAACAAAAAeAAAAGAAAABIAAAA0AAAAMgAAACUAAAAhAAAAHgAAADEAAAAwAAAAFgAAABAAAAApAAAAIgAAABMAAAAmAAAAFQAAADYAAAAkAAAAMwAAACMAAAAuAAAALQAAADgAAAARAAAAGwAAABkAAAAkAAAAFAAAACIAAAATAAAANwAAACgAAAA2AAAAJQAAACcAAAA0AAAAOQAAABgAAAAXAAAAIAAAACYAAAB/AAAAIgAAADMAAAAdAAAALwAAABUAAAAnAAAAJQAAABkAAAAXAAAAOwAAADkAAAAtAAAAKAAAABsAAAAkAAAAFAAAADwAAAAuAAAANwAAACkAAAAxAAAANQAAAD0AAAAWAAAAIQAAAB8AAAAqAAAAOgAAACsAAAA+AAAAHAAAACwAAAAaAAAAKwAAAD4AAAAvAAAAQAAAABoAAAAqAAAAHQAAACwAAAA1AAAAOgAAAEEAAAAcAAAAHwAAACoAAAAtAAAAJwAAACMAAAAZAAAAPwAAADsAAAA4AAAALgAAADwAAAA4AAAARAAAABsAAAAoAAAAIwAAAC8AAAAmAAAAKwAAAB0AAABFAAAAMwAAAEAAAAAwAAAAMQAAAB4AAAAhAAAAQwAAAEIAAAAyAAAAMQAAAH8AAAA9AAAAQgAAACEAAAAwAAAAKQAAADIAAAAwAAAAIAAAAB4AAABGAAAAQwAAADQAAAAzAAAARQAAADYAAABHAAAAJgAAAC8AAAAiAAAANAAAADkAAABGAAAASgAAACAAAAAlAAAAMgAAADUAAAA9AAAAQQAAAEsAAAAfAAAAKQAAACwAAAA2AAAARwAAADcAAABJAAAAIgAAADMAAAAkAAAANwAAACgAAAA2AAAAJAAAAEgAAAA8AAAASQAAADgAAABEAAAAPwAAAE0AAAAjAAAALgAAAC0AAAA5AAAAOwAAAEoAAABOAAAAJQAAACcAAAA0AAAAOgAAAH8AAAA+AAAATAAAACwAAABBAAAAKgAAADsAAAA/AAAATgAAAE8AAAAnAAAALQAAADkAAAA8AAAASAAAAEQAAABQAAAAKAAAADcAAAAuAAAAPQAAADUAAAAxAAAAKQAAAFEAAABLAAAAQgAAAD4AAAArAAAAOgAAACoAAABSAAAAQAAAAEwAAAA/AAAAfwAAADgAAAAtAAAATwAAADsAAABNAAAAQAAAAC8AAAA+AAAAKwAAAFQAAABFAAAAUgAAAEEAAAA6AAAANQAAACwAAABWAAAATAAAAEsAAABCAAAAQwAAAFEAAABVAAAAMQAAADAAAAA9AAAAQwAAAEIAAAAyAAAAMAAAAFcAAABVAAAARgAAAEQAAAA4AAAAPAAAAC4AAABaAAAATQAAAFAAAABFAAAAMwAAAEAAAAAvAAAAWQAAAEcAAABUAAAARgAAAEMAAAA0AAAAMgAAAFMAAABXAAAASgAAAEcAAABZAAAASQAAAFsAAAAzAAAARQAAADYAAABIAAAAfwAAAEkAAAA3AAAAUAAAADwAAABYAAAASQAAAFsAAABIAAAAWAAAADYAAABHAAAANwAAAEoAAABOAAAAUwAAAFwAAAA0AAAAOQAAAEYAAABLAAAAQQAAAD0AAAA1AAAAXgAAAFYAAABRAAAATAAAAFYAAABSAAAAYAAAADoAAABBAAAAPgAAAE0AAAA/AAAARAAAADgAAABdAAAATwAAAFoAAABOAAAASgAAADsAAAA5AAAAXwAAAFwAAABPAAAATwAAAE4AAAA/AAAAOwAAAF0AAABfAAAATQAAAFAAAABEAAAASAAAADwAAABjAAAAWgAAAFgAAABRAAAAVQAAAF4AAABlAAAAPQAAAEIAAABLAAAAUgAAAGAAAABUAAAAYgAAAD4AAABMAAAAQAAAAFMAAAB/AAAASgAAAEYAAABkAAAAVwAAAFwAAABUAAAARQAAAFIAAABAAAAAYQAAAFkAAABiAAAAVQAAAFcAAABlAAAAZgAAAEIAAABDAAAAUQAAAFYAAABMAAAASwAAAEEAAABoAAAAYAAAAF4AAABXAAAAUwAAAGYAAABkAAAAQwAAAEYAAABVAAAAWAAAAEgAAABbAAAASQAAAGMAAABQAAAAaQAAAFkAAABhAAAAWwAAAGcAAABFAAAAVAAAAEcAAABaAAAATQAAAFAAAABEAAAAagAAAF0AAABjAAAAWwAAAEkAAABZAAAARwAAAGkAAABYAAAAZwAAAFwAAABTAAAATgAAAEoAAABsAAAAZAAAAF8AAABdAAAATwAAAFoAAABNAAAAbQAAAF8AAABqAAAAXgAAAFYAAABRAAAASwAAAGsAAABoAAAAZQAAAF8AAABcAAAATwAAAE4AAABtAAAAbAAAAF0AAABgAAAAaAAAAGIAAABuAAAATAAAAFYAAABSAAAAYQAAAH8AAABiAAAAVAAAAGcAAABZAAAAbwAAAGIAAABuAAAAYQAAAG8AAABSAAAAYAAAAFQAAABjAAAAUAAAAGkAAABYAAAAagAAAFoAAABxAAAAZAAAAGYAAABTAAAAVwAAAGwAAAByAAAAXAAAAGUAAABmAAAAawAAAHAAAABRAAAAVQAAAF4AAABmAAAAZQAAAFcAAABVAAAAcgAAAHAAAABkAAAAZwAAAFsAAABhAAAAWQAAAHQAAABpAAAAbwAAAGgAAABrAAAAbgAAAHMAAABWAAAAXgAAAGAAAABpAAAAWAAAAGcAAABbAAAAcQAAAGMAAAB0AAAAagAAAF0AAABjAAAAWgAAAHUAAABtAAAAcQAAAGsAAAB/AAAAZQAAAF4AAABzAAAAaAAAAHAAAABsAAAAZAAAAF8AAABcAAAAdgAAAHIAAABtAAAAbQAAAGwAAABdAAAAXwAAAHUAAAB2AAAAagAAAG4AAABiAAAAaAAAAGAAAAB3AAAAbwAAAHMAAABvAAAAYQAAAG4AAABiAAAAdAAAAGcAAAB3AAAAcAAAAGsAAABmAAAAZQAAAHgAAABzAAAAcgAAAHEAAABjAAAAdAAAAGkAAAB1AAAAagAAAHkAAAByAAAAcAAAAGQAAABmAAAAdgAAAHgAAABsAAAAcwAAAG4AAABrAAAAaAAAAHgAAAB3AAAAcAAAAHQAAABnAAAAdwAAAG8AAABxAAAAaQAAAHkAAAB1AAAAfwAAAG0AAAB2AAAAcQAAAHkAAABqAAAAdgAAAHgAAABsAAAAcgAAAHUAAAB5AAAAbQAAAHcAAABvAAAAcwAAAG4AAAB5AAAAdAAAAHgAAAB4AAAAcwAAAHIAAABwAAAAeQAAAHcAAAB2AAAAeQAAAHQAAAB4AAAAdwAAAHUAAABxAAAAdgAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAEAAAAFAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAIAAAAFAAAAAQAAAAAAAAD/////AQAAAAAAAAADAAAABAAAAAIAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAUAAAABAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAAFAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAEAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAQAAAAFAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAMAAAAAAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAAAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAADAAAAAwAAAAMAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAABQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAAAAAAAAAAABAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAMAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAQAAAAMAAAABAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAMAAAABAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAADAAAABQAAAAEAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAEAAAABQAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAgAAAAUAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAAMAAAABAAAAAAAAAAEAAAAAAAAABQAAAAAAAAAAAAAABQAAAAUAAAAAAAAAAAAAAP////8BAAAAAAAAAAMAAAAEAAAAAgAAAAAAAAAAAAAAAQAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAABQAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAQAAAP//////////AQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAIAAAAAAAAAAAAAAAEAAAACAAAABgAAAAQAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAABwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABgAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAoAAAACAAAAAAAAAAAAAAABAAAAAQAAAAUAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAIAAAAAAAAAAAAAAAEAAAADAAAABwAAAAYAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAHAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAABAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAgAAAAAAAAAAAAAAAQAAAAAAAAAJAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAwAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAgAAAAAAAAAAAAAAAQAAAAQAAAAIAAAACgAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAsAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAJAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAACAAAAAAAAAAAAAAABAAAACwAAAA8AAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAA4AAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAgAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAFAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcAAAACAAAAAAAAAAAAAAABAAAADAAAABAAAAAMAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAPAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAEAAAAKAAAAEwAAAAgAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAADwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAJAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA0AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAgAAAAAAAAAAAAAAAQAAAA0AAAARAAAADQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABEAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABMAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQAAAAIAAAAAAAAAAAAAAAEAAAAOAAAAEgAAAA8AAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAPAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABMAAAACAAAAAAAAAAAAAAABAAAA//////////8TAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABMAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAASAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABIAAAAAAAAAGAAAAAAAAAAhAAAAAAAAAB4AAAAAAAAAIAAAAAMAAAAxAAAAAQAAADAAAAADAAAAMgAAAAMAAAAIAAAAAAAAAAUAAAAFAAAACgAAAAUAAAAWAAAAAAAAABAAAAAAAAAAEgAAAAAAAAApAAAAAQAAACEAAAAAAAAAHgAAAAAAAAAEAAAAAAAAAAAAAAAFAAAAAgAAAAUAAAAPAAAAAQAAAAgAAAAAAAAABQAAAAUAAAAfAAAAAQAAABYAAAAAAAAAEAAAAAAAAAACAAAAAAAAAAYAAAAAAAAADgAAAAAAAAAKAAAAAAAAAAsAAAAAAAAAEQAAAAMAAAAYAAAAAQAAABcAAAADAAAAGQAAAAMAAAAAAAAAAAAAAAEAAAAFAAAACQAAAAUAAAAFAAAAAAAAAAIAAAAAAAAABgAAAAAAAAASAAAAAQAAAAoAAAAAAAAACwAAAAAAAAAEAAAAAQAAAAMAAAAFAAAABwAAAAUAAAAIAAAAAQAAAAAAAAAAAAAAAQAAAAUAAAAQAAAAAQAAAAUAAAAAAAAAAgAAAAAAAAAHAAAAAAAAABUAAAAAAAAAJgAAAAAAAAAJAAAAAAAAABMAAAAAAAAAIgAAAAMAAAAOAAAAAQAAABQAAAADAAAAJAAAAAMAAAADAAAAAAAAAA0AAAAFAAAAHQAAAAUAAAABAAAAAAAAAAcAAAAAAAAAFQAAAAAAAAAGAAAAAQAAAAkAAAAAAAAAEwAAAAAAAAAEAAAAAgAAAAwAAAAFAAAAGgAAAAUAAAAAAAAAAQAAAAMAAAAAAAAADQAAAAUAAAACAAAAAQAAAAEAAAAAAAAABwAAAAAAAAAaAAAAAAAAACoAAAAAAAAAOgAAAAAAAAAdAAAAAAAAACsAAAAAAAAAPgAAAAMAAAAmAAAAAQAAAC8AAAADAAAAQAAAAAMAAAAMAAAAAAAAABwAAAAFAAAALAAAAAUAAAANAAAAAAAAABoAAAAAAAAAKgAAAAAAAAAVAAAAAQAAAB0AAAAAAAAAKwAAAAAAAAAEAAAAAwAAAA8AAAAFAAAAHwAAAAUAAAADAAAAAQAAAAwAAAAAAAAAHAAAAAUAAAAHAAAAAQAAAA0AAAAAAAAAGgAAAAAAAAAfAAAAAAAAACkAAAAAAAAAMQAAAAAAAAAsAAAAAAAAADUAAAAAAAAAPQAAAAMAAAA6AAAAAQAAAEEAAAADAAAASwAAAAMAAAAPAAAAAAAAABYAAAAFAAAAIQAAAAUAAAAcAAAAAAAAAB8AAAAAAAAAKQAAAAAAAAAqAAAAAQAAACwAAAAAAAAANQAAAAAAAAAEAAAABAAAAAgAAAAFAAAAEAAAAAUAAAAMAAAAAQAAAA8AAAAAAAAAFgAAAAUAAAAaAAAAAQAAABwAAAAAAAAAHwAAAAAAAAAyAAAAAAAAADAAAAAAAAAAMQAAAAMAAAAgAAAAAAAAAB4AAAADAAAAIQAAAAMAAAAYAAAAAwAAABIAAAADAAAAEAAAAAMAAABGAAAAAAAAAEMAAAAAAAAAQgAAAAMAAAA0AAAAAwAAADIAAAAAAAAAMAAAAAAAAAAlAAAAAwAAACAAAAAAAAAAHgAAAAMAAABTAAAAAAAAAFcAAAADAAAAVQAAAAMAAABKAAAAAwAAAEYAAAAAAAAAQwAAAAAAAAA5AAAAAQAAADQAAAADAAAAMgAAAAAAAAAZAAAAAAAAABcAAAAAAAAAGAAAAAMAAAARAAAAAAAAAAsAAAADAAAACgAAAAMAAAAOAAAAAwAAAAYAAAADAAAAAgAAAAMAAAAtAAAAAAAAACcAAAAAAAAAJQAAAAMAAAAjAAAAAwAAABkAAAAAAAAAFwAAAAAAAAAbAAAAAwAAABEAAAAAAAAACwAAAAMAAAA/AAAAAAAAADsAAAADAAAAOQAAAAMAAAA4AAAAAwAAAC0AAAAAAAAAJwAAAAAAAAAuAAAAAwAAACMAAAADAAAAGQAAAAAAAAAkAAAAAAAAABQAAAAAAAAADgAAAAMAAAAiAAAAAAAAABMAAAADAAAACQAAAAMAAAAmAAAAAwAAABUAAAADAAAABwAAAAMAAAA3AAAAAAAAACgAAAAAAAAAGwAAAAMAAAA2AAAAAwAAACQAAAAAAAAAFAAAAAAAAAAzAAAAAwAAACIAAAAAAAAAEwAAAAMAAABIAAAAAAAAADwAAAADAAAALgAAAAMAAABJAAAAAwAAADcAAAAAAAAAKAAAAAAAAABHAAAAAwAAADYAAAADAAAAJAAAAAAAAABAAAAAAAAAAC8AAAAAAAAAJgAAAAMAAAA+AAAAAAAAACsAAAADAAAAHQAAAAMAAAA6AAAAAwAAACoAAAADAAAAGgAAAAMAAABUAAAAAAAAAEUAAAAAAAAAMwAAAAMAAABSAAAAAwAAAEAAAAAAAAAALwAAAAAAAABMAAAAAwAAAD4AAAAAAAAAKwAAAAMAAABhAAAAAAAAAFkAAAADAAAARwAAAAMAAABiAAAAAwAAAFQAAAAAAAAARQAAAAAAAABgAAAAAwAAAFIAAAADAAAAQAAAAAAAAABLAAAAAAAAAEEAAAAAAAAAOgAAAAMAAAA9AAAAAAAAADUAAAADAAAALAAAAAMAAAAxAAAAAwAAACkAAAADAAAAHwAAAAMAAABeAAAAAAAAAFYAAAAAAAAATAAAAAMAAABRAAAAAwAAAEsAAAAAAAAAQQAAAAAAAABCAAAAAwAAAD0AAAAAAAAANQAAAAMAAABrAAAAAAAAAGgAAAADAAAAYAAAAAMAAABlAAAAAwAAAF4AAAAAAAAAVgAAAAAAAABVAAAAAwAAAFEAAAADAAAASwAAAAAAAAA5AAAAAAAAADsAAAAAAAAAPwAAAAMAAABKAAAAAAAAAE4AAAADAAAATwAAAAMAAABTAAAAAwAAAFwAAAADAAAAXwAAAAMAAAAlAAAAAAAAACcAAAADAAAALQAAAAMAAAA0AAAAAAAAADkAAAAAAAAAOwAAAAAAAABGAAAAAwAAAEoAAAAAAAAATgAAAAMAAAAYAAAAAAAAABcAAAADAAAAGQAAAAMAAAAgAAAAAwAAACUAAAAAAAAAJwAAAAMAAAAyAAAAAwAAADQAAAAAAAAAOQAAAAAAAAAuAAAAAAAAADwAAAAAAAAASAAAAAMAAAA4AAAAAAAAAEQAAAADAAAAUAAAAAMAAAA/AAAAAwAAAE0AAAADAAAAWgAAAAMAAAAbAAAAAAAAACgAAAADAAAANwAAAAMAAAAjAAAAAAAAAC4AAAAAAAAAPAAAAAAAAAAtAAAAAwAAADgAAAAAAAAARAAAAAMAAAAOAAAAAAAAABQAAAADAAAAJAAAAAMAAAARAAAAAwAAABsAAAAAAAAAKAAAAAMAAAAZAAAAAwAAACMAAAAAAAAALgAAAAAAAABHAAAAAAAAAFkAAAAAAAAAYQAAAAMAAABJAAAAAAAAAFsAAAADAAAAZwAAAAMAAABIAAAAAwAAAFgAAAADAAAAaQAAAAMAAAAzAAAAAAAAAEUAAAADAAAAVAAAAAMAAAA2AAAAAAAAAEcAAAAAAAAAWQAAAAAAAAA3AAAAAwAAAEkAAAAAAAAAWwAAAAMAAAAmAAAAAAAAAC8AAAADAAAAQAAAAAMAAAAiAAAAAwAAADMAAAAAAAAARQAAAAMAAAAkAAAAAwAAADYAAAAAAAAARwAAAAAAAABgAAAAAAAAAGgAAAAAAAAAawAAAAMAAABiAAAAAAAAAG4AAAADAAAAcwAAAAMAAABhAAAAAwAAAG8AAAADAAAAdwAAAAMAAABMAAAAAAAAAFYAAAADAAAAXgAAAAMAAABSAAAAAAAAAGAAAAAAAAAAaAAAAAAAAABUAAAAAwAAAGIAAAAAAAAAbgAAAAMAAAA6AAAAAAAAAEEAAAADAAAASwAAAAMAAAA+AAAAAwAAAEwAAAAAAAAAVgAAAAMAAABAAAAAAwAAAFIAAAAAAAAAYAAAAAAAAABVAAAAAAAAAFcAAAAAAAAAUwAAAAMAAABlAAAAAAAAAGYAAAADAAAAZAAAAAMAAABrAAAAAwAAAHAAAAADAAAAcgAAAAMAAABCAAAAAAAAAEMAAAADAAAARgAAAAMAAABRAAAAAAAAAFUAAAAAAAAAVwAAAAAAAABeAAAAAwAAAGUAAAAAAAAAZgAAAAMAAAAxAAAAAAAAADAAAAADAAAAMgAAAAMAAAA9AAAAAwAAAEIAAAAAAAAAQwAAAAMAAABLAAAAAwAAAFEAAAAAAAAAVQAAAAAAAABfAAAAAAAAAFwAAAAAAAAAUwAAAAAAAABPAAAAAAAAAE4AAAAAAAAASgAAAAMAAAA/AAAAAQAAADsAAAADAAAAOQAAAAMAAABtAAAAAAAAAGwAAAAAAAAAZAAAAAUAAABdAAAAAQAAAF8AAAAAAAAAXAAAAAAAAABNAAAAAQAAAE8AAAAAAAAATgAAAAAAAAB1AAAABAAAAHYAAAAFAAAAcgAAAAUAAABqAAAAAQAAAG0AAAAAAAAAbAAAAAAAAABaAAAAAQAAAF0AAAABAAAAXwAAAAAAAABaAAAAAAAAAE0AAAAAAAAAPwAAAAAAAABQAAAAAAAAAEQAAAAAAAAAOAAAAAMAAABIAAAAAQAAADwAAAADAAAALgAAAAMAAABqAAAAAAAAAF0AAAAAAAAATwAAAAUAAABjAAAAAQAAAFoAAAAAAAAATQAAAAAAAABYAAAAAQAAAFAAAAAAAAAARAAAAAAAAAB1AAAAAwAAAG0AAAAFAAAAXwAAAAUAAABxAAAAAQAAAGoAAAAAAAAAXQAAAAAAAABpAAAAAQAAAGMAAAABAAAAWgAAAAAAAABpAAAAAAAAAFgAAAAAAAAASAAAAAAAAABnAAAAAAAAAFsAAAAAAAAASQAAAAMAAABhAAAAAQAAAFkAAAADAAAARwAAAAMAAABxAAAAAAAAAGMAAAAAAAAAUAAAAAUAAAB0AAAAAQAAAGkAAAAAAAAAWAAAAAAAAABvAAAAAQAAAGcAAAAAAAAAWwAAAAAAAAB1AAAAAgAAAGoAAAAFAAAAWgAAAAUAAAB5AAAAAQAAAHEAAAAAAAAAYwAAAAAAAAB3AAAAAQAAAHQAAAABAAAAaQAAAAAAAAB3AAAAAAAAAG8AAAAAAAAAYQAAAAAAAABzAAAAAAAAAG4AAAAAAAAAYgAAAAMAAABrAAAAAQAAAGgAAAADAAAAYAAAAAMAAAB5AAAAAAAAAHQAAAAAAAAAZwAAAAUAAAB4AAAAAQAAAHcAAAAAAAAAbwAAAAAAAABwAAAAAQAAAHMAAAAAAAAAbgAAAAAAAAB1AAAAAQAAAHEAAAAFAAAAaQAAAAUAAAB2AAAAAQAAAHkAAAAAAAAAdAAAAAAAAAByAAAAAQAAAHgAAAABAAAAdwAAAAAAAAByAAAAAAAAAHAAAAAAAAAAawAAAAAAAABkAAAAAAAAAGYAAAAAAAAAZQAAAAMAAABTAAAAAQAAAFcAAAADAAAAVQAAAAMAAAB2AAAAAAAAAHgAAAAAAAAAcwAAAAUAAABsAAAAAQAAAHIAAAAAAAAAcAAAAAAAAABcAAAAAQAAAGQAAAAAAAAAZgAAAAAAAAB1AAAAAAAAAHkAAAAFAAAAdwAAAAUAAABtAAAAAQAAAHYAAAAAAAAAeAAAAAAAAABfAAAAAQAAAGwAAAABAAAAcgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAAEAAAABAAAAAAAAAAAAAAABAAAAAAAAAAEAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAB+ogX28rbpPxqumpJv+fM/165tC4ns9D+XaEnTqUsEQFrOtNlC4PA/3U+0XG6P9b9TdUUBxTTjP4PUp8ex1ty/B1rD/EN43z+lcDi6LLrZP/a45NWEHMY/oJ5ijLDZ+j/xw3rjxWPjP2B8A46ioQdAotff3wla2z+FMSpA1jj+v6b5Y1mtPbS/cIu8K0F457/2esiyJpDNv98k5Ts2NeA/pvljWa09tD88ClUJ60MDQPZ6yLImkM0/4ONKxa0UBcD2uOTVhBzGv5G7JRxGave/8cN648Vj47+HCwtkjAXIv6LX398JWtu/qyheaCAL9D9TdUUBxTTjv4gyTxslhwVAB1rD/EN4378EH/28teoFwH6iBfbytum/F6ztFYdK/r/Xrm0Liez0vwcS6wNGWeO/Ws602ULg8L9TCtRLiLT8P8pi5RexJsw/BlIKPVwR5T95Wyu0/QjnP5PjoT7YYcu/mBhKZ6zrwj8wRYS7NebuP3qW6geh+Ls/SLrixebL3r+pcyymN9XrPwmkNHp7xec/GWNMZVAA17+82s+x2BLiPwn2ytbJ9ek/LgEH1sMS1j8yp/2LhTfeP+SnWwtQBbu/d38gkp5X7z8ytsuHaADGPzUYObdf1+m/7IauECWhwz+cjSACjzniP76Z+wUhN9K/1+GEKzup67+/GYr/04baPw6idWOvsuc/ZedTWsRa5b/EJQOuRzi0v/OncYhHPes/h49PixY53j+i8wWfC03Nvw2idWOvsue/ZedTWsRa5T/EJQOuRzi0P/KncYhHPeu/iY9PixY53r+i8wWfC03NP9anWwtQBbs/d38gkp5X778ytsuHaADGvzUYObdf1+k/74auECWhw7+cjSACjzniv8CZ+wUhN9I/1uGEKzup6z+/GYr/04bavwmkNHp7xee/F2NMZVAA1z+82s+x2BLivwr2ytbJ9em/KwEH1sMS1r8yp/2LhTfev81i5RexJsy/BlIKPVwR5b95Wyu0/Qjnv5DjoT7YYcs/nBhKZ6zrwr8wRYS7Nebuv3OW6geh+Lu/SLrixebL3j+pcyymN9Xrv8rHIFfWehZAMBwUdlo0DECTUc17EOb2PxpVB1SWChdAzjbhb9pTDUDQhmdvECX5P9FlMKCC9+g/IIAzjELgE0DajDngMv8GQFhWDmDPjNs/y1guLh96EkAxPi8k7DIEQJCc4URlhRhA3eLKKLwkEECqpNAyTBD/P6xpjXcDiwVAFtl//cQm4z+Ibt3XKiYTQM7mCLUb3QdAoM1t8yVv7D8aLZv2Nk8UQEAJPV5nQwxAtSsfTCoE9z9TPjXLXIIWQBVanC5W9AtAYM3d7Adm9j++5mQz1FoWQBUThyaVBghAwH5muQsV7T89Q1qv82MUQJoWGOfNuBdAzrkClkmwDkDQjKq77t37Py+g0dtitsE/ZwAMTwVPEUBojepluNwBQGYbtuW+t9w/HNWIJs6MEkDTNuQUSlgEQKxktPP5TcQ/ixbLB8JjEUCwuWjXMQYCQAS/R09FkRdAowpiZjhhDkB7LmlczD/7P01iQmhhsAVAnrtTwDy84z/Z6jfQ2TgTQChOCXMnWwpAhrW3daoz8z/HYJvVPI4VQLT3ik5FcA5Angi7LOZd+z+NNVzDy5gXQBXdvVTFUA1AYNMgOeYe+T8+qHXGCwkXQKQTOKwa5AJA8gFVoEMW0T+FwzJyttIRQAEAAAD/////BwAAAP////8xAAAA/////1cBAAD/////YQkAAP////+nQQAA/////5HLAQD/////95AMAP/////B9lcAAAAAAAAAAAAAAAAAAgAAAP////8OAAAA/////2IAAAD/////rgIAAP/////CEgAA/////06DAAD/////IpcDAP/////uIRkA/////4LtrwAAAAAAAAAAAAAAAAAAAAAAAgAAAP//////////AQAAAAMAAAD//////////////////////////////////////////////////////////////////////////wEAAAAAAAAAAgAAAP///////////////wMAAAD//////////////////////////////////////////////////////////////////////////wEAAAAAAAAAAgAAAP///////////////wMAAAD//////////////////////////////////////////////////////////////////////////wEAAAAAAAAAAgAAAP///////////////wMAAAD//////////////////////////////////////////////////////////wIAAAD//////////wEAAAAAAAAA/////////////////////wMAAAD/////////////////////////////////////////////////////AwAAAP////////////////////8AAAAA/////////////////////wEAAAD///////////////8CAAAA////////////////////////////////AwAAAP////////////////////8AAAAA////////////////AgAAAAEAAAD/////////////////////////////////////////////////////AwAAAP////////////////////8AAAAA////////////////AgAAAAEAAAD/////////////////////////////////////////////////////AwAAAP////////////////////8AAAAA////////////////AgAAAAEAAAD/////////////////////////////////////////////////////AwAAAP////////////////////8AAAAA////////////////AgAAAAEAAAD/////////////////////////////////////////////////////AQAAAAIAAAD///////////////8AAAAA/////////////////////wMAAAD/////////////////////////////////////////////////////AQAAAAIAAAD///////////////8AAAAA/////////////////////wMAAAD/////////////////////////////////////////////////////AQAAAAIAAAD///////////////8AAAAA/////////////////////wMAAAD/////////////////////////////////////////////////////AQAAAAIAAAD///////////////8AAAAA/////////////////////wMAAAD///////////////////////////////8CAAAA////////////////AQAAAP////////////////////8AAAAA/////////////////////wMAAAD/////////////////////////////////////////////////////AwAAAP////////////////////8AAAAAAQAAAP//////////AgAAAP//////////////////////////////////////////////////////////AwAAAP///////////////wIAAAAAAAAAAQAAAP//////////////////////////////////////////////////////////////////////////AwAAAP///////////////wIAAAAAAAAAAQAAAP//////////////////////////////////////////////////////////////////////////AwAAAP///////////////wIAAAAAAAAAAQAAAP//////////////////////////////////////////////////////////////////////////AwAAAAEAAAD//////////wIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAgAAAAAAAAACAAAAAQAAAAEAAAACAAAAAgAAAAAAAAAFAAAABQAAAAAAAAACAAAAAgAAAAMAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAIAAAABAAAAAgAAAAIAAAACAAAAAAAAAAUAAAAGAAAAAAAAAAIAAAACAAAAAwAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAIAAAAAAAAAAgAAAAEAAAADAAAAAgAAAAIAAAAAAAAABQAAAAcAAAAAAAAAAgAAAAIAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAgAAAAAAAAACAAAAAQAAAAQAAAACAAAAAgAAAAAAAAAFAAAACAAAAAAAAAACAAAAAgAAAAMAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAACAAAAAAAAAAIAAAABAAAAAAAAAAIAAAACAAAAAAAAAAUAAAAJAAAAAAAAAAIAAAACAAAAAwAAAAUAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAIAAAACAAAAAAAAAAMAAAAOAAAAAgAAAAAAAAACAAAAAwAAAAAAAAAAAAAAAgAAAAIAAAADAAAABgAAAAAAAAAAAAAAAAAAAAAAAAALAAAAAgAAAAIAAAAAAAAAAwAAAAoAAAACAAAAAAAAAAIAAAADAAAAAQAAAAAAAAACAAAAAgAAAAMAAAAHAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAACAAAAAgAAAAAAAAADAAAACwAAAAIAAAAAAAAAAgAAAAMAAAACAAAAAAAAAAIAAAACAAAAAwAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAIAAAACAAAAAAAAAAMAAAAMAAAAAgAAAAAAAAACAAAAAwAAAAMAAAAAAAAAAgAAAAIAAAADAAAACQAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAgAAAAIAAAAAAAAAAwAAAA0AAAACAAAAAAAAAAIAAAADAAAABAAAAAAAAAACAAAAAgAAAAMAAAAKAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAACAAAAAgAAAAAAAAADAAAABgAAAAIAAAAAAAAAAgAAAAMAAAAPAAAAAAAAAAIAAAACAAAAAwAAAAsAAAAAAAAAAAAAAAAAAAAAAAAABgAAAAIAAAACAAAAAAAAAAMAAAAHAAAAAgAAAAAAAAACAAAAAwAAABAAAAAAAAAAAgAAAAIAAAADAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAgAAAAIAAAAAAAAAAwAAAAgAAAACAAAAAAAAAAIAAAADAAAAEQAAAAAAAAACAAAAAgAAAAMAAAANAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAACAAAAAgAAAAAAAAADAAAACQAAAAIAAAAAAAAAAgAAAAMAAAASAAAAAAAAAAIAAAACAAAAAwAAAA4AAAAAAAAAAAAAAAAAAAAAAAAACQAAAAIAAAACAAAAAAAAAAMAAAAFAAAAAgAAAAAAAAACAAAAAwAAABMAAAAAAAAAAgAAAAIAAAADAAAADwAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAgAAAAAAAAACAAAAAQAAABMAAAACAAAAAgAAAAAAAAAFAAAACgAAAAAAAAACAAAAAgAAAAMAAAAQAAAAAAAAAAAAAAAAAAAAAAAAABEAAAACAAAAAAAAAAIAAAABAAAADwAAAAIAAAACAAAAAAAAAAUAAAALAAAAAAAAAAIAAAACAAAAAwAAABEAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAIAAAAAAAAAAgAAAAEAAAAQAAAAAgAAAAIAAAAAAAAABQAAAAwAAAAAAAAAAgAAAAIAAAADAAAAEgAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAgAAAAAAAAACAAAAAQAAABEAAAACAAAAAgAAAAAAAAAFAAAADQAAAAAAAAACAAAAAgAAAAMAAAATAAAAAAAAAAAAAAAAAAAAAAAAAA8AAAACAAAAAAAAAAIAAAABAAAAEgAAAAIAAAACAAAAAAAAAAUAAAAOAAAAAAAAAAIAAAACAAAAAwAAAAIAAAABAAAAAAAAAAEAAAACAAAAAAAAAAAAAAACAAAAAQAAAAAAAAABAAAAAgAAAAEAAAAAAAAAAgAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAAAAAAAAAAABQAAAAQAAAAAAAAAAQAAAAUAAAAEAAAAAAAAAAUAAAAAAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAAAAAAAAAAAAAIAAAABAAAAAAAAAAEAAAACAAAAAQAAAAAAAAACAAAAAgAAAAAAAAABAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAAAAAAAAAAABQAAAAQAAAAAAAAAAQAAAAUAAAAEAAAAAAAAAAUAAAAFAAAAAAAAAAEAAAAAAAAAAAAAAMuhRbbsNlBBYqHW9OmHIkF9XBuqnS31QAK37uYhNMhAOSo3UUupm0DC+6pc6JxvQHV9eseEEEJAzURsCyqlFEB8BQ4NMJjnPyy3tBoS97o/xawXQznRjj89J2K2CZxhP6vX43RIIDQ/S8isgygEBz+LvFHQkmzaPjFFFO7wMq4+AADMLkTtjkIAAOgkJqxhQgAAU7B0MjRCAADwpBcVB0IAAACYP2HaQQAAAIn/Ja5BzczM4Eg6gUHNzMxMU7BTQTMzMzNfgCZBAAAAAEi3+UAAAAAAwGPNQDMzMzMzy6BAmpmZmZkxc0AzMzMzM/NFQDMzMzMzMxlAzczMzMzM7D+ygXSx2U6RQKimJOvQKnpA23hmONTHY0A/AGcxyudNQNb3K647mzZA+S56rrwWIUAm4kUQ+9UJQKre9hGzh/M/BLvoy9WG3T+LmqMf8VHGP2m3nYNV37A/gbFHcyeCmT+cBPWBckiDP61tZACjKW0/q2RbYVUYVj8uDypVyLNAP6jGS5cA5zBBwcqhBdCNGUEGEhQ/JVEDQT6WPnRbNO1AB/AWSJgT1kDfUWNCNLDAQNk+5C33OqlAchWL34QSk0DKvtDIrNV8QNF0G3kFzGVASSeWhBl6UED+/0mNGuk4QGjA/dm/1CJALPLPMql6DEDSHoDrwpP1P2jouzWST+A/egAAAAAAAABKAwAAAAAAAPoWAAAAAAAAyqAAAAAAAAB6ZQQAAAAAAErGHgAAAAAA+mvXAAAAAADK8+MFAAAAAHqqOykAAAAASqmhIAEAAAD6oGvkBwAAAMpm8T43AAAAes+ZuIIBAABKrDQMkwoAAPq1cFUFSgAAyvkUViUGAgAAAAAAAwAAAAYAAAACAAAABQAAAAEAAAAEAAAAAAAAAAAAAAAFAAAAAwAAAAEAAAAGAAAABAAAAAIAAAAAAAAAAAAAAP////8AAAAAAAAAAAAAAAAAAAAAAAAAAP////////////////////////////////////8AAAAA/////wAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAP////8AAAAAAAAAAAEAAAABAAAAAAAAAAAAAAD/////AAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAA/////wUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAP////8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/////////////////////////////////////AAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/////////////////////////////////////wAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAUAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP////////////////////////////////////8AAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAABAAAAAAAAAAAAAAABAAAAAQAAAAEAAAAAAAAAAQAAAAAAAAAFAAAAAQAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAEAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEBAAAAAAABAAEAAAEBAAAAAAABAAAAAQAAAAEAAQAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAACAAAAAQAAAAMAAAAOAAAABgAAAAsAAAACAAAABwAAAAEAAAAYAAAABQAAAAoAAAABAAAABgAAAAAAAAAmAAAABwAAAAwAAAADAAAACAAAAAIAAAAxAAAACQAAAA4AAAAAAAAABQAAAAQAAAA6AAAACAAAAA0AAAAEAAAACQAAAAMAAAA/AAAACwAAAAYAAAAPAAAACgAAABAAAABIAAAADAAAAAcAAAAQAAAACwAAABEAAABTAAAACgAAAAUAAAATAAAADgAAAA8AAABhAAAADQAAAAgAAAARAAAADAAAABIAAABrAAAADgAAAAkAAAASAAAADQAAABMAAAB1AAAADwAAABMAAAARAAAAEgAAABAAAAAHAAAABwAAAAEAAAACAAAABAAAAAMAAAAAAAAAAAAAAAcAAAADAAAAAQAAAAIAAAAFAAAABAAAAAAAAAAAAAAAYWxnb3MuYwBfcG9seWZpbGxJbnRlcm5hbABhZGphY2VudEZhY2VEaXJbdG1wRmlqay5mYWNlXVtmaWprLmZhY2VdID09IEtJAGZhY2VpamsuYwBfZmFjZUlqa1BlbnRUb0dlb0JvdW5kYXJ5AGFkamFjZW50RmFjZURpcltjZW50ZXJJSksuZmFjZV1bZmFjZTJdID09IEtJAF9mYWNlSWprVG9HZW9Cb3VuZGFyeQBwb2x5Z29uLT5uZXh0ID09IE5VTEwAbGlua2VkR2VvLmMAYWRkTmV3TGlua2VkUG9seWdvbgBuZXh0ICE9IE5VTEwAbG9vcCAhPSBOVUxMAGFkZE5ld0xpbmtlZExvb3AAcG9seWdvbi0+Zmlyc3QgPT0gTlVMTABhZGRMaW5rZWRMb29wAGNvb3JkICE9IE5VTEwAYWRkTGlua2VkQ29vcmQAbG9vcC0+Zmlyc3QgPT0gTlVMTABpbm5lckxvb3BzICE9IE5VTEwAbm9ybWFsaXplTXVsdGlQb2x5Z29uAGJib3hlcyAhPSBOVUxMAGNhbmRpZGF0ZXMgIT0gTlVMTABmaW5kUG9seWdvbkZvckhvbGUAY2FuZGlkYXRlQkJveGVzICE9IE5VTEwAcmV2RGlyICE9IElOVkFMSURfRElHSVQAbG9jYWxpai5jAGgzVG9Mb2NhbElqawBiYXNlQ2VsbCAhPSBvcmlnaW5CYXNlQ2VsbAAhKG9yaWdpbk9uUGVudCAmJiBpbmRleE9uUGVudCkAcGVudGFnb25Sb3RhdGlvbnMgPj0gMABkaXJlY3Rpb25Sb3RhdGlvbnMgPj0gMABiYXNlQ2VsbCA9PSBvcmlnaW5CYXNlQ2VsbABiYXNlQ2VsbCAhPSBJTlZBTElEX0JBU0VfQ0VMTABsb2NhbElqa1RvSDMAIV9pc0Jhc2VDZWxsUGVudGFnb24oYmFzZUNlbGwpAGJhc2VDZWxsUm90YXRpb25zID49IDAAd2l0aGluUGVudGFnb25Sb3RhdGlvbnMgPj0gMABncmFwaC0+YnVja2V0cyAhPSBOVUxMAHZlcnRleEdyYXBoLmMAaW5pdFZlcnRleEdyYXBoAG5vZGUgIT0gTlVMTABhZGRWZXJ0ZXhOb2Rl";var Oi=24032;function Qi(xe){return xe}function Ki(xe){var Me=/\b__Z[\w\d_]+/g;return xe.replace(Me,function(ct){var Pt=ct;return ct===Pt?ct:Pt+" ["+ct+"]"})}function Kr(){var xe=new Error;if(!xe.stack){try{throw new Error(0)}catch(Me){xe=Me}if(!xe.stack)return"(no stack trace available)"}return xe.stack.toString()}function _n(){var xe=Kr();return ne.extraStackTrace&&(xe+=`
`+ne.extraStackTrace()),Ki(xe)}function ts(xe,Me,ct,Pt){Et("Assertion failed: "+jr(xe)+", at: "+[Me?jr(Me):"unknown filename",ct,Pt?jr(Pt):"unknown function"])}function oi(){return Sn.length}function gn(xe,Me,ct){Nn.set(Nn.subarray(Me,Me+ct),xe)}function vr(xe){return ne.___errno_location&&(Ir[ne.___errno_location()>>2]=xe),xe}function ys(xe){Et("OOM")}function ls(xe){try{var Me=new ArrayBuffer(xe);return Me.byteLength!=xe?void 0:(new Int8Array(Me).set(Sn),we(Me),wo(Me),1)}catch{}}function gi(xe){var Me=oi(),ct=16777216,Pt=2147483648-ct;if(xe>Pt)return!1;for(var o=16777216,oe=Math.max(Me,o);oe<xe;)oe<=536870912?oe=At(2*oe,ct):oe=Math.min(At((3*oe+2147483648)/4,ct),Pt);var ti=ls(oe);return!!ti}var br=typeof atob=="function"?atob:function(xe){var Me="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",ct="",Pt,o,oe,ti,xi,yi,ai,pi=0;xe=xe.replace(/[^A-Za-z0-9\+\/\=]/g,"");do ti=Me.indexOf(xe.charAt(pi++)),xi=Me.indexOf(xe.charAt(pi++)),yi=Me.indexOf(xe.charAt(pi++)),ai=Me.indexOf(xe.charAt(pi++)),Pt=ti<<2|xi>>4,o=(xi&15)<<4|yi>>2,oe=(yi&3)<<6|ai,ct=ct+String.fromCharCode(Pt),yi!==64&&(ct=ct+String.fromCharCode(o)),ai!==64&&(ct=ct+String.fromCharCode(oe));while(pi<xe.length);return ct};function wr(xe){try{for(var Me=br(xe),ct=new Uint8Array(Me.length),Pt=0;Pt<Me.length;++Pt)ct[Pt]=Me.charCodeAt(Pt);return ct}catch{throw new Error("Converting base64 string to bytes failed.")}}function Cn(xe){if(ni(xe))return wr(xe.slice(Zt.length))}var io={Math,Int8Array,Int32Array,Uint8Array,Float32Array,Float64Array},Sr={a:Et,b:Xt,c:Rt,d:ts,e:vr,f:oi,g:gn,h:gi,i:ys,j:Qi,k:Ki,l:ls,m:Kr,n:_n,o:Oi,p:Zo},kt=function(xe,Me,ct){"almost asm";var Pt=new xe.Int8Array(ct),o=new xe.Int32Array(ct);new xe.Uint8Array(ct),new xe.Float32Array(ct);var oe=new xe.Float64Array(ct),ti=Me.p|0,xi=xe.Math.floor,yi=xe.Math.abs,ai=xe.Math.sqrt,pi=xe.Math.pow,gr=xe.Math.cos,bi=xe.Math.sin,zi=xe.Math.tan,fn=xe.Math.acos,Qs=xe.Math.asin,HA=xe.Math.atan,Ls=xe.Math.atan2,Rs=xe.Math.ceil,ko=xe.Math.imul,nn=xe.Math.min,qo=xe.Math.clz32,Dr=Me.b,gt=Me.c,Di=Me.d,Je=Me.e,Ar=Me.f,Hs=Me.g,DA=Me.h,kl=Me.i,nt=24048;function yn(x){return Pt=new Int8Array(x),o=new Int32Array(x),oe=new Float64Array(x),ct=x,!0}function Ze(x){x=x|0;var T=0;return T=nt,nt=nt+x|0,nt=nt+15&-16,T|0}function As(){return nt|0}function Xl(x){x=x|0,nt=x}function ro(x,T){x=x|0,nt=x}function WA(x){return x=x|0,(ko(x*3|0,x+1|0)|0)+1|0}function Xi(x,T,M,L){x=x|0,T=T|0,M=M|0,L=L|0;var j=0,H=0;Qo(x,T,M,L,0)|0&&(H=(ko(M*3|0,M+1|0)|0)+1|0,tn(L|0,0,H<<3|0)|0,j=Yo(H,4)|0,j&&(Fs(x,T,M,L,j,H,0),mr(j)))}function mn(x,T,M,L,j){x=x|0,T=T|0,M=M|0,L=L|0,j=j|0;var H=0;if(Qo(x,T,M,L,j)|0){if(H=(ko(M*3|0,M+1|0)|0)+1|0,tn(L|0,0,H<<3|0)|0,j|0){tn(j|0,0,H<<2|0)|0,Fs(x,T,M,L,j,H,0);return}j=Yo(H,4)|0,j&&(Fs(x,T,M,L,j,H,0),mr(j))}}function Qo(x,T,M,L,j){x=x|0,T=T|0,M=M|0,L=L|0,j=j|0;var H=0,Q=0,K=0,ue=0,Se=0,De=0,_t=0,Xe=0,tt=0;if(tt=nt,nt=nt+16|0,Xe=tt,H=L,o[H>>2]=x,o[H+4>>2]=T,H=(j|0)!=0,H&&(o[j>>2]=0),Ns(x,T)|0)return Xe=1,nt=tt,Xe|0;o[Xe>>2]=0;e:do if((M|0)>=1)if(H)for(Se=0,De=1,_t=1,Q=0,H=x;;){if(!(Q|Se)){if(H=Wn(H,T,4,Xe)|0,T=gt()|0,(H|0)==0&(T|0)==0){H=2;break e}if(Ns(H,T)|0){H=1;break e}}if(H=Wn(H,T,o[16+(Se<<2)>>2]|0,Xe)|0,T=gt()|0,(H|0)==0&(T|0)==0){H=2;break e}if(x=L+(_t<<3)|0,o[x>>2]=H,o[x+4>>2]=T,o[j+(_t<<2)>>2]=De,Q=Q+1|0,x=(Q|0)==(De|0),K=Se+1|0,ue=(K|0)==6,Ns(H,T)|0){H=1;break e}if(De=De+(ue&x&1)|0,(De|0)>(M|0)){H=0;break}else Se=x?ue?0:K:Se,_t=_t+1|0,Q=x?0:Q}else for(Se=0,De=1,_t=1,Q=0,H=x;;){if(!(Q|Se)){if(H=Wn(H,T,4,Xe)|0,T=gt()|0,(H|0)==0&(T|0)==0){H=2;break e}if(Ns(H,T)|0){H=1;break e}}if(H=Wn(H,T,o[16+(Se<<2)>>2]|0,Xe)|0,T=gt()|0,(H|0)==0&(T|0)==0){H=2;break e}if(x=L+(_t<<3)|0,o[x>>2]=H,o[x+4>>2]=T,Q=Q+1|0,x=(Q|0)==(De|0),K=Se+1|0,ue=(K|0)==6,Ns(H,T)|0){H=1;break e}if(De=De+(ue&x&1)|0,(De|0)>(M|0)){H=0;break}else Se=x?ue?0:K:Se,_t=_t+1|0,Q=x?0:Q}else H=0;while(!1);return Xe=H,nt=tt,Xe|0}function Fs(x,T,M,L,j,H,Q){x=x|0,T=T|0,M=M|0,L=L|0,j=j|0,H=H|0,Q=Q|0;var K=0,ue=0,Se=0,De=0,_t=0,Xe=0,tt=0;if(_t=nt,nt=nt+16|0,De=_t,(x|0)==0&(T|0)==0){nt=_t;return}if(K=Ea(x|0,T|0,H|0,((H|0)<0)<<31>>31|0)|0,gt()|0,ue=L+(K<<3)|0,Xe=ue,tt=o[Xe>>2]|0,Xe=o[Xe+4>>2]|0,Se=(tt|0)==(x|0)&(Xe|0)==(T|0),!((tt|0)==0&(Xe|0)==0|Se))do K=(K+1|0)%(H|0)|0,ue=L+(K<<3)|0,tt=ue,Xe=o[tt>>2]|0,tt=o[tt+4>>2]|0,Se=(Xe|0)==(x|0)&(tt|0)==(T|0);while(!((Xe|0)==0&(tt|0)==0|Se));if(K=j+(K<<2)|0,Se&&(o[K>>2]|0)<=(Q|0)){nt=_t;return}if(tt=ue,o[tt>>2]=x,o[tt+4>>2]=T,o[K>>2]=Q,(Q|0)>=(M|0)){nt=_t;return}tt=Q+1|0,o[De>>2]=0,Xe=Wn(x,T,2,De)|0,Fs(Xe,gt()|0,M,L,j,H,tt),o[De>>2]=0,Xe=Wn(x,T,3,De)|0,Fs(Xe,gt()|0,M,L,j,H,tt),o[De>>2]=0,Xe=Wn(x,T,1,De)|0,Fs(Xe,gt()|0,M,L,j,H,tt),o[De>>2]=0,Xe=Wn(x,T,5,De)|0,Fs(Xe,gt()|0,M,L,j,H,tt),o[De>>2]=0,Xe=Wn(x,T,4,De)|0,Fs(Xe,gt()|0,M,L,j,H,tt),o[De>>2]=0,Xe=Wn(x,T,6,De)|0,Fs(Xe,gt()|0,M,L,j,H,tt),nt=_t}function Wn(x,T,M,L){x=x|0,T=T|0,M=M|0,L=L|0;var j=0,H=0,Q=0,K=0,ue=0,Se=0,De=0,_t=0,Xe=0,tt=0;if((o[L>>2]|0)>0){j=0;do M=Os(M)|0,j=j+1|0;while((j|0)<(o[L>>2]|0))}K=Vt(x|0,T|0,45)|0,gt()|0,ue=K&127,H=Ws(x,T)|0,j=Vt(x|0,T|0,52)|0,gt()|0,j=j&15;e:do if(!j)Q=6;else for(;;){if(_t=(15-j|0)*3|0,Xe=Vt(x|0,T|0,_t|0)|0,gt()|0,Xe=Xe&7,tt=(Rn(j)|0)==0,j=j+-1|0,De=Jt(7,0,_t|0)|0,T=T&~(gt()|0),_t=Jt(o[(tt?464:48)+(Xe*28|0)+(M<<2)>>2]|0,0,_t|0)|0,Se=gt()|0,M=o[(tt?672:256)+(Xe*28|0)+(M<<2)>>2]|0,x=_t|x&~De,T=Se|T,!M){M=0;break e}if(!j){Q=6;break}}while(!1);(Q|0)==6&&(tt=o[880+(ue*28|0)+(M<<2)>>2]|0,Xe=Jt(tt|0,0,45)|0,x=Xe|x,T=gt()|0|T&-1040385,M=o[4304+(ue*28|0)+(M<<2)>>2]|0,(tt&127|0)==127&&(tt=Jt(o[880+(ue*28|0)+20>>2]|0,0,45)|0,T=gt()|0|T&-1040385,M=o[4304+(ue*28|0)+20>>2]|0,x=$o(tt|x,T)|0,T=gt()|0,o[L>>2]=(o[L>>2]|0)+1)),Q=Vt(x|0,T|0,45)|0,gt()|0,Q=Q&127;e:do if(is(Q)|0){t:do if((Ws(x,T)|0)==1){if((ue|0)!=(Q|0))if(rs(Q,o[7728+(ue*28|0)>>2]|0)|0){x=Pn(x,T)|0,H=1,T=gt()|0;break}else{x=$o(x,T)|0,H=1,T=gt()|0;break}switch(H|0){case 5:{x=Pn(x,T)|0,T=gt()|0,o[L>>2]=(o[L>>2]|0)+5,H=0;break t}case 3:{x=$o(x,T)|0,T=gt()|0,o[L>>2]=(o[L>>2]|0)+1,H=0;break t}default:return Xe=0,tt=0,Dr(Xe|0),tt|0}}else H=0;while(!1);if((M|0)>0){j=0;do x=ho(x,T)|0,T=gt()|0,j=j+1|0;while((j|0)!=(M|0))}if((ue|0)!=(Q|0)){if(!(YA(Q)|0)){if((H|0)!=0|(Ws(x,T)|0)!=5)break;o[L>>2]=(o[L>>2]|0)+1;break}switch(K&127){case 8:case 118:break e}(Ws(x,T)|0)!=3&&(o[L>>2]=(o[L>>2]|0)+1)}}else if((M|0)>0){j=0;do x=$o(x,T)|0,T=gt()|0,j=j+1|0;while((j|0)!=(M|0))}while(!1);return o[L>>2]=((o[L>>2]|0)+M|0)%6|0,Xe=T,tt=x,Dr(Xe|0),tt|0}function co(x,T,M,L){x=x|0,T=T|0,M=M|0,L=L|0;var j=0,H=0,Q=0,K=0,ue=0,Se=0,De=0,_t=0;if(_t=nt,nt=nt+16|0,De=_t,!M)return De=L,o[De>>2]=x,o[De+4>>2]=T,De=0,nt=_t,De|0;o[De>>2]=0;e:do if(Ns(x,T)|0)x=1;else{if(H=(M|0)>0,H){j=0,Se=x;do{if(Se=Wn(Se,T,4,De)|0,T=gt()|0,(Se|0)==0&(T|0)==0){x=2;break e}if(j=j+1|0,Ns(Se,T)|0){x=1;break e}}while((j|0)<(M|0));if(ue=L,o[ue>>2]=Se,o[ue+4>>2]=T,ue=M+-1|0,H){H=0,Q=1,j=Se,x=T;do{if(j=Wn(j,x,2,De)|0,x=gt()|0,(j|0)==0&(x|0)==0){x=2;break e}if(K=L+(Q<<3)|0,o[K>>2]=j,o[K+4>>2]=x,Q=Q+1|0,Ns(j,x)|0){x=1;break e}H=H+1|0}while((H|0)<(M|0));K=0,H=Q;do{if(j=Wn(j,x,3,De)|0,x=gt()|0,(j|0)==0&(x|0)==0){x=2;break e}if(Q=L+(H<<3)|0,o[Q>>2]=j,o[Q+4>>2]=x,H=H+1|0,Ns(j,x)|0){x=1;break e}K=K+1|0}while((K|0)<(M|0));Q=0;do{if(j=Wn(j,x,1,De)|0,x=gt()|0,(j|0)==0&(x|0)==0){x=2;break e}if(K=L+(H<<3)|0,o[K>>2]=j,o[K+4>>2]=x,H=H+1|0,Ns(j,x)|0){x=1;break e}Q=Q+1|0}while((Q|0)<(M|0));Q=0;do{if(j=Wn(j,x,5,De)|0,x=gt()|0,(j|0)==0&(x|0)==0){x=2;break e}if(K=L+(H<<3)|0,o[K>>2]=j,o[K+4>>2]=x,H=H+1|0,Ns(j,x)|0){x=1;break e}Q=Q+1|0}while((Q|0)<(M|0));Q=0;do{if(j=Wn(j,x,4,De)|0,x=gt()|0,(j|0)==0&(x|0)==0){x=2;break e}if(K=L+(H<<3)|0,o[K>>2]=j,o[K+4>>2]=x,H=H+1|0,Ns(j,x)|0){x=1;break e}Q=Q+1|0}while((Q|0)<(M|0));for(Q=0;;){if(j=Wn(j,x,6,De)|0,x=gt()|0,(j|0)==0&(x|0)==0){x=2;break e}if((Q|0)!=(ue|0))if(K=L+(H<<3)|0,o[K>>2]=j,o[K+4>>2]=x,!(Ns(j,x)|0))H=H+1|0;else{x=1;break e}if(Q=Q+1|0,(Q|0)>=(M|0)){Q=Se,H=T;break}}}else Q=Se,j=Se,H=T,x=T}else Q=L,o[Q>>2]=x,o[Q+4>>2]=T,Q=x,j=x,H=T,x=T;x=((Q|0)!=(j|0)|(H|0)!=(x|0))&1}while(!1);return De=x,nt=_t,De|0}function Ds(x,T){x=x|0,T=T|0;var M=0,L=0,j=0,H=0,Q=0,K=0;if(H=nt,nt=nt+48|0,j=H+8|0,L=H,K=x,Q=o[K+4>>2]|0,M=L,o[M>>2]=o[K>>2],o[M+4>>2]=Q,Vi(L,j),j=Yl(j,T)|0,T=o[L>>2]|0,L=o[x+8>>2]|0,(L|0)<=0)return K=T,Q=(j|0)<(K|0),K=Q?K:j,K=K+12|0,nt=H,K|0;M=o[x+12>>2]|0,x=0;do T=(o[M+(x<<3)>>2]|0)+T|0,x=x+1|0;while((x|0)<(L|0));return K=(j|0)<(T|0),K=K?T:j,K=K+12|0,nt=H,K|0}function Dl(x,T,M){x=x|0,T=T|0,M=M|0;var L=0,j=0,H=0,Q=0,K=0,ue=0;if(K=nt,nt=nt+48|0,L=K+8|0,j=K,!($A(x,T,M)|0)){nt=K;return}if(ue=x,H=o[ue+4>>2]|0,Q=j,o[Q>>2]=o[ue>>2],o[Q+4>>2]=H,Vi(j,L),Q=Yl(L,T)|0,T=o[j>>2]|0,H=o[x+8>>2]|0,(H|0)>0){j=o[x+12>>2]|0,L=0;do T=(o[j+(L<<3)>>2]|0)+T|0,L=L+1|0;while((L|0)!=(H|0))}if(T=(Q|0)<(T|0)?T:Q,(T|0)<=-12){nt=K;return}ue=T+11|0,tn(M|0,0,(((ue|0)>0?ue:0)<<3)+8|0)|0,nt=K}function $A(x,T,M){x=x|0,T=T|0,M=M|0;var L=0,j=0,H=0,Q=0,K=0,ue=0,Se=0,De=0,_t=0,Xe=0,tt=0,z=0,l=0,g=0,S=0,k=0,F=0,Z=0,u=0,h=0,f=0,y=0,b=0,I=0,R=0,V=0,W=0,Y=0,le=0,fe=0;if(fe=nt,nt=nt+112|0,V=fe+80|0,ue=fe+72|0,W=fe,Y=fe+56|0,Se=x+8|0,le=mo((o[Se>>2]<<5)+32|0)|0,le||Di(22848,22448,800,22456),Ro(x,le),H=x,L=o[H+4>>2]|0,K=ue,o[K>>2]=o[H>>2],o[K+4>>2]=L,Vi(ue,V),K=Yl(V,T)|0,L=o[ue>>2]|0,H=o[Se>>2]|0,(H|0)>0){Q=o[x+12>>2]|0,j=0;do L=(o[Q+(j<<3)>>2]|0)+L|0,j=j+1|0;while((j|0)!=(H|0))}if(K=(K|0)<(L|0)?L:K,R=K+12|0,j=Yo(R,8)|0,De=Yo(R,8)|0,o[V>>2]=0,b=x,I=o[b+4>>2]|0,L=ue,o[L>>2]=o[b>>2],o[L+4>>2]=I,L=XA(ue,R,T,V,j,De)|0,L|0)return mr(j),mr(De),mr(le),le=L,nt=fe,le|0;e:do if((o[Se>>2]|0)>0){for(H=x+12|0,L=0;Q=XA((o[H>>2]|0)+(L<<3)|0,R,T,V,j,De)|0,L=L+1|0,!(Q|0);)if((L|0)>=(o[Se>>2]|0))break e;return mr(j),mr(De),mr(le),le=Q,nt=fe,le|0}while(!1);(K|0)>-12&&tn(De|0,0,((R|0)>1?R:1)<<3|0)|0;e:do if((o[V>>2]|0)>0){I=((R|0)<0)<<31>>31,Z=j,u=De,h=j,f=j,y=De,b=j,L=j,g=j,S=De,k=De,F=De,j=De;t:for(;;){for(l=o[V>>2]|0,tt=0,z=0,H=0;;){Q=W,K=Q+56|0;do o[Q>>2]=0,Q=Q+4|0;while((Q|0)<(K|0));if(T=Z+(tt<<3)|0,ue=o[T>>2]|0,T=o[T+4>>2]|0,Qo(ue,T,1,W,0)|0){Q=W,K=Q+56|0;do o[Q>>2]=0,Q=Q+4|0;while((Q|0)<(K|0));Q=Yo(7,4)|0,Q|0&&(Fs(ue,T,1,W,Q,7,0),mr(Q))}Xe=0;do{_t=W+(Xe<<3)|0,De=o[_t>>2]|0,_t=o[_t+4>>2]|0;i:do if(!((De|0)==0&(_t|0)==0)){if(ue=Ea(De|0,_t|0,R|0,I|0)|0,gt()|0,Q=M+(ue<<3)|0,K=Q,T=o[K>>2]|0,K=o[K+4>>2]|0,!((T|0)==0&(K|0)==0))for(Se=0;;){if((Se|0)>(R|0))break t;if((T|0)==(De|0)&(K|0)==(_t|0))break i;if(ue=(ue+1|0)%(R|0)|0,Q=M+(ue<<3)|0,K=Q,T=o[K>>2]|0,K=o[K+4>>2]|0,(T|0)==0&(K|0)==0)break;Se=Se+1|0}(De|0)==0&(_t|0)==0||(fo(De,_t,Y),Za(x,le,Y)|0&&(Se=Q,o[Se>>2]=De,o[Se+4>>2]=_t,Se=u+(H<<3)|0,o[Se>>2]=De,o[Se+4>>2]=_t,H=H+1|0))}while(!1);Xe=Xe+1|0}while(Xe>>>0<7);if(z=z+1|0,(z|0)>=(l|0))break;tt=tt+1|0}if((l|0)>0&&tn(h|0,0,l<<3|0)|0,o[V>>2]=H,(H|0)>0)De=j,_t=F,Xe=b,tt=k,z=S,l=u,j=g,F=L,k=f,S=h,g=De,L=_t,b=y,y=Xe,f=tt,h=z,u=Z,Z=l;else break e}return mr(f),mr(y),mr(le),le=-1,nt=fe,le|0}else L=De;while(!1);return mr(le),mr(j),mr(L),le=0,nt=fe,le|0}function XA(x,T,M,L,j,H){x=x|0,T=T|0,M=M|0,L=L|0,j=j|0,H=H|0;var Q=0,K=0,ue=0,Se=0,De=0,_t=0,Xe=0,tt=0,z=0,l=0,g=0,S=0,k=0,F=0,Z=0,u=0,h=0,f=0,y=0,b=0,I=0,R=0,V=0;if(I=nt,nt=nt+48|0,h=I+32|0,f=I+16|0,y=I,Q=o[x>>2]|0,(Q|0)<=0)return b=0,nt=I,b|0;S=x+4|0,k=h+8|0,F=f+8|0,Z=y+8|0,u=((T|0)<0)<<31>>31,g=0;e:for(;;){K=o[S>>2]|0,z=K+(g<<4)|0,o[h>>2]=o[z>>2],o[h+4>>2]=o[z+4>>2],o[h+8>>2]=o[z+8>>2],o[h+12>>2]=o[z+12>>2],(g|0)==(Q+-1|0)?(o[f>>2]=o[K>>2],o[f+4>>2]=o[K+4>>2],o[f+8>>2]=o[K+8>>2],o[f+12>>2]=o[K+12>>2]):(z=K+(g+1<<4)|0,o[f>>2]=o[z>>2],o[f+4>>2]=o[z+4>>2],o[f+8>>2]=o[z+8>>2],o[f+12>>2]=o[z+12>>2]),z=Po(h,f,M)|0;t:do if((z|0)>0){l=+(z|0),tt=0;i:for(;;){V=+(z-tt|0),R=+(tt|0),oe[y>>3]=+oe[h>>3]*V/l+ +oe[f>>3]*R/l,oe[Z>>3]=+oe[k>>3]*V/l+ +oe[F>>3]*R/l,_t=Ua(y,M)|0,Xe=gt()|0,K=Ea(_t|0,Xe|0,T|0,u|0)|0,gt()|0,Q=H+(K<<3)|0,ue=Q,Se=o[ue>>2]|0,ue=o[ue+4>>2]|0;r:do if((Se|0)==0&(ue|0)==0)b=14;else for(De=0;;){if((De|0)>(T|0)){Q=1;break r}if((Se|0)==(_t|0)&(ue|0)==(Xe|0)){Q=7;break r}if(K=(K+1|0)%(T|0)|0,Q=H+(K<<3)|0,ue=Q,Se=o[ue>>2]|0,ue=o[ue+4>>2]|0,(Se|0)==0&(ue|0)==0){b=14;break}else De=De+1|0}while(!1);switch((b|0)==14&&(b=0,(_t|0)==0&(Xe|0)==0?Q=7:(o[Q>>2]=_t,o[Q+4>>2]=Xe,Q=o[L>>2]|0,De=j+(Q<<3)|0,o[De>>2]=_t,o[De+4>>2]=Xe,o[L>>2]=Q+1,Q=0)),Q&7){case 7:case 0:break;default:break i}if(tt=tt+1|0,(z|0)<=(tt|0)){b=8;break t}}if(Q|0){Q=-1,b=20;break e}}else b=8;while(!1);if((b|0)==8&&(b=0),g=g+1|0,Q=o[x>>2]|0,(g|0)>=(Q|0)){Q=0,b=20;break}}return(b|0)==20?(nt=I,Q|0):0}function Pl(x,T,M){x=x|0,T=T|0,M=M|0;var L=0,j=0,H=0,Q=0,K=0,ue=0,Se=0;if(Se=nt,nt=nt+176|0,ue=Se,(T|0)<1){Ji(M,0,0),nt=Se;return}Q=x,Q=Vt(o[Q>>2]|0,o[Q+4>>2]|0,52)|0,gt()|0,Ji(M,(T|0)>6?T:6,Q&15),Q=0;do{if(L=x+(Q<<3)|0,ba(o[L>>2]|0,o[L+4>>2]|0,ue),L=o[ue>>2]|0,(L|0)>0){K=0;do H=ue+8+(K<<4)|0,K=K+1|0,L=ue+8+(((K|0)%(L|0)|0)<<4)|0,j=nA(M,L,H)|0,j?rA(M,j)|0:oc(M,H,L)|0,L=o[ue>>2]|0;while((K|0)<(L|0))}Q=Q+1|0}while((Q|0)!=(T|0));nt=Se}function uA(x,T,M){x=x|0,T=T|0,M=M|0;var L=0,j=0,H=0,Q=0;if(H=nt,nt=nt+32|0,L=H,j=H+16|0,Pl(x,T,j),o[M>>2]=0,o[M+4>>2]=0,o[M+8>>2]=0,x=Ta(j)|0,!x){Lo(M)|0,To(j),nt=H;return}do{T=tc(M)|0;do gl(T,x)|0,Q=x+16|0,o[L>>2]=o[Q>>2],o[L+4>>2]=o[Q+4>>2],o[L+8>>2]=o[Q+8>>2],o[L+12>>2]=o[Q+12>>2],rA(j,x)|0,x=xl(j,L)|0;while(x|0);x=Ta(j)|0}while(x|0);Lo(M)|0,To(j),nt=H}function is(x){return x=x|0,o[7728+(x*28|0)+16>>2]|0}function YA(x){return x=x|0,(x|0)==4|(x|0)==117|0}function jn(x){return x=x|0,o[11152+((o[x>>2]|0)*216|0)+((o[x+4>>2]|0)*72|0)+((o[x+8>>2]|0)*24|0)+(o[x+12>>2]<<3)>>2]|0}function hA(x){return x=x|0,o[11152+((o[x>>2]|0)*216|0)+((o[x+4>>2]|0)*72|0)+((o[x+8>>2]|0)*24|0)+(o[x+12>>2]<<3)+4>>2]|0}function ei(x,T){x=x|0,T=T|0,x=7728+(x*28|0)|0,o[T>>2]=o[x>>2],o[T+4>>2]=o[x+4>>2],o[T+8>>2]=o[x+8>>2],o[T+12>>2]=o[x+12>>2]}function ir(x,T){x=x|0,T=T|0;var M=0,L=0;if(T>>>0>20)return T=-1,T|0;do if((o[11152+(T*216|0)>>2]|0)!=(x|0))if((o[11152+(T*216|0)+8>>2]|0)!=(x|0))if((o[11152+(T*216|0)+16>>2]|0)!=(x|0))if((o[11152+(T*216|0)+24>>2]|0)!=(x|0))if((o[11152+(T*216|0)+32>>2]|0)!=(x|0))if((o[11152+(T*216|0)+40>>2]|0)!=(x|0))if((o[11152+(T*216|0)+48>>2]|0)!=(x|0))if((o[11152+(T*216|0)+56>>2]|0)!=(x|0))if((o[11152+(T*216|0)+64>>2]|0)!=(x|0))if((o[11152+(T*216|0)+72>>2]|0)!=(x|0))if((o[11152+(T*216|0)+80>>2]|0)!=(x|0))if((o[11152+(T*216|0)+88>>2]|0)!=(x|0))if((o[11152+(T*216|0)+96>>2]|0)!=(x|0))if((o[11152+(T*216|0)+104>>2]|0)!=(x|0))if((o[11152+(T*216|0)+112>>2]|0)!=(x|0))if((o[11152+(T*216|0)+120>>2]|0)!=(x|0))if((o[11152+(T*216|0)+128>>2]|0)!=(x|0))if((o[11152+(T*216|0)+136>>2]|0)==(x|0))x=2,M=1,L=2;else{if((o[11152+(T*216|0)+144>>2]|0)==(x|0)){x=0,M=2,L=0;break}if((o[11152+(T*216|0)+152>>2]|0)==(x|0)){x=0,M=2,L=1;break}if((o[11152+(T*216|0)+160>>2]|0)==(x|0)){x=0,M=2,L=2;break}if((o[11152+(T*216|0)+168>>2]|0)==(x|0)){x=1,M=2,L=0;break}if((o[11152+(T*216|0)+176>>2]|0)==(x|0)){x=1,M=2,L=1;break}if((o[11152+(T*216|0)+184>>2]|0)==(x|0)){x=1,M=2,L=2;break}if((o[11152+(T*216|0)+192>>2]|0)==(x|0)){x=2,M=2,L=0;break}if((o[11152+(T*216|0)+200>>2]|0)==(x|0)){x=2,M=2,L=1;break}if((o[11152+(T*216|0)+208>>2]|0)==(x|0)){x=2,M=2,L=2;break}else x=-1;return x|0}else x=2,M=1,L=1;else x=2,M=1,L=0;else x=1,M=1,L=2;else x=1,M=1,L=1;else x=1,M=1,L=0;else x=0,M=1,L=2;else x=0,M=1,L=1;else x=0,M=1,L=0;else x=2,M=0,L=2;else x=2,M=0,L=1;else x=2,M=0,L=0;else x=1,M=0,L=2;else x=1,M=0,L=1;else x=1,M=0,L=0;else x=0,M=0,L=2;else x=0,M=0,L=1;else x=0,M=0,L=0;while(!1);return T=o[11152+(T*216|0)+(M*72|0)+(x*24|0)+(L<<3)+4>>2]|0,T|0}function rs(x,T){return x=x|0,T=T|0,(o[7728+(x*28|0)+20>>2]|0)==(T|0)?(T=1,T|0):(T=(o[7728+(x*28|0)+24>>2]|0)==(T|0),T|0)}function xt(x,T){return x=x|0,T=T|0,o[880+(x*28|0)+(T<<2)>>2]|0}function vi(x,T){return x=x|0,T=T|0,(o[880+(x*28|0)>>2]|0)==(T|0)?(T=0,T|0):(o[880+(x*28|0)+4>>2]|0)==(T|0)?(T=1,T|0):(o[880+(x*28|0)+8>>2]|0)==(T|0)?(T=2,T|0):(o[880+(x*28|0)+12>>2]|0)==(T|0)?(T=3,T|0):(o[880+(x*28|0)+16>>2]|0)==(T|0)?(T=4,T|0):(o[880+(x*28|0)+20>>2]|0)==(T|0)?(T=5,T|0):((o[880+(x*28|0)+24>>2]|0)==(T|0)?6:7)|0}function Do(){return 122}function Ho(x){x=x|0;var T=0,M=0,L=0;T=0;do Jt(T|0,0,45)|0,L=gt()|0|134225919,M=x+(T<<3)|0,o[M>>2]=-1,o[M+4>>2]=L,T=T+1|0;while((T|0)!=122)}function xn(x){return x=x|0,+oe[x+16>>3]<+oe[x+24>>3]|0}function ta(x,T){x=x|0,T=T|0;var M=0,L=0,j=0;return M=+oe[T>>3],!(M>=+oe[x+8>>3])||!(M<=+oe[x>>3])?(T=0,T|0):(L=+oe[x+16>>3],M=+oe[x+24>>3],j=+oe[T+8>>3],T=j>=M,x=j<=L&1,L<M?T&&(x=1):T||(x=0),T=(x|0)!=0,T|0)}function Yl(x,T){x=x|0,T=T|0;var M=0,L=0,j=0,H=0,Q=0,K=0,ue=0,Se=0;Q=nt,nt=nt+288|0,M=Q+264|0,L=Q+96|0,j=Q,H=j,K=H+96|0;do o[H>>2]=0,H=H+4|0;while((H|0)<(K|0));return nl(T,j),H=j,K=o[H>>2]|0,H=o[H+4>>2]|0,fo(K,H,M),ba(K,H,L),ue=+Rl(M,L+8|0),oe[M>>3]=+oe[x>>3],H=M+8|0,oe[H>>3]=+oe[x+16>>3],oe[L>>3]=+oe[x+8>>3],K=L+8|0,oe[K>>3]=+oe[x+24>>3],Se=+Rl(M,L),K=~~+Rs(+(Se*Se/+sA(+ +yi(+((+oe[H>>3]-+oe[K>>3])/(+oe[M>>3]-+oe[L>>3]))),3)/(ue*(ue*2.59807621135)*.8))),nt=Q,(K|0?K:1)|0}function Po(x,T,M){x=x|0,T=T|0,M=M|0;var L=0,j=0,H=0,Q=0,K=0,ue=0,Se=0;K=nt,nt=nt+288|0,L=K+264|0,j=K+96|0,H=K,Q=H,ue=Q+96|0;do o[Q>>2]=0,Q=Q+4|0;while((Q|0)<(ue|0));return nl(M,H),ue=H,Q=o[ue>>2]|0,ue=o[ue+4>>2]|0,fo(Q,ue,L),ba(Q,ue,j),Se=+Rl(L,j+8|0),ue=~~+Rs(+(+Rl(x,T)/(Se*2))),nt=K,(ue|0?ue:1)|0}function Kl(x,T,M,L){x=x|0,T=T|0,M=M|0,L=L|0,o[x>>2]=T,o[x+4>>2]=M,o[x+8>>2]=L}function dA(x,T){x=x|0,T=T|0;var M=0,L=0,j=0,H=0,Q=0,K=0,ue=0,Se=0,De=0,_t=0,Xe=0;_t=T+8|0,o[_t>>2]=0,ue=+oe[x>>3],Q=+yi(+ue),Se=+oe[x+8>>3],K=+yi(+Se)/.8660254037844386,Q=Q+K*.5,M=~~Q,x=~~K,Q=Q-+(M|0),K=K-+(x|0);do if(Q<.5)if(Q<.3333333333333333)if(o[T>>2]=M,K<(Q+1)*.5){o[T+4>>2]=x;break}else{x=x+1|0,o[T+4>>2]=x;break}else if(Xe=1-Q,x=(!(K<Xe)&1)+x|0,o[T+4>>2]=x,Xe<=K&K<Q*2){M=M+1|0,o[T>>2]=M;break}else{o[T>>2]=M;break}else{if(!(Q<.6666666666666666))if(M=M+1|0,o[T>>2]=M,K<Q*.5){o[T+4>>2]=x;break}else{x=x+1|0,o[T+4>>2]=x;break}if(K<1-Q){if(o[T+4>>2]=x,Q*2+-1<K){o[T>>2]=M;break}}else x=x+1|0,o[T+4>>2]=x;M=M+1|0,o[T>>2]=M}while(!1);do if(ue<0)if(x&1){De=(x+1|0)/2|0,De=Ol(M|0,((M|0)<0)<<31>>31|0,De|0,((De|0)<0)<<31>>31|0)|0,M=~~(+(M|0)-((+(De>>>0)+4294967296*+(gt()|0))*2+1)),o[T>>2]=M;break}else{De=(x|0)/2|0,De=Ol(M|0,((M|0)<0)<<31>>31|0,De|0,((De|0)<0)<<31>>31|0)|0,M=~~(+(M|0)-(+(De>>>0)+4294967296*+(gt()|0))*2),o[T>>2]=M;break}while(!1);De=T+4|0,Se<0&&(M=M-((x<<1|1|0)/2|0)|0,o[T>>2]=M,x=0-x|0,o[De>>2]=x),L=x-M|0,(M|0)<0?(j=0-M|0,o[De>>2]=L,o[_t>>2]=j,o[T>>2]=0,x=L,M=0):j=0,(x|0)<0&&(M=M-x|0,o[T>>2]=M,j=j-x|0,o[_t>>2]=j,o[De>>2]=0,x=0),H=M-j|0,L=x-j|0,(j|0)<0&&(o[T>>2]=H,o[De>>2]=L,o[_t>>2]=0,x=L,M=H,j=0),L=(x|0)<(M|0)?x:M,L=(j|0)<(L|0)?j:L,!((L|0)<=0)&&(o[T>>2]=M-L,o[De>>2]=x-L,o[_t>>2]=j-L)}function $n(x){x=x|0;var T=0,M=0,L=0,j=0,H=0,Q=0;T=o[x>>2]|0,Q=x+4|0,M=o[Q>>2]|0,(T|0)<0&&(M=M-T|0,o[Q>>2]=M,H=x+8|0,o[H>>2]=(o[H>>2]|0)-T,o[x>>2]=0,T=0),(M|0)<0?(T=T-M|0,o[x>>2]=T,H=x+8|0,j=(o[H>>2]|0)-M|0,o[H>>2]=j,o[Q>>2]=0,M=0):(j=x+8|0,H=j,j=o[j>>2]|0),(j|0)<0&&(T=T-j|0,o[x>>2]=T,M=M-j|0,o[Q>>2]=M,o[H>>2]=0,j=0),L=(M|0)<(T|0)?M:T,L=(j|0)<(L|0)?j:L,!((L|0)<=0)&&(o[x>>2]=T-L,o[Q>>2]=M-L,o[H>>2]=j-L)}function Ht(x,T){x=x|0,T=T|0;var M=0,L=0;L=o[x+8>>2]|0,M=+((o[x+4>>2]|0)-L|0),oe[T>>3]=+((o[x>>2]|0)-L|0)-M*.5,oe[T+8>>3]=M*.8660254037844386}function ji(x,T,M){x=x|0,T=T|0,M=M|0,o[M>>2]=(o[T>>2]|0)+(o[x>>2]|0),o[M+4>>2]=(o[T+4>>2]|0)+(o[x+4>>2]|0),o[M+8>>2]=(o[T+8>>2]|0)+(o[x+8>>2]|0)}function ar(x,T,M){x=x|0,T=T|0,M=M|0,o[M>>2]=(o[x>>2]|0)-(o[T>>2]|0),o[M+4>>2]=(o[x+4>>2]|0)-(o[T+4>>2]|0),o[M+8>>2]=(o[x+8>>2]|0)-(o[T+8>>2]|0)}function sn(x,T){x=x|0,T=T|0;var M=0,L=0;M=ko(o[x>>2]|0,T)|0,o[x>>2]=M,M=x+4|0,L=ko(o[M>>2]|0,T)|0,o[M>>2]=L,x=x+8|0,T=ko(o[x>>2]|0,T)|0,o[x>>2]=T}function ia(x){x=x|0;var T=0,M=0,L=0,j=0,H=0,Q=0,K=0;Q=o[x>>2]|0,K=(Q|0)<0,L=(o[x+4>>2]|0)-(K?Q:0)|0,H=(L|0)<0,j=(H?0-L|0:0)+((o[x+8>>2]|0)-(K?Q:0))|0,M=(j|0)<0,x=M?0:j,T=(H?0:L)-(M?j:0)|0,j=(K?0:Q)-(H?L:0)-(M?j:0)|0,M=(T|0)<(j|0)?T:j,M=(x|0)<(M|0)?x:M,L=(M|0)>0,x=x-(L?M:0)|0,T=T-(L?M:0)|0;e:do switch(j-(L?M:0)|0){case 0:switch(T|0){case 0:return K=x|0?(x|0)==1?1:7:0,K|0;case 1:return K=x|0?(x|0)==1?3:7:2,K|0;default:break e}case 1:switch(T|0){case 0:return K=x|0?(x|0)==1?5:7:4,K|0;case 1:{if(!x)x=6;else break e;return x|0}default:break e}}while(!1);return K=7,K|0}function Pr(x){x=x|0;var T=0,M=0,L=0,j=0,H=0,Q=0,K=0;Q=x+8|0,M=o[Q>>2]|0,T=(o[x>>2]|0)-M|0,K=x+4|0,M=(o[K>>2]|0)-M|0,L=Gn(+((T*3|0)-M|0)/7)|0,o[x>>2]=L,T=Gn(+((M<<1)+T|0)/7)|0,o[K>>2]=T,o[Q>>2]=0,M=T-L|0,(L|0)<0?(H=0-L|0,o[K>>2]=M,o[Q>>2]=H,o[x>>2]=0,T=M,L=0,M=H):M=0,(T|0)<0&&(L=L-T|0,o[x>>2]=L,M=M-T|0,o[Q>>2]=M,o[K>>2]=0,T=0),H=L-M|0,j=T-M|0,(M|0)<0?(o[x>>2]=H,o[K>>2]=j,o[Q>>2]=0,T=j,j=H,M=0):j=L,L=(T|0)<(j|0)?T:j,L=(M|0)<(L|0)?M:L,!((L|0)<=0)&&(o[x>>2]=j-L,o[K>>2]=T-L,o[Q>>2]=M-L)}function ma(x){x=x|0;var T=0,M=0,L=0,j=0,H=0,Q=0,K=0;Q=x+8|0,M=o[Q>>2]|0,T=(o[x>>2]|0)-M|0,K=x+4|0,M=(o[K>>2]|0)-M|0,L=Gn(+((T<<1)+M|0)/7)|0,o[x>>2]=L,T=Gn(+((M*3|0)-T|0)/7)|0,o[K>>2]=T,o[Q>>2]=0,M=T-L|0,(L|0)<0?(H=0-L|0,o[K>>2]=M,o[Q>>2]=H,o[x>>2]=0,T=M,L=0,M=H):M=0,(T|0)<0&&(L=L-T|0,o[x>>2]=L,M=M-T|0,o[Q>>2]=M,o[K>>2]=0,T=0),H=L-M|0,j=T-M|0,(M|0)<0?(o[x>>2]=H,o[K>>2]=j,o[Q>>2]=0,T=j,j=H,M=0):j=L,L=(T|0)<(j|0)?T:j,L=(M|0)<(L|0)?M:L,!((L|0)<=0)&&(o[x>>2]=j-L,o[K>>2]=T-L,o[Q>>2]=M-L)}function Ja(x){x=x|0;var T=0,M=0,L=0,j=0,H=0,Q=0,K=0;T=o[x>>2]|0,Q=x+4|0,M=o[Q>>2]|0,K=x+8|0,L=o[K>>2]|0,j=M+(T*3|0)|0,o[x>>2]=j,M=L+(M*3|0)|0,o[Q>>2]=M,T=(L*3|0)+T|0,o[K>>2]=T,L=M-j|0,(j|0)<0?(T=T-j|0,o[Q>>2]=L,o[K>>2]=T,o[x>>2]=0,M=L,L=0):L=j,(M|0)<0&&(L=L-M|0,o[x>>2]=L,T=T-M|0,o[K>>2]=T,o[Q>>2]=0,M=0),H=L-T|0,j=M-T|0,(T|0)<0?(o[x>>2]=H,o[Q>>2]=j,o[K>>2]=0,L=H,T=0):j=M,M=(j|0)<(L|0)?j:L,M=(T|0)<(M|0)?T:M,!((M|0)<=0)&&(o[x>>2]=L-M,o[Q>>2]=j-M,o[K>>2]=T-M)}function ra(x){x=x|0;var T=0,M=0,L=0,j=0,H=0,Q=0,K=0;j=o[x>>2]|0,Q=x+4|0,T=o[Q>>2]|0,K=x+8|0,M=o[K>>2]|0,L=(T*3|0)+j|0,j=M+(j*3|0)|0,o[x>>2]=j,o[Q>>2]=L,T=(M*3|0)+T|0,o[K>>2]=T,M=L-j|0,(j|0)<0?(T=T-j|0,o[Q>>2]=M,o[K>>2]=T,o[x>>2]=0,j=0):M=L,(M|0)<0&&(j=j-M|0,o[x>>2]=j,T=T-M|0,o[K>>2]=T,o[Q>>2]=0,M=0),H=j-T|0,L=M-T|0,(T|0)<0?(o[x>>2]=H,o[Q>>2]=L,o[K>>2]=0,j=H,T=0):L=M,M=(L|0)<(j|0)?L:j,M=(T|0)<(M|0)?T:M,!((M|0)<=0)&&(o[x>>2]=j-M,o[Q>>2]=L-M,o[K>>2]=T-M)}function no(x,T){x=x|0,T=T|0;var M=0,L=0,j=0,H=0,Q=0,K=0;(T+-1|0)>>>0>=6||(j=(o[15472+(T*12|0)>>2]|0)+(o[x>>2]|0)|0,o[x>>2]=j,K=x+4|0,L=(o[15472+(T*12|0)+4>>2]|0)+(o[K>>2]|0)|0,o[K>>2]=L,Q=x+8|0,T=(o[15472+(T*12|0)+8>>2]|0)+(o[Q>>2]|0)|0,o[Q>>2]=T,M=L-j|0,(j|0)<0?(T=T-j|0,o[K>>2]=M,o[Q>>2]=T,o[x>>2]=0,L=0):(M=L,L=j),(M|0)<0&&(L=L-M|0,o[x>>2]=L,T=T-M|0,o[Q>>2]=T,o[K>>2]=0,M=0),H=L-T|0,j=M-T|0,(T|0)<0?(o[x>>2]=H,o[K>>2]=j,o[Q>>2]=0,L=H,T=0):j=M,M=(j|0)<(L|0)?j:L,M=(T|0)<(M|0)?T:M,!((M|0)<=0)&&(o[x>>2]=L-M,o[K>>2]=j-M,o[Q>>2]=T-M))}function Xn(x){x=x|0;var T=0,M=0,L=0,j=0,H=0,Q=0,K=0;j=o[x>>2]|0,Q=x+4|0,T=o[Q>>2]|0,K=x+8|0,M=o[K>>2]|0,L=T+j|0,j=M+j|0,o[x>>2]=j,o[Q>>2]=L,T=M+T|0,o[K>>2]=T,M=L-j|0,(j|0)<0?(T=T-j|0,o[Q>>2]=M,o[K>>2]=T,o[x>>2]=0,L=0):(M=L,L=j),(M|0)<0&&(L=L-M|0,o[x>>2]=L,T=T-M|0,o[K>>2]=T,o[Q>>2]=0,M=0),H=L-T|0,j=M-T|0,(T|0)<0?(o[x>>2]=H,o[Q>>2]=j,o[K>>2]=0,L=H,T=0):j=M,M=(j|0)<(L|0)?j:L,M=(T|0)<(M|0)?T:M,!((M|0)<=0)&&(o[x>>2]=L-M,o[Q>>2]=j-M,o[K>>2]=T-M)}function fl(x){x=x|0;var T=0,M=0,L=0,j=0,H=0,Q=0,K=0;T=o[x>>2]|0,Q=x+4|0,L=o[Q>>2]|0,K=x+8|0,M=o[K>>2]|0,j=L+T|0,o[x>>2]=j,L=M+L|0,o[Q>>2]=L,T=M+T|0,o[K>>2]=T,M=L-j|0,(j|0)<0?(T=T-j|0,o[Q>>2]=M,o[K>>2]=T,o[x>>2]=0,L=0):(M=L,L=j),(M|0)<0&&(L=L-M|0,o[x>>2]=L,T=T-M|0,o[K>>2]=T,o[Q>>2]=0,M=0),H=L-T|0,j=M-T|0,(T|0)<0?(o[x>>2]=H,o[Q>>2]=j,o[K>>2]=0,L=H,T=0):j=M,M=(j|0)<(L|0)?j:L,M=(T|0)<(M|0)?T:M,!((M|0)<=0)&&(o[x>>2]=L-M,o[Q>>2]=j-M,o[K>>2]=T-M)}function Os(x){switch(x=x|0,x|0){case 1:{x=5;break}case 5:{x=4;break}case 4:{x=6;break}case 6:{x=2;break}case 2:{x=3;break}case 3:{x=1;break}}return x|0}function _a(x){switch(x=x|0,x|0){case 1:{x=3;break}case 3:{x=2;break}case 2:{x=6;break}case 6:{x=4;break}case 4:{x=5;break}case 5:{x=1;break}}return x|0}function zl(x){x=x|0;var T=0,M=0,L=0,j=0,H=0,Q=0,K=0;T=o[x>>2]|0,Q=x+4|0,M=o[Q>>2]|0,K=x+8|0,L=o[K>>2]|0,j=M+(T<<1)|0,o[x>>2]=j,M=L+(M<<1)|0,o[Q>>2]=M,T=(L<<1)+T|0,o[K>>2]=T,L=M-j|0,(j|0)<0?(T=T-j|0,o[Q>>2]=L,o[K>>2]=T,o[x>>2]=0,M=L,L=0):L=j,(M|0)<0&&(L=L-M|0,o[x>>2]=L,T=T-M|0,o[K>>2]=T,o[Q>>2]=0,M=0),H=L-T|0,j=M-T|0,(T|0)<0?(o[x>>2]=H,o[Q>>2]=j,o[K>>2]=0,L=H,T=0):j=M,M=(j|0)<(L|0)?j:L,M=(T|0)<(M|0)?T:M,!((M|0)<=0)&&(o[x>>2]=L-M,o[Q>>2]=j-M,o[K>>2]=T-M)}function ga(x){x=x|0;var T=0,M=0,L=0,j=0,H=0,Q=0,K=0;j=o[x>>2]|0,Q=x+4|0,T=o[Q>>2]|0,K=x+8|0,M=o[K>>2]|0,L=(T<<1)+j|0,j=M+(j<<1)|0,o[x>>2]=j,o[Q>>2]=L,T=(M<<1)+T|0,o[K>>2]=T,M=L-j|0,(j|0)<0?(T=T-j|0,o[Q>>2]=M,o[K>>2]=T,o[x>>2]=0,j=0):M=L,(M|0)<0&&(j=j-M|0,o[x>>2]=j,T=T-M|0,o[K>>2]=T,o[Q>>2]=0,M=0),H=j-T|0,L=M-T|0,(T|0)<0?(o[x>>2]=H,o[Q>>2]=L,o[K>>2]=0,j=H,T=0):L=M,M=(L|0)<(j|0)?L:j,M=(T|0)<(M|0)?T:M,!((M|0)<=0)&&(o[x>>2]=j-M,o[Q>>2]=L-M,o[K>>2]=T-M)}function el(x,T){x=x|0,T=T|0;var M=0,L=0,j=0,H=0,Q=0,K=0;return Q=(o[x>>2]|0)-(o[T>>2]|0)|0,K=(Q|0)<0,L=(o[x+4>>2]|0)-(o[T+4>>2]|0)-(K?Q:0)|0,H=(L|0)<0,j=(K?0-Q|0:0)+(o[x+8>>2]|0)-(o[T+8>>2]|0)+(H?0-L|0:0)|0,x=(j|0)<0,T=x?0:j,M=(H?0:L)-(x?j:0)|0,j=(K?0:Q)-(H?L:0)-(x?j:0)|0,x=(M|0)<(j|0)?M:j,x=(T|0)<(x|0)?T:x,L=(x|0)>0,T=T-(L?x:0)|0,M=M-(L?x:0)|0,x=j-(L?x:0)|0,x=(x|0)>-1?x:0-x|0,M=(M|0)>-1?M:0-M|0,T=(T|0)>-1?T:0-T|0,T=(M|0)>(T|0)?M:T,((x|0)>(T|0)?x:T)|0}function Fa(x,T){x=x|0,T=T|0;var M=0;M=o[x+8>>2]|0,o[T>>2]=(o[x>>2]|0)-M,o[T+4>>2]=(o[x+4>>2]|0)-M}function KA(x,T){x=x|0,T=T|0;var M=0,L=0,j=0,H=0,Q=0,K=0;L=o[x>>2]|0,o[T>>2]=L,x=o[x+4>>2]|0,Q=T+4|0,o[Q>>2]=x,K=T+8|0,o[K>>2]=0,M=x-L|0,(L|0)<0?(x=0-L|0,o[Q>>2]=M,o[K>>2]=x,o[T>>2]=0,L=0):(M=x,x=0),(M|0)<0&&(L=L-M|0,o[T>>2]=L,x=x-M|0,o[K>>2]=x,o[Q>>2]=0,M=0),H=L-x|0,j=M-x|0,(x|0)<0?(o[T>>2]=H,o[Q>>2]=j,o[K>>2]=0,M=j,j=H,x=0):j=L,L=(M|0)<(j|0)?M:j,L=(x|0)<(L|0)?x:L,!((L|0)<=0)&&(o[T>>2]=j-L,o[Q>>2]=M-L,o[K>>2]=x-L)}function fA(x){x=x|0;var T=0,M=0,L=0,j=0;T=x+8|0,j=o[T>>2]|0,M=j-(o[x>>2]|0)|0,o[x>>2]=M,L=x+4|0,x=(o[L>>2]|0)-j|0,o[L>>2]=x,o[T>>2]=0-(x+M)}function PA(x){x=x|0;var T=0,M=0,L=0,j=0,H=0,Q=0,K=0;M=o[x>>2]|0,T=0-M|0,o[x>>2]=T,Q=x+8|0,o[Q>>2]=0,K=x+4|0,L=o[K>>2]|0,j=L+M|0,(M|0)>0?(o[K>>2]=j,o[Q>>2]=M,o[x>>2]=0,T=0,L=j):M=0,(L|0)<0?(H=T-L|0,o[x>>2]=H,M=M-L|0,o[Q>>2]=M,o[K>>2]=0,j=H-M|0,T=0-M|0,(M|0)<0?(o[x>>2]=j,o[K>>2]=T,o[Q>>2]=0,L=T,M=0):(L=0,j=H)):j=T,T=(L|0)<(j|0)?L:j,T=(M|0)<(T|0)?M:T,!((T|0)<=0)&&(o[x>>2]=j-T,o[K>>2]=L-T,o[Q>>2]=M-T)}function Wo(x,T,M){x=x|0,T=T|0,M=M|0;var L=0,j=0;L=nt,nt=nt+16|0,j=L,pr(x,T,M,j),dA(j,M+4|0),nt=L}function pr(x,T,M,L){x=x|0,T=T|0,M=M|0,L=L|0;var j=0,H=0,Q=0,K=0,ue=0;if(ue=nt,nt=nt+32|0,H=ue,gA(x,H),o[M>>2]=0,j=+Ms(15888,H),Q=+Ms(15912,H),Q<j&&(o[M>>2]=1,j=Q),Q=+Ms(15936,H),Q<j&&(o[M>>2]=2,j=Q),Q=+Ms(15960,H),Q<j&&(o[M>>2]=3,j=Q),Q=+Ms(15984,H),Q<j&&(o[M>>2]=4,j=Q),Q=+Ms(16008,H),Q<j&&(o[M>>2]=5,j=Q),Q=+Ms(16032,H),Q<j&&(o[M>>2]=6,j=Q),Q=+Ms(16056,H),Q<j&&(o[M>>2]=7,j=Q),Q=+Ms(16080,H),Q<j&&(o[M>>2]=8,j=Q),Q=+Ms(16104,H),Q<j&&(o[M>>2]=9,j=Q),Q=+Ms(16128,H),Q<j&&(o[M>>2]=10,j=Q),Q=+Ms(16152,H),Q<j&&(o[M>>2]=11,j=Q),Q=+Ms(16176,H),Q<j&&(o[M>>2]=12,j=Q),Q=+Ms(16200,H),Q<j&&(o[M>>2]=13,j=Q),Q=+Ms(16224,H),Q<j&&(o[M>>2]=14,j=Q),Q=+Ms(16248,H),Q<j&&(o[M>>2]=15,j=Q),Q=+Ms(16272,H),Q<j&&(o[M>>2]=16,j=Q),Q=+Ms(16296,H),Q<j&&(o[M>>2]=17,j=Q),Q=+Ms(16320,H),Q<j&&(o[M>>2]=18,j=Q),Q=+Ms(16344,H),Q<j&&(o[M>>2]=19,j=Q),Q=+fn(+(1-j*.5)),Q<1e-16){o[L>>2]=0,o[L+4>>2]=0,o[L+8>>2]=0,o[L+12>>2]=0,nt=ue;return}if(M=o[M>>2]|0,j=+oe[16368+(M*24|0)>>3],j=+Ll(j-+Ll(+Gr(15568+(M<<4)|0,x))),Rn(T)|0?K=+Ll(j+-.3334731722518321):K=j,j=+zi(+Q)/.381966011250105,(T|0)>0){H=0;do j=j*2.6457513110645907,H=H+1|0;while((H|0)!=(T|0))}Q=+gr(+K)*j,oe[L>>3]=Q,K=+bi(+K)*j,oe[L+8>>3]=K,nt=ue}function Oa(x,T,M,L,j){x=x|0,T=T|0,M=M|0,L=L|0,j=j|0;var H=0,Q=0;if(H=+nc(x),H<1e-16){T=15568+(T<<4)|0,o[j>>2]=o[T>>2],o[j+4>>2]=o[T+4>>2],o[j+8>>2]=o[T+8>>2],o[j+12>>2]=o[T+12>>2];return}if(Q=+Ls(+ +oe[x+8>>3],+ +oe[x>>3]),(M|0)>0){x=0;do H=H/2.6457513110645907,x=x+1|0;while((x|0)!=(M|0))}L?(H=H/3,M=(Rn(M)|0)==0,H=+HA(+((M?H:H/2.6457513110645907)*.381966011250105))):(H=+HA(+(H*.381966011250105)),Rn(M)|0&&(Q=+Ll(Q+.3334731722518321))),Yn(15568+(T<<4)|0,+Ll(+oe[16368+(T*24|0)>>3]-Q),H,j)}function zA(x,T,M){x=x|0,T=T|0,M=M|0;var L=0,j=0;L=nt,nt=nt+16|0,j=L,Ht(x+4|0,j),Oa(j,o[x>>2]|0,T,0,M),nt=L}function uo(x,T,M,L,j){x=x|0,T=T|0,M=M|0,L=L|0,j=j|0;var H=0,Q=0,K=0,ue=0,Se=0,De=0,_t=0,Xe=0,tt=0,z=0,l=0,g=0,S=0,k=0,F=0,Z=0,u=0,h=0,f=0,y=0,b=0,I=0,R=0,V=0,W=0,Y=0,le=0,fe=0;if(Y=nt,nt=nt+272|0,H=Y+256|0,k=Y+240|0,R=Y,V=Y+224|0,W=Y+208|0,F=Y+176|0,Z=Y+160|0,u=Y+192|0,h=Y+144|0,f=Y+128|0,y=Y+112|0,b=Y+96|0,I=Y+80|0,o[H>>2]=T,o[k>>2]=o[x>>2],o[k+4>>2]=o[x+4>>2],o[k+8>>2]=o[x+8>>2],o[k+12>>2]=o[x+12>>2],so(k,H,R),o[j>>2]=0,k=L+M+((L|0)==5&1)|0,(k|0)<=(M|0)){nt=Y;return}ue=o[H>>2]|0,Se=V+4|0,De=F+4|0,_t=M+5|0,Xe=16848+(ue<<2)|0,tt=16928+(ue<<2)|0,z=f+8|0,l=y+8|0,g=b+8|0,S=W+4|0,K=M;e:for(;;){Q=R+(((K|0)%5|0)<<4)|0,o[W>>2]=o[Q>>2],o[W+4>>2]=o[Q+4>>2],o[W+8>>2]=o[Q+8>>2],o[W+12>>2]=o[Q+12>>2];do;while((Bl(W,ue,0,1)|0)==2);if((K|0)>(M|0)&(Rn(T)|0)!=0){if(o[F>>2]=o[W>>2],o[F+4>>2]=o[W+4>>2],o[F+8>>2]=o[W+8>>2],o[F+12>>2]=o[W+12>>2],Ht(Se,Z),L=o[F>>2]|0,H=o[17008+(L*80|0)+(o[V>>2]<<2)>>2]|0,o[F>>2]=o[18608+(L*80|0)+(H*20|0)>>2],Q=o[18608+(L*80|0)+(H*20|0)+16>>2]|0,(Q|0)>0){x=0;do Xn(De),x=x+1|0;while((x|0)<(Q|0))}switch(Q=18608+(L*80|0)+(H*20|0)+4|0,o[u>>2]=o[Q>>2],o[u+4>>2]=o[Q+4>>2],o[u+8>>2]=o[Q+8>>2],sn(u,(o[Xe>>2]|0)*3|0),ji(De,u,De),$n(De),Ht(De,h),le=+(o[tt>>2]|0),oe[f>>3]=le*3,oe[z>>3]=0,fe=le*-1.5,oe[y>>3]=fe,oe[l>>3]=le*2.598076211353316,oe[b>>3]=fe,oe[g>>3]=le*-2.598076211353316,o[17008+((o[F>>2]|0)*80|0)+(o[W>>2]<<2)>>2]|0){case 1:{x=y,L=f;break}case 3:{x=b,L=y;break}case 2:{x=f,L=b;break}default:{x=12;break e}}VA(Z,h,L,x,I),Oa(I,o[F>>2]|0,ue,1,j+8+(o[j>>2]<<4)|0),o[j>>2]=(o[j>>2]|0)+1}if((K|0)<(_t|0)&&(Ht(S,F),Oa(F,o[W>>2]|0,ue,1,j+8+(o[j>>2]<<4)|0),o[j>>2]=(o[j>>2]|0)+1),o[V>>2]=o[W>>2],o[V+4>>2]=o[W+4>>2],o[V+8>>2]=o[W+8>>2],o[V+12>>2]=o[W+12>>2],K=K+1|0,(K|0)>=(k|0)){x=3;break}}if((x|0)==3){nt=Y;return}else(x|0)==12&&Di(22474,22521,581,22531)}function so(x,T,M){x=x|0,T=T|0,M=M|0;var L=0,j=0,H=0,Q=0,K=0,ue=0;ue=nt,nt=nt+128|0,L=ue+64|0,j=ue,H=L,Q=20208,K=H+60|0;do o[H>>2]=o[Q>>2],H=H+4|0,Q=Q+4|0;while((H|0)<(K|0));H=j,Q=20272,K=H+60|0;do o[H>>2]=o[Q>>2],H=H+4|0,Q=Q+4|0;while((H|0)<(K|0));K=(Rn(o[T>>2]|0)|0)==0,L=K?L:j,j=x+4|0,zl(j),ga(j),Rn(o[T>>2]|0)|0&&(ra(j),o[T>>2]=(o[T>>2]|0)+1),o[M>>2]=o[x>>2],T=M+4|0,ji(j,L,T),$n(T),o[M+16>>2]=o[x>>2],T=M+20|0,ji(j,L+12|0,T),$n(T),o[M+32>>2]=o[x>>2],T=M+36|0,ji(j,L+24|0,T),$n(T),o[M+48>>2]=o[x>>2],T=M+52|0,ji(j,L+36|0,T),$n(T),o[M+64>>2]=o[x>>2],M=M+68|0,ji(j,L+48|0,M),$n(M),nt=ue}function Bl(x,T,M,L){x=x|0,T=T|0,M=M|0,L=L|0;var j=0,H=0,Q=0,K=0,ue=0,Se=0,De=0,_t=0,Xe=0,tt=0,z=0;if(z=nt,nt=nt+32|0,Xe=z+12|0,K=z,tt=x+4|0,_t=o[16928+(T<<2)>>2]|0,De=(L|0)!=0,_t=De?_t*3|0:_t,j=o[tt>>2]|0,Se=x+8|0,Q=o[Se>>2]|0,De){if(H=x+12|0,L=o[H>>2]|0,j=Q+j+L|0,(j|0)==(_t|0))return tt=1,nt=z,tt|0;ue=H}else ue=x+12|0,L=o[ue>>2]|0,j=Q+j+L|0;if((j|0)<=(_t|0))return tt=0,nt=z,tt|0;do if((L|0)>0){if(L=o[x>>2]|0,(Q|0)>0){H=18608+(L*80|0)+60|0,L=x;break}L=18608+(L*80|0)+40|0,M?(Kl(Xe,_t,0,0),ar(tt,Xe,K),fl(K),ji(K,Xe,tt),H=L,L=x):(H=L,L=x)}else H=18608+((o[x>>2]|0)*80|0)+20|0,L=x;while(!1);if(o[L>>2]=o[H>>2],j=H+16|0,(o[j>>2]|0)>0){L=0;do Xn(tt),L=L+1|0;while((L|0)<(o[j>>2]|0))}return x=H+4|0,o[Xe>>2]=o[x>>2],o[Xe+4>>2]=o[x+4>>2],o[Xe+8>>2]=o[x+8>>2],T=o[16848+(T<<2)>>2]|0,sn(Xe,De?T*3|0:T),ji(tt,Xe,tt),$n(tt),De?L=((o[Se>>2]|0)+(o[tt>>2]|0)+(o[ue>>2]|0)|0)==(_t|0)?1:2:L=2,tt=L,nt=z,tt|0}function Jl(x,T){x=x|0,T=T|0;var M=0;do M=Bl(x,T,0,1)|0;while((M|0)==2);return M|0}function hs(x,T,M,L,j){x=x|0,T=T|0,M=M|0,L=L|0,j=j|0;var H=0,Q=0,K=0,ue=0,Se=0,De=0,_t=0,Xe=0,tt=0,z=0,l=0,g=0,S=0,k=0,F=0,Z=0,u=0,h=0,f=0,y=0,b=0,I=0,R=0;if(b=nt,nt=nt+240|0,H=b+224|0,u=b+208|0,h=b,f=b+192|0,y=b+176|0,g=b+160|0,S=b+144|0,k=b+128|0,F=b+112|0,Z=b+96|0,o[H>>2]=T,o[u>>2]=o[x>>2],o[u+4>>2]=o[x+4>>2],o[u+8>>2]=o[x+8>>2],o[u+12>>2]=o[x+12>>2],ya(u,H,h),o[j>>2]=0,l=L+M+((L|0)==6&1)|0,(l|0)<=(M|0)){nt=b;return}ue=o[H>>2]|0,Se=M+6|0,De=16928+(ue<<2)|0,_t=S+8|0,Xe=k+8|0,tt=F+8|0,z=f+4|0,Q=0,K=M,L=-1;e:for(;;){if(H=(K|0)%6|0,x=h+(H<<4)|0,o[f>>2]=o[x>>2],o[f+4>>2]=o[x+4>>2],o[f+8>>2]=o[x+8>>2],o[f+12>>2]=o[x+12>>2],x=Q,Q=Bl(f,ue,0,1)|0,(K|0)>(M|0)&(Rn(T)|0)!=0&&(x|0)!=1&&(o[f>>2]|0)!=(L|0)){switch(Ht(h+(((H+5|0)%6|0)<<4)+4|0,y),Ht(h+(H<<4)+4|0,g),I=+(o[De>>2]|0),oe[S>>3]=I*3,oe[_t>>3]=0,R=I*-1.5,oe[k>>3]=R,oe[Xe>>3]=I*2.598076211353316,oe[F>>3]=R,oe[tt>>3]=I*-2.598076211353316,H=o[u>>2]|0,o[17008+(H*80|0)+(((L|0)==(H|0)?o[f>>2]|0:L)<<2)>>2]|0){case 1:{x=k,L=S;break}case 3:{x=F,L=k;break}case 2:{x=S,L=F;break}default:{x=8;break e}}VA(y,g,L,x,Z),!(sc(y,Z)|0)&&!(sc(g,Z)|0)&&(Oa(Z,o[u>>2]|0,ue,1,j+8+(o[j>>2]<<4)|0),o[j>>2]=(o[j>>2]|0)+1)}if((K|0)<(Se|0)&&(Ht(z,y),Oa(y,o[f>>2]|0,ue,1,j+8+(o[j>>2]<<4)|0),o[j>>2]=(o[j>>2]|0)+1),K=K+1|0,(K|0)>=(l|0)){x=3;break}else L=o[f>>2]|0}if((x|0)==3){nt=b;return}else(x|0)==8&&Di(22557,22521,746,22602)}function ya(x,T,M){x=x|0,T=T|0,M=M|0;var L=0,j=0,H=0,Q=0,K=0,ue=0;ue=nt,nt=nt+160|0,L=ue+80|0,j=ue,H=L,Q=20336,K=H+72|0;do o[H>>2]=o[Q>>2],H=H+4|0,Q=Q+4|0;while((H|0)<(K|0));H=j,Q=20416,K=H+72|0;do o[H>>2]=o[Q>>2],H=H+4|0,Q=Q+4|0;while((H|0)<(K|0));K=(Rn(o[T>>2]|0)|0)==0,L=K?L:j,j=x+4|0,zl(j),ga(j),Rn(o[T>>2]|0)|0&&(ra(j),o[T>>2]=(o[T>>2]|0)+1),o[M>>2]=o[x>>2],T=M+4|0,ji(j,L,T),$n(T),o[M+16>>2]=o[x>>2],T=M+20|0,ji(j,L+12|0,T),$n(T),o[M+32>>2]=o[x>>2],T=M+36|0,ji(j,L+24|0,T),$n(T),o[M+48>>2]=o[x>>2],T=M+52|0,ji(j,L+36|0,T),$n(T),o[M+64>>2]=o[x>>2],T=M+68|0,ji(j,L+48|0,T),$n(T),o[M+80>>2]=o[x>>2],M=M+84|0,ji(j,L+60|0,M),$n(M),nt=ue}function Ll(x){x=+x;var T=0;return T=x<0?x+6.283185307179586:x,+(x>=6.283185307179586?T+-6.283185307179586:T)}function Vs(x,T){return x=x|0,T=T|0,+yi(+(+oe[x>>3]-+oe[T>>3]))<17453292519943298e-27?(T=+yi(+(+oe[x+8>>3]-+oe[T+8>>3]))<17453292519943298e-27,T|0):(T=0,T|0)}function cs(x,T){x=x|0,T=T|0;var M=0,L=0,j=0,H=0;return j=+oe[T>>3],L=+oe[x>>3],H=+bi(+((j-L)*.5)),M=+bi(+((+oe[T+8>>3]-+oe[x+8>>3])*.5)),M=H*H+M*(+gr(+j)*+gr(+L)*M),+(+Ls(+ +ai(+M),+ +ai(+(1-M)))*2)}function Rl(x,T){x=x|0,T=T|0;var M=0,L=0,j=0,H=0;return j=+oe[T>>3],L=+oe[x>>3],H=+bi(+((j-L)*.5)),M=+bi(+((+oe[T+8>>3]-+oe[x+8>>3])*.5)),M=H*H+M*(+gr(+j)*+gr(+L)*M),+(+Ls(+ +ai(+M),+ +ai(+(1-M)))*2*6371.007180918475)}function BA(x,T){x=x|0,T=T|0;var M=0,L=0,j=0,H=0;return j=+oe[T>>3],L=+oe[x>>3],H=+bi(+((j-L)*.5)),M=+bi(+((+oe[T+8>>3]-+oe[x+8>>3])*.5)),M=H*H+M*(+gr(+j)*+gr(+L)*M),+(+Ls(+ +ai(+M),+ +ai(+(1-M)))*2*6371.007180918475*1e3)}function Gr(x,T){x=x|0,T=T|0;var M=0,L=0,j=0,H=0,Q=0;return H=+oe[T>>3],L=+gr(+H),j=+oe[T+8>>3]-+oe[x+8>>3],Q=L*+bi(+j),M=+oe[x>>3],+ +Ls(+Q,+(+bi(+H)*+gr(+M)-+gr(+j)*(L*+bi(+M))))}function Yn(x,T,M,L){x=x|0,T=+T,M=+M,L=L|0;var j=0,H=0,Q=0,K=0;if(M<1e-16){o[L>>2]=o[x>>2],o[L+4>>2]=o[x+4>>2],o[L+8>>2]=o[x+8>>2],o[L+12>>2]=o[x+12>>2];return}H=T<0?T+6.283185307179586:T,H=T>=6.283185307179586?H+-6.283185307179586:H;do if(H<1e-16)T=+oe[x>>3]+M,oe[L>>3]=T,j=L;else{if(j=+yi(+(H+-3.141592653589793))<1e-16,T=+oe[x>>3],j){T=T-M,oe[L>>3]=T,j=L;break}if(Q=+gr(+M),M=+bi(+M),T=Q*+bi(+T)+ +gr(+H)*(M*+gr(+T)),T=T>1?1:T,T=+Qs(+(T<-1?-1:T)),oe[L>>3]=T,+yi(+(T+-1.5707963267948966))<1e-16){oe[L>>3]=1.5707963267948966,oe[L+8>>3]=0;return}if(+yi(+(T+1.5707963267948966))<1e-16){oe[L>>3]=-1.5707963267948966,oe[L+8>>3]=0;return}if(K=+gr(+T),H=M*+bi(+H)/K,M=+oe[x>>3],T=(Q-+bi(+T)*+bi(+M))/+gr(+M)/K,Q=H>1?1:H,T=T>1?1:T,T=+oe[x+8>>3]+ +Ls(+(Q<-1?-1:Q),+(T<-1?-1:T)),T>3.141592653589793)do T=T+-6.283185307179586;while(T>3.141592653589793);if(T<-3.141592653589793)do T=T+6.283185307179586;while(T<-3.141592653589793);oe[L+8>>3]=T;return}while(!1);if(+yi(+(T+-1.5707963267948966))<1e-16){oe[j>>3]=1.5707963267948966,oe[L+8>>3]=0;return}if(+yi(+(T+1.5707963267948966))<1e-16){oe[j>>3]=-1.5707963267948966,oe[L+8>>3]=0;return}if(T=+oe[x+8>>3],T>3.141592653589793)do T=T+-6.283185307179586;while(T>3.141592653589793);if(T<-3.141592653589793)do T=T+6.283185307179586;while(T<-3.141592653589793);oe[L+8>>3]=T}function eA(x){return x=x|0,+ +oe[20496+(x<<3)>>3]}function Gi(x){return x=x|0,+ +oe[20624+(x<<3)>>3]}function xa(x){return x=x|0,+ +oe[20752+(x<<3)>>3]}function ns(x){return x=x|0,+ +oe[20880+(x<<3)>>3]}function Tn(x){x=x|0;var T=0;return T=21008+(x<<3)|0,x=o[T>>2]|0,Dr(o[T+4>>2]|0),x|0}function Va(x,T,M){x=x|0,T=T|0,M=M|0;var L=0,j=0,H=0,Q=0,K=0,ue=0,Se=0,De=0,_t=0,Xe=0;return Xe=+oe[T>>3],De=+oe[x>>3],ue=+bi(+((Xe-De)*.5)),H=+oe[T+8>>3],Se=+oe[x+8>>3],Q=+bi(+((H-Se)*.5)),K=+gr(+De),_t=+gr(+Xe),Q=ue*ue+Q*(_t*K*Q),Q=+Ls(+ +ai(+Q),+ +ai(+(1-Q)))*2,ue=+oe[M>>3],Xe=+bi(+((ue-Xe)*.5)),L=+oe[M+8>>3],H=+bi(+((L-H)*.5)),j=+gr(+ue),H=Xe*Xe+H*(_t*j*H),H=+Ls(+ +ai(+H),+ +ai(+(1-H)))*2,ue=+bi(+((De-ue)*.5)),L=+bi(+((Se-L)*.5)),L=ue*ue+L*(K*j*L),L=+Ls(+ +ai(+L),+ +ai(+(1-L)))*2,j=(Q+H+L)*.5,+(+HA(+ +ai(+(+zi(+(j*.5))*+zi(+((j-Q)*.5))*+zi(+((j-H)*.5))*+zi(+((j-L)*.5)))))*4)}function Tc(x,T){x=x|0,T=T|0;var M=0,L=0,j=0,H=0,Q=0;if(H=nt,nt=nt+192|0,L=H+168|0,j=H,fo(x,T,L),ba(x,T,j),T=o[j>>2]|0,(T|0)<=0)return M=0,nt=H,+M;if(M=+Va(j+8|0,j+8+(((T|0)!=1&1)<<4)|0,L)+0,(T|0)==1)return nt=H,+M;x=1;do Q=x,x=x+1|0,M=M+ +Va(j+8+(Q<<4)|0,j+8+(((x|0)%(T|0)|0)<<4)|0,L);while((x|0)<(T|0));return nt=H,+M}function tl(x,T){x=x|0,T=T|0;var M=0,L=0,j=0,H=0,Q=0;if(H=nt,nt=nt+192|0,L=H+168|0,j=H,fo(x,T,L),ba(x,T,j),T=o[j>>2]|0,(T|0)>0){if(M=+Va(j+8|0,j+8+(((T|0)!=1&1)<<4)|0,L)+0,(T|0)!=1){x=1;do Q=x,x=x+1|0,M=M+ +Va(j+8+(Q<<4)|0,j+8+(((x|0)%(T|0)|0)<<4)|0,L);while((x|0)<(T|0))}}else M=0;return nt=H,+(M*6371.007180918475*6371.007180918475)}function pA(x,T){x=x|0,T=T|0;var M=0,L=0,j=0,H=0,Q=0;if(H=nt,nt=nt+192|0,L=H+168|0,j=H,fo(x,T,L),ba(x,T,j),T=o[j>>2]|0,(T|0)>0){if(M=+Va(j+8|0,j+8+(((T|0)!=1&1)<<4)|0,L)+0,(T|0)!=1){x=1;do Q=x,x=x+1|0,M=M+ +Va(j+8+(Q<<4)|0,j+8+(((x|0)%(T|0)|0)<<4)|0,L);while((x|0)<(T|0))}}else M=0;return nt=H,+(M*6371.007180918475*6371.007180918475*1e3*1e3)}function zo(x,T){x=x|0,T=T|0;var M=0,L=0,j=0,H=0,Q=0,K=0,ue=0,Se=0;if(Q=nt,nt=nt+176|0,H=Q,ol(x,T,H),x=o[H>>2]|0,(x|0)<=1)return j=0,nt=Q,+j;T=x+-1|0,x=0,M=0,L=+oe[H+8>>3],j=+oe[H+16>>3];do x=x+1|0,ue=L,L=+oe[H+8+(x<<4)>>3],Se=+bi(+((L-ue)*.5)),K=j,j=+oe[H+8+(x<<4)+8>>3],K=+bi(+((j-K)*.5)),K=Se*Se+K*(+gr(+L)*+gr(+ue)*K),M=M+ +Ls(+ +ai(+K),+ +ai(+(1-K)))*2;while((x|0)<(T|0));return nt=Q,+M}function pl(x,T){x=x|0,T=T|0;var M=0,L=0,j=0,H=0,Q=0,K=0,ue=0,Se=0;if(Q=nt,nt=nt+176|0,H=Q,ol(x,T,H),x=o[H>>2]|0,(x|0)<=1)return j=0,nt=Q,+j;T=x+-1|0,x=0,M=0,L=+oe[H+8>>3],j=+oe[H+16>>3];do x=x+1|0,ue=L,L=+oe[H+8+(x<<4)>>3],Se=+bi(+((L-ue)*.5)),K=j,j=+oe[H+8+(x<<4)+8>>3],K=+bi(+((j-K)*.5)),K=Se*Se+K*(+gr(+ue)*+gr(+L)*K),M=M+ +Ls(+ +ai(+K),+ +ai(+(1-K)))*2;while((x|0)!=(T|0));return Se=M*6371.007180918475,nt=Q,+Se}function Ln(x,T){x=x|0,T=T|0;var M=0,L=0,j=0,H=0,Q=0,K=0,ue=0,Se=0;if(Q=nt,nt=nt+176|0,H=Q,ol(x,T,H),x=o[H>>2]|0,(x|0)<=1)return j=0,nt=Q,+j;T=x+-1|0,x=0,M=0,L=+oe[H+8>>3],j=+oe[H+16>>3];do x=x+1|0,ue=L,L=+oe[H+8+(x<<4)>>3],Se=+bi(+((L-ue)*.5)),K=j,j=+oe[H+8+(x<<4)+8>>3],K=+bi(+((j-K)*.5)),K=Se*Se+K*(+gr(+ue)*+gr(+L)*K),M=M+ +Ls(+ +ai(+K),+ +ai(+(1-K)))*2;while((x|0)!=(T|0));return Se=M*6371.007180918475*1e3,nt=Q,+Se}function Ec(x,T){return x=x|0,T=T|0,T=Vt(x|0,T|0,52)|0,gt()|0,T&15|0}function mA(x,T){return x=x|0,T=T|0,T=Vt(x|0,T|0,45)|0,gt()|0,T&127|0}function il(x,T){x=x|0,T=T|0;var M=0,L=0,j=0,H=0,Q=0,K=0;if(!(!0&(T&-16777216|0)==134217728)||(Q=Vt(x|0,T|0,45)|0,gt()|0,Q=Q&127,Q>>>0>121))return T=0,T|0;M=Vt(x|0,T|0,52)|0,gt()|0,M=M&15;do if(M|0){for(j=1,L=0;;){if(H=Vt(x|0,T|0,(15-j|0)*3|0)|0,gt()|0,H=H&7,(H|0)!=0&(L^1))if((H|0)==1&(is(Q)|0)!=0){K=0,L=13;break}else L=1;if((H|0)==7){K=0,L=13;break}if(j>>>0<M>>>0)j=j+1|0;else{L=9;break}}if((L|0)==9){if((M|0)==15)K=1;else break;return K|0}else if((L|0)==13)return K|0}while(!1);for(;;){if(K=Vt(x|0,T|0,(14-M|0)*3|0)|0,gt()|0,!((K&7|0)==7&!0)){K=0,L=13;break}if(M>>>0<14)M=M+1|0;else{K=1,L=13;break}}return(L|0)==13?K|0:0}function Na(x,T,M){x=x|0,T=T|0,M=M|0;var L=0,j=0;if(L=Vt(x|0,T|0,52)|0,gt()|0,L=L&15,(L|0)>=(M|0)){if((L|0)!=(M|0))if(M>>>0<=15){if(j=Jt(M|0,0,52)|0,x=j|x,T=gt()|0|T&-15728641,(L|0)>(M|0))do j=Jt(7,0,(14-M|0)*3|0)|0,M=M+1|0,x=j|x,T=gt()|0|T;while((M|0)<(L|0))}else T=0,x=0}else T=0,x=0;return Dr(T|0),x|0}function xu(x,T,M){return x=x|0,T=T|0,M=M|0,x=Vt(x|0,T|0,52)|0,gt()|0,x=x&15,(M|0)<16&(x|0)<=(M|0)?(M=ll(7,M-x|0)|0,M|0):(M=0,M|0)}function Ps(x,T,M,L){x=x|0,T=T|0,M=M|0,L=L|0;var j=0,H=0,Q=0,K=0,ue=0,Se=0,De=0;if(Q=Vt(x|0,T|0,52)|0,gt()|0,Q=Q&15,!!((M|0)<16&(Q|0)<=(M|0))){if((Q|0)==(M|0)){M=L,o[M>>2]=x,o[M+4>>2]=T;return}if(ue=ll(7,M-Q|0)|0,Se=(ue|0)/7|0,K=Vt(x|0,T|0,45)|0,gt()|0,!(is(K&127)|0))H=0;else{e:do if(!Q)j=0;else for(H=1;;){if(j=Vt(x|0,T|0,(15-H|0)*3|0)|0,gt()|0,j=j&7,j|0)break e;if(H>>>0<Q>>>0)H=H+1|0;else{j=0;break}}while(!1);H=(j|0)==0}if(De=Jt(Q+1|0,0,52)|0,j=gt()|0|T&-15728641,K=(14-Q|0)*3|0,T=Jt(7,0,K|0)|0,T=(De|x)&~T,Q=j&~(gt()|0),Ps(T,Q,M,L),j=L+(Se<<3)|0,!H){De=Jt(1,0,K|0)|0,Ps(De|T,gt()|0|Q,M,j),De=j+(Se<<3)|0,ue=Jt(2,0,K|0)|0,Ps(ue|T,gt()|0|Q,M,De),De=De+(Se<<3)|0,ue=Jt(3,0,K|0)|0,Ps(ue|T,gt()|0|Q,M,De),De=De+(Se<<3)|0,ue=Jt(4,0,K|0)|0,Ps(ue|T,gt()|0|Q,M,De),De=De+(Se<<3)|0,ue=Jt(5,0,K|0)|0,Ps(ue|T,gt()|0|Q,M,De),ue=Jt(6,0,K|0)|0,Ps(ue|T,gt()|0|Q,M,De+(Se<<3)|0);return}H=j+(Se<<3)|0,(ue|0)>6&&(ue=j+8|0,De=(H>>>0>ue>>>0?H:ue)+-1+(0-j)|0,tn(j|0,0,De+8&-8|0)|0,j=ue+(De>>>3<<3)|0),De=Jt(2,0,K|0)|0,Ps(De|T,gt()|0|Q,M,j),De=j+(Se<<3)|0,ue=Jt(3,0,K|0)|0,Ps(ue|T,gt()|0|Q,M,De),De=De+(Se<<3)|0,ue=Jt(4,0,K|0)|0,Ps(ue|T,gt()|0|Q,M,De),De=De+(Se<<3)|0,ue=Jt(5,0,K|0)|0,Ps(ue|T,gt()|0|Q,M,De),ue=Jt(6,0,K|0)|0,Ps(ue|T,gt()|0|Q,M,De+(Se<<3)|0)}}function Ns(x,T){x=x|0,T=T|0;var M=0,L=0,j=0;if(j=Vt(x|0,T|0,45)|0,gt()|0,!(is(j&127)|0))return j=0,j|0;j=Vt(x|0,T|0,52)|0,gt()|0,j=j&15;e:do if(!j)M=0;else for(L=1;;){if(M=Vt(x|0,T|0,(15-L|0)*3|0)|0,gt()|0,M=M&7,M|0)break e;if(L>>>0<j>>>0)L=L+1|0;else{M=0;break}}while(!1);return j=(M|0)==0&1,j|0}function oo(x,T,M){x=x|0,T=T|0,M=M|0;var L=0,j=0;if(L=Vt(x|0,T|0,52)|0,gt()|0,L=L&15,(M|0)<16&(L|0)<=(M|0)){if((L|0)!=(M|0)&&(j=Jt(M|0,0,52)|0,x=j|x,T=gt()|0|T&-15728641,(L|0)<(M|0)))do j=Jt(7,0,(14-L|0)*3|0)|0,L=L+1|0,x=x&~j,T=T&~(gt()|0);while((L|0)<(M|0))}else T=0,x=0;return Dr(T|0),x|0}function na(x,T,M){x=x|0,T=T|0,M=M|0;var L=0,j=0,H=0,Q=0,K=0,ue=0,Se=0,De=0,_t=0,Xe=0,tt=0,z=0,l=0,g=0,S=0,k=0,F=0,Z=0,u=0,h=0,f=0,y=0;if(!M)return f=0,f|0;if(j=x,L=o[j>>2]|0,j=o[j+4>>2]|0,!0&(j&15728640|0)==0){if((M|0)<=0||(f=T,o[f>>2]=L,o[f+4>>2]=j,(M|0)==1))return f=0,f|0;L=1;do u=x+(L<<3)|0,h=o[u+4>>2]|0,f=T+(L<<3)|0,o[f>>2]=o[u>>2],o[f+4>>2]=h,L=L+1|0;while((L|0)!=(M|0));return L=0,L|0}if(u=M<<3,h=mo(u)|0,!h)return f=-3,f|0;if(Vl(h|0,x|0,u|0)|0,Z=Yo(M,8)|0,!Z)return mr(h),f=-3,f|0;L=M;e:for(;;){Q=h,De=o[Q>>2]|0,Q=o[Q+4>>2]|0,k=Vt(De|0,Q|0,52)|0,gt()|0,k=k&15,F=k+-1|0,S=(L|0)>0;t:do if(S){if(g=((L|0)<0)<<31>>31,z=Jt(F|0,0,52)|0,l=gt()|0,F>>>0>15)for(j=0,x=De,M=Q;;){if(!((x|0)==0&(M|0)==0)){if(H=Vt(x|0,M|0,52)|0,gt()|0,H=H&15,K=(H|0)<(F|0),H=(H|0)==(F|0),Se=K?0:H?x:0,x=K?0:H?M:0,M=Ea(Se|0,x|0,L|0,g|0)|0,gt()|0,H=Z+(M<<3)|0,K=H,ue=o[K>>2]|0,K=o[K+4>>2]|0,(ue|0)==0&(K|0)==0)M=Se;else for(z=0,tt=M,Xe=K,M=Se;;){if((z|0)>(L|0)){f=41;break e}if((ue|0)==(M|0)&(Xe&-117440513|0)==(x|0)){Se=Vt(ue|0,Xe|0,56)|0,gt()|0,Se=Se&7,_t=Se+1|0,l=Vt(ue|0,Xe|0,45)|0,gt()|0;i:do if(!(is(l&127)|0))K=7;else{if(ue=Vt(ue|0,Xe|0,52)|0,gt()|0,ue=ue&15,!ue){K=6;break}for(K=1;;){if(l=Jt(7,0,(15-K|0)*3|0)|0,!((l&M|0)==0&((gt()|0)&x|0)==0)){K=7;break i}if(K>>>0<ue>>>0)K=K+1|0;else{K=6;break}}}while(!1);if((Se+2|0)>>>0>K>>>0){f=51;break e}l=Jt(_t|0,0,56)|0,x=gt()|0|x&-117440513,K=H,o[K>>2]=0,o[K+4>>2]=0,K=tt,M=l|M}else K=(tt+1|0)%(L|0)|0;if(H=Z+(K<<3)|0,Xe=H,ue=o[Xe>>2]|0,Xe=o[Xe+4>>2]|0,(ue|0)==0&(Xe|0)==0)break;z=z+1|0,tt=K}l=H,o[l>>2]=M,o[l+4>>2]=x}if(j=j+1|0,(j|0)>=(L|0))break t;M=h+(j<<3)|0,x=o[M>>2]|0,M=o[M+4>>2]|0}for(j=0,x=De,M=Q;;){if(!((x|0)==0&(M|0)==0)){if(K=Vt(x|0,M|0,52)|0,gt()|0,K=K&15,(K|0)>=(F|0)){if((K|0)!=(F|0)&&(x=x|z,M=M&-15728641|l,K>>>0>=k>>>0)){H=F;do tt=Jt(7,0,(14-H|0)*3|0)|0,H=H+1|0,x=tt|x,M=gt()|0|M;while(H>>>0<K>>>0)}}else x=0,M=0;if(K=Ea(x|0,M|0,L|0,g|0)|0,gt()|0,H=Z+(K<<3)|0,ue=H,Se=o[ue>>2]|0,ue=o[ue+4>>2]|0,!((Se|0)==0&(ue|0)==0))for(tt=0;;){if((tt|0)>(L|0)){f=41;break e}if((Se|0)==(x|0)&(ue&-117440513|0)==(M|0)){_t=Vt(Se|0,ue|0,56)|0,gt()|0,_t=_t&7,Xe=_t+1|0,y=Vt(Se|0,ue|0,45)|0,gt()|0;i:do if(!(is(y&127)|0))ue=7;else{if(Se=Vt(Se|0,ue|0,52)|0,gt()|0,Se=Se&15,!Se){ue=6;break}for(ue=1;;){if(y=Jt(7,0,(15-ue|0)*3|0)|0,!((y&x|0)==0&((gt()|0)&M|0)==0)){ue=7;break i}if(ue>>>0<Se>>>0)ue=ue+1|0;else{ue=6;break}}}while(!1);if((_t+2|0)>>>0>ue>>>0){f=51;break e}y=Jt(Xe|0,0,56)|0,M=gt()|0|M&-117440513,Xe=H,o[Xe>>2]=0,o[Xe+4>>2]=0,x=y|x}else K=(K+1|0)%(L|0)|0;if(H=Z+(K<<3)|0,ue=H,Se=o[ue>>2]|0,ue=o[ue+4>>2]|0,(Se|0)==0&(ue|0)==0)break;tt=tt+1|0}y=H,o[y>>2]=x,o[y+4>>2]=M}if(j=j+1|0,(j|0)>=(L|0))break t;M=h+(j<<3)|0,x=o[M>>2]|0,M=o[M+4>>2]|0}}while(!1);if((L+5|0)>>>0<11){f=99;break}if(l=Yo((L|0)/6|0,8)|0,!l){f=58;break}t:do if(S){tt=0,Xe=0;do{if(K=Z+(tt<<3)|0,x=K,j=o[x>>2]|0,x=o[x+4>>2]|0,!((j|0)==0&(x|0)==0)){ue=Vt(j|0,x|0,56)|0,gt()|0,ue=ue&7,M=ue+1|0,Se=x&-117440513,y=Vt(j|0,x|0,45)|0,gt()|0;i:do if(is(y&127)|0){if(_t=Vt(j|0,x|0,52)|0,gt()|0,_t=_t&15,_t|0)for(H=1;;){if(y=Jt(7,0,(15-H|0)*3|0)|0,!((j&y|0)==0&(Se&(gt()|0)|0)==0))break i;if(H>>>0<_t>>>0)H=H+1|0;else break}x=Jt(M|0,0,56)|0,j=x|j,x=gt()|0|Se,M=K,o[M>>2]=j,o[M+4>>2]=x,M=ue+2|0}while(!1);(M|0)==7&&(y=l+(Xe<<3)|0,o[y>>2]=j,o[y+4>>2]=x&-117440513,Xe=Xe+1|0)}tt=tt+1|0}while((tt|0)!=(L|0));if(S){if(z=((L|0)<0)<<31>>31,_t=Jt(F|0,0,52)|0,tt=gt()|0,F>>>0>15)for(x=0,j=0;;){do if(!((De|0)==0&(Q|0)==0)){for(ue=Vt(De|0,Q|0,52)|0,gt()|0,ue=ue&15,H=(ue|0)<(F|0),ue=(ue|0)==(F|0),K=H?0:ue?De:0,ue=H?0:ue?Q:0,H=Ea(K|0,ue|0,L|0,z|0)|0,gt()|0,M=0;;){if((M|0)>(L|0)){f=98;break e}if(y=Z+(H<<3)|0,Se=o[y+4>>2]|0,(Se&-117440513|0)==(ue|0)&&(o[y>>2]|0)==(K|0)){f=70;break}if(H=(H+1|0)%(L|0)|0,y=Z+(H<<3)|0,(o[y>>2]|0)==(K|0)&&(o[y+4>>2]|0)==(ue|0))break;M=M+1|0}if((f|0)==70&&(f=0,!0&(Se&117440512|0)==100663296))break;y=T+(j<<3)|0,o[y>>2]=De,o[y+4>>2]=Q,j=j+1|0}while(!1);if(x=x+1|0,(x|0)>=(L|0)){L=Xe;break t}Q=h+(x<<3)|0,De=o[Q>>2]|0,Q=o[Q+4>>2]|0}for(x=0,j=0;;){do if(!((De|0)==0&(Q|0)==0)){if(ue=Vt(De|0,Q|0,52)|0,gt()|0,ue=ue&15,(ue|0)>=(F|0))if((ue|0)!=(F|0))if(M=De|_t,H=Q&-15728641|tt,ue>>>0<k>>>0)ue=H;else{K=F;do y=Jt(7,0,(14-K|0)*3|0)|0,K=K+1|0,M=y|M,H=gt()|0|H;while(K>>>0<ue>>>0);ue=H}else M=De,ue=Q;else M=0,ue=0;for(K=Ea(M|0,ue|0,L|0,z|0)|0,gt()|0,H=0;;){if((H|0)>(L|0)){f=98;break e}if(y=Z+(K<<3)|0,Se=o[y+4>>2]|0,(Se&-117440513|0)==(ue|0)&&(o[y>>2]|0)==(M|0)){f=93;break}if(K=(K+1|0)%(L|0)|0,y=Z+(K<<3)|0,(o[y>>2]|0)==(M|0)&&(o[y+4>>2]|0)==(ue|0))break;H=H+1|0}if((f|0)==93&&(f=0,!0&(Se&117440512|0)==100663296))break;y=T+(j<<3)|0,o[y>>2]=De,o[y+4>>2]=Q,j=j+1|0}while(!1);if(x=x+1|0,(x|0)>=(L|0)){L=Xe;break t}Q=h+(x<<3)|0,De=o[Q>>2]|0,Q=o[Q+4>>2]|0}}else j=0,L=Xe}else j=0,L=0;while(!1);if(tn(Z|0,0,u|0)|0,Vl(h|0,l|0,L<<3|0)|0,mr(l),L)T=T+(j<<3)|0;else break}return(f|0)==41?(mr(h),mr(Z),y=-1,y|0):(f|0)==51?(mr(h),mr(Z),y=-2,y|0):(f|0)==58?(mr(h),mr(Z),y=-3,y|0):(f|0)==98?(mr(l),mr(h),mr(Z),y=-1,y|0):((f|0)==99&&Vl(T|0,h|0,L<<3|0)|0,mr(h),mr(Z),y=0,y|0)}function ml(x,T,M,L,j){x=x|0,T=T|0,M=M|0,L=L|0,j=j|0;var H=0,Q=0,K=0,ue=0,Se=0,De=0;if((T|0)<=0)return j=0,j|0;if((j|0)>=16){for(H=0;;){if(De=x+(H<<3)|0,!((o[De>>2]|0)==0&(o[De+4>>2]|0)==0)){H=14;break}if(H=H+1|0,(H|0)>=(T|0)){Q=0,H=16;break}}if((H|0)==14)return((L|0)>0?-2:-1)|0;if((H|0)==16)return Q|0}H=0,De=0;e:for(;;){Se=x+(De<<3)|0,K=Se,Q=o[K>>2]|0,K=o[K+4>>2]|0;do if(!((Q|0)==0&(K|0)==0)){if((H|0)>=(L|0)){Q=-1,H=16;break e}if(ue=Vt(Q|0,K|0,52)|0,gt()|0,ue=ue&15,(ue|0)>(j|0)){Q=-2,H=16;break e}if((ue|0)==(j|0)){Se=M+(H<<3)|0,o[Se>>2]=Q,o[Se+4>>2]=K,H=H+1|0;break}if(Q=(ll(7,j-ue|0)|0)+H|0,(Q|0)>(L|0)){Q=-1,H=16;break e}Ps(o[Se>>2]|0,o[Se+4>>2]|0,j,M+(H<<3)|0),H=Q}while(!1);if(De=De+1|0,(De|0)>=(T|0)){Q=0,H=16;break}}return(H|0)==16?Q|0:0}function Kc(x,T,M){x=x|0,T=T|0,M=M|0;var L=0,j=0,H=0,Q=0;if((T|0)<=0)return M=0,M|0;if((M|0)>=16){for(L=0;;){if(Q=x+(L<<3)|0,!((o[Q>>2]|0)==0&(o[Q+4>>2]|0)==0)){L=-1,j=13;break}if(L=L+1|0,(L|0)>=(T|0)){L=0,j=13;break}}if((j|0)==13)return L|0}L=0,Q=0;e:for(;;){j=x+(Q<<3)|0,H=o[j>>2]|0,j=o[j+4>>2]|0;do if(!((H|0)==0&(j|0)==0)){if(j=Vt(H|0,j|0,52)|0,gt()|0,j=j&15,(j|0)>(M|0)){L=-1,j=13;break e}if((j|0)==(M|0)){L=L+1|0;break}else{L=(ll(7,M-j|0)|0)+L|0;break}}while(!1);if(Q=Q+1|0,(Q|0)>=(T|0)){j=13;break}}return(j|0)==13?L|0:0}function JA(x,T){return x=x|0,T=T|0,T=Vt(x|0,T|0,52)|0,gt()|0,T&1|0}function Ws(x,T){x=x|0,T=T|0;var M=0,L=0,j=0;if(j=Vt(x|0,T|0,52)|0,gt()|0,j=j&15,!j)return j=0,j|0;for(L=1;;){if(M=Vt(x|0,T|0,(15-L|0)*3|0)|0,gt()|0,M=M&7,M|0){L=5;break}if(L>>>0<j>>>0)L=L+1|0;else{M=0,L=5;break}}return(L|0)==5?M|0:0}function ho(x,T){x=x|0,T=T|0;var M=0,L=0,j=0,H=0,Q=0,K=0,ue=0;if(ue=Vt(x|0,T|0,52)|0,gt()|0,ue=ue&15,!ue)return K=T,ue=x,Dr(K|0),ue|0;for(K=1,M=0;;){H=(15-K|0)*3|0,L=Jt(7,0,H|0)|0,j=gt()|0,Q=Vt(x|0,T|0,H|0)|0,gt()|0,H=Jt(Os(Q&7)|0,0,H|0)|0,Q=gt()|0,x=H|x&~L,T=Q|T&~j;e:do if(!M)if((H&L|0)==0&(Q&j|0)==0)M=0;else if(L=Vt(x|0,T|0,52)|0,gt()|0,L=L&15,!L)M=1;else{M=1;t:for(;;){switch(Q=Vt(x|0,T|0,(15-M|0)*3|0)|0,gt()|0,Q&7){case 1:break t;case 0:break;default:{M=1;break e}}if(M>>>0<L>>>0)M=M+1|0;else{M=1;break e}}for(M=1;;)if(Q=(15-M|0)*3|0,j=Vt(x|0,T|0,Q|0)|0,gt()|0,H=Jt(7,0,Q|0)|0,T=T&~(gt()|0),Q=Jt(Os(j&7)|0,0,Q|0)|0,x=x&~H|Q,T=T|(gt()|0),M>>>0<L>>>0)M=M+1|0;else{M=1;break}}while(!1);if(K>>>0<ue>>>0)K=K+1|0;else break}return Dr(T|0),x|0}function $o(x,T){x=x|0,T=T|0;var M=0,L=0,j=0,H=0,Q=0;if(L=Vt(x|0,T|0,52)|0,gt()|0,L=L&15,!L)return M=T,L=x,Dr(M|0),L|0;for(M=1;H=(15-M|0)*3|0,Q=Vt(x|0,T|0,H|0)|0,gt()|0,j=Jt(7,0,H|0)|0,T=T&~(gt()|0),H=Jt(Os(Q&7)|0,0,H|0)|0,x=H|x&~j,T=gt()|0|T,M>>>0<L>>>0;)M=M+1|0;return Dr(T|0),x|0}function LA(x,T){x=x|0,T=T|0;var M=0,L=0,j=0,H=0,Q=0,K=0,ue=0;if(ue=Vt(x|0,T|0,52)|0,gt()|0,ue=ue&15,!ue)return K=T,ue=x,Dr(K|0),ue|0;for(K=1,M=0;;){H=(15-K|0)*3|0,L=Jt(7,0,H|0)|0,j=gt()|0,Q=Vt(x|0,T|0,H|0)|0,gt()|0,H=Jt(_a(Q&7)|0,0,H|0)|0,Q=gt()|0,x=H|x&~L,T=Q|T&~j;e:do if(!M)if((H&L|0)==0&(Q&j|0)==0)M=0;else if(L=Vt(x|0,T|0,52)|0,gt()|0,L=L&15,!L)M=1;else{M=1;t:for(;;){switch(Q=Vt(x|0,T|0,(15-M|0)*3|0)|0,gt()|0,Q&7){case 1:break t;case 0:break;default:{M=1;break e}}if(M>>>0<L>>>0)M=M+1|0;else{M=1;break e}}for(M=1;;)if(j=(15-M|0)*3|0,H=Jt(7,0,j|0)|0,Q=T&~(gt()|0),T=Vt(x|0,T|0,j|0)|0,gt()|0,T=Jt(_a(T&7)|0,0,j|0)|0,x=x&~H|T,T=Q|(gt()|0),M>>>0<L>>>0)M=M+1|0;else{M=1;break}}while(!1);if(K>>>0<ue>>>0)K=K+1|0;else break}return Dr(T|0),x|0}function Pn(x,T){x=x|0,T=T|0;var M=0,L=0,j=0,H=0,Q=0;if(L=Vt(x|0,T|0,52)|0,gt()|0,L=L&15,!L)return M=T,L=x,Dr(M|0),L|0;for(M=1;Q=(15-M|0)*3|0,H=Jt(7,0,Q|0)|0,j=T&~(gt()|0),T=Vt(x|0,T|0,Q|0)|0,gt()|0,T=Jt(_a(T&7)|0,0,Q|0)|0,x=T|x&~H,T=gt()|0|j,M>>>0<L>>>0;)M=M+1|0;return Dr(T|0),x|0}function va(x,T){x=x|0,T=T|0;var M=0,L=0,j=0,H=0,Q=0,K=0,ue=0,Se=0,De=0;if(ue=nt,nt=nt+64|0,K=ue+40|0,L=ue+24|0,j=ue+12|0,H=ue,Jt(T|0,0,52)|0,M=gt()|0|134225919,!T)return(o[x+4>>2]|0)>2||(o[x+8>>2]|0)>2||(o[x+12>>2]|0)>2?(Q=0,K=0,Dr(Q|0),nt=ue,K|0):(Jt(jn(x)|0,0,45)|0,Q=gt()|0|M,K=-1,Dr(Q|0),nt=ue,K|0);if(o[K>>2]=o[x>>2],o[K+4>>2]=o[x+4>>2],o[K+8>>2]=o[x+8>>2],o[K+12>>2]=o[x+12>>2],Q=K+4|0,(T|0)>0)for(x=-1;o[L>>2]=o[Q>>2],o[L+4>>2]=o[Q+4>>2],o[L+8>>2]=o[Q+8>>2],T&1?(Pr(Q),o[j>>2]=o[Q>>2],o[j+4>>2]=o[Q+4>>2],o[j+8>>2]=o[Q+8>>2],Ja(j)):(ma(Q),o[j>>2]=o[Q>>2],o[j+4>>2]=o[Q+4>>2],o[j+8>>2]=o[Q+8>>2],ra(j)),ar(L,j,H),$n(H),De=(15-T|0)*3|0,Se=Jt(7,0,De|0)|0,M=M&~(gt()|0),De=Jt(ia(H)|0,0,De|0)|0,x=De|x&~Se,M=gt()|0|M,(T|0)>1;)T=T+-1|0;else x=-1;e:do if((o[Q>>2]|0)<=2&&(o[K+8>>2]|0)<=2&&(o[K+12>>2]|0)<=2){if(L=jn(K)|0,T=Jt(L|0,0,45)|0,T=T|x,x=gt()|0|M&-1040385,H=hA(K)|0,!(is(L)|0)){if((H|0)<=0)break;for(j=0;;){if(L=Vt(T|0,x|0,52)|0,gt()|0,L=L&15,L)for(M=1;De=(15-M|0)*3|0,K=Vt(T|0,x|0,De|0)|0,gt()|0,Se=Jt(7,0,De|0)|0,x=x&~(gt()|0),De=Jt(Os(K&7)|0,0,De|0)|0,T=T&~Se|De,x=x|(gt()|0),M>>>0<L>>>0;)M=M+1|0;if(j=j+1|0,(j|0)==(H|0))break e}}j=Vt(T|0,x|0,52)|0,gt()|0,j=j&15;t:do if(j){M=1;i:for(;;){switch(De=Vt(T|0,x|0,(15-M|0)*3|0)|0,gt()|0,De&7){case 1:break i;case 0:break;default:break t}if(M>>>0<j>>>0)M=M+1|0;else break t}if(rs(L,o[K>>2]|0)|0)for(M=1;K=(15-M|0)*3|0,Se=Jt(7,0,K|0)|0,De=x&~(gt()|0),x=Vt(T|0,x|0,K|0)|0,gt()|0,x=Jt(_a(x&7)|0,0,K|0)|0,T=T&~Se|x,x=De|(gt()|0),M>>>0<j>>>0;)M=M+1|0;else for(M=1;De=(15-M|0)*3|0,K=Vt(T|0,x|0,De|0)|0,gt()|0,Se=Jt(7,0,De|0)|0,x=x&~(gt()|0),De=Jt(Os(K&7)|0,0,De|0)|0,T=T&~Se|De,x=x|(gt()|0),M>>>0<j>>>0;)M=M+1|0}while(!1);if((H|0)>0){M=0;do T=ho(T,x)|0,x=gt()|0,M=M+1|0;while((M|0)!=(H|0))}}else T=0,x=0;while(!1);return Se=x,De=T,Dr(Se|0),nt=ue,De|0}function Rn(x){return x=x|0,(x|0)%2|0|0}function Ua(x,T){x=x|0,T=T|0;var M=0,L=0;return L=nt,nt=nt+16|0,M=L,T>>>0<=15&&(o[x+4>>2]&2146435072|0)!=2146435072&&(o[x+8+4>>2]&2146435072|0)!=2146435072?(Wo(x,T,M),T=va(M,T)|0,x=gt()|0):(x=0,T=0),Dr(x|0),nt=L,T|0}function rl(x,T,M){x=x|0,T=T|0,M=M|0;var L=0,j=0,H=0,Q=0;if(j=M+4|0,H=Vt(x|0,T|0,52)|0,gt()|0,H=H&15,Q=Vt(x|0,T|0,45)|0,gt()|0,L=(H|0)==0,is(Q&127)|0){if(L)return Q=1,Q|0;L=1}else{if(L)return Q=0,Q|0;!(o[j>>2]|0)&&!(o[M+8>>2]|0)?L=(o[M+12>>2]|0)!=0&1:L=1}for(M=1;M&1?Ja(j):ra(j),Q=Vt(x|0,T|0,(15-M|0)*3|0)|0,gt()|0,no(j,Q&7),M>>>0<H>>>0;)M=M+1|0;return L|0}function _l(x,T,M){x=x|0,T=T|0,M=M|0;var L=0,j=0,H=0,Q=0,K=0,ue=0,Se=0,De=0;De=nt,nt=nt+16|0,ue=De,Se=Vt(x|0,T|0,45)|0,gt()|0,Se=Se&127;e:do if(is(Se)|0&&(H=Vt(x|0,T|0,52)|0,gt()|0,H=H&15,(H|0)!=0)){L=1;t:for(;;){switch(K=Vt(x|0,T|0,(15-L|0)*3|0)|0,gt()|0,K&7){case 5:break t;case 0:break;default:{L=T;break e}}if(L>>>0<H>>>0)L=L+1|0;else{L=T;break e}}for(j=1,L=T;T=(15-j|0)*3|0,Q=Jt(7,0,T|0)|0,K=L&~(gt()|0),L=Vt(x|0,L|0,T|0)|0,gt()|0,L=Jt(_a(L&7)|0,0,T|0)|0,x=x&~Q|L,L=K|(gt()|0),j>>>0<H>>>0;)j=j+1|0}else L=T;while(!1);if(K=7728+(Se*28|0)|0,o[M>>2]=o[K>>2],o[M+4>>2]=o[K+4>>2],o[M+8>>2]=o[K+8>>2],o[M+12>>2]=o[K+12>>2],!(rl(x,L,M)|0)){nt=De;return}if(Q=M+4|0,o[ue>>2]=o[Q>>2],o[ue+4>>2]=o[Q+4>>2],o[ue+8>>2]=o[Q+8>>2],H=Vt(x|0,L|0,52)|0,gt()|0,K=H&15,H&1?(ra(Q),H=K+1|0):H=K,!(is(Se)|0))L=0;else{e:do if(!K)L=0;else for(T=1;;){if(j=Vt(x|0,L|0,(15-T|0)*3|0)|0,gt()|0,j=j&7,j|0){L=j;break e}if(T>>>0<K>>>0)T=T+1|0;else{L=0;break}}while(!1);L=(L|0)==4&1}if(!(Bl(M,H,L,0)|0))(H|0)!=(K|0)&&(o[Q>>2]=o[ue>>2],o[Q+4>>2]=o[ue+4>>2],o[Q+8>>2]=o[ue+8>>2]);else{if(is(Se)|0)do;while(Bl(M,H,0,0)|0);(H|0)!=(K|0)&&ma(Q)}nt=De}function fo(x,T,M){x=x|0,T=T|0,M=M|0;var L=0,j=0;L=nt,nt=nt+16|0,j=L,_l(x,T,j),T=Vt(x|0,T|0,52)|0,gt()|0,zA(j,T&15,M),nt=L}function ba(x,T,M){x=x|0,T=T|0,M=M|0;var L=0,j=0,H=0,Q=0,K=0;Q=nt,nt=nt+16|0,H=Q,_l(x,T,H),L=Vt(x|0,T|0,45)|0,gt()|0,L=(is(L&127)|0)==0,j=Vt(x|0,T|0,52)|0,gt()|0,j=j&15;e:do if(!L){if(j|0)for(L=1;;){if(K=Jt(7,0,(15-L|0)*3|0)|0,!((K&x|0)==0&((gt()|0)&T|0)==0))break e;if(L>>>0<j>>>0)L=L+1|0;else break}uo(H,j,0,5,M),nt=Q;return}while(!1);hs(H,j,0,6,M),nt=Q}function Fl(x,T){x=x|0,T=T|0;var M=0,L=0,j=0;if(L=Vt(x|0,T|0,45)|0,gt()|0,!(is(L&127)|0))return L=2,L|0;if(L=Vt(x|0,T|0,52)|0,gt()|0,L=L&15,!L)return L=5,L|0;for(M=1;;){if(j=Jt(7,0,(15-M|0)*3|0)|0,!((j&x|0)==0&((gt()|0)&T|0)==0)){M=2,x=6;break}if(M>>>0<L>>>0)M=M+1|0;else{M=5,x=6;break}}return(x|0)==6?M|0:0}function Mt(x,T,M){x=x|0,T=T|0,M=M|0;var L=0,j=0,H=0,Q=0,K=0,ue=0,Se=0,De=0,_t=0;_t=nt,nt=nt+128|0,Se=_t+112|0,H=_t+96|0,De=_t,j=Vt(x|0,T|0,52)|0,gt()|0,K=j&15,o[Se>>2]=K,Q=Vt(x|0,T|0,45)|0,gt()|0,Q=Q&127;e:do if(is(Q)|0){if(K|0)for(L=1;;){if(ue=Jt(7,0,(15-L|0)*3|0)|0,!((ue&x|0)==0&((gt()|0)&T|0)==0)){j=0;break e}if(L>>>0<K>>>0)L=L+1|0;else break}if(j&1)j=1;else{ue=Jt(K+1|0,0,52)|0,De=gt()|0|T&-15728641,Se=Jt(7,0,(14-K|0)*3|0)|0,Mt((ue|x)&~Se,De&~(gt()|0),M),nt=_t;return}}else j=0;while(!1);_l(x,T,H),j?(so(H,Se,De),ue=5):(ya(H,Se,De),ue=6);e:do if(is(Q)|0)if(!K)L=20;else for(L=1;;){if(Q=Jt(7,0,(15-L|0)*3|0)|0,!((Q&x|0)==0&((gt()|0)&T|0)==0)){L=8;break e}if(L>>>0<K>>>0)L=L+1|0;else{L=20;break}}else L=8;while(!1);if(tn(M|0,-1,L|0)|0,j){j=0;do{for(H=De+(j<<4)|0,Jl(H,o[Se>>2]|0)|0,H=o[H>>2]|0,L=0;Q=M+(L<<2)|0,K=o[Q>>2]|0,!((K|0)==-1|(K|0)==(H|0));)L=L+1|0;o[Q>>2]=H,j=j+1|0}while((j|0)!=(ue|0))}else{j=0;do{for(H=De+(j<<4)|0,Bl(H,o[Se>>2]|0,0,1)|0,H=o[H>>2]|0,L=0;Q=M+(L<<2)|0,K=o[Q>>2]|0,!((K|0)==-1|(K|0)==(H|0));)L=L+1|0;o[Q>>2]=H,j=j+1|0}while((j|0)!=(ue|0))}nt=_t}function ec(){return 12}function nl(x,T){x=x|0,T=T|0;var M=0,L=0,j=0,H=0,Q=0,K=0,ue=0;if(Jt(x|0,0,52)|0,K=gt()|0|134225919,(x|0)<1){L=0,M=0;do is(L)|0&&(Jt(L|0,0,45)|0,Q=K|(gt()|0),x=T+(M<<3)|0,o[x>>2]=-1,o[x+4>>2]=Q,M=M+1|0),L=L+1|0;while((L|0)!=122);return}Q=0,M=0;do{if(is(Q)|0){for(Jt(Q|0,0,45)|0,L=1,j=-1,H=K|(gt()|0);ue=Jt(7,0,(15-L|0)*3|0)|0,j=j&~ue,H=H&~(gt()|0),(L|0)!=(x|0);)L=L+1|0;ue=T+(M<<3)|0,o[ue>>2]=j,o[ue+4>>2]=H,M=M+1|0}Q=Q+1|0}while((Q|0)!=122)}function sl(x,T,M,L){x=x|0,T=T|0,M=M|0,L=L|0;var j=0,H=0,Q=0,K=0,ue=0,Se=0;if(K=nt,nt=nt+64|0,Q=K,(x|0)==(M|0)&(T|0)==(L|0)|(!1|(T&2013265920|0)!=134217728|(!1|(L&2013265920|0)!=134217728))||(j=Vt(x|0,T|0,52)|0,gt()|0,j=j&15,H=Vt(M|0,L|0,52)|0,gt()|0,(j|0)!=(H&15|0)))return Q=0,nt=K,Q|0;if(H=j+-1|0,j>>>0>1&&(Se=Na(x,T,H)|0,ue=gt()|0,H=Na(M,L,H)|0,(Se|0)==(H|0)&(ue|0)==(gt()|0))&&(H=(j^15)*3|0,j=Vt(x|0,T|0,H|0)|0,gt()|0,j=j&7,H=Vt(M|0,L|0,H|0)|0,gt()|0,H=H&7,(j|0)==0|(H|0)==0||(o[21136+(j<<2)>>2]|0)==(H|0)||(o[21168+(j<<2)>>2]|0)==(H|0)))return Se=1,nt=K,Se|0;j=Q,H=j+56|0;do o[j>>2]=0,j=j+4|0;while((j|0)<(H|0));return Xi(x,T,1,Q),Se=Q,!((o[Se>>2]|0)==(M|0)&&(o[Se+4>>2]|0)==(L|0))&&(Se=Q+8|0,!((o[Se>>2]|0)==(M|0)&&(o[Se+4>>2]|0)==(L|0)))&&(Se=Q+16|0,!((o[Se>>2]|0)==(M|0)&&(o[Se+4>>2]|0)==(L|0)))&&(Se=Q+24|0,!((o[Se>>2]|0)==(M|0)&&(o[Se+4>>2]|0)==(L|0)))&&(Se=Q+32|0,!((o[Se>>2]|0)==(M|0)&&(o[Se+4>>2]|0)==(L|0)))&&(Se=Q+40|0,!((o[Se>>2]|0)==(M|0)&&(o[Se+4>>2]|0)==(L|0)))?(j=Q+48|0,j=((o[j>>2]|0)==(M|0)?(o[j+4>>2]|0)==(L|0):0)&1):j=1,Se=j,nt=K,Se|0}function Mc(x,T,M,L){x=x|0,T=T|0,M=M|0,L=L|0;var j=0,H=0,Q=0,K=0,ue=0,Se=0,De=0;if(Se=nt,nt=nt+16|0,Q=Se,!(sl(x,T,M,L)|0))return K=0,ue=0,Dr(K|0),nt=Se,ue|0;for(K=T&-2130706433,j=(Ns(x,T)|0)==0,j=j?1:2;o[Q>>2]=0,De=Wn(x,T,j,Q)|0,H=j+1|0,!((De|0)==(M|0)&(gt()|0)==(L|0));)if(H>>>0<7)j=H;else{j=0,x=0,ue=6;break}return(ue|0)==6?(Dr(j|0),nt=Se,x|0):(De=Jt(j|0,0,56)|0,ue=K|(gt()|0)|268435456,De=x|De,Dr(ue|0),nt=Se,De|0)}function po(x,T){x=x|0,T=T|0;var M=0;return M=!0&(T&2013265920|0)==268435456,Dr((M?T&-2130706433|134217728:0)|0),(M?x:0)|0}function sa(x,T){x=x|0,T=T|0;var M=0,L=0,j=0;return L=nt,nt=nt+16|0,M=L,!0&(T&2013265920|0)==268435456?(j=Vt(x|0,T|0,56)|0,gt()|0,o[M>>2]=0,M=Wn(x,T&-2130706433|134217728,j&7,M)|0,T=gt()|0,Dr(T|0),nt=L,M|0):(T=0,M=0,Dr(T|0),nt=L,M|0)}function Bo(x,T){x=x|0,T=T|0;var M=0;if(!(!0&(T&2013265920|0)==268435456))return M=0,M|0;switch(M=Vt(x|0,T|0,56)|0,gt()|0,M&7){case 0:case 7:return M=0,M|0}return M=T&-2130706433|134217728,!0&(T&117440512|0)==16777216&(Ns(x,M)|0)!=0?(M=0,M|0):(M=il(x,M)|0,M|0)}function ja(x,T,M){x=x|0,T=T|0,M=M|0;var L=0,j=0,H=0,Q=0,K=0;H=nt,nt=nt+16|0,L=H,Q=!0&(T&2013265920|0)==268435456,j=T&-2130706433|134217728,K=M,o[K>>2]=Q?x:0,o[K+4>>2]=Q?j:0,Q?(T=Vt(x|0,T|0,56)|0,gt()|0,o[L>>2]=0,x=Wn(x,j,T&7,L)|0,T=gt()|0):(x=0,T=0),K=M+8|0,o[K>>2]=x,o[K+4>>2]=T,nt=H}function RA(x,T,M){x=x|0,T=T|0,M=M|0;var L=0,j=0;j=(Ns(x,T)|0)==0,T=T&-2130706433,L=M,o[L>>2]=j?x:0,o[L+4>>2]=j?T|285212672:0,L=M+8|0,o[L>>2]=x,o[L+4>>2]=T|301989888,L=M+16|0,o[L>>2]=x,o[L+4>>2]=T|318767104,L=M+24|0,o[L>>2]=x,o[L+4>>2]=T|335544320,L=M+32|0,o[L>>2]=x,o[L+4>>2]=T|352321536,M=M+40|0,o[M>>2]=x,o[M+4>>2]=T|369098752}function ol(x,T,M){x=x|0,T=T|0,M=M|0;var L=0,j=0,H=0,Q=0,K=0;if(Q=nt,nt=nt+16|0,H=Q,L=Vt(x|0,T|0,56)|0,gt()|0,K=!0&(T&2013265920|0)==268435456,j=K?x:0,x=K?T&-2130706433|134217728:0,T=UA(j,x,L&7)|0,(T|0)==-1){o[M>>2]=0,nt=Q;return}_l(j,x,H),L=Vt(j|0,x|0,52)|0,gt()|0,L=L&15,Ns(j,x)|0?uo(H,L,T,2,M):hs(H,L,T,2,M),nt=Q}function tc(x){x=x|0;var T=0,M=0,L=0;return T=Yo(1,12)|0,T||Di(22691,22646,49,22704),M=x+4|0,L=o[M>>2]|0,L|0?(L=L+8|0,o[L>>2]=T,o[M>>2]=T,T|0):(o[x>>2]|0&&Di(22721,22646,61,22744),L=x,o[L>>2]=T,o[M>>2]=T,T|0)}function gl(x,T){x=x|0,T=T|0;var M=0,L=0;return L=mo(24)|0,L||Di(22758,22646,78,22772),o[L>>2]=o[T>>2],o[L+4>>2]=o[T+4>>2],o[L+8>>2]=o[T+8>>2],o[L+12>>2]=o[T+12>>2],o[L+16>>2]=0,T=x+4|0,M=o[T>>2]|0,M|0?(o[M+16>>2]=L,o[T>>2]=L,L|0):(o[x>>2]|0&&Di(22787,22646,82,22772),o[x>>2]=L,o[T>>2]=L,L|0)}function FA(x){x=x|0;var T=0,M=0,L=0,j=0;if(x)for(L=1;;){if(T=o[x>>2]|0,T|0)do{if(M=o[T>>2]|0,M|0)do j=M,M=o[M+16>>2]|0,mr(j);while(M|0);j=T,T=o[T+8>>2]|0,mr(j)}while(T|0);if(T=x,x=o[x+8>>2]|0,L||mr(T),x)L=0;else break}}function Lo(x){x=x|0;var T=0,M=0,L=0,j=0,H=0,Q=0,K=0,ue=0,Se=0,De=0,_t=0,Xe=0,tt=0,z=0,l=0,g=0,S=0,k=0,F=0,Z=0,u=0,h=0,f=0,y=0,b=0,I=0,R=0,V=0,W=0,Y=0,le=0,fe=0;if(j=x+8|0,o[j>>2]|0)return fe=1,fe|0;if(L=o[x>>2]|0,!L)return fe=0,fe|0;T=L,M=0;do M=M+1|0,T=o[T+8>>2]|0;while(T|0);if(M>>>0<2)return fe=0,fe|0;Y=mo(M<<2)|0,Y||Di(22807,22646,317,22826),W=mo(M<<5)|0,W||Di(22848,22646,321,22826),o[x>>2]=0,h=x+4|0,o[h>>2]=0,o[j>>2]=0,M=0,V=0,u=0,_t=0;e:for(;;){if(De=o[L>>2]|0,De){H=0,Q=De;do{if(ue=+oe[Q+8>>3],T=Q,Q=o[Q+16>>2]|0,Se=(Q|0)==0,j=Se?De:Q,K=+oe[j+8>>3],+yi(+(ue-K))>3.141592653589793){fe=14;break}H=H+(K-ue)*(+oe[T>>3]+ +oe[j>>3])}while(!Se);if((fe|0)==14){fe=0,H=0,T=De;do Z=+oe[T+8>>3],R=T+16|0,I=o[R>>2]|0,I=I|0?I:De,F=+oe[I+8>>3],H=H+(+oe[T>>3]+ +oe[I>>3])*((F<0?F+6.283185307179586:F)-(Z<0?Z+6.283185307179586:Z)),T=o[(T|0?R:L)>>2]|0;while(T|0)}H>0?(o[Y+(V<<2)>>2]=L,V=V+1|0,j=u,T=_t):fe=19}else fe=19;if((fe|0)==19){fe=0;do if(M){if(T=M+8|0,o[T>>2]|0){fe=21;break e}if(M=Yo(1,12)|0,!M){fe=23;break e}o[T>>2]=M,j=M+4|0,Q=M,T=_t}else if(_t){j=h,Q=_t+8|0,T=L,M=x;break}else if(o[x>>2]|0){fe=27;break e}else{j=h,Q=x,T=L,M=x;break}while(!1);if(o[Q>>2]=L,o[j>>2]=L,Q=W+(u<<5)|0,Se=o[L>>2]|0,Se){for(De=W+(u<<5)+8|0,oe[De>>3]=17976931348623157e292,_t=W+(u<<5)+24|0,oe[_t>>3]=17976931348623157e292,oe[Q>>3]=-17976931348623157e292,Xe=W+(u<<5)+16|0,oe[Xe>>3]=-17976931348623157e292,S=17976931348623157e292,k=-17976931348623157e292,j=0,tt=Se,ue=17976931348623157e292,l=17976931348623157e292,g=-17976931348623157e292,K=-17976931348623157e292;H=+oe[tt>>3],Z=+oe[tt+8>>3],tt=o[tt+16>>2]|0,z=(tt|0)==0,F=+oe[(z?Se:tt)+8>>3],H<ue&&(oe[De>>3]=H,ue=H),Z<l&&(oe[_t>>3]=Z,l=Z),H>g?oe[Q>>3]=H:H=g,Z>K&&(oe[Xe>>3]=Z,K=Z),S=Z>0&Z<S?Z:S,k=Z<0&Z>k?Z:k,j=j|+yi(+(Z-F))>3.141592653589793,!z;)g=H;j&&(oe[Xe>>3]=k,oe[_t>>3]=S)}else o[Q>>2]=0,o[Q+4>>2]=0,o[Q+8>>2]=0,o[Q+12>>2]=0,o[Q+16>>2]=0,o[Q+20>>2]=0,o[Q+24>>2]=0,o[Q+28>>2]=0;j=u+1|0}if(R=L+8|0,L=o[R>>2]|0,o[R>>2]=0,L)u=j,_t=T;else{fe=45;break}}if((fe|0)==21)Di(22624,22646,35,22658);else if((fe|0)==23)Di(22678,22646,37,22658);else if((fe|0)==27)Di(22721,22646,61,22744);else if((fe|0)==45){e:do if((V|0)>0){for(R=(j|0)==0,b=j<<2,I=(x|0)==0,y=0,T=0;;){if(f=o[Y+(y<<2)>>2]|0,R)fe=73;else{if(u=mo(b)|0,!u){fe=50;break}if(h=mo(b)|0,!h){fe=52;break}t:do if(I)M=0;else{for(j=0,M=0,Q=x;L=W+(j<<5)|0,Xo(o[Q>>2]|0,L,o[f>>2]|0)|0?(o[u+(M<<2)>>2]=Q,o[h+(M<<2)>>2]=L,z=M+1|0):z=M,Q=o[Q+8>>2]|0,Q;)j=j+1|0,M=z;if((z|0)>0)if(L=o[u>>2]|0,(z|0)==1)M=L;else for(Xe=0,tt=-1,M=L,_t=L;;){for(Se=o[_t>>2]|0,L=0,Q=0;j=o[o[u+(Q<<2)>>2]>>2]|0,(j|0)==(Se|0)?De=L:De=L+((Xo(j,o[h+(Q<<2)>>2]|0,o[Se>>2]|0)|0)&1)|0,Q=Q+1|0,(Q|0)!=(z|0);)L=De;if(j=(De|0)>(tt|0),M=j?_t:M,L=Xe+1|0,(L|0)==(z|0))break t;Xe=L,tt=j?De:tt,_t=o[u+(L<<2)>>2]|0}else M=0}while(!1);if(mr(u),mr(h),M){if(j=M+4|0,L=o[j>>2]|0,L)M=L+8|0;else if(o[M>>2]|0){fe=70;break}o[M>>2]=f,o[j>>2]=f}else fe=73}if((fe|0)==73){if(fe=0,T=o[f>>2]|0,T|0)do h=T,T=o[T+16>>2]|0,mr(h);while(T|0);mr(f),T=2}if(y=y+1|0,(y|0)>=(V|0)){le=T;break e}}(fe|0)==50?Di(22863,22646,249,22882):(fe|0)==52?Di(22901,22646,252,22882):(fe|0)==70&&Di(22721,22646,61,22744)}else le=0;while(!1);return mr(Y),mr(W),fe=le,fe|0}return 0}function Xo(x,T,M){x=x|0,T=T|0,M=M|0;var L=0,j=0,H=0,Q=0,K=0,ue=0,Se=0,De=0;if(!(ta(T,M)|0)||(T=xn(T)|0,Se=+oe[M>>3],L=+oe[M+8>>3],L=T&L<0?L+6.283185307179586:L,x=o[x>>2]|0,!x))return x=0,x|0;if(T){T=0,M=x;e:for(;;){for(;Q=+oe[M>>3],ue=+oe[M+8>>3],M=M+16|0,De=o[M>>2]|0,De=De|0?De:x,H=+oe[De>>3],j=+oe[De+8>>3],Q>H?(K=Q,Q=ue):(K=H,H=Q,Q=j,j=ue),!!(Se<H|Se>K);)if(M=o[M>>2]|0,!M){M=22;break e}if(ue=j<0?j+6.283185307179586:j,Q=Q<0?Q+6.283185307179586:Q,L=Q==L|ue==L?L+-2220446049250313e-31:L,ue=ue+(Se-H)/(K-H)*(Q-ue),(ue<0?ue+6.283185307179586:ue)>L&&(T=T^1),M=o[M>>2]|0,!M){M=22;break}}if((M|0)==22)return T|0}else{T=0,M=x;e:for(;;){for(;Q=+oe[M>>3],ue=+oe[M+8>>3],M=M+16|0,De=o[M>>2]|0,De=De|0?De:x,H=+oe[De>>3],j=+oe[De+8>>3],Q>H?(K=Q,Q=ue):(K=H,H=Q,Q=j,j=ue),!!(Se<H|Se>K);)if(M=o[M>>2]|0,!M){M=22;break e}if(L=Q==L|j==L?L+-2220446049250313e-31:L,j+(Se-H)/(K-H)*(Q-j)>L&&(T=T^1),M=o[M>>2]|0,!M){M=22;break}}if((M|0)==22)return T|0}return 0}function wa(x,T,M,L,j){x=x|0,T=T|0,M=M|0,L=L|0,j=j|0;var H=0,Q=0,K=0,ue=0,Se=0,De=0,_t=0,Xe=0,tt=0,z=0,l=0,g=0,S=0,k=0;if(k=nt,nt=nt+32|0,S=k+16|0,g=k,H=Vt(x|0,T|0,52)|0,gt()|0,H=H&15,tt=Vt(M|0,L|0,52)|0,gt()|0,(H|0)!=(tt&15|0))return S=1,nt=k,S|0;if(Se=Vt(x|0,T|0,45)|0,gt()|0,Se=Se&127,De=Vt(M|0,L|0,45)|0,gt()|0,De=De&127,tt=(Se|0)!=(De|0),tt){if(K=vi(Se,De)|0,(K|0)==7)return S=2,nt=k,S|0;ue=vi(De,Se)|0,(ue|0)==7?Di(22925,22949,151,22959):(z=K,Q=ue)}else z=0,Q=0;_t=is(Se)|0,Xe=is(De)|0,o[S>>2]=0,o[S+4>>2]=0,o[S+8>>2]=0,o[S+12>>2]=0;do if(z){if(De=o[4304+(Se*28|0)+(z<<2)>>2]|0,K=(De|0)>0,Xe)if(K){Se=0,ue=M,K=L;do ue=LA(ue,K)|0,K=gt()|0,Q=_a(Q)|0,(Q|0)==1&&(Q=_a(1)|0),Se=Se+1|0;while((Se|0)!=(De|0));De=Q,Se=ue,ue=K}else De=Q,Se=M,ue=L;else if(K){Se=0,ue=M,K=L;do ue=Pn(ue,K)|0,K=gt()|0,Q=_a(Q)|0,Se=Se+1|0;while((Se|0)!=(De|0));De=Q,Se=ue,ue=K}else De=Q,Se=M,ue=L;if(rl(Se,ue,S)|0,tt||Di(22972,22949,181,22959),K=(_t|0)!=0,Q=(Xe|0)!=0,K&Q&&Di(22999,22949,182,22959),K){if(Q=Ws(x,T)|0,Pt[22032+(Q*7|0)+z>>0]|0){H=3;break}ue=o[21200+(Q*28|0)+(z<<2)>>2]|0,Se=ue,l=26}else if(Q){if(Q=Ws(Se,ue)|0,Pt[22032+(Q*7|0)+De>>0]|0){H=4;break}Se=0,ue=o[21200+(De*28|0)+(Q<<2)>>2]|0,l=26}else Q=0;if((l|0)==26)if((ue|0)<=-1&&Di(23030,22949,212,22959),(Se|0)<=-1&&Di(23053,22949,213,22959),(ue|0)>0){K=S+4|0,Q=0;do fl(K),Q=Q+1|0;while((Q|0)!=(ue|0));Q=Se}else Q=Se;if(o[g>>2]=0,o[g+4>>2]=0,o[g+8>>2]=0,no(g,z),H|0)for(;Rn(H)|0?Ja(g):ra(g),(H|0)>1;)H=H+-1|0;if((Q|0)>0){H=0;do fl(g),H=H+1|0;while((H|0)!=(Q|0))}l=S+4|0,ji(l,g,l),$n(l),l=50}else if(rl(M,L,S)|0,(_t|0)!=0&(Xe|0)!=0)if((De|0)!=(Se|0)&&Di(23077,22949,243,22959),Q=Ws(x,T)|0,H=Ws(M,L)|0,Pt[22032+(Q*7|0)+H>>0]|0)H=5;else if(Q=o[21200+(Q*28|0)+(H<<2)>>2]|0,(Q|0)>0){K=S+4|0,H=0;do fl(K),H=H+1|0;while((H|0)!=(Q|0));l=50}else l=50;else l=50;while(!1);return(l|0)==50&&(H=S+4|0,o[j>>2]=o[H>>2],o[j+4>>2]=o[H+4>>2],o[j+8>>2]=o[H+8>>2],H=0),S=H,nt=k,S|0}function al(x,T,M,L){x=x|0,T=T|0,M=M|0,L=L|0;var j=0,H=0,Q=0,K=0,ue=0,Se=0,De=0,_t=0,Xe=0,tt=0,z=0,l=0,g=0,S=0,k=0;if(z=nt,nt=nt+48|0,Q=z+36|0,K=z+24|0,ue=z+12|0,Se=z,H=Vt(x|0,T|0,52)|0,gt()|0,H=H&15,Xe=Vt(x|0,T|0,45)|0,gt()|0,Xe=Xe&127,De=is(Xe)|0,Jt(H|0,0,52)|0,g=gt()|0|134225919,l=L,o[l>>2]=-1,o[l+4>>2]=g,!H)return(o[M>>2]|0)>1||(o[M+4>>2]|0)>1||(o[M+8>>2]|0)>1||(j=xt(Xe,ia(M)|0)|0,(j|0)==127)?(g=1,nt=z,g|0):(tt=Jt(j|0,0,45)|0,l=gt()|0,Xe=L,l=o[Xe+4>>2]&-1040385|l,g=L,o[g>>2]=o[Xe>>2]|tt,o[g+4>>2]=l,g=0,nt=z,g|0);for(o[Q>>2]=o[M>>2],o[Q+4>>2]=o[M+4>>2],o[Q+8>>2]=o[M+8>>2];o[K>>2]=o[Q>>2],o[K+4>>2]=o[Q+4>>2],o[K+8>>2]=o[Q+8>>2],Rn(H)|0?(Pr(Q),o[ue>>2]=o[Q>>2],o[ue+4>>2]=o[Q+4>>2],o[ue+8>>2]=o[Q+8>>2],Ja(ue)):(ma(Q),o[ue>>2]=o[Q>>2],o[ue+4>>2]=o[Q+4>>2],o[ue+8>>2]=o[Q+8>>2],ra(ue)),ar(K,ue,Se),$n(Se),l=L,S=o[l>>2]|0,l=o[l+4>>2]|0,k=(15-H|0)*3|0,M=Jt(7,0,k|0)|0,l=l&~(gt()|0),k=Jt(ia(Se)|0,0,k|0)|0,l=gt()|0|l,g=L,o[g>>2]=k|S&~M,o[g+4>>2]=l,(H|0)>1;)H=H+-1|0;e:do if((o[Q>>2]|0)<=1&&(o[Q+4>>2]|0)<=1&&(o[Q+8>>2]|0)<=1){H=ia(Q)|0,K=xt(Xe,H)|0,(K|0)==127?Se=0:Se=is(K)|0;t:do if(H){if(De){if(Q=21408+((Ws(x,T)|0)*28|0)+(H<<2)|0,Q=o[Q>>2]|0,(Q|0)>0){M=0;do H=Os(H)|0,M=M+1|0;while((M|0)!=(Q|0))}if((H|0)==1){j=3;break e}M=xt(Xe,H)|0,(M|0)==127&&Di(23104,22949,376,23134),is(M)|0?Di(23147,22949,377,23134):(tt=Q,_t=H,j=M)}else tt=0,_t=H,j=K;if(ue=o[4304+(Xe*28|0)+(_t<<2)>>2]|0,(ue|0)<=-1&&Di(23178,22949,384,23134),!Se){if((tt|0)<=-1&&Di(23030,22949,417,23134),tt|0){Q=L,H=0,M=o[Q>>2]|0,Q=o[Q+4>>2]|0;do M=$o(M,Q)|0,Q=gt()|0,k=L,o[k>>2]=M,o[k+4>>2]=Q,H=H+1|0;while((H|0)<(tt|0))}if((ue|0)<=0){H=54;break}for(Q=L,H=0,M=o[Q>>2]|0,Q=o[Q+4>>2]|0;;)if(M=$o(M,Q)|0,Q=gt()|0,k=L,o[k>>2]=M,o[k+4>>2]=Q,H=H+1|0,(H|0)==(ue|0)){H=54;break t}}if(K=vi(j,Xe)|0,(K|0)==7&&Di(22925,22949,393,23134),H=L,M=o[H>>2]|0,H=o[H+4>>2]|0,(ue|0)>0){Q=0;do M=$o(M,H)|0,H=gt()|0,k=L,o[k>>2]=M,o[k+4>>2]=H,Q=Q+1|0;while((Q|0)!=(ue|0))}if(M=Ws(M,H)|0,k=YA(j)|0,M=o[(k?21824:21616)+(K*28|0)+(M<<2)>>2]|0,(M|0)<=-1&&Di(23030,22949,412,23134),!M)H=54;else{K=L,H=0,Q=o[K>>2]|0,K=o[K+4>>2]|0;do Q=ho(Q,K)|0,K=gt()|0,k=L,o[k>>2]=Q,o[k+4>>2]=K,H=H+1|0;while((H|0)<(M|0));H=54}}else if((De|0)!=0&(Se|0)!=0)if(k=Ws(x,T)|0,H=L,H=21408+(k*28|0)+((Ws(o[H>>2]|0,o[H+4>>2]|0)|0)<<2)|0,H=o[H>>2]|0,(H|0)<=-1&&Di(23201,22949,433,23134),!H)j=K,H=55;else{Q=L,j=0,M=o[Q>>2]|0,Q=o[Q+4>>2]|0;do M=$o(M,Q)|0,Q=gt()|0,k=L,o[k>>2]=M,o[k+4>>2]=Q,j=j+1|0;while((j|0)<(H|0));j=K,H=54}else j=K,H=54;while(!1);if((H|0)==54&&Se&&(H=55),(H|0)==55&&(k=L,(Ws(o[k>>2]|0,o[k+4>>2]|0)|0)==1)){j=4;break}k=L,g=o[k>>2]|0,k=o[k+4>>2]&-1040385,S=Jt(j|0,0,45)|0,k=k|(gt()|0),j=L,o[j>>2]=g|S,o[j+4>>2]=k,j=0}else j=2;while(!1);return k=j,nt=z,k|0}function yl(x,T,M,L,j){x=x|0,T=T|0,M=M|0,L=L|0,j=j|0;var H=0,Q=0;return Q=nt,nt=nt+16|0,H=Q,x=wa(x,T,M,L,H)|0,x||(Fa(H,j),x=0),nt=Q,x|0}function vu(x,T,M,L){x=x|0,T=T|0,M=M|0,L=L|0;var j=0,H=0;return j=nt,nt=nt+16|0,H=j,KA(M,H),L=al(x,T,H,L)|0,nt=j,L|0}function ic(x,T,M,L){x=x|0,T=T|0,M=M|0,L=L|0;var j=0,H=0,Q=0;return Q=nt,nt=nt+32|0,j=Q+12|0,H=Q,!(wa(x,T,x,T,j)|0)&&!(wa(x,T,M,L,H)|0)?x=el(j,H)|0:x=-1,nt=Q,x|0}function Jc(x,T,M,L){x=x|0,T=T|0,M=M|0,L=L|0;var j=0,H=0,Q=0;return Q=nt,nt=nt+32|0,j=Q+12|0,H=Q,!(wa(x,T,x,T,j)|0)&&!(wa(x,T,M,L,H)|0)?x=el(j,H)|0:x=-1,nt=Q,(x>>>31^1)+x|0}function tA(x,T,M,L,j){x=x|0,T=T|0,M=M|0,L=L|0,j=j|0;var H=0,Q=0,K=0,ue=0,Se=0,De=0,_t=0,Xe=0,tt=0,z=0,l=0,g=0,S=0,k=0,F=0,Z=0,u=0,h=0;if(u=nt,nt=nt+48|0,H=u+24|0,Q=u+12|0,Z=u,!(wa(x,T,x,T,H)|0)&&!(wa(x,T,M,L,Q)|0)){if(F=el(H,Q)|0,(F|0)<0)return Z=F,nt=u,Z|0;for(o[H>>2]=0,o[H+4>>2]=0,o[H+8>>2]=0,o[Q>>2]=0,o[Q+4>>2]=0,o[Q+8>>2]=0,wa(x,T,x,T,H)|0,wa(x,T,M,L,Q)|0,fA(H),fA(Q),F?(De=o[H>>2]|0,tt=+(F|0),g=H+4|0,_t=o[g>>2]|0,S=H+8|0,Xe=o[S>>2]|0,k=H,M=De,L=_t,H=Xe,z=+((o[Q>>2]|0)-De|0)/tt,l=+((o[Q+4>>2]|0)-_t|0)/tt,tt=+((o[Q+8>>2]|0)-Xe|0)/tt):(L=H+4|0,Xe=H+8|0,g=L,S=Xe,k=H,M=o[H>>2]|0,L=o[L>>2]|0,H=o[Xe>>2]|0,z=0,l=0,tt=0),o[Z>>2]=M,Xe=Z+4|0,o[Xe>>2]=L,_t=Z+8|0,o[_t>>2]=H,De=0;;){ue=+(De|0),h=z*ue+ +(M|0),K=l*ue+ +(o[g>>2]|0),ue=tt*ue+ +(o[S>>2]|0),L=~~+vl(+h),Q=~~+vl(+K),M=~~+vl(+ue),h=+yi(+(+(L|0)-h)),K=+yi(+(+(Q|0)-K)),ue=+yi(+(+(M|0)-ue));do if(h>K&h>ue)L=0-(Q+M)|0,H=Q;else if(Se=0-L|0,K>ue){H=Se-M|0;break}else{H=Q,M=Se-Q|0;break}while(!1);if(o[Z>>2]=L,o[Xe>>2]=H,o[_t>>2]=M,PA(Z),al(x,T,Z,j+(De<<3)|0)|0,(De|0)==(F|0))break;De=De+1|0,M=o[k>>2]|0}return Z=0,nt=u,Z|0}return Z=-1,nt=u,Z|0}function ll(x,T){x=x|0,T=T|0;var M=0;if(!T)return M=1,M|0;M=x,x=1;do x=ko(T&1|0?M:1,x)|0,T=T>>1,M=ko(M,M)|0;while(T|0);return x|0}function Ga(x,T,M){x=x|0,T=T|0,M=M|0;var L=0,j=0,H=0,Q=0,K=0,ue=0,Se=0,De=0,_t=0,Xe=0;if(!(ta(T,M)|0)||(T=xn(T)|0,Xe=+oe[M>>3],L=+oe[M+8>>3],L=T&L<0?L+6.283185307179586:L,_t=o[x>>2]|0,(_t|0)<=0))return _t=0,_t|0;if(De=o[x+4>>2]|0,T){T=0,M=-1,x=0;e:for(;;){for(Se=x;Q=+oe[De+(Se<<4)>>3],ue=+oe[De+(Se<<4)+8>>3],x=(M+2|0)%(_t|0)|0,H=+oe[De+(x<<4)>>3],j=+oe[De+(x<<4)+8>>3],Q>H?(K=Q,Q=ue):(K=H,H=Q,Q=j,j=ue),!!(Xe<H|Xe>K);)if(M=Se+1|0,(M|0)<(_t|0))x=Se,Se=M,M=x;else{M=22;break e}if(ue=j<0?j+6.283185307179586:j,Q=Q<0?Q+6.283185307179586:Q,L=Q==L|ue==L?L+-2220446049250313e-31:L,ue=ue+(Xe-H)/(K-H)*(Q-ue),(ue<0?ue+6.283185307179586:ue)>L&&(T=T^1),x=Se+1|0,(x|0)>=(_t|0)){M=22;break}else M=Se}if((M|0)==22)return T|0}else{T=0,M=-1,x=0;e:for(;;){for(Se=x;Q=+oe[De+(Se<<4)>>3],ue=+oe[De+(Se<<4)+8>>3],x=(M+2|0)%(_t|0)|0,H=+oe[De+(x<<4)>>3],j=+oe[De+(x<<4)+8>>3],Q>H?(K=Q,Q=ue):(K=H,H=Q,Q=j,j=ue),!!(Xe<H|Xe>K);)if(M=Se+1|0,(M|0)<(_t|0))x=Se,Se=M,M=x;else{M=22;break e}if(L=Q==L|j==L?L+-2220446049250313e-31:L,j+(Xe-H)/(K-H)*(Q-j)>L&&(T=T^1),x=Se+1|0,(x|0)>=(_t|0)){M=22;break}else M=Se}if((M|0)==22)return T|0}return 0}function Vi(x,T){x=x|0,T=T|0;var M=0,L=0,j=0,H=0,Q=0,K=0,ue=0,Se=0,De=0,_t=0,Xe=0,tt=0,z=0,l=0,g=0,S=0,k=0;if(z=o[x>>2]|0,!z){o[T>>2]=0,o[T+4>>2]=0,o[T+8>>2]=0,o[T+12>>2]=0,o[T+16>>2]=0,o[T+20>>2]=0,o[T+24>>2]=0,o[T+28>>2]=0;return}if(l=T+8|0,oe[l>>3]=17976931348623157e292,g=T+24|0,oe[g>>3]=17976931348623157e292,oe[T>>3]=-17976931348623157e292,S=T+16|0,oe[S>>3]=-17976931348623157e292,!((z|0)<=0)){for(Xe=o[x+4>>2]|0,Se=17976931348623157e292,De=-17976931348623157e292,_t=0,x=-1,H=17976931348623157e292,Q=17976931348623157e292,ue=-17976931348623157e292,L=-17976931348623157e292,tt=0;M=+oe[Xe+(tt<<4)>>3],K=+oe[Xe+(tt<<4)+8>>3],x=x+2|0,j=+oe[Xe+(((x|0)==(z|0)?0:x)<<4)+8>>3],M<H&&(oe[l>>3]=M,H=M),K<Q&&(oe[g>>3]=K,Q=K),M>ue?oe[T>>3]=M:M=ue,K>L&&(oe[S>>3]=K,L=K),Se=K>0&K<Se?K:Se,De=K<0&K>De?K:De,_t=_t|+yi(+(K-j))>3.141592653589793,x=tt+1|0,(x|0)!=(z|0);)k=tt,ue=M,tt=x,x=k;_t&&(oe[S>>3]=De,oe[g>>3]=Se)}}function Ro(x,T){x=x|0,T=T|0;var M=0,L=0,j=0,H=0,Q=0,K=0,ue=0,Se=0,De=0,_t=0,Xe=0,tt=0,z=0,l=0,g=0,S=0,k=0,F=0,Z=0,u=0,h=0,f=0;if(z=o[x>>2]|0,z){if(l=T+8|0,oe[l>>3]=17976931348623157e292,g=T+24|0,oe[g>>3]=17976931348623157e292,oe[T>>3]=-17976931348623157e292,S=T+16|0,oe[S>>3]=-17976931348623157e292,(z|0)>0){for(j=o[x+4>>2]|0,Xe=17976931348623157e292,tt=-17976931348623157e292,L=0,M=-1,ue=17976931348623157e292,Se=17976931348623157e292,_t=-17976931348623157e292,Q=-17976931348623157e292,k=0;H=+oe[j+(k<<4)>>3],De=+oe[j+(k<<4)+8>>3],h=M+2|0,K=+oe[j+(((h|0)==(z|0)?0:h)<<4)+8>>3],H<ue&&(oe[l>>3]=H,ue=H),De<Se&&(oe[g>>3]=De,Se=De),H>_t?oe[T>>3]=H:H=_t,De>Q&&(oe[S>>3]=De,Q=De),Xe=De>0&De<Xe?De:Xe,tt=De<0&De>tt?De:tt,L=L|+yi(+(De-K))>3.141592653589793,M=k+1|0,(M|0)!=(z|0);)h=k,_t=H,k=M,M=h;L&&(oe[S>>3]=tt,oe[g>>3]=Xe)}}else o[T>>2]=0,o[T+4>>2]=0,o[T+8>>2]=0,o[T+12>>2]=0,o[T+16>>2]=0,o[T+20>>2]=0,o[T+24>>2]=0,o[T+28>>2]=0;if(h=x+8|0,M=o[h>>2]|0,!((M|0)<=0)){u=x+12|0,Z=0;do if(j=o[u>>2]|0,L=Z,Z=Z+1|0,g=T+(Z<<5)|0,S=o[j+(L<<3)>>2]|0,S){if(k=T+(Z<<5)+8|0,oe[k>>3]=17976931348623157e292,x=T+(Z<<5)+24|0,oe[x>>3]=17976931348623157e292,oe[g>>3]=-17976931348623157e292,F=T+(Z<<5)+16|0,oe[F>>3]=-17976931348623157e292,(S|0)>0){for(z=o[j+(L<<3)+4>>2]|0,Xe=17976931348623157e292,tt=-17976931348623157e292,j=0,L=-1,l=0,ue=17976931348623157e292,Se=17976931348623157e292,De=-17976931348623157e292,Q=-17976931348623157e292;H=+oe[z+(l<<4)>>3],_t=+oe[z+(l<<4)+8>>3],L=L+2|0,K=+oe[z+(((L|0)==(S|0)?0:L)<<4)+8>>3],H<ue&&(oe[k>>3]=H,ue=H),_t<Se&&(oe[x>>3]=_t,Se=_t),H>De?oe[g>>3]=H:H=De,_t>Q&&(oe[F>>3]=_t,Q=_t),Xe=_t>0&_t<Xe?_t:Xe,tt=_t<0&_t>tt?_t:tt,j=j|+yi(+(_t-K))>3.141592653589793,L=l+1|0,(L|0)!=(S|0);)f=l,l=L,De=H,L=f;j&&(oe[F>>3]=tt,oe[x>>3]=Xe)}}else o[g>>2]=0,o[g+4>>2]=0,o[g+8>>2]=0,o[g+12>>2]=0,o[g+16>>2]=0,o[g+20>>2]=0,o[g+24>>2]=0,o[g+28>>2]=0,M=o[h>>2]|0;while((Z|0)<(M|0))}}function Za(x,T,M){x=x|0,T=T|0,M=M|0;var L=0,j=0,H=0;if(!(Ga(x,T,M)|0))return j=0,j|0;if(j=x+8|0,(o[j>>2]|0)<=0)return j=1,j|0;for(L=x+12|0,x=0;;){if(H=x,x=x+1|0,Ga((o[L>>2]|0)+(H<<3)|0,T+(x<<5)|0,M)|0){x=0,L=6;break}if((x|0)>=(o[j>>2]|0)){x=1,L=6;break}}return(L|0)==6?x|0:0}function Al(){return 8}function rc(){return 16}function Si(){return 168}function iA(){return 8}function OA(){return 16}function oa(){return 12}function _A(){return 8}function nc(x){x=x|0;var T=0,M=0;return M=+oe[x>>3],T=+oe[x+8>>3],+ +ai(+(M*M+T*T))}function VA(x,T,M,L,j){x=x|0,T=T|0,M=M|0,L=L|0,j=j|0;var H=0,Q=0,K=0,ue=0,Se=0,De=0,_t=0,Xe=0;Se=+oe[x>>3],ue=+oe[T>>3]-Se,K=+oe[x+8>>3],Q=+oe[T+8>>3]-K,_t=+oe[M>>3],H=+oe[L>>3]-_t,Xe=+oe[M+8>>3],De=+oe[L+8>>3]-Xe,H=(H*(K-Xe)-(Se-_t)*De)/(ue*De-Q*H),oe[j>>3]=Se+ue*H,oe[j+8>>3]=K+Q*H}function sc(x,T){return x=x|0,T=T|0,+oe[x>>3]!=+oe[T>>3]?(T=0,T|0):(T=+oe[x+8>>3]==+oe[T+8>>3],T|0)}function Ms(x,T){x=x|0,T=T|0;var M=0,L=0,j=0;return j=+oe[x>>3]-+oe[T>>3],L=+oe[x+8>>3]-+oe[T+8>>3],M=+oe[x+16>>3]-+oe[T+16>>3],+(j*j+L*L+M*M)}function gA(x,T){x=x|0,T=T|0;var M=0,L=0,j=0;M=+oe[x>>3],L=+gr(+M),M=+bi(+M),oe[T+16>>3]=M,M=+oe[x+8>>3],j=L*+gr(+M),oe[T>>3]=j,M=L*+bi(+M),oe[T+8>>3]=M}function NA(x,T){x=x|0,T=T|0;var M=0,L=0,j=0,H=0,Q=0,K=0,ue=0,Se=0;if(Se=nt,nt=nt+32|0,j=Se+16|0,H=Se,_l(x,T,j),Q=mA(x,T)|0,ue=Ws(x,T)|0,ei(Q,H),T=ir(Q,o[j>>2]|0)|0,!(is(Q)|0))return ue=T,nt=Se,ue|0;do switch(Q|0){case 4:{x=0,M=14;break}case 14:{x=1,M=14;break}case 24:{x=2,M=14;break}case 38:{x=3,M=14;break}case 49:{x=4,M=14;break}case 58:{x=5,M=14;break}case 63:{x=6,M=14;break}case 72:{x=7,M=14;break}case 83:{x=8,M=14;break}case 97:{x=9,M=14;break}case 107:{x=10,M=14;break}case 117:{x=11,M=14;break}default:K=0,L=0}while(!1);return(M|0)==14&&(K=o[22096+(x*24|0)+8>>2]|0,L=o[22096+(x*24|0)+16>>2]|0),x=o[j>>2]|0,(x|0)!=(o[H>>2]|0)&&(Q=YA(Q)|0,x=o[j>>2]|0,Q|(x|0)==(L|0)&&(T=(T+1|0)%6|0)),(ue|0)==3&(x|0)==(L|0)?(ue=(T+5|0)%6|0,nt=Se,ue|0):(ue|0)==5&(x|0)==(K|0)?(ue=(T+1|0)%6|0,nt=Se,ue|0):(ue=T,nt=Se,ue|0)}function UA(x,T,M){x=x|0,T=T|0,M=M|0;var L=0,j=0;return L=Ns(x,T)|0,(M+-1|0)>>>0>5||(j=(L|0)!=0,(M|0)==1&j)?(M=-1,M|0):(L=NA(x,T)|0,j?(M=(5-L+(o[22384+(M<<2)>>2]|0)|0)%5|0,M|0):(M=(6-L+(o[22416+(M<<2)>>2]|0)|0)%6|0,M|0))}function Ji(x,T,M){x=x|0,T=T|0,M=M|0;var L=0;(T|0)>0?(L=Yo(T,4)|0,o[x>>2]=L,L||Di(23230,23253,40,23267)):o[x>>2]=0,o[x+4>>2]=T,o[x+8>>2]=0,o[x+12>>2]=M}function To(x){x=x|0;var T=0,M=0,L=0,j=0,H=0,Q=0,K=0;j=x+4|0,H=x+12|0,Q=x+8|0;e:for(;;){for(M=o[j>>2]|0,T=0;;){if((T|0)>=(M|0))break e;if(L=o[x>>2]|0,K=o[L+(T<<2)>>2]|0,!K)T=T+1|0;else break}T=L+(~~(+yi(+(+pi(10,+ +(15-(o[H>>2]|0)|0))*(+oe[K>>3]+ +oe[K+8>>3])))%+(M|0))>>>0<<2)|0,M=o[T>>2]|0;t:do if(M|0){if(L=K+32|0,(M|0)==(K|0))o[T>>2]=o[L>>2];else{if(M=M+32|0,T=o[M>>2]|0,!T)break;for(;(T|0)!=(K|0);)if(M=T+32|0,T=o[M>>2]|0,!T)break t;o[M>>2]=o[L>>2]}mr(K),o[Q>>2]=(o[Q>>2]|0)+-1}while(!1)}mr(o[x>>2]|0)}function Ta(x){x=x|0;var T=0,M=0,L=0;for(L=o[x+4>>2]|0,M=0;;){if((M|0)>=(L|0)){T=0,M=4;break}if(T=o[(o[x>>2]|0)+(M<<2)>>2]|0,!T)M=M+1|0;else{M=4;break}}return(M|0)==4?T|0:0}function rA(x,T){x=x|0,T=T|0;var M=0,L=0,j=0,H=0;if(M=~~(+yi(+(+pi(10,+ +(15-(o[x+12>>2]|0)|0))*(+oe[T>>3]+ +oe[T+8>>3])))%+(o[x+4>>2]|0))>>>0,M=(o[x>>2]|0)+(M<<2)|0,L=o[M>>2]|0,!L)return H=1,H|0;H=T+32|0;do if((L|0)!=(T|0)){if(M=o[L+32>>2]|0,!M)return H=1,H|0;for(j=M;;){if((j|0)==(T|0)){j=8;break}if(M=o[j+32>>2]|0,M)L=j,j=M;else{M=1,j=10;break}}if((j|0)==8){o[L+32>>2]=o[H>>2];break}else if((j|0)==10)return M|0}else o[M>>2]=o[H>>2];while(!1);return mr(T),H=x+8|0,o[H>>2]=(o[H>>2]|0)+-1,H=0,H|0}function oc(x,T,M){x=x|0,T=T|0,M=M|0;var L=0,j=0,H=0,Q=0;H=mo(40)|0,H||Di(23283,23253,98,23296),o[H>>2]=o[T>>2],o[H+4>>2]=o[T+4>>2],o[H+8>>2]=o[T+8>>2],o[H+12>>2]=o[T+12>>2],j=H+16|0,o[j>>2]=o[M>>2],o[j+4>>2]=o[M+4>>2],o[j+8>>2]=o[M+8>>2],o[j+12>>2]=o[M+12>>2],o[H+32>>2]=0,j=~~(+yi(+(+pi(10,+ +(15-(o[x+12>>2]|0)|0))*(+oe[T>>3]+ +oe[T+8>>3])))%+(o[x+4>>2]|0))>>>0,j=(o[x>>2]|0)+(j<<2)|0,L=o[j>>2]|0;do if(!L)o[j>>2]=H;else{for(;!(Vs(L,T)|0&&Vs(L+16|0,M)|0);)if(j=o[L+32>>2]|0,L=j|0?j:L,!(o[L+32>>2]|0)){Q=10;break}if((Q|0)==10){o[L+32>>2]=H;break}return mr(H),Q=L,Q|0}while(!1);return Q=x+8|0,o[Q>>2]=(o[Q>>2]|0)+1,Q=H,Q|0}function nA(x,T,M){x=x|0,T=T|0,M=M|0;var L=0,j=0;if(j=~~(+yi(+(+pi(10,+ +(15-(o[x+12>>2]|0)|0))*(+oe[T>>3]+ +oe[T+8>>3])))%+(o[x+4>>2]|0))>>>0,j=o[(o[x>>2]|0)+(j<<2)>>2]|0,!j)return M=0,M|0;if(!M){for(x=j;;){if(Vs(x,T)|0){L=10;break}if(x=o[x+32>>2]|0,!x){x=0,L=10;break}}if((L|0)==10)return x|0}for(x=j;;){if(Vs(x,T)|0&&Vs(x+16|0,M)|0){L=10;break}if(x=o[x+32>>2]|0,!x){x=0,L=10;break}}return(L|0)==10?x|0:0}function xl(x,T){x=x|0,T=T|0;var M=0;if(M=~~(+yi(+(+pi(10,+ +(15-(o[x+12>>2]|0)|0))*(+oe[T>>3]+ +oe[T+8>>3])))%+(o[x+4>>2]|0))>>>0,x=o[(o[x>>2]|0)+(M<<2)>>2]|0,!x)return M=0,M|0;for(;;){if(Vs(x,T)|0){T=5;break}if(x=o[x+32>>2]|0,!x){x=0,T=5;break}}return(T|0)==5?x|0:0}function Ss(){return 23312}function aa(x){return x=+x,+ +la(+x)}function Gn(x){return x=+x,~~+aa(x)|0}function mo(x){x=x|0;var T=0,M=0,L=0,j=0,H=0,Q=0,K=0,ue=0,Se=0,De=0,_t=0,Xe=0,tt=0,z=0,l=0,g=0,S=0,k=0,F=0,Z=0,u=0;u=nt,nt=nt+16|0,Xe=u;do if(x>>>0<245){if(Se=x>>>0<11?16:x+11&-8,x=Se>>>3,_t=o[5829]|0,M=_t>>>x,M&3|0)return T=(M&1^1)+x|0,x=23356+(T<<1<<2)|0,M=x+8|0,L=o[M>>2]|0,j=L+8|0,H=o[j>>2]|0,(H|0)==(x|0)?o[5829]=_t&~(1<<T):(o[H+12>>2]=x,o[M>>2]=H),Z=T<<3,o[L+4>>2]=Z|3,Z=L+Z+4|0,o[Z>>2]=o[Z>>2]|1,Z=j,nt=u,Z|0;if(De=o[5831]|0,Se>>>0>De>>>0){if(M|0)return T=2<<x,T=M<<x&(T|0-T),T=(T&0-T)+-1|0,K=T>>>12&16,T=T>>>K,M=T>>>5&8,T=T>>>M,H=T>>>2&4,T=T>>>H,x=T>>>1&2,T=T>>>x,L=T>>>1&1,L=(M|K|H|x|L)+(T>>>L)|0,T=23356+(L<<1<<2)|0,x=T+8|0,H=o[x>>2]|0,K=H+8|0,M=o[K>>2]|0,(M|0)==(T|0)?(x=_t&~(1<<L),o[5829]=x):(o[M+12>>2]=T,o[x>>2]=M,x=_t),Z=L<<3,Q=Z-Se|0,o[H+4>>2]=Se|3,j=H+Se|0,o[j+4>>2]=Q|1,o[H+Z>>2]=Q,De|0&&(L=o[5834]|0,T=De>>>3,M=23356+(T<<1<<2)|0,T=1<<T,x&T?(x=M+8|0,T=o[x>>2]|0):(o[5829]=x|T,T=M,x=M+8|0),o[x>>2]=L,o[T+12>>2]=L,o[L+8>>2]=T,o[L+12>>2]=M),o[5831]=Q,o[5834]=j,Z=K,nt=u,Z|0;if(H=o[5830]|0,H){for(M=(H&0-H)+-1|0,j=M>>>12&16,M=M>>>j,L=M>>>5&8,M=M>>>L,Q=M>>>2&4,M=M>>>Q,K=M>>>1&2,M=M>>>K,ue=M>>>1&1,ue=o[23620+((L|j|Q|K|ue)+(M>>>ue)<<2)>>2]|0,M=ue,K=ue,ue=(o[ue+4>>2]&-8)-Se|0;x=o[M+16>>2]|0,!(!x&&(x=o[M+20>>2]|0,!x));)Q=(o[x+4>>2]&-8)-Se|0,j=Q>>>0<ue>>>0,M=x,K=j?x:K,ue=j?Q:ue;if(Q=K+Se|0,Q>>>0>K>>>0){j=o[K+24>>2]|0,T=o[K+12>>2]|0;do if((T|0)==(K|0)){if(x=K+20|0,T=o[x>>2]|0,!T&&(x=K+16|0,T=o[x>>2]|0,!T)){M=0;break}for(;;)if(L=T+20|0,M=o[L>>2]|0,M)T=M,x=L;else if(L=T+16|0,M=o[L>>2]|0,M)T=M,x=L;else break;o[x>>2]=0,M=T}else M=o[K+8>>2]|0,o[M+12>>2]=T,o[T+8>>2]=M,M=T;while(!1);do if(j|0){if(T=o[K+28>>2]|0,x=23620+(T<<2)|0,(K|0)==(o[x>>2]|0)){if(o[x>>2]=M,!M){o[5830]=H&~(1<<T);break}}else if(Z=j+16|0,o[((o[Z>>2]|0)==(K|0)?Z:j+20|0)>>2]=M,!M)break;o[M+24>>2]=j,T=o[K+16>>2]|0,T|0&&(o[M+16>>2]=T,o[T+24>>2]=M),T=o[K+20>>2]|0,T|0&&(o[M+20>>2]=T,o[T+24>>2]=M)}while(!1);return ue>>>0<16?(Z=ue+Se|0,o[K+4>>2]=Z|3,Z=K+Z+4|0,o[Z>>2]=o[Z>>2]|1):(o[K+4>>2]=Se|3,o[Q+4>>2]=ue|1,o[Q+ue>>2]=ue,De|0&&(L=o[5834]|0,T=De>>>3,M=23356+(T<<1<<2)|0,T=1<<T,T&_t?(x=M+8|0,T=o[x>>2]|0):(o[5829]=T|_t,T=M,x=M+8|0),o[x>>2]=L,o[T+12>>2]=L,o[L+8>>2]=T,o[L+12>>2]=M),o[5831]=ue,o[5834]=Q),Z=K+8|0,nt=u,Z|0}else _t=Se}else _t=Se}else _t=Se}else if(x>>>0<=4294967231)if(x=x+11|0,Se=x&-8,L=o[5830]|0,L){j=0-Se|0,x=x>>>8,x?Se>>>0>16777215?ue=31:(_t=(x+1048320|0)>>>16&8,l=x<<_t,K=(l+520192|0)>>>16&4,l=l<<K,ue=(l+245760|0)>>>16&2,ue=14-(K|_t|ue)+(l<<ue>>>15)|0,ue=Se>>>(ue+7|0)&1|ue<<1):ue=0,M=o[23620+(ue<<2)>>2]|0;e:do if(!M)M=0,x=0,l=61;else for(x=0,K=Se<<((ue|0)==31?0:25-(ue>>>1)|0),H=0;;){if(Q=(o[M+4>>2]&-8)-Se|0,Q>>>0<j>>>0)if(Q)x=M,j=Q;else{x=M,j=0,l=65;break e}if(l=o[M+20>>2]|0,M=o[M+16+(K>>>31<<2)>>2]|0,H=(l|0)==0|(l|0)==(M|0)?H:l,M)K=K<<1;else{M=H,l=61;break}}while(!1);if((l|0)==61){if((M|0)==0&(x|0)==0){if(x=2<<ue,x=(x|0-x)&L,!x){_t=Se;break}_t=(x&0-x)+-1|0,Q=_t>>>12&16,_t=_t>>>Q,H=_t>>>5&8,_t=_t>>>H,K=_t>>>2&4,_t=_t>>>K,ue=_t>>>1&2,_t=_t>>>ue,M=_t>>>1&1,x=0,M=o[23620+((H|Q|K|ue|M)+(_t>>>M)<<2)>>2]|0}M?l=65:(K=x,Q=j)}if((l|0)==65)for(H=M;;)if(_t=(o[H+4>>2]&-8)-Se|0,M=_t>>>0<j>>>0,j=M?_t:j,x=M?H:x,M=o[H+16>>2]|0,M||(M=o[H+20>>2]|0),M)H=M;else{K=x,Q=j;break}if(K|0&&Q>>>0<((o[5831]|0)-Se|0)>>>0&&(De=K+Se|0,De>>>0>K>>>0)){H=o[K+24>>2]|0,T=o[K+12>>2]|0;do if((T|0)==(K|0)){if(x=K+20|0,T=o[x>>2]|0,!T&&(x=K+16|0,T=o[x>>2]|0,!T)){T=0;break}for(;;)if(j=T+20|0,M=o[j>>2]|0,M)T=M,x=j;else if(j=T+16|0,M=o[j>>2]|0,M)T=M,x=j;else break;o[x>>2]=0}else Z=o[K+8>>2]|0,o[Z+12>>2]=T,o[T+8>>2]=Z;while(!1);do if(H){if(x=o[K+28>>2]|0,M=23620+(x<<2)|0,(K|0)==(o[M>>2]|0)){if(o[M>>2]=T,!T){L=L&~(1<<x),o[5830]=L;break}}else if(Z=H+16|0,o[((o[Z>>2]|0)==(K|0)?Z:H+20|0)>>2]=T,!T)break;o[T+24>>2]=H,x=o[K+16>>2]|0,x|0&&(o[T+16>>2]=x,o[x+24>>2]=T),x=o[K+20>>2]|0,x&&(o[T+20>>2]=x,o[x+24>>2]=T)}while(!1);e:do if(Q>>>0<16)Z=Q+Se|0,o[K+4>>2]=Z|3,Z=K+Z+4|0,o[Z>>2]=o[Z>>2]|1;else{if(o[K+4>>2]=Se|3,o[De+4>>2]=Q|1,o[De+Q>>2]=Q,T=Q>>>3,Q>>>0<256){M=23356+(T<<1<<2)|0,x=o[5829]|0,T=1<<T,x&T?(x=M+8|0,T=o[x>>2]|0):(o[5829]=x|T,T=M,x=M+8|0),o[x>>2]=De,o[T+12>>2]=De,o[De+8>>2]=T,o[De+12>>2]=M;break}if(T=Q>>>8,T?Q>>>0>16777215?M=31:(F=(T+1048320|0)>>>16&8,Z=T<<F,k=(Z+520192|0)>>>16&4,Z=Z<<k,M=(Z+245760|0)>>>16&2,M=14-(k|F|M)+(Z<<M>>>15)|0,M=Q>>>(M+7|0)&1|M<<1):M=0,T=23620+(M<<2)|0,o[De+28>>2]=M,x=De+16|0,o[x+4>>2]=0,o[x>>2]=0,x=1<<M,!(L&x)){o[5830]=L|x,o[T>>2]=De,o[De+24>>2]=T,o[De+12>>2]=De,o[De+8>>2]=De;break}T=o[T>>2]|0;t:do if((o[T+4>>2]&-8|0)!=(Q|0)){for(L=Q<<((M|0)==31?0:25-(M>>>1)|0);M=T+16+(L>>>31<<2)|0,x=o[M>>2]|0,!!x;)if((o[x+4>>2]&-8|0)==(Q|0)){T=x;break t}else L=L<<1,T=x;o[M>>2]=De,o[De+24>>2]=T,o[De+12>>2]=De,o[De+8>>2]=De;break e}while(!1);F=T+8|0,Z=o[F>>2]|0,o[Z+12>>2]=De,o[F>>2]=De,o[De+8>>2]=Z,o[De+12>>2]=T,o[De+24>>2]=0}while(!1);return Z=K+8|0,nt=u,Z|0}else _t=Se}else _t=Se;else _t=-1;while(!1);if(M=o[5831]|0,M>>>0>=_t>>>0)return T=M-_t|0,x=o[5834]|0,T>>>0>15?(Z=x+_t|0,o[5834]=Z,o[5831]=T,o[Z+4>>2]=T|1,o[x+M>>2]=T,o[x+4>>2]=_t|3):(o[5831]=0,o[5834]=0,o[x+4>>2]=M|3,Z=x+M+4|0,o[Z>>2]=o[Z>>2]|1),Z=x+8|0,nt=u,Z|0;if(Q=o[5832]|0,Q>>>0>_t>>>0)return k=Q-_t|0,o[5832]=k,Z=o[5835]|0,F=Z+_t|0,o[5835]=F,o[F+4>>2]=k|1,o[Z+4>>2]=_t|3,Z=Z+8|0,nt=u,Z|0;if(o[5947]|0?x=o[5949]|0:(o[5949]=4096,o[5948]=4096,o[5950]=-1,o[5951]=-1,o[5952]=0,o[5940]=0,o[5947]=Xe&-16^1431655768,x=4096),K=_t+48|0,ue=_t+47|0,H=x+ue|0,j=0-x|0,Se=H&j,Se>>>0<=_t>>>0||(x=o[5939]|0,x|0&&(De=o[5937]|0,Xe=De+Se|0,Xe>>>0<=De>>>0|Xe>>>0>x>>>0)))return Z=0,nt=u,Z|0;e:do if(o[5940]&4)T=0,l=143;else{M=o[5835]|0;t:do if(M){for(L=23764;Xe=o[L>>2]|0,!(Xe>>>0<=M>>>0&&(Xe+(o[L+4>>2]|0)|0)>>>0>M>>>0);)if(x=o[L+8>>2]|0,x)L=x;else{l=128;break t}if(T=H-Q&j,T>>>0<2147483647)if(x=Zn(T|0)|0,(x|0)==((o[L>>2]|0)+(o[L+4>>2]|0)|0)){if((x|0)!=-1){Q=T,H=x,l=145;break e}}else L=x,l=136;else T=0}else l=128;while(!1);do if((l|0)==128)if(M=Zn(0)|0,(M|0)!=-1&&(T=M,tt=o[5948]|0,z=tt+-1|0,T=(z&T|0?(z+T&0-tt)-T|0:0)+Se|0,tt=o[5937]|0,z=T+tt|0,T>>>0>_t>>>0&T>>>0<2147483647)){if(Xe=o[5939]|0,Xe|0&&z>>>0<=tt>>>0|z>>>0>Xe>>>0){T=0;break}if(x=Zn(T|0)|0,(x|0)==(M|0)){Q=T,H=M,l=145;break e}else L=x,l=136}else T=0;while(!1);do if((l|0)==136){if(M=0-T|0,!(K>>>0>T>>>0&(T>>>0<2147483647&(L|0)!=-1)))if((L|0)==-1){T=0;break}else{Q=T,H=L,l=145;break e}if(x=o[5949]|0,x=ue-T+x&0-x,x>>>0>=2147483647){Q=T,H=L,l=145;break e}if((Zn(x|0)|0)==-1){Zn(M|0)|0,T=0;break}else{Q=x+T|0,H=L,l=145;break e}}while(!1);o[5940]=o[5940]|4,l=143}while(!1);if((l|0)==143&&Se>>>0<2147483647&&(k=Zn(Se|0)|0,z=Zn(0)|0,g=z-k|0,S=g>>>0>(_t+40|0)>>>0,!((k|0)==-1|S^1|k>>>0<z>>>0&((k|0)!=-1&(z|0)!=-1)^1))&&(Q=S?g:T,H=k,l=145),(l|0)==145){T=(o[5937]|0)+Q|0,o[5937]=T,T>>>0>(o[5938]|0)>>>0&&(o[5938]=T),ue=o[5835]|0;e:do if(ue){for(T=23764;;){if(x=o[T>>2]|0,M=o[T+4>>2]|0,(H|0)==(x+M|0)){l=154;break}if(L=o[T+8>>2]|0,L)T=L;else break}if((l|0)==154&&(F=T+4|0,(o[T+12>>2]&8|0)==0)&&H>>>0>ue>>>0&x>>>0<=ue>>>0){o[F>>2]=M+Q,Z=(o[5832]|0)+Q|0,k=ue+8|0,k=k&7|0?0-k&7:0,F=ue+k|0,k=Z-k|0,o[5835]=F,o[5832]=k,o[F+4>>2]=k|1,o[ue+Z+4>>2]=40,o[5836]=o[5951];break}for(H>>>0<(o[5833]|0)>>>0&&(o[5833]=H),M=H+Q|0,T=23764;;){if((o[T>>2]|0)==(M|0)){l=162;break}if(x=o[T+8>>2]|0,x)T=x;else break}if((l|0)==162&&!(o[T+12>>2]&8|0)){o[T>>2]=H,De=T+4|0,o[De>>2]=(o[De>>2]|0)+Q,De=H+8|0,De=H+(De&7|0?0-De&7:0)|0,T=M+8|0,T=M+(T&7|0?0-T&7:0)|0,Se=De+_t|0,K=T-De-_t|0,o[De+4>>2]=_t|3;t:do if((ue|0)==(T|0))Z=(o[5832]|0)+K|0,o[5832]=Z,o[5835]=Se,o[Se+4>>2]=Z|1;else{if((o[5834]|0)==(T|0)){Z=(o[5831]|0)+K|0,o[5831]=Z,o[5834]=Se,o[Se+4>>2]=Z|1,o[Se+Z>>2]=Z;break}if(x=o[T+4>>2]|0,(x&3|0)==1){Q=x&-8,L=x>>>3;i:do if(x>>>0<256)if(x=o[T+8>>2]|0,M=o[T+12>>2]|0,(M|0)==(x|0)){o[5829]=o[5829]&~(1<<L);break}else{o[x+12>>2]=M,o[M+8>>2]=x;break}else{H=o[T+24>>2]|0,x=o[T+12>>2]|0;do if((x|0)==(T|0)){if(M=T+16|0,L=M+4|0,x=o[L>>2]|0,x)M=L;else if(x=o[M>>2]|0,!x){x=0;break}for(;;)if(j=x+20|0,L=o[j>>2]|0,L)x=L,M=j;else if(j=x+16|0,L=o[j>>2]|0,L)x=L,M=j;else break;o[M>>2]=0}else Z=o[T+8>>2]|0,o[Z+12>>2]=x,o[x+8>>2]=Z;while(!1);if(!H)break;M=o[T+28>>2]|0,L=23620+(M<<2)|0;do if((o[L>>2]|0)!=(T|0)){if(Z=H+16|0,o[((o[Z>>2]|0)==(T|0)?Z:H+20|0)>>2]=x,!x)break i}else{if(o[L>>2]=x,x|0)break;o[5830]=o[5830]&~(1<<M);break i}while(!1);if(o[x+24>>2]=H,M=T+16|0,L=o[M>>2]|0,L|0&&(o[x+16>>2]=L,o[L+24>>2]=x),M=o[M+4>>2]|0,!M)break;o[x+20>>2]=M,o[M+24>>2]=x}while(!1);T=T+Q|0,j=Q+K|0}else j=K;if(T=T+4|0,o[T>>2]=o[T>>2]&-2,o[Se+4>>2]=j|1,o[Se+j>>2]=j,T=j>>>3,j>>>0<256){M=23356+(T<<1<<2)|0,x=o[5829]|0,T=1<<T,x&T?(x=M+8|0,T=o[x>>2]|0):(o[5829]=x|T,T=M,x=M+8|0),o[x>>2]=Se,o[T+12>>2]=Se,o[Se+8>>2]=T,o[Se+12>>2]=M;break}T=j>>>8;do if(!T)L=0;else{if(j>>>0>16777215){L=31;break}F=(T+1048320|0)>>>16&8,Z=T<<F,k=(Z+520192|0)>>>16&4,Z=Z<<k,L=(Z+245760|0)>>>16&2,L=14-(k|F|L)+(Z<<L>>>15)|0,L=j>>>(L+7|0)&1|L<<1}while(!1);if(T=23620+(L<<2)|0,o[Se+28>>2]=L,x=Se+16|0,o[x+4>>2]=0,o[x>>2]=0,x=o[5830]|0,M=1<<L,!(x&M)){o[5830]=x|M,o[T>>2]=Se,o[Se+24>>2]=T,o[Se+12>>2]=Se,o[Se+8>>2]=Se;break}T=o[T>>2]|0;i:do if((o[T+4>>2]&-8|0)!=(j|0)){for(L=j<<((L|0)==31?0:25-(L>>>1)|0);M=T+16+(L>>>31<<2)|0,x=o[M>>2]|0,!!x;)if((o[x+4>>2]&-8|0)==(j|0)){T=x;break i}else L=L<<1,T=x;o[M>>2]=Se,o[Se+24>>2]=T,o[Se+12>>2]=Se,o[Se+8>>2]=Se;break t}while(!1);F=T+8|0,Z=o[F>>2]|0,o[Z+12>>2]=Se,o[F>>2]=Se,o[Se+8>>2]=Z,o[Se+12>>2]=T,o[Se+24>>2]=0}while(!1);return Z=De+8|0,nt=u,Z|0}for(T=23764;x=o[T>>2]|0,!(x>>>0<=ue>>>0&&(Z=x+(o[T+4>>2]|0)|0,Z>>>0>ue>>>0));)T=o[T+8>>2]|0;j=Z+-47|0,x=j+8|0,x=j+(x&7|0?0-x&7:0)|0,j=ue+16|0,x=x>>>0<j>>>0?ue:x,T=x+8|0,M=Q+-40|0,k=H+8|0,k=k&7|0?0-k&7:0,F=H+k|0,k=M-k|0,o[5835]=F,o[5832]=k,o[F+4>>2]=k|1,o[H+M+4>>2]=40,o[5836]=o[5951],M=x+4|0,o[M>>2]=27,o[T>>2]=o[5941],o[T+4>>2]=o[5942],o[T+8>>2]=o[5943],o[T+12>>2]=o[5944],o[5941]=H,o[5942]=Q,o[5944]=0,o[5943]=T,T=x+24|0;do F=T,T=T+4|0,o[T>>2]=7;while((F+8|0)>>>0<Z>>>0);if((x|0)!=(ue|0)){if(H=x-ue|0,o[M>>2]=o[M>>2]&-2,o[ue+4>>2]=H|1,o[x>>2]=H,T=H>>>3,H>>>0<256){M=23356+(T<<1<<2)|0,x=o[5829]|0,T=1<<T,x&T?(x=M+8|0,T=o[x>>2]|0):(o[5829]=x|T,T=M,x=M+8|0),o[x>>2]=ue,o[T+12>>2]=ue,o[ue+8>>2]=T,o[ue+12>>2]=M;break}if(T=H>>>8,T?H>>>0>16777215?L=31:(F=(T+1048320|0)>>>16&8,Z=T<<F,k=(Z+520192|0)>>>16&4,Z=Z<<k,L=(Z+245760|0)>>>16&2,L=14-(k|F|L)+(Z<<L>>>15)|0,L=H>>>(L+7|0)&1|L<<1):L=0,M=23620+(L<<2)|0,o[ue+28>>2]=L,o[ue+20>>2]=0,o[j>>2]=0,T=o[5830]|0,x=1<<L,!(T&x)){o[5830]=T|x,o[M>>2]=ue,o[ue+24>>2]=M,o[ue+12>>2]=ue,o[ue+8>>2]=ue;break}T=o[M>>2]|0;t:do if((o[T+4>>2]&-8|0)!=(H|0)){for(L=H<<((L|0)==31?0:25-(L>>>1)|0);M=T+16+(L>>>31<<2)|0,x=o[M>>2]|0,!!x;)if((o[x+4>>2]&-8|0)==(H|0)){T=x;break t}else L=L<<1,T=x;o[M>>2]=ue,o[ue+24>>2]=T,o[ue+12>>2]=ue,o[ue+8>>2]=ue;break e}while(!1);F=T+8|0,Z=o[F>>2]|0,o[Z+12>>2]=ue,o[F>>2]=ue,o[ue+8>>2]=Z,o[ue+12>>2]=T,o[ue+24>>2]=0}}else Z=o[5833]|0,(Z|0)==0|H>>>0<Z>>>0&&(o[5833]=H),o[5941]=H,o[5942]=Q,o[5944]=0,o[5838]=o[5947],o[5837]=-1,o[5842]=23356,o[5841]=23356,o[5844]=23364,o[5843]=23364,o[5846]=23372,o[5845]=23372,o[5848]=23380,o[5847]=23380,o[5850]=23388,o[5849]=23388,o[5852]=23396,o[5851]=23396,o[5854]=23404,o[5853]=23404,o[5856]=23412,o[5855]=23412,o[5858]=23420,o[5857]=23420,o[5860]=23428,o[5859]=23428,o[5862]=23436,o[5861]=23436,o[5864]=23444,o[5863]=23444,o[5866]=23452,o[5865]=23452,o[5868]=23460,o[5867]=23460,o[5870]=23468,o[5869]=23468,o[5872]=23476,o[5871]=23476,o[5874]=23484,o[5873]=23484,o[5876]=23492,o[5875]=23492,o[5878]=23500,o[5877]=23500,o[5880]=23508,o[5879]=23508,o[5882]=23516,o[5881]=23516,o[5884]=23524,o[5883]=23524,o[5886]=23532,o[5885]=23532,o[5888]=23540,o[5887]=23540,o[5890]=23548,o[5889]=23548,o[5892]=23556,o[5891]=23556,o[5894]=23564,o[5893]=23564,o[5896]=23572,o[5895]=23572,o[5898]=23580,o[5897]=23580,o[5900]=23588,o[5899]=23588,o[5902]=23596,o[5901]=23596,o[5904]=23604,o[5903]=23604,Z=Q+-40|0,k=H+8|0,k=k&7|0?0-k&7:0,F=H+k|0,k=Z-k|0,o[5835]=F,o[5832]=k,o[F+4>>2]=k|1,o[H+Z+4>>2]=40,o[5836]=o[5951];while(!1);if(T=o[5832]|0,T>>>0>_t>>>0)return k=T-_t|0,o[5832]=k,Z=o[5835]|0,F=Z+_t|0,o[5835]=F,o[F+4>>2]=k|1,o[Z+4>>2]=_t|3,Z=Z+8|0,nt=u,Z|0}return Z=Ss()|0,o[Z>>2]=12,Z=0,nt=u,Z|0}function mr(x){x=x|0;var T=0,M=0,L=0,j=0,H=0,Q=0,K=0,ue=0;if(x){M=x+-8|0,j=o[5833]|0,x=o[x+-4>>2]|0,T=x&-8,ue=M+T|0;do if(x&1)K=M,Q=M;else{if(L=o[M>>2]|0,!(x&3)||(Q=M+(0-L)|0,H=L+T|0,Q>>>0<j>>>0))return;if((o[5834]|0)==(Q|0)){if(x=ue+4|0,T=o[x>>2]|0,(T&3|0)!=3){K=Q,T=H;break}o[5831]=H,o[x>>2]=T&-2,o[Q+4>>2]=H|1,o[Q+H>>2]=H;return}if(M=L>>>3,L>>>0<256)if(x=o[Q+8>>2]|0,T=o[Q+12>>2]|0,(T|0)==(x|0)){o[5829]=o[5829]&~(1<<M),K=Q,T=H;break}else{o[x+12>>2]=T,o[T+8>>2]=x,K=Q,T=H;break}j=o[Q+24>>2]|0,x=o[Q+12>>2]|0;do if((x|0)==(Q|0)){if(T=Q+16|0,M=T+4|0,x=o[M>>2]|0,x)T=M;else if(x=o[T>>2]|0,!x){x=0;break}for(;;)if(L=x+20|0,M=o[L>>2]|0,M)x=M,T=L;else if(L=x+16|0,M=o[L>>2]|0,M)x=M,T=L;else break;o[T>>2]=0}else K=o[Q+8>>2]|0,o[K+12>>2]=x,o[x+8>>2]=K;while(!1);if(j){if(T=o[Q+28>>2]|0,M=23620+(T<<2)|0,(o[M>>2]|0)==(Q|0)){if(o[M>>2]=x,!x){o[5830]=o[5830]&~(1<<T),K=Q,T=H;break}}else if(K=j+16|0,o[((o[K>>2]|0)==(Q|0)?K:j+20|0)>>2]=x,!x){K=Q,T=H;break}o[x+24>>2]=j,T=Q+16|0,M=o[T>>2]|0,M|0&&(o[x+16>>2]=M,o[M+24>>2]=x),T=o[T+4>>2]|0,T?(o[x+20>>2]=T,o[T+24>>2]=x,K=Q,T=H):(K=Q,T=H)}else K=Q,T=H}while(!1);if(!(Q>>>0>=ue>>>0)&&(x=ue+4|0,L=o[x>>2]|0,!!(L&1))){if(L&2)o[x>>2]=L&-2,o[K+4>>2]=T|1,o[Q+T>>2]=T,j=T;else{if((o[5835]|0)==(ue|0)){if(ue=(o[5832]|0)+T|0,o[5832]=ue,o[5835]=K,o[K+4>>2]=ue|1,(K|0)!=(o[5834]|0))return;o[5834]=0,o[5831]=0;return}if((o[5834]|0)==(ue|0)){ue=(o[5831]|0)+T|0,o[5831]=ue,o[5834]=Q,o[K+4>>2]=ue|1,o[Q+ue>>2]=ue;return}j=(L&-8)+T|0,M=L>>>3;do if(L>>>0<256)if(T=o[ue+8>>2]|0,x=o[ue+12>>2]|0,(x|0)==(T|0)){o[5829]=o[5829]&~(1<<M);break}else{o[T+12>>2]=x,o[x+8>>2]=T;break}else{H=o[ue+24>>2]|0,x=o[ue+12>>2]|0;do if((x|0)==(ue|0)){if(T=ue+16|0,M=T+4|0,x=o[M>>2]|0,x)T=M;else if(x=o[T>>2]|0,!x){M=0;break}for(;;)if(L=x+20|0,M=o[L>>2]|0,M)x=M,T=L;else if(L=x+16|0,M=o[L>>2]|0,M)x=M,T=L;else break;o[T>>2]=0,M=x}else M=o[ue+8>>2]|0,o[M+12>>2]=x,o[x+8>>2]=M,M=x;while(!1);if(H|0){if(x=o[ue+28>>2]|0,T=23620+(x<<2)|0,(o[T>>2]|0)==(ue|0)){if(o[T>>2]=M,!M){o[5830]=o[5830]&~(1<<x);break}}else if(L=H+16|0,o[((o[L>>2]|0)==(ue|0)?L:H+20|0)>>2]=M,!M)break;o[M+24>>2]=H,x=ue+16|0,T=o[x>>2]|0,T|0&&(o[M+16>>2]=T,o[T+24>>2]=M),x=o[x+4>>2]|0,x|0&&(o[M+20>>2]=x,o[x+24>>2]=M)}}while(!1);if(o[K+4>>2]=j|1,o[Q+j>>2]=j,(K|0)==(o[5834]|0)){o[5831]=j;return}}if(x=j>>>3,j>>>0<256){M=23356+(x<<1<<2)|0,T=o[5829]|0,x=1<<x,T&x?(T=M+8|0,x=o[T>>2]|0):(o[5829]=T|x,x=M,T=M+8|0),o[T>>2]=K,o[x+12>>2]=K,o[K+8>>2]=x,o[K+12>>2]=M;return}x=j>>>8,x?j>>>0>16777215?L=31:(Q=(x+1048320|0)>>>16&8,ue=x<<Q,H=(ue+520192|0)>>>16&4,ue=ue<<H,L=(ue+245760|0)>>>16&2,L=14-(H|Q|L)+(ue<<L>>>15)|0,L=j>>>(L+7|0)&1|L<<1):L=0,x=23620+(L<<2)|0,o[K+28>>2]=L,o[K+20>>2]=0,o[K+16>>2]=0,T=o[5830]|0,M=1<<L;e:do if(!(T&M))o[5830]=T|M,o[x>>2]=K,o[K+24>>2]=x,o[K+12>>2]=K,o[K+8>>2]=K;else{x=o[x>>2]|0;t:do if((o[x+4>>2]&-8|0)!=(j|0)){for(L=j<<((L|0)==31?0:25-(L>>>1)|0);M=x+16+(L>>>31<<2)|0,T=o[M>>2]|0,!!T;)if((o[T+4>>2]&-8|0)==(j|0)){x=T;break t}else L=L<<1,x=T;o[M>>2]=K,o[K+24>>2]=x,o[K+12>>2]=K,o[K+8>>2]=K;break e}while(!1);Q=x+8|0,ue=o[Q>>2]|0,o[ue+12>>2]=K,o[Q>>2]=K,o[K+8>>2]=ue,o[K+12>>2]=x,o[K+24>>2]=0}while(!1);if(ue=(o[5837]|0)+-1|0,o[5837]=ue,!(ue|0)){for(x=23772;x=o[x>>2]|0,x;)x=x+8|0;o[5837]=-1}}}}function Yo(x,T){x=x|0,T=T|0;var M=0;return x?(M=ko(T,x)|0,(T|x)>>>0>65535&&(M=((M>>>0)/(x>>>0)|0|0)==(T|0)?M:-1)):M=0,x=mo(M)|0,!x||!(o[x+-4>>2]&3)||tn(x|0,0,M|0)|0,x|0}function ac(x,T,M,L){return x=x|0,T=T|0,M=M|0,L=L|0,M=x+M>>>0,Dr(T+L+(M>>>0<x>>>0|0)>>>0|0),M|0|0}function Ol(x,T,M,L){return x=x|0,T=T|0,M=M|0,L=L|0,L=T-L-(M>>>0>x>>>0|0)>>>0,Dr(L|0),x-M>>>0|0|0}function lc(x){return x=x|0,(x?31-(qo(x^x-1)|0)|0:32)|0}function _o(x,T,M,L,j){x=x|0,T=T|0,M=M|0,L=L|0,j=j|0;var H=0,Q=0,K=0,ue=0,Se=0,De=0,_t=0,Xe=0,tt=0,z=0;if(De=x,ue=T,Se=ue,Q=M,Xe=L,K=Xe,!Se)return H=(j|0)!=0,K?H?(o[j>>2]=x|0,o[j+4>>2]=T&0,Xe=0,j=0,Dr(Xe|0),j|0):(Xe=0,j=0,Dr(Xe|0),j|0):(H&&(o[j>>2]=(De>>>0)%(Q>>>0),o[j+4>>2]=0),Xe=0,j=(De>>>0)/(Q>>>0)>>>0,Dr(Xe|0),j|0);H=(K|0)==0;do if(Q){if(!H){if(H=(qo(K|0)|0)-(qo(Se|0)|0)|0,H>>>0<=31){_t=H+1|0,K=31-H|0,T=H-31>>31,Q=_t,x=De>>>(_t>>>0)&T|Se<<K,T=Se>>>(_t>>>0)&T,H=0,K=De<<K;break}return j?(o[j>>2]=x|0,o[j+4>>2]=ue|T&0,Xe=0,j=0,Dr(Xe|0),j|0):(Xe=0,j=0,Dr(Xe|0),j|0)}if(H=Q-1|0,H&Q|0){K=(qo(Q|0)|0)+33-(qo(Se|0)|0)|0,z=64-K|0,_t=32-K|0,ue=_t>>31,tt=K-32|0,T=tt>>31,Q=K,x=_t-1>>31&Se>>>(tt>>>0)|(Se<<_t|De>>>(K>>>0))&T,T=T&Se>>>(K>>>0),H=De<<z&ue,K=(Se<<z|De>>>(tt>>>0))&ue|De<<_t&K-33>>31;break}return j|0&&(o[j>>2]=H&De,o[j+4>>2]=0),(Q|0)==1?(tt=ue|T&0,z=x|0|0,Dr(tt|0),z|0):(z=lc(Q|0)|0,tt=Se>>>(z>>>0)|0,z=Se<<32-z|De>>>(z>>>0)|0,Dr(tt|0),z|0)}else{if(H)return j|0&&(o[j>>2]=(Se>>>0)%(Q>>>0),o[j+4>>2]=0),tt=0,z=(Se>>>0)/(Q>>>0)>>>0,Dr(tt|0),z|0;if(!De)return j|0&&(o[j>>2]=0,o[j+4>>2]=(Se>>>0)%(K>>>0)),tt=0,z=(Se>>>0)/(K>>>0)>>>0,Dr(tt|0),z|0;if(H=K-1|0,!(H&K))return j|0&&(o[j>>2]=x|0,o[j+4>>2]=H&Se|T&0),tt=0,z=Se>>>((lc(K|0)|0)>>>0),Dr(tt|0),z|0;if(H=(qo(K|0)|0)-(qo(Se|0)|0)|0,H>>>0<=30){T=H+1|0,K=31-H|0,Q=T,x=Se<<K|De>>>(T>>>0),T=Se>>>(T>>>0),H=0,K=De<<K;break}return j?(o[j>>2]=x|0,o[j+4>>2]=ue|T&0,tt=0,z=0,Dr(tt|0),z|0):(tt=0,z=0,Dr(tt|0),z|0)}while(!1);if(!Q)Se=K,ue=0,K=0;else{_t=M|0|0,De=Xe|L&0,Se=ac(_t|0,De|0,-1,-1)|0,M=gt()|0,ue=K,K=0;do L=ue,ue=H>>>31|ue<<1,H=K|H<<1,L=x<<1|L>>>31|0,Xe=x>>>31|T<<1|0,Ol(Se|0,M|0,L|0,Xe|0)|0,z=gt()|0,tt=z>>31|((z|0)<0?-1:0)<<1,K=tt&1,x=Ol(L|0,Xe|0,tt&_t|0,(((z|0)<0?-1:0)>>31|((z|0)<0?-1:0)<<1)&De|0)|0,T=gt()|0,Q=Q-1|0;while(Q|0);Se=ue,ue=0}return Q=0,j|0&&(o[j>>2]=x,o[j+4>>2]=T),tt=(H|0)>>>31|(Se|Q)<<1|(Q<<1|H>>>31)&0|ue,z=(H<<1|0)&-2|K,Dr(tt|0),z|0}function Ea(x,T,M,L){x=x|0,T=T|0,M=M|0,L=L|0;var j=0,H=0;return H=nt,nt=nt+16|0,j=H|0,_o(x,T,M,L,j)|0,nt=H,Dr(o[j+4>>2]|0),o[j>>2]|0|0}function Vt(x,T,M){return x=x|0,T=T|0,M=M|0,(M|0)<32?(Dr(T>>>M|0),x>>>M|(T&(1<<M)-1)<<32-M):(Dr(0),T>>>M-32|0)}function Jt(x,T,M){return x=x|0,T=T|0,M=M|0,(M|0)<32?(Dr(T<<M|(x&(1<<M)-1<<32-M)>>>32-M|0),x<<M):(Dr(x<<M-32|0),0)}function sA(x,T){return x=+x,T=+T,x!=x?+T:T!=T?+x:+nn(+x,+T)}function vl(x){return x=+x,x>=0?+xi(x+.5):+Rs(x-.5)}function Vl(x,T,M){x=x|0,T=T|0,M=M|0;var L=0,j=0,H=0;if((M|0)>=8192)return Hs(x|0,T|0,M|0)|0,x|0;if(H=x|0,j=x+M|0,(x&3)==(T&3)){for(;x&3;){if(!M)return H|0;Pt[x>>0]=Pt[T>>0]|0,x=x+1|0,T=T+1|0,M=M-1|0}for(M=j&-4|0,L=M-64|0;(x|0)<=(L|0);)o[x>>2]=o[T>>2],o[x+4>>2]=o[T+4>>2],o[x+8>>2]=o[T+8>>2],o[x+12>>2]=o[T+12>>2],o[x+16>>2]=o[T+16>>2],o[x+20>>2]=o[T+20>>2],o[x+24>>2]=o[T+24>>2],o[x+28>>2]=o[T+28>>2],o[x+32>>2]=o[T+32>>2],o[x+36>>2]=o[T+36>>2],o[x+40>>2]=o[T+40>>2],o[x+44>>2]=o[T+44>>2],o[x+48>>2]=o[T+48>>2],o[x+52>>2]=o[T+52>>2],o[x+56>>2]=o[T+56>>2],o[x+60>>2]=o[T+60>>2],x=x+64|0,T=T+64|0;for(;(x|0)<(M|0);)o[x>>2]=o[T>>2],x=x+4|0,T=T+4|0}else for(M=j-4|0;(x|0)<(M|0);)Pt[x>>0]=Pt[T>>0]|0,Pt[x+1>>0]=Pt[T+1>>0]|0,Pt[x+2>>0]=Pt[T+2>>0]|0,Pt[x+3>>0]=Pt[T+3>>0]|0,x=x+4|0,T=T+4|0;for(;(x|0)<(j|0);)Pt[x>>0]=Pt[T>>0]|0,x=x+1|0,T=T+1|0;return H|0}function tn(x,T,M){x=x|0,T=T|0,M=M|0;var L=0,j=0,H=0,Q=0;if(H=x+M|0,T=T&255,(M|0)>=67){for(;x&3;)Pt[x>>0]=T,x=x+1|0;for(L=H&-4|0,Q=T|T<<8|T<<16|T<<24,j=L-64|0;(x|0)<=(j|0);)o[x>>2]=Q,o[x+4>>2]=Q,o[x+8>>2]=Q,o[x+12>>2]=Q,o[x+16>>2]=Q,o[x+20>>2]=Q,o[x+24>>2]=Q,o[x+28>>2]=Q,o[x+32>>2]=Q,o[x+36>>2]=Q,o[x+40>>2]=Q,o[x+44>>2]=Q,o[x+48>>2]=Q,o[x+52>>2]=Q,o[x+56>>2]=Q,o[x+60>>2]=Q,x=x+64|0;for(;(x|0)<(L|0);)o[x>>2]=Q,x=x+4|0}for(;(x|0)<(H|0);)Pt[x>>0]=T,x=x+1|0;return H-M|0}function la(x){return x=+x,x>=0?+xi(x+.5):+Rs(x-.5)}function Zn(x){x=x|0;var T=0,M=0,L=0;return L=Ar()|0,M=o[ti>>2]|0,T=M+x|0,(x|0)>0&(T|0)<(M|0)|(T|0)<0?(kl(T|0)|0,Je(12),-1):(T|0)>(L|0)&&!(DA(T|0)|0)?(Je(12),-1):(o[ti>>2]=T,M|0)}return{___uremdi3:Ea,_bitshift64Lshr:Vt,_bitshift64Shl:Jt,_calloc:Yo,_cellAreaKm2:tl,_cellAreaM2:pA,_cellAreaRads2:Tc,_compact:na,_destroyLinkedPolygon:FA,_edgeLengthKm:xa,_edgeLengthM:ns,_emscripten_replace_memory:yn,_exactEdgeLengthKm:pl,_exactEdgeLengthM:Ln,_exactEdgeLengthRads:zo,_experimentalH3ToLocalIj:yl,_experimentalLocalIjToH3:vu,_free:mr,_geoToH3:Ua,_getDestinationH3IndexFromUnidirectionalEdge:sa,_getH3IndexesFromUnidirectionalEdge:ja,_getH3UnidirectionalEdge:Mc,_getH3UnidirectionalEdgeBoundary:ol,_getH3UnidirectionalEdgesFromHexagon:RA,_getOriginH3IndexFromUnidirectionalEdge:po,_getPentagonIndexes:nl,_getRes0Indexes:Ho,_h3Distance:ic,_h3GetBaseCell:mA,_h3GetFaces:Mt,_h3GetResolution:Ec,_h3IndexesAreNeighbors:sl,_h3IsPentagon:Ns,_h3IsResClassIII:JA,_h3IsValid:il,_h3Line:tA,_h3LineSize:Jc,_h3SetToLinkedGeo:uA,_h3ToCenterChild:oo,_h3ToChildren:Ps,_h3ToGeo:fo,_h3ToGeoBoundary:ba,_h3ToParent:Na,_h3UnidirectionalEdgeIsValid:Bo,_hexAreaKm2:eA,_hexAreaM2:Gi,_hexRing:co,_i64Subtract:Ol,_kRing:Xi,_kRingDistances:mn,_llvm_minnum_f64:sA,_llvm_round_f64:vl,_malloc:mo,_maxFaceCount:Fl,_maxH3ToChildrenSize:xu,_maxKringSize:WA,_maxPolyfillSize:Ds,_maxUncompactSize:Kc,_memcpy:Vl,_memset:tn,_numHexagons:Tn,_pentagonIndexCount:ec,_pointDistKm:Rl,_pointDistM:BA,_pointDistRads:cs,_polyfill:Dl,_res0IndexCount:Do,_round:la,_sbrk:Zn,_sizeOfCoordIJ:_A,_sizeOfGeoBoundary:Si,_sizeOfGeoCoord:rc,_sizeOfGeoPolygon:OA,_sizeOfGeofence:iA,_sizeOfH3Index:Al,_sizeOfLinkedGeoPolygon:oa,_uncompact:ml,establishStackSpace:ro,stackAlloc:Ze,stackRestore:Xl,stackSave:As}}(io,Sr,tr);ne.___uremdi3=kt.___uremdi3,ne._bitshift64Lshr=kt._bitshift64Lshr,ne._bitshift64Shl=kt._bitshift64Shl,ne._calloc=kt._calloc,ne._cellAreaKm2=kt._cellAreaKm2,ne._cellAreaM2=kt._cellAreaM2,ne._cellAreaRads2=kt._cellAreaRads2,ne._compact=kt._compact,ne._destroyLinkedPolygon=kt._destroyLinkedPolygon,ne._edgeLengthKm=kt._edgeLengthKm,ne._edgeLengthM=kt._edgeLengthM;var we=ne._emscripten_replace_memory=kt._emscripten_replace_memory;ne._exactEdgeLengthKm=kt._exactEdgeLengthKm,ne._exactEdgeLengthM=kt._exactEdgeLengthM,ne._exactEdgeLengthRads=kt._exactEdgeLengthRads,ne._experimentalH3ToLocalIj=kt._experimentalH3ToLocalIj,ne._experimentalLocalIjToH3=kt._experimentalLocalIjToH3,ne._free=kt._free,ne._geoToH3=kt._geoToH3,ne._getDestinationH3IndexFromUnidirectionalEdge=kt._getDestinationH3IndexFromUnidirectionalEdge,ne._getH3IndexesFromUnidirectionalEdge=kt._getH3IndexesFromUnidirectionalEdge,ne._getH3UnidirectionalEdge=kt._getH3UnidirectionalEdge,ne._getH3UnidirectionalEdgeBoundary=kt._getH3UnidirectionalEdgeBoundary,ne._getH3UnidirectionalEdgesFromHexagon=kt._getH3UnidirectionalEdgesFromHexagon,ne._getOriginH3IndexFromUnidirectionalEdge=kt._getOriginH3IndexFromUnidirectionalEdge,ne._getPentagonIndexes=kt._getPentagonIndexes,ne._getRes0Indexes=kt._getRes0Indexes,ne._h3Distance=kt._h3Distance,ne._h3GetBaseCell=kt._h3GetBaseCell,ne._h3GetFaces=kt._h3GetFaces,ne._h3GetResolution=kt._h3GetResolution,ne._h3IndexesAreNeighbors=kt._h3IndexesAreNeighbors,ne._h3IsPentagon=kt._h3IsPentagon,ne._h3IsResClassIII=kt._h3IsResClassIII,ne._h3IsValid=kt._h3IsValid,ne._h3Line=kt._h3Line,ne._h3LineSize=kt._h3LineSize,ne._h3SetToLinkedGeo=kt._h3SetToLinkedGeo,ne._h3ToCenterChild=kt._h3ToCenterChild,ne._h3ToChildren=kt._h3ToChildren,ne._h3ToGeo=kt._h3ToGeo,ne._h3ToGeoBoundary=kt._h3ToGeoBoundary,ne._h3ToParent=kt._h3ToParent,ne._h3UnidirectionalEdgeIsValid=kt._h3UnidirectionalEdgeIsValid,ne._hexAreaKm2=kt._hexAreaKm2,ne._hexAreaM2=kt._hexAreaM2,ne._hexRing=kt._hexRing,ne._i64Subtract=kt._i64Subtract,ne._kRing=kt._kRing,ne._kRingDistances=kt._kRingDistances,ne._llvm_minnum_f64=kt._llvm_minnum_f64,ne._llvm_round_f64=kt._llvm_round_f64,ne._malloc=kt._malloc,ne._maxFaceCount=kt._maxFaceCount,ne._maxH3ToChildrenSize=kt._maxH3ToChildrenSize,ne._maxKringSize=kt._maxKringSize,ne._maxPolyfillSize=kt._maxPolyfillSize,ne._maxUncompactSize=kt._maxUncompactSize,ne._memcpy=kt._memcpy,ne._memset=kt._memset,ne._numHexagons=kt._numHexagons,ne._pentagonIndexCount=kt._pentagonIndexCount,ne._pointDistKm=kt._pointDistKm,ne._pointDistM=kt._pointDistM,ne._pointDistRads=kt._pointDistRads,ne._polyfill=kt._polyfill,ne._res0IndexCount=kt._res0IndexCount,ne._round=kt._round,ne._sbrk=kt._sbrk,ne._sizeOfCoordIJ=kt._sizeOfCoordIJ,ne._sizeOfGeoBoundary=kt._sizeOfGeoBoundary,ne._sizeOfGeoCoord=kt._sizeOfGeoCoord,ne._sizeOfGeoPolygon=kt._sizeOfGeoPolygon,ne._sizeOfGeofence=kt._sizeOfGeofence,ne._sizeOfH3Index=kt._sizeOfH3Index,ne._sizeOfLinkedGeoPolygon=kt._sizeOfLinkedGeoPolygon,ne._uncompact=kt._uncompact,ne.establishStackSpace=kt.establishStackSpace;var Ae=ne.stackAlloc=kt.stackAlloc,pe=ne.stackRestore=kt.stackRestore,Te=ne.stackSave=kt.stackSave;if(ne.asm=kt,ne.cwrap=kr,ne.setValue=qt,ne.getValue=$t,ne.getTempRet0=Rt,Ft){ni(Ft)||(Ft=dt(Ft));{$e();var Be=function(xe){xe.byteLength&&(xe=new Uint8Array(xe)),Nn.set(xe,yt),ne.memoryInitializerRequest&&delete ne.memoryInitializerRequest.response,Pe()},Ve=function(){Bt(Ft,Be,function(){throw"could not load memory initializer "+Ft})},Ke=Cn(Ft);if(Ke)Be(Ke.buffer);else if(ne.memoryInitializerRequest){var Qe=function(){var xe=ne.memoryInitializerRequest,Me=xe.response;if(xe.status!==200&&xe.status!==0){var ct=Cn(ne.memoryInitializerRequestURL);if(ct)Me=ct.buffer;else{console.warn("a problem seems to have happened with Module.memoryInitializerRequest, status: "+xe.status+", retrying "+Ft),Ve();return}}Be(Me)};ne.memoryInitializerRequest.response?setTimeout(Qe,0):ne.memoryInitializerRequest.addEventListener("load",Qe)}else Ve()}}var Ge;Ue=function xe(){Ge||He(),Ge||(Ue=xe)};function He(xe){if(Yt>0||(zt(),Yt>0))return;function Me(){Ge||(Ge=!0,!ui&&(dr(),In(),ne.onRuntimeInitialized&&ne.onRuntimeInitialized(),Es()))}ne.setStatus?(ne.setStatus("Running..."),setTimeout(function(){setTimeout(function(){ne.setStatus("")},1),Me()},1)):Me()}ne.run=He;function Et(xe){throw ne.onAbort&&ne.onAbort(xe),xe+="",P(xe),We(xe),ui=!0,"abort("+xe+"). Build with -s ASSERTIONS=1 for more info."}if(ne.abort=Et,ne.preInit)for(typeof ne.preInit=="function"&&(ne.preInit=[ne.preInit]);ne.preInit.length>0;)ne.preInit.pop()();return He(),Le}(typeof I_=="object"?I_:{}),Ur="number",np=Ur,An=Ur,Mn=Ur,CA=Ur,os=Ur,l5=[["sizeOfH3Index",Ur],["sizeOfGeoCoord",Ur],["sizeOfGeoBoundary",Ur],["sizeOfGeoPolygon",Ur],["sizeOfGeofence",Ur],["sizeOfLinkedGeoPolygon",Ur],["sizeOfCoordIJ",Ur],["h3IsValid",np,[An,Mn]],["geoToH3",An,[Ur,Ur,CA]],["h3ToGeo",null,[An,Mn,os]],["h3ToGeoBoundary",null,[An,Mn,os]],["maxKringSize",Ur,[Ur]],["kRing",null,[An,Mn,Ur,os]],["kRingDistances",null,[An,Mn,Ur,os,os]],["hexRing",null,[An,Mn,Ur,os]],["maxPolyfillSize",Ur,[os,CA]],["polyfill",null,[os,CA,os]],["h3SetToLinkedGeo",null,[os,Ur,os]],["destroyLinkedPolygon",null,[os]],["compact",Ur,[os,os,Ur]],["uncompact",Ur,[os,Ur,os,Ur,CA]],["maxUncompactSize",Ur,[os,Ur,CA]],["h3IsPentagon",np,[An,Mn]],["h3IsResClassIII",np,[An,Mn]],["h3GetBaseCell",Ur,[An,Mn]],["h3GetResolution",Ur,[An,Mn]],["maxFaceCount",Ur,[An,Mn]],["h3GetFaces",null,[An,Mn,os]],["h3ToParent",An,[An,Mn,CA]],["h3ToChildren",null,[An,Mn,CA,os]],["h3ToCenterChild",An,[An,Mn,CA]],["maxH3ToChildrenSize",Ur,[An,Mn,CA]],["h3IndexesAreNeighbors",np,[An,Mn,An,Mn]],["getH3UnidirectionalEdge",An,[An,Mn,An,Mn]],["getOriginH3IndexFromUnidirectionalEdge",An,[An,Mn]],["getDestinationH3IndexFromUnidirectionalEdge",An,[An,Mn]],["h3UnidirectionalEdgeIsValid",np,[An,Mn]],["getH3IndexesFromUnidirectionalEdge",null,[An,Mn,os]],["getH3UnidirectionalEdgesFromHexagon",null,[An,Mn,os]],["getH3UnidirectionalEdgeBoundary",null,[An,Mn,os]],["h3Distance",Ur,[An,Mn,An,Mn]],["h3Line",Ur,[An,Mn,An,Mn,os]],["h3LineSize",Ur,[An,Mn,An,Mn]],["experimentalH3ToLocalIj",Ur,[An,Mn,An,Mn,os]],["experimentalLocalIjToH3",Ur,[An,Mn,os,os]],["hexAreaM2",Ur,[CA]],["hexAreaKm2",Ur,[CA]],["edgeLengthM",Ur,[CA]],["edgeLengthKm",Ur,[CA]],["pointDistM",Ur,[os,os]],["pointDistKm",Ur,[os,os]],["pointDistRads",Ur,[os,os]],["cellAreaM2",Ur,[An,Mn]],["cellAreaKm2",Ur,[An,Mn]],["cellAreaRads2",Ur,[An,Mn]],["exactEdgeLengthM",Ur,[An,Mn]],["exactEdgeLengthKm",Ur,[An,Mn]],["exactEdgeLengthRads",Ur,[An,Mn]],["numHexagons",Ur,[CA]],["getRes0Indexes",null,[os]],["res0IndexCount",Ur],["getPentagonIndexes",null,[Ur,os]],["pentagonIndexCount",Ur]],wh={};l5.forEach(function(ne){wh[ne[0]]=I_.cwrap.apply(I_,ne)});wh.sizeOfH3Index();wh.sizeOfGeoCoord();wh.sizeOfGeoBoundary();wh.sizeOfGeoPolygon();wh.sizeOfGeofence();wh.sizeOfLinkedGeoPolygon();wh.sizeOfCoordIJ();function A5(Le){let ne,Fe,ze,wt;return ne=new o5({props:{update:Le[1]}}),ze=new oI({props:{selectionData:Le[0]}}),{c(){sd(ne.$$.fragment),Fe=Ad(),sd(ze.$$.fragment)},l(dt){od(ne.$$.fragment,dt),Fe=cd(dt),od(ze.$$.fragment,dt)},m(dt,Bt){ad(ne,dt,Bt),ud(dt,Fe,Bt),ad(ze,dt,Bt),wt=!0},p(dt,[Bt]){const P={};Bt&1&&(P.selectionData=dt[0]),ze.$set(P)},i(dt){wt||(kA(ne.$$.fragment,dt),kA(ze.$$.fragment,dt),wt=!0)},o(dt){bc(ne.$$.fragment,dt),bc(ze.$$.fragment,dt),wt=!1},d(dt){dt&&vc(Fe),ld(ne,dt),ld(ze,dt)}}}function c5(Le,ne,Fe){let ze={latlng:{lat:0,lng:0},hex:""};function wt(dt){console.log("updating!!"),Fe(0,ze=dt)}return[ze,wt]}class p5 extends vh{constructor(ne){super(),bh(this,ne,c5,A5,xh,{})}}export{p5 as component};
