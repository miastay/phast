<script>

    import * as phylotree from 'phylotree';
    import * as d3 from 'd3';
	import { onMount } from 'svelte';
    import { getBrandColors } from '../util/colors';
    import { selectionData } from '../store';

    export let newick;
    export let present;
    export let hex_id;
    export let clade;
    $: $selectionData && rerender($selectionData.hex);
    $: if(present && !treemap) buildNodeMap(present);

    export let header = true;

    let treeref;
    let treemap;

    let tooltipX, tooltipY;
    let showTooltip = false;
    let tooltipText = '';
    let tooltipFlip = false;

    
    let width = 1000;
    let height = 1000;

    function rerender(hex_id) {

        console.log("attempting rerender")
        console.log($selectionData)
        console.log(treeref, hex_id)

        let nwk = '(((((((((((Tyrannus_verticalis:4.001433,(Tyrannus_tyrannus:3.53811,Tyrannus_vociferans:3.53811):0.463323):2.959154,(Myiarchus_cinerascens:2.014245,Myiarchus_tyrannulus:2.014245):4.946342):1.597191,((((Empidonax_difficilis:4.450615,((((Empidonax_oberholseri:2.161306,Empidonax_hammondii:2.161306):0.842122,Empidonax_minimus:3.003428):0.213631,Empidonax_wrightii:3.217059):0.929523,Empidonax_traillii:4.146582):0.304032):0.148682,(Contopus_sordidulus:3.526572,Contopus_cooperi:3.526571):1.072725):0.325545,(Sayornis_saya:3.781439,Sayornis_nigricans:3.781439):1.143402):3.069996,Pyrocephalus_rubinus:7.994837):0.56294):19.243085,(((((Chamaea_fasciata:12.429713,((((Riparia_riparia:6.967223,(Tachycineta_thalassina:4.679356,Tachycineta_bicolor:4.679355):2.287867):0.197341,(Stelgidopteryx_serripennis:6.278306,Progne_subis:6.278307):0.886257):0.999496,(Petrochelidon_pyrrhonota:7.596176,Hirundo_rustica:7.596175):0.567883):3.908347,Psaltriparus_minimus:12.072407):0.357305):3.198033,Eremophila_alpestris:15.627745):0.954938,(((Poecile_rufescens:3.381344,(Poecile_gambeli:2.366328,Poecile_atricapillus:2.366328):1.015016):2.5912,(Baeolophus_inornatus:1.885773,Baeolophus_ridgwayi:1.885773):4.086771):6.604761,Auriparus_flaviceps:12.577305):4.005378):1.204803,(((((Cinclus_mexicanus:14.257735,((Turdus_migratorius:9.645123,((Catharus_guttatus:5.110876,Catharus_ustulatus:5.110876):3.731149,Ixoreus_naevius:8.842026):0.803098):2.400322,(Myadestes_townsendi:11.383646,(Sialia_currucoides:3.141333,Sialia_mexicana:3.141332):8.242315):0.661799):2.21229):0.472993,(Sturnus_vulgaris:11.154101,((Mimus_polyglottos:5.122579,Oreoscoptes_montanus:5.12258):1.517727,(Toxostoma_bendirei:4.640856,((Toxostoma_lecontei:2.747447,Toxostoma_crissale:2.747447):0.857103,Toxostoma_redivivum:3.60455):1.036307):1.999449):4.513794):3.576628):2.188836,((((((Campylorhynchus_brunneicapillus:6.585247,Thryomanes_bewickii:6.585247):0.601549,(Troglodytes_aedon:5.644158,Cistothorus_palustris:5.644159):1.542638):0.934231,(Catherpes_mexicanus:6.20663,Salpinctes_obsoletus:6.20663):1.914396):3.05437,((Polioptila_californica:1.690149,Polioptila_melanura:1.690149):1.702386,Polioptila_caerulea:3.392536):7.782861):2.80982,Certhia_americana:13.985217):1.128942,((Sitta_canadensis:6.561379,Sitta_pygmaea:6.56138):1.810662,Sitta_carolinensis:8.37204):6.742118):1.805406):0.407621,(((Bombycilla_garrulus:3.757978,Bombycilla_cedrorum:3.757978):8.174507,Phainopepla_nitens:11.932485):4.887578,Regulus_satrapa:16.820063):0.507124):0.145318,(((((((((Passerina_caerulea:2.570987,Passerina_amoena:2.570987):1.680228,Passerina_cyanea:4.251215):2.855821,((Piranga_ludoviciana:4.343958,Piranga_rubra:4.343958):2.254702,Cardinalis_cardinalis:6.598661):0.508374):0.258533,Pheucticus_melanocephalus:7.365567):1.805195,(((((((Euphagus_cyanocephalus:4.083924,(Molothrus_aeneus:1.212313,Molothrus_ater:1.212313):2.871611):0.187559,(Agelaius_phoeniceus:3.000792,Agelaius_tricolor:3.000792):1.270691):2.148377,(Icterus_cucullatus:4.501935,(Icterus_parisorum:3.486088,Icterus_galbula:3.486089):1.015845):1.917926):0.524545,(Sturnella_neglecta:6.36353,Xanthocephalus_xanthocephalus:6.36353):0.580875):0.481912,Icteria_virens:7.426317):0.371308,((((((((Setophaga_townsendi:0.205227,Setophaga_occidentalis:0.205227):0.950551,Setophaga_nigrescens:1.155778):0.925938,(Setophaga_coronata:1.835635,Setophaga_palmarum:1.835635):0.246081):0.150194,Setophaga_petechia:2.231909):0.420317,Setophaga_ruticilla:2.652226):1.343903,(Cardellina_rubrifrons:2.573805,Cardellina_pusilla:2.573805):1.422325):0.307199,(Geothlypis_trichas:3.17745,Geothlypis_tolmiei:3.17745):1.125879):0.24755,(Parkesia_noveboracensis:3.921106,Mniotilta_varia:3.921106):0.629773):3.246746):0.860785,((Ammodramus_savannarum:7.22603,((Spizella_atrogularis:3.327185,(Spizella_breweri:2.319898,Spizella_passerina:2.319898):1.007287):3.419478,((Calamospiza_melanocorys:5.462612,Amphispiza_bilineata:5.462613):0.473245,Chondestes_grammacus:5.935857):0.810805):0.479369):0.284235,(((Pooecetes_gramineus:4.482169,(((Melospiza_lincolnii:1.264886,Melospiza_georgiana:1.264886):0.837596,Melospiza_melodia:2.102483):1.773568,Passerculus_sandwichensis:3.876051):0.606118):1.04583,((Pipilo_maculatus:2.033152,Pipilo_chlorurus:2.033153):2.918452,((Melozone_aberti:0.89701,Melozone_crissalis:0.89701):3.214586,Aimophila_ruficeps:4.111597):0.840007):0.576396):0.208553,(Junco_hyemalis:4.32944,(Zonotrichia_albicollis:1.482363,(Zonotrichia_atricapilla:0.331305,Zonotrichia_leucophrys:0.331305):1.151058):2.847076):1.407113):1.773713):1.148145):0.512351):0.561069,Calcarius_lapponicus:9.731831):1.359019,(((Spinus_pinus:3.142395,(Spinus_tristis:2.540467,(Spinus_psaltria:1.162173,Spinus_lawrencei:1.162173):1.378294):0.601928):1.6301,(Loxia_leucoptera:1.210478,Loxia_curvirostra:1.210477):3.562017):2.7703,(Leucosticte_tephrocotis:6.423852,Pinicola_enucleator:6.423852):1.11894):3.548056):0.547327,(Anthus_rubescens:5.935911,Anthus_spragueii:5.935912):5.702265):0.415079,Passer_domesticus:12.053257):5.419249):0.314981):2.469957,((Vireo_gilvus:3.302798,(((Vireo_cassinii:0.402464,Vireo_plumbeus:0.402464):1.942187,(Vireo_vicinior:2.056349,Vireo_huttoni:2.056349):0.288302):0.466454,Vireo_bellii:2.811106):0.491692):12.019837,(Lanius_ludovicianus:11.409307,(((((Corvus_corax:4.701119,Corvus_brachyrhynchos:4.701119):1.990164,Nucifraga_columbiana:6.691283):1.298672,Pica_hudsonia:7.989953):0.514906,((Gymnorhinus_cyanocephalus:6.126222,Aphelocoma_californica:6.126222):0.683341,Cyanocitta_stelleri:6.809564):1.695297):0.40107,Perisoreus_canadensis:8.905929):2.503378):3.913326):4.934811):7.543419):10.368133,(Brotogeris_chiriri:10.109007,(Amazona_finschi:1.862114,Amazona_viridigenalis:1.862114):8.246892):28.059987):0.875789,((Falco_mexicanus:3.250519,Falco_peregrinus:3.250519):1.551005,(Falco_columbarius:4.340078,Falco_sparverius:4.340078):0.461445):34.243259):18.167212,(((((((Sphyrapicus_ruber:0.691321,Sphyrapicus_nuchalis:0.691321):4.673796,Sphyrapicus_thyroideus:5.365118):3.383365,(Melanerpes_uropygialis:7.684308,(Melanerpes_formicivorus:7.035306,Melanerpes_lewis:7.035306):0.649002):1.064176):0.729339,Picoides_arcticus:9.477822):26.111884,Megaceryle_alcyon:35.589708):21.232651,(((((Megascops_kennicottii:9.535534,Bubo_virginianus:9.535534):0.399666,(Strix_nebulosa:8.157754,(Strix_varia:6.649511,Strix_occidentalis:6.649511):1.508244):1.777446):0.688896,(Asio_otus:6.154249,Asio_flammeus:6.154249):4.469847):2.862398,(((Glaucidium_gnoma:10.483593,Athene_cunicularia:10.483593):0.73703,Aegolius_acadicus:11.220624):0.978771,Micrathene_whitneyi:12.199394):1.2871):8.747286,Tyto_alba:22.233781):34.588578):0.214221,((((Aquila_chrysaetos:7.964539,((((((Buteo_swainsoni:1.391803,(Buteo_albonotatus:1.258194,(Buteo_regalis:0.408815,Buteo_lagopus:0.408815):0.84938):0.13361):0.246285,Buteo_jamaicensis:1.638089):0.602243,Buteo_lineatus:2.240332):1.894991,Parabuteo_unicinctus:4.135322):2.246454,Haliaeetus_leucocephalus:6.381778):0.568816,(Accipiter_striatus:5.309671,Accipiter_cooperii:5.30967):1.640922):1.013948):2.988594,Elanus_leucurus:10.953135):1.124614,Pandion_haliaetus:12.07775):4.511346,((Coragyps_atratus:3.554197,Gymnogyps_californianus:3.554197):2.188988,Cathartes_aura:5.743185):10.84591):40.447484):0.175416):0.552342,(((((((((((Calidris_bairdii:4.228354,Calidris_melanotos:4.228355):0.721063,Calidris_mauri:4.949417):0.597188,(Calidris_alba:4.799257,Calidris_minutilla:4.799257):0.747348):0.928535,(Calidris_ptilocnemis:4.342482,Calidris_alpina:4.342482):2.132658):1.149079,Calidris_canutus:7.62422):3.509313,(Arenaria_interpres:3.533248,Arenaria_melanocephala:3.533248):7.600284):1.234303,((Gallinago_delicata:10.711284,(Limnodromus_griseus:5.529963,Limnodromus_scolopaceus:5.529963):5.181322):1.375692,(((Tringa_solitaria:7.846535,((Tringa_melanoleuca:6.221306,(Tringa_flavipes:5.250045,Tringa_semipalmata:5.250045):0.971262):0.372349,Tringa_incana:6.593656):1.252879):2.273961,Phalaropus_fulicarius:10.120496):0.508933,Actitis_macularius:10.629429):1.457548):0.280858):0.808214,Limosa_fedoa:13.176049):0.875709,(Numenius_americanus:7.01717,Numenius_phaeopus:7.01717):7.034588):7.503049,((((((Chlidonias_niger:4.717037,((Sterna_hirundo:3.62124,Sterna_forsteri:3.62124):0.268369,(Thalasseus_elegans:1.230911,Thalasseus_maximus:1.230912):2.658698):0.827428):0.955816,(Gelochelidon_nilotica:4.350884,Hydroprogne_caspia:4.350884):1.321968):1.505717,Sternula_antillarum:7.178569):4.533572,Rynchops_niger:11.712141):0.654253,(((((((Larus_hyperboreus:0.185546,Larus_glaucoides:0.185546):0.003055,Larus_glaucescens:0.188601):0.263007,Larus_californicus:0.451609):0.374466,Larus_occidentalis:0.826074):0.18028,Larus_delawarensis:1.006355):0.196994,Larus_heermanni:1.203348):3.257797,(Xema_sabini:3.479007,Rissa_tridactyla:3.479007):0.982139):7.905248):0.839622,((((Cerorhinca_monocerata:4.962971,Fratercula_cirrhata:4.962971):4.069719,Ptychoramphus_aleuticus:9.03269):0.727745,(((Uria_aalge:7.923653,(Synthliboramphus_antiquus:3.720373,(Synthliboramphus_hypoleucus:0.671056,Synthliboramphus_craveri:0.671056):3.049317):4.20328):0.407386,Cepphus_columba:8.331039):0.426139,Brachyramphus_marmoratus:8.757178):1.003257):1.771281,Stercorarius_pomarinus:11.531716):1.6743):8.348792):1.743606,(((Charadrius_montanus:9.995173,(Charadrius_semipalmatus:6.536113,Charadrius_vociferus:6.536113):3.45906):1.702327,Recurvirostra_americana:11.697501):0.798071,((Pluvialis_fulva:2.455897,Pluvialis_dominica:2.455897):1.178289,Pluvialis_squatarola:3.634185):8.861386):10.802842):34.465924):0.473736,((((Columbina_inca:3.404918,Columbina_passerina:3.404918):8.482142,((Zenaida_asiatica:6.129893,Zenaida_macroura:6.129893):3.814154,Patagioenas_fasciata:9.944047):1.943014):22.893088,(Podilymbus_podiceps:7.533322,(((Podiceps_auritus:3.080437,Podiceps_grisegena:3.080437):1.451611,Podiceps_nigricollis:4.532048):0.835204,(Aechmophorus_clarkii:0.649792,Aechmophorus_occidentalis:0.649792):4.71746):2.166071):27.246826):0.63047,(((Cypseloides_niger:10.552193,(Aeronautes_saxatalis:7.70865,Chaetura_vauxi:7.708649):2.843543):21.460899,(Archilochus_alexandri:4.492772,(((Selasphorus_sasin:1.25153,(Selasphorus_calliope:0.828849,Selasphorus_rufus:0.828849):0.422681):0.256848,Selasphorus_platycercus:1.508378):0.915832,(Calypte_anna:1.752307,Calypte_costae:1.752307):0.671904):2.068562):27.52032):2.173856,(Phalaenoptilus_nuttallii:9.381208,(Chordeiles_acutipennis:4.827009,Chordeiles_minor:4.827009):4.554198):24.805739):1.223671):22.827456):3.416457,(((((((((Botaurus_lentiginosus:7.844435,Ixobrychus_exilis:7.844434):4.109641,((((Bubulcus_ibis:5.166884,Ardea_alba:5.166884):0.893851,Ardea_herodias:6.060735):2.772452,Nycticorax_nycticorax:8.833187):0.574409,(Egretta_caerulea:4.018093,Egretta_thula:4.018093):5.389502):2.546481):12.342126,(Pelecanus_erythrorhynchos:4.196515,Pelecanus_occidentalis:4.196516):20.099686):1.029739,Plegadis_chihi:25.325942):23.512005,Fregata_magnificens:48.837946):1.031774,Mycteria_americana:49.869719):10.866735,(((Pterodroma_cookii:8.933823,Puffinus_opisthomelas:8.933826):0.331096,Fulmarus_glacialis:9.26492):3.849296,((Phoebastria_immutabilis:1.85668,Phoebastria_nigripes:1.85668):0.562903,Phoebastria_albatrus:2.419582):10.694634):47.622239):0.137649,((Gavia_immer:1.471913,Gavia_pacifica:1.471913):4.785063,Gavia_stellata:6.256976):54.617128):0.372954,((Coccyzus_americanus:20.634502,Geococcyx_californianus:20.634503):10.43379,(((Fulica_americana:5.83685,Gallinula_galeata:5.836849):3.314091,Porzana_carolina:9.15094):2.511697,(Laterallus_jamaicensis:11.336317,Rallus_limicola:11.336317):0.32632):19.405654):30.178765):0.407474):2.979476,((((((Anas_platyrhynchos:3.223317,Anas_acuta:3.223318):2.598536,((Aythya_marila:0.342269,Aythya_affinis:0.342269):1.154018,((Aythya_americana:0.805757,Aythya_collaris:0.805757):0.461603,Aythya_valisineria:1.26736):0.228926):4.325566):1.213051,(Aix_sponsa:6.70241,((((Bucephala_albeola:3.701376,(Bucephala_clangula:1.11771,Bucephala_islandica:1.11771):2.583666):1.514894,((Mergus_merganser:1.873201,Mergus_serrator:1.873201):1.916388,Lophodytes_cucullatus:3.789589):1.426681):0.502879,Melanitta_perspicillata:5.719149):0.771899,Histrionicus_histrionicus:6.491048):0.211362):0.332494):2.655406,(((((Branta_hutchinsii:0.999185,Branta_canadensis:0.999184):2.080501,Branta_bernicla:3.079685):1.059406,Anser_albifrons:4.13909):2.225437,(Cygnus_columbianus:0.874443,Cygnus_buccinator:0.874443):5.490085):2.888657,Oxyura_jamaicensis:9.253185):0.437126):3.174907,Dendrocygna_bicolor:12.865217):41.141001,((((((Lagopus_leucura:4.060241,Centrocercus_urophasianus:4.06024):1.450073,Bonasa_umbellus:5.510314):1.796859,Meleagris_gallopavo:7.307173):0.657843,Phasianus_colchicus:7.965017):3.942481,Alectoris_chukar:11.907496):3.85599,((Callipepla_californica:0.906981,Callipepla_gambelii:0.906981):6.06878,Oreortyx_pictus:6.975761):8.787725):38.242733):10.627788);'
        
        let tree = new phylotree.phylotree(nwk);
        let renderedTree = tree.render({
            height:height, 
            width:width,
            'left-right-spacing': 'fit-to-size', 
            'top-bottom-spacing': 'fit-to-size',
            'is-radial': true,
            'brush': false,
            'collapsible': false,
            'selectable': false,
            'reroot': false,
            'hide': false,
            container: "#tree_container",
        })
        console.log(renderedTree)
        console.log(tree.display)

        console.log(treemap)
        console.log(hex_id)

        // break out here if we don't have a selected hex (just render empty tree)
        if(!treemap || !hex_id) {
            renderedTree.update();
            //let tree_svg = tree.display.show();
            return;
        }

        let nodeParents = []

        renderedTree.style_edges (function (element, data) {
            //if(!treemap || !treemap[hex_id] || !data?.target?.data?.name) return;
            if(treemap && treemap[hex_id]?.includes(data.target.data.name)) {
                element.style("stroke", getBrandColors()['500']);
                element.style ("stroke-width", "2px");
                nodeParents.push(getParentNodes(data))
            }
            
            // if (data.target.data._cp_id > 0) {
            //     element.style ("stroke", colors(data.target.data._cp_id));
            // } else {
            //     element.style ("stroke", null);
            // }
            // if (+data.target.data.bootstrap_values >= bootstrap_threshold) {
            //      element.style ("stroke-width", "5px");
            // } else {            
            //      element.style ("stroke-width", null);
            // }
        });

        console.log(nodeParents);

        renderedTree.update();

        let tree_svg = tree.display.show();

        tree_svg.querySelectorAll(`.node-circle`).forEach((x) => x.attr('r', 0))
        
        for(let value of treemap[hex_id]) {

            let node_group = tree_svg.querySelector(`[data-node-name="${value}"]`);
            if(!node_group) continue;

            let node_text = node_group.firstChild;

            //node_group.appendChild(node_circle_anno)
            d3.select(node_group).append("circle").classed("node-circle", true).attr('r', 3).attr('title', value).style('fill', getBrandColors()['500'])

            //d3.select(node_group).append("text").classed("node-tooltip", true).text(value)

            // console.log(node_text)
            // node_text.classList.add('shown-node');

            //node_text.style['color'] = "blue !important";
            // console.log(node_text.classList);
        }

        for(let node of tree.getNodes()) {
            console.log(node)
        }

        tree_svg.setAttribute("width", width);
        tree_svg.setAttribute("height", height);
        tree_svg.setAttribute("viewBox", `${width / 16} ${width / 16} ${width / 3.3} ${height / 3.3}`); 

        console.log(tree_svg)
        treeref.appendChild(tree_svg)

        console.log(treeref.querySelectorAll('.node-circle'))
        treeref.querySelectorAll('.node-circle').forEach((elem) => {
            elem.addEventListener('mouseover', (e) => {
                let layerWidth = document.querySelector('#tree_container').clientWidth;
                //tooltipX = e.layerX; tooltipY = e.layerY;
                tooltipFlip = false;

                let tooltipWidth = document.querySelector('.tree_tooltip').clientWidth;
                let widthPadding = 0;

                if(window.innerWidth - e.screenX < (tooltipWidth + widthPadding)) {
                    tooltipFlip = true;
                }

                showTooltip = true;
                tooltipText = e.target.attributes.title.value;
                //d3.select(elem.parentElement).append("rect").classed("node-tooltip", true)
                // d3.select(elem.parentElement).append("text").classed("node-tooltip", true).text(e.target.attributes.title.value).attr("textLength", 100)
            })
            elem.addEventListener('mouseout', (e) => {
                //d3.select(elem.parentElement).select('.node-tooltip').remove();
                showTooltip = false;
            })
        })

        tree_svg.addEventListener('mousemove', (e) => {
            if(e.target.localName !== "svg") return;
            tooltipX = e.layerX;
            tooltipY = e.layerY;
        })

    }

    function getParentNodes(node) {
        if(!node?.target?.parent) return;
        let parent = node?.target?.parent;
        return getParentNodes(parent);
    }

    async function buildNodeMap(type) {
        //return list;
        return fetch(`/phast/data/${type}_hex_species.json`).then((res) => res.json())
        .then((actualNodes) => {
            treemap = JSON.parse(actualNodes[0]);
            return treemap;
        })
    }

    onMount(async () => {
        buildNodeMap(clade).then((map) => rerender(hex_id)).then(() => console.log('built node map'))   
    })

</script>

<div class="phylo-container">
    {#if header}<h2>Taxa found in this area</h2>{/if}
    <div id="tree_container" bind:this={treeref}>
        <div class={`tree_tooltip ${showTooltip ? 'shown' : 'hidden'} ${tooltipFlip ? 'flip' : ''}`} style={`margin-top: calc(${tooltipY}px - 2rem); left: ${tooltipX}px;`}><span>{tooltipText}</span></div>
    </div>
</div>


<style lang="scss">

    @import '../style/frames.scss';
    @import '../style/colors.scss';

    .phylo-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        overflow: hidden;
        box-sizing: border-box;
        padding: 1rem;
        height: 100%;
    }

    #tree_container {
        display: flex;
        flex-direction: row;
        justify-content: center;
        aspect-ratio: 1/1;
        height: 85%;
    }

    .tree_tooltip {
        display: flex;
        position: absolute;
        background: $theme-900;
        color: white;
        padding: 0.5rem;
        padding-bottom: 0.6rem;
        transform-origin: bottom left;
        transform: translateY(-2rem);
        clip-path: polygon(0% 0%, 100% 0%, 100% 90%, 10% 90%, 0% 110%);
        border-radius: 0.5rem;
        border-bottom-right-radius: 0.8rem;
        &.hidden {
            opacity: 0;
            z-index: -1000;
            //display: none;
            //transform: inherit scaleY(0.1);
        }
        &.flip {
            transform-origin: top left;
            transform: scaleX(-1) translateY(-100%);
            > * {
                transform: scaleX(-1);
            }
            //clip-path: polygon(0% 0%, 100% 0%, 100% 110%, 90% 90%, 0% 90%);
            //text-align: right;
        }
        transition: all 0.3s ease, margin-top 0s ease, left 0s ease, transform 0s ease;
    }


    :global(path.branch) {
        fill: none;
        stroke: black;
        stroke-width: 0.5px;
    }
    :global(text.phylotree-node-text) {
        fill: black !important;
        font-size: 0.2rem !important;
        display: none;
    }

    :global(.shown-node) {
        display: block !important;
        fill: blue !important;
        //font-size: 5rem;
    }

    // :global(circle) {
    //     fill: none;
    //     stroke: none;
    // }
    :global(circle) {
        fill: none;
        stroke: none;
        transition: all 0.3s ease;
    }
    :global(.node-circle) {
        fill: $theme-700 !important;
        &:hover {
            transform: scale(2);
        }
    }

    :global(.node-circle:hover .node-tooltip) {
        fill: blue !important;
    }

    :global(text.node-tooltip ) {
        fill: white;
        font-size: 1rem;
        white-space: nowrap;
        transform: translate(-1rem, -1rem);
    }
    :global(rect.node-tooltip ) {
        fill: red;
        width: 100px;
        height: -50px;
        white-space: nowrap;
        transform: translate(-1rem, -1rem);
    }

    :global(.tree-scale-bar) {
        display: none;
    }

    
    :global(svg) {
        height: 100%;
        width: 100%;
    }

    h2 {
        @include graph-header;
        text-align: center;
        width: 100%;
    }

    :global(html) {
        overflow: hidden;
    }

</style>